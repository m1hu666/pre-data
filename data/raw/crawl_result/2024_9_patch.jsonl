[
    {
        "query_url": "https://api.github.com/repos/StarCitizenTools/mediawiki-skins-Citizen/commits/717d16af35b10dab04d434aefddbf991fc8c168c",
        "url": "https://api.github.com/repos/StarCitizenTools/mediawiki-skins-Citizen/commits/717d16af35b10dab04d434aefddbf991fc8c168c",
        "html_url": "https://github.com/StarCitizenTools/mediawiki-skins-Citizen/commit/717d16af35b10dab04d434aefddbf991fc8c168c",
        "message": "feat(core): \u2728 display real name in user menu when exists\n\nCloses: #652\nCo-authored-by: SimonTaurus <simon.stier@gmx.de>",
        "files": [
            {
                "sha": "dc80f83fc8b967f8b0e4c5cd2cc5c59dd57d8f5b",
                "filename": "includes/Partials/Header.php",
                "status": "modified",
                "additions": 16,
                "deletions": 1,
                "changes": 17,
                "blob_url": "https://github.com/StarCitizenTools/mediawiki-skins-Citizen/blob/717d16af35b10dab04d434aefddbf991fc8c168c/includes%2FPartials%2FHeader.php",
                "raw_url": "https://github.com/StarCitizenTools/mediawiki-skins-Citizen/raw/717d16af35b10dab04d434aefddbf991fc8c168c/includes%2FPartials%2FHeader.php",
                "contents_url": "https://api.github.com/repos/StarCitizenTools/mediawiki-skins-Citizen/contents/includes%2FPartials%2FHeader.php?ref=717d16af35b10dab04d434aefddbf991fc8c168c",
                "patch": "@@ -82,7 +82,22 @@ public function getUserInfoData( $userPageData ): array {\n \t */\n \tprivate function getUserPageHTML( $isRegistered, $userPageData ): ?string {\n \t\tif ( $isRegistered ) {\n-\t\t\t$html = $userPageData['html-items'];\n+\t\t\t$realname = $this->user->getRealName();\n+\t\t\tif ( !empty( $realname ) ) {\n+\t\t\t\t$username = $this->user->getName();\n+\t\t\t\t$innerHtml = <<<HTML\n+\t\t\t\t\t<div id=\"pt-userpage-realname\">$realname</div>\n+\t\t\t\t\t<div id=\"pt-userpage-username\">$username</div>\n+\t\t\t\tHTML;\n+\t\t\t\t// Dirty but it works\n+\t\t\t\t$html = str_replace(\n+\t\t\t\t\t\">\" . $username . \"<\",\n+\t\t\t\t\t\">\" . $innerHtml . \"<\",\n+\t\t\t\t\t$userPageData['html-items']\n+\t\t\t\t);\n+\t\t\t} else {\n+\t\t\t\t$html = $userPageData['html-items'];\n+\t\t\t}\n \t\t} else {\n \t\t\t// There must be a cleaner way to do this\n \t\t\t$msg = $this->skin->msg( 'notloggedin' )->text();"
            },
            {
                "sha": "31889fa960ebb119dc0129986ef2c90f28f48cd0",
                "filename": "resources/skins.citizen.styles/components/Usermenu.less",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/StarCitizenTools/mediawiki-skins-Citizen/blob/717d16af35b10dab04d434aefddbf991fc8c168c/resources%2Fskins.citizen.styles%2Fcomponents%2FUsermenu.less",
                "raw_url": "https://github.com/StarCitizenTools/mediawiki-skins-Citizen/raw/717d16af35b10dab04d434aefddbf991fc8c168c/resources%2Fskins.citizen.styles%2Fcomponents%2FUsermenu.less",
                "contents_url": "https://api.github.com/repos/StarCitizenTools/mediawiki-skins-Citizen/contents/resources%2Fskins.citizen.styles%2Fcomponents%2FUsermenu.less?ref=717d16af35b10dab04d434aefddbf991fc8c168c",
                "patch": "@@ -98,6 +98,16 @@\n \t\t\t}\n \t\t}\n \n+\t\t&page {\n+\t\t\t&-username {\n+\t\t\t\tmargin-top: var( --space-xxs );\n+\t\t\t\tmargin-bottom: var( --space-sm );\n+\t\t\t\tcolor: var( --color-base--subtle );\n+\t\t\t\tfont-size: 0.8125rem;\n+\t\t\t\tfont-weight: var( --font-weight-normal );\n+\t\t\t}\n+\t\t}\n+\n \t\t&contris {\n \t\t\tfont-weight: var( --font-weight-medium );\n \t\t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/StarCitizenTools/mediawiki-skins-Citizen/commits/86da3e07718c8d8da6f4310386fef85599606f9b",
        "url": "https://api.github.com/repos/StarCitizenTools/mediawiki-skins-Citizen/commits/86da3e07718c8d8da6f4310386fef85599606f9b",
        "html_url": "https://github.com/StarCitizenTools/mediawiki-skins-Citizen/commit/86da3e07718c8d8da6f4310386fef85599606f9b",
        "message": "fix(userInfo): \ud83d\udc1b escape html characters for real name\n\nGHSA-62r2-gcxr-426x",
        "files": [
            {
                "sha": "dd6e711f1e54dad9091845fb8a3e5a658bb009e4",
                "filename": "includes/Components/CitizenComponentUserInfo.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/StarCitizenTools/mediawiki-skins-Citizen/blob/86da3e07718c8d8da6f4310386fef85599606f9b/includes%2FComponents%2FCitizenComponentUserInfo.php",
                "raw_url": "https://github.com/StarCitizenTools/mediawiki-skins-Citizen/raw/86da3e07718c8d8da6f4310386fef85599606f9b/includes%2FComponents%2FCitizenComponentUserInfo.php",
                "contents_url": "https://api.github.com/repos/StarCitizenTools/mediawiki-skins-Citizen/contents/includes%2FComponents%2FCitizenComponentUserInfo.php?ref=86da3e07718c8d8da6f4310386fef85599606f9b",
                "patch": "@@ -130,9 +130,9 @@ private function getUserPage(): array {\n \t\t$userPageData = $this->userPageData;\n \n \t\t$htmlItems = $userPageData['html-items'];\n-\t\t$realname = $user->getRealName();\n+\t\t$realname = htmlspecialchars( $user->getRealName(), ENT_QUOTES );\n \t\tif ( !empty( $realname ) ) {\n-\t\t\t$username = $user->getName();\n+\t\t\t$username = htmlspecialchars( $user->getName(), ENT_QUOTES );\n \t\t\t$innerHtml = <<<HTML\n \t\t\t\t<span id=\"pt-userpage-realname\">$realname</span>\n \t\t\t\t<span id=\"pt-userpage-username\">$username</span>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/alist-org/alist/commits/6100647310594868e931f3de1188ddd8bde93b78",
        "url": "https://api.github.com/repos/AlistGo/alist/commits/6100647310594868e931f3de1188ddd8bde93b78",
        "html_url": "https://github.com/AlistGo/alist/commit/6100647310594868e931f3de1188ddd8bde93b78",
        "message": "fix: reflected XSS vulnerability plist api",
        "files": [
            {
                "sha": "bd41c42c3bfb93aa07bacc2f24b1aa67740c4571",
                "filename": "server/handles/helper.go",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/AlistGo/alist/blob/6100647310594868e931f3de1188ddd8bde93b78/server%2Fhandles%2Fhelper.go",
                "raw_url": "https://github.com/AlistGo/alist/raw/6100647310594868e931f3de1188ddd8bde93b78/server%2Fhandles%2Fhelper.go",
                "contents_url": "https://api.github.com/repos/AlistGo/alist/contents/server%2Fhandles%2Fhelper.go?ref=6100647310594868e931f3de1188ddd8bde93b78",
                "patch": "@@ -45,6 +45,8 @@ func Plist(c *gin.Context) {\n \t}\n \tfullName := c.Param(\"name\")\n \tUrl := link.String()\n+\tUrl = strings.ReplaceAll(Url, \"<\", \"[\")\n+\tUrl = strings.ReplaceAll(Url, \">\", \"]\")\n \tnameEncode := linkNameSplit[1]\n \tfullName, err = url.PathUnescape(nameEncode)\n \tif err != nil {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/zopefoundation/RestrictedPython/commits/d701cc36cccac36b21fa200f1f2d1945a9a215e6",
        "url": "https://api.github.com/repos/zopefoundation/RestrictedPython/commits/d701cc36cccac36b21fa200f1f2d1945a9a215e6",
        "html_url": "https://github.com/zopefoundation/RestrictedPython/commit/d701cc36cccac36b21fa200f1f2d1945a9a215e6",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "68d79980874792950197cd22c393fb237ead0053",
                "filename": "CHANGES.rst",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/zopefoundation/RestrictedPython/blob/d701cc36cccac36b21fa200f1f2d1945a9a215e6/CHANGES.rst",
                "raw_url": "https://github.com/zopefoundation/RestrictedPython/raw/d701cc36cccac36b21fa200f1f2d1945a9a215e6/CHANGES.rst",
                "contents_url": "https://api.github.com/repos/zopefoundation/RestrictedPython/contents/CHANGES.rst?ref=d701cc36cccac36b21fa200f1f2d1945a9a215e6",
                "patch": "@@ -10,6 +10,8 @@ Changes\n   it as ``getattr`` implementation. Such use should now follow the same policy\n   and give the same level of protection as direct attribute access in an\n   environment based on ``RestrictedPython``'s ``safe_builtints``.\n+- Prevent information leakage via ``AttributeError.obj``\n+  and the ``string`` module.\n \n \n 7.2 (2024-08-02)"
            },
            {
                "sha": "26d73d15584bc25c7ee3bf75da3bef74a01b7e5c",
                "filename": "src/RestrictedPython/Utilities.py",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/zopefoundation/RestrictedPython/blob/d701cc36cccac36b21fa200f1f2d1945a9a215e6/src%2FRestrictedPython%2FUtilities.py",
                "raw_url": "https://github.com/zopefoundation/RestrictedPython/raw/d701cc36cccac36b21fa200f1f2d1945a9a215e6/src%2FRestrictedPython%2FUtilities.py",
                "contents_url": "https://api.github.com/repos/zopefoundation/RestrictedPython/contents/src%2FRestrictedPython%2FUtilities.py?ref=d701cc36cccac36b21fa200f1f2d1945a9a215e6",
                "patch": "@@ -29,7 +29,11 @@ def __getattr__(self, attr):\n         if attr in self.__excludes:\n             raise NotImplementedError(\n                 f\"{self.__mod.__name__}.{attr} is not safe\")\n-        return getattr(self.__mod, attr)\n+        try:\n+            return getattr(self.__mod, attr)\n+        except AttributeError as e:\n+            e.obj = self\n+            raise\n \n \n utility_builtins['string'] = _AttributeDelegator(string, \"Formatter\")"
            },
            {
                "sha": "0d3992eef888426b8c751692e52ee7dfd7c2220b",
                "filename": "tests/builtins/test_utilities.py",
                "status": "modified",
                "additions": 11,
                "deletions": 2,
                "changes": 13,
                "blob_url": "https://github.com/zopefoundation/RestrictedPython/blob/d701cc36cccac36b21fa200f1f2d1945a9a215e6/tests%2Fbuiltins%2Ftest_utilities.py",
                "raw_url": "https://github.com/zopefoundation/RestrictedPython/raw/d701cc36cccac36b21fa200f1f2d1945a9a215e6/tests%2Fbuiltins%2Ftest_utilities.py",
                "contents_url": "https://api.github.com/repos/zopefoundation/RestrictedPython/contents/tests%2Fbuiltins%2Ftest_utilities.py?ref=d701cc36cccac36b21fa200f1f2d1945a9a215e6",
                "patch": "@@ -7,8 +7,17 @@ def test_string_in_utility_builtins():\n     from RestrictedPython.Utilities import utility_builtins\n \n     # we no longer provide access to ``string`` itself, only to\n-    # a restricted view of it\n-    assert utility_builtins['string'].__name__ == string.__name__\n+    # a restricted view of it (``rstring``)\n+    rstring = utility_builtins['string']\n+    assert rstring.__name__ == string.__name__\n+\n+    # ensure it does not provide access to ``string`` via\n+    # ``AttributeError.obj``\n+    try:\n+        rstring.unexisting_attribute\n+    except AttributeError as e:\n+        assert e.obj is rstring\n+        \n \n \n def test_math_in_utility_builtins():"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Clinical-Genomics/scout/commits/f59e50f8ea596e641da8a0e9c7a33c0696bcbea5",
        "url": "https://api.github.com/repos/Clinical-Genomics/scout/commits/f59e50f8ea596e641da8a0e9c7a33c0696bcbea5",
        "html_url": "https://github.com/Clinical-Genomics/scout/commit/f59e50f8ea596e641da8a0e9c7a33c0696bcbea5",
        "message": "Fix regular expression check in new panel form (#4843)\n\n* Fix regular expression check in new panel form\r\n\r\n* Sanitize panel ID before exporting the file\r\n\r\n* Stricter check of ID of newly created gene panels to prevent file downloading vulnerability\r\n\r\n* Add again the new pattern in the HTML check\r\n\r\n* tiny fix in changelog\r\n\r\n---------\r\n\r\nCo-authored-by: Chiara Rasi <rasi.chiara@gmacil.com>",
        "files": [
            {
                "sha": "3bd0120393f385b1544c1736abc7c151ca55ee3f",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Clinical-Genomics/scout/blob/f59e50f8ea596e641da8a0e9c7a33c0696bcbea5/CHANGELOG.md",
                "raw_url": "https://github.com/Clinical-Genomics/scout/raw/f59e50f8ea596e641da8a0e9c7a33c0696bcbea5/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/Clinical-Genomics/scout/contents/CHANGELOG.md?ref=f59e50f8ea596e641da8a0e9c7a33c0696bcbea5",
                "patch": "@@ -14,6 +14,7 @@ About changelog [here](https://keepachangelog.com/en/1.0.0/)\n ### Fixed\n - Broken heading anchors in the documentation (`admin-guide/login-system.md` and `admin-guide/setup-scout.md` files)\n - Avoid open login redirect attacks by always redirecting to cases page upon user login\n+- Stricter check of ID of gene panels to prevent file downloading vulnerability\n \n ## [4.88.1]\n ### Fixed"
            },
            {
                "sha": "fb6d66a9cfefa6f2b977425c609c98bf912fd366",
                "filename": "scout/server/blueprints/panels/controllers.py",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/Clinical-Genomics/scout/blob/f59e50f8ea596e641da8a0e9c7a33c0696bcbea5/scout%2Fserver%2Fblueprints%2Fpanels%2Fcontrollers.py",
                "raw_url": "https://github.com/Clinical-Genomics/scout/raw/f59e50f8ea596e641da8a0e9c7a33c0696bcbea5/scout%2Fserver%2Fblueprints%2Fpanels%2Fcontrollers.py",
                "contents_url": "https://api.github.com/repos/Clinical-Genomics/scout/contents/scout%2Fserver%2Fblueprints%2Fpanels%2Fcontrollers.py?ref=f59e50f8ea596e641da8a0e9c7a33c0696bcbea5",
                "patch": "@@ -1,6 +1,7 @@\n # -*- coding: utf-8 -*-\n import datetime as dt\n import logging\n+import re\n \n from flask import flash, redirect\n from flask_login import current_user\n@@ -309,9 +310,11 @@ def downloaded_panel_name(panel_obj, format) -> str:\n     Returns:\n         a string describing the panel\n     \"\"\"\n+    sanitized_panel_id = re.sub(r\"[^a-zA-Z_\\-]+\", \"\", panel_obj[\"panel_name\"])\n+\n     return \"_\".join(\n         [\n-            panel_obj[\"panel_name\"],\n+            sanitized_panel_id,\n             str(panel_obj[\"version\"]),\n             dt.datetime.now().strftime(DATE_DAY_FORMATTER),\n             f\"scout.{format}\","
            },
            {
                "sha": "a9ea734396686cde1eb4c88e4550f9157488336a",
                "filename": "scout/server/blueprints/panels/templates/panels/panels.html",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Clinical-Genomics/scout/blob/f59e50f8ea596e641da8a0e9c7a33c0696bcbea5/scout%2Fserver%2Fblueprints%2Fpanels%2Ftemplates%2Fpanels%2Fpanels.html",
                "raw_url": "https://github.com/Clinical-Genomics/scout/raw/f59e50f8ea596e641da8a0e9c7a33c0696bcbea5/scout%2Fserver%2Fblueprints%2Fpanels%2Ftemplates%2Fpanels%2Fpanels.html",
                "contents_url": "https://api.github.com/repos/Clinical-Genomics/scout/contents/scout%2Fserver%2Fblueprints%2Fpanels%2Ftemplates%2Fpanels%2Fpanels.html?ref=f59e50f8ea596e641da8a0e9c7a33c0696bcbea5",
                "patch": "@@ -109,7 +109,7 @@\n           </div>\n           <div class=\"col-sm-3 text-center\">\n               <input type=\"text\" name=\"new_panel_name\" class=\"form-control\" placeholder=\"Panel ID\" required\n-                pattern=\"^[a-zA-Z0-9_-]*$\" title=\"Only alphanumeric characters (A-Z+a-z+0-9), hyphens, and underscores allowed.\">\n+                pattern=\"[A-Za-z0-9_\\-]+\" title=\"Only alphanumeric characters (A-Z+a-z+0-9), hyphens, and underscores allowed.\">\n             </div>\n             <div class=\"col-sm-4 text-center\">\n               <input type=\"text\" name=\"display_name\" class=\"form-control\" placeholder=\"Full name\">"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Clinical-Genomics/scout/commits/50055edfca9a7183b248019af97e1fb0b0065a02",
        "url": "https://api.github.com/repos/Clinical-Genomics/scout/commits/50055edfca9a7183b248019af97e1fb0b0065a02",
        "html_url": "https://github.com/Clinical-Genomics/scout/commit/50055edfca9a7183b248019af97e1fb0b0065a02",
        "message": "Avoid open login redirect attacks via next (#4841)\n\n* Avoid open login redirect attacks via next\r\n\r\n* Remove next also where it comes from\r\n\r\n* typo\r\n\r\n---------\r\n\r\nCo-authored-by: Chiara Rasi <rasi.chiara@gmacil.com>",
        "files": [
            {
                "sha": "705c5dedc760da0c12651bd9547278306159ebe0",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Clinical-Genomics/scout/blob/50055edfca9a7183b248019af97e1fb0b0065a02/CHANGELOG.md",
                "raw_url": "https://github.com/Clinical-Genomics/scout/raw/50055edfca9a7183b248019af97e1fb0b0065a02/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/Clinical-Genomics/scout/contents/CHANGELOG.md?ref=50055edfca9a7183b248019af97e1fb0b0065a02",
                "patch": "@@ -12,6 +12,7 @@ About changelog [here](https://keepachangelog.com/en/1.0.0/)\n - Documentation for OMICS variants and updating a case\n ### Fixed\n - Broken heading anchors in the documentation (`admin-guide/login-system.md` and `admin-guide/setup-scout.md` files)\n+- Avoid open login redirect attacks by always redirecting to cases page upon user login\n \n ## [4.88.1]\n ### Fixed"
            },
            {
                "sha": "7e784d4fcb1af9f7b56b4c9f67d11889044cf25f",
                "filename": "scout/server/app.py",
                "status": "modified",
                "additions": 1,
                "deletions": 4,
                "changes": 5,
                "blob_url": "https://github.com/Clinical-Genomics/scout/blob/50055edfca9a7183b248019af97e1fb0b0065a02/scout%2Fserver%2Fapp.py",
                "raw_url": "https://github.com/Clinical-Genomics/scout/raw/50055edfca9a7183b248019af97e1fb0b0065a02/scout%2Fserver%2Fapp.py",
                "contents_url": "https://api.github.com/repos/Clinical-Genomics/scout/contents/scout%2Fserver%2Fapp.py?ref=50055edfca9a7183b248019af97e1fb0b0065a02",
                "patch": "@@ -83,10 +83,7 @@ def check_user():\n             relevant_endpoint = not (static_endpoint or public_endpoint)\n             # if endpoint requires auth, check if user is authenticated\n             if relevant_endpoint and not current_user.is_authenticated:\n-                # combine visited URL (convert byte string query string to unicode!)\n-                next_url = \"{}?{}\".format(request.path, request.query_string.decode())\n-                login_url = url_for(\"public.index\", next=next_url)\n-                return redirect(login_url)\n+                return redirect(url_for(\"public.index\"))\n \n     return app\n "
            },
            {
                "sha": "66d45a5a9f4adb8f55a41ccb969e774154d9a081",
                "filename": "scout/server/blueprints/login/views.py",
                "status": "modified",
                "additions": 1,
                "deletions": 4,
                "changes": 5,
                "blob_url": "https://github.com/Clinical-Genomics/scout/blob/50055edfca9a7183b248019af97e1fb0b0065a02/scout%2Fserver%2Fblueprints%2Flogin%2Fviews.py",
                "raw_url": "https://github.com/Clinical-Genomics/scout/raw/50055edfca9a7183b248019af97e1fb0b0065a02/scout%2Fserver%2Fblueprints%2Flogin%2Fviews.py",
                "contents_url": "https://api.github.com/repos/Clinical-Genomics/scout/contents/scout%2Fserver%2Fblueprints%2Flogin%2Fviews.py?ref=50055edfca9a7183b248019af97e1fb0b0065a02",
                "patch": "@@ -47,8 +47,6 @@ def load_user(user_id):\n @public_endpoint\n def login():\n     \"\"\"Login a user if they have access.\"\"\"\n-    if \"next\" in request.args:\n-        session[\"next_url\"] = request.args[\"next\"]\n \n     user_id = None\n     user_mail = None\n@@ -130,7 +128,6 @@ def users():\n def perform_login(user_dict):\n     if login_user(user_dict, remember=True):\n         flash(\"you logged in as: {}\".format(user_dict.name), \"success\")\n-        next_url = session.pop(\"next_url\", None)\n-        return redirect(request.args.get(\"next\") or next_url or url_for(\"cases.index\"))\n+        return redirect(url_for(\"cases.index\"))\n     flash(\"sorry, you could not log in\", \"warning\")\n     return redirect(url_for(\"public.index\"))"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/expressjs/basic-auth-connect/commits/bac1e6a8530e1efd0028800b9b588a37adb0d203",
        "url": "https://api.github.com/repos/expressjs/basic-auth-connect/commits/bac1e6a8530e1efd0028800b9b588a37adb0d203",
        "html_url": "https://github.com/expressjs/basic-auth-connect/commit/bac1e6a8530e1efd0028800b9b588a37adb0d203",
        "message": "feat: add timing safe equal comparison\n\n* chore: add tsscmp@1.0.6 as dependency\n* feat: add timing safe equal comparison\n\nCo-authored-by: Blake Embrey <hello@blakeembrey.com>",
        "files": [
            {
                "sha": "cb86d5f9469625feb16302b854f7f0ef2f05cfa7",
                "filename": "index.js",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/expressjs/basic-auth-connect/blob/bac1e6a8530e1efd0028800b9b588a37adb0d203/index.js",
                "raw_url": "https://github.com/expressjs/basic-auth-connect/raw/bac1e6a8530e1efd0028800b9b588a37adb0d203/index.js",
                "contents_url": "https://api.github.com/repos/expressjs/basic-auth-connect/contents/index.js?ref=bac1e6a8530e1efd0028800b9b588a37adb0d203",
                "patch": "@@ -1,3 +1,4 @@\n+var timingSafeCompare = require('tsscmp');\n var http = require('http');\n \n /*!\n@@ -53,7 +54,9 @@ module.exports = function basicAuth(callback, realm) {\n     if ('string' != typeof password) throw new Error('password argument required');\n     realm = arguments[2];\n     callback = function(user, pass){\n-      return user == username && pass == password;\n+      const usernameValid = timingSafeCompare(user, username);\n+      const passwordValid = timingSafeCompare(pass, password);\n+      return usernameValid && passwordValid;\n     }\n   }\n "
            },
            {
                "sha": "749972b1fc0bbb1feb19b1a7d130a6dff6f70b6b",
                "filename": "package.json",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/expressjs/basic-auth-connect/blob/bac1e6a8530e1efd0028800b9b588a37adb0d203/package.json",
                "raw_url": "https://github.com/expressjs/basic-auth-connect/raw/bac1e6a8530e1efd0028800b9b588a37adb0d203/package.json",
                "contents_url": "https://api.github.com/repos/expressjs/basic-auth-connect/contents/package.json?ref=bac1e6a8530e1efd0028800b9b588a37adb0d203",
                "patch": "@@ -18,12 +18,15 @@\n     \"url\": \"https://github.com/expressjs/basic-auth-connect/issues\"\n   },\n   \"devDependencies\": {\n+    \"connect\": \"*\",\n     \"mocha\": \"*\",\n     \"should\": \"*\",\n-    \"supertest\": \"*\",\n-    \"connect\": \"*\"\n+    \"supertest\": \"*\"\n   },\n   \"scripts\": {\n     \"test\": \"make test\"\n+  },\n+  \"dependencies\": {\n+    \"tsscmp\": \"^1.0.6\"\n   }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cvat-ai/cvat/commits/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
        "url": "https://api.github.com/repos/cvat-ai/cvat/commits/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
        "html_url": "https://github.com/cvat-ai/cvat/commit/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
        "message": "Merge commit from fork\n\n* Fix security issue when anyone could obtain project|task|job|membership details\n\n* Check additional permissions when trying to update task/project target/source storage",
        "files": [
            {
                "sha": "c7f58f2b8084215cbb02eb34e7f950ae79a09076",
                "filename": "changelog.d/20240920_124259_maria_fix_patch_security_issue.md",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/changelog.d%2F20240920_124259_maria_fix_patch_security_issue.md",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/changelog.d%2F20240920_124259_maria_fix_patch_security_issue.md",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/changelog.d%2F20240920_124259_maria_fix_patch_security_issue.md?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -0,0 +1,4 @@\n+### Security\n+\n+- Fixed a security issue that occurred in PATCH requests to projects|tasks|jobs|memberships\n+  (<https://github.com/cvat-ai/cvat/security/advisories/GHSA-gxhm-hg65-5gh2>)"
            },
            {
                "sha": "dacc57f836d437e5881181a609e5878a31065b0c",
                "filename": "cvat/apps/engine/permissions.py",
                "status": "modified",
                "additions": 17,
                "deletions": 13,
                "changes": 30,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Fpermissions.py",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Fpermissions.py",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/cvat%2Fapps%2Fengine%2Fpermissions.py?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -210,6 +210,7 @@ class Scopes(StrEnum):\n         UPDATE_ASSIGNEE = 'update:assignee'\n         UPDATE_DESC = 'update:desc'\n         UPDATE_ORG = 'update:organization'\n+        UPDATE_ASSOCIATED_STORAGE = 'update:associated_storage'\n         VIEW = 'view'\n         IMPORT_DATASET = 'import:dataset'\n         EXPORT_ANNOTATIONS = 'export:annotations'\n@@ -285,6 +286,9 @@ def get_scopes(request, view, obj):\n \n         scopes = []\n         if scope == Scopes.UPDATE:\n+            # user should have permissions to view a project\n+            scopes.append(Scopes.VIEW)\n+\n             if any(k in request.data for k in ('owner_id', 'owner')):\n                 owner_id = request.data.get('owner_id') or request.data.get('owner')\n                 if owner_id != getattr(obj.owner, 'id', None):\n@@ -299,6 +303,9 @@ def get_scopes(request, view, obj):\n                     break\n             if 'organization' in request.data:\n                 scopes.append(Scopes.UPDATE_ORG)\n+\n+            if {'source_storage', 'target_storage'} & request.data.keys():\n+                scopes.append(Scopes.UPDATE_ASSOCIATED_STORAGE)\n         else:\n             scopes.append(scope)\n \n@@ -376,6 +383,7 @@ class Scopes(StrEnum):\n         UPDATE_ASSIGNEE = 'update:assignee'\n         UPDATE_PROJECT = 'update:project'\n         UPDATE_OWNER = 'update:owner'\n+        UPDATE_ASSOCIATED_STORAGE = 'update:associated_storage'\n         DELETE = 'delete'\n         VIEW_ANNOTATIONS = 'view:annotations'\n         UPDATE_ANNOTATIONS = 'update:annotations'\n@@ -509,6 +517,8 @@ def get_scopes(request, view, obj) -> List[Scopes]:\n             scopes.append(scope)\n \n         elif scope == Scopes.UPDATE:\n+            # user should have permissions to view a task\n+            scopes.append(Scopes.VIEW)\n             if any(k in request.data for k in ('owner_id', 'owner')):\n                 owner_id = request.data.get('owner_id') or request.data.get('owner')\n                 if owner_id != getattr(obj.owner, 'id', None):\n@@ -530,6 +540,9 @@ def get_scopes(request, view, obj) -> List[Scopes]:\n             if request.data.get('organization'):\n                 scopes.append(Scopes.UPDATE_ORGANIZATION)\n \n+            if {'source_storage', 'target_storage'} & request.data.keys():\n+                scopes.append(Scopes.UPDATE_ASSOCIATED_STORAGE)\n+\n         elif scope == Scopes.VIEW_ANNOTATIONS:\n             if 'format' in request.query_params:\n                 scope = Scopes.EXPORT_ANNOTATIONS\n@@ -614,11 +627,8 @@ class Scopes(StrEnum):\n         VIEW = 'view'\n         UPDATE = 'update'\n         UPDATE_ASSIGNEE = 'update:assignee'\n-        UPDATE_OWNER = 'update:owner'\n-        UPDATE_PROJECT = 'update:project'\n         UPDATE_STAGE = 'update:stage'\n         UPDATE_STATE = 'update:state'\n-        UPDATE_DESC = 'update:desc'\n         DELETE = 'delete'\n         VIEW_ANNOTATIONS = 'view:annotations'\n         UPDATE_ANNOTATIONS = 'update:annotations'\n@@ -728,25 +738,19 @@ def get_scopes(request, view, obj):\n \n         scopes = []\n         if scope == Scopes.UPDATE:\n-            if any(k in request.data for k in ('owner_id', 'owner')):\n-                owner_id = request.data.get('owner_id') or request.data.get('owner')\n-                if owner_id != getattr(obj.owner, 'id', None):\n-                    scopes.append(Scopes.UPDATE_OWNER)\n+            # user should have permissions to view a job\n+            scopes.append(Scopes.VIEW)\n+\n             if any(k in request.data for k in ('assignee_id', 'assignee')):\n                 assignee_id = request.data.get('assignee_id') or request.data.get('assignee')\n                 if assignee_id != getattr(obj.assignee, 'id', None):\n                     scopes.append(Scopes.UPDATE_ASSIGNEE)\n-            if any(k in request.data for k in ('project_id', 'project')):\n-                project_id = request.data.get('project_id') or request.data.get('project')\n-                if project_id != getattr(obj.project, 'id', None):\n-                    scopes.append(Scopes.UPDATE_PROJECT)\n+\n             if 'stage' in request.data:\n                 scopes.append(Scopes.UPDATE_STAGE)\n             if 'state' in request.data:\n                 scopes.append(Scopes.UPDATE_STATE)\n \n-            if any(k in request.data for k in ('name', 'labels', 'bug_tracker', 'subset')):\n-                scopes.append(Scopes.UPDATE_DESC)\n         elif scope == Scopes.VIEW_ANNOTATIONS:\n             if 'format' in request.query_params:\n                 scope = Scopes.EXPORT_ANNOTATIONS"
            },
            {
                "sha": "8e40ddc43c8d53851295f1ed834c11788a644a1b",
                "filename": "cvat/apps/engine/rules/projects.rego",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Frules%2Fprojects.rego",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Frules%2Fprojects.rego",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/cvat%2Fapps%2Fengine%2Frules%2Fprojects.rego?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -7,7 +7,7 @@ import data.organizations\n \n # input: {\n #     \"scope\": <\"create\"|\"list\"|\"update:desc\"|\"update:owner\"|\"update:assignee\"|\n-#               \"view\"|\"delete\"|\"export:dataset\"|\"export:annotations\"|\n+#               \"update:associated_storage\"|\"view\"|\"delete\"|\"export:dataset\"|\"export:annotations\"|\n #               \"import:dataset\"> or null,\n #     \"auth\": {\n #         \"user\": {\n@@ -127,22 +127,22 @@ allow if {\n \n \n allow if {\n-    input.scope in {utils.DELETE, utils.UPDATE_ORG}\n+    input.scope in {utils.DELETE, utils.UPDATE_ORG, utils.UPDATE_ASSOCIATED_STORAGE}\n     utils.is_sandbox\n     utils.has_perm(utils.WORKER)\n     utils.is_resource_owner\n }\n \n allow if {\n-    input.scope in {utils.DELETE, utils.UPDATE_ORG}\n+    input.scope in {utils.DELETE, utils.UPDATE_ORG, utils.UPDATE_ASSOCIATED_STORAGE}\n     input.auth.organization.id == input.resource.organization.id\n     utils.has_perm(utils.WORKER)\n     organizations.is_member\n     utils.is_resource_owner\n }\n \n allow if {\n-    input.scope in {utils.DELETE, utils.UPDATE_ORG}\n+    input.scope in {utils.DELETE, utils.UPDATE_ORG, utils.UPDATE_ASSOCIATED_STORAGE}\n     input.auth.organization.id == input.resource.organization.id\n     utils.has_perm(utils.USER)\n     organizations.is_staff"
            },
            {
                "sha": "7f7d592bdb01e9dea880665c862bc9a89a0008d3",
                "filename": "cvat/apps/engine/rules/tasks.rego",
                "status": "modified",
                "additions": 19,
                "deletions": 5,
                "changes": 24,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Frules%2Ftasks.rego",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Frules%2Ftasks.rego",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/cvat%2Fapps%2Fengine%2Frules%2Ftasks.rego?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -7,8 +7,8 @@ import data.organizations\n \n # input: {\n #     \"scope\": <\"create\"|\"create@project\"|\"view\"|\"list\"|\"update:desc\"|\n-#         \"update:owner\"|\"update:assignee\"|\"update:project\"|\"delete\"|\n-#         \"view:annotations\"|\"update:annotations\"|\"delete:annotations\"|\n+#         \"update:owner\"|\"update:assignee\"|\"update:project\"|\"update:associated_storage\"|\n+#         \"delete\"|\"view:annotations\"|\"update:annotations\"|\"delete:annotations\"|\n #         \"export:dataset\"|\"view:data\"|\"upload:data\"|\"export:annotations\"> or null,\n #     \"auth\": {\n #         \"user\": {\n@@ -250,10 +250,17 @@ allow if {\n     utils.has_perm(utils.WORKER)\n }\n \n+allow if {\n+    input.scope == utils.UPDATE_ASSOCIATED_STORAGE\n+    utils.is_sandbox\n+    is_project_owner\n+    utils.has_perm(utils.WORKER)\n+}\n+\n allow if {\n     input.scope in {\n         utils.UPDATE_OWNER, utils.UPDATE_ASSIGNEE, utils.UPDATE_PROJECT,\n-        utils.DELETE, utils.UPDATE_ORG\n+        utils.DELETE, utils.UPDATE_ORG, utils.UPDATE_ASSOCIATED_STORAGE\n     }\n     utils.is_sandbox\n     is_task_owner\n@@ -263,7 +270,7 @@ allow if {\n allow if {\n     input.scope in {\n         utils.UPDATE_OWNER, utils.UPDATE_ASSIGNEE, utils.UPDATE_PROJECT,\n-        utils.DELETE, utils.UPDATE_ORG\n+        utils.DELETE, utils.UPDATE_ORG, utils.UPDATE_ASSOCIATED_STORAGE\n     }\n     input.auth.organization.id == input.resource.organization.id\n     utils.has_perm(utils.USER)\n@@ -273,13 +280,20 @@ allow if {\n allow if {\n     input.scope in {\n         utils.UPDATE_OWNER, utils.UPDATE_ASSIGNEE, utils.UPDATE_PROJECT,\n-        utils.DELETE, utils.UPDATE_ORG\n+        utils.DELETE, utils.UPDATE_ORG, utils.UPDATE_ASSOCIATED_STORAGE\n     }\n     input.auth.organization.id == input.resource.organization.id\n     utils.has_perm(utils.WORKER)\n     organizations.has_perm(organizations.WORKER)\n     is_task_owner\n }\n+allow if {\n+    input.scope == utils.UPDATE_ASSOCIATED_STORAGE\n+    input.auth.organization.id == input.resource.organization.id\n+    utils.has_perm(utils.WORKER)\n+    organizations.has_perm(organizations.WORKER)\n+    is_project_owner\n+}\n \n allow if {\n     input.scope in {"
            },
            {
                "sha": "5d42ba4a923452f93438310446cb05d809bc8390",
                "filename": "cvat/apps/engine/rules/tests/configs/projects.csv",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Frules%2Ftests%2Fconfigs%2Fprojects.csv",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Frules%2Ftests%2Fconfigs%2Fprojects.csv",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/cvat%2Fapps%2Fengine%2Frules%2Ftests%2Fconfigs%2Fprojects.csv?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -43,4 +43,9 @@ export:backup,Project,Organization,None,,GET,/projects/{id}/backup,User,Maintain\n update:organization,\"Project, Organization\",Sandbox,\"None, Assignee\",,PATCH,/projects/{id},Admin,N/A\n update:organization,\"Project, Organization\",Sandbox,Owner,,PATCH,/projects/{id},Worker,N/A\n update:organization,\"Project, Organization\",Organization,\"None, Assignee\",,PATCH,/projects/{id},User,Maintainer\n-update:organization,\"Project, Organization\",Organization,Owner,,PATCH,/projects/{id},Worker,Worker\n\\ No newline at end of file\n+update:organization,\"Project, Organization\",Organization,Owner,,PATCH,/projects/{id},Worker,Worker\n+update:associated_storage,Project,Sandbox,None,,PATCH,/projects/{id},Admin,N/A\n+update:associated_storage,Project,Sandbox,Owner,,PATCH,/projects/{id},Worker,N/A\n+update:associated_storage,Project,Organization,None,,PATCH,/projects/{id},Admin,N/A\n+update:associated_storage,Project,Organization,\"None, Assignee\",,PATCH,/projects/{id},User,Maintainer\n+update:associated_storage,Project,Organization,Owner,,PATCH,/projects/{id},Worker,Worker"
            },
            {
                "sha": "e5c17c3481040a85a7eba32793cc483cac1d36d9",
                "filename": "cvat/apps/engine/rules/tests/configs/tasks.csv",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Frules%2Ftests%2Fconfigs%2Ftasks.csv",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fengine%2Frules%2Ftests%2Fconfigs%2Ftasks.csv",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/cvat%2Fapps%2Fengine%2Frules%2Ftests%2Fconfigs%2Ftasks.csv?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -29,6 +29,11 @@ update:project,\"Task, Project\",Sandbox,\"None, Assignee\",,PATCH,/tasks/{id},Admin\n update:project,\"Task, Project\",Sandbox,\"Owner, Project:owner, Project:assignee\",,PATCH,/tasks/{id},Worker,N/A\n update:project,\"Task, Project\",Organization,\"None, Assignee\",,PATCH,/tasks/{id},User,Maintainer\n update:project,\"Task, Project\",Organization,\"Owner, Project:owner, Project:assignee\",,PATCH,/tasks/{id},Worker,Worker\n+update:associated_storage,Task,Sandbox,None,,PATCH,/tasks/{id},Admin,N/A\n+update:associated_storage,Task,Sandbox,\"Owner, Project:owner\",,PATCH,/tasks/{id},Worker,N/A\n+update:associated_storage,Task,Organization,None,,PATCH,/tasks/{id},Admin,N/A\n+update:associated_storage,Task,Organization,\"None, Assignee, Project:assignee\",,PATCH,/tasks/{id},User,Maintainer\n+update:associated_storage,Task,Organization,\"Owner, Project:owner\",,PATCH,/tasks/{id},Worker,Worker\n delete,Task,Sandbox,\"None, Assignee\",,DELETE,/tasks/{id},Admin,N/A\n delete,Task,Sandbox,\"Owner, Project:owner, Project:assignee\",,DELETE,/tasks/{id},Worker,N/A\n delete,Task,Organization,\"None, Assignee\",,DELETE,/tasks/{id},User,Maintainer"
            },
            {
                "sha": "7371f2e35edb916f10e2fd2126eac7e443c5116f",
                "filename": "cvat/apps/iam/rules/utils.rego",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fiam%2Frules%2Futils.rego",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Fiam%2Frules%2Futils.rego",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/cvat%2Fapps%2Fiam%2Frules%2Futils.rego?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -36,6 +36,7 @@ RESEND := \"resend\"\n UPDATE_DESC := \"update:desc\"\n UPDATE_ASSIGNEE := \"update:assignee\"\n UPDATE_OWNER := \"update:owner\"\n+UPDATE_ASSOCIATED_STORAGE := \"update:associated_storage\"\n EXPORT_ANNOTATIONS := \"export:annotations\"\n EXPORT_DATASET := \"export:dataset\"\n CREATE_IN_PROJECT := \"create@project\""
            },
            {
                "sha": "3bf1eb655fe469cccfa666e8fe267d0a867a8d1f",
                "filename": "cvat/apps/organizations/permissions.py",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Forganizations%2Fpermissions.py",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/cvat%2Fapps%2Forganizations%2Fpermissions.py",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/cvat%2Fapps%2Forganizations%2Fpermissions.py?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -3,8 +3,6 @@\n #\n # SPDX-License-Identifier: MIT\n \n-from typing import cast\n-\n from django.conf import settings\n \n from cvat.apps.iam.permissions import OpenPolicyAgentPermission, StrEnum\n@@ -175,7 +173,10 @@ def get_scopes(request, view, obj):\n         }[view.action]\n \n         if scope == Scopes.UPDATE:\n-            if request.data.get('role') != cast(Membership, obj).role:\n+            # user should have permissions to view a membership\n+            scopes.append(Scopes.VIEW)\n+\n+            if 'role' in request.data.keys():\n                 scopes.append(Scopes.UPDATE_ROLE)\n         else:\n             scopes.append(scope)"
            },
            {
                "sha": "831fa0bf6db3b39b83697732845c935829201182",
                "filename": "tests/python/rest_api/test_jobs.py",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/tests%2Fpython%2Frest_api%2Ftest_jobs.py",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/tests%2Fpython%2Frest_api%2Ftest_jobs.py",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/tests%2Fpython%2Frest_api%2Ftest_jobs.py?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -18,6 +18,7 @@\n import pytest\n from cvat_sdk import models\n from cvat_sdk.api_client.api_client import ApiClient, Endpoint\n+from cvat_sdk.api_client.exceptions import ForbiddenException\n from cvat_sdk.core.helpers import get_paginated_collection\n from deepdiff import DeepDiff\n from PIL import Image\n@@ -1275,6 +1276,15 @@ def test_can_update_assignee_updated_date_on_assignee_updates(\n             else:\n                 assert updated_job.assignee is None\n \n+    def test_malefactor_cannot_obtain_job_details_via_empty_partial_update_request(\n+        self, regular_lonely_user, jobs\n+    ):\n+        job = next(iter(jobs))\n+\n+        with make_api_client(regular_lonely_user) as api_client:\n+            with pytest.raises(ForbiddenException):\n+                api_client.jobs_api.partial_update(job[\"id\"])\n+\n \n def _check_coco_job_annotations(content, values_to_be_checked):\n     exported_annotations = json.loads(content)"
            },
            {
                "sha": "abaca68ae2dfb387306da68bb3cb597aa2df1722",
                "filename": "tests/python/rest_api/test_memberships.py",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/tests%2Fpython%2Frest_api%2Ftest_memberships.py",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/tests%2Fpython%2Frest_api%2Ftest_memberships.py",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/tests%2Fpython%2Frest_api%2Ftest_memberships.py?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -8,6 +8,7 @@\n \n import pytest\n from cvat_sdk.api_client.api_client import ApiClient, Endpoint\n+from cvat_sdk.api_client.exceptions import ForbiddenException\n from deepdiff import DeepDiff\n \n from shared.utils.config import get_method, make_api_client, patch_method\n@@ -137,6 +138,15 @@ def test_user_cannot_change_self_role(self, who: str, find_users):\n             user[\"username\"], user[\"membership_id\"], self.ROLES[abs(self.ROLES.index(who) - 1)]\n         )\n \n+    def test_malefactor_cannot_obtain_membership_details_via_empty_partial_update_request(\n+        self, regular_lonely_user, memberships\n+    ):\n+        membership = next(iter(memberships))\n+\n+        with make_api_client(regular_lonely_user) as api_client:\n+            with pytest.raises(ForbiddenException):\n+                api_client.memberships_api.partial_update(membership[\"id\"])\n+\n \n @pytest.mark.usefixtures(\"restore_db_per_function\")\n class TestDeleteMemberships:"
            },
            {
                "sha": "61b893cc2e789cbd3b6fbc72e3ab68c839b82705",
                "filename": "tests/python/rest_api/test_projects.py",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/tests%2Fpython%2Frest_api%2Ftest_projects.py",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/tests%2Fpython%2Frest_api%2Ftest_projects.py",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/tests%2Fpython%2Frest_api%2Ftest_projects.py?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -1398,3 +1398,12 @@ def test_can_update_assignee_updated_date_on_assignee_updates(\n                 assert updated_project.assignee.id == new_assignee_id\n             else:\n                 assert updated_project.assignee is None\n+\n+    def test_malefactor_cannot_obtain_project_details_via_empty_partial_update_request(\n+        self, regular_lonely_user, projects\n+    ):\n+        project = next(iter(projects))\n+\n+        with make_api_client(regular_lonely_user) as api_client:\n+            with pytest.raises(ForbiddenException):\n+                api_client.projects_api.partial_update(project[\"id\"])"
            },
            {
                "sha": "c7ac1a734b00aa90ef7d9c7bf20a9f427ea0187f",
                "filename": "tests/python/rest_api/test_tasks.py",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/tests%2Fpython%2Frest_api%2Ftest_tasks.py",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5/tests%2Fpython%2Frest_api%2Ftest_tasks.py",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/tests%2Fpython%2Frest_api%2Ftest_tasks.py?ref=59ce6ca784a0d426b2cfb8cf2850ba1d520c03f5",
                "patch": "@@ -24,6 +24,7 @@\n from cvat_sdk import Client, Config, exceptions\n from cvat_sdk.api_client import models\n from cvat_sdk.api_client.api_client import ApiClient, ApiException, Endpoint\n+from cvat_sdk.api_client.exceptions import ForbiddenException\n from cvat_sdk.core.helpers import get_paginated_collection\n from cvat_sdk.core.progress import NullProgressReporter\n from cvat_sdk.core.proxies.tasks import ResourceType, Task\n@@ -2778,6 +2779,15 @@ def test_user_cannot_update_task_with_cloud_storage_without_access(\n             )\n         assert response.status == HTTPStatus.FORBIDDEN\n \n+    def test_malefactor_cannot_obtain_task_details_via_empty_partial_update_request(\n+        self, regular_lonely_user, tasks\n+    ):\n+        task = next(iter(tasks))\n+\n+        with make_api_client(regular_lonely_user) as api_client:\n+            with pytest.raises(ForbiddenException):\n+                api_client.tasks_api.partial_update(task[\"id\"])\n+\n     @pytest.mark.parametrize(\"has_old_assignee\", [False, True])\n     @pytest.mark.parametrize(\"new_assignee\", [None, \"same\", \"different\"])\n     def test_can_update_assignee_updated_date_on_assignee_updates("
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cvat-ai/cvat/commits/0bf45fd5de08a652dffbfb517318a64c2fdbc5cf",
        "url": "https://api.github.com/repos/cvat-ai/cvat/commits/0bf45fd5de08a652dffbfb517318a64c2fdbc5cf",
        "html_url": "https://github.com/cvat-ai/cvat/commit/0bf45fd5de08a652dffbfb517318a64c2fdbc5cf",
        "message": "Merge commit from fork\n\nWhen a view returns an `HttpResponseNotFound` object, the `Content-Type`\nheader is set to `text/html` by default. Therefore, including external data\n(in this case, the request ID) in the output without any escaping or\nvalidation leads to a vulnerability. If an attacker can trick a user into\nfollowing a malicious link, they can include HTML elements in the request ID\nthat execute malicious JavaScript code in the victim's browser. That code\nwill be able to make requests to the CVAT API with the user's privileges.\n\nThe simplest fix for this is to not include variable data in the error\nmessage, which is what I did.\n\nIn the long run, I think we need to get rid of these HTML responses,\nsince it doesn't make sense for a JSON API to return HTML.",
        "files": [
            {
                "sha": "584291de39a215457f64af60fb38d914abb27646",
                "filename": "changelog.d/20240912_201524_roman_xss_requests.md",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/0bf45fd5de08a652dffbfb517318a64c2fdbc5cf/changelog.d%2F20240912_201524_roman_xss_requests.md",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/0bf45fd5de08a652dffbfb517318a64c2fdbc5cf/changelog.d%2F20240912_201524_roman_xss_requests.md",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/changelog.d%2F20240912_201524_roman_xss_requests.md?ref=0bf45fd5de08a652dffbfb517318a64c2fdbc5cf",
                "patch": "@@ -0,0 +1,4 @@\n+### Security\n+\n+- Fixed an XSS vulnerability in request-related endpoints\n+  (<https://github.com/cvat-ai/cvat/security/advisories/GHSA-hp6c-f34j-qjj7>)"
            },
            {
                "sha": "528c8314b6776c7a58b53a901b18e951130e344a",
                "filename": "cvat/apps/engine/views.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/0bf45fd5de08a652dffbfb517318a64c2fdbc5cf/cvat%2Fapps%2Fengine%2Fviews.py",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/0bf45fd5de08a652dffbfb517318a64c2fdbc5cf/cvat%2Fapps%2Fengine%2Fviews.py",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/cvat%2Fapps%2Fengine%2Fviews.py?ref=0bf45fd5de08a652dffbfb517318a64c2fdbc5cf",
                "patch": "@@ -3391,7 +3391,7 @@ def retrieve(self, request: HttpRequest, pk: str):\n         job = self._get_rq_job_by_id(pk)\n \n         if not job:\n-            return HttpResponseNotFound(f\"There is no request with specified id: {pk}\")\n+            return HttpResponseNotFound(\"There is no request with specified id\")\n \n         self.check_object_permissions(request, job)\n \n@@ -3428,7 +3428,7 @@ def cancel(self, request: HttpRequest, pk: str):\n         rq_job = self._get_rq_job_by_id(pk)\n \n         if not rq_job:\n-            return HttpResponseNotFound(f\"There is no request with specified id: {pk!r}\")\n+            return HttpResponseNotFound(\"There is no request with specified id\")\n \n         self.check_object_permissions(request, rq_job)\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cvat-ai/cvat/commits/75c3d573bc9468b718f53b442c2ef69ad1d5de12",
        "url": "https://api.github.com/repos/cvat-ai/cvat/commits/75c3d573bc9468b718f53b442c2ef69ad1d5de12",
        "html_url": "https://github.com/cvat-ai/cvat/commit/75c3d573bc9468b718f53b442c2ef69ad1d5de12",
        "message": "Merge commit from fork\n\nThe default `Content-Type` for `HttpResponse` is `text/html`, so an attacker\ncan create a label a `<script>` tag inside its name, generate a quality\nreport, and give a direct link to the `/data` endpoint to a victim user,\ncausing the script to execute with that user's permission.",
        "files": [
            {
                "sha": "b06336c505d4e6accb1cdc51552ef5e669057291",
                "filename": "changelog.d/20240916_144227_roman_xss_quality_report.md",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/75c3d573bc9468b718f53b442c2ef69ad1d5de12/changelog.d%2F20240916_144227_roman_xss_quality_report.md",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/75c3d573bc9468b718f53b442c2ef69ad1d5de12/changelog.d%2F20240916_144227_roman_xss_quality_report.md",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/changelog.d%2F20240916_144227_roman_xss_quality_report.md?ref=75c3d573bc9468b718f53b442c2ef69ad1d5de12",
                "patch": "@@ -0,0 +1,4 @@\n+### Security\n+\n+- Fixed an XSS vulnerability in the quality report data endpoint\n+  (<https://github.com/cvat-ai/cvat/security/advisories/GHSA-2c85-39cc-2px9>)"
            },
            {
                "sha": "00f327539f96a889a921fab8e2357932ffbd643d",
                "filename": "cvat/apps/quality_control/views.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cvat-ai/cvat/blob/75c3d573bc9468b718f53b442c2ef69ad1d5de12/cvat%2Fapps%2Fquality_control%2Fviews.py",
                "raw_url": "https://github.com/cvat-ai/cvat/raw/75c3d573bc9468b718f53b442c2ef69ad1d5de12/cvat%2Fapps%2Fquality_control%2Fviews.py",
                "contents_url": "https://api.github.com/repos/cvat-ai/cvat/contents/cvat%2Fapps%2Fquality_control%2Fviews.py?ref=75c3d573bc9468b718f53b442c2ef69ad1d5de12",
                "patch": "@@ -329,7 +329,7 @@ def create(self, request, *args, **kwargs):\n     def data(self, request, pk):\n         report = self.get_object()  # check permissions\n         json_report = qc.prepare_report_for_downloading(report, host=get_server_url(request))\n-        return HttpResponse(json_report.encode())\n+        return HttpResponse(json_report.encode(), content_type=\"application/json\")\n \n \n @extend_schema(tags=[\"quality\"])"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mantisbt/mantisbt/commits/56bbd02dc1fb33a8de5898fd17dc3d698c847f55",
        "url": "https://api.github.com/repos/mantisbt/mantisbt/commits/56bbd02dc1fb33a8de5898fd17dc3d698c847f55",
        "html_url": "https://github.com/mantisbt/mantisbt/commit/56bbd02dc1fb33a8de5898fd17dc3d698c847f55",
        "message": "Merge commit from fork\n\nCreate 2 new Profile API functions: profile_can_update() and\nprofile_ensure_can_update().\n\nUse them in account_prof_update.php and account_prof_edit_page.php to\nensure that users can only view and update their own Profiles (or the\nglobal ones if they are authorized to).\n\nFixes #34640, CVE-2024-45792",
        "files": [
            {
                "sha": "e1aede4ebba7c30a3a42b20a5618a90ed76fbaab",
                "filename": "account_prof_edit_page.php",
                "status": "modified",
                "additions": 3,
                "deletions": 7,
                "changes": 10,
                "blob_url": "https://github.com/mantisbt/mantisbt/blob/56bbd02dc1fb33a8de5898fd17dc3d698c847f55/account_prof_edit_page.php",
                "raw_url": "https://github.com/mantisbt/mantisbt/raw/56bbd02dc1fb33a8de5898fd17dc3d698c847f55/account_prof_edit_page.php",
                "contents_url": "https://api.github.com/repos/mantisbt/mantisbt/contents/account_prof_edit_page.php?ref=56bbd02dc1fb33a8de5898fd17dc3d698c847f55",
                "patch": "@@ -61,13 +61,9 @@\n $f_profile_id\t= gpc_get_int( 'profile_id' );\n $f_redirect_page = gpc_get_string( 'redirect', 'account_prof_menu_page.php' );\n \n-/** @noinspection PhpUnhandledExceptionInspection */\n-$t_global_profile = profile_is_global( $f_profile_id );\n-if( $t_global_profile ) {\n-\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ) );\n-}\n-$t_row = profile_get_row( $f_profile_id );\n+profile_ensure_can_update( $f_profile_id );\n \n+$t_row = profile_get_row( $f_profile_id );\n /**\n  * @var $v_id\n  * @var $v_user_id\n@@ -80,7 +76,7 @@\n \n layout_page_header();\n \n-if( $t_global_profile ) {\n+if( profile_is_global( $f_profile_id ) ) {\n \tlayout_page_begin( 'manage_overview_page.php' );\n \tprint_manage_menu( 'manage_prof_menu_page.php' );\n } else {"
            },
            {
                "sha": "b255732ca5eecb8e1cee8b92bfce51cde7427e92",
                "filename": "account_prof_update.php",
                "status": "modified",
                "additions": 5,
                "deletions": 16,
                "changes": 21,
                "blob_url": "https://github.com/mantisbt/mantisbt/blob/56bbd02dc1fb33a8de5898fd17dc3d698c847f55/account_prof_update.php",
                "raw_url": "https://github.com/mantisbt/mantisbt/raw/56bbd02dc1fb33a8de5898fd17dc3d698c847f55/account_prof_update.php",
                "contents_url": "https://api.github.com/repos/mantisbt/mantisbt/contents/account_prof_update.php?ref=56bbd02dc1fb33a8de5898fd17dc3d698c847f55",
                "patch": "@@ -61,6 +61,9 @@\n \n if( $f_action != 'add' ) {\n \t$f_profile_id = gpc_get_int( 'profile_id' );\n+\tprofile_ensure_can_update( $f_profile_id );\n+\n+\t$t_user_id = profile_is_global( $f_profile_id ) ? ALL_USERS : auth_get_current_user_id();\n }\n \n switch( $f_action ) {\n@@ -72,23 +75,16 @@\n \t\t$t_user_id\t\t= gpc_get_int( 'user_id' );\n \n \t\tif( ALL_USERS == $t_user_id ) {\n-\t\t\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ) );\n+\t\t\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ), $t_user_id );\n \t\t} else {\n-\t\t\taccess_ensure_global_level( config_get( 'add_profile_threshold' ) );\n \t\t\t$t_user_id = auth_get_current_user_id();\n+\t\t\taccess_ensure_global_level( config_get( 'add_profile_threshold' ), $t_user_id );\n \t\t}\n \n \t\tprofile_create( $t_user_id, $f_platform, $f_os, $f_os_build, $f_description );\n \t\tbreak;\n \n \tcase 'update':\n-\t\tif( profile_is_global( $f_profile_id ) ) {\n-\t\t\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ) );\n-\t\t\t$t_user_id = ALL_USERS;\n-\t\t} else {\n-\t\t\t$t_user_id = auth_get_current_user_id();\n-\t\t}\n-\n \t\t$f_platform = gpc_get_string( 'platform' );\n \t\t$f_os = gpc_get_string( 'os' );\n \t\t$f_os_build = gpc_get_string( 'os_build' );\n@@ -98,13 +94,6 @@\n \t\tbreak;\n \n \tcase 'delete':\n-\t\tif( profile_is_global( $f_profile_id ) ) {\n-\t\t\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ) );\n-\t\t\t$t_user_id = ALL_USERS;\n-\t\t} else {\n-\t\t\t$t_user_id = auth_get_current_user_id();\n-\t\t}\n-\n \t\thelper_ensure_confirmed(\n \t\t\tsprintf( lang_get( 'delete_profile_confirm_msg' ),\n \t\t\t\tstring_attribute( profile_get_name( $f_profile_id ) )"
            },
            {
                "sha": "f1e3dfaab6654c9a0c946d1db41331bfa45bbb7a",
                "filename": "core/profile_api.php",
                "status": "modified",
                "additions": 35,
                "deletions": 0,
                "changes": 35,
                "blob_url": "https://github.com/mantisbt/mantisbt/blob/56bbd02dc1fb33a8de5898fd17dc3d698c847f55/core%2Fprofile_api.php",
                "raw_url": "https://github.com/mantisbt/mantisbt/raw/56bbd02dc1fb33a8de5898fd17dc3d698c847f55/core%2Fprofile_api.php",
                "contents_url": "https://api.github.com/repos/mantisbt/mantisbt/contents/core%2Fprofile_api.php?ref=56bbd02dc1fb33a8de5898fd17dc3d698c847f55",
                "patch": "@@ -333,3 +333,38 @@ function profile_is_global( $p_profile_id ) {\n \t$t_row = profile_get_row( $p_profile_id );\n \treturn $t_row['user_id'] == ALL_USERS;\n }\n+\n+/**\n+ * Check if user is allowed to update or delete the given Profile.\n+ *\n+ * @param int      $p_profile_id Profile id\n+ * @param int|null $p_user_id    User id or null for current user (default).\n+ *\n+ * @return bool True if allowed, false otherwise.\n+ * @throws ClientException\n+ */\n+function profile_can_update( $p_profile_id, $p_user_id = null ) {\n+\t$t_row = profile_get_row( $p_profile_id );\n+\t$t_user_id = $p_user_id === null ? auth_get_current_user_id() : $p_user_id;\n+\n+\t# Global profile ?\n+\tif( $t_row['user_id'] == ALL_USERS ) {\n+\t\treturn access_has_global_level( config_get( 'manage_global_profile_threshold' ) );\n+\t}\n+\n+\treturn $t_row['user_id'] == $t_user_id;\n+}\n+\n+/**\n+ * Throws Access Denied error if user is not allowed to update the Profile.\n+ *\n+ * @param int      $p_profile_id Profile id\n+ * @param int|null $p_user_id    User id or null for current user (default).\n+ *\n+ * @throws ClientException\n+ */\n+function profile_ensure_can_update( $p_profile_id, $p_user_id = null ) {\n+\tif( !profile_can_update( $p_profile_id, $p_user_id ) ) {\n+\t\taccess_denied();\n+\t}\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mantisbt/mantisbt/commits/ef0f820284032350cc20a39ff9cb2010d5463b41",
        "url": "https://api.github.com/repos/mantisbt/mantisbt/commits/ef0f820284032350cc20a39ff9cb2010d5463b41",
        "html_url": "https://github.com/mantisbt/mantisbt/commit/ef0f820284032350cc20a39ff9cb2010d5463b41",
        "message": "Prevent unauthorized access to other users Profiles\n\nCreate 2 new Profile API functions: profile_can_update() and\nprofile_ensure_can_update().\n\nUse them in account_prof_update.php and account_prof_edit_page.php to\nensure that users can only view and update their own Profiles (or the\nglobal ones if they are authorized to).\n\nFixes #34640, CVE-2024-45792\n\n(cherry picked from commit 56bbd02dc1fb33a8de5898fd17dc3d698c847f55)",
        "files": [
            {
                "sha": "e1aede4ebba7c30a3a42b20a5618a90ed76fbaab",
                "filename": "account_prof_edit_page.php",
                "status": "modified",
                "additions": 3,
                "deletions": 7,
                "changes": 10,
                "blob_url": "https://github.com/mantisbt/mantisbt/blob/ef0f820284032350cc20a39ff9cb2010d5463b41/account_prof_edit_page.php",
                "raw_url": "https://github.com/mantisbt/mantisbt/raw/ef0f820284032350cc20a39ff9cb2010d5463b41/account_prof_edit_page.php",
                "contents_url": "https://api.github.com/repos/mantisbt/mantisbt/contents/account_prof_edit_page.php?ref=ef0f820284032350cc20a39ff9cb2010d5463b41",
                "patch": "@@ -61,13 +61,9 @@\n $f_profile_id\t= gpc_get_int( 'profile_id' );\n $f_redirect_page = gpc_get_string( 'redirect', 'account_prof_menu_page.php' );\n \n-/** @noinspection PhpUnhandledExceptionInspection */\n-$t_global_profile = profile_is_global( $f_profile_id );\n-if( $t_global_profile ) {\n-\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ) );\n-}\n-$t_row = profile_get_row( $f_profile_id );\n+profile_ensure_can_update( $f_profile_id );\n \n+$t_row = profile_get_row( $f_profile_id );\n /**\n  * @var $v_id\n  * @var $v_user_id\n@@ -80,7 +76,7 @@\n \n layout_page_header();\n \n-if( $t_global_profile ) {\n+if( profile_is_global( $f_profile_id ) ) {\n \tlayout_page_begin( 'manage_overview_page.php' );\n \tprint_manage_menu( 'manage_prof_menu_page.php' );\n } else {"
            },
            {
                "sha": "b255732ca5eecb8e1cee8b92bfce51cde7427e92",
                "filename": "account_prof_update.php",
                "status": "modified",
                "additions": 5,
                "deletions": 16,
                "changes": 21,
                "blob_url": "https://github.com/mantisbt/mantisbt/blob/ef0f820284032350cc20a39ff9cb2010d5463b41/account_prof_update.php",
                "raw_url": "https://github.com/mantisbt/mantisbt/raw/ef0f820284032350cc20a39ff9cb2010d5463b41/account_prof_update.php",
                "contents_url": "https://api.github.com/repos/mantisbt/mantisbt/contents/account_prof_update.php?ref=ef0f820284032350cc20a39ff9cb2010d5463b41",
                "patch": "@@ -61,6 +61,9 @@\n \n if( $f_action != 'add' ) {\n \t$f_profile_id = gpc_get_int( 'profile_id' );\n+\tprofile_ensure_can_update( $f_profile_id );\n+\n+\t$t_user_id = profile_is_global( $f_profile_id ) ? ALL_USERS : auth_get_current_user_id();\n }\n \n switch( $f_action ) {\n@@ -72,23 +75,16 @@\n \t\t$t_user_id\t\t= gpc_get_int( 'user_id' );\n \n \t\tif( ALL_USERS == $t_user_id ) {\n-\t\t\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ) );\n+\t\t\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ), $t_user_id );\n \t\t} else {\n-\t\t\taccess_ensure_global_level( config_get( 'add_profile_threshold' ) );\n \t\t\t$t_user_id = auth_get_current_user_id();\n+\t\t\taccess_ensure_global_level( config_get( 'add_profile_threshold' ), $t_user_id );\n \t\t}\n \n \t\tprofile_create( $t_user_id, $f_platform, $f_os, $f_os_build, $f_description );\n \t\tbreak;\n \n \tcase 'update':\n-\t\tif( profile_is_global( $f_profile_id ) ) {\n-\t\t\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ) );\n-\t\t\t$t_user_id = ALL_USERS;\n-\t\t} else {\n-\t\t\t$t_user_id = auth_get_current_user_id();\n-\t\t}\n-\n \t\t$f_platform = gpc_get_string( 'platform' );\n \t\t$f_os = gpc_get_string( 'os' );\n \t\t$f_os_build = gpc_get_string( 'os_build' );\n@@ -98,13 +94,6 @@\n \t\tbreak;\n \n \tcase 'delete':\n-\t\tif( profile_is_global( $f_profile_id ) ) {\n-\t\t\taccess_ensure_global_level( config_get( 'manage_global_profile_threshold' ) );\n-\t\t\t$t_user_id = ALL_USERS;\n-\t\t} else {\n-\t\t\t$t_user_id = auth_get_current_user_id();\n-\t\t}\n-\n \t\thelper_ensure_confirmed(\n \t\t\tsprintf( lang_get( 'delete_profile_confirm_msg' ),\n \t\t\t\tstring_attribute( profile_get_name( $f_profile_id ) )"
            },
            {
                "sha": "fec6df7e8f69f7d8b5186ce21b2bc5846db0c9ab",
                "filename": "core/profile_api.php",
                "status": "modified",
                "additions": 35,
                "deletions": 0,
                "changes": 35,
                "blob_url": "https://github.com/mantisbt/mantisbt/blob/ef0f820284032350cc20a39ff9cb2010d5463b41/core%2Fprofile_api.php",
                "raw_url": "https://github.com/mantisbt/mantisbt/raw/ef0f820284032350cc20a39ff9cb2010d5463b41/core%2Fprofile_api.php",
                "contents_url": "https://api.github.com/repos/mantisbt/mantisbt/contents/core%2Fprofile_api.php?ref=ef0f820284032350cc20a39ff9cb2010d5463b41",
                "patch": "@@ -327,3 +327,38 @@ function profile_is_global( $p_profile_id ) {\n \t$t_row = profile_get_row( $p_profile_id );\n \treturn $t_row['user_id'] == ALL_USERS;\n }\n+\n+/**\n+ * Check if user is allowed to update or delete the given Profile.\n+ *\n+ * @param int      $p_profile_id Profile id\n+ * @param int|null $p_user_id    User id or null for current user (default).\n+ *\n+ * @return bool True if allowed, false otherwise.\n+ * @throws ClientException\n+ */\n+function profile_can_update( $p_profile_id, $p_user_id = null ) {\n+\t$t_row = profile_get_row( $p_profile_id );\n+\t$t_user_id = $p_user_id === null ? auth_get_current_user_id() : $p_user_id;\n+\n+\t# Global profile ?\n+\tif( $t_row['user_id'] == ALL_USERS ) {\n+\t\treturn access_has_global_level( config_get( 'manage_global_profile_threshold' ) );\n+\t}\n+\n+\treturn $t_row['user_id'] == $t_user_id;\n+}\n+\n+/**\n+ * Throws Access Denied error if user is not allowed to update the Profile.\n+ *\n+ * @param int      $p_profile_id Profile id\n+ * @param int|null $p_user_id    User id or null for current user (default).\n+ *\n+ * @throws ClientException\n+ */\n+function profile_ensure_can_update( $p_profile_id, $p_user_id = null ) {\n+\tif( !profile_can_update( $p_profile_id, $p_user_id ) ) {\n+\t\taccess_denied();\n+\t}\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/eclipse-ee4j/glassfish/commits/6ca35eee2ba90a8108984b27bec33f9cc50cd83b",
        "url": "https://api.github.com/repos/eclipse-ee4j/glassfish/commits/6ca35eee2ba90a8108984b27bec33f9cc50cd83b",
        "html_url": "https://github.com/eclipse-ee4j/glassfish/commit/6ca35eee2ba90a8108984b27bec33f9cc50cd83b",
        "message": "Merge pull request #25106 from luiseufrasio/luiseufrasio-CVE-2024-7312-link-redirection-via-host-parameter\n\nsetting local Name and Port for /managment/* URI",
        "files": [
            {
                "sha": "ad5d05b396d4ce3d1f021da7ad23f4f546713c39",
                "filename": "nucleus/admin/rest/rest-service/src/main/java/org/glassfish/admin/rest/adapter/RestManagementAdapter.java",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/eclipse-ee4j/glassfish/blob/6ca35eee2ba90a8108984b27bec33f9cc50cd83b/nucleus%2Fadmin%2Frest%2Frest-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fglassfish%2Fadmin%2Frest%2Fadapter%2FRestManagementAdapter.java",
                "raw_url": "https://github.com/eclipse-ee4j/glassfish/raw/6ca35eee2ba90a8108984b27bec33f9cc50cd83b/nucleus%2Fadmin%2Frest%2Frest-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fglassfish%2Fadmin%2Frest%2Fadapter%2FRestManagementAdapter.java",
                "contents_url": "https://api.github.com/repos/eclipse-ee4j/glassfish/contents/nucleus%2Fadmin%2Frest%2Frest-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fglassfish%2Fadmin%2Frest%2Fadapter%2FRestManagementAdapter.java?ref=6ca35eee2ba90a8108984b27bec33f9cc50cd83b",
                "patch": "@@ -18,6 +18,8 @@\n package org.glassfish.admin.rest.adapter;\n \n import org.glassfish.admin.restconnector.Constants;\n+import org.glassfish.grizzly.http.server.Request;\n+import org.glassfish.grizzly.http.server.Response;\n import org.jvnet.hk2.annotations.Service;\n \n /**\n@@ -32,4 +34,11 @@ public class RestManagementAdapter extends RestAdapter {\n     public RestManagementAdapter() {\n         super(new RestManagementResourceProvider());\n     }\n+\n+    @Override\n+    public void service(Request req, Response res) {\n+        req.setServerName(req.getLocalName());\n+        req.setServerPort(req.getLocalPort());\n+        super.service(req, res);\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/filamentphp/filament/commits/df7989352464d08eda5837ef50f9997fad902316",
        "url": "https://api.github.com/repos/filamentphp/filament/commits/df7989352464d08eda5837ef50f9997fad902316",
        "html_url": "https://github.com/filamentphp/filament/commit/df7989352464d08eda5837ef50f9997fad902316",
        "message": "Merge commit from fork\n\nescape string state",
        "files": [
            {
                "sha": "e10d8c0c3494065155109d83af4c278f264c19ba",
                "filename": "packages/infolists/resources/views/components/color-entry.blade.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/filamentphp/filament/blob/df7989352464d08eda5837ef50f9997fad902316/packages%2Finfolists%2Fresources%2Fviews%2Fcomponents%2Fcolor-entry.blade.php",
                "raw_url": "https://github.com/filamentphp/filament/raw/df7989352464d08eda5837ef50f9997fad902316/packages%2Finfolists%2Fresources%2Fviews%2Fcomponents%2Fcolor-entry.blade.php",
                "contents_url": "https://api.github.com/repos/filamentphp/filament/contents/packages%2Finfolists%2Fresources%2Fviews%2Fcomponents%2Fcolor-entry.blade.php?ref=df7989352464d08eda5837ef50f9997fad902316",
                "patch": "@@ -43,7 +43,7 @@\n                         'cursor-pointer' => $itemIsCopyable,\n                     ])\n                     @style([\n-                        \"background-color: {$state}\" => $state,\n+                        'background-color: ' . e($state) => $state,\n                     ])\n                 ></div>\n             @endforeach"
            },
            {
                "sha": "b2302ea4a2efbea35ac8c868afb17ac02d60904f",
                "filename": "packages/tables/resources/views/columns/color-column.blade.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/filamentphp/filament/blob/df7989352464d08eda5837ef50f9997fad902316/packages%2Ftables%2Fresources%2Fviews%2Fcolumns%2Fcolor-column.blade.php",
                "raw_url": "https://github.com/filamentphp/filament/raw/df7989352464d08eda5837ef50f9997fad902316/packages%2Ftables%2Fresources%2Fviews%2Fcolumns%2Fcolor-column.blade.php",
                "contents_url": "https://api.github.com/repos/filamentphp/filament/contents/packages%2Ftables%2Fresources%2Fviews%2Fcolumns%2Fcolor-column.blade.php?ref=df7989352464d08eda5837ef50f9997fad902316",
                "patch": "@@ -45,7 +45,7 @@\n                     'cursor-pointer' => $itemIsCopyable,\n                 ])\n                 @style([\n-                    \"background-color: {$state}\" => $state,\n+                    'background-color: ' . e($state) => $state,\n                 ])\n             ></div>\n         @endforeach"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/spring-projects/spring-framework/commits/8d16a50907c11f7e6b407d878a26e84eba08a533",
        "url": "https://api.github.com/repos/spring-projects/spring-framework/commits/8d16a50907c11f7e6b407d878a26e84eba08a533",
        "html_url": "https://github.com/spring-projects/spring-framework/commit/8d16a50907c11f7e6b407d878a26e84eba08a533",
        "message": "Efficient ETag parsing\n\nCloses gh-33372",
        "files": [
            {
                "sha": "e279ac6a05b4bfccf52c3b70f600ab3341c977fd",
                "filename": "spring-web/src/main/java/org/springframework/http/ETag.java",
                "status": "added",
                "additions": 144,
                "deletions": 0,
                "changes": 144,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/8d16a50907c11f7e6b407d878a26e84eba08a533/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FETag.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/8d16a50907c11f7e6b407d878a26e84eba08a533/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FETag.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FETag.java?ref=8d16a50907c11f7e6b407d878a26e84eba08a533",
                "patch": "@@ -0,0 +1,144 @@\n+/*\n+ * Copyright 2002-2024 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.springframework.http;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+\n+import org.springframework.util.StringUtils;\n+\n+/**\n+ * Represents an ETag for HTTP conditional requests.\n+ *\n+ * @param tag the unquoted tag value\n+ * @param weak whether the entity tag is for weak or strong validation\n+ * @author Rossen Stoyanchev\n+ * @since 5.3.38\n+ * @see <a href=\"https://datatracker.ietf.org/doc/html/rfc7232\">RFC 7232</a>\n+ */\n+public record ETag(String tag, boolean weak) {\n+\n+\tprivate static final Log logger = LogFactory.getLog(ETag.class);\n+\n+\tprivate static final ETag WILDCARD = new ETag(\"*\", false);\n+\n+\n+\t/**\n+\t * Whether this a wildcard tag matching to any entity tag value.\n+\t */\n+\tpublic boolean isWildcard() {\n+\t\treturn (this == WILDCARD);\n+\t}\n+\n+\t/**\n+\t * Return the fully formatted tag including \"W/\" prefix and quotes.\n+\t */\n+\tpublic String formattedTag() {\n+\t\tif (isWildcard()) {\n+\t\t\treturn \"*\";\n+\t\t}\n+\t\treturn (this.weak ? \"W/\" : \"\") + \"\\\"\" + this.tag + \"\\\"\";\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\treturn formattedTag();\n+\t}\n+\n+\n+\t/**\n+\t * Parse entity tags from an \"If-Match\" or \"If-None-Match\" header.\n+\t * @param source the source string to parse\n+\t * @return the parsed ETags\n+\t */\n+\tpublic static List<ETag> parse(String source) {\n+\n+\t\tList<ETag> result = new ArrayList<>();\n+\t\tState state = State.BEFORE_QUOTES;\n+\t\tint startIndex = -1;\n+\t\tboolean weak = false;\n+\n+\t\tfor (int i = 0; i < source.length(); i++) {\n+\t\t\tchar c = source.charAt(i);\n+\n+\t\t\tif (state == State.IN_QUOTES) {\n+\t\t\t\tif (c == '\"') {\n+\t\t\t\t\tString tag = source.substring(startIndex, i);\n+\t\t\t\t\tif (StringUtils.hasText(tag)) {\n+\t\t\t\t\t\tresult.add(new ETag(tag, weak));\n+\t\t\t\t\t}\n+\t\t\t\t\tstate = State.AFTER_QUOTES;\n+\t\t\t\t\tstartIndex = -1;\n+\t\t\t\t\tweak = false;\n+\t\t\t\t}\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif (Character.isWhitespace(c)) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif (c == ',') {\n+\t\t\t\tstate = State.BEFORE_QUOTES;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif (state == State.BEFORE_QUOTES) {\n+\t\t\t\tif (c == '*') {\n+\t\t\t\t\tresult.add(WILDCARD);\n+\t\t\t\t\tstate = State.AFTER_QUOTES;\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (c == '\"') {\n+\t\t\t\t\tstate = State.IN_QUOTES;\n+\t\t\t\t\tstartIndex = i + 1;\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (c == 'W' && source.length() > i + 2) {\n+\t\t\t\t\tif (source.charAt(i + 1) == '/' && source.charAt(i + 2) == '\"') {\n+\t\t\t\t\t\tstate = State.IN_QUOTES;\n+\t\t\t\t\t\ti = i + 2;\n+\t\t\t\t\t\tstartIndex = i + 1;\n+\t\t\t\t\t\tweak = true;\n+\t\t\t\t\t\tcontinue;\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tif (logger.isDebugEnabled()) {\n+\t\t\t\tlogger.debug(\"Unexpected char at index \" + i);\n+\t\t\t}\n+\t\t}\n+\n+\t\tif (state != State.IN_QUOTES && logger.isDebugEnabled()) {\n+\t\t\tlogger.debug(\"Expected closing '\\\"'\");\n+\t\t}\n+\n+\t\treturn result;\n+\t}\n+\n+\n+\tprivate enum State {\n+\n+\t\tBEFORE_QUOTES, IN_QUOTES, AFTER_QUOTES\n+\n+\t}\n+\n+}"
            },
            {
                "sha": "94aa9a99aeb3f8c203bdef868fe5afa09c560ce5",
                "filename": "spring-web/src/main/java/org/springframework/http/HttpHeaders.java",
                "status": "modified",
                "additions": 14,
                "deletions": 30,
                "changes": 44,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/8d16a50907c11f7e6b407d878a26e84eba08a533/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FHttpHeaders.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/8d16a50907c11f7e6b407d878a26e84eba08a533/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FHttpHeaders.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FHttpHeaders.java?ref=8d16a50907c11f7e6b407d878a26e84eba08a533",
                "patch": "@@ -41,8 +41,6 @@\n import java.util.Set;\n import java.util.StringJoiner;\n import java.util.function.BiConsumer;\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n import java.util.stream.Collectors;\n \n import org.springframework.lang.Nullable;\n@@ -394,12 +392,6 @@ public class HttpHeaders implements MultiValueMap<String, String>, Serializable\n \t */\n \tpublic static final HttpHeaders EMPTY = new ReadOnlyHttpHeaders(new LinkedMultiValueMap<>());\n \n-\t/**\n-\t * Pattern matching ETag multiple field values in headers such as \"If-Match\", \"If-None-Match\".\n-\t * @see <a href=\"https://tools.ietf.org/html/rfc7232#section-2.3\">Section 2.3 of RFC 7232</a>\n-\t */\n-\tprivate static final Pattern ETAG_HEADER_VALUE_PATTERN = Pattern.compile(\"\\\\*|\\\\s*((W\\\\/)?(\\\"[^\\\"]*\\\"))\\\\s*,?\");\n-\n \tprivate static final DecimalFormatSymbols DECIMAL_FORMAT_SYMBOLS = new DecimalFormatSymbols(Locale.ENGLISH);\n \n \tprivate static final ZoneId GMT = ZoneId.of(\"GMT\");\n@@ -1625,35 +1617,27 @@ public void clearContentHeaders() {\n \n \t/**\n \t * Retrieve a combined result from the field values of the ETag header.\n-\t * @param headerName the header name\n+\t * @param name the header name\n \t * @return the combined result\n \t * @throws IllegalArgumentException if parsing fails\n \t * @since 4.3\n \t */\n-\tprotected List<String> getETagValuesAsList(String headerName) {\n-\t\tList<String> values = get(headerName);\n-\t\tif (values != null) {\n-\t\t\tList<String> result = new ArrayList<>();\n-\t\t\tfor (String value : values) {\n-\t\t\t\tif (value != null) {\n-\t\t\t\t\tMatcher matcher = ETAG_HEADER_VALUE_PATTERN.matcher(value);\n-\t\t\t\t\twhile (matcher.find()) {\n-\t\t\t\t\t\tif (\"*\".equals(matcher.group())) {\n-\t\t\t\t\t\t\tresult.add(matcher.group());\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\telse {\n-\t\t\t\t\t\t\tresult.add(matcher.group(1));\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\tif (result.isEmpty()) {\n-\t\t\t\t\t\tthrow new IllegalArgumentException(\n-\t\t\t\t\t\t\t\t\"Could not parse header '\" + headerName + \"' with value '\" + value + \"'\");\n-\t\t\t\t\t}\n+\tprotected List<String> getETagValuesAsList(String name) {\n+\t\tList<String> values = get(name);\n+\t\tif (values == null) {\n+\t\t\treturn Collections.emptyList();\n+\t\t}\n+\t\tList<String> result = new ArrayList<>();\n+\t\tfor (String value : values) {\n+\t\t\tif (value != null) {\n+\t\t\t\tList<ETag> tags = ETag.parse(value);\n+\t\t\t\tAssert.notEmpty(tags, \"Could not parse header '\" + name + \"' with value '\" + value + \"'\");\n+\t\t\t\tfor (ETag tag : tags) {\n+\t\t\t\t\tresult.add(tag.formattedTag());\n \t\t\t\t}\n \t\t\t}\n-\t\t\treturn result;\n \t\t}\n-\t\treturn Collections.emptyList();\n+\t\treturn result;\n \t}\n \n \t/**"
            },
            {
                "sha": "4dd90ef2539b01d839dd1fffcf52ae3587ab0a2c",
                "filename": "spring-web/src/main/java/org/springframework/web/context/request/ServletWebRequest.java",
                "status": "modified",
                "additions": 6,
                "deletions": 14,
                "changes": 20,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/8d16a50907c11f7e6b407d878a26e84eba08a533/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequest.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/8d16a50907c11f7e6b407d878a26e84eba08a533/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequest.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequest.java?ref=8d16a50907c11f7e6b407d878a26e84eba08a533",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2022 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -25,13 +25,12 @@\n import java.util.Map;\n import java.util.Set;\n import java.util.TimeZone;\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n \n import jakarta.servlet.http.HttpServletRequest;\n import jakarta.servlet.http.HttpServletResponse;\n import jakarta.servlet.http.HttpSession;\n \n+import org.springframework.http.ETag;\n import org.springframework.http.HttpHeaders;\n import org.springframework.http.HttpMethod;\n import org.springframework.http.HttpStatus;\n@@ -53,12 +52,6 @@ public class ServletWebRequest extends ServletRequestAttributes implements Nativ\n \n \tprivate static final Set<String> SAFE_METHODS = Set.of(\"GET\", \"HEAD\");\n \n-\t/**\n-\t * Pattern matching ETag multiple field values in headers such as \"If-Match\", \"If-None-Match\".\n-\t * @see <a href=\"https://tools.ietf.org/html/rfc7232#section-2.3\">Section 2.3 of RFC 7232</a>\n-\t */\n-\tprivate static final Pattern ETAG_HEADER_VALUE_PATTERN = Pattern.compile(\"\\\\*|\\\\s*((W\\\\/)?(\\\"[^\\\"]*\\\"))\\\\s*,?\");\n-\n \t/**\n \t * Date formats as specified in the HTTP RFC.\n \t * @see <a href=\"https://tools.ietf.org/html/rfc7231#section-7.1.1.1\">Section 7.1.1.1 of RFC 7231</a>\n@@ -255,20 +248,19 @@ private boolean matchRequestedETags(Enumeration<String> requestedETags, @Nullabl\n \t\teTag = padEtagIfNecessary(eTag);\n \t\twhile (requestedETags.hasMoreElements()) {\n \t\t\t// Compare weak/strong ETags as per https://datatracker.ietf.org/doc/html/rfc9110#section-8.8.3\n-\t\t\tMatcher eTagMatcher = ETAG_HEADER_VALUE_PATTERN.matcher(requestedETags.nextElement());\n-\t\t\twhile (eTagMatcher.find()) {\n+\t\t\tfor (ETag requestedETag : ETag.parse(requestedETags.nextElement())) {\n \t\t\t\t// only consider \"lost updates\" checks for unsafe HTTP methods\n-\t\t\t\tif (\"*\".equals(eTagMatcher.group()) && StringUtils.hasLength(eTag)\n+\t\t\t\tif (requestedETag.isWildcard() && StringUtils.hasLength(eTag)\n \t\t\t\t\t\t&& !SAFE_METHODS.contains(getRequest().getMethod())) {\n \t\t\t\t\treturn false;\n \t\t\t\t}\n \t\t\t\tif (weakCompare) {\n-\t\t\t\t\tif (eTagWeakMatch(eTag, eTagMatcher.group(1))) {\n+\t\t\t\t\tif (eTagWeakMatch(eTag, requestedETag.formattedTag())) {\n \t\t\t\t\t\treturn false;\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t\telse {\n-\t\t\t\t\tif (eTagStrongMatch(eTag, eTagMatcher.group(1))) {\n+\t\t\t\t\tif (eTagStrongMatch(eTag, requestedETag.formattedTag())) {\n \t\t\t\t\t\treturn false;\n \t\t\t\t\t}\n \t\t\t\t}"
            },
            {
                "sha": "7fdc186b6a1fa7c3990c8532699958c7f4300663",
                "filename": "spring-web/src/test/java/org/springframework/web/context/request/ServletWebRequestHttpMethodsTests.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/8d16a50907c11f7e6b407d878a26e84eba08a533/spring-web%2Fsrc%2Ftest%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequestHttpMethodsTests.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/8d16a50907c11f7e6b407d878a26e84eba08a533/spring-web%2Fsrc%2Ftest%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequestHttpMethodsTests.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Ftest%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequestHttpMethodsTests.java?ref=8d16a50907c11f7e6b407d878a26e84eba08a533",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2022 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -163,8 +163,8 @@ void ifNoneMatchShouldNotMatchDifferentETag(String method) {\n \t\tassertOkWithETag(etag);\n \t}\n \n+\t// gh-19127\n \t@SafeHttpMethodsTest\n-\t\t// SPR-14559\n \tvoid ifNoneMatchShouldNotFailForUnquotedETag(String method) {\n \t\tsetUpRequest(method);\n \t\tString etag = \"\\\"etagvalue\\\"\";"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/spring-projects/spring-framework/commits/bb17ad8314b81850a939fd265fb53b3361705e85",
        "url": "https://api.github.com/repos/spring-projects/spring-framework/commits/bb17ad8314b81850a939fd265fb53b3361705e85",
        "html_url": "https://github.com/spring-projects/spring-framework/commit/bb17ad8314b81850a939fd265fb53b3361705e85",
        "message": "Efficient ETag parsing",
        "files": [
            {
                "sha": "e279ac6a05b4bfccf52c3b70f600ab3341c977fd",
                "filename": "spring-web/src/main/java/org/springframework/http/ETag.java",
                "status": "added",
                "additions": 144,
                "deletions": 0,
                "changes": 144,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/bb17ad8314b81850a939fd265fb53b3361705e85/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FETag.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/bb17ad8314b81850a939fd265fb53b3361705e85/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FETag.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FETag.java?ref=bb17ad8314b81850a939fd265fb53b3361705e85",
                "patch": "@@ -0,0 +1,144 @@\n+/*\n+ * Copyright 2002-2024 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.springframework.http;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+\n+import org.springframework.util.StringUtils;\n+\n+/**\n+ * Represents an ETag for HTTP conditional requests.\n+ *\n+ * @param tag the unquoted tag value\n+ * @param weak whether the entity tag is for weak or strong validation\n+ * @author Rossen Stoyanchev\n+ * @since 5.3.38\n+ * @see <a href=\"https://datatracker.ietf.org/doc/html/rfc7232\">RFC 7232</a>\n+ */\n+public record ETag(String tag, boolean weak) {\n+\n+\tprivate static final Log logger = LogFactory.getLog(ETag.class);\n+\n+\tprivate static final ETag WILDCARD = new ETag(\"*\", false);\n+\n+\n+\t/**\n+\t * Whether this a wildcard tag matching to any entity tag value.\n+\t */\n+\tpublic boolean isWildcard() {\n+\t\treturn (this == WILDCARD);\n+\t}\n+\n+\t/**\n+\t * Return the fully formatted tag including \"W/\" prefix and quotes.\n+\t */\n+\tpublic String formattedTag() {\n+\t\tif (isWildcard()) {\n+\t\t\treturn \"*\";\n+\t\t}\n+\t\treturn (this.weak ? \"W/\" : \"\") + \"\\\"\" + this.tag + \"\\\"\";\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\treturn formattedTag();\n+\t}\n+\n+\n+\t/**\n+\t * Parse entity tags from an \"If-Match\" or \"If-None-Match\" header.\n+\t * @param source the source string to parse\n+\t * @return the parsed ETags\n+\t */\n+\tpublic static List<ETag> parse(String source) {\n+\n+\t\tList<ETag> result = new ArrayList<>();\n+\t\tState state = State.BEFORE_QUOTES;\n+\t\tint startIndex = -1;\n+\t\tboolean weak = false;\n+\n+\t\tfor (int i = 0; i < source.length(); i++) {\n+\t\t\tchar c = source.charAt(i);\n+\n+\t\t\tif (state == State.IN_QUOTES) {\n+\t\t\t\tif (c == '\"') {\n+\t\t\t\t\tString tag = source.substring(startIndex, i);\n+\t\t\t\t\tif (StringUtils.hasText(tag)) {\n+\t\t\t\t\t\tresult.add(new ETag(tag, weak));\n+\t\t\t\t\t}\n+\t\t\t\t\tstate = State.AFTER_QUOTES;\n+\t\t\t\t\tstartIndex = -1;\n+\t\t\t\t\tweak = false;\n+\t\t\t\t}\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif (Character.isWhitespace(c)) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif (c == ',') {\n+\t\t\t\tstate = State.BEFORE_QUOTES;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif (state == State.BEFORE_QUOTES) {\n+\t\t\t\tif (c == '*') {\n+\t\t\t\t\tresult.add(WILDCARD);\n+\t\t\t\t\tstate = State.AFTER_QUOTES;\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (c == '\"') {\n+\t\t\t\t\tstate = State.IN_QUOTES;\n+\t\t\t\t\tstartIndex = i + 1;\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (c == 'W' && source.length() > i + 2) {\n+\t\t\t\t\tif (source.charAt(i + 1) == '/' && source.charAt(i + 2) == '\"') {\n+\t\t\t\t\t\tstate = State.IN_QUOTES;\n+\t\t\t\t\t\ti = i + 2;\n+\t\t\t\t\t\tstartIndex = i + 1;\n+\t\t\t\t\t\tweak = true;\n+\t\t\t\t\t\tcontinue;\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tif (logger.isDebugEnabled()) {\n+\t\t\t\tlogger.debug(\"Unexpected char at index \" + i);\n+\t\t\t}\n+\t\t}\n+\n+\t\tif (state != State.IN_QUOTES && logger.isDebugEnabled()) {\n+\t\t\tlogger.debug(\"Expected closing '\\\"'\");\n+\t\t}\n+\n+\t\treturn result;\n+\t}\n+\n+\n+\tprivate enum State {\n+\n+\t\tBEFORE_QUOTES, IN_QUOTES, AFTER_QUOTES\n+\n+\t}\n+\n+}"
            },
            {
                "sha": "521382cbdf24ae2e243e93aff47369c09559cc5c",
                "filename": "spring-web/src/main/java/org/springframework/http/HttpHeaders.java",
                "status": "modified",
                "additions": 14,
                "deletions": 30,
                "changes": 44,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/bb17ad8314b81850a939fd265fb53b3361705e85/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FHttpHeaders.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/bb17ad8314b81850a939fd265fb53b3361705e85/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FHttpHeaders.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FHttpHeaders.java?ref=bb17ad8314b81850a939fd265fb53b3361705e85",
                "patch": "@@ -41,8 +41,6 @@\n import java.util.Set;\n import java.util.StringJoiner;\n import java.util.function.BiConsumer;\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n import java.util.stream.Collectors;\n \n import org.springframework.lang.Nullable;\n@@ -394,12 +392,6 @@ public class HttpHeaders implements MultiValueMap<String, String>, Serializable\n \t */\n \tpublic static final HttpHeaders EMPTY = new ReadOnlyHttpHeaders(new LinkedMultiValueMap<>());\n \n-\t/**\n-\t * Pattern matching ETag multiple field values in headers such as \"If-Match\", \"If-None-Match\".\n-\t * @see <a href=\"https://tools.ietf.org/html/rfc7232#section-2.3\">Section 2.3 of RFC 7232</a>\n-\t */\n-\tprivate static final Pattern ETAG_HEADER_VALUE_PATTERN = Pattern.compile(\"\\\\*|\\\\s*((W\\\\/)?(\\\"[^\\\"]*\\\"))\\\\s*,?\");\n-\n \tprivate static final DecimalFormatSymbols DECIMAL_FORMAT_SYMBOLS = new DecimalFormatSymbols(Locale.ENGLISH);\n \n \tprivate static final ZoneId GMT = ZoneId.of(\"GMT\");\n@@ -1629,35 +1621,27 @@ public void clearContentHeaders() {\n \n \t/**\n \t * Retrieve a combined result from the field values of the ETag header.\n-\t * @param headerName the header name\n+\t * @param name the header name\n \t * @return the combined result\n \t * @throws IllegalArgumentException if parsing fails\n \t * @since 4.3\n \t */\n-\tprotected List<String> getETagValuesAsList(String headerName) {\n-\t\tList<String> values = get(headerName);\n-\t\tif (values != null) {\n-\t\t\tList<String> result = new ArrayList<>();\n-\t\t\tfor (String value : values) {\n-\t\t\t\tif (value != null) {\n-\t\t\t\t\tMatcher matcher = ETAG_HEADER_VALUE_PATTERN.matcher(value);\n-\t\t\t\t\twhile (matcher.find()) {\n-\t\t\t\t\t\tif (\"*\".equals(matcher.group())) {\n-\t\t\t\t\t\t\tresult.add(matcher.group());\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\telse {\n-\t\t\t\t\t\t\tresult.add(matcher.group(1));\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\tif (result.isEmpty()) {\n-\t\t\t\t\t\tthrow new IllegalArgumentException(\n-\t\t\t\t\t\t\t\t\"Could not parse header '\" + headerName + \"' with value '\" + value + \"'\");\n-\t\t\t\t\t}\n+\tprotected List<String> getETagValuesAsList(String name) {\n+\t\tList<String> values = get(name);\n+\t\tif (values == null) {\n+\t\t\treturn Collections.emptyList();\n+\t\t}\n+\t\tList<String> result = new ArrayList<>();\n+\t\tfor (String value : values) {\n+\t\t\tif (value != null) {\n+\t\t\t\tList<ETag> tags = ETag.parse(value);\n+\t\t\t\tAssert.notEmpty(tags, \"Could not parse header '\" + name + \"' with value '\" + value + \"'\");\n+\t\t\t\tfor (ETag tag : tags) {\n+\t\t\t\t\tresult.add(tag.formattedTag());\n \t\t\t\t}\n \t\t\t}\n-\t\t\treturn result;\n \t\t}\n-\t\treturn Collections.emptyList();\n+\t\treturn result;\n \t}\n \n \t/**"
            },
            {
                "sha": "462fd89cf7fc494009c0617f69b0fd9fb9b854f4",
                "filename": "spring-web/src/main/java/org/springframework/web/context/request/ServletWebRequest.java",
                "status": "modified",
                "additions": 5,
                "deletions": 13,
                "changes": 18,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/bb17ad8314b81850a939fd265fb53b3361705e85/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequest.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/bb17ad8314b81850a939fd265fb53b3361705e85/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequest.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequest.java?ref=bb17ad8314b81850a939fd265fb53b3361705e85",
                "patch": "@@ -25,13 +25,12 @@\n import java.util.Map;\n import java.util.Set;\n import java.util.TimeZone;\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n \n import jakarta.servlet.http.HttpServletRequest;\n import jakarta.servlet.http.HttpServletResponse;\n import jakarta.servlet.http.HttpSession;\n \n+import org.springframework.http.ETag;\n import org.springframework.http.HttpHeaders;\n import org.springframework.http.HttpMethod;\n import org.springframework.http.HttpStatus;\n@@ -53,12 +52,6 @@ public class ServletWebRequest extends ServletRequestAttributes implements Nativ\n \n \tprivate static final Set<String> SAFE_METHODS = Set.of(\"GET\", \"HEAD\");\n \n-\t/**\n-\t * Pattern matching ETag multiple field values in headers such as \"If-Match\", \"If-None-Match\".\n-\t * @see <a href=\"https://tools.ietf.org/html/rfc7232#section-2.3\">Section 2.3 of RFC 7232</a>\n-\t */\n-\tprivate static final Pattern ETAG_HEADER_VALUE_PATTERN = Pattern.compile(\"\\\\*|\\\\s*((W\\\\/)?(\\\"[^\\\"]*\\\"))\\\\s*,?\");\n-\n \t/**\n \t * Date formats as specified in the HTTP RFC.\n \t * @see <a href=\"https://tools.ietf.org/html/rfc7231#section-7.1.1.1\">Section 7.1.1.1 of RFC 7231</a>\n@@ -255,20 +248,19 @@ private boolean matchRequestedETags(Enumeration<String> requestedETags, @Nullabl\n \t\tetag = padEtagIfNecessary(etag);\n \t\twhile (requestedETags.hasMoreElements()) {\n \t\t\t// Compare weak/strong ETags as per https://datatracker.ietf.org/doc/html/rfc9110#section-8.8.3\n-\t\t\tMatcher etagMatcher = ETAG_HEADER_VALUE_PATTERN.matcher(requestedETags.nextElement());\n-\t\t\twhile (etagMatcher.find()) {\n+\t\t\tfor (ETag requestedETag : ETag.parse(requestedETags.nextElement())) {\n \t\t\t\t// only consider \"lost updates\" checks for unsafe HTTP methods\n-\t\t\t\tif (\"*\".equals(etagMatcher.group()) && StringUtils.hasLength(etag)\n+\t\t\t\tif (requestedETag.isWildcard() && StringUtils.hasLength(etag)\n \t\t\t\t\t\t&& !SAFE_METHODS.contains(getRequest().getMethod())) {\n \t\t\t\t\treturn false;\n \t\t\t\t}\n \t\t\t\tif (weakCompare) {\n-\t\t\t\t\tif (etagWeakMatch(etag, etagMatcher.group(1))) {\n+\t\t\t\t\tif (etagWeakMatch(etag, requestedETag.formattedTag())) {\n \t\t\t\t\t\treturn false;\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t\telse {\n-\t\t\t\t\tif (etagStrongMatch(etag, etagMatcher.group(1))) {\n+\t\t\t\t\tif (etagStrongMatch(etag, requestedETag.formattedTag())) {\n \t\t\t\t\t\treturn false;\n \t\t\t\t\t}\n \t\t\t\t}"
            },
            {
                "sha": "7fdc186b6a1fa7c3990c8532699958c7f4300663",
                "filename": "spring-web/src/test/java/org/springframework/web/context/request/ServletWebRequestHttpMethodsTests.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/bb17ad8314b81850a939fd265fb53b3361705e85/spring-web%2Fsrc%2Ftest%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequestHttpMethodsTests.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/bb17ad8314b81850a939fd265fb53b3361705e85/spring-web%2Fsrc%2Ftest%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequestHttpMethodsTests.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Ftest%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequestHttpMethodsTests.java?ref=bb17ad8314b81850a939fd265fb53b3361705e85",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2022 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -163,8 +163,8 @@ void ifNoneMatchShouldNotMatchDifferentETag(String method) {\n \t\tassertOkWithETag(etag);\n \t}\n \n+\t// gh-19127\n \t@SafeHttpMethodsTest\n-\t\t// SPR-14559\n \tvoid ifNoneMatchShouldNotFailForUnquotedETag(String method) {\n \t\tsetUpRequest(method);\n \t\tString etag = \"\\\"etagvalue\\\"\";"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/spring-projects/spring-framework/commits/582bfccbb72e5c8959a0b472d1dc7d03a20520f3",
        "url": "https://api.github.com/repos/spring-projects/spring-framework/commits/582bfccbb72e5c8959a0b472d1dc7d03a20520f3",
        "html_url": "https://github.com/spring-projects/spring-framework/commit/582bfccbb72e5c8959a0b472d1dc7d03a20520f3",
        "message": "Efficient ETag parsing\n\nCloses gh-33372",
        "files": [
            {
                "sha": "c4d670d50cbccaf8b49897c54d59bb95d6df5891",
                "filename": "spring-web/src/main/java/org/springframework/http/ETag.java",
                "status": "added",
                "additions": 161,
                "deletions": 0,
                "changes": 161,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/582bfccbb72e5c8959a0b472d1dc7d03a20520f3/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FETag.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/582bfccbb72e5c8959a0b472d1dc7d03a20520f3/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FETag.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FETag.java?ref=582bfccbb72e5c8959a0b472d1dc7d03a20520f3",
                "patch": "@@ -0,0 +1,161 @@\n+/*\n+ * Copyright 2002-2024 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.springframework.http;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+\n+import org.springframework.util.StringUtils;\n+\n+/**\n+ * Represents an ETag for HTTP conditional requests.\n+ *\n+ * @author Rossen Stoyanchev\n+ * @since 5.3.38\n+ * @see <a href=\"https://datatracker.ietf.org/doc/html/rfc7232\">RFC 7232</a>\n+ */\n+public class ETag {\n+\n+\tprivate static final Log logger = LogFactory.getLog(ETag.class);\n+\n+\tprivate static final ETag WILDCARD = new ETag(\"*\", false);\n+\n+\n+\tprivate final String tag;\n+\n+\tprivate final boolean weak;\n+\n+\n+\tpublic ETag(String tag, boolean weak) {\n+\t\tthis.tag = tag;\n+\t\tthis.weak = weak;\n+\t}\n+\n+\n+\tpublic String tag() {\n+\t\treturn this.tag;\n+\t}\n+\n+\tpublic boolean weak() {\n+\t\treturn this.weak;\n+\t}\n+\n+\t/**\n+\t * Whether this a wildcard tag matching to any entity tag value.\n+\t */\n+\tpublic boolean isWildcard() {\n+\t\treturn (this == WILDCARD);\n+\t}\n+\n+\t/**\n+\t * Return the fully formatted tag including \"W/\" prefix and quotes.\n+\t */\n+\tpublic String formattedTag() {\n+\t\tif (this == WILDCARD) {\n+\t\t\treturn \"*\";\n+\t\t}\n+\t\treturn (this.weak ? \"W/\" : \"\") + \"\\\"\" + this.tag + \"\\\"\";\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\treturn formattedTag();\n+\t}\n+\n+\n+\t/**\n+\t * Parse entity tags from an \"If-Match\" or \"If-None-Match\" header.\n+\t * @param source the source string to parse\n+\t * @return the parsed ETags\n+\t */\n+\tpublic static List<ETag> parse(String source) {\n+\n+\t\tList<ETag> result = new ArrayList<>();\n+\t\tState state = State.BEFORE_QUOTES;\n+\t\tint startIndex = -1;\n+\t\tboolean weak = false;\n+\n+\t\tfor (int i = 0; i < source.length(); i++) {\n+\t\t\tchar c = source.charAt(i);\n+\n+\t\t\tif (state == State.IN_QUOTES) {\n+\t\t\t\tif (c == '\"') {\n+\t\t\t\t\tString tag = source.substring(startIndex, i);\n+\t\t\t\t\tif (StringUtils.hasText(tag)) {\n+\t\t\t\t\t\tresult.add(new ETag(tag, weak));\n+\t\t\t\t\t}\n+\t\t\t\t\tstate = State.AFTER_QUOTES;\n+\t\t\t\t\tstartIndex = -1;\n+\t\t\t\t\tweak = false;\n+\t\t\t\t}\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif (Character.isWhitespace(c)) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif (c == ',') {\n+\t\t\t\tstate = State.BEFORE_QUOTES;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tif (state == State.BEFORE_QUOTES) {\n+\t\t\t\tif (c == '*') {\n+\t\t\t\t\tresult.add(WILDCARD);\n+\t\t\t\t\tstate = State.AFTER_QUOTES;\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (c == '\"') {\n+\t\t\t\t\tstate = State.IN_QUOTES;\n+\t\t\t\t\tstartIndex = i + 1;\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (c == 'W' && source.length() > i + 2) {\n+\t\t\t\t\tif (source.charAt(i + 1) == '/' && source.charAt(i + 2) == '\"') {\n+\t\t\t\t\t\tstate = State.IN_QUOTES;\n+\t\t\t\t\t\ti = i + 2;\n+\t\t\t\t\t\tstartIndex = i + 1;\n+\t\t\t\t\t\tweak = true;\n+\t\t\t\t\t\tcontinue;\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tif (logger.isDebugEnabled()) {\n+\t\t\t\tlogger.debug(\"Unexpected char at index \" + i);\n+\t\t\t}\n+\t\t}\n+\n+\t\tif (state != State.IN_QUOTES && logger.isDebugEnabled()) {\n+\t\t\tlogger.debug(\"Expected closing '\\\"'\");\n+\t\t}\n+\n+\t\treturn result;\n+\t}\n+\n+\n+\tprivate enum State {\n+\n+\t\tBEFORE_QUOTES, IN_QUOTES, AFTER_QUOTES\n+\n+\t}\n+\n+}"
            },
            {
                "sha": "5fe14a360be48fe0456d02618f212b3f3a8aefab",
                "filename": "spring-web/src/main/java/org/springframework/http/HttpHeaders.java",
                "status": "modified",
                "additions": 14,
                "deletions": 30,
                "changes": 44,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/582bfccbb72e5c8959a0b472d1dc7d03a20520f3/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FHttpHeaders.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/582bfccbb72e5c8959a0b472d1dc7d03a20520f3/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FHttpHeaders.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fhttp%2FHttpHeaders.java?ref=582bfccbb72e5c8959a0b472d1dc7d03a20520f3",
                "patch": "@@ -40,8 +40,6 @@\n import java.util.Map;\n import java.util.Set;\n import java.util.StringJoiner;\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n import java.util.stream.Collectors;\n \n import org.springframework.lang.Nullable;\n@@ -393,12 +391,6 @@ public class HttpHeaders implements MultiValueMap<String, String>, Serializable\n \t */\n \tpublic static final HttpHeaders EMPTY = new ReadOnlyHttpHeaders(new LinkedMultiValueMap<>());\n \n-\t/**\n-\t * Pattern matching ETag multiple field values in headers such as \"If-Match\", \"If-None-Match\".\n-\t * @see <a href=\"https://tools.ietf.org/html/rfc7232#section-2.3\">Section 2.3 of RFC 7232</a>\n-\t */\n-\tprivate static final Pattern ETAG_HEADER_VALUE_PATTERN = Pattern.compile(\"\\\\*|\\\\s*((W\\\\/)?(\\\"[^\\\"]*\\\"))\\\\s*,?\");\n-\n \tprivate static final DecimalFormatSymbols DECIMAL_FORMAT_SYMBOLS = new DecimalFormatSymbols(Locale.ENGLISH);\n \n \tprivate static final ZoneId GMT = ZoneId.of(\"GMT\");\n@@ -1568,35 +1560,27 @@ public void clearContentHeaders() {\n \n \t/**\n \t * Retrieve a combined result from the field values of the ETag header.\n-\t * @param headerName the header name\n+\t * @param name the header name\n \t * @return the combined result\n \t * @throws IllegalArgumentException if parsing fails\n \t * @since 4.3\n \t */\n-\tprotected List<String> getETagValuesAsList(String headerName) {\n-\t\tList<String> values = get(headerName);\n-\t\tif (values != null) {\n-\t\t\tList<String> result = new ArrayList<>();\n-\t\t\tfor (String value : values) {\n-\t\t\t\tif (value != null) {\n-\t\t\t\t\tMatcher matcher = ETAG_HEADER_VALUE_PATTERN.matcher(value);\n-\t\t\t\t\twhile (matcher.find()) {\n-\t\t\t\t\t\tif (\"*\".equals(matcher.group())) {\n-\t\t\t\t\t\t\tresult.add(matcher.group());\n-\t\t\t\t\t\t}\n-\t\t\t\t\t\telse {\n-\t\t\t\t\t\t\tresult.add(matcher.group(1));\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\tif (result.isEmpty()) {\n-\t\t\t\t\t\tthrow new IllegalArgumentException(\n-\t\t\t\t\t\t\t\t\"Could not parse header '\" + headerName + \"' with value '\" + value + \"'\");\n-\t\t\t\t\t}\n+\tprotected List<String> getETagValuesAsList(String name) {\n+\t\tList<String> values = get(name);\n+\t\tif (values == null) {\n+\t\t\treturn Collections.emptyList();\n+\t\t}\n+\t\tList<String> result = new ArrayList<>();\n+\t\tfor (String value : values) {\n+\t\t\tif (value != null) {\n+\t\t\t\tList<ETag> tags = ETag.parse(value);\n+\t\t\t\tAssert.notEmpty(tags, \"Could not parse header '\" + name + \"' with value '\" + value + \"'\");\n+\t\t\t\tfor (ETag tag : tags) {\n+\t\t\t\t\tresult.add(tag.formattedTag());\n \t\t\t\t}\n \t\t\t}\n-\t\t\treturn result;\n \t\t}\n-\t\treturn Collections.emptyList();\n+\t\treturn result;\n \t}\n \n \t/**"
            },
            {
                "sha": "8bb3b4817f6ba5b98ce77d79fc5623e7660aa20c",
                "filename": "spring-web/src/main/java/org/springframework/web/context/request/ServletWebRequest.java",
                "status": "modified",
                "additions": 5,
                "deletions": 13,
                "changes": 18,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/582bfccbb72e5c8959a0b472d1dc7d03a20520f3/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequest.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/582bfccbb72e5c8959a0b472d1dc7d03a20520f3/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequest.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-web%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fcontext%2Frequest%2FServletWebRequest.java?ref=582bfccbb72e5c8959a0b472d1dc7d03a20520f3",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2022 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -26,13 +26,12 @@\n import java.util.Locale;\n import java.util.Map;\n import java.util.TimeZone;\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n \n import javax.servlet.http.HttpServletRequest;\n import javax.servlet.http.HttpServletResponse;\n import javax.servlet.http.HttpSession;\n \n+import org.springframework.http.ETag;\n import org.springframework.http.HttpHeaders;\n import org.springframework.http.HttpMethod;\n import org.springframework.http.HttpStatus;\n@@ -54,12 +53,6 @@ public class ServletWebRequest extends ServletRequestAttributes implements Nativ\n \n \tprivate static final List<String> SAFE_METHODS = Arrays.asList(\"GET\", \"HEAD\");\n \n-\t/**\n-\t * Pattern matching ETag multiple field values in headers such as \"If-Match\", \"If-None-Match\".\n-\t * @see <a href=\"https://tools.ietf.org/html/rfc7232#section-2.3\">Section 2.3 of RFC 7232</a>\n-\t */\n-\tprivate static final Pattern ETAG_HEADER_VALUE_PATTERN = Pattern.compile(\"\\\\*|\\\\s*((W\\\\/)?(\\\"[^\\\"]*\\\"))\\\\s*,?\");\n-\n \t/**\n \t * Date formats as specified in the HTTP RFC.\n \t * @see <a href=\"https://tools.ietf.org/html/rfc7231#section-7.1.1.1\">Section 7.1.1.1 of RFC 7231</a>\n@@ -289,11 +282,10 @@ private boolean validateIfNoneMatch(@Nullable String etag) {\n \t\t\tetag = etag.substring(2);\n \t\t}\n \t\twhile (ifNoneMatch.hasMoreElements()) {\n-\t\t\tString clientETags = ifNoneMatch.nextElement();\n-\t\t\tMatcher etagMatcher = ETAG_HEADER_VALUE_PATTERN.matcher(clientETags);\n \t\t\t// Compare weak/strong ETags as per https://tools.ietf.org/html/rfc7232#section-2.3\n-\t\t\twhile (etagMatcher.find()) {\n-\t\t\t\tif (StringUtils.hasLength(etagMatcher.group()) && etag.equals(etagMatcher.group(3))) {\n+\t\t\tfor (ETag requestedETag : ETag.parse(ifNoneMatch.nextElement())) {\n+\t\t\t\tString tag = requestedETag.tag();\n+\t\t\t\tif (StringUtils.hasLength(tag) && etag.equals(padEtagIfNecessary(tag))) {\n \t\t\t\t\tthis.notModified = true;\n \t\t\t\t\tbreak;\n \t\t\t\t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/amir20/dozzle/commits/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3",
        "url": "https://api.github.com/repos/amir20/dozzle/commits/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3",
        "html_url": "https://github.com/amir20/dozzle/commit/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3",
        "message": "feat: uses bcrypt hash instead (#3293)",
        "files": [
            {
                "sha": "940c3dde826caca3b1babeece82a535c036f5818",
                "filename": "docs/guide/authentication.md",
                "status": "modified",
                "additions": 10,
                "deletions": 12,
                "changes": 22,
                "blob_url": "https://github.com/amir20/dozzle/blob/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3/docs%2Fguide%2Fauthentication.md",
                "raw_url": "https://github.com/amir20/dozzle/raw/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3/docs%2Fguide%2Fauthentication.md",
                "contents_url": "https://api.github.com/repos/amir20/dozzle/contents/docs%2Fguide%2Fauthentication.md?ref=de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3",
                "patch": "@@ -18,16 +18,16 @@ The content of the file looks like:\n users:\n   # \"admin\" here is username\n   admin:\n-    name: \"Admin\"\n-    # Just sha-256 which can be computed with \"echo -n password | shasum -a 256\"\n-    password: \"5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8\"\n     email: me@email.net\n+    name: Admin\n+    # Generate with docker run amir20/dozzle generate --name Admin --email me@email.net --password secret admin\n+    password: $2a$11$9ho4vY2LdJ/WBopFcsAS0uORC0x2vuFHQgT/yBqZyzclhHsoaIkzK\n ```\n \n-> [!TIP]\n-> This file can be generated with `docker run amir20/dozzle generate` with v6.6.x. See [below](#generating-users-yml) for more details.\n+Dozzle uses `email` to generate avatars using [Gravatar](https://gravatar.com/). It is optional. The password is hashed using `bcrypt` which can be generated using `docker run amir20/dozzle generate`.\n \n-Dozzle uses `email` to generate avatars using [Gravatar](https://gravatar.com/). It is optional. The password is hashed using `sha256` which can be generated with `echo -n 'secret-password' | shasum -a 256` or `echo -n 'secret-password' | sha256sum` on linux.\n+> [!WARNING]\n+> In previous versions of Dozzle, SHA-256 was used to hash passwords. Bcrypt is now more secure and is recommended for future use. Dozzle will revert to SHA-256 if it does not find a bcrypt hash. It is advisable to update the password hash to bcrypt using `docker run amir20/dozzle generate`. For more details, see [this issue](https://github.com/amir20/dozzle/security/advisories/GHSA-w7qr-q9fh-fj35).\n \n You will need to mount this file for Dozzle to find it. Here is an example:\n \n@@ -52,21 +52,19 @@ services:\n \n ```yaml [users.yml]\n users:\n-  # \"admin\" here is username\n   admin:\n-    name: \"Admin\"\n-    # Just sha-256 which can be computed with \"echo -n password | shasum -a 256\"\n-    password: \"5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8\"\n     email: me@email.net\n+    name: Admin\n+    password: $2a$11$9ho4vY2LdJ/WBopFcsAS0uORC0x2vuFHQgT/yBqZyzclhHsoaIkzK\n ```\n \n :::\n \n Dozzle uses [JWT](https://en.wikipedia.org/wiki/JSON_Web_Token) to generate tokens for authentication. This token is saved in a cookie.\n \n-## Generating users.yml <Badge type=\"tip\" text=\"v6.6.x\" />\n+## Generating users.yml\n \n-Starting with version `v6.6.x`, Dozzle has a builtin `generate` command to generate `users.yml`. Here is an example:\n+Dozzle has a builtin `generate` command to generate `users.yml`. Here is an example:\n \n ```sh\n docker run amir20/dozzle generate admin --password password --email test@email.net --name \"John Doe\" > users.yml"
            },
            {
                "sha": "002a77574dcf7a2497d7583393c7c630cda973c5",
                "filename": "go.mod",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/amir20/dozzle/blob/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3/go.mod",
                "raw_url": "https://github.com/amir20/dozzle/raw/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3/go.mod",
                "contents_url": "https://api.github.com/repos/amir20/dozzle/contents/go.mod?ref=de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3",
                "patch": "@@ -32,6 +32,7 @@ require (\n \tgithub.com/samber/lo v1.47.0\n \tgithub.com/wk8/go-ordered-map/v2 v2.1.8\n \tgithub.com/yuin/goldmark v1.7.4\n+\tgolang.org/x/crypto v0.27.0\n \tgolang.org/x/sync v0.8.0\n \tgoogle.golang.org/grpc v1.67.0\n \tgoogle.golang.org/protobuf v1.34.2\n@@ -71,7 +72,6 @@ require (\n \tgo.opentelemetry.io/otel/metric v1.28.0 // indirect\n \tgo.opentelemetry.io/otel/sdk v1.22.0 // indirect\n \tgo.opentelemetry.io/otel/trace v1.28.0 // indirect\n-\tgolang.org/x/crypto v0.27.0 // indirect\n \tgolang.org/x/text v0.18.0 // indirect\n \tgoogle.golang.org/genproto/googleapis/rpc v0.0.0-20240814211410-ddb44dafa142 // indirect\n \tgotest.tools/v3 v3.0.3 // indirect"
            },
            {
                "sha": "04762bf92493498921dbb003e2fdbf412d7d5aad",
                "filename": "go.sum",
                "status": "modified",
                "additions": 0,
                "deletions": 2,
                "changes": 2,
                "blob_url": "https://github.com/amir20/dozzle/blob/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3/go.sum",
                "raw_url": "https://github.com/amir20/dozzle/raw/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3/go.sum",
                "contents_url": "https://api.github.com/repos/amir20/dozzle/contents/go.sum?ref=de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3",
                "patch": "@@ -29,8 +29,6 @@ github.com/decred/dcrd/dcrec/secp256k1/v4 v4.3.0 h1:rpfIENRNNilwHwZeG5+P150SMrnN\n github.com/decred/dcrd/dcrec/secp256k1/v4 v4.3.0/go.mod h1:v57UDF4pDQJcEfFUCRop3lJL149eHGSe9Jvczhzjo/0=\n github.com/distribution/reference v0.6.0 h1:0IXCQ5g4/QMHHkarYzh5l+u8T3t73zM5QvfrDyIgxBk=\n github.com/distribution/reference v0.6.0/go.mod h1:BbU0aIcezP1/5jX/8MP0YiH4SdvB5Y4f/wlDRiLyi3E=\n-github.com/docker/docker v27.3.0+incompatible h1:BNb1QY6o4JdKpqwi9IB+HUYcRRrVN4aGFUTvDmWYK1A=\n-github.com/docker/docker v27.3.0+incompatible/go.mod h1:eEKB0N0r5NX/I1kEveEz05bcu8tLC/8azJZsviup8Sk=\n github.com/docker/docker v27.3.1+incompatible h1:KttF0XoteNTicmUtBO0L2tP+J7FGRFTjaEF4k6WdhfI=\n github.com/docker/docker v27.3.1+incompatible/go.mod h1:eEKB0N0r5NX/I1kEveEz05bcu8tLC/8azJZsviup8Sk=\n github.com/docker/go-connections v0.5.0 h1:USnMq7hx7gwdVZq1L49hLXaFtUdTADjXGp+uj1Br63c="
            },
            {
                "sha": "5826e3d31c179dcc345f3bd5f295539f099a92ee",
                "filename": "internal/auth/users.go",
                "status": "modified",
                "additions": 26,
                "deletions": 4,
                "changes": 30,
                "blob_url": "https://github.com/amir20/dozzle/blob/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3/internal%2Fauth%2Fusers.go",
                "raw_url": "https://github.com/amir20/dozzle/raw/de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3/internal%2Fauth%2Fusers.go",
                "contents_url": "https://api.github.com/repos/amir20/dozzle/contents/internal%2Fauth%2Fusers.go?ref=de79f03aa3dbe5bb1e154a7e8d3dccbd229f3ea3",
                "patch": "@@ -13,6 +13,7 @@ import (\n \n \t\"github.com/go-chi/jwtauth/v5\"\n \t\"github.com/rs/zerolog/log\"\n+\t\"golang.org/x/crypto/bcrypt\"\n \t\"gopkg.in/yaml.v3\"\n )\n \n@@ -61,7 +62,11 @@ func GenerateUsers(user User, hashPassword bool) *bytes.Buffer {\n \tbuffer := &bytes.Buffer{}\n \n \tif hashPassword {\n-\t\tuser.Password = sha256sum(user.Password)\n+\t\thash, err := bcrypt.GenerateFromPassword([]byte(user.Password), 11)\n+\t\tif err != nil {\n+\t\t\tlog.Fatal().Err(err).Msg(\"Failed to hash password\")\n+\t\t}\n+\t\tuser.Password = string(hash)\n \t}\n \n \tusers := UserDatabase{\n@@ -93,8 +98,8 @@ func decodeUsersFromFile(path string) (UserDatabase, error) {\n \t\t\tlog.Fatal().Msgf(\"User %s has an empty password\", username)\n \t\t}\n \n-\t\tif len(user.Password) != 64 {\n-\t\t\tlog.Fatal().Str(\"password\", user.Password).Msgf(\"User %s has an invalid password hash\", username)\n+\t\tif !(len(user.Password) == 64 || len(user.Password) == 60) {\n+\t\t\tlog.Fatal().Str(\"password\", user.Password).Str(\"user\", username).Msg(\"Invalid password for user\")\n \t\t}\n \n \t\tif user.Name == \"\" {\n@@ -146,9 +151,10 @@ func (u *UserDatabase) FindByPassword(username, password string) *User {\n \t\treturn nil\n \t}\n \n-\tif user.Password != sha256sum(password) {\n+\tif !CompareHashAndPassword(user.Password, password) {\n \t\treturn nil\n \t}\n+\n \treturn user\n }\n \n@@ -157,6 +163,22 @@ func sha256sum(s string) string {\n \treturn hex.EncodeToString(bytes[:])\n }\n \n+func CompareHashAndPassword(hash, password string) bool {\n+\tif len(hash) == 64 {\n+\t\tlog.Warn().Msg(\"Using sha256sum for password comparison. Consider using a more secure hash algorithm to protected against brute-force attacks. See https://github.com/amir20/dozzle/security/advisories/GHSA-w7qr-q9fh-fj35 for more details.\")\n+\t\treturn hash == sha256sum(password)\n+\t}\n+\n+\tif len(hash) == 60 {\n+\t\terr := bcrypt.CompareHashAndPassword([]byte(hash), []byte(password))\n+\t\treturn err == nil\n+\t}\n+\n+\tlog.Error().Str(\"hash\", hash).Msg(\"Invalid hash length. Expecting 64 or 60 characters.\")\n+\n+\treturn false\n+}\n+\n func UserFromContext(ctx context.Context) *User {\n \tif user, ok := ctx.Value(remoteUser).(User); ok {\n \t\treturn &user"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/NginxProxyManager/nginx-proxy-manager/commits/99cce7e2b0da2978411cedd7cac5fffbe15bc466",
        "url": "https://api.github.com/repos/NginxProxyManager/nginx-proxy-manager/commits/99cce7e2b0da2978411cedd7cac5fffbe15bc466",
        "html_url": "https://github.com/NginxProxyManager/nginx-proxy-manager/commit/99cce7e2b0da2978411cedd7cac5fffbe15bc466",
        "message": "Fix command injection when passing bash commands into the dns provider configuration\n\n- Use built in node functions to write the file\n- And to delete the file",
        "files": [
            {
                "sha": "291056caa644defa9c830f035e4a4d917b55c40c",
                "filename": "backend/internal/certificate.js",
                "status": "modified",
                "additions": 5,
                "deletions": 8,
                "changes": 13,
                "blob_url": "https://github.com/NginxProxyManager/nginx-proxy-manager/blob/99cce7e2b0da2978411cedd7cac5fffbe15bc466/backend%2Finternal%2Fcertificate.js",
                "raw_url": "https://github.com/NginxProxyManager/nginx-proxy-manager/raw/99cce7e2b0da2978411cedd7cac5fffbe15bc466/backend%2Finternal%2Fcertificate.js",
                "contents_url": "https://api.github.com/repos/NginxProxyManager/nginx-proxy-manager/contents/backend%2Finternal%2Fcertificate.js?ref=99cce7e2b0da2978411cedd7cac5fffbe15bc466",
                "patch": "@@ -861,9 +861,8 @@ const internalCertificate = {\n \t\tlogger.info(`Requesting Let'sEncrypt certificates via ${dnsPlugin.name} for Cert #${certificate.id}: ${certificate.domain_names.join(', ')}`);\n \n \t\tconst credentialsLocation = '/etc/letsencrypt/credentials/credentials-' + certificate.id;\n-\t\t// Escape single quotes and backslashes\n-\t\tconst escapedCredentials = certificate.meta.dns_provider_credentials.replaceAll('\\'', '\\\\\\'').replaceAll('\\\\', '\\\\\\\\');\n-\t\tconst credentialsCmd     = 'mkdir -p /etc/letsencrypt/credentials 2> /dev/null; echo \\'' + escapedCredentials + '\\' > \\'' + credentialsLocation + '\\' && chmod 600 \\'' + credentialsLocation + '\\'';\n+\t\tfs.mkdirSync('/etc/letsencrypt/credentials', { recursive: true });\n+\t\tfs.writeFileSync(credentialsLocation, certificate.meta.dns_provider_credentials, {mode: 0o600});\n \n \t\t// Whether the plugin has a --<name>-credentials argument\n \t\tconst hasConfigArg = certificate.meta.dns_provider !== 'route53';\n@@ -898,17 +897,15 @@ const internalCertificate = {\n \t\t\tmainCmd = mainCmd + ' --dns-duckdns-no-txt-restore';\n \t\t}\n \n-\t\tlogger.info('Command:', `${credentialsCmd} && && ${mainCmd}`);\n+\t\tlogger.info('Command:', mainCmd);\n \n \t\ttry {\n-\t\t\tawait utils.exec(credentialsCmd);\n \t\t\tconst result = await utils.exec(mainCmd);\n \t\t\tlogger.info(result);\n \t\t\treturn result;\n \t\t} catch (err) {\n-\t\t\t// Don't fail if file does not exist\n-\t\t\tconst delete_credentialsCmd = `rm -f '${credentialsLocation}' || true`;\n-\t\t\tawait utils.exec(delete_credentialsCmd);\n+\t\t\t// Don't fail if file does not exist, so no need for action in the callback\n+\t\t\tfs.unlink(credentialsLocation, () => {});\n \t\t\tthrow err;\n \t\t}\n \t},"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/NginxProxyManager/nginx-proxy-manager/commits/99cce7e2b0da2978411cedd7cac5fffbe15bc466",
        "url": "https://api.github.com/repos/NginxProxyManager/nginx-proxy-manager/commits/99cce7e2b0da2978411cedd7cac5fffbe15bc466",
        "html_url": "https://github.com/NginxProxyManager/nginx-proxy-manager/commit/99cce7e2b0da2978411cedd7cac5fffbe15bc466",
        "message": "Fix command injection when passing bash commands into the dns provider configuration\n\n- Use built in node functions to write the file\n- And to delete the file",
        "files": [
            {
                "sha": "291056caa644defa9c830f035e4a4d917b55c40c",
                "filename": "backend/internal/certificate.js",
                "status": "modified",
                "additions": 5,
                "deletions": 8,
                "changes": 13,
                "blob_url": "https://github.com/NginxProxyManager/nginx-proxy-manager/blob/99cce7e2b0da2978411cedd7cac5fffbe15bc466/backend%2Finternal%2Fcertificate.js",
                "raw_url": "https://github.com/NginxProxyManager/nginx-proxy-manager/raw/99cce7e2b0da2978411cedd7cac5fffbe15bc466/backend%2Finternal%2Fcertificate.js",
                "contents_url": "https://api.github.com/repos/NginxProxyManager/nginx-proxy-manager/contents/backend%2Finternal%2Fcertificate.js?ref=99cce7e2b0da2978411cedd7cac5fffbe15bc466",
                "patch": "@@ -861,9 +861,8 @@ const internalCertificate = {\n \t\tlogger.info(`Requesting Let'sEncrypt certificates via ${dnsPlugin.name} for Cert #${certificate.id}: ${certificate.domain_names.join(', ')}`);\n \n \t\tconst credentialsLocation = '/etc/letsencrypt/credentials/credentials-' + certificate.id;\n-\t\t// Escape single quotes and backslashes\n-\t\tconst escapedCredentials = certificate.meta.dns_provider_credentials.replaceAll('\\'', '\\\\\\'').replaceAll('\\\\', '\\\\\\\\');\n-\t\tconst credentialsCmd     = 'mkdir -p /etc/letsencrypt/credentials 2> /dev/null; echo \\'' + escapedCredentials + '\\' > \\'' + credentialsLocation + '\\' && chmod 600 \\'' + credentialsLocation + '\\'';\n+\t\tfs.mkdirSync('/etc/letsencrypt/credentials', { recursive: true });\n+\t\tfs.writeFileSync(credentialsLocation, certificate.meta.dns_provider_credentials, {mode: 0o600});\n \n \t\t// Whether the plugin has a --<name>-credentials argument\n \t\tconst hasConfigArg = certificate.meta.dns_provider !== 'route53';\n@@ -898,17 +897,15 @@ const internalCertificate = {\n \t\t\tmainCmd = mainCmd + ' --dns-duckdns-no-txt-restore';\n \t\t}\n \n-\t\tlogger.info('Command:', `${credentialsCmd} && && ${mainCmd}`);\n+\t\tlogger.info('Command:', mainCmd);\n \n \t\ttry {\n-\t\t\tawait utils.exec(credentialsCmd);\n \t\t\tconst result = await utils.exec(mainCmd);\n \t\t\tlogger.info(result);\n \t\t\treturn result;\n \t\t} catch (err) {\n-\t\t\t// Don't fail if file does not exist\n-\t\t\tconst delete_credentialsCmd = `rm -f '${credentialsLocation}' || true`;\n-\t\t\tawait utils.exec(delete_credentialsCmd);\n+\t\t\t// Don't fail if file does not exist, so no need for action in the callback\n+\t\t\tfs.unlink(credentialsLocation, () => {});\n \t\t\tthrow err;\n \t\t}\n \t},"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/OpenPrinting/libppd/commits/d681747ebf12602cb426725eb8ce2753211e2477",
        "url": "https://api.github.com/repos/OpenPrinting/libppd/commits/d681747ebf12602cb426725eb8ce2753211e2477",
        "html_url": "https://github.com/OpenPrinting/libppd/commit/d681747ebf12602cb426725eb8ce2753211e2477",
        "message": "Prevent PPD generation based on invalid IPP response\n\nAuthor: Mike Sweet\nMinor fixes: Zdenek Dohnal\n\nFixes CVE-2024-47175",
        "files": [
            {
                "sha": "818f5b09fcab1b9beeb3e23b996dc8ea071a43e9",
                "filename": "ppd/ppd-cache.c",
                "status": "modified",
                "additions": 12,
                "deletions": 5,
                "changes": 17,
                "blob_url": "https://github.com/OpenPrinting/libppd/blob/d681747ebf12602cb426725eb8ce2753211e2477/ppd%2Fppd-cache.c",
                "raw_url": "https://github.com/OpenPrinting/libppd/raw/d681747ebf12602cb426725eb8ce2753211e2477/ppd%2Fppd-cache.c",
                "contents_url": "https://api.github.com/repos/OpenPrinting/libppd/contents/ppd%2Fppd-cache.c?ref=d681747ebf12602cb426725eb8ce2753211e2477",
                "patch": "@@ -1,6 +1,7 @@\n //\n // PPD cache implementation for libppd.\n //\n+// Copyright \u00a9 2024 by OpenPrinting\n // Copyright \u00a9\u00a02010-2019 by Apple Inc.\n //\n // Licensed under Apache License v2.0.  See the file \"LICENSE\" for more\n@@ -3434,7 +3435,7 @@ ppdCacheGetBin(\n \n   //\n   // Range check input...\n- \n+\n \n   if (!pc || !output_bin)\n     return (NULL);\n@@ -3935,7 +3936,7 @@ ppdCacheGetPageSize(\n       {\n \t//\n \t// Check not only the base size (like \"A4\") but also variants (like\n-        // \"A4.Borderless\"). We check only the margins and orientation but do \n+        // \"A4.Borderless\"). We check only the margins and orientation but do\n \t// not re-check the size.\n \t//\n \n@@ -4776,7 +4777,7 @@ ppdPwgPpdizeName(const char *ipp,\t// I - IPP keyword\n \t*end;\t\t\t\t// End of name buffer\n \n \n-  if (!ipp)\n+  if (!ipp || !_ppd_isalnum(*ipp))\n   {\n     *name = '\\0';\n     return;\n@@ -4786,13 +4787,19 @@ ppdPwgPpdizeName(const char *ipp,\t// I - IPP keyword\n \n   for (ptr = name + 1, end = name + namesize - 1; *ipp && ptr < end;)\n   {\n-    if (*ipp == '-' && _ppd_isalnum(ipp[1]))\n+    if (*ipp == '-' && isalnum(ipp[1]))\n     {\n       ipp ++;\n       *ptr++ = (char)toupper(*ipp++ & 255);\n     }\n-    else\n+    else if (*ipp == '_' || *ipp == '.' || *ipp == '-' || isalnum(*ipp))\n+    {\n       *ptr++ = *ipp++;\n+    }\n+    else\n+    {\n+      ipp ++;\n+    }\n   }\n \n   *ptr = '\\0';"
            },
            {
                "sha": "1e8fc2f7a283aa299f4741b31037b49fb409e65a",
                "filename": "ppd/ppd-generator.c",
                "status": "modified",
                "additions": 164,
                "deletions": 93,
                "changes": 257,
                "blob_url": "https://github.com/OpenPrinting/libppd/blob/d681747ebf12602cb426725eb8ce2753211e2477/ppd%2Fppd-generator.c",
                "raw_url": "https://github.com/OpenPrinting/libppd/raw/d681747ebf12602cb426725eb8ce2753211e2477/ppd%2Fppd-generator.c",
                "contents_url": "https://api.github.com/repos/OpenPrinting/libppd/contents/ppd%2Fppd-generator.c?ref=d681747ebf12602cb426725eb8ce2753211e2477",
                "patch": "@@ -1,15 +1,16 @@\n //\n //   PWG Raster/Apple Raster/PCLm/PDF/IPP legacy PPD generator for libppd.\n //\n-//   Copyright 2016-2019 by Till Kamppeter.\n-//   Copyright 2017-2019 by Sahil Arora.\n-//   Copyright 2018-2019 by Deepak Patankar.\n+//   Copyright \u00a9 2024 by OpenPrinting\n+//   Copyright \u00a9\u00a02016-2019 by Till Kamppeter.\n+//   Copyright \u00a9\u00a02017-2019 by Sahil Arora.\n+//   Copyright \u00a9\u00a02018-2019 by Deepak Patankar.\n //\n //   The PPD generator is based on the PPD generator for the CUPS\n //   \"lpadmin -m everywhere\" functionality in the cups/ppd-cache.c\n //   file. The copyright of this file is:\n //\n-//   Copyright 2010-2016 by Apple Inc.\n+//   Copyright \u00a9\u00a02010-2016 by Apple Inc.\n //\n //   Licensed under Apache License v2.0.  See the file \"LICENSE\" for more\n //   information.\n@@ -71,6 +72,7 @@ typedef struct _ppd_size_s                // **** Media Size (cups_size_t of lib\n \n static int\thttp_connect(http_t **http, const char *url, char *resource,\n \t\t\t     size_t ressize);\n+static void\tppd_put_string(cups_file_t *fp, cups_lang_t *lang, const char *ppd_option, const char *ppd_choice, const char *pwg_msgid);\n \n \n //\n@@ -80,7 +82,7 @@ static int\thttp_connect(http_t **http, const char *url, char *resource,\n // than CUPS 2.2.x. We have also an additional test and development\n // platform for this code. Taken from cups/ppd-cache.c,\n // cups/string-private.h, cups/string.c.\n-// \n+//\n // The advantage of PPD generation instead of working with System V\n // interface scripts is that the print dialogs of the clients do not\n // need to ask the printer for its options via IPP. So we have access\n@@ -144,7 +146,7 @@ char ppdgenerator_msg[1024];\n //                           IPP 1.x legacy)\n //\n \n-char *                                             // O - PPD filename or NULL \n+char *                                             // O - PPD filename or NULL\n                                                    //     on error\n ppdCreatePPDFromIPP(char         *buffer,          // I - Filename buffer\n \t\t    size_t       bufsize,          // I - Size of filename\n@@ -195,7 +197,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \t\t     cups_array_t *conflicts,       // I - Array of\n \t\t\t\t\t\t    //     constraints\n \t\t     cups_array_t *sizes,           // I - Media sizes we've\n-\t\t\t\t\t\t    //     added \n+\t\t\t\t\t\t    //     added\n \t\t     char*        default_pagesize, // I - Default page size\n \t\t     const char   *default_cluster_color, // I - cluster def\n \t\t\t\t\t\t    //     color (if cluster's\n@@ -207,6 +209,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \t\t     size_t       status_msg_size)  // I - Size of status\n \t\t\t\t\t\t    //     message buffer\n {\n+  cups_lang_t\t\t*lang;\t\t// Localization language\n   cups_file_t\t\t*fp;\t\t// PPD file\n   cups_array_t\t\t*printer_sizes;\t// Media sizes we've added\n   _ppd_size_t\t\t*size;\t\t// Current media size\n@@ -219,9 +222,10 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n   ipp_t\t\t\t*media_col,\t// Media collection\n \t\t\t*media_size;\t// Media size collection\n   char\t\t\tmake[256],\t// Make and model\n-\t\t\t*model,\t\t// Model name\n+\t\t\t*mptr,\t\t// Pointer into make and model\n \t\t\tppdname[PPD_MAX_NAME];\n \t\t    \t\t\t// PPD keyword\n+  const char\t\t*model;\t\t// Model name\n   int\t\t\ti, j,\t\t// Looping vars\n \t\t\tcount = 0,\t// Number of values\n \t\t\tbottom,\t\t// Largest bottom margin\n@@ -303,6 +307,68 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n     return (NULL);\n   }\n \n+  //\n+  // Get a sanitized make and model...\n+  //\n+\n+  if ((attr = ippFindAttribute(supported, \"printer-make-and-model\", IPP_TAG_TEXT)) != NULL && ippValidateAttribute(attr))\n+  {\n+    // Sanitize the model name to only contain PPD-safe characters.\n+    strlcpy(make, ippGetString(attr, 0, NULL), sizeof(make));\n+\n+    for (mptr = make; *mptr; mptr ++)\n+    {\n+      if (*mptr < ' ' || *mptr >= 127 || *mptr == '\\\"')\n+      {\n+        // Truncate the make and model on the first bad character...\n+\t*mptr = '\\0';\n+\tbreak;\n+      }\n+    }\n+\n+    while (mptr > make)\n+    {\n+      // Strip trailing whitespace...\n+      mptr --;\n+      if (*mptr == ' ')\n+\t*mptr = '\\0';\n+    }\n+\n+    if (!make[0])\n+    {\n+      // Use a default make and model if nothing remains...\n+      strlcpy(make, \"Unknown\", sizeof(make));\n+    }\n+  }\n+  else\n+  {\n+    // Use a default make and model...\n+    strlcpy(make, \"Unknown\", sizeof(make));\n+  }\n+\n+  if (!strncasecmp(make, \"Hewlett Packard \", 16) || !strncasecmp(make, \"Hewlett-Packard \", 16))\n+  {\n+    // Normalize HP printer make and model...\n+    model = make + 16;\n+    strlcpy(make, \"HP\", sizeof(make));\n+\n+    if (!strncasecmp(model, \"HP \", 3))\n+      model += 3;\n+  }\n+  else if ((mptr = strchr(make, ' ')) != NULL)\n+  {\n+    // Separate \"MAKE MODEL\"...\n+    while (*mptr && *mptr == ' ')\n+      *mptr++ = '\\0';\n+\n+    model = mptr;\n+  }\n+  else\n+  {\n+    // No separate model name...\n+    model = \"Printer\";\n+  }\n+\n   //\n   // Standard stuff for PPD file...\n   //\n@@ -331,25 +397,6 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n     }\n   }\n \n-  if ((attr = ippFindAttribute(supported, \"printer-make-and-model\",\n-\t\t\t       IPP_TAG_TEXT)) != NULL)\n-    strlcpy(make, ippGetString(attr, 0, NULL), sizeof(make));\n-  else if (make_model && make_model[0] != '\\0')\n-    strlcpy(make, make_model, sizeof(make));\n-  else\n-    strlcpy(make, \"Unknown Printer\", sizeof(make));\n-\n-  if (!strncasecmp(make, \"Hewlett Packard \", 16) ||\n-      !strncasecmp(make, \"Hewlett-Packard \", 16))\n-  {\n-    model = make + 16;\n-    strlcpy(make, \"HP\", sizeof(make));\n-  }\n-  else if ((model = strchr(make, ' ')) != NULL)\n-    *model++ = '\\0';\n-  else\n-    model = make;\n-\n   cupsFilePrintf(fp, \"*Manufacturer: \\\"%s\\\"\\n\", make);\n   cupsFilePrintf(fp, \"*ModelName: \\\"%s %s\\\"\\n\", make, model);\n   cupsFilePrintf(fp, \"*Product: \\\"(%s %s)\\\"\\n\", make, model);\n@@ -445,21 +492,19 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n   }\n   cupsFilePuts(fp, \"\\\"\\n\");\n \n-  if ((attr = ippFindAttribute(supported, \"printer-more-info\", IPP_TAG_URI)) !=\n-      NULL)\n+  if ((attr = ippFindAttribute(supported, \"printer-more-info\", IPP_TAG_URI)) != NULL && ippValidateAttribute(attr))\n     cupsFilePrintf(fp, \"*APSupplies: \\\"%s\\\"\\n\", ippGetString(attr, 0, NULL));\n \n-  if ((attr = ippFindAttribute(supported, \"printer-charge-info-uri\",\n-\t\t\t       IPP_TAG_URI)) != NULL)\n-    cupsFilePrintf(fp, \"*cupsChargeInfoURI: \\\"%s\\\"\\n\", ippGetString(attr, 0,\n-\t\t\t\t\t\t\t\t    NULL));\n+  if ((attr = ippFindAttribute(supported, \"printer-charge-info-uri\", IPP_TAG_URI)) != NULL && ippValidateAttribute(attr))\n+    cupsFilePrintf(fp, \"*cupsChargeInfoURI: \\\"%s\\\"\\n\", ippGetString(attr, 0, NULL));\n \n   // Message catalogs for UI strings\n+  lang = cupsLangDefault();\n   opt_strings_catalog = cfCatalogOptionArrayNew();\n   cfCatalogLoad(NULL, NULL, opt_strings_catalog);\n \n   if ((attr = ippFindAttribute(supported, \"printer-strings-uri\",\n-\t\t\t       IPP_TAG_URI)) != NULL)\n+\t\t\t       IPP_TAG_URI)) != NULL && ippValidateAttribute(attr))\n   {\n     printer_opt_strings_catalog = cfCatalogOptionArrayNew();\n     cfCatalogLoad(ippGetString(attr, 0, NULL), NULL,\n@@ -512,7 +557,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \t  response = cupsDoRequest(http, request, resource);\n \n \t  if ((attr = ippFindAttribute(response, \"printer-strings-uri\",\n-\t\t\t\t       IPP_TAG_URI)) != NULL)\n+\t\t\t\t       IPP_TAG_URI)) != NULL && ippValidateAttribute(attr))\n \t    cupsFilePrintf(fp, \"*cupsStringsURI %s: \\\"%s\\\"\\n\", keyword,\n \t\t\t   ippGetString(attr, 0, NULL));\n \n@@ -538,13 +583,10 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \t\t\t\t     IPP_TAG_BOOLEAN), 0))\n     cupsFilePuts(fp, \"*cupsJobAccountingUserId: True\\n\");\n \n-  if ((attr = ippFindAttribute(supported, \"printer-privacy-policy-uri\",\n-\t\t\t       IPP_TAG_URI)) != NULL)\n-    cupsFilePrintf(fp, \"*cupsPrivacyURI: \\\"%s\\\"\\n\",\n-\t\t   ippGetString(attr, 0, NULL));\n+  if ((attr = ippFindAttribute(supported, \"printer-privacy-policy-uri\", IPP_TAG_URI)) != NULL && ippValidateAttribute(attr))\n+    cupsFilePrintf(fp, \"*cupsPrivacyURI: \\\"%s\\\"\\n\", ippGetString(attr, 0, NULL));\n \n-  if ((attr = ippFindAttribute(supported, \"printer-mandatory-job-attributes\",\n-\t\t\t       IPP_TAG_KEYWORD)) != NULL)\n+  if ((attr = ippFindAttribute(supported, \"printer-mandatory-job-attributes\", IPP_TAG_KEYWORD)) != NULL && ippValidateAttribute(attr))\n   {\n     char\tprefix = '\\\"';\t\t// Prefix for string\n \n@@ -564,8 +606,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n     cupsFilePuts(fp, \"\\\"\\n\");\n   }\n \n-  if ((attr = ippFindAttribute(supported, \"printer-requested-job-attributes\",\n-\t\t\t       IPP_TAG_KEYWORD)) != NULL)\n+  if ((attr = ippFindAttribute(supported, \"printer-requested-job-attributes\", IPP_TAG_KEYWORD)) != NULL && ippValidateAttribute(attr))\n   {\n     char\tprefix = '\\\"';\t\t// Prefix for string\n \n@@ -684,7 +725,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n   }\n \n   //\n-  // Fax \n+  // Fax\n   //\n \n   if (is_fax)\n@@ -734,21 +775,21 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n   else if (cupsArrayFind(pdl_list, \"image/urf\") &&\n \t   (ippFindAttribute(supported, \"urf-supported\", IPP_TAG_KEYWORD) != NULL))\n   {\n-    int resStore = 0; // Variable for storing the no. of resolutions in the resolution array \n+    int resStore = 0; // Variable for storing the no. of resolutions in the resolution array\n     int resArray[__INT16_MAX__]; // Creating a resolution array supporting a maximum of 32767 resolutions.\n     int lowdpi = 0, middpi = 0, hidpi = 0; // Lower , middle and higher resolution\n     if ((attr = ippFindAttribute(supported, \"urf-supported\",\n \t\t\tIPP_TAG_KEYWORD)) != NULL)\n     {\n       for (int i = 0, count = ippGetCount(attr); i < count; i ++)\n-      {  \n+      {\n        \tconst char *rs = ippGetString(attr, i, NULL); // RS values\n-        const char *rsCopy = ippGetString(attr, i, NULL); // RS values(copy) \n+        const char *rsCopy = ippGetString(attr, i, NULL); // RS values(copy)\n \tif (strncasecmp(rs, \"RS\", 2)) // Comparing attributes to have RS in\n \t                              // the beginning to indicate the\n \t                              // resolution feature\n \t  continue;\n-        int resCount = 0; // Using a count variable which can be reset \n+        int resCount = 0; // Using a count variable which can be reset\n         while (*rsCopy != '\\0') // Parsing through the copy pointer to\n \t                        // determine the no. of resolutions\n         {\n@@ -846,7 +887,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \t    formatfound = 1;\n \t    is_apple = 1;\n \t  }\n-        } \n+        }\n       }\n     }\n   }\n@@ -924,7 +965,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n   if (manual_copies == 1)\n     cupsFilePuts(fp, \"*cupsManualCopies: True\\n\");\n \n-  // No resolution requirements by any of the supported PDLs? \n+  // No resolution requirements by any of the supported PDLs?\n   // Use \"printer-resolution-supported\" attribute\n   if (common_res == NULL)\n   {\n@@ -1042,7 +1083,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n   //\n   // PageSize/PageRegion/ImageableArea/PaperDimension\n   //\n- \n+\n   cfGenerateSizes(supported, CF_GEN_SIZES_DEFAULT, &printer_sizes, &defattr,\n \t\t  NULL, NULL, NULL, NULL, NULL, NULL,\n \t\t  &min_width, &min_length,\n@@ -1421,15 +1462,15 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n         if (!strcmp(sources[j], keyword))\n \t  break;\n       if (j >= 0)\n-\tcupsFilePrintf(fp, \"*InputSlot %s%s%s: \\\"<</MediaPosition %d>>setpagedevice\\\"\\n\",\n-\t\t       ppdname,\n-\t\t       (human_readable ? \"/\" : \"\"),\n-\t\t       (human_readable ? human_readable : \"\"), j);\n+      {\n+\tcupsFilePrintf(fp, \"*InputSlot %s: \\\"<</MediaPosition %d>>setpagedevice\\\"\\n\", ppdname, j);\n+\tppd_put_string(fp, lang, \"InputSlot\", ppdname, human_readable);\n+      }\n       else\n-\tcupsFilePrintf(fp, \"*InputSlot %s%s%s: \\\"\\\"\\n\",\n-\t\t       ppdname,\n-\t\t       (human_readable ? \"/\" : \"\"),\n-\t\t       (human_readable ? human_readable : \"\"));\n+      {\n+\tcupsFilePrintf(fp, \"*InputSlot %s%s%s:\\\"\\\"\\n\", ppdname, human_readable ? \"/\" : \"\", human_readable ? human_readable : \"\");\n+\tppd_put_string(fp, lang, \"InputSlot\", ppdname, human_readable);\n+      }\n     }\n     cupsFilePuts(fp, \"*CloseUI: *InputSlot\\n\");\n   }\n@@ -1464,11 +1505,8 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n       human_readable = cfCatalogLookUpChoice((char *)keyword, \"media-type\",\n \t\t\t\t\t     opt_strings_catalog,\n \t\t\t\t\t     printer_opt_strings_catalog);\n-      cupsFilePrintf(fp, \"*MediaType %s%s%s: \\\"<</MediaType(%s)>>setpagedevice\\\"\\n\",\n-\t\t     ppdname,\n-\t\t     (human_readable ? \"/\" : \"\"),\n-\t\t     (human_readable ? human_readable : \"\"),\n-\t\t     ppdname);\n+      cupsFilePrintf(fp, \"*MediaType %s: \\\"<</MediaType(%s)>>setpagedevice\\\"\\n\", ppdname, ppdname);\n+      ppd_put_string(fp, lang, \"MediaType\", ppdname, human_readable);\n     }\n     cupsFilePuts(fp, \"*CloseUI: *MediaType\\n\");\n   }\n@@ -1791,10 +1829,8 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n       human_readable = cfCatalogLookUpChoice((char *)keyword, \"output-bin\",\n \t\t\t\t\t     opt_strings_catalog,\n \t\t\t\t\t     printer_opt_strings_catalog);\n-      cupsFilePrintf(fp, \"*OutputBin %s%s%s: \\\"\\\"\\n\",\n-\t\t     ppdname,\n-\t\t     (human_readable ? \"/\" : \"\"),\n-\t\t     (human_readable ? human_readable : \"\"));\n+      cupsFilePrintf(fp, \"*OutputBin %s: \\\"\\\"\\n\", ppdname);\n+      ppd_put_string(fp, lang, \"OutputBin\", ppdname, human_readable);\n       outputorderinfofound = 0;\n       faceupdown = 1;\n       firsttolast = 1;\n@@ -1848,7 +1884,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \n   //\n   // Finishing options...\n-  // \n+  //\n \n   if ((attr = ippFindAttribute(supported, \"finishings-supported\",\n \t\t\t       IPP_TAG_ENUM)) != NULL)\n@@ -1973,9 +2009,8 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \thuman_readable = cfCatalogLookUpChoice(buf, \"finishings\",\n \t\t\t\t\t       opt_strings_catalog,\n \t\t\t\t\t       printer_opt_strings_catalog);\n-\tcupsFilePrintf(fp, \"*StapleLocation %s%s%s: \\\"\\\"\\n\", ppd_keyword,\n-\t\t       (human_readable ? \"/\" : \"\"),\n-\t\t       (human_readable ? human_readable : \"\"));\n+\tcupsFilePrintf(fp, \"*StapleLocation %s: \\\"\\\"\\n\", ppd_keyword);\n+\tppd_put_string(fp, lang, \"StapleLocation\", ppd_keyword, human_readable);\n \tcupsFilePrintf(fp, \"*cupsIPPFinishings %d/%s: \\\"*StapleLocation %s\\\"\\n\",\n \t\t       value, keyword, ppd_keyword);\n       }\n@@ -2065,9 +2100,8 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \thuman_readable = cfCatalogLookUpChoice(buf, \"finishings\",\n \t\t\t\t\t       opt_strings_catalog,\n \t\t\t\t\t       printer_opt_strings_catalog);\n-\tcupsFilePrintf(fp, \"*FoldType %s%s%s: \\\"\\\"\\n\", ppd_keyword,\n-\t\t       (human_readable ? \"/\" : \"\"),\n-\t\t       (human_readable ? human_readable : \"\"));\n+\tcupsFilePrintf(fp, \"*FoldType %s: \\\"\\\"\\n\", ppd_keyword);\n+\tppd_put_string(fp, lang, \"FoldType\", ppd_keyword, human_readable);\n \tcupsFilePrintf(fp, \"*cupsIPPFinishings %d/%s: \\\"*FoldType %s\\\"\\n\",\n \t\t       value, keyword, ppd_keyword);\n       }\n@@ -2164,9 +2198,8 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \thuman_readable = cfCatalogLookUpChoice(buf, \"finishings\",\n \t\t\t\t\t       opt_strings_catalog,\n \t\t\t\t\t       printer_opt_strings_catalog);\n-\tcupsFilePrintf(fp, \"*PunchMedia %s%s%s: \\\"\\\"\\n\", ppd_keyword,\n-\t\t       (human_readable ? \"/\" : \"\"),\n-\t\t       (human_readable ? human_readable : \"\"));\n+\tcupsFilePrintf(fp, \"*PunchMedia %s: \\\"\\\"\\n\", ppd_keyword);\n+\tppd_put_string(fp, lang, \"PunchMedia\", ppd_keyword, human_readable);\n \tcupsFilePrintf(fp, \"*cupsIPPFinishings %d/%s: \\\"*PunchMedia %s\\\"\\n\",\n \t\t       value, keyword, ppd_keyword);\n       }\n@@ -2257,9 +2290,8 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \thuman_readable = cfCatalogLookUpChoice(buf, \"finishings\",\n \t\t\t\t\t       opt_strings_catalog,\n \t\t\t\t\t       printer_opt_strings_catalog);\n-\tcupsFilePrintf(fp, \"*CutMedia %s%s%s: \\\"\\\"\\n\", ppd_keyword,\n-\t\t       (human_readable ? \"/\" : \"\"),\n-\t\t       (human_readable ? human_readable : \"\"));\n+\tcupsFilePrintf(fp, \"*CutMedia %s: \\\"\\\"\\n\", ppd_keyword);\n+\tppd_put_string(fp, lang, \"CutMedia\", ppd_keyword, human_readable);\n \tcupsFilePrintf(fp, \"*cupsIPPFinishings %d/%s: \\\"*CutMedia %s\\\"\\n\",\n \t\t       value, keyword, ppd_keyword);\n       }\n@@ -2283,7 +2315,7 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n     cupsFilePrintf(fp, \"*OpenUI *cupsFinishingTemplate/%s: PickOne\\n\",\n \t\t   (human_readable ? human_readable : \"Finishing Template\"));\n     cupsFilePuts(fp, \"*OrderDependency: 10 AnySetup *cupsFinishingTemplate\\n\");\n-    cupsFilePuts(fp, \"*DefaultcupsFinishingTemplate: none\\n\");\n+    cupsFilePuts(fp, \"*DefaultcupsFinishingTemplate: None\\n\");\n     human_readable = cfCatalogLookUpChoice(\"3\", \"finishings\",\n \t\t\t\t\t   opt_strings_catalog,\n \t\t\t\t\t   printer_opt_strings_catalog);\n@@ -2314,8 +2346,9 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \t\t\t\t\t     printer_opt_strings_catalog);\n       if (human_readable == NULL)\n \thuman_readable = (char *)keyword;\n-      cupsFilePrintf(fp, \"*cupsFinishingTemplate %s/%s: \\\"\\n\", keyword,\n-\t\t     human_readable);\n+      ppdPwgPpdizeName(keyword, ppdname, sizeof(ppdname));\n+      cupsFilePrintf(fp, \"*cupsFinishingTemplate %s: \\\"\\n\", ppdname);\n+      ppd_put_string(fp, lang, \"cupsFinishingTemplate\", ppdname, human_readable);\n       for (finishing_attr = ippGetFirstAttribute(finishing_col); finishing_attr;\n \t   finishing_attr = ippGetNextAttribute(finishing_col)) {\n         if (ippGetValueTag(finishing_attr) == IPP_TAG_BEGIN_COLLECTION) {\n@@ -2579,14 +2612,14 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n       if (!preset || !preset_name)\n         continue;\n \n-      if ((localized_name =\n+      ppdPwgPpdizeName(preset_name, ppdname, sizeof(ppdname));\n+\n+      localized_name =\n \t   cfCatalogLookUpOption((char *)preset_name,\n \t\t\t\t opt_strings_catalog,\n-\t\t\t\t printer_opt_strings_catalog)) == NULL)\n-        cupsFilePrintf(fp, \"*APPrinterPreset %s: \\\"\\n\", preset_name);\n-      else\n-        cupsFilePrintf(fp, \"*APPrinterPreset %s/%s: \\\"\\n\", preset_name,\n-\t\t       localized_name);\n+\t\t\t\t printer_opt_strings_catalog);\n+      cupsFilePrintf(fp, \"*APPrinterPreset %s: \\\"\\n\", ppdname);\n+      ppd_put_string(fp, lang, \"APPrinterPreset\", ppdname, localized_name);\n \n       for (member = ippGetFirstAttribute(preset); member;\n \t   member = ippGetNextAttribute(preset))\n@@ -2635,7 +2668,10 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \t\t ippGetString(ippFindAttribute(fin_col,\n \t\t\t\t\t       \"finishing-template\",\n \t\t\t\t\t       IPP_TAG_ZERO), 0, NULL)) != NULL)\n-              cupsFilePrintf(fp, \"*cupsFinishingTemplate %s\\n\", keyword);\n+            {\n+\t      ppdPwgPpdizeName(keyword, ppdname, sizeof(ppdname));\n+              cupsFilePrintf(fp, \"*cupsFinishingTemplate %s\\n\", ppdname);\n+            }\n           }\n         }\n \telse if (!strcmp(member_name, \"media\"))\n@@ -2674,15 +2710,15 @@ ppdCreatePPDFromIPP2(char         *buffer,          // I - Filename buffer\n \t\t\t\t      NULL)) != NULL)\n \t  {\n             ppdPwgPpdizeName(keyword, ppdname, sizeof(ppdname));\n-            cupsFilePrintf(fp, \"*InputSlot %s\\n\", keyword);\n+            cupsFilePrintf(fp, \"*InputSlot %s\\n\", ppdname);\n \t  }\n \n           if ((keyword = ippGetString(ippFindAttribute(media_col, \"media-type\",\n \t\t\t\t\t\t       IPP_TAG_ZERO), 0,\n \t\t\t\t      NULL)) != NULL)\n \t  {\n             ppdPwgPpdizeName(keyword, ppdname, sizeof(ppdname));\n-            cupsFilePrintf(fp, \"*MediaType %s\\n\", keyword);\n+            cupsFilePrintf(fp, \"*MediaType %s\\n\", ppdname);\n \t  }\n         }\n \telse if (!strcmp(member_name, \"print-quality\"))\n@@ -2832,3 +2868,38 @@ http_connect(http_t     **http,\t\t// IO - Current HTTP connection\n \n   return (*http != NULL);\n }\n+\n+\n+/*\n+ * 'ppd_put_strings()' - Write localization attributes to a PPD file.\n+ */\n+\n+static void\n+ppd_put_string(cups_file_t  *fp,\t/* I - PPD file */\n+               cups_lang_t  *lang,\t/* I - Language */\n+\t       const char   *ppd_option,/* I - PPD option */\n+\t       const char   *ppd_choice,/* I - PPD choice */\n+\t       const char   *text)\t/* I - Localized text */\n+{\n+  if (!text)\n+    return;\n+\n+  // Add the first line of localized text...\n+#if CUPS_VERSION_MAJOR > 2\n+  cupsFilePrintf(fp, \"*%s.%s %s/\", cupsLangGetName(lang), ppd_option, ppd_choice);\n+#else\n+  cupsFilePrintf(fp, \"*%s.%s %s/\", lang->language, ppd_option, ppd_choice);\n+#endif // CUPS_VERSION_MAJOR > 2\n+\n+  while (*text && *text != '\\n')\n+  {\n+    // Escape \":\" and \"<\"...\n+    if (*text == ':' || *text == '<')\n+      cupsFilePrintf(fp, \"<%02X>\", *text);\n+    else\n+      cupsFilePutChar(fp, *text);\n+\n+    text ++;\n+  }\n+  cupsFilePuts(fp, \": \\\"\\\"\\n\");\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/OpenPrinting/libcupsfilters/commits/95576ec3d20c109332d14672a807353cdc551018",
        "url": "https://api.github.com/repos/OpenPrinting/libcupsfilters/commits/95576ec3d20c109332d14672a807353cdc551018",
        "html_url": "https://github.com/OpenPrinting/libcupsfilters/commit/95576ec3d20c109332d14672a807353cdc551018",
        "message": "cfGetPrinterAttributes5(): Validate response attributes before return\n\nThe destination can be corrupted or forged, so validate the response\nto strenghten security measures.\n\nFixes CVE-2024-47076",
        "files": [
            {
                "sha": "db10cb3f002779e258129c9406838565bff62113",
                "filename": "cupsfilters/ipp.c",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/OpenPrinting/libcupsfilters/blob/95576ec3d20c109332d14672a807353cdc551018/cupsfilters%2Fipp.c",
                "raw_url": "https://github.com/OpenPrinting/libcupsfilters/raw/95576ec3d20c109332d14672a807353cdc551018/cupsfilters%2Fipp.c",
                "contents_url": "https://api.github.com/repos/OpenPrinting/libcupsfilters/contents/cupsfilters%2Fipp.c?ref=95576ec3d20c109332d14672a807353cdc551018",
                "patch": "@@ -404,6 +404,14 @@ cfGetPrinterAttributes5(http_t *http_printer,\n \t    ippDelete(response2);\n \t  }\n \t}\n+\n+\t// Check if the response is valid\n+\tif (!ippValidateAttributes(response))\n+\t{\n+\t  ippDelete(response);\n+\t  response = NULL;\n+\t}\n+\n \tif (have_http == 0) httpClose(http_printer);\n \tif (uri) free(uri);\n \treturn (response);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/OpenPrinting/cups-browsed/commits/1debe6b140c37e0aa928559add4abcc95ce54aa2",
        "url": "https://api.github.com/repos/OpenPrinting/cups-browsed/commits/1debe6b140c37e0aa928559add4abcc95ce54aa2",
        "html_url": "https://github.com/OpenPrinting/cups-browsed/commit/1debe6b140c37e0aa928559add4abcc95ce54aa2",
        "message": "Default BrowseRemoteProtocols should not include \"cups\" protocol\n\nWorks around CVE-2024-47176, the fix will be complete removal of CUPS\nBrowsing functionality",
        "files": [
            {
                "sha": "84de91290516baa62ac4f436f02b5a8d8e08a364",
                "filename": "configure.ac",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/OpenPrinting/cups-browsed/blob/1debe6b140c37e0aa928559add4abcc95ce54aa2/configure.ac",
                "raw_url": "https://github.com/OpenPrinting/cups-browsed/raw/1debe6b140c37e0aa928559add4abcc95ce54aa2/configure.ac",
                "contents_url": "https://api.github.com/repos/OpenPrinting/cups-browsed/contents/configure.ac?ref=1debe6b140c37e0aa928559add4abcc95ce54aa2",
                "patch": "@@ -183,9 +183,9 @@ else\n fi\n \n AC_ARG_WITH([browseremoteprotocols],\n-\t[AS_HELP_STRING([--with-browseremoteprotocols=value], [Set which protocols to listen for in cups-browsed (default: dnssd cups)])],\n+\t[AS_HELP_STRING([--with-browseremoteprotocols=value], [Set which protocols to listen for in cups-browsed (default: dnssd)])],\n \t[with_browseremoteprotocols=\"$withval\"],\n-\t[with_browseremoteprotocols=\"dnssd cups\"]\n+\t[with_browseremoteprotocols=\"dnssd\"]\n )\n BROWSEREMOTEPROTOCOLS=\"$with_browseremoteprotocols\"\n AC_SUBST(BROWSEREMOTEPROTOCOLS)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openbao/openbao/commits/d5b4e922469830ac335b21dc0e8f9878c501a884",
        "url": "https://api.github.com/repos/openbao/openbao/commits/d5b4e922469830ac335b21dc0e8f9878c501a884",
        "html_url": "https://github.com/openbao/openbao/commit/d5b4e922469830ac335b21dc0e8f9878c501a884",
        "message": "Deny empty valid_principals during SSH issuance (#561)\n\n* Deny empty valid_principals during SSH issuance\r\n\r\nHashiCorp Vault recently released a security vulnerability identifying\r\nglobal issuance without valid_principals. They introduced a new role\r\noption, allow_empty_principals, breaking existing users (as it defaults\r\nto false), but allowing operators to override it on a per-role level.\r\n\r\nAs evidenced by the extent of the test changes, this is definitely\r\nconsidered a breaking change.\r\n\r\nSee also: https://discuss.hashicorp.com/t/hcsec-2024-20-vault-ssh-secrets-engine-configuration-did-not-restrict-valid-principals-by-default/70251\r\nSee also: https://groups.google.com/g/opensshunixdev/c/RFKeIwNvtn8\r\nSee also: https://github.com/openssh/openssh-portable/commit/0a80ca190a39943029719facf7edb990def7ae62\r\nSee also: https://github.com/openssh/openssh-portable/blob/67a115e7a56dbdc3f5a58c64b29231151f3670f5/regress/cert-userkey.sh#L341-L343\r\nSee also: https://github.com/openssh/openssh-portable/blob/67a115e7a56dbdc3f5a58c64b29231151f3670f5/regress/cert-hostkey.sh#L247\r\n\r\nSigned-off-by: Alexander Scheel <ascheel@gitlab.com>\r\n\r\n* Add changelog entry\r\n\r\nSigned-off-by: Alexander Scheel <ascheel@gitlab.com>\r\n\r\n* Update changelog/561.txt\r\n\r\nSigned-off-by: Alexander Scheel <alexander.m.scheel@gmail.com>\r\n\r\n---------\r\n\r\nSigned-off-by: Alexander Scheel <ascheel@gitlab.com>\r\nSigned-off-by: Alexander Scheel <alexander.m.scheel@gmail.com>",
        "files": [
            {
                "sha": "5203ce31480c340ff4d163d2d0eba24e72de5f87",
                "filename": "builtin/logical/ssh/backend_test.go",
                "status": "modified",
                "additions": 43,
                "deletions": 11,
                "changes": 54,
                "blob_url": "https://github.com/openbao/openbao/blob/d5b4e922469830ac335b21dc0e8f9878c501a884/builtin%2Flogical%2Fssh%2Fbackend_test.go",
                "raw_url": "https://github.com/openbao/openbao/raw/d5b4e922469830ac335b21dc0e8f9878c501a884/builtin%2Flogical%2Fssh%2Fbackend_test.go",
                "contents_url": "https://api.github.com/repos/openbao/openbao/contents/builtin%2Flogical%2Fssh%2Fbackend_test.go?ref=d5b4e922469830ac335b21dc0e8f9878c501a884",
                "patch": "@@ -1261,6 +1261,7 @@ func TestBackend_AllowedUserKeyLengths(t *testing.T) {\n \t\t\tcreateRoleStep(\"weakkey\", map[string]interface{}{\n \t\t\t\t\"key_type\":                \"ca\",\n \t\t\t\t\"allow_user_certificates\": true,\n+\t\t\t\t\"allowed_users\":           \"toor\",\n \t\t\t\t\"allowed_user_key_lengths\": map[string]interface{}{\n \t\t\t\t\t\"rsa\": 4096,\n \t\t\t\t},\n@@ -1269,7 +1270,8 @@ func TestBackend_AllowedUserKeyLengths(t *testing.T) {\n \t\t\t\tOperation: logical.UpdateOperation,\n \t\t\t\tPath:      \"sign/weakkey\",\n \t\t\t\tData: map[string]interface{}{\n-\t\t\t\t\t\"public_key\": testCAPublicKey,\n+\t\t\t\t\t\"public_key\":       testCAPublicKey,\n+\t\t\t\t\t\"valid_principals\": \"toor\",\n \t\t\t\t},\n \t\t\t\tErrorOk: true,\n \t\t\t\tCheck: func(resp *logical.Response) error {\n@@ -1282,6 +1284,7 @@ func TestBackend_AllowedUserKeyLengths(t *testing.T) {\n \t\t\tcreateRoleStep(\"stdkey\", map[string]interface{}{\n \t\t\t\t\"key_type\":                \"ca\",\n \t\t\t\t\"allow_user_certificates\": true,\n+\t\t\t\t\"allowed_users\":           \"*\", // validate we can bypass allow_empty_principals=false\n \t\t\t\t\"allowed_user_key_lengths\": map[string]interface{}{\n \t\t\t\t\t\"rsa\": 2048,\n \t\t\t\t},\n@@ -1312,6 +1315,7 @@ func TestBackend_AllowedUserKeyLengths(t *testing.T) {\n \t\t\tcreateRoleStep(\"multikey\", map[string]interface{}{\n \t\t\t\t\"key_type\":                \"ca\",\n \t\t\t\t\"allow_user_certificates\": true,\n+\t\t\t\t\"allowed_users\":           \"toor\",\n \t\t\t\t\"allowed_user_key_lengths\": map[string]interface{}{\n \t\t\t\t\t\"rsa\": []int{2048, 4096},\n \t\t\t\t},\n@@ -1321,23 +1325,26 @@ func TestBackend_AllowedUserKeyLengths(t *testing.T) {\n \t\t\t\tOperation: logical.UpdateOperation,\n \t\t\t\tPath:      \"sign/multikey\",\n \t\t\t\tData: map[string]interface{}{\n-\t\t\t\t\t\"public_key\": testCAPublicKey,\n+\t\t\t\t\t\"public_key\":       testCAPublicKey,\n+\t\t\t\t\t\"valid_principals\": \"toor\",\n \t\t\t\t},\n \t\t\t},\n \t\t\t// Pass with 4096-bit key\n \t\t\t{\n \t\t\t\tOperation: logical.UpdateOperation,\n \t\t\t\tPath:      \"sign/multikey\",\n \t\t\t\tData: map[string]interface{}{\n-\t\t\t\t\t\"public_key\": publicKey4096,\n+\t\t\t\t\t\"public_key\":       publicKey4096,\n+\t\t\t\t\t\"valid_principals\": \"toor\",\n \t\t\t\t},\n \t\t\t},\n \t\t\t// Fail with 3072-bit key\n \t\t\t{\n \t\t\t\tOperation: logical.UpdateOperation,\n \t\t\t\tPath:      \"sign/multikey\",\n \t\t\t\tData: map[string]interface{}{\n-\t\t\t\t\t\"public_key\": publicKey3072,\n+\t\t\t\t\t\"public_key\":       publicKey3072,\n+\t\t\t\t\t\"valid_principals\": \"toor\",\n \t\t\t\t},\n \t\t\t\tErrorOk: true,\n \t\t\t\tCheck: func(resp *logical.Response) error {\n@@ -1352,7 +1359,8 @@ func TestBackend_AllowedUserKeyLengths(t *testing.T) {\n \t\t\t\tOperation: logical.UpdateOperation,\n \t\t\t\tPath:      \"sign/multikey\",\n \t\t\t\tData: map[string]interface{}{\n-\t\t\t\t\t\"public_key\": publicKeyECDSA256,\n+\t\t\t\t\t\"public_key\":       publicKeyECDSA256,\n+\t\t\t\t\t\"valid_principals\": \"toor\",\n \t\t\t\t},\n \t\t\t\tErrorOk: true,\n \t\t\t\tCheck: func(resp *logical.Response) error {\n@@ -1365,6 +1373,7 @@ func TestBackend_AllowedUserKeyLengths(t *testing.T) {\n \t\t\tcreateRoleStep(\"ectypes\", map[string]interface{}{\n \t\t\t\t\"key_type\":                \"ca\",\n \t\t\t\t\"allow_user_certificates\": true,\n+\t\t\t\t\"allowed_users\":           \"toor\",\n \t\t\t\t\"allowed_user_key_lengths\": map[string]interface{}{\n \t\t\t\t\t\"ec\":                  []int{256},\n \t\t\t\t\t\"ecdsa-sha2-nistp521\": 0,\n@@ -1375,23 +1384,26 @@ func TestBackend_AllowedUserKeyLengths(t *testing.T) {\n \t\t\t\tOperation: logical.UpdateOperation,\n \t\t\t\tPath:      \"sign/ectypes\",\n \t\t\t\tData: map[string]interface{}{\n-\t\t\t\t\t\"public_key\": publicKeyECDSA256,\n+\t\t\t\t\t\"public_key\":       publicKeyECDSA256,\n+\t\t\t\t\t\"valid_principals\": \"toor\",\n \t\t\t\t},\n \t\t\t},\n \t\t\t// Pass with ECDSA P-521\n \t\t\t{\n \t\t\t\tOperation: logical.UpdateOperation,\n \t\t\t\tPath:      \"sign/ectypes\",\n \t\t\t\tData: map[string]interface{}{\n-\t\t\t\t\t\"public_key\": publicKeyECDSA521,\n+\t\t\t\t\t\"public_key\":       publicKeyECDSA521,\n+\t\t\t\t\t\"valid_principals\": \"toor\",\n \t\t\t\t},\n \t\t\t},\n \t\t\t// Fail with RSA key\n \t\t\t{\n \t\t\t\tOperation: logical.UpdateOperation,\n \t\t\t\tPath:      \"sign/ectypes\",\n \t\t\t\tData: map[string]interface{}{\n-\t\t\t\t\t\"public_key\": publicKey3072,\n+\t\t\t\t\t\"public_key\":       publicKey3072,\n+\t\t\t\t\t\"valid_principals\": \"toor\",\n \t\t\t\t},\n \t\t\t\tErrorOk: true,\n \t\t\t\tCheck: func(resp *logical.Response) error {\n@@ -1840,6 +1852,7 @@ func TestSSHBackend_IssueSign(t *testing.T) {\n \t\t\t\t\"key_type\":                \"ca\",\n \t\t\t\t\"allow_user_key_ids\":      false,\n \t\t\t\t\"allow_user_certificates\": true,\n+\t\t\t\t\"allowed_users\":           \"*\",\n \t\t\t\t\"allowed_user_key_lengths\": map[string]interface{}{\n \t\t\t\t\t\"ssh-rsa\":             []int{2048, 3072, 4096},\n \t\t\t\t\t\"ecdsa-sha2-nistp521\": 0,\n@@ -2117,8 +2130,9 @@ func issueSSHKeyPairStep(role, keyType string, keyBits int, expectError bool, er\n \t\tOperation: logical.UpdateOperation,\n \t\tPath:      \"issue/\" + role,\n \t\tData: map[string]interface{}{\n-\t\t\t\"key_type\": keyType,\n-\t\t\t\"key_bits\": keyBits,\n+\t\t\t\"key_type\":         keyType,\n+\t\t\t\"key_bits\":         keyBits,\n+\t\t\t\"valid_principals\": \"toor\",\n \t\t},\n \t\tErrorOk: true,\n \t\tCheck: func(resp *logical.Response) error {\n@@ -2675,13 +2689,31 @@ func TestProperAuthing(t *testing.T) {\n \t_, err = client.Logical().WriteWithContext(ctx, \"ssh/roles/test-ca\", map[string]interface{}{\n \t\t\"key_type\":                \"ca\",\n \t\t\"allow_user_certificates\": true,\n+\t\t\"allowed_users\":           \"*\",\n \t})\n \tif err != nil {\n \t\tt.Fatal(err)\n \t}\n \n \t_, err = client.Logical().WriteWithContext(ctx, \"ssh/issue/test-ca\", map[string]interface{}{\n-\t\t\"username\": \"toor\",\n+\t\t\"valid_principals\": \"toor\",\n+\t})\n+\tif err != nil {\n+\t\tt.Fatal(err)\n+\t}\n+\n+\t_, err = client.Logical().WriteWithContext(ctx, \"ssh/roles/test-ca-empty\", map[string]interface{}{\n+\t\t\"key_type\":                \"ca\",\n+\t\t\"allow_host_certificates\": true,\n+\t\t\"allow_empty_principals\":  true,\n+\t})\n+\tif err != nil {\n+\t\tt.Fatal(err)\n+\t}\n+\n+\t_, err = client.Logical().WriteWithContext(ctx, \"ssh/issue/test-ca-empty\", map[string]interface{}{\n+\t\t\"cert_type\": \"host\",\n+\t\t\"key_type\":  \"ssh-ed25519\",\n \t})\n \tif err != nil {\n \t\tt.Fatal(err)"
            },
            {
                "sha": "21e549a06ce7fd4b15bc53be100995d2a4ae9c44",
                "filename": "builtin/logical/ssh/path_config_ca_test.go",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/openbao/openbao/blob/d5b4e922469830ac335b21dc0e8f9878c501a884/builtin%2Flogical%2Fssh%2Fpath_config_ca_test.go",
                "raw_url": "https://github.com/openbao/openbao/raw/d5b4e922469830ac335b21dc0e8f9878c501a884/builtin%2Flogical%2Fssh%2Fpath_config_ca_test.go",
                "contents_url": "https://api.github.com/repos/openbao/openbao/contents/builtin%2Flogical%2Fssh%2Fpath_config_ca_test.go?ref=d5b4e922469830ac335b21dc0e8f9878c501a884",
                "patch": "@@ -201,7 +201,8 @@ func createDeleteHelper(t *testing.T, b logical.Backend, config *logical.Backend\n \t}\n \n \tissueOptions := map[string]interface{}{\n-\t\t\"public_key\": testCAPublicKeyEd25519,\n+\t\t\"public_key\":       testCAPublicKeyEd25519,\n+\t\t\"valid_principals\": \"toor\",\n \t}\n \tissueReq := &logical.Request{\n \t\tPath:      \"sign/ca-issuance\","
            },
            {
                "sha": "8afcf3c57cc8a20c6ed7abd57f547a396c459722",
                "filename": "builtin/logical/ssh/path_issue_sign.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/openbao/openbao/blob/d5b4e922469830ac335b21dc0e8f9878c501a884/builtin%2Flogical%2Fssh%2Fpath_issue_sign.go",
                "raw_url": "https://github.com/openbao/openbao/raw/d5b4e922469830ac335b21dc0e8f9878c501a884/builtin%2Flogical%2Fssh%2Fpath_issue_sign.go",
                "contents_url": "https://api.github.com/repos/openbao/openbao/contents/builtin%2Flogical%2Fssh%2Fpath_issue_sign.go?ref=d5b4e922469830ac335b21dc0e8f9878c501a884",
                "patch": "@@ -191,6 +191,10 @@ func (b *backend) calculateValidPrincipals(data *framework.FieldData, req *logic\n \n \tswitch {\n \tcase len(parsedPrincipals) == 0:\n+\t\tif !role.AllowEmptyPrincipals && principalsAllowedByRole != \"*\" {\n+\t\t\treturn nil, fmt.Errorf(\"refusing to issue unsafe, globally-valid certificate with no principals specified; set valid_principals or default_user\")\n+\t\t}\n+\n \t\t// There is nothing to process\n \t\treturn nil, nil\n \tcase len(allowedPrincipals) == 0:"
            },
            {
                "sha": "900ad6a9c58d26d37aa88d87c29df5ae359df9d7",
                "filename": "builtin/logical/ssh/path_roles.go",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/openbao/openbao/blob/d5b4e922469830ac335b21dc0e8f9878c501a884/builtin%2Flogical%2Fssh%2Fpath_roles.go",
                "raw_url": "https://github.com/openbao/openbao/raw/d5b4e922469830ac335b21dc0e8f9878c501a884/builtin%2Flogical%2Fssh%2Fpath_roles.go",
                "contents_url": "https://api.github.com/repos/openbao/openbao/contents/builtin%2Flogical%2Fssh%2Fpath_roles.go?ref=d5b4e922469830ac335b21dc0e8f9878c501a884",
                "patch": "@@ -60,6 +60,7 @@ type sshRole struct {\n \tAllowBareDomains           bool              `mapstructure:\"allow_bare_domains\" json:\"allow_bare_domains\"`\n \tAllowSubdomains            bool              `mapstructure:\"allow_subdomains\" json:\"allow_subdomains\"`\n \tAllowUserKeyIDs            bool              `mapstructure:\"allow_user_key_ids\" json:\"allow_user_key_ids\"`\n+\tAllowEmptyPrincipals       bool              `mapstructure:\"allow_empty_principals\" json:\"allow_empty_principals\"`\n \tKeyIDFormat                string            `mapstructure:\"key_id_format\" json:\"key_id_format\"`\n \tOldAllowedUserKeyLengths   map[string]int    `mapstructure:\"allowed_user_key_lengths\" json:\"allowed_user_key_lengths,omitempty\"`\n \tAllowedUserKeyTypesLengths map[string][]int  `mapstructure:\"allowed_user_key_types_lengths\" json:\"allowed_user_key_types_lengths\"`\n@@ -374,6 +375,23 @@ func pathRoles(b *backend) *framework.Path {\n \t\t\t\t\tValue: 30,\n \t\t\t\t},\n \t\t\t},\n+\t\t\t\"allow_empty_principals\": {\n+\t\t\t\tType: framework.TypeBool,\n+\t\t\t\tDescription: `\n+                [Optional for CA type]\n+\t\t\t\tIf true, host and user certificates can be issued without any valid principals. For\n+\t\t\t\thost certificates, this means that any domain a host claims to be will be trusted by\n+\t\t\t\tthe connecting client. For user certificates, when a CA certificate is placed in a\n+\t\t\t\tuser's AuthorizedKeys file, any principal on that certificate will be allowed to\n+\t\t\t\tconnect. When allowed_users or allowed_domains is set to * (corresponding to the\n+\t\t\t\trole/certificate type), allow_empty_principals=false still permits issuance.\n+\n+\t\t\t\tIt is recommend to leave this disabled.\n+                `,\n+\t\t\t\tDisplayAttrs: &framework.DisplayAttributes{\n+\t\t\t\t\tName: \"Allow User Key IDs\",\n+\t\t\t\t},\n+\t\t\t},\n \t\t},\n \n \t\tCallbacks: map[logical.Operation]framework.OperationFunc{\n@@ -504,6 +522,7 @@ func (b *backend) createCARole(allowedUsers, defaultUser, signer string, data *f\n \t\tAllowBareDomains:          data.Get(\"allow_bare_domains\").(bool),\n \t\tAllowSubdomains:           data.Get(\"allow_subdomains\").(bool),\n \t\tAllowUserKeyIDs:           data.Get(\"allow_user_key_ids\").(bool),\n+\t\tAllowEmptyPrincipals:      data.Get(\"allow_empty_principals\").(bool),\n \t\tDefaultExtensionsTemplate: data.Get(\"default_extensions_template\").(bool),\n \t\tKeyIDFormat:               data.Get(\"key_id_format\").(string),\n \t\tKeyType:                   KeyTypeCA,\n@@ -694,6 +713,7 @@ func (b *backend) parseRole(role *sshRole) (map[string]interface{}, error) {\n \t\t\t\"allow_bare_domains\":          role.AllowBareDomains,\n \t\t\t\"allow_subdomains\":            role.AllowSubdomains,\n \t\t\t\"allow_user_key_ids\":          role.AllowUserKeyIDs,\n+\t\t\t\"allow_empty_principals\":      role.AllowEmptyPrincipals,\n \t\t\t\"key_id_format\":               role.KeyIDFormat,\n \t\t\t\"key_type\":                    role.KeyType,\n \t\t\t\"default_critical_options\":    role.DefaultCriticalOptions,"
            },
            {
                "sha": "05e5f6cc4824b65e33e211239d78a2dded8e4e76",
                "filename": "changelog/561.txt",
                "status": "added",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/openbao/openbao/blob/d5b4e922469830ac335b21dc0e8f9878c501a884/changelog%2F561.txt",
                "raw_url": "https://github.com/openbao/openbao/raw/d5b4e922469830ac335b21dc0e8f9878c501a884/changelog%2F561.txt",
                "contents_url": "https://api.github.com/repos/openbao/openbao/contents/changelog%2F561.txt?ref=d5b4e922469830ac335b21dc0e8f9878c501a884",
                "patch": "@@ -0,0 +1,3 @@\n+```release-note:security\n+secrets/ssh: Deny globally valid certificate issuance without valid_principals or allow_empty_principals override. HCSEC-2024-20 / CVE-2024-7594. (**potentially breaking**)\n+```"
            },
            {
                "sha": "1eeab7aa5ec8845bc846201d5459fcf48c2c11cf",
                "filename": "website/content/api-docs/secret/ssh.mdx",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/openbao/openbao/blob/d5b4e922469830ac335b21dc0e8f9878c501a884/website%2Fcontent%2Fapi-docs%2Fsecret%2Fssh.mdx",
                "raw_url": "https://github.com/openbao/openbao/raw/d5b4e922469830ac335b21dc0e8f9878c501a884/website%2Fcontent%2Fapi-docs%2Fsecret%2Fssh.mdx",
                "contents_url": "https://api.github.com/repos/openbao/openbao/contents/website%2Fcontent%2Fapi-docs%2Fsecret%2Fssh.mdx?ref=d5b4e922469830ac335b21dc0e8f9878c501a884",
                "patch": "@@ -202,6 +202,15 @@ This endpoint creates or updates a named role.\n - `not_before_duration` `(duration: \"30s\")` \u2013\u00a0Specifies the duration by which to\n   backdate the `ValidAfter` property. Uses [duration format strings](/docs/concepts/duration-format).\n \n+- `allow_empty_principals` `(bool: false)` \u2013 If true, host and user\n+certificates can be issued without any valid principals. For host\n+certificates, this means that any domain a host claims to be will be trusted\n+by the connecting client. For user certificates, when a CA certificate is\n+placed in a user's AuthorizedKeys file, any principal on that certificate\n+will be allowed to connect. When `allowed_users` or `allowed_domains` is set\n+to `*` (corresponding to the role/certificate type),\n+`allow_empty_principals=false` still permits issuance.\n+\n ### Sample payload\n \n ```json"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/badges/shields/commits/ec1b6c8daccda075403c1688ac02603f7aaa50b2",
        "url": "https://api.github.com/repos/badges/shields/commits/ec1b6c8daccda075403c1688ac02603f7aaa50b2",
        "html_url": "https://github.com/badges/shields/commit/ec1b6c8daccda075403c1688ac02603f7aaa50b2",
        "message": "[dynamicjson dynamicyaml dynamictoml] switch to jsonpath-plus (#10551)",
        "files": [
            {
                "sha": "d5bdb4e4be31175ebb0e08d6e58e11963004dabe",
                "filename": "package-lock.json",
                "status": "modified",
                "additions": 51,
                "deletions": 132,
                "changes": 183,
                "blob_url": "https://github.com/badges/shields/blob/ec1b6c8daccda075403c1688ac02603f7aaa50b2/package-lock.json",
                "raw_url": "https://github.com/badges/shields/raw/ec1b6c8daccda075403c1688ac02603f7aaa50b2/package-lock.json",
                "contents_url": "https://api.github.com/repos/badges/shields/contents/package-lock.json?ref=ec1b6c8daccda075403c1688ac02603f7aaa50b2",
                "patch": "@@ -35,7 +35,7 @@\n         \"joi\": \"17.13.3\",\n         \"joi-extension-semver\": \"5.0.0\",\n         \"js-yaml\": \"^4.1.0\",\n-        \"jsonpath\": \"~1.1.1\",\n+        \"jsonpath-plus\": \"^9.0.0\",\n         \"lodash.countby\": \"^4.6.0\",\n         \"lodash.groupby\": \"^4.6.0\",\n         \"lodash.times\": \"^4.3.2\",\n@@ -3957,6 +3957,28 @@\n         \"node\": \">=v12.0.0\"\n       }\n     },\n+    \"node_modules/@jsep-plugin/assignment\": {\n+      \"version\": \"1.2.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@jsep-plugin/assignment/-/assignment-1.2.1.tgz\",\n+      \"integrity\": \"sha512-gaHqbubTi29aZpVbBlECRpmdia+L5/lh2BwtIJTmtxdbecEyyX/ejAOg7eQDGNvGOUmPY7Z2Yxdy9ioyH/VJeA==\",\n+      \"engines\": {\n+        \"node\": \">= 10.16.0\"\n+      },\n+      \"peerDependencies\": {\n+        \"jsep\": \"^0.4.0||^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@jsep-plugin/regex\": {\n+      \"version\": \"1.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/@jsep-plugin/regex/-/regex-1.0.3.tgz\",\n+      \"integrity\": \"sha512-XfZgry4DwEZvSFtS/6Y+R48D7qJYJK6R9/yJFyUFHCIUMEEHuJ4X95TDgJp5QkmzfLYvapMPzskV5HpIDrREug==\",\n+      \"engines\": {\n+        \"node\": \">= 10.16.0\"\n+      },\n+      \"peerDependencies\": {\n+        \"jsep\": \"^0.4.0||^1.0.0\"\n+      }\n+    },\n     \"node_modules/@leichtgewicht/ip-codec\": {\n       \"version\": \"2.0.4\",\n       \"resolved\": \"https://registry.npmjs.org/@leichtgewicht/ip-codec/-/ip-codec-2.0.4.tgz\",\n@@ -10233,7 +10255,8 @@\n     \"node_modules/deep-is\": {\n       \"version\": \"0.1.4\",\n       \"resolved\": \"https://registry.npmjs.org/deep-is/-/deep-is-0.1.4.tgz\",\n-      \"integrity\": \"sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==\"\n+      \"integrity\": \"sha512-oIPzksmTg4/MriiaYGO+okXDT7ztn/w3Eptv/+gSIdMdKsJo0u4CfYNFJPy+4SKMuCqGw2wxnA+URMg3t8a/bQ==\",\n+      \"dev\": true\n     },\n     \"node_modules/deepmerge\": {\n       \"version\": \"4.3.1\",\n@@ -11501,94 +11524,6 @@\n         \"url\": \"https://github.com/sponsors/sindresorhus\"\n       }\n     },\n-    \"node_modules/escodegen\": {\n-      \"version\": \"1.14.3\",\n-      \"resolved\": \"https://registry.npmjs.org/escodegen/-/escodegen-1.14.3.tgz\",\n-      \"integrity\": \"sha512-qFcX0XJkdg+PB3xjZZG/wKSuT1PnQWx57+TVSjIMmILd2yC/6ByYElPwJnslDsuWuSAp4AwJGumarAAmJch5Kw==\",\n-      \"dependencies\": {\n-        \"esprima\": \"^4.0.1\",\n-        \"estraverse\": \"^4.2.0\",\n-        \"esutils\": \"^2.0.2\",\n-        \"optionator\": \"^0.8.1\"\n-      },\n-      \"bin\": {\n-        \"escodegen\": \"bin/escodegen.js\",\n-        \"esgenerate\": \"bin/esgenerate.js\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=4.0\"\n-      },\n-      \"optionalDependencies\": {\n-        \"source-map\": \"~0.6.1\"\n-      }\n-    },\n-    \"node_modules/escodegen/node_modules/esprima\": {\n-      \"version\": \"4.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/esprima/-/esprima-4.0.1.tgz\",\n-      \"integrity\": \"sha512-eGuFFw7Upda+g4p+QHvnW0RyTX/SVeJBDM/gCtMARO0cLuT2HcEKnTPvhjV6aGeqrCB/sbNop0Kszm0jsaWU4A==\",\n-      \"bin\": {\n-        \"esparse\": \"bin/esparse.js\",\n-        \"esvalidate\": \"bin/esvalidate.js\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=4\"\n-      }\n-    },\n-    \"node_modules/escodegen/node_modules/estraverse\": {\n-      \"version\": \"4.3.0\",\n-      \"resolved\": \"https://registry.npmjs.org/estraverse/-/estraverse-4.3.0.tgz\",\n-      \"integrity\": \"sha512-39nnKffWz8xN1BU/2c79n9nB9HDzo0niYUqx6xyqUnyoAnQyyWpOTdZEeiCch8BBu515t4wp9ZmgVfVhn9EBpw==\",\n-      \"engines\": {\n-        \"node\": \">=4.0\"\n-      }\n-    },\n-    \"node_modules/escodegen/node_modules/levn\": {\n-      \"version\": \"0.3.0\",\n-      \"resolved\": \"https://registry.npmjs.org/levn/-/levn-0.3.0.tgz\",\n-      \"integrity\": \"sha512-0OO4y2iOHix2W6ujICbKIaEQXvFQHue65vUG3pb5EUomzPI90z9hsA1VsO/dbIIpC53J8gxM9Q4Oho0jrCM/yA==\",\n-      \"dependencies\": {\n-        \"prelude-ls\": \"~1.1.2\",\n-        \"type-check\": \"~0.3.2\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 0.8.0\"\n-      }\n-    },\n-    \"node_modules/escodegen/node_modules/optionator\": {\n-      \"version\": \"0.8.3\",\n-      \"resolved\": \"https://registry.npmjs.org/optionator/-/optionator-0.8.3.tgz\",\n-      \"integrity\": \"sha512-+IW9pACdk3XWmmTXG8m3upGUJst5XRGzxMRjXzAuJ1XnIFNvfhjjIuYkDvysnPQ7qzqVzLt78BCruntqRhWQbA==\",\n-      \"dependencies\": {\n-        \"deep-is\": \"~0.1.3\",\n-        \"fast-levenshtein\": \"~2.0.6\",\n-        \"levn\": \"~0.3.0\",\n-        \"prelude-ls\": \"~1.1.2\",\n-        \"type-check\": \"~0.3.2\",\n-        \"word-wrap\": \"~1.2.3\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 0.8.0\"\n-      }\n-    },\n-    \"node_modules/escodegen/node_modules/prelude-ls\": {\n-      \"version\": \"1.1.2\",\n-      \"resolved\": \"https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.1.2.tgz\",\n-      \"integrity\": \"sha512-ESF23V4SKG6lVSGZgYNpbsiaAkdab6ZgOxe52p7+Kid3W3u3bxR4Vfd/o21dmN7jSt0IwgZ4v5MUd26FEtXE9w==\",\n-      \"engines\": {\n-        \"node\": \">= 0.8.0\"\n-      }\n-    },\n-    \"node_modules/escodegen/node_modules/type-check\": {\n-      \"version\": \"0.3.2\",\n-      \"resolved\": \"https://registry.npmjs.org/type-check/-/type-check-0.3.2.tgz\",\n-      \"integrity\": \"sha512-ZCmOJdvOWDBYJlzAoFkC+Q0+bUyEOS1ltgp1MGU03fqHG+dbi9tBFU2Rd9QKiDZFAYrhPh2JUf7rZRIuHRKtOg==\",\n-      \"dependencies\": {\n-        \"prelude-ls\": \"~1.1.2\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 0.8.0\"\n-      }\n-    },\n     \"node_modules/eslint\": {\n       \"version\": \"8.57.1\",\n       \"resolved\": \"https://registry.npmjs.org/eslint/-/eslint-8.57.1.tgz\",\n@@ -12623,18 +12558,6 @@\n         \"url\": \"https://opencollective.com/eslint\"\n       }\n     },\n-    \"node_modules/esprima\": {\n-      \"version\": \"1.2.2\",\n-      \"resolved\": \"https://registry.npmjs.org/esprima/-/esprima-1.2.2.tgz\",\n-      \"integrity\": \"sha512-+JpPZam9w5DuJ3Q67SqsMGtiHKENSMRVoxvArfJZK01/BfLEObtZ6orJa/MtoGNR/rfMgp5837T41PAmTwAv/A==\",\n-      \"bin\": {\n-        \"esparse\": \"bin/esparse.js\",\n-        \"esvalidate\": \"bin/esvalidate.js\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=0.4.0\"\n-      }\n-    },\n     \"node_modules/esquery\": {\n       \"version\": \"1.6.0\",\n       \"resolved\": \"https://registry.npmjs.org/esquery/-/esquery-1.6.0.tgz\",\n@@ -12786,6 +12709,7 @@\n       \"version\": \"2.0.3\",\n       \"resolved\": \"https://registry.npmjs.org/esutils/-/esutils-2.0.3.tgz\",\n       \"integrity\": \"sha512-kVscqXk4OCp68SZ0dkgEKVi6/8ij300KBWTJq32P/dYeWTSwK41WyTxalN1eRmA5Z9UU/LX9D7FWSmV9SAYx6g==\",\n+      \"dev\": true,\n       \"engines\": {\n         \"node\": \">=0.10.0\"\n       }\n@@ -13107,7 +13031,8 @@\n     \"node_modules/fast-levenshtein\": {\n       \"version\": \"2.0.6\",\n       \"resolved\": \"https://registry.npmjs.org/fast-levenshtein/-/fast-levenshtein-2.0.6.tgz\",\n-      \"integrity\": \"sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==\"\n+      \"integrity\": \"sha512-DCXu6Ifhqcks7TZKY3Hxp3y6qphY5SJZmrWMDrKcERSOXWQdMhU9Ig/PYrzyw/ul9jOIyh0N4M0tbC5hodg8dw==\",\n+      \"dev\": true\n     },\n     \"node_modules/fast-safe-stringify\": {\n       \"version\": \"2.1.1\",\n@@ -16680,6 +16605,14 @@\n         \"node\": \">=8\"\n       }\n     },\n+    \"node_modules/jsep\": {\n+      \"version\": \"1.3.9\",\n+      \"resolved\": \"https://registry.npmjs.org/jsep/-/jsep-1.3.9.tgz\",\n+      \"integrity\": \"sha512-i1rBX5N7VPl0eYb6+mHNp52sEuaS2Wi8CDYx1X5sn9naevL78+265XJqy1qENEk7mRKwS06NHpUqiBwR7qeodw==\",\n+      \"engines\": {\n+        \"node\": \">= 10.16.0\"\n+      }\n+    },\n     \"node_modules/jsesc\": {\n       \"version\": \"2.5.2\",\n       \"resolved\": \"https://registry.npmjs.org/jsesc/-/jsesc-2.5.2.tgz\",\n@@ -16849,21 +16782,23 @@\n         \"graceful-fs\": \"^4.1.6\"\n       }\n     },\n-    \"node_modules/jsonpath\": {\n-      \"version\": \"1.1.1\",\n-      \"resolved\": \"https://registry.npmjs.org/jsonpath/-/jsonpath-1.1.1.tgz\",\n-      \"integrity\": \"sha512-l6Cg7jRpixfbgoWgkrl77dgEj8RPvND0wMH6TwQmi9Qs4TFfS9u5cUFnbeKTwj5ga5Y3BTGGNI28k117LJ009w==\",\n+    \"node_modules/jsonpath-plus\": {\n+      \"version\": \"9.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/jsonpath-plus/-/jsonpath-plus-9.0.0.tgz\",\n+      \"integrity\": \"sha512-bqE77VIDStrOTV/czspZhTn+o27Xx9ZJRGVkdVShEtPoqsIx5yALv3lWVU6y+PqYvWPJNWE7ORCQheQkEe0DDA==\",\n       \"dependencies\": {\n-        \"esprima\": \"1.2.2\",\n-        \"static-eval\": \"2.0.2\",\n-        \"underscore\": \"1.12.1\"\n+        \"@jsep-plugin/assignment\": \"^1.2.1\",\n+        \"@jsep-plugin/regex\": \"^1.0.3\",\n+        \"jsep\": \"^1.3.8\"\n+      },\n+      \"bin\": {\n+        \"jsonpath\": \"bin/jsonpath-cli.js\",\n+        \"jsonpath-plus\": \"bin/jsonpath-cli.js\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=14.0.0\"\n       }\n     },\n-    \"node_modules/jsonpath/node_modules/underscore\": {\n-      \"version\": \"1.12.1\",\n-      \"resolved\": \"https://registry.npmjs.org/underscore/-/underscore-1.12.1.tgz\",\n-      \"integrity\": \"sha512-hEQt0+ZLDVUMhebKxL4x1BTtDY7bavVofhZ9KZ4aI26X9SRaE+Y3m83XUL1UP2jn8ynjndwCCpEHdUG+9pP1Tw==\"\n-    },\n     \"node_modules/jsonpointer\": {\n       \"version\": \"5.0.1\",\n       \"resolved\": \"https://registry.npmjs.org/jsonpointer/-/jsonpointer-5.0.1.tgz\",\n@@ -27365,7 +27300,7 @@\n       \"version\": \"0.6.1\",\n       \"resolved\": \"https://registry.npmjs.org/source-map/-/source-map-0.6.1.tgz\",\n       \"integrity\": \"sha512-UjgapumWlbMhkBgzT7Ykc5YXUT46F0iKu8SGXq0bcwP5dz/h0Plj6enJqjz1Zbq2l5WaqYnrVbwWOWMyF3F47g==\",\n-      \"devOptional\": true,\n+      \"dev\": true,\n       \"engines\": {\n         \"node\": \">=0.10.0\"\n       }\n@@ -27658,14 +27593,6 @@\n       \"integrity\": \"sha512-HTEHMNieakEnoe33shBYcZ7NX83ACUjCu8c40iOGEZsngj9zRnkqS9j1pqQPXwobB0ZcVTk27REb7COQ0UR59w==\",\n       \"dev\": true\n     },\n-    \"node_modules/static-eval\": {\n-      \"version\": \"2.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/static-eval/-/static-eval-2.0.2.tgz\",\n-      \"integrity\": \"sha512-N/D219Hcr2bPjLxPiV+TQE++Tsmrady7TqAJugLy7Xk1EumfDWS/f5dtBbkRCGE7wKKXuYockQoj8Rm2/pVKyg==\",\n-      \"dependencies\": {\n-        \"escodegen\": \"^1.8.1\"\n-      }\n-    },\n     \"node_modules/statuses\": {\n       \"version\": \"2.0.1\",\n       \"resolved\": \"https://registry.npmjs.org/statuses/-/statuses-2.0.1.tgz\",\n@@ -30532,14 +30459,6 @@\n       \"integrity\": \"sha512-CC1bOL87PIWSBhDcTrdeLo6eGT7mCFtrg0uIJtqJUFyK+eJnzl8A1niH56uu7KMa5XFrtiV+AQuHO3n7DsHnLQ==\",\n       \"dev\": true\n     },\n-    \"node_modules/word-wrap\": {\n-      \"version\": \"1.2.5\",\n-      \"resolved\": \"https://registry.npmjs.org/word-wrap/-/word-wrap-1.2.5.tgz\",\n-      \"integrity\": \"sha512-BN22B5eaMMI9UMtjrGd5g5eCYPpCPDUy0FJXbYsaT5zYxjFOckS53SQDE3pWkVoWpHXVb3BrYcEN4Twa55B5cA==\",\n-      \"engines\": {\n-        \"node\": \">=0.10.0\"\n-      }\n-    },\n     \"node_modules/workerpool\": {\n       \"version\": \"6.5.1\",\n       \"resolved\": \"https://registry.npmjs.org/workerpool/-/workerpool-6.5.1.tgz\","
            },
            {
                "sha": "2aa32b812ce6e4552c951c886f697b25ee531d66",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/badges/shields/blob/ec1b6c8daccda075403c1688ac02603f7aaa50b2/package.json",
                "raw_url": "https://github.com/badges/shields/raw/ec1b6c8daccda075403c1688ac02603f7aaa50b2/package.json",
                "contents_url": "https://api.github.com/repos/badges/shields/contents/package.json?ref=ec1b6c8daccda075403c1688ac02603f7aaa50b2",
                "patch": "@@ -47,7 +47,7 @@\n     \"joi\": \"17.13.3\",\n     \"joi-extension-semver\": \"5.0.0\",\n     \"js-yaml\": \"^4.1.0\",\n-    \"jsonpath\": \"~1.1.1\",\n+    \"jsonpath-plus\": \"^9.0.0\",\n     \"lodash.countby\": \"^4.6.0\",\n     \"lodash.groupby\": \"^4.6.0\",\n     \"lodash.times\": \"^4.3.2\","
            },
            {
                "sha": "fbc32c3e8344441122f0f8e1d69a3927a78726a7",
                "filename": "services/dynamic/dynamic-json.tester.js",
                "status": "modified",
                "additions": 23,
                "deletions": 8,
                "changes": 31,
                "blob_url": "https://github.com/badges/shields/blob/ec1b6c8daccda075403c1688ac02603f7aaa50b2/services%2Fdynamic%2Fdynamic-json.tester.js",
                "raw_url": "https://github.com/badges/shields/raw/ec1b6c8daccda075403c1688ac02603f7aaa50b2/services%2Fdynamic%2Fdynamic-json.tester.js",
                "contents_url": "https://api.github.com/repos/badges/shields/contents/services%2Fdynamic%2Fdynamic-json.tester.js?ref=ec1b6c8daccda075403c1688ac02603f7aaa50b2",
                "patch": "@@ -145,8 +145,8 @@ t.create('query with lexical error')\n   )\n   .expectBadge({\n     label: 'custom badge',\n-    message: 'unparseable jsonpath query',\n-    color: 'red',\n+    message: 'no result',\n+    color: 'lightgrey',\n   })\n \n t.create('query with parse error')\n@@ -155,8 +155,8 @@ t.create('query with parse error')\n   )\n   .expectBadge({\n     label: 'custom badge',\n-    message: 'unparseable jsonpath query',\n-    color: 'red',\n+    message: 'no result',\n+    color: 'lightgrey',\n   })\n \n // Example from https://stackoverflow.com/q/11670384/893113\n@@ -170,7 +170,23 @@ t.create('query with invalid token')\n   )\n   .expectBadge({\n     label: 'custom badge',\n-    message: 'unparseable jsonpath query',\n+    message: 'query not supported',\n+    color: 'red',\n+  })\n+\n+/*\n+Based on https://github.com/JSONPath-Plus/JSONPath/blob/v9.0.0/test/test.errors.js#L53-L68\n+This functionality is disabled for security reasons.\n+*/\n+t.create('query with eval filtering expression')\n+  .get(\n+    `.json?url=https://github.com/badges/shields/raw/master/package.json&query=${encodeURIComponent(\n+      '$..keywords[(@.length-1)]',\n+    )}`,\n+  )\n+  .expectBadge({\n+    label: 'custom badge',\n+    message: 'query not supported',\n     color: 'red',\n   })\n \n@@ -185,12 +201,11 @@ t.create('JSON contains an array')\n   })\n \n t.create('JSON contains a string')\n-  .get('.json?url=https://example.test/json&query=$.foo,')\n+  .get('.json?url=https://example.test/json&query=$')\n   .intercept(nock =>\n     nock('https://example.test').get('/json').reply(200, '\"foo\"'),\n   )\n   .expectBadge({\n     label: 'custom badge',\n-    message: 'resource must contain an object or array',\n-    color: 'lightgrey',\n+    message: 'foo',\n   })"
            },
            {
                "sha": "5a93004a42ee06b52acf4755ccffa74d3cf50140",
                "filename": "services/dynamic/dynamic-yaml.tester.js",
                "status": "modified",
                "additions": 2,
                "deletions": 3,
                "changes": 5,
                "blob_url": "https://github.com/badges/shields/blob/ec1b6c8daccda075403c1688ac02603f7aaa50b2/services%2Fdynamic%2Fdynamic-yaml.tester.js",
                "raw_url": "https://github.com/badges/shields/raw/ec1b6c8daccda075403c1688ac02603f7aaa50b2/services%2Fdynamic%2Fdynamic-yaml.tester.js",
                "contents_url": "https://api.github.com/repos/badges/shields/contents/services%2Fdynamic%2Fdynamic-yaml.tester.js?ref=ec1b6c8daccda075403c1688ac02603f7aaa50b2",
                "patch": "@@ -102,12 +102,11 @@ t.create('YAML from url | error color overrides user specified')\n   })\n \n t.create('YAML contains a string')\n-  .get('.json?url=https://example.test/yaml&query=$.foo,')\n+  .get('.json?url=https://example.test/yaml&query=$,')\n   .intercept(nock =>\n     nock('https://example.test').get('/yaml').reply(200, '\"foo\"'),\n   )\n   .expectBadge({\n     label: 'custom badge',\n-    message: 'resource must contain an object or array',\n-    color: 'lightgrey',\n+    message: 'foo',\n   })"
            },
            {
                "sha": "62d778c692adf3c59d77e1d88be5fc208a1f706a",
                "filename": "services/dynamic/json-path.js",
                "status": "modified",
                "additions": 4,
                "deletions": 16,
                "changes": 20,
                "blob_url": "https://github.com/badges/shields/blob/ec1b6c8daccda075403c1688ac02603f7aaa50b2/services%2Fdynamic%2Fjson-path.js",
                "raw_url": "https://github.com/badges/shields/raw/ec1b6c8daccda075403c1688ac02603f7aaa50b2/services%2Fdynamic%2Fjson-path.js",
                "contents_url": "https://api.github.com/repos/badges/shields/contents/services%2Fdynamic%2Fjson-path.js?ref=ec1b6c8daccda075403c1688ac02603f7aaa50b2",
                "patch": "@@ -3,7 +3,7 @@\n  */\n \n import Joi from 'joi'\n-import jp from 'jsonpath'\n+import { JSONPath as jp } from 'jsonpath-plus'\n import { renderDynamicBadge, httpErrors } from '../dynamic-common.js'\n import { InvalidParameter, InvalidResponse } from '../index.js'\n \n@@ -43,26 +43,14 @@ export default superclass =>\n         httpErrors,\n       })\n \n-      // JSONPath only works on objects and arrays.\n-      // https://github.com/badges/shields/issues/4018\n-      if (typeof data !== 'object') {\n-        throw new InvalidResponse({\n-          prettyMessage: 'resource must contain an object or array',\n-        })\n-      }\n-\n       let values\n       try {\n-        values = jp.query(data, pathExpression)\n+        values = jp({ json: data, path: pathExpression, eval: false })\n       } catch (e) {\n         const { message } = e\n-        if (\n-          message.startsWith('Lexical error') ||\n-          message.startsWith('Parse error') ||\n-          message.includes('Unexpected token')\n-        ) {\n+        if (message.includes('prevented in JSONPath expression')) {\n           throw new InvalidParameter({\n-            prettyMessage: 'unparseable jsonpath query',\n+            prettyMessage: 'query not supported',\n           })\n         } else {\n           throw e"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/NixOS/nix/commits/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90",
        "url": "https://api.github.com/repos/NixOS/nix/commits/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90",
        "html_url": "https://github.com/NixOS/nix/commit/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90",
        "message": "Merge pull request #11585 from NixOS/verify-tls\n\nbuiltin:fetchurl: Enable TLS verification",
        "files": [
            {
                "sha": "489941d5bc4dd88ff1313acd4dfdb99045ac6449",
                "filename": "doc/manual/rl-next/verify-tls.md",
                "status": "added",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/NixOS/nix/blob/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90/doc%2Fmanual%2Frl-next%2Fverify-tls.md",
                "raw_url": "https://github.com/NixOS/nix/raw/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90/doc%2Fmanual%2Frl-next%2Fverify-tls.md",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/doc%2Fmanual%2Frl-next%2Fverify-tls.md?ref=062b4a489e30da9c85fa4ff15cfdd2e51cac7b90",
                "patch": "@@ -0,0 +1,8 @@\n+---\n+synopsis: \"`<nix/fetchurl.nix>` uses TLS verification\"\n+prs: [11585]\n+---\n+\n+Previously `<nix/fetchurl.nix>` did not do TLS verification. This was because the Nix sandbox in the past did not have access to TLS certificates, and Nix checks the hash of the fetched file anyway. However, this can expose authentication data from `netrc` and URLs to man-in-the-middle attackers. In addition, Nix now in some cases (such as when using impure derivations) does *not* check the hash. Therefore we have now enabled TLS verification. This means that downloads by `<nix/fetchurl.nix>` will now fail if you're fetching from a HTTPS server that does not have a valid certificate.\n+\n+`<nix/fetchurl.nix>` is also known as the builtin derivation builder `builtin:fetchurl`. It's not to be confused with the evaluation-time function `builtins.fetchurl`, which was not affected by this issues."
            },
            {
                "sha": "f33060c3307ebacc2604a356f82696e22991de0a",
                "filename": "src/libstore/builtins/fetchurl.cc",
                "status": "modified",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/NixOS/nix/blob/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90/src%2Flibstore%2Fbuiltins%2Ffetchurl.cc",
                "raw_url": "https://github.com/NixOS/nix/raw/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90/src%2Flibstore%2Fbuiltins%2Ffetchurl.cc",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/src%2Flibstore%2Fbuiltins%2Ffetchurl.cc?ref=062b4a489e30da9c85fa4ff15cfdd2e51cac7b90",
                "patch": "@@ -38,10 +38,7 @@ void builtinFetchurl(\n \n         auto source = sinkToSource([&](Sink & sink) {\n \n-            /* No need to do TLS verification, because we check the hash of\n-               the result anyway. */\n             FileTransferRequest request(url);\n-            request.verifyTLS = false;\n             request.decompress = false;\n \n             auto decompressor = makeDecompressionSink("
            },
            {
                "sha": "c61a2888f3ec90bf1460a07accc4eaadd29c4198",
                "filename": "tests/nixos/default.nix",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/NixOS/nix/blob/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90/tests%2Fnixos%2Fdefault.nix",
                "raw_url": "https://github.com/NixOS/nix/raw/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90/tests%2Fnixos%2Fdefault.nix",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/tests%2Fnixos%2Fdefault.nix?ref=062b4a489e30da9c85fa4ff15cfdd2e51cac7b90",
                "patch": "@@ -159,4 +159,6 @@ in\n   fsync = runNixOSTestFor \"x86_64-linux\" ./fsync.nix;\n \n   cgroups = runNixOSTestFor \"x86_64-linux\" ./cgroups;\n+\n+  fetchurl = runNixOSTestFor \"x86_64-linux\" ./fetchurl.nix;\n }"
            },
            {
                "sha": "476f779bcc3ed202b4e2a1e3137fcaca8784a43f",
                "filename": "tests/nixos/fetchurl.nix",
                "status": "added",
                "additions": 78,
                "deletions": 0,
                "changes": 78,
                "blob_url": "https://github.com/NixOS/nix/blob/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90/tests%2Fnixos%2Ffetchurl.nix",
                "raw_url": "https://github.com/NixOS/nix/raw/062b4a489e30da9c85fa4ff15cfdd2e51cac7b90/tests%2Fnixos%2Ffetchurl.nix",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/tests%2Fnixos%2Ffetchurl.nix?ref=062b4a489e30da9c85fa4ff15cfdd2e51cac7b90",
                "patch": "@@ -0,0 +1,78 @@\n+# Test whether builtin:fetchurl properly performs TLS certificate\n+# checks on HTTPS servers.\n+\n+{ lib, config, pkgs, ... }:\n+\n+let\n+\n+  makeTlsCert = name: pkgs.runCommand name {\n+    nativeBuildInputs = with pkgs; [ openssl ];\n+  } ''\n+    mkdir -p $out\n+    openssl req -x509 \\\n+      -subj '/CN=${name}/' -days 49710 \\\n+      -addext 'subjectAltName = DNS:${name}' \\\n+      -keyout \"$out/key.pem\" -newkey ed25519 \\\n+      -out \"$out/cert.pem\" -noenc\n+  '';\n+\n+  goodCert = makeTlsCert \"good\";\n+  badCert = makeTlsCert \"bad\";\n+\n+in\n+\n+{\n+  name = \"nss-preload\";\n+\n+  nodes = {\n+    machine = { lib, pkgs, ... }: {\n+      services.nginx = {\n+        enable = true;\n+\n+        virtualHosts.\"good\" = {\n+          addSSL = true;\n+          sslCertificate = \"${goodCert}/cert.pem\";\n+          sslCertificateKey = \"${goodCert}/key.pem\";\n+          root = pkgs.runCommand \"nginx-root\" {} ''\n+            mkdir \"$out\"\n+            echo 'hello world' > \"$out/index.html\"\n+          '';\n+        };\n+\n+        virtualHosts.\"bad\" = {\n+          addSSL = true;\n+          sslCertificate = \"${badCert}/cert.pem\";\n+          sslCertificateKey = \"${badCert}/key.pem\";\n+          root = pkgs.runCommand \"nginx-root\" {} ''\n+            mkdir \"$out\"\n+            echo 'foobar' > \"$out/index.html\"\n+          '';\n+        };\n+      };\n+\n+      security.pki.certificateFiles = [ \"${goodCert}/cert.pem\" ];\n+\n+      networking.hosts.\"127.0.0.1\" = [ \"good\" \"bad\" ];\n+\n+      virtualisation.writableStore = true;\n+\n+      nix.settings.experimental-features = \"nix-command\";\n+    };\n+  };\n+\n+  testScript = { nodes, ... }: ''\n+    machine.wait_for_unit(\"nginx\")\n+    machine.wait_for_open_port(443)\n+\n+    out = machine.succeed(\"curl https://good/index.html\")\n+    assert out == \"hello world\\n\"\n+\n+    # Fetching from a server with a trusted cert should work.\n+    machine.succeed(\"nix build --no-substitute --expr 'import <nix/fetchurl.nix> { url = \\\"https://good/index.html\\\"; hash = \\\"sha256-qUiQTy8PR5uPgZdpSzAYSw0u0cHNKh7A+4XSmaGSpEc=\\\"; }'\")\n+\n+    # Fetching from a server with an untrusted cert should fail.\n+    err = machine.fail(\"nix build --no-substitute --expr 'import <nix/fetchurl.nix> { url = \\\"https://bad/index.html\\\"; hash = \\\"sha256-rsBwZF/lPuOzdjBZN2E08FjMM3JHyXit0Xi2zN+wAZ8=\\\"; }' 2>&1\")\n+    print(err)\n+    assert \"SSL certificate problem: self-signed certificate\" in err\n+  '';\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/NixOS/nix/commits/5db358d4d78aea7204a8f22c5bf2a309267ee038",
        "url": "https://api.github.com/repos/NixOS/nix/commits/5db358d4d78aea7204a8f22c5bf2a309267ee038",
        "html_url": "https://github.com/NixOS/nix/commit/5db358d4d78aea7204a8f22c5bf2a309267ee038",
        "message": "Disable TLS verification for builtin fetchurl\n\nThis makes it consistent with the Nixpkgs fetchurl and makes it work\nin chroots. We don't need verification because the hash of the result\nis checked anyway.",
        "files": [
            {
                "sha": "091a67428e4c383e3256019c0200b3f6a7197bac",
                "filename": "src/libstore/builtins.cc",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/NixOS/nix/blob/5db358d4d78aea7204a8f22c5bf2a309267ee038/src%2Flibstore%2Fbuiltins.cc",
                "raw_url": "https://github.com/NixOS/nix/raw/5db358d4d78aea7204a8f22c5bf2a309267ee038/src%2Flibstore%2Fbuiltins.cc",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/src%2Flibstore%2Fbuiltins.cc?ref=5db358d4d78aea7204a8f22c5bf2a309267ee038",
                "patch": "@@ -8,7 +8,13 @@ void builtinFetchurl(const BasicDerivation & drv)\n     auto url = drv.env.find(\"url\");\n     if (url == drv.env.end()) throw Error(\"attribute \u2018url\u2019 missing\");\n     printMsg(lvlInfo, format(\"downloading \u2018%1%\u2019...\") % url->second);\n-    auto data = downloadFile(url->second); // FIXME: show progress\n+\n+    /* No need to do TLS verification, because we check the hash of\n+       the result anyway. */\n+    DownloadOptions options;\n+    options.verifyTLS = false;\n+\n+    auto data = downloadFile(url->second, options); // FIXME: show progress\n \n     auto out = drv.env.find(\"out\");\n     if (out == drv.env.end()) throw Error(\"attribute \u2018url\u2019 missing\");"
            },
            {
                "sha": "8ef3ab3f0b623541c043ede0608a375f71f28c16",
                "filename": "src/libstore/download.cc",
                "status": "modified",
                "additions": 17,
                "deletions": 9,
                "changes": 26,
                "blob_url": "https://github.com/NixOS/nix/blob/5db358d4d78aea7204a8f22c5bf2a309267ee038/src%2Flibstore%2Fdownload.cc",
                "raw_url": "https://github.com/NixOS/nix/raw/5db358d4d78aea7204a8f22c5bf2a309267ee038/src%2Flibstore%2Fdownload.cc",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/src%2Flibstore%2Fdownload.cc?ref=5db358d4d78aea7204a8f22c5bf2a309267ee038",
                "patch": "@@ -102,7 +102,6 @@ struct Curl\n         if (!curl) throw Error(\"unable to initialize curl\");\n \n         curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);\n-        curl_easy_setopt(curl, CURLOPT_CAINFO, getEnv(\"SSL_CERT_FILE\", \"/etc/ssl/certs/ca-certificates.crt\").c_str());\n         curl_easy_setopt(curl, CURLOPT_USERAGENT, (\"Nix/\" + nixVersion).c_str());\n         curl_easy_setopt(curl, CURLOPT_FAILONERROR, 1);\n \n@@ -125,20 +124,27 @@ struct Curl\n         if (requestHeaders) curl_slist_free_all(requestHeaders);\n     }\n \n-    bool fetch(const string & url, const string & expectedETag = \"\")\n+    bool fetch(const string & url, const DownloadOptions & options)\n     {\n         curl_easy_setopt(curl, CURLOPT_URL, url.c_str());\n \n+        if (options.verifyTLS)\n+            curl_easy_setopt(curl, CURLOPT_CAINFO, getEnv(\"SSL_CERT_FILE\", \"/etc/ssl/certs/ca-certificates.crt\").c_str());\n+        else {\n+            curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 0);\n+            curl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 0);\n+        }\n+\n         data.clear();\n \n         if (requestHeaders) {\n             curl_slist_free_all(requestHeaders);\n             requestHeaders = 0;\n         }\n \n-        if (!expectedETag.empty()) {\n-            this->expectedETag = expectedETag;\n-            requestHeaders = curl_slist_append(requestHeaders, (\"If-None-Match: \" + expectedETag).c_str());\n+        if (!options.expectedETag.empty()) {\n+            this->expectedETag = options.expectedETag;\n+            requestHeaders = curl_slist_append(requestHeaders, (\"If-None-Match: \" + options.expectedETag).c_str());\n         }\n \n         curl_easy_setopt(curl, CURLOPT_HTTPHEADER, requestHeaders);\n@@ -154,7 +160,7 @@ struct Curl\n             //std::cerr << \"\\e[\" << moveBack << \"D\\e[K\\n\";\n             std::cerr << \"\\n\";\n         checkInterrupt();\n-        if (res == CURLE_WRITE_ERROR && etag == expectedETag) return false;\n+        if (res == CURLE_WRITE_ERROR && etag == options.expectedETag) return false;\n         if (res != CURLE_OK)\n             throw DownloadError(format(\"unable to download \u2018%1%\u2019: %2% (%3%)\")\n                 % url % curl_easy_strerror(res) % res);\n@@ -168,11 +174,11 @@ struct Curl\n };\n \n \n-DownloadResult downloadFile(string url, string expectedETag)\n+DownloadResult downloadFile(string url, const DownloadOptions & options)\n {\n     DownloadResult res;\n     Curl curl;\n-    if (curl.fetch(url, expectedETag)) {\n+    if (curl.fetch(url, options)) {\n         res.cached = false;\n         res.data = curl.data;\n     } else\n@@ -224,7 +230,9 @@ Path downloadFileCached(const string & url, bool unpack)\n     if (!skip) {\n \n         try {\n-            auto res = downloadFile(url, expectedETag);\n+            DownloadOptions options;\n+            options.expectedETag = expectedETag;\n+            auto res = downloadFile(url, options);\n \n             if (!res.cached)\n                 storePath = store->addTextToStore(name, res.data, PathSet(), false);"
            },
            {
                "sha": "aff109ee7ce1f520993c411e9dd5e7d77726c316",
                "filename": "src/libstore/download.hh",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/NixOS/nix/blob/5db358d4d78aea7204a8f22c5bf2a309267ee038/src%2Flibstore%2Fdownload.hh",
                "raw_url": "https://github.com/NixOS/nix/raw/5db358d4d78aea7204a8f22c5bf2a309267ee038/src%2Flibstore%2Fdownload.hh",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/src%2Flibstore%2Fdownload.hh?ref=5db358d4d78aea7204a8f22c5bf2a309267ee038",
                "patch": "@@ -5,13 +5,19 @@\n \n namespace nix {\n \n+struct DownloadOptions\n+{\n+    string expectedETag;\n+    bool verifyTLS{true};\n+};\n+\n struct DownloadResult\n {\n     bool cached;\n     string data, etag;\n };\n \n-DownloadResult downloadFile(string url, string expectedETag = \"\");\n+DownloadResult downloadFile(string url, const DownloadOptions & options);\n \n Path downloadFileCached(const string & url, bool unpack);\n "
            },
            {
                "sha": "73a2845e07a5cc4ca8629b8681a5d670d76147fb",
                "filename": "src/nix-prefetch-url/nix-prefetch-url.cc",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/NixOS/nix/blob/5db358d4d78aea7204a8f22c5bf2a309267ee038/src%2Fnix-prefetch-url%2Fnix-prefetch-url.cc",
                "raw_url": "https://github.com/NixOS/nix/raw/5db358d4d78aea7204a8f22c5bf2a309267ee038/src%2Fnix-prefetch-url%2Fnix-prefetch-url.cc",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/src%2Fnix-prefetch-url%2Fnix-prefetch-url.cc?ref=5db358d4d78aea7204a8f22c5bf2a309267ee038",
                "patch": "@@ -158,7 +158,7 @@ int main(int argc, char * * argv)\n             auto actualUri = resolveMirrorUri(state, uri);\n \n             /* Download the file. */\n-            auto result = downloadFile(actualUri);\n+            auto result = downloadFile(actualUri, DownloadOptions());\n \n             AutoDelete tmpDir(createTempDir(), true);\n             Path tmpFile = (Path) tmpDir + \"/tmp\";"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/layui/layui/commits/f756b41d63bf3d488a2cb042918638c9851bf2b0",
        "url": "https://api.github.com/repos/layui/layui/commits/f756b41d63bf3d488a2cb042918638c9851bf2b0",
        "html_url": "https://github.com/layui/layui/commit/f756b41d63bf3d488a2cb042918638c9851bf2b0",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "ccee8e30cab3b0af3a195fdb00e0e047e27e5900",
                "filename": "src/layui.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/layui/layui/blob/f756b41d63bf3d488a2cb042918638c9851bf2b0/src%2Flayui.js",
                "raw_url": "https://github.com/layui/layui/raw/f756b41d63bf3d488a2cb042918638c9851bf2b0/src%2Flayui.js",
                "contents_url": "https://api.github.com/repos/layui/layui/contents/src%2Flayui.js?ref=f756b41d63bf3d488a2cb042918638c9851bf2b0",
                "patch": "@@ -24,8 +24,8 @@\n \n   // \u83b7\u53d6 layui \u6240\u5728\u76ee\u5f55\n   var getPath = function(){\n-    var jsPath = doc.currentScript ? doc.currentScript.src : function(){\n-      var js = doc.scripts;\n+    var jsPath = (doc.currentScript && doc.currentScript.tagName.toUpperCase() === 'SCRIPT') ? doc.currentScript.src : function(){\n+      var js = doc.getElementsByTagName('script');\n       var last = js.length - 1;\n       var src;\n       for(var i = last; i > 0; i--){"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/cd8c95aa4663f54bd66a69c5952f2e42405426f3",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/cd8c95aa4663f54bd66a69c5952f2e42405426f3",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/cd8c95aa4663f54bd66a69c5952f2e42405426f3",
        "message": "Check customer before deleting reviews",
        "files": [
            {
                "sha": "f1a3e811a42da3c5fd574f4e72dea6e9c0b5d3d0",
                "filename": "controller/frontend/src/Controller/Frontend/Review/Standard.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/cd8c95aa4663f54bd66a69c5952f2e42405426f3/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FReview%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/cd8c95aa4663f54bd66a69c5952f2e42405426f3/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FReview%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FReview%2FStandard.php?ref=cd8c95aa4663f54bd66a69c5952f2e42405426f3",
                "patch": "@@ -107,7 +107,7 @@ public function create( array $vals = [] ) : \\Aimeos\\MShop\\Review\\Item\\Iface\n \tpublic function delete( $ids ) : Iface\n \t{\n \t\t$ids = (array) $ids;\n-\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids] );\n+\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids, 'review.customerid' => $this->context()->user()] );\n \t\t$this->manager->delete( $this->manager->search( $filter->slice( 0, count( $ids ) ) )->toArray() );\n \n \t\treturn $this;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/700da5ea2b622724b68c8684346bf74ac3bbca9b",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/700da5ea2b622724b68c8684346bf74ac3bbca9b",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/700da5ea2b622724b68c8684346bf74ac3bbca9b",
        "message": "Check customer before deleting reviews",
        "files": [
            {
                "sha": "c9f97ced00908a8f08f6dc9e5e5e0242c28db633",
                "filename": "controller/frontend/src/Controller/Frontend/Review/Standard.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/700da5ea2b622724b68c8684346bf74ac3bbca9b/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FReview%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/700da5ea2b622724b68c8684346bf74ac3bbca9b/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FReview%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FReview%2FStandard.php?ref=700da5ea2b622724b68c8684346bf74ac3bbca9b",
                "patch": "@@ -106,7 +106,7 @@ public function create( array $vals = [] ) : \\Aimeos\\MShop\\Review\\Item\\Iface\n \tpublic function delete( $ids ) : Iface\n \t{\n \t\t$ids = (array) $ids;\n-\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids] );\n+\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids, 'review.customerid' => $this->context()->user()] );\n \t\t$this->manager->delete( $this->manager->search( $filter->slice( 0, count( $ids ) ) )->toArray() );\n \n \t\treturn $this;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/ae7baa3f2fbf594c2c1e4b1aae83364a84b241a6",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/ae7baa3f2fbf594c2c1e4b1aae83364a84b241a6",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/ae7baa3f2fbf594c2c1e4b1aae83364a84b241a6",
        "message": "Check user before canceling subscription",
        "files": [
            {
                "sha": "d3353991e66f6ee6b62927072bf80be28bdd5d13",
                "filename": "src/Controller/Frontend/Subscription/Standard.php",
                "status": "modified",
                "additions": 6,
                "deletions": 5,
                "changes": 11,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/ae7baa3f2fbf594c2c1e4b1aae83364a84b241a6/src%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/ae7baa3f2fbf594c2c1e4b1aae83364a84b241a6/src%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/src%2FController%2FFrontend%2FSubscription%2FStandard.php?ref=ae7baa3f2fbf594c2c1e4b1aae83364a84b241a6",
                "patch": "@@ -169,7 +169,8 @@ public function __clone()\n \t */\n \tpublic function cancel( string $id ) : \\Aimeos\\MShop\\Subscription\\Item\\Iface\n \t{\n-\t\t$item = $this->manager->get( $id );\n+\t\t$item = $this->object()->get( $id );\n+\n \t\t$item = $item->setDateEnd( $item->getDateNext() ?: date( 'Y-m-d' ) )\n \t\t\t->setReason( \\Aimeos\\MShop\\Subscription\\Item\\Iface::REASON_CANCEL );\n \n@@ -201,16 +202,16 @@ public function compare( string $operator, string $key, $value ) : Iface\n \t */\n \tpublic function get( string $id ) : \\Aimeos\\MShop\\Subscription\\Item\\Iface\n \t{\n-\t\t$userId = $this->context()->user();\n+\t\t$user = $this->context()->user();\n \n \t\t$filter = $this->manager->filter( null )->add( [\n-\t\t\t'order.customerid' => $userId,\n+\t\t\t'order.customerid' => $user,\n \t\t\t'subscription.id' => $id\n \t\t] );\n \n-\t\treturn $this->manager->search( $filter, $this->domains )->first( function() use ( $id, $userId ) {\n+\t\treturn $this->manager->search( $filter, $this->domains )->first( function() use ( $id, $user ) {\n \t\t\t$msg = 'Invalid subscription ID \"%1$s\" for customer ID \"%2$s\"';\n-\t\t\tthrow new \\Aimeos\\Controller\\Frontend\\Subscription\\Exception( sprintf( $msg, $id, $userId ) );\n+\t\t\tthrow new \\Aimeos\\Controller\\Frontend\\Subscription\\Exception( sprintf( $msg, $id, $user ) );\n \t\t} );\n \t}\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/2ad5c062a629af374da470a319914c321c9bfee2",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/2ad5c062a629af374da470a319914c321c9bfee2",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/2ad5c062a629af374da470a319914c321c9bfee2",
        "message": "Check customer before deleting reviews",
        "files": [
            {
                "sha": "6b55b7a655facd7858792afc7235f0b0de4752da",
                "filename": "src/Controller/Frontend/Review/Standard.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/2ad5c062a629af374da470a319914c321c9bfee2/src%2FController%2FFrontend%2FReview%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/2ad5c062a629af374da470a319914c321c9bfee2/src%2FController%2FFrontend%2FReview%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/src%2FController%2FFrontend%2FReview%2FStandard.php?ref=2ad5c062a629af374da470a319914c321c9bfee2",
                "patch": "@@ -216,7 +216,7 @@ public function create( array $vals = [] ) : \\Aimeos\\MShop\\Review\\Item\\Iface\n \tpublic function delete( $ids ) : Iface\n \t{\n \t\t$ids = (array) $ids;\n-\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids] );\n+\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids, 'review.customerid' => $this->context()->user()] );\n \t\t$this->manager->delete( $this->manager->search( $filter->slice( 0, count( $ids ) ) )->toArray() );\n \n \t\treturn $this;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/d4eac06f3a25330c089d8be4397f2ab1936dd9bb",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/d4eac06f3a25330c089d8be4397f2ab1936dd9bb",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/d4eac06f3a25330c089d8be4397f2ab1936dd9bb",
        "message": "Check user before canceling subscription",
        "files": [
            {
                "sha": "7390d173669db02f7209bba03f420526f6cc2c2b",
                "filename": "src/Controller/Frontend/Subscription/Standard.php",
                "status": "modified",
                "additions": 6,
                "deletions": 5,
                "changes": 11,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/d4eac06f3a25330c089d8be4397f2ab1936dd9bb/src%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/d4eac06f3a25330c089d8be4397f2ab1936dd9bb/src%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/src%2FController%2FFrontend%2FSubscription%2FStandard.php?ref=d4eac06f3a25330c089d8be4397f2ab1936dd9bb",
                "patch": "@@ -169,7 +169,8 @@ public function __clone()\n \t */\n \tpublic function cancel( string $id ) : \\Aimeos\\MShop\\Subscription\\Item\\Iface\n \t{\n-\t\t$item = $this->manager->get( $id );\n+\t\t$item = $this->object()->get( $id );\n+\n \t\t$item = $item->setDateEnd( $item->getDateNext() ?: date( 'Y-m-d' ) )\n \t\t\t->setReason( \\Aimeos\\MShop\\Subscription\\Item\\Iface::REASON_CANCEL );\n \n@@ -201,16 +202,16 @@ public function compare( string $operator, string $key, $value ) : Iface\n \t */\n \tpublic function get( string $id ) : \\Aimeos\\MShop\\Subscription\\Item\\Iface\n \t{\n-\t\t$userId = $this->context()->user();\n+\t\t$user = $this->context()->user();\n \n \t\t$filter = $this->manager->filter( null )->add( [\n-\t\t\t'order.customerid' => $userId,\n+\t\t\t'order.customerid' => $user,\n \t\t\t'subscription.id' => $id\n \t\t] );\n \n-\t\treturn $this->manager->search( $filter, $this->domains )->first( function() use ( $id, $userId ) {\n+\t\treturn $this->manager->search( $filter, $this->domains )->first( function() use ( $id, $user ) {\n \t\t\t$msg = 'Invalid subscription ID \"%1$s\" for customer ID \"%2$s\"';\n-\t\t\tthrow new \\Aimeos\\Controller\\Frontend\\Subscription\\Exception( sprintf( $msg, $id, $userId ) );\n+\t\t\tthrow new \\Aimeos\\Controller\\Frontend\\Subscription\\Exception( sprintf( $msg, $id, $user ) );\n \t\t} );\n \t}\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/53eebdc51fae34440dfd768a7811c169c7779aa9",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/53eebdc51fae34440dfd768a7811c169c7779aa9",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/53eebdc51fae34440dfd768a7811c169c7779aa9",
        "message": "Check user before canceling subscription",
        "files": [
            {
                "sha": "81d41b0fc06ede926875d727c1668f6cd2b1ea39",
                "filename": "src/Controller/Frontend/Subscription/Standard.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/53eebdc51fae34440dfd768a7811c169c7779aa9/src%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/53eebdc51fae34440dfd768a7811c169c7779aa9/src%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/src%2FController%2FFrontend%2FSubscription%2FStandard.php?ref=53eebdc51fae34440dfd768a7811c169c7779aa9",
                "patch": "@@ -169,7 +169,8 @@ public function __clone()\n \t */\n \tpublic function cancel( string $id ) : \\Aimeos\\MShop\\Subscription\\Item\\Iface\n \t{\n-\t\t$item = $this->manager->get( $id );\n+\t\t$item = $this->object()->get( $id );\n+\n \t\t$item = $item->setDateEnd( $item->getDateNext() ?: date( 'Y-m-d' ) )\n \t\t\t->setReason( \\Aimeos\\MShop\\Subscription\\Item\\Iface::REASON_CANCEL );\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/5833db6d18a889b94dc036dfb84b6f5cca73fbac",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/5833db6d18a889b94dc036dfb84b6f5cca73fbac",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/5833db6d18a889b94dc036dfb84b6f5cca73fbac",
        "message": "Check user before canceling subscription",
        "files": [
            {
                "sha": "7510f86c5860f9c74702eae3743f552a29b76c56",
                "filename": "controller/frontend/src/Controller/Frontend/Subscription/Standard.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/5833db6d18a889b94dc036dfb84b6f5cca73fbac/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/5833db6d18a889b94dc036dfb84b6f5cca73fbac/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FSubscription%2FStandard.php?ref=5833db6d18a889b94dc036dfb84b6f5cca73fbac",
                "patch": "@@ -58,8 +58,8 @@ public function __clone()\n \t */\n \tpublic function cancel( string $id ) : \\Aimeos\\MShop\\Subscription\\Item\\Iface\n \t{\n-\t\t$item = $this->manager->getItem( $id );\n-\t\t$item = $item->setDateEnd( $item->getDateNext() )\n+\t\t$item = $this->getObject()->get( $id );\n+\t\t$item = $item->setDateEnd( $item->getDateNext() ?: date( 'Y-m-d' ) )\n \t\t\t->setReason( \\Aimeos\\MShop\\Subscription\\Item\\Iface::REASON_CANCEL );\n \n \t\treturn $this->manager->saveItem( $item );"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/7c93139f86eff9ec26b117a8918e06ce6cc0000f",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/7c93139f86eff9ec26b117a8918e06ce6cc0000f",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/7c93139f86eff9ec26b117a8918e06ce6cc0000f",
        "message": "Check user before canceling subscription",
        "files": [
            {
                "sha": "760a92e785cacee6e7e3936347bc71664198a22e",
                "filename": "controller/frontend/src/Controller/Frontend/Subscription/Standard.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/7c93139f86eff9ec26b117a8918e06ce6cc0000f/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/7c93139f86eff9ec26b117a8918e06ce6cc0000f/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FSubscription%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/controller%2Ffrontend%2Fsrc%2FController%2FFrontend%2FSubscription%2FStandard.php?ref=7c93139f86eff9ec26b117a8918e06ce6cc0000f",
                "patch": "@@ -57,7 +57,7 @@ public function __clone()\n \t */\n \tpublic function cancel( string $id ) : \\Aimeos\\MShop\\Subscription\\Item\\Iface\n \t{\n-\t\t$item = $this->manager->get( $id );\n+\t\t$item = $this->getObject()->get( $id );\n \t\t$item = $item->setDateEnd( $item->getDateNext() ?: date( 'Y-m-d' ) )\n \t\t\t->setReason( \\Aimeos\\MShop\\Subscription\\Item\\Iface::REASON_CANCEL );\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/f7c6a9ce2a6f5a9ad4af31313508870a78398f85",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/f7c6a9ce2a6f5a9ad4af31313508870a78398f85",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/f7c6a9ce2a6f5a9ad4af31313508870a78398f85",
        "message": "Check customer before deleting reviews",
        "files": [
            {
                "sha": "280e6011ff4f5472bde7748594e9266ae75624fc",
                "filename": "src/Controller/Frontend/Review/Standard.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/f7c6a9ce2a6f5a9ad4af31313508870a78398f85/src%2FController%2FFrontend%2FReview%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/f7c6a9ce2a6f5a9ad4af31313508870a78398f85/src%2FController%2FFrontend%2FReview%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/src%2FController%2FFrontend%2FReview%2FStandard.php?ref=f7c6a9ce2a6f5a9ad4af31313508870a78398f85",
                "patch": "@@ -218,7 +218,7 @@ public function create( array $vals = [] ) : \\Aimeos\\MShop\\Review\\Item\\Iface\n \tpublic function delete( $ids ) : Iface\n \t{\n \t\t$ids = (array) $ids;\n-\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids] );\n+\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids, 'review.customerid' => $this->context()->user()] );\n \t\t$this->manager->delete( $this->manager->search( $filter->slice( 0, count( $ids ) ) )->toArray() );\n \n \t\treturn $this;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/6ea6b82f5a1fc18c574cb6f97225930d139b14a5",
        "url": "https://api.github.com/repos/aimeos/ai-controller-frontend/commits/6ea6b82f5a1fc18c574cb6f97225930d139b14a5",
        "html_url": "https://github.com/aimeos/ai-controller-frontend/commit/6ea6b82f5a1fc18c574cb6f97225930d139b14a5",
        "message": "Check customer before deleting reviews",
        "files": [
            {
                "sha": "812d2713ec3f92a7c5d010c71a707eba63af3752",
                "filename": "src/Controller/Frontend/Review/Standard.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/aimeos/ai-controller-frontend/blob/6ea6b82f5a1fc18c574cb6f97225930d139b14a5/src%2FController%2FFrontend%2FReview%2FStandard.php",
                "raw_url": "https://github.com/aimeos/ai-controller-frontend/raw/6ea6b82f5a1fc18c574cb6f97225930d139b14a5/src%2FController%2FFrontend%2FReview%2FStandard.php",
                "contents_url": "https://api.github.com/repos/aimeos/ai-controller-frontend/contents/src%2FController%2FFrontend%2FReview%2FStandard.php?ref=6ea6b82f5a1fc18c574cb6f97225930d139b14a5",
                "patch": "@@ -216,7 +216,7 @@ public function create( array $vals = [] ) : \\Aimeos\\MShop\\Review\\Item\\Iface\n \tpublic function delete( $ids ) : Iface\n \t{\n \t\t$ids = (array) $ids;\n-\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids] );\n+\t\t$filter = $this->manager->filter()->add( ['review.id' => $ids, 'review.customerid' => $this->context()->user()] );\n \t\t$this->manager->delete( $this->manager->search( $filter->slice( 0, count( $ids ) ) )->toArray() );\n \n \t\treturn $this;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mattermost/mattermost/commits/69a8b3df0f9fd3a7a5b792ec678b6191618d039b",
        "url": "https://api.github.com/repos/mattermost/mattermost/commits/69a8b3df0f9fd3a7a5b792ec678b6191618d039b",
        "html_url": "https://github.com/mattermost/mattermost/commit/69a8b3df0f9fd3a7a5b792ec678b6191618d039b",
        "message": "Cleanup post embed for WebSocket payload (#27763)\n\n* Cleanup post embed for WebSocket payload\r\n\r\n* Removing post embeds in create post API\r\n\r\n* Fixed a nil check:\r\n\r\n* Removed a now-irrelavent test\r\n\r\n---------\r\n\r\nCo-authored-by: Mattermost Build <build@mattermost.com>",
        "files": [
            {
                "sha": "11481b82a1bcf7e2072d02f56b0e2e5a67b5cbf6",
                "filename": "server/channels/app/post_metadata.go",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/mattermost/mattermost/blob/69a8b3df0f9fd3a7a5b792ec678b6191618d039b/server%2Fchannels%2Fapp%2Fpost_metadata.go",
                "raw_url": "https://github.com/mattermost/mattermost/raw/69a8b3df0f9fd3a7a5b792ec678b6191618d039b/server%2Fchannels%2Fapp%2Fpost_metadata.go",
                "contents_url": "https://api.github.com/repos/mattermost/mattermost/contents/server%2Fchannels%2Fapp%2Fpost_metadata.go?ref=69a8b3df0f9fd3a7a5b792ec678b6191618d039b",
                "patch": "@@ -202,6 +202,11 @@ func (a *App) getEmbedsAndImages(c request.CTX, post *model.Post, isNewPost bool\n }\n \n func removePermalinkMetadataFromPost(post *model.Post) {\n+\tremoveEmbeddedPostsFromMetadata(post)\n+\tpost.DelProp(model.PostPropsPreviewedPost)\n+}\n+\n+func removeEmbeddedPostsFromMetadata(post *model.Post) {\n \tif post.Metadata == nil || len(post.Metadata.Embeds) == 0 {\n \t\treturn\n \t}\n@@ -217,8 +222,6 @@ func removePermalinkMetadataFromPost(post *model.Post) {\n \t}\n \n \tpost.Metadata.Embeds = newEmbeds\n-\n-\tpost.DelProp(model.PostPropsPreviewedPost)\n }\n \n func (a *App) sanitizePostMetadataForUserAndChannel(c request.CTX, post *model.Post, previewedPost *model.PreviewPost, previewedChannel *model.Channel, userID string) *model.Post {"
            },
            {
                "sha": "2ba6e280147828cbc7c6a72e67c7cbd681044589",
                "filename": "server/public/model/post.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/mattermost/mattermost/blob/69a8b3df0f9fd3a7a5b792ec678b6191618d039b/server%2Fpublic%2Fmodel%2Fpost.go",
                "raw_url": "https://github.com/mattermost/mattermost/raw/69a8b3df0f9fd3a7a5b792ec678b6191618d039b/server%2Fpublic%2Fmodel%2Fpost.go",
                "contents_url": "https://api.github.com/repos/mattermost/mattermost/contents/server%2Fpublic%2Fmodel%2Fpost.go?ref=69a8b3df0f9fd3a7a5b792ec678b6191618d039b",
                "patch": "@@ -508,6 +508,10 @@ func (o *Post) SanitizeProps() {\n func (o *Post) SanitizeInput() {\n \to.DeleteAt = 0\n \to.RemoteId = NewPointer(\"\")\n+\n+\tif o.Metadata != nil {\n+\t\to.Metadata.Embeds = nil\n+\t}\n }\n \n func (o *Post) ContainsIntegrationsReservedProps() []string {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/strawberry-graphql/strawberry/commits/37265b230e511480a9ceace492f9f6a484be1387",
        "url": "https://api.github.com/repos/strawberry-graphql/strawberry/commits/37265b230e511480a9ceace492f9f6a484be1387",
        "html_url": "https://github.com/strawberry-graphql/strawberry/commit/37265b230e511480a9ceace492f9f6a484be1387",
        "message": "Disable multipart uploads by default (#3645)\n\n* Disable multipart uploads by default\r\n\r\n* Document the new option\r\n\r\n* Stop disabling Django's CSRF protection by default\r\n\r\n* Document breaking changes\r\n\r\n* Add release file\r\n\r\n* [pre-commit.ci] auto fixes from pre-commit.com hooks\r\n\r\nfor more information, see https://pre-commit.ci\r\n\r\n* Bump date\r\n\r\n* Test\r\n\r\n* Add tweet file\r\n\r\n* Shorter tweet\r\n\r\n---------\r\n\r\nCo-authored-by: pre-commit-ci[bot] <66853113+pre-commit-ci[bot]@users.noreply.github.com>\r\nCo-authored-by: Patrick Arminio <patrick.arminio@gmail.com>",
        "files": [
            {
                "sha": "0374bbe3d495e82b79d812a57b96a87d4237d953",
                "filename": ".github/workflows/test.yml",
                "status": "modified",
                "additions": 0,
                "deletions": 14,
                "changes": 14,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/.github%2Fworkflows%2Ftest.yml",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/.github%2Fworkflows%2Ftest.yml",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/.github%2Fworkflows%2Ftest.yml?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -59,20 +59,6 @@ jobs:\n             3.12\n             3.13-dev\n \n-      - name: Pip and nox cache\n-        id: cache\n-        uses: actions/cache@v4\n-        with:\n-          path: |\n-            ~/.cache\n-            ~/.nox\n-            .nox\n-          key:\n-            ${{ runner.os }}-nox-${{ matrix.session.session }}-${{ env.pythonLocation }}-${{\n-            hashFiles('**/poetry.lock') }}-${{ hashFiles('**/noxfile.py') }}\n-          restore-keys: |\n-            ${{ runner.os }}-nox-${{ matrix.session.session }}-${{ env.pythonLocation }}\n-\n       - run: pip install poetry nox nox-poetry uv\n       - run: nox -r -t tests -s \"${{ matrix.session.session }}\"\n       - uses: actions/upload-artifact@v4"
            },
            {
                "sha": "0d039486fc459778b9b554d6cffeda6036816063",
                "filename": "RELEASE.md",
                "status": "added",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/RELEASE.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/RELEASE.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/RELEASE.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -0,0 +1,7 @@\n+Release type: minor\n+\n+Starting with this release, multipart uploads are disabled by default and Strawberry Django view is no longer implicitly exempted from Django's CSRF protection.\n+Both changes relieve users from implicit security implications inherited from the GraphQL multipart request specification which was enabled in Strawberry by default.\n+\n+These are breaking changes if you are using multipart uploads OR the Strawberry Django view.\n+Migrations guides including further information are available on the Strawberry website."
            },
            {
                "sha": "ec081269f6e12f55defebba9461ee9988a48adda",
                "filename": "TWEET.md",
                "status": "added",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/TWEET.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/TWEET.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/TWEET.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -0,0 +1,8 @@\n+\ud83c\udd95 Release $version is out! Thanks to $contributor \ud83d\udc4f\n+\n+We've made some important security changes regarding file uploads and CSRF in\n+Django.\n+\n+Check out our migration guides if you're using multipart or Django view.\n+\n+\ud83d\udc47 $release_url"
            },
            {
                "sha": "3df11e2b23ce1ef4905fbcae16d0611528c96c62",
                "filename": "docs/breaking-changes.md",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fbreaking-changes.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fbreaking-changes.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fbreaking-changes.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -4,6 +4,7 @@ title: List of breaking changes and deprecations\n \n # List of breaking changes and deprecations\n \n+- [Version 0.243.0 - 25 September 2024](./breaking-changes/0.243.0.md)\n - [Version 0.240.0 - 10 September 2024](./breaking-changes/0.240.0.md)\n - [Version 0.236.0 - 17 July 2024](./breaking-changes/0.236.0.md)\n - [Version 0.233.0 - 29 May 2024](./breaking-changes/0.233.0.md)"
            },
            {
                "sha": "0eec0b96339dd8c7de5ba2009c192ae65ea0ad9e",
                "filename": "docs/breaking-changes/0.243.0.md",
                "status": "added",
                "additions": 53,
                "deletions": 0,
                "changes": 53,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fbreaking-changes%2F0.243.0.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fbreaking-changes%2F0.243.0.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fbreaking-changes%2F0.243.0.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -0,0 +1,53 @@\n+---\n+title: 0.243.0 Breaking Changes\n+slug: breaking-changes/0.243.0\n+---\n+\n+# v0.240.0 Breaking Changes\n+\n+Release v0.240.0 comes with two breaking changes regarding multipart file\n+uploads and Django CSRF protection.\n+\n+## Multipart uploads disabled by default\n+\n+Previously, support for uploads via the\n+[GraphQL multipart request specification](https://github.com/jaydenseric/graphql-multipart-request-spec)\n+was enabled by default. This implicitly required Strawberry users to consider\n+the\n+[security implications outlined in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security).\n+Given that most Strawberry users were likely not aware of this, we're making\n+multipart file upload support stictly opt-in via a new\n+`multipart_uploads_enabled` view settings.\n+\n+To enable multipart upload support for your Strawberry view integration, please\n+follow the updated integration guides and enable appropriate security\n+measurements for your server.\n+\n+## Django CSRF protection enabled\n+\n+Previously, the Strawberry Django view integration was internally exempted from\n+Django's built-in CSRF protection (i.e, the `CsrfViewMiddleware` middleware).\n+While this is how many GraphQL APIs operate, implicitly addded exemptions can\n+lead to security vulnerabilities. Instead, we delegate the decision of adding an\n+CSRF exemption to users now.\n+\n+Note that having the CSRF protection enabled on your Strawberry Django view\n+potentially requires all your clients to send an CSRF token with every request.\n+You can learn more about this in the official Django\n+[Cross Site Request Forgery protection documentation](https://docs.djangoproject.com/en/dev/ref/csrf/).\n+\n+To restore the behaviour of the integration before this release, you can add the\n+`csrf_exempt` decorator provided by Django yourself:\n+\n+```python\n+from django.urls import path\n+from django.views.decorators.csrf import csrf_exempt\n+\n+from strawberry.django.views import GraphQLView\n+\n+from api.schema import schema\n+\n+urlpatterns = [\n+    path(\"graphql/\", csrf_exempt(GraphQLView.as_view(schema=schema))),\n+]\n+```"
            },
            {
                "sha": "e968e43bf289f74a41dd1e9c7178e71f6376759c",
                "filename": "docs/integrations/aiohttp.md",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Faiohttp.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Faiohttp.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fintegrations%2Faiohttp.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -29,14 +29,18 @@ app.router.add_route(\"*\", \"/graphql\", GraphQLView(schema=schema))\n \n ## Options\n \n-The `GraphQLView` accepts two options at the moment:\n+The `GraphQLView` accepts the following options at the moment:\n \n - `schema`: mandatory, the schema created by `strawberry.Schema`.\n - `graphql_ide`: optional, defaults to `\"graphiql\"`, allows to choose the\n   GraphQL IDE interface (one of `graphiql`, `apollo-sandbox` or `pathfinder`) or\n   to disable it by passing `None`.\n - `allow_queries_via_get`: optional, defaults to `True`, whether to enable\n   queries via `GET` requests\n+- `multipart_uploads_enabled`: optional, defaults to `False`, controls whether\n+  to enable multipart uploads. Please make sure to consider the\n+  [security implications mentioned in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security)\n+  when enabling this feature.\n \n ## Extending the view\n "
            },
            {
                "sha": "dcb51643b32971c821403f7faf386ccd745a1dba",
                "filename": "docs/integrations/asgi.md",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fasgi.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fasgi.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fintegrations%2Fasgi.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -29,14 +29,18 @@ app with `uvicorn server:app`\n \n ## Options\n \n-The `GraphQL` app accepts two options at the moment:\n+The `GraphQL` app accepts the following options at the moment:\n \n - `schema`: mandatory, the schema created by `strawberry.Schema`.\n - `graphql_ide`: optional, defaults to `\"graphiql\"`, allows to choose the\n   GraphQL IDE interface (one of `graphiql`, `apollo-sandbox` or `pathfinder`) or\n   to disable it by passing `None`.\n - `allow_queries_via_get`: optional, defaults to `True`, whether to enable\n   queries via `GET` requests\n+- `multipart_uploads_enabled`: optional, defaults to `False`, controls whether\n+  to enable multipart uploads. Please make sure to consider the\n+  [security implications mentioned in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security)\n+  when enabling this feature.\n \n ## Extending the view\n "
            },
            {
                "sha": "ce4fc70fb681e3aa168150ce19caad3c57e0e309",
                "filename": "docs/integrations/channels.md",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fchannels.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fchannels.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fintegrations%2Fchannels.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -524,6 +524,10 @@ GraphQLWebsocketCommunicator(\n   queries via `GET` requests\n - `subscriptions_enabled`: optional boolean paramenter enabling subscriptions in\n   the GraphiQL interface, defaults to `True`\n+- `multipart_uploads_enabled`: optional, defaults to `False`, controls whether\n+  to enable multipart uploads. Please make sure to consider the\n+  [security implications mentioned in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security)\n+  when enabling this feature.\n \n ### Extending the consumer\n "
            },
            {
                "sha": "2909aba6f9455a87dd9f8c7922359c42baea2f1b",
                "filename": "docs/integrations/django.md",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fdjango.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fdjango.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fintegrations%2Fdjango.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -10,13 +10,14 @@ It provides a view that you can use to serve your GraphQL schema:\n \n ```python\n from django.urls import path\n+from django.views.decorators.csrf import csrf_exempt\n \n from strawberry.django.views import GraphQLView\n \n from api.schema import schema\n \n urlpatterns = [\n-    path(\"graphql/\", GraphQLView.as_view(schema=schema)),\n+    path(\"graphql/\", csrf_exempt(GraphQLView.as_view(schema=schema))),\n ]\n ```\n \n@@ -40,6 +41,10 @@ The `GraphQLView` accepts the following arguments:\n   queries via `GET` requests\n - `subscriptions_enabled`: optional boolean paramenter enabling subscriptions in\n   the GraphiQL interface, defaults to `False`.\n+- `multipart_uploads_enabled`: optional, defaults to `False`, controls whether\n+  to enable multipart uploads. Please make sure to consider the\n+  [security implications mentioned in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security)\n+  when enabling this feature.\n \n ## Deprecated options\n "
            },
            {
                "sha": "18b7dae5b6a62723d4a80a8314770b32802757f0",
                "filename": "docs/integrations/fastapi.md",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Ffastapi.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Ffastapi.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fintegrations%2Ffastapi.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -54,6 +54,10 @@ The `GraphQLRouter` accepts the following options:\n   value.\n - `root_value_getter`: optional FastAPI dependency for providing custom root\n   value.\n+- `multipart_uploads_enabled`: optional, defaults to `False`, controls whether\n+  to enable multipart uploads. Please make sure to consider the\n+  [security implications mentioned in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security)\n+  when enabling this feature.\n \n ## context_getter\n "
            },
            {
                "sha": "b44e166efafa18c67894038b368009faba59bd28",
                "filename": "docs/integrations/flask.md",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fflask.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fflask.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fintegrations%2Fflask.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -34,13 +34,17 @@ from strawberry.flask.views import AsyncGraphQLView\n \n ## Options\n \n-The `GraphQLView` accepts two options at the moment:\n+The `GraphQLView` accepts the following options at the moment:\n \n - `schema`: mandatory, the schema created by `strawberry.Schema`.\n - `graphiql:` optional, defaults to `True`, whether to enable the GraphiQL\n   interface.\n - `allow_queries_via_get`: optional, defaults to `True`, whether to enable\n   queries via `GET` requests\n+- `multipart_uploads_enabled`: optional, defaults to `False`, controls whether\n+  to enable multipart uploads. Please make sure to consider the\n+  [security implications mentioned in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security)\n+  when enabling this feature.\n \n ## Extending the view\n "
            },
            {
                "sha": "b50509662607f67dd1a90efbde8ca4d7fdeddae2",
                "filename": "docs/integrations/litestar.md",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Flitestar.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Flitestar.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fintegrations%2Flitestar.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -61,6 +61,10 @@ The `make_graphql_controller` function accepts the following options:\n   the maximum time to wait for the connection initialization message when using\n   `graphql-transport-ws`\n   [protocol](https://github.com/enisdenjo/graphql-ws/blob/master/PROTOCOL.md#connectioninit)\n+- `multipart_uploads_enabled`: optional, defaults to `False`, controls whether\n+  to enable multipart uploads. Please make sure to consider the\n+  [security implications mentioned in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security)\n+  when enabling this feature.\n \n ## context_getter\n "
            },
            {
                "sha": "fa9b0719903470c6e1dfd43f42d9dbaf0903b9d0",
                "filename": "docs/integrations/quart.md",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fquart.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fquart.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fintegrations%2Fquart.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -26,13 +26,17 @@ if __name__ == \"__main__\":\n \n ## Options\n \n-The `GraphQLView` accepts two options at the moment:\n+The `GraphQLView` accepts the following options at the moment:\n \n - `schema`: mandatory, the schema created by `strawberry.Schema`.\n - `graphiql:` optional, defaults to `True`, whether to enable the GraphiQL\n   interface.\n - `allow_queries_via_get`: optional, defaults to `True`, whether to enable\n   queries via `GET` requests\n+- `multipart_uploads_enabled`: optional, defaults to `False`, controls whether\n+  to enable multipart uploads. Please make sure to consider the\n+  [security implications mentioned in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security)\n+  when enabling this feature.\n \n ## Extending the view\n "
            },
            {
                "sha": "0a7d885c7dcb295f230d5bcbafca5aa3371015e8",
                "filename": "docs/integrations/sanic.md",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fsanic.md",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/docs%2Fintegrations%2Fsanic.md",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/docs%2Fintegrations%2Fsanic.md?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -22,15 +22,18 @@ app.add_route(\n \n ## Options\n \n-The `GraphQLView` accepts two options at the moment:\n+The `GraphQLView` accepts the following options at the moment:\n \n - `schema`: mandatory, the schema created by `strawberry.Schema`.\n - `graphql_ide`: optional, defaults to `\"graphiql\"`, allows to choose the\n   GraphQL IDE interface (one of `graphiql`, `apollo-sandbox` or `pathfinder`) or\n   to disable it by passing `None`.\n - `allow_queries_via_get`: optional, defaults to `True`, whether to enable\n   queries via `GET` requests\n-- `def encode_json(self, data: GraphQLHTTPResponse) -> str`\n+- `multipart_uploads_enabled`: optional, defaults to `False`, controls whether\n+  to enable multipart uploads. Please make sure to consider the\n+  [security implications mentioned in the GraphQL Multipart Request Specification](https://github.com/jaydenseric/graphql-multipart-request-spec/blob/master/readme.md#security)\n+  when enabling this feature.\n \n ## Extending the view\n "
            },
            {
                "sha": "f2154309f6025f3f9979821a1ca03d434542fa33",
                "filename": "strawberry/aiohttp/views.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Faiohttp%2Fviews.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Faiohttp%2Fviews.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Faiohttp%2Fviews.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -111,6 +111,7 @@ def __init__(\n             GRAPHQL_WS_PROTOCOL,\n         ),\n         connection_init_wait_timeout: timedelta = timedelta(minutes=1),\n+        multipart_uploads_enabled: bool = False,\n     ) -> None:\n         self.schema = schema\n         self.allow_queries_via_get = allow_queries_via_get\n@@ -119,6 +120,7 @@ def __init__(\n         self.debug = debug\n         self.subscription_protocols = subscription_protocols\n         self.connection_init_wait_timeout = connection_init_wait_timeout\n+        self.multipart_uploads_enabled = multipart_uploads_enabled\n \n         if graphiql is not None:\n             warnings.warn("
            },
            {
                "sha": "d2647c6ee675b3b6d8608d7ec7605230d21875b7",
                "filename": "strawberry/asgi/__init__.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fasgi%2F__init__.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fasgi%2F__init__.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Fasgi%2F__init__.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -106,6 +106,7 @@ def __init__(\n             GRAPHQL_WS_PROTOCOL,\n         ),\n         connection_init_wait_timeout: timedelta = timedelta(minutes=1),\n+        multipart_uploads_enabled: bool = False,\n     ) -> None:\n         self.schema = schema\n         self.allow_queries_via_get = allow_queries_via_get\n@@ -114,6 +115,7 @@ def __init__(\n         self.debug = debug\n         self.protocols = subscription_protocols\n         self.connection_init_wait_timeout = connection_init_wait_timeout\n+        self.multipart_uploads_enabled = multipart_uploads_enabled\n \n         if graphiql is not None:\n             warnings.warn("
            },
            {
                "sha": "c7264a45b3629a5b51c64880dfc1c07adfed21ac",
                "filename": "strawberry/channels/handlers/http_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fchannels%2Fhandlers%2Fhttp_handler.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fchannels%2Fhandlers%2Fhttp_handler.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Fchannels%2Fhandlers%2Fhttp_handler.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -168,12 +168,14 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         subscriptions_enabled: bool = True,\n+        multipart_uploads_enabled: bool = False,\n         **kwargs: Any,\n     ) -> None:\n         self.schema = schema\n         self.allow_queries_via_get = allow_queries_via_get\n         self.subscriptions_enabled = subscriptions_enabled\n         self._ide_subscriptions_enabled = subscriptions_enabled\n+        self.multipart_uploads_enabled = multipart_uploads_enabled\n \n         if graphiql is not None:\n             warnings.warn("
            },
            {
                "sha": "132c822f78279e9cea53f7dd71e4c84035e9005a",
                "filename": "strawberry/django/views.py",
                "status": "modified",
                "additions": 3,
                "deletions": 4,
                "changes": 7,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fdjango%2Fviews.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fdjango%2Fviews.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Fdjango%2Fviews.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -28,8 +28,7 @@\n from django.template.exceptions import TemplateDoesNotExist\n from django.template.loader import render_to_string\n from django.template.response import TemplateResponse\n-from django.utils.decorators import classonlymethod, method_decorator\n-from django.views.decorators.csrf import csrf_exempt\n+from django.utils.decorators import classonlymethod\n from django.views.generic import View\n \n from strawberry.http.async_base_view import AsyncBaseHTTPView, AsyncHTTPRequestAdapter\n@@ -147,11 +146,13 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         subscriptions_enabled: bool = False,\n+        multipart_uploads_enabled: bool = False,\n         **kwargs: Any,\n     ) -> None:\n         self.schema = schema\n         self.allow_queries_via_get = allow_queries_via_get\n         self.subscriptions_enabled = subscriptions_enabled\n+        self.multipart_uploads_enabled = multipart_uploads_enabled\n \n         if graphiql is not None:\n             warnings.warn(\n@@ -229,7 +230,6 @@ def get_context(self, request: HttpRequest, response: HttpResponse) -> Any:\n     def get_sub_response(self, request: HttpRequest) -> TemporalHttpResponse:\n         return TemporalHttpResponse()\n \n-    @method_decorator(csrf_exempt)\n     def dispatch(\n         self, request: HttpRequest, *args: Any, **kwargs: Any\n     ) -> Union[HttpResponseNotAllowed, TemplateResponse, HttpResponseBase]:\n@@ -288,7 +288,6 @@ async def get_context(self, request: HttpRequest, response: HttpResponse) -> Any\n     async def get_sub_response(self, request: HttpRequest) -> TemporalHttpResponse:\n         return TemporalHttpResponse()\n \n-    @method_decorator(csrf_exempt)\n     async def dispatch(  # pyright: ignore\n         self, request: HttpRequest, *args: Any, **kwargs: Any\n     ) -> Union[HttpResponseNotAllowed, TemplateResponse, HttpResponseBase]:"
            },
            {
                "sha": "badcfa33e0b7a74cf6c9de9e64449e022fb74aab",
                "filename": "strawberry/fastapi/router.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Ffastapi%2Frouter.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Ffastapi%2Frouter.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Ffastapi%2Frouter.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -156,6 +156,7 @@ def __init__(\n         generate_unique_id_function: Callable[[APIRoute], str] = Default(\n             generate_unique_id\n         ),\n+        multipart_uploads_enabled: bool = False,\n         **kwargs: Any,\n     ) -> None:\n         super().__init__(\n@@ -190,6 +191,7 @@ def __init__(\n         )\n         self.protocols = subscription_protocols\n         self.connection_init_wait_timeout = connection_init_wait_timeout\n+        self.multipart_uploads_enabled = multipart_uploads_enabled\n \n         if graphiql is not None:\n             warnings.warn("
            },
            {
                "sha": "d952eb6aa9b3761e6b5cd60e1e75d89b53c4f45d",
                "filename": "strawberry/flask/views.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fflask%2Fviews.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fflask%2Fviews.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Fflask%2Fviews.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -71,10 +71,12 @@ def __init__(\n         graphiql: Optional[bool] = None,\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n+        multipart_uploads_enabled: bool = False,\n     ) -> None:\n         self.schema = schema\n         self.graphiql = graphiql\n         self.allow_queries_via_get = allow_queries_via_get\n+        self.multipart_uploads_enabled = multipart_uploads_enabled\n \n         if graphiql is not None:\n             warnings.warn("
            },
            {
                "sha": "c9f1e6ae496f87969af2af9963575f62eb014ec6",
                "filename": "strawberry/http/async_base_view.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fhttp%2Fasync_base_view.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fhttp%2Fasync_base_view.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Fhttp%2Fasync_base_view.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -333,7 +333,7 @@ async def parse_http_body(\n             data = self.parse_query_params(request.query_params)\n         elif \"application/json\" in content_type:\n             data = self.parse_json(await request.get_body())\n-        elif content_type == \"multipart/form-data\":\n+        elif self.multipart_uploads_enabled and content_type == \"multipart/form-data\":\n             data = await self.parse_multipart(request)\n         else:\n             raise HTTPException(400, \"Unsupported content type\")"
            },
            {
                "sha": "5ab57ef65d9aa79f4eacf17478ba531c518971b4",
                "filename": "strawberry/http/base.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fhttp%2Fbase.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fhttp%2Fbase.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Fhttp%2Fbase.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -23,6 +23,7 @@ def headers(self) -> Mapping[str, str]: ...\n \n class BaseView(Generic[Request]):\n     graphql_ide: Optional[GraphQL_IDE]\n+    multipart_uploads_enabled: bool = False\n \n     # TODO: we might remove this in future :)\n     _ide_replace_variables: bool = True"
            },
            {
                "sha": "df770e05410ee31e94d003f97b4f42c8a071d500",
                "filename": "strawberry/http/sync_base_view.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fhttp%2Fsync_base_view.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fhttp%2Fsync_base_view.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Fhttp%2Fsync_base_view.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -143,7 +143,7 @@ def parse_http_body(self, request: SyncHTTPRequestAdapter) -> GraphQLRequestData\n         elif \"application/json\" in content_type:\n             data = self.parse_json(request.body)\n         # TODO: multipart via get?\n-        elif content_type == \"multipart/form-data\":\n+        elif self.multipart_uploads_enabled and content_type == \"multipart/form-data\":\n             data = self.parse_multipart(request)\n         elif self._is_multipart_subscriptions(content_type, params):\n             raise HTTPException("
            },
            {
                "sha": "e5c27ffe873f641ff17e8b4645487d359f057031",
                "filename": "strawberry/litestar/controller.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Flitestar%2Fcontroller.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Flitestar%2Fcontroller.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Flitestar%2Fcontroller.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -410,6 +410,7 @@ def make_graphql_controller(\n         GRAPHQL_WS_PROTOCOL,\n     ),\n     connection_init_wait_timeout: timedelta = timedelta(minutes=1),\n+    multipart_uploads_enabled: bool = False,\n ) -> Type[GraphQLController]:  # sourcery skip: move-assign\n     if context_getter is None:\n         custom_context_getter_ = _none_custom_context_getter\n@@ -456,6 +457,7 @@ class _GraphQLController(GraphQLController):\n     _GraphQLController.schema = schema_\n     _GraphQLController.allow_queries_via_get = allow_queries_via_get_\n     _GraphQLController.graphql_ide = graphql_ide_\n+    _GraphQLController.multipart_uploads_enabled = multipart_uploads_enabled\n \n     return _GraphQLController\n "
            },
            {
                "sha": "5aafcec514281101b90cf76081741e5d4f7d1b54",
                "filename": "strawberry/quart/views.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fquart%2Fviews.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fquart%2Fviews.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Fquart%2Fviews.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -61,9 +61,11 @@ def __init__(\n         graphiql: Optional[bool] = None,\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n+        multipart_uploads_enabled: bool = False,\n     ) -> None:\n         self.schema = schema\n         self.allow_queries_via_get = allow_queries_via_get\n+        self.multipart_uploads_enabled = multipart_uploads_enabled\n \n         if graphiql is not None:\n             warnings.warn("
            },
            {
                "sha": "b62a63ba6538b72c5f1c661897f0163aa43da97f",
                "filename": "strawberry/sanic/views.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fsanic%2Fviews.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/strawberry%2Fsanic%2Fviews.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/strawberry%2Fsanic%2Fviews.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -102,11 +102,13 @@ def __init__(\n         allow_queries_via_get: bool = True,\n         json_encoder: Optional[Type[json.JSONEncoder]] = None,\n         json_dumps_params: Optional[Dict[str, Any]] = None,\n+        multipart_uploads_enabled: bool = False,\n     ) -> None:\n         self.schema = schema\n         self.allow_queries_via_get = allow_queries_via_get\n         self.json_encoder = json_encoder\n         self.json_dumps_params = json_dumps_params\n+        self.multipart_uploads_enabled = multipart_uploads_enabled\n \n         if self.json_encoder is not None:  # pragma: no cover\n             warnings.warn("
            },
            {
                "sha": "4979d7d48096c12cd36416869ab4de356f6ac2a3",
                "filename": "tests/http/clients/aiohttp.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Faiohttp.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Faiohttp.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Faiohttp.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -72,13 +72,15 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         view = GraphQLView(\n             schema=schema,\n             graphiql=graphiql,\n             graphql_ide=graphql_ide,\n             allow_queries_via_get=allow_queries_via_get,\n             keep_alive=False,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n         view.result_override = result_override\n "
            },
            {
                "sha": "5734c8df16f771c5ac91ada89d50daa9b9fa7b4b",
                "filename": "tests/http/clients/asgi.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fasgi.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fasgi.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fasgi.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -74,13 +74,15 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         view = GraphQLView(\n             schema,\n             graphiql=graphiql,\n             graphql_ide=graphql_ide,\n             allow_queries_via_get=allow_queries_via_get,\n             keep_alive=False,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n         view.result_override = result_override\n "
            },
            {
                "sha": "5f5caf4dd7d01f4ca0d9058d5bdd944839e12d7d",
                "filename": "tests/http/clients/async_django.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fasync_django.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fasync_django.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fasync_django.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -43,6 +43,7 @@ async def _do_request(self, request: RequestFactory) -> Response:\n             graphql_ide=self.graphql_ide,\n             allow_queries_via_get=self.allow_queries_via_get,\n             result_override=self.result_override,\n+            multipart_uploads_enabled=self.multipart_uploads_enabled,\n         )\n \n         try:"
            },
            {
                "sha": "4db37c8d1b681ecb786f4aa3c2c7384e9b640848",
                "filename": "tests/http/clients/async_flask.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fasync_flask.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fasync_flask.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fasync_flask.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -52,6 +52,7 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.app = Flask(__name__)\n         self.app.debug = True\n@@ -63,6 +64,7 @@ def __init__(\n             graphql_ide=graphql_ide,\n             allow_queries_via_get=allow_queries_via_get,\n             result_override=result_override,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n \n         self.app.add_url_rule("
            },
            {
                "sha": "ff31e4111e6e4023d28c42e7c55e2dee5c615267",
                "filename": "tests/http/clients/base.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fbase.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fbase.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fbase.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -103,6 +103,7 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ): ...\n \n     @abc.abstractmethod"
            },
            {
                "sha": "2e01c1f40003205005d535e93a4cb1f8e12adae9",
                "filename": "tests/http/clients/chalice.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fchalice.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fchalice.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fchalice.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -50,6 +50,7 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.app = Chalice(app_name=\"TheStackBadger\")\n "
            },
            {
                "sha": "14abd5e4af50c8e1d3c2d14fa50cdc52bc58a70e",
                "filename": "tests/http/clients/channels.py",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fchannels.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fchannels.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fchannels.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -139,6 +139,7 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.ws_app = DebuggableGraphQLTransportWSConsumer.as_asgi(\n             schema=schema,\n@@ -151,6 +152,7 @@ def __init__(\n             graphql_ide=graphql_ide,\n             allow_queries_via_get=allow_queries_via_get,\n             result_override=result_override,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n \n     def create_app(self, **kwargs: Any) -> None:\n@@ -260,13 +262,15 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.http_app = DebuggableSyncGraphQLHTTPConsumer.as_asgi(\n             schema=schema,\n             graphiql=graphiql,\n             graphql_ide=graphql_ide,\n             allow_queries_via_get=allow_queries_via_get,\n             result_override=result_override,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n \n "
            },
            {
                "sha": "a871d7b63bc12e7223f4e3ff3c98e17afa065de9",
                "filename": "tests/http/clients/django.py",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fdjango.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fdjango.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fdjango.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -48,11 +48,13 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.graphiql = graphiql\n         self.graphql_ide = graphql_ide\n         self.allow_queries_via_get = allow_queries_via_get\n         self.result_override = result_override\n+        self.multipart_uploads_enabled = multipart_uploads_enabled\n \n     def _get_header_name(self, key: str) -> str:\n         return f\"HTTP_{key.upper().replace('-', '_')}\"\n@@ -75,6 +77,7 @@ async def _do_request(self, request: RequestFactory) -> Response:\n             graphql_ide=self.graphql_ide,\n             allow_queries_via_get=self.allow_queries_via_get,\n             result_override=self.result_override,\n+            multipart_uploads_enabled=self.multipart_uploads_enabled,\n         )\n \n         try:"
            },
            {
                "sha": "cddc43032f05d6cc5db2f7b3b7f806e1cf8b136d",
                "filename": "tests/http/clients/fastapi.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Ffastapi.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Ffastapi.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Ffastapi.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -86,6 +86,7 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.app = FastAPI()\n \n@@ -97,6 +98,7 @@ def __init__(\n             root_value_getter=get_root_value,\n             allow_queries_via_get=allow_queries_via_get,\n             keep_alive=False,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n         graphql_app.result_override = result_override\n         self.app.include_router(graphql_app, prefix=\"/graphql\")"
            },
            {
                "sha": "7da42bbaffaf4a0b3d1dde8462c673f40ecbc6fc",
                "filename": "tests/http/clients/flask.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fflask.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fflask.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fflask.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -61,6 +61,7 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.app = Flask(__name__)\n         self.app.debug = True\n@@ -72,6 +73,7 @@ def __init__(\n             graphql_ide=graphql_ide,\n             allow_queries_via_get=allow_queries_via_get,\n             result_override=result_override,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n \n         self.app.add_url_rule("
            },
            {
                "sha": "0b99b437296c2fabd05fd117d4abffbb686a5dea",
                "filename": "tests/http/clients/litestar.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Flitestar.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Flitestar.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Flitestar.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -59,12 +59,14 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.create_app(\n             graphiql=graphiql,\n             graphql_ide=graphql_ide,\n             allow_queries_via_get=allow_queries_via_get,\n             result_override=result_override,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n \n     def create_app(self, result_override: ResultOverrideFunction = None, **kwargs: Any):"
            },
            {
                "sha": "d9a184dfd40afe5210fb93a24af6a8e3e14dfa0b",
                "filename": "tests/http/clients/quart.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fquart.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fquart.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fquart.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -54,6 +54,7 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.app = Quart(__name__)\n         self.app.debug = True\n@@ -65,6 +66,7 @@ def __init__(\n             graphql_ide=graphql_ide,\n             allow_queries_via_get=allow_queries_via_get,\n             result_override=result_override,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n \n         self.app.add_url_rule("
            },
            {
                "sha": "8edc351db9cb2f9ec966361d84d49319d6cd8c5e",
                "filename": "tests/http/clients/sanic.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fsanic.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Fclients%2Fsanic.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Fclients%2Fsanic.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -53,6 +53,7 @@ def __init__(\n         graphql_ide: Optional[GraphQL_IDE] = \"graphiql\",\n         allow_queries_via_get: bool = True,\n         result_override: ResultOverrideFunction = None,\n+        multipart_uploads_enabled: bool = False,\n     ):\n         self.app = Sanic(\n             f\"test_{int(randint(0, 1000))}\",  # noqa: S311\n@@ -63,6 +64,7 @@ def __init__(\n             graphql_ide=graphql_ide,\n             allow_queries_via_get=allow_queries_via_get,\n             result_override=result_override,\n+            multipart_uploads_enabled=multipart_uploads_enabled,\n         )\n         self.app.add_route(\n             view,"
            },
            {
                "sha": "7a991db846eeebace450a50c9ae12ebed2714638",
                "filename": "tests/http/test_upload.py",
                "status": "modified",
                "additions": 47,
                "deletions": 17,
                "changes": 64,
                "blob_url": "https://github.com/strawberry-graphql/strawberry/blob/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Ftest_upload.py",
                "raw_url": "https://github.com/strawberry-graphql/strawberry/raw/37265b230e511480a9ceace492f9f6a484be1387/tests%2Fhttp%2Ftest_upload.py",
                "contents_url": "https://api.github.com/repos/strawberry-graphql/strawberry/contents/tests%2Fhttp%2Ftest_upload.py?ref=37265b230e511480a9ceace492f9f6a484be1387",
                "patch": "@@ -20,7 +20,18 @@ def http_client(http_client_class: Type[HttpClient]) -> HttpClient:\n     return http_client_class()\n \n \n-async def test_upload(http_client: HttpClient):\n+@pytest.fixture()\n+def enabled_http_client(http_client_class: Type[HttpClient]) -> HttpClient:\n+    with contextlib.suppress(ImportError):\n+        from .clients.chalice import ChaliceHttpClient\n+\n+        if http_client_class is ChaliceHttpClient:\n+            pytest.xfail(reason=\"Chalice does not support uploads\")\n+\n+    return http_client_class(multipart_uploads_enabled=True)\n+\n+\n+async def test_multipart_uploads_are_disabled_by_default(http_client: HttpClient):\n     f = BytesIO(b\"strawberry\")\n \n     query = \"\"\"\n@@ -35,16 +46,35 @@ async def test_upload(http_client: HttpClient):\n         files={\"textFile\": f},\n     )\n \n+    assert response.status_code == 400\n+    assert response.data == b\"Unsupported content type\"\n+\n+\n+async def test_upload(enabled_http_client: HttpClient):\n+    f = BytesIO(b\"strawberry\")\n+\n+    query = \"\"\"\n+    mutation($textFile: Upload!) {\n+        readText(textFile: $textFile)\n+    }\n+    \"\"\"\n+\n+    response = await enabled_http_client.query(\n+        query,\n+        variables={\"textFile\": None},\n+        files={\"textFile\": f},\n+    )\n+\n     assert response.json.get(\"errors\") is None\n     assert response.json[\"data\"] == {\"readText\": \"strawberry\"}\n \n \n-async def test_file_list_upload(http_client: HttpClient):\n+async def test_file_list_upload(enabled_http_client: HttpClient):\n     query = \"mutation($files: [Upload!]!) { readFiles(files: $files) }\"\n     file1 = BytesIO(b\"strawberry1\")\n     file2 = BytesIO(b\"strawberry2\")\n \n-    response = await http_client.query(\n+    response = await enabled_http_client.query(\n         query=query,\n         variables={\"files\": [None, None]},\n         files={\"file1\": file1, \"file2\": file2},\n@@ -57,12 +87,12 @@ async def test_file_list_upload(http_client: HttpClient):\n     assert data[\"readFiles\"][1] == \"strawberry2\"\n \n \n-async def test_nested_file_list(http_client: HttpClient):\n+async def test_nested_file_list(enabled_http_client: HttpClient):\n     query = \"mutation($folder: FolderInput!) { readFolder(folder: $folder) }\"\n     file1 = BytesIO(b\"strawberry1\")\n     file2 = BytesIO(b\"strawberry2\")\n \n-    response = await http_client.query(\n+    response = await enabled_http_client.query(\n         query=query,\n         variables={\"folder\": {\"files\": [None, None]}},\n         files={\"file1\": file1, \"file2\": file2},\n@@ -74,7 +104,7 @@ async def test_nested_file_list(http_client: HttpClient):\n     assert data[\"readFolder\"][1] == \"strawberry2\"\n \n \n-async def test_upload_single_and_list_file_together(http_client: HttpClient):\n+async def test_upload_single_and_list_file_together(enabled_http_client: HttpClient):\n     query = \"\"\"\n         mutation($files: [Upload!]!, $textFile: Upload!) {\n             readFiles(files: $files)\n@@ -85,7 +115,7 @@ async def test_upload_single_and_list_file_together(http_client: HttpClient):\n     file2 = BytesIO(b\"strawberry2\")\n     file3 = BytesIO(b\"strawberry3\")\n \n-    response = await http_client.query(\n+    response = await enabled_http_client.query(\n         query=query,\n         variables={\"files\": [None, None], \"textFile\": None},\n         files={\"file1\": file1, \"file2\": file2, \"textFile\": file3},\n@@ -98,15 +128,15 @@ async def test_upload_single_and_list_file_together(http_client: HttpClient):\n     assert data[\"readText\"] == \"strawberry3\"\n \n \n-async def test_upload_invalid_query(http_client: HttpClient):\n+async def test_upload_invalid_query(enabled_http_client: HttpClient):\n     f = BytesIO(b\"strawberry\")\n \n     query = \"\"\"\n     mutation($textFile: Upload!) {\n         readT\n     \"\"\"\n \n-    response = await http_client.query(\n+    response = await enabled_http_client.query(\n         query,\n         variables={\"textFile\": None},\n         files={\"textFile\": f},\n@@ -122,7 +152,7 @@ async def test_upload_invalid_query(http_client: HttpClient):\n     ]\n \n \n-async def test_upload_missing_file(http_client: HttpClient):\n+async def test_upload_missing_file(enabled_http_client: HttpClient):\n     f = BytesIO(b\"strawberry\")\n \n     query = \"\"\"\n@@ -131,7 +161,7 @@ async def test_upload_missing_file(http_client: HttpClient):\n     }\n     \"\"\"\n \n-    response = await http_client.query(\n+    response = await enabled_http_client.query(\n         query,\n         variables={\"textFile\": None},\n         # using the wrong name to simulate a missing file\n@@ -155,7 +185,7 @@ def value(self) -> bytes:\n         return self.buffer.getvalue()\n \n \n-async def test_extra_form_data_fields_are_ignored(http_client: HttpClient):\n+async def test_extra_form_data_fields_are_ignored(enabled_http_client: HttpClient):\n     query = \"\"\"mutation($textFile: Upload!) {\n         readText(textFile: $textFile)\n     }\"\"\"\n@@ -175,7 +205,7 @@ async def test_extra_form_data_fields_are_ignored(http_client: HttpClient):\n \n     data, header = encode_multipart_formdata(fields)\n \n-    response = await http_client.post(\n+    response = await enabled_http_client.post(\n         url=\"/graphql\",\n         data=data,\n         headers={\n@@ -188,9 +218,9 @@ async def test_extra_form_data_fields_are_ignored(http_client: HttpClient):\n     assert response.json[\"data\"] == {\"readText\": \"strawberry\"}\n \n \n-async def test_sending_invalid_form_data(http_client: HttpClient):\n+async def test_sending_invalid_form_data(enabled_http_client: HttpClient):\n     headers = {\"content-type\": \"multipart/form-data; boundary=----fake\"}\n-    response = await http_client.post(\"/graphql\", headers=headers)\n+    response = await enabled_http_client.post(\"/graphql\", headers=headers)\n \n     assert response.status_code == 400\n     # TODO: consolidate this, it seems only AIOHTTP returns the second error\n@@ -202,7 +232,7 @@ async def test_sending_invalid_form_data(http_client: HttpClient):\n \n \n @pytest.mark.aiohttp\n-async def test_sending_invalid_json_body(http_client: HttpClient):\n+async def test_sending_invalid_json_body(enabled_http_client: HttpClient):\n     f = BytesIO(b\"strawberry\")\n     operations = \"}\"\n     file_map = json.dumps({\"textFile\": [\"variables.textFile\"]})\n@@ -215,7 +245,7 @@ async def test_sending_invalid_json_body(http_client: HttpClient):\n \n     data, header = encode_multipart_formdata(fields)\n \n-    response = await http_client.post(\n+    response = await enabled_http_client.post(\n         \"/graphql\",\n         data=data,\n         headers={"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/grafana/agent/commits/91bab2c05906938d3f8e1e3c61a863f037985299",
        "url": "https://api.github.com/repos/grafana/agent/commits/91bab2c05906938d3f8e1e3c61a863f037985299",
        "html_url": "https://github.com/grafana/agent/commit/91bab2c05906938d3f8e1e3c61a863f037985299",
        "message": "fix win registry (#7045)",
        "files": [
            {
                "sha": "07a424ddbead7028089e7ba88fc702de0113584b",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/grafana/agent/blob/91bab2c05906938d3f8e1e3c61a863f037985299/CHANGELOG.md",
                "raw_url": "https://github.com/grafana/agent/raw/91bab2c05906938d3f8e1e3c61a863f037985299/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/grafana/agent/contents/CHANGELOG.md?ref=91bab2c05906938d3f8e1e3c61a863f037985299",
                "patch": "@@ -7,6 +7,13 @@ This document contains a historical list of changes between releases. Only\n changes that impact end-user behavior are listed; changes to documentation or\n internal API changes are not present.\n \n+v0.43.3 (2024-09-26)\n+-------------------------\n+\n+### Bugfixes\n+\n+- Windows installer: Don't quote Alloy's binary path in the Windows Registry. (@jkroepke)\n+\n v0.43.2 (2024-09-25)\n -------------------------\n "
            },
            {
                "sha": "0070f1a14d74c4649d84694b350c023e7e86336f",
                "filename": "packaging/grafana-agent-flow/windows/install_script.nsis",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/grafana/agent/blob/91bab2c05906938d3f8e1e3c61a863f037985299/packaging%2Fgrafana-agent-flow%2Fwindows%2Finstall_script.nsis",
                "raw_url": "https://github.com/grafana/agent/raw/91bab2c05906938d3f8e1e3c61a863f037985299/packaging%2Fgrafana-agent-flow%2Fwindows%2Finstall_script.nsis",
                "contents_url": "https://api.github.com/repos/grafana/agent/contents/packaging%2Fgrafana-agent-flow%2Fwindows%2Finstall_script.nsis?ref=91bab2c05906938d3f8e1e3c61a863f037985299",
                "patch": "@@ -135,7 +135,7 @@ Function InitializeRegistry\n   nsExec::ExecToLog 'Reg.exe query \"${REGKEY}\" /reg:64 /ve'\n   Pop $0\n   ${If} $0 == 1\n-    nsExec::ExecToLog 'Reg.exe add \"${REGKEY}\" /reg:64 /ve /d \"\\\"$INSTDIR\\grafana-agent-flow-windows-amd64.exe\\\"\"'\n+    nsExec::ExecToLog 'Reg.exe add \"${REGKEY}\" /reg:64 /ve /d \"$INSTDIR\\grafana-agent-flow-windows-amd64.exe\"'\n     Pop $0 # Ignore return result\n   ${EndIf}\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/grafana/alloy/commits/f14249012fd970d3fd73604e6fff9b6c7990a9bb",
        "url": "https://api.github.com/repos/grafana/alloy/commits/f14249012fd970d3fd73604e6fff9b6c7990a9bb",
        "html_url": "https://github.com/grafana/alloy/commit/f14249012fd970d3fd73604e6fff9b6c7990a9bb",
        "message": "[release/v1.4] Fix Windows installer (#1767)\n\n* fix(installer): do not quote servicepath in registy (#1765)\r\n\r\n* Update VERSION\r\n\r\n---------\r\n\r\nCo-authored-by: Jan-Otto Kr\u00f6pke <joe@cloudeteer.de>",
        "files": [
            {
                "sha": "ff0c277f1551a4934f6fc1bb82dd139071ee26e6",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/grafana/alloy/blob/f14249012fd970d3fd73604e6fff9b6c7990a9bb/CHANGELOG.md",
                "raw_url": "https://github.com/grafana/alloy/raw/f14249012fd970d3fd73604e6fff9b6c7990a9bb/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/grafana/alloy/contents/CHANGELOG.md?ref=f14249012fd970d3fd73604e6fff9b6c7990a9bb",
                "patch": "@@ -7,6 +7,13 @@ This document contains a historical list of changes between releases. Only\n changes that impact end-user behavior are listed; changes to documentation or\n internal API changes are not present.\n \n+v1.4.1\n+-----------------\n+\n+### Bugfixes\n+\n+- Windows installer: Don't quote Alloy's binary path in the Windows Registry. (@jkroepke)\n+\n v1.4.0\n -----------------\n "
            },
            {
                "sha": "92d0fee58925630f997d09d6e5367c125b79c2f0",
                "filename": "VERSION",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/grafana/alloy/blob/f14249012fd970d3fd73604e6fff9b6c7990a9bb/VERSION",
                "raw_url": "https://github.com/grafana/alloy/raw/f14249012fd970d3fd73604e6fff9b6c7990a9bb/VERSION",
                "contents_url": "https://api.github.com/repos/grafana/alloy/contents/VERSION?ref=f14249012fd970d3fd73604e6fff9b6c7990a9bb",
                "patch": "@@ -20,4 +20,4 @@\n #\n # Lines starting with \"#\" and blank lines are ignored.\n \n-v1.4.0\n+v1.4.1"
            },
            {
                "sha": "f7ce81a0686975c48f75d7640a606aa02345014d",
                "filename": "docs/sources/_index.md",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/grafana/alloy/blob/f14249012fd970d3fd73604e6fff9b6c7990a9bb/docs%2Fsources%2F_index.md",
                "raw_url": "https://github.com/grafana/alloy/raw/f14249012fd970d3fd73604e6fff9b6c7990a9bb/docs%2Fsources%2F_index.md",
                "contents_url": "https://api.github.com/repos/grafana/alloy/contents/docs%2Fsources%2F_index.md?ref=f14249012fd970d3fd73604e6fff9b6c7990a9bb",
                "patch": "@@ -4,7 +4,7 @@ title: Grafana Alloy\n description: Grafana Alloy is a a vendor-neutral distribution of the OTel Collector\n weight: 350\n cascade:\n-  ALLOY_RELEASE: v1.4.0\n+  ALLOY_RELEASE: v1.4.1\n   OTEL_VERSION: v0.105.0\n   FULL_PRODUCT_NAME: Grafana Alloy\n   PRODUCT_NAME: Alloy"
            },
            {
                "sha": "8c3ad4c4e7681566279cd46dcce419dd9366a65f",
                "filename": "packaging/windows/install_script.nsis",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/grafana/alloy/blob/f14249012fd970d3fd73604e6fff9b6c7990a9bb/packaging%2Fwindows%2Finstall_script.nsis",
                "raw_url": "https://github.com/grafana/alloy/raw/f14249012fd970d3fd73604e6fff9b6c7990a9bb/packaging%2Fwindows%2Finstall_script.nsis",
                "contents_url": "https://api.github.com/repos/grafana/alloy/contents/packaging%2Fwindows%2Finstall_script.nsis?ref=f14249012fd970d3fd73604e6fff9b6c7990a9bb",
                "patch": "@@ -156,7 +156,7 @@ Function InitializeRegistry\n   nsExec::ExecToLog 'Reg.exe query \"${REGKEY}\" /reg:64 /ve'\n   Pop $0\n   ${If} $0 == 1\n-    nsExec::ExecToLog 'Reg.exe add \"${REGKEY}\" /reg:64 /ve /d  \"\\\"$INSTDIR\\alloy-windows-amd64.exe\\\"\"'\n+    nsExec::ExecToLog 'Reg.exe add \"${REGKEY}\" /reg:64 /ve /d  \"$INSTDIR\\alloy-windows-amd64.exe\"'\n     Pop $0 # Ignore return result\n   ${EndIf}\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/grafana/alloy/commits/88e779887690954c009503598a3f4bf563cb6596",
        "url": "https://api.github.com/repos/grafana/alloy/commits/88e779887690954c009503598a3f4bf563cb6596",
        "html_url": "https://github.com/grafana/alloy/commit/88e779887690954c009503598a3f4bf563cb6596",
        "message": "[release/v1.3] Fix Windows installer (#1768)\n\n* fix(installer): do not quote servicepath in registy (#1765)\r\n\r\n* Update VERSION file\r\n\r\n---------\r\n\r\nCo-authored-by: Jan-Otto Kr\u00f6pke <joe@cloudeteer.de>",
        "files": [
            {
                "sha": "fe3a2eaf9eb338aeee51798ae7e449308b18b37a",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/grafana/alloy/blob/88e779887690954c009503598a3f4bf563cb6596/CHANGELOG.md",
                "raw_url": "https://github.com/grafana/alloy/raw/88e779887690954c009503598a3f4bf563cb6596/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/grafana/alloy/contents/CHANGELOG.md?ref=88e779887690954c009503598a3f4bf563cb6596",
                "patch": "@@ -7,6 +7,13 @@ This document contains a historical list of changes between releases. Only\n changes that impact end-user behavior are listed; changes to documentation or\n internal API changes are not present.\n \n+v1.3.4\n+-----------------\n+\n+### Bugfixes\n+\n+- Windows installer: Don't quote Alloy's binary path in the Windows Registry. (@jkroepke)\n+\n v1.3.3\n -----------------\n "
            },
            {
                "sha": "d61d34aa630c3774855593db711f93ebad8c84d3",
                "filename": "VERSION",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/grafana/alloy/blob/88e779887690954c009503598a3f4bf563cb6596/VERSION",
                "raw_url": "https://github.com/grafana/alloy/raw/88e779887690954c009503598a3f4bf563cb6596/VERSION",
                "contents_url": "https://api.github.com/repos/grafana/alloy/contents/VERSION?ref=88e779887690954c009503598a3f4bf563cb6596",
                "patch": "@@ -20,4 +20,4 @@\n #\n # Lines starting with \"#\" and blank lines are ignored.\n \n-v1.3.3\n+v1.3.4"
            },
            {
                "sha": "58be26d42dce390c63694c16eb6b2e14c45f36c0",
                "filename": "docs/sources/_index.md",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/grafana/alloy/blob/88e779887690954c009503598a3f4bf563cb6596/docs%2Fsources%2F_index.md",
                "raw_url": "https://github.com/grafana/alloy/raw/88e779887690954c009503598a3f4bf563cb6596/docs%2Fsources%2F_index.md",
                "contents_url": "https://api.github.com/repos/grafana/alloy/contents/docs%2Fsources%2F_index.md?ref=88e779887690954c009503598a3f4bf563cb6596",
                "patch": "@@ -4,7 +4,7 @@ title: Grafana Alloy\n description: Grafana Alloy is a a vendor-neutral distribution of the OTel Collector\n weight: 350\n cascade:\n-  ALLOY_RELEASE: v1.3.3\n+  ALLOY_RELEASE: v1.3.4\n   OTEL_VERSION: v0.105.0\n   FULL_PRODUCT_NAME: Grafana Alloy\n   PRODUCT_NAME: Alloy"
            },
            {
                "sha": "8c3ad4c4e7681566279cd46dcce419dd9366a65f",
                "filename": "packaging/windows/install_script.nsis",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/grafana/alloy/blob/88e779887690954c009503598a3f4bf563cb6596/packaging%2Fwindows%2Finstall_script.nsis",
                "raw_url": "https://github.com/grafana/alloy/raw/88e779887690954c009503598a3f4bf563cb6596/packaging%2Fwindows%2Finstall_script.nsis",
                "contents_url": "https://api.github.com/repos/grafana/alloy/contents/packaging%2Fwindows%2Finstall_script.nsis?ref=88e779887690954c009503598a3f4bf563cb6596",
                "patch": "@@ -156,7 +156,7 @@ Function InitializeRegistry\n   nsExec::ExecToLog 'Reg.exe query \"${REGKEY}\" /reg:64 /ve'\n   Pop $0\n   ${If} $0 == 1\n-    nsExec::ExecToLog 'Reg.exe add \"${REGKEY}\" /reg:64 /ve /d  \"\\\"$INSTDIR\\alloy-windows-amd64.exe\\\"\"'\n+    nsExec::ExecToLog 'Reg.exe add \"${REGKEY}\" /reg:64 /ve /d  \"$INSTDIR\\alloy-windows-amd64.exe\"'\n     Pop $0 # Ignore return result\n   ${EndIf}\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/incubator-answer/commits/c3a17046c6c3be1cec16ba49d07d9f7742b7260f",
        "url": "https://api.github.com/repos/apache/answer/commits/c3a17046c6c3be1cec16ba49d07d9f7742b7260f",
        "html_url": "https://github.com/apache/answer/commit/c3a17046c6c3be1cec16ba49d07d9f7742b7260f",
        "message": "fix: gavatar use sha256 for hash",
        "files": [
            {
                "sha": "8a087428c7271f5c2e9a5a7f1348d9831b396d2f",
                "filename": "ui/package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/answer/blob/c3a17046c6c3be1cec16ba49d07d9f7742b7260f/ui%2Fpackage.json",
                "raw_url": "https://github.com/apache/answer/raw/c3a17046c6c3be1cec16ba49d07d9f7742b7260f/ui%2Fpackage.json",
                "contents_url": "https://api.github.com/repos/apache/answer/contents/ui%2Fpackage.json?ref=c3a17046c6c3be1cec16ba49d07d9f7742b7260f",
                "patch": "@@ -31,9 +31,9 @@\n     \"diff\": \"^5.1.0\",\n     \"front-matter\": \"^4.0.2\",\n     \"i18next\": \"^21.9.0\",\n+    \"js-sha256\": \"0.11.0\",\n     \"lodash\": \"^4.17.21\",\n     \"marked\": \"^4.0.19\",\n-    \"md5\": \"^2.3.0\",\n     \"next-share\": \"^0.18.1\",\n     \"qrcode\": \"^1.5.1\",\n     \"qs\": \"^6.11.0\","
            },
            {
                "sha": "77bbee2d428a9e654cae3eab7ffc3b3ae4d3069a",
                "filename": "ui/pnpm-lock.yaml",
                "status": "modified",
                "additions": 7,
                "deletions": 23,
                "changes": 30,
                "blob_url": "https://github.com/apache/answer/blob/c3a17046c6c3be1cec16ba49d07d9f7742b7260f/ui%2Fpnpm-lock.yaml",
                "raw_url": "https://github.com/apache/answer/raw/c3a17046c6c3be1cec16ba49d07d9f7742b7260f/ui%2Fpnpm-lock.yaml",
                "contents_url": "https://api.github.com/repos/apache/answer/contents/ui%2Fpnpm-lock.yaml?ref=c3a17046c6c3be1cec16ba49d07d9f7742b7260f",
                "patch": "@@ -53,15 +53,15 @@ importers:\n       i18next:\n         specifier: ^21.9.0\n         version: 21.9.2\n+      js-sha256:\n+        specifier: 0.11.0\n+        version: 0.11.0\n       lodash:\n         specifier: ^4.17.21\n         version: 4.17.21\n       marked:\n         specifier: ^4.0.19\n         version: 4.1.0\n-      md5:\n-        specifier: ^2.3.0\n-        version: 2.3.0\n       next-share:\n         specifier: ^0.18.1\n         version: 0.18.1(react-dom@18.2.0)(react-scripts@5.0.1)(react@18.2.0)\n@@ -4642,10 +4642,6 @@ packages:\n     resolution: {integrity: sha512-oSvEeo6ZUD7NepqAat3RqoucZ5SeqLJgOvVIwkafu6IP3V0pO38s/ypdVUmDDK6qIIHNlYHJAKX9E7R7HoKElw==}\n     engines: {node: '>=12.20'}\n \n-  /charenc@0.0.2:\n-    resolution: {integrity: sha512-yrLQ/yVUFXkzg7EDQsPieE/53+0RlaWTs+wBrvW36cyilJ2SaDWfl4Yj7MtLTXleV9uEKefbAGUPv2/iWSooRA==}\n-    dev: false\n-\n   /check-types@11.1.2:\n     resolution: {integrity: sha512-tzWzvgePgLORb9/3a0YenggReLKAIb2owL03H2Xdoe5pKcUyWRSEQ8xfCar8t2SIAuEDwtmx2da1YB52YuHQMQ==}\n \n@@ -4977,10 +4973,6 @@ packages:\n       shebang-command: 2.0.0\n       which: 2.0.2\n \n-  /crypt@0.0.2:\n-    resolution: {integrity: sha512-mCxBlsHFYh9C+HVpiEacem8FEBnMXgU9gy4zmNC+SXAZNB/1idgp/aulFJ4FgCi7GPEVbfyng092GqL2k2rmow==}\n-    dev: false\n-\n   /crypto-random-string@2.0.0:\n     resolution: {integrity: sha512-v1plID3y9r/lPhviJ1wrXpLeyUIGAZ2SHNYTEapm7/8A9nLPoyvVp3RK/EPFqn5kEznyWgYZNsRtYYIWbuG8KA==}\n     engines: {node: '>=8'}\n@@ -7207,10 +7199,6 @@ packages:\n       call-bind: 1.0.5\n       has-tostringtag: 1.0.0\n \n-  /is-buffer@1.1.6:\n-    resolution: {integrity: sha512-NcdALwpXkTm5Zvvbk7owOUSvVvBKDgKP5/ewfXEznmQFfs4ZRmanOeKBTjRVjka3QFoN6XJ+9F3USqfHqTaU5w==}\n-    dev: false\n-\n   /is-callable@1.2.6:\n     resolution: {integrity: sha512-krO72EO2NptOGAX2KYyqbP9vYMlNAXdB53rq6f8LXY6RY7JdSR/3BD6wLUlPHSAesmY9vstNrjvqGaCiRK/91Q==}\n     engines: {node: '>= 0.4'}\n@@ -8017,6 +8005,10 @@ packages:\n       - ts-node\n       - utf-8-validate\n \n+  /js-sha256@0.11.0:\n+    resolution: {integrity: sha512-6xNlKayMZvds9h1Y1VWc0fQHQ82BxTXizWPEtEeGvmOUYpBRy4gbWroHLpzowe6xiQhHpelCQiE7HEdznyBL9Q==}\n+    dev: false\n+\n   /js-tokens@4.0.0:\n     resolution: {integrity: sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==}\n \n@@ -8362,14 +8354,6 @@ packages:\n     hasBin: true\n     dev: false\n \n-  /md5@2.3.0:\n-    resolution: {integrity: sha512-T1GITYmFaKuO91vxyoQMFETst+O71VUPEU3ze5GNzDm0OWdP8v1ziTaAEPUr/3kLsY3Sftgz242A1SetQiDL7g==}\n-    dependencies:\n-      charenc: 0.0.2\n-      crypt: 0.0.2\n-      is-buffer: 1.1.6\n-    dev: false\n-\n   /mdn-data@2.0.14:\n     resolution: {integrity: sha512-dn6wd0uw5GsdswPFfsgMp5NSB0/aDe6fK94YJV/AJDYXL6HVLWBsxeq7js7Ad+mU2K9LAlwpk6kN2D5mwCPVow==}\n "
            },
            {
                "sha": "9af28ce6e1109d8c2fa327108735c127bcc2be0f",
                "filename": "ui/src/pages/Users/Settings/Profile/index.tsx",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/apache/answer/blob/c3a17046c6c3be1cec16ba49d07d9f7742b7260f/ui%2Fsrc%2Fpages%2FUsers%2FSettings%2FProfile%2Findex.tsx",
                "raw_url": "https://github.com/apache/answer/raw/c3a17046c6c3be1cec16ba49d07d9f7742b7260f/ui%2Fsrc%2Fpages%2FUsers%2FSettings%2FProfile%2Findex.tsx",
                "contents_url": "https://api.github.com/repos/apache/answer/contents/ui%2Fsrc%2Fpages%2FUsers%2FSettings%2FProfile%2Findex.tsx?ref=c3a17046c6c3be1cec16ba49d07d9f7742b7260f",
                "patch": "@@ -21,7 +21,7 @@ import React, { FormEvent, useState, useEffect } from 'react';\n import { Form, Button, Stack, ButtonGroup } from 'react-bootstrap';\n import { Trans, useTranslation } from 'react-i18next';\n \n-import MD5 from 'md5';\n+import { sha256 } from 'js-sha256';\n \n import type { FormDataType } from '@/common/interface';\n import { UploadImg, Avatar, Icon, ImgViewer } from '@/components';\n@@ -273,7 +273,7 @@ const Index: React.FC = () => {\n       setFormData({ ...formData });\n       if (res.e_mail) {\n         const str = res.e_mail.toLowerCase().trim();\n-        const hash = MD5(str);\n+        const hash = sha256(str);\n         setMailHash(hash);\n       }\n     });"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/concretecms/concretecms/commits/7c8ed0d1d9db0d7f6df7fa066e0858ea618451a5",
        "url": "https://api.github.com/repos/concretecms/concretecms/commits/7c8ed0d1d9db0d7f6df7fa066e0858ea618451a5",
        "html_url": "https://github.com/concretecms/concretecms/commit/7c8ed0d1d9db0d7f6df7fa066e0858ea618451a5",
        "message": "ix H1 2400810",
        "files": [
            {
                "sha": "ceb71f01c2c48db9bd2c7ecf558d5683def7c5a1",
                "filename": "concrete/views/dialogs/event/view_version.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/concretecms/concretecms/blob/7c8ed0d1d9db0d7f6df7fa066e0858ea618451a5/concrete%2Fviews%2Fdialogs%2Fevent%2Fview_version.php",
                "raw_url": "https://github.com/concretecms/concretecms/raw/7c8ed0d1d9db0d7f6df7fa066e0858ea618451a5/concrete%2Fviews%2Fdialogs%2Fevent%2Fview_version.php",
                "contents_url": "https://api.github.com/repos/concretecms/concretecms/contents/concrete%2Fviews%2Fdialogs%2Fevent%2Fview_version.php?ref=7c8ed0d1d9db0d7f6df7fa066e0858ea618451a5",
                "patch": "@@ -12,7 +12,7 @@\n     <?php if (!$version->isApproved()) { ?>\n         <div class=\"alert alert-info\"><?=t('This occurrence belongs to an event version that is not yet approved.')?></div>\n     <?php } ?>\n-    <h3><?=$version->getName()?></h3>\n+    <h3><?=h($version->getName())?></h3>\n \n     <?php\n     $repetitions = $version->getRepetitions();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/concretecms/concretecms/commits/d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c",
        "url": "https://api.github.com/repos/concretecms/concretecms/commits/d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c",
        "html_url": "https://github.com/concretecms/concretecms/commit/d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c",
        "message": "Merge pull request #12183 from aembler/misc-fixes-082224\n\nMisc fixes 082224",
        "files": [
            {
                "sha": "e08783465986d4a2760fb0de9b8e0a673ccaa738",
                "filename": "concrete/config/concrete.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/concretecms/concretecms/blob/d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c/concrete%2Fconfig%2Fconcrete.php",
                "raw_url": "https://github.com/concretecms/concretecms/raw/d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c/concrete%2Fconfig%2Fconcrete.php",
                "contents_url": "https://api.github.com/repos/concretecms/concretecms/contents/concrete%2Fconfig%2Fconcrete.php?ref=d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c",
                "patch": "@@ -6,8 +6,8 @@\n      *\n      * @var string\n      */\n-    'version' => '9.3.3',\n-    'version_installed' => '9.3.3',\n+    'version' => '9.3.4',\n+    'version_installed' => '9.3.4',\n     'version_db' => '20240711000000', // the key of the latest database migration\n \n     /*"
            },
            {
                "sha": "31c5d0c2ec611fd508d1e9e59747137b2281272f",
                "filename": "concrete/single_pages/dashboard/system/files/thumbnails.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/concretecms/concretecms/blob/d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c/concrete%2Fsingle_pages%2Fdashboard%2Fsystem%2Ffiles%2Fthumbnails.php",
                "raw_url": "https://github.com/concretecms/concretecms/raw/d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c/concrete%2Fsingle_pages%2Fdashboard%2Fsystem%2Ffiles%2Fthumbnails.php",
                "contents_url": "https://api.github.com/repos/concretecms/concretecms/contents/concrete%2Fsingle_pages%2Fdashboard%2Fsystem%2Ffiles%2Fthumbnails.php?ref=d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c",
                "patch": "@@ -120,7 +120,7 @@\n         <div class=\"form-group\">\n             <?= $form->label('ftSaveAreaBackgroundColor', t('Image Editor Background Color')); ?>\n             <div>\n-                <?= $form_color->output('ftSaveAreaBackgroundColor', $type->getSaveAreaBackgroundColor(), ['preferredFormat' => 'hex']); ?>\n+                <?= $form_color->output('ftSaveAreaBackgroundColor', h($type->getSaveAreaBackgroundColor()), ['preferredFormat' => 'hex']); ?>\n             </div>\n             <p class=\"help-block\"><?= t('Leave this empty to use a transparent background.'); ?></p>\n         </div>"
            },
            {
                "sha": "c7dbf037ba22a5ba2122c70f8051b79b634f96fe",
                "filename": "concrete/views/dialogs/event/view_version.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/concretecms/concretecms/blob/d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c/concrete%2Fviews%2Fdialogs%2Fevent%2Fview_version.php",
                "raw_url": "https://github.com/concretecms/concretecms/raw/d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c/concrete%2Fviews%2Fdialogs%2Fevent%2Fview_version.php",
                "contents_url": "https://api.github.com/repos/concretecms/concretecms/contents/concrete%2Fviews%2Fdialogs%2Fevent%2Fview_version.php?ref=d97b43b8dd0b5578b41d2ffb5b2186a44c2c772c",
                "patch": "@@ -12,7 +12,7 @@\n     <?php if (!$version->isApproved()) { ?>\n         <div class=\"alert alert-info\"><?=t('This occurrence belongs to an event version that is not yet approved.')?></div>\n     <?php } ?>\n-    <h3><?=$version->getName()?></h3>\n+    <h3><?=h($version->getName())?></h3>\n \n     <?php\n     $repetitions = $version->getRepetitions();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/concretecms/concretecms/commits/dbce253166f6b10ff3e0c09e50fd395370b8b065",
        "url": "https://api.github.com/repos/concretecms/concretecms/commits/dbce253166f6b10ff3e0c09e50fd395370b8b065",
        "html_url": "https://github.com/concretecms/concretecms/commit/dbce253166f6b10ff3e0c09e50fd395370b8b065",
        "message": "Fix H1 921527",
        "files": [
            {
                "sha": "dd6e3938239dde20aeb0523d585126b6142b655b",
                "filename": "concrete/single_pages/dashboard/system/files/thumbnails.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/concretecms/concretecms/blob/dbce253166f6b10ff3e0c09e50fd395370b8b065/concrete%2Fsingle_pages%2Fdashboard%2Fsystem%2Ffiles%2Fthumbnails.php",
                "raw_url": "https://github.com/concretecms/concretecms/raw/dbce253166f6b10ff3e0c09e50fd395370b8b065/concrete%2Fsingle_pages%2Fdashboard%2Fsystem%2Ffiles%2Fthumbnails.php",
                "contents_url": "https://api.github.com/repos/concretecms/concretecms/contents/concrete%2Fsingle_pages%2Fdashboard%2Fsystem%2Ffiles%2Fthumbnails.php?ref=dbce253166f6b10ff3e0c09e50fd395370b8b065",
                "patch": "@@ -120,7 +120,7 @@\n         <div class=\"form-group\">\n             <?= $form->label('ftSaveAreaBackgroundColor', t('Image Editor Background Color')); ?>\n             <div>\n-                <?= $form_color->output('ftSaveAreaBackgroundColor', $type->getSaveAreaBackgroundColor(), ['preferredFormat' => 'hex']); ?>\n+                <?= $form_color->output('ftSaveAreaBackgroundColor', h($type->getSaveAreaBackgroundColor()), ['preferredFormat' => 'hex']); ?>\n             </div>\n             <p class=\"help-block\"><?= t('Leave this empty to use a transparent background.'); ?></p>\n         </div>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/FlowiseAI/Flowise/commits/8375ebb4ec1ebb2b1295561cc0f63486a29f3fde",
        "url": "https://api.github.com/repos/FlowiseAI/Flowise/commits/8375ebb4ec1ebb2b1295561cc0f63486a29f3fde",
        "html_url": "https://github.com/FlowiseAI/Flowise/commit/8375ebb4ec1ebb2b1295561cc0f63486a29f3fde",
        "message": "Chore/update flowise embed version to 2.0.0 (#3205)\n\n* update flowise-embed version on lock file\r\n\r\n* add agent messages to share chatbot\r\n\r\n* Update pnpm-lock.yaml\r\n\r\n* update flowise-embed version\r\n\r\n* update flowise-embed to 1.3.9\r\n\r\n* update embed version to 2.0",
        "files": [
            {
                "sha": "14a8dc49974bde86602c49a1d662ad5336467293",
                "filename": "pnpm-lock.yaml",
                "status": "modified",
                "additions": 8,
                "deletions": 10,
                "changes": 18,
                "blob_url": "https://github.com/FlowiseAI/Flowise/blob/8375ebb4ec1ebb2b1295561cc0f63486a29f3fde/pnpm-lock.yaml",
                "raw_url": "https://github.com/FlowiseAI/Flowise/raw/8375ebb4ec1ebb2b1295561cc0f63486a29f3fde/pnpm-lock.yaml",
                "contents_url": "https://api.github.com/repos/FlowiseAI/Flowise/contents/pnpm-lock.yaml?ref=8375ebb4ec1ebb2b1295561cc0f63486a29f3fde",
                "patch": "@@ -658,10 +658,10 @@ importers:\n                 version: 16.4.5\n             flowise-embed:\n                 specifier: latest\n-                version: 1.3.13(bufferutil@4.0.8)(utf-8-validate@6.0.4)\n+                version: 2.0.0\n             flowise-embed-react:\n                 specifier: latest\n-                version: 1.0.2(@types/node@20.12.12)(flowise-embed@1.3.13(bufferutil@4.0.8)(utf-8-validate@6.0.4))(react-dom@18.2.0(react@18.2.0))(react@18.2.0)(sass@1.71.1)(terser@5.29.1)(typescript@5.5.2)\n+                version: 1.0.2(@types/node@20.12.12)(flowise-embed@2.0.0)(react-dom@18.2.0(react@18.2.0))(react@18.2.0)(sass@1.71.1)(terser@5.29.1)(typescript@5.5.2)\n             flowise-react-json-view:\n                 specifier: '*'\n                 version: 1.21.7(@types/react@18.2.65)(encoding@0.1.13)(react-dom@18.2.0(react@18.2.0))(react@18.2.0)\n@@ -8391,8 +8391,8 @@ packages:\n             flowise-embed: '*'\n             react: 18.x\n \n-    flowise-embed@1.3.13:\n-        resolution: { integrity: sha512-5RnmeIwus4X9cQawJnZdMYlgdYcC+aCkD8YGF3zRfyspoc+9N+zqyH9B7XKMf4ak/lcVA+fmkP2PkXyYetqUng== }\n+    flowise-embed@2.0.0:\n+        resolution: { integrity: sha512-HzkcDaakPwXPbyimm2dFcwh3947BevpY3GY1Zrynb6Wn2+6j0o/kmbYY8LzLUaNFiEWhnO+kW44i27rtVu5ryQ== }\n \n     flowise-react-json-view@1.21.7:\n         resolution: { integrity: sha512-oFjwtSLJkUWk6waLh8heCQ4o9b60FJRA2X8LefaZp5WaJvj/Rr2HILjk+ocf1JkfTcq8jc6t2jfIybg4leWsaQ== }\n@@ -26110,10 +26110,10 @@ snapshots:\n \n     flatted@3.3.1: {}\n \n-    flowise-embed-react@1.0.2(@types/node@20.12.12)(flowise-embed@1.3.13(bufferutil@4.0.8)(utf-8-validate@6.0.4))(react-dom@18.2.0(react@18.2.0))(react@18.2.0)(sass@1.71.1)(terser@5.29.1)(typescript@5.5.2):\n+    flowise-embed-react@1.0.2(@types/node@20.12.12)(flowise-embed@2.0.0)(react-dom@18.2.0(react@18.2.0))(react@18.2.0)(sass@1.71.1)(terser@5.29.1)(typescript@5.5.2):\n         dependencies:\n             '@ladle/react': 2.5.1(@types/node@20.12.12)(react-dom@18.2.0(react@18.2.0))(react@18.2.0)(sass@1.71.1)(terser@5.29.1)(typescript@5.5.2)\n-            flowise-embed: 1.3.13(bufferutil@4.0.8)(utf-8-validate@6.0.4)\n+            flowise-embed: 2.0.0\n             react: 18.2.0\n         transitivePeerDependencies:\n             - '@types/node'\n@@ -26127,21 +26127,19 @@ snapshots:\n             - terser\n             - typescript\n \n-    flowise-embed@1.3.13(bufferutil@4.0.8)(utf-8-validate@6.0.4):\n+    flowise-embed@2.0.0:\n         dependencies:\n             '@babel/core': 7.24.0\n+            '@microsoft/fetch-event-source': 2.0.1\n             '@ts-stack/markdown': 1.5.0\n             device-detector-js: 3.0.3\n             lodash: 4.17.21\n             prettier: 3.2.5\n-            socket.io-client: 4.7.4(bufferutil@4.0.8)(utf-8-validate@6.0.4)\n             solid-element: 1.7.0(solid-js@1.7.1)\n             solid-js: 1.7.1\n             zod: 3.23.8\n         transitivePeerDependencies:\n-            - bufferutil\n             - supports-color\n-            - utf-8-validate\n \n     flowise-react-json-view@1.21.7(@types/react@18.2.65)(encoding@0.1.13)(react-dom@18.2.0(react@18.2.0))(react@18.2.0):\n         dependencies:"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/commits/6a9645df41371cb69f251038d501ec87b1304c84",
        "url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/commits/6a9645df41371cb69f251038d501ec87b1304c84",
        "html_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/commit/6a9645df41371cb69f251038d501ec87b1304c84",
        "message": "add streaming of artifacts",
        "files": [
            {
                "sha": "9aed6d21fe4025ea2360ba05cb594b609532f0b8",
                "filename": "dist/components/Bot.d.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2FBot.d.ts",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2FBot.d.ts",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/dist%2Fcomponents%2FBot.d.ts?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -32,6 +32,7 @@ export type IAgentReasoning = {\n     agentName?: string;\n     messages?: string[];\n     usedTools?: any[];\n+    artifacts?: FileUpload[];\n     sourceDocuments?: any[];\n     instructions?: string;\n     nextAgent?: string;\n@@ -56,6 +57,7 @@ export type MessageType = {\n     sourceDocuments?: any;\n     fileAnnotations?: any;\n     fileUploads?: Partial<FileUpload>[];\n+    artifacts?: Partial<FileUpload>[];\n     agentReasoning?: IAgentReasoning[];\n     usedTools?: any[];\n     action?: IAction | null;"
            },
            {
                "sha": "e45e07abeafb81269e9a79150a2eca8e2b13247f",
                "filename": "dist/components/Bot.d.ts.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2FBot.d.ts.map",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2FBot.d.ts.map",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/dist%2Fcomponents%2FBot.d.ts.map?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -1 +1 @@\n-{\"version\":3,\"file\":\"Bot.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../src/components/Bot.tsx\"],\"names\":[],\"mappings\":\"AAEA,OAAO,EAML,kBAAkB,EACnB,MAAM,4BAA4B,CAAC;AAMpC,OAAO,EAAE,eAAe,EAAE,WAAW,EAAE,cAAc,EAAE,gBAAgB,EAAE,aAAa,EAAE,oBAAoB,EAAE,MAAM,yBAAyB,CAAC;AAK9I,OAAO,EAAE,WAAW,EAAE,MAAM,sDAAsD,CAAC;AASnF,MAAM,MAAM,SAAS,CAAC,CAAC,GAAG,WAAW,IAAI;IACvC,MAAM,EAAE,CAAC,CAAC;CACX,CAAC;AAEF,MAAM,MAAM,SAAS,CAAC,CAAC,GAAG,WAAW,IAAI;IACvC,cAAc,EAAE,MAAM,IAAI,CAAC;IAC3B,aAAa,EAAE,CAAC,CAAC;CAClB,CAAC;AAEF,KAAK,iBAAiB,GAAG;IACvB,SAAS,EAAE,MAAM,EAAE,CAAC;IACpB,aAAa,EAAE,MAAM,CAAC;CACvB,CAAC;AAEF,MAAM,MAAM,aAAa,GAAG;IAC1B,qBAAqB,EAAE,iBAAiB,EAAE,CAAC;IAC3C,sBAAsB,EAAE,iBAAiB,EAAE,CAAC;IAC5C,oBAAoB,EAAE,OAAO,CAAC;IAC9B,qBAAqB,EAAE,OAAO,CAAC;IAC/B,mBAAmB,EAAE,OAAO,CAAC;CAC9B,CAAC;AAEF,KAAK,eAAe,GAAG,MAAM,GAAG,WAAW,CAAC;AAE5C,KAAK,WAAW,GAAG;IACjB,IAAI,EAAE,eAAe,CAAC;IACtB,IAAI,EAAE,MAAM,CAAC;IACb,IAAI,EAAE,MAAM,CAAC;IACb,OAAO,EAAE,MAAM,CAAC;IAChB,IAAI,EAAE,MAAM,CAAC;CACd,CAAC;AAEF,KAAK,WAAW,GAAG,YAAY,GAAG,aAAa,GAAG,oBAAoB,GAAG,oBAAoB,CAAC;AAE9F,MAAM,MAAM,eAAe,GAAG;IAC5B,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,QAAQ,CAAC,EAAE,MAAM,EAAE,CAAC;IACpB,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;IAClB,eAAe,CAAC,EAAE,GAAG,EAAE,CAAC;IACxB,YAAY,CAAC,EAAE,MAAM,CAAC;IACtB,SAAS,CAAC,EAAE,MAAM,CAAC;CACpB,CAAC;AAEF,MAAM,MAAM,OAAO,GAAG;IACpB,EAAE,CAAC,EAAE,MAAM,CAAC;IACZ,QAAQ,CAAC,EAAE,KAAK,CAAC;QACf,IAAI,EAAE,MAAM,CAAC;QACb,KAAK,EAAE,MAAM,CAAC;KACf,CAAC,CAAC;IACH,OAAO,CAAC,EAAE;QACR,OAAO,EAAE,MAAM,CAAC;QAChB,MAAM,EAAE,MAAM,CAAC;QACf,SAAS,EAAE,GAAG,EAAE,CAAC;KAClB,CAAC;CACH,CAAC;AAEF,MAAM,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;AAEtD,MAAM,MAAM,WAAW,GAAG;IACxB,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,OAAO,EAAE,MAAM,CAAC;IAChB,IAAI,EAAE,WAAW,CAAC;IAClB,eAAe,CAAC,EAAE,GAAG,CAAC;IACtB,eAAe,CAAC,EAAE,GAAG,CAAC;IACtB,WAAW,CAAC,EAAE,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC;IACpC,cAAc,CAAC,EAAE,eAAe,EAAE,CAAC;IACnC,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;IAClB,MAAM,CAAC,EAAE,OAAO,GAAG,IAAI,CAAC;IACxB,MAAM,CAAC,EAAE,kBAAkB,CAAC;IAC5B,EAAE,CAAC,EAAE,MAAM,CAAC;CACb,CAAC;AAEF,KAAK,kBAAkB,GAAG,CAAC,QAAQ,EAAE,MAAM,GAAG,OAAO,GAAG,MAAM,GAAG,WAAW,EAAE,KAAK,IAAI,CAAC;AACxF,MAAM,MAAM,mBAAmB,GAAG,MAAM,CAAC,kBAAkB,GAAG,gBAAgB,GAAG,iBAAiB,EAAE,kBAAkB,CAAC,CAAC;AAExH,MAAM,MAAM,QAAQ,GAAG;IACrB,UAAU,EAAE,MAAM,CAAC;IACnB,OAAO,CAAC,EAAE,MAAM,CAAC;IACjB,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,WAAW,KAAK,OAAO,CAAC,IAAI,CAAC,CAAC;IACpD,cAAc,CAAC,EAAE,MAAM,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;IACzC,cAAc,CAAC,EAAE,MAAM,CAAC;IACxB,YAAY,CAAC,EAAE,MAAM,CAAC;IACtB,UAAU,CAAC,EAAE,eAAe,CAAC;IAC7B,WAAW,CAAC,EAAE,gBAAgB,CAAC;IAC/B,SAAS,CAAC,EAAE,cAAc,CAAC;IAC3B,QAAQ,CAAC,EAAE,aAAa,CAAC;IACzB,kBAAkB,CAAC,EAAE,MAAM,CAAC;IAC5B,oBAAoB,CAAC,EAAE,MAAM,CAAC;IAC9B,qBAAqB,CAAC,EAAE,MAAM,CAAC;IAC/B,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,SAAS,CAAC,EAAE,OAAO,CAAC;IACpB,iBAAiB,CAAC,EAAE,OAAO,CAAC;IAC5B,KAAK,CAAC,EAAE,MAAM,CAAC;IACf,cAAc,CAAC,EAAE,MAAM,CAAC;IACxB,QAAQ,CAAC,EAAE,MAAM,CAAC;IAClB,UAAU,CAAC,EAAE,OAAO,CAAC;IACrB,MAAM,CAAC,EAAE,WAAW,CAAC;IACrB,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,eAAe,CAAC,EAAE,mBAAmB,CAAC;IACtC,cAAc,CAAC,EAAE,MAAM,EAAE,CAAC;IAC1B,qBAAqB,CAAC,EAAE,MAAM,CAAC;IAC/B,iBAAiB,CAAC,EAAE,OAAO,CAAC;IAC5B,UAAU,CAAC,EAAE,oBAAoB,CAAC;CACnC,CAAC;AAEF,MAAM,MAAM,WAAW,GAAG;IACxB,MAAM,EAAE,OAAO,CAAC;IAChB,KAAK,CAAC,EAAE,MAAM,CAAC;IACf,IAAI,CAAC,EAAE,OAAO,CAAC;IACf,KAAK,CAAC,EAAE,OAAO,CAAC;IAChB,KAAK,CAAC,EAAE,OAAO,CAAC;IAChB,cAAc,CAAC,EAAE,MAAM,CAAC;CACzB,CAAC;AAoFF,eAAO,MAAM,GAAG,aAAc,QAAQ,GAAG;IAAE,KAAK,CAAC,EAAE,MAAM,CAAA;CAAE,mCAgrC1D,CAAC\"}\n\\ No newline at end of file\n+{\"version\":3,\"file\":\"Bot.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../src/components/Bot.tsx\"],\"names\":[],\"mappings\":\"AAEA,OAAO,EAML,kBAAkB,EACnB,MAAM,4BAA4B,CAAC;AAMpC,OAAO,EAAE,eAAe,EAAE,WAAW,EAAE,cAAc,EAAE,gBAAgB,EAAE,aAAa,EAAE,oBAAoB,EAAE,MAAM,yBAAyB,CAAC;AAK9I,OAAO,EAAE,WAAW,EAAE,MAAM,sDAAsD,CAAC;AASnF,MAAM,MAAM,SAAS,CAAC,CAAC,GAAG,WAAW,IAAI;IACvC,MAAM,EAAE,CAAC,CAAC;CACX,CAAC;AAEF,MAAM,MAAM,SAAS,CAAC,CAAC,GAAG,WAAW,IAAI;IACvC,cAAc,EAAE,MAAM,IAAI,CAAC;IAC3B,aAAa,EAAE,CAAC,CAAC;CAClB,CAAC;AAEF,KAAK,iBAAiB,GAAG;IACvB,SAAS,EAAE,MAAM,EAAE,CAAC;IACpB,aAAa,EAAE,MAAM,CAAC;CACvB,CAAC;AAEF,MAAM,MAAM,aAAa,GAAG;IAC1B,qBAAqB,EAAE,iBAAiB,EAAE,CAAC;IAC3C,sBAAsB,EAAE,iBAAiB,EAAE,CAAC;IAC5C,oBAAoB,EAAE,OAAO,CAAC;IAC9B,qBAAqB,EAAE,OAAO,CAAC;IAC/B,mBAAmB,EAAE,OAAO,CAAC;CAC9B,CAAC;AAEF,KAAK,eAAe,GAAG,MAAM,GAAG,WAAW,CAAC;AAE5C,KAAK,WAAW,GAAG;IACjB,IAAI,EAAE,eAAe,CAAC;IACtB,IAAI,EAAE,MAAM,CAAC;IACb,IAAI,EAAE,MAAM,CAAC;IACb,OAAO,EAAE,MAAM,CAAC;IAChB,IAAI,EAAE,MAAM,CAAC;CACd,CAAC;AAEF,KAAK,WAAW,GAAG,YAAY,GAAG,aAAa,GAAG,oBAAoB,GAAG,oBAAoB,CAAC;AAE9F,MAAM,MAAM,eAAe,GAAG;IAC5B,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,QAAQ,CAAC,EAAE,MAAM,EAAE,CAAC;IACpB,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;IAClB,SAAS,CAAC,EAAE,UAAU,EAAE,CAAC;IACzB,eAAe,CAAC,EAAE,GAAG,EAAE,CAAC;IACxB,YAAY,CAAC,EAAE,MAAM,CAAC;IACtB,SAAS,CAAC,EAAE,MAAM,CAAC;CACpB,CAAC;AAEF,MAAM,MAAM,OAAO,GAAG;IACpB,EAAE,CAAC,EAAE,MAAM,CAAC;IACZ,QAAQ,CAAC,EAAE,KAAK,CAAC;QACf,IAAI,EAAE,MAAM,CAAC;QACb,KAAK,EAAE,MAAM,CAAC;KACf,CAAC,CAAC;IACH,OAAO,CAAC,EAAE;QACR,OAAO,EAAE,MAAM,CAAC;QAChB,MAAM,EAAE,MAAM,CAAC;QACf,SAAS,EAAE,GAAG,EAAE,CAAC;KAClB,CAAC;CACH,CAAC;AAEF,MAAM,MAAM,UAAU,GAAG,IAAI,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;AAEtD,MAAM,MAAM,WAAW,GAAG;IACxB,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,OAAO,EAAE,MAAM,CAAC;IAChB,IAAI,EAAE,WAAW,CAAC;IAClB,eAAe,CAAC,EAAE,GAAG,CAAC;IACtB,eAAe,CAAC,EAAE,GAAG,CAAC;IACtB,WAAW,CAAC,EAAE,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC;IACpC,SAAS,CAAC,EAAE,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC;IAClC,cAAc,CAAC,EAAE,eAAe,EAAE,CAAC;IACnC,SAAS,CAAC,EAAE,GAAG,EAAE,CAAC;IAClB,MAAM,CAAC,EAAE,OAAO,GAAG,IAAI,CAAC;IACxB,MAAM,CAAC,EAAE,kBAAkB,CAAC;IAC5B,EAAE,CAAC,EAAE,MAAM,CAAC;CACb,CAAC;AAEF,KAAK,kBAAkB,GAAG,CAAC,QAAQ,EAAE,MAAM,GAAG,OAAO,GAAG,MAAM,GAAG,WAAW,EAAE,KAAK,IAAI,CAAC;AACxF,MAAM,MAAM,mBAAmB,GAAG,MAAM,CAAC,kBAAkB,GAAG,gBAAgB,GAAG,iBAAiB,EAAE,kBAAkB,CAAC,CAAC;AAExH,MAAM,MAAM,QAAQ,GAAG;IACrB,UAAU,EAAE,MAAM,CAAC;IACnB,OAAO,CAAC,EAAE,MAAM,CAAC;IACjB,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,WAAW,KAAK,OAAO,CAAC,IAAI,CAAC,CAAC;IACpD,cAAc,CAAC,EAAE,MAAM,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;IACzC,cAAc,CAAC,EAAE,MAAM,CAAC;IACxB,YAAY,CAAC,EAAE,MAAM,CAAC;IACtB,UAAU,CAAC,EAAE,eAAe,CAAC;IAC7B,WAAW,CAAC,EAAE,gBAAgB,CAAC;IAC/B,SAAS,CAAC,EAAE,cAAc,CAAC;IAC3B,QAAQ,CAAC,EAAE,aAAa,CAAC;IACzB,kBAAkB,CAAC,EAAE,MAAM,CAAC;IAC5B,oBAAoB,CAAC,EAAE,MAAM,CAAC;IAC9B,qBAAqB,CAAC,EAAE,MAAM,CAAC;IAC/B,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,SAAS,CAAC,EAAE,OAAO,CAAC;IACpB,iBAAiB,CAAC,EAAE,OAAO,CAAC;IAC5B,KAAK,CAAC,EAAE,MAAM,CAAC;IACf,cAAc,CAAC,EAAE,MAAM,CAAC;IACxB,QAAQ,CAAC,EAAE,MAAM,CAAC;IAClB,UAAU,CAAC,EAAE,OAAO,CAAC;IACrB,MAAM,CAAC,EAAE,WAAW,CAAC;IACrB,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,eAAe,CAAC,EAAE,mBAAmB,CAAC;IACtC,cAAc,CAAC,EAAE,MAAM,EAAE,CAAC;IAC1B,qBAAqB,CAAC,EAAE,MAAM,CAAC;IAC/B,iBAAiB,CAAC,EAAE,OAAO,CAAC;IAC5B,UAAU,CAAC,EAAE,oBAAoB,CAAC;CACnC,CAAC;AAEF,MAAM,MAAM,WAAW,GAAG;IACxB,MAAM,EAAE,OAAO,CAAC;IAChB,KAAK,CAAC,EAAE,MAAM,CAAC;IACf,IAAI,CAAC,EAAE,OAAO,CAAC;IACf,KAAK,CAAC,EAAE,OAAO,CAAC;IAChB,KAAK,CAAC,EAAE,OAAO,CAAC;IAChB,cAAc,CAAC,EAAE,MAAM,CAAC;CACzB,CAAC;AAoFF,eAAO,MAAM,GAAG,aAAc,QAAQ,GAAG;IAAE,KAAK,CAAC,EAAE,MAAM,CAAA;CAAE,mCA4rC1D,CAAC\"}\n\\ No newline at end of file"
            },
            {
                "sha": "b63c595ffa1898b65b97188c799006db9642ebed",
                "filename": "dist/components/bubbles/AgentReasoningBubble.d.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2Fbubbles%2FAgentReasoningBubble.d.ts",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2Fbubbles%2FAgentReasoningBubble.d.ts",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/dist%2Fcomponents%2Fbubbles%2FAgentReasoningBubble.d.ts?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -1,6 +1,11 @@\n+import { FileUpload } from '../Bot';\n type Props = {\n+    apiHost?: string;\n+    chatflowid: string;\n+    chatId: string;\n     agentName: string;\n     agentMessage: string;\n+    agentArtifacts?: FileUpload[];\n     backgroundColor?: string;\n     textColor?: string;\n     fontSize?: number;"
            },
            {
                "sha": "fa65ea4953d36e335ad139bdc94ecccca3a7b91e",
                "filename": "dist/components/bubbles/AgentReasoningBubble.d.ts.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2Fbubbles%2FAgentReasoningBubble.d.ts.map",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2Fbubbles%2FAgentReasoningBubble.d.ts.map",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/dist%2Fcomponents%2Fbubbles%2FAgentReasoningBubble.d.ts.map?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -1 +1 @@\n-{\"version\":3,\"file\":\"AgentReasoningBubble.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/components/bubbles/AgentReasoningBubble.tsx\"],\"names\":[],\"mappings\":\"AAGA,KAAK,KAAK,GAAG;IACX,SAAS,EAAE,MAAM,CAAC;IAClB,YAAY,EAAE,MAAM,CAAC;IACrB,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,QAAQ,CAAC,EAAE,MAAM,CAAC;CACnB,CAAC;AAQF,eAAO,MAAM,oBAAoB,UAAW,KAAK,mCA2BhD,CAAC\"}\n\\ No newline at end of file\n+{\"version\":3,\"file\":\"AgentReasoningBubble.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/components/bubbles/AgentReasoningBubble.tsx\"],\"names\":[],\"mappings\":\"AAEA,OAAO,EAAE,UAAU,EAAE,MAAM,QAAQ,CAAC;AAGpC,KAAK,KAAK,GAAG;IACX,OAAO,CAAC,EAAE,MAAM,CAAC;IACjB,UAAU,EAAE,MAAM,CAAC;IACnB,MAAM,EAAE,MAAM,CAAA;IACd,SAAS,EAAE,MAAM,CAAC;IAClB,YAAY,EAAE,MAAM,CAAC;IACrB,cAAc,CAAC,EAAE,UAAU,EAAE,CAAC;IAC9B,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,QAAQ,CAAC,EAAE,MAAM,CAAC;CACnB,CAAC;AAQF,eAAO,MAAM,oBAAoB,UAAW,KAAK,mCAmFhD,CAAC\"}\n\\ No newline at end of file"
            },
            {
                "sha": "747f65e7427529015bca55d0828f0a63af009cf9",
                "filename": "dist/components/bubbles/BotBubble.d.ts.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2Fbubbles%2FBotBubble.d.ts.map",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fcomponents%2Fbubbles%2FBotBubble.d.ts.map",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/dist%2Fcomponents%2Fbubbles%2FBotBubble.d.ts.map?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -1 +1 @@\n-{\"version\":3,\"file\":\"BotBubble.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/components/bubbles/BotBubble.tsx\"],\"names\":[],\"mappings\":\"AAIA,OAAO,EAAE,OAAO,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAC;AAO9C,KAAK,KAAK,GAAG;IACX,OAAO,EAAE,WAAW,CAAC;IACrB,UAAU,EAAE,MAAM,CAAC;IACnB,MAAM,EAAE,MAAM,CAAC;IACf,OAAO,CAAC,EAAE,MAAM,CAAC;IACjB,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,WAAW,KAAK,OAAO,CAAC,IAAI,CAAC,CAAC;IACpD,eAAe,CAAC,EAAE,GAAG,CAAC;IACtB,UAAU,CAAC,EAAE,OAAO,CAAC;IACrB,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,kBAAkB,CAAC,EAAE,OAAO,CAAC;IAC7B,QAAQ,CAAC,EAAE,MAAM,CAAC;IAClB,aAAa,CAAC,EAAE,MAAM,CAAC;IACvB,SAAS,EAAE,OAAO,CAAC;IACnB,iBAAiB,CAAC,EAAE,OAAO,CAAC;IAC5B,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,iBAAiB,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,GAAG,SAAS,GAAG,IAAI,KAAK,IAAI,CAAC;IAC/E,0BAA0B,EAAE,CAAC,GAAG,EAAE,GAAG,KAAK,IAAI,CAAC;CAChD,CAAC;AASF,eAAO,MAAM,SAAS,UAAW,KAAK,mCA+VrC,CAAC\"}\n\\ No newline at end of file\n+{\"version\":3,\"file\":\"BotBubble.d.ts\",\"sourceRoot\":\"\",\"sources\":[\"../../../src/components/bubbles/BotBubble.tsx\"],\"names\":[],\"mappings\":\"AAIA,OAAO,EAAc,OAAO,EAAE,WAAW,EAAE,MAAM,QAAQ,CAAC;AAO1D,KAAK,KAAK,GAAG;IACX,OAAO,EAAE,WAAW,CAAC;IACrB,UAAU,EAAE,MAAM,CAAC;IACnB,MAAM,EAAE,MAAM,CAAC;IACf,OAAO,CAAC,EAAE,MAAM,CAAC;IACjB,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,WAAW,KAAK,OAAO,CAAC,IAAI,CAAC,CAAC;IACpD,eAAe,CAAC,EAAE,GAAG,CAAC;IACtB,UAAU,CAAC,EAAE,OAAO,CAAC;IACrB,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,SAAS,CAAC,EAAE,MAAM,CAAC;IACnB,kBAAkB,CAAC,EAAE,OAAO,CAAC;IAC7B,QAAQ,CAAC,EAAE,MAAM,CAAC;IAClB,aAAa,CAAC,EAAE,MAAM,CAAC;IACvB,SAAS,EAAE,OAAO,CAAC;IACnB,iBAAiB,CAAC,EAAE,OAAO,CAAC;IAC5B,eAAe,CAAC,EAAE,MAAM,CAAC;IACzB,iBAAiB,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,GAAG,SAAS,GAAG,IAAI,KAAK,IAAI,CAAC;IAC/E,0BAA0B,EAAE,CAAC,GAAG,EAAE,GAAG,KAAK,IAAI,CAAC;CAChD,CAAC;AASF,eAAO,MAAM,SAAS,UAAW,KAAK,mCAkZrC,CAAC\"}\n\\ No newline at end of file"
            },
            {
                "sha": "9ad3c502409dbb3f9c439d2c291273ecba2403fc",
                "filename": "dist/web.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fweb.js",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/dist%2Fweb.js",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/dist%2Fweb.js?ref=6a9645df41371cb69f251038d501ec87b1304c84"
            },
            {
                "sha": "cf1b38c24d076ee6451fe21489891fa14157aa63",
                "filename": "src/components/Bot.tsx",
                "status": "modified",
                "additions": 18,
                "deletions": 4,
                "changes": 22,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fcomponents%2FBot.tsx",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fcomponents%2FBot.tsx",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/src%2Fcomponents%2FBot.tsx?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -25,7 +25,7 @@ import { cancelAudioRecording, startAudioRecording, stopAudioRecording } from '@\n import { LeadCaptureBubble } from '@/components/bubbles/LeadCaptureBubble';\n import { removeLocalStorageChatHistory, getLocalStorageChatflow, setLocalStorageChatflow, setCookie, getCookie } from '@/utils';\n import { cloneDeep } from 'lodash';\n-import { EventStreamContentType, fetchEventSource } from '@microsoft/fetch-event-source';\n+import { fetchEventSource } from '@microsoft/fetch-event-source';\n \n export type FileEvent<T = EventTarget> = {\n   target: T;\n@@ -65,6 +65,7 @@ export type IAgentReasoning = {\n   agentName?: string;\n   messages?: string[];\n   usedTools?: any[];\n+  artifacts?: FileUpload[];\n   sourceDocuments?: any[];\n   instructions?: string;\n   nextAgent?: string;\n@@ -92,6 +93,7 @@ export type MessageType = {\n   sourceDocuments?: any;\n   fileAnnotations?: any;\n   fileUploads?: Partial<FileUpload>[];\n+  artifacts?: Partial<FileUpload>[];\n   agentReasoning?: IAgentReasoning[];\n   usedTools?: any[];\n   action?: IAction | null;\n@@ -230,9 +232,6 @@ export const Bot = (botProps: BotProps & { class?: string }) => {\n   let bottomSpacer: HTMLDivElement | undefined;\n   let botContainer: HTMLDivElement | undefined;\n \n-  // Extract sourceDocsTitle directly from props\n-  const sourceDocsTitle = props.sourceDocsTitle;\n-\n   const [userInput, setUserInput] = createSignal('');\n   const [loading, setLoading] = createSignal(false);\n   const [sourcePopupOpen, setSourcePopupOpen] = createSignal(false);\n@@ -411,6 +410,16 @@ export const Bot = (botProps: BotProps & { class?: string }) => {\n     });\n   };\n \n+  const updateLastMessageArtifacts = (artifacts: FileUpload[]) => {\n+    setMessages((prevMessages) => {\n+      const allMessages = [...cloneDeep(prevMessages)];\n+      if (allMessages[allMessages.length - 1].type === 'userMessage') return allMessages;\n+      allMessages[allMessages.length - 1].artifacts = artifacts;\n+      addChatMessage(allMessages);\n+      return allMessages;\n+    })\n+  }\n+\n   const updateLastMessageAction = (action: IAction) => {\n     setMessages((data) => {\n       const updated = data.map((item, i) => {\n@@ -517,6 +526,9 @@ export const Bot = (botProps: BotProps & { class?: string }) => {\n           case 'action':\n             updateLastMessageAction(payload.data);\n             break;\n+          case 'artifacts':\n+            updateLastMessageArtifacts(payload.data);\n+            break;\n           case 'metadata':\n             updateMetadata(payload.data, input);\n             break;\n@@ -663,6 +675,7 @@ export const Bot = (botProps: BotProps & { class?: string }) => {\n             fileAnnotations: data?.fileAnnotations,\n             agentReasoning: data?.agentReasoning,\n             action: data?.action,\n+            artifacts: data?.artifacts,\n             type: 'apiMessage' as messageType,\n             feedback: null,\n           };\n@@ -821,6 +834,7 @@ export const Bot = (botProps: BotProps & { class?: string }) => {\n               if (message.fileUploads) chatHistory.fileUploads = message.fileUploads;\n               if (message.agentReasoning) chatHistory.agentReasoning = message.agentReasoning;\n               if (message.action) chatHistory.action = message.action;\n+              if (message.artifacts) chatHistory.artifacts = message.artifacts;              \n               return chatHistory;\n             })\n           : [{ message: props.welcomeMessage ?? defaultWelcomeMessage, type: 'apiMessage' }];"
            },
            {
                "sha": "4a6db428127af74cb03666e4e23656175f288429",
                "filename": "src/components/bubbles/AgentReasoningBubble.tsx",
                "status": "modified",
                "additions": 64,
                "deletions": 2,
                "changes": 66,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fcomponents%2Fbubbles%2FAgentReasoningBubble.tsx",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fcomponents%2Fbubbles%2FAgentReasoningBubble.tsx",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/src%2Fcomponents%2Fbubbles%2FAgentReasoningBubble.tsx?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -1,9 +1,15 @@\n-import { onMount } from 'solid-js';\n+import { For, onMount } from 'solid-js';\n import { Marked } from '@ts-stack/markdown';\n+import { FileUpload } from '../Bot';\n+import { cloneDeep } from 'lodash';\n \n type Props = {\n+  apiHost?: string;\n+  chatflowid: string;\n+  chatId: string\n   agentName: string;\n   agentMessage: string;\n+  agentArtifacts?: FileUpload[];\n   backgroundColor?: string;\n   textColor?: string;\n   fontSize?: number;\n@@ -13,7 +19,7 @@ const defaultBackgroundColor = '#f7f8ff';\n const defaultTextColor = '#303235';\n const defaultFontSize = 16;\n \n-Marked.setOptions({ isNoP: true });\n+Marked.setOptions({ isNoP: true, sanitize: true });\n \n export const AgentReasoningBubble = (props: Props) => {\n   let botMessageEl: HTMLDivElement | undefined;\n@@ -27,8 +33,64 @@ export const AgentReasoningBubble = (props: Props) => {\n     }\n   });\n \n+  const agentReasoningArtifacts = (artifacts: FileUpload[]) => {\n+    const newArtifacts = cloneDeep(artifacts)\n+    for (let i = 0; i < newArtifacts.length; i++) {\n+        const artifact = newArtifacts[i]\n+        if (artifact && (artifact.type === 'png' || artifact.type === 'jpeg')) {\n+            const data = artifact.data as string\n+            newArtifacts[i].data = `${props.apiHost}/api/v1/get-upload-file?chatflowId=${props.chatflowid}&chatId=${props.chatId}&fileName=${data.replace(\n+                'FILE-STORAGE::',\n+                ''\n+            )}`\n+        }\n+    }\n+    return newArtifacts\n+  }\n+\n+  const renderArtifacts = (item: Partial<FileUpload>) => {\n+    if (item.type === 'png' || item.type === 'jpeg') {\n+      const src = item.data as string;\n+      return (\n+        <div class=\"flex items-center justify-center max-w-[128px] mr-[10px] p-0 m-0\">\n+          <img class=\"w-full h-full bg-cover\" src={src} />\n+        </div>\n+      );\n+    } else if (item.type === 'html') {\n+      const src = (item.data as string);\n+      return (\n+        <div class=\"mt-2\">\n+            <div innerHTML={src}></div>\n+        </div>\n+      );\n+    } else {\n+      const src = item.data as string;\n+      return (\n+        <span\n+          innerHTML={Marked.parse(src)}\n+          class=\"prose\"\n+          style={{\n+            'background-color': props.backgroundColor ?? defaultBackgroundColor,\n+            color: props.textColor ?? defaultTextColor,\n+            'border-radius': '6px',\n+            'font-size': props.fontSize ? `${props.fontSize}px` : `${defaultFontSize}px`,\n+          }}\n+        />\n+      );\n+    }\n+  };\n+\n   return (\n     <div class=\"mb-6\">\n+      {props.agentArtifacts && (\n+        <div class=\"flex flex-row items-start flex-wrap w-full gap-2\">\n+          <For each={agentReasoningArtifacts(props.agentArtifacts)}>\n+            {(item) => {\n+              return item !== null ? <>{renderArtifacts(item)}</> : null\n+            }}\n+          </For>\n+        </div>\n+      )}\n       {props.agentMessage && (\n         <span\n           ref={botMessageEl}"
            },
            {
                "sha": "56a8941e2999d6865ac19d54167b26a34a8dacae",
                "filename": "src/components/bubbles/BotBubble.tsx",
                "status": "modified",
                "additions": 54,
                "deletions": 3,
                "changes": 57,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fcomponents%2Fbubbles%2FBotBubble.tsx",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fcomponents%2Fbubbles%2FBotBubble.tsx",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/src%2Fcomponents%2Fbubbles%2FBotBubble.tsx?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -2,7 +2,7 @@ import { createEffect, Show, createSignal, onMount, For } from 'solid-js';\n import { Avatar } from '../avatars/Avatar';\n import { Marked } from '@ts-stack/markdown';\n import { FeedbackRatingType, sendFeedbackQuery, sendFileDownloadQuery, updateFeedbackQuery } from '@/queries/sendMessageQuery';\n-import { IAction, MessageType } from '../Bot';\n+import { FileUpload, IAction, MessageType } from '../Bot';\n import { CopyToClipboardButton, ThumbsDownButton, ThumbsUpButton } from '../buttons/FeedbackButtons';\n import FeedbackContentDialog from '../FeedbackContentDialog';\n import { AgentReasoningBubble } from './AgentReasoningBubble';\n@@ -35,7 +35,7 @@ const defaultTextColor = '#303235';\n const defaultFontSize = 16;\n const defaultFeedbackColor = '#3B81F6';\n \n-Marked.setOptions({ isNoP: true });\n+Marked.setOptions({ isNoP: true, sanitize: true });\n \n export const BotBubble = (props: Props) => {\n   let botMessageEl: HTMLDivElement | undefined;\n@@ -52,7 +52,7 @@ export const BotBubble = (props: Props) => {\n     try {\n       const response = await sendFileDownloadQuery({\n         apiHost: props.apiHost,\n-        body: { question: '', fileName: fileAnnotation.fileName },\n+        body: { fileName: fileAnnotation.fileName, chatflowId: props.chatflowid, chatId: props.chatId } as any,\n         onRequest: props.onRequest,\n       });\n       const blob = new Blob([response.data]);\n@@ -242,6 +242,44 @@ export const BotBubble = (props: Props) => {\n     }\n   });\n \n+  const renderArtifacts = (item: Partial<FileUpload>) => {\n+    if (item.type === 'png' || item.type === 'jpeg') {\n+      let src = item.data as string;\n+      if (src.startsWith('FILE-STORAGE::')) {\n+        src = `${props.apiHost}/api/v1/get-upload-file?chatflowId=${props.chatflowid}&chatId=${props.chatId}&fileName=${src.replace(\n+          'FILE-STORAGE::',\n+          ''\n+        )}`;\n+      }\n+      return (\n+        <div class=\"flex items-center justify-center p-0 m-0\">\n+          <img class=\"w-full h-full bg-cover\" src={src} />\n+        </div>\n+      );\n+    } else if (item.type === 'html') {\n+      const src = (item.data as string);\n+      return (\n+        <div class=\"mt-2\">\n+            <div innerHTML={src}></div>\n+        </div>\n+      );\n+    } else {\n+      const src = item.data as string;\n+      return (\n+        <span\n+          innerHTML={Marked.parse(src)}\n+          class=\"prose\"\n+          style={{\n+            'background-color': props.backgroundColor ?? defaultBackgroundColor,\n+            color: props.textColor ?? defaultTextColor,\n+            'border-radius': '6px',\n+            'font-size': props.fontSize ? `${props.fontSize}px` : `${defaultFontSize}px`,\n+          }}\n+        />\n+      );\n+    }\n+  };\n+\n   return (\n     <div>\n       <div class=\"flex flex-row justify-start mb-2 items-start host-container\" style={{ 'margin-right': '50px' }}>\n@@ -264,15 +302,28 @@ export const BotBubble = (props: Props) => {\n                     <AgentReasoningBubble\n                       agentName={agent.agentName ?? ''}\n                       agentMessage={msgContent}\n+                      agentArtifacts={agent.artifacts}\n                       backgroundColor={props.backgroundColor}\n                       textColor={props.textColor}\n                       fontSize={props.fontSize}\n+                      apiHost={props.apiHost}\n+                      chatflowid={props.chatflowid}\n+                      chatId={props.chatId}\n                     />\n                   );\n                 }}\n               </For>\n             </details>\n           )}\n+          {props.message.artifacts && props.message.artifacts.length > 0 && (\n+            <div class=\"flex flex-row items-start flex-wrap w-full gap-2\">\n+              <For each={props.message.artifacts}>\n+                {(item) => {\n+                  return item !== null ? <>{renderArtifacts(item)}</> : null\n+                }}\n+              </For>\n+            </div>\n+          )}\n           {props.message.message && (\n             <span\n               ref={botMessageEl}"
            },
            {
                "sha": "0fe27e7ca43cff945a0473e145d91dbd38d1dc02",
                "filename": "src/components/bubbles/GuestBubble.tsx",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fcomponents%2Fbubbles%2FGuestBubble.tsx",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fcomponents%2Fbubbles%2FGuestBubble.tsx",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/src%2Fcomponents%2Fbubbles%2FGuestBubble.tsx?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -20,7 +20,7 @@ const defaultBackgroundColor = '#3B81F6';\n const defaultTextColor = '#ffffff';\n const defaultFontSize = 16;\n \n-Marked.setOptions({ isNoP: true });\n+Marked.setOptions({ isNoP: true, sanitize: true });\n \n export const GuestBubble = (props: Props) => {\n   let userMessageEl: HTMLDivElement | undefined;"
            },
            {
                "sha": "f79d339ee0363623604f0253796117ec22f0b674",
                "filename": "src/queries/sendMessageQuery.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/blob/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fqueries%2FsendMessageQuery.ts",
                "raw_url": "https://github.com/FlowiseAI/FlowiseChatEmbed/raw/6a9645df41371cb69f251038d501ec87b1304c84/src%2Fqueries%2FsendMessageQuery.ts",
                "contents_url": "https://api.github.com/repos/FlowiseAI/FlowiseChatEmbed/contents/src%2Fqueries%2FsendMessageQuery.ts?ref=6a9645df41371cb69f251038d501ec87b1304c84",
                "patch": "@@ -111,7 +111,7 @@ export const isStreamAvailableQuery = ({ chatflowid, apiHost = 'http://localhost\n export const sendFileDownloadQuery = ({ apiHost = 'http://localhost:3000', body, onRequest }: MessageRequest) =>\n   sendRequest<any>({\n     method: 'POST',\n-    url: `${apiHost}/api/v1/openai-assistants-file`,\n+    url: `${apiHost}/api/v1/openai-assistants-file/download`,\n     body,\n     type: 'blob',\n     onRequest: onRequest,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/linkis/commits/82c2f4b201b746e9206bb58ef98f536fc333aa07",
        "url": "https://api.github.com/repos/apache/linkis/commits/82c2f4b201b746e9206bb58ef98f536fc333aa07",
        "html_url": "https://github.com/apache/linkis/commit/82c2f4b201b746e9206bb58ef98f536fc333aa07",
        "message": "[MINOR] add util for generating random strings (#5143)",
        "files": [
            {
                "sha": "e2ef2e897075ff617f2777322270cc785ef5991a",
                "filename": "LICENSE",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/linkis/blob/82c2f4b201b746e9206bb58ef98f536fc333aa07/LICENSE",
                "raw_url": "https://github.com/apache/linkis/raw/82c2f4b201b746e9206bb58ef98f536fc333aa07/LICENSE",
                "contents_url": "https://api.github.com/repos/apache/linkis/contents/LICENSE?ref=82c2f4b201b746e9206bb58ef98f536fc333aa07",
                "patch": "@@ -241,6 +241,7 @@ The following file are provided under the Apache 2.0 License.\n     linkis-engineconn-plugins/hbase/hbase-shims-1.4.3/src/main/resources/hbase-ruby/*\n     linkis-engineconn-plugins/hbase/hbase-shims-2.2.6/src/main/resources/hbase-ruby/*\n     linkis-engineconn-plugins/hbase/hbase-shims-2.5.3/src/main/resources/hbase-ruby/*\n+    linkis-engineconn-plugins/spark/src/main/java/org/apache/linkis/engineplugin/spark/executor/SecureRandomStringUtils.java\n \n The files:\n     .mvn/wrapper/MavenWrapperDownloader.java"
            },
            {
                "sha": "de5ac0b60ff263e0275eb830130cd002197ef460",
                "filename": "linkis-engineconn-plugins/spark/src/main/java/org/apache/linkis/engineplugin/spark/executor/SecureRandomStringUtils.java",
                "status": "added",
                "additions": 221,
                "deletions": 0,
                "changes": 221,
                "blob_url": "https://github.com/apache/linkis/blob/82c2f4b201b746e9206bb58ef98f536fc333aa07/linkis-engineconn-plugins%2Fspark%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Flinkis%2Fengineplugin%2Fspark%2Fexecutor%2FSecureRandomStringUtils.java",
                "raw_url": "https://github.com/apache/linkis/raw/82c2f4b201b746e9206bb58ef98f536fc333aa07/linkis-engineconn-plugins%2Fspark%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Flinkis%2Fengineplugin%2Fspark%2Fexecutor%2FSecureRandomStringUtils.java",
                "contents_url": "https://api.github.com/repos/apache/linkis/contents/linkis-engineconn-plugins%2Fspark%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Flinkis%2Fengineplugin%2Fspark%2Fexecutor%2FSecureRandomStringUtils.java?ref=82c2f4b201b746e9206bb58ef98f536fc333aa07",
                "patch": "@@ -0,0 +1,221 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.linkis.engineplugin.spark.executor;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+import java.security.NoSuchAlgorithmException;\n+import java.security.SecureRandom;\n+\n+/**\n+ * Based on Commons Lang3 RandomStringUtils, but with a SecureRandom.\n+ *\n+ * <p>For internal Apache Linkis use only.\n+ */\n+final class SecureRandomStringUtils {\n+  // Based on\n+  // https://github.com/apache/commons-lang/blob/5e07d873e6b45714d29bf47634adffa3b5aef098/src/main/java/org/apache/commons/lang3/RandomStringUtils.java\n+\n+  private static SecureRandom RANDOM_INSTANCE;\n+\n+  private static SecureRandom random() {\n+    if (RANDOM_INSTANCE != null) {\n+      return RANDOM_INSTANCE;\n+    }\n+    try {\n+      RANDOM_INSTANCE = SecureRandom.getInstanceStrong();\n+      return RANDOM_INSTANCE;\n+    } catch (NoSuchAlgorithmException e) {\n+      throw new IllegalStateException(\"Cannot create SecureRandom.getInstanceStrong()\", e);\n+    }\n+  }\n+\n+  // Random\n+  /**\n+   * Creates a random string whose length is the number of characters specified.\n+   *\n+   * <p>Characters will be chosen from the set of Latin alphabetic characters (a-z, A-Z) and the\n+   * digits 0-9.\n+   *\n+   * @param count the length of random string to create\n+   * @return the random string\n+   * @throws IllegalArgumentException if {@code count} &lt; 0.\n+   */\n+  public static String randomAlphanumeric(final int count) {\n+    return random(count, true, true);\n+  }\n+\n+  /**\n+   * Creates a random string whose length is the number of characters specified.\n+   *\n+   * <p>Characters will be chosen from the set of alpha-numeric characters as indicated by the\n+   * arguments.\n+   *\n+   * @param count the length of random string to create\n+   * @param letters if {@code true}, generated string may include alphabetic characters\n+   * @param numbers if {@code true}, generated string may include numeric characters\n+   * @return the random string\n+   * @throws IllegalArgumentException if {@code count} &lt; 0.\n+   */\n+  private static String random(final int count, final boolean letters, final boolean numbers) {\n+    return random(count, 0, 0, letters, numbers);\n+  }\n+\n+  /**\n+   * Creates a random string whose length is the number of characters specified.\n+   *\n+   * <p>Characters will be chosen from the set of alpha-numeric characters as indicated by the\n+   * arguments.\n+   *\n+   * @param count the length of random string to create\n+   * @param start the position in set of chars to start at\n+   * @param end the position in set of chars to end before\n+   * @param letters if {@code true}, generated string may include alphabetic characters\n+   * @param numbers if {@code true}, generated string may include numeric characters\n+   * @return the random string\n+   * @throws IllegalArgumentException if {@code count} &lt; 0.\n+   */\n+  private static String random(\n+      final int count,\n+      final int start,\n+      final int end,\n+      final boolean letters,\n+      final boolean numbers) {\n+    return random(count, start, end, letters, numbers, null, random());\n+  }\n+\n+  /**\n+   * Creates a random string based on a variety of options, using supplied source of randomness.\n+   *\n+   * <p>If start and end are both {@code 0}, start and end are set to {@code ' '} and {@code 'z'},\n+   * the ASCII printable characters, will be used, unless letters and numbers are both {@code\n+   * false}, in which case, start and end are set to {@code 0} and {@link Character#MAX_CODE_POINT}.\n+   *\n+   * <p>If set is not {@code null}, characters between start and end are chosen.\n+   *\n+   * <p>This method accepts a user-supplied {@link SecureRandom} instance to use as a source of\n+   * randomness. By seeding a single {@link SecureRandom} instance with a fixed seed and using it\n+   * for each call, the same random sequence of strings can be generated repeatedly and predictably.\n+   *\n+   * @param count the length of random string to create\n+   * @param start the position in set of chars to start at (inclusive)\n+   * @param end the position in set of chars to end before (exclusive)\n+   * @param letters if {@code true}, generated string may include alphabetic characters\n+   * @param numbers if {@code true}, generated string may include numeric characters\n+   * @param chars the set of chars to choose randoms from, must not be empty. If {@code null}, then\n+   *     it will use the set of all chars.\n+   * @param random a source of randomness.\n+   * @return the random string\n+   * @throws ArrayIndexOutOfBoundsException if there are not {@code (end - start) + 1} characters in\n+   *     the set array.\n+   * @throws IllegalArgumentException if {@code count} &lt; 0 or the provided chars array is empty.\n+   */\n+  private static String random(\n+      int count,\n+      int start,\n+      int end,\n+      final boolean letters,\n+      final boolean numbers,\n+      final char[] chars,\n+      final SecureRandom random) {\n+    if (count == 0) {\n+      return StringUtils.EMPTY;\n+    }\n+    if (count < 0) {\n+      throw new IllegalArgumentException(\n+          \"Requested random string length \" + count + \" is less than 0.\");\n+    }\n+    if (chars != null && chars.length == 0) {\n+      throw new IllegalArgumentException(\"The chars array must not be empty\");\n+    }\n+\n+    if (start == 0 && end == 0) {\n+      if (chars != null) {\n+        end = chars.length;\n+      } else if (!letters && !numbers) {\n+        end = Character.MAX_CODE_POINT;\n+      } else {\n+        end = 'z' + 1;\n+        start = ' ';\n+      }\n+    } else if (end <= start) {\n+      throw new IllegalArgumentException(\n+          \"Parameter end (\" + end + \") must be greater than start (\" + start + \")\");\n+    }\n+\n+    final int zeroDigitAscii = 48;\n+    final int firstLetterAscii = 65;\n+\n+    if (chars == null && (numbers && end <= zeroDigitAscii || letters && end <= firstLetterAscii)) {\n+      throw new IllegalArgumentException(\n+          \"Parameter end (\"\n+              + end\n+              + \") must be greater then (\"\n+              + zeroDigitAscii\n+              + \") for generating digits \"\n+              + \"or greater then (\"\n+              + firstLetterAscii\n+              + \") for generating letters.\");\n+    }\n+\n+    final StringBuilder builder = new StringBuilder(count);\n+    final int gap = end - start;\n+\n+    while (count-- != 0) {\n+      final int codePoint;\n+      if (chars == null) {\n+        codePoint = random.nextInt(gap) + start;\n+\n+        switch (Character.getType(codePoint)) {\n+          case Character.UNASSIGNED:\n+          case Character.PRIVATE_USE:\n+          case Character.SURROGATE:\n+            count++;\n+            continue;\n+        }\n+\n+      } else {\n+        codePoint = chars[random.nextInt(gap) + start];\n+      }\n+\n+      final int numberOfChars = Character.charCount(codePoint);\n+      if (count == 0 && numberOfChars > 1) {\n+        count++;\n+        continue;\n+      }\n+\n+      if (letters && Character.isLetter(codePoint)\n+          || numbers && Character.isDigit(codePoint)\n+          || !letters && !numbers) {\n+        builder.appendCodePoint(codePoint);\n+\n+        if (numberOfChars == 2) {\n+          count--;\n+        }\n+\n+      } else {\n+        count++;\n+      }\n+    }\n+    return builder.toString();\n+  }\n+\n+  private SecureRandomStringUtils() {\n+    // empty\n+  }\n+}"
            },
            {
                "sha": "14984885c0151ea51cc4415c393a8a61ca33c8c9",
                "filename": "linkis-engineconn-plugins/spark/src/main/scala/org/apache/linkis/engineplugin/spark/executor/SparkPythonExecutor.scala",
                "status": "modified",
                "additions": 2,
                "deletions": 3,
                "changes": 5,
                "blob_url": "https://github.com/apache/linkis/blob/82c2f4b201b746e9206bb58ef98f536fc333aa07/linkis-engineconn-plugins%2Fspark%2Fsrc%2Fmain%2Fscala%2Forg%2Fapache%2Flinkis%2Fengineplugin%2Fspark%2Fexecutor%2FSparkPythonExecutor.scala",
                "raw_url": "https://github.com/apache/linkis/raw/82c2f4b201b746e9206bb58ef98f536fc333aa07/linkis-engineconn-plugins%2Fspark%2Fsrc%2Fmain%2Fscala%2Forg%2Fapache%2Flinkis%2Fengineplugin%2Fspark%2Fexecutor%2FSparkPythonExecutor.scala",
                "contents_url": "https://api.github.com/repos/apache/linkis/contents/linkis-engineconn-plugins%2Fspark%2Fsrc%2Fmain%2Fscala%2Forg%2Fapache%2Flinkis%2Fengineplugin%2Fspark%2Fexecutor%2FSparkPythonExecutor.scala?ref=82c2f4b201b746e9206bb58ef98f536fc333aa07",
                "patch": "@@ -38,15 +38,14 @@ import org.apache.linkis.storage.resultset.ResultSetWriterFactory\n \n import org.apache.commons.exec.CommandLine\n import org.apache.commons.io.IOUtils\n-import org.apache.commons.lang3.{RandomStringUtils, StringUtils}\n+import org.apache.commons.lang3.StringUtils\n import org.apache.spark.SparkConf\n import org.apache.spark.api.java.JavaSparkContext\n import org.apache.spark.sql.{DataFrame, SparkSession}\n import org.apache.spark.sql.execution.datasources.csv.UDF\n \n import java.io._\n import java.net.InetAddress\n-import java.security.SecureRandom\n import java.util\n \n import scala.collection.JavaConverters._\n@@ -77,7 +76,7 @@ class SparkPythonExecutor(val sparkEngineSession: SparkEngineSession, val id: In\n   private val lineOutputStream = new RsOutputStream\n   val sqlContext = sparkEngineSession.sqlContext\n   val SUCCESS = \"success\"\n-  private lazy val py4jToken: String = SecureRandom.getInstance(\"SHA1PRNG\").nextInt(100000).toString\n+  private lazy val py4jToken: String = SecureRandomStringUtils.randomAlphanumeric(256)\n \n   private lazy val gwBuilder: GatewayServerBuilder = {\n     val builder = new GatewayServerBuilder()"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/oveleon/contao-cookiebar/commits/1d57470be5878f66d5e1e23f624dd387564b9b8d",
        "url": "https://api.github.com/repos/oveleon/contao-cookiebar/commits/1d57470be5878f66d5e1e23f624dd387564b9b8d",
        "html_url": "https://github.com/oveleon/contao-cookiebar/commit/1d57470be5878f66d5e1e23f624dd387564b9b8d",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "be0a484b99e3ae10c51a3d823ae4a6792e494fd9",
                "filename": "src/Controller/CookiebarController.php",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/oveleon/contao-cookiebar/blob/1d57470be5878f66d5e1e23f624dd387564b9b8d/src%2FController%2FCookiebarController.php",
                "raw_url": "https://github.com/oveleon/contao-cookiebar/raw/1d57470be5878f66d5e1e23f624dd387564b9b8d/src%2FController%2FCookiebarController.php",
                "contents_url": "https://api.github.com/repos/oveleon/contao-cookiebar/contents/src%2FController%2FCookiebarController.php?ref=1d57470be5878f66d5e1e23f624dd387564b9b8d",
                "patch": "@@ -64,6 +64,11 @@ public function blockAction(Request $request, $locale, $id)\n             throw new PageNotFoundException();\n         }\n \n+        if(!Validator::isLocale($locale))\n+        {\n+            return new Response('The URL must contain a valid locale.', Response::HTTP_BAD_REQUEST);\n+        }\n+\n         $strUrl = $request->get('redirect');\n \n         // Protect against XSS attacks"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rollup/rollup/commits/e2552c9e955e0a61f70f508200ee9f752f85a541",
        "url": "https://api.github.com/repos/rollup/rollup/commits/e2552c9e955e0a61f70f508200ee9f752f85a541",
        "html_url": "https://github.com/rollup/rollup/commit/e2552c9e955e0a61f70f508200ee9f752f85a541",
        "message": "Fix DOM Clobbering CVE (#5671)",
        "files": [
            {
                "sha": "a16a85c07127a9533f7bdf46753eef2d4be0984c",
                "filename": "src/ast/nodes/MetaProperty.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/src%2Fast%2Fnodes%2FMetaProperty.ts",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/src%2Fast%2Fnodes%2FMetaProperty.ts",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/src%2Fast%2Fnodes%2FMetaProperty.ts?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,10 +1,10 @@\n import type MagicString from 'magic-string';\n import type { InternalModuleFormat } from '../../rollup/types';\n-import type { PluginDriver } from '../../utils/PluginDriver';\n import { escapeId } from '../../utils/escapeId';\n import type { GenerateCodeSnippets } from '../../utils/generateCodeSnippets';\n import { DOCUMENT_CURRENT_SCRIPT } from '../../utils/interopHelpers';\n import { dirname, normalize, relative } from '../../utils/path';\n+import type { PluginDriver } from '../../utils/PluginDriver';\n import type { RenderOptions } from '../../utils/renderHelpers';\n import type { NodeInteraction } from '../NodeInteractions';\n import { INTERACTION_ACCESSED } from '../NodeInteractions';\n@@ -158,7 +158,7 @@ const getRelativeUrlFromDocument = (relativePath: string, umd = false) =>\n \tgetResolveUrl(\n \t\t`'${escapeId(relativePath)}', ${\n \t\t\tumd ? `typeof document === 'undefined' ? location.href : ` : ''\n-\t\t}document.currentScript && document.currentScript.src || document.baseURI`\n+\t\t}document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI`\n \t);\n \n const getGenericImportMetaMechanism =\n@@ -180,7 +180,7 @@ const getFileUrlFromRelativePath = (path: string) =>\n const getUrlFromDocument = (chunkId: string, umd = false) =>\n \t`${\n \t\tumd ? `typeof document === 'undefined' ? location.href : ` : ''\n-\t}(${DOCUMENT_CURRENT_SCRIPT} && ${DOCUMENT_CURRENT_SCRIPT}.src || new URL('${escapeId(\n+\t}(${DOCUMENT_CURRENT_SCRIPT} && ${DOCUMENT_CURRENT_SCRIPT}.tagName.toUpperCase() === 'SCRIPT' && ${DOCUMENT_CURRENT_SCRIPT}.src || new URL('${escapeId(\n \t\tchunkId\n \t)}', document.baseURI).href)`;\n "
            },
            {
                "sha": "5fe6927ab20f5b2e1aa025bb30477081f397f002",
                "filename": "test/chunking-form/samples/asset-needs-code-reference/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fasset-needs-code-reference%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fasset-needs-code-reference%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fasset-needs-code-reference%2F_expected%2Fcjs%2Fmain.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-var asset2 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/logo2.svg').href : new URL('logo2.svg', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset2 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/logo2.svg').href : new URL('logo2.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n {\n \tconst image = document.createElement('img');"
            },
            {
                "sha": "4f2e3528610e911506aa5841e14778baab71e581",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-with-importer/_expected/cjs/main.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-with-importer%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-with-importer%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-with-importer%2F_expected%2Fcjs%2Fmain.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,5 +1,5 @@\n 'use strict';\n \n-console.log('no importer', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib.js').href : new URL('generated-lib.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n-console.log('from maim', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib.js').href : new URL('generated-lib.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n-console.log('from nested', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib2.js').href : new URL('generated-lib2.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('no importer', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib.js').href : new URL('generated-lib.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n+console.log('from maim', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib.js').href : new URL('generated-lib.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n+console.log('from nested', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib2.js').href : new URL('generated-lib2.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));"
            },
            {
                "sha": "068a048b4c6fa0716c2ae0a6caf4955b9e5516f7",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-worker/_expected/cjs/chunks/nested.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fnested.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fnested.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fnested.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,7 +1,7 @@\n 'use strict';\n \n const getWorkerMessage = () => new Promise(resolve => {\n-  const worker = new Worker((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/worker-proxy.js').href : new URL('worker-proxy.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+  const worker = new Worker((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/worker-proxy.js').href : new URL('worker-proxy.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n   worker.onmessage = resolve;\n });\n "
            },
            {
                "sha": "74905837541892f36bcea735b5c3bce7d4dc2592",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-worker/_expected/cjs/chunks/worker-proxy.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fworker-proxy.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fworker-proxy.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fworker-proxy.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,3 +1,3 @@\n 'use strict';\n \n-PLACEHOLDER((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/worker.js').href : new URL('worker.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+PLACEHOLDER((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/worker.js').href : new URL('worker.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));"
            },
            {
                "sha": "a1cd157d07482f5ac20ccb4591f02434391e0717",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-worker/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fmain.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -3,7 +3,7 @@\n var shared = require('./chunks/shared.js');\n \n const getWorkerMessage = () => new Promise(resolve => {\n-  const worker = new Worker((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/chunks/worker-proxy.js').href : new URL('chunks/worker-proxy.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+  const worker = new Worker((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/chunks/worker-proxy.js').href : new URL('chunks/worker-proxy.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n   worker.onmessage = resolve;\n });\n "
            },
            {
                "sha": "98ae99aa4ca1830ceab054fdd635dd82b373cc89",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-worklet/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worklet%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worklet%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worklet%2F_expected%2Fcjs%2Fmain.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -2,6 +2,6 @@\n \n var shared = require('./chunks/shared.js');\n \n-CSS.paintWorklet.addModule((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/chunks/worklet.js').href : new URL('chunks/worklet.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+CSS.paintWorklet.addModule((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/chunks/worklet.js').href : new URL('chunks/worklet.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n \n document.body.innerHTML += `<h1 style=\"background-image: paint(vertical-lines);\">color: ${shared.color}, size: ${shared.size}</h1>`;"
            },
            {
                "sha": "ca7980f90824c789b2116182838fda3975a36440",
                "filename": "test/chunking-form/samples/emit-file/reference-files/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fmain.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo1-FquQRdV3.svg').href : new URL('assets/logo1-FquQRdV3.svg', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo1-FquQRdV3.svg').href : new URL('assets/logo1-FquQRdV3.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n function showImage(url) {\n \tconsole.log(url);"
            },
            {
                "sha": "f5430b1cb4ccf07c1ab20f9b3fe57de0898a2898",
                "filename": "test/chunking-form/samples/emit-file/reference-files/_expected/cjs/nested/chunk.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fnested%2Fchunk.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fnested%2Fchunk.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fnested%2Fchunk.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -2,6 +2,6 @@\n \n var main = require('../main.js');\n \n-var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/../assets/logo2-DJfvToLT.svg').href : new URL('../assets/logo2-DJfvToLT.svg', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/../assets/logo2-DJfvToLT.svg').href : new URL('../assets/logo2-DJfvToLT.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n main.showImage(logo);"
            },
            {
                "sha": "20a405e4e318aecc9a703471f3117d89ff05949a",
                "filename": "test/chunking-form/samples/emit-file/set-asset-source/_expected/cjs/main.js",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Fset-asset-source%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Femit-file%2Fset-asset-source%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Fset-asset-source%2F_expected%2Fcjs%2Fmain.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,14 +1,14 @@\n 'use strict';\n \n-const renderStart = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/renderStart-B4XObdBk.txt').href : new URL('assets/renderStart-B4XObdBk.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const renderStartNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/renderStart.txt').href : new URL('renderStart.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n+const renderStart = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/renderStart-B4XObdBk.txt').href : new URL('assets/renderStart-B4XObdBk.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const renderStartNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/renderStart.txt').href : new URL('renderStart.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n const renderStartNamedImmediately = 'renderStart.txt';\n-const bannerNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/banner.txt').href : new URL('banner.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const footerNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/footer.txt').href : new URL('footer.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const introNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/intro.txt').href : new URL('intro.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const outroNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/outro.txt').href : new URL('outro.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const renderChunkNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/renderChunk.txt').href : new URL('renderChunk.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const generateBundleNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generateBundle.txt').href : new URL('generateBundle.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n+const bannerNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/banner.txt').href : new URL('banner.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const footerNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/footer.txt').href : new URL('footer.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const introNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/intro.txt').href : new URL('intro.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const outroNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/outro.txt').href : new URL('outro.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const renderChunkNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/renderChunk.txt').href : new URL('renderChunk.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const generateBundleNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generateBundle.txt').href : new URL('generateBundle.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n exports.bannerNamed = bannerNamed;\n exports.footerNamed = footerNamed;"
            },
            {
                "sha": "554aa8e8546a6ed04ddb313b10bb66ca4cb4ae89",
                "filename": "test/chunking-form/samples/import-meta-numeric-paths/_expected/cjs/0/1/nested.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fimport-meta-numeric-paths%2F_expected%2Fcjs%2F0%2F1%2Fnested.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fimport-meta-numeric-paths%2F_expected%2Fcjs%2F0%2F1%2Fnested.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fimport-meta-numeric-paths%2F_expected%2Fcjs%2F0%2F1%2Fnested.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-const url = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('0/1/nested.js', document.baseURI).href));\n+const url = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('0/1/nested.js', document.baseURI).href));\n \n exports.url = url;"
            },
            {
                "sha": "bb2e40a89faf035bbc685d00554ecbfdb595c81f",
                "filename": "test/chunking-form/samples/import-meta-url/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fmain.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -9,7 +9,7 @@ function log(url) {\n \t}\n }\n \n-log('main: ' + (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('main.js', document.baseURI).href)));\n+log('main: ' + (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('main.js', document.baseURI).href)));\n Promise.resolve().then(function () { return require('./nested/chunk.js'); });\n \n exports.log = log;"
            },
            {
                "sha": "43c3320e6864410f6e621e68f7b3c6d444ea373f",
                "filename": "test/chunking-form/samples/import-meta-url/_expected/cjs/nested/chunk.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fnested%2Fchunk.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fnested%2Fchunk.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fnested%2Fchunk.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -3,4 +3,4 @@\n var main = require('../main.js');\n \n var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-main.log('nested: ' + (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('nested/chunk.js', document.baseURI).href)));\n+main.log('nested: ' + (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('nested/chunk.js', document.baseURI).href)));"
            },
            {
                "sha": "65cd4727d9459bc3d5df0f18a93533f7eab80c1c",
                "filename": "test/chunking-form/samples/render-chunk/_expected/cjs/chunk-dep2-Cr_zOuBy.js",
                "status": "renamed",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fchunk-dep2-Cr_zOuBy.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fchunk-dep2-Cr_zOuBy.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fchunk-dep2-Cr_zOuBy.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,7 +1,7 @@\n 'use strict';\n \n var num = 2;\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n \n exports.num = num;\n console.log({\n@@ -18,24 +18,24 @@ console.log({\n   \"name\": \"dep2\",\n   \"type\": \"chunk\",\n   \"dynamicImports\": [],\n-  \"fileName\": \"chunk-dep2-DaLIbws0.js\",\n+  \"fileName\": \"chunk-dep2-Cr_zOuBy.js\",\n   \"implicitlyLoadedBefore\": [],\n   \"importedBindings\": {},\n   \"imports\": [],\n   \"modules\": {\n     \"**/dep2.js\": {\n-      \"code\": \"var num = 2;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"var num = 2;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 19,\n       \"removedExports\": [],\n       \"renderedExports\": [\n         \"num\"\n       ],\n-      \"renderedLength\": 269\n+      \"renderedLength\": 330\n     }\n   },\n   \"referencedFiles\": [\n     \"asset-test-C4X7hChn\"\n   ]\n });\n-console.log('all chunks', [\"entry-main1-s6RHXqBe.js\",\"entry-main2-DPo9-iBy.js\",\"chunk-dep2-DaLIbws0.js\"])\n+console.log('all chunks', [\"entry-main1-CW_cw0go.js\",\"entry-main2-CvqsXhWd.js\",\"chunk-dep2-Cr_zOuBy.js\"])\n console.log('referenced asset in renderChunk', 'asset-test-C4X7hChn');",
                "previous_filename": "test/chunking-form/samples/render-chunk/_expected/cjs/chunk-dep2-DaLIbws0.js"
            },
            {
                "sha": "a10e73c7c5cef0cd48fe48082661c2b06adf447c",
                "filename": "test/chunking-form/samples/render-chunk/_expected/cjs/entry-main1-CW_cw0go.js",
                "status": "renamed",
                "additions": 11,
                "deletions": 11,
                "changes": 22,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main1-CW_cw0go.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main1-CW_cw0go.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main1-CW_cw0go.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,12 +1,12 @@\n 'use strict';\n \n-var dep2 = require('./chunk-dep2-DaLIbws0.js');\n+var dep2 = require('./chunk-dep2-Cr_zOuBy.js');\n \n var num = 1;\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n \n console.log(num + dep2.num);\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n console.log({\n   \"exports\": [],\n   \"facadeModuleId\": \"**/main1.js\",\n@@ -20,37 +20,37 @@ console.log({\n   \"name\": \"main1\",\n   \"type\": \"chunk\",\n   \"dynamicImports\": [],\n-  \"fileName\": \"entry-main1-s6RHXqBe.js\",\n+  \"fileName\": \"entry-main1-CW_cw0go.js\",\n   \"implicitlyLoadedBefore\": [],\n   \"importedBindings\": {\n-    \"chunk-dep2-DaLIbws0.js\": [\n+    \"chunk-dep2-Cr_zOuBy.js\": [\n       \"num\"\n     ]\n   },\n   \"imports\": [\n-    \"chunk-dep2-DaLIbws0.js\"\n+    \"chunk-dep2-Cr_zOuBy.js\"\n   ],\n   \"modules\": {\n     \"**/dep1.js\": {\n-      \"code\": \"var num = 1;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"var num = 1;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 19,\n       \"removedExports\": [],\n       \"renderedExports\": [\n         \"num\"\n       ],\n-      \"renderedLength\": 269\n+      \"renderedLength\": 330\n     },\n     \"**/main1.js\": {\n-      \"code\": \"console.log(num + dep2.num);\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"console.log(num + dep2.num);\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 102,\n       \"removedExports\": [],\n       \"renderedExports\": [],\n-      \"renderedLength\": 285\n+      \"renderedLength\": 346\n     }\n   },\n   \"referencedFiles\": [\n     \"asset-test-C4X7hChn\"\n   ]\n });\n-console.log('all chunks', [\"entry-main1-s6RHXqBe.js\",\"entry-main2-DPo9-iBy.js\",\"chunk-dep2-DaLIbws0.js\"])\n+console.log('all chunks', [\"entry-main1-CW_cw0go.js\",\"entry-main2-CvqsXhWd.js\",\"chunk-dep2-Cr_zOuBy.js\"])\n console.log('referenced asset in renderChunk', 'asset-test-C4X7hChn');",
                "previous_filename": "test/chunking-form/samples/render-chunk/_expected/cjs/entry-main1-s6RHXqBe.js"
            },
            {
                "sha": "95904e0384c51615cd679a287f39e46b07a1cd3f",
                "filename": "test/chunking-form/samples/render-chunk/_expected/cjs/entry-main2-CvqsXhWd.js",
                "status": "renamed",
                "additions": 11,
                "deletions": 11,
                "changes": 22,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main2-CvqsXhWd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main2-CvqsXhWd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main2-CvqsXhWd.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,12 +1,12 @@\n 'use strict';\n \n-var dep2 = require('./chunk-dep2-DaLIbws0.js');\n+var dep2 = require('./chunk-dep2-Cr_zOuBy.js');\n \n var num = 3;\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n \n console.log(dep2.num + num);\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n console.log({\n   \"exports\": [],\n   \"facadeModuleId\": \"**/main2.js\",\n@@ -20,37 +20,37 @@ console.log({\n   \"name\": \"main2\",\n   \"type\": \"chunk\",\n   \"dynamicImports\": [],\n-  \"fileName\": \"entry-main2-DPo9-iBy.js\",\n+  \"fileName\": \"entry-main2-CvqsXhWd.js\",\n   \"implicitlyLoadedBefore\": [],\n   \"importedBindings\": {\n-    \"chunk-dep2-DaLIbws0.js\": [\n+    \"chunk-dep2-Cr_zOuBy.js\": [\n       \"num\"\n     ]\n   },\n   \"imports\": [\n-    \"chunk-dep2-DaLIbws0.js\"\n+    \"chunk-dep2-Cr_zOuBy.js\"\n   ],\n   \"modules\": {\n     \"**/dep3.js\": {\n-      \"code\": \"var num = 3;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"var num = 3;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 19,\n       \"removedExports\": [],\n       \"renderedExports\": [\n         \"num\"\n       ],\n-      \"renderedLength\": 269\n+      \"renderedLength\": 330\n     },\n     \"**/main2.js\": {\n-      \"code\": \"console.log(dep2.num + num);\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"console.log(dep2.num + num);\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-C4X7hChn').href : new URL('asset-test-C4X7hChn', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 102,\n       \"removedExports\": [],\n       \"renderedExports\": [],\n-      \"renderedLength\": 285\n+      \"renderedLength\": 346\n     }\n   },\n   \"referencedFiles\": [\n     \"asset-test-C4X7hChn\"\n   ]\n });\n-console.log('all chunks', [\"entry-main1-s6RHXqBe.js\",\"entry-main2-DPo9-iBy.js\",\"chunk-dep2-DaLIbws0.js\"])\n+console.log('all chunks', [\"entry-main1-CW_cw0go.js\",\"entry-main2-CvqsXhWd.js\",\"chunk-dep2-Cr_zOuBy.js\"])\n console.log('referenced asset in renderChunk', 'asset-test-C4X7hChn');",
                "previous_filename": "test/chunking-form/samples/render-chunk/_expected/cjs/entry-main2-DPo9-iBy.js"
            },
            {
                "sha": "4406e594f63c0801e617e1650c808669b50e7e6b",
                "filename": "test/chunking-form/samples/resolve-file-url/_expected/cjs/main.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fresolve-file-url%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fchunking-form%2Fsamples%2Fresolve-file-url%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fresolve-file-url%2F_expected%2Fcjs%2Fmain.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -3,7 +3,7 @@\n const asset$1 = 'resolved';\n const chunk$1 = 'resolved';\n \n-const asset = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-B7Qh6_pN.txt').href : new URL('assets/asset-unresolved-B7Qh6_pN.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const chunk = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/nested/chunk2.js').href : new URL('nested/chunk2.js', document.currentScript && document.currentScript.src || document.baseURI).href);\n+const asset = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-B7Qh6_pN.txt').href : new URL('assets/asset-unresolved-B7Qh6_pN.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const chunk = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/nested/chunk2.js').href : new URL('nested/chunk2.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n Promise.resolve().then(function () { return require('./nested/chunk.js'); }).then(result => console.log(result, chunk$1, chunk, asset$1, asset));"
            },
            {
                "sha": "dc1ef8f2d964f1e74896f4dd54f1508d3d7f5303",
                "filename": "test/form/samples/configure-file-url/_expected/cjs.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fcjs.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -4,6 +4,6 @@ var asset1 = 'chunkId=cjs.js:moduleId=solved:fileName=assets/asset-solved-DSjIji\n \n var asset2 = 'resolved';\n \n-var asset3 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-B7Qh6_pN.txt').href : new URL('assets/asset-unresolved-B7Qh6_pN.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset3 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-B7Qh6_pN.txt').href : new URL('assets/asset-unresolved-B7Qh6_pN.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n console.log(asset1, asset2, asset3);"
            },
            {
                "sha": "a53ad90da5740d5c55425412f80e6e7cdc932468",
                "filename": "test/form/samples/configure-file-url/_expected/iife.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fiife.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -5,7 +5,7 @@\n \n \tvar asset2 = 'resolved';\n \n-\tvar asset3 = new URL('assets/asset-unresolved-B7Qh6_pN.txt', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar asset3 = new URL('assets/asset-unresolved-B7Qh6_pN.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n \tconsole.log(asset1, asset2, asset3);\n "
            },
            {
                "sha": "ba84ba7407b86846c0b5b6bd639fb39d43dfa67e",
                "filename": "test/form/samples/configure-file-url/_expected/umd.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fumd.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -7,7 +7,7 @@\n \n \tvar asset2 = 'resolved';\n \n-\tvar asset3 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-B7Qh6_pN.txt').href : new URL('assets/asset-unresolved-B7Qh6_pN.txt', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar asset3 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-B7Qh6_pN.txt').href : new URL('assets/asset-unresolved-B7Qh6_pN.txt', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n \tconsole.log(asset1, asset2, asset3);\n "
            },
            {
                "sha": "de9fe06c73a83b272d37f197f37b0583fc3ba62a",
                "filename": "test/form/samples/deconflict-format-specific-globals/_expected/cjs.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fcjs.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -38,7 +38,7 @@ console.log(_interopDefault$1, _interopNamespace$1, module$1, require$1, exports\n \n Promise.resolve().then(function () { return /*#__PURE__*/_interopNamespace(require('external')); }).then(console.log);\n exports.default = 0;\n-console.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n+console.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n \n function nested1() {\n \tconst _interopDefault = 1;\n@@ -52,7 +52,7 @@ function nested1() {\n \n \tPromise.resolve().then(function () { return /*#__PURE__*/_interopNamespace(require('external')); }).then(console.log);\n \texports.default = 1;\n-\tconsole.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n+\tconsole.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n }\n \n nested1();"
            },
            {
                "sha": "79215c9d9a1e690dab9fbb0d314659f1624fa925",
                "filename": "test/form/samples/deconflict-format-specific-globals/_expected/iife.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fiife.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -19,7 +19,7 @@ var bundle = (function (external) {\n \n \timport('external').then(console.log);\n \texports.default = 0;\n-\tconsole.log((_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n+\tconsole.log((_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n \n \tfunction nested1() {\n \t\tconst _interopDefault = 1;\n@@ -33,7 +33,7 @@ var bundle = (function (external) {\n \n \t\timport('external').then(console.log);\n \t\texports.default = 1;\n-\t\tconsole.log((_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n+\t\tconsole.log((_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n \t}\n \n \tnested1();"
            },
            {
                "sha": "12411d78ca9772b7121d6214f0815c6bad2a6405",
                "filename": "test/form/samples/deconflict-format-specific-globals/_expected/umd.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fumd.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -22,7 +22,7 @@\n \n \timport('external').then(console.log);\n \texports.default = 0;\n-\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n+\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n \n \tfunction nested1() {\n \t\tconst _interopDefault = 1;\n@@ -36,7 +36,7 @@\n \n \t\timport('external').then(console.log);\n \t\texports.default = 1;\n-\t\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n+\t\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n \t}\n \n \tnested1();"
            },
            {
                "sha": "a045b662ea4ed222d4653aa6c7d1efcc98748ae7",
                "filename": "test/form/samples/emit-asset-file/_expected/cjs.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fcjs.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,8 +1,8 @@\n 'use strict';\n \n-var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo-zDlmrXar.svg').href : new URL('assets/logo-zDlmrXar.svg', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo-zDlmrXar.svg').href : new URL('assets/logo-zDlmrXar.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-var logoReverse = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo_reverse\\'-DbGK2oiS.svg').href : new URL('assets/logo_reverse\\'-DbGK2oiS.svg', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var logoReverse = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo_reverse\\'-DbGK2oiS.svg').href : new URL('assets/logo_reverse\\'-DbGK2oiS.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n function showImage(url) {\n \tconsole.log(url);"
            },
            {
                "sha": "99f0cd4ef985304310e691f531d2f3d88233a867",
                "filename": "test/form/samples/emit-asset-file/_expected/iife.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fiife.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,9 +1,9 @@\n (function () {\n \t'use strict';\n \n-\tvar logo = new URL('assets/logo-zDlmrXar.svg', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar logo = new URL('assets/logo-zDlmrXar.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n-\tvar logoReverse = new URL('assets/logo_reverse\\'-DbGK2oiS.svg', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar logoReverse = new URL('assets/logo_reverse\\'-DbGK2oiS.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n \tfunction showImage(url) {\n \t\tconsole.log(url);"
            },
            {
                "sha": "b0a946f43b813f92f9e3e75c4f1af1850d13bbfa",
                "filename": "test/form/samples/emit-asset-file/_expected/umd.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fumd.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -3,9 +3,9 @@\n \tfactory();\n })((function () { 'use strict';\n \n-\tvar logo = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo-zDlmrXar.svg').href : new URL('assets/logo-zDlmrXar.svg', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar logo = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo-zDlmrXar.svg').href : new URL('assets/logo-zDlmrXar.svg', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-\tvar logoReverse = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo_reverse\\'-DbGK2oiS.svg').href : new URL('assets/logo_reverse\\'-DbGK2oiS.svg', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar logoReverse = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo_reverse\\'-DbGK2oiS.svg').href : new URL('assets/logo_reverse\\'-DbGK2oiS.svg', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n \tfunction showImage(url) {\n \t\tconsole.log(url);"
            },
            {
                "sha": "34b0f4e18c8d11bf2dc6cf76c7bb6c0167d280b1",
                "filename": "test/form/samples/emit-uint8array-no-buffer/_expected/cjs.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fcjs.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,9 +1,9 @@\n 'use strict';\n \n-var asset1 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-C1v24hPj').href : new URL('assets/asset-C1v24hPj', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset1 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-C1v24hPj').href : new URL('assets/asset-C1v24hPj', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-var asset2 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-CtWoGP2A').href : new URL('assets/asset-CtWoGP2A', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset2 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-CtWoGP2A').href : new URL('assets/asset-CtWoGP2A', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-var asset99 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-8_Inlget').href : new URL('assets/asset-8_Inlget', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset99 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-8_Inlget').href : new URL('assets/asset-8_Inlget', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n console.log(asset1, asset2, asset99);"
            },
            {
                "sha": "34744b4be322aea05cb61e76ca292d76d658d2a6",
                "filename": "test/form/samples/emit-uint8array-no-buffer/_expected/iife.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fiife.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,11 +1,11 @@\n (function () {\n \t'use strict';\n \n-\tvar asset1 = new URL('assets/asset-C1v24hPj', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar asset1 = new URL('assets/asset-C1v24hPj', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n-\tvar asset2 = new URL('assets/asset-CtWoGP2A', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar asset2 = new URL('assets/asset-CtWoGP2A', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n-\tvar asset99 = new URL('assets/asset-8_Inlget', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar asset99 = new URL('assets/asset-8_Inlget', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n \tconsole.log(asset1, asset2, asset99);\n "
            },
            {
                "sha": "400d414421846b3bba6f55f9b0a3adab28944719",
                "filename": "test/form/samples/emit-uint8array-no-buffer/_expected/umd.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fumd.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -3,11 +3,11 @@\n \tfactory();\n })((function () { 'use strict';\n \n-\tvar asset1 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-C1v24hPj').href : new URL('assets/asset-C1v24hPj', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar asset1 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-C1v24hPj').href : new URL('assets/asset-C1v24hPj', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-\tvar asset2 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-CtWoGP2A').href : new URL('assets/asset-CtWoGP2A', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar asset2 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-CtWoGP2A').href : new URL('assets/asset-CtWoGP2A', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-\tvar asset99 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-8_Inlget').href : new URL('assets/asset-8_Inlget', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar asset99 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-8_Inlget').href : new URL('assets/asset-8_Inlget', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n \tconsole.log(asset1, asset2, asset99);\n "
            },
            {
                "sha": "627bdaafb55d47493ef73ad54874e2f61a06c165",
                "filename": "test/form/samples/import-meta-url/_expected/cjs.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -9,4 +9,4 @@ function log(url) {\n \t}\n }\n \n-log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n+log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));"
            },
            {
                "sha": "78e89b6f5a5047a37c706d4d3a46851bd56f4477",
                "filename": "test/form/samples/import-meta-url/_expected/iife.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fiife.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -10,6 +10,6 @@\n \t\t}\n \t}\n \n-\tlog((_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n+\tlog((_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n \n })();"
            },
            {
                "sha": "16bfbc0c7d9941488fb8055da30f588fd1f85253",
                "filename": "test/form/samples/import-meta-url/_expected/umd.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fumd.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -12,6 +12,6 @@\n \t\t}\n \t}\n \n-\tlog((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n+\tlog((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n \n }));"
            },
            {
                "sha": "e9237dfc42ddfe4254d021f3f042ccf9bb624a58",
                "filename": "test/form/samples/import-meta/_expected/cjs.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fcjs.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -1,4 +1,4 @@\n 'use strict';\n \n var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-console.log(({ url: (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)) }));\n+console.log(({ url: (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)) }));"
            },
            {
                "sha": "fb1536378daec436e73f133a9fb5d4f345e2ec77",
                "filename": "test/form/samples/import-meta/_expected/iife.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fiife.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -2,6 +2,6 @@\n \t'use strict';\n \n \tvar _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-\tconsole.log(({ url: (_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href) }));\n+\tconsole.log(({ url: (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href) }));\n \n })();"
            },
            {
                "sha": "7d52eac886bdb7f3141d0c749f04ee437c758855",
                "filename": "test/form/samples/import-meta/_expected/umd.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fumd.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -4,6 +4,6 @@\n })((function () { 'use strict';\n \n \tvar _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-\tconsole.log(({ url: (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)) }));\n+\tconsole.log(({ url: (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)) }));\n \n }));"
            },
            {
                "sha": "17ad437ca9a1efd968c838f5f98f5dd6d0ea11ca",
                "filename": "test/form/samples/resolve-import-meta-url/_expected/cjs.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fcjs.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -5,9 +5,9 @@ console.log('resolved');\n console.log('resolved');\n console.log('resolved');\n \n-console.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n+console.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n console.log(undefined);\n-console.log(({ url: (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)) }));\n+console.log(({ url: (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)) }));\n \n console.log('url=cjs.js:resolve-import-meta-url/main.js');\n console.log('privateProp=cjs.js:resolve-import-meta-url/main.js');"
            },
            {
                "sha": "e1cfc0e52986f4ba5b2b69eb318cd958908562b6",
                "filename": "test/form/samples/resolve-import-meta-url/_expected/iife.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fiife.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -6,9 +6,9 @@\n \tconsole.log('resolved');\n \tconsole.log('resolved');\n \n-\tconsole.log((_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n+\tconsole.log((_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n \tconsole.log(undefined);\n-\tconsole.log(({ url: (_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href) }));\n+\tconsole.log(({ url: (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href) }));\n \n \tconsole.log('url=iife.js:resolve-import-meta-url/main.js');\n \tconsole.log('privateProp=iife.js:resolve-import-meta-url/main.js');"
            },
            {
                "sha": "220d0d20124f81793ffc70ce4eba4fe1cf4ee1a8",
                "filename": "test/form/samples/resolve-import-meta-url/_expected/umd.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fumd.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -8,9 +8,9 @@\n \tconsole.log('resolved');\n \tconsole.log('resolved');\n \n-\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n+\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n \tconsole.log(undefined);\n-\tconsole.log(({ url: (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)) }));\n+\tconsole.log(({ url: (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)) }));\n \n \tconsole.log('url=umd.js:resolve-import-meta-url/main.js');\n \tconsole.log('privateProp=umd.js:resolve-import-meta-url/main.js');"
            },
            {
                "sha": "cbfd63c2357ae715200e5dceb070b735b9eeb594",
                "filename": "test/function/samples/import-meta-url-b/_config.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Ffunction%2Fsamples%2Fimport-meta-url-b%2F_config.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Ffunction%2Fsamples%2Fimport-meta-url-b%2F_config.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Ffunction%2Fsamples%2Fimport-meta-url-b%2F_config.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -7,7 +7,8 @@ module.exports = defineTest({\n \tcontext: {\n \t\tdocument: {\n \t\t\tcurrentScript: {\n-\t\t\t\tsrc: source\n+\t\t\t\tsrc: source,\n+\t\t\t\ttagName: 'SCRIPT'\n \t\t\t}\n \t\t}\n \t},"
            },
            {
                "sha": "ac0dc17caff2371aea043eeb3eea18288356947a",
                "filename": "test/function/samples/import-meta-url-with-compact/_config.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/rollup/rollup/blob/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Ffunction%2Fsamples%2Fimport-meta-url-with-compact%2F_config.js",
                "raw_url": "https://github.com/rollup/rollup/raw/e2552c9e955e0a61f70f508200ee9f752f85a541/test%2Ffunction%2Fsamples%2Fimport-meta-url-with-compact%2F_config.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Ffunction%2Fsamples%2Fimport-meta-url-with-compact%2F_config.js?ref=e2552c9e955e0a61f70f508200ee9f752f85a541",
                "patch": "@@ -7,7 +7,8 @@ module.exports = defineTest({\n \tcontext: {\n \t\tdocument: {\n \t\t\tcurrentScript: {\n-\t\t\t\tsrc: source\n+\t\t\t\tsrc: source,\n+\t\t\t\ttagName: 'SCRIPT'\n \t\t\t}\n \t\t}\n \t},"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rollup/rollup/commits/2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
        "url": "https://api.github.com/repos/rollup/rollup/commits/2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
        "html_url": "https://github.com/rollup/rollup/commit/2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
        "message": "Fix DOM Clobbering CVE",
        "files": [
            {
                "sha": "e9dcac56b6f291205c4164c33c5bc95c793a1b19",
                "filename": "src/ast/nodes/MetaProperty.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/src%2Fast%2Fnodes%2FMetaProperty.ts",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/src%2Fast%2Fnodes%2FMetaProperty.ts",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/src%2Fast%2Fnodes%2FMetaProperty.ts?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -156,7 +156,7 @@ const getRelativeUrlFromDocument = (relativePath: string, umd = false) =>\n \tgetResolveUrl(\n \t\t`'${escapeId(relativePath)}', ${\n \t\t\tumd ? `typeof document === 'undefined' ? location.href : ` : ''\n-\t\t}document.currentScript && document.currentScript.src || document.baseURI`\n+\t\t}document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI`\n \t);\n \n const getGenericImportMetaMechanism =\n@@ -178,7 +178,7 @@ const getFileUrlFromRelativePath = (path: string) =>\n const getUrlFromDocument = (chunkId: string, umd = false) =>\n \t`${\n \t\tumd ? `typeof document === 'undefined' ? location.href : ` : ''\n-\t}(${DOCUMENT_CURRENT_SCRIPT} && ${DOCUMENT_CURRENT_SCRIPT}.src || new URL('${escapeId(\n+\t}(${DOCUMENT_CURRENT_SCRIPT} && ${DOCUMENT_CURRENT_SCRIPT}.tagName.toUpperCase() === 'SCRIPT' && ${DOCUMENT_CURRENT_SCRIPT}.src || new URL('${escapeId(\n \t\tchunkId\n \t)}', document.baseURI).href)`;\n "
            },
            {
                "sha": "5fe6927ab20f5b2e1aa025bb30477081f397f002",
                "filename": "test/chunking-form/samples/asset-needs-code-reference/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fasset-needs-code-reference%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fasset-needs-code-reference%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fasset-needs-code-reference%2F_expected%2Fcjs%2Fmain.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-var asset2 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/logo2.svg').href : new URL('logo2.svg', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset2 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/logo2.svg').href : new URL('logo2.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n {\n \tconst image = document.createElement('img');"
            },
            {
                "sha": "4f2e3528610e911506aa5841e14778baab71e581",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-with-importer/_expected/cjs/main.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-with-importer%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-with-importer%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-with-importer%2F_expected%2Fcjs%2Fmain.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,5 +1,5 @@\n 'use strict';\n \n-console.log('no importer', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib.js').href : new URL('generated-lib.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n-console.log('from maim', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib.js').href : new URL('generated-lib.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n-console.log('from nested', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib2.js').href : new URL('generated-lib2.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('no importer', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib.js').href : new URL('generated-lib.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n+console.log('from maim', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib.js').href : new URL('generated-lib.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n+console.log('from nested', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generated-lib2.js').href : new URL('generated-lib2.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));"
            },
            {
                "sha": "068a048b4c6fa0716c2ae0a6caf4955b9e5516f7",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-worker/_expected/cjs/chunks/nested.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fnested.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fnested.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fnested.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,7 +1,7 @@\n 'use strict';\n \n const getWorkerMessage = () => new Promise(resolve => {\n-  const worker = new Worker((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/worker-proxy.js').href : new URL('worker-proxy.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+  const worker = new Worker((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/worker-proxy.js').href : new URL('worker-proxy.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n   worker.onmessage = resolve;\n });\n "
            },
            {
                "sha": "74905837541892f36bcea735b5c3bce7d4dc2592",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-worker/_expected/cjs/chunks/worker-proxy.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fworker-proxy.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fworker-proxy.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fchunks%2Fworker-proxy.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,3 +1,3 @@\n 'use strict';\n \n-PLACEHOLDER((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/worker.js').href : new URL('worker.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+PLACEHOLDER((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/worker.js').href : new URL('worker.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));"
            },
            {
                "sha": "a1cd157d07482f5ac20ccb4591f02434391e0717",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-worker/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worker%2F_expected%2Fcjs%2Fmain.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -3,7 +3,7 @@\n var shared = require('./chunks/shared.js');\n \n const getWorkerMessage = () => new Promise(resolve => {\n-  const worker = new Worker((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/chunks/worker-proxy.js').href : new URL('chunks/worker-proxy.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+  const worker = new Worker((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/chunks/worker-proxy.js').href : new URL('chunks/worker-proxy.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n   worker.onmessage = resolve;\n });\n "
            },
            {
                "sha": "98ae99aa4ca1830ceab054fdd635dd82b373cc89",
                "filename": "test/chunking-form/samples/emit-file/emit-chunk-worklet/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worklet%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worklet%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Femit-chunk-worklet%2F_expected%2Fcjs%2Fmain.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -2,6 +2,6 @@\n \n var shared = require('./chunks/shared.js');\n \n-CSS.paintWorklet.addModule((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/chunks/worklet.js').href : new URL('chunks/worklet.js', document.currentScript && document.currentScript.src || document.baseURI).href));\n+CSS.paintWorklet.addModule((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/chunks/worklet.js').href : new URL('chunks/worklet.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n \n document.body.innerHTML += `<h1 style=\"background-image: paint(vertical-lines);\">color: ${shared.color}, size: ${shared.size}</h1>`;"
            },
            {
                "sha": "475efc777b2d551135b2f3c7dde1e88a8af8b75c",
                "filename": "test/chunking-form/samples/emit-file/reference-files/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fmain.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo1-60bc15c4.svg').href : new URL('assets/logo1-60bc15c4.svg', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo1-60bc15c4.svg').href : new URL('assets/logo1-60bc15c4.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n function showImage(url) {\n \tconsole.log(url);"
            },
            {
                "sha": "0bac313fa280e1084fbe277a74d6d1bbaf878df8",
                "filename": "test/chunking-form/samples/emit-file/reference-files/_expected/cjs/nested/chunk.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fnested%2Fchunk.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fnested%2Fchunk.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Freference-files%2F_expected%2Fcjs%2Fnested%2Fchunk.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -2,6 +2,6 @@\n \n var main = require('../main.js');\n \n-var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/../assets/logo2-fdaa7478.svg').href : new URL('../assets/logo2-fdaa7478.svg', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/../assets/logo2-fdaa7478.svg').href : new URL('../assets/logo2-fdaa7478.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n main.showImage(logo);"
            },
            {
                "sha": "7199af7c5040a5f0c53aec1b6bd7470b1b64f7d7",
                "filename": "test/chunking-form/samples/emit-file/set-asset-source/_expected/cjs/main.js",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Fset-asset-source%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Femit-file%2Fset-asset-source%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Femit-file%2Fset-asset-source%2F_expected%2Fcjs%2Fmain.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,14 +1,14 @@\n 'use strict';\n \n-const renderStart = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/renderStart-981aa2ea.txt').href : new URL('assets/renderStart-981aa2ea.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const renderStartNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/renderStart.txt').href : new URL('renderStart.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n+const renderStart = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/renderStart-981aa2ea.txt').href : new URL('assets/renderStart-981aa2ea.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const renderStartNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/renderStart.txt').href : new URL('renderStart.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n const renderStartNamedImmediately = 'renderStart.txt';\n-const bannerNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/banner.txt').href : new URL('banner.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const footerNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/footer.txt').href : new URL('footer.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const introNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/intro.txt').href : new URL('intro.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const outroNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/outro.txt').href : new URL('outro.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const renderChunkNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/renderChunk.txt').href : new URL('renderChunk.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const generateBundleNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generateBundle.txt').href : new URL('generateBundle.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n+const bannerNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/banner.txt').href : new URL('banner.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const footerNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/footer.txt').href : new URL('footer.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const introNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/intro.txt').href : new URL('intro.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const outroNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/outro.txt').href : new URL('outro.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const renderChunkNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/renderChunk.txt').href : new URL('renderChunk.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const generateBundleNamed = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/generateBundle.txt').href : new URL('generateBundle.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n exports.bannerNamed = bannerNamed;\n exports.footerNamed = footerNamed;"
            },
            {
                "sha": "554aa8e8546a6ed04ddb313b10bb66ca4cb4ae89",
                "filename": "test/chunking-form/samples/import-meta-numeric-paths/_expected/cjs/0/1/nested.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fimport-meta-numeric-paths%2F_expected%2Fcjs%2F0%2F1%2Fnested.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fimport-meta-numeric-paths%2F_expected%2Fcjs%2F0%2F1%2Fnested.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fimport-meta-numeric-paths%2F_expected%2Fcjs%2F0%2F1%2Fnested.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-const url = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('0/1/nested.js', document.baseURI).href));\n+const url = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('0/1/nested.js', document.baseURI).href));\n \n exports.url = url;"
            },
            {
                "sha": "bb2e40a89faf035bbc685d00554ecbfdb595c81f",
                "filename": "test/chunking-form/samples/import-meta-url/_expected/cjs/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fmain.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -9,7 +9,7 @@ function log(url) {\n \t}\n }\n \n-log('main: ' + (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('main.js', document.baseURI).href)));\n+log('main: ' + (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('main.js', document.baseURI).href)));\n Promise.resolve().then(function () { return require('./nested/chunk.js'); });\n \n exports.log = log;"
            },
            {
                "sha": "43c3320e6864410f6e621e68f7b3c6d444ea373f",
                "filename": "test/chunking-form/samples/import-meta-url/_expected/cjs/nested/chunk.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fnested%2Fchunk.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fnested%2Fchunk.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs%2Fnested%2Fchunk.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -3,4 +3,4 @@\n var main = require('../main.js');\n \n var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-main.log('nested: ' + (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('nested/chunk.js', document.baseURI).href)));\n+main.log('nested: ' + (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('nested/chunk.js', document.baseURI).href)));"
            },
            {
                "sha": "2bf13f438efb22a8faa4dc81ee83ebb5a44d84ef",
                "filename": "test/chunking-form/samples/render-chunk/_expected/cjs/chunk-dep2-e49c5bba.js",
                "status": "renamed",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fchunk-dep2-e49c5bba.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fchunk-dep2-e49c5bba.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fchunk-dep2-e49c5bba.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,7 +1,7 @@\n 'use strict';\n \n var num = 2;\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n \n exports.num = num;\n console.log({\n@@ -18,24 +18,24 @@ console.log({\n   \"name\": \"dep2\",\n   \"type\": \"chunk\",\n   \"dynamicImports\": [],\n-  \"fileName\": \"chunk-dep2-8d89c265.js\",\n+  \"fileName\": \"chunk-dep2-e49c5bba.js\",\n   \"implicitlyLoadedBefore\": [],\n   \"importedBindings\": {},\n   \"imports\": [],\n   \"modules\": {\n     \"**/dep2.js\": {\n-      \"code\": \"var num = 2;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"var num = 2;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 19,\n       \"removedExports\": [],\n       \"renderedExports\": [\n         \"num\"\n       ],\n-      \"renderedLength\": 269\n+      \"renderedLength\": 330\n     }\n   },\n   \"referencedFiles\": [\n     \"asset-test-9f86d081\"\n   ]\n });\n-console.log('all chunks', [\"entry-main1-5be92ae4.js\",\"entry-main2-20c5a0f4.js\",\"chunk-dep2-8d89c265.js\"])\n+console.log('all chunks', [\"entry-main1-31317016.js\",\"entry-main2-f63e5752.js\",\"chunk-dep2-e49c5bba.js\"])\n console.log('referenced asset in renderChunk', 'asset-test-9f86d081');",
                "previous_filename": "test/chunking-form/samples/render-chunk/_expected/cjs/chunk-dep2-8d89c265.js"
            },
            {
                "sha": "1e791b4f2afa15dbdfdde0e992106b7a6c05cc8a",
                "filename": "test/chunking-form/samples/render-chunk/_expected/cjs/entry-main1-31317016.js",
                "status": "renamed",
                "additions": 11,
                "deletions": 11,
                "changes": 22,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main1-31317016.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main1-31317016.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main1-31317016.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,12 +1,12 @@\n 'use strict';\n \n-var dep2 = require('./chunk-dep2-8d89c265.js');\n+var dep2 = require('./chunk-dep2-e49c5bba.js');\n \n var num = 1;\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n \n console.log(num + dep2.num);\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n console.log({\n   \"exports\": [],\n   \"facadeModuleId\": \"**/main1.js\",\n@@ -20,37 +20,37 @@ console.log({\n   \"name\": \"main1\",\n   \"type\": \"chunk\",\n   \"dynamicImports\": [],\n-  \"fileName\": \"entry-main1-5be92ae4.js\",\n+  \"fileName\": \"entry-main1-31317016.js\",\n   \"implicitlyLoadedBefore\": [],\n   \"importedBindings\": {\n-    \"chunk-dep2-8d89c265.js\": [\n+    \"chunk-dep2-e49c5bba.js\": [\n       \"num\"\n     ]\n   },\n   \"imports\": [\n-    \"chunk-dep2-8d89c265.js\"\n+    \"chunk-dep2-e49c5bba.js\"\n   ],\n   \"modules\": {\n     \"**/dep1.js\": {\n-      \"code\": \"var num = 1;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"var num = 1;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 19,\n       \"removedExports\": [],\n       \"renderedExports\": [\n         \"num\"\n       ],\n-      \"renderedLength\": 269\n+      \"renderedLength\": 330\n     },\n     \"**/main1.js\": {\n-      \"code\": \"console.log(num + dep2.num);\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"console.log(num + dep2.num);\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 102,\n       \"removedExports\": [],\n       \"renderedExports\": [],\n-      \"renderedLength\": 285\n+      \"renderedLength\": 346\n     }\n   },\n   \"referencedFiles\": [\n     \"asset-test-9f86d081\"\n   ]\n });\n-console.log('all chunks', [\"entry-main1-5be92ae4.js\",\"entry-main2-20c5a0f4.js\",\"chunk-dep2-8d89c265.js\"])\n+console.log('all chunks', [\"entry-main1-31317016.js\",\"entry-main2-f63e5752.js\",\"chunk-dep2-e49c5bba.js\"])\n console.log('referenced asset in renderChunk', 'asset-test-9f86d081');",
                "previous_filename": "test/chunking-form/samples/render-chunk/_expected/cjs/entry-main1-5be92ae4.js"
            },
            {
                "sha": "f10ca6a4670557bf60b4170d6683460aed99f375",
                "filename": "test/chunking-form/samples/render-chunk/_expected/cjs/entry-main2-f63e5752.js",
                "status": "renamed",
                "additions": 11,
                "deletions": 11,
                "changes": 22,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main2-f63e5752.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main2-f63e5752.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Frender-chunk%2F_expected%2Fcjs%2Fentry-main2-f63e5752.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,12 +1,12 @@\n 'use strict';\n \n-var dep2 = require('./chunk-dep2-8d89c265.js');\n+var dep2 = require('./chunk-dep2-e49c5bba.js');\n \n var num = 3;\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n \n console.log(dep2.num + num);\n-console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\n+console.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\n console.log({\n   \"exports\": [],\n   \"facadeModuleId\": \"**/main2.js\",\n@@ -20,37 +20,37 @@ console.log({\n   \"name\": \"main2\",\n   \"type\": \"chunk\",\n   \"dynamicImports\": [],\n-  \"fileName\": \"entry-main2-20c5a0f4.js\",\n+  \"fileName\": \"entry-main2-f63e5752.js\",\n   \"implicitlyLoadedBefore\": [],\n   \"importedBindings\": {\n-    \"chunk-dep2-8d89c265.js\": [\n+    \"chunk-dep2-e49c5bba.js\": [\n       \"num\"\n     ]\n   },\n   \"imports\": [\n-    \"chunk-dep2-8d89c265.js\"\n+    \"chunk-dep2-e49c5bba.js\"\n   ],\n   \"modules\": {\n     \"**/dep3.js\": {\n-      \"code\": \"var num = 3;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"var num = 3;\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 19,\n       \"removedExports\": [],\n       \"renderedExports\": [\n         \"num\"\n       ],\n-      \"renderedLength\": 269\n+      \"renderedLength\": 330\n     },\n     \"**/main2.js\": {\n-      \"code\": \"console.log(dep2.num + num);\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.src || document.baseURI).href));\",\n+      \"code\": \"console.log(dep2.num + num);\\nconsole.log('referenced asset', (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/asset-test-9f86d081').href : new URL('asset-test-9f86d081', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href));\",\n       \"originalLength\": 102,\n       \"removedExports\": [],\n       \"renderedExports\": [],\n-      \"renderedLength\": 285\n+      \"renderedLength\": 346\n     }\n   },\n   \"referencedFiles\": [\n     \"asset-test-9f86d081\"\n   ]\n });\n-console.log('all chunks', [\"entry-main1-5be92ae4.js\",\"entry-main2-20c5a0f4.js\",\"chunk-dep2-8d89c265.js\"])\n+console.log('all chunks', [\"entry-main1-31317016.js\",\"entry-main2-f63e5752.js\",\"chunk-dep2-e49c5bba.js\"])\n console.log('referenced asset in renderChunk', 'asset-test-9f86d081');",
                "previous_filename": "test/chunking-form/samples/render-chunk/_expected/cjs/entry-main2-20c5a0f4.js"
            },
            {
                "sha": "1890509a14f66858a8dc793a4e257cd0529346fc",
                "filename": "test/chunking-form/samples/resolve-file-url/_expected/cjs/main.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fresolve-file-url%2F_expected%2Fcjs%2Fmain.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fchunking-form%2Fsamples%2Fresolve-file-url%2F_expected%2Fcjs%2Fmain.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fchunking-form%2Fsamples%2Fresolve-file-url%2F_expected%2Fcjs%2Fmain.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -3,7 +3,7 @@\n const asset$1 = 'resolved';\n const chunk$1 = 'resolved';\n \n-const asset = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-f4c1e86c.txt').href : new URL('assets/asset-unresolved-f4c1e86c.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n-const chunk = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/nested/chunk2.js').href : new URL('nested/chunk2.js', document.currentScript && document.currentScript.src || document.baseURI).href);\n+const asset = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-f4c1e86c.txt').href : new URL('assets/asset-unresolved-f4c1e86c.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n+const chunk = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/nested/chunk2.js').href : new URL('nested/chunk2.js', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n Promise.resolve().then(function () { return require('./nested/chunk.js'); }).then(result => console.log(result, chunk$1, chunk, asset$1, asset));"
            },
            {
                "sha": "6796791d442aecc44aa9f0137392008578213d42",
                "filename": "test/form/samples/configure-file-url/_expected/cjs.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fcjs.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -4,6 +4,6 @@ var asset1 = 'chunkId=cjs.js:moduleId=solved:fileName=assets/asset-solved-230eca\n \n var asset2 = 'resolved';\n \n-var asset3 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-f4c1e86c.txt').href : new URL('assets/asset-unresolved-f4c1e86c.txt', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset3 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-f4c1e86c.txt').href : new URL('assets/asset-unresolved-f4c1e86c.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n console.log(asset1, asset2, asset3);"
            },
            {
                "sha": "56fceabc89b6ebd543f39b6de96bffc4dcecb22c",
                "filename": "test/form/samples/configure-file-url/_expected/iife.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fiife.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -5,7 +5,7 @@\n \n \tvar asset2 = 'resolved';\n \n-\tvar asset3 = new URL('assets/asset-unresolved-f4c1e86c.txt', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar asset3 = new URL('assets/asset-unresolved-f4c1e86c.txt', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n \tconsole.log(asset1, asset2, asset3);\n "
            },
            {
                "sha": "2dc4fd336aca62749e145e59f36908ab16b1768f",
                "filename": "test/form/samples/configure-file-url/_expected/umd.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fconfigure-file-url%2F_expected%2Fumd.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -7,7 +7,7 @@\n \n \tvar asset2 = 'resolved';\n \n-\tvar asset3 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-f4c1e86c.txt').href : new URL('assets/asset-unresolved-f4c1e86c.txt', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar asset3 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-unresolved-f4c1e86c.txt').href : new URL('assets/asset-unresolved-f4c1e86c.txt', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n \tconsole.log(asset1, asset2, asset3);\n "
            },
            {
                "sha": "de9fe06c73a83b272d37f197f37b0583fc3ba62a",
                "filename": "test/form/samples/deconflict-format-specific-globals/_expected/cjs.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fcjs.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -38,7 +38,7 @@ console.log(_interopDefault$1, _interopNamespace$1, module$1, require$1, exports\n \n Promise.resolve().then(function () { return /*#__PURE__*/_interopNamespace(require('external')); }).then(console.log);\n exports.default = 0;\n-console.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n+console.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n \n function nested1() {\n \tconst _interopDefault = 1;\n@@ -52,7 +52,7 @@ function nested1() {\n \n \tPromise.resolve().then(function () { return /*#__PURE__*/_interopNamespace(require('external')); }).then(console.log);\n \texports.default = 1;\n-\tconsole.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n+\tconsole.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n }\n \n nested1();"
            },
            {
                "sha": "79215c9d9a1e690dab9fbb0d314659f1624fa925",
                "filename": "test/form/samples/deconflict-format-specific-globals/_expected/iife.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fiife.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -19,7 +19,7 @@ var bundle = (function (external) {\n \n \timport('external').then(console.log);\n \texports.default = 0;\n-\tconsole.log((_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n+\tconsole.log((_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n \n \tfunction nested1() {\n \t\tconst _interopDefault = 1;\n@@ -33,7 +33,7 @@ var bundle = (function (external) {\n \n \t\timport('external').then(console.log);\n \t\texports.default = 1;\n-\t\tconsole.log((_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n+\t\tconsole.log((_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n \t}\n \n \tnested1();"
            },
            {
                "sha": "12411d78ca9772b7121d6214f0815c6bad2a6405",
                "filename": "test/form/samples/deconflict-format-specific-globals/_expected/umd.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fdeconflict-format-specific-globals%2F_expected%2Fumd.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -22,7 +22,7 @@\n \n \timport('external').then(console.log);\n \texports.default = 0;\n-\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n+\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n \n \tfunction nested1() {\n \t\tconst _interopDefault = 1;\n@@ -36,7 +36,7 @@\n \n \t\timport('external').then(console.log);\n \t\texports.default = 1;\n-\t\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n+\t\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n \t}\n \n \tnested1();"
            },
            {
                "sha": "c43683be0e8a37a439517fd7eb6ae0ada4f58b3e",
                "filename": "test/form/samples/emit-asset-file/_expected/cjs.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fcjs.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo-a2a2cdc4.svg').href : new URL('assets/logo-a2a2cdc4.svg', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var logo = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo-a2a2cdc4.svg').href : new URL('assets/logo-a2a2cdc4.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n function showImage(url) {\n \tconsole.log(url);"
            },
            {
                "sha": "97fb8dcd6c8122bdee00eb0b84f4101c0538fb72",
                "filename": "test/form/samples/emit-asset-file/_expected/iife.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fiife.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,7 +1,7 @@\n (function () {\n \t'use strict';\n \n-\tvar logo = new URL('assets/logo-a2a2cdc4.svg', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar logo = new URL('assets/logo-a2a2cdc4.svg', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n \tfunction showImage(url) {\n \t\tconsole.log(url);"
            },
            {
                "sha": "5c86f1f55c08ecaff1912df62e0fa892630dbf5b",
                "filename": "test/form/samples/emit-asset-file/_expected/umd.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-asset-file%2F_expected%2Fumd.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -3,7 +3,7 @@\n \tfactory();\n })((function () { 'use strict';\n \n-\tvar logo = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo-a2a2cdc4.svg').href : new URL('assets/logo-a2a2cdc4.svg', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar logo = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/logo-a2a2cdc4.svg').href : new URL('assets/logo-a2a2cdc4.svg', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n \tfunction showImage(url) {\n \t\tconsole.log(url);"
            },
            {
                "sha": "d4abd76ed81e20c677f3a66896064ca964b0069c",
                "filename": "test/form/samples/emit-uint8array-no-buffer/_expected/cjs.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fcjs.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,9 +1,9 @@\n 'use strict';\n \n-var asset1 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-8e3dd2ea').href : new URL('assets/asset-8e3dd2ea', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset1 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-8e3dd2ea').href : new URL('assets/asset-8e3dd2ea', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-var asset2 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-75590fc1').href : new URL('assets/asset-75590fc1', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset2 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-75590fc1').href : new URL('assets/asset-75590fc1', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-var asset99 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-60cc5dc9').href : new URL('assets/asset-60cc5dc9', document.currentScript && document.currentScript.src || document.baseURI).href);\n+var asset99 = (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-60cc5dc9').href : new URL('assets/asset-60cc5dc9', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n console.log(asset1, asset2, asset99);"
            },
            {
                "sha": "a0610996f8c072ff3a5d9cbaa8d9f4e16810fc9a",
                "filename": "test/form/samples/emit-uint8array-no-buffer/_expected/iife.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fiife.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,11 +1,11 @@\n (function () {\n \t'use strict';\n \n-\tvar asset1 = new URL('assets/asset-8e3dd2ea', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar asset1 = new URL('assets/asset-8e3dd2ea', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n-\tvar asset2 = new URL('assets/asset-75590fc1', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar asset2 = new URL('assets/asset-75590fc1', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n-\tvar asset99 = new URL('assets/asset-60cc5dc9', document.currentScript && document.currentScript.src || document.baseURI).href;\n+\tvar asset99 = new URL('assets/asset-60cc5dc9', document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href;\n \n \tconsole.log(asset1, asset2, asset99);\n "
            },
            {
                "sha": "cb0b1f8cea9c4c2114d104ac18dcaee0b8b192a2",
                "filename": "test/form/samples/emit-uint8array-no-buffer/_expected/umd.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Femit-uint8array-no-buffer%2F_expected%2Fumd.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -3,11 +3,11 @@\n \tfactory();\n })((function () { 'use strict';\n \n-\tvar asset1 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-8e3dd2ea').href : new URL('assets/asset-8e3dd2ea', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar asset1 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-8e3dd2ea').href : new URL('assets/asset-8e3dd2ea', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-\tvar asset2 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-75590fc1').href : new URL('assets/asset-75590fc1', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar asset2 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-75590fc1').href : new URL('assets/asset-75590fc1', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n-\tvar asset99 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-60cc5dc9').href : new URL('assets/asset-60cc5dc9', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.src || document.baseURI).href);\n+\tvar asset99 = (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__dirname + '/assets/asset-60cc5dc9').href : new URL('assets/asset-60cc5dc9', typeof document === 'undefined' ? location.href : document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI).href);\n \n \tconsole.log(asset1, asset2, asset99);\n "
            },
            {
                "sha": "627bdaafb55d47493ef73ad54874e2f61a06c165",
                "filename": "test/form/samples/import-meta-url/_expected/cjs.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fcjs.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -9,4 +9,4 @@ function log(url) {\n \t}\n }\n \n-log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n+log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));"
            },
            {
                "sha": "78e89b6f5a5047a37c706d4d3a46851bd56f4477",
                "filename": "test/form/samples/import-meta-url/_expected/iife.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fiife.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -10,6 +10,6 @@\n \t\t}\n \t}\n \n-\tlog((_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n+\tlog((_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n \n })();"
            },
            {
                "sha": "16bfbc0c7d9941488fb8055da30f588fd1f85253",
                "filename": "test/form/samples/import-meta-url/_expected/umd.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta-url%2F_expected%2Fumd.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -12,6 +12,6 @@\n \t\t}\n \t}\n \n-\tlog((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n+\tlog((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n \n }));"
            },
            {
                "sha": "e9237dfc42ddfe4254d021f3f042ccf9bb624a58",
                "filename": "test/form/samples/import-meta/_expected/cjs.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fcjs.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -1,4 +1,4 @@\n 'use strict';\n \n var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-console.log(({ url: (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)) }));\n+console.log(({ url: (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)) }));"
            },
            {
                "sha": "fb1536378daec436e73f133a9fb5d4f345e2ec77",
                "filename": "test/form/samples/import-meta/_expected/iife.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fiife.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -2,6 +2,6 @@\n \t'use strict';\n \n \tvar _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-\tconsole.log(({ url: (_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href) }));\n+\tconsole.log(({ url: (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href) }));\n \n })();"
            },
            {
                "sha": "7d52eac886bdb7f3141d0c749f04ee437c758855",
                "filename": "test/form/samples/import-meta/_expected/umd.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fimport-meta%2F_expected%2Fumd.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -4,6 +4,6 @@\n })((function () { 'use strict';\n \n \tvar _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;\n-\tconsole.log(({ url: (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)) }));\n+\tconsole.log(({ url: (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)) }));\n \n }));"
            },
            {
                "sha": "17ad437ca9a1efd968c838f5f98f5dd6d0ea11ca",
                "filename": "test/form/samples/resolve-import-meta-url/_expected/cjs.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fcjs.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fcjs.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fcjs.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -5,9 +5,9 @@ console.log('resolved');\n console.log('resolved');\n console.log('resolved');\n \n-console.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n+console.log((typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)));\n console.log(undefined);\n-console.log(({ url: (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)) }));\n+console.log(({ url: (typeof document === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('cjs.js', document.baseURI).href)) }));\n \n console.log('url=cjs.js:resolve-import-meta-url/main.js');\n console.log('privateProp=cjs.js:resolve-import-meta-url/main.js');"
            },
            {
                "sha": "e1cfc0e52986f4ba5b2b69eb318cd958908562b6",
                "filename": "test/form/samples/resolve-import-meta-url/_expected/iife.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fiife.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fiife.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fiife.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -6,9 +6,9 @@\n \tconsole.log('resolved');\n \tconsole.log('resolved');\n \n-\tconsole.log((_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n+\tconsole.log((_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href));\n \tconsole.log(undefined);\n-\tconsole.log(({ url: (_documentCurrentScript && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href) }));\n+\tconsole.log(({ url: (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('iife.js', document.baseURI).href) }));\n \n \tconsole.log('url=iife.js:resolve-import-meta-url/main.js');\n \tconsole.log('privateProp=iife.js:resolve-import-meta-url/main.js');"
            },
            {
                "sha": "220d0d20124f81793ffc70ce4eba4fe1cf4ee1a8",
                "filename": "test/form/samples/resolve-import-meta-url/_expected/umd.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fumd.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fumd.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Fform%2Fsamples%2Fresolve-import-meta-url%2F_expected%2Fumd.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -8,9 +8,9 @@\n \tconsole.log('resolved');\n \tconsole.log('resolved');\n \n-\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n+\tconsole.log((typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)));\n \tconsole.log(undefined);\n-\tconsole.log(({ url: (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)) }));\n+\tconsole.log(({ url: (typeof document === 'undefined' && typeof location === 'undefined' ? require('u' + 'rl').pathToFileURL(__filename).href : typeof document === 'undefined' ? location.href : (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('umd.js', document.baseURI).href)) }));\n \n \tconsole.log('url=umd.js:resolve-import-meta-url/main.js');\n \tconsole.log('privateProp=umd.js:resolve-import-meta-url/main.js');"
            },
            {
                "sha": "cbfd63c2357ae715200e5dceb070b735b9eeb594",
                "filename": "test/function/samples/import-meta-url-b/_config.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/rollup/rollup/blob/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Ffunction%2Fsamples%2Fimport-meta-url-b%2F_config.js",
                "raw_url": "https://github.com/rollup/rollup/raw/2ef77c00ec2635d42697cff2c0567ccc8db34fb4/test%2Ffunction%2Fsamples%2Fimport-meta-url-b%2F_config.js",
                "contents_url": "https://api.github.com/repos/rollup/rollup/contents/test%2Ffunction%2Fsamples%2Fimport-meta-url-b%2F_config.js?ref=2ef77c00ec2635d42697cff2c0567ccc8db34fb4",
                "patch": "@@ -7,7 +7,8 @@ module.exports = defineTest({\n \tcontext: {\n \t\tdocument: {\n \t\t\tcurrentScript: {\n-\t\t\t\tsrc: source\n+\t\t\t\tsrc: source,\n+\t\t\t\ttagName: 'SCRIPT'\n \t\t\t}\n \t\t}\n \t},"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/lobehub/lobe-chat/commits/e960a23b0c69a5762eb27d776d33dac443058faf",
        "url": "https://api.github.com/repos/lobehub/lobe-chat/commits/e960a23b0c69a5762eb27d776d33dac443058faf",
        "html_url": "https://github.com/lobehub/lobe-chat/commit/e960a23b0c69a5762eb27d776d33dac443058faf",
        "message": "\ud83d\udc1b fix: try to implement better ssrf-protect (#4044)\n\n* \ud83d\udc1b fix: try to implement better ssrf-protect\r\n\r\n* \ud83d\udc1b fix: fix error\r\n\r\n* \ud83d\udc84 style: improve pwa",
        "files": [
            {
                "sha": "83e944a9fdb675d4262d8ca666e217b4ad42e365",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/package.json",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/package.json",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/package.json?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -203,6 +203,7 @@\n     \"remark\": \"^14.0.3\",\n     \"remark-gfm\": \"^3.0.1\",\n     \"remark-html\": \"^15.0.2\",\n+    \"request-filtering-agent\": \"^2.0.1\",\n     \"resolve-accept-language\": \"^3.1.5\",\n     \"rtl-detect\": \"^1.1.2\",\n     \"semver\": \"^7.6.3\","
            },
            {
                "sha": "67277ac7989a0a4c79f6e4ebd8129b93674cd06a",
                "filename": "src/app/api/proxy/route.ts",
                "status": "removed",
                "additions": 0,
                "deletions": 34,
                "changes": 34,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/4e3b71b85b8b4cbf816a0a90ea491df3cb20c619/src%2Fapp%2Fapi%2Fproxy%2Froute.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/4e3b71b85b8b4cbf816a0a90ea491df3cb20c619/src%2Fapp%2Fapi%2Fproxy%2Froute.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fapp%2Fapi%2Fproxy%2Froute.ts?ref=4e3b71b85b8b4cbf816a0a90ea491df3cb20c619",
                "patch": "@@ -1,34 +0,0 @@\n-import { isPrivate } from 'ip';\n-import { NextResponse } from 'next/server';\n-import dns from 'node:dns';\n-import { promisify } from 'node:util';\n-\n-const lookupAsync = promisify(dns.lookup);\n-\n-export const runtime = 'nodejs';\n-\n-/**\n- * just for a proxy\n- */\n-export const POST = async (req: Request) => {\n-  const url = new URL(await req.text());\n-  let address;\n-\n-  try {\n-    const lookupResult = await lookupAsync(url.hostname);\n-    address = lookupResult.address;\n-  } catch (err) {\n-    console.error(`${url.hostname} DNS parser error:`, err);\n-\n-    return NextResponse.json({ error: 'DNS parser error' }, { status: 504 });\n-  }\n-\n-  const isInternalHost = isPrivate(address);\n-\n-  if (isInternalHost)\n-    return NextResponse.json({ error: 'Not support internal host proxy' }, { status: 400 });\n-\n-  const res = await fetch(url.toString());\n-\n-  return new Response(res.body, { headers: res.headers });\n-};"
            },
            {
                "sha": "da81e4ae8c2bc5292423770cdb3fa68dc34116ef",
                "filename": "src/app/webapi/proxy/route.ts",
                "status": "added",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fapp%2Fwebapi%2Fproxy%2Froute.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fapp%2Fwebapi%2Fproxy%2Froute.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fapp%2Fwebapi%2Fproxy%2Froute.ts?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -0,0 +1,19 @@\n+import { NextResponse } from 'next/server';\n+import fetch from 'node-fetch';\n+import { useAgent as ssrfAgent } from 'request-filtering-agent';\n+\n+/**\n+ * just for a proxy\n+ */\n+export const POST = async (req: Request) => {\n+  const url = await req.text();\n+\n+  try {\n+    const res = await fetch(url, { agent: ssrfAgent(url) });\n+\n+    return new Response(await res.arrayBuffer(), { headers: { ...res.headers } });\n+  } catch (err) {\n+    console.error(err); // DNS lookup 127.0.0.1(family:4, host:127.0.0.1.nip.io) is not allowed. Because, It is private IP address.\n+    return NextResponse.json({ error: 'Not support internal host proxy' }, { status: 400 });\n+  }\n+};"
            },
            {
                "sha": "9660a955e691e49d39899be19de12feb6d6532d0",
                "filename": "src/server/routers/lambda/user.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fserver%2Frouters%2Flambda%2Fuser.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fserver%2Frouters%2Flambda%2Fuser.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fserver%2Frouters%2Flambda%2Fuser.ts?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -63,7 +63,7 @@ export const userRouter = router({\n     const sessionCount = await sessionModel.count();\n \n     return {\n-      canEnablePWAGuide: messageCount >= 2,\n+      canEnablePWAGuide: messageCount >= 4,\n       canEnableTrace: messageCount >= 4,\n       // \u6709\u6d88\u606f\uff0c\u6216\u8005\u521b\u5efa\u8fc7\u52a9\u624b\uff0c\u5219\u8ba4\u4e3a\u6709 conversation\n       hasConversation: messageCount > 0 || sessionCount > 1,"
            },
            {
                "sha": "5b110bef7062e0ecf51cd48ed45af0a8995fe1d7",
                "filename": "src/services/_url.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fservices%2F_url.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fservices%2F_url.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fservices%2F_url.ts?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -1,4 +1,4 @@\n-// TODO: \u672a\u6765\u8def\u7531\u9700\u8981\u8fc1\u79fb\u5230 trpc or /webapi\n+// TODO: \u672a\u6765\u6240\u6709\u6838\u5fc3\u8def\u7531\u9700\u8981\u8fc1\u79fb\u5230 trpc\uff0c\u90e8\u5206\u4e0d\u9700\u8981\u8fc1\u79fb\u7684\u5219\u8d70 webapi\n \n /* eslint-disable sort-keys-fix/sort-keys-fix */\n import { transform } from 'lodash-es';\n@@ -17,7 +17,7 @@ const mapWithBasePath = <T extends object>(apis: T): T => {\n };\n \n export const API_ENDPOINTS = mapWithBasePath({\n-  proxy: '/api/proxy',\n+  proxy: '/webapi/proxy',\n   oauth: '/api/auth',\n \n   // agent markets"
            },
            {
                "sha": "4554b16fa4be979ed585e3cc2f6b64c5fab08223",
                "filename": "src/services/user/client.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fservices%2Fuser%2Fclient.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fservices%2Fuser%2Fclient.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fservices%2Fuser%2Fclient.ts?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -23,7 +23,7 @@ export class ClientService implements IUserService {\n \n     return {\n       avatar: user.avatar,\n-      canEnablePWAGuide: messageCount >= 2,\n+      canEnablePWAGuide: messageCount >= 4,\n       canEnableTrace: messageCount >= 4,\n       hasConversation: messageCount > 0 || sessionCount > 0,\n       isOnboard: true,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/iredmail/iRedAdmin/commits/b537e71ecf522d7f10180f5f0aab4a98a881893a",
        "url": "https://api.github.com/repos/iredmail/iRedAdmin/commits/b537e71ecf522d7f10180f5f0aab4a98a881893a",
        "html_url": "https://github.com/iredmail/iRedAdmin/commit/b537e71ecf522d7f10180f5f0aab4a98a881893a",
        "message": "Fix 2 possible XSS vulnerabilities.\nThanks to Simone Quatrini @surecloudcyber.com.",
        "files": [
            {
                "sha": "d7a31ba14fea03283f2ce035e8e170f623fac2ff",
                "filename": "ChangeLog",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/iredmail/iRedAdmin/blob/b537e71ecf522d7f10180f5f0aab4a98a881893a/ChangeLog",
                "raw_url": "https://github.com/iredmail/iRedAdmin/raw/b537e71ecf522d7f10180f5f0aab4a98a881893a/ChangeLog",
                "contents_url": "https://api.github.com/repos/iredmail/iRedAdmin/contents/ChangeLog?ref=b537e71ecf522d7f10180f5f0aab4a98a881893a",
                "patch": "@@ -5,6 +5,8 @@\n       Defaults to `False`.\n \n * Fixed issues:\n+    - 2 possible XSS vulnerabilities.\n+      Thanks to Simone Quatrini @surecloudcyber.com.\n     - Incorrect time zone (America/Sao_Paulo, GMT-03:00).\n       Thanks to Guilherme Rauth.\n "
            },
            {
                "sha": "9e1f497e4860d1cc909467159423951af2621360",
                "filename": "controllers/ldap/user.py",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/iredmail/iRedAdmin/blob/b537e71ecf522d7f10180f5f0aab4a98a881893a/controllers%2Fldap%2Fuser.py",
                "raw_url": "https://github.com/iredmail/iRedAdmin/raw/b537e71ecf522d7f10180f5f0aab4a98a881893a/controllers%2Fldap%2Fuser.py",
                "contents_url": "https://api.github.com/repos/iredmail/iRedAdmin/contents/controllers%2Fldap%2Fuser.py?ref=b537e71ecf522d7f10180f5f0aab4a98a881893a",
                "patch": "@@ -24,6 +24,11 @@ def GET(self, domain, cur_page=1, disabled_only=False):\n         form = web.input()\n \n         order_name = form.get('order_name')\n+\n+        # Currently only sorting by `name` and `quota` are supported.\n+        if order_name not in [\"name\", \"quota\"]:\n+            order_name = \"name\"\n+\n         order_by_desc = (form.get('order_by', 'asc').lower() == 'desc')\n \n         first_char = None"
            },
            {
                "sha": "69b4e643ded06f015ab18e6e9913ae77f0acf599",
                "filename": "controllers/sql/user.py",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/iredmail/iRedAdmin/blob/b537e71ecf522d7f10180f5f0aab4a98a881893a/controllers%2Fsql%2Fuser.py",
                "raw_url": "https://github.com/iredmail/iRedAdmin/raw/b537e71ecf522d7f10180f5f0aab4a98a881893a/controllers%2Fsql%2Fuser.py",
                "contents_url": "https://api.github.com/repos/iredmail/iRedAdmin/contents/controllers%2Fsql%2Fuser.py?ref=b537e71ecf522d7f10180f5f0aab4a98a881893a",
                "patch": "@@ -23,7 +23,13 @@ def GET(self, domain, cur_page=1, disabled_only=False):\n         cur_page = int(cur_page) or 1\n \n         form = web.input(_unicode=False)\n+\n         order_name = form.get('order_name')\n+\n+        # Currently only sorting by `name` and `quota` are supported.\n+        if order_name not in [\"name\", \"quota\"]:\n+            order_name = \"name\"\n+\n         order_by_desc = (form.get('order_by', 'asc').lower() == 'desc')\n \n         records = []"
            },
            {
                "sha": "a0c5561470dd479fbf2a17ffeee6a48a93ab57d8",
                "filename": "libs/sqllib/user.py",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/iredmail/iRedAdmin/blob/b537e71ecf522d7f10180f5f0aab4a98a881893a/libs%2Fsqllib%2Fuser.py",
                "raw_url": "https://github.com/iredmail/iRedAdmin/raw/b537e71ecf522d7f10180f5f0aab4a98a881893a/libs%2Fsqllib%2Fuser.py",
                "contents_url": "https://api.github.com/repos/iredmail/iRedAdmin/contents/libs%2Fsqllib%2Fuser.py?ref=b537e71ecf522d7f10180f5f0aab4a98a881893a",
                "patch": "@@ -315,7 +315,6 @@ def get_paged_users(conn,\n                 limit=settings.PAGE_SIZE_LIMIT,\n                 offset=(cur_page - 1) * settings.PAGE_SIZE_LIMIT,\n             )\n-\n         else:\n             qr = conn.select(\n                 'mailbox',"
            },
            {
                "sha": "6678bb5e36da6b800db6fa701ec72332b3ce103d",
                "filename": "templates/default/ldap/user/list.html",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/iredmail/iRedAdmin/blob/b537e71ecf522d7f10180f5f0aab4a98a881893a/templates%2Fdefault%2Fldap%2Fuser%2Flist.html",
                "raw_url": "https://github.com/iredmail/iRedAdmin/raw/b537e71ecf522d7f10180f5f0aab4a98a881893a/templates%2Fdefault%2Fldap%2Fuser%2Flist.html",
                "contents_url": "https://api.github.com/repos/iredmail/iRedAdmin/contents/templates%2Fdefault%2Fldap%2Fuser%2Flist.html?ref=b537e71ecf522d7f10180f5f0aab4a98a881893a",
                "patch": "@@ -197,10 +197,19 @@ <h2>\n                         {% set baseurl = ctx.homepath + '/users/' + cur_domain + '/disabled' %}\n                     {% endif %}\n \n+                    {% set url_suffix = \"\" %}\n+\n+                    {% if order_name in [\"name\", \"quota\"] %}\n+                        {% set url_suffix = \"?order_name=\" + order_name %}\n+                        {% if order_by_desc %}\n+                            {% set url_suffix = url_suffix + \"&order_by=desc\" %}\n+                        {% endif %}\n+                    {% endif %}\n+\n                     {{ show_pages(baseurl=baseurl,\n                                   total=total,\n                                   cur_page=cur_page,\n-                                  url_suffix=ctx.query) }}\n+                                  url_suffix=url_suffix) }}\n                 </div>\n                 {% endif %}\n             </form>"
            },
            {
                "sha": "644641fb68de42ee0c2c1fbf1ad02a80dac81586",
                "filename": "templates/default/sql/user/list.html",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/iredmail/iRedAdmin/blob/b537e71ecf522d7f10180f5f0aab4a98a881893a/templates%2Fdefault%2Fsql%2Fuser%2Flist.html",
                "raw_url": "https://github.com/iredmail/iRedAdmin/raw/b537e71ecf522d7f10180f5f0aab4a98a881893a/templates%2Fdefault%2Fsql%2Fuser%2Flist.html",
                "contents_url": "https://api.github.com/repos/iredmail/iRedAdmin/contents/templates%2Fdefault%2Fsql%2Fuser%2Flist.html?ref=b537e71ecf522d7f10180f5f0aab4a98a881893a",
                "patch": "@@ -230,10 +230,19 @@ <h2>\n                           total=total,\n                           cur_page=cur_page) }}\n         {% else %}\n+            {% set url_suffix = \"\" %}\n+\n+            {% if order_name in [\"name\", \"quota\"] %}\n+                {% set url_suffix = \"?order_name=\" + order_name %}\n+                {% if order_by_desc %}\n+                    {% set url_suffix = url_suffix + \"&order_by=desc\" %}\n+                {% endif %}\n+            {% endif %}\n+\n             {{ show_pages(baseurl=baseurl,\n                           total=total,\n                           cur_page=cur_page,\n-                          url_suffix=ctx.query) }}\n+                          url_suffix=url_suffix) }}\n         {% endif %}\n     </div>\n     {% endif %}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/iredmail/iRedAdmin/commits/3c72b438d412ea3ee0270f6956e19b1098c19191",
        "url": "https://api.github.com/repos/iredmail/iRedAdmin/commits/3c72b438d412ea3ee0270f6956e19b1098c19191",
        "html_url": "https://github.com/iredmail/iRedAdmin/commit/3c72b438d412ea3ee0270f6956e19b1098c19191",
        "message": "Verify submit data and escape them.\nThanks Simone Quatrini for the report.\n\nNote: This doesn't affect iRedAdmin-Pro.",
        "files": [
            {
                "sha": "29ee206b8c65c806f8777a4edce63d39c8f09871",
                "filename": "controllers/panel/log.py",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/iredmail/iRedAdmin/blob/3c72b438d412ea3ee0270f6956e19b1098c19191/controllers%2Fpanel%2Flog.py",
                "raw_url": "https://github.com/iredmail/iRedAdmin/raw/3c72b438d412ea3ee0270f6956e19b1098c19191/controllers%2Fpanel%2Flog.py",
                "contents_url": "https://api.github.com/repos/iredmail/iRedAdmin/contents/controllers%2Fpanel%2Flog.py?ref=3c72b438d412ea3ee0270f6956e19b1098c19191",
                "patch": "@@ -3,6 +3,7 @@\n import web\n import settings\n from controllers import decorators\n+from libs import iredutils\n from libs.panel import LOG_EVENTS, log as loglib\n \n session = web.config.get('_session')\n@@ -25,6 +26,16 @@ def GET(self):\n         form_admin = web.safestr(form.get('admin', 'all'))\n         form_cur_page = web.safestr(form.get('page', '1'))\n \n+        # Verify input data.\n+        if form_event not in LOG_EVENTS:\n+            form_event = \"all\"\n+\n+        if not iredutils.is_domain(form_domain):\n+            form_domain = \"\"\n+\n+        if not iredutils.is_email(form_admin):\n+            form_admin = \"\"\n+\n         if not form_cur_page.isdigit() or form_cur_page == '0':\n             form_cur_page = 1\n         else:"
            },
            {
                "sha": "b6308631cf9dc7bf4e22c9d1c3d80ab374441b64",
                "filename": "templates/default/panel/log.html",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/iredmail/iRedAdmin/blob/3c72b438d412ea3ee0270f6956e19b1098c19191/templates%2Fdefault%2Fpanel%2Flog.html",
                "raw_url": "https://github.com/iredmail/iRedAdmin/raw/3c72b438d412ea3ee0270f6956e19b1098c19191/templates%2Fdefault%2Fpanel%2Flog.html",
                "contents_url": "https://api.github.com/repos/iredmail/iRedAdmin/contents/templates%2Fdefault%2Fpanel%2Flog.html?ref=3c72b438d412ea3ee0270f6956e19b1098c19191",
                "patch": "@@ -66,9 +66,9 @@ <h2>{{ _('Admin Log') }}\n <form name=\"log\" id=\"list_table\" method=\"post\" action=\"{{ctx.homepath}}/activities/admins\">\n     {{ input_csrf_token() }}\n \n-    <input type=\"hidden\" name=\"domain\" value=\"{{ domain }}\" />\n-    <input type=\"hidden\" name=\"admin\" value=\"{{ admin }}\" />\n-    <input type=\"hidden\" name=\"event\" value=\"{{ event }}\" />\n+    <input type=\"hidden\" name=\"domain\" value=\"{{ domain |e }}\" />\n+    <input type=\"hidden\" name=\"admin\" value=\"{{ admin |e }}\" />\n+    <input type=\"hidden\" name=\"event\" value=\"{{ event |e }}\" />\n \n     <table class=\"style1\">\n         <thead>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/RapidScada/scada/commits/b14cbdfa6cf3a205e57f2383c915365adc3859a7",
        "url": "https://api.github.com/repos/RapidScada/scada/commits/b14cbdfa6cf3a205e57f2383c915365adc3859a7",
        "html_url": "https://github.com/RapidScada/scada/commit/b14cbdfa6cf3a205e57f2383c915365adc3859a7",
        "message": "Update MainLogic.cs",
        "files": [
            {
                "sha": "45fd2646fbf173a7ab42c4cf41f8fa9f3b4f8fee",
                "filename": "ScadaServer/ScadaServer/ScadaServerEngine/MainLogic.cs",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/RapidScada/scada/blob/b14cbdfa6cf3a205e57f2383c915365adc3859a7/ScadaServer%2FScadaServer%2FScadaServerEngine%2FMainLogic.cs",
                "raw_url": "https://github.com/RapidScada/scada/raw/b14cbdfa6cf3a205e57f2383c915365adc3859a7/ScadaServer%2FScadaServer%2FScadaServerEngine%2FMainLogic.cs",
                "contents_url": "https://api.github.com/repos/RapidScada/scada/contents/ScadaServer%2FScadaServer%2FScadaServerEngine%2FMainLogic.cs?ref=b14cbdfa6cf3a205e57f2383c915365adc3859a7",
                "patch": "@@ -2126,7 +2126,8 @@ public bool CheckUser(string username, string password, out int roleID)\n             lock (users)\n             {\n                 if (users.TryGetValue(username.Trim().ToLowerInvariant(), out User user) &&\n-                    (string.IsNullOrEmpty(password) || password == user.Password))\n+                    !string.IsNullOrEmpty(password) && password == user.Password)\n+                    //(string.IsNullOrEmpty(password) || password == user.Password))\n                 {\n                     roleID = user.RoleID;\n                     return true;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/GladysAssistant/Gladys/commits/344ad9b8ca3078d9292dd95f2dd7b9172bc6ebbe",
        "url": "https://api.github.com/repos/GladysAssistant/Gladys/commits/344ad9b8ca3078d9292dd95f2dd7b9172bc6ebbe",
        "html_url": "https://github.com/GladysAssistant/Gladys/commit/344ad9b8ca3078d9292dd95f2dd7b9172bc6ebbe",
        "message": "Prevent user from updating his own role (#2115)",
        "files": [
            {
                "sha": "4a7bdcdce7b815394f70da106e98521f789dddf3",
                "filename": "server/api/controllers/user.controller.js",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/GladysAssistant/Gladys/blob/344ad9b8ca3078d9292dd95f2dd7b9172bc6ebbe/server%2Fapi%2Fcontrollers%2Fuser.controller.js",
                "raw_url": "https://github.com/GladysAssistant/Gladys/raw/344ad9b8ca3078d9292dd95f2dd7b9172bc6ebbe/server%2Fapi%2Fcontrollers%2Fuser.controller.js",
                "contents_url": "https://api.github.com/repos/GladysAssistant/Gladys/contents/server%2Fapi%2Fcontrollers%2Fuser.controller.js?ref=344ad9b8ca3078d9292dd95f2dd7b9172bc6ebbe",
                "patch": "@@ -131,6 +131,7 @@ module.exports = function UserController(gladys) {\n    * @apiGroup User\n    */\n   async function updateMySelf(req, res, next) {\n+    delete req.body.role;\n     const newUser = await gladys.user.update(req.user.id, req.body);\n     res.json(newUser);\n   }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/lyft/confidant/commits/8876b07abde0c8d2a4974f79b60562b6d0193db9",
        "url": "https://api.github.com/repos/lyft/confidant/commits/8876b07abde0c8d2a4974f79b60562b6d0193db9",
        "html_url": "https://github.com/lyft/confidant/commit/8876b07abde0c8d2a4974f79b60562b6d0193db9",
        "message": "Prevent XSS from API call (#436)\n\n### Description: \r\nPrevent XSS\r\n\r\n### Test\r\ntest in confidant-staging",
        "files": [
            {
                "sha": "40708274b40d43f2cc79dbe6ba1910b9fdba17d7",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/lyft/confidant/blob/8876b07abde0c8d2a4974f79b60562b6d0193db9/CHANGELOG.md",
                "raw_url": "https://github.com/lyft/confidant/raw/8876b07abde0c8d2a4974f79b60562b6d0193db9/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/lyft/confidant/contents/CHANGELOG.md?ref=8876b07abde0c8d2a4974f79b60562b6d0193db9",
                "patch": "@@ -1,5 +1,9 @@\n # Changelog\n \n+## 6.6.2\n+\n+* XSS security fix / enhancement for Flask API response\n+\n ## 6.6.1\n \n * Upgrade confidant to python 3.10.14"
            },
            {
                "sha": "28179fc1f51c8e3ccacab1b8e36a63af4aa9e1bf",
                "filename": "VERSION",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/lyft/confidant/blob/8876b07abde0c8d2a4974f79b60562b6d0193db9/VERSION",
                "raw_url": "https://github.com/lyft/confidant/raw/8876b07abde0c8d2a4974f79b60562b6d0193db9/VERSION",
                "contents_url": "https://api.github.com/repos/lyft/confidant/contents/VERSION?ref=8876b07abde0c8d2a4974f79b60562b6d0193db9",
                "patch": "@@ -1 +1 @@\n-6.6.1\n+6.6.2"
            },
            {
                "sha": "63cde87dda2dc68f7ce317706ad2f5400c0aba48",
                "filename": "confidant/routes/credentials.py",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/lyft/confidant/blob/8876b07abde0c8d2a4974f79b60562b6d0193db9/confidant%2Froutes%2Fcredentials.py",
                "raw_url": "https://github.com/lyft/confidant/raw/8876b07abde0c8d2a4974f79b60562b6d0193db9/confidant%2Froutes%2Fcredentials.py",
                "contents_url": "https://api.github.com/repos/lyft/confidant/contents/confidant%2Froutes%2Fcredentials.py?ref=8876b07abde0c8d2a4974f79b60562b6d0193db9",
                "patch": "@@ -36,6 +36,7 @@\n \n \n @blueprint.route('/v1/credentials', methods=['GET'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n def get_credential_list():\n     \"\"\"\n@@ -132,6 +133,7 @@ def get_credential_list():\n \n \n @blueprint.route('/v1/credentials/<id>', methods=['GET'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n def get_credential(id):\n     \"\"\"\n@@ -369,6 +371,7 @@ def diff_credential(id, old_revision, new_revision):\n \n \n @blueprint.route('/v1/archive/credentials/<id>', methods=['GET'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n def get_archive_credential_revisions(id):\n     \"\"\"\n@@ -451,6 +454,7 @@ def get_archive_credential_revisions(id):\n \n \n @blueprint.route('/v1/archive/credentials', methods=['GET'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n def get_archive_credential_list():\n     \"\"\"\n@@ -534,6 +538,7 @@ def get_archive_credential_list():\n \n \n @blueprint.route('/v1/credentials', methods=['POST'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n @authnz.require_csrf_token\n @maintenance.check_maintenance_mode\n@@ -727,6 +732,7 @@ def get_credential_dependencies(id):\n \n \n @blueprint.route('/v1/credentials/<id>', methods=['PUT'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n @authnz.require_csrf_token\n @maintenance.check_maintenance_mode\n@@ -952,6 +958,7 @@ def update_credential(id):\n \n \n @blueprint.route('/v1/credentials/<id>/<to_revision>', methods=['PUT'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n @authnz.require_csrf_token\n @maintenance.check_maintenance_mode"
            },
            {
                "sha": "265ef90dc8d94ce316697dda401d385884ea5890",
                "filename": "confidant/routes/services.py",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/lyft/confidant/blob/8876b07abde0c8d2a4974f79b60562b6d0193db9/confidant%2Froutes%2Fservices.py",
                "raw_url": "https://github.com/lyft/confidant/raw/8876b07abde0c8d2a4974f79b60562b6d0193db9/confidant%2Froutes%2Fservices.py",
                "contents_url": "https://api.github.com/repos/lyft/confidant/contents/confidant%2Froutes%2Fservices.py?ref=8876b07abde0c8d2a4974f79b60562b6d0193db9",
                "patch": "@@ -76,6 +76,7 @@ def get_iam_roles_list():\n \n \n @blueprint.route('/v1/services', methods=['GET'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n def get_service_list():\n     \"\"\"\n@@ -164,10 +165,12 @@ def get_service_list():\n             services_response = ServicesResponse.from_services(\n                 Service.data_type_date_index.query('service'),\n             )\n+\n         return services_response_schema.dumps(services_response)\n \n \n @blueprint.route('/v1/services/<id>', methods=['GET'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n def get_service(id):\n     '''\n@@ -334,6 +337,7 @@ def get_service(id):\n \n \n @blueprint.route('/v1/archive/services/<id>', methods=['GET'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n def get_archive_service_revisions(id):\n     \"\"\"\n@@ -414,6 +418,7 @@ def get_archive_service_revisions(id):\n \n \n @blueprint.route('/v1/archive/services', methods=['GET'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n def get_archive_service_list():\n     \"\"\"\n@@ -492,6 +497,7 @@ def get_archive_service_list():\n \n \n @blueprint.route('/v1/services/<id>', methods=['PUT'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n @authnz.require_csrf_token\n @maintenance.check_maintenance_mode\n@@ -701,6 +707,7 @@ def map_service_credentials(id):\n \n \n @blueprint.route('/v1/services/<id>/<to_revision>', methods=['PUT'])\n+@misc.prevent_xss_decorator\n @authnz.require_auth\n @authnz.require_csrf_token\n @maintenance.check_maintenance_mode"
            },
            {
                "sha": "c96a84021ff6b6f795f4a47df49bbf3092d09d68",
                "filename": "confidant/utils/misc.py",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/lyft/confidant/blob/8876b07abde0c8d2a4974f79b60562b6d0193db9/confidant%2Futils%2Fmisc.py",
                "raw_url": "https://github.com/lyft/confidant/raw/8876b07abde0c8d2a4974f79b60562b6d0193db9/confidant%2Futils%2Fmisc.py",
                "contents_url": "https://api.github.com/repos/lyft/confidant/contents/confidant%2Futils%2Fmisc.py?ref=8876b07abde0c8d2a4974f79b60562b6d0193db9",
                "patch": "@@ -1,6 +1,8 @@\n+from functools import wraps\n import importlib\n import pytz\n from datetime import datetime\n+from flask import make_response\n \n \n def dict_deep_update(a, b):\n@@ -54,3 +56,28 @@ def utcnow():\n     \"\"\"\n     now = datetime.utcnow()\n     return now.replace(tzinfo=pytz.utc)\n+\n+\n+def prevent_xss_decorator(func):\n+    \"\"\"\n+    Prevents XSS attacks:\n+     1. Set content type to be application/json\n+     2. Set Content Security Policy (already specified at app level)\n+     3. Enable XSS Protection\n+     4. Prevent MIME Type Sniffing\n+     5. Limit Referrer Information\n+    \"\"\"\n+    @wraps(func)\n+    def wrapper(*args, **kwargs):\n+        # Call the original function to get the response\n+        pre_xss_response = func(*args, **kwargs)\n+\n+        # Apply XSS prevention\n+        response = make_response(pre_xss_response)\n+        response.headers['Content-Type'] = 'application/json'\n+        response.headers['X-XSS-Protection'] = '1; mode=block'\n+        response.headers['X-Content-Type-Options'] = 'nosniff'\n+        response.headers['Referrer-Policy'] = 'no-referrer'\n+\n+        return response\n+    return wrapper"
            },
            {
                "sha": "8196051a6342911df63e04584508f6048cd0625d",
                "filename": "docker-compose.yml",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/lyft/confidant/blob/8876b07abde0c8d2a4974f79b60562b6d0193db9/docker-compose.yml",
                "raw_url": "https://github.com/lyft/confidant/raw/8876b07abde0c8d2a4974f79b60562b6d0193db9/docker-compose.yml",
                "contents_url": "https://api.github.com/repos/lyft/confidant/contents/docker-compose.yml?ref=8876b07abde0c8d2a4974f79b60562b6d0193db9",
                "patch": "@@ -1,4 +1,3 @@\n-version: \"3.8\"\n networks:\n   confidant:\n     name: confidant"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/udecode/plate/commits/16df6074edac22d56c60e0283eae0740230401c9",
        "url": "https://api.github.com/repos/udecode/plate/commits/16df6074edac22d56c60e0283eae0740230401c9",
        "html_url": "https://github.com/udecode/plate/commit/16df6074edac22d56c60e0283eae0740230401c9",
        "message": "Merge commit from fork\n\nMitigate XSS in `element.attributes`",
        "files": [
            {
                "sha": "251ee0d35567d49f97709beb5978ee66cf870bd2",
                "filename": ".changeset/loud-lemons-tickle.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/.changeset%2Floud-lemons-tickle.md",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/.changeset%2Floud-lemons-tickle.md",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/.changeset%2Floud-lemons-tickle.md?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@udecode/plate-link': patch\n+---\n+\n+Add the `target` attribute to `dangerouslyAllowAttributes` for LinkPlugin"
            },
            {
                "sha": "aa92f8cd5a6ceb836b33c4f443b21a9332227a41",
                "filename": ".changeset/lovely-taxis-bake.md",
                "status": "added",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/.changeset%2Flovely-taxis-bake.md",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/.changeset%2Flovely-taxis-bake.md",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/.changeset%2Flovely-taxis-bake.md?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -0,0 +1,8 @@\n+---\n+'@udecode/plate-media': patch\n+---\n+\n+Add the following attributes to `dangerouslyAllowAttributes`:\n+\n+- ImagePlugin: `alt`, `width`, `height`\n+- VideoPlugin: `width`, `height`"
            },
            {
                "sha": "63f6f8a303998fa6e0c4a169d59f7f31dae60447",
                "filename": ".changeset/olive-shrimps-joke.md",
                "status": "added",
                "additions": 32,
                "deletions": 0,
                "changes": 32,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/.changeset%2Folive-shrimps-joke.md",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/.changeset%2Folive-shrimps-joke.md",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/.changeset%2Folive-shrimps-joke.md?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -0,0 +1,32 @@\n+---\n+'@udecode/plate-core': patch\n+---\n+\n+Mitigate XSS in `element.attributes` by requiring all attribute names to be allowlisted in the `node.dangerouslyAllowAttributes` plugin configuration option.\n+\n+Migration:\n+\n+For each plugin that needs to support passing DOM attributes using `element.attributes`, add the list of allowed attributes to the `node.dangerouslyAllowAttributes` option of the plugin.\n+\n+```ts\n+const ImagePlugin = createPlatePlugin({\n+  key: 'image',\n+  node: {\n+    isElement: true,\n+    isVoid: true,\n+    dangerouslyAllowAttributes: ['alt'],\n+  },\n+});\n+```\n+\n+To modify existing plugins, use the `extend` method as follows:\n+\n+```ts\n+const MyImagePlugin = ImagePlugin.extend({\n+  node: {\n+    dangerouslyAllowAttributes: ['alt'],\n+  },\n+});\n+```\n+\n+WARNING: Improper use of `dangerouslyAllowAttributes` WILL make your application vulnerable to cross-site scripting (XSS) or information exposure attacks. Ensure you carefully research the security implications of any attribute before adding it. For example, the `src` and `href` attributes will allow attackers to execute arbitrary code, and the `style` and `background` attributes will allow attackers to leak users' IP addresses."
            },
            {
                "sha": "2453b1ef09541b6b86a349416fdfc297702c83bd",
                "filename": ".changeset/silver-flies-relax.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/.changeset%2Fsilver-flies-relax.md",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/.changeset%2Fsilver-flies-relax.md",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/.changeset%2Fsilver-flies-relax.md?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@udecode/plate-table': patch\n+---\n+\n+Add the `colspan` and `rowspan` attributes to `dangerouslyAllowAttributes` for TableCellPlugin and TableCellHeaderPlugin"
            },
            {
                "sha": "343ee4af55c7cbd2ef2393eb68012c57b82a2545",
                "filename": "packages/core/src/lib/plugin/BasePlugin.ts",
                "status": "modified",
                "additions": 31,
                "deletions": 0,
                "changes": 31,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fcore%2Fsrc%2Flib%2Fplugin%2FBasePlugin.ts",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fcore%2Fsrc%2Flib%2Fplugin%2FBasePlugin.ts",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/packages%2Fcore%2Fsrc%2Flib%2Fplugin%2FBasePlugin.ts?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -93,6 +93,37 @@ export type BasePluginNode = {\n    */\n   type: string;\n \n+  /**\n+   * Controls which (if any) attribute names in the `attributes` property of an\n+   * element will be passed as `nodeProps` to the {@link NodeComponent}, and\n+   * subsequently rendered as DOM attributes.\n+   *\n+   * WARNING: If used improperly, this property WILL make your application\n+   * vulnerable to cross-site scripting (XSS) or information exposure attacks.\n+   *\n+   * For example, if the `href` attribute is allowed and the component passes\n+   * `nodeProps` to an `<a>` element, then attackers can direct users to open a\n+   * document containing a malicious link element:\n+   *\n+   * { type: 'link', url: 'https://safesite.com/', attributes: { href:\n+   * 'javascript:alert(\"xss\")' }, children: [{ text: 'Click me' }], }\n+   *\n+   * The same is true of the `src` attribute when passed to certain HTML\n+   * elements, such as `<iframe>`.\n+   *\n+   * If the `style` attribute (or another attribute that can load URLs, such as\n+   * `background`) is allowed, then attackers can direct users to open a\n+   * document that will send a HTTP request to an arbitrary URL. This can leak\n+   * the victim's IP address or confirm to the attacker that the victim opened\n+   * the document.\n+   *\n+   * Before allowing any attribute name, ensure that you thoroughly research and\n+   * assess any potential risks associated with it.\n+   *\n+   * @default [ ]\n+   */\n+  dangerouslyAllowAttributes?: string[];\n+\n   /**\n    * Indicates if this plugin's nodes should be rendered as elements. Used by\n    * Plate for {@link NodeComponent} rendering as elements."
            },
            {
                "sha": "c324485bc794c8e4bc47edc3bad1a240e242ba96",
                "filename": "packages/core/src/react/components/Plate.spec.tsx",
                "status": "modified",
                "additions": 123,
                "deletions": 1,
                "changes": 124,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fcore%2Fsrc%2Freact%2Fcomponents%2FPlate.spec.tsx",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fcore%2Fsrc%2Freact%2Fcomponents%2FPlate.spec.tsx",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/packages%2Fcore%2Fsrc%2Freact%2Fcomponents%2FPlate.spec.tsx?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -6,7 +6,11 @@ import { type Value, isBlock, setNodes } from '@udecode/slate';\n import isEqual from 'lodash/isEqual';\n import memoize from 'lodash/memoize';\n \n-import type { PlatePlugins } from '../plugin';\n+import type {\n+  PlatePlugins,\n+  PlateRenderElementProps,\n+  PlateRenderLeafProps,\n+} from '../plugin';\n \n import { type SlatePlugins, createSlatePlugin } from '../../lib';\n import { createPlateEditor, usePlateEditor } from '../editor';\n@@ -470,4 +474,122 @@ describe('Plate', () => {\n       expect(mountCount).toBe(2);\n     });\n   });\n+\n+  describe('User-defined attributes', () => {\n+    const ParagraphElement = ({\n+      attributes,\n+      children,\n+      nodeProps,\n+    }: PlateRenderElementProps) => (\n+      <p {...attributes} {...nodeProps} data-testid=\"paragraph\">\n+        {children}\n+      </p>\n+    );\n+\n+    const BoldLeaf = ({\n+      attributes,\n+      children,\n+      nodeProps,\n+    }: PlateRenderLeafProps) => (\n+      <strong {...attributes} {...nodeProps} data-testid=\"bold\">\n+        {children}\n+      </strong>\n+    );\n+\n+    const getParagraphPlugin = (dangerouslyAllowAttributes: boolean) =>\n+      createPlatePlugin({\n+        key: 'p',\n+        node: {\n+          component: ParagraphElement,\n+          dangerouslyAllowAttributes: dangerouslyAllowAttributes\n+            ? ['data-my-paragraph-attribute']\n+            : undefined,\n+          isElement: true,\n+        },\n+      });\n+\n+    const getBoldPlugin = (dangerouslyAllowAttributes: boolean) =>\n+      createPlatePlugin({\n+        key: 'bold',\n+        node: {\n+          component: BoldLeaf,\n+          dangerouslyAllowAttributes: dangerouslyAllowAttributes\n+            ? ['data-my-bold-attribute']\n+            : undefined,\n+          isLeaf: true,\n+        },\n+      });\n+\n+    const initialValue = [\n+      {\n+        attributes: {\n+          'data-my-paragraph-attribute': 'hello',\n+          'data-unpermitted-paragraph-attribute': 'world',\n+        },\n+        children: [\n+          {\n+            attributes: {\n+              'data-my-bold-attribute': 'hello',\n+              'data-unpermitted-bold-attribute': 'world',\n+            },\n+            bold: true,\n+            text: 'My bold paragraph',\n+          },\n+        ],\n+        type: 'p',\n+      },\n+    ];\n+\n+    const Editor = ({\n+      dangerouslyAllowAttributes,\n+    }: {\n+      dangerouslyAllowAttributes: boolean;\n+    }) => {\n+      const editor = usePlateEditor({\n+        plugins: [\n+          getParagraphPlugin(dangerouslyAllowAttributes),\n+          getBoldPlugin(dangerouslyAllowAttributes),\n+        ],\n+        value: initialValue,\n+      });\n+\n+      return (\n+        <Plate editor={editor}>\n+          <PlateContent />\n+        </Plate>\n+      );\n+    };\n+\n+    it('renders no user-defined attributes by default', () => {\n+      const { getByTestId } = render(\n+        <Editor dangerouslyAllowAttributes={false} />\n+      );\n+\n+      const paragraphEl = getByTestId('paragraph');\n+      expect(Object.keys(paragraphEl.dataset)).toEqual(['slateNode', 'testid']);\n+\n+      const boldEl = getByTestId('bold');\n+      expect(Object.keys(boldEl.dataset)).toEqual(['slateLeaf', 'testid']);\n+    });\n+\n+    it('renders allowed user-defined attributes', () => {\n+      const { getByTestId } = render(\n+        <Editor dangerouslyAllowAttributes={true} />\n+      );\n+\n+      const paragraphEl = getByTestId('paragraph');\n+      expect(Object.keys(paragraphEl.dataset)).toEqual([\n+        'slateNode',\n+        'myParagraphAttribute',\n+        'testid',\n+      ]);\n+\n+      const boldEl = getByTestId('bold');\n+      expect(Object.keys(boldEl.dataset)).toEqual([\n+        'slateLeaf',\n+        'myBoldAttribute',\n+        'testid',\n+      ]);\n+    });\n+  });\n });"
            },
            {
                "sha": "63e43d8a0dc3546d07bde9e7f2416efcb064b1fc",
                "filename": "packages/core/src/react/utils/getRenderNodeProps.ts",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fcore%2Fsrc%2Freact%2Futils%2FgetRenderNodeProps.ts",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fcore%2Fsrc%2Freact%2Futils%2FgetRenderNodeProps.ts",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/packages%2Fcore%2Fsrc%2Freact%2Futils%2FgetRenderNodeProps.ts?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -1,6 +1,7 @@\n import type { AnyObject } from '@udecode/utils';\n \n import { clsx } from 'clsx';\n+import pick from 'lodash/pick.js';\n \n import type { PlateEditor } from '../editor';\n import type { AnyEditorPlatePlugin } from '../plugin/PlatePlugin';\n@@ -10,8 +11,9 @@ import { getSlateClass } from '../../lib';\n import { getEditorPlugin } from '../plugin';\n \n /**\n- * Override node props with plugin props. `props.element.attributes` are passed\n- * as `nodeProps`. Extend the class name with the node type.\n+ * Override node props with plugin props. Allowed properties in\n+ * `props.element.attributes` are passed as `nodeProps`. Extend the class name\n+ * with the node type.\n  */\n export const getRenderNodeProps = ({\n   attributes,\n@@ -33,7 +35,17 @@ export const getRenderNodeProps = ({\n         : plugin.node.props) ?? {};\n   }\n   if (!newProps.nodeProps && attributes) {\n-    newProps.nodeProps = attributes;\n+    /**\n+     * WARNING: Improper use of `dangerouslyAllowAttributes` WILL make your\n+     * application vulnerable to cross-site scripting (XSS) or information\n+     * exposure attacks.\n+     *\n+     * @see {@link BasePluginNode.dangerouslyAllowAttributes}\n+     */\n+    newProps.nodeProps = pick(\n+      attributes,\n+      plugin.node.dangerouslyAllowAttributes ?? []\n+    );\n   }\n \n   props = { ...props, ...newProps };"
            },
            {
                "sha": "b00a6ad297f0b279decccb846ac59fd67a12a1a6",
                "filename": "packages/link/src/lib/BaseLinkPlugin.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/packages%2Flink%2Fsrc%2Flib%2FBaseLinkPlugin.ts",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/packages%2Flink%2Fsrc%2Flib%2FBaseLinkPlugin.ts",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/packages%2Flink%2Fsrc%2Flib%2FBaseLinkPlugin.ts?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -93,7 +93,11 @@ export type BaseLinkConfig = PluginConfig<\n export const BaseLinkPlugin = createTSlatePlugin<BaseLinkConfig>({\n   key: 'a',\n   extendEditor: withLink,\n-  node: { isElement: true, isInline: true },\n+  node: {\n+    dangerouslyAllowAttributes: ['target'],\n+    isElement: true,\n+    isInline: true,\n+  },\n   options: {\n     allowedSchemes: ['http', 'https', 'mailto', 'tel'],\n     dangerouslySkipSanitization: false,"
            },
            {
                "sha": "b7974f5baad22011691e3106cd4933a5bec3fbdd",
                "filename": "packages/media/src/lib/BaseVideoPlugin.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fmedia%2Fsrc%2Flib%2FBaseVideoPlugin.ts",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fmedia%2Fsrc%2Flib%2FBaseVideoPlugin.ts",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/packages%2Fmedia%2Fsrc%2Flib%2FBaseVideoPlugin.ts?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -6,5 +6,9 @@ export interface TVideoElement extends TMediaElement {}\n \n export const BaseVideoPlugin = createSlatePlugin({\n   key: 'video',\n-  node: { isElement: true, isVoid: true },\n+  node: {\n+    dangerouslyAllowAttributes: ['width', 'height'],\n+    isElement: true,\n+    isVoid: true,\n+  },\n });"
            },
            {
                "sha": "b461f12bae9dd1233ed9317a5159a3fcd0604843",
                "filename": "packages/media/src/lib/image/BaseImagePlugin.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fmedia%2Fsrc%2Flib%2Fimage%2FBaseImagePlugin.ts",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/packages%2Fmedia%2Fsrc%2Flib%2Fimage%2FBaseImagePlugin.ts",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/packages%2Fmedia%2Fsrc%2Flib%2Fimage%2FBaseImagePlugin.ts?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -30,7 +30,11 @@ export type ImageConfig = PluginConfig<\n export const BaseImagePlugin = createTSlatePlugin<ImageConfig>({\n   key: 'img',\n   extendEditor: withImage,\n-  node: { isElement: true, isVoid: true },\n+  node: {\n+    dangerouslyAllowAttributes: ['alt', 'width', 'height'],\n+    isElement: true,\n+    isVoid: true,\n+  },\n }).extend(({ plugin }) => ({\n   parsers: {\n     html: {"
            },
            {
                "sha": "2f4ef639a2e907b5445ee376943706a01c2b5c7f",
                "filename": "packages/table/src/lib/BaseTablePlugin.ts",
                "status": "modified",
                "additions": 8,
                "deletions": 2,
                "changes": 10,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/packages%2Ftable%2Fsrc%2Flib%2FBaseTablePlugin.ts",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/packages%2Ftable%2Fsrc%2Flib%2FBaseTablePlugin.ts",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/packages%2Ftable%2Fsrc%2Flib%2FBaseTablePlugin.ts?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -25,7 +25,10 @@ export const BaseTableRowPlugin = createSlatePlugin({\n \n export const BaseTableCellPlugin = createSlatePlugin({\n   key: 'td',\n-  node: { isElement: true },\n+  node: {\n+    dangerouslyAllowAttributes: ['colspan', 'rowspan'],\n+    isElement: true,\n+  },\n }).extend(({ type }) => ({\n   parsers: {\n     html: {\n@@ -40,7 +43,10 @@ export const BaseTableCellPlugin = createSlatePlugin({\n \n export const BaseTableCellHeaderPlugin = createSlatePlugin({\n   key: 'th',\n-  node: { isElement: true },\n+  node: {\n+    dangerouslyAllowAttributes: ['colspan', 'rowspan'],\n+    isElement: true,\n+  },\n }).extend(({ type }) => ({\n   parsers: {\n     html: {"
            },
            {
                "sha": "4cd94075dfec960b2f0f5600658ae7beedc7c77f",
                "filename": "yarn.lock",
                "status": "modified",
                "additions": 81,
                "deletions": 81,
                "changes": 162,
                "blob_url": "https://github.com/udecode/plate/blob/16df6074edac22d56c60e0283eae0740230401c9/yarn.lock",
                "raw_url": "https://github.com/udecode/plate/raw/16df6074edac22d56c60e0283eae0740230401c9/yarn.lock",
                "contents_url": "https://api.github.com/repos/udecode/plate/contents/yarn.lock?ref=16df6074edac22d56c60e0283eae0740230401c9",
                "patch": "@@ -560,7 +560,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@changesets/cli@npm:^2.27.8\":\n+\"@changesets/cli@npm:^2.27.7\":\n   version: 2.27.8\n   resolution: \"@changesets/cli@npm:2.27.8\"\n   dependencies:\n@@ -636,13 +636,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@changesets/get-github-info@npm:^0.6.0\":\n-  version: 0.6.0\n-  resolution: \"@changesets/get-github-info@npm:0.6.0\"\n+\"@changesets/get-github-info@npm:^0.5.2\":\n+  version: 0.5.2\n+  resolution: \"@changesets/get-github-info@npm:0.5.2\"\n   dependencies:\n     dataloader: \"npm:^1.4.0\"\n     node-fetch: \"npm:^2.5.0\"\n-  checksum: 10c0/21fde8a8cb48091a8ea8be37defbc0dca5defe10a097025968b273076657f354032803a5db31ffe0fa86ab089383faa981ab674489d31e38bf7bc4dcf981ad79\n+  checksum: 10c0/702c001d939be544490db4903c63d60a38404348bf6658632e9a8e204b1a96289a604a27aa00da67322331e4cfe3592e7175dbd88736449c203f4664a7c69824\n   languageName: node\n   linkType: hard\n \n@@ -5877,7 +5877,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -5894,7 +5894,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -5913,7 +5913,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     \"@udecode/plate-heading\": \"npm:38.0.1\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -5929,7 +5929,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -5945,7 +5945,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -5961,7 +5961,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -5977,7 +5977,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -5994,7 +5994,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     react-textarea-autosize: \"npm:^8.5.3\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6013,7 +6013,7 @@ __metadata:\n     delay: \"npm:5.0.0\"\n     p-defer: \"npm:^4.0.1\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6030,7 +6030,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     prismjs: \"npm:^1.29.0\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6046,7 +6046,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6063,7 +6063,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6073,17 +6073,17 @@ __metadata:\n   languageName: unknown\n   linkType: soft\n \n-\"@udecode/plate-common@npm:38.0.1, @udecode/plate-common@workspace:^, @udecode/plate-common@workspace:packages/common\":\n+\"@udecode/plate-common@npm:38.0.4, @udecode/plate-common@workspace:^, @udecode/plate-common@workspace:packages/common\":\n   version: 0.0.0-use.local\n   resolution: \"@udecode/plate-common@workspace:packages/common\"\n   dependencies:\n-    \"@udecode/plate-core\": \"npm:38.0.1\"\n-    \"@udecode/plate-utils\": \"npm:38.0.1\"\n+    \"@udecode/plate-core\": \"npm:38.0.4\"\n+    \"@udecode/plate-utils\": \"npm:38.0.4\"\n     \"@udecode/react-hotkeys\": \"npm:37.0.0\"\n     \"@udecode/react-utils\": \"npm:38.0.1\"\n-    \"@udecode/slate\": \"npm:37.0.0\"\n-    \"@udecode/slate-react\": \"npm:38.0.1\"\n-    \"@udecode/slate-utils\": \"npm:37.0.0\"\n+    \"@udecode/slate\": \"npm:38.0.4\"\n+    \"@udecode/slate-react\": \"npm:38.0.4\"\n+    \"@udecode/slate-utils\": \"npm:38.0.4\"\n     \"@udecode/utils\": \"npm:37.0.0\"\n   peerDependencies:\n     react: \">=16.8.0\"\n@@ -6095,15 +6095,15 @@ __metadata:\n   languageName: unknown\n   linkType: soft\n \n-\"@udecode/plate-core@npm:38.0.1, @udecode/plate-core@workspace:^, @udecode/plate-core@workspace:packages/core\":\n+\"@udecode/plate-core@npm:38.0.4, @udecode/plate-core@workspace:^, @udecode/plate-core@workspace:packages/core\":\n   version: 0.0.0-use.local\n   resolution: \"@udecode/plate-core@workspace:packages/core\"\n   dependencies:\n     \"@udecode/react-hotkeys\": \"npm:37.0.0\"\n     \"@udecode/react-utils\": \"npm:38.0.1\"\n-    \"@udecode/slate\": \"npm:37.0.0\"\n-    \"@udecode/slate-react\": \"npm:38.0.1\"\n-    \"@udecode/slate-utils\": \"npm:37.0.0\"\n+    \"@udecode/slate\": \"npm:38.0.4\"\n+    \"@udecode/slate-react\": \"npm:38.0.4\"\n+    \"@udecode/slate-utils\": \"npm:38.0.4\"\n     \"@udecode/utils\": \"npm:37.0.0\"\n     clsx: \"npm:^2.1.1\"\n     is-hotkey: \"npm:^0.2.0\"\n@@ -6135,7 +6135,7 @@ __metadata:\n     \"@udecode/plate-table\": \"npm:38.0.1\"\n     papaparse: \"npm:^5.4.1\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6151,7 +6151,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6167,7 +6167,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.94.0\"\n@@ -6185,7 +6185,7 @@ __metadata:\n     diff-match-patch-ts: \"npm:^0.6.0\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6203,7 +6203,7 @@ __metadata:\n     lodash: \"npm:^4.17.21\"\n     raf: \"npm:^3.4.1\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dnd: \">=14.0.0\"\n     react-dnd-html5-backend: \">=14.0.0\"\n@@ -6227,7 +6227,7 @@ __metadata:\n     \"@udecode/plate-table\": \"npm:38.0.1\"\n     validator: \"npm:^13.12.0\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6245,7 +6245,7 @@ __metadata:\n     \"@udecode/plate-combobox\": \"npm:38.0.1\"\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6262,7 +6262,7 @@ __metadata:\n     \"@excalidraw/excalidraw\": \"npm:0.16.4\"\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6278,7 +6278,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6296,7 +6296,7 @@ __metadata:\n     \"@floating-ui/react\": \"npm:^0.26.23\"\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6313,7 +6313,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6329,7 +6329,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6345,7 +6345,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6361,7 +6361,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6379,7 +6379,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     html-entities: \"npm:^2.5.2\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6398,7 +6398,7 @@ __metadata:\n     \"@udecode/plate-list\": \"npm:38.0.1\"\n     clsx: \"npm:^2.1.1\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6414,7 +6414,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6431,7 +6431,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     juice: \"npm:^8.1.0\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6447,7 +6447,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6463,7 +6463,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6479,7 +6479,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6497,7 +6497,7 @@ __metadata:\n     \"@udecode/plate-floating\": \"npm:38.0.1\"\n     \"@udecode/plate-normalizers\": \"npm:38.0.1\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6515,7 +6515,7 @@ __metadata:\n     \"@udecode/plate-reset-node\": \"npm:38.0.1\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6534,7 +6534,7 @@ __metadata:\n     remark-parse: \"npm:^9.0.0\"\n     unified: \"npm:^11.0.5\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6552,7 +6552,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     katex: \"npm:0.16.11\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6569,7 +6569,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     js-video-url-parser: \"npm:^0.5.1\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6586,7 +6586,7 @@ __metadata:\n     \"@udecode/plate-combobox\": \"npm:38.0.1\"\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6603,7 +6603,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6620,7 +6620,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6637,7 +6637,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n     \"@playwright/test\": \">=1.42.1\"\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6653,7 +6653,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6669,7 +6669,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6685,7 +6685,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6702,7 +6702,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     copy-to-clipboard: \"npm:^3.3.3\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6719,7 +6719,7 @@ __metadata:\n     \"@udecode/plate-combobox\": \"npm:38.0.1\"\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6737,7 +6737,7 @@ __metadata:\n     \"@udecode/plate-diff\": \"npm:38.0.0\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6754,7 +6754,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     tabbable: \"npm:^6.2.0\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6772,7 +6772,7 @@ __metadata:\n     \"@udecode/plate-resizable\": \"npm:38.0.0\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6799,7 +6799,7 @@ __metadata:\n     \"@udecode/plate-node-id\": \"npm:38.0.1\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6815,7 +6815,7 @@ __metadata:\n   dependencies:\n     \"@udecode/plate-common\": \"workspace:^\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6856,15 +6856,15 @@ __metadata:\n   languageName: unknown\n   linkType: soft\n \n-\"@udecode/plate-utils@npm:38.0.1, @udecode/plate-utils@workspace:^, @udecode/plate-utils@workspace:packages/plate-utils\":\n+\"@udecode/plate-utils@npm:38.0.4, @udecode/plate-utils@workspace:^, @udecode/plate-utils@workspace:packages/plate-utils\":\n   version: 0.0.0-use.local\n   resolution: \"@udecode/plate-utils@workspace:packages/plate-utils\"\n   dependencies:\n-    \"@udecode/plate-core\": \"npm:38.0.1\"\n+    \"@udecode/plate-core\": \"npm:38.0.4\"\n     \"@udecode/react-utils\": \"npm:38.0.1\"\n-    \"@udecode/slate\": \"npm:37.0.0\"\n-    \"@udecode/slate-react\": \"npm:38.0.1\"\n-    \"@udecode/slate-utils\": \"npm:37.0.0\"\n+    \"@udecode/slate\": \"npm:38.0.4\"\n+    \"@udecode/slate-react\": \"npm:38.0.4\"\n+    \"@udecode/slate-utils\": \"npm:38.0.4\"\n     \"@udecode/utils\": \"npm:37.0.0\"\n     clsx: \"npm:^2.1.1\"\n     lodash: \"npm:^4.17.21\"\n@@ -6887,7 +6887,7 @@ __metadata:\n     \"@udecode/plate-common\": \"workspace:^\"\n     yjs: \"npm:^13.6.19\"\n   peerDependencies:\n-    \"@udecode/plate-common\": \">=38.0.1\"\n+    \"@udecode/plate-common\": \">=38.0.4\"\n     react: \">=16.8.0\"\n     react-dom: \">=16.8.0\"\n     slate: \">=0.103.0\"\n@@ -6910,7 +6910,7 @@ __metadata:\n     \"@udecode/plate-code-block\": \"npm:38.0.1\"\n     \"@udecode/plate-combobox\": \"npm:38.0.1\"\n     \"@udecode/plate-comments\": \"npm:38.0.1\"\n-    \"@udecode/plate-common\": \"npm:38.0.1\"\n+    \"@udecode/plate-common\": \"npm:38.0.4\"\n     \"@udecode/plate-csv\": \"npm:38.0.1\"\n     \"@udecode/plate-diff\": \"npm:38.0.0\"\n     \"@udecode/plate-docx\": \"npm:38.0.1\"\n@@ -6975,12 +6975,12 @@ __metadata:\n   languageName: unknown\n   linkType: soft\n \n-\"@udecode/slate-react@npm:38.0.1, @udecode/slate-react@workspace:^, @udecode/slate-react@workspace:packages/slate-react\":\n+\"@udecode/slate-react@npm:38.0.4, @udecode/slate-react@workspace:^, @udecode/slate-react@workspace:packages/slate-react\":\n   version: 0.0.0-use.local\n   resolution: \"@udecode/slate-react@workspace:packages/slate-react\"\n   dependencies:\n     \"@udecode/react-utils\": \"npm:38.0.1\"\n-    \"@udecode/slate\": \"npm:37.0.0\"\n+    \"@udecode/slate\": \"npm:38.0.4\"\n     \"@udecode/utils\": \"npm:37.0.0\"\n   peerDependencies:\n     react: \">=16.8.0\"\n@@ -6991,11 +6991,11 @@ __metadata:\n   languageName: unknown\n   linkType: soft\n \n-\"@udecode/slate-utils@npm:37.0.0, @udecode/slate-utils@workspace:^, @udecode/slate-utils@workspace:packages/slate-utils\":\n+\"@udecode/slate-utils@npm:38.0.4, @udecode/slate-utils@workspace:^, @udecode/slate-utils@workspace:packages/slate-utils\":\n   version: 0.0.0-use.local\n   resolution: \"@udecode/slate-utils@workspace:packages/slate-utils\"\n   dependencies:\n-    \"@udecode/slate\": \"npm:37.0.0\"\n+    \"@udecode/slate\": \"npm:38.0.4\"\n     \"@udecode/utils\": \"npm:37.0.0\"\n     lodash: \"npm:^4.17.21\"\n   peerDependencies:\n@@ -7004,7 +7004,7 @@ __metadata:\n   languageName: unknown\n   linkType: soft\n \n-\"@udecode/slate@npm:37.0.0, @udecode/slate@workspace:^, @udecode/slate@workspace:packages/slate\":\n+\"@udecode/slate@npm:38.0.4, @udecode/slate@workspace:^, @udecode/slate@workspace:packages/slate\":\n   version: 0.0.0-use.local\n   resolution: \"@udecode/slate@workspace:packages/slate\"\n   dependencies:\n@@ -16727,8 +16727,8 @@ __metadata:\n   version: 0.0.0-use.local\n   resolution: \"plate@workspace:.\"\n   dependencies:\n-    \"@changesets/cli\": \"npm:^2.27.8\"\n-    \"@changesets/get-github-info\": \"npm:^0.6.0\"\n+    \"@changesets/cli\": \"npm:^2.27.7\"\n+    \"@changesets/get-github-info\": \"npm:^0.5.2\"\n     \"@dword-design/eslint-plugin-import-alias\": \"npm:^5.1.1\"\n     \"@ianvs/prettier-plugin-sort-imports\": \"npm:^4.3.1\"\n     \"@playwright/test\": \"npm:1.47.0\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/navidrome/navidrome/commits/3107170afd9f557a10f7031f23cb3c9e975a71f9",
        "url": "https://api.github.com/repos/navidrome/navidrome/commits/3107170afd9f557a10f7031f23cb3c9e975a71f9",
        "html_url": "https://github.com/navidrome/navidrome/commit/3107170afd9f557a10f7031f23cb3c9e975a71f9",
        "message": "Improve SQL sanitization",
        "files": [
            {
                "sha": "b365e23baeade00b36887f18aa55f8cd8f9f7c0c",
                "filename": "model/annotation.go",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/model%2Fannotation.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/model%2Fannotation.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/model%2Fannotation.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -3,11 +3,11 @@ package model\n import \"time\"\n \n type Annotations struct {\n-\tPlayCount int64      `structs:\"-\" json:\"playCount\"`\n-\tPlayDate  *time.Time `structs:\"-\" json:\"playDate\" `\n-\tRating    int        `structs:\"-\" json:\"rating\"   `\n-\tStarred   bool       `structs:\"-\" json:\"starred\"  `\n-\tStarredAt *time.Time `structs:\"-\" json:\"starredAt\"`\n+\tPlayCount int64      `structs:\"play_count\" json:\"playCount\"`\n+\tPlayDate  *time.Time `structs:\"play_date\"  json:\"playDate\" `\n+\tRating    int        `structs:\"rating\"     json:\"rating\"   `\n+\tStarred   bool       `structs:\"starred\"    json:\"starred\"  `\n+\tStarredAt *time.Time `structs:\"starred_at\" json:\"starredAt\"`\n }\n \n type AnnotatedRepository interface {"
            },
            {
                "sha": "a0a92f7ee0e449180d5485267597b305fda54e61",
                "filename": "persistence/album_repository.go",
                "status": "modified",
                "additions": 6,
                "deletions": 8,
                "changes": 14,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Falbum_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Falbum_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Falbum_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -16,7 +16,6 @@ import (\n \n type albumRepository struct {\n \tsqlRepository\n-\tsqlRestful\n }\n \n type dbAlbum struct {\n@@ -58,8 +57,7 @@ func NewAlbumRepository(ctx context.Context, db dbx.Builder) model.AlbumReposito\n \tr := &albumRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"album\"\n-\tr.filterMappings = map[string]filterFunc{\n+\tr.registerModel(&model.Album{}, map[string]filterFunc{\n \t\t\"id\":              idFilter(r.tableName),\n \t\t\"name\":            fullTextFilter,\n \t\t\"compilation\":     booleanFilter,\n@@ -68,12 +66,12 @@ func NewAlbumRepository(ctx context.Context, db dbx.Builder) model.AlbumReposito\n \t\t\"recently_played\": recentlyPlayedFilter,\n \t\t\"starred\":         booleanFilter,\n \t\t\"has_rating\":      hasRatingFilter,\n-\t}\n+\t})\n \tif conf.Server.PreferSortTags {\n \t\tr.sortMappings = map[string]string{\n \t\t\t\"name\":           \"COALESCE(NULLIF(sort_album_name,''),order_album_name)\",\n \t\t\t\"artist\":         \"compilation asc, COALESCE(NULLIF(sort_album_artist_name,''),order_album_artist_name) asc, COALESCE(NULLIF(sort_album_name,''),order_album_name) asc\",\n-\t\t\t\"albumArtist\":    \"compilation asc, COALESCE(NULLIF(sort_album_artist_name,''),order_album_artist_name) asc, COALESCE(NULLIF(sort_album_name,''),order_album_name) asc\",\n+\t\t\t\"album_artist\":   \"compilation asc, COALESCE(NULLIF(sort_album_artist_name,''),order_album_artist_name) asc, COALESCE(NULLIF(sort_album_name,''),order_album_name) asc\",\n \t\t\t\"max_year\":       \"coalesce(nullif(original_date,''), cast(max_year as text)), release_date, name, COALESCE(NULLIF(sort_album_name,''),order_album_name) asc\",\n \t\t\t\"random\":         r.seededRandomSort(),\n \t\t\t\"recently_added\": recentlyAddedSort(),\n@@ -82,7 +80,7 @@ func NewAlbumRepository(ctx context.Context, db dbx.Builder) model.AlbumReposito\n \t\tr.sortMappings = map[string]string{\n \t\t\t\"name\":           \"order_album_name asc, order_album_artist_name asc\",\n \t\t\t\"artist\":         \"compilation asc, order_album_artist_name asc, order_album_name asc\",\n-\t\t\t\"albumArtist\":    \"compilation asc, order_album_artist_name asc, order_album_name asc\",\n+\t\t\t\"album_artist\":   \"compilation asc, order_album_artist_name asc, order_album_name asc\",\n \t\t\t\"max_year\":       \"coalesce(nullif(original_date,''), cast(max_year as text)), release_date, name, order_album_name asc\",\n \t\t\t\"random\":         r.seededRandomSort(),\n \t\t\t\"recently_added\": recentlyAddedSort(),\n@@ -213,15 +211,15 @@ func (r *albumRepository) Search(q string, offset int, size int) (model.Albums,\n }\n \n func (r *albumRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.CountAll(r.parseRestOptions(options...))\n+\treturn r.CountAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *albumRepository) Read(id string) (interface{}, error) {\n \treturn r.Get(id)\n }\n \n func (r *albumRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\treturn r.GetAll(r.parseRestOptions(options...))\n+\treturn r.GetAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *albumRepository) EntityName() string {"
            },
            {
                "sha": "617fcb6df0d429b0b438a511554ba4a53e4a38dc",
                "filename": "persistence/artist_repository.go",
                "status": "modified",
                "additions": 4,
                "deletions": 6,
                "changes": 10,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fartist_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fartist_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fartist_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -20,7 +20,6 @@ import (\n \n type artistRepository struct {\n \tsqlRepository\n-\tsqlRestful\n \tindexGroups utils.IndexGroups\n }\n \n@@ -60,12 +59,11 @@ func NewArtistRepository(ctx context.Context, db dbx.Builder) model.ArtistReposi\n \tr.ctx = ctx\n \tr.db = db\n \tr.indexGroups = utils.ParseIndexGroups(conf.Server.IndexGroups)\n-\tr.tableName = \"artist\"\n-\tr.filterMappings = map[string]filterFunc{\n+\tr.registerModel(&model.Artist{}, map[string]filterFunc{\n \t\t\"id\":      idFilter(r.tableName),\n \t\t\"name\":    fullTextFilter,\n \t\t\"starred\": booleanFilter,\n-\t}\n+\t})\n \tif conf.Server.PreferSortTags {\n \t\tr.sortMappings = map[string]string{\n \t\t\t\"name\": \"COALESCE(NULLIF(sort_artist_name,''),order_artist_name)\",\n@@ -200,15 +198,15 @@ func (r *artistRepository) Search(q string, offset int, size int) (model.Artists\n }\n \n func (r *artistRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.CountAll(r.parseRestOptions(options...))\n+\treturn r.CountAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *artistRepository) Read(id string) (interface{}, error) {\n \treturn r.Get(id)\n }\n \n func (r *artistRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\treturn r.GetAll(r.parseRestOptions(options...))\n+\treturn r.GetAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *artistRepository) EntityName() string {"
            },
            {
                "sha": "77f27b77bcd9321cb62eba5501078a6c47bb6c96",
                "filename": "persistence/genre_repository.go",
                "status": "modified",
                "additions": 4,
                "deletions": 6,
                "changes": 10,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fgenre_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fgenre_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fgenre_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -14,17 +14,15 @@ import (\n \n type genreRepository struct {\n \tsqlRepository\n-\tsqlRestful\n }\n \n func NewGenreRepository(ctx context.Context, db dbx.Builder) model.GenreRepository {\n \tr := &genreRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"genre\"\n-\tr.filterMappings = map[string]filterFunc{\n+\tr.registerModel(&model.Genre{}, map[string]filterFunc{\n \t\t\"name\": containsFilter(\"name\"),\n-\t}\n+\t})\n \treturn r\n }\n \n@@ -60,7 +58,7 @@ func (r *genreRepository) Put(m *model.Genre) error {\n }\n \n func (r *genreRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.count(Select(), r.parseRestOptions(options...))\n+\treturn r.count(Select(), r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *genreRepository) Read(id string) (interface{}, error) {\n@@ -71,7 +69,7 @@ func (r *genreRepository) Read(id string) (interface{}, error) {\n }\n \n func (r *genreRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\tsel := r.newSelect(r.parseRestOptions(options...)).Columns(\"*\")\n+\tsel := r.newSelect(r.parseRestOptions(r.ctx, options...)).Columns(\"*\")\n \tres := model.Genres{}\n \terr := r.queryAll(sel, &res)\n \treturn res, err"
            },
            {
                "sha": "4603c613a64ab4123458b2432a30c2fe7b6c6bd9",
                "filename": "persistence/library_repository.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Flibrary_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Flibrary_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Flibrary_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -18,7 +18,7 @@ func NewLibraryRepository(ctx context.Context, db dbx.Builder) model.LibraryRepo\n \tr := &libraryRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"library\"\n+\tr.registerModel(&model.Library{}, nil)\n \treturn r\n }\n "
            },
            {
                "sha": "584b381f8bd98c6b3d7ec19e70f9e3874d7a78bf",
                "filename": "persistence/mediafile_repository.go",
                "status": "modified",
                "additions": 16,
                "deletions": 16,
                "changes": 32,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fmediafile_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fmediafile_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fmediafile_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -18,34 +18,34 @@ import (\n \n type mediaFileRepository struct {\n \tsqlRepository\n-\tsqlRestful\n }\n \n func NewMediaFileRepository(ctx context.Context, db dbx.Builder) *mediaFileRepository {\n \tr := &mediaFileRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"media_file\"\n-\tr.filterMappings = map[string]filterFunc{\n+\tr.registerModel(&model.MediaFile{}, map[string]filterFunc{\n \t\t\"id\":      idFilter(r.tableName),\n \t\t\"title\":   fullTextFilter,\n \t\t\"starred\": booleanFilter,\n-\t}\n+\t})\n \tif conf.Server.PreferSortTags {\n \t\tr.sortMappings = map[string]string{\n-\t\t\t\"title\":     \"COALESCE(NULLIF(sort_title,''),title)\",\n-\t\t\t\"artist\":    \"COALESCE(NULLIF(sort_artist_name,''),order_artist_name) asc, COALESCE(NULLIF(sort_album_name,''),order_album_name) asc, release_date asc, disc_number asc, track_number asc\",\n-\t\t\t\"album\":     \"COALESCE(NULLIF(sort_album_name,''),order_album_name) asc, release_date asc, disc_number asc, track_number asc, COALESCE(NULLIF(sort_artist_name,''),order_artist_name) asc, COALESCE(NULLIF(sort_title,''),title) asc\",\n-\t\t\t\"random\":    r.seededRandomSort(),\n-\t\t\t\"createdAt\": \"media_file.created_at\",\n+\t\t\t\"title\":        \"COALESCE(NULLIF(sort_title,''),title)\",\n+\t\t\t\"artist\":       \"COALESCE(NULLIF(sort_artist_name,''),order_artist_name) asc, COALESCE(NULLIF(sort_album_name,''),order_album_name) asc, release_date asc, disc_number asc, track_number asc\",\n+\t\t\t\"album\":        \"COALESCE(NULLIF(sort_album_name,''),order_album_name) asc, release_date asc, disc_number asc, track_number asc, COALESCE(NULLIF(sort_artist_name,''),order_artist_name) asc, COALESCE(NULLIF(sort_title,''),title) asc\",\n+\t\t\t\"random\":       r.seededRandomSort(),\n+\t\t\t\"created_at\":   \"media_file.created_at\",\n+\t\t\t\"track_number\": \"album, release_date, disc_number, track_number\",\n \t\t}\n \t} else {\n \t\tr.sortMappings = map[string]string{\n-\t\t\t\"title\":     \"order_title\",\n-\t\t\t\"artist\":    \"order_artist_name asc, order_album_name asc, release_date asc, disc_number asc, track_number asc\",\n-\t\t\t\"album\":     \"order_album_name asc, release_date asc, disc_number asc, track_number asc, order_artist_name asc, title asc\",\n-\t\t\t\"random\":    r.seededRandomSort(),\n-\t\t\t\"createdAt\": \"media_file.created_at\",\n+\t\t\t\"title\":        \"order_title\",\n+\t\t\t\"artist\":       \"order_artist_name asc, order_album_name asc, release_date asc, disc_number asc, track_number asc\",\n+\t\t\t\"album\":        \"order_album_name asc, release_date asc, disc_number asc, track_number asc, order_artist_name asc, title asc\",\n+\t\t\t\"random\":       r.seededRandomSort(),\n+\t\t\t\"created_at\":   \"media_file.created_at\",\n+\t\t\t\"track_number\": \"album, release_date, disc_number, track_number\",\n \t\t}\n \t}\n \treturn r\n@@ -209,15 +209,15 @@ func (r *mediaFileRepository) Search(q string, offset int, size int) (model.Medi\n }\n \n func (r *mediaFileRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.CountAll(r.parseRestOptions(options...))\n+\treturn r.CountAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *mediaFileRepository) Read(id string) (interface{}, error) {\n \treturn r.Get(id)\n }\n \n func (r *mediaFileRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\treturn r.GetAll(r.parseRestOptions(options...))\n+\treturn r.GetAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *mediaFileRepository) EntityName() string {"
            },
            {
                "sha": "381ec2ae89633562e1be9ca32adabcb34d9dd8a7",
                "filename": "persistence/player_repository.go",
                "status": "modified",
                "additions": 4,
                "deletions": 6,
                "changes": 10,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fplayer_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fplayer_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fplayer_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -12,17 +12,15 @@ import (\n \n type playerRepository struct {\n \tsqlRepository\n-\tsqlRestful\n }\n \n func NewPlayerRepository(ctx context.Context, db dbx.Builder) model.PlayerRepository {\n \tr := &playerRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"player\"\n-\tr.filterMappings = map[string]filterFunc{\n+\tr.registerModel(&model.Player{}, map[string]filterFunc{\n \t\t\"name\": containsFilter(\"player.name\"),\n-\t}\n+\t})\n \treturn r\n }\n \n@@ -74,7 +72,7 @@ func (r *playerRepository) addRestriction(sql ...Sqlizer) Sqlizer {\n }\n \n func (r *playerRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.count(r.newRestSelect(), r.parseRestOptions(options...))\n+\treturn r.count(r.newRestSelect(), r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *playerRepository) Read(id string) (interface{}, error) {\n@@ -85,7 +83,7 @@ func (r *playerRepository) Read(id string) (interface{}, error) {\n }\n \n func (r *playerRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\tsel := r.newRestSelect(r.parseRestOptions(options...))\n+\tsel := r.newRestSelect(r.parseRestOptions(r.ctx, options...))\n \tres := model.Players{}\n \terr := r.queryAll(sel, &res)\n \treturn res, err"
            },
            {
                "sha": "efc072da5fc4d0b10d8bf6b5699d04d833575222",
                "filename": "persistence/playlist_repository.go",
                "status": "modified",
                "additions": 4,
                "deletions": 6,
                "changes": 10,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fplaylist_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fplaylist_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fplaylist_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -19,7 +19,6 @@ import (\n \n type playlistRepository struct {\n \tsqlRepository\n-\tsqlRestful\n }\n \n type dbPlaylist struct {\n@@ -51,11 +50,10 @@ func NewPlaylistRepository(ctx context.Context, db dbx.Builder) model.PlaylistRe\n \tr := &playlistRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"playlist\"\n-\tr.filterMappings = map[string]filterFunc{\n+\tr.registerModel(&model.Playlist{}, map[string]filterFunc{\n \t\t\"q\":     playlistFilter,\n \t\t\"smart\": smartPlaylistFilter,\n-\t}\n+\t})\n \treturn r\n }\n \n@@ -372,15 +370,15 @@ func (r *playlistRepository) loadTracks(sel SelectBuilder, id string) (model.Pla\n }\n \n func (r *playlistRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.CountAll(r.parseRestOptions(options...))\n+\treturn r.CountAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *playlistRepository) Read(id string) (interface{}, error) {\n \treturn r.Get(id)\n }\n \n func (r *playlistRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\treturn r.GetAll(r.parseRestOptions(options...))\n+\treturn r.GetAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *playlistRepository) EntityName() string {"
            },
            {
                "sha": "f2089edcf306efe268cab6cad3a5b672750c52b0",
                "filename": "persistence/playlist_track_repository.go",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fplaylist_track_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fplaylist_track_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fplaylist_track_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -13,7 +13,6 @@ import (\n \n type playlistTrackRepository struct {\n \tsqlRepository\n-\tsqlRestful\n \tplaylistId   string\n \tplaylist     *model.Playlist\n \tplaylistRepo *playlistRepository\n@@ -26,6 +25,7 @@ func (r *playlistRepository) Tracks(playlistId string, refreshSmartPlaylist bool\n \tp.ctx = r.ctx\n \tp.db = r.db\n \tp.tableName = \"playlist_tracks\"\n+\tp.registerModel(&model.PlaylistTrack{}, nil)\n \tp.sortMappings = map[string]string{\n \t\t\"id\":     \"playlist_tracks.id\",\n \t\t\"artist\": \"order_artist_name asc\",\n@@ -51,7 +51,7 @@ func (r *playlistRepository) Tracks(playlistId string, refreshSmartPlaylist bool\n }\n \n func (r *playlistTrackRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.count(Select().Where(Eq{\"playlist_id\": r.playlistId}), r.parseRestOptions(options...))\n+\treturn r.count(Select().Where(Eq{\"playlist_id\": r.playlistId}), r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *playlistTrackRepository) Read(id string) (interface{}, error) {\n@@ -112,7 +112,7 @@ func (r *playlistTrackRepository) GetAlbumIDs(options ...model.QueryOptions) ([]\n }\n \n func (r *playlistTrackRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\treturn r.GetAll(r.parseRestOptions(options...))\n+\treturn r.GetAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *playlistTrackRepository) EntityName() string {"
            },
            {
                "sha": "781c5024191b8f4c5b0b41ba3ee7a7a76b41dac4",
                "filename": "persistence/radio_repository.go",
                "status": "modified",
                "additions": 4,
                "deletions": 6,
                "changes": 10,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fradio_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fradio_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fradio_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -15,17 +15,15 @@ import (\n \n type radioRepository struct {\n \tsqlRepository\n-\tsqlRestful\n }\n \n func NewRadioRepository(ctx context.Context, db dbx.Builder) model.RadioRepository {\n \tr := &radioRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"radio\"\n-\tr.filterMappings = map[string]filterFunc{\n+\tr.registerModel(&model.Radio{}, map[string]filterFunc{\n \t\t\"name\": containsFilter(\"name\"),\n-\t}\n+\t})\n \tr.sortMappings = map[string]string{\n \t\t\"name\": \"(name collate nocase), name\",\n \t}\n@@ -96,7 +94,7 @@ func (r *radioRepository) Put(radio *model.Radio) error {\n }\n \n func (r *radioRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.CountAll(r.parseRestOptions(options...))\n+\treturn r.CountAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *radioRepository) EntityName() string {\n@@ -112,7 +110,7 @@ func (r *radioRepository) Read(id string) (interface{}, error) {\n }\n \n func (r *radioRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\treturn r.GetAll(r.parseRestOptions(options...))\n+\treturn r.GetAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *radioRepository) Save(entity interface{}) (string, error) {"
            },
            {
                "sha": "ca7b971c1c8f81f19bd0731689e3a86e2b4773d7",
                "filename": "persistence/share_repository.go",
                "status": "modified",
                "additions": 3,
                "deletions": 4,
                "changes": 7,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fshare_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fshare_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fshare_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -17,14 +17,13 @@ import (\n \n type shareRepository struct {\n \tsqlRepository\n-\tsqlRestful\n }\n \n func NewShareRepository(ctx context.Context, db dbx.Builder) model.ShareRepository {\n \tr := &shareRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"share\"\n+\tr.registerModel(&model.Share{}, map[string]filterFunc{})\n \treturn r\n }\n \n@@ -166,7 +165,7 @@ func (r *shareRepository) CountAll(options ...model.QueryOptions) (int64, error)\n }\n \n func (r *shareRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.CountAll(r.parseRestOptions(options...))\n+\treturn r.CountAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *shareRepository) EntityName() string {\n@@ -185,7 +184,7 @@ func (r *shareRepository) Read(id string) (interface{}, error) {\n }\n \n func (r *shareRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\tsq := r.selectShare(r.parseRestOptions(options...))\n+\tsq := r.selectShare(r.parseRestOptions(r.ctx, options...))\n \tres := model.Shares{}\n \terr := r.queryAll(sq, &res)\n \treturn res, err"
            },
            {
                "sha": "e50f72cb1618b928e80ad75faabc3ca97541e6f6",
                "filename": "persistence/sql_base_repository.go",
                "status": "modified",
                "additions": 28,
                "deletions": 4,
                "changes": 32,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fsql_base_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fsql_base_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fsql_base_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -19,11 +19,25 @@ import (\n \t\"github.com/pocketbase/dbx\"\n )\n \n+// sqlRepository is the base repository for all SQL repositories. It provides common functions to interact with the DB.\n+// When creating a new repository using this base, you must:\n+//\n+//   - Embed this struct.\n+//   - Set ctx and db fields. ctx should be the context passed to the constructor method, usually obtained from the request\n+//   - Call registerModel with the model instance and any possible filters.\n+//   - If the model has a different table name than the default (lowercase of the model name), it should be set manually\n+//     using the tableName field.\n+//   - Sort mappings should be set in the sortMappings field. If the sort field is not in the map, it will be used as is.\n+//\n+// All fields in filters and sortMappings must be in snake_case. Only sorts and filters based on real field names or\n+// defined in the mappings will be allowed.\n type sqlRepository struct {\n-\tctx          context.Context\n-\ttableName    string\n-\tdb           dbx.Builder\n-\tsortMappings map[string]string\n+\tctx                context.Context\n+\ttableName          string\n+\tdb                 dbx.Builder\n+\tsortMappings       map[string]string\n+\tfilterMappings     map[string]filterFunc\n+\tisFieldWhiteListed fieldWhiteListedFunc\n }\n \n const invalidUserId = \"-1\"\n@@ -44,6 +58,16 @@ func loggedUser(ctx context.Context) *model.User {\n \t}\n }\n \n+func (r *sqlRepository) registerModel(instance any, filters map[string]filterFunc) {\n+\tif r.tableName == \"\" {\n+\t\tr.tableName = strings.TrimPrefix(reflect.TypeOf(instance).String(), \"*model.\")\n+\t\tr.tableName = toSnakeCase(r.tableName)\n+\t}\n+\tr.tableName = strings.ToLower(r.tableName)\n+\tr.isFieldWhiteListed = registerModelWhiteList(instance)\n+\tr.filterMappings = filters\n+}\n+\n func (r sqlRepository) getTableName() string {\n \treturn r.tableName\n }"
            },
            {
                "sha": "35d802d98fc64735a466fe96a65c40d82ad8a33b",
                "filename": "persistence/sql_base_repository_test.go",
                "status": "modified",
                "additions": 42,
                "deletions": 21,
                "changes": 63,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fsql_base_repository_test.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fsql_base_repository_test.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fsql_base_repository_test.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -73,40 +73,61 @@ var _ = Describe(\"sqlRepository\", func() {\n \t\t})\n \t})\n \n-\tDescribe(\"sortMapping\", func() {\n+\tDescribe(\"sanitizeSort\", func() {\n \t\tBeforeEach(func() {\n+\t\t\tr.registerModel(&struct {\n+\t\t\t\tField string `structs:\"field\"`\n+\t\t\t}{}, nil)\n \t\t\tr.sortMappings = map[string]string{\n-\t\t\t\t\"sort1\":      \"mappedSort1\",\n-\t\t\t\t\"sortTwo\":    \"mappedSort2\",\n-\t\t\t\t\"sort_three\": \"mappedSort3\",\n+\t\t\t\t\"sort1\": \"mappedSort1\",\n \t\t\t}\n \t\t})\n \n-\t\tIt(\"returns the mapped value when sort key exists\", func() {\n-\t\t\tExpect(r.sortMapping(\"sort1\")).To(Equal(\"mappedSort1\"))\n-\t\t})\n+\t\tWhen(\"sanitizing sort\", func() {\n+\t\t\tIt(\"returns empty if the sort key is not found in the model nor in the mappings\", func() {\n+\t\t\t\tsort, _ := r.sanitizeSort(\"unknown\", \"\")\n+\t\t\t\tExpect(sort).To(BeEmpty())\n+\t\t\t})\n \n-\t\tContext(\"when sort key does not exist\", func() {\n-\t\t\tIt(\"returns the original sort key, snake cased\", func() {\n-\t\t\t\tExpect(r.sortMapping(\"NotFoundSort\")).To(Equal(\"not_found_sort\"))\n+\t\t\tIt(\"returns the mapped value when sort key exists\", func() {\n+\t\t\t\tsort, _ := r.sanitizeSort(\"sort1\", \"\")\n+\t\t\t\tExpect(sort).To(Equal(\"mappedSort1\"))\n+\t\t\t})\n+\n+\t\t\tIt(\"is case insensitive\", func() {\n+\t\t\t\tsort, _ := r.sanitizeSort(\"Sort1\", \"\")\n+\t\t\t\tExpect(sort).To(Equal(\"mappedSort1\"))\n \t\t\t})\n-\t\t})\n \n-\t\tContext(\"when sort key is camel cased\", func() {\n-\t\t\tIt(\"returns the mapped value when camel case sort key exists\", func() {\n-\t\t\t\tExpect(r.sortMapping(\"sortTwo\")).To(Equal(\"mappedSort2\"))\n+\t\t\tIt(\"returns the field if it is a valid field\", func() {\n+\t\t\t\tsort, _ := r.sanitizeSort(\"field\", \"\")\n+\t\t\t\tExpect(sort).To(Equal(\"field\"))\n \t\t\t})\n-\t\t\tIt(\"returns the mapped value when passing a snake case key\", func() {\n-\t\t\t\tExpect(r.sortMapping(\"sort_two\")).To(Equal(\"mappedSort2\"))\n+\n+\t\t\tIt(\"is case insensitive for fields\", func() {\n+\t\t\t\tsort, _ := r.sanitizeSort(\"FIELD\", \"\")\n+\t\t\t\tExpect(sort).To(Equal(\"field\"))\n \t\t\t})\n \t\t})\n+\t\tWhen(\"sanitizing order\", func() {\n+\t\t\tIt(\"returns 'asc' if order is empty\", func() {\n+\t\t\t\t_, order := r.sanitizeSort(\"\", \"\")\n+\t\t\t\tExpect(order).To(Equal(\"\"))\n+\t\t\t})\n \n-\t\tContext(\"when sort key is snake cased\", func() {\n-\t\t\tIt(\"returns the mapped value when snake case sort key exists\", func() {\n-\t\t\t\tExpect(r.sortMapping(\"sort_three\")).To(Equal(\"mappedSort3\"))\n+\t\t\tIt(\"returns 'asc' if order is 'asc'\", func() {\n+\t\t\t\t_, order := r.sanitizeSort(\"\", \"ASC\")\n+\t\t\t\tExpect(order).To(Equal(\"asc\"))\n \t\t\t})\n-\t\t\tIt(\"returns the mapped value when passing a camel case key\", func() {\n-\t\t\t\tExpect(r.sortMapping(\"sortThree\")).To(Equal(\"mappedSort3\"))\n+\n+\t\t\tIt(\"returns 'desc' if order is 'desc'\", func() {\n+\t\t\t\t_, order := r.sanitizeSort(\"\", \"desc\")\n+\t\t\t\tExpect(order).To(Equal(\"desc\"))\n+\t\t\t})\n+\n+\t\t\tIt(\"returns 'asc' if order is unknown\", func() {\n+\t\t\t\t_, order := r.sanitizeSort(\"\", \"something\")\n+\t\t\t\tExpect(order).To(Equal(\"asc\"))\n \t\t\t})\n \t\t})\n \t})"
            },
            {
                "sha": "193ff656328bcb6591d38dbf86f5b103fc816039",
                "filename": "persistence/sql_restful.go",
                "status": "modified",
                "additions": 102,
                "deletions": 20,
                "changes": 122,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fsql_restful.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fsql_restful.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fsql_restful.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -1,61 +1,94 @@\n package persistence\n \n import (\n+\t\"context\"\n \t\"fmt\"\n+\t\"reflect\"\n \t\"strings\"\n+\t\"sync\"\n \n \t. \"github.com/Masterminds/squirrel\"\n \t\"github.com/deluan/rest\"\n+\t\"github.com/fatih/structs\"\n+\t\"github.com/navidrome/navidrome/log\"\n \t\"github.com/navidrome/navidrome/model\"\n )\n \n-type filterFunc = func(field string, value interface{}) Sqlizer\n+type filterFunc = func(field string, value any) Sqlizer\n \n-type sqlRestful struct {\n-\tfilterMappings map[string]filterFunc\n-}\n-\n-func (r sqlRestful) parseRestFilters(options rest.QueryOptions) Sqlizer {\n+func (r *sqlRepository) parseRestFilters(ctx context.Context, options rest.QueryOptions) Sqlizer {\n \tif len(options.Filters) == 0 {\n \t\treturn nil\n \t}\n \tfilters := And{}\n \tfor f, v := range options.Filters {\n+\t\t// Ignore filters with empty values\n \t\tif v == \"\" {\n \t\t\tcontinue\n \t\t}\n+\t\t// Look for a custom filter function\n+\t\tf = strings.ToLower(f)\n \t\tif ff, ok := r.filterMappings[f]; ok {\n \t\t\tfilters = append(filters, ff(f, v))\n-\t\t} else if strings.HasSuffix(strings.ToLower(f), \"id\") {\n+\t\t\tcontinue\n+\t\t}\n+\t\t// Ignore invalid filters (not based on a field or filter function)\n+\t\tif r.isFieldWhiteListed != nil && !r.isFieldWhiteListed(f) {\n+\t\t\tlog.Warn(ctx, \"Ignoring filter not whitelisted\", \"filter\", f)\n+\t\t\tcontinue\n+\t\t}\n+\t\t// For fields ending in \"id\", use an exact match\n+\t\tif strings.HasSuffix(f, \"id\") {\n \t\t\tfilters = append(filters, eqFilter(f, v))\n-\t\t} else {\n-\t\t\tfilters = append(filters, startsWithFilter(f, v))\n+\t\t\tcontinue\n \t\t}\n+\t\t// Default to a \"starts with\" filter\n+\t\tfilters = append(filters, startsWithFilter(f, v))\n \t}\n \treturn filters\n }\n \n-func (r sqlRestful) parseRestOptions(options ...rest.QueryOptions) model.QueryOptions {\n+func (r *sqlRepository) parseRestOptions(ctx context.Context, options ...rest.QueryOptions) model.QueryOptions {\n \tqo := model.QueryOptions{}\n \tif len(options) > 0 {\n-\t\tqo.Sort = options[0].Sort\n-\t\tqo.Order = strings.ToLower(options[0].Order)\n+\t\tqo.Sort, qo.Order = r.sanitizeSort(options[0].Sort, options[0].Order)\n \t\tqo.Max = options[0].Max\n \t\tqo.Offset = options[0].Offset\n \t\tif seed, ok := options[0].Filters[\"seed\"].(string); ok {\n \t\t\tqo.Seed = seed\n \t\t\tdelete(options[0].Filters, \"seed\")\n \t\t}\n-\t\tqo.Filters = r.parseRestFilters(options[0])\n+\t\tqo.Filters = r.parseRestFilters(ctx, options[0])\n \t}\n \treturn qo\n }\n \n-func eqFilter(field string, value interface{}) Sqlizer {\n+func (r sqlRepository) sanitizeSort(sort, order string) (string, string) {\n+\tif sort != \"\" {\n+\t\tsort = toSnakeCase(sort)\n+\t\tif mapped, ok := r.sortMappings[sort]; ok {\n+\t\t\tsort = mapped\n+\t\t} else {\n+\t\t\tif !r.isFieldWhiteListed(sort) {\n+\t\t\t\tlog.Warn(r.ctx, \"Ignoring sort not whitelisted\", \"sort\", sort)\n+\t\t\t\tsort = \"\"\n+\t\t\t}\n+\t\t}\n+\t}\n+\tif order != \"\" {\n+\t\torder = strings.ToLower(order)\n+\t\tif order != \"desc\" {\n+\t\t\torder = \"asc\"\n+\t\t}\n+\t}\n+\treturn sort, order\n+}\n+\n+func eqFilter(field string, value any) Sqlizer {\n \treturn Eq{field: value}\n }\n \n-func startsWithFilter(field string, value interface{}) Sqlizer {\n+func startsWithFilter(field string, value any) Sqlizer {\n \treturn Like{field: fmt.Sprintf(\"%s%%\", value)}\n }\n \n@@ -65,16 +98,16 @@ func containsFilter(field string) func(string, any) Sqlizer {\n \t}\n }\n \n-func booleanFilter(field string, value interface{}) Sqlizer {\n+func booleanFilter(field string, value any) Sqlizer {\n \tv := strings.ToLower(value.(string))\n \treturn Eq{field: strings.ToLower(v) == \"true\"}\n }\n \n-func fullTextFilter(field string, value interface{}) Sqlizer {\n+func fullTextFilter(_ string, value any) Sqlizer {\n \treturn fullTextExpr(value.(string))\n }\n \n-func substringFilter(field string, value interface{}) Sqlizer {\n+func substringFilter(field string, value any) Sqlizer {\n \tparts := strings.Split(value.(string), \" \")\n \tfilters := And{}\n \tfor _, part := range parts {\n@@ -83,8 +116,57 @@ func substringFilter(field string, value interface{}) Sqlizer {\n \treturn filters\n }\n \n-func idFilter(tableName string) func(string, interface{}) Sqlizer {\n-\treturn func(field string, value interface{}) Sqlizer {\n+func idFilter(tableName string) func(string, any) Sqlizer {\n+\treturn func(field string, value any) Sqlizer {\n \t\treturn Eq{tableName + \".id\": value}\n \t}\n }\n+\n+func invalidFilter(ctx context.Context) func(string, any) Sqlizer {\n+\treturn func(field string, value any) Sqlizer {\n+\t\tlog.Warn(ctx, \"Invalid filter\", \"fieldName\", field, \"value\", value)\n+\t\treturn Eq{\"1\": \"0\"}\n+\t}\n+}\n+\n+var (\n+\twhiteList = map[string]map[string]struct{}{}\n+\tmutex     sync.RWMutex\n+)\n+\n+func registerModelWhiteList(instance any) fieldWhiteListedFunc {\n+\tname := reflect.TypeOf(instance).String()\n+\tregisterFieldWhiteList(name, instance)\n+\treturn getFieldWhiteListedFunc(name)\n+}\n+\n+func registerFieldWhiteList(name string, instance any) {\n+\tmutex.Lock()\n+\tdefer mutex.Unlock()\n+\tif whiteList[name] != nil {\n+\t\treturn\n+\t}\n+\tm := structs.Map(instance)\n+\twhiteList[name] = map[string]struct{}{}\n+\tfor k := range m {\n+\t\twhiteList[name][toSnakeCase(k)] = struct{}{}\n+\t}\n+\tma := structs.Map(model.Annotations{})\n+\tfor k := range ma {\n+\t\twhiteList[name][toSnakeCase(k)] = struct{}{}\n+\t}\n+}\n+\n+type fieldWhiteListedFunc func(field string) bool\n+\n+func getFieldWhiteListedFunc(tableName string) fieldWhiteListedFunc {\n+\treturn func(field string) bool {\n+\t\tmutex.RLock()\n+\t\tdefer mutex.RUnlock()\n+\t\tif _, ok := whiteList[tableName]; !ok {\n+\t\t\treturn false\n+\t\t}\n+\t\t_, ok := whiteList[tableName][field]\n+\t\treturn ok\n+\t}\n+}"
            },
            {
                "sha": "6579e9ffabf5c139057272abd2449d4ca5771d5f",
                "filename": "persistence/sql_restful_test.go",
                "status": "modified",
                "additions": 9,
                "deletions": 7,
                "changes": 16,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fsql_restful_test.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fsql_restful_test.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fsql_restful_test.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -1,6 +1,8 @@\n package persistence\n \n import (\n+\t\"context\"\n+\n \t\"github.com/Masterminds/squirrel\"\n \t\"github.com/deluan/rest\"\n \t. \"github.com/onsi/ginkgo/v2\"\n@@ -9,31 +11,31 @@ import (\n \n var _ = Describe(\"sqlRestful\", func() {\n \tDescribe(\"parseRestFilters\", func() {\n-\t\tvar r sqlRestful\n+\t\tvar r sqlRepository\n \t\tvar options rest.QueryOptions\n \n \t\tBeforeEach(func() {\n-\t\t\tr = sqlRestful{}\n+\t\t\tr = sqlRepository{}\n \t\t})\n \n \t\tIt(\"returns nil if filters is empty\", func() {\n \t\t\toptions.Filters = nil\n-\t\t\tExpect(r.parseRestFilters(options)).To(BeNil())\n+\t\t\tExpect(r.parseRestFilters(context.Background(), options)).To(BeNil())\n \t\t})\n \n \t\tIt(\"returns a '=' condition for 'id' filter\", func() {\n \t\t\toptions.Filters = map[string]interface{}{\"id\": \"123\"}\n-\t\t\tExpect(r.parseRestFilters(options)).To(Equal(squirrel.And{squirrel.Eq{\"id\": \"123\"}}))\n+\t\t\tExpect(r.parseRestFilters(context.Background(), options)).To(Equal(squirrel.And{squirrel.Eq{\"id\": \"123\"}}))\n \t\t})\n \n \t\tIt(\"returns a 'in' condition for multiples 'id' filters\", func() {\n \t\t\toptions.Filters = map[string]interface{}{\"id\": []string{\"123\", \"456\"}}\n-\t\t\tExpect(r.parseRestFilters(options)).To(Equal(squirrel.And{squirrel.Eq{\"id\": []string{\"123\", \"456\"}}}))\n+\t\t\tExpect(r.parseRestFilters(context.Background(), options)).To(Equal(squirrel.And{squirrel.Eq{\"id\": []string{\"123\", \"456\"}}}))\n \t\t})\n \n \t\tIt(\"returns a 'like' condition for other filters\", func() {\n \t\t\toptions.Filters = map[string]interface{}{\"name\": \"joe\"}\n-\t\t\tExpect(r.parseRestFilters(options)).To(Equal(squirrel.And{squirrel.Like{\"name\": \"joe%\"}}))\n+\t\t\tExpect(r.parseRestFilters(context.Background(), options)).To(Equal(squirrel.And{squirrel.Like{\"name\": \"joe%\"}}))\n \t\t})\n \n \t\tIt(\"uses the custom filter\", func() {\n@@ -43,7 +45,7 @@ var _ = Describe(\"sqlRestful\", func() {\n \t\t\t\t},\n \t\t\t}\n \t\t\toptions.Filters = map[string]interface{}{\"test\": 100}\n-\t\t\tExpect(r.parseRestFilters(options)).To(Equal(squirrel.And{squirrel.Gt{\"test\": 100}}))\n+\t\t\tExpect(r.parseRestFilters(context.Background(), options)).To(Equal(squirrel.And{squirrel.Gt{\"test\": 100}}))\n \t\t})\n \t})\n })"
            },
            {
                "sha": "9f8998b808b832ed5f2d71965a34106ad583d30a",
                "filename": "persistence/transcoding_repository.go",
                "status": "modified",
                "additions": 3,
                "deletions": 4,
                "changes": 7,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Ftranscoding_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Ftranscoding_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Ftranscoding_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -12,14 +12,13 @@ import (\n \n type transcodingRepository struct {\n \tsqlRepository\n-\tsqlRestful\n }\n \n func NewTranscodingRepository(ctx context.Context, db dbx.Builder) model.TranscodingRepository {\n \tr := &transcodingRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"transcoding\"\n+\tr.registerModel(&model.Transcoding{}, nil)\n \treturn r\n }\n \n@@ -47,15 +46,15 @@ func (r *transcodingRepository) Put(t *model.Transcoding) error {\n }\n \n func (r *transcodingRepository) Count(options ...rest.QueryOptions) (int64, error) {\n-\treturn r.count(Select(), r.parseRestOptions(options...))\n+\treturn r.count(Select(), r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *transcodingRepository) Read(id string) (interface{}, error) {\n \treturn r.Get(id)\n }\n \n func (r *transcodingRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n-\tsel := r.newSelect(r.parseRestOptions(options...)).Columns(\"*\")\n+\tsel := r.newSelect(r.parseRestOptions(r.ctx, options...)).Columns(\"*\")\n \tres := model.Transcodings{}\n \terr := r.queryAll(sel, &res)\n \treturn res, err"
            },
            {
                "sha": "34162446d62dcb9cf5bed608f09321c701790f3d",
                "filename": "persistence/user_repository.go",
                "status": "modified",
                "additions": 11,
                "deletions": 10,
                "changes": 21,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fuser_repository.go",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/persistence%2Fuser_repository.go",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/persistence%2Fuser_repository.go?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -22,7 +22,6 @@ import (\n \n type userRepository struct {\n \tsqlRepository\n-\tsqlRestful\n }\n \n var (\n@@ -34,7 +33,9 @@ func NewUserRepository(ctx context.Context, db dbx.Builder) model.UserRepository\n \tr := &userRepository{}\n \tr.ctx = ctx\n \tr.db = db\n-\tr.tableName = \"user\"\n+\tr.registerModel(&model.User{}, map[string]filterFunc{\n+\t\t\"password\": invalidFilter(ctx),\n+\t})\n \tonce.Do(func() {\n \t\t_ = r.initPasswordEncryptionKey()\n \t})\n@@ -91,7 +92,7 @@ func (r *userRepository) FindFirstAdmin() (*model.User, error) {\n }\n \n func (r *userRepository) FindByUsername(username string) (*model.User, error) {\n-\tsel := r.newSelect().Columns(\"*\").Where(Like{\"user_name\": username})\n+\tsel := r.newSelect().Columns(\"*\").Where(Expr(\"user_name = ? COLLATE NOCASE\", username))\n \tvar usr model.User\n \terr := r.queryOne(sel, &usr)\n \treturn &usr, err\n@@ -123,10 +124,10 @@ func (r *userRepository) Count(options ...rest.QueryOptions) (int64, error) {\n \tif !usr.IsAdmin {\n \t\treturn 0, rest.ErrPermissionDenied\n \t}\n-\treturn r.CountAll(r.parseRestOptions(options...))\n+\treturn r.CountAll(r.parseRestOptions(r.ctx, options...))\n }\n \n-func (r *userRepository) Read(id string) (interface{}, error) {\n+func (r *userRepository) Read(id string) (any, error) {\n \tusr := loggedUser(r.ctx)\n \tif !usr.IsAdmin && usr.ID != id {\n \t\treturn nil, rest.ErrPermissionDenied\n@@ -138,23 +139,23 @@ func (r *userRepository) Read(id string) (interface{}, error) {\n \treturn usr, err\n }\n \n-func (r *userRepository) ReadAll(options ...rest.QueryOptions) (interface{}, error) {\n+func (r *userRepository) ReadAll(options ...rest.QueryOptions) (any, error) {\n \tusr := loggedUser(r.ctx)\n \tif !usr.IsAdmin {\n \t\treturn nil, rest.ErrPermissionDenied\n \t}\n-\treturn r.GetAll(r.parseRestOptions(options...))\n+\treturn r.GetAll(r.parseRestOptions(r.ctx, options...))\n }\n \n func (r *userRepository) EntityName() string {\n \treturn \"user\"\n }\n \n-func (r *userRepository) NewInstance() interface{} {\n+func (r *userRepository) NewInstance() any {\n \treturn &model.User{}\n }\n \n-func (r *userRepository) Save(entity interface{}) (string, error) {\n+func (r *userRepository) Save(entity any) (string, error) {\n \tusr := loggedUser(r.ctx)\n \tif !usr.IsAdmin {\n \t\treturn \"\", rest.ErrPermissionDenied\n@@ -170,7 +171,7 @@ func (r *userRepository) Save(entity interface{}) (string, error) {\n \treturn u.ID, err\n }\n \n-func (r *userRepository) Update(id string, entity interface{}, cols ...string) error {\n+func (r *userRepository) Update(id string, entity any, _ ...string) error {\n \tu := entity.(*model.User)\n \tu.ID = id\n \tusr := loggedUser(r.ctx)"
            },
            {
                "sha": "9ceef8030d040894cdd26c9cb46cb4d01158ba5c",
                "filename": "ui/src/album/AlbumSongs.js",
                "status": "modified",
                "additions": 1,
                "deletions": 6,
                "changes": 7,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Falbum%2FAlbumSongs.js",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Falbum%2FAlbumSongs.js",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/ui%2Fsrc%2Falbum%2FAlbumSongs.js?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -97,12 +97,7 @@ const AlbumSongs = (props) => {\n   const toggleableFields = useMemo(() => {\n     return {\n       trackNumber: isDesktop && (\n-        <TextField\n-          source=\"trackNumber\"\n-          sortBy=\"releaseDate asc, discNumber asc, trackNumber asc\"\n-          label=\"#\"\n-          sortable={false}\n-        />\n+        <TextField source=\"trackNumber\" label=\"#\" sortable={false} />\n       ),\n       title: (\n         <SongTitleField"
            },
            {
                "sha": "c98242c5152cdfce32ce8840c32a761120c95fb8",
                "filename": "ui/src/album/AlbumTableView.js",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Falbum%2FAlbumTableView.js",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Falbum%2FAlbumTableView.js",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/ui%2Fsrc%2Falbum%2FAlbumTableView.js?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -150,8 +150,7 @@ const AlbumTableView = ({\n       <TextField source=\"name\" />\n       {columns}\n       <AlbumContextMenu\n-        source={'starred'}\n-        sortBy={'starred ASC, starredAt ASC'}\n+        source={'starred_at'}\n         sortByOrder={'DESC'}\n         sortable={config.enableFavourites}\n         className={classes.contextMenu}"
            },
            {
                "sha": "4284c09c12f23cf60acbf79302d32c9ab08b9d52",
                "filename": "ui/src/artist/ArtistList.js",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Fartist%2FArtistList.js",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Fartist%2FArtistList.js",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/ui%2Fsrc%2Fartist%2FArtistList.js?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -145,8 +145,7 @@ const ArtistListView = ({ hasShow, hasEdit, hasList, width, ...rest }) => {\n       <TextField source=\"name\" />\n       {columns}\n       <ArtistContextMenu\n-        source={'starred'}\n-        sortBy={'starred ASC, starredAt ASC'}\n+        source={'starred_at'}\n         sortByOrder={'DESC'}\n         sortable={config.enableFavourites}\n         className={classes.contextMenu}"
            },
            {
                "sha": "6ee5f93caa96679aea40733ea61600d5e95ab5a3",
                "filename": "ui/src/common/ContextMenus.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Fcommon%2FContextMenus.js",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Fcommon%2FContextMenus.js",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/ui%2Fsrc%2Fcommon%2FContextMenus.js?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -203,7 +203,7 @@ export const AlbumContextMenu = (props) =>\n       resource={'album'}\n       songQueryParams={{\n         pagination: { page: 1, perPage: -1 },\n-        sort: { field: 'releaseDate, discNumber, trackNumber', order: 'ASC' },\n+        sort: { field: 'trackNumber', order: 'ASC' },\n         filter: {\n           album_id: props.record.id,\n           release_date: props.releaseDate,\n@@ -234,7 +234,7 @@ export const ArtistContextMenu = (props) =>\n       songQueryParams={{\n         pagination: { page: 1, perPage: 200 },\n         sort: {\n-          field: 'album, releaseDate, discNumber, trackNumber',\n+          field: 'trackNumber',\n           order: 'ASC',\n         },\n         filter: { album_artist_id: props.record.id },"
            },
            {
                "sha": "0df3125a6d00b8f7617279f9434d8f92a3e5d578",
                "filename": "ui/src/common/PlayButton.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Fcommon%2FPlayButton.js",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Fcommon%2FPlayButton.js",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/ui%2Fsrc%2Fcommon%2FPlayButton.js?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -21,7 +21,7 @@ export const PlayButton = ({ record, size, className }) => {\n     dataProvider\n       .getList('song', {\n         pagination: { page: 1, perPage: -1 },\n-        sort: { field: 'releaseDate, discNumber, trackNumber', order: 'ASC' },\n+        sort: { field: 'trackNumber', order: 'ASC' },\n         filter: {\n           album_id: record.id,\n           release_date: record.releaseDate,"
            },
            {
                "sha": "8251ae651e4ffbfe7030b92f28e58829d32f476d",
                "filename": "ui/src/song/SongList.js",
                "status": "modified",
                "additions": 2,
                "deletions": 11,
                "changes": 13,
                "blob_url": "https://github.com/navidrome/navidrome/blob/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Fsong%2FSongList.js",
                "raw_url": "https://github.com/navidrome/navidrome/raw/3107170afd9f557a10f7031f23cb3c9e975a71f9/ui%2Fsrc%2Fsong%2FSongList.js",
                "contents_url": "https://api.github.com/repos/navidrome/navidrome/contents/ui%2Fsrc%2Fsong%2FSongList.js?ref=3107170afd9f557a10f7031f23cb3c9e975a71f9",
                "patch": "@@ -98,15 +98,7 @@ const SongList = (props) => {\n \n   const toggleableFields = React.useMemo(() => {\n     return {\n-      album: isDesktop && (\n-        <AlbumLinkField\n-          source=\"album\"\n-          sortBy={\n-            'album, order_album_artist_name, release_date, disc_number, track_number, title'\n-          }\n-          sortByOrder={'ASC'}\n-        />\n-      ),\n+      album: isDesktop && <AlbumLinkField source=\"album\" sortByOrder={'ASC'} />,\n       artist: <ArtistLinkField source=\"artist\" />,\n       albumArtist: <ArtistLinkField source=\"albumArtist\" />,\n       trackNumber: isDesktop && <NumberField source=\"trackNumber\" />,\n@@ -179,8 +171,7 @@ const SongList = (props) => {\n             <SongTitleField source=\"title\" showTrackNumbers={false} />\n             {columns}\n             <SongContextMenu\n-              source={'starred'}\n-              sortBy={'starred ASC, starredAt ASC'}\n+              source={'starred_at'}\n               sortByOrder={'DESC'}\n               sortable={config.enableFavourites}\n               className={classes.contextMenu}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dragonflyoss/Dragonfly2/commits/e9da69dc4048bf2a18a671be94616d85e3429433",
        "url": "https://api.github.com/repos/dragonflyoss/dragonfly/commits/e9da69dc4048bf2a18a671be94616d85e3429433",
        "html_url": "https://github.com/dragonflyoss/dragonfly/commit/e9da69dc4048bf2a18a671be94616d85e3429433",
        "message": "feat: add auth config to manager (#2161)\n\nFix https://github.com/dragonflyoss/Dragonfly2/security/advisories/GHSA-hpc8-7wpm-889w.\r\n\r\nSigned-off-by: Gaius <gaius.qi@gmail.com>",
        "files": [
            {
                "sha": "4a193e7e9edf874118d1843478e2fce5890833ce",
                "filename": "deploy/docker-compose/template/manager.template.yaml",
                "status": "modified",
                "additions": 15,
                "deletions": 0,
                "changes": 15,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/e9da69dc4048bf2a18a671be94616d85e3429433/deploy%2Fdocker-compose%2Ftemplate%2Fmanager.template.yaml",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/e9da69dc4048bf2a18a671be94616d85e3429433/deploy%2Fdocker-compose%2Ftemplate%2Fmanager.template.yaml",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/deploy%2Fdocker-compose%2Ftemplate%2Fmanager.template.yaml?ref=e9da69dc4048bf2a18a671be94616d85e3429433",
                "patch": "@@ -32,6 +32,21 @@ server:\n   # In macos(just for testing), default value is /Users/$USER/.dragonfly/plugins.\n   pluginDir: ''\n \n+auth:\n+  jwt:\n+    # Realm name to display to the user, default value is Dragonfly.\n+    realm: \"Dragonfly\"\n+    # Key is secret key used for signing, default value is\n+    # encoded base64 of dragonfly.\n+    # Please change the key in production.\n+    key: \"ZHJhZ29uZmx5Cg==\"\n+    # Timeout is duration that a jwt token is valid,\n+    # default duration is two days.\n+    timeout: 48h\n+    # MaxRefresh field allows clients to refresh their token\n+    # until MaxRefresh has passed, default duration is two days.\n+    maxRefresh: 48h\n+\n # Database info used for server.\n database:\n   # Database type, supported types include mysql, mariadb and postgres."
            },
            {
                "sha": "1608dd49248269497c44e0112e48540be9f04a9e",
                "filename": "deploy/helm-charts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": null,
                "raw_url": null,
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/deploy%2Fhelm-charts?ref=e9da69dc4048bf2a18a671be94616d85e3429433",
                "patch": "@@ -1 +1 @@\n-Subproject commit be86afe69937a54f9f94c75be986a74ce4dbc2c0\n+Subproject commit 1608dd49248269497c44e0112e48540be9f04a9e"
            },
            {
                "sha": "5f66364af5575c7911feb3bf9318ab65274835d2",
                "filename": "manager/config/config.go",
                "status": "modified",
                "additions": 45,
                "deletions": 0,
                "changes": 45,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fconfig%2Fconfig.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fconfig%2Fconfig.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fconfig%2Fconfig.go?ref=e9da69dc4048bf2a18a671be94616d85e3429433",
                "patch": "@@ -37,6 +37,9 @@ type Config struct {\n \t// Server configuration.\n \tServer ServerConfig `yaml:\"server\" mapstructure:\"server\"`\n \n+\t// Auth configuration.\n+\tAuth AuthConfig `yaml:\"auth\" mapstructure:\"auth\"`\n+\n \t// Database configuration.\n \tDatabase DatabaseConfig `yaml:\"database\" mapstructure:\"database\"`\n \n@@ -79,6 +82,25 @@ type ServerConfig struct {\n \tREST RestConfig `yaml:\"rest\" mapstructure:\"rest\"`\n }\n \n+type AuthConfig struct {\n+\t// JWT configuration.\n+\tJWT JWTConfig `yaml:\"jwt\" mapstructure:\"jwt\"`\n+}\n+\n+type JWTConfig struct {\n+\t// Realm name to display to the user, default value is Dragonfly.\n+\tRealm string `yaml:\"realm\" mapstructure:\"realm\"`\n+\n+\t// Key is secret key used for signing. Please change the key in production\n+\tKey string `yaml:\"key\" mapstructure:\"key\"`\n+\n+\t// Timeout is duration that a jwt token is valid, default duration is two days.\n+\tTimeout time.Duration `yaml:\"timeout\" mapstructure:\"timeout\"`\n+\n+\t// MaxRefresh field allows clients to refresh their token until MaxRefresh has passed, default duration is two days.\n+\tMaxRefresh time.Duration `yaml:\"maxRefresh\" mapstructure:\"maxRefresh\"`\n+}\n+\n type DatabaseConfig struct {\n \t// Database type.\n \tType string `yaml:\"type\" mapstructure:\"type\"`\n@@ -324,6 +346,13 @@ func New() *Config {\n \t\t\t\tAddr: DefaultRESTAddr,\n \t\t\t},\n \t\t},\n+\t\tAuth: AuthConfig{\n+\t\t\tJWT: JWTConfig{\n+\t\t\t\tRealm:      DefaultJWTRealm,\n+\t\t\t\tTimeout:    DefaultJWTTimeout,\n+\t\t\t\tMaxRefresh: DefaultJWTMaxRefresh,\n+\t\t\t},\n+\t\t},\n \t\tDatabase: DatabaseConfig{\n \t\t\tType: DatabaseTypeMysql,\n \t\t\tMysql: MysqlConfig{\n@@ -391,6 +420,22 @@ func (cfg *Config) Validate() error {\n \t\treturn errors.New(\"grpc requires parameter listenIP\")\n \t}\n \n+\tif cfg.Auth.JWT.Realm == \"\" {\n+\t\treturn errors.New(\"jwt requires parameter realm\")\n+\t}\n+\n+\tif cfg.Auth.JWT.Key == \"\" {\n+\t\treturn errors.New(\"jwt requires parameter key\")\n+\t}\n+\n+\tif cfg.Auth.JWT.Timeout == 0 {\n+\t\treturn errors.New(\"jwt requires parameter timeout\")\n+\t}\n+\n+\tif cfg.Auth.JWT.MaxRefresh == 0 {\n+\t\treturn errors.New(\"jwt requires parameter maxRefresh\")\n+\t}\n+\n \tif cfg.Database.Type == \"\" {\n \t\treturn errors.New(\"database requires parameter type\")\n \t}"
            },
            {
                "sha": "d1aff9952353100c2c2da01fcee7fc4a0b04e4b8",
                "filename": "manager/config/config_test.go",
                "status": "modified",
                "additions": 96,
                "deletions": 0,
                "changes": 96,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fconfig%2Fconfig_test.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fconfig%2Fconfig_test.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fconfig%2Fconfig_test.go?ref=e9da69dc4048bf2a18a671be94616d85e3429433",
                "patch": "@@ -31,6 +31,13 @@ import (\n )\n \n var (\n+\tmockJWTConfig = JWTConfig{\n+\t\tRealm:      \"foo\",\n+\t\tKey:        \"bar\",\n+\t\tTimeout:    30 * time.Second,\n+\t\tMaxRefresh: 1 * time.Minute,\n+\t}\n+\n \tmockMysqlConfig = MysqlConfig{\n \t\tUser:      \"foo\",\n \t\tPassword:  \"bar\",\n@@ -118,6 +125,14 @@ func TestConfig_Load(t *testing.T) {\n \t\t\t\tAddr: \":8080\",\n \t\t\t},\n \t\t},\n+\t\tAuth: AuthConfig{\n+\t\t\tJWT: JWTConfig{\n+\t\t\t\tRealm:      \"foo\",\n+\t\t\t\tKey:        \"bar\",\n+\t\t\t\tTimeout:    30 * time.Second,\n+\t\t\t\tMaxRefresh: 1 * time.Minute,\n+\t\t\t},\n+\t\t},\n \t\tDatabase: DatabaseConfig{\n \t\t\tType: \"mysql\",\n \t\t\tMysql: MysqlConfig{\n@@ -216,6 +231,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"valid config\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n \t\t\t},\n@@ -257,10 +273,57 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\t\tassert.EqualError(err, \"grpc requires parameter listenIP\")\n \t\t\t},\n \t\t},\n+\t\t{\n+\t\t\tname:   \"jwt requires parameter realm\",\n+\t\t\tconfig: New(),\n+\t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT.Realm = \"\"\n+\t\t\t},\n+\t\t\texpect: func(t *testing.T, err error) {\n+\t\t\t\tassert := assert.New(t)\n+\t\t\t\tassert.EqualError(err, \"jwt requires parameter realm\")\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname:   \"jwt requires parameter key\",\n+\t\t\tconfig: New(),\n+\t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT.Key = \"\"\n+\t\t\t},\n+\t\t\texpect: func(t *testing.T, err error) {\n+\t\t\t\tassert := assert.New(t)\n+\t\t\t\tassert.EqualError(err, \"jwt requires parameter key\")\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname:   \"jwt requires parameter timeout\",\n+\t\t\tconfig: New(),\n+\t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n+\t\t\t\tcfg.Auth.JWT.Timeout = 0\n+\t\t\t},\n+\t\t\texpect: func(t *testing.T, err error) {\n+\t\t\t\tassert := assert.New(t)\n+\t\t\t\tassert.EqualError(err, \"jwt requires parameter timeout\")\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname:   \"jwt requires parameter maxRefresh\",\n+\t\t\tconfig: New(),\n+\t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n+\t\t\t\tcfg.Auth.JWT.MaxRefresh = 0\n+\t\t\t},\n+\t\t\texpect: func(t *testing.T, err error) {\n+\t\t\t\tassert := assert.New(t)\n+\t\t\t\tassert.EqualError(err, \"jwt requires parameter maxRefresh\")\n+\t\t\t},\n+\t\t},\n \t\t{\n \t\t\tname:   \"database requires parameter type\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = \"\"\n \t\t\t},\n \t\t\texpect: func(t *testing.T, err error) {\n@@ -272,6 +335,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter user\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.User = \"\"\n@@ -285,6 +349,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter password\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.Password = \"\"\n@@ -298,6 +363,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter host\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.Host = \"\"\n@@ -311,6 +377,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter port\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.Port = 0\n@@ -324,6 +391,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter dbname\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.DBName = \"\"\n@@ -337,6 +405,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"tls requires parameter cert\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.TLS = mockMysqlTLSConfig\n@@ -351,6 +420,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"tls requires parameter key\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.TLS = mockMysqlTLSConfig\n@@ -366,6 +436,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"tls requires parameter ca\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.TLS = mockMysqlTLSConfig\n@@ -382,6 +453,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter user\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.User = \"\"\n@@ -395,6 +467,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter password\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.Password = \"\"\n@@ -408,6 +481,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter host\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.Host = \"\"\n@@ -421,6 +495,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter port\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.Port = 0\n@@ -434,6 +509,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter dbname\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.DBName = \"\"\n@@ -447,6 +523,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter sslMode\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.SSLMode = \"\"\n@@ -460,6 +537,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter timezone\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.Timezone = \"\"\n@@ -473,6 +551,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter addrs\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -487,6 +566,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter db\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -501,6 +581,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter brokerDB\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -515,6 +596,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter backendDB\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -529,6 +611,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter ttl\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -543,6 +626,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"local requires parameter size\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -557,6 +641,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"local requires parameter ttl\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -571,6 +656,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"objectStorage requires parameter name\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -586,6 +672,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"invalid objectStorage name\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -601,6 +688,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"objectStorage requires parameter accessKey\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -616,6 +704,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"objectStorage requires parameter secretKey\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -631,6 +720,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"metrics requires parameter addr\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -646,6 +736,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"security requires parameter caCert\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -661,6 +752,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"security requires parameter caKey\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -676,6 +768,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"security requires parameter tlsPolicy\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -691,6 +784,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"certSpec requires parameter ipAddresses\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -706,6 +800,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"certSpec requires parameter dnsNames\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -721,6 +816,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"certSpec requires parameter validityPeriod\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig"
            },
            {
                "sha": "507d60c167426bab3be6a53ccf1e52a3033cff35",
                "filename": "manager/config/constants.go",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fconfig%2Fconstants.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fconfig%2Fconstants.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fconfig%2Fconstants.go?ref=e9da69dc4048bf2a18a671be94616d85e3429433",
                "patch": "@@ -45,6 +45,17 @@ const (\n \tDefaultRESTAddr = \":8080\"\n )\n \n+const (\n+\t// DefaultJWTTimeout is default of name in jwt.\n+\tDefaultJWTRealm = \"Dragonfly\"\n+\n+\t// DefaultJWTTimeout is default of timeout in jwt.\n+\tDefaultJWTTimeout = 2 * 24 * time.Hour\n+\n+\t// DefaultJWTMaxRefresh is default of max refresh in jwt.\n+\tDefaultJWTMaxRefresh = 2 * 24 * time.Hour\n+)\n+\n const (\n \t// DefaultRedisDB is default db for redis.\n \tDefaultRedisDB = 0"
            },
            {
                "sha": "844e4fca58c39699d39e484ad9b6e10ec023c221",
                "filename": "manager/config/testdata/manager.yaml",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fconfig%2Ftestdata%2Fmanager.yaml",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fconfig%2Ftestdata%2Fmanager.yaml",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fconfig%2Ftestdata%2Fmanager.yaml?ref=e9da69dc4048bf2a18a671be94616d85e3429433",
                "patch": "@@ -13,6 +13,13 @@ server:\n   rest:\n     addr: :8080\n \n+auth:\n+  jwt:\n+    realm: foo\n+    key: bar\n+    timeout: 30s\n+    maxRefresh: 1m\n+\n database:\n   type: mysql\n   mysql:"
            },
            {
                "sha": "bf8bb12e9a65411ee5973fb4e48d6f9d2b6b3d29",
                "filename": "manager/middlewares/jwt.go",
                "status": "modified",
                "additions": 13,
                "deletions": 9,
                "changes": 22,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fmiddlewares%2Fjwt.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Fmiddlewares%2Fjwt.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fmiddlewares%2Fjwt.go?ref=e9da69dc4048bf2a18a671be94616d85e3429433",
                "patch": "@@ -24,25 +24,29 @@ import (\n \tjwt \"github.com/appleboy/gin-jwt/v2\"\n \t\"github.com/gin-gonic/gin\"\n \n+\t\"d7y.io/dragonfly/v2/manager/config\"\n \t\"d7y.io/dragonfly/v2/manager/model\"\n \t\"d7y.io/dragonfly/v2/manager/service\"\n \t\"d7y.io/dragonfly/v2/manager/types\"\n )\n \n-func Jwt(service service.Service) (*jwt.GinJWTMiddleware, error) {\n-\tidentityKey := \"id\"\n+const (\n+\t// defaultIdentityKey is default of the identity key.\n+\tdefaultIdentityKey = \"id\"\n+)\n \n+func Jwt(cfg config.JWTConfig, service service.Service) (*jwt.GinJWTMiddleware, error) {\n \tauthMiddleware, err := jwt.New(&jwt.GinJWTMiddleware{\n-\t\tRealm:       \"Dragonfly\",\n-\t\tKey:         []byte(\"Secret Key\"),\n-\t\tTimeout:     2 * 24 * time.Hour,\n-\t\tMaxRefresh:  2 * 24 * time.Hour,\n-\t\tIdentityKey: identityKey,\n+\t\tRealm:       cfg.Realm,\n+\t\tKey:         []byte(cfg.Key),\n+\t\tTimeout:     cfg.Timeout,\n+\t\tMaxRefresh:  cfg.MaxRefresh,\n+\t\tIdentityKey: defaultIdentityKey,\n \n \t\tIdentityHandler: func(c *gin.Context) any {\n \t\t\tclaims := jwt.ExtractClaims(c)\n \n-\t\t\tid, ok := claims[identityKey]\n+\t\t\tid, ok := claims[defaultIdentityKey]\n \t\t\tif !ok {\n \t\t\t\tc.JSON(http.StatusUnauthorized, gin.H{\n \t\t\t\t\t\"message\": \"Unavailable token: require user id\",\n@@ -82,7 +86,7 @@ func Jwt(service service.Service) (*jwt.GinJWTMiddleware, error) {\n \t\tPayloadFunc: func(data any) jwt.MapClaims {\n \t\t\tif user, ok := data.(*model.User); ok {\n \t\t\t\treturn jwt.MapClaims{\n-\t\t\t\t\tidentityKey: user.ID,\n+\t\t\t\t\tdefaultIdentityKey: user.ID,\n \t\t\t\t}\n \t\t\t}\n "
            },
            {
                "sha": "85e082f9b4b41685ce4ff40187d2db09e229d0b3",
                "filename": "manager/router/router.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Frouter%2Frouter.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/e9da69dc4048bf2a18a671be94616d85e3429433/manager%2Frouter%2Frouter.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Frouter%2Frouter.go?ref=e9da69dc4048bf2a18a671be94616d85e3429433",
                "patch": "@@ -78,7 +78,7 @@ func Init(cfg *config.Config, logDir string, service service.Service, enforcer *\n \tr.Use(cors.New(corsConfig))\n \n \trbac := middlewares.RBAC(enforcer)\n-\tjwt, err := middlewares.Jwt(service)\n+\tjwt, err := middlewares.Jwt(cfg.Auth.JWT, service)\n \tif err != nil {\n \t\treturn nil, err\n \t}"
            },
            {
                "sha": "96850f3230b7bd9250bcd919e018c262f508d098",
                "filename": "test/testdata/charts/config-nydus.yaml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/e9da69dc4048bf2a18a671be94616d85e3429433/test%2Ftestdata%2Fcharts%2Fconfig-nydus.yaml",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/e9da69dc4048bf2a18a671be94616d85e3429433/test%2Ftestdata%2Fcharts%2Fconfig-nydus.yaml",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/test%2Ftestdata%2Fcharts%2Fconfig-nydus.yaml?ref=e9da69dc4048bf2a18a671be94616d85e3429433",
                "patch": "@@ -12,7 +12,7 @@ resources:\n dragonfly:\n   enable: true\n   mirrorConfig:\n-    host: \"http://127.0.0.1:65001\"\n+  - host: \"http://127.0.0.1:65001\"\n     auth_through: false\n     headers:\n       \"X-Dragonfly-Registry\": \"https://ghcr.io\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dragonflyoss/dragonfly/commits/684469a31bd27d38c715c507bca9f6d2c21f9007",
        "url": "https://api.github.com/repos/dragonflyoss/dragonfly/commits/684469a31bd27d38c715c507bca9f6d2c21f9007",
        "html_url": "https://github.com/dragonflyoss/dragonfly/commit/684469a31bd27d38c715c507bca9f6d2c21f9007",
        "message": "feat: add auth config to manager (#2161)\n\nFix https://github.com/dragonflyoss/Dragonfly2/security/advisories/GHSA-hpc8-7wpm-889w.\r\n\r\nSigned-off-by: Gaius <gaius.qi@gmail.com>",
        "files": [
            {
                "sha": "4a193e7e9edf874118d1843478e2fce5890833ce",
                "filename": "deploy/docker-compose/template/manager.template.yaml",
                "status": "modified",
                "additions": 15,
                "deletions": 0,
                "changes": 15,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/684469a31bd27d38c715c507bca9f6d2c21f9007/deploy%2Fdocker-compose%2Ftemplate%2Fmanager.template.yaml",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/684469a31bd27d38c715c507bca9f6d2c21f9007/deploy%2Fdocker-compose%2Ftemplate%2Fmanager.template.yaml",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/deploy%2Fdocker-compose%2Ftemplate%2Fmanager.template.yaml?ref=684469a31bd27d38c715c507bca9f6d2c21f9007",
                "patch": "@@ -32,6 +32,21 @@ server:\n   # In macos(just for testing), default value is /Users/$USER/.dragonfly/plugins.\n   pluginDir: ''\n \n+auth:\n+  jwt:\n+    # Realm name to display to the user, default value is Dragonfly.\n+    realm: \"Dragonfly\"\n+    # Key is secret key used for signing, default value is\n+    # encoded base64 of dragonfly.\n+    # Please change the key in production.\n+    key: \"ZHJhZ29uZmx5Cg==\"\n+    # Timeout is duration that a jwt token is valid,\n+    # default duration is two days.\n+    timeout: 48h\n+    # MaxRefresh field allows clients to refresh their token\n+    # until MaxRefresh has passed, default duration is two days.\n+    maxRefresh: 48h\n+\n # Database info used for server.\n database:\n   # Database type, supported types include mysql, mariadb and postgres."
            },
            {
                "sha": "1608dd49248269497c44e0112e48540be9f04a9e",
                "filename": "deploy/helm-charts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": null,
                "raw_url": null,
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/deploy%2Fhelm-charts?ref=684469a31bd27d38c715c507bca9f6d2c21f9007",
                "patch": "@@ -1 +1 @@\n-Subproject commit be86afe69937a54f9f94c75be986a74ce4dbc2c0\n+Subproject commit 1608dd49248269497c44e0112e48540be9f04a9e"
            },
            {
                "sha": "5f66364af5575c7911feb3bf9318ab65274835d2",
                "filename": "manager/config/config.go",
                "status": "modified",
                "additions": 45,
                "deletions": 0,
                "changes": 45,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fconfig%2Fconfig.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fconfig%2Fconfig.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fconfig%2Fconfig.go?ref=684469a31bd27d38c715c507bca9f6d2c21f9007",
                "patch": "@@ -37,6 +37,9 @@ type Config struct {\n \t// Server configuration.\n \tServer ServerConfig `yaml:\"server\" mapstructure:\"server\"`\n \n+\t// Auth configuration.\n+\tAuth AuthConfig `yaml:\"auth\" mapstructure:\"auth\"`\n+\n \t// Database configuration.\n \tDatabase DatabaseConfig `yaml:\"database\" mapstructure:\"database\"`\n \n@@ -79,6 +82,25 @@ type ServerConfig struct {\n \tREST RestConfig `yaml:\"rest\" mapstructure:\"rest\"`\n }\n \n+type AuthConfig struct {\n+\t// JWT configuration.\n+\tJWT JWTConfig `yaml:\"jwt\" mapstructure:\"jwt\"`\n+}\n+\n+type JWTConfig struct {\n+\t// Realm name to display to the user, default value is Dragonfly.\n+\tRealm string `yaml:\"realm\" mapstructure:\"realm\"`\n+\n+\t// Key is secret key used for signing. Please change the key in production\n+\tKey string `yaml:\"key\" mapstructure:\"key\"`\n+\n+\t// Timeout is duration that a jwt token is valid, default duration is two days.\n+\tTimeout time.Duration `yaml:\"timeout\" mapstructure:\"timeout\"`\n+\n+\t// MaxRefresh field allows clients to refresh their token until MaxRefresh has passed, default duration is two days.\n+\tMaxRefresh time.Duration `yaml:\"maxRefresh\" mapstructure:\"maxRefresh\"`\n+}\n+\n type DatabaseConfig struct {\n \t// Database type.\n \tType string `yaml:\"type\" mapstructure:\"type\"`\n@@ -324,6 +346,13 @@ func New() *Config {\n \t\t\t\tAddr: DefaultRESTAddr,\n \t\t\t},\n \t\t},\n+\t\tAuth: AuthConfig{\n+\t\t\tJWT: JWTConfig{\n+\t\t\t\tRealm:      DefaultJWTRealm,\n+\t\t\t\tTimeout:    DefaultJWTTimeout,\n+\t\t\t\tMaxRefresh: DefaultJWTMaxRefresh,\n+\t\t\t},\n+\t\t},\n \t\tDatabase: DatabaseConfig{\n \t\t\tType: DatabaseTypeMysql,\n \t\t\tMysql: MysqlConfig{\n@@ -391,6 +420,22 @@ func (cfg *Config) Validate() error {\n \t\treturn errors.New(\"grpc requires parameter listenIP\")\n \t}\n \n+\tif cfg.Auth.JWT.Realm == \"\" {\n+\t\treturn errors.New(\"jwt requires parameter realm\")\n+\t}\n+\n+\tif cfg.Auth.JWT.Key == \"\" {\n+\t\treturn errors.New(\"jwt requires parameter key\")\n+\t}\n+\n+\tif cfg.Auth.JWT.Timeout == 0 {\n+\t\treturn errors.New(\"jwt requires parameter timeout\")\n+\t}\n+\n+\tif cfg.Auth.JWT.MaxRefresh == 0 {\n+\t\treturn errors.New(\"jwt requires parameter maxRefresh\")\n+\t}\n+\n \tif cfg.Database.Type == \"\" {\n \t\treturn errors.New(\"database requires parameter type\")\n \t}"
            },
            {
                "sha": "d1aff9952353100c2c2da01fcee7fc4a0b04e4b8",
                "filename": "manager/config/config_test.go",
                "status": "modified",
                "additions": 96,
                "deletions": 0,
                "changes": 96,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fconfig%2Fconfig_test.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fconfig%2Fconfig_test.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fconfig%2Fconfig_test.go?ref=684469a31bd27d38c715c507bca9f6d2c21f9007",
                "patch": "@@ -31,6 +31,13 @@ import (\n )\n \n var (\n+\tmockJWTConfig = JWTConfig{\n+\t\tRealm:      \"foo\",\n+\t\tKey:        \"bar\",\n+\t\tTimeout:    30 * time.Second,\n+\t\tMaxRefresh: 1 * time.Minute,\n+\t}\n+\n \tmockMysqlConfig = MysqlConfig{\n \t\tUser:      \"foo\",\n \t\tPassword:  \"bar\",\n@@ -118,6 +125,14 @@ func TestConfig_Load(t *testing.T) {\n \t\t\t\tAddr: \":8080\",\n \t\t\t},\n \t\t},\n+\t\tAuth: AuthConfig{\n+\t\t\tJWT: JWTConfig{\n+\t\t\t\tRealm:      \"foo\",\n+\t\t\t\tKey:        \"bar\",\n+\t\t\t\tTimeout:    30 * time.Second,\n+\t\t\t\tMaxRefresh: 1 * time.Minute,\n+\t\t\t},\n+\t\t},\n \t\tDatabase: DatabaseConfig{\n \t\t\tType: \"mysql\",\n \t\t\tMysql: MysqlConfig{\n@@ -216,6 +231,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"valid config\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n \t\t\t},\n@@ -257,10 +273,57 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\t\tassert.EqualError(err, \"grpc requires parameter listenIP\")\n \t\t\t},\n \t\t},\n+\t\t{\n+\t\t\tname:   \"jwt requires parameter realm\",\n+\t\t\tconfig: New(),\n+\t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT.Realm = \"\"\n+\t\t\t},\n+\t\t\texpect: func(t *testing.T, err error) {\n+\t\t\t\tassert := assert.New(t)\n+\t\t\t\tassert.EqualError(err, \"jwt requires parameter realm\")\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname:   \"jwt requires parameter key\",\n+\t\t\tconfig: New(),\n+\t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT.Key = \"\"\n+\t\t\t},\n+\t\t\texpect: func(t *testing.T, err error) {\n+\t\t\t\tassert := assert.New(t)\n+\t\t\t\tassert.EqualError(err, \"jwt requires parameter key\")\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname:   \"jwt requires parameter timeout\",\n+\t\t\tconfig: New(),\n+\t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n+\t\t\t\tcfg.Auth.JWT.Timeout = 0\n+\t\t\t},\n+\t\t\texpect: func(t *testing.T, err error) {\n+\t\t\t\tassert := assert.New(t)\n+\t\t\t\tassert.EqualError(err, \"jwt requires parameter timeout\")\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname:   \"jwt requires parameter maxRefresh\",\n+\t\t\tconfig: New(),\n+\t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n+\t\t\t\tcfg.Auth.JWT.MaxRefresh = 0\n+\t\t\t},\n+\t\t\texpect: func(t *testing.T, err error) {\n+\t\t\t\tassert := assert.New(t)\n+\t\t\t\tassert.EqualError(err, \"jwt requires parameter maxRefresh\")\n+\t\t\t},\n+\t\t},\n \t\t{\n \t\t\tname:   \"database requires parameter type\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = \"\"\n \t\t\t},\n \t\t\texpect: func(t *testing.T, err error) {\n@@ -272,6 +335,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter user\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.User = \"\"\n@@ -285,6 +349,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter password\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.Password = \"\"\n@@ -298,6 +363,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter host\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.Host = \"\"\n@@ -311,6 +377,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter port\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.Port = 0\n@@ -324,6 +391,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"mysql requires parameter dbname\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.DBName = \"\"\n@@ -337,6 +405,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"tls requires parameter cert\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.TLS = mockMysqlTLSConfig\n@@ -351,6 +420,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"tls requires parameter key\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.TLS = mockMysqlTLSConfig\n@@ -366,6 +436,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"tls requires parameter ca\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Mysql.TLS = mockMysqlTLSConfig\n@@ -382,6 +453,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter user\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.User = \"\"\n@@ -395,6 +467,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter password\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.Password = \"\"\n@@ -408,6 +481,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter host\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.Host = \"\"\n@@ -421,6 +495,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter port\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.Port = 0\n@@ -434,6 +509,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter dbname\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.DBName = \"\"\n@@ -447,6 +523,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter sslMode\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.SSLMode = \"\"\n@@ -460,6 +537,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"postgres requires parameter timezone\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypePostgres\n \t\t\t\tcfg.Database.Postgres = mockPostgresConfig\n \t\t\t\tcfg.Database.Postgres.Timezone = \"\"\n@@ -473,6 +551,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter addrs\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -487,6 +566,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter db\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -501,6 +581,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter brokerDB\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -515,6 +596,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter backendDB\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -529,6 +611,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"redis requires parameter ttl\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -543,6 +626,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"local requires parameter size\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -557,6 +641,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"local requires parameter ttl\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -571,6 +656,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"objectStorage requires parameter name\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -586,6 +672,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"invalid objectStorage name\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -601,6 +688,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"objectStorage requires parameter accessKey\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -616,6 +704,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"objectStorage requires parameter secretKey\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -631,6 +720,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"metrics requires parameter addr\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -646,6 +736,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"security requires parameter caCert\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -661,6 +752,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"security requires parameter caKey\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -676,6 +768,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"security requires parameter tlsPolicy\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -691,6 +784,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"certSpec requires parameter ipAddresses\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -706,6 +800,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"certSpec requires parameter dnsNames\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig\n@@ -721,6 +816,7 @@ func TestConfig_Validate(t *testing.T) {\n \t\t\tname:   \"certSpec requires parameter validityPeriod\",\n \t\t\tconfig: New(),\n \t\t\tmock: func(cfg *Config) {\n+\t\t\t\tcfg.Auth.JWT = mockJWTConfig\n \t\t\t\tcfg.Database.Type = DatabaseTypeMysql\n \t\t\t\tcfg.Database.Mysql = mockMysqlConfig\n \t\t\t\tcfg.Database.Redis = mockRedisConfig"
            },
            {
                "sha": "507d60c167426bab3be6a53ccf1e52a3033cff35",
                "filename": "manager/config/constants.go",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fconfig%2Fconstants.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fconfig%2Fconstants.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fconfig%2Fconstants.go?ref=684469a31bd27d38c715c507bca9f6d2c21f9007",
                "patch": "@@ -45,6 +45,17 @@ const (\n \tDefaultRESTAddr = \":8080\"\n )\n \n+const (\n+\t// DefaultJWTTimeout is default of name in jwt.\n+\tDefaultJWTRealm = \"Dragonfly\"\n+\n+\t// DefaultJWTTimeout is default of timeout in jwt.\n+\tDefaultJWTTimeout = 2 * 24 * time.Hour\n+\n+\t// DefaultJWTMaxRefresh is default of max refresh in jwt.\n+\tDefaultJWTMaxRefresh = 2 * 24 * time.Hour\n+)\n+\n const (\n \t// DefaultRedisDB is default db for redis.\n \tDefaultRedisDB = 0"
            },
            {
                "sha": "844e4fca58c39699d39e484ad9b6e10ec023c221",
                "filename": "manager/config/testdata/manager.yaml",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fconfig%2Ftestdata%2Fmanager.yaml",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fconfig%2Ftestdata%2Fmanager.yaml",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fconfig%2Ftestdata%2Fmanager.yaml?ref=684469a31bd27d38c715c507bca9f6d2c21f9007",
                "patch": "@@ -13,6 +13,13 @@ server:\n   rest:\n     addr: :8080\n \n+auth:\n+  jwt:\n+    realm: foo\n+    key: bar\n+    timeout: 30s\n+    maxRefresh: 1m\n+\n database:\n   type: mysql\n   mysql:"
            },
            {
                "sha": "bf8bb12e9a65411ee5973fb4e48d6f9d2b6b3d29",
                "filename": "manager/middlewares/jwt.go",
                "status": "modified",
                "additions": 13,
                "deletions": 9,
                "changes": 22,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fmiddlewares%2Fjwt.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Fmiddlewares%2Fjwt.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Fmiddlewares%2Fjwt.go?ref=684469a31bd27d38c715c507bca9f6d2c21f9007",
                "patch": "@@ -24,25 +24,29 @@ import (\n \tjwt \"github.com/appleboy/gin-jwt/v2\"\n \t\"github.com/gin-gonic/gin\"\n \n+\t\"d7y.io/dragonfly/v2/manager/config\"\n \t\"d7y.io/dragonfly/v2/manager/model\"\n \t\"d7y.io/dragonfly/v2/manager/service\"\n \t\"d7y.io/dragonfly/v2/manager/types\"\n )\n \n-func Jwt(service service.Service) (*jwt.GinJWTMiddleware, error) {\n-\tidentityKey := \"id\"\n+const (\n+\t// defaultIdentityKey is default of the identity key.\n+\tdefaultIdentityKey = \"id\"\n+)\n \n+func Jwt(cfg config.JWTConfig, service service.Service) (*jwt.GinJWTMiddleware, error) {\n \tauthMiddleware, err := jwt.New(&jwt.GinJWTMiddleware{\n-\t\tRealm:       \"Dragonfly\",\n-\t\tKey:         []byte(\"Secret Key\"),\n-\t\tTimeout:     2 * 24 * time.Hour,\n-\t\tMaxRefresh:  2 * 24 * time.Hour,\n-\t\tIdentityKey: identityKey,\n+\t\tRealm:       cfg.Realm,\n+\t\tKey:         []byte(cfg.Key),\n+\t\tTimeout:     cfg.Timeout,\n+\t\tMaxRefresh:  cfg.MaxRefresh,\n+\t\tIdentityKey: defaultIdentityKey,\n \n \t\tIdentityHandler: func(c *gin.Context) any {\n \t\t\tclaims := jwt.ExtractClaims(c)\n \n-\t\t\tid, ok := claims[identityKey]\n+\t\t\tid, ok := claims[defaultIdentityKey]\n \t\t\tif !ok {\n \t\t\t\tc.JSON(http.StatusUnauthorized, gin.H{\n \t\t\t\t\t\"message\": \"Unavailable token: require user id\",\n@@ -82,7 +86,7 @@ func Jwt(service service.Service) (*jwt.GinJWTMiddleware, error) {\n \t\tPayloadFunc: func(data any) jwt.MapClaims {\n \t\t\tif user, ok := data.(*model.User); ok {\n \t\t\t\treturn jwt.MapClaims{\n-\t\t\t\t\tidentityKey: user.ID,\n+\t\t\t\t\tdefaultIdentityKey: user.ID,\n \t\t\t\t}\n \t\t\t}\n "
            },
            {
                "sha": "85e082f9b4b41685ce4ff40187d2db09e229d0b3",
                "filename": "manager/router/router.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Frouter%2Frouter.go",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/684469a31bd27d38c715c507bca9f6d2c21f9007/manager%2Frouter%2Frouter.go",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/manager%2Frouter%2Frouter.go?ref=684469a31bd27d38c715c507bca9f6d2c21f9007",
                "patch": "@@ -78,7 +78,7 @@ func Init(cfg *config.Config, logDir string, service service.Service, enforcer *\n \tr.Use(cors.New(corsConfig))\n \n \trbac := middlewares.RBAC(enforcer)\n-\tjwt, err := middlewares.Jwt(service)\n+\tjwt, err := middlewares.Jwt(cfg.Auth.JWT, service)\n \tif err != nil {\n \t\treturn nil, err\n \t}"
            },
            {
                "sha": "96850f3230b7bd9250bcd919e018c262f508d098",
                "filename": "test/testdata/charts/config-nydus.yaml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/dragonflyoss/dragonfly/blob/684469a31bd27d38c715c507bca9f6d2c21f9007/test%2Ftestdata%2Fcharts%2Fconfig-nydus.yaml",
                "raw_url": "https://github.com/dragonflyoss/dragonfly/raw/684469a31bd27d38c715c507bca9f6d2c21f9007/test%2Ftestdata%2Fcharts%2Fconfig-nydus.yaml",
                "contents_url": "https://api.github.com/repos/dragonflyoss/dragonfly/contents/test%2Ftestdata%2Fcharts%2Fconfig-nydus.yaml?ref=684469a31bd27d38c715c507bca9f6d2c21f9007",
                "patch": "@@ -12,7 +12,7 @@ resources:\n dragonfly:\n   enable: true\n   mirrorConfig:\n-    host: \"http://127.0.0.1:65001\"\n+  - host: \"http://127.0.0.1:65001\"\n     auth_through: false\n     headers:\n       \"X-Dragonfly-Registry\": \"https://ghcr.io\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/traefik/traefik/commits/584144100524277829f26219baaab29a53b8134f",
        "url": "https://api.github.com/repos/traefik/traefik/commits/584144100524277829f26219baaab29a53b8134f",
        "html_url": "https://github.com/traefik/traefik/commit/584144100524277829f26219baaab29a53b8134f",
        "message": "Cleanup Connection headers before passing the middleware chain\n\nCo-authored-by: Romain <rtribotte@users.noreply.github.com>",
        "files": [
            {
                "sha": "540ff8ad08d99af6561649397c3bb79a0fc3a020",
                "filename": "docs/content/reference/static-configuration/cli-ref.md",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Freference%2Fstatic-configuration%2Fcli-ref.md",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Freference%2Fstatic-configuration%2Fcli-ref.md",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/docs%2Fcontent%2Freference%2Fstatic-configuration%2Fcli-ref.md?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -111,6 +111,9 @@ Entry point address.\n `--entrypoints.<name>.allowacmebypass`:  \n Enables handling of ACME TLS and HTTP challenges with custom routers. (Default: ```false```)\n \n+`--entrypoints.<name>.forwardedheaders.connection`:  \n+List of Connection headers that are allowed to pass through the middleware chain before being removed.\n+\n `--entrypoints.<name>.forwardedheaders.insecure`:  \n Trust all forwarded headers. (Default: ```false```)\n "
            },
            {
                "sha": "173c18c3e9a30c36bba5a3689c97721dca0fa9f7",
                "filename": "docs/content/reference/static-configuration/env-ref.md",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Freference%2Fstatic-configuration%2Fenv-ref.md",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Freference%2Fstatic-configuration%2Fenv-ref.md",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/docs%2Fcontent%2Freference%2Fstatic-configuration%2Fenv-ref.md?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -111,6 +111,9 @@ Entry point address.\n `TRAEFIK_ENTRYPOINTS_<NAME>_ALLOWACMEBYPASS`:  \n Enables handling of ACME TLS and HTTP challenges with custom routers. (Default: ```false```)\n \n+`TRAEFIK_ENTRYPOINTS_<NAME>_FORWARDEDHEADERS_CONNECTION`:  \n+List of Connection headers that are allowed to pass through the middleware chain before being removed.\n+\n `TRAEFIK_ENTRYPOINTS_<NAME>_FORWARDEDHEADERS_INSECURE`:  \n Trust all forwarded headers. (Default: ```false```)\n "
            },
            {
                "sha": "89844adfe7a88cf27ffdc61aec93d6a62dc09b58",
                "filename": "docs/content/reference/static-configuration/file.toml",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Freference%2Fstatic-configuration%2Ffile.toml",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Freference%2Fstatic-configuration%2Ffile.toml",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/docs%2Fcontent%2Freference%2Fstatic-configuration%2Ffile.toml?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -33,6 +33,7 @@\n     [entryPoints.EntryPoint0.forwardedHeaders]\n       insecure = true\n       trustedIPs = [\"foobar\", \"foobar\"]\n+      connection = [\"foobar\", \"foobar\"]\n     [entryPoints.EntryPoint0.http]\n       middlewares = [\"foobar\", \"foobar\"]\n       encodeQuerySemicolons = true"
            },
            {
                "sha": "38541da46d2b97207da492e1182a0800994eb55a",
                "filename": "docs/content/reference/static-configuration/file.yaml",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Freference%2Fstatic-configuration%2Ffile.yaml",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Freference%2Fstatic-configuration%2Ffile.yaml",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/docs%2Fcontent%2Freference%2Fstatic-configuration%2Ffile.yaml?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -37,6 +37,9 @@ entryPoints:\n       trustedIPs:\n         - foobar\n         - foobar\n+      connection:\n+        - foobar\n+        - foobar\n     http:\n       redirections:\n         entryPoint:"
            },
            {
                "sha": "b87e09b92434c55783c5d3a9b0b7ce4a847fd019",
                "filename": "docs/content/routing/entrypoints.md",
                "status": "modified",
                "additions": 34,
                "deletions": 0,
                "changes": 34,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Frouting%2Fentrypoints.md",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/docs%2Fcontent%2Frouting%2Fentrypoints.md",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/docs%2Fcontent%2Frouting%2Fentrypoints.md?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -422,6 +422,40 @@ You can configure Traefik to trust the forwarded headers information (`X-Forward\n     --entryPoints.web.forwardedHeaders.insecure\n     ```\n \n+??? info \"`forwardedHeaders.connection`\"\n+    \n+    As per RFC7230, Traefik respects the Connection options from the client request.\n+    By doing so, it removes any header field(s) listed in the request Connection header and the Connection header field itself when empty.\n+    The removal happens as soon as the request is handled by Traefik,\n+    thus the removed headers are not available when the request passes through the middleware chain.\n+    The `connection` option lists the Connection headers allowed to passthrough the middleware chain before their removal.\n+\n+    ```yaml tab=\"File (YAML)\"\n+    ## Static configuration\n+    entryPoints:\n+      web:\n+        address: \":80\"\n+        forwardedHeaders:\n+          connection:\n+            - foobar\n+    ```\n+\n+    ```toml tab=\"File (TOML)\"\n+    ## Static configuration\n+    [entryPoints]\n+      [entryPoints.web]\n+        address = \":80\"\n+\n+        [entryPoints.web.forwardedHeaders]\n+          connection = [\"foobar\"]\n+    ```\n+\n+    ```bash tab=\"CLI\"\n+    ## Static configuration\n+    --entryPoints.web.address=:80\n+    --entryPoints.web.forwardedHeaders.connection=foobar\n+    ```\n+\n ### Transport\n \n #### `respondingTimeouts`"
            },
            {
                "sha": "091e1995cc4640e2e48c420feb91c0998583809f",
                "filename": "integration/fixtures/headers/connection_hop_by_hop_headers.toml",
                "status": "added",
                "additions": 37,
                "deletions": 0,
                "changes": 37,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/integration%2Ffixtures%2Fheaders%2Fconnection_hop_by_hop_headers.toml",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/integration%2Ffixtures%2Fheaders%2Fconnection_hop_by_hop_headers.toml",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/integration%2Ffixtures%2Fheaders%2Fconnection_hop_by_hop_headers.toml?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -0,0 +1,37 @@\n+[global]\n+  checkNewVersion = false\n+  sendAnonymousUsage = false\n+\n+[log]\n+  level = \"DEBUG\"\n+\n+# Limiting the Logs to Specific Fields\n+[accessLog]\n+  format = \"json\"\n+  filePath = \"access.log\"\n+\n+  [accessLog.fields.headers.names]\n+    \"Foo\" = \"keep\"\n+    \"Bar\" = \"keep\"\n+\n+[entryPoints]\n+  [entryPoints.web]\n+    address = \":8000\"\n+  [entryPoints.web.forwardedHeaders]\n+    insecure = true\n+    connection = [\"Foo\"]\n+\n+[providers.file]\n+  filename = \"{{ .SelfFilename }}\"\n+\n+## dynamic configuration ##\n+\n+[http.routers]\n+  [http.routers.router1]\n+    rule = \"Host(`test.localhost`)\"\n+    service = \"service1\"\n+\n+[http.services]\n+  [http.services.service1.loadBalancer]\n+    [[http.services.service1.loadBalancer.servers]]\n+      url = \"http://127.0.0.1:9000\""
            },
            {
                "sha": "2b6c53be2b6643ebd40c52b0722439b8687e42b6",
                "filename": "integration/headers_test.go",
                "status": "modified",
                "additions": 53,
                "deletions": 0,
                "changes": 53,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/integration%2Fheaders_test.go",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/integration%2Fheaders_test.go",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/integration%2Fheaders_test.go?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -4,6 +4,7 @@ import (\n \t\"net\"\n \t\"net/http\"\n \t\"net/http/httptest\"\n+\t\"os\"\n \t\"testing\"\n \t\"time\"\n \n@@ -20,6 +21,11 @@ func TestHeadersSuite(t *testing.T) {\n \tsuite.Run(t, new(HeadersSuite))\n }\n \n+func (s *HeadersSuite) TearDownTest() {\n+\ts.displayTraefikLogFile(traefikTestLogFile)\n+\t_ = os.Remove(traefikTestAccessLogFile)\n+}\n+\n func (s *HeadersSuite) TestSimpleConfiguration() {\n \ts.traefikCmd(withConfigFile(\"fixtures/headers/basic.toml\"))\n \n@@ -62,6 +68,53 @@ func (s *HeadersSuite) TestReverseProxyHeaderRemoved() {\n \trequire.NoError(s.T(), err)\n }\n \n+func (s *HeadersSuite) TestConnectionHopByHop() {\n+\tfile := s.adaptFile(\"fixtures/headers/connection_hop_by_hop_headers.toml\", struct{}{})\n+\ts.traefikCmd(withConfigFile(file))\n+\n+\thandler := http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n+\t\t_, found := r.Header[\"X-Forwarded-For\"]\n+\t\tassert.True(s.T(), found)\n+\t\txHost, found := r.Header[\"X-Forwarded-Host\"]\n+\t\tassert.True(s.T(), found)\n+\t\tassert.Equal(s.T(), \"localhost\", xHost[0])\n+\n+\t\t_, found = r.Header[\"Foo\"]\n+\t\tassert.False(s.T(), found)\n+\t\t_, found = r.Header[\"Bar\"]\n+\t\tassert.False(s.T(), found)\n+\t})\n+\n+\tlistener, err := net.Listen(\"tcp\", \"127.0.0.1:9000\")\n+\trequire.NoError(s.T(), err)\n+\n+\tts := &httptest.Server{\n+\t\tListener: listener,\n+\t\tConfig:   &http.Server{Handler: handler},\n+\t}\n+\tts.Start()\n+\tdefer ts.Close()\n+\n+\treq, err := http.NewRequest(http.MethodGet, \"http://127.0.0.1:8000/\", nil)\n+\trequire.NoError(s.T(), err)\n+\treq.Host = \"test.localhost\"\n+\treq.Header = http.Header{\n+\t\t\"Connection\":       {\"Foo,Bar,X-Forwarded-For,X-Forwarded-Host\"},\n+\t\t\"Foo\":              {\"bar\"},\n+\t\t\"Bar\":              {\"foo\"},\n+\t\t\"X-Forwarded-Host\": {\"localhost\"},\n+\t}\n+\n+\terr = try.Request(req, time.Second, try.StatusCodeIs(http.StatusOK))\n+\trequire.NoError(s.T(), err)\n+\n+\taccessLog, err := os.ReadFile(traefikTestAccessLogFile)\n+\trequire.NoError(s.T(), err)\n+\n+\tassert.Contains(s.T(), string(accessLog), \"\\\"request_Foo\\\":\\\"bar\\\"\")\n+\tassert.NotContains(s.T(), string(accessLog), \"\\\"request_Bar\\\":\\\"\\\"\")\n+}\n+\n func (s *HeadersSuite) TestCorsResponses() {\n \tfile := s.adaptFile(\"fixtures/headers/cors.toml\", struct{}{})\n \ts.traefikCmd(withConfigFile(file))"
            },
            {
                "sha": "27b9f7a0b0f88c9d1df836f264d46dc3d1a8e852",
                "filename": "pkg/config/static/entrypoints.go",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/pkg%2Fconfig%2Fstatic%2Fentrypoints.go",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/pkg%2Fconfig%2Fstatic%2Fentrypoints.go",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/pkg%2Fconfig%2Fstatic%2Fentrypoints.go?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -110,6 +110,7 @@ type TLSConfig struct {\n type ForwardedHeaders struct {\n \tInsecure   bool     `description:\"Trust all forwarded headers.\" json:\"insecure,omitempty\" toml:\"insecure,omitempty\" yaml:\"insecure,omitempty\" export:\"true\"`\n \tTrustedIPs []string `description:\"Trust only forwarded headers from selected IPs.\" json:\"trustedIPs,omitempty\" toml:\"trustedIPs,omitempty\" yaml:\"trustedIPs,omitempty\"`\n+\tConnection []string `description:\"List of Connection headers that are allowed to pass through the middleware chain before being removed.\" json:\"connection,omitempty\" toml:\"connection,omitempty\" yaml:\"connection,omitempty\"`\n }\n \n // ProxyProtocol contains Proxy-Protocol configuration."
            },
            {
                "sha": "1cd1da81abe504b44891ac60447d93420e60726b",
                "filename": "pkg/middlewares/auth/connectionheader.go",
                "status": "renamed",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fauth%2Fconnectionheader.go",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fauth%2Fconnectionheader.go",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/pkg%2Fmiddlewares%2Fauth%2Fconnectionheader.go?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -1,4 +1,4 @@\n-package connectionheader\n+package auth\n \n import (\n \t\"net/http\"",
                "previous_filename": "pkg/middlewares/connectionheader/connectionheader.go"
            },
            {
                "sha": "00d719ef04c157afa55694c38d3fe486d478c89a",
                "filename": "pkg/middlewares/auth/connectionheader_test.go",
                "status": "renamed",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fauth%2Fconnectionheader_test.go",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fauth%2Fconnectionheader_test.go",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/pkg%2Fmiddlewares%2Fauth%2Fconnectionheader_test.go?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -1,4 +1,4 @@\n-package connectionheader\n+package auth\n \n import (\n \t\"net/http\"",
                "previous_filename": "pkg/middlewares/connectionheader/connectionheader_test.go"
            },
            {
                "sha": "27d42973cd54028b65057bc6ed7aade2a5fac87f",
                "filename": "pkg/middlewares/auth/forward.go",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fauth%2Fforward.go",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fauth%2Fforward.go",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/pkg%2Fmiddlewares%2Fauth%2Fforward.go?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -15,7 +15,6 @@ import (\n \t\"github.com/traefik/traefik/v2/pkg/config/dynamic\"\n \t\"github.com/traefik/traefik/v2/pkg/log\"\n \t\"github.com/traefik/traefik/v2/pkg/middlewares\"\n-\t\"github.com/traefik/traefik/v2/pkg/middlewares/connectionheader\"\n \t\"github.com/traefik/traefik/v2/pkg/tracing\"\n \t\"github.com/vulcand/oxy/v2/forward\"\n \t\"github.com/vulcand/oxy/v2/utils\"\n@@ -90,7 +89,7 @@ func NewForward(ctx context.Context, next http.Handler, config dynamic.ForwardAu\n \t\tfa.authResponseHeadersRegex = re\n \t}\n \n-\treturn connectionheader.Remover(fa), nil\n+\treturn Remover(fa), nil\n }\n \n func (fa *forwardAuth) GetTracingInformation() (string, ext.SpanKindEnum) {"
            },
            {
                "sha": "6f715ccfb50a00a1c8bb86e42b5b7493d86f5ea4",
                "filename": "pkg/middlewares/forwardedheaders/forwarded_header.go",
                "status": "modified",
                "additions": 62,
                "deletions": 13,
                "changes": 75,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fforwardedheaders%2Fforwarded_header.go",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fforwardedheaders%2Fforwarded_header.go",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/pkg%2Fmiddlewares%2Fforwardedheaders%2Fforwarded_header.go?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -3,10 +3,13 @@ package forwardedheaders\n import (\n \t\"net\"\n \t\"net/http\"\n+\t\"net/textproto\"\n \t\"os\"\n+\t\"slices\"\n \t\"strings\"\n \n \t\"github.com/traefik/traefik/v2/pkg/ip\"\n+\t\"golang.org/x/net/http/httpguts\"\n )\n \n const (\n@@ -42,19 +45,20 @@ var xHeaders = []string{\n // Unless insecure is set,\n // it first removes all the existing values for those headers if the remote address is not one of the trusted ones.\n type XForwarded struct {\n-\tinsecure   bool\n-\ttrustedIps []string\n-\tipChecker  *ip.Checker\n-\tnext       http.Handler\n-\thostname   string\n+\tinsecure          bool\n+\ttrustedIPs        []string\n+\tconnectionHeaders []string\n+\tipChecker         *ip.Checker\n+\tnext              http.Handler\n+\thostname          string\n }\n \n // NewXForwarded creates a new XForwarded.\n-func NewXForwarded(insecure bool, trustedIps []string, next http.Handler) (*XForwarded, error) {\n+func NewXForwarded(insecure bool, trustedIPs []string, connectionHeaders []string, next http.Handler) (*XForwarded, error) {\n \tvar ipChecker *ip.Checker\n-\tif len(trustedIps) > 0 {\n+\tif len(trustedIPs) > 0 {\n \t\tvar err error\n-\t\tipChecker, err = ip.NewChecker(trustedIps)\n+\t\tipChecker, err = ip.NewChecker(trustedIPs)\n \t\tif err != nil {\n \t\t\treturn nil, err\n \t\t}\n@@ -66,11 +70,12 @@ func NewXForwarded(insecure bool, trustedIps []string, next http.Handler) (*XFor\n \t}\n \n \treturn &XForwarded{\n-\t\tinsecure:   insecure,\n-\t\ttrustedIps: trustedIps,\n-\t\tipChecker:  ipChecker,\n-\t\tnext:       next,\n-\t\thostname:   hostname,\n+\t\tinsecure:          insecure,\n+\t\ttrustedIPs:        trustedIPs,\n+\t\tconnectionHeaders: connectionHeaders,\n+\t\tipChecker:         ipChecker,\n+\t\tnext:              next,\n+\t\thostname:          hostname,\n \t}, nil\n }\n \n@@ -189,9 +194,53 @@ func (x *XForwarded) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n \n \tx.rewrite(r)\n \n+\tx.removeConnectionHeaders(r)\n+\n \tx.next.ServeHTTP(w, r)\n }\n \n+func (x *XForwarded) removeConnectionHeaders(req *http.Request) {\n+\tvar reqUpType string\n+\tif httpguts.HeaderValuesContainsToken(req.Header[connection], upgrade) {\n+\t\treqUpType = unsafeHeader(req.Header).Get(upgrade)\n+\t}\n+\n+\tvar connectionHopByHopHeaders []string\n+\tfor _, f := range req.Header[connection] {\n+\t\tfor _, sf := range strings.Split(f, \",\") {\n+\t\t\tif sf = textproto.TrimString(sf); sf != \"\" {\n+\t\t\t\t// Connection header cannot dictate to remove X- headers managed by Traefik,\n+\t\t\t\t// as per rfc7230 https://datatracker.ietf.org/doc/html/rfc7230#section-6.1,\n+\t\t\t\t// A proxy or gateway MUST ... and then remove the Connection header field itself\n+\t\t\t\t// (or replace it with the intermediary's own connection options for the forwarded message).\n+\t\t\t\tif slices.Contains(xHeaders, sf) {\n+\t\t\t\t\tcontinue\n+\t\t\t\t}\n+\n+\t\t\t\t// Keep headers allowed through the middleware chain.\n+\t\t\t\tif slices.Contains(x.connectionHeaders, sf) {\n+\t\t\t\t\tconnectionHopByHopHeaders = append(connectionHopByHopHeaders, sf)\n+\t\t\t\t\tcontinue\n+\t\t\t\t}\n+\n+\t\t\t\t// Apply Connection header option.\n+\t\t\t\treq.Header.Del(sf)\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tif reqUpType != \"\" {\n+\t\tconnectionHopByHopHeaders = append(connectionHopByHopHeaders, upgrade)\n+\t\tunsafeHeader(req.Header).Set(upgrade, reqUpType)\n+\t}\n+\tif len(connectionHopByHopHeaders) > 0 {\n+\t\tunsafeHeader(req.Header).Set(connection, strings.Join(connectionHopByHopHeaders, \",\"))\n+\t\treturn\n+\t}\n+\n+\tunsafeHeader(req.Header).Del(connection)\n+}\n+\n // unsafeHeader allows to manage Header values.\n // Must be used only when the header name is already a canonical key.\n type unsafeHeader map[string][]string"
            },
            {
                "sha": "414fd50070604da457911d08b28320c83bad7619",
                "filename": "pkg/middlewares/forwardedheaders/forwarded_header_test.go",
                "status": "modified",
                "additions": 272,
                "deletions": 10,
                "changes": 282,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fforwardedheaders%2Fforwarded_header_test.go",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fforwardedheaders%2Fforwarded_header_test.go",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/pkg%2Fmiddlewares%2Fforwardedheaders%2Fforwarded_header_test.go?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -12,15 +12,16 @@ import (\n \n func TestServeHTTP(t *testing.T) {\n \ttestCases := []struct {\n-\t\tdesc            string\n-\t\tinsecure        bool\n-\t\ttrustedIps      []string\n-\t\tincomingHeaders map[string][]string\n-\t\tremoteAddr      string\n-\t\texpectedHeaders map[string]string\n-\t\ttls             bool\n-\t\twebsocket       bool\n-\t\thost            string\n+\t\tdesc              string\n+\t\tinsecure          bool\n+\t\ttrustedIps        []string\n+\t\tconnectionHeaders []string\n+\t\tincomingHeaders   map[string][]string\n+\t\tremoteAddr        string\n+\t\texpectedHeaders   map[string]string\n+\t\ttls               bool\n+\t\twebsocket         bool\n+\t\thost              string\n \t}{\n \t\t{\n \t\t\tdesc:            \"all Empty\",\n@@ -269,6 +270,196 @@ func TestServeHTTP(t *testing.T) {\n \t\t\t\txForwardedServer: \"foo.com:8080\",\n \t\t\t},\n \t\t},\n+\t\t{\n+\t\t\tdesc:     \"Untrusted: Connection header has no effect on X- forwarded headers\",\n+\t\t\tinsecure: false,\n+\t\t\tincomingHeaders: map[string][]string{\n+\t\t\t\tconnection: {\n+\t\t\t\t\txForwardedProto,\n+\t\t\t\t\txForwardedFor,\n+\t\t\t\t\txForwardedURI,\n+\t\t\t\t\txForwardedMethod,\n+\t\t\t\t\txForwardedHost,\n+\t\t\t\t\txForwardedPort,\n+\t\t\t\t\txForwardedTLSClientCert,\n+\t\t\t\t\txForwardedTLSClientCertInfo,\n+\t\t\t\t\txRealIP,\n+\t\t\t\t},\n+\t\t\t\txForwardedProto:             {\"foo\"},\n+\t\t\t\txForwardedFor:               {\"foo\"},\n+\t\t\t\txForwardedURI:               {\"foo\"},\n+\t\t\t\txForwardedMethod:            {\"foo\"},\n+\t\t\t\txForwardedHost:              {\"foo\"},\n+\t\t\t\txForwardedPort:              {\"foo\"},\n+\t\t\t\txForwardedTLSClientCert:     {\"foo\"},\n+\t\t\t\txForwardedTLSClientCertInfo: {\"foo\"},\n+\t\t\t\txRealIP:                     {\"foo\"},\n+\t\t\t},\n+\t\t\texpectedHeaders: map[string]string{\n+\t\t\t\txForwardedProto:             \"http\",\n+\t\t\t\txForwardedFor:               \"\",\n+\t\t\t\txForwardedURI:               \"\",\n+\t\t\t\txForwardedMethod:            \"\",\n+\t\t\t\txForwardedHost:              \"\",\n+\t\t\t\txForwardedPort:              \"80\",\n+\t\t\t\txForwardedTLSClientCert:     \"\",\n+\t\t\t\txForwardedTLSClientCertInfo: \"\",\n+\t\t\t\txRealIP:                     \"\",\n+\t\t\t\tconnection:                  \"\",\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tdesc:     \"Trusted (insecure): Connection header has no effect on X- forwarded headers\",\n+\t\t\tinsecure: true,\n+\t\t\tincomingHeaders: map[string][]string{\n+\t\t\t\tconnection: {\n+\t\t\t\t\txForwardedProto,\n+\t\t\t\t\txForwardedFor,\n+\t\t\t\t\txForwardedURI,\n+\t\t\t\t\txForwardedMethod,\n+\t\t\t\t\txForwardedHost,\n+\t\t\t\t\txForwardedPort,\n+\t\t\t\t\txForwardedTLSClientCert,\n+\t\t\t\t\txForwardedTLSClientCertInfo,\n+\t\t\t\t\txRealIP,\n+\t\t\t\t},\n+\t\t\t\txForwardedProto:             {\"foo\"},\n+\t\t\t\txForwardedFor:               {\"foo\"},\n+\t\t\t\txForwardedURI:               {\"foo\"},\n+\t\t\t\txForwardedMethod:            {\"foo\"},\n+\t\t\t\txForwardedHost:              {\"foo\"},\n+\t\t\t\txForwardedPort:              {\"foo\"},\n+\t\t\t\txForwardedTLSClientCert:     {\"foo\"},\n+\t\t\t\txForwardedTLSClientCertInfo: {\"foo\"},\n+\t\t\t\txRealIP:                     {\"foo\"},\n+\t\t\t},\n+\t\t\texpectedHeaders: map[string]string{\n+\t\t\t\txForwardedProto:             \"foo\",\n+\t\t\t\txForwardedFor:               \"foo\",\n+\t\t\t\txForwardedURI:               \"foo\",\n+\t\t\t\txForwardedMethod:            \"foo\",\n+\t\t\t\txForwardedHost:              \"foo\",\n+\t\t\t\txForwardedPort:              \"foo\",\n+\t\t\t\txForwardedTLSClientCert:     \"foo\",\n+\t\t\t\txForwardedTLSClientCertInfo: \"foo\",\n+\t\t\t\txRealIP:                     \"foo\",\n+\t\t\t\tconnection:                  \"\",\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tdesc:     \"Untrusted and Connection: Connection header has no effect on X- forwarded headers\",\n+\t\t\tinsecure: false,\n+\t\t\tconnectionHeaders: []string{\n+\t\t\t\txForwardedProto,\n+\t\t\t\txForwardedFor,\n+\t\t\t\txForwardedURI,\n+\t\t\t\txForwardedMethod,\n+\t\t\t\txForwardedHost,\n+\t\t\t\txForwardedPort,\n+\t\t\t\txForwardedTLSClientCert,\n+\t\t\t\txForwardedTLSClientCertInfo,\n+\t\t\t\txRealIP,\n+\t\t\t},\n+\t\t\tincomingHeaders: map[string][]string{\n+\t\t\t\tconnection: {\n+\t\t\t\t\txForwardedProto,\n+\t\t\t\t\txForwardedFor,\n+\t\t\t\t\txForwardedURI,\n+\t\t\t\t\txForwardedMethod,\n+\t\t\t\t\txForwardedHost,\n+\t\t\t\t\txForwardedPort,\n+\t\t\t\t\txForwardedTLSClientCert,\n+\t\t\t\t\txForwardedTLSClientCertInfo,\n+\t\t\t\t\txRealIP,\n+\t\t\t\t},\n+\t\t\t\txForwardedProto:             {\"foo\"},\n+\t\t\t\txForwardedFor:               {\"foo\"},\n+\t\t\t\txForwardedURI:               {\"foo\"},\n+\t\t\t\txForwardedMethod:            {\"foo\"},\n+\t\t\t\txForwardedHost:              {\"foo\"},\n+\t\t\t\txForwardedPort:              {\"foo\"},\n+\t\t\t\txForwardedTLSClientCert:     {\"foo\"},\n+\t\t\t\txForwardedTLSClientCertInfo: {\"foo\"},\n+\t\t\t\txRealIP:                     {\"foo\"},\n+\t\t\t},\n+\t\t\texpectedHeaders: map[string]string{\n+\t\t\t\txForwardedProto:             \"http\",\n+\t\t\t\txForwardedFor:               \"\",\n+\t\t\t\txForwardedURI:               \"\",\n+\t\t\t\txForwardedMethod:            \"\",\n+\t\t\t\txForwardedHost:              \"\",\n+\t\t\t\txForwardedPort:              \"80\",\n+\t\t\t\txForwardedTLSClientCert:     \"\",\n+\t\t\t\txForwardedTLSClientCertInfo: \"\",\n+\t\t\t\txRealIP:                     \"\",\n+\t\t\t\tconnection:                  \"\",\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tdesc:     \"Trusted (insecure) and Connection: Connection header has no effect on X- forwarded headers\",\n+\t\t\tinsecure: true,\n+\t\t\tconnectionHeaders: []string{\n+\t\t\t\txForwardedProto,\n+\t\t\t\txForwardedFor,\n+\t\t\t\txForwardedURI,\n+\t\t\t\txForwardedMethod,\n+\t\t\t\txForwardedHost,\n+\t\t\t\txForwardedPort,\n+\t\t\t\txForwardedTLSClientCert,\n+\t\t\t\txForwardedTLSClientCertInfo,\n+\t\t\t\txRealIP,\n+\t\t\t},\n+\t\t\tincomingHeaders: map[string][]string{\n+\t\t\t\tconnection: {\n+\t\t\t\t\txForwardedProto,\n+\t\t\t\t\txForwardedFor,\n+\t\t\t\t\txForwardedURI,\n+\t\t\t\t\txForwardedMethod,\n+\t\t\t\t\txForwardedHost,\n+\t\t\t\t\txForwardedPort,\n+\t\t\t\t\txForwardedTLSClientCert,\n+\t\t\t\t\txForwardedTLSClientCertInfo,\n+\t\t\t\t\txRealIP,\n+\t\t\t\t},\n+\t\t\t\txForwardedProto:             {\"foo\"},\n+\t\t\t\txForwardedFor:               {\"foo\"},\n+\t\t\t\txForwardedURI:               {\"foo\"},\n+\t\t\t\txForwardedMethod:            {\"foo\"},\n+\t\t\t\txForwardedHost:              {\"foo\"},\n+\t\t\t\txForwardedPort:              {\"foo\"},\n+\t\t\t\txForwardedTLSClientCert:     {\"foo\"},\n+\t\t\t\txForwardedTLSClientCertInfo: {\"foo\"},\n+\t\t\t\txRealIP:                     {\"foo\"},\n+\t\t\t},\n+\t\t\texpectedHeaders: map[string]string{\n+\t\t\t\txForwardedProto:             \"foo\",\n+\t\t\t\txForwardedFor:               \"foo\",\n+\t\t\t\txForwardedURI:               \"foo\",\n+\t\t\t\txForwardedMethod:            \"foo\",\n+\t\t\t\txForwardedHost:              \"foo\",\n+\t\t\t\txForwardedPort:              \"foo\",\n+\t\t\t\txForwardedTLSClientCert:     \"foo\",\n+\t\t\t\txForwardedTLSClientCertInfo: \"foo\",\n+\t\t\t\txRealIP:                     \"foo\",\n+\t\t\t\tconnection:                  \"\",\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tdesc: \"Connection: one remove, and one passthrough header\",\n+\t\t\tconnectionHeaders: []string{\n+\t\t\t\t\"foo\",\n+\t\t\t},\n+\t\t\tincomingHeaders: map[string][]string{\n+\t\t\t\tconnection: {\n+\t\t\t\t\t\"foo\",\n+\t\t\t\t},\n+\t\t\t\t\"Foo\": {\"bar\"},\n+\t\t\t\t\"Bar\": {\"foo\"},\n+\t\t\t},\n+\t\t\texpectedHeaders: map[string]string{\n+\t\t\t\t\"Bar\": \"foo\",\n+\t\t\t},\n+\t\t},\n \t}\n \n \tfor _, test := range testCases {\n@@ -299,7 +490,7 @@ func TestServeHTTP(t *testing.T) {\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\tm, err := NewXForwarded(test.insecure, test.trustedIps,\n+\t\t\tm, err := NewXForwarded(test.insecure, test.trustedIps, test.connectionHeaders,\n \t\t\t\thttp.HandlerFunc(func(_ http.ResponseWriter, _ *http.Request) {}))\n \t\t\trequire.NoError(t, err)\n \n@@ -382,3 +573,74 @@ func Test_isWebsocketRequest(t *testing.T) {\n \t\t})\n \t}\n }\n+\n+func TestConnection(t *testing.T) {\n+\ttestCases := []struct {\n+\t\tdesc              string\n+\t\treqHeaders        map[string]string\n+\t\tconnectionHeaders []string\n+\t\texpected          http.Header\n+\t}{\n+\t\t{\n+\t\t\tdesc: \"simple remove\",\n+\t\t\treqHeaders: map[string]string{\n+\t\t\t\t\"Foo\":      \"bar\",\n+\t\t\t\tconnection: \"foo\",\n+\t\t\t},\n+\t\t\texpected: http.Header{},\n+\t\t},\n+\t\t{\n+\t\t\tdesc: \"remove and upgrade\",\n+\t\t\treqHeaders: map[string]string{\n+\t\t\t\tupgrade:    \"test\",\n+\t\t\t\t\"Foo\":      \"bar\",\n+\t\t\t\tconnection: \"upgrade,foo\",\n+\t\t\t},\n+\t\t\texpected: http.Header{\n+\t\t\t\tupgrade:    []string{\"test\"},\n+\t\t\t\tconnection: []string{\"Upgrade\"},\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tdesc: \"no remove\",\n+\t\t\treqHeaders: map[string]string{\n+\t\t\t\t\"Foo\":      \"bar\",\n+\t\t\t\tconnection: \"fii\",\n+\t\t\t},\n+\t\t\texpected: http.Header{\n+\t\t\t\t\"Foo\": []string{\"bar\"},\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tdesc: \"no remove because connection header pass through\",\n+\t\t\treqHeaders: map[string]string{\n+\t\t\t\t\"Foo\":      \"bar\",\n+\t\t\t\tconnection: \"Foo\",\n+\t\t\t},\n+\t\t\tconnectionHeaders: []string{\"Foo\"},\n+\t\t\texpected: http.Header{\n+\t\t\t\t\"Foo\":      []string{\"bar\"},\n+\t\t\t\tconnection: []string{\"Foo\"},\n+\t\t\t},\n+\t\t},\n+\t}\n+\n+\tfor _, test := range testCases {\n+\t\tt.Run(test.desc, func(t *testing.T) {\n+\t\t\tt.Parallel()\n+\n+\t\t\tforwarded, err := NewXForwarded(true, nil, test.connectionHeaders, nil)\n+\t\t\trequire.NoError(t, err)\n+\n+\t\t\treq := httptest.NewRequest(http.MethodGet, \"https://localhost\", nil)\n+\n+\t\t\tfor k, v := range test.reqHeaders {\n+\t\t\t\treq.Header.Set(k, v)\n+\t\t\t}\n+\n+\t\t\tforwarded.removeConnectionHeaders(req)\n+\n+\t\t\tassert.Equal(t, test.expected, req.Header)\n+\t\t})\n+\t}\n+}"
            },
            {
                "sha": "5ed9f28070644ffaa62af35364b856bcca6546e1",
                "filename": "pkg/middlewares/headers/headers.go",
                "status": "modified",
                "additions": 2,
                "deletions": 4,
                "changes": 6,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fheaders%2Fheaders.go",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/pkg%2Fmiddlewares%2Fheaders%2Fheaders.go",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/pkg%2Fmiddlewares%2Fheaders%2Fheaders.go?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -10,7 +10,6 @@ import (\n \t\"github.com/traefik/traefik/v2/pkg/config/dynamic\"\n \t\"github.com/traefik/traefik/v2/pkg/log\"\n \t\"github.com/traefik/traefik/v2/pkg/middlewares\"\n-\t\"github.com/traefik/traefik/v2/pkg/middlewares/connectionheader\"\n \t\"github.com/traefik/traefik/v2/pkg/tracing\"\n )\n \n@@ -69,12 +68,11 @@ func New(ctx context.Context, next http.Handler, cfg dynamic.Headers, name strin\n \n \tif hasCustomHeaders || hasCorsHeaders {\n \t\tlogger.Debugf(\"Setting up customHeaders/Cors from %v\", cfg)\n-\t\th, err := NewHeader(nextHandler, cfg)\n+\t\tvar err error\n+\t\thandler, err = NewHeader(nextHandler, cfg)\n \t\tif err != nil {\n \t\t\treturn nil, err\n \t\t}\n-\n-\t\thandler = connectionheader.Remover(h)\n \t}\n \n \treturn &headers{"
            },
            {
                "sha": "5cd6cbb49bb74d5c0ec9bf7a2d0a57562d1f57f9",
                "filename": "pkg/server/server_entrypoint_tcp.go",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/traefik/traefik/blob/584144100524277829f26219baaab29a53b8134f/pkg%2Fserver%2Fserver_entrypoint_tcp.go",
                "raw_url": "https://github.com/traefik/traefik/raw/584144100524277829f26219baaab29a53b8134f/pkg%2Fserver%2Fserver_entrypoint_tcp.go",
                "contents_url": "https://api.github.com/repos/traefik/traefik/contents/pkg%2Fserver%2Fserver_entrypoint_tcp.go?ref=584144100524277829f26219baaab29a53b8134f",
                "patch": "@@ -565,6 +565,7 @@ func createHTTPServer(ctx context.Context, ln net.Listener, configuration *stati\n \thandler, err = forwardedheaders.NewXForwarded(\n \t\tconfiguration.ForwardedHeaders.Insecure,\n \t\tconfiguration.ForwardedHeaders.TrustedIPs,\n+\t\tconfiguration.ForwardedHeaders.Connection,\n \t\tnext)\n \tif err != nil {\n \t\treturn nil, err"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/puma/puma/commits/f196b23be24712fb8fb16051cc124798cc84f70e",
        "url": "https://api.github.com/repos/puma/puma/commits/f196b23be24712fb8fb16051cc124798cc84f70e",
        "html_url": "https://github.com/puma/puma/commit/f196b23be24712fb8fb16051cc124798cc84f70e",
        "message": "Merge commit from fork\n\n* Prevent underscores from clobbering hyphen headers\n\n* Special case encoding headers to prevent app confusion\n\n* Handle _ as , in jruby as well\n\n* Silence RuboCop offense\n\n---------\n\nCo-authored-by: Patrik Ragnarsson <patrik@starkast.net>",
        "files": [
            {
                "sha": "0c4f79eee7a2c36193a47df59fa9ff2a0fbe2b13",
                "filename": "ext/puma_http11/org/jruby/puma/Http11.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/puma/puma/blob/f196b23be24712fb8fb16051cc124798cc84f70e/ext%2Fpuma_http11%2Forg%2Fjruby%2Fpuma%2FHttp11.java",
                "raw_url": "https://github.com/puma/puma/raw/f196b23be24712fb8fb16051cc124798cc84f70e/ext%2Fpuma_http11%2Forg%2Fjruby%2Fpuma%2FHttp11.java",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/ext%2Fpuma_http11%2Forg%2Fjruby%2Fpuma%2FHttp11.java?ref=f196b23be24712fb8fb16051cc124798cc84f70e",
                "patch": "@@ -99,6 +99,8 @@ public static void http_field(Ruby runtime, RubyHash req, ByteList buffer, int f\n             int bite = b.get(i) & 0xFF;\n             if(bite == '-') {\n                 b.set(i, (byte)'_');\n+            } else if(bite == '_') {\n+                b.set(i, (byte)',');\n             } else {\n                 b.set(i, (byte)Character.toUpperCase(bite));\n             }"
            },
            {
                "sha": "451105e648b085e25d238a49ceb3104580f09cef",
                "filename": "lib/puma/const.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/puma/puma/blob/f196b23be24712fb8fb16051cc124798cc84f70e/lib%2Fpuma%2Fconst.rb",
                "raw_url": "https://github.com/puma/puma/raw/f196b23be24712fb8fb16051cc124798cc84f70e/lib%2Fpuma%2Fconst.rb",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/lib%2Fpuma%2Fconst.rb?ref=f196b23be24712fb8fb16051cc124798cc84f70e",
                "patch": "@@ -244,6 +244,14 @@ module Const\n     # header values can contain HTAB?\n     ILLEGAL_HEADER_VALUE_REGEX = /[\\x00-\\x08\\x0A-\\x1F]/.freeze\n \n+    # The keys of headers that should not be convert to underscore\n+    # normalized versions. These headers are ignored at the request reading layer,\n+    # but if we normalize them after reading, it's just confusing for the application.\n+    UNMASKABLE_HEADERS = {\n+      \"HTTP_TRANSFER,ENCODING\" => true,\n+      \"HTTP_CONTENT,LENGTH\" => true,\n+    }\n+\n     # Banned keys of response header\n     BANNED_HEADER_KEY = /\\A(rack\\.|status\\z)/.freeze\n "
            },
            {
                "sha": "86e2d467e42bfe979c9ab6063c57585f8cecda48",
                "filename": "lib/puma/request.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 3,
                "changes": 19,
                "blob_url": "https://github.com/puma/puma/blob/f196b23be24712fb8fb16051cc124798cc84f70e/lib%2Fpuma%2Frequest.rb",
                "raw_url": "https://github.com/puma/puma/raw/f196b23be24712fb8fb16051cc124798cc84f70e/lib%2Fpuma%2Frequest.rb",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/lib%2Fpuma%2Frequest.rb?ref=f196b23be24712fb8fb16051cc124798cc84f70e",
                "patch": "@@ -318,6 +318,11 @@ def illegal_header_value?(header_value)\n     # compatibility, we'll convert them back. This code is written to\n     # avoid allocation in the common case (ie there are no headers\n     # with `,` in their names), that's why it has the extra conditionals.\n+    #\n+    # @note If a normalized version of a `,` header already exists, we ignore\n+    #       the `,` version. This prevents clobbering headers managed by proxies\n+    #       but not by clients (Like X-Forwarded-For).\n+    #\n     # @param env [Hash] see Puma::Client#env, from request, modifies in place\n     # @version 5.0.3\n     #\n@@ -326,23 +331,31 @@ def req_env_post_parse(env)\n       to_add = nil\n \n       env.each do |k,v|\n-        if k.start_with?(\"HTTP_\") and k.include?(\",\") and k != \"HTTP_TRANSFER,ENCODING\"\n+        if k.start_with?(\"HTTP_\") && k.include?(\",\") && !UNMASKABLE_HEADERS.key?(k)\n           if to_delete\n             to_delete << k\n           else\n             to_delete = [k]\n           end\n \n+          new_k = k.tr(\",\", \"_\")\n+          if env.key?(new_k)\n+            next\n+          end\n+\n           unless to_add\n             to_add = {}\n           end\n \n-          to_add[k.tr(\",\", \"_\")] = v\n+          to_add[new_k] = v\n         end\n       end\n \n-      if to_delete\n+      if to_delete # rubocop:disable Style/SafeNavigation\n         to_delete.each { |k| env.delete(k) }\n+      end\n+\n+      if to_add\n         env.merge! to_add\n       end\n     end"
            },
            {
                "sha": "60e61c3dde566fd456e2a486fe490a462bbfbb55",
                "filename": "test/test_normalize.rb",
                "status": "added",
                "additions": 57,
                "deletions": 0,
                "changes": 57,
                "blob_url": "https://github.com/puma/puma/blob/f196b23be24712fb8fb16051cc124798cc84f70e/test%2Ftest_normalize.rb",
                "raw_url": "https://github.com/puma/puma/raw/f196b23be24712fb8fb16051cc124798cc84f70e/test%2Ftest_normalize.rb",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/test%2Ftest_normalize.rb?ref=f196b23be24712fb8fb16051cc124798cc84f70e",
                "patch": "@@ -0,0 +1,57 @@\n+# frozen_string_literal: true\n+\n+require_relative \"helper\"\n+\n+require \"puma/request\"\n+\n+class TestNormalize < Minitest::Test\n+  parallelize_me!\n+\n+  include Puma::Request\n+\n+  def test_comma_headers\n+    env = {\n+      \"HTTP_X_FORWARDED_FOR\" => \"1.1.1.1\",\n+      \"HTTP_X_FORWARDED,FOR\" => \"2.2.2.2\",\n+    }\n+\n+    req_env_post_parse env\n+\n+    expected = {\n+      \"HTTP_X_FORWARDED_FOR\" => \"1.1.1.1\",\n+    }\n+\n+    assert_equal expected, env\n+\n+    # Test that the iteration order doesn't matter\n+\n+    env = {\n+      \"HTTP_X_FORWARDED,FOR\" => \"2.2.2.2\",\n+      \"HTTP_X_FORWARDED_FOR\" => \"1.1.1.1\",\n+    }\n+\n+    req_env_post_parse env\n+\n+    expected = {\n+      \"HTTP_X_FORWARDED_FOR\" => \"1.1.1.1\",\n+    }\n+\n+    assert_equal expected, env\n+  end\n+\n+  def test_unmaskable_headers\n+    env = {\n+      \"HTTP_CONTENT,LENGTH\" => \"100000\",\n+      \"HTTP_TRANSFER,ENCODING\" => \"chunky\"\n+    }\n+\n+    req_env_post_parse env\n+\n+    expected = {\n+      \"HTTP_CONTENT,LENGTH\" => \"100000\",\n+      \"HTTP_TRANSFER,ENCODING\" => \"chunky\"\n+    }\n+\n+    assert_equal expected, env\n+  end\n+end"
            },
            {
                "sha": "c6aa91ab0570909bccf81aae5886087b9ad15126",
                "filename": "test/test_request_invalid.rb",
                "status": "modified",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/puma/puma/blob/f196b23be24712fb8fb16051cc124798cc84f70e/test%2Ftest_request_invalid.rb",
                "raw_url": "https://github.com/puma/puma/raw/f196b23be24712fb8fb16051cc124798cc84f70e/test%2Ftest_request_invalid.rb",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/test%2Ftest_request_invalid.rb?ref=f196b23be24712fb8fb16051cc124798cc84f70e",
                "patch": "@@ -216,4 +216,32 @@ def test_chunked_size_mismatch_2\n \n     assert_status data\n   end\n+\n+  def test_underscore_header_1\n+    hdrs = [\n+      \"X-FORWARDED-FOR: 1.1.1.1\",  # proper\n+      \"X-FORWARDED-FOR: 2.2.2.2\",  # proper\n+      \"X_FORWARDED-FOR: 3.3.3.3\",  # invalid, contains underscore\n+      \"Content-Length: 5\",\n+    ].join \"\\r\\n\"\n+\n+    response = send_http_and_read \"#{GET_PREFIX}#{hdrs}\\r\\n\\r\\nHello\\r\\n\\r\\n\"\n+\n+    assert_includes response, \"HTTP_X_FORWARDED_FOR = 1.1.1.1, 2.2.2.2\"\n+    refute_includes response, \"3.3.3.3\"\n+  end\n+\n+  def test_underscore_header_2\n+    hdrs = [\n+      \"X_FORWARDED-FOR: 3.3.3.3\",  # invalid, contains underscore\n+      \"X-FORWARDED-FOR: 2.2.2.2\",  # proper\n+      \"X-FORWARDED-FOR: 1.1.1.1\",  # proper\n+      \"Content-Length: 5\",\n+    ].join \"\\r\\n\"\n+\n+    response = send_http_and_read \"#{GET_PREFIX}#{hdrs}\\r\\n\\r\\nHello\\r\\n\\r\\n\"\n+\n+    assert_includes response, \"HTTP_X_FORWARDED_FOR = 2.2.2.2, 1.1.1.1\"\n+    refute_includes response, \"3.3.3.3\"\n+  end\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/puma/puma/commits/cac3fd18cf29ed43719ff5d52d9cfec215f0a043",
        "url": "https://api.github.com/repos/puma/puma/commits/cac3fd18cf29ed43719ff5d52d9cfec215f0a043",
        "html_url": "https://github.com/puma/puma/commit/cac3fd18cf29ed43719ff5d52d9cfec215f0a043",
        "message": "Merge commit from fork\n\n* Prevent underscores from clobbering hyphen headers\n\n* Special case encoding headers to prevent app confusion\n\n* Handle _ as , in jruby as well\n\n* Silence RuboCop offense\n\n---------\n\nCo-authored-by: Patrik Ragnarsson <patrik@starkast.net>",
        "files": [
            {
                "sha": "bffdea7a5baad6df78afc3d7455892f9fc94d4c8",
                "filename": "ext/puma_http11/org/jruby/puma/Http11.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/puma/puma/blob/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/ext%2Fpuma_http11%2Forg%2Fjruby%2Fpuma%2FHttp11.java",
                "raw_url": "https://github.com/puma/puma/raw/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/ext%2Fpuma_http11%2Forg%2Fjruby%2Fpuma%2FHttp11.java",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/ext%2Fpuma_http11%2Forg%2Fjruby%2Fpuma%2FHttp11.java?ref=cac3fd18cf29ed43719ff5d52d9cfec215f0a043",
                "patch": "@@ -99,6 +99,8 @@ public static void http_field(Ruby runtime, RubyHash req, ByteList buffer, int f\n             int bite = b.get(i) & 0xFF;\n             if(bite == '-') {\n                 b.set(i, (byte)'_');\n+            } else if(bite == '_') {\n+                b.set(i, (byte)',');\n             } else {\n                 b.set(i, (byte)Character.toUpperCase(bite));\n             }"
            },
            {
                "sha": "3c3c988638cd92442c4aad18fe409d7c5f580652",
                "filename": "lib/puma/const.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/puma/puma/blob/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/lib%2Fpuma%2Fconst.rb",
                "raw_url": "https://github.com/puma/puma/raw/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/lib%2Fpuma%2Fconst.rb",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/lib%2Fpuma%2Fconst.rb?ref=cac3fd18cf29ed43719ff5d52d9cfec215f0a043",
                "patch": "@@ -281,6 +281,14 @@ module Const\n     # header values can contain HTAB?\n     ILLEGAL_HEADER_VALUE_REGEX = /[\\x00-\\x08\\x0A-\\x1F]/.freeze\n \n+    # The keys of headers that should not be convert to underscore\n+    # normalized versions. These headers are ignored at the request reading layer,\n+    # but if we normalize them after reading, it's just confusing for the application.\n+    UNMASKABLE_HEADERS = {\n+      \"HTTP_TRANSFER,ENCODING\" => true,\n+      \"HTTP_CONTENT,LENGTH\" => true,\n+    }\n+\n     # Banned keys of response header\n     BANNED_HEADER_KEY = /\\A(rack\\.|status\\z)/.freeze\n "
            },
            {
                "sha": "c9427c8ae52e9355f08166be4831f08ac24bded2",
                "filename": "lib/puma/request.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 3,
                "changes": 19,
                "blob_url": "https://github.com/puma/puma/blob/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/lib%2Fpuma%2Frequest.rb",
                "raw_url": "https://github.com/puma/puma/raw/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/lib%2Fpuma%2Frequest.rb",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/lib%2Fpuma%2Frequest.rb?ref=cac3fd18cf29ed43719ff5d52d9cfec215f0a043",
                "patch": "@@ -495,6 +495,11 @@ def illegal_header_value?(header_value)\n     # compatibility, we'll convert them back. This code is written to\n     # avoid allocation in the common case (ie there are no headers\n     # with `,` in their names), that's why it has the extra conditionals.\n+    #\n+    # @note If a normalized version of a `,` header already exists, we ignore\n+    #       the `,` version. This prevents clobbering headers managed by proxies\n+    #       but not by clients (Like X-Forwarded-For).\n+    #\n     # @param env [Hash] see Puma::Client#env, from request, modifies in place\n     # @version 5.0.3\n     #\n@@ -503,23 +508,31 @@ def req_env_post_parse(env)\n       to_add = nil\n \n       env.each do |k,v|\n-        if k.start_with?(\"HTTP_\") && k.include?(\",\") && k != \"HTTP_TRANSFER,ENCODING\"\n+        if k.start_with?(\"HTTP_\") && k.include?(\",\") && !UNMASKABLE_HEADERS.key?(k)\n           if to_delete\n             to_delete << k\n           else\n             to_delete = [k]\n           end\n \n+          new_k = k.tr(\",\", \"_\")\n+          if env.key?(new_k)\n+            next\n+          end\n+\n           unless to_add\n             to_add = {}\n           end\n \n-          to_add[k.tr(\",\", \"_\")] = v\n+          to_add[new_k] = v\n         end\n       end\n \n-      if to_delete\n+      if to_delete # rubocop:disable Style/SafeNavigation\n         to_delete.each { |k| env.delete(k) }\n+      end\n+\n+      if to_add\n         env.merge! to_add\n       end\n     end"
            },
            {
                "sha": "60e61c3dde566fd456e2a486fe490a462bbfbb55",
                "filename": "test/test_normalize.rb",
                "status": "added",
                "additions": 57,
                "deletions": 0,
                "changes": 57,
                "blob_url": "https://github.com/puma/puma/blob/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/test%2Ftest_normalize.rb",
                "raw_url": "https://github.com/puma/puma/raw/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/test%2Ftest_normalize.rb",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/test%2Ftest_normalize.rb?ref=cac3fd18cf29ed43719ff5d52d9cfec215f0a043",
                "patch": "@@ -0,0 +1,57 @@\n+# frozen_string_literal: true\n+\n+require_relative \"helper\"\n+\n+require \"puma/request\"\n+\n+class TestNormalize < Minitest::Test\n+  parallelize_me!\n+\n+  include Puma::Request\n+\n+  def test_comma_headers\n+    env = {\n+      \"HTTP_X_FORWARDED_FOR\" => \"1.1.1.1\",\n+      \"HTTP_X_FORWARDED,FOR\" => \"2.2.2.2\",\n+    }\n+\n+    req_env_post_parse env\n+\n+    expected = {\n+      \"HTTP_X_FORWARDED_FOR\" => \"1.1.1.1\",\n+    }\n+\n+    assert_equal expected, env\n+\n+    # Test that the iteration order doesn't matter\n+\n+    env = {\n+      \"HTTP_X_FORWARDED,FOR\" => \"2.2.2.2\",\n+      \"HTTP_X_FORWARDED_FOR\" => \"1.1.1.1\",\n+    }\n+\n+    req_env_post_parse env\n+\n+    expected = {\n+      \"HTTP_X_FORWARDED_FOR\" => \"1.1.1.1\",\n+    }\n+\n+    assert_equal expected, env\n+  end\n+\n+  def test_unmaskable_headers\n+    env = {\n+      \"HTTP_CONTENT,LENGTH\" => \"100000\",\n+      \"HTTP_TRANSFER,ENCODING\" => \"chunky\"\n+    }\n+\n+    req_env_post_parse env\n+\n+    expected = {\n+      \"HTTP_CONTENT,LENGTH\" => \"100000\",\n+      \"HTTP_TRANSFER,ENCODING\" => \"chunky\"\n+    }\n+\n+    assert_equal expected, env\n+  end\n+end"
            },
            {
                "sha": "57eb2b39b98e96603a45975e0ba09f901d17cda7",
                "filename": "test/test_request_invalid.rb",
                "status": "modified",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/puma/puma/blob/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/test%2Ftest_request_invalid.rb",
                "raw_url": "https://github.com/puma/puma/raw/cac3fd18cf29ed43719ff5d52d9cfec215f0a043/test%2Ftest_request_invalid.rb",
                "contents_url": "https://api.github.com/repos/puma/puma/contents/test%2Ftest_request_invalid.rb?ref=cac3fd18cf29ed43719ff5d52d9cfec215f0a043",
                "patch": "@@ -215,4 +215,32 @@ def test_chunked_size_mismatch_2\n \n     assert_status data\n   end\n+\n+  def test_underscore_header_1\n+    hdrs = [\n+      \"X-FORWARDED-FOR: 1.1.1.1\",  # proper\n+      \"X-FORWARDED-FOR: 2.2.2.2\",  # proper\n+      \"X_FORWARDED-FOR: 3.3.3.3\",  # invalid, contains underscore\n+      \"Content-Length: 5\",\n+    ].join \"\\r\\n\"\n+\n+    response = send_http_and_read \"#{GET_PREFIX}#{hdrs}\\r\\n\\r\\nHello\\r\\n\\r\\n\"\n+\n+    assert_includes response, \"HTTP_X_FORWARDED_FOR = 1.1.1.1, 2.2.2.2\"\n+    refute_includes response, \"3.3.3.3\"\n+  end\n+\n+  def test_underscore_header_2\n+    hdrs = [\n+      \"X_FORWARDED-FOR: 3.3.3.3\",  # invalid, contains underscore\n+      \"X-FORWARDED-FOR: 2.2.2.2\",  # proper\n+      \"X-FORWARDED-FOR: 1.1.1.1\",  # proper\n+      \"Content-Length: 5\",\n+    ].join \"\\r\\n\"\n+\n+    response = send_http_and_read \"#{GET_PREFIX}#{hdrs}\\r\\n\\r\\nHello\\r\\n\\r\\n\"\n+\n+    assert_includes response, \"HTTP_X_FORWARDED_FOR = 2.2.2.2, 1.1.1.1\"\n+    refute_includes response, \"3.3.3.3\"\n+  end\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/jeanmarc77/123solar/commits/94bf9ab7ad0ccb7fbdc02f172f37f0e2ea08d48f",
        "url": "https://api.github.com/repos/jeanmarc77/123solar/commits/94bf9ab7ad0ccb7fbdc02f172f37f0e2ea08d48f",
        "html_url": "https://github.com/jeanmarc77/123solar/commit/94bf9ab7ad0ccb7fbdc02f172f37f0e2ea08d48f",
        "message": "Update detailed.php\n\nxss",
        "files": [
            {
                "sha": "e500fe67e7d709099edabda331c84b32e3ea182b",
                "filename": "detailed.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/jeanmarc77/123solar/blob/94bf9ab7ad0ccb7fbdc02f172f37f0e2ea08d48f/detailed.php",
                "raw_url": "https://github.com/jeanmarc77/123solar/raw/94bf9ab7ad0ccb7fbdc02f172f37f0e2ea08d48f/detailed.php",
                "contents_url": "https://api.github.com/repos/jeanmarc77/123solar/contents/detailed.php?ref=94bf9ab7ad0ccb7fbdc02f172f37f0e2ea08d48f",
                "patch": "@@ -47,7 +47,7 @@\n \n $regexp = \"/[0-9]{1,2}+\\/[0-9]{1,2}+\\/[0-9]{4}/\";\n if (!empty($_POST['date1']) && preg_match($regexp, $_POST['date1'])) {\n-\t$date1 = $_POST['date1'];\n+\t$date1 = htmlspecialchars($_POST['date1']);\n } else {\n \t$date1 = (substr($lstlog, -6, 2)) . \"/\" . (substr($lstlog, -8, 2)) . \"/\" . (substr($lstlog, -12, 4));\n }\n@@ -230,7 +230,7 @@\n \t$checkavgpower = 'on';\n }\n $titledate = substr($date1, 0, 10);\n-$csvdate1  = (substr($date1, 6, 4)) . (substr($date1, 3, 2)) . (substr($date1, 0, 2)) . \".csv\";\n+$csvdate1  = (substr($date1, 6, 4)) . (substr($date1, 3, 2)) . (substr($date1, 0, 2)) . '.csv';\n \n echo \"\n <script type='text/javascript'>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/jeanmarc77/123solar/commits/f4a8c748ec436e5a79f91ccb6a6f73752b336aa5",
        "url": "https://api.github.com/repos/jeanmarc77/123solar/commits/f4a8c748ec436e5a79f91ccb6a6f73752b336aa5",
        "html_url": "https://github.com/jeanmarc77/123solar/commit/f4a8c748ec436e5a79f91ccb6a6f73752b336aa5",
        "message": "Update admin_invt2.php\n\nxss",
        "files": [
            {
                "sha": "b1dc930e1d924ffd77f775e3a3ece8ce2f107b46",
                "filename": "admin/admin_invt2.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/jeanmarc77/123solar/blob/f4a8c748ec436e5a79f91ccb6a6f73752b336aa5/admin%2Fadmin_invt2.php",
                "raw_url": "https://github.com/jeanmarc77/123solar/raw/f4a8c748ec436e5a79f91ccb6a6f73752b336aa5/admin%2Fadmin_invt2.php",
                "contents_url": "https://api.github.com/repos/jeanmarc77/123solar/contents/admin%2Fadmin_invt2.php?ref=f4a8c748ec436e5a79f91ccb6a6f73752b336aa5",
                "patch": "@@ -55,7 +55,7 @@\n } else {\n \t$CORRECTFACTORx = 1;\n }\n-if (!empty($_POST['PASSOx'])) {\n+if (!empty($_POST['PASSOx']) && is_numeric($_POST['PASSOx'])) {\n \t$PASSOx = $_POST['PASSOx'];\n } else {\n \t$PASSOx = 0;\n@@ -484,7 +484,7 @@ function testemail($adress) {\n \n \tif ($Err != true) {\n \t\tinclude \"../config/config_invt\" . $invt_numx . \".php\";\n-\t\tif (${'PROTOCOL' . $invt_numx} != $PROTOCOLx) { // Clearing options\n+\t\tif (\"{${'PROTOCOL' . $invt_numx}}\" != $PROTOCOLx) { // Clearing options\n \t\t\t$COMOPTIONx = '';\n \t\t}\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/google-deepmind/reverb/commits/6a0dcf4c9e842b7f999912f792aaa6f6bd261a25",
        "url": "https://api.github.com/repos/google-deepmind/reverb/commits/6a0dcf4c9e842b7f999912f792aaa6f6bd261a25",
        "html_url": "https://github.com/google-deepmind/reverb/commit/6a0dcf4c9e842b7f999912f792aaa6f6bd261a25",
        "message": "Only support compression/decompression of scalar types, disallowing variant and resource dtypes.\n\nPiperOrigin-RevId: 659499334\nChange-Id: I0689fa155a1818eed7498de23464c8d2b56e233c",
        "files": [
            {
                "sha": "7e48303b8bb8afdc390bf375e6e84ab4fc45cc36",
                "filename": "reverb/cc/BUILD",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/google-deepmind/reverb/blob/6a0dcf4c9e842b7f999912f792aaa6f6bd261a25/reverb%2Fcc%2FBUILD",
                "raw_url": "https://github.com/google-deepmind/reverb/raw/6a0dcf4c9e842b7f999912f792aaa6f6bd261a25/reverb%2Fcc%2FBUILD",
                "contents_url": "https://api.github.com/repos/google-deepmind/reverb/contents/reverb%2Fcc%2FBUILD?ref=6a0dcf4c9e842b7f999912f792aaa6f6bd261a25",
                "patch": "@@ -67,6 +67,7 @@ reverb_cc_test(\n     deps = [\n         \":tensor_compression\",\n         \"//reverb/cc/testing:tensor_testutil\",\n+        \"//third_party/absl/status\",\n     ] + reverb_tf_deps(),\n )\n "
            },
            {
                "sha": "5cab855a23d5d6fdfb0a63a523f2cfdd18900667",
                "filename": "reverb/cc/tensor_compression.cc",
                "status": "modified",
                "additions": 47,
                "deletions": 0,
                "changes": 47,
                "blob_url": "https://github.com/google-deepmind/reverb/blob/6a0dcf4c9e842b7f999912f792aaa6f6bd261a25/reverb%2Fcc%2Ftensor_compression.cc",
                "raw_url": "https://github.com/google-deepmind/reverb/raw/6a0dcf4c9e842b7f999912f792aaa6f6bd261a25/reverb%2Fcc%2Ftensor_compression.cc",
                "contents_url": "https://api.github.com/repos/google-deepmind/reverb/contents/reverb%2Fcc%2Ftensor_compression.cc?ref=6a0dcf4c9e842b7f999912f792aaa6f6bd261a25",
                "patch": "@@ -18,6 +18,7 @@\n \n #include \"absl/status/status.h\"\n #include \"absl/status/statusor.h\"\n+#include \"absl/strings/str_cat.h\"\n #include \"reverb/cc/platform/logging.h\"\n #include \"reverb/cc/platform/snappy.h\"\n #include \"tensorflow/core/framework/register_types.h\"\n@@ -55,6 +56,40 @@ tensorflow::Tensor DeltaEncode(const tensorflow::Tensor& tensor, bool encode) {\n   return output;\n }\n \n+bool IsSupported(const tensorflow::DataType data_type) {\n+  switch (data_type) {\n+    case tensorflow::DT_FLOAT:\n+    case tensorflow::DT_DOUBLE:\n+    case tensorflow::DT_INT32:\n+    case tensorflow::DT_UINT8:\n+    case tensorflow::DT_INT16:\n+    case tensorflow::DT_INT8:\n+    case tensorflow::DT_STRING:\n+    case tensorflow::DT_COMPLEX64:\n+    case tensorflow::DT_INT64:\n+    case tensorflow::DT_BOOL:\n+    case tensorflow::DT_QINT8:\n+    case tensorflow::DT_QUINT8:\n+    case tensorflow::DT_QINT32:\n+    case tensorflow::DT_BFLOAT16:\n+    case tensorflow::DT_QINT16:\n+    case tensorflow::DT_QUINT16:\n+    case tensorflow::DT_UINT16:\n+    case tensorflow::DT_COMPLEX128:\n+    case tensorflow::DT_HALF:\n+    // DT_RESOURCE and DT_VARIANT are not supported.\n+    case tensorflow::DT_UINT32:\n+    case tensorflow::DT_UINT64:\n+    case tensorflow::DT_FLOAT8_E5M2:\n+    case tensorflow::DT_FLOAT8_E4M3FN:\n+    case tensorflow::DT_INT4:\n+    case tensorflow::DT_UINT4:\n+      return true;\n+    default:\n+      return false;\n+  }\n+}\n+\n }  // namespace\n \n tensorflow::Tensor DeltaEncode(const tensorflow::Tensor& tensor, bool encode) {\n@@ -83,6 +118,12 @@ std::vector<tensorflow::Tensor> DeltaEncodeList(\n \n absl::Status CompressTensorAsProto(const tensorflow::Tensor& tensor,\n                                    tensorflow::TensorProto* proto) {\n+  if (!IsSupported(tensor.dtype())) {\n+    return absl::InvalidArgumentError(absl::StrCat(\n+        \"Tensor of dtype \", tensorflow::DataTypeString(tensor.dtype()),\n+        \" is not supported for compression.\"));\n+  }\n+\n   if (tensor.dtype() == tensorflow::DT_STRING) {\n     tensor.AsProtoTensorContent(proto);\n     return absl::OkStatus();\n@@ -97,6 +138,12 @@ absl::Status CompressTensorAsProto(const tensorflow::Tensor& tensor,\n \n absl::StatusOr<tensorflow::Tensor> DecompressTensorFromProto(\n     const tensorflow::TensorProto& proto) {\n+  if (!IsSupported(proto.dtype())) {\n+    return absl::InvalidArgumentError(absl::StrCat(\n+        \"Tensor of dtype \", tensorflow::DataTypeString(proto.dtype()),\n+        \" is not supported for decompression.\"));\n+  }\n+\n   if (proto.dtype() == tensorflow::DT_STRING) {\n     tensorflow::Tensor tensor;\n     REVERB_CHECK(tensor.FromProto(proto));"
            },
            {
                "sha": "6bba0c4ce652d70532c1c7a90e6e0e2a7e076502",
                "filename": "reverb/cc/tensor_compression_test.cc",
                "status": "modified",
                "additions": 29,
                "deletions": 0,
                "changes": 29,
                "blob_url": "https://github.com/google-deepmind/reverb/blob/6a0dcf4c9e842b7f999912f792aaa6f6bd261a25/reverb%2Fcc%2Ftensor_compression_test.cc",
                "raw_url": "https://github.com/google-deepmind/reverb/raw/6a0dcf4c9e842b7f999912f792aaa6f6bd261a25/reverb%2Fcc%2Ftensor_compression_test.cc",
                "contents_url": "https://api.github.com/repos/google-deepmind/reverb/contents/reverb%2Fcc%2Ftensor_compression_test.cc?ref=6a0dcf4c9e842b7f999912f792aaa6f6bd261a25",
                "patch": "@@ -18,19 +18,24 @@\n \n #include \"gmock/gmock.h\"\n #include \"gtest/gtest.h\"\n+#include \"absl/status/status.h\"\n #include \"reverb/cc/testing/tensor_testutil.h\"\n #include \"tensorflow/core/framework/register_types.h\"\n #include \"tensorflow/core/framework/tensor.h\"\n #include \"tensorflow/core/framework/tensor.pb.h\"\n #include \"tensorflow/core/framework/tensor_shape.h\"\n #include \"tensorflow/core/framework/types.h\"\n #include \"tensorflow/core/framework/types.pb.h\"\n+#include \"tensorflow/core/framework/variant.h\"\n #include \"tensorflow/core/platform/tstring.h\"\n \n namespace deepmind {\n namespace reverb {\n namespace {\n \n+using ::testing::HasSubstr;\n+using ::testing::status::StatusIs;\n+\n template <typename T>\n void EncodeMatchesDecodeT() {\n   tensorflow::Tensor tensor(tensorflow::DataTypeToEnum<T>::v(),\n@@ -103,6 +108,30 @@ TEST(TensorCompressionTest, NonStringTensorWithDeltaEncoding) {\n   test::ExpectTensorEqual<int>(tensor, DeltaEncode(result, false));\n }\n \n+TEST(TensorCompressionTest, CompressingVariantNotSupported) {\n+  tensorflow::Tensor tensor(tensorflow::DT_VARIANT,\n+                            tensorflow::TensorShape({}));\n+\n+  tensorflow::Tensor internal(tensorflow::DT_FLOAT,\n+                              tensorflow::TensorShape({2, 2}));\n+  internal.flat<float>().setRandom();\n+  tensor.flat<tensorflow::Variant>()(0) = internal;\n+\n+  tensorflow::TensorProto proto;\n+  EXPECT_THAT(CompressTensorAsProto(DeltaEncode(tensor, true), &proto),\n+              StatusIs(absl::StatusCode::kInvalidArgument,\n+                       HasSubstr(\"variant is not supported\")));\n+}\n+\n+TEST(TensorCompressionTest, DecompressingVariantNotSupported) {\n+  tensorflow::TensorProto proto;\n+  proto.set_dtype(tensorflow::DT_VARIANT);\n+\n+  EXPECT_THAT(DecompressTensorFromProto(proto),\n+              StatusIs(absl::StatusCode::kInvalidArgument,\n+                       HasSubstr(\"variant is not supported\")));\n+}\n+\n }  // namespace\n }  // namespace reverb\n }  // namespace deepmind"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/grafana/grafana-plugin-sdk-go/commits/aaa26d1bebaaf6160c37d3f1226a750eab70ca41",
        "url": "https://api.github.com/repos/grafana/grafana-plugin-sdk-go/commits/aaa26d1bebaaf6160c37d3f1226a750eab70ca41",
        "html_url": "https://github.com/grafana/grafana-plugin-sdk-go/commit/aaa26d1bebaaf6160c37d3f1226a750eab70ca41",
        "message": "Remove repo info from binary (#1091)",
        "files": [
            {
                "sha": "e840ce1f3e016b1021b6bdbe2d7430f805088b01",
                "filename": "build/common.go",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/grafana/grafana-plugin-sdk-go/blob/aaa26d1bebaaf6160c37d3f1226a750eab70ca41/build%2Fcommon.go",
                "raw_url": "https://github.com/grafana/grafana-plugin-sdk-go/raw/aaa26d1bebaaf6160c37d3f1226a750eab70ca41/build%2Fcommon.go",
                "contents_url": "https://api.github.com/repos/grafana/grafana-plugin-sdk-go/contents/build%2Fcommon.go?ref=aaa26d1bebaaf6160c37d3f1226a750eab70ca41",
                "patch": "@@ -12,6 +12,7 @@ import (\n \t\"sort\"\n \t\"strings\"\n \t\"sync\"\n+\t\"time\"\n \n \t\"github.com/magefile/mage/mg\"\n \t\"github.com/magefile/mage/sh\"\n@@ -152,7 +153,9 @@ func getBuildBackendCmdInfo(cfg Config) (Config, []string, error) {\n \t\t\"build\", \"-o\", filepath.Join(outputPath, exePath),\n \t}\n \n-\tinfo := getBuildInfoFromEnvironment()\n+\tinfo := Info{\n+\t\tTime: now().UnixNano() / int64(time.Millisecond),\n+\t}\n \tpluginID, err := internal.GetStringValueFromJSON(filepath.Join(pluginJSONPath, \"plugin.json\"), \"id\")\n \tif err == nil && len(pluginID) > 0 {\n \t\tinfo.PluginID = pluginID"
            },
            {
                "sha": "64f1a628b9f27692c63d5d47d56db7c673d13beb",
                "filename": "build/common_test.go",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/grafana/grafana-plugin-sdk-go/blob/aaa26d1bebaaf6160c37d3f1226a750eab70ca41/build%2Fcommon_test.go",
                "raw_url": "https://github.com/grafana/grafana-plugin-sdk-go/raw/aaa26d1bebaaf6160c37d3f1226a750eab70ca41/build%2Fcommon_test.go",
                "contents_url": "https://api.github.com/repos/grafana/grafana-plugin-sdk-go/contents/build%2Fcommon_test.go?ref=aaa26d1bebaaf6160c37d3f1226a750eab70ca41",
                "patch": "@@ -153,7 +153,7 @@ func Test_getBuildBackendCmdInfo(t *testing.T) {\n \t\t\t\tEnv:            map[string]string{\"CGO_ENABLED\": \"0\", \"GOARCH\": \"arm64\", \"GOOS\": \"darwin\"},\n \t\t\t\tPluginJSONPath: filepath.Join(tmpDir, \"foobar-datasource\"),\n \t\t\t},\n-\t\t\texpectedArgs: []string{\"build\", \"-o\", filepath.Join(defaultOutputBinaryPath, \"gpx_foo_darwin_arm64\"), \"-ldflags\", \"-w -s -extldflags \\\"-static\\\" -X 'github.com/grafana/grafana-plugin-sdk-go/build.buildInfoJSON={.*}' -X 'main.branch=.+' -X 'main.commit=[a-z0-9\\\\d]{40}'\", \"./pkg\"},\n+\t\t\texpectedArgs: []string{\"build\", \"-o\", filepath.Join(defaultOutputBinaryPath, \"gpx_foo_darwin_arm64\"), \"-ldflags\", \"-w -s -extldflags \\\"-static\\\" -X 'github.com/grafana/grafana-plugin-sdk-go/build.buildInfoJSON={.*}'\", \"./pkg\"},\n \t\t\twantErr:      assert.NoError,\n \t\t},\n \t\t{\n@@ -174,7 +174,7 @@ func Test_getBuildBackendCmdInfo(t *testing.T) {\n \t\t\t\tEnv:            map[string]string{\"CGO_ENABLED\": \"0\", \"GOARCH\": \"arm64\", \"GOOS\": \"darwin\"},\n \t\t\t\tPluginJSONPath: filepath.Join(tmpDir, \"foobar-app\"),\n \t\t\t},\n-\t\t\texpectedArgs: []string{\"build\", \"-o\", filepath.Join(defaultOutputBinaryPath, defaultNestedDataSourcePath, \"gpx_foo_darwin_arm64\"), \"-ldflags\", \"-w -s -extldflags \\\"-static\\\" -X 'github.com/grafana/grafana-plugin-sdk-go/build.buildInfoJSON={.*}' -X 'main.branch=.+' -X 'main.commit=[a-z0-9\\\\d]{40}'\", \"./pkg\"},\n+\t\t\texpectedArgs: []string{\"build\", \"-o\", filepath.Join(defaultOutputBinaryPath, defaultNestedDataSourcePath, \"gpx_foo_darwin_arm64\"), \"-ldflags\", \"-w -s -extldflags \\\"-static\\\" -X 'github.com/grafana/grafana-plugin-sdk-go/build.buildInfoJSON={.*}'\", \"./pkg\"},\n \t\t\twantErr:      assert.NoError,\n \t\t},\n \t\t{\n@@ -195,7 +195,7 @@ func Test_getBuildBackendCmdInfo(t *testing.T) {\n \t\t\t\tEnv:            map[string]string{\"CGO_ENABLED\": \"0\", \"GOARCH\": \"amd64\", \"GOOS\": \"windows\"},\n \t\t\t\tPluginJSONPath: filepath.Join(tmpDir, \"foobarbaz-app\"),\n \t\t\t},\n-\t\t\texpectedArgs: []string{\"build\", \"-o\", filepath.Join(defaultOutputBinaryPath, \"gpx_foobarbaz_windows_amd64.exe\"), \"-ldflags\", \"-w -s -extldflags \\\"-static\\\" -X 'github.com/grafana/grafana-plugin-sdk-go/build.buildInfoJSON={.*}' -X 'main.branch=.+' -X 'main.commit=[a-z0-9\\\\d]{40}'\", \"./pkg\"},\n+\t\t\texpectedArgs: []string{\"build\", \"-o\", filepath.Join(defaultOutputBinaryPath, \"gpx_foobarbaz_windows_amd64.exe\"), \"-ldflags\", \"-w -s -extldflags \\\"-static\\\" -X 'github.com/grafana/grafana-plugin-sdk-go/build.buildInfoJSON={.*}'\", \"./pkg\"},\n \t\t\twantErr:      assert.NoError,\n \t\t},\n \t}"
            },
            {
                "sha": "882c751c1df82c293cca3a9bda1de3d1cfee4efd",
                "filename": "build/info.go",
                "status": "modified",
                "additions": 0,
                "deletions": 76,
                "changes": 76,
                "blob_url": "https://github.com/grafana/grafana-plugin-sdk-go/blob/aaa26d1bebaaf6160c37d3f1226a750eab70ca41/build%2Finfo.go",
                "raw_url": "https://github.com/grafana/grafana-plugin-sdk-go/raw/aaa26d1bebaaf6160c37d3f1226a750eab70ca41/build%2Finfo.go",
                "contents_url": "https://api.github.com/repos/grafana/grafana-plugin-sdk-go/contents/build%2Finfo.go?ref=aaa26d1bebaaf6160c37d3f1226a750eab70ca41",
                "patch": "@@ -3,10 +3,6 @@ package build\n import (\n \t\"encoding/json\"\n \t\"fmt\"\n-\t\"os\"\n-\t\"os/exec\"\n-\t\"strconv\"\n-\t\"strings\"\n \t\"time\"\n )\n \n@@ -21,11 +17,6 @@ type Info struct {\n \tTime     int64  `json:\"time,omitempty\"`\n \tPluginID string `json:\"pluginID,omitempty\"`\n \tVersion  string `json:\"version,omitempty\"`\n-\tRepo     string `json:\"repo,omitempty\"`\n-\tBranch   string `json:\"branch,omitempty\"`\n-\tHash     string `json:\"hash,omitempty\"`\n-\tBuild    int64  `json:\"build,omitempty\"`\n-\tPR       int64  `json:\"pr,omitempty\"`\n }\n \n // this will append build flags -- the keys are picked to match existing\n@@ -37,80 +28,13 @@ func (v Info) appendFlags(flags map[string]string) {\n \tif v.Version != \"\" {\n \t\tflags[\"main.version\"] = v.Version\n \t}\n-\tif v.Branch != \"\" {\n-\t\tflags[\"main.branch\"] = v.Branch\n-\t}\n-\tif v.Hash != \"\" {\n-\t\tflags[\"main.commit\"] = v.Hash\n-\t}\n \n \tout, err := json.Marshal(v)\n \tif err == nil {\n \t\tflags[\"github.com/grafana/grafana-plugin-sdk-go/build.buildInfoJSON\"] = string(out)\n \t}\n }\n \n-func getEnvironment(check ...string) string {\n-\tfor _, key := range check {\n-\t\tif strings.HasPrefix(key, \"> \") {\n-\t\t\tparts := strings.Split(key, \" \")\n-\t\t\tcmd := exec.Command(parts[1], parts[2:]...) // #nosec G204\n-\t\t\tout, err := cmd.CombinedOutput()\n-\t\t\tif err == nil && len(out) > 0 {\n-\t\t\t\tstr := strings.TrimSpace(string(out))\n-\t\t\t\tif strings.Index(str, \" \") > 0 {\n-\t\t\t\t\tcontinue // skip any output that has spaces\n-\t\t\t\t}\n-\t\t\t\treturn str\n-\t\t\t}\n-\t\t\tcontinue\n-\t\t}\n-\n-\t\tval := os.Getenv(key)\n-\t\tif val != \"\" {\n-\t\t\treturn strings.TrimSpace(val)\n-\t\t}\n-\t}\n-\treturn \"\"\n-}\n-\n-// getBuildInfoFromEnvironment reads the\n-func getBuildInfoFromEnvironment() Info {\n-\tv := Info{\n-\t\tTime: now().UnixNano() / int64(time.Millisecond),\n-\t}\n-\n-\tv.Repo = getEnvironment(\n-\t\t\"DRONE_REPO_LINK\",\n-\t\t\"CIRCLE_PROJECT_REPONAME\",\n-\t\t\"CI_REPONAME\",\n-\t\t\"> git remote get-url origin\")\n-\tv.Branch = getEnvironment(\n-\t\t\"DRONE_BRANCH\",\n-\t\t\"CIRCLE_BRANCH\",\n-\t\t\"CI_BRANCH\",\n-\t\t\"> git branch --show-current\")\n-\tv.Hash = getEnvironment(\n-\t\t\"DRONE_COMMIT_SHA\",\n-\t\t\"CIRCLE_SHA1\",\n-\t\t\"CI_COMMIT_SHA\",\n-\t\t\"> git rev-parse HEAD\")\n-\tval, err := strconv.ParseInt(getEnvironment(\n-\t\t\"DRONE_BUILD_NUMBER\",\n-\t\t\"CIRCLE_BUILD_NUM\",\n-\t\t\"CI_BUILD_NUM\"), 10, 64)\n-\tif err == nil {\n-\t\tv.Build = val\n-\t}\n-\tval, err = strconv.ParseInt(getEnvironment(\n-\t\t\"DRONE_PULL_REQUEST\",\n-\t\t\"CI_PULL_REQUEST\"), 10, 64)\n-\tif err == nil {\n-\t\tv.PR = val\n-\t}\n-\treturn v\n-}\n-\n // InfoGetter is an interface with a method for returning the build info.\n type InfoGetter interface {\n \t// GetInfo returns the build info."
            },
            {
                "sha": "6a4c815c28c405d11a00052472f7a85bef90f78f",
                "filename": "build/info_test.go",
                "status": "removed",
                "additions": 0,
                "deletions": 57,
                "changes": 57,
                "blob_url": "https://github.com/grafana/grafana-plugin-sdk-go/blob/41102661e6497e3dc9c8bcec9a734b674f163ceb/build%2Finfo_test.go",
                "raw_url": "https://github.com/grafana/grafana-plugin-sdk-go/raw/41102661e6497e3dc9c8bcec9a734b674f163ceb/build%2Finfo_test.go",
                "contents_url": "https://api.github.com/repos/grafana/grafana-plugin-sdk-go/contents/build%2Finfo_test.go?ref=41102661e6497e3dc9c8bcec9a734b674f163ceb",
                "patch": "@@ -1,57 +0,0 @@\n-package build\n-\n-import (\n-\t\"fmt\"\n-\t\"os\"\n-\t\"testing\"\n-\t\"time\"\n-\n-\t\"github.com/stretchr/testify/assert\"\n-\t\"github.com/stretchr/testify/require\"\n-)\n-\n-func TestFillBuildInfo(t *testing.T) {\n-\t// Set this as a constant for testing\n-\tnow = func() time.Time { return time.Unix(1515151515, 0) }\n-\tt.Cleanup(func() {\n-\t\tnow = time.Now\n-\t})\n-\n-\tt.Run(\"drone\", func(t *testing.T) {\n-\t\tt.Setenv(\"DRONE_REPO_LINK\", \"https://github.com/octocat/hello-world\")\n-\t\tt.Setenv(\"DRONE_BRANCH\", \"main\")\n-\t\tt.Setenv(\"DRONE_COMMIT_SHA\", \"bcdd4bf0245c82c060407b3b24b9b87301d15ac1\")\n-\t\tt.Setenv(\"DRONE_BUILD_NUMBER\", \"22\")\n-\t\tt.Setenv(\"DRONE_PULL_REQUEST\", \"33\")\n-\n-\t\tinfo := getBuildInfoFromEnvironment()\n-\t\trequire.NotNil(t, info)\n-\t\tassert.Equal(t, \"main\", info.Branch)\n-\t\tassert.Equal(t, \"bcdd4bf0245c82c060407b3b24b9b87301d15ac1\", info.Hash)\n-\t\tassert.Equal(t, int64(22), info.Build)\n-\t\tassert.Equal(t, int64(33), info.PR)\n-\t})\n-\n-\tt.Run(\"circle\", func(t *testing.T) {\n-\t\tos.Clearenv() // Clear DRONE env vars in CI environment\n-\t\tt.Setenv(\"CIRCLE_PROJECT_REPONAME\", \"https://github.com/octocat/hello-world\")\n-\t\tt.Setenv(\"CIRCLE_BRANCH\", \"main\")\n-\t\tt.Setenv(\"CIRCLE_SHA1\", \"bcdd4bf0245c82c060407b3b24b9b87301d15ac1\")\n-\t\tt.Setenv(\"CIRCLE_BUILD_NUM\", \"22\")\n-\t\tt.Setenv(\"CI_PULL_REQUEST\", \"33\")\n-\n-\t\tinfo := getBuildInfoFromEnvironment()\n-\t\trequire.NotNil(t, info)\n-\t\tassert.Equal(t, \"main\", info.Branch)\n-\t\tassert.Equal(t, \"bcdd4bf0245c82c060407b3b24b9b87301d15ac1\", info.Hash)\n-\t\tassert.Equal(t, int64(22), info.Build)\n-\t\tassert.Equal(t, int64(33), info.PR)\n-\t})\n-\n-\t// really testable since it delegates to functions, but helful in local dev\n-\tt.Run(\"git commands\", func(t *testing.T) {\n-\t\tinfo := getBuildInfoFromEnvironment()\n-\t\tfmt.Printf(\"BUILD: %#v\\n\", info)\n-\t\trequire.NotNil(t, info)\n-\t})\n-}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/4728531c162f2f9e8c2ca1add713cfee2db6be3b",
        "url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/4728531c162f2f9e8c2ca1add713cfee2db6be3b",
        "html_url": "https://github.com/protocolbuffers/protobuf/commit/4728531c162f2f9e8c2ca1add713cfee2db6be3b",
        "message": "Add recursion check when parsing unknown fields in Java.\n\nPiperOrigin-RevId: 675657198",
        "files": [
            {
                "sha": "bf5f922b073c5cd30eb9075337a3396a0dbdc40f",
                "filename": "java/core/src/main/java/com/google/protobuf/ArrayDecoders.java",
                "status": "modified",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java?ref=4728531c162f2f9e8c2ca1add713cfee2db6be3b",
                "patch": "@@ -23,6 +23,10 @@\n  */\n @CheckReturnValue\n final class ArrayDecoders {\n+  static final int DEFAULT_RECURSION_LIMIT = 100;\n+\n+  @SuppressWarnings(\"NonFinalStaticField\")\n+  private static volatile int recursionLimit = DEFAULT_RECURSION_LIMIT;\n \n   private ArrayDecoders() {}\n \n@@ -37,6 +41,7 @@ static final class Registers {\n     public long long1;\n     public Object object1;\n     public final ExtensionRegistryLite extensionRegistry;\n+    public int recursionDepth;\n \n     Registers() {\n       this.extensionRegistry = ExtensionRegistryLite.getEmptyRegistry();\n@@ -244,7 +249,10 @@ static int mergeMessageField(\n     if (length < 0 || length > limit - position) {\n       throw InvalidProtocolBufferException.truncatedMessage();\n     }\n+    registers.recursionDepth++;\n+    checkRecursionLimit(registers.recursionDepth);\n     schema.mergeFrom(msg, data, position, position + length, registers);\n+    registers.recursionDepth--;\n     registers.object1 = msg;\n     return position + length;\n   }\n@@ -262,8 +270,11 @@ static int mergeGroupField(\n     // A group field must has a MessageSchema (the only other subclass of Schema is MessageSetSchema\n     // and it can't be used in group fields).\n     final MessageSchema messageSchema = (MessageSchema) schema;\n+    registers.recursionDepth++;\n+    checkRecursionLimit(registers.recursionDepth);\n     final int endPosition =\n         messageSchema.parseMessage(msg, data, position, limit, endGroup, registers);\n+    registers.recursionDepth--;\n     registers.object1 = msg;\n     return endPosition;\n   }\n@@ -1024,6 +1035,8 @@ static int decodeUnknownField(\n         final UnknownFieldSetLite child = UnknownFieldSetLite.newInstance();\n         final int endGroup = (tag & ~0x7) | WireFormat.WIRETYPE_END_GROUP;\n         int lastTag = 0;\n+        registers.recursionDepth++;\n+        checkRecursionLimit(registers.recursionDepth);\n         while (position < limit) {\n           position = decodeVarint32(data, position, registers);\n           lastTag = registers.int1;\n@@ -1032,6 +1045,7 @@ static int decodeUnknownField(\n           }\n           position = decodeUnknownField(lastTag, data, position, limit, child, registers);\n         }\n+        registers.recursionDepth--;\n         if (position > limit || lastTag != endGroup) {\n           throw InvalidProtocolBufferException.parseFailure();\n         }\n@@ -1078,4 +1092,18 @@ static int skipField(int tag, byte[] data, int position, int limit, Registers re\n         throw InvalidProtocolBufferException.invalidTag();\n     }\n   }\n+\n+  /**\n+   * Set the maximum recursion limit that ArrayDecoders will allow. An exception will be thrown if\n+   * the depth of the message exceeds this limit.\n+   */\n+  public static void setRecursionLimit(int limit) {\n+    recursionLimit = limit;\n+  }\n+\n+  private static void checkRecursionLimit(int depth) throws InvalidProtocolBufferException {\n+    if (depth >= recursionLimit) {\n+      throw InvalidProtocolBufferException.recursionLimitExceeded();\n+    }\n+  }\n }"
            },
            {
                "sha": "fd2991356dfb07335046f871a9351adf85162731",
                "filename": "java/core/src/main/java/com/google/protobuf/CodedInputStream.java",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStream.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStream.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStream.java?ref=4728531c162f2f9e8c2ca1add713cfee2db6be3b",
                "patch": "@@ -229,7 +229,10 @@ public void skipMessage() throws IOException {\n       if (tag == 0) {\n         return;\n       }\n+      checkRecursionLimit();\n+      ++recursionDepth;\n       boolean fieldSkipped = skipField(tag);\n+      --recursionDepth;\n       if (!fieldSkipped) {\n         return;\n       }\n@@ -246,7 +249,10 @@ public void skipMessage(CodedOutputStream output) throws IOException {\n       if (tag == 0) {\n         return;\n       }\n+      checkRecursionLimit();\n+      ++recursionDepth;\n       boolean fieldSkipped = skipField(tag, output);\n+      --recursionDepth;\n       if (!fieldSkipped) {\n         return;\n       }"
            },
            {
                "sha": "5ad6762b0dc4e0179971d5ca7365855d20d36098",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSchema.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java?ref=4728531c162f2f9e8c2ca1add713cfee2db6be3b",
                "patch": "@@ -3006,8 +3006,8 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n             // Unknown field.\n-\n-            if (unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n+            if (unknownFieldSchema.mergeOneFieldFrom(\n+                unknownFields, reader, /* currentDepth= */ 0)) {\n               continue;\n             }\n           }\n@@ -3382,8 +3382,8 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               if (unknownFields == null) {\n                 unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n               }\n-\n-              if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n+              if (!unknownFieldSchema.mergeOneFieldFrom(\n+                  unknownFields, reader, /* currentDepth= */ 0)) {\n                 return;\n               }\n               break;\n@@ -3399,8 +3399,8 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n             if (unknownFields == null) {\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n-\n-            if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n+            if (!unknownFieldSchema.mergeOneFieldFrom(\n+                unknownFields, reader, /* currentDepth= */ 0)) {\n               return;\n             }\n           }"
            },
            {
                "sha": "ec37d41f98c5a431f95edf91090835429a68567b",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSetSchema.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java?ref=4728531c162f2f9e8c2ca1add713cfee2db6be3b",
                "patch": "@@ -278,8 +278,7 @@ boolean parseMessageSetItemOrUnknownField(\n               reader, extension, extensionRegistry, extensions);\n           return true;\n         } else {\n-\n-          return unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader);\n+          return unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader, /* currentDepth= */ 0);\n         }\n       } else {\n         return reader.skipField();"
            },
            {
                "sha": "80602b16359aa378d120704a271a98b856039b71",
                "filename": "java/core/src/main/java/com/google/protobuf/UnknownFieldSchema.java",
                "status": "modified",
                "additions": 25,
                "deletions": 4,
                "changes": 29,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java?ref=4728531c162f2f9e8c2ca1add713cfee2db6be3b",
                "patch": "@@ -13,6 +13,11 @@\n @CheckReturnValue\n abstract class UnknownFieldSchema<T, B> {\n \n+  static final int DEFAULT_RECURSION_LIMIT = 100;\n+\n+  @SuppressWarnings(\"NonFinalStaticField\")\n+  private static volatile int recursionLimit = DEFAULT_RECURSION_LIMIT;\n+\n   /** Whether unknown fields should be dropped. */\n   abstract boolean shouldDiscardUnknownFields(Reader reader);\n \n@@ -55,7 +60,9 @@ abstract class UnknownFieldSchema<T, B> {\n   /** Marks unknown fields as immutable. */\n   abstract void makeImmutable(Object message);\n \n-  final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOException {\n+  /** Merges one field into the unknown fields. */\n+  final boolean mergeOneFieldFrom(B unknownFields, Reader reader, int currentDepth)\n+      throws IOException {\n     int tag = reader.getTag();\n     int fieldNumber = WireFormat.getTagFieldNumber(tag);\n     switch (WireFormat.getTagWireType(tag)) {\n@@ -74,7 +81,12 @@ final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOExcepti\n       case WireFormat.WIRETYPE_START_GROUP:\n         final B subFields = newBuilder();\n         int endGroupTag = WireFormat.makeTag(fieldNumber, WireFormat.WIRETYPE_END_GROUP);\n-        mergeFrom(subFields, reader);\n+        currentDepth++;\n+        if (currentDepth >= recursionLimit) {\n+          throw InvalidProtocolBufferException.recursionLimitExceeded();\n+        }\n+        mergeFrom(subFields, reader, currentDepth);\n+        currentDepth--;\n         if (endGroupTag != reader.getTag()) {\n           throw InvalidProtocolBufferException.invalidEndTag();\n         }\n@@ -87,10 +99,11 @@ final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOExcepti\n     }\n   }\n \n-  private final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n+  private final void mergeFrom(B unknownFields, Reader reader, int currentDepth)\n+      throws IOException {\n     while (true) {\n       if (reader.getFieldNumber() == Reader.READ_DONE\n-          || !mergeOneFieldFrom(unknownFields, reader)) {\n+          || !mergeOneFieldFrom(unknownFields, reader, currentDepth)) {\n         break;\n       }\n     }\n@@ -107,4 +120,12 @@ private final void mergeFrom(B unknownFields, Reader reader) throws IOException\n   abstract int getSerializedSizeAsMessageSet(T message);\n \n   abstract int getSerializedSize(T unknowns);\n+\n+  /**\n+   * Set the maximum recursion limit that ArrayDecoders will allow. An exception will be thrown if\n+   * the depth of the message exceeds this limit.\n+   */\n+  public void setRecursionLimit(int limit) {\n+    recursionLimit = limit;\n+  }\n }"
            },
            {
                "sha": "14c4bbeea51dcad9c077098f705517deb1b0ff9b",
                "filename": "java/core/src/test/java/com/google/protobuf/CodedInputStreamTest.java",
                "status": "modified",
                "additions": 158,
                "deletions": 0,
                "changes": 158,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStreamTest.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Fcore%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStreamTest.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStreamTest.java?ref=4728531c162f2f9e8c2ca1add713cfee2db6be3b",
                "patch": "@@ -11,6 +11,9 @@\n import static com.google.common.truth.Truth.assertWithMessage;\n import static org.junit.Assert.assertArrayEquals;\n import static org.junit.Assert.assertThrows;\n+\n+import com.google.common.primitives.Bytes;\n+import map_test.MapTestProto.MapContainer;\n import protobuf_unittest.UnittestProto.BoolMessage;\n import protobuf_unittest.UnittestProto.Int32Message;\n import protobuf_unittest.UnittestProto.Int64Message;\n@@ -35,6 +38,13 @@ public class CodedInputStreamTest {\n \n   private static final int DEFAULT_BLOCK_SIZE = 4096;\n \n+  private static final int GROUP_TAP = WireFormat.makeTag(3, WireFormat.WIRETYPE_START_GROUP);\n+\n+  private static final byte[] NESTING_SGROUP = generateSGroupTags();\n+\n+  private static final byte[] NESTING_SGROUP_WITH_INITIAL_BYTES = generateSGroupTagsForMapField();\n+\n+\n   private enum InputType {\n     ARRAY {\n       @Override\n@@ -117,6 +127,17 @@ private byte[] bytes(int... bytesAsInts) {\n     return bytes;\n   }\n \n+  private static byte[] generateSGroupTags() {\n+    byte[] bytes = new byte[100000];\n+    Arrays.fill(bytes, (byte) GROUP_TAP);\n+    return bytes;\n+  }\n+\n+  private static byte[] generateSGroupTagsForMapField() {\n+    byte[] initialBytes = {18, 1, 75, 26, (byte) 198, (byte) 154, 12};\n+    return Bytes.concat(initialBytes, NESTING_SGROUP);\n+  }\n+\n   /**\n    * An InputStream which limits the number of bytes it reads at a time. We use this to make sure\n    * that CodedInputStream doesn't screw up when reading in small blocks.\n@@ -740,6 +761,143 @@ public void testMaliciousRecursion() throws Exception {\n     }\n   }\n \n+  @Test\n+  public void testMaliciousRecursion_unknownFields() throws Exception {\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestRecursiveMessage.parseFrom(NESTING_SGROUP));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousRecursion_skippingUnknownField() throws Exception {\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () ->\n+                DiscardUnknownFieldsParser.wrap(TestRecursiveMessage.parser())\n+                    .parseFrom(NESTING_SGROUP));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromInputStream() throws Exception {\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () ->\n+                MapContainer.parseFrom(\n+                    new ByteArrayInputStream(NESTING_SGROUP_WITH_INITIAL_BYTES)));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () ->\n+                MapContainer.newBuilder()\n+                    .mergeFrom(new ByteArrayInputStream(NESTING_SGROUP_WITH_INITIAL_BYTES)));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_inputStream_skipMessage() throws Exception {\n+    ByteArrayInputStream inputSteam = new ByteArrayInputStream(NESTING_SGROUP);\n+    CodedInputStream input = CodedInputStream.newInstance(inputSteam);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromByteArray() throws Exception {\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(NESTING_SGROUP_WITH_INITIAL_BYTES));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.newBuilder().mergeFrom(NESTING_SGROUP_WITH_INITIAL_BYTES));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"the input ended unexpectedly in the middle of a field\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"the input ended unexpectedly in the middle of a field\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_arrayDecoder_skipMessage() throws Exception {\n+    CodedInputStream input = CodedInputStream.newInstance(NESTING_SGROUP);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromByteBuffer() throws Exception {\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(ByteBuffer.wrap(NESTING_SGROUP_WITH_INITIAL_BYTES)));\n+\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .contains(\"the input ended unexpectedly in the middle of a field\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_byteBuffer_skipMessage() throws Exception {\n+    CodedInputStream input = InputType.NIO_DIRECT.newDecoder(NESTING_SGROUP);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_iterableByteBuffer() throws Exception {\n+    CodedInputStream input = InputType.ITER_DIRECT.newDecoder(NESTING_SGROUP);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n   private void checkSizeLimitExceeded(InvalidProtocolBufferException e) {\n     assertThat(e)\n         .hasMessageThat()"
            },
            {
                "sha": "1fc9c56071609a4abe057dfc0260e0c259dc3b68",
                "filename": "java/lite/src/test/java/com/google/protobuf/LiteTest.java",
                "status": "modified",
                "additions": 232,
                "deletions": 0,
                "changes": 232,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/4728531c162f2f9e8c2ca1add713cfee2db6be3b/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java?ref=4728531c162f2f9e8c2ca1add713cfee2db6be3b",
                "patch": "@@ -2463,6 +2463,211 @@ public void testParseFromByteBufferThrows() {\n     }\n   }\n \n+  @Test\n+  public void testParseFromInputStream_concurrent_nestingUnknownGroups() throws Exception {\n+    int numThreads = 200;\n+    ArrayList<Thread> threads = new ArrayList<>();\n+\n+    ByteString byteString = generateNestingGroups(99);\n+    AtomicBoolean thrown = new AtomicBoolean(false);\n+\n+    for (int i = 0; i < numThreads; i++) {\n+      Thread thread =\n+          new Thread(\n+              () -> {\n+                try {\n+                  TestAllTypesLite unused = TestAllTypesLite.parseFrom(byteString);\n+                } catch (IOException e) {\n+                  if (e.getMessage().contains(\"Protocol message had too many levels of nesting\")) {\n+                    thrown.set(true);\n+                  }\n+                }\n+              });\n+      thread.start();\n+      threads.add(thread);\n+    }\n+\n+    for (Thread thread : threads) {\n+      thread.join();\n+    }\n+\n+    assertThat(thrown.get()).isFalse();\n+  }\n+\n+  @Test\n+  public void testParseFromInputStream_nestingUnknownGroups() throws IOException {\n+    ByteString byteString = generateNestingGroups(99);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> TestAllTypesLite.parseFrom(byteString));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromInputStream_nestingUnknownGroups_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(100);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> TestAllTypesLite.parseFrom(byteString));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromInputStream_setRecursionLimit_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(199);\n+    UnknownFieldSchema<?, ?> schema = SchemaUtil.unknownFieldSetLiteSchema();\n+    schema.setRecursionLimit(200);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> TestAllTypesLite.parseFrom(byteString));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+    schema.setRecursionLimit(UnknownFieldSchema.DEFAULT_RECURSION_LIMIT);\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_concurrent_nestingUnknownGroups() throws Exception {\n+    int numThreads = 200;\n+    ArrayList<Thread> threads = new ArrayList<>();\n+\n+    ByteString byteString = generateNestingGroups(99);\n+    AtomicBoolean thrown = new AtomicBoolean(false);\n+\n+    for (int i = 0; i < numThreads; i++) {\n+      Thread thread =\n+          new Thread(\n+              () -> {\n+                try {\n+                  // Should pass in byte[] instead of ByteString to go into ArrayDecoders.\n+                  TestAllTypesLite unused = TestAllTypesLite.parseFrom(byteString.toByteArray());\n+                } catch (InvalidProtocolBufferException e) {\n+                  if (e.getMessage().contains(\"Protocol message had too many levels of nesting\")) {\n+                    thrown.set(true);\n+                  }\n+                }\n+              });\n+      thread.start();\n+      threads.add(thread);\n+    }\n+\n+    for (Thread thread : threads) {\n+      thread.join();\n+    }\n+\n+    assertThat(thrown.get()).isFalse();\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_nestingUnknownGroups() throws IOException {\n+    ByteString byteString = generateNestingGroups(99);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestAllTypesLite.parseFrom(byteString.toByteArray()));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_nestingUnknownGroups_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(100);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestAllTypesLite.parseFrom(byteString.toByteArray()));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_setRecursionLimit_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(199);\n+    ArrayDecoders.setRecursionLimit(200);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestAllTypesLite.parseFrom(byteString.toByteArray()));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+    ArrayDecoders.setRecursionLimit(ArrayDecoders.DEFAULT_RECURSION_LIMIT);\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_recursiveMessages() throws Exception {\n+    byte[] data99 = makeRecursiveMessage(99).toByteArray();\n+    byte[] data100 = makeRecursiveMessage(100).toByteArray();\n+\n+    RecursiveMessage unused = RecursiveMessage.parseFrom(data99);\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> RecursiveMessage.parseFrom(data100));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_recursiveKnownGroups() throws Exception {\n+    byte[] data99 = makeRecursiveGroup(99).toByteArray();\n+    byte[] data100 = makeRecursiveGroup(100).toByteArray();\n+\n+    RecursiveGroup unused = RecursiveGroup.parseFrom(data99);\n+    Throwable thrown =\n+        assertThrows(InvalidProtocolBufferException.class, () -> RecursiveGroup.parseFrom(data100));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  @SuppressWarnings(\"ProtoParseFromByteString\")\n+  public void testMaliciousSGroupTagsWithMapField_fromByteArray() throws Exception {\n+    ByteString byteString = generateNestingGroups(102);\n+\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(byteString.toByteArray()));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.newBuilder().mergeFrom(byteString.toByteArray()));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromInputStream() throws Exception {\n+    byte[] bytes = generateNestingGroups(101).toByteArray();\n+\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(new ByteArrayInputStream(bytes)));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.newBuilder().mergeFrom(new ByteArrayInputStream(bytes)));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n   @Test\n   public void testParseFromByteBuffer_extensions() throws Exception {\n     TestAllExtensionsLite message =\n@@ -2819,4 +3024,31 @@ private static boolean contains(ByteString a, ByteString b) {\n     }\n     return false;\n   }\n+\n+  private static ByteString generateNestingGroups(int num) throws IOException {\n+    int groupTap = WireFormat.makeTag(3, WireFormat.WIRETYPE_START_GROUP);\n+    ByteString.Output byteStringOutput = ByteString.newOutput();\n+    CodedOutputStream codedOutput = CodedOutputStream.newInstance(byteStringOutput);\n+    for (int i = 0; i < num; i++) {\n+      codedOutput.writeInt32NoTag(groupTap);\n+    }\n+    codedOutput.flush();\n+    return byteStringOutput.toByteString();\n+  }\n+\n+  private static RecursiveMessage makeRecursiveMessage(int num) {\n+    if (num == 0) {\n+      return RecursiveMessage.getDefaultInstance();\n+    } else {\n+      return RecursiveMessage.newBuilder().setRecurse(makeRecursiveMessage(num - 1)).build();\n+    }\n+  }\n+\n+  private static RecursiveGroup makeRecursiveGroup(int num) {\n+    if (num == 0) {\n+      return RecursiveGroup.getDefaultInstance();\n+    } else {\n+      return RecursiveGroup.newBuilder().setRecurse(makeRecursiveGroup(num - 1)).build();\n+    }\n+  }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/d6c82fc55a76481c676f541a255571e8950bb8c3",
        "url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/d6c82fc55a76481c676f541a255571e8950bb8c3",
        "html_url": "https://github.com/protocolbuffers/protobuf/commit/d6c82fc55a76481c676f541a255571e8950bb8c3",
        "message": "Add recursion check when parsing unknown fields in Java.  (#18388)\n\n* Internal change\r\n\r\nPiperOrigin-RevId: 663919912\r\n\r\n* Internal change\r\n\r\nPiperOrigin-RevId: 653615736\r\n\r\n* Add recursion check when parsing unknown fields in Java.\r\n\r\nPiperOrigin-RevId: 675657198\r\n\r\n---------\r\n\r\nCo-authored-by: Protobuf Team Bot <protobuf-github-bot@google.com>",
        "files": [
            {
                "sha": "1f7b0cb5b8bbb34e59598271cf8db0d59acb498e",
                "filename": "java/core/BUILD.bazel",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2FBUILD.bazel",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2FBUILD.bazel",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2FBUILD.bazel?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -608,6 +608,7 @@ junit_tests(\n             \"src/test/java/com/google/protobuf/DescriptorsTest.java\",\n             \"src/test/java/com/google/protobuf/DebugFormatTest.java\",\n             \"src/test/java/com/google/protobuf/CodedOutputStreamTest.java\",\n+            \"src/test/java/com/google/protobuf/CodedInputStreamTest.java\",\n             \"src/test/java/com/google/protobuf/ProtobufToStringOutputTest.java\",\n             # Excluded in core_tests\n             \"src/test/java/com/google/protobuf/DecodeUtf8Test.java\",\n@@ -656,6 +657,7 @@ junit_tests(\n             \"src/test/java/com/google/protobuf/DescriptorsTest.java\",\n             \"src/test/java/com/google/protobuf/DebugFormatTest.java\",\n             \"src/test/java/com/google/protobuf/CodedOutputStreamTest.java\",\n+            \"src/test/java/com/google/protobuf/CodedInputStreamTest.java\",\n             \"src/test/java/com/google/protobuf/ProtobufToStringOutputTest.java\",\n             # Excluded in core_tests\n             \"src/test/java/com/google/protobuf/DecodeUtf8Test.java\","
            },
            {
                "sha": "bf5f922b073c5cd30eb9075337a3396a0dbdc40f",
                "filename": "java/core/src/main/java/com/google/protobuf/ArrayDecoders.java",
                "status": "modified",
                "additions": 29,
                "deletions": 2,
                "changes": 31,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -23,9 +23,12 @@\n  */\n @CheckReturnValue\n final class ArrayDecoders {\n+  static final int DEFAULT_RECURSION_LIMIT = 100;\n \n-  private ArrayDecoders() {\n-  }\n+  @SuppressWarnings(\"NonFinalStaticField\")\n+  private static volatile int recursionLimit = DEFAULT_RECURSION_LIMIT;\n+\n+  private ArrayDecoders() {}\n \n   /**\n    * A helper used to return multiple values in a Java function. Java doesn't natively support\n@@ -38,6 +41,7 @@ static final class Registers {\n     public long long1;\n     public Object object1;\n     public final ExtensionRegistryLite extensionRegistry;\n+    public int recursionDepth;\n \n     Registers() {\n       this.extensionRegistry = ExtensionRegistryLite.getEmptyRegistry();\n@@ -245,7 +249,10 @@ static int mergeMessageField(\n     if (length < 0 || length > limit - position) {\n       throw InvalidProtocolBufferException.truncatedMessage();\n     }\n+    registers.recursionDepth++;\n+    checkRecursionLimit(registers.recursionDepth);\n     schema.mergeFrom(msg, data, position, position + length, registers);\n+    registers.recursionDepth--;\n     registers.object1 = msg;\n     return position + length;\n   }\n@@ -263,8 +270,11 @@ static int mergeGroupField(\n     // A group field must has a MessageSchema (the only other subclass of Schema is MessageSetSchema\n     // and it can't be used in group fields).\n     final MessageSchema messageSchema = (MessageSchema) schema;\n+    registers.recursionDepth++;\n+    checkRecursionLimit(registers.recursionDepth);\n     final int endPosition =\n         messageSchema.parseMessage(msg, data, position, limit, endGroup, registers);\n+    registers.recursionDepth--;\n     registers.object1 = msg;\n     return endPosition;\n   }\n@@ -1025,6 +1035,8 @@ static int decodeUnknownField(\n         final UnknownFieldSetLite child = UnknownFieldSetLite.newInstance();\n         final int endGroup = (tag & ~0x7) | WireFormat.WIRETYPE_END_GROUP;\n         int lastTag = 0;\n+        registers.recursionDepth++;\n+        checkRecursionLimit(registers.recursionDepth);\n         while (position < limit) {\n           position = decodeVarint32(data, position, registers);\n           lastTag = registers.int1;\n@@ -1033,6 +1045,7 @@ static int decodeUnknownField(\n           }\n           position = decodeUnknownField(lastTag, data, position, limit, child, registers);\n         }\n+        registers.recursionDepth--;\n         if (position > limit || lastTag != endGroup) {\n           throw InvalidProtocolBufferException.parseFailure();\n         }\n@@ -1079,4 +1092,18 @@ static int skipField(int tag, byte[] data, int position, int limit, Registers re\n         throw InvalidProtocolBufferException.invalidTag();\n     }\n   }\n+\n+  /**\n+   * Set the maximum recursion limit that ArrayDecoders will allow. An exception will be thrown if\n+   * the depth of the message exceeds this limit.\n+   */\n+  public static void setRecursionLimit(int limit) {\n+    recursionLimit = limit;\n+  }\n+\n+  private static void checkRecursionLimit(int depth) throws InvalidProtocolBufferException {\n+    if (depth >= recursionLimit) {\n+      throw InvalidProtocolBufferException.recursionLimitExceeded();\n+    }\n+  }\n }"
            },
            {
                "sha": "6b3573bf92f10006a469a9a2777393e7c73fee93",
                "filename": "java/core/src/main/java/com/google/protobuf/CodedInputStream.java",
                "status": "modified",
                "additions": 30,
                "deletions": 82,
                "changes": 112,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStream.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStream.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStream.java?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -224,13 +224,41 @@ public abstract boolean skipField(final int tag, final CodedOutputStream output)\n    * Reads and discards an entire message. This will read either until EOF or until an endgroup tag,\n    * whichever comes first.\n    */\n-  public abstract void skipMessage() throws IOException;\n+  public void skipMessage() throws IOException {\n+    while (true) {\n+      final int tag = readTag();\n+      if (tag == 0) {\n+        return;\n+      }\n+      checkRecursionLimit();\n+      ++recursionDepth;\n+      boolean fieldSkipped = skipField(tag);\n+      --recursionDepth;\n+      if (!fieldSkipped) {\n+        return;\n+      }\n+    }\n+  }\n \n   /**\n    * Reads an entire message and writes it to output in wire format. This will read either until EOF\n    * or until an endgroup tag, whichever comes first.\n    */\n-  public abstract void skipMessage(CodedOutputStream output) throws IOException;\n+  public void skipMessage(CodedOutputStream output) throws IOException {\n+    while (true) {\n+      final int tag = readTag();\n+      if (tag == 0) {\n+        return;\n+      }\n+      checkRecursionLimit();\n+      ++recursionDepth;\n+      boolean fieldSkipped = skipField(tag, output);\n+      --recursionDepth;\n+      if (!fieldSkipped) {\n+        return;\n+      }\n+    }\n+  }\n \n   // -----------------------------------------------------------------\n \n@@ -700,26 +728,6 @@ public boolean skipField(final int tag, final CodedOutputStream output) throws I\n       }\n     }\n \n-    @Override\n-    public void skipMessage() throws IOException {\n-      while (true) {\n-        final int tag = readTag();\n-        if (tag == 0 || !skipField(tag)) {\n-          return;\n-        }\n-      }\n-    }\n-\n-    @Override\n-    public void skipMessage(CodedOutputStream output) throws IOException {\n-      while (true) {\n-        final int tag = readTag();\n-        if (tag == 0 || !skipField(tag, output)) {\n-          return;\n-        }\n-      }\n-    }\n-\n     // -----------------------------------------------------------------\n \n     @Override\n@@ -1412,26 +1420,6 @@ public boolean skipField(final int tag, final CodedOutputStream output) throws I\n       }\n     }\n \n-    @Override\n-    public void skipMessage() throws IOException {\n-      while (true) {\n-        final int tag = readTag();\n-        if (tag == 0 || !skipField(tag)) {\n-          return;\n-        }\n-      }\n-    }\n-\n-    @Override\n-    public void skipMessage(CodedOutputStream output) throws IOException {\n-      while (true) {\n-        final int tag = readTag();\n-        if (tag == 0 || !skipField(tag, output)) {\n-          return;\n-        }\n-      }\n-    }\n-\n     // -----------------------------------------------------------------\n \n     @Override\n@@ -2178,26 +2166,6 @@ public boolean skipField(final int tag, final CodedOutputStream output) throws I\n       }\n     }\n \n-    @Override\n-    public void skipMessage() throws IOException {\n-      while (true) {\n-        final int tag = readTag();\n-        if (tag == 0 || !skipField(tag)) {\n-          return;\n-        }\n-      }\n-    }\n-\n-    @Override\n-    public void skipMessage(CodedOutputStream output) throws IOException {\n-      while (true) {\n-        final int tag = readTag();\n-        if (tag == 0 || !skipField(tag, output)) {\n-          return;\n-        }\n-      }\n-    }\n-\n     /** Collects the bytes skipped and returns the data in a ByteBuffer. */\n     private class SkippedDataSink implements RefillCallback {\n       private int lastPos = pos;\n@@ -3322,26 +3290,6 @@ public boolean skipField(final int tag, final CodedOutputStream output) throws I\n       }\n     }\n \n-    @Override\n-    public void skipMessage() throws IOException {\n-      while (true) {\n-        final int tag = readTag();\n-        if (tag == 0 || !skipField(tag)) {\n-          return;\n-        }\n-      }\n-    }\n-\n-    @Override\n-    public void skipMessage(CodedOutputStream output) throws IOException {\n-      while (true) {\n-        final int tag = readTag();\n-        if (tag == 0 || !skipField(tag, output)) {\n-          return;\n-        }\n-      }\n-    }\n-\n     // -----------------------------------------------------------------\n \n     @Override"
            },
            {
                "sha": "dbcb9e899dbee203b8418d626f421dc357fed1c6",
                "filename": "java/core/src/main/java/com/google/protobuf/InvalidProtocolBufferException.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -132,7 +132,7 @@ public InvalidWireTypeException(String description) {\n   static InvalidProtocolBufferException recursionLimitExceeded() {\n     return new InvalidProtocolBufferException(\n         \"Protocol message had too many levels of nesting.  May be malicious.  \"\n-            + \"Use CodedInputStream.setRecursionLimit() to increase the depth limit.\");\n+            + \"Use setRecursionLimit() to increase the recursion depth limit.\");\n   }\n \n   static InvalidProtocolBufferException sizeLimitExceeded() {"
            },
            {
                "sha": "5ad6762b0dc4e0179971d5ca7365855d20d36098",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSchema.java",
                "status": "modified",
                "additions": 6,
                "deletions": 3,
                "changes": 9,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -3006,7 +3006,8 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n             // Unknown field.\n-            if (unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n+            if (unknownFieldSchema.mergeOneFieldFrom(\n+                unknownFields, reader, /* currentDepth= */ 0)) {\n               continue;\n             }\n           }\n@@ -3381,7 +3382,8 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               if (unknownFields == null) {\n                 unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n               }\n-              if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n+              if (!unknownFieldSchema.mergeOneFieldFrom(\n+                  unknownFields, reader, /* currentDepth= */ 0)) {\n                 return;\n               }\n               break;\n@@ -3397,7 +3399,8 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n             if (unknownFields == null) {\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n-            if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n+            if (!unknownFieldSchema.mergeOneFieldFrom(\n+                unknownFields, reader, /* currentDepth= */ 0)) {\n               return;\n             }\n           }"
            },
            {
                "sha": "ec37d41f98c5a431f95edf91090835429a68567b",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSetSchema.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -278,7 +278,7 @@ boolean parseMessageSetItemOrUnknownField(\n               reader, extension, extensionRegistry, extensions);\n           return true;\n         } else {\n-          return unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader);\n+          return unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader, /* currentDepth= */ 0);\n         }\n       } else {\n         return reader.skipField();"
            },
            {
                "sha": "80602b16359aa378d120704a271a98b856039b71",
                "filename": "java/core/src/main/java/com/google/protobuf/UnknownFieldSchema.java",
                "status": "modified",
                "additions": 24,
                "deletions": 4,
                "changes": 28,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -13,6 +13,11 @@\n @CheckReturnValue\n abstract class UnknownFieldSchema<T, B> {\n \n+  static final int DEFAULT_RECURSION_LIMIT = 100;\n+\n+  @SuppressWarnings(\"NonFinalStaticField\")\n+  private static volatile int recursionLimit = DEFAULT_RECURSION_LIMIT;\n+\n   /** Whether unknown fields should be dropped. */\n   abstract boolean shouldDiscardUnknownFields(Reader reader);\n \n@@ -56,7 +61,8 @@ abstract class UnknownFieldSchema<T, B> {\n   abstract void makeImmutable(Object message);\n \n   /** Merges one field into the unknown fields. */\n-  final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOException {\n+  final boolean mergeOneFieldFrom(B unknownFields, Reader reader, int currentDepth)\n+      throws IOException {\n     int tag = reader.getTag();\n     int fieldNumber = WireFormat.getTagFieldNumber(tag);\n     switch (WireFormat.getTagWireType(tag)) {\n@@ -75,7 +81,12 @@ final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOExcepti\n       case WireFormat.WIRETYPE_START_GROUP:\n         final B subFields = newBuilder();\n         int endGroupTag = WireFormat.makeTag(fieldNumber, WireFormat.WIRETYPE_END_GROUP);\n-        mergeFrom(subFields, reader);\n+        currentDepth++;\n+        if (currentDepth >= recursionLimit) {\n+          throw InvalidProtocolBufferException.recursionLimitExceeded();\n+        }\n+        mergeFrom(subFields, reader, currentDepth);\n+        currentDepth--;\n         if (endGroupTag != reader.getTag()) {\n           throw InvalidProtocolBufferException.invalidEndTag();\n         }\n@@ -88,10 +99,11 @@ final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOExcepti\n     }\n   }\n \n-  final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n+  private final void mergeFrom(B unknownFields, Reader reader, int currentDepth)\n+      throws IOException {\n     while (true) {\n       if (reader.getFieldNumber() == Reader.READ_DONE\n-          || !mergeOneFieldFrom(unknownFields, reader)) {\n+          || !mergeOneFieldFrom(unknownFields, reader, currentDepth)) {\n         break;\n       }\n     }\n@@ -108,4 +120,12 @@ final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n   abstract int getSerializedSizeAsMessageSet(T message);\n \n   abstract int getSerializedSize(T unknowns);\n+\n+  /**\n+   * Set the maximum recursion limit that ArrayDecoders will allow. An exception will be thrown if\n+   * the depth of the message exceeds this limit.\n+   */\n+  public void setRecursionLimit(int limit) {\n+    recursionLimit = limit;\n+  }\n }"
            },
            {
                "sha": "f73cb3b0eecf35489f99cf754b03fc192d36aee8",
                "filename": "java/core/src/test/java/com/google/protobuf/CodedInputStreamTest.java",
                "status": "modified",
                "additions": 158,
                "deletions": 0,
                "changes": 158,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStreamTest.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStreamTest.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStreamTest.java?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -11,6 +11,9 @@\n import static com.google.common.truth.Truth.assertWithMessage;\n import static org.junit.Assert.assertArrayEquals;\n import static org.junit.Assert.assertThrows;\n+\n+import com.google.common.primitives.Bytes;\n+import map_test.MapTestProto.MapContainer;\n import protobuf_unittest.UnittestProto.BoolMessage;\n import protobuf_unittest.UnittestProto.Int32Message;\n import protobuf_unittest.UnittestProto.Int64Message;\n@@ -35,6 +38,13 @@ public class CodedInputStreamTest {\n \n   private static final int DEFAULT_BLOCK_SIZE = 4096;\n \n+  private static final int GROUP_TAP = WireFormat.makeTag(3, WireFormat.WIRETYPE_START_GROUP);\n+\n+  private static final byte[] NESTING_SGROUP = generateSGroupTags();\n+\n+  private static final byte[] NESTING_SGROUP_WITH_INITIAL_BYTES = generateSGroupTagsForMapField();\n+\n+\n   private enum InputType {\n     ARRAY {\n       @Override\n@@ -117,6 +127,17 @@ private byte[] bytes(int... bytesAsInts) {\n     return bytes;\n   }\n \n+  private static byte[] generateSGroupTags() {\n+    byte[] bytes = new byte[100000];\n+    Arrays.fill(bytes, (byte) GROUP_TAP);\n+    return bytes;\n+  }\n+\n+  private static byte[] generateSGroupTagsForMapField() {\n+    byte[] initialBytes = {18, 1, 75, 26, (byte) 198, (byte) 154, 12};\n+    return Bytes.concat(initialBytes, NESTING_SGROUP);\n+  }\n+\n   /**\n    * An InputStream which limits the number of bytes it reads at a time. We use this to make sure\n    * that CodedInputStream doesn't screw up when reading in small blocks.\n@@ -740,6 +761,143 @@ public void testMaliciousRecursion() throws Exception {\n     }\n   }\n \n+  @Test\n+  public void testMaliciousRecursion_unknownFields() throws Exception {\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestRecursiveMessage.parseFrom(NESTING_SGROUP));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousRecursion_skippingUnknownField() throws Exception {\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () ->\n+                DiscardUnknownFieldsParser.wrap(TestRecursiveMessage.parser())\n+                    .parseFrom(NESTING_SGROUP));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromInputStream() throws Exception {\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () ->\n+                MapContainer.parseFrom(\n+                    new ByteArrayInputStream(NESTING_SGROUP_WITH_INITIAL_BYTES)));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () ->\n+                MapContainer.newBuilder()\n+                    .mergeFrom(new ByteArrayInputStream(NESTING_SGROUP_WITH_INITIAL_BYTES)));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_inputStream_skipMessage() throws Exception {\n+    ByteArrayInputStream inputSteam = new ByteArrayInputStream(NESTING_SGROUP);\n+    CodedInputStream input = CodedInputStream.newInstance(inputSteam);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromByteArray() throws Exception {\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(NESTING_SGROUP_WITH_INITIAL_BYTES));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.newBuilder().mergeFrom(NESTING_SGROUP_WITH_INITIAL_BYTES));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"the input ended unexpectedly in the middle of a field\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"the input ended unexpectedly in the middle of a field\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_arrayDecoder_skipMessage() throws Exception {\n+    CodedInputStream input = CodedInputStream.newInstance(NESTING_SGROUP);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromByteBuffer() throws Exception {\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(ByteBuffer.wrap(NESTING_SGROUP_WITH_INITIAL_BYTES)));\n+\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .contains(\"the input ended unexpectedly in the middle of a field\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_byteBuffer_skipMessage() throws Exception {\n+    CodedInputStream input = InputType.NIO_DIRECT.newDecoder(NESTING_SGROUP);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_iterableByteBuffer() throws Exception {\n+    CodedInputStream input = InputType.ITER_DIRECT.newDecoder(NESTING_SGROUP);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n   private void checkSizeLimitExceeded(InvalidProtocolBufferException e) {\n     assertThat(e)\n         .hasMessageThat()"
            },
            {
                "sha": "c40ea5461efac4e8141869c2f20067a24cad7048",
                "filename": "java/core/src/test/proto/com/google/protobuf/map_lite_test.proto",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Ftest%2Fproto%2Fcom%2Fgoogle%2Fprotobuf%2Fmap_lite_test.proto",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Ftest%2Fproto%2Fcom%2Fgoogle%2Fprotobuf%2Fmap_lite_test.proto",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Ftest%2Fproto%2Fcom%2Fgoogle%2Fprotobuf%2Fmap_lite_test.proto?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -115,4 +115,5 @@ message ReservedAsMapFieldWithEnumValue {\n // https://github.com/protocolbuffers/protobuf/issues/9785\n message MapContainer {\n   map<string, string> my_map = 1;\n+  map<uint32, string> m = 3;\n }"
            },
            {
                "sha": "80bdc0d8532d8cf2fcfc93097b7a67a086167d34",
                "filename": "java/core/src/test/proto/com/google/protobuf/map_test.proto",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Ftest%2Fproto%2Fcom%2Fgoogle%2Fprotobuf%2Fmap_test.proto",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Fcore%2Fsrc%2Ftest%2Fproto%2Fcom%2Fgoogle%2Fprotobuf%2Fmap_test.proto",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Ftest%2Fproto%2Fcom%2Fgoogle%2Fprotobuf%2Fmap_test.proto?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -114,4 +114,5 @@ message ReservedAsMapFieldWithEnumValue {\n // https://github.com/protocolbuffers/protobuf/issues/9785\n message MapContainer {\n   map<string, string> my_map = 1;\n+  map<uint32, string> m = 3;\n }"
            },
            {
                "sha": "1fc9c56071609a4abe057dfc0260e0c259dc3b68",
                "filename": "java/lite/src/test/java/com/google/protobuf/LiteTest.java",
                "status": "modified",
                "additions": 236,
                "deletions": 0,
                "changes": 236,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -10,12 +10,14 @@\n import static com.google.common.truth.Truth.assertThat;\n import static com.google.common.truth.Truth.assertWithMessage;\n import static java.util.Collections.singletonList;\n+import static org.junit.Assert.assertThrows;\n \n import com.google.protobuf.FieldPresenceTestProto.TestAllTypes;\n import com.google.protobuf.UnittestImportLite.ImportEnumLite;\n import com.google.protobuf.UnittestImportPublicLite.PublicImportMessageLite;\n import com.google.protobuf.UnittestLite.ForeignEnumLite;\n import com.google.protobuf.UnittestLite.ForeignMessageLite;\n+import com.google.protobuf.UnittestLite.RecursiveGroup;\n import com.google.protobuf.UnittestLite.RecursiveMessage;\n import com.google.protobuf.UnittestLite.TestAllExtensionsLite;\n import com.google.protobuf.UnittestLite.TestAllTypesLite;\n@@ -29,6 +31,7 @@\n import com.google.protobuf.UnittestLite.TestHugeFieldNumbersLite;\n import com.google.protobuf.UnittestLite.TestNestedExtensionLite;\n import com.google.protobuf.testing.Proto3TestingLite.Proto3MessageLite;\n+import map_lite_test.MapTestProto.MapContainer;\n import map_lite_test.MapTestProto.TestMap;\n import map_lite_test.MapTestProto.TestMap.MessageValue;\n import protobuf_unittest.NestedExtensionLite;\n@@ -50,6 +53,7 @@\n import java.util.Arrays;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.concurrent.atomic.AtomicBoolean;\n import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n@@ -2459,6 +2463,211 @@ public void testParseFromByteBufferThrows() {\n     }\n   }\n \n+  @Test\n+  public void testParseFromInputStream_concurrent_nestingUnknownGroups() throws Exception {\n+    int numThreads = 200;\n+    ArrayList<Thread> threads = new ArrayList<>();\n+\n+    ByteString byteString = generateNestingGroups(99);\n+    AtomicBoolean thrown = new AtomicBoolean(false);\n+\n+    for (int i = 0; i < numThreads; i++) {\n+      Thread thread =\n+          new Thread(\n+              () -> {\n+                try {\n+                  TestAllTypesLite unused = TestAllTypesLite.parseFrom(byteString);\n+                } catch (IOException e) {\n+                  if (e.getMessage().contains(\"Protocol message had too many levels of nesting\")) {\n+                    thrown.set(true);\n+                  }\n+                }\n+              });\n+      thread.start();\n+      threads.add(thread);\n+    }\n+\n+    for (Thread thread : threads) {\n+      thread.join();\n+    }\n+\n+    assertThat(thrown.get()).isFalse();\n+  }\n+\n+  @Test\n+  public void testParseFromInputStream_nestingUnknownGroups() throws IOException {\n+    ByteString byteString = generateNestingGroups(99);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> TestAllTypesLite.parseFrom(byteString));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromInputStream_nestingUnknownGroups_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(100);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> TestAllTypesLite.parseFrom(byteString));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromInputStream_setRecursionLimit_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(199);\n+    UnknownFieldSchema<?, ?> schema = SchemaUtil.unknownFieldSetLiteSchema();\n+    schema.setRecursionLimit(200);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> TestAllTypesLite.parseFrom(byteString));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+    schema.setRecursionLimit(UnknownFieldSchema.DEFAULT_RECURSION_LIMIT);\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_concurrent_nestingUnknownGroups() throws Exception {\n+    int numThreads = 200;\n+    ArrayList<Thread> threads = new ArrayList<>();\n+\n+    ByteString byteString = generateNestingGroups(99);\n+    AtomicBoolean thrown = new AtomicBoolean(false);\n+\n+    for (int i = 0; i < numThreads; i++) {\n+      Thread thread =\n+          new Thread(\n+              () -> {\n+                try {\n+                  // Should pass in byte[] instead of ByteString to go into ArrayDecoders.\n+                  TestAllTypesLite unused = TestAllTypesLite.parseFrom(byteString.toByteArray());\n+                } catch (InvalidProtocolBufferException e) {\n+                  if (e.getMessage().contains(\"Protocol message had too many levels of nesting\")) {\n+                    thrown.set(true);\n+                  }\n+                }\n+              });\n+      thread.start();\n+      threads.add(thread);\n+    }\n+\n+    for (Thread thread : threads) {\n+      thread.join();\n+    }\n+\n+    assertThat(thrown.get()).isFalse();\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_nestingUnknownGroups() throws IOException {\n+    ByteString byteString = generateNestingGroups(99);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestAllTypesLite.parseFrom(byteString.toByteArray()));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_nestingUnknownGroups_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(100);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestAllTypesLite.parseFrom(byteString.toByteArray()));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_setRecursionLimit_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(199);\n+    ArrayDecoders.setRecursionLimit(200);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestAllTypesLite.parseFrom(byteString.toByteArray()));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+    ArrayDecoders.setRecursionLimit(ArrayDecoders.DEFAULT_RECURSION_LIMIT);\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_recursiveMessages() throws Exception {\n+    byte[] data99 = makeRecursiveMessage(99).toByteArray();\n+    byte[] data100 = makeRecursiveMessage(100).toByteArray();\n+\n+    RecursiveMessage unused = RecursiveMessage.parseFrom(data99);\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> RecursiveMessage.parseFrom(data100));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_recursiveKnownGroups() throws Exception {\n+    byte[] data99 = makeRecursiveGroup(99).toByteArray();\n+    byte[] data100 = makeRecursiveGroup(100).toByteArray();\n+\n+    RecursiveGroup unused = RecursiveGroup.parseFrom(data99);\n+    Throwable thrown =\n+        assertThrows(InvalidProtocolBufferException.class, () -> RecursiveGroup.parseFrom(data100));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  @SuppressWarnings(\"ProtoParseFromByteString\")\n+  public void testMaliciousSGroupTagsWithMapField_fromByteArray() throws Exception {\n+    ByteString byteString = generateNestingGroups(102);\n+\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(byteString.toByteArray()));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.newBuilder().mergeFrom(byteString.toByteArray()));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromInputStream() throws Exception {\n+    byte[] bytes = generateNestingGroups(101).toByteArray();\n+\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(new ByteArrayInputStream(bytes)));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.newBuilder().mergeFrom(new ByteArrayInputStream(bytes)));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n   @Test\n   public void testParseFromByteBuffer_extensions() throws Exception {\n     TestAllExtensionsLite message =\n@@ -2815,4 +3024,31 @@ private static boolean contains(ByteString a, ByteString b) {\n     }\n     return false;\n   }\n+\n+  private static ByteString generateNestingGroups(int num) throws IOException {\n+    int groupTap = WireFormat.makeTag(3, WireFormat.WIRETYPE_START_GROUP);\n+    ByteString.Output byteStringOutput = ByteString.newOutput();\n+    CodedOutputStream codedOutput = CodedOutputStream.newInstance(byteStringOutput);\n+    for (int i = 0; i < num; i++) {\n+      codedOutput.writeInt32NoTag(groupTap);\n+    }\n+    codedOutput.flush();\n+    return byteStringOutput.toByteString();\n+  }\n+\n+  private static RecursiveMessage makeRecursiveMessage(int num) {\n+    if (num == 0) {\n+      return RecursiveMessage.getDefaultInstance();\n+    } else {\n+      return RecursiveMessage.newBuilder().setRecurse(makeRecursiveMessage(num - 1)).build();\n+    }\n+  }\n+\n+  private static RecursiveGroup makeRecursiveGroup(int num) {\n+    if (num == 0) {\n+      return RecursiveGroup.getDefaultInstance();\n+    } else {\n+      return RecursiveGroup.newBuilder().setRecurse(makeRecursiveGroup(num - 1)).build();\n+    }\n+  }\n }"
            },
            {
                "sha": "0a6c0456c3321e99a73ded07ed19b8d362fdbc98",
                "filename": "src/google/protobuf/unittest_lite.proto",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/d6c82fc55a76481c676f541a255571e8950bb8c3/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/d6c82fc55a76481c676f541a255571e8950bb8c3/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto?ref=d6c82fc55a76481c676f541a255571e8950bb8c3",
                "patch": "@@ -627,3 +627,7 @@ message RecursiveMessage {\n   RecursiveMessage recurse = 1;\n   bytes payload = 2;\n }\n+\n+message RecursiveGroup {\n+  RecursiveGroup recurse = 1 [features.message_encoding = DELIMITED];\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/9a5f5fe752a20cbac2e722b06949ac985abdd534",
        "url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/9a5f5fe752a20cbac2e722b06949ac985abdd534",
        "html_url": "https://github.com/protocolbuffers/protobuf/commit/9a5f5fe752a20cbac2e722b06949ac985abdd534",
        "message": "Internal change\n\nPiperOrigin-RevId: 653615736",
        "files": [
            {
                "sha": "9bf14396263a376540976c45d156c237598ef468",
                "filename": "java/core/src/main/java/com/google/protobuf/ArrayDecoders.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java?ref=9a5f5fe752a20cbac2e722b06949ac985abdd534",
                "patch": "@@ -24,8 +24,7 @@\n @CheckReturnValue\n final class ArrayDecoders {\n \n-  private ArrayDecoders() {\n-  }\n+  private ArrayDecoders() {}\n \n   /**\n    * A helper used to return multiple values in a Java function. Java doesn't natively support"
            },
            {
                "sha": "dbcb9e899dbee203b8418d626f421dc357fed1c6",
                "filename": "java/core/src/main/java/com/google/protobuf/InvalidProtocolBufferException.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java?ref=9a5f5fe752a20cbac2e722b06949ac985abdd534",
                "patch": "@@ -132,7 +132,7 @@ public InvalidWireTypeException(String description) {\n   static InvalidProtocolBufferException recursionLimitExceeded() {\n     return new InvalidProtocolBufferException(\n         \"Protocol message had too many levels of nesting.  May be malicious.  \"\n-            + \"Use CodedInputStream.setRecursionLimit() to increase the depth limit.\");\n+            + \"Use setRecursionLimit() to increase the recursion depth limit.\");\n   }\n \n   static InvalidProtocolBufferException sizeLimitExceeded() {"
            },
            {
                "sha": "f8f79fcdf8b4c137b51c32cc3d45b71c14761a40",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSchema.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java?ref=9a5f5fe752a20cbac2e722b06949ac985abdd534",
                "patch": "@@ -3006,6 +3006,7 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n             // Unknown field.\n+\n             if (unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n               continue;\n             }\n@@ -3381,6 +3382,7 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               if (unknownFields == null) {\n                 unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n               }\n+\n               if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n                 return;\n               }\n@@ -3397,6 +3399,7 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n             if (unknownFields == null) {\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n+\n             if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n               return;\n             }"
            },
            {
                "sha": "a17037e8efd4eb67d7b46d908ec52d140f3df5a2",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSetSchema.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java?ref=9a5f5fe752a20cbac2e722b06949ac985abdd534",
                "patch": "@@ -278,6 +278,7 @@ boolean parseMessageSetItemOrUnknownField(\n               reader, extension, extensionRegistry, extensions);\n           return true;\n         } else {\n+\n           return unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader);\n         }\n       } else {"
            },
            {
                "sha": "a43bc2a9472d33f365053bd2c103917ae154c89f",
                "filename": "java/core/src/main/java/com/google/protobuf/UnknownFieldSchema.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java?ref=9a5f5fe752a20cbac2e722b06949ac985abdd534",
                "patch": "@@ -55,7 +55,6 @@ abstract class UnknownFieldSchema<T, B> {\n   /** Marks unknown fields as immutable. */\n   abstract void makeImmutable(Object message);\n \n-  /** Merges one field into the unknown fields. */\n   final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOException {\n     int tag = reader.getTag();\n     int fieldNumber = WireFormat.getTagFieldNumber(tag);\n@@ -88,7 +87,7 @@ final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOExcepti\n     }\n   }\n \n-  final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n+  private final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n     while (true) {\n       if (reader.getFieldNumber() == Reader.READ_DONE\n           || !mergeOneFieldFrom(unknownFields, reader)) {"
            },
            {
                "sha": "13050b65d05b41df346593b839d9f63314df0e4b",
                "filename": "java/lite/src/test/java/com/google/protobuf/LiteTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/9a5f5fe752a20cbac2e722b06949ac985abdd534/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java?ref=9a5f5fe752a20cbac2e722b06949ac985abdd534",
                "patch": "@@ -10,12 +10,14 @@\n import static com.google.common.truth.Truth.assertThat;\n import static com.google.common.truth.Truth.assertWithMessage;\n import static java.util.Collections.singletonList;\n+import static org.junit.Assert.assertThrows;\n \n import com.google.protobuf.FieldPresenceTestProto.TestAllTypes;\n import com.google.protobuf.UnittestImportLite.ImportEnumLite;\n import com.google.protobuf.UnittestImportPublicLite.PublicImportMessageLite;\n import com.google.protobuf.UnittestLite.ForeignEnumLite;\n import com.google.protobuf.UnittestLite.ForeignMessageLite;\n+import com.google.protobuf.UnittestLite.RecursiveGroup;\n import com.google.protobuf.UnittestLite.RecursiveMessage;\n import com.google.protobuf.UnittestLite.TestAllExtensionsLite;\n import com.google.protobuf.UnittestLite.TestAllTypesLite;\n@@ -51,6 +53,7 @@\n import java.util.Arrays;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.concurrent.atomic.AtomicBoolean;\n import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;"
            },
            {
                "sha": "0a6c0456c3321e99a73ded07ed19b8d362fdbc98",
                "filename": "src/google/protobuf/unittest_lite.proto",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/9a5f5fe752a20cbac2e722b06949ac985abdd534/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/9a5f5fe752a20cbac2e722b06949ac985abdd534/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto?ref=9a5f5fe752a20cbac2e722b06949ac985abdd534",
                "patch": "@@ -627,3 +627,7 @@ message RecursiveMessage {\n   RecursiveMessage recurse = 1;\n   bytes payload = 2;\n }\n+\n+message RecursiveGroup {\n+  RecursiveGroup recurse = 1 [features.message_encoding = DELIMITED];\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
        "url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
        "html_url": "https://github.com/protocolbuffers/protobuf/commit/ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
        "message": "Add recursion check when parsing unknown fields in Java.\n\nPiperOrigin-RevId: 675657198",
        "files": [
            {
                "sha": "4e079e1b6301001c27e2f043046bdc6c70d1cd03",
                "filename": "java/core/BUILD.bazel",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2FBUILD.bazel",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2FBUILD.bazel",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2FBUILD.bazel?ref=ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
                "patch": "@@ -616,6 +616,7 @@ junit_tests(\n             \"src/test/java/com/google/protobuf/DescriptorsTest.java\",\n             \"src/test/java/com/google/protobuf/DebugFormatTest.java\",\n             \"src/test/java/com/google/protobuf/CodedOutputStreamTest.java\",\n+            \"src/test/java/com/google/protobuf/CodedInputStreamTest.java\",\n             \"src/test/java/com/google/protobuf/ProtobufToStringOutputTest.java\",\n             # Excluded in core_tests\n             \"src/test/java/com/google/protobuf/DecodeUtf8Test.java\",\n@@ -664,6 +665,7 @@ junit_tests(\n             \"src/test/java/com/google/protobuf/DescriptorsTest.java\",\n             \"src/test/java/com/google/protobuf/DebugFormatTest.java\",\n             \"src/test/java/com/google/protobuf/CodedOutputStreamTest.java\",\n+            \"src/test/java/com/google/protobuf/CodedInputStreamTest.java\",\n             \"src/test/java/com/google/protobuf/ProtobufToStringOutputTest.java\",\n             # Excluded in core_tests\n             \"src/test/java/com/google/protobuf/DecodeUtf8Test.java\","
            },
            {
                "sha": "bf5f922b073c5cd30eb9075337a3396a0dbdc40f",
                "filename": "java/core/src/main/java/com/google/protobuf/ArrayDecoders.java",
                "status": "modified",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java?ref=ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
                "patch": "@@ -23,6 +23,10 @@\n  */\n @CheckReturnValue\n final class ArrayDecoders {\n+  static final int DEFAULT_RECURSION_LIMIT = 100;\n+\n+  @SuppressWarnings(\"NonFinalStaticField\")\n+  private static volatile int recursionLimit = DEFAULT_RECURSION_LIMIT;\n \n   private ArrayDecoders() {}\n \n@@ -37,6 +41,7 @@ static final class Registers {\n     public long long1;\n     public Object object1;\n     public final ExtensionRegistryLite extensionRegistry;\n+    public int recursionDepth;\n \n     Registers() {\n       this.extensionRegistry = ExtensionRegistryLite.getEmptyRegistry();\n@@ -244,7 +249,10 @@ static int mergeMessageField(\n     if (length < 0 || length > limit - position) {\n       throw InvalidProtocolBufferException.truncatedMessage();\n     }\n+    registers.recursionDepth++;\n+    checkRecursionLimit(registers.recursionDepth);\n     schema.mergeFrom(msg, data, position, position + length, registers);\n+    registers.recursionDepth--;\n     registers.object1 = msg;\n     return position + length;\n   }\n@@ -262,8 +270,11 @@ static int mergeGroupField(\n     // A group field must has a MessageSchema (the only other subclass of Schema is MessageSetSchema\n     // and it can't be used in group fields).\n     final MessageSchema messageSchema = (MessageSchema) schema;\n+    registers.recursionDepth++;\n+    checkRecursionLimit(registers.recursionDepth);\n     final int endPosition =\n         messageSchema.parseMessage(msg, data, position, limit, endGroup, registers);\n+    registers.recursionDepth--;\n     registers.object1 = msg;\n     return endPosition;\n   }\n@@ -1024,6 +1035,8 @@ static int decodeUnknownField(\n         final UnknownFieldSetLite child = UnknownFieldSetLite.newInstance();\n         final int endGroup = (tag & ~0x7) | WireFormat.WIRETYPE_END_GROUP;\n         int lastTag = 0;\n+        registers.recursionDepth++;\n+        checkRecursionLimit(registers.recursionDepth);\n         while (position < limit) {\n           position = decodeVarint32(data, position, registers);\n           lastTag = registers.int1;\n@@ -1032,6 +1045,7 @@ static int decodeUnknownField(\n           }\n           position = decodeUnknownField(lastTag, data, position, limit, child, registers);\n         }\n+        registers.recursionDepth--;\n         if (position > limit || lastTag != endGroup) {\n           throw InvalidProtocolBufferException.parseFailure();\n         }\n@@ -1078,4 +1092,18 @@ static int skipField(int tag, byte[] data, int position, int limit, Registers re\n         throw InvalidProtocolBufferException.invalidTag();\n     }\n   }\n+\n+  /**\n+   * Set the maximum recursion limit that ArrayDecoders will allow. An exception will be thrown if\n+   * the depth of the message exceeds this limit.\n+   */\n+  public static void setRecursionLimit(int limit) {\n+    recursionLimit = limit;\n+  }\n+\n+  private static void checkRecursionLimit(int depth) throws InvalidProtocolBufferException {\n+    if (depth >= recursionLimit) {\n+      throw InvalidProtocolBufferException.recursionLimitExceeded();\n+    }\n+  }\n }"
            },
            {
                "sha": "85b7a5bcae1e44ecb75b2914d43cb024e4ee2d37",
                "filename": "java/core/src/main/java/com/google/protobuf/CodedInputStream.java",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStream.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStream.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStream.java?ref=ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
                "patch": "@@ -230,7 +230,10 @@ public void skipMessage() throws IOException {\n       if (tag == 0) {\n         return;\n       }\n+      checkRecursionLimit();\n+      ++recursionDepth;\n       boolean fieldSkipped = skipField(tag);\n+      --recursionDepth;\n       if (!fieldSkipped) {\n         return;\n       }\n@@ -247,7 +250,10 @@ public void skipMessage(CodedOutputStream output) throws IOException {\n       if (tag == 0) {\n         return;\n       }\n+      checkRecursionLimit();\n+      ++recursionDepth;\n       boolean fieldSkipped = skipField(tag, output);\n+      --recursionDepth;\n       if (!fieldSkipped) {\n         return;\n       }"
            },
            {
                "sha": "5ad6762b0dc4e0179971d5ca7365855d20d36098",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSchema.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java?ref=ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
                "patch": "@@ -3006,8 +3006,8 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n             // Unknown field.\n-\n-            if (unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n+            if (unknownFieldSchema.mergeOneFieldFrom(\n+                unknownFields, reader, /* currentDepth= */ 0)) {\n               continue;\n             }\n           }\n@@ -3382,8 +3382,8 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               if (unknownFields == null) {\n                 unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n               }\n-\n-              if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n+              if (!unknownFieldSchema.mergeOneFieldFrom(\n+                  unknownFields, reader, /* currentDepth= */ 0)) {\n                 return;\n               }\n               break;\n@@ -3399,8 +3399,8 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n             if (unknownFields == null) {\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n-\n-            if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n+            if (!unknownFieldSchema.mergeOneFieldFrom(\n+                unknownFields, reader, /* currentDepth= */ 0)) {\n               return;\n             }\n           }"
            },
            {
                "sha": "ec37d41f98c5a431f95edf91090835429a68567b",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSetSchema.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java?ref=ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
                "patch": "@@ -278,8 +278,7 @@ boolean parseMessageSetItemOrUnknownField(\n               reader, extension, extensionRegistry, extensions);\n           return true;\n         } else {\n-\n-          return unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader);\n+          return unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader, /* currentDepth= */ 0);\n         }\n       } else {\n         return reader.skipField();"
            },
            {
                "sha": "80602b16359aa378d120704a271a98b856039b71",
                "filename": "java/core/src/main/java/com/google/protobuf/UnknownFieldSchema.java",
                "status": "modified",
                "additions": 25,
                "deletions": 4,
                "changes": 29,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java?ref=ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
                "patch": "@@ -13,6 +13,11 @@\n @CheckReturnValue\n abstract class UnknownFieldSchema<T, B> {\n \n+  static final int DEFAULT_RECURSION_LIMIT = 100;\n+\n+  @SuppressWarnings(\"NonFinalStaticField\")\n+  private static volatile int recursionLimit = DEFAULT_RECURSION_LIMIT;\n+\n   /** Whether unknown fields should be dropped. */\n   abstract boolean shouldDiscardUnknownFields(Reader reader);\n \n@@ -55,7 +60,9 @@ abstract class UnknownFieldSchema<T, B> {\n   /** Marks unknown fields as immutable. */\n   abstract void makeImmutable(Object message);\n \n-  final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOException {\n+  /** Merges one field into the unknown fields. */\n+  final boolean mergeOneFieldFrom(B unknownFields, Reader reader, int currentDepth)\n+      throws IOException {\n     int tag = reader.getTag();\n     int fieldNumber = WireFormat.getTagFieldNumber(tag);\n     switch (WireFormat.getTagWireType(tag)) {\n@@ -74,7 +81,12 @@ final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOExcepti\n       case WireFormat.WIRETYPE_START_GROUP:\n         final B subFields = newBuilder();\n         int endGroupTag = WireFormat.makeTag(fieldNumber, WireFormat.WIRETYPE_END_GROUP);\n-        mergeFrom(subFields, reader);\n+        currentDepth++;\n+        if (currentDepth >= recursionLimit) {\n+          throw InvalidProtocolBufferException.recursionLimitExceeded();\n+        }\n+        mergeFrom(subFields, reader, currentDepth);\n+        currentDepth--;\n         if (endGroupTag != reader.getTag()) {\n           throw InvalidProtocolBufferException.invalidEndTag();\n         }\n@@ -87,10 +99,11 @@ final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOExcepti\n     }\n   }\n \n-  private final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n+  private final void mergeFrom(B unknownFields, Reader reader, int currentDepth)\n+      throws IOException {\n     while (true) {\n       if (reader.getFieldNumber() == Reader.READ_DONE\n-          || !mergeOneFieldFrom(unknownFields, reader)) {\n+          || !mergeOneFieldFrom(unknownFields, reader, currentDepth)) {\n         break;\n       }\n     }\n@@ -107,4 +120,12 @@ private final void mergeFrom(B unknownFields, Reader reader) throws IOException\n   abstract int getSerializedSizeAsMessageSet(T message);\n \n   abstract int getSerializedSize(T unknowns);\n+\n+  /**\n+   * Set the maximum recursion limit that ArrayDecoders will allow. An exception will be thrown if\n+   * the depth of the message exceeds this limit.\n+   */\n+  public void setRecursionLimit(int limit) {\n+    recursionLimit = limit;\n+  }\n }"
            },
            {
                "sha": "f73cb3b0eecf35489f99cf754b03fc192d36aee8",
                "filename": "java/core/src/test/java/com/google/protobuf/CodedInputStreamTest.java",
                "status": "modified",
                "additions": 158,
                "deletions": 0,
                "changes": 158,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStreamTest.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Fcore%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStreamTest.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FCodedInputStreamTest.java?ref=ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
                "patch": "@@ -11,6 +11,9 @@\n import static com.google.common.truth.Truth.assertWithMessage;\n import static org.junit.Assert.assertArrayEquals;\n import static org.junit.Assert.assertThrows;\n+\n+import com.google.common.primitives.Bytes;\n+import map_test.MapTestProto.MapContainer;\n import protobuf_unittest.UnittestProto.BoolMessage;\n import protobuf_unittest.UnittestProto.Int32Message;\n import protobuf_unittest.UnittestProto.Int64Message;\n@@ -35,6 +38,13 @@ public class CodedInputStreamTest {\n \n   private static final int DEFAULT_BLOCK_SIZE = 4096;\n \n+  private static final int GROUP_TAP = WireFormat.makeTag(3, WireFormat.WIRETYPE_START_GROUP);\n+\n+  private static final byte[] NESTING_SGROUP = generateSGroupTags();\n+\n+  private static final byte[] NESTING_SGROUP_WITH_INITIAL_BYTES = generateSGroupTagsForMapField();\n+\n+\n   private enum InputType {\n     ARRAY {\n       @Override\n@@ -117,6 +127,17 @@ private byte[] bytes(int... bytesAsInts) {\n     return bytes;\n   }\n \n+  private static byte[] generateSGroupTags() {\n+    byte[] bytes = new byte[100000];\n+    Arrays.fill(bytes, (byte) GROUP_TAP);\n+    return bytes;\n+  }\n+\n+  private static byte[] generateSGroupTagsForMapField() {\n+    byte[] initialBytes = {18, 1, 75, 26, (byte) 198, (byte) 154, 12};\n+    return Bytes.concat(initialBytes, NESTING_SGROUP);\n+  }\n+\n   /**\n    * An InputStream which limits the number of bytes it reads at a time. We use this to make sure\n    * that CodedInputStream doesn't screw up when reading in small blocks.\n@@ -740,6 +761,143 @@ public void testMaliciousRecursion() throws Exception {\n     }\n   }\n \n+  @Test\n+  public void testMaliciousRecursion_unknownFields() throws Exception {\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestRecursiveMessage.parseFrom(NESTING_SGROUP));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousRecursion_skippingUnknownField() throws Exception {\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () ->\n+                DiscardUnknownFieldsParser.wrap(TestRecursiveMessage.parser())\n+                    .parseFrom(NESTING_SGROUP));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromInputStream() throws Exception {\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () ->\n+                MapContainer.parseFrom(\n+                    new ByteArrayInputStream(NESTING_SGROUP_WITH_INITIAL_BYTES)));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () ->\n+                MapContainer.newBuilder()\n+                    .mergeFrom(new ByteArrayInputStream(NESTING_SGROUP_WITH_INITIAL_BYTES)));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_inputStream_skipMessage() throws Exception {\n+    ByteArrayInputStream inputSteam = new ByteArrayInputStream(NESTING_SGROUP);\n+    CodedInputStream input = CodedInputStream.newInstance(inputSteam);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromByteArray() throws Exception {\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(NESTING_SGROUP_WITH_INITIAL_BYTES));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.newBuilder().mergeFrom(NESTING_SGROUP_WITH_INITIAL_BYTES));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"the input ended unexpectedly in the middle of a field\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"the input ended unexpectedly in the middle of a field\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_arrayDecoder_skipMessage() throws Exception {\n+    CodedInputStream input = CodedInputStream.newInstance(NESTING_SGROUP);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromByteBuffer() throws Exception {\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(ByteBuffer.wrap(NESTING_SGROUP_WITH_INITIAL_BYTES)));\n+\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .contains(\"the input ended unexpectedly in the middle of a field\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_byteBuffer_skipMessage() throws Exception {\n+    CodedInputStream input = InputType.NIO_DIRECT.newDecoder(NESTING_SGROUP);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTags_iterableByteBuffer() throws Exception {\n+    CodedInputStream input = InputType.ITER_DIRECT.newDecoder(NESTING_SGROUP);\n+    CodedOutputStream output = CodedOutputStream.newInstance(new byte[NESTING_SGROUP.length]);\n+\n+    Throwable thrown = assertThrows(InvalidProtocolBufferException.class, input::skipMessage);\n+    Throwable thrown2 =\n+        assertThrows(InvalidProtocolBufferException.class, () -> input.skipMessage(output));\n+\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(thrown2)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n   private void checkSizeLimitExceeded(InvalidProtocolBufferException e) {\n     assertThat(e)\n         .hasMessageThat()"
            },
            {
                "sha": "ecf997f8313b482f4623ee1f81265bf6cc9a8b10",
                "filename": "java/lite/src/test/java/com/google/protobuf/LiteTest.java",
                "status": "modified",
                "additions": 232,
                "deletions": 0,
                "changes": 232,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/ac9fb5b4c71b0dd80985b27684e265d1f03abf46/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java?ref=ac9fb5b4c71b0dd80985b27684e265d1f03abf46",
                "patch": "@@ -2469,6 +2469,211 @@ public void testParseFromByteBufferThrows() {\n     }\n   }\n \n+  @Test\n+  public void testParseFromInputStream_concurrent_nestingUnknownGroups() throws Exception {\n+    int numThreads = 200;\n+    ArrayList<Thread> threads = new ArrayList<>();\n+\n+    ByteString byteString = generateNestingGroups(99);\n+    AtomicBoolean thrown = new AtomicBoolean(false);\n+\n+    for (int i = 0; i < numThreads; i++) {\n+      Thread thread =\n+          new Thread(\n+              () -> {\n+                try {\n+                  TestAllTypesLite unused = TestAllTypesLite.parseFrom(byteString);\n+                } catch (IOException e) {\n+                  if (e.getMessage().contains(\"Protocol message had too many levels of nesting\")) {\n+                    thrown.set(true);\n+                  }\n+                }\n+              });\n+      thread.start();\n+      threads.add(thread);\n+    }\n+\n+    for (Thread thread : threads) {\n+      thread.join();\n+    }\n+\n+    assertThat(thrown.get()).isFalse();\n+  }\n+\n+  @Test\n+  public void testParseFromInputStream_nestingUnknownGroups() throws IOException {\n+    ByteString byteString = generateNestingGroups(99);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> TestAllTypesLite.parseFrom(byteString));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromInputStream_nestingUnknownGroups_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(100);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> TestAllTypesLite.parseFrom(byteString));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromInputStream_setRecursionLimit_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(199);\n+    UnknownFieldSchema<?, ?> schema = SchemaUtil.unknownFieldSetLiteSchema();\n+    schema.setRecursionLimit(200);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> TestAllTypesLite.parseFrom(byteString));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+    schema.setRecursionLimit(UnknownFieldSchema.DEFAULT_RECURSION_LIMIT);\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_concurrent_nestingUnknownGroups() throws Exception {\n+    int numThreads = 200;\n+    ArrayList<Thread> threads = new ArrayList<>();\n+\n+    ByteString byteString = generateNestingGroups(99);\n+    AtomicBoolean thrown = new AtomicBoolean(false);\n+\n+    for (int i = 0; i < numThreads; i++) {\n+      Thread thread =\n+          new Thread(\n+              () -> {\n+                try {\n+                  // Should pass in byte[] instead of ByteString to go into ArrayDecoders.\n+                  TestAllTypesLite unused = TestAllTypesLite.parseFrom(byteString.toByteArray());\n+                } catch (InvalidProtocolBufferException e) {\n+                  if (e.getMessage().contains(\"Protocol message had too many levels of nesting\")) {\n+                    thrown.set(true);\n+                  }\n+                }\n+              });\n+      thread.start();\n+      threads.add(thread);\n+    }\n+\n+    for (Thread thread : threads) {\n+      thread.join();\n+    }\n+\n+    assertThat(thrown.get()).isFalse();\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_nestingUnknownGroups() throws IOException {\n+    ByteString byteString = generateNestingGroups(99);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestAllTypesLite.parseFrom(byteString.toByteArray()));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_nestingUnknownGroups_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(100);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestAllTypesLite.parseFrom(byteString.toByteArray()));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_setRecursionLimit_exception() throws IOException {\n+    ByteString byteString = generateNestingGroups(199);\n+    ArrayDecoders.setRecursionLimit(200);\n+\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> TestAllTypesLite.parseFrom(byteString.toByteArray()));\n+    assertThat(thrown)\n+        .hasMessageThat()\n+        .doesNotContain(\"Protocol message had too many levels of nesting\");\n+    ArrayDecoders.setRecursionLimit(ArrayDecoders.DEFAULT_RECURSION_LIMIT);\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_recursiveMessages() throws Exception {\n+    byte[] data99 = makeRecursiveMessage(99).toByteArray();\n+    byte[] data100 = makeRecursiveMessage(100).toByteArray();\n+\n+    RecursiveMessage unused = RecursiveMessage.parseFrom(data99);\n+    Throwable thrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class, () -> RecursiveMessage.parseFrom(data100));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testParseFromBytes_recursiveKnownGroups() throws Exception {\n+    byte[] data99 = makeRecursiveGroup(99).toByteArray();\n+    byte[] data100 = makeRecursiveGroup(100).toByteArray();\n+\n+    RecursiveGroup unused = RecursiveGroup.parseFrom(data99);\n+    Throwable thrown =\n+        assertThrows(InvalidProtocolBufferException.class, () -> RecursiveGroup.parseFrom(data100));\n+    assertThat(thrown).hasMessageThat().contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  @SuppressWarnings(\"ProtoParseFromByteString\")\n+  public void testMaliciousSGroupTagsWithMapField_fromByteArray() throws Exception {\n+    ByteString byteString = generateNestingGroups(102);\n+\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(byteString.toByteArray()));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.newBuilder().mergeFrom(byteString.toByteArray()));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n+  @Test\n+  public void testMaliciousSGroupTagsWithMapField_fromInputStream() throws Exception {\n+    byte[] bytes = generateNestingGroups(101).toByteArray();\n+\n+    Throwable parseFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.parseFrom(new ByteArrayInputStream(bytes)));\n+    Throwable mergeFromThrown =\n+        assertThrows(\n+            InvalidProtocolBufferException.class,\n+            () -> MapContainer.newBuilder().mergeFrom(new ByteArrayInputStream(bytes)));\n+\n+    assertThat(parseFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+    assertThat(mergeFromThrown)\n+        .hasMessageThat()\n+        .contains(\"Protocol message had too many levels of nesting\");\n+  }\n+\n   @Test\n   public void testParseFromByteBuffer_extensions() throws Exception {\n     TestAllExtensionsLite message =\n@@ -2825,4 +3030,31 @@ private static boolean contains(ByteString a, ByteString b) {\n     }\n     return false;\n   }\n+\n+  private static ByteString generateNestingGroups(int num) throws IOException {\n+    int groupTap = WireFormat.makeTag(3, WireFormat.WIRETYPE_START_GROUP);\n+    ByteString.Output byteStringOutput = ByteString.newOutput();\n+    CodedOutputStream codedOutput = CodedOutputStream.newInstance(byteStringOutput);\n+    for (int i = 0; i < num; i++) {\n+      codedOutput.writeInt32NoTag(groupTap);\n+    }\n+    codedOutput.flush();\n+    return byteStringOutput.toByteString();\n+  }\n+\n+  private static RecursiveMessage makeRecursiveMessage(int num) {\n+    if (num == 0) {\n+      return RecursiveMessage.getDefaultInstance();\n+    } else {\n+      return RecursiveMessage.newBuilder().setRecurse(makeRecursiveMessage(num - 1)).build();\n+    }\n+  }\n+\n+  private static RecursiveGroup makeRecursiveGroup(int num) {\n+    if (num == 0) {\n+      return RecursiveGroup.getDefaultInstance();\n+    } else {\n+      return RecursiveGroup.newBuilder().setRecurse(makeRecursiveGroup(num - 1)).build();\n+    }\n+  }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/cc8b3483a5584b3301e3d43d17eb59704857ffaa",
        "url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/cc8b3483a5584b3301e3d43d17eb59704857ffaa",
        "html_url": "https://github.com/protocolbuffers/protobuf/commit/cc8b3483a5584b3301e3d43d17eb59704857ffaa",
        "message": "Internal change\n\nPiperOrigin-RevId: 653615736",
        "files": [
            {
                "sha": "9bf14396263a376540976c45d156c237598ef468",
                "filename": "java/core/src/main/java/com/google/protobuf/ArrayDecoders.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java?ref=cc8b3483a5584b3301e3d43d17eb59704857ffaa",
                "patch": "@@ -24,8 +24,7 @@\n @CheckReturnValue\n final class ArrayDecoders {\n \n-  private ArrayDecoders() {\n-  }\n+  private ArrayDecoders() {}\n \n   /**\n    * A helper used to return multiple values in a Java function. Java doesn't natively support"
            },
            {
                "sha": "dbcb9e899dbee203b8418d626f421dc357fed1c6",
                "filename": "java/core/src/main/java/com/google/protobuf/InvalidProtocolBufferException.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java?ref=cc8b3483a5584b3301e3d43d17eb59704857ffaa",
                "patch": "@@ -132,7 +132,7 @@ public InvalidWireTypeException(String description) {\n   static InvalidProtocolBufferException recursionLimitExceeded() {\n     return new InvalidProtocolBufferException(\n         \"Protocol message had too many levels of nesting.  May be malicious.  \"\n-            + \"Use CodedInputStream.setRecursionLimit() to increase the depth limit.\");\n+            + \"Use setRecursionLimit() to increase the recursion depth limit.\");\n   }\n \n   static InvalidProtocolBufferException sizeLimitExceeded() {"
            },
            {
                "sha": "f8f79fcdf8b4c137b51c32cc3d45b71c14761a40",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSchema.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java?ref=cc8b3483a5584b3301e3d43d17eb59704857ffaa",
                "patch": "@@ -3006,6 +3006,7 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n             // Unknown field.\n+\n             if (unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n               continue;\n             }\n@@ -3381,6 +3382,7 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               if (unknownFields == null) {\n                 unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n               }\n+\n               if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n                 return;\n               }\n@@ -3397,6 +3399,7 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n             if (unknownFields == null) {\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n+\n             if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n               return;\n             }"
            },
            {
                "sha": "a17037e8efd4eb67d7b46d908ec52d140f3df5a2",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSetSchema.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java?ref=cc8b3483a5584b3301e3d43d17eb59704857ffaa",
                "patch": "@@ -278,6 +278,7 @@ boolean parseMessageSetItemOrUnknownField(\n               reader, extension, extensionRegistry, extensions);\n           return true;\n         } else {\n+\n           return unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader);\n         }\n       } else {"
            },
            {
                "sha": "a43bc2a9472d33f365053bd2c103917ae154c89f",
                "filename": "java/core/src/main/java/com/google/protobuf/UnknownFieldSchema.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java?ref=cc8b3483a5584b3301e3d43d17eb59704857ffaa",
                "patch": "@@ -55,7 +55,6 @@ abstract class UnknownFieldSchema<T, B> {\n   /** Marks unknown fields as immutable. */\n   abstract void makeImmutable(Object message);\n \n-  /** Merges one field into the unknown fields. */\n   final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOException {\n     int tag = reader.getTag();\n     int fieldNumber = WireFormat.getTagFieldNumber(tag);\n@@ -88,7 +87,7 @@ final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOExcepti\n     }\n   }\n \n-  final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n+  private final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n     while (true) {\n       if (reader.getFieldNumber() == Reader.READ_DONE\n           || !mergeOneFieldFrom(unknownFields, reader)) {"
            },
            {
                "sha": "411bc63f087fd41fafe73731a1e50e2043d78f78",
                "filename": "java/lite/src/test/java/com/google/protobuf/LiteTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/cc8b3483a5584b3301e3d43d17eb59704857ffaa/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java?ref=cc8b3483a5584b3301e3d43d17eb59704857ffaa",
                "patch": "@@ -10,12 +10,14 @@\n import static com.google.common.truth.Truth.assertThat;\n import static com.google.common.truth.Truth.assertWithMessage;\n import static java.util.Collections.singletonList;\n+import static org.junit.Assert.assertThrows;\n \n import com.google.protobuf.FieldPresenceTestProto.TestAllTypes;\n import com.google.protobuf.UnittestImportLite.ImportEnumLite;\n import com.google.protobuf.UnittestImportPublicLite.PublicImportMessageLite;\n import com.google.protobuf.UnittestLite.ForeignEnumLite;\n import com.google.protobuf.UnittestLite.ForeignMessageLite;\n+import com.google.protobuf.UnittestLite.RecursiveGroup;\n import com.google.protobuf.UnittestLite.RecursiveMessage;\n import com.google.protobuf.UnittestLite.TestAllExtensionsLite;\n import com.google.protobuf.UnittestLite.TestAllTypesLite;\n@@ -50,6 +52,7 @@\n import java.util.Arrays;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.concurrent.atomic.AtomicBoolean;\n import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;"
            },
            {
                "sha": "4bc78c4de6a804a62b2dabb84f8812291996257b",
                "filename": "src/google/protobuf/unittest_lite.proto",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/cc8b3483a5584b3301e3d43d17eb59704857ffaa/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/cc8b3483a5584b3301e3d43d17eb59704857ffaa/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto?ref=cc8b3483a5584b3301e3d43d17eb59704857ffaa",
                "patch": "@@ -625,3 +625,7 @@ message RecursiveMessage {\n   RecursiveMessage recurse = 1;\n   bytes payload = 2;\n }\n+\n+message RecursiveGroup {\n+  RecursiveGroup recurse = 1 [features.message_encoding = DELIMITED];\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/850fcce9176e2c9070614dab53537760498c926b",
        "url": "https://api.github.com/repos/protocolbuffers/protobuf/commits/850fcce9176e2c9070614dab53537760498c926b",
        "html_url": "https://github.com/protocolbuffers/protobuf/commit/850fcce9176e2c9070614dab53537760498c926b",
        "message": "Internal change\n\nPiperOrigin-RevId: 653615736",
        "files": [
            {
                "sha": "9bf14396263a376540976c45d156c237598ef468",
                "filename": "java/core/src/main/java/com/google/protobuf/ArrayDecoders.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FArrayDecoders.java?ref=850fcce9176e2c9070614dab53537760498c926b",
                "patch": "@@ -24,8 +24,7 @@\n @CheckReturnValue\n final class ArrayDecoders {\n \n-  private ArrayDecoders() {\n-  }\n+  private ArrayDecoders() {}\n \n   /**\n    * A helper used to return multiple values in a Java function. Java doesn't natively support"
            },
            {
                "sha": "dbcb9e899dbee203b8418d626f421dc357fed1c6",
                "filename": "java/core/src/main/java/com/google/protobuf/InvalidProtocolBufferException.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FInvalidProtocolBufferException.java?ref=850fcce9176e2c9070614dab53537760498c926b",
                "patch": "@@ -132,7 +132,7 @@ public InvalidWireTypeException(String description) {\n   static InvalidProtocolBufferException recursionLimitExceeded() {\n     return new InvalidProtocolBufferException(\n         \"Protocol message had too many levels of nesting.  May be malicious.  \"\n-            + \"Use CodedInputStream.setRecursionLimit() to increase the depth limit.\");\n+            + \"Use setRecursionLimit() to increase the recursion depth limit.\");\n   }\n \n   static InvalidProtocolBufferException sizeLimitExceeded() {"
            },
            {
                "sha": "f8f79fcdf8b4c137b51c32cc3d45b71c14761a40",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSchema.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSchema.java?ref=850fcce9176e2c9070614dab53537760498c926b",
                "patch": "@@ -3006,6 +3006,7 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n             // Unknown field.\n+\n             if (unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n               continue;\n             }\n@@ -3381,6 +3382,7 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n               if (unknownFields == null) {\n                 unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n               }\n+\n               if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n                 return;\n               }\n@@ -3397,6 +3399,7 @@ private <UT, UB, ET extends FieldDescriptorLite<ET>> void mergeFromHelper(\n             if (unknownFields == null) {\n               unknownFields = unknownFieldSchema.getBuilderFromMessage(message);\n             }\n+\n             if (!unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader)) {\n               return;\n             }"
            },
            {
                "sha": "a17037e8efd4eb67d7b46d908ec52d140f3df5a2",
                "filename": "java/core/src/main/java/com/google/protobuf/MessageSetSchema.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FMessageSetSchema.java?ref=850fcce9176e2c9070614dab53537760498c926b",
                "patch": "@@ -278,6 +278,7 @@ boolean parseMessageSetItemOrUnknownField(\n               reader, extension, extensionRegistry, extensions);\n           return true;\n         } else {\n+\n           return unknownFieldSchema.mergeOneFieldFrom(unknownFields, reader);\n         }\n       } else {"
            },
            {
                "sha": "a43bc2a9472d33f365053bd2c103917ae154c89f",
                "filename": "java/core/src/main/java/com/google/protobuf/UnknownFieldSchema.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/850fcce9176e2c9070614dab53537760498c926b/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Fcore%2Fsrc%2Fmain%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FUnknownFieldSchema.java?ref=850fcce9176e2c9070614dab53537760498c926b",
                "patch": "@@ -55,7 +55,6 @@ abstract class UnknownFieldSchema<T, B> {\n   /** Marks unknown fields as immutable. */\n   abstract void makeImmutable(Object message);\n \n-  /** Merges one field into the unknown fields. */\n   final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOException {\n     int tag = reader.getTag();\n     int fieldNumber = WireFormat.getTagFieldNumber(tag);\n@@ -88,7 +87,7 @@ final boolean mergeOneFieldFrom(B unknownFields, Reader reader) throws IOExcepti\n     }\n   }\n \n-  final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n+  private final void mergeFrom(B unknownFields, Reader reader) throws IOException {\n     while (true) {\n       if (reader.getFieldNumber() == Reader.READ_DONE\n           || !mergeOneFieldFrom(unknownFields, reader)) {"
            },
            {
                "sha": "61009df109d48c9aeb81e984f4e4338047602972",
                "filename": "java/lite/src/test/java/com/google/protobuf/LiteTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/850fcce9176e2c9070614dab53537760498c926b/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/850fcce9176e2c9070614dab53537760498c926b/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/java%2Flite%2Fsrc%2Ftest%2Fjava%2Fcom%2Fgoogle%2Fprotobuf%2FLiteTest.java?ref=850fcce9176e2c9070614dab53537760498c926b",
                "patch": "@@ -10,12 +10,14 @@\n import static com.google.common.truth.Truth.assertThat;\n import static com.google.common.truth.Truth.assertWithMessage;\n import static java.util.Collections.singletonList;\n+import static org.junit.Assert.assertThrows;\n \n import com.google.protobuf.FieldPresenceTestProto.TestAllTypes;\n import com.google.protobuf.UnittestImportLite.ImportEnumLite;\n import com.google.protobuf.UnittestImportPublicLite.PublicImportMessageLite;\n import com.google.protobuf.UnittestLite.ForeignEnumLite;\n import com.google.protobuf.UnittestLite.ForeignMessageLite;\n+import com.google.protobuf.UnittestLite.RecursiveGroup;\n import com.google.protobuf.UnittestLite.RecursiveMessage;\n import com.google.protobuf.UnittestLite.TestAllExtensionsLite;\n import com.google.protobuf.UnittestLite.TestAllTypesLite;\n@@ -51,6 +53,7 @@\n import java.util.Arrays;\n import java.util.Iterator;\n import java.util.List;\n+import java.util.concurrent.atomic.AtomicBoolean;\n import org.junit.Before;\n import org.junit.Test;\n import org.junit.runner.RunWith;"
            },
            {
                "sha": "2402cbe033913518be4c396d2bceaff0c1c48669",
                "filename": "src/google/protobuf/unittest_lite.proto",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/protocolbuffers/protobuf/blob/850fcce9176e2c9070614dab53537760498c926b/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto",
                "raw_url": "https://github.com/protocolbuffers/protobuf/raw/850fcce9176e2c9070614dab53537760498c926b/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto",
                "contents_url": "https://api.github.com/repos/protocolbuffers/protobuf/contents/src%2Fgoogle%2Fprotobuf%2Funittest_lite.proto?ref=850fcce9176e2c9070614dab53537760498c926b",
                "patch": "@@ -506,3 +506,7 @@ message RecursiveMessage {\n   optional RecursiveMessage recurse = 1;\n   optional bytes payload = 2;\n }\n+\n+message RecursiveGroup {\n+  RecursiveGroup recurse = 1 [features.message_encoding = DELIMITED];\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/aee7bfb7510a83acf178a7f02da9661c040e9abf",
        "url": "https://api.github.com/repos/mautic/mautic/commits/aee7bfb7510a83acf178a7f02da9661c040e9abf",
        "html_url": "https://github.com/mautic/mautic/commit/aee7bfb7510a83acf178a7f02da9661c040e9abf",
        "message": "Merge remote-tracking branch 'security/advisory-fix-MST-34-5.1' into 5.1",
        "files": [
            {
                "sha": "0b08ce6cd31d1959d7f96749d36df49c16146cfc",
                "filename": "build/package_devhead.php",
                "status": "modified",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/mautic/mautic/blob/aee7bfb7510a83acf178a7f02da9661c040e9abf/build%2Fpackage_devhead.php",
                "raw_url": "https://github.com/mautic/mautic/raw/aee7bfb7510a83acf178a7f02da9661c040e9abf/build%2Fpackage_devhead.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/build%2Fpackage_devhead.php?ref=aee7bfb7510a83acf178a7f02da9661c040e9abf",
                "patch": "@@ -33,9 +33,6 @@\n \n system('zip -r ../packages/mautic-head.zip . > /dev/null');\n \n-// Copy over upgrade.php\n-system('cp '.__DIR__.'/../upgrade.php '.__DIR__.'/packaging');\n-\n chdir(__DIR__.'/packaging');\n echo \"Packaging Mautic Update Package\\n\";\n system('zip -r ../packages/mautic-head-update.zip . > /dev/null');"
            },
            {
                "sha": "ead3f86f649c027cc3cf56a27577197f2ff88df8",
                "filename": "upgrade.php",
                "status": "removed",
                "additions": 0,
                "deletions": 1022,
                "changes": 1022,
                "blob_url": "https://github.com/mautic/mautic/blob/0614c5fa9bbc70e0897f27e967d4519951142114/upgrade.php",
                "raw_url": "https://github.com/mautic/mautic/raw/0614c5fa9bbc70e0897f27e967d4519951142114/upgrade.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/upgrade.php?ref=0614c5fa9bbc70e0897f27e967d4519951142114",
                "patch": "@@ -1,1022 +0,0 @@\n-<?php\n-\n-ini_set('display_errors', 'Off');\n-date_default_timezone_set('UTC');\n-\n-// Running this script standalone is no longer supported\n-$standalone = 0;\n-$task       = getVar('task');\n-\n-define('IN_CLI', 'cli' === php_sapi_name());\n-define('MAUTIC_ROOT', (IN_CLI || empty($task)) ? __DIR__ : dirname(__DIR__));\n-define('MAUTIC_APP_ROOT', MAUTIC_ROOT.'/app');\n-\n-if (IN_CLI) {\n-    if (!file_exists(__DIR__.'/upgrade')) {\n-        mkdir(__DIR__.'/upgrade');\n-    }\n-    define('MAUTIC_UPGRADE_ROOT', __DIR__.'/upgrade');\n-} else {\n-    define('MAUTIC_UPGRADE_ROOT', __DIR__);\n-}\n-\n-// Fail-safe PHP version check\n-if (file_exists(MAUTIC_UPGRADE_ROOT.'/app/release_metadata.json')) {\n-    $metadata = json_decode(file_get_contents(MAUTIC_UPGRADE_ROOT.'/app/release_metadata.json'), true);\n-\n-    // Are we running the minimum version?\n-    if (version_compare(PHP_VERSION, $metadata['minimum_php_version'], 'lt')) {\n-        echo 'Your server does not meet the minimum PHP requirements. Mautic requires PHP version '.$metadata['minimum_php_version'].' while your server has '\n-            .PHP_VERSION.'. Please contact your host to update your PHP installation.'.\"\\n\";\n-        exit;\n-    }\n-\n-    // Are we running a version newer than what Mautic supports?\n-    if (version_compare(PHP_VERSION, $metadata['maximum_php_version'], 'gt')) {\n-        echo 'Mautic does not support PHP version '.PHP_VERSION.' at this time. To use Mautic, you will need to downgrade to an earlier version.'\n-            .\"\\n\";\n-        exit;\n-    }\n-}\n-\n-// Get local parameters\n-$localParameters = get_local_config();\n-$cacheDir        = (isset($localParameters['cache_path'])) ? str_replace('%kernel.project_dir%', MAUTIC_ROOT, $localParameters['cache_path'].'/prod') : MAUTIC_ROOT.'/var/cache/prod';\n-$logDir          = (isset($localParameters['log_path'])) ? str_replace('%kernel.project_dir%', MAUTIC_ROOT, $localParameters['log_path'].'/prod') : MAUTIC_ROOT.'/var/logs';\n-\n-define('MAUTIC_CACHE_DIR', $cacheDir);\n-define('MAUTIC_UPGRADE_ERROR_LOG', $logDir.'/upgrade_errors.php');\n-\n-/*\n- * Updating to 2.8.1: Check to see if we have a mautic_session_name\n- * and use that to populate the actual session name that will be\n- * generated after a successful update.\n- */\n-if (isset($_COOKIE['mautic_session_name'])) {\n-    $sessionValue = $_COOKIE[$_COOKIE['mautic_session_name']];\n-\n-    include MAUTIC_APP_ROOT.'/config/paths.php';\n-    $localConfigPath = str_replace('%kernel.project_dir%', MAUTIC_ROOT, $paths['local_config']);\n-\n-    $newSessionName = md5(md5($localConfigPath).$localParameters['secret_key']);\n-\n-    setcookie($newSessionName, $sessionValue, 0, '/', '', false, true);\n-\n-    unset($_COOKIE['mautic_session_name']);\n-    setcookie('mautic_session_name', '', -1);\n-}\n-\n-// Fetch the update state out of the request if applicable\n-$state = json_decode(base64_decode(getVar('updateState', 'W10=')), true);\n-\n-// Prime the state if it's empty\n-if (empty($state)) {\n-    $state['pluginComplete'] = false;\n-    $state['bundleComplete'] = false;\n-    $state['cacheComplete']  = false;\n-    $state['coreComplete']   = false;\n-    $state['vendorComplete'] = false;\n-}\n-$status = ['complete' => false, 'error' => false, 'updateState' => $state, 'stepStatus' => 'In Progress'];\n-\n-if (IN_CLI) {\n-    echo \"Upgrading through upgrade.php using the CLI is no longer supported. Please use 'php bin/console mautic:update:find' instead. \\n\";\n-    exit(1);\n-}\n-\n-// Web request upgrade\n-$request         = explode('?', $_SERVER['REQUEST_URI'])[0];\n-$url             = \"//{$_SERVER['HTTP_HOST']}{$request}\";\n-$isSSL           = (!empty($_SERVER['HTTPS']) && 'off' != $_SERVER['HTTPS']);\n-$cookie_path     = (isset($localParameters['cookie_path'])) ? $localParameters['cookie_path'] : '/';\n-$cookie_domain   = (isset($localParameters['cookie_domain'])) ? $localParameters['cookie_domain'] : '';\n-$cookie_secure   = (isset($localParameters['cookie_secure'])) ? $localParameters['cookie_secure'] : $isSSL;\n-$cookie_httponly = (isset($localParameters['cookie_httponly'])) ? $localParameters['cookie_httponly'] : false;\n-\n-setcookie('mautic_update', $task, time() + 300, $cookie_path, $cookie_domain, $cookie_secure, $cookie_httponly);\n-$query    = '';\n-$maxCount = 5;\n-\n-switch ($task) {\n-    case '':\n-        html_body(\"<div class='well text-center'>This script cannot run standalone. Please log into Mautic to check for updates.</div>\");\n-\n-        // no break\n-    case 'moveBundles':\n-        $status = move_mautic_bundles($status, $maxCount);\n-        if (empty($status['complete'])) {\n-            if (!isset($state['refresh_count'])) {\n-                $state['refresh_count'] = 1;\n-            }\n-            $nextTask = 'moveBundles';\n-            $query    = 'count='.$state['refresh_count'].'&';\n-            ++$state['refresh_count'];\n-        } else {\n-            $nextTask = 'moveCore';\n-            unset($state['refresh_count']);\n-        }\n-        break;\n-\n-    case 'moveCore':\n-        $status   = move_mautic_core($status);\n-        $nextTask = 'moveVendors';\n-        break;\n-\n-    case 'moveVendors':\n-        $status   = move_mautic_vendors($status, $maxCount);\n-        $nextTask = (!empty($status['complete'])) ? 'clearCache' : 'moveVendors';\n-\n-        if (empty($status['complete'])) {\n-            if (!isset($state['refresh_count'])) {\n-                $state['refresh_count'] = 1;\n-            }\n-            $nextTask = 'moveVendors';\n-            $query    = 'count='.$state['refresh_count'].'&';\n-            ++$state['refresh_count'];\n-        } else {\n-            $nextTask = 'clearCache';\n-            unset($state['refresh_count']);\n-        }\n-        break;\n-\n-    case 'clearCache':\n-        clear_mautic_cache();\n-        $nextTask = 'finish';\n-        break;\n-\n-    case 'finish':\n-        $status['complete']                     = true;\n-        $status['stepStatus']                   = 'Success';\n-        $status['nextStep']                     = 'Processing Database Updates';\n-        $status['nextStepStatus']               = 'In Progress';\n-        $status['updateState']['cacheComplete'] = true;\n-\n-        break;\n-\n-    default:\n-        $status['error']      = true;\n-        $status['message']    = 'Invalid task';\n-        $status['stepStatus'] = 'Failed';\n-        break;\n-}\n-\n-// Request through Mautic's UI\n-$status['updateState'] = get_state_param($status['updateState']);\n-\n-send_response($status);\n-\n-/**\n- * Get local parameters.\n- *\n- * @return mixed\n- */\n-function get_local_config()\n-{\n-    static $parameters;\n-\n-    if (null === $parameters) {\n-        // Used in paths.php\n-        $root = MAUTIC_APP_ROOT;\n-\n-        /** @var array<string> $paths */\n-        $paths = [];\n-        include MAUTIC_APP_ROOT.'/config/paths.php';\n-\n-        // Include local config to get cache_path\n-        $localConfig = str_replace('%kernel.project_dir%', MAUTIC_ROOT, $paths['local_config']);\n-\n-        /** @var array<string, mixed> $parameters */\n-        $parameters = [];\n-        include $localConfig;\n-\n-        $localParameters = $parameters;\n-\n-        // check for parameter overrides\n-        if (file_exists(MAUTIC_APP_ROOT.'/../config/parameters_local.php')) {\n-            /** @var array<string, mixed> $parameters */\n-            include MAUTIC_APP_ROOT.'/../config/parameters_local.php';\n-            $localParameters = array_merge($localParameters, $parameters);\n-        }\n-\n-        foreach ($localParameters as $k => &$v) {\n-            if (!empty($v) && is_string($v) && preg_match('/getenv\\((.*?)\\)/', $v, $match)) {\n-                $v = (string) getenv($match[1]);\n-            }\n-        }\n-\n-        $parameters = $localParameters;\n-    }\n-\n-    return $parameters;\n-}\n-\n-/**\n- * Clears the application cache.\n- *\n- * Since this script is being executed via web requests and standalone from the Mautic application, we don't have access to Symfony's\n- * CLI suite.  So we'll go with Option B in this instance and just nuke the entire production cache and let Symfony rebuild it on the next\n- * application cycle.\n- *\n- * @return bool\n- */\n-function clear_mautic_cache()\n-{\n-    if (!recursive_remove_directory(MAUTIC_CACHE_DIR)) {\n-        process_error_log(['Could not remove the application cache.  You will need to manually delete '.MAUTIC_CACHE_DIR.'.']);\n-\n-        return false;\n-    }\n-\n-    // Follow the same pattern as the console command and flush opcache/apc as appropriate.\n-    if (function_exists('opcache_reset')) {\n-        opcache_reset();\n-    }\n-\n-    if (function_exists('apcu_clear_cache')) {\n-        apcu_clear_cache();\n-    }\n-\n-    return true;\n-}\n-\n-/**\n- * Copy a folder.\n- *\n- * This function is based on \\Joomla\\Filesystem\\Folder:copy()\n- *\n- * @param string $src  The path to the source folder\n- * @param string $dest The path to the destination folder\n- *\n- * @return array<string>|string|bool True on success, a single error message on a \"boot\" fail, or an array of errors from the recursive operation\n- */\n-function copy_directory($src, $dest)\n-{\n-    @set_time_limit((int) ini_get('max_execution_time'));\n-    $errorLog = [];\n-\n-    // Eliminate trailing directory separators, if any\n-    $src  = rtrim($src, DIRECTORY_SEPARATOR);\n-    $dest = rtrim($dest, DIRECTORY_SEPARATOR);\n-\n-    // Make sure the destination exists\n-    if (!is_dir($dest)) {\n-        if (!@mkdir($dest, 0777, true)) {\n-            return sprintf(\n-                'Could not move files from %s to production since the folder could not be created.',\n-                str_replace(MAUTIC_UPGRADE_ROOT, '', $src)\n-            );\n-        }\n-    }\n-\n-    if (!($dh = @opendir($src))) {\n-        return sprintf('Could not read directory %s to move files.', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-    }\n-\n-    // Walk through the directory copying files and recursing into folders.\n-    while (false !== ($file = readdir($dh))) {\n-        $sfid = $src.'/'.$file;\n-        $dfid = $dest.'/'.$file;\n-\n-        switch (filetype($sfid)) {\n-            case 'dir':\n-                if ('.' != $file && '..' != $file) {\n-                    $ret = copy_directory($sfid, $dfid);\n-\n-                    if (true !== $ret) {\n-                        if (is_array($ret)) {\n-                            $errorLog += $ret;\n-                        } else {\n-                            $errorLog[] = $ret;\n-                        }\n-                    }\n-                }\n-                break;\n-\n-            case 'file':\n-                if (!@rename($sfid, $dfid)) {\n-                    $errorLog[] = sprintf('Could not move file %s to production.', str_replace(MAUTIC_UPGRADE_ROOT, '', $sfid));\n-                }\n-                break;\n-        }\n-    }\n-\n-    if (!empty($errorLog)) {\n-        return $errorLog;\n-    }\n-\n-    return true;\n-}\n-\n-/**\n- * Fetches a request variable and returns the sanitized version of it.\n- *\n- * @param string $name\n- * @param string $default\n- * @param int    $filter\n- *\n- * @return mixed|string\n- */\n-function getVar($name, $default = '', $filter = FILTER_SANITIZE_STRING)\n-{\n-    if (isset($_REQUEST[$name])) {\n-        return filter_var($_REQUEST[$name], $filter);\n-    }\n-\n-    return $default;\n-}\n-\n-/**\n- * Moves the Mautic bundles from the upgrade directory to production.\n- *\n- * A typical update package will only include changed files in the bundles.  However, in this script we will assume that all of\n- * the bundle resources are included here and recursively iterate over the bundles in batches to update the filesystem.\n- *\n- * @param array<mixed> $status\n- * @param int          $maxCount\n- *\n- * @return array<mixed>\n- */\n-function move_mautic_bundles(array $status, $maxCount = 5)\n-{\n-    $errorLog = [];\n-\n-    // First, we will move any addon bundles into position\n-    if (is_dir(MAUTIC_UPGRADE_ROOT.'/plugins') && !$status['updateState']['pluginComplete']) {\n-        $iterator = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.'/plugins');\n-\n-        // Sanity check, make sure there are actually directories here to process\n-        $dirs = glob(MAUTIC_UPGRADE_ROOT.'/plugins/*', GLOB_ONLYDIR);\n-\n-        if (count($dirs)) {\n-            /** @var DirectoryIterator $directory */\n-            foreach ($iterator as $directory) {\n-                // Sanity checks\n-                if (!$directory->isDot() && $directory->isDir()) {\n-                    $src  = $directory->getPath().'/'.$directory->getFilename();\n-                    $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                    $result = copy_directory($src, $dest);\n-\n-                    if (true !== $result) {\n-                        if (is_array($result)) {\n-                            $errorLog += $result;\n-                        } else {\n-                            $errorLog[] = $result;\n-                        }\n-                    }\n-\n-                    $deleteDir = recursive_remove_directory($src);\n-\n-                    if (!$deleteDir) {\n-                        $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                    }\n-                }\n-            }\n-        }\n-\n-        // At this point, there shouldn't be any plugins remaining; nuke the folder\n-        $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.'/plugins');\n-\n-        if (!$deleteDir) {\n-            $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', '/plugins');\n-        }\n-\n-        process_error_log($errorLog);\n-\n-        $status['updateState']['pluginComplete'] = true;\n-\n-        if (-1 != $maxCount) {\n-            // Finished with plugins, get a response back to the app so we can iterate to the next part\n-            return $status;\n-        }\n-    }\n-\n-    // Now we move the main app bundles into production\n-    if (is_dir(MAUTIC_UPGRADE_ROOT.'/app/bundles') && !$status['updateState']['bundleComplete']) {\n-        // Initialize the bundle state if it isn't\n-        if (!isset($status['updateState']['completedBundles'])) {\n-            $status['updateState']['completedBundles'] = [];\n-        }\n-\n-        $completed = true;\n-        $iterator  = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.'/app/bundles');\n-\n-        // Sanity check, make sure there are actually directories here to process\n-        $dirs = glob(MAUTIC_UPGRADE_ROOT.'/app/bundles/*', GLOB_ONLYDIR);\n-\n-        if (count($dirs)) {\n-            $count = 0;\n-\n-            /** @var DirectoryIterator $directory */\n-            foreach ($iterator as $directory) {\n-                // Exit the loop if the count has reached 5\n-                if (-1 != $maxCount && $count === $maxCount) {\n-                    $completed = false;\n-                    break;\n-                }\n-\n-                // Sanity checks\n-                if (!$directory->isDot() && $directory->isDir()) {\n-                    // Don't process this bundle if we've already tried it\n-                    if (isset($status['updateState']['completedBundles'][$directory->getFilename()])) {\n-                        continue;\n-                    }\n-\n-                    $src  = $directory->getPath().'/'.$directory->getFilename();\n-                    $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                    $result = copy_directory($src, $dest);\n-\n-                    if (true !== $result) {\n-                        if (is_array($result)) {\n-                            $errorLog += $result;\n-                        } else {\n-                            $errorLog[] = $result;\n-                        }\n-                    }\n-\n-                    $deleteDir = recursive_remove_directory($src);\n-\n-                    if (!$deleteDir) {\n-                        $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                    }\n-\n-                    $status['updateState']['completedBundles'][$directory->getFilename()] = true;\n-                    ++$count;\n-                }\n-            }\n-        }\n-\n-        if ($completed) {\n-            $status['updateState']['bundleComplete'] = true;\n-\n-            // At this point, there shouldn't be any bundles remaining; nuke the folder\n-            $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.'/app/bundles');\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', '/app/bundles');\n-            }\n-        }\n-\n-        process_error_log($errorLog);\n-\n-        // If we haven't finished the bundles yet, throw a response back to repeat the step\n-        if (!$status['updateState']['bundleComplete']) {\n-            return $status;\n-        }\n-    }\n-\n-    // To get here, all of the bundle updates must have been processed (or there are literally none).  Step complete.\n-    $status['complete'] = true;\n-\n-    return $status;\n-}\n-\n-/**\n- * Moves the Mautic core files that are not part of bundles or vendors into production.\n- *\n- * The \"core\" files are broken into groups for purposes of the update script: bundles, vendor, and everything else.  This step\n- * will take care of the everything else.\n- *\n- * @param array<mixed> $status\n- *\n- * @return array<mixed>\n- */\n-function move_mautic_core(array $status)\n-{\n-    $errorLog = [];\n-\n-    // Multilevel directories\n-    $nestedDirectories = [\n-        '/media',\n-        '/themes',\n-        '/translations',\n-        '/app/middlewares',\n-    ];\n-\n-    foreach ($nestedDirectories as $dir) {\n-        if (is_dir(MAUTIC_UPGRADE_ROOT.$dir)) {\n-            copy_directories($dir, $errorLog);\n-\n-            // At this point, we can remove the media directory\n-            $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.$dir);\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', $dir);\n-            }\n-        }\n-    }\n-\n-    // Single level directories with files only\n-    $fileOnlyDirectories = [\n-        '/app/config',\n-        '/app/migrations',\n-        '/app',\n-        '/bin',\n-    ];\n-\n-    foreach ($fileOnlyDirectories as $dir) {\n-        if (copy_files($dir, $errorLog)) {\n-            // At this point, we can remove the config directory\n-            $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.$dir);\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', $dir);\n-            }\n-        }\n-    }\n-\n-    // Now move any root level files\n-    $iterator = new FilesystemIterator(MAUTIC_UPGRADE_ROOT);\n-\n-    /** @var FilesystemIterator $file */\n-    foreach ($iterator as $file) {\n-        // Sanity checks\n-        if ($file->isFile() && !in_array($file->getFilename(), ['deleted_files.txt', 'critical_migrations.txt', 'upgrade.php'])) {\n-            $src  = $file->getPath().'/'.$file->getFilename();\n-            $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-            if (!@rename($src, $dest)) {\n-                $errorLog[] = sprintf('Could not move file %s to production.', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-            }\n-        }\n-    }\n-\n-    process_error_log($errorLog);\n-\n-    // In this step, we'll also go ahead and remove deleted files, return the results from that\n-    return remove_mautic_deleted_files($status);\n-}\n-\n-/**\n- * Moves the Mautic dependencies from the upgrade directory to production.\n- *\n- * Since the /vendor folder is not stored under version control, we cannot accurately track changes in third party dependencies\n- * between releases.  Therefore, this step will recursively iterate over the vendors in batches to remove each package completely\n- * and replace it with the new version.\n- *\n- * @param array<mixed> $status\n- * @param int          $maxCount\n- *\n- * @return array<mixed>\n- */\n-function move_mautic_vendors(array $status, $maxCount = 5)\n-{\n-    $errorLog = [];\n-\n-    // If there isn't even a vendor directory, just skip this step\n-    if (!is_dir(MAUTIC_UPGRADE_ROOT.'/vendor')) {\n-        $status['complete']                      = true;\n-        $status['stepStatus']                    = 'Success';\n-        $status['nextStep']                      = 'Clearing Application Cache';\n-        $status['nextStepStatus']                = 'In Progress';\n-        $status['updateState']['vendorComplete'] = true;\n-\n-        return $status;\n-    }\n-\n-    // Initialize the vendor state if it isn't\n-    if (!isset($status['updateState']['completedVendors'])) {\n-        $status['updateState']['completedVendors'] = [];\n-    }\n-\n-    // Symfony is the largest of our vendors, we will process it first\n-    if (is_dir(MAUTIC_UPGRADE_ROOT.'/vendor/symfony') && !isset($status['updateState']['completedVendors']['symfony'])) {\n-        // Initialize the Symfony state if it isn't, this step will recurse\n-        if (!isset($status['updateState']['completedSymfony'])) {\n-            $status['updateState']['completedSymfony'] = [];\n-        }\n-\n-        $completed = true;\n-        $iterator  = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.'/vendor/symfony');\n-\n-        // Sanity check, make sure there are actually directories here to process\n-        $dirs = glob(MAUTIC_UPGRADE_ROOT.'/vendor/symfony/*', GLOB_ONLYDIR);\n-\n-        if (count($dirs)) {\n-            $count = 0;\n-\n-            /** @var DirectoryIterator $directory */\n-            foreach ($iterator as $directory) {\n-                // Exit the loop if the count has reached 5\n-                if (-1 != $maxCount && $count === $maxCount) {\n-                    $completed = false;\n-                    break;\n-                }\n-\n-                // Sanity checks\n-                if (!$directory->isDot() && $directory->isDir()) {\n-                    // Don't process this directory if we've already tried it\n-                    if (isset($status['updateState']['completedSymfony'][$directory->getFilename()])) {\n-                        continue;\n-                    }\n-\n-                    $src  = $directory->getPath().'/'.$directory->getFilename();\n-                    $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                    // We'll need to completely remove the existing vendor first\n-                    recursive_remove_directory($dest);\n-\n-                    $result = copy_directory($src, $dest);\n-\n-                    if (true !== $result) {\n-                        if (is_array($result)) {\n-                            $errorLog += $result;\n-                        } else {\n-                            $errorLog[] = $result;\n-                        }\n-                    }\n-\n-                    $deleteDir = recursive_remove_directory($src);\n-\n-                    if (!$deleteDir) {\n-                        $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                    }\n-\n-                    $status['updateState']['completedSymfony'][$directory->getFilename()] = true;\n-                    ++$count;\n-                }\n-            }\n-        }\n-\n-        if ($completed) {\n-            $status['updateState']['completedVendors']['symfony'] = true;\n-\n-            // At this point, there shouldn't be any Symfony code remaining; nuke the folder\n-            $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.'/vendor/symfony');\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', '/vendor/symfony');\n-            }\n-        }\n-\n-        process_error_log($errorLog);\n-\n-        // If we haven't finished Symfony yet, throw a response back to repeat the step\n-        if (!isset($status['updateState']['completedVendors']['symfony'])) {\n-            return $status;\n-        }\n-    }\n-\n-    // Once we've gotten here, we can safely iterate through the rest of the vendor directory; the rest of the contents are rather small in size\n-    $completed = true;\n-    $iterator  = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.'/vendor');\n-\n-    // Sanity check, make sure there are actually directories here to process\n-    $dirs = glob(MAUTIC_UPGRADE_ROOT.'/vendor/*', GLOB_ONLYDIR);\n-\n-    if (count($dirs)) {\n-        $count = 0;\n-\n-        /** @var DirectoryIterator $directory */\n-        foreach ($iterator as $directory) {\n-            // Exit the loop if the count has reached 5\n-            if (-1 != $maxCount && $count === $maxCount) {\n-                $completed = false;\n-                break;\n-            }\n-\n-            // Sanity checks\n-            if (!$directory->isDot() && $directory->isDir()) {\n-                // Don't process this directory if we've already tried it\n-                if (isset($status['updateState']['completedVendors'][$directory->getFilename()])) {\n-                    continue;\n-                }\n-\n-                $src  = $directory->getPath().'/'.$directory->getFilename();\n-                $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                // We'll need to completely remove the existing vendor first\n-                recursive_remove_directory($dest);\n-\n-                $result = copy_directory($src, $dest);\n-\n-                if (true !== $result) {\n-                    if (is_array($result)) {\n-                        $errorLog += $result;\n-                    } else {\n-                        $errorLog[] = $result;\n-                    }\n-                }\n-\n-                $deleteDir = recursive_remove_directory($src);\n-\n-                if (!$deleteDir) {\n-                    $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                }\n-\n-                $status['updateState']['completedVendors'][$directory->getFilename()] = true;\n-                ++$count;\n-            }\n-        }\n-    }\n-\n-    if ($completed) {\n-        $status['updateState']['vendorComplete'] = true;\n-\n-        // Move the autoload.php file over now\n-        if (!@rename(MAUTIC_UPGRADE_ROOT.'/vendor/autoload.php', MAUTIC_ROOT.'/vendor/autoload.php')) {\n-            $errorLog[] = 'Could not move file /vendor/autoload.php to production.';\n-        }\n-\n-        // At this point, there shouldn't be any vendors remaining; nuke the folder\n-        $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.'/vendor');\n-\n-        if (!$deleteDir) {\n-            $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', '/vendor');\n-        }\n-    }\n-\n-    process_error_log($errorLog);\n-\n-    // If we haven't finished the vendors yet, throw a response back to repeat the step\n-    if (!$status['updateState']['vendorComplete']) {\n-        return $status;\n-    }\n-\n-    // Once we get here, we have finished the moving files step; notifiy Mautic of this\n-    $status['complete']                      = true;\n-    $status['stepStatus']                    = 'Success';\n-    $status['nextStep']                      = 'Clearing Application Cache';\n-    $status['nextStepStatus']                = 'In Progress';\n-    $status['updateState']['vendorComplete'] = true;\n-\n-    return $status;\n-}\n-\n-/**\n- * Copy files from the directory.\n- *\n- * @param string        $dir\n- * @param array<string> &$errorLog\n- *\n- * @return bool\n- */\n-function copy_files($dir, &$errorLog)\n-{\n-    if (is_dir(MAUTIC_UPGRADE_ROOT.$dir)) {\n-        $iterator = new FilesystemIterator(MAUTIC_UPGRADE_ROOT.$dir);\n-\n-        /** @var FilesystemIterator $file */\n-        foreach ($iterator as $file) {\n-            // Sanity checks\n-            if ($file->isFile()) {\n-                $src  = $file->getPath().'/'.$file->getFilename();\n-                $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                if (!@rename($src, $dest)) {\n-                    $errorLog[] = sprintf('Could not move file %s to production.', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                }\n-            }\n-        }\n-\n-        return true;\n-    }\n-\n-    return false;\n-}\n-\n-/**\n- * Copy directories.\n- *\n- * @param string        $dir\n- * @param array<string> &$errorLog\n- * @param bool          $createDest\n- */\n-function copy_directories($dir, &$errorLog, $createDest = true): bool\n-{\n-    // Ensure the destination directory exists\n-    $exists = file_exists(MAUTIC_ROOT.$dir);\n-    if ($createDest && !$exists) {\n-        mkdir(MAUTIC_ROOT.$dir, 0755, true);\n-    } elseif (!$exists) {\n-        $errorLog[] = sprintf('%s does not exist.', MAUTIC_ROOT.$dir);\n-\n-        return false;\n-    }\n-\n-    // Copy root level files first\n-    copy_files($dir, $errorLog);\n-\n-    $iterator = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.$dir);\n-\n-    /** @var DirectoryIterator $directory */\n-    foreach ($iterator as $directory) {\n-        // Sanity checks\n-        if (!$directory->isDot() && $directory->isDir()) {\n-            $src  = $directory->getPath().'/'.$directory->getFilename();\n-            $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-            $result = copy_directory($src, $dest);\n-\n-            if (true !== $result) {\n-                if (is_array($result)) {\n-                    $errorLog += $result;\n-                } else {\n-                    $errorLog[] = $result;\n-                }\n-            }\n-\n-            $deleteDir = recursive_remove_directory($src);\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-            }\n-        }\n-    }\n-\n-    return true;\n-}\n-\n-/**\n- * Processes the error log for each step.\n- *\n- * @param array<string> $errorLog\n- */\n-function process_error_log(array $errorLog): void\n-{\n-    // If there were any errors, add them to the error log\n-    if (count($errorLog)) {\n-        // Check if the error log exists first\n-        if (file_exists(MAUTIC_UPGRADE_ERROR_LOG)) {\n-            $errors = file_get_contents(MAUTIC_UPGRADE_ERROR_LOG);\n-        } else {\n-            $errors = \"<?php die('no access'); \\n\\n\";\n-        }\n-\n-        $errors .= implode(PHP_EOL, $errorLog).\"\\n\";\n-\n-        @file_put_contents(MAUTIC_UPGRADE_ERROR_LOG, $errors);\n-    }\n-}\n-\n-/**\n- * Tries to recursively delete a directory.\n- *\n- * This code is based on the recursive_remove_directory function used by Akeeba Restore\n- *\n- * @param string $directory\n- *\n- * @return bool\n- */\n-function recursive_remove_directory($directory)\n-{\n-    // if the path has a slash at the end we remove it here\n-    if ('/' == substr($directory, -1)) {\n-        $directory = substr($directory, 0, -1);\n-    }\n-\n-    // if the path is not valid or is not a directory ...\n-    if (!file_exists($directory)) {\n-        return true;\n-    } elseif (!is_dir($directory)) {\n-        return false;\n-    // ... if the path is not readable\n-    } elseif (!is_readable($directory)) {\n-        // ... we return false and exit the function\n-        return false;\n-    // ... else if the path is readable\n-    } else {\n-        // we open the directory\n-        $handle = opendir($directory);\n-\n-        // and scan through the items inside\n-        while (false !== ($item = readdir($handle))) {\n-            // if the filepointer is not the current directory\n-            // or the parent directory\n-            if ('.' != $item && '..' != $item) {\n-                // we build the new path to delete\n-                $path = $directory.'/'.$item;\n-                // if the new path is a directory\n-                if (is_dir($path)) {\n-                    // we call this function with the new path\n-                    recursive_remove_directory($path);\n-                // if the new path is a file\n-                } else {\n-                    // we remove the file\n-                    @unlink($path);\n-                }\n-            }\n-        }\n-\n-        // close the directory\n-        closedir($handle);\n-\n-        // try to delete the now empty directory\n-        if (!@rmdir($directory)) {\n-            // return false if not possible\n-            return false;\n-        }\n-\n-        // return success\n-        return true;\n-    }\n-}\n-\n-/**\n- * Removes deleted files from the system.\n- *\n- * While packaging updates, the script will generate a list of deleted files in comparison to the previous version.  In this step,\n- * we will process that list to remove files which are no longer included in the application.\n- *\n- * @param array<mixed> $status\n- *\n- * @return array<mixed>\n- */\n-function remove_mautic_deleted_files(array $status)\n-{\n-    $errorLog = [];\n-\n-    // Make sure we have a deleted_files list otherwise we can't process this step\n-    if (file_exists(MAUTIC_UPGRADE_ROOT.'/deleted_files.txt')) {\n-        $deletedFiles = json_decode(file_get_contents(MAUTIC_UPGRADE_ROOT.'/deleted_files.txt'), true);\n-\n-        foreach ($deletedFiles as $file) {\n-            $path = MAUTIC_ROOT.'/'.$file;\n-\n-            // If it doesn't exist, don't even bother\n-            if (file_exists($path)) {\n-                // Try setting the permissions to 777 just to make sure we can get rid of the file\n-                @chmod($path, 0777);\n-\n-                if (!@unlink($path)) {\n-                    // Failed to delete, reset the permissions to 644 for safety\n-                    @chmod($path, 0644);\n-\n-                    $errorLog[] = sprintf(\n-                        'Failed removing the file at %s from the production path.  As this is a deleted file, you can manually remove this file.',\n-                        $file\n-                    );\n-                } else {\n-                    // Check to see if directory is now empty and if so, delete it\n-                    $dirpath = dirname($path);\n-                    if (file_exists($dirpath) && !glob($dirpath.'/*')) {\n-                        @chmod($dirpath, 0777);\n-                        if (!@unlink($dirpath)) {\n-                            // Failed to delete, reset the permissions to 0755 for safety\n-                            @chmod($dirpath, 0755);\n-                        }\n-                    }\n-                }\n-            }\n-        }\n-    } else {\n-        $errorLog[] = 'The file containing the list of deleted files was not found, could not process the deleted file list.';\n-    }\n-\n-    process_error_log($errorLog);\n-\n-    $status['complete']                    = true;\n-    $status['updateState']['coreComplete'] = true;\n-\n-    return $status;\n-}\n-\n-/**\n- * @param array<mixed> $state\n- *\n- * @return string\n- */\n-function get_state_param(array $state)\n-{\n-    return base64_encode(json_encode($state));\n-}\n-\n-/**\n- * Send the response back to the main application.\n- *\n- * @param array<mixed> $status\n- */\n-function send_response(array $status): void\n-{\n-    header('Content-Type: application/json; charset=utf-8');\n-\n-    echo json_encode($status);\n-}\n-\n-/**\n- * Wrap content in some HTML.\n- */\n-function html_body(string $content): void\n-{\n-    $html = <<<HTML\n-<!DOCTYPE html>\n-<html lang=\"en\">\n-  <head>\n-    <meta charset=\"utf-8\">\n-    <title>Upgrade Mautic</title>\n-    <!-- Latest compiled and minified CSS -->\n-    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\n-  </head>\n-  <body>\n-    <div class=\"container\" style=\"padding: 25px;\">\n-        $content\n-    </div>\n-  </body>\n-</html>\n-HTML;\n-\n-    echo $html;\n-\n-    exit;\n-}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/73b18e9a434a28e528fe0e3d03620e7367bdcdca",
        "url": "https://api.github.com/repos/mautic/mautic/commits/73b18e9a434a28e528fe0e3d03620e7367bdcdca",
        "html_url": "https://github.com/mautic/mautic/commit/73b18e9a434a28e528fe0e3d03620e7367bdcdca",
        "message": "Merge remote-tracking branch 'security/advisory-fix-MST-34-4.x' into 4.4",
        "files": [
            {
                "sha": "603a15c36ea8106b913850825db46b28c362f6de",
                "filename": "app/assets/scaffold/build/package_devhead.php",
                "status": "modified",
                "additions": 3,
                "deletions": 11,
                "changes": 14,
                "blob_url": "https://github.com/mautic/mautic/blob/73b18e9a434a28e528fe0e3d03620e7367bdcdca/app%2Fassets%2Fscaffold%2Fbuild%2Fpackage_devhead.php",
                "raw_url": "https://github.com/mautic/mautic/raw/73b18e9a434a28e528fe0e3d03620e7367bdcdca/app%2Fassets%2Fscaffold%2Fbuild%2Fpackage_devhead.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fassets%2Fscaffold%2Fbuild%2Fpackage_devhead.php?ref=73b18e9a434a28e528fe0e3d03620e7367bdcdca",
                "patch": "@@ -1,20 +1,12 @@\n <?php\n-/**\n- * @copyright   2014 Mautic Contributors. All rights reserved\n- * @author      Mautic\n- *\n- * @link        http://mautic.org\n- *\n- * @license     GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html\n- */\n+\n+$baseDir = __DIR__;\n \n /*\n  * Build a \"production\" package from the current development HEAD, this should be run after a 'composer install --no-dev --no-scripts --optimize-autoloader'\n  * to emulate a proper release package\n  */\n \n-$baseDir = __DIR__;\n-\n // Preparation - Remove previous packages\n echo \"Preparing environment\\n\";\n umask(022);\n@@ -42,7 +34,7 @@\n system('zip -r ../packages/mautic-head.zip . > /dev/null');\n \n // Copy over upgrade.php\n-system('cp '.__DIR__.'/../upgrade.php '.__DIR__.'/packaging');\n+system('cp '.__DIR__.'/../app/assets/scaffold/files/upgrade.php '.__DIR__.'/packaging');\n \n chdir(__DIR__.'/packaging');\n echo \"Packaging Mautic Update Package\\n\";"
            },
            {
                "sha": "0f3fc14a62f5dccbc399f316f01485689561e4fc",
                "filename": "app/composer.json",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/mautic/mautic/blob/73b18e9a434a28e528fe0e3d03620e7367bdcdca/app%2Fcomposer.json",
                "raw_url": "https://github.com/mautic/mautic/raw/73b18e9a434a28e528fe0e3d03620e7367bdcdca/app%2Fcomposer.json",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fcomposer.json?ref=73b18e9a434a28e528fe0e3d03620e7367bdcdca",
                "patch": "@@ -141,7 +141,6 @@\n         \"[web-root]/index_dev.php\": \"assets/scaffold/files/index_dev.php\",\n         \"[web-root]/offline.php\": \"assets/scaffold/files/offline.php\",\n         \"[web-root]/robots.txt\": \"assets/scaffold/files/robots.txt\",\n-        \"[web-root]/upgrade.php\": \"assets/scaffold/files/upgrade.php\",\n         \"[web-root]/translations/.htaccess\": \"assets/scaffold/files/translations.htaccess\",\n         \"[web-root]/favicon.ico\": \"assets/scaffold/files/favicon.ico\",\n         \"[web-root]/media/dashboards/alternative-default.json\": \"assets/scaffold/media/dashboards/alternative-default.json\","
            },
            {
                "sha": "113d99bafb4ec1e61198b47565d85687f94989d2",
                "filename": "upgrade.php",
                "status": "removed",
                "additions": 0,
                "deletions": 1076,
                "changes": 1076,
                "blob_url": "https://github.com/mautic/mautic/blob/89f964d06f00688016b38a56dfd9e95fc676c7ce/upgrade.php",
                "raw_url": "https://github.com/mautic/mautic/raw/89f964d06f00688016b38a56dfd9e95fc676c7ce/upgrade.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/upgrade.php?ref=89f964d06f00688016b38a56dfd9e95fc676c7ce",
                "patch": "@@ -1,1076 +0,0 @@\n-<?php\n-\n-/*\n- * @copyright   2014 Mautic Contributors. All rights reserved\n- * @author      Mautic\n- *\n- * @link        http://mautic.org\n- *\n- * @license     GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html\n- */\n-\n-ini_set('display_errors', 'Off');\n-date_default_timezone_set('UTC');\n-\n-// Running this script standalone is no longer supported\n-$standalone = 0;\n-$task       = getVar('task');\n-\n-define('IN_CLI', 'cli' === php_sapi_name());\n-define('MAUTIC_ROOT', (IN_CLI || $standalone || empty($task)) ? __DIR__ : dirname(__DIR__));\n-define('MAUTIC_APP_ROOT', MAUTIC_ROOT.'/app');\n-\n-if ($standalone || IN_CLI) {\n-    if (!file_exists(__DIR__.'/upgrade')) {\n-        mkdir(__DIR__.'/upgrade');\n-    }\n-    define('MAUTIC_UPGRADE_ROOT', __DIR__.'/upgrade');\n-} else {\n-    define('MAUTIC_UPGRADE_ROOT', __DIR__);\n-}\n-\n-// Fail-safe PHP version check\n-if (file_exists(MAUTIC_UPGRADE_ROOT.'/app/release_metadata.json')) {\n-    $metadata = json_decode(file_get_contents(MAUTIC_UPGRADE_ROOT.'/app/release_metadata.json'), true);\n-\n-    // Are we running the minimum version?\n-    if (version_compare(PHP_VERSION, $metadata['minimum_php_version'], 'lt')) {\n-        echo 'Your server does not meet the minimum PHP requirements. Mautic requires PHP version '.$metadata['minimum_php_version'].' while your server has '\n-            .PHP_VERSION.'. Please contact your host to update your PHP installation.'.\"\\n\";\n-        exit;\n-    }\n-\n-    // Are we running a version newer than what Mautic supports?\n-    if (version_compare(PHP_VERSION, $metadata['maximum_php_version'], 'gt')) {\n-        echo 'Mautic does not support PHP version '.PHP_VERSION.' at this time. To use Mautic, you will need to downgrade to an earlier version.'\n-            .\"\\n\";\n-        exit;\n-    }\n-}\n-\n-// Get local parameters\n-$localParameters = get_local_config();\n-$cacheDir        = (isset($localParameters['cache_path'])) ? str_replace('%kernel.root_dir%', MAUTIC_APP_ROOT, $localParameters['cache_path'].'/prod') : MAUTIC_APP_ROOT.'/../var/cache/prod';\n-$logDir          = (isset($localParameters['log_path'])) ? str_replace('%kernel.root_dir%', MAUTIC_APP_ROOT, $localParameters['log_path'].'/prod') : MAUTIC_APP_ROOT.'/../var/logs';\n-\n-define('MAUTIC_CACHE_DIR', $cacheDir);\n-define('MAUTIC_UPGRADE_ERROR_LOG', $logDir.'/upgrade_errors.php');\n-\n-/*\n- * Updating to 2.8.1: Check to see if we have a mautic_session_name\n- * and use that to populate the actual session name that will be\n- * generated after a successful update.\n- */\n-if (isset($_COOKIE['mautic_session_name'])) {\n-    $sessionValue = $_COOKIE[$_COOKIE['mautic_session_name']];\n-\n-    include MAUTIC_APP_ROOT.'/config/paths.php';\n-    $localConfigPath = str_replace('%kernel.root_dir%', MAUTIC_APP_ROOT, $paths['local_config']);\n-\n-    $newSessionName = md5(md5($localConfigPath).$localParameters['secret_key']);\n-\n-    setcookie($newSessionName, $sessionValue, 0, '/', '', false, true);\n-\n-    unset($_COOKIE['mautic_session_name']);\n-    setcookie('mautic_session_name', null, -1);\n-}\n-\n-// Fetch the update state out of the request if applicable\n-$state = json_decode(base64_decode(getVar('updateState', 'W10=')), true);\n-\n-// Prime the state if it's empty\n-if (empty($state)) {\n-    $state['pluginComplete'] = false;\n-    $state['bundleComplete'] = false;\n-    $state['cacheComplete']  = false;\n-    $state['coreComplete']   = false;\n-    $state['vendorComplete'] = false;\n-}\n-$status = ['complete' => false, 'error' => false, 'updateState' => $state, 'stepStatus' => 'In Progress'];\n-\n-if (IN_CLI) {\n-    echo \"Upgrading through upgrade.php using the CLI is no longer supported. Please use 'php bin/console mautic:update:find' instead. \\n\";\n-    exit(1);\n-}\n-\n-// Web request upgrade\n-$request         = explode('?', $_SERVER['REQUEST_URI'])[0];\n-$url             = \"//{$_SERVER['HTTP_HOST']}{$request}\";\n-$isSSL           = (!empty($_SERVER['HTTPS']) && 'off' != $_SERVER['HTTPS']);\n-$cookie_path     = (isset($localParameters['cookie_path'])) ? $localParameters['cookie_path'] : '/';\n-$cookie_domain   = (isset($localParameters['cookie_domain'])) ? $localParameters['cookie_domain'] : '';\n-$cookie_secure   = (isset($localParameters['cookie_secure'])) ? $localParameters['cookie_secure'] : $isSSL;\n-$cookie_httponly = (isset($localParameters['cookie_httponly'])) ? $localParameters['cookie_httponly'] : false;\n-\n-setcookie('mautic_update', $task, time() + 300, $cookie_path, $cookie_domain, $cookie_secure, $cookie_httponly);\n-$query    = '';\n-$maxCount = (!empty($standalone)) ? 25 : 5;\n-\n-switch ($task) {\n-    case '':\n-        html_body(\"<div class='well text-center'>This script cannot run standalone. Please log into Mautic to check for updates.</div>\");\n-\n-        // no break\n-    case 'moveBundles':\n-        $status = move_mautic_bundles($status, $maxCount);\n-        if (empty($status['complete'])) {\n-            if (!isset($state['refresh_count'])) {\n-                $state['refresh_count'] = 1;\n-            }\n-            $nextTask = 'moveBundles';\n-            $query    = 'count='.$state['refresh_count'].'&';\n-            ++$state['refresh_count'];\n-        } else {\n-            $nextTask = 'moveCore';\n-            unset($state['refresh_count']);\n-        }\n-        break;\n-\n-    case 'moveCore':\n-        $status   = move_mautic_core($status);\n-        $nextTask = 'moveVendors';\n-        break;\n-\n-    case 'moveVendors':\n-        $status   = move_mautic_vendors($status, $maxCount);\n-        $nextTask = (!empty($status['complete'])) ? 'clearCache' : 'moveVendors';\n-\n-        if (empty($status['complete'])) {\n-            if (!isset($state['refresh_count'])) {\n-                $state['refresh_count'] = 1;\n-            }\n-            $nextTask = 'moveVendors';\n-            $query    = 'count='.$state['refresh_count'].'&';\n-            ++$state['refresh_count'];\n-        } else {\n-            $nextTask = 'clearCache';\n-            unset($state['refresh_count']);\n-        }\n-        break;\n-\n-    case 'clearCache':\n-        clear_mautic_cache();\n-        $nextTask = 'finish';\n-        break;\n-\n-    case 'finish':\n-        $status['complete']                     = true;\n-        $status['stepStatus']                   = 'Success';\n-        $status['nextStep']                     = 'Processing Database Updates';\n-        $status['nextStepStatus']               = 'In Progress';\n-        $status['updateState']['cacheComplete'] = true;\n-\n-        break;\n-\n-    default:\n-        $status['error']      = true;\n-        $status['message']    = 'Invalid task';\n-        $status['stepStatus'] = 'Failed';\n-        break;\n-}\n-\n-// Request through Mautic's UI\n-$status['updateState'] = get_state_param($status['updateState']);\n-\n-send_response($status);\n-\n-/**\n- * Get local parameters.\n- *\n- * @return mixed\n- */\n-function get_local_config()\n-{\n-    static $parameters;\n-\n-    if (null === $parameters) {\n-        // Used in paths.php\n-        $root = MAUTIC_APP_ROOT;\n-\n-        /** @var array $paths */\n-        include MAUTIC_APP_ROOT.'/config/paths.php';\n-\n-        // Include local config to get cache_path\n-        $localConfig = str_replace('%kernel.root_dir%', MAUTIC_APP_ROOT, $paths['local_config']);\n-\n-        /** @var array $parameters */\n-        include $localConfig;\n-\n-        $localParameters = $parameters;\n-\n-        //check for parameter overrides\n-        if (file_exists(MAUTIC_APP_ROOT.'/config/parameters_local.php')) {\n-            /** @var $parameters */\n-            include MAUTIC_APP_ROOT.'/config/parameters_local.php';\n-            $localParameters = array_merge($localParameters, $parameters);\n-        }\n-\n-        foreach ($localParameters as $k => &$v) {\n-            if (!empty($v) && is_string($v) && preg_match('/getenv\\((.*?)\\)/', $v, $match)) {\n-                $v = (string) getenv($match[1]);\n-            }\n-        }\n-\n-        $parameters = $localParameters;\n-    }\n-\n-    return $parameters;\n-}\n-\n-/**\n- * Clears the application cache.\n- *\n- * Since this script is being executed via web requests and standalone from the Mautic application, we don't have access to Symfony's\n- * CLI suite.  So we'll go with Option B in this instance and just nuke the entire production cache and let Symfony rebuild it on the next\n- * application cycle.\n- *\n- * @return array\n- */\n-function clear_mautic_cache()\n-{\n-    if (!recursive_remove_directory(MAUTIC_CACHE_DIR)) {\n-        process_error_log(['Could not remove the application cache.  You will need to manually delete '.MAUTIC_CACHE_DIR.'.']);\n-\n-        return false;\n-    }\n-\n-    // Follow the same pattern as the console command and flush opcache/apc as appropriate.\n-    if (function_exists('opcache_reset')) {\n-        opcache_reset();\n-    }\n-\n-    if (function_exists('apcu_clear_cache')) {\n-        apcu_clear_cache();\n-    }\n-\n-    return true;\n-}\n-\n-/**\n- * @param $command\n- *\n- * @return array\n- *\n- * @throws Exception\n- */\n-function run_symfony_command($command, array $args)\n-{\n-    static $application;\n-\n-    require_once MAUTIC_APP_ROOT.'/autoload.php';\n-    require_once MAUTIC_APP_ROOT.'/AppKernel.php';\n-\n-    $args = array_merge(\n-        ['console', $command],\n-        $args\n-    );\n-\n-    if (null == $application) {\n-        $kernel      = new \\AppKernel('prod', true);\n-        $application = new \\Symfony\\Bundle\\FrameworkBundle\\Console\\Application($kernel);\n-        $application->setAutoExit(false);\n-    }\n-\n-    $input    = new \\Symfony\\Component\\Console\\Input\\ArgvInput($args);\n-    $output   = new \\Symfony\\Component\\Console\\Output\\NullOutput();\n-    $exitCode = $application->run($input, $output);\n-\n-    unset($input, $output);\n-\n-    return 0 === $exitCode;\n-}\n-\n-/**\n- * Copy a folder.\n- *\n- * This function is based on \\Joomla\\Filesystem\\Folder:copy()\n- *\n- * @param string $src  The path to the source folder\n- * @param string $dest The path to the destination folder\n- *\n- * @return array|string|bool True on success, a single error message on a \"boot\" fail, or an array of errors from the recursive operation\n- */\n-function copy_directory($src, $dest)\n-{\n-    @set_time_limit(ini_get('max_execution_time'));\n-    $errorLog = [];\n-\n-    // Eliminate trailing directory separators, if any\n-    $src  = rtrim($src, DIRECTORY_SEPARATOR);\n-    $dest = rtrim($dest, DIRECTORY_SEPARATOR);\n-\n-    // Make sure the destination exists\n-    if (!is_dir($dest)) {\n-        if (!@mkdir($dest, 0777, true)) {\n-            return sprintf(\n-                'Could not move files from %s to production since the folder could not be created.',\n-                str_replace(MAUTIC_UPGRADE_ROOT, '', $src)\n-            );\n-        }\n-    }\n-\n-    if (!($dh = @opendir($src))) {\n-        return sprintf('Could not read directory %s to move files.', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-    }\n-\n-    // Walk through the directory copying files and recursing into folders.\n-    while (false !== ($file = readdir($dh))) {\n-        $sfid = $src.'/'.$file;\n-        $dfid = $dest.'/'.$file;\n-\n-        switch (filetype($sfid)) {\n-            case 'dir':\n-                if ('.' != $file && '..' != $file) {\n-                    $ret = copy_directory($sfid, $dfid);\n-\n-                    if (true !== $ret) {\n-                        if (is_array($ret)) {\n-                            $errorLog += $ret;\n-                        } else {\n-                            $errorLog[] = $ret;\n-                        }\n-                    }\n-                }\n-                break;\n-\n-            case 'file':\n-                if (!@rename($sfid, $dfid)) {\n-                    $errorLog[] = sprintf('Could not move file %s to production.', str_replace(MAUTIC_UPGRADE_ROOT, '', $sfid));\n-                }\n-                break;\n-        }\n-    }\n-\n-    if (!empty($errorLog)) {\n-        return $errorLog;\n-    }\n-\n-    return true;\n-}\n-\n-/**\n- * Fetches a request variable and returns the sanitized version of it.\n- *\n- * @param string $name\n- * @param string $default\n- * @param int    $filter\n- *\n- * @return mixed|string\n- */\n-function getVar($name, $default = '', $filter = FILTER_SANITIZE_STRING)\n-{\n-    if (isset($_REQUEST[$name])) {\n-        return filter_var($_REQUEST[$name], $filter);\n-    }\n-\n-    return $default;\n-}\n-\n-/**\n- * Moves the Mautic bundles from the upgrade directory to production.\n- *\n- * A typical update package will only include changed files in the bundles.  However, in this script we will assume that all of\n- * the bundle resources are included here and recursively iterate over the bundles in batches to update the filesystem.\n- *\n- * @param int $maxCount\n- *\n- * @return array\n- */\n-function move_mautic_bundles(array $status, $maxCount = 5)\n-{\n-    $errorLog = [];\n-\n-    // First, we will move any addon bundles into position\n-    if (is_dir(MAUTIC_UPGRADE_ROOT.'/plugins') && !$status['updateState']['pluginComplete']) {\n-        $iterator = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.'/plugins');\n-\n-        // Sanity check, make sure there are actually directories here to process\n-        $dirs = glob(MAUTIC_UPGRADE_ROOT.'/plugins/*', GLOB_ONLYDIR);\n-\n-        if (count($dirs)) {\n-            /** @var DirectoryIterator $directory */\n-            foreach ($iterator as $directory) {\n-                // Sanity checks\n-                if (!$directory->isDot() && $directory->isDir()) {\n-                    $src  = $directory->getPath().'/'.$directory->getFilename();\n-                    $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                    $result = copy_directory($src, $dest);\n-\n-                    if (true !== $result) {\n-                        if (is_array($result)) {\n-                            $errorLog += $result;\n-                        } else {\n-                            $errorLog[] = $result;\n-                        }\n-                    }\n-\n-                    $deleteDir = recursive_remove_directory($src);\n-\n-                    if (!$deleteDir) {\n-                        $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                    }\n-                }\n-            }\n-        }\n-\n-        // At this point, there shouldn't be any plugins remaining; nuke the folder\n-        $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.'/plugins');\n-\n-        if (!$deleteDir) {\n-            $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', '/plugins');\n-        }\n-\n-        process_error_log($errorLog);\n-\n-        $status['updateState']['pluginComplete'] = true;\n-\n-        if (-1 != $maxCount) {\n-            // Finished with plugins, get a response back to the app so we can iterate to the next part\n-            return $status;\n-        }\n-    }\n-\n-    // Now we move the main app bundles into production\n-    if (is_dir(MAUTIC_UPGRADE_ROOT.'/app/bundles') && !$status['updateState']['bundleComplete']) {\n-        // Initialize the bundle state if it isn't\n-        if (!isset($status['updateState']['completedBundles'])) {\n-            $status['updateState']['completedBundles'] = [];\n-        }\n-\n-        $completed = true;\n-        $iterator  = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.'/app/bundles');\n-\n-        // Sanity check, make sure there are actually directories here to process\n-        $dirs = glob(MAUTIC_UPGRADE_ROOT.'/app/bundles/*', GLOB_ONLYDIR);\n-\n-        if (count($dirs)) {\n-            $count = 0;\n-\n-            /** @var DirectoryIterator $directory */\n-            foreach ($iterator as $directory) {\n-                // Exit the loop if the count has reached 5\n-                if (-1 != $maxCount && $count === $maxCount) {\n-                    $completed = false;\n-                    break;\n-                }\n-\n-                // Sanity checks\n-                if (!$directory->isDot() && $directory->isDir()) {\n-                    // Don't process this bundle if we've already tried it\n-                    if (isset($status['updateState']['completedBundles'][$directory->getFilename()])) {\n-                        continue;\n-                    }\n-\n-                    $src  = $directory->getPath().'/'.$directory->getFilename();\n-                    $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                    $result = copy_directory($src, $dest);\n-\n-                    if (true !== $result) {\n-                        if (is_array($result)) {\n-                            $errorLog += $result;\n-                        } else {\n-                            $errorLog[] = $result;\n-                        }\n-                    }\n-\n-                    $deleteDir = recursive_remove_directory($src);\n-\n-                    if (!$deleteDir) {\n-                        $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                    }\n-\n-                    $status['updateState']['completedBundles'][$directory->getFilename()] = true;\n-                    ++$count;\n-                }\n-            }\n-        }\n-\n-        if ($completed) {\n-            $status['updateState']['bundleComplete'] = true;\n-\n-            // At this point, there shouldn't be any bundles remaining; nuke the folder\n-            $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.'/app/bundles');\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', '/app/bundles');\n-            }\n-        }\n-\n-        process_error_log($errorLog);\n-\n-        // If we haven't finished the bundles yet, throw a response back to repeat the step\n-        if (!$status['updateState']['bundleComplete']) {\n-            return $status;\n-        }\n-    }\n-\n-    // To get here, all of the bundle updates must have been processed (or there are literally none).  Step complete.\n-    $status['complete'] = true;\n-\n-    return $status;\n-}\n-\n-/**\n- * Moves the Mautic core files that are not part of bundles or vendors into production.\n- *\n- * The \"core\" files are broken into groups for purposes of the update script: bundles, vendor, and everything else.  This step\n- * will take care of the everything else.\n- *\n- * @return array\n- */\n-function move_mautic_core(array $status)\n-{\n-    $errorLog = [];\n-\n-    // Multilevel directories\n-    $nestedDirectories = [\n-        '/media',\n-        '/themes',\n-        '/translations',\n-        '/app/middlewares',\n-    ];\n-\n-    foreach ($nestedDirectories as $dir) {\n-        if (is_dir(MAUTIC_UPGRADE_ROOT.$dir)) {\n-            copy_directories($dir, $errorLog);\n-\n-            // At this point, we can remove the media directory\n-            $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.$dir);\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', $dir);\n-            }\n-        }\n-    }\n-\n-    // Single level directories with files only\n-    $fileOnlyDirectories = [\n-        '/app/config',\n-        '/app/migrations',\n-        '/app',\n-        '/bin',\n-    ];\n-\n-    foreach ($fileOnlyDirectories as $dir) {\n-        if (copy_files($dir, $errorLog)) {\n-            // At this point, we can remove the config directory\n-            $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.$dir);\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', $dir);\n-            }\n-        }\n-    }\n-\n-    // Now move any root level files\n-    $iterator = new FilesystemIterator(MAUTIC_UPGRADE_ROOT);\n-\n-    /** @var FilesystemIterator $file */\n-    foreach ($iterator as $file) {\n-        // Sanity checks\n-        if ($file->isFile() && !in_array($file->getFilename(), ['deleted_files.txt', 'critical_migrations.txt', 'upgrade.php'])) {\n-            $src  = $file->getPath().'/'.$file->getFilename();\n-            $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-            if (!@rename($src, $dest)) {\n-                $errorLog[] = sprintf('Could not move file %s to production.', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-            }\n-        }\n-    }\n-\n-    process_error_log($errorLog);\n-\n-    // In this step, we'll also go ahead and remove deleted files, return the results from that\n-    return remove_mautic_deleted_files($status);\n-}\n-\n-/**\n- * Moves the Mautic dependencies from the upgrade directory to production.\n- *\n- * Since the /vendor folder is not stored under version control, we cannot accurately track changes in third party dependencies\n- * between releases.  Therefore, this step will recursively iterate over the vendors in batches to remove each package completely\n- * and replace it with the new version.\n- *\n- * @param int $maxCount\n- *\n- * @return array\n- */\n-function move_mautic_vendors(array $status, $maxCount = 5)\n-{\n-    $errorLog = [];\n-\n-    // If there isn't even a vendor directory, just skip this step\n-    if (!is_dir(MAUTIC_UPGRADE_ROOT.'/vendor')) {\n-        $status['complete']                      = true;\n-        $status['stepStatus']                    = 'Success';\n-        $status['nextStep']                      = 'Clearing Application Cache';\n-        $status['nextStepStatus']                = 'In Progress';\n-        $status['updateState']['vendorComplete'] = true;\n-\n-        return $status;\n-    }\n-\n-    // Initialize the vendor state if it isn't\n-    if (!isset($status['updateState']['completedVendors'])) {\n-        $status['updateState']['completedVendors'] = [];\n-    }\n-\n-    // Symfony is the largest of our vendors, we will process it first\n-    if (is_dir(MAUTIC_UPGRADE_ROOT.'/vendor/symfony') && !isset($status['updateState']['completedVendors']['symfony'])) {\n-        // Initialize the Symfony state if it isn't, this step will recurse\n-        if (!isset($status['updateState']['completedSymfony'])) {\n-            $status['updateState']['completedSymfony'] = [];\n-        }\n-\n-        $completed = true;\n-        $iterator  = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.'/vendor/symfony');\n-\n-        // Sanity check, make sure there are actually directories here to process\n-        $dirs = glob(MAUTIC_UPGRADE_ROOT.'/vendor/symfony/*', GLOB_ONLYDIR);\n-\n-        if (count($dirs)) {\n-            $count = 0;\n-\n-            /** @var DirectoryIterator $directory */\n-            foreach ($iterator as $directory) {\n-                // Exit the loop if the count has reached 5\n-                if (-1 != $maxCount && $count === $maxCount) {\n-                    $completed = false;\n-                    break;\n-                }\n-\n-                // Sanity checks\n-                if (!$directory->isDot() && $directory->isDir()) {\n-                    // Don't process this directory if we've already tried it\n-                    if (isset($status['updateState']['completedSymfony'][$directory->getFilename()])) {\n-                        continue;\n-                    }\n-\n-                    $src  = $directory->getPath().'/'.$directory->getFilename();\n-                    $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                    // We'll need to completely remove the existing vendor first\n-                    recursive_remove_directory($dest);\n-\n-                    $result = copy_directory($src, $dest);\n-\n-                    if (true !== $result) {\n-                        if (is_array($result)) {\n-                            $errorLog += $result;\n-                        } else {\n-                            $errorLog[] = $result;\n-                        }\n-                    }\n-\n-                    $deleteDir = recursive_remove_directory($src);\n-\n-                    if (!$deleteDir) {\n-                        $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                    }\n-\n-                    $status['updateState']['completedSymfony'][$directory->getFilename()] = true;\n-                    ++$count;\n-                }\n-            }\n-        }\n-\n-        if ($completed) {\n-            $status['updateState']['completedVendors']['symfony'] = true;\n-\n-            // At this point, there shouldn't be any Symfony code remaining; nuke the folder\n-            $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.'/vendor/symfony');\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', '/vendor/symfony');\n-            }\n-        }\n-\n-        process_error_log($errorLog);\n-\n-        // If we haven't finished Symfony yet, throw a response back to repeat the step\n-        if (!isset($status['updateState']['completedVendors']['symfony'])) {\n-            return $status;\n-        }\n-    }\n-\n-    // Once we've gotten here, we can safely iterate through the rest of the vendor directory; the rest of the contents are rather small in size\n-    $completed = true;\n-    $iterator  = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.'/vendor');\n-\n-    // Sanity check, make sure there are actually directories here to process\n-    $dirs = glob(MAUTIC_UPGRADE_ROOT.'/vendor/*', GLOB_ONLYDIR);\n-\n-    if (count($dirs)) {\n-        $count = 0;\n-\n-        /** @var DirectoryIterator $directory */\n-        foreach ($iterator as $directory) {\n-            // Exit the loop if the count has reached 5\n-            if (-1 != $maxCount && $count === $maxCount) {\n-                $completed = false;\n-                break;\n-            }\n-\n-            // Sanity checks\n-            if (!$directory->isDot() && $directory->isDir()) {\n-                // Don't process this directory if we've already tried it\n-                if (isset($status['updateState']['completedVendors'][$directory->getFilename()])) {\n-                    continue;\n-                }\n-\n-                $src  = $directory->getPath().'/'.$directory->getFilename();\n-                $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                // We'll need to completely remove the existing vendor first\n-                recursive_remove_directory($dest);\n-\n-                $result = copy_directory($src, $dest);\n-\n-                if (true !== $result) {\n-                    if (is_array($result)) {\n-                        $errorLog += $result;\n-                    } else {\n-                        $errorLog[] = $result;\n-                    }\n-                }\n-\n-                $deleteDir = recursive_remove_directory($src);\n-\n-                if (!$deleteDir) {\n-                    $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                }\n-\n-                $status['updateState']['completedVendors'][$directory->getFilename()] = true;\n-                ++$count;\n-            }\n-        }\n-    }\n-\n-    if ($completed) {\n-        $status['updateState']['vendorComplete'] = true;\n-\n-        // Move the autoload.php file over now\n-        if (!@rename(MAUTIC_UPGRADE_ROOT.'/vendor/autoload.php', MAUTIC_ROOT.'/vendor/autoload.php')) {\n-            $errorLog[] = 'Could not move file /vendor/autoload.php to production.';\n-        }\n-\n-        // At this point, there shouldn't be any vendors remaining; nuke the folder\n-        $deleteDir = recursive_remove_directory(MAUTIC_UPGRADE_ROOT.'/vendor');\n-\n-        if (!$deleteDir) {\n-            $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', '/vendor');\n-        }\n-    }\n-\n-    process_error_log($errorLog);\n-\n-    // If we haven't finished the vendors yet, throw a response back to repeat the step\n-    if (!$status['updateState']['vendorComplete']) {\n-        return $status;\n-    }\n-\n-    // Once we get here, we have finished the moving files step; notifiy Mautic of this\n-    $status['complete']                      = true;\n-    $status['stepStatus']                    = 'Success';\n-    $status['nextStep']                      = 'Clearing Application Cache';\n-    $status['nextStepStatus']                = 'In Progress';\n-    $status['updateState']['vendorComplete'] = true;\n-\n-    return $status;\n-}\n-\n-/**\n- * Copy files from the directory.\n- *\n- * @param string $dir\n- * @param array  &$errorLog\n- *\n- * @return bool\n- */\n-function copy_files($dir, &$errorLog)\n-{\n-    if (is_dir(MAUTIC_UPGRADE_ROOT.$dir)) {\n-        $iterator = new FilesystemIterator(MAUTIC_UPGRADE_ROOT.$dir);\n-\n-        /** @var FilesystemIterator $file */\n-        foreach ($iterator as $file) {\n-            // Sanity checks\n-            if ($file->isFile()) {\n-                $src  = $file->getPath().'/'.$file->getFilename();\n-                $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-                if (!@rename($src, $dest)) {\n-                    $errorLog[] = sprintf('Could not move file %s to production.', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-                }\n-            }\n-        }\n-\n-        return true;\n-    }\n-\n-    return false;\n-}\n-\n-/**\n- * Copy directories.\n- *\n- * @param string $dir\n- * @param array  &$errorLog\n- * @param bool   $createDest\n- *\n- * @return bool|void\n- */\n-function copy_directories($dir, &$errorLog, $createDest = true)\n-{\n-    // Ensure the destination directory exists\n-    $exists = file_exists(MAUTIC_ROOT.$dir);\n-    if ($createDest && !$exists) {\n-        mkdir(MAUTIC_ROOT.$dir, 0755, true);\n-    } elseif (!$exists) {\n-        $errorLog[] = sprintf('%s does not exist.', MAUTIC_ROOT.$dir);\n-\n-        return false;\n-    }\n-\n-    // Copy root level files first\n-    copy_files($dir, $errorLog);\n-\n-    $iterator = new DirectoryIterator(MAUTIC_UPGRADE_ROOT.$dir);\n-\n-    /** @var DirectoryIterator $directory */\n-    foreach ($iterator as $directory) {\n-        // Sanity checks\n-        if (!$directory->isDot() && $directory->isDir()) {\n-            $src  = $directory->getPath().'/'.$directory->getFilename();\n-            $dest = str_replace(MAUTIC_UPGRADE_ROOT, MAUTIC_ROOT, $src);\n-\n-            $result = copy_directory($src, $dest);\n-\n-            if (true !== $result) {\n-                if (is_array($result)) {\n-                    $errorLog += $result;\n-                } else {\n-                    $errorLog[] = $result;\n-                }\n-            }\n-\n-            $deleteDir = recursive_remove_directory($src);\n-\n-            if (!$deleteDir) {\n-                $errorLog[] = sprintf('Failed to remove the upgrade directory %s folder', str_replace(MAUTIC_UPGRADE_ROOT, '', $src));\n-            }\n-        }\n-    }\n-}\n-\n-/**\n- * Processes the error log for each step.\n- */\n-function process_error_log(array $errorLog)\n-{\n-    // If there were any errors, add them to the error log\n-    if (count($errorLog)) {\n-        // Check if the error log exists first\n-        if (file_exists(MAUTIC_UPGRADE_ERROR_LOG)) {\n-            $errors = file_get_contents(MAUTIC_UPGRADE_ERROR_LOG);\n-        } else {\n-            $errors = \"<?php die('no access'); \\n\\n\";\n-        }\n-\n-        $errors .= implode(PHP_EOL, $errorLog).\"\\n\";\n-\n-        @file_put_contents(MAUTIC_UPGRADE_ERROR_LOG, $errors);\n-    }\n-}\n-\n-/**\n- * Tries to recursively delete a directory.\n- *\n- * This code is based on the recursive_remove_directory function used by Akeeba Restore\n- *\n- * @param string $directory\n- *\n- * @return bool\n- */\n-function recursive_remove_directory($directory)\n-{\n-    // if the path has a slash at the end we remove it here\n-    if ('/' == substr($directory, -1)) {\n-        $directory = substr($directory, 0, -1);\n-    }\n-\n-    // if the path is not valid or is not a directory ...\n-    if (!file_exists($directory)) {\n-        return true;\n-    } elseif (!is_dir($directory)) {\n-        return false;\n-    // ... if the path is not readable\n-    } elseif (!is_readable($directory)) {\n-        // ... we return false and exit the function\n-        return false;\n-    // ... else if the path is readable\n-    } else {\n-        // we open the directory\n-        $handle = opendir($directory);\n-\n-        // and scan through the items inside\n-        while (false !== ($item = readdir($handle))) {\n-            // if the filepointer is not the current directory\n-            // or the parent directory\n-            if ('.' != $item && '..' != $item) {\n-                // we build the new path to delete\n-                $path = $directory.'/'.$item;\n-                // if the new path is a directory\n-                if (is_dir($path)) {\n-                    // we call this function with the new path\n-                    recursive_remove_directory($path);\n-                // if the new path is a file\n-                } else {\n-                    // we remove the file\n-                    @unlink($path);\n-                }\n-            }\n-        }\n-\n-        // close the directory\n-        closedir($handle);\n-\n-        // try to delete the now empty directory\n-        if (!@rmdir($directory)) {\n-            // return false if not possible\n-            return false;\n-        }\n-\n-        // return success\n-        return true;\n-    }\n-}\n-\n-/**\n- * Removes deleted files from the system.\n- *\n- * While packaging updates, the script will generate a list of deleted files in comparison to the previous version.  In this step,\n- * we will process that list to remove files which are no longer included in the application.\n- *\n- * @return array\n- */\n-function remove_mautic_deleted_files(array $status)\n-{\n-    $errorLog = [];\n-\n-    // Make sure we have a deleted_files list otherwise we can't process this step\n-    if (file_exists(MAUTIC_UPGRADE_ROOT.'/deleted_files.txt')) {\n-        $deletedFiles = json_decode(file_get_contents(MAUTIC_UPGRADE_ROOT.'/deleted_files.txt'), true);\n-\n-        foreach ($deletedFiles as $file) {\n-            $path = MAUTIC_ROOT.'/'.$file;\n-\n-            // If it doesn't exist, don't even bother\n-            if (file_exists($path)) {\n-                // Try setting the permissions to 777 just to make sure we can get rid of the file\n-                @chmod($path, 0777);\n-\n-                if (!@unlink($path)) {\n-                    // Failed to delete, reset the permissions to 644 for safety\n-                    @chmod($path, 0644);\n-\n-                    $errorLog[] = sprintf(\n-                        'Failed removing the file at %s from the production path.  As this is a deleted file, you can manually remove this file.',\n-                        $file\n-                    );\n-                } else {\n-                    // Check to see if directory is now empty and if so, delete it\n-                    $dirpath = dirname($path);\n-                    if (file_exists($dirpath) && !glob($dirpath.'/*')) {\n-                        @chmod($dirpath, 0777);\n-                        if (!@unlink($dirpath)) {\n-                            // Failed to delete, reset the permissions to 0755 for safety\n-                            @chmod($dirpath, 0755);\n-                        }\n-                    }\n-                }\n-            }\n-        }\n-    } else {\n-        $errorLog[] = 'The file containing the list of deleted files was not found, could not process the deleted file list.';\n-    }\n-\n-    process_error_log($errorLog);\n-\n-    $status['complete']                    = true;\n-    $status['updateState']['coreComplete'] = true;\n-\n-    return $status;\n-}\n-\n-/**\n- * @return string\n- */\n-function get_state_param(array $state)\n-{\n-    return base64_encode(json_encode($state));\n-}\n-\n-/**\n- * Send the response back to the main application.\n- */\n-function send_response(array $status)\n-{\n-    header('Content-Type: application/json; charset=utf-8');\n-\n-    echo json_encode($status);\n-}\n-\n-/**\n- * Crap means of not having issues with.\n- */\n-function make_request($url, $method = 'GET', $data = null)\n-{\n-    $method  = strtoupper($method);\n-    $ch      = curl_init();\n-    $timeout = 15;\n-    if ($data && 'POST' == $method) {\n-        curl_setopt($ch, CURLOPT_POSTFIELDS, $data);\n-    }\n-    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, $method);\n-    curl_setopt($ch, CURLOPT_URL, $url);\n-    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);\n-    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);\n-    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, $timeout);\n-    curl_setopt($ch, CURLOPT_CAINFO, MAUTIC_ROOT.'/vendor/joomla/http/src/Transport/cacert.pem');\n-    $data = curl_exec($ch);\n-    curl_close($ch);\n-\n-    return $data;\n-}\n-\n-/**\n- * Wrap content in some HTML.\n- *\n- * @param $content\n- */\n-function html_body($content)\n-{\n-    $html = <<<HTML\n-<!DOCTYPE html>\n-<html lang=\"en\">\n-  <head>\n-    <meta charset=\"utf-8\">\n-    <title>Upgrade Mautic</title>\n-    <!-- Latest compiled and minified CSS -->\n-    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\n-  </head>\n-  <body>\n-    <div class=\"container\" style=\"padding: 25px;\">\n-        $content\n-    </div>\n-  </body>\n-</html>\n-HTML;\n-\n-    echo $html;\n-\n-    exit;\n-}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/550e33562d03363f7592fa9354259787a23a1d98",
        "url": "https://api.github.com/repos/mautic/mautic/commits/550e33562d03363f7592fa9354259787a23a1d98",
        "html_url": "https://github.com/mautic/mautic/commit/550e33562d03363f7592fa9354259787a23a1d98",
        "message": "Merge remote-tracking branch 'security/DPMMA-2855_mtc-contact-xss-v5' into 5.1",
        "files": [
            {
                "sha": "3be748b8818e9af1c715f86fb1d41dbf5cb89ab7",
                "filename": "app/bundles/CoreBundle/Assets/js/1a.content.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/mautic/mautic/blob/550e33562d03363f7592fa9354259787a23a1d98/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F1a.content.js",
                "raw_url": "https://github.com/mautic/mautic/raw/550e33562d03363f7592fa9354259787a23a1d98/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F1a.content.js",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F1a.content.js?ref=550e33562d03363f7592fa9354259787a23a1d98",
                "patch": "@@ -204,8 +204,8 @@ Mautic.generatePageTitle = function(route){\n             currentModuleItem = mQuery('.page-header h3').text();\n         }\n \n-        // Encoded entites are decoded by this process and can cause a XSS\n-        currentModuleItem = mQuery('<div>'+currentModuleItem+'</div>').text();\n+        // Safely set the text content to prevent XSS\n+        currentModuleItem = mQuery('<div>').text(currentModuleItem).html();\n \n         mQuery('title').html( currentModule[0].toUpperCase() + currentModule.slice(1) + ' | ' + currentModuleItem + ' | Mautic' );\n     } else {"
            },
            {
                "sha": "4cae643dd5ac503033b7f37f3e03587454d38082",
                "filename": "app/bundles/CoreBundle/Assets/js/9.modals.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mautic/mautic/blob/550e33562d03363f7592fa9354259787a23a1d98/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F9.modals.js",
                "raw_url": "https://github.com/mautic/mautic/raw/550e33562d03363f7592fa9354259787a23a1d98/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F9.modals.js",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F9.modals.js?ref=550e33562d03363f7592fa9354259787a23a1d98",
                "patch": "@@ -90,7 +90,8 @@ Mautic.loadAjaxModal = function (target, route, method, header, footer, preventD\n     //move the modal to the body tag to get around positioned div issues\n     element.one('show.bs.modal', function () {\n         if (header) {\n-            element.find(\".modal-title\").html(header);\n+            // use text instead of html method to prevent XSS\n+            element.find(\".modal-title\").text(header);\n         }\n \n         if (footer && footer != 'false') {"
            },
            {
                "sha": "b0b2c23a9d0ee9c2937d3f47f7dad24498194aea",
                "filename": "app/bundles/LeadBundle/Resources/views/Auditlog/details.html.twig",
                "status": "modified",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/mautic/mautic/blob/550e33562d03363f7592fa9354259787a23a1d98/app%2Fbundles%2FLeadBundle%2FResources%2Fviews%2FAuditlog%2Fdetails.html.twig",
                "raw_url": "https://github.com/mautic/mautic/raw/550e33562d03363f7592fa9354259787a23a1d98/app%2Fbundles%2FLeadBundle%2FResources%2Fviews%2FAuditlog%2Fdetails.html.twig",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FResources%2Fviews%2FAuditlog%2Fdetails.html.twig?ref=550e33562d03363f7592fa9354259787a23a1d98",
                "patch": "@@ -24,7 +24,3 @@\n         {{ 'mautic.lead.audit.merged'|trans }}\n     {% endif %}\n {% endif %}\n-<!--\n-Event Type: \"{{ event.eventType }}\"\n-{{ event.details|json_encode(constant('JSON_PRETTY_PRINT'))|raw }}\n--->\n\\ No newline at end of file"
            },
            {
                "sha": "b20727bf32789a44d7def34b20f002da26be7a13",
                "filename": "app/bundles/PageBundle/Tests/Controller/PublicControllerFunctionalTest.php",
                "status": "added",
                "additions": 44,
                "deletions": 0,
                "changes": 44,
                "blob_url": "https://github.com/mautic/mautic/blob/550e33562d03363f7592fa9354259787a23a1d98/app%2Fbundles%2FPageBundle%2FTests%2FController%2FPublicControllerFunctionalTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/550e33562d03363f7592fa9354259787a23a1d98/app%2Fbundles%2FPageBundle%2FTests%2FController%2FPublicControllerFunctionalTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FPageBundle%2FTests%2FController%2FPublicControllerFunctionalTest.php?ref=550e33562d03363f7592fa9354259787a23a1d98",
                "patch": "@@ -0,0 +1,44 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+namespace Mautic\\PageBundle\\Tests\\Controller;\n+\n+use Mautic\\CoreBundle\\Test\\MauticMysqlTestCase;\n+use PHPUnit\\Framework\\Assert;\n+\n+class PublicControllerFunctionalTest extends MauticMysqlTestCase\n+{\n+    public function testMtcEventCompanyXss(): void\n+    {\n+        $this->client->request('POST', '/mtc/event', [\n+            'page_url' => 'https://example.com?Company=%3Cimg+src+onerror%3Dalert%28%27Company%27%29%3E',\n+        ]);\n+        $clientResponse = $this->client->getResponse();\n+        Assert::assertTrue($clientResponse->isOk());\n+\n+        $response = json_decode($clientResponse->getContent(), true);\n+\n+        $this->client->request('GET', sprintf('/s/contacts/view/%d', $response['id']));\n+        $clientResponse = $this->client->getResponse();\n+        Assert::assertTrue($clientResponse->isOk());\n+        $content = $clientResponse->getContent();\n+\n+        Assert::assertStringNotContainsString('<img src onerror=alert(\\'Company\\')>', $content);\n+\n+        $crawler        = $this->client->request('GET', sprintf('/s/contacts/edit/%d', $response['id']));\n+        $clientResponse = $this->client->getResponse();\n+        Assert::assertTrue($clientResponse->isOk());\n+        $content = $clientResponse->getContent();\n+\n+        Assert::assertStringNotContainsString('<img src onerror=alert(\\'Company\\')>', $content);\n+\n+        $buttonCrawlerNode = $crawler->selectButton('Save & Close');\n+        $form              = $buttonCrawlerNode->form();\n+        $this->client->submit($form);\n+        $clientResponse = $this->client->getResponse();\n+        Assert::assertTrue($clientResponse->isOk());\n+        $content = $clientResponse->getContent();\n+        Assert::assertStringNotContainsString('<img src onerror=alert(\\'Company\\')>', $content);\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
        "url": "https://api.github.com/repos/mautic/mautic/commits/629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
        "html_url": "https://github.com/mautic/mautic/commit/629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
        "message": "Merge branch 'DPMMA-2855_mtc-contact-xss-v4' into 4.4",
        "files": [
            {
                "sha": "f601dfec16be22d9deba74a5df3dd4ef9fd006a6",
                "filename": "app/bundles/CoreBundle/Assets/js/1a.content.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/mautic/mautic/blob/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F1a.content.js",
                "raw_url": "https://github.com/mautic/mautic/raw/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F1a.content.js",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F1a.content.js?ref=629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
                "patch": "@@ -203,8 +203,8 @@ Mautic.generatePageTitle = function(route){\n             currentModuleItem = mQuery('.page-header h3').text();\n         }\n \n-        // Encoded entites are decoded by this process and can cause a XSS\n-        currentModuleItem = mQuery('<div>'+currentModuleItem+'</div>').text();\n+        // Safely set the text content to prevent XSS\n+        currentModuleItem = mQuery('<div>').text(currentModuleItem).html();\n \n         mQuery('title').html( currentModule[0].toUpperCase() + currentModule.slice(1) + ' | ' + currentModuleItem + ' | Mautic' );\n     } else {"
            },
            {
                "sha": "daeab1f1919257788e6cd09185a8d63ca1b12ff4",
                "filename": "app/bundles/CoreBundle/Assets/js/9.modals.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mautic/mautic/blob/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F9.modals.js",
                "raw_url": "https://github.com/mautic/mautic/raw/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F9.modals.js",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FCoreBundle%2FAssets%2Fjs%2F9.modals.js?ref=629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
                "patch": "@@ -66,7 +66,8 @@ Mautic.loadAjaxModal = function (target, route, method, header, footer, preventD\n     //move the modal to the body tag to get around positioned div issues\n     mQuery(target).one('show.bs.modal', function () {\n         if (header) {\n-            mQuery(target + \" .modal-title\").html(header);\n+            // use text instead of html method to prevent XSS\n+            mQuery(target + \" .modal-title\").text(header);\n         }\n \n         if (footer && footer != 'false') {"
            },
            {
                "sha": "83fadcd6cc2dc4e5f103abd6af2b6354595fc675",
                "filename": "app/bundles/DashboardBundle/Views/Dashboard/recentactivity.html.php",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/mautic/mautic/blob/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FDashboardBundle%2FViews%2FDashboard%2Frecentactivity.html.php",
                "raw_url": "https://github.com/mautic/mautic/raw/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FDashboardBundle%2FViews%2FDashboard%2Frecentactivity.html.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FDashboardBundle%2FViews%2FDashboard%2Frecentactivity.html.php?ref=629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
                "patch": "@@ -27,23 +27,23 @@\n             <div class=\"media-body\">\n                 <?php if (isset($log['userId']) && $log['userId']) : ?>\n                     <a href=\"<?php echo $view['router']->path('mautic_user_action', ['objectAction' => 'edit', 'objectId' => $log['userId']]); ?>\" data-toggle=\"ajax\">\n-                        <?php echo $log['userName']; ?>\n+                        <?php echo $view->escape($log['userName']); ?>\n                     </a>\n                 <?php elseif ($log['userName']) : ?>\n-                    <?php echo $log['userName']; ?>\n+                    <?php echo $view->escape($log['userName']); ?>\n                 <?php else: ?>\n                     <?php echo $view['translator']->trans('mautic.core.system'); ?>\n                 <?php endif; ?>\n                 <?php echo $view['translator']->trans('mautic.dashboard.'.$log['action'].'.past.tense'); ?>\n \n                 <?php if (!empty($log['route'])): ?>\n                 <a href=\"<?php echo $log['route']; ?>\" data-toggle=\"ajax\">\n-                    <?php echo $log['objectName']; ?>\n+                    <?php echo $view->escape($log['objectName']); ?>\n                 </a>\n                 <?php elseif (!empty($log['objectName'])): ?>\n-                    <?php echo $log['objectName']; ?>\n+                    <?php echo $view->escape($log['objectName']); ?>\n                 <?php endif; ?>\n-                <?php echo $log['object']; ?>\n+                <?php echo $view->escape($log['object']); ?>\n                 <p class=\"fs-12 dark-sm\"><small> <?php echo $view['date']->toFull($log['dateAdded']); ?></small></p>\n             </div>\n         </li>"
            },
            {
                "sha": "55f186e2105d60bbfe8d16bacebeef2e0a91a4fb",
                "filename": "app/bundles/LeadBundle/Controller/LeadController.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/mautic/mautic/blob/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FLeadBundle%2FController%2FLeadController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FLeadBundle%2FController%2FLeadController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FController%2FLeadController.php?ref=629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
                "patch": "@@ -512,7 +512,7 @@ public function newAction()\n                     $this->addFlash(\n                         'mautic.core.notice.created',\n                         [\n-                            '%name%'      => $identifier,\n+                            '%name%'      => htmlspecialchars($identifier, ENT_QUOTES | ENT_SUBSTITUTE, 'UTF-8', false),\n                             '%menu_link%' => 'mautic_contact_index',\n                             '%url%'       => $this->generateUrl(\n                                 'mautic_contact_action',\n@@ -706,7 +706,7 @@ public function editAction($objectId, $ignorePost = false)\n                     $this->addFlash(\n                         'mautic.core.notice.updated',\n                         [\n-                            '%name%'      => $identifier,\n+                            '%name%'      => htmlspecialchars($identifier, ENT_QUOTES | ENT_SUBSTITUTE, 'UTF-8', false),\n                             '%menu_link%' => 'mautic_contact_index',\n                             '%url%'       => $this->generateUrl(\n                                 'mautic_contact_action',\n@@ -1114,7 +1114,7 @@ public function deleteAction($objectId)\n                     'type'    => 'notice',\n                     'msg'     => 'mautic.core.notice.deleted',\n                     'msgVars' => [\n-                        '%name%' => $identifier,\n+                        '%name%' => htmlspecialchars($identifier, ENT_QUOTES | ENT_SUBSTITUTE, 'UTF-8', false),\n                         '%id%'   => $objectId,\n                     ],\n                 ];"
            },
            {
                "sha": "05a8e6b3539340132611e83ba19d836093b3fe25",
                "filename": "app/bundles/LeadBundle/Views/Auditlog/details.html.php",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/mautic/mautic/blob/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FLeadBundle%2FViews%2FAuditlog%2Fdetails.html.php",
                "raw_url": "https://github.com/mautic/mautic/raw/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FLeadBundle%2FViews%2FAuditlog%2Fdetails.html.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FViews%2FAuditlog%2Fdetails.html.php?ref=629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
                "patch": "@@ -99,4 +99,3 @@\n         break;\n }\n echo $text;\n-echo '<!-- '.PHP_EOL.json_encode($details, JSON_PRETTY_PRINT).PHP_EOL.' -->';"
            },
            {
                "sha": "53948cfde251bdcfe6f8219a0602162000d6fd12",
                "filename": "app/bundles/LeadBundle/Views/Lead/form.html.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mautic/mautic/blob/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FLeadBundle%2FViews%2FLead%2Fform.html.php",
                "raw_url": "https://github.com/mautic/mautic/raw/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FLeadBundle%2FViews%2FLead%2Fform.html.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FViews%2FLead%2Fform.html.php?ref=629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
                "patch": "@@ -11,7 +11,7 @@\n $view->extend('MauticCoreBundle:Default:content.html.php');\n $header = ($lead->getId()) ?\n     $view['translator']->trans('mautic.lead.lead.header.edit',\n-        ['%name%' => $view['translator']->trans($lead->getPrimaryIdentifier())]) :\n+        ['%name%' => $view['translator']->trans($this->escape($lead->getPrimaryIdentifier()))]) :\n     $view['translator']->trans('mautic.lead.lead.header.new');\n $view['slots']->set('headerTitle', $header);\n $view['slots']->set('mauticContent', 'lead');"
            },
            {
                "sha": "b20727bf32789a44d7def34b20f002da26be7a13",
                "filename": "app/bundles/PageBundle/Tests/Controller/PublicControllerFunctionalTest.php",
                "status": "added",
                "additions": 44,
                "deletions": 0,
                "changes": 44,
                "blob_url": "https://github.com/mautic/mautic/blob/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FPageBundle%2FTests%2FController%2FPublicControllerFunctionalTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/629165ac905c53bbb44feb5a6dbadb1dfd6d5564/app%2Fbundles%2FPageBundle%2FTests%2FController%2FPublicControllerFunctionalTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FPageBundle%2FTests%2FController%2FPublicControllerFunctionalTest.php?ref=629165ac905c53bbb44feb5a6dbadb1dfd6d5564",
                "patch": "@@ -0,0 +1,44 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+namespace Mautic\\PageBundle\\Tests\\Controller;\n+\n+use Mautic\\CoreBundle\\Test\\MauticMysqlTestCase;\n+use PHPUnit\\Framework\\Assert;\n+\n+class PublicControllerFunctionalTest extends MauticMysqlTestCase\n+{\n+    public function testMtcEventCompanyXss(): void\n+    {\n+        $this->client->request('POST', '/mtc/event', [\n+            'page_url' => 'https://example.com?Company=%3Cimg+src+onerror%3Dalert%28%27Company%27%29%3E',\n+        ]);\n+        $clientResponse = $this->client->getResponse();\n+        Assert::assertTrue($clientResponse->isOk());\n+\n+        $response = json_decode($clientResponse->getContent(), true);\n+\n+        $this->client->request('GET', sprintf('/s/contacts/view/%d', $response['id']));\n+        $clientResponse = $this->client->getResponse();\n+        Assert::assertTrue($clientResponse->isOk());\n+        $content = $clientResponse->getContent();\n+\n+        Assert::assertStringNotContainsString('<img src onerror=alert(\\'Company\\')>', $content);\n+\n+        $crawler        = $this->client->request('GET', sprintf('/s/contacts/edit/%d', $response['id']));\n+        $clientResponse = $this->client->getResponse();\n+        Assert::assertTrue($clientResponse->isOk());\n+        $content = $clientResponse->getContent();\n+\n+        Assert::assertStringNotContainsString('<img src onerror=alert(\\'Company\\')>', $content);\n+\n+        $buttonCrawlerNode = $crawler->selectButton('Save & Close');\n+        $form              = $buttonCrawlerNode->form();\n+        $this->client->submit($form);\n+        $clientResponse = $this->client->getResponse();\n+        Assert::assertTrue($clientResponse->isOk());\n+        $content = $clientResponse->getContent();\n+        Assert::assertStringNotContainsString('<img src onerror=alert(\\'Company\\')>', $content);\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/0f21a3aa9c896788e1986fae0d7f166fc7a14c30",
        "url": "https://api.github.com/repos/mautic/mautic/commits/0f21a3aa9c896788e1986fae0d7f166fc7a14c30",
        "html_url": "https://github.com/mautic/mautic/commit/0f21a3aa9c896788e1986fae0d7f166fc7a14c30",
        "message": "Merge remote-tracking branch 'security/Mst-76-m4' into 4.4",
        "files": [
            {
                "sha": "f96e827c0dd016df317de4f827a8f289f3c9ad30",
                "filename": "app/bundles/CoreBundle/Templating/Helper/FormatterHelper.php",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/mautic/mautic/blob/0f21a3aa9c896788e1986fae0d7f166fc7a14c30/app%2Fbundles%2FCoreBundle%2FTemplating%2FHelper%2FFormatterHelper.php",
                "raw_url": "https://github.com/mautic/mautic/raw/0f21a3aa9c896788e1986fae0d7f166fc7a14c30/app%2Fbundles%2FCoreBundle%2FTemplating%2FHelper%2FFormatterHelper.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FCoreBundle%2FTemplating%2FHelper%2FFormatterHelper.php?ref=0f21a3aa9c896788e1986fae0d7f166fc7a14c30",
                "patch": "@@ -55,7 +55,7 @@ public function _($val, $type = 'html', $textOnly = false, $round = 1)\n                     if (is_array($v)) {\n                         $stringParts = $this->_($v, 'array', $textOnly, $round + 1);\n                     } else {\n-                        $stringParts[] = $v;\n+                        $stringParts[] = InputHelper::clean($v);\n                     }\n                 }\n                 if (1 === $round) {\n@@ -74,10 +74,12 @@ public function _($val, $type = 'html', $textOnly = false, $round = 1)\n                 $string = $this->dateHelper->toDate($val, 'utc');\n                 break;\n             case 'url':\n-                $string = ($textOnly) ? $val : '<a href=\"'.$val.'\" target=\"_new\">'.$val.'</a>';\n+                $url    = InputHelper::url($val);\n+                $string = ($textOnly) ? $url : '<a href=\"'.$url.'\" target=\"_blank\">'.$url.'</a>';\n                 break;\n             case 'email':\n-                $string = ($textOnly) ? $val : '<a href=\"mailto:'.$val.'\">'.$val.'</a>';\n+                $url    = InputHelper::url($val);\n+                $string = ($textOnly) ? $url : '<a href=\"mailto:'.$url.'\">'.$url.'</a>';\n                 break;\n             case 'int':\n                 $string = (int) $val;"
            },
            {
                "sha": "bde6c61d7f0b37e64c902b03b3f403a5c8252d03",
                "filename": "app/bundles/CoreBundle/Tests/Unit/Templating/Helper/FormatterHelperTest.php",
                "status": "modified",
                "additions": 100,
                "deletions": 0,
                "changes": 100,
                "blob_url": "https://github.com/mautic/mautic/blob/0f21a3aa9c896788e1986fae0d7f166fc7a14c30/app%2Fbundles%2FCoreBundle%2FTests%2FUnit%2FTemplating%2FHelper%2FFormatterHelperTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/0f21a3aa9c896788e1986fae0d7f166fc7a14c30/app%2Fbundles%2FCoreBundle%2FTests%2FUnit%2FTemplating%2FHelper%2FFormatterHelperTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FCoreBundle%2FTests%2FUnit%2FTemplating%2FHelper%2FFormatterHelperTest.php?ref=0f21a3aa9c896788e1986fae0d7f166fc7a14c30",
                "patch": "@@ -104,4 +104,104 @@ public function stringProvider(): iterable\n             DateTime::createFromFormat('Y-m-d H:i:s', 'now', new \\DateTimeZone('UTC')),\n         ];\n     }\n+\n+    /**\n+     * @dataProvider urlFormatProvider\n+     */\n+    public function testUrlFormat(string $url, string $expected): void\n+    {\n+        $result = $this->formatterHelper->_($url, 'url');\n+        $this->assertEquals($expected, $result);\n+    }\n+\n+    /**\n+     * @return array<string, array<string>>\n+     */\n+    public function urlFormatProvider(): array\n+    {\n+        return [\n+            'normal url' => [\n+                'http://example.com',\n+                '<a href=\"http://example.com\" target=\"_blank\">http://example.com</a>',\n+            ],\n+            'malicious url' => [\n+                'http://example.com\"><script>alert(\"XSS\")</script>',\n+                '<a href=\"http://example.com&#34;&#62;&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;\" target=\"_blank\">http://example.com&#34;&#62;&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;</a>',\n+            ],\n+            'malicious url2' => [\n+                'http://example.com?a=\"<b>test</b>',\n+                '<a href=\"http://example.com?a=%22%3Cb%3Etest%3C%2Fb%3E\" target=\"_blank\">http://example.com?a=%22%3Cb%3Etest%3C%2Fb%3E</a>',\n+            ],\n+            'url with single GET parameter' => [\n+                'http://example.com/page?param=value',\n+                '<a href=\"http://example.com/page?param=value\" target=\"_blank\">http://example.com/page?param=value</a>',\n+            ],\n+            'url with multiple GET parameters' => [\n+                'http://example.com/search?q=test&page=1&sort=desc',\n+                '<a href=\"http://example.com/search?q=test&page=1&sort=desc\" target=\"_blank\">http://example.com/search?q=test&page=1&sort=desc</a>',\n+            ],\n+            'url with encoded GET parameters' => [\n+                'http://example.com/search?q=hello+world&lang=en',\n+                '<a href=\"http://example.com/search?q=hello+world&lang=en\" target=\"_blank\">http://example.com/search?q=hello+world&lang=en</a>',\n+            ],\n+            'url with special characters in GET parameters' => [\n+                'http://example.com/path?param=value&special=!@#$%^&*()',\n+                '<a href=\"http://example.com/path?param=value&special=%21%40#$%^&*()\" target=\"_blank\">http://example.com/path?param=value&special=%21%40#$%^&*()</a>',\n+            ],\n+            'https url' => [\n+                'https://secure.example.com',\n+                '<a href=\"https://secure.example.com\" target=\"_blank\">https://secure.example.com</a>',\n+            ],\n+            'url with port number' => [\n+                'http://example.com:8080/path',\n+                '<a href=\"http://example.com:8080/path\" target=\"_blank\">http://example.com:8080/path</a>',\n+            ],\n+            'url with username and password' => [\n+                'http://user:pass@example.com',\n+                '<a href=\"http://user:pass@example.com\" target=\"_blank\">http://user:pass@example.com</a>',\n+            ],\n+            'url with fragment identifier' => [\n+                'http://example.com/page#section',\n+                '<a href=\"http://example.com/page#section\" target=\"_blank\">http://example.com/page#section</a>',\n+            ],\n+        ];\n+    }\n+\n+    /**\n+     * @dataProvider emailFormatProvider\n+     */\n+    public function testEmailFormat(string $email, string $expected): void\n+    {\n+        $result = $this->formatterHelper->_($email, 'email');\n+        $this->assertEquals($expected, $result);\n+    }\n+\n+    /**\n+     * @return array<string, array<string>>\n+     */\n+    public function emailFormatProvider(): array\n+    {\n+        return [\n+            'normal email' => [\n+                'user@example.com',\n+                '<a href=\"mailto:user@example.com\">user@example.com</a>',\n+            ],\n+            'email with alias' => [\n+                'user.one+test@example.com',\n+                '<a href=\"mailto:user.one+test@example.com\">user.one+test@example.com</a>',\n+            ],\n+            'malicious email' => [\n+                'user@example.com\"><script>alert(\"XSS\")</script>',\n+                '<a href=\"mailto:user@example.com&#34;&#62;&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;\">user@example.com&#34;&#62;&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;</a>',\n+            ],\n+        ];\n+    }\n+\n+    public function testArrayFormat(): void\n+    {\n+        $input    = ['<script>alert(\"XSS\")</script>'];\n+        $result   = $this->formatterHelper->_($input, 'array');\n+        $expected = '&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;';\n+        $this->assertEquals($expected, $result);\n+    }\n }"
            },
            {
                "sha": "fb3a4971e174556a3cba32096af17ff53a89a2d1",
                "filename": "app/bundles/ReportBundle/Tests/Controller/ReportControllerFunctionalTest.php",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/mautic/mautic/blob/0f21a3aa9c896788e1986fae0d7f166fc7a14c30/app%2Fbundles%2FReportBundle%2FTests%2FController%2FReportControllerFunctionalTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/0f21a3aa9c896788e1986fae0d7f166fc7a14c30/app%2Fbundles%2FReportBundle%2FTests%2FController%2FReportControllerFunctionalTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FReportBundle%2FTests%2FController%2FReportControllerFunctionalTest.php?ref=0f21a3aa9c896788e1986fae0d7f166fc7a14c30",
                "patch": "@@ -54,4 +54,31 @@ public function testContactReportSqlInjectionDontWork(): void\n         $this->client->request('GET', '/s/reports/view/'.$report->getId().'?tmpl=list&name=report.'.$report->getId().'&orderby=a_id');\n         $this->assertTrue($this->client->getResponse()->isOk());\n     }\n+\n+    public function testXssUrlFromQuery(): void\n+    {\n+        $report = new Report();\n+        $report->setName('Hits report');\n+        $report->setDescription('<b>Text Xss Hits</b>');\n+        $report->setSource('page.hits');\n+        $coulmns = [\n+            'ph.isp',\n+            'ph.url',\n+            'ph.browser_languages',\n+            'ph.referer',\n+            'ph.remote_host',\n+            'ph.user_agent',\n+        ];\n+        $report->setColumns($coulmns);\n+        $this->getContainer()->get('mautic.report.model.report')->saveEntity($report);\n+        $xssHeader     = '<script>alert(1)</script>';\n+        $this->client->request('GET', '/mtracking.gif?page_url='.$xssHeader);\n+        $this->assertResponseStatusCodeSame(200);\n+        $this->client->request('GET', '/s/reports/view/'.$report->getId());\n+        $this->assertResponseStatusCodeSame(200);\n+        $this->assertStringNotContainsString($xssHeader, $this->client->getResponse()->getContent());\n+\n+        $this->client->request('GET', '/s/reports/view/'.$report->getId().'/export/html');\n+        $this->assertStringNotContainsString($xssHeader, $this->client->getResponse()->getContent());\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/43db5e492c0ef82c917745849d5b454dbc8ca2c4",
        "url": "https://api.github.com/repos/mautic/mautic/commits/43db5e492c0ef82c917745849d5b454dbc8ca2c4",
        "html_url": "https://github.com/mautic/mautic/commit/43db5e492c0ef82c917745849d5b454dbc8ca2c4",
        "message": "Merge remote-tracking branch 'security/Mst-76-m5' into 5.1",
        "files": [
            {
                "sha": "03a28ac9d86848dd6a5064b2948f71d30679d026",
                "filename": "app/bundles/CoreBundle/Tests/Unit/Twig/Helper/FormatterHelperTest.php",
                "status": "modified",
                "additions": 100,
                "deletions": 0,
                "changes": 100,
                "blob_url": "https://github.com/mautic/mautic/blob/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FCoreBundle%2FTests%2FUnit%2FTwig%2FHelper%2FFormatterHelperTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FCoreBundle%2FTests%2FUnit%2FTwig%2FHelper%2FFormatterHelperTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FCoreBundle%2FTests%2FUnit%2FTwig%2FHelper%2FFormatterHelperTest.php?ref=43db5e492c0ef82c917745849d5b454dbc8ca2c4",
                "patch": "@@ -119,4 +119,104 @@ public static function stringProvider(): iterable\n             \\DateTime::createFromFormat('Y-m-d H:i:s', 'now', new \\DateTimeZone('UTC')),\n         ];\n     }\n+\n+    /**\n+     * @dataProvider urlFormatProvider\n+     */\n+    public function testUrlFormat(string $url, string $expected): void\n+    {\n+        $result = $this->formatterHelper->_($url, 'url');\n+        $this->assertEquals($expected, $result);\n+    }\n+\n+    /**\n+     * @return array<string, array<string>>\n+     */\n+    public function urlFormatProvider(): array\n+    {\n+        return [\n+            'normal url' => [\n+                'http://example.com',\n+                '<a href=\"http://example.com\" target=\"_blank\">http://example.com</a>',\n+            ],\n+            'malicious url' => [\n+                'http://example.com\"><script>alert(\"XSS\")</script>',\n+                '<a href=\"http://example.com&#34;&#62;&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;\" target=\"_blank\">http://example.com&#34;&#62;&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;</a>',\n+            ],\n+            'malicious url2' => [\n+                'http://example.com?a=\"<b>test</b>',\n+                '<a href=\"http://example.com?a=%22%3Cb%3Etest%3C%2Fb%3E\" target=\"_blank\">http://example.com?a=%22%3Cb%3Etest%3C%2Fb%3E</a>',\n+            ],\n+            'url with single GET parameter' => [\n+                'http://example.com/page?param=value',\n+                '<a href=\"http://example.com/page?param=value\" target=\"_blank\">http://example.com/page?param=value</a>',\n+            ],\n+            'url with multiple GET parameters' => [\n+                'http://example.com/search?q=test&page=1&sort=desc',\n+                '<a href=\"http://example.com/search?q=test&page=1&sort=desc\" target=\"_blank\">http://example.com/search?q=test&page=1&sort=desc</a>',\n+            ],\n+            'url with encoded GET parameters' => [\n+                'http://example.com/search?q=hello+world&lang=en',\n+                '<a href=\"http://example.com/search?q=hello+world&lang=en\" target=\"_blank\">http://example.com/search?q=hello+world&lang=en</a>',\n+            ],\n+            'url with special characters in GET parameters' => [\n+                'http://example.com/path?param=value&special=!@#$%^&*()',\n+                '<a href=\"http://example.com/path?param=value&special=%21%40#$%^&*()\" target=\"_blank\">http://example.com/path?param=value&special=%21%40#$%^&*()</a>',\n+            ],\n+            'https url' => [\n+                'https://secure.example.com',\n+                '<a href=\"https://secure.example.com\" target=\"_blank\">https://secure.example.com</a>',\n+            ],\n+            'url with port number' => [\n+                'http://example.com:8080/path',\n+                '<a href=\"http://example.com:8080/path\" target=\"_blank\">http://example.com:8080/path</a>',\n+            ],\n+            'url with username and password' => [\n+                'http://user:pass@example.com',\n+                '<a href=\"http://user:pass@example.com\" target=\"_blank\">http://user:pass@example.com</a>',\n+            ],\n+            'url with fragment identifier' => [\n+                'http://example.com/page#section',\n+                '<a href=\"http://example.com/page#section\" target=\"_blank\">http://example.com/page#section</a>',\n+            ],\n+        ];\n+    }\n+\n+    /**\n+     * @dataProvider emailFormatProvider\n+     */\n+    public function testEmailFormat(string $email, string $expected): void\n+    {\n+        $result = $this->formatterHelper->_($email, 'email');\n+        $this->assertEquals($expected, $result);\n+    }\n+\n+    /**\n+     * @return array<string, array<string>>\n+     */\n+    public function emailFormatProvider(): array\n+    {\n+        return [\n+            'normal email' => [\n+                'user@example.com',\n+                '<a href=\"mailto:user@example.com\">user@example.com</a>',\n+            ],\n+            'email with alias' => [\n+                'user.one+test@example.com',\n+                '<a href=\"mailto:user.one+test@example.com\">user.one+test@example.com</a>',\n+            ],\n+            'malicious email' => [\n+                'user@example.com\"><script>alert(\"XSS\")</script>',\n+                '<a href=\"mailto:user@example.com&#34;&#62;&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;\">user@example.com&#34;&#62;&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;</a>',\n+            ],\n+        ];\n+    }\n+\n+    public function testArrayFormat(): void\n+    {\n+        $input    = ['<script>alert(\"XSS\")</script>'];\n+        $result   = $this->formatterHelper->_($input, 'array');\n+        $expected = '&#60;script&#62;alert(&#34;XSS&#34;)&#60;/script&#62;';\n+        $this->assertEquals($expected, $result);\n+    }\n }"
            },
            {
                "sha": "6209258770817994305f428dd1835f6c6bf7f8d0",
                "filename": "app/bundles/CoreBundle/Twig/Helper/FormatterHelper.php",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/mautic/mautic/blob/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FCoreBundle%2FTwig%2FHelper%2FFormatterHelper.php",
                "raw_url": "https://github.com/mautic/mautic/raw/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FCoreBundle%2FTwig%2FHelper%2FFormatterHelper.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FCoreBundle%2FTwig%2FHelper%2FFormatterHelper.php?ref=43db5e492c0ef82c917745849d5b454dbc8ca2c4",
                "patch": "@@ -47,7 +47,7 @@ public function _($val, $type = 'html', $textOnly = false, $round = 1)\n                     if (is_array($v)) {\n                         $stringParts = $this->_($v, 'array', $textOnly, $round + 1);\n                     } else {\n-                        $stringParts[] = $v;\n+                        $stringParts[] = InputHelper::clean($v);\n                     }\n                 }\n                 if (1 === $round) {\n@@ -66,10 +66,12 @@ public function _($val, $type = 'html', $textOnly = false, $round = 1)\n                 $string = $this->dateHelper->toDate($val, 'utc');\n                 break;\n             case 'url':\n-                $string = ($textOnly) ? $val : '<a href=\"'.$val.'\" target=\"_new\">'.$val.'</a>';\n+                $url        = InputHelper::url($val);\n+                $string     = ($textOnly) ? $url : '<a href=\"'.$url.'\" target=\"_blank\">'.$url.'</a>';\n                 break;\n             case 'email':\n-                $string = ($textOnly) ? $val : '<a href=\"mailto:'.$val.'\">'.$val.'</a>';\n+                $url    = InputHelper::url($val);\n+                $string = ($textOnly) ? $url : '<a href=\"mailto:'.$url.'\">'.$url.'</a>';\n                 break;\n             case 'int':\n                 $string = strval((int) $val);"
            },
            {
                "sha": "2318016c8de618153cce2b443b645cad35e796e7",
                "filename": "app/bundles/ReportBundle/Resources/views/Report/_details_report_content.html.twig",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/mautic/mautic/blob/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FReportBundle%2FResources%2Fviews%2FReport%2F_details_report_content.html.twig",
                "raw_url": "https://github.com/mautic/mautic/raw/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FReportBundle%2FResources%2Fviews%2FReport%2F_details_report_content.html.twig",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FReportBundle%2FResources%2Fviews%2FReport%2F_details_report_content.html.twig?ref=43db5e492c0ef82c917745849d5b454dbc8ca2c4",
                "patch": "@@ -82,11 +82,11 @@\n                                                 {% elseif 'date' is same as cellType %}\n                                                     {{ dateToShort(cellVal, 'UTC') }}\n                                                 {% else %}\n-                                                    {% set value = format(cellVal, cellType) %}\n+                                                    {% set value = format(cellVal, cellType)|purify %}\n                                                     {% if collapse == false %}\n-                                                        {{ format(cellVal, cellType) }}\n+                                                        {{ format(cellVal, cellType)|purify }}\n                                                     {% else %}\n-                                                        {% set value = htmlEntityDecode(format(cellVal, cellType)) %}\n+                                                        {% set value = htmlEntityDecode(format(cellVal, cellType)|purify) %}\n                                                         <div data-toggle=\"collapse\" data-target=\"#audit-log-details-{{ startCount }}\" class=\"accordion-toggle\" style=\"cursor: pointer\">\n                                                             {{ value|length > 50 ? value|slice(0, 50) ~ '...' : value }}\n                                                         </div>"
            },
            {
                "sha": "a331a6a4587d87c3ea78051b59ded898877f85ce",
                "filename": "app/bundles/ReportBundle/Resources/views/Report/export.html.twig",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mautic/mautic/blob/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FReportBundle%2FResources%2Fviews%2FReport%2Fexport.html.twig",
                "raw_url": "https://github.com/mautic/mautic/raw/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FReportBundle%2FResources%2Fviews%2FReport%2Fexport.html.twig",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FReportBundle%2FResources%2Fviews%2FReport%2Fexport.html.twig?ref=43db5e492c0ef82c917745849d5b454dbc8ca2c4",
                "patch": "@@ -53,7 +53,7 @@\n                   <tr>\n                       <td>{{ count + 1 }}</td>\n                       {% for k, v in data %}\n-                          <td>{{ format(v, reportDataResult.getType(k)) }}</td>\n+                          <td>{{ format(v, reportDataResult.getType(k))|purify }}</td>\n                       {% endfor %}\n                   </tr>\n               {% endfor %}"
            },
            {
                "sha": "1854e099e85e92eb8a1a2986002c3fa1a3138d28",
                "filename": "app/bundles/ReportBundle/Tests/Controller/ReportControllerFunctionalTest.php",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/mautic/mautic/blob/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FReportBundle%2FTests%2FController%2FReportControllerFunctionalTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/43db5e492c0ef82c917745849d5b454dbc8ca2c4/app%2Fbundles%2FReportBundle%2FTests%2FController%2FReportControllerFunctionalTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FReportBundle%2FTests%2FController%2FReportControllerFunctionalTest.php?ref=43db5e492c0ef82c917745849d5b454dbc8ca2c4",
                "patch": "@@ -424,6 +424,33 @@ public function testDescriptionIsNotEscaped(): void\n         $this->assertStringContainsString('<small><b>This is allowed HTML</b></small>', $clientResponseContent);\n     }\n \n+    public function testXssUrlFromQuery(): void\n+    {\n+        $report = new Report();\n+        $report->setName('Hits report');\n+        $report->setDescription('<b>Text Xss Hits</b>');\n+        $report->setSource('page.hits');\n+        $coulmns = [\n+            'ph.isp',\n+            'ph.url',\n+            'ph.browser_languages',\n+            'ph.referer',\n+            'ph.remote_host',\n+            'ph.user_agent',\n+        ];\n+        $report->setColumns($coulmns);\n+        $this->getContainer()->get('mautic.report.model.report')->saveEntity($report);\n+        $xssHeader     = '<script>alert(1)</script>';\n+        $this->client->request('GET', '/mtracking.gif?page_url='.$xssHeader);\n+        $this->assertResponseStatusCodeSame(200);\n+        $this->client->request('GET', '/s/reports/view/'.$report->getId());\n+        $this->assertResponseStatusCodeSame(200);\n+        $this->assertStringNotContainsString($xssHeader, $this->client->getResponse()->getContent());\n+\n+        $this->client->request('GET', '/s/reports/view/'.$report->getId().'/export/html');\n+        $this->assertStringNotContainsString($xssHeader, $this->client->getResponse()->getContent());\n+    }\n+\n     /**\n      * @param string[] $graphs\n      */"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/88153a15b3cea331b7036d956b880c69e81a0032",
        "url": "https://api.github.com/repos/mautic/mautic/commits/88153a15b3cea331b7036d956b880c69e81a0032",
        "html_url": "https://github.com/mautic/mautic/commit/88153a15b3cea331b7036d956b880c69e81a0032",
        "message": "Merge remote-tracking branch 'security/mst35-4.4' into 4.4",
        "files": [
            {
                "sha": "9b5b3f719bf0d7865445a68e984fe2369cd1d65a",
                "filename": "app/bundles/CoreBundle/Helper/InputHelper.php",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/mautic/mautic/blob/88153a15b3cea331b7036d956b880c69e81a0032/app%2Fbundles%2FCoreBundle%2FHelper%2FInputHelper.php",
                "raw_url": "https://github.com/mautic/mautic/raw/88153a15b3cea331b7036d956b880c69e81a0032/app%2Fbundles%2FCoreBundle%2FHelper%2FInputHelper.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FCoreBundle%2FHelper%2FInputHelper.php?ref=88153a15b3cea331b7036d956b880c69e81a0032",
                "patch": "@@ -539,4 +539,22 @@ public static function transliterate($value)\n \n         return \\URLify::transliterate((string) $value);\n     }\n+\n+    /**\n+     * Clean input evil attributes to prevent XSS\n+     * Remove any attribute starting with \"on\" or xmlns or javascript:.\n+     *\n+     * @return string\n+     */\n+    public static function cleanInputAttributes(?string $value)\n+    {\n+        $value = htmlspecialchars($value, ENT_SUBSTITUTE, 'UTF-8', false);\n+        // Remove any attribute starting with \"on\" or javascript used in href, src, value, data, etc.\n+        preg_match('/(on[A-Za-z]*\\s*=|javascript:)/i', $value, $result);\n+        if (!empty($result)) {\n+            return '';\n+        }\n+\n+        return $value;\n+    }\n }"
            },
            {
                "sha": "9b71a53ffc30913453dd18b42b6e6d7b0a2fc1bd",
                "filename": "app/bundles/FormBundle/Views/Field/field_helper.php",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/mautic/mautic/blob/88153a15b3cea331b7036d956b880c69e81a0032/app%2Fbundles%2FFormBundle%2FViews%2FField%2Ffield_helper.php",
                "raw_url": "https://github.com/mautic/mautic/raw/88153a15b3cea331b7036d956b880c69e81a0032/app%2Fbundles%2FFormBundle%2FViews%2FField%2Ffield_helper.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FFormBundle%2FViews%2FField%2Ffield_helper.php?ref=88153a15b3cea331b7036d956b880c69e81a0032",
                "patch": "@@ -1,5 +1,7 @@\n <?php\n \n+use Mautic\\CoreBundle\\Helper\\InputHelper;\n+\n $appendAttribute = function (&$attributes, $attributeName, $append) {\n     if (false === stripos($attributes, \"{$attributeName}=\")) {\n         $attributes .= ' '.$attributeName.'=\"'.$append.'\"';\n@@ -76,7 +78,7 @@\n }\n \n // Container\n-$containerAttr = 'id=\"mauticform'.$formName.'_'.$id.'\" '.htmlspecialchars_decode($field['containerAttributes']);\n+$containerAttr = 'id=\"mauticform'.$formName.'_'.$id.'\" '.InputHelper::cleanInputAttributes($field['containerAttributes']);\n \n if (!isset($containerClass)) {\n     $containerClass = $containerType;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/344b908ef690283e7d8d3fc5cc1327396a1c3046",
        "url": "https://api.github.com/repos/mautic/mautic/commits/344b908ef690283e7d8d3fc5cc1327396a1c3046",
        "html_url": "https://github.com/mautic/mautic/commit/344b908ef690283e7d8d3fc5cc1327396a1c3046",
        "message": "Merge remote-tracking branch 'security/mst35-50' into 5.1",
        "files": [
            {
                "sha": "8d28c0d4f95b1c56ac207c093e397bae39b14716",
                "filename": "app/bundles/FormBundle/Resources/views/Field/freehtml.html.twig",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mautic/mautic/blob/344b908ef690283e7d8d3fc5cc1327396a1c3046/app%2Fbundles%2FFormBundle%2FResources%2Fviews%2FField%2Ffreehtml.html.twig",
                "raw_url": "https://github.com/mautic/mautic/raw/344b908ef690283e7d8d3fc5cc1327396a1c3046/app%2Fbundles%2FFormBundle%2FResources%2Fviews%2FField%2Ffreehtml.html.twig",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FFormBundle%2FResources%2Fviews%2FField%2Ffreehtml.html.twig?ref=344b908ef690283e7d8d3fc5cc1327396a1c3046",
                "patch": "@@ -12,7 +12,7 @@\n {% set validationMessage = '' %}\n {% set inputAttributes = htmlAttributesStringToArray(field.inputAttributes|default('')) %}\n {% set labelAttributes = htmlAttributesStringToArray(field.labelAttributes|default('')) %}\n-{% set containerAttributes = htmlAttributesStringToArray(field.containerAttributes|default('')) %}\n+{% set containerAttributes = htmlAttributesStringToArray(formFieldCleanInputAttributes(field.containerAttributes|default(''))) %}\n {% if ignoreName is not defined or (ignoreName is defined and ignoreName is empty) %}\n   {% set inputName = 'mauticform[' ~ field.alias ~ ']' %}\n   {% if field.properties.multiple is defined %}"
            },
            {
                "sha": "1a93d04783fa4adfe76056042eac67e956a9ca92",
                "filename": "app/bundles/FormBundle/Twig/Extension/FormFieldExtension.php",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/mautic/mautic/blob/344b908ef690283e7d8d3fc5cc1327396a1c3046/app%2Fbundles%2FFormBundle%2FTwig%2FExtension%2FFormFieldExtension.php",
                "raw_url": "https://github.com/mautic/mautic/raw/344b908ef690283e7d8d3fc5cc1327396a1c3046/app%2Fbundles%2FFormBundle%2FTwig%2FExtension%2FFormFieldExtension.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FFormBundle%2FTwig%2FExtension%2FFormFieldExtension.php?ref=344b908ef690283e7d8d3fc5cc1327396a1c3046",
                "patch": "@@ -16,6 +16,24 @@ public function getFunctions()\n             new TwigFunction('formFieldParseBooleanList', [FormFieldHelper::class, 'parseBooleanList']),\n             new TwigFunction('formFieldParseList', [FormFieldHelper::class, 'parseList']),\n             new TwigFunction('formFieldParseListForChoices', [FormFieldHelper::class, 'parseListForChoices']),\n+            new TwigFunction('formFieldCleanInputAttributes', [$this, 'cleanInputAttributes']),\n         ];\n     }\n+\n+    /**\n+     * Clean input evil attributes to prevent XSS\n+     * Remove any attribute starting with \"on\" or xmlns or javascript:. Used in href, src, value, data, etc.\n+     */\n+    public function cleanInputAttributes(string $value): string\n+    {\n+        // Remove any HTML tags\n+        $value = htmlspecialchars($value, ENT_SUBSTITUTE, 'UTF-8', false);\n+        // Remove any attribute starting with \"on\" or javascript used in href, src, value, data, etc.\n+        preg_match('/(on[A-Za-z]*\\s*=|javascript:)/i', $value, $result);\n+        if (!empty($result)) {\n+            return '';\n+        }\n+\n+        return $value;\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/89f964d06f00688016b38a56dfd9e95fc676c7ce",
        "url": "https://api.github.com/repos/mautic/mautic/commits/89f964d06f00688016b38a56dfd9e95fc676c7ce",
        "html_url": "https://github.com/mautic/mautic/commit/89f964d06f00688016b38a56dfd9e95fc676c7ce",
        "message": "Merge remote-tracking branch 'security/advisory-fix-MST-33-4.x' into 4.4",
        "files": [
            {
                "sha": "6085ab891a13c851706a37fd65c7fcd7579d2f1a",
                "filename": "app/bundles/UserBundle/Controller/SecurityController.php",
                "status": "modified",
                "additions": 0,
                "deletions": 27,
                "changes": 27,
                "blob_url": "https://github.com/mautic/mautic/blob/89f964d06f00688016b38a56dfd9e95fc676c7ce/app%2Fbundles%2FUserBundle%2FController%2FSecurityController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/89f964d06f00688016b38a56dfd9e95fc676c7ce/app%2Fbundles%2FUserBundle%2FController%2FSecurityController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FUserBundle%2FController%2FSecurityController.php?ref=89f964d06f00688016b38a56dfd9e95fc676c7ce",
                "patch": "@@ -39,33 +39,6 @@ public function initialize(FilterControllerEvent $event)\n      */\n     public function loginAction()\n     {\n-        // A way to keep the upgrade from failing if the session is lost after\n-        // the cache is cleared by upgrade.php\n-        if ($this->request->cookies->has('mautic_update')) {\n-            $step = $this->request->cookies->get('mautic_update');\n-            if ('clearCache' == $step) {\n-                // Run migrations\n-                $this->request->query->set('finalize', 1);\n-\n-                return $this->forward('MauticCoreBundle:Ajax:updateDatabaseMigration',\n-                    [\n-                        'request' => $this->request,\n-                    ]\n-                );\n-            } elseif ('schemaMigration' == $step) {\n-                // Done so finalize\n-                return $this->forward('MauticCoreBundle:Ajax:updateFinalization',\n-                    [\n-                        'request' => $this->request,\n-                    ]\n-                );\n-            }\n-\n-            /** @var \\Mautic\\CoreBundle\\Helper\\CookieHelper $cookieHelper */\n-            $cookieHelper = $this->factory->getHelper('cookie');\n-            $cookieHelper->deleteCookie('mautic_update');\n-        }\n-\n         $session = $this->request->getSession();\n \n         // get the login error if there is one"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/925aeee7d3dbb6ca67f92d9dc5893d99250f739b",
        "url": "https://api.github.com/repos/mautic/mautic/commits/925aeee7d3dbb6ca67f92d9dc5893d99250f739b",
        "html_url": "https://github.com/mautic/mautic/commit/925aeee7d3dbb6ca67f92d9dc5893d99250f739b",
        "message": "Merge remote-tracking branch 'security/advisory-fix-MST-33-5.1' into 5.1",
        "files": [
            {
                "sha": "65f55b934ca57adbce2068ead5f6f183cf7d6061",
                "filename": "app/bundles/UserBundle/Controller/SecurityController.php",
                "status": "modified",
                "additions": 0,
                "deletions": 27,
                "changes": 27,
                "blob_url": "https://github.com/mautic/mautic/blob/925aeee7d3dbb6ca67f92d9dc5893d99250f739b/app%2Fbundles%2FUserBundle%2FController%2FSecurityController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/925aeee7d3dbb6ca67f92d9dc5893d99250f739b/app%2Fbundles%2FUserBundle%2FController%2FSecurityController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FUserBundle%2FController%2FSecurityController.php?ref=925aeee7d3dbb6ca67f92d9dc5893d99250f739b",
                "patch": "@@ -46,33 +46,6 @@ public function onRequest(RequestEvent $event): void\n      */\n     public function loginAction(Request $request, AuthenticationUtils $authenticationUtils, IntegrationHelper $integrationHelper, TranslatorInterface $translator): \\Symfony\\Component\\HttpFoundation\\Response\n     {\n-        // A way to keep the upgrade from failing if the session is lost after\n-        // the cache is cleared by upgrade.php\n-        if ($request->cookies->has('mautic_update')) {\n-            $step = $request->cookies->get('mautic_update');\n-            if ('clearCache' === $step) {\n-                // Run migrations\n-                $request->query->set('finalize', 1);\n-\n-                return $this->forward('Mautic\\CoreBundle\\Controller\\AjaxController::updateDatabaseMigrationAction',\n-                    [\n-                        'request' => $request,\n-                    ]\n-                );\n-            } elseif ('schemaMigration' === $step) {\n-                // Done so finalize\n-                return $this->forward('Mautic\\CoreBundle\\Controller\\AjaxController::updateFinalizationAction',\n-                    [\n-                        'request' => $request,\n-                    ]\n-                );\n-            }\n-\n-            /** @var \\Mautic\\CoreBundle\\Helper\\CookieHelper $cookieHelper */\n-            $cookieHelper = $this->factory->getHelper('cookie');\n-            $cookieHelper->deleteCookie('mautic_update');\n-        }\n-\n         $error = $authenticationUtils->getLastAuthenticationError();\n \n         if (null !== $error) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/google/mesop/commits/17fb769d6a91f0a8cbccfab18f64977b158a6a31",
        "url": "https://api.github.com/repos/mesop-dev/mesop/commits/17fb769d6a91f0a8cbccfab18f64977b158a6a31",
        "html_url": "https://github.com/mesop-dev/mesop/commit/17fb769d6a91f0a8cbccfab18f64977b158a6a31",
        "message": "Fix web component static file serving (#942)",
        "files": [
            {
                "sha": "3ea6d656e22d047d11867a6eec2c3929e38cf616",
                "filename": "docs/guides/web-security.md",
                "status": "modified",
                "additions": 6,
                "deletions": 2,
                "changes": 8,
                "blob_url": "https://github.com/mesop-dev/mesop/blob/17fb769d6a91f0a8cbccfab18f64977b158a6a31/docs%2Fguides%2Fweb-security.md",
                "raw_url": "https://github.com/mesop-dev/mesop/raw/17fb769d6a91f0a8cbccfab18f64977b158a6a31/docs%2Fguides%2Fweb-security.md",
                "contents_url": "https://api.github.com/repos/mesop-dev/mesop/contents/docs%2Fguides%2Fweb-security.md?ref=17fb769d6a91f0a8cbccfab18f64977b158a6a31",
                "patch": "@@ -1,8 +1,12 @@\n # Web Security\n \n-Mesop by default configures its apps to follow a set of web security best practices.\n+## Static file serving\n \n-## How\n+Mesop allows serving JS and CSS files located within the Mesop app's file subtree to support [web components](../web-components/index.md).\n+\n+**Security Warning:** Do not place any sensitive or confidential JS and CSS files in your Mesop project directory. These files may be inadvertently exposed and served by the Mesop web server, potentially compromising your application's security.\n+\n+## JavaScript Security\n \n At a high-level, Mesop is built on top of Angular which provides [built-in security protections](https://angular.io/guide/security) and Mesop configures a strict [Content Security Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP).\n "
            },
            {
                "sha": "3e01e4d11a9307def964733699c58f09dc934a43",
                "filename": "mesop/components/input/e2e/input_test.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/mesop-dev/mesop/blob/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Fcomponents%2Finput%2Fe2e%2Finput_test.ts",
                "raw_url": "https://github.com/mesop-dev/mesop/raw/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Fcomponents%2Finput%2Fe2e%2Finput_test.ts",
                "contents_url": "https://api.github.com/repos/mesop-dev/mesop/contents/mesop%2Fcomponents%2Finput%2Fe2e%2Finput_test.ts?ref=17fb769d6a91f0a8cbccfab18f64977b158a6a31",
                "patch": "@@ -44,7 +44,8 @@ test('test input on_blur works', async ({page}) => {\n   ).toBeVisible();\n });\n \n-test('test textarea shortcuts', async ({page}) => {\n+// TODO: unskip this test once the flakiness is fixed\n+test.skip('test textarea shortcuts', async ({page}) => {\n   await page.goto('/components/input/e2e/textarea_shortcut_app');\n   const textbox = page.getByLabel('Textarea');\n   await textbox.fill('hi');\n@@ -89,7 +90,8 @@ test('test textarea shortcuts', async ({page}) => {\n   ).toBeVisible();\n });\n \n-test('test native textarea shortcuts', async ({page}) => {\n+// TODO: unskip this test once the flakiness is fixed\n+test.skip('test native textarea shortcuts', async ({page}) => {\n   await page.goto('/components/input/e2e/textarea_shortcut_app');\n   const textbox = page.getByPlaceholder('Native textarea');\n "
            },
            {
                "sha": "5ae3fa6a36c61a69ca327357850699375c9d12d1",
                "filename": "mesop/examples/web_component/BUILD",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/mesop-dev/mesop/blob/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Fexamples%2Fweb_component%2FBUILD",
                "raw_url": "https://github.com/mesop-dev/mesop/raw/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Fexamples%2Fweb_component%2FBUILD",
                "contents_url": "https://api.github.com/repos/mesop-dev/mesop/contents/mesop%2Fexamples%2Fweb_component%2FBUILD?ref=17fb769d6a91f0a8cbccfab18f64977b158a6a31",
                "patch": "@@ -7,7 +7,10 @@ package(\n py_library(\n     name = \"web_component\",\n     srcs = glob([\"*.py\"]),\n-    data = glob([\"*.js\"]),\n+    data = glob([\n+        \"*.js\",\n+        \"*.css\",\n+    ]),\n     deps = [\n         \"//mesop\",\n         \"//mesop/examples/web_component/async_action\","
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "mesop/examples/web_component/testing.css",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/mesop-dev/mesop/blob/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Fexamples%2Fweb_component%2Ftesting.css",
                "raw_url": "https://github.com/mesop-dev/mesop/raw/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Fexamples%2Fweb_component%2Ftesting.css",
                "contents_url": "https://api.github.com/repos/mesop-dev/mesop/contents/mesop%2Fexamples%2Fweb_component%2Ftesting.css?ref=17fb769d6a91f0a8cbccfab18f64977b158a6a31"
            },
            {
                "sha": "1e6d24f77e3102a3d8be0af2773cf55ead65e9c3",
                "filename": "mesop/server/static_file_serving.py",
                "status": "modified",
                "additions": 12,
                "deletions": 1,
                "changes": 13,
                "blob_url": "https://github.com/mesop-dev/mesop/blob/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Fserver%2Fstatic_file_serving.py",
                "raw_url": "https://github.com/mesop-dev/mesop/raw/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Fserver%2Fstatic_file_serving.py",
                "contents_url": "https://api.github.com/repos/mesop-dev/mesop/contents/mesop%2Fserver%2Fstatic_file_serving.py?ref=17fb769d6a91f0a8cbccfab18f64977b158a6a31",
                "patch": "@@ -96,8 +96,19 @@ def serve_web_components(path: str):\n     serving_path = (\n       get_runfile_location(path)\n       if has_runfiles()\n-      else os.path.join(os.getcwd(), path)\n+      else safe_join(os.getcwd(), path)\n     )\n+\n+    file_name = os.path.basename(path)\n+    file_extension = os.path.splitext(file_name)[1].lower()\n+    allowed_extensions = {\".js\", \".css\"}\n+    if file_extension not in allowed_extensions:\n+      raise MesopException(\n+        f\"Unexpected file type: {file_extension}. Only {', '.join(allowed_extensions)} files are allowed.\"\n+      )\n+\n+    if not serving_path:\n+      raise MesopException(\"Unexpected request to \" + path)\n     return send_file_compressed(\n       serving_path,\n       disable_gzip_cache=disable_gzip_cache,"
            },
            {
                "sha": "dddfa733a9bbbf2ed160cc9554c642e7719af77e",
                "filename": "mesop/tests/e2e/web_components/web_component_serving_test.ts",
                "status": "added",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/mesop-dev/mesop/blob/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Ftests%2Fe2e%2Fweb_components%2Fweb_component_serving_test.ts",
                "raw_url": "https://github.com/mesop-dev/mesop/raw/17fb769d6a91f0a8cbccfab18f64977b158a6a31/mesop%2Ftests%2Fe2e%2Fweb_components%2Fweb_component_serving_test.ts",
                "contents_url": "https://api.github.com/repos/mesop-dev/mesop/contents/mesop%2Ftests%2Fe2e%2Fweb_components%2Fweb_component_serving_test.ts?ref=17fb769d6a91f0a8cbccfab18f64977b158a6a31",
                "patch": "@@ -0,0 +1,20 @@\n+import {test, expect} from '@playwright/test';\n+\n+test('web components serving blocks non-js/css files', async ({page}) => {\n+  const response = await page.goto(\n+    '/__web-components-module__/mesop/mesop/examples/web_component/quickstart/counter_component.py',\n+  );\n+  expect(response!.status()).toBe(500);\n+});\n+\n+test('web components serving allows js and css files', async ({page}) => {\n+  const jsResponse = await page.goto(\n+    '/__web-components-module__/mesop/mesop/examples/web_component/quickstart/counter_component.js',\n+  );\n+  expect(jsResponse!.status()).toBe(200);\n+\n+  const cssResponse = await page.goto(\n+    '/__web-components-module__/mesop/mesop/examples/web_component/testing.css',\n+  );\n+  expect(cssResponse!.status()).toBe(200);\n+});"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/e8acc9d8e6af7dfbfe70716ded431642ae4a6dd4",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/e8acc9d8e6af7dfbfe70716ded431642ae4a6dd4",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/e8acc9d8e6af7dfbfe70716ded431642ae4a6dd4",
        "message": "XWIKI-20337: Bad condition for editing notification filter preferences",
        "files": [
            {
                "sha": "33ae1b9764f7f2c75dad887997e14483cc1a6c47",
                "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationPreferenceService.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/e8acc9d8e6af7dfbfe70716ded431642ae4a6dd4/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/e8acc9d8e6af7dfbfe70716ded431642ae4a6dd4/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml?ref=e8acc9d8e6af7dfbfe70716ded431642ae4a6dd4",
                "patch": "@@ -37,6 +37,7 @@\n   <syntaxId>xwiki/2.1</syntaxId>\n   <hidden>true</hidden>\n   <content>{{velocity}}\n+#set($isActionAllowed = false)\n #if (\"$!request.user\" != \"\")\n     #if ($request.user.contains(\".\"))\n       #set ($targetUser = $request.user)\n@@ -47,15 +48,17 @@\n #if (\"$!request.target\" == 'wiki')\n   #set ($targetDoc = $xwiki.getDocument($services.model.createDocumentReference('', ['XWiki', 'Notifications', 'Code'], 'NotificationAdministration')))\n   #set ($targetRef = $services.wiki.getCurrentWikiReference())\n+  #set($isActionAllowed = $hasAdmin)\n #elseif (\"$!request.target\" == 'user')\n   #set ($targetDoc = $xwiki.getDocument($targetUser))\n-  #set ($targetRef = $targetUser)\n+  #set ($targetRef = $services.model.resolveDocument($targetUser))\n+  #set($isActionAllowed = ($services.security.authorization.hasAccess('admin', $requestedUserDocRef) || $xcontext.userReference.equals($targetRef)))\n #end\n #if (\"$!request.action\" == \"\" &amp;&amp; $request.method.equalsIgnoreCase('get'))\n   This is a technical page for Notifications macro.\n #elseif (!$services.csrf.isTokenValid($request.csrf))\n   #set ($discard = $response.sendError(401, $services.localization.render('notifications.settings.error.badCSRF')))\n-#elseif (\"$!request.target\" == 'wiki' &amp;&amp; !$hasAdmin)\n+#elseif (!$isActionAllowed)\n   #set ($discard = $response.sendError(401))\n #elseif (\"$!request.action\" == \"\" || \"$!request.target\" == \"\" || (\"$!request.target\" == 'user' &amp;&amp; \"$!request.user\" == \"\"))\n   #set ($discard = $response.sendError(400, $services.localization.render('notifications.settings.error.badParameters')))"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/4771573dac88e0cf04e30f1a8dfa183c048d503a",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/4771573dac88e0cf04e30f1a8dfa183c048d503a",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/4771573dac88e0cf04e30f1a8dfa183c048d503a",
        "message": "XWIKI-20337: Bad condition for editing notification filter preferences\n\n(cherry picked from commit e8acc9d8e6af7dfbfe70716ded431642ae4a6dd4)",
        "files": [
            {
                "sha": "33ae1b9764f7f2c75dad887997e14483cc1a6c47",
                "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationPreferenceService.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/4771573dac88e0cf04e30f1a8dfa183c048d503a/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/4771573dac88e0cf04e30f1a8dfa183c048d503a/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml?ref=4771573dac88e0cf04e30f1a8dfa183c048d503a",
                "patch": "@@ -37,6 +37,7 @@\n   <syntaxId>xwiki/2.1</syntaxId>\n   <hidden>true</hidden>\n   <content>{{velocity}}\n+#set($isActionAllowed = false)\n #if (\"$!request.user\" != \"\")\n     #if ($request.user.contains(\".\"))\n       #set ($targetUser = $request.user)\n@@ -47,15 +48,17 @@\n #if (\"$!request.target\" == 'wiki')\n   #set ($targetDoc = $xwiki.getDocument($services.model.createDocumentReference('', ['XWiki', 'Notifications', 'Code'], 'NotificationAdministration')))\n   #set ($targetRef = $services.wiki.getCurrentWikiReference())\n+  #set($isActionAllowed = $hasAdmin)\n #elseif (\"$!request.target\" == 'user')\n   #set ($targetDoc = $xwiki.getDocument($targetUser))\n-  #set ($targetRef = $targetUser)\n+  #set ($targetRef = $services.model.resolveDocument($targetUser))\n+  #set($isActionAllowed = ($services.security.authorization.hasAccess('admin', $requestedUserDocRef) || $xcontext.userReference.equals($targetRef)))\n #end\n #if (\"$!request.action\" == \"\" &amp;&amp; $request.method.equalsIgnoreCase('get'))\n   This is a technical page for Notifications macro.\n #elseif (!$services.csrf.isTokenValid($request.csrf))\n   #set ($discard = $response.sendError(401, $services.localization.render('notifications.settings.error.badCSRF')))\n-#elseif (\"$!request.target\" == 'wiki' &amp;&amp; !$hasAdmin)\n+#elseif (!$isActionAllowed)\n   #set ($discard = $response.sendError(401))\n #elseif (\"$!request.action\" == \"\" || \"$!request.target\" == \"\" || (\"$!request.target\" == 'user' &amp;&amp; \"$!request.user\" == \"\"))\n   #set ($discard = $response.sendError(400, $services.localization.render('notifications.settings.error.badParameters')))"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/b9180b874a22e383ad5f2cd9e25bfed4594d4955",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/b9180b874a22e383ad5f2cd9e25bfed4594d4955",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/b9180b874a22e383ad5f2cd9e25bfed4594d4955",
        "message": "XWIKI-20337: Bad condition for editing notification filter preferences\n\n  * Fix condition for watching / unwatching users\n\n(cherry picked from commit 0bd5585f5b7b0045ef197d26f3c5b69a25ee42bf)",
        "files": [
            {
                "sha": "f7336f1adb1dda60a30a5bcf67dcc6866ff06841",
                "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationPreferenceService.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/b9180b874a22e383ad5f2cd9e25bfed4594d4955/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/b9180b874a22e383ad5f2cd9e25bfed4594d4955/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml?ref=b9180b874a22e383ad5f2cd9e25bfed4594d4955",
                "patch": "@@ -52,7 +52,7 @@\n #elseif (\"$!request.target\" == 'user')\n   #set ($targetDoc = $xwiki.getDocument($targetUser))\n   #set ($targetRef = $services.model.resolveDocument($targetUser))\n-  #set($isActionAllowed = ($services.security.authorization.hasAccess('admin', $requestedUserDocRef) || $xcontext.userReference.equals($targetRef)))\n+  #set($isActionAllowed = (\"$!request.action\" == 'watchUser' || \"$!request.action\" == 'unwatchUser' || $services.security.authorization.hasAccess('admin', $requestedUserDocRef) || $xcontext.userReference.equals($targetRef)))\n #end\n #if (\"$!request.action\" == \"\" &amp;&amp; $request.method.equalsIgnoreCase('get'))\n   This is a technical page for Notifications macro."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/99193a7e9a203b5bb8b2583ac96f5f4d56b9aa1a",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/99193a7e9a203b5bb8b2583ac96f5f4d56b9aa1a",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/99193a7e9a203b5bb8b2583ac96f5f4d56b9aa1a",
        "message": "XWIKI-20337: Bad condition for editing notification filter preferences\n\n  * Fix condition for watching / unwatching users\n\n(cherry picked from commit 0bd5585f5b7b0045ef197d26f3c5b69a25ee42bf)",
        "files": [
            {
                "sha": "f7336f1adb1dda60a30a5bcf67dcc6866ff06841",
                "filename": "xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/main/resources/XWiki/Notifications/Code/NotificationPreferenceService.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/99193a7e9a203b5bb8b2583ac96f5f4d56b9aa1a/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/99193a7e9a203b5bb8b2583ac96f5f4d56b9aa1a/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-notifications%2Fxwiki-platform-notifications-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FNotifications%2FCode%2FNotificationPreferenceService.xml?ref=99193a7e9a203b5bb8b2583ac96f5f4d56b9aa1a",
                "patch": "@@ -52,7 +52,7 @@\n #elseif (\"$!request.target\" == 'user')\n   #set ($targetDoc = $xwiki.getDocument($targetUser))\n   #set ($targetRef = $services.model.resolveDocument($targetUser))\n-  #set($isActionAllowed = ($services.security.authorization.hasAccess('admin', $requestedUserDocRef) || $xcontext.userReference.equals($targetRef)))\n+  #set($isActionAllowed = (\"$!request.action\" == 'watchUser' || \"$!request.action\" == 'unwatchUser' || $services.security.authorization.hasAccess('admin', $requestedUserDocRef) || $xcontext.userReference.equals($targetRef)))\n #end\n #if (\"$!request.action\" == \"\" &amp;&amp; $request.method.equalsIgnoreCase('get'))\n   This is a technical page for Notifications macro."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/owen2345/camaleon-cms/commits/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
        "url": "https://api.github.com/repos/owen2345/camaleon-cms/commits/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
        "html_url": "https://github.com/owen2345/camaleon-cms/commit/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
        "message": "Merge pull request #1083 from texpert/fix-path-traversal-in-download-private-file\n\nMitigate arbitrary path traversal in download_private_file  (GHSL-2024-183)",
        "files": [
            {
                "sha": "7e613cf929df8c612516a2d5736506d5d2e5c34c",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/owen2345/camaleon-cms/blob/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/CHANGELOG.md",
                "raw_url": "https://github.com/owen2345/camaleon-cms/raw/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/owen2345/camaleon-cms/contents/CHANGELOG.md?ref=071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
                "patch": "@@ -8,6 +8,8 @@\n - **Security fix:** Mitigate arbitrary path write in uploader (GHSL-2024-182)\n   - Thanks [Peter St\u00f6ckli](https://github.com/p-) for reporting and providing clear reproduction steps\n - Add Rails 7.2 to stable testing on CI, point rails_edge to main branch\n+- **Security fix:** Mitigate arbitrary path traversal in download_private_file (GHSL-2024-183)\n+  - Thanks [Peter St\u00f6ckli](https://github.com/p-) for reporting and providing clear reproduction steps\n \n ## [2.8.0](https://github.com/owen2345/camaleon-cms/tree/2.8.0) (2024-07-26)\n - Use jQuery 2.x - 2.2.4"
            },
            {
                "sha": "4f6a26b5d09a70264aa9d3764d76d71536edb955",
                "filename": "Gemfile",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/owen2345/camaleon-cms/blob/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/Gemfile",
                "raw_url": "https://github.com/owen2345/camaleon-cms/raw/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/Gemfile",
                "contents_url": "https://api.github.com/repos/owen2345/camaleon-cms/contents/Gemfile?ref=071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
                "patch": "@@ -1,9 +1,9 @@\n source 'https://rubygems.org'\n \n gemspec\n-gem 'non-digest-assets'\n+gem 'non-digest-assets', git: 'https://github.com/mvz/non-digest-assets'\n gem 'oj'\n-gem 'rails', '~> 7.1.0'\n+gem 'rails', '~> 7.2.0'\n gem 'selenium-webdriver'\n gem 'sprockets-rails', '>= 3.5.1'\n "
            },
            {
                "sha": "241558b1a1e34e0377cce3855f57d79345a88dc7",
                "filename": "app/controllers/camaleon_cms/admin/media_controller.rb",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/owen2345/camaleon-cms/blob/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/app%2Fcontrollers%2Fcamaleon_cms%2Fadmin%2Fmedia_controller.rb",
                "raw_url": "https://github.com/owen2345/camaleon-cms/raw/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/app%2Fcontrollers%2Fcamaleon_cms%2Fadmin%2Fmedia_controller.rb",
                "contents_url": "https://api.github.com/repos/owen2345/camaleon-cms/contents/app%2Fcontrollers%2Fcamaleon_cms%2Fadmin%2Fmedia_controller.rb?ref=071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
                "patch": "@@ -30,6 +30,8 @@ def download_private_file\n \n         file = cama_uploader.fetch_file(\"private/#{params[:file]}\")\n \n+        return render plain: helpers.sanitize(file[:error]) if file.is_a?(Hash) && file[:error].present?\n+\n         send_file file, disposition: 'inline'\n       end\n "
            },
            {
                "sha": "bffe161b0e7a986ff30670b6ce7e7adfaa7dbd6f",
                "filename": "app/uploaders/camaleon_cms_aws_uploader.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/owen2345/camaleon-cms/blob/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/app%2Fuploaders%2Fcamaleon_cms_aws_uploader.rb",
                "raw_url": "https://github.com/owen2345/camaleon-cms/raw/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/app%2Fuploaders%2Fcamaleon_cms_aws_uploader.rb",
                "contents_url": "https://api.github.com/repos/owen2345/camaleon-cms/contents/app%2Fuploaders%2Fcamaleon_cms_aws_uploader.rb?ref=071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
                "patch": "@@ -36,11 +36,11 @@ def objects(prefix = '/', sort = 'created_at')\n   end\n \n   def fetch_file(file_name)\n-    bucket.object(file_name).download_file(file_name) unless file_exists?(file_name)\n+    return file_name if file_exists?(file_name)\n \n-    raise ActionController::RoutingError, 'File not found' unless file_exists?(file_name)\n+    return file_name if bucket.object(file_name).download_file(file_name) && file_exists?(file_name)\n \n-    file_name\n+    { error: 'File not found' }\n   end\n \n   # parse an AWS file into custom file_object"
            },
            {
                "sha": "c9be051a40753d92def0edcd1d8b60293b956f83",
                "filename": "app/uploaders/camaleon_cms_local_uploader.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/owen2345/camaleon-cms/blob/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/app%2Fuploaders%2Fcamaleon_cms_local_uploader.rb",
                "raw_url": "https://github.com/owen2345/camaleon-cms/raw/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/app%2Fuploaders%2Fcamaleon_cms_local_uploader.rb",
                "contents_url": "https://api.github.com/repos/owen2345/camaleon-cms/contents/app%2Fuploaders%2Fcamaleon_cms_local_uploader.rb?ref=071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
                "patch": "@@ -25,9 +25,11 @@ def browser_files(prefix = '/', _objects = {})\n   end\n \n   def fetch_file(file_name)\n-    raise ActionController::RoutingError, 'File not found' unless file_exists?(file_name)\n+    return { error: 'Invalid file path' } if file_name.include?('..')\n \n-    file_name\n+    return file_name if file_exists?(file_name)\n+\n+    { error: 'File not found' }\n   end\n \n   def file_parse(key)"
            },
            {
                "sha": "bbb98a45ea629241a07ff4baa9b8b9bb22efd4e2",
                "filename": "spec/dummy/config/environments/test.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/owen2345/camaleon-cms/blob/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/spec%2Fdummy%2Fconfig%2Fenvironments%2Ftest.rb",
                "raw_url": "https://github.com/owen2345/camaleon-cms/raw/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/spec%2Fdummy%2Fconfig%2Fenvironments%2Ftest.rb",
                "contents_url": "https://api.github.com/repos/owen2345/camaleon-cms/contents/spec%2Fdummy%2Fconfig%2Fenvironments%2Ftest.rb?ref=071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
                "patch": "@@ -25,7 +25,11 @@\n   config.assets.check_precompiled_asset = false\n \n   # Raise exceptions instead of rendering exception templates.\n-  config.action_dispatch.show_exceptions = false\n+  config.action_dispatch.show_exceptions = if ::Rails::VERSION::STRING < '7.2.0'\n+                                             false\n+                                           else\n+                                             :none\n+                                           end\n \n   # Disable request forgery protection in test environment.\n   config.action_controller.allow_forgery_protection = false"
            },
            {
                "sha": "338189130074685fd3ff5a4d671bd82775c8dc66",
                "filename": "spec/requests/download_private_file_spec.rb",
                "status": "added",
                "additions": 47,
                "deletions": 0,
                "changes": 47,
                "blob_url": "https://github.com/owen2345/camaleon-cms/blob/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/spec%2Frequests%2Fdownload_private_file_spec.rb",
                "raw_url": "https://github.com/owen2345/camaleon-cms/raw/071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e/spec%2Frequests%2Fdownload_private_file_spec.rb",
                "contents_url": "https://api.github.com/repos/owen2345/camaleon-cms/contents/spec%2Frequests%2Fdownload_private_file_spec.rb?ref=071b1b09d6d61ab02a5960b1ccafd9d9c2155a3e",
                "patch": "@@ -0,0 +1,47 @@\n+# frozen_string_literal: true\n+\n+require 'rails_helper'\n+\n+RSpec.describe 'Media requests', type: :request do\n+  init_site\n+\n+  describe 'Download private file' do\n+    let(:current_site) { Cama::Site.first.decorate }\n+\n+    before do\n+      allow_any_instance_of(CamaleonCms::Admin::MediaController).to receive(:cama_authenticate)\n+      allow_any_instance_of(CamaleonCms::Admin::MediaController).to receive(:current_site).and_return(current_site)\n+    end\n+\n+    context 'when the file path is valid and file exists' do\n+      before do\n+        allow_any_instance_of(CamaleonCmsLocalUploader).to receive(:fetch_file).and_return('some_file')\n+\n+        allow_any_instance_of(CamaleonCms::Admin::MediaController).to receive(:send_file)\n+        allow_any_instance_of(CamaleonCms::Admin::MediaController).to receive(:default_render)\n+      end\n+\n+      it 'allows the file to be downloaded' do\n+        expect_any_instance_of(CamaleonCms::Admin::MediaController).to receive(:send_file).with('some_file', disposition: 'inline')\n+\n+        get '/admin/media/download_private_file', params: { file: 'some_file' }\n+      end\n+    end\n+\n+    context 'when file path is invalid' do\n+      it 'returns invalid file path error' do\n+        get '/admin/media/download_private_file', params: { file: './../../../../../etc/passwd' }\n+\n+        expect(response.body).to include('Invalid file path')\n+      end\n+    end\n+\n+    context 'when the file is not found' do\n+      it 'returns file not found error' do\n+        get '/admin/media/download_private_file', params: { file: 'passwd' }\n+\n+        expect(response.body).to include('File not found')\n+      end\n+    end\n+  end\n+end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/owen2345/camaleon-cms/commits/b3b12b1e4a9e3fccaf5bb4330820fa7f8744e6bd",
        "url": "https://api.github.com/repos/owen2345/camaleon-cms/commits/b3b12b1e4a9e3fccaf5bb4330820fa7f8744e6bd",
        "html_url": "https://github.com/owen2345/camaleon-cms/commit/b3b12b1e4a9e3fccaf5bb4330820fa7f8744e6bd",
        "message": "Fix GHSL-2024-182 - don't allow path traversal on upload_file",
        "files": [
            {
                "sha": "9a8453b6d90c6aab30eb6d1e1133110ef67567f1",
                "filename": "app/helpers/camaleon_cms/uploader_helper.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/owen2345/camaleon-cms/blob/b3b12b1e4a9e3fccaf5bb4330820fa7f8744e6bd/app%2Fhelpers%2Fcamaleon_cms%2Fuploader_helper.rb",
                "raw_url": "https://github.com/owen2345/camaleon-cms/raw/b3b12b1e4a9e3fccaf5bb4330820fa7f8744e6bd/app%2Fhelpers%2Fcamaleon_cms%2Fuploader_helper.rb",
                "contents_url": "https://api.github.com/repos/owen2345/camaleon-cms/contents/app%2Fhelpers%2Fcamaleon_cms%2Fuploader_helper.rb?ref=b3b12b1e4a9e3fccaf5bb4330820fa7f8744e6bd",
                "patch": "@@ -58,6 +58,9 @@ def upload_file(uploaded_io, settings = {})\n       hooks_run('before_upload', settings)\n       res = { error: nil }\n \n+      # guard against path traversal\n+      return { error: 'Invalid file path' } unless cama_uploader.class.valid_folder_path?(settings[:folder])\n+\n       # formats validations\n       return { error: \"#{ct('file_format_error')} (#{settings[:formats]})\" } unless cama_uploader.class.validate_file_format(\n         uploaded_io.path, settings[:formats]"
            },
            {
                "sha": "05399356b8bd7c82c23fc82e21c4cbe58bdf2f19",
                "filename": "app/uploaders/camaleon_cms_uploader.rb",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/owen2345/camaleon-cms/blob/b3b12b1e4a9e3fccaf5bb4330820fa7f8744e6bd/app%2Fuploaders%2Fcamaleon_cms_uploader.rb",
                "raw_url": "https://github.com/owen2345/camaleon-cms/raw/b3b12b1e4a9e3fccaf5bb4330820fa7f8744e6bd/app%2Fuploaders%2Fcamaleon_cms_uploader.rb",
                "contents_url": "https://api.github.com/repos/owen2345/camaleon-cms/contents/app%2Fuploaders%2Fcamaleon_cms_uploader.rb?ref=b3b12b1e4a9e3fccaf5bb4330820fa7f8744e6bd",
                "patch": "@@ -125,6 +125,12 @@ def self.validate_file_format(key, valid_formats = '*')\n     valid_formats.include?(File.extname(key).sub('.', '').split('?').first.try(:downcase))\n   end\n \n+  def self.valid_folder_path?(path)\n+    return false if path.include?(\"..\") || File.absolute_path?(path) || path.include?(\"://\")\n+\n+    true\n+  end\n+\n   # verify if this file name already exist\n   # if the file is already exist, return a new name for this file\n   # sample: search_new_key(\"my_file/file.txt\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/directus/directus/commits/4aace0bbe57232e38cd6a287ee475293e46dc91b",
        "url": "https://api.github.com/repos/directus/directus/commits/4aace0bbe57232e38cd6a287ee475293e46dc91b",
        "html_url": "https://github.com/directus/directus/commit/4aace0bbe57232e38cd6a287ee475293e46dc91b",
        "message": "Merge commit from fork\n\n* Exclude all auth from response caching\n\n* Add changeset",
        "files": [
            {
                "sha": "32d1d59da4a339abb8a1ffaaf597cbac12ec33bc",
                "filename": ".changeset/orange-suns-fry.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/directus/directus/blob/4aace0bbe57232e38cd6a287ee475293e46dc91b/.changeset%2Forange-suns-fry.md",
                "raw_url": "https://github.com/directus/directus/raw/4aace0bbe57232e38cd6a287ee475293e46dc91b/.changeset%2Forange-suns-fry.md",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/.changeset%2Forange-suns-fry.md?ref=4aace0bbe57232e38cd6a287ee475293e46dc91b",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@directus/api': patch\n+---\n+\n+Fixed an issue that could cause the response cache to misbehave"
            },
            {
                "sha": "505e77e01aeda5bfaa2fbfac8f6b213c670a7134",
                "filename": "api/src/middleware/respond.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/directus/directus/blob/4aace0bbe57232e38cd6a287ee475293e46dc91b/api%2Fsrc%2Fmiddleware%2Frespond.ts",
                "raw_url": "https://github.com/directus/directus/raw/4aace0bbe57232e38cd6a287ee475293e46dc91b/api%2Fsrc%2Fmiddleware%2Frespond.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Fmiddleware%2Frespond.ts?ref=4aace0bbe57232e38cd6a287ee475293e46dc91b",
                "patch": "@@ -27,6 +27,7 @@ export const respond: RequestHandler = asyncHandler(async (req, res) => {\n \n \tif (\n \t\t(req.method.toLowerCase() === 'get' || req.originalUrl?.startsWith('/graphql')) &&\n+\t\treq.originalUrl?.startsWith('/auth') === false &&\n \t\tenv['CACHE_ENABLED'] === true &&\n \t\tcache &&\n \t\t!req.sanitizedQuery.export &&"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/directus/directus/commits/769fa22797bff5a9231599883b391e013f122e52",
        "url": "https://api.github.com/repos/directus/directus/commits/769fa22797bff5a9231599883b391e013f122e52",
        "html_url": "https://github.com/directus/directus/commit/769fa22797bff5a9231599883b391e013f122e52",
        "message": "Merge commit from fork\n\n* Exclude all auth from response caching\n\n* Add changeset",
        "files": [
            {
                "sha": "32d1d59da4a339abb8a1ffaaf597cbac12ec33bc",
                "filename": ".changeset/orange-suns-fry.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/directus/directus/blob/769fa22797bff5a9231599883b391e013f122e52/.changeset%2Forange-suns-fry.md",
                "raw_url": "https://github.com/directus/directus/raw/769fa22797bff5a9231599883b391e013f122e52/.changeset%2Forange-suns-fry.md",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/.changeset%2Forange-suns-fry.md?ref=769fa22797bff5a9231599883b391e013f122e52",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@directus/api': patch\n+---\n+\n+Fixed an issue that could cause the response cache to misbehave"
            },
            {
                "sha": "19c93c84889817612c9c946770021068bb6e65a6",
                "filename": "api/src/middleware/respond.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/directus/directus/blob/769fa22797bff5a9231599883b391e013f122e52/api%2Fsrc%2Fmiddleware%2Frespond.ts",
                "raw_url": "https://github.com/directus/directus/raw/769fa22797bff5a9231599883b391e013f122e52/api%2Fsrc%2Fmiddleware%2Frespond.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Fmiddleware%2Frespond.ts?ref=769fa22797bff5a9231599883b391e013f122e52",
                "patch": "@@ -27,6 +27,7 @@ export const respond: RequestHandler = asyncHandler(async (req, res) => {\n \n \tif (\n \t\t(req.method.toLowerCase() === 'get' || req.originalUrl?.startsWith('/graphql')) &&\n+\t\treq.originalUrl?.startsWith('/auth') === false &&\n \t\tenv['CACHE_ENABLED'] === true &&\n \t\tcache &&\n \t\t!req.sanitizedQuery.export &&"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/directus/directus/commits/c1f3ccc681595038d094ce110ddeee38cb38f431",
        "url": "https://api.github.com/repos/directus/directus/commits/c1f3ccc681595038d094ce110ddeee38cb38f431",
        "html_url": "https://github.com/directus/directus/commit/c1f3ccc681595038d094ce110ddeee38cb38f431",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "f7ae704722b335684f1a20aae724d59bdc941eb9",
                "filename": ".changeset/silly-months-protect.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/directus/directus/blob/c1f3ccc681595038d094ce110ddeee38cb38f431/.changeset%2Fsilly-months-protect.md",
                "raw_url": "https://github.com/directus/directus/raw/c1f3ccc681595038d094ce110ddeee38cb38f431/.changeset%2Fsilly-months-protect.md",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/.changeset%2Fsilly-months-protect.md?ref=c1f3ccc681595038d094ce110ddeee38cb38f431",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@directus/env': patch\n+---\n+\n+Expanded `0.0.0.0` matching of loopback ranges"
            },
            {
                "sha": "77cc0694da69f4e0356fa0941b4dfa019a319ee2",
                "filename": "api/src/request/is-denied-ip.test.ts",
                "status": "modified",
                "additions": 23,
                "deletions": 1,
                "changes": 24,
                "blob_url": "https://github.com/directus/directus/blob/c1f3ccc681595038d094ce110ddeee38cb38f431/api%2Fsrc%2Frequest%2Fis-denied-ip.test.ts",
                "raw_url": "https://github.com/directus/directus/raw/c1f3ccc681595038d094ce110ddeee38cb38f431/api%2Fsrc%2Frequest%2Fis-denied-ip.test.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Frequest%2Fis-denied-ip.test.ts?ref=c1f3ccc681595038d094ce110ddeee38cb38f431",
                "patch": "@@ -108,7 +108,7 @@ test(`Returns true if IP matches resolved local network interface address`, asyn\n \t\t\t\tnetmask: '255.0.0.0',\n \t\t\t\tfamily: 'IPv4',\n \t\t\t\tmac: '00:00:00:00:00:00',\n-\t\t\t\tinternal: true,\n+\t\t\t\tinternal: false,\n \t\t\t\tcidr: '127.0.0.1/8',\n \t\t\t},\n \t\t],\n@@ -118,3 +118,25 @@ test(`Returns true if IP matches resolved local network interface address`, asyn\n \n \texpect(result).toBe(true);\n });\n+\n+test(`Returns true if IP matches resolved to local loopback devices`, async () => {\n+\tvi.mocked(useEnv).mockReturnValue({ IMPORT_IP_DENY_LIST: ['0.0.0.0'] });\n+\n+\tvi.mocked(os.networkInterfaces).mockReturnValue({\n+\t\tfa0: undefined,\n+\t\tlo0: [\n+\t\t\t{\n+\t\t\t\taddress: '127.0.0.1',\n+\t\t\t\tnetmask: '255.0.0.0',\n+\t\t\t\tfamily: 'IPv4',\n+\t\t\t\tmac: '00:00:00:00:00:00',\n+\t\t\t\tinternal: true,\n+\t\t\t\tcidr: '127.0.0.1/8',\n+\t\t\t},\n+\t\t],\n+\t});\n+\n+\texpect(isDeniedIp('127.0.0.1')).toBe(true);\n+\texpect(isDeniedIp('127.8.16.32')).toBe(true);\n+\texpect(isDeniedIp('127.127.127.127')).toBe(true);\n+});"
            },
            {
                "sha": "f61a1218f670d6403225ab382e03c4de3ace8344",
                "filename": "api/src/request/is-denied-ip.ts",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/directus/directus/blob/c1f3ccc681595038d094ce110ddeee38cb38f431/api%2Fsrc%2Frequest%2Fis-denied-ip.ts",
                "raw_url": "https://github.com/directus/directus/raw/c1f3ccc681595038d094ce110ddeee38cb38f431/api%2Fsrc%2Frequest%2Fis-denied-ip.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Frequest%2Fis-denied-ip.ts?ref=c1f3ccc681595038d094ce110ddeee38cb38f431",
                "patch": "@@ -1,4 +1,5 @@\n import { useEnv } from '@directus/env';\n+import { matches } from 'ip-matching';\n import os from 'node:os';\n import { useLogger } from '../logger/index.js';\n import { ipInNetworks } from '../utils/ip-in-networks.js';\n@@ -29,7 +30,11 @@ export function isDeniedIp(ip: string): boolean {\n \t\t\tif (!networkInfo) continue;\n \n \t\t\tfor (const info of networkInfo) {\n-\t\t\t\tif (info.address === ip) return true;\n+\t\t\t\tif (info.internal && info.cidr) {\n+\t\t\t\t\tif (matches(ip, info.cidr)) return true;\n+\t\t\t\t} else if (info.address === ip) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/directus/directus/commits/8cbf943b65fd4a763d09a5fdbba8996b1e7797ff",
        "url": "https://api.github.com/repos/directus/directus/commits/8cbf943b65fd4a763d09a5fdbba8996b1e7797ff",
        "html_url": "https://github.com/directus/directus/commit/8cbf943b65fd4a763d09a5fdbba8996b1e7797ff",
        "message": "Merge commit from fork\n\n* updated default blocklist to include other loopback devices\n\n* changeset\n\n* improved fix\n\n* Update api/src/request/is-denied-ip.ts\n\nCo-authored-by: Hannes K\u00fcttner <kuettner.hannes@gmail.com>\n\n---------\n\nCo-authored-by: Hannes K\u00fcttner <kuettner.hannes@gmail.com>",
        "files": [
            {
                "sha": "f7ae704722b335684f1a20aae724d59bdc941eb9",
                "filename": ".changeset/silly-months-protect.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/directus/directus/blob/8cbf943b65fd4a763d09a5fdbba8996b1e7797ff/.changeset%2Fsilly-months-protect.md",
                "raw_url": "https://github.com/directus/directus/raw/8cbf943b65fd4a763d09a5fdbba8996b1e7797ff/.changeset%2Fsilly-months-protect.md",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/.changeset%2Fsilly-months-protect.md?ref=8cbf943b65fd4a763d09a5fdbba8996b1e7797ff",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@directus/env': patch\n+---\n+\n+Expanded `0.0.0.0` matching of loopback ranges"
            },
            {
                "sha": "77cc0694da69f4e0356fa0941b4dfa019a319ee2",
                "filename": "api/src/request/is-denied-ip.test.ts",
                "status": "modified",
                "additions": 23,
                "deletions": 1,
                "changes": 24,
                "blob_url": "https://github.com/directus/directus/blob/8cbf943b65fd4a763d09a5fdbba8996b1e7797ff/api%2Fsrc%2Frequest%2Fis-denied-ip.test.ts",
                "raw_url": "https://github.com/directus/directus/raw/8cbf943b65fd4a763d09a5fdbba8996b1e7797ff/api%2Fsrc%2Frequest%2Fis-denied-ip.test.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Frequest%2Fis-denied-ip.test.ts?ref=8cbf943b65fd4a763d09a5fdbba8996b1e7797ff",
                "patch": "@@ -108,7 +108,7 @@ test(`Returns true if IP matches resolved local network interface address`, asyn\n \t\t\t\tnetmask: '255.0.0.0',\n \t\t\t\tfamily: 'IPv4',\n \t\t\t\tmac: '00:00:00:00:00:00',\n-\t\t\t\tinternal: true,\n+\t\t\t\tinternal: false,\n \t\t\t\tcidr: '127.0.0.1/8',\n \t\t\t},\n \t\t],\n@@ -118,3 +118,25 @@ test(`Returns true if IP matches resolved local network interface address`, asyn\n \n \texpect(result).toBe(true);\n });\n+\n+test(`Returns true if IP matches resolved to local loopback devices`, async () => {\n+\tvi.mocked(useEnv).mockReturnValue({ IMPORT_IP_DENY_LIST: ['0.0.0.0'] });\n+\n+\tvi.mocked(os.networkInterfaces).mockReturnValue({\n+\t\tfa0: undefined,\n+\t\tlo0: [\n+\t\t\t{\n+\t\t\t\taddress: '127.0.0.1',\n+\t\t\t\tnetmask: '255.0.0.0',\n+\t\t\t\tfamily: 'IPv4',\n+\t\t\t\tmac: '00:00:00:00:00:00',\n+\t\t\t\tinternal: true,\n+\t\t\t\tcidr: '127.0.0.1/8',\n+\t\t\t},\n+\t\t],\n+\t});\n+\n+\texpect(isDeniedIp('127.0.0.1')).toBe(true);\n+\texpect(isDeniedIp('127.8.16.32')).toBe(true);\n+\texpect(isDeniedIp('127.127.127.127')).toBe(true);\n+});"
            },
            {
                "sha": "256b739b89caa80a4dde9fc21b2f47de128ec823",
                "filename": "api/src/request/is-denied-ip.ts",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/directus/directus/blob/8cbf943b65fd4a763d09a5fdbba8996b1e7797ff/api%2Fsrc%2Frequest%2Fis-denied-ip.ts",
                "raw_url": "https://github.com/directus/directus/raw/8cbf943b65fd4a763d09a5fdbba8996b1e7797ff/api%2Fsrc%2Frequest%2Fis-denied-ip.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Frequest%2Fis-denied-ip.ts?ref=8cbf943b65fd4a763d09a5fdbba8996b1e7797ff",
                "patch": "@@ -1,5 +1,6 @@\n import { useEnv } from '@directus/env';\n import os from 'node:os';\n+import { matches } from 'ip-matching';\n import { useLogger } from '../logger/index.js';\n import { ipInNetworks } from '../utils/ip-in-networks.js';\n \n@@ -29,7 +30,11 @@ export function isDeniedIp(ip: string): boolean {\n \t\t\tif (!networkInfo) continue;\n \n \t\t\tfor (const info of networkInfo) {\n-\t\t\t\tif (info.address === ip) return true;\n+\t\t\t\tif (info.internal && info.cidr) {\n+\t\t\t\t\tif (matches(ip, info.cidr)) return true;\n+\t\t\t\t} else if (info.address === ip) { \n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/delvedor/find-my-way/commits/17fae694dcefc056045da201681c1530f0f80518",
        "url": "https://api.github.com/repos/delvedor/find-my-way/commits/17fae694dcefc056045da201681c1530f0f80518",
        "html_url": "https://github.com/delvedor/find-my-way/commit/17fae694dcefc056045da201681c1530f0f80518",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "eeee78fcb037b803668a06f87861f310c30bd79c",
                "filename": "index.js",
                "status": "modified",
                "additions": 13,
                "deletions": 4,
                "changes": 17,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/17fae694dcefc056045da201681c1530f0f80518/index.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/17fae694dcefc056045da201681c1530f0f80518/index.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/index.js?ref=17fae694dcefc056045da201681c1530f0f80518",
                "patch": "@@ -192,6 +192,8 @@ Router.prototype._on = function _on (method, path, opts, handler, store) {\n \n     if (isParametricNode) {\n       let isRegexNode = false\n+      let isParamSafe = true\n+      let backtrack = ''\n       const regexps = []\n \n       let lastParamStartIndex = i + 1\n@@ -219,8 +221,10 @@ Router.prototype._on = function _on (method, path, opts, handler, store) {\n             regexps.push(trimRegExpStartAndEnd(regexString))\n \n             j = endOfRegexIndex + 1\n+            isParamSafe = true\n           } else {\n-            regexps.push('(.*?)')\n+            regexps.push(isParamSafe ? '(.*?)' : `(${backtrack}|(?:(?!${backtrack}).)*)`)\n+            isParamSafe = false\n           }\n \n           const staticPartStartIndex = j\n@@ -238,7 +242,7 @@ Router.prototype._on = function _on (method, path, opts, handler, store) {\n           if (staticPart) {\n             staticPart = staticPart.split('::').join(':')\n             staticPart = staticPart.split('%').join('%25')\n-            regexps.push(escapeRegExp(staticPart))\n+            regexps.push(backtrack = escapeRegExp(staticPart))\n           }\n \n           lastParamStartIndex = j + 1\n@@ -335,6 +339,8 @@ Router.prototype.findRoute = function findNode (method, path, constraints = {})\n \n     if (isParametricNode) {\n       let isRegexNode = false\n+      let isParamSafe = true\n+      let backtrack = ''\n       const regexps = []\n \n       let lastParamStartIndex = i + 1\n@@ -344,6 +350,7 @@ Router.prototype.findRoute = function findNode (method, path, constraints = {})\n         const isRegexParam = charCode === 40\n         const isStaticPart = charCode === 45 || charCode === 46\n         const isEndOfNode = charCode === 47 || j === pattern.length\n+\n         if (isRegexParam || isStaticPart || isEndOfNode) {\n           const paramName = pattern.slice(lastParamStartIndex, j)\n           params.push(paramName)\n@@ -361,8 +368,10 @@ Router.prototype.findRoute = function findNode (method, path, constraints = {})\n             regexps.push(trimRegExpStartAndEnd(regexString))\n \n             j = endOfRegexIndex + 1\n+            isParamSafe = false\n           } else {\n-            regexps.push('(.*?)')\n+            regexps.push(isParamSafe ? '(.*?)' : `(${backtrack}|(?:(?!${backtrack}).)*)`)\n+            isParamSafe = false\n           }\n \n           const staticPartStartIndex = j\n@@ -380,7 +389,7 @@ Router.prototype.findRoute = function findNode (method, path, constraints = {})\n           if (staticPart) {\n             staticPart = staticPart.split('::').join(':')\n             staticPart = staticPart.split('%').join('%25')\n-            regexps.push(escapeRegExp(staticPart))\n+            regexps.push(backtrack = escapeRegExp(staticPart))\n           }\n \n           lastParamStartIndex = j + 1"
            },
            {
                "sha": "55fc64e2dc04e49d530421e75296afd384c9c770",
                "filename": "test/issue-17.test.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/17fae694dcefc056045da201681c1530f0f80518/test%2Fissue-17.test.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/17fae694dcefc056045da201681c1530f0f80518/test%2Fissue-17.test.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/test%2Fissue-17.test.js?ref=17fae694dcefc056045da201681c1530f0f80518",
                "patch": "@@ -132,8 +132,8 @@ test('Multi parametric route / 2', t => {\n   })\n \n   findMyWay.on('GET', '/a/:p1-:p2', (req, res, params) => {\n-    t.equal(params.p1, 'foo')\n-    t.equal(params.p2, 'bar-baz')\n+    t.equal(params.p1, 'foo-bar')\n+    t.equal(params.p2, 'baz')\n   })\n \n   findMyWay.on('GET', '/b/:p1.:p2', (req, res, params) => {"
            },
            {
                "sha": "16650654ff258d8511ac65e645510de693f91313",
                "filename": "test/optional-params.test.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/17fae694dcefc056045da201681c1530f0f80518/test%2Foptional-params.test.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/17fae694dcefc056045da201681c1530f0f80518/test%2Foptional-params.test.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/test%2Foptional-params.test.js?ref=17fae694dcefc056045da201681c1530f0f80518",
                "patch": "@@ -68,8 +68,8 @@ test('Multi parametric route with optional param', (t) => {\n \n   findMyWay.on('GET', '/a/:p1-:p2?', (req, res, params) => {\n     if (params.p1 && params.p2) {\n-      t.equal(params.p1, 'foo')\n-      t.equal(params.p2, 'bar-baz')\n+      t.equal(params.p1, 'foo-bar')\n+      t.equal(params.p2, 'baz')\n     }\n   })\n "
            },
            {
                "sha": "77ffc474b2235a1610e45a46ca8f59d49c108dbc",
                "filename": "test/regex.test.js",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/17fae694dcefc056045da201681c1530f0f80518/test%2Fregex.test.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/17fae694dcefc056045da201681c1530f0f80518/test%2Fregex.test.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/test%2Fregex.test.js?ref=17fae694dcefc056045da201681c1530f0f80518",
                "patch": "@@ -255,3 +255,17 @@ test('Disable safe regex check', t => {\n     }\n   })\n })\n+\n+test('prevent back-tracking', (t) => {\n+  t.plan(0)\n+  t.setTimeout(20)\n+\n+  const findMyWay = FindMyWay({\n+    defaultRoute: () => {\n+      t.fail('route not matched')\n+    }\n+  })\n+\n+  findMyWay.on('GET', '/:foo-:bar-', (req, res, params) => {})\n+  findMyWay.find('GET', '/' + '-'.repeat(16_000) + 'a', { host: 'fastify.io' })\n+})"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/delvedor/find-my-way/commits/5e9e0eb5d8d438e06a185d5e536a896572dd0440",
        "url": "https://api.github.com/repos/delvedor/find-my-way/commits/5e9e0eb5d8d438e06a185d5e536a896572dd0440",
        "html_url": "https://github.com/delvedor/find-my-way/commit/5e9e0eb5d8d438e06a185d5e536a896572dd0440",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "eeee78fcb037b803668a06f87861f310c30bd79c",
                "filename": "index.js",
                "status": "modified",
                "additions": 13,
                "deletions": 4,
                "changes": 17,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/5e9e0eb5d8d438e06a185d5e536a896572dd0440/index.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/5e9e0eb5d8d438e06a185d5e536a896572dd0440/index.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/index.js?ref=5e9e0eb5d8d438e06a185d5e536a896572dd0440",
                "patch": "@@ -192,6 +192,8 @@ Router.prototype._on = function _on (method, path, opts, handler, store) {\n \n     if (isParametricNode) {\n       let isRegexNode = false\n+      let isParamSafe = true\n+      let backtrack = ''\n       const regexps = []\n \n       let lastParamStartIndex = i + 1\n@@ -219,8 +221,10 @@ Router.prototype._on = function _on (method, path, opts, handler, store) {\n             regexps.push(trimRegExpStartAndEnd(regexString))\n \n             j = endOfRegexIndex + 1\n+            isParamSafe = true\n           } else {\n-            regexps.push('(.*?)')\n+            regexps.push(isParamSafe ? '(.*?)' : `(${backtrack}|(?:(?!${backtrack}).)*)`)\n+            isParamSafe = false\n           }\n \n           const staticPartStartIndex = j\n@@ -238,7 +242,7 @@ Router.prototype._on = function _on (method, path, opts, handler, store) {\n           if (staticPart) {\n             staticPart = staticPart.split('::').join(':')\n             staticPart = staticPart.split('%').join('%25')\n-            regexps.push(escapeRegExp(staticPart))\n+            regexps.push(backtrack = escapeRegExp(staticPart))\n           }\n \n           lastParamStartIndex = j + 1\n@@ -335,6 +339,8 @@ Router.prototype.findRoute = function findNode (method, path, constraints = {})\n \n     if (isParametricNode) {\n       let isRegexNode = false\n+      let isParamSafe = true\n+      let backtrack = ''\n       const regexps = []\n \n       let lastParamStartIndex = i + 1\n@@ -344,6 +350,7 @@ Router.prototype.findRoute = function findNode (method, path, constraints = {})\n         const isRegexParam = charCode === 40\n         const isStaticPart = charCode === 45 || charCode === 46\n         const isEndOfNode = charCode === 47 || j === pattern.length\n+\n         if (isRegexParam || isStaticPart || isEndOfNode) {\n           const paramName = pattern.slice(lastParamStartIndex, j)\n           params.push(paramName)\n@@ -361,8 +368,10 @@ Router.prototype.findRoute = function findNode (method, path, constraints = {})\n             regexps.push(trimRegExpStartAndEnd(regexString))\n \n             j = endOfRegexIndex + 1\n+            isParamSafe = false\n           } else {\n-            regexps.push('(.*?)')\n+            regexps.push(isParamSafe ? '(.*?)' : `(${backtrack}|(?:(?!${backtrack}).)*)`)\n+            isParamSafe = false\n           }\n \n           const staticPartStartIndex = j\n@@ -380,7 +389,7 @@ Router.prototype.findRoute = function findNode (method, path, constraints = {})\n           if (staticPart) {\n             staticPart = staticPart.split('::').join(':')\n             staticPart = staticPart.split('%').join('%25')\n-            regexps.push(escapeRegExp(staticPart))\n+            regexps.push(backtrack = escapeRegExp(staticPart))\n           }\n \n           lastParamStartIndex = j + 1"
            },
            {
                "sha": "55fc64e2dc04e49d530421e75296afd384c9c770",
                "filename": "test/issue-17.test.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/5e9e0eb5d8d438e06a185d5e536a896572dd0440/test%2Fissue-17.test.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/5e9e0eb5d8d438e06a185d5e536a896572dd0440/test%2Fissue-17.test.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/test%2Fissue-17.test.js?ref=5e9e0eb5d8d438e06a185d5e536a896572dd0440",
                "patch": "@@ -132,8 +132,8 @@ test('Multi parametric route / 2', t => {\n   })\n \n   findMyWay.on('GET', '/a/:p1-:p2', (req, res, params) => {\n-    t.equal(params.p1, 'foo')\n-    t.equal(params.p2, 'bar-baz')\n+    t.equal(params.p1, 'foo-bar')\n+    t.equal(params.p2, 'baz')\n   })\n \n   findMyWay.on('GET', '/b/:p1.:p2', (req, res, params) => {"
            },
            {
                "sha": "16650654ff258d8511ac65e645510de693f91313",
                "filename": "test/optional-params.test.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/5e9e0eb5d8d438e06a185d5e536a896572dd0440/test%2Foptional-params.test.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/5e9e0eb5d8d438e06a185d5e536a896572dd0440/test%2Foptional-params.test.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/test%2Foptional-params.test.js?ref=5e9e0eb5d8d438e06a185d5e536a896572dd0440",
                "patch": "@@ -68,8 +68,8 @@ test('Multi parametric route with optional param', (t) => {\n \n   findMyWay.on('GET', '/a/:p1-:p2?', (req, res, params) => {\n     if (params.p1 && params.p2) {\n-      t.equal(params.p1, 'foo')\n-      t.equal(params.p2, 'bar-baz')\n+      t.equal(params.p1, 'foo-bar')\n+      t.equal(params.p2, 'baz')\n     }\n   })\n "
            },
            {
                "sha": "77ffc474b2235a1610e45a46ca8f59d49c108dbc",
                "filename": "test/regex.test.js",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/5e9e0eb5d8d438e06a185d5e536a896572dd0440/test%2Fregex.test.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/5e9e0eb5d8d438e06a185d5e536a896572dd0440/test%2Fregex.test.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/test%2Fregex.test.js?ref=5e9e0eb5d8d438e06a185d5e536a896572dd0440",
                "patch": "@@ -255,3 +255,17 @@ test('Disable safe regex check', t => {\n     }\n   })\n })\n+\n+test('prevent back-tracking', (t) => {\n+  t.plan(0)\n+  t.setTimeout(20)\n+\n+  const findMyWay = FindMyWay({\n+    defaultRoute: () => {\n+      t.fail('route not matched')\n+    }\n+  })\n+\n+  findMyWay.on('GET', '/:foo-:bar-', (req, res, params) => {})\n+  findMyWay.find('GET', '/' + '-'.repeat(16_000) + 'a', { host: 'fastify.io' })\n+})"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/delvedor/find-my-way/commits/66fa03923355b8da1db4ba572d66a4fee4a57cf5",
        "url": "https://api.github.com/repos/delvedor/find-my-way/commits/66fa03923355b8da1db4ba572d66a4fee4a57cf5",
        "html_url": "https://github.com/delvedor/find-my-way/commit/66fa03923355b8da1db4ba572d66a4fee4a57cf5",
        "message": "Define insert method for each node type (#248)",
        "files": [
            {
                "sha": "4cfe6e1dcf8568728b6f81272ba09bb797b0dae9",
                "filename": "custom_node.js",
                "status": "modified",
                "additions": 71,
                "deletions": 49,
                "changes": 120,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/66fa03923355b8da1db4ba572d66a4fee4a57cf5/custom_node.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/66fa03923355b8da1db4ba572d66a4fee4a57cf5/custom_node.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/custom_node.js?ref=66fa03923355b8da1db4ba572d66a4fee4a57cf5",
                "patch": "@@ -34,37 +34,6 @@ Object.defineProperty(Node.prototype, 'types', {\n   value: types\n })\n \n-Node.prototype.addChild = function (node) {\n-  const label = node.prefix[0]\n-  switch (node.kind) {\n-    case this.types.STATIC:\n-      assert(\n-        this.staticChildren[label] === undefined,\n-        `There is already a child with label '${label}'`\n-      )\n-      this.staticChildren[label] = node\n-      break\n-    case this.types.PARAM:\n-    case this.types.REGEX:\n-      assert(this.parametricChild === null, 'There is already a parametric child')\n-      this.parametricChild = node\n-      break\n-    case this.types.MATCH_ALL:\n-      assert(this.wildcardChild === null, 'There is already a wildcard child')\n-      this.wildcardChild = node\n-      break\n-    default:\n-      throw new Error(`Unknown node kind: ${node.kind}`)\n-  }\n-\n-  this.numberOfChildren++\n-\n-  this._saveParametricBrother()\n-  this._saveWildcardBrother()\n-\n-  return this\n-}\n-\n Node.prototype._saveParametricBrother = function () {\n   let parametricBrother = this.parametricBrother\n   if (this.parametricChild !== null) {\n@@ -76,7 +45,7 @@ Node.prototype._saveParametricBrother = function () {\n   if (parametricBrother) {\n     for (const child of Object.values(this.staticChildren)) {\n       child.parametricBrother = parametricBrother\n-      child._saveParametricBrother(parametricBrother)\n+      child._saveParametricBrother()\n     }\n   }\n }\n@@ -92,7 +61,7 @@ Node.prototype._saveWildcardBrother = function () {\n   if (wildcardBrother) {\n     for (const child of Object.values(this.staticChildren)) {\n       child.wildcardBrother = wildcardBrother\n-      child._saveWildcardBrother(wildcardBrother)\n+      child._saveWildcardBrother()\n     }\n     if (this.parametricChild !== null) {\n       this.parametricChild.wildcardBrother = wildcardBrother\n@@ -116,7 +85,7 @@ Node.prototype.reset = function (prefix) {\n }\n \n Node.prototype.split = function (length) {\n-  const newChild = new Node(\n+  const staticChild = new Node(\n     {\n       prefix: this.prefix.slice(length),\n       staticChildren: this.staticChildren,\n@@ -131,32 +100,85 @@ Node.prototype.split = function (length) {\n   )\n \n   if (this.wildcardChild !== null) {\n-    newChild.wildcardChild = this.wildcardChild\n+    staticChild.wildcardChild = this.wildcardChild\n   }\n \n   if (this.parametricChild !== null) {\n-    newChild.parametricChild = this.parametricChild\n+    staticChild.parametricChild = this.parametricChild\n   }\n \n   this.reset(this.prefix.slice(0, length))\n-  this.addChild(newChild)\n-  return newChild\n+\n+  const label = staticChild.prefix.charAt(0)\n+  this.staticChildren[label] = staticChild\n+\n+  this.numberOfChildren++\n+\n+  this._saveParametricBrother()\n+  this._saveWildcardBrother()\n+\n+  return staticChild\n }\n \n-Node.prototype.getChildByLabel = function (label, kind) {\n-  if (label.length === 0) {\n-    return null\n+Node.prototype.insertStaticNode = function (path) {\n+  if (path.length === 0) {\n+    return this\n   }\n \n-  switch (kind) {\n-    case this.types.STATIC:\n-      return this.staticChildren[label]\n-    case this.types.MATCH_ALL:\n-      return this.wildcardChild\n-    case this.types.PARAM:\n-    case this.types.REGEX:\n-      return this.parametricChild\n+  let staticChild = this.staticChildren[path.charAt(0)]\n+  if (staticChild) {\n+    let i = 0\n+    for (; i < staticChild.prefix.length; i++) {\n+      if (path.charCodeAt(i) !== staticChild.prefix.charCodeAt(i)) {\n+        staticChild.split(i)\n+        break\n+      }\n+    }\n+    return staticChild.insertStaticNode(path.slice(i))\n   }\n+\n+  staticChild = new Node({ method: this.method, prefix: path, kind: types.STATIC, constrainer: this.constrainer })\n+\n+  const label = path.charAt(0)\n+  this.staticChildren[label] = staticChild\n+  this.numberOfChildren++\n+\n+  this._saveParametricBrother()\n+  this._saveWildcardBrother()\n+\n+  return staticChild\n+}\n+\n+Node.prototype.insertParametricNode = function (regex) {\n+  if (this.parametricChild) {\n+    return this.parametricChild\n+  }\n+\n+  const kind = regex ? types.REGEX : types.PARAM\n+  const parametricChild = new Node({ method: this.method, prefix: ':', kind, regex, constrainer: this.constrainer })\n+\n+  this.parametricChild = parametricChild\n+  this.numberOfChildren++\n+\n+  this._saveParametricBrother()\n+  this._saveWildcardBrother()\n+\n+  return parametricChild\n+}\n+\n+Node.prototype.insertWildcardNode = function () {\n+  if (this.wildcardChild) {\n+    return this.wildcardChild\n+  }\n+\n+  const wildcardChild = new Node({ method: this.method, prefix: '*', kind: types.MATCH_ALL, constrainer: this.constrainer })\n+\n+  this.wildcardChild = wildcardChild\n+  this.numberOfChildren++\n+\n+  this._saveWildcardBrother()\n+\n+  return wildcardChild\n }\n \n Node.prototype.findStaticMatchingChild = function (path, pathIndex) {"
            },
            {
                "sha": "3630676750abe245eed76eff9bc112c106c0642c",
                "filename": "index.js",
                "status": "modified",
                "additions": 26,
                "deletions": 54,
                "changes": 80,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/66fa03923355b8da1db4ba572d66a4fee4a57cf5/index.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/66fa03923355b8da1db4ba572d66a4fee4a57cf5/index.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/index.js?ref=66fa03923355b8da1db4ba572d66a4fee4a57cf5",
                "patch": "@@ -166,29 +166,34 @@ Router.prototype._on = function _on (method, path, opts, handler, store) {\n \n   const params = []\n   for (let i = 0; i <= path.length; i++) {\n-    // search for parametric or wildcard routes\n-    // parametric route\n-    if (path.charCodeAt(i) === 58) {\n-      if (path.charCodeAt(i + 1) === 58) {\n-        // It's a double colon. Let's just replace it with a single colon and go ahead\n-        path = path.slice(0, i) + path.slice(i + 1)\n-        continue\n-      }\n+    if (path.charCodeAt(i) === 58 && path.charCodeAt(i + 1) === 58) {\n+      // It's a double colon. Let's just replace it with a single colon and go ahead\n+      path = path.slice(0, i) + path.slice(i + 1)\n+      continue\n+    }\n \n-      // add the static part of the route to the tree\n-      currentNode = this._insert(currentNode, method, path.slice(parentNodePathIndex, i), NODE_TYPES.STATIC, null)\n+    const isParametricNode = path.charCodeAt(i) === 58\n+    const isWildcardNode = path.charCodeAt(i) === 42\n \n-      const paramStartIndex = i + 1\n+    if (isParametricNode || isWildcardNode || (i === path.length && i !== parentNodePathIndex)) {\n+      let staticNodePath = path.slice(parentNodePathIndex, i)\n+      if (!this.caseSensitive) {\n+        staticNodePath = staticNodePath.toLowerCase()\n+      }\n+      // add the static part of the route to the tree\n+      currentNode = currentNode.insertStaticNode(staticNodePath)\n+    }\n \n+    if (isParametricNode) {\n+      let isRegexNode = false\n       const regexps = []\n-      let nodeType = NODE_TYPES.PARAM\n-      let lastParamStartIndex = paramStartIndex\n \n-      for (let j = paramStartIndex; ; j++) {\n+      let lastParamStartIndex = i + 1\n+      for (let j = lastParamStartIndex; ; j++) {\n         const charCode = path.charCodeAt(j)\n \n         if (charCode === 40 || charCode === 45 || charCode === 46) {\n-          nodeType = NODE_TYPES.REGEX\n+          isRegexNode = true\n \n           const paramName = path.slice(lastParamStartIndex, j)\n           params.push(paramName)\n@@ -233,63 +238,30 @@ Router.prototype._on = function _on (method, path, opts, handler, store) {\n         }\n \n         if (path.charCodeAt(j) === 47 || j === path.length) {\n-          path = path.slice(0, paramStartIndex) + path.slice(j)\n+          path = path.slice(0, i + 1) + path.slice(j)\n           break\n         }\n       }\n \n       let regex = null\n-      if (nodeType === NODE_TYPES.REGEX) {\n+      if (isRegexNode) {\n         regex = new RegExp('^' + regexps.join('') + '$')\n       }\n \n-      currentNode = this._insert(currentNode, method, ':', nodeType, regex)\n+      currentNode = currentNode.insertParametricNode(regex)\n       parentNodePathIndex = i + 1\n-    // wildcard route\n-    } else if (path.charCodeAt(i) === 42) {\n-      currentNode = this._insert(currentNode, method, path.slice(parentNodePathIndex, i), NODE_TYPES.STATIC, null)\n+    } else if (isWildcardNode) {\n       // add the wildcard parameter\n       params.push('*')\n-      currentNode = this._insert(currentNode, method, path.slice(i), NODE_TYPES.MATCH_ALL, null)\n-      break\n-    } else if (i === path.length && i !== parentNodePathIndex) {\n-      currentNode = this._insert(currentNode, method, path.slice(parentNodePathIndex), NODE_TYPES.STATIC, null)\n+      currentNode = currentNode.insertWildcardNode()\n+      parentNodePathIndex = i + 1\n     }\n   }\n \n   assert(!currentNode.getHandler(constraints), `Method '${method}' already declared for route '${path}' with constraints '${JSON.stringify(constraints)}'`)\n   currentNode.addHandler(handler, params, store, constraints)\n }\n \n-Router.prototype._insert = function _insert (currentNode, method, path, kind, regex) {\n-  if (!this.caseSensitive) {\n-    path = path.toLowerCase()\n-  }\n-\n-  let childNode = currentNode.getChildByLabel(path.charAt(0), kind)\n-  while (childNode) {\n-    currentNode = childNode\n-\n-    let i = 0\n-    for (; i < currentNode.prefix.length; i++) {\n-      if (path.charCodeAt(i) !== currentNode.prefix.charCodeAt(i)) {\n-        currentNode.split(i)\n-        break\n-      }\n-    }\n-    path = path.slice(i)\n-    childNode = currentNode.getChildByLabel(path.charAt(0), kind)\n-  }\n-\n-  if (path.length > 0) {\n-    const node = new Node({ method, prefix: path, kind, handlers: null, regex, constrainer: this.constrainer })\n-    currentNode.addChild(node)\n-    currentNode = node\n-  }\n-\n-  return currentNode\n-}\n-\n Router.prototype.reset = function reset () {\n   this.trees = {}\n   this.routes = []"
            },
            {
                "sha": "76e4d6673412c86688a2511282029ba4ce12549e",
                "filename": "test/issue-104.test.js",
                "status": "modified",
                "additions": 3,
                "deletions": 6,
                "changes": 9,
                "blob_url": "https://github.com/delvedor/find-my-way/blob/66fa03923355b8da1db4ba572d66a4fee4a57cf5/test%2Fissue-104.test.js",
                "raw_url": "https://github.com/delvedor/find-my-way/raw/66fa03923355b8da1db4ba572d66a4fee4a57cf5/test%2Fissue-104.test.js",
                "contents_url": "https://api.github.com/repos/delvedor/find-my-way/contents/test%2Fissue-104.test.js?ref=66fa03923355b8da1db4ba572d66a4fee4a57cf5",
                "patch": "@@ -210,17 +210,14 @@ test('Mixed parametric routes, with last defined route being static', t => {\n test('parametricBrother of Parent Node, with a parametric child', t => {\n   t.plan(1)\n   const parent = new Node({ prefix: '/a' })\n-  const parametricChild = new Node({ prefix: ':id', kind: parent.types.PARAM })\n-  parent.addChild(parametricChild)\n+  parent.insertParametricNode()\n   t.equal(parent.parametricBrother, null)\n })\n \n test('parametricBrother of Parent Node, with a parametric child and a static child', t => {\n   t.plan(1)\n   const parent = new Node({ prefix: '/a' })\n-  const parametricChild = new Node({ prefix: ':id', kind: parent.types.PARAM })\n-  const staticChild = new Node({ prefix: '/b', kind: parent.types.STATIC })\n-  parent.addChild(parametricChild)\n-  parent.addChild(staticChild)\n+  parent.insertParametricNode()\n+  parent.insertStaticNode('/b')\n   t.equal(parent.parametricBrother, null)\n })"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/2cc4af975fe01c264d439acc1451c936e7114644",
        "url": "https://api.github.com/repos/mautic/mautic/commits/2cc4af975fe01c264d439acc1451c936e7114644",
        "html_url": "https://github.com/mautic/mautic/commit/2cc4af975fe01c264d439acc1451c936e7114644",
        "message": "Merge pull request from GHSA-qjx3-2g35-6hv8\n\n* add new twigfunction to sanitize attributes tags\n\n* back to old version 5.x\n\n* - Edited permissions to deny invalid access.\n- tests\n\n* - fix permission\n- add tests\n\n* - fix permission\n- add tests\n\n* - change getUserIdentifier to getUsername\n\n* - fix phpstan\n\n* - fixcs\n\n* remove extra line.\n\n* - removing comment\n\n* - take out import permission\n\n* - change permission parameters from lead to user data\n\n* - change permission parameters from lead to user data\n\n* CS fix\n\n---------\n\nCo-authored-by: lenonleite <lenonleite@github.com>\nCo-authored-by: lenonleite <lenonleite@cience.com>\nCo-authored-by: John Linhart <jan@linhart.email>",
        "files": [
            {
                "sha": "b11c71396db58c0755cd1671b9ca31cade12edca",
                "filename": "app/bundles/LeadBundle/Controller/CompanyController.php",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/mautic/mautic/blob/2cc4af975fe01c264d439acc1451c936e7114644/app%2Fbundles%2FLeadBundle%2FController%2FCompanyController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/2cc4af975fe01c264d439acc1451c936e7114644/app%2Fbundles%2FLeadBundle%2FController%2FCompanyController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FController%2FCompanyController.php?ref=2cc4af975fe01c264d439acc1451c936e7114644",
                "patch": "@@ -132,7 +132,6 @@ public function contactsListAction(Request $request, $objectId, $page = 1)\n             return $this->accessDenied();\n         }\n \n-        // set some permissions\n         $permissions = $this->security->isGranted(\n             [\n                 'lead:leads:viewown',\n@@ -820,13 +819,19 @@ public function mergeAction(Request $request, $objectId)\n         // set some permissions\n         $permissions = $this->security->isGranted(\n             [\n+                'lead:leads:viewown',\n                 'lead:leads:viewother',\n                 'lead:leads:create',\n                 'lead:leads:editother',\n                 'lead:leads:deleteother',\n             ],\n             'RETURN_ARRAY'\n         );\n+\n+        if (!$permissions['lead:leads:viewown'] && !$permissions['lead:leads:viewother']) {\n+            return $this->accessDenied();\n+        }\n+\n         /** @var CompanyModel $model */\n         $model            = $this->getModel('lead.company');\n         $secondaryCompany = $model->getEntity($objectId);"
            },
            {
                "sha": "6e017f25aa36013f399df1e6fb17748d6dab1f21",
                "filename": "app/bundles/LeadBundle/Controller/LeadController.php",
                "status": "modified",
                "additions": 25,
                "deletions": 0,
                "changes": 25,
                "blob_url": "https://github.com/mautic/mautic/blob/2cc4af975fe01c264d439acc1451c936e7114644/app%2Fbundles%2FLeadBundle%2FController%2FLeadController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/2cc4af975fe01c264d439acc1451c936e7114644/app%2Fbundles%2FLeadBundle%2FController%2FLeadController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FController%2FLeadController.php?ref=2cc4af975fe01c264d439acc1451c936e7114644",
                "patch": "@@ -231,6 +231,27 @@ public function indexAction(\n \n     public function quickAddAction(Request $request): Response\n     {\n+        // set some permissions\n+        $permissions = $this->security->isGranted(\n+            [\n+                'lead:leads:viewown',\n+                'lead:leads:viewother',\n+                'lead:leads:create',\n+                'lead:leads:editown',\n+                'lead:leads:editother',\n+            ],\n+            'RETURN_ARRAY'\n+        );\n+\n+        if (\n+            !$permissions['lead:leads:viewown']\n+            && !$permissions['lead:leads:viewother']\n+            && !$permissions['lead:leads:create']\n+            && !$permissions['lead:leads:editown']\n+            && !$permissions['lead:leads:editother']\n+        ) {\n+            return $this->accessDenied();\n+        }\n         /** @var \\Mautic\\LeadBundle\\Model\\LeadModel $model */\n         $model = $this->getModel('lead.lead');\n \n@@ -1838,6 +1859,10 @@ public function batchStagesAction(Request $request, $objectId = 0)\n      */\n     public function batchOwnersAction(Request $request, $objectId = 0)\n     {\n+        if (!$this->security->isGranted('user:users:view')) {\n+            return $this->accessDenied();\n+        }\n+\n         if ('POST' == $request->getMethod()) {\n             /** @var \\Mautic\\LeadBundle\\Model\\LeadModel $model */\n             $model = $this->getModel('lead');"
            },
            {
                "sha": "22e600e58b9e278ad457f3d000491e2e78ebf84c",
                "filename": "app/bundles/LeadBundle/Tests/Functional/Controller/CompanyControllerTest.php",
                "status": "added",
                "additions": 71,
                "deletions": 0,
                "changes": 71,
                "blob_url": "https://github.com/mautic/mautic/blob/2cc4af975fe01c264d439acc1451c936e7114644/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FCompanyControllerTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/2cc4af975fe01c264d439acc1451c936e7114644/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FCompanyControllerTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FCompanyControllerTest.php?ref=2cc4af975fe01c264d439acc1451c936e7114644",
                "patch": "@@ -0,0 +1,71 @@\n+<?php\n+\n+namespace Mautic\\LeadBundle\\Tests\\Functional\\Controller;\n+\n+use Mautic\\CoreBundle\\Test\\MauticMysqlTestCase;\n+use Mautic\\UserBundle\\Entity\\Role;\n+use Mautic\\UserBundle\\Entity\\User;\n+\n+class CompanyControllerTest extends MauticMysqlTestCase\n+{\n+    public const USERNAME = 'jhony';\n+\n+    public function testMergeAction(): void\n+    {\n+        $this->client->request('GET', '/s/companies/merge/1');\n+        $clientResponse         = $this->client->getResponse();\n+        $this->assertEquals(200, $clientResponse->getStatusCode());\n+    }\n+\n+    public function testMergeActionWithoutPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request('GET', '/s/companies/merge/1');\n+        $clientResponse         = $this->client->getResponse();\n+        $this->assertEquals(403, $clientResponse->getStatusCode());\n+    }\n+\n+    private function createAndLoginUser(): User\n+    {\n+        // Create non-admin role\n+        $role = $this->createRole();\n+        // Create non-admin user\n+        $user = $this->createUser($role);\n+\n+        $this->em->flush();\n+        $this->em->detach($role);\n+\n+        $this->loginUser(self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_USER', self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+\n+        return $user;\n+    }\n+\n+    private function createRole(bool $isAdmin = false): Role\n+    {\n+        $role = new Role();\n+        $role->setName('Role');\n+        $role->setIsAdmin($isAdmin);\n+\n+        $this->em->persist($role);\n+\n+        return $role;\n+    }\n+\n+    private function createUser(Role $role): User\n+    {\n+        $user = new User();\n+        $user->setFirstName('Jhony');\n+        $user->setLastName('Doe');\n+        $user->setUsername(self::USERNAME);\n+        $user->setEmail('john.doe@email.com');\n+        $encoder = self::$container->get('security.encoder_factory')->getEncoder($user);\n+        $user->setPassword($encoder->encodePassword('mautic', null));\n+        $user->setRole($role);\n+\n+        $this->em->persist($user);\n+\n+        return $user;\n+    }\n+}"
            },
            {
                "sha": "4af27e3e550d0a1bfdef2719998915e9b3586328",
                "filename": "app/bundles/LeadBundle/Tests/Functional/Controller/LeadControllerTest.php",
                "status": "modified",
                "additions": 82,
                "deletions": 0,
                "changes": 82,
                "blob_url": "https://github.com/mautic/mautic/blob/2cc4af975fe01c264d439acc1451c936e7114644/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FLeadControllerTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/2cc4af975fe01c264d439acc1451c936e7114644/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FLeadControllerTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FLeadControllerTest.php?ref=2cc4af975fe01c264d439acc1451c936e7114644",
                "patch": "@@ -9,12 +9,15 @@\n use Mautic\\LeadBundle\\Command\\ContactScheduledExportCommand;\n use Mautic\\LeadBundle\\Entity\\ContactExportScheduler;\n use Mautic\\LeadBundle\\Entity\\Lead;\n+use Mautic\\UserBundle\\Entity\\Role;\n+use Mautic\\UserBundle\\Entity\\User;\n use PHPUnit\\Framework\\Assert;\n use Symfony\\Component\\HttpFoundation\\Request;\n use Symfony\\Component\\Routing\\Generator\\UrlGeneratorInterface;\n \n class LeadControllerTest extends MauticMysqlTestCase\n {\n+    public const USERNAME = 'jhony';\n     /**\n      * @var array<string>\n      */\n@@ -101,4 +104,83 @@ private function checkContactExportScheduler(int $count): array\n \n         return $allRows;\n     }\n+\n+    public function testAccessContactQuickAddWithPermission(): void\n+    {\n+        $this->setAdminUser();\n+        $this->client->request(Request::METHOD_GET, '/s/contacts/quickAdd');\n+        $this->assertResponseStatusCodeSame(200, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    private function setAdminUser(): void\n+    {\n+        $this->loginUser('admin');\n+        $this->client->setServerParameter('PHP_AUTH_USER', 'admin');\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+    }\n+\n+    public function testAccessContactQuickAddWithNoPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request(Request::METHOD_GET, '/s/contacts/quickAdd');\n+        $this->assertResponseStatusCodeSame(403, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    public function testAccessContactBatchOwnersNoPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request(Request::METHOD_GET, '/s/contacts/batchOwners');\n+        $this->assertResponseStatusCodeSame(403, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    public function testAccessContactBatchOwnersPermission(): void\n+    {\n+        $this->setAdminUser();\n+        $this->client->request(Request::METHOD_GET, '/s/contacts/batchOwners');\n+        $this->assertResponseStatusCodeSame(200, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    private function createAndLoginUser(): User\n+    {\n+        // Create non-admin role\n+        $role = $this->createRole();\n+        // Create non-admin user\n+        $user = $this->createUser($role);\n+\n+        $this->em->flush();\n+        $this->em->detach($role);\n+\n+        $this->loginUser(self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_USER', self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+\n+        return $user;\n+    }\n+\n+    private function createRole(bool $isAdmin = false): Role\n+    {\n+        $role = new Role();\n+        $role->setName('Role');\n+        $role->setIsAdmin($isAdmin);\n+\n+        $this->em->persist($role);\n+\n+        return $role;\n+    }\n+\n+    private function createUser(Role $role): User\n+    {\n+        $user = new User();\n+        $user->setFirstName('Jhony');\n+        $user->setLastName('Doe');\n+        $user->setUsername(self::USERNAME);\n+        $user->setEmail('john.doe@email.com');\n+        $encoder = self::$container->get('security.encoder_factory')->getEncoder($user);\n+        $user->setPassword($encoder->encodePassword('mautic', null));\n+        $user->setRole($role);\n+\n+        $this->em->persist($user);\n+\n+        return $user;\n+    }\n }"
            },
            {
                "sha": "0f3ae04a201ce2e3017142c34b98fd129993e81a",
                "filename": "plugins/MauticSocialBundle/Controller/MonitoringController.php",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/mautic/mautic/blob/2cc4af975fe01c264d439acc1451c936e7114644/plugins%2FMauticSocialBundle%2FController%2FMonitoringController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/2cc4af975fe01c264d439acc1451c936e7114644/plugins%2FMauticSocialBundle%2FController%2FMonitoringController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/plugins%2FMauticSocialBundle%2FController%2FMonitoringController.php?ref=2cc4af975fe01c264d439acc1451c936e7114644",
                "patch": "@@ -24,6 +24,10 @@ class MonitoringController extends FormController\n      */\n     public function indexAction(Request $request, MonitoringModel $model, $page = 1)\n     {\n+        if (!$this->security->isGranted('mauticSocial:monitoring:view')) {\n+            return $this->accessDenied();\n+        }\n+\n         $session = $request->getSession();\n \n         $this->setListFilters();"
            },
            {
                "sha": "796abbea47e38c3da23fa81232c2caf2320a71de",
                "filename": "plugins/MauticSocialBundle/Tests/Functional/Controller/MonitoringControllerTest.php",
                "status": "added",
                "additions": 101,
                "deletions": 0,
                "changes": 101,
                "blob_url": "https://github.com/mautic/mautic/blob/2cc4af975fe01c264d439acc1451c936e7114644/plugins%2FMauticSocialBundle%2FTests%2FFunctional%2FController%2FMonitoringControllerTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/2cc4af975fe01c264d439acc1451c936e7114644/plugins%2FMauticSocialBundle%2FTests%2FFunctional%2FController%2FMonitoringControllerTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/plugins%2FMauticSocialBundle%2FTests%2FFunctional%2FController%2FMonitoringControllerTest.php?ref=2cc4af975fe01c264d439acc1451c936e7114644",
                "patch": "@@ -0,0 +1,101 @@\n+<?php\n+\n+namespace MauticPlugin\\MauticSocialBundle\\Tests\\Functional\\Controller;\n+\n+use Mautic\\CoreBundle\\Test\\MauticMysqlTestCase;\n+use Mautic\\UserBundle\\Entity\\Role;\n+use Mautic\\UserBundle\\Entity\\User;\n+\n+class MonitoringControllerTest extends MauticMysqlTestCase\n+{\n+    public const USERNAME = 'jhony';\n+\n+    public function testIndex(): void\n+    {\n+        $this->client->request('GET', '/s/monitoring');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(200, $response->getStatusCode());\n+    }\n+\n+    public function testNew(): void\n+    {\n+        $this->client->request('GET', '/s/monitoring/new');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(200, $response->getStatusCode());\n+    }\n+\n+    public function testEdit(): void\n+    {\n+        $this->client->request('GET', '/s/monitoring/edit/1');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(200, $response->getStatusCode());\n+    }\n+\n+    public function testIndexWithoutPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request('GET', '/s/monitoring');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(403, $response->getStatusCode());\n+    }\n+\n+    public function testNewWithoutPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request('GET', '/s/monitoring/new');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(403, $response->getStatusCode());\n+    }\n+\n+    public function testEditWithoutPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request('GET', '/s/monitoring/edit/1');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(403, $response->getStatusCode());\n+    }\n+\n+    private function createAndLoginUser(): User\n+    {\n+        // Create non-admin role\n+        $role = $this->createRole();\n+        // Create non-admin user\n+        $user = $this->createUser($role);\n+\n+        $this->em->flush();\n+        $this->em->detach($role);\n+\n+        $this->loginUser(self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_USER', self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+\n+        return $user;\n+    }\n+\n+    private function createRole(bool $isAdmin = false): Role\n+    {\n+        $role = new Role();\n+        $role->setName('Role');\n+        $role->setIsAdmin($isAdmin);\n+\n+        $this->em->persist($role);\n+\n+        return $role;\n+    }\n+\n+    private function createUser(Role $role): User\n+    {\n+        $user = new User();\n+        $user->setFirstName('John');\n+        $user->setLastName('Doe');\n+        $user->setUsername(self::USERNAME);\n+        $user->setEmail('john.doe@email.com');\n+        $encoder = self::$container->get('security.encoder_factory')->getEncoder($user);\n+        $user->setPassword($encoder->encodePassword('mautic', null));\n+        $user->setRole($role);\n+\n+        $this->em->persist($user);\n+\n+        return $user;\n+    }\n+}"
            },
            {
                "sha": "c046572f0a8fa01b55b7de7f3634fa4c091b11d1",
                "filename": "plugins/MauticTagManagerBundle/Controller/TagController.php",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/mautic/mautic/blob/2cc4af975fe01c264d439acc1451c936e7114644/plugins%2FMauticTagManagerBundle%2FController%2FTagController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/2cc4af975fe01c264d439acc1451c936e7114644/plugins%2FMauticTagManagerBundle%2FController%2FTagController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/plugins%2FMauticTagManagerBundle%2FController%2FTagController.php?ref=2cc4af975fe01c264d439acc1451c936e7114644",
                "patch": "@@ -238,6 +238,10 @@ public function newAction(Request $request)\n      */\n     public function editAction(Request $request, $objectId, $ignorePost = false)\n     {\n+        if (!$this->security->isGranted('tagManager:tagManager:edit')) {\n+            return $this->accessDenied();\n+        }\n+\n         $postActionVars = $this->getPostActionVars($request, $objectId);\n \n         try {"
            },
            {
                "sha": "e0998b21aca1042bd32e4e3aad624ebf1cfb5ef8",
                "filename": "plugins/MauticTagManagerBundle/Tests/Functional/Controller/TagControllerTest.php",
                "status": "modified",
                "additions": 55,
                "deletions": 0,
                "changes": 55,
                "blob_url": "https://github.com/mautic/mautic/blob/2cc4af975fe01c264d439acc1451c936e7114644/plugins%2FMauticTagManagerBundle%2FTests%2FFunctional%2FController%2FTagControllerTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/2cc4af975fe01c264d439acc1451c936e7114644/plugins%2FMauticTagManagerBundle%2FTests%2FFunctional%2FController%2FTagControllerTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/plugins%2FMauticTagManagerBundle%2FTests%2FFunctional%2FController%2FTagControllerTest.php?ref=2cc4af975fe01c264d439acc1451c936e7114644",
                "patch": "@@ -8,11 +8,14 @@\n use Mautic\\LeadBundle\\Entity\\Tag;\n use Mautic\\LeadBundle\\Entity\\TagRepository;\n use Mautic\\LeadBundle\\Model\\TagModel;\n+use Mautic\\UserBundle\\Entity\\Role;\n+use Mautic\\UserBundle\\Entity\\User;\n use PHPUnit\\Framework\\Assert;\n use Symfony\\Component\\HttpFoundation\\Request;\n \n class TagControllerTest extends MauticMysqlTestCase\n {\n+    public const USERNAME = 'jhony';\n     /**\n      * @var TagRepository\n      */\n@@ -181,4 +184,56 @@ public function testEmptyTagShouldThrowValidationError(): void\n         Assert::assertTrue($this->client->getResponse()->isOk());\n         Assert::assertStringContainsString('A value is required.', $this->client->getResponse()->getContent());\n     }\n+\n+    public function testEditTagWithNoPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $tag     = $this->tagRepository->findOneBy([]);\n+        $this->client->request(Request::METHOD_GET, '/s/tags/edit/'.$tag->getId());\n+        $this->assertResponseStatusCodeSame(403, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    private function createAndLoginUser(): User\n+    {\n+        // Create non-admin role\n+        $role = $this->createRole();\n+        // Create non-admin user\n+        $user = $this->createUser($role);\n+\n+        $this->em->flush();\n+        $this->em->detach($role);\n+\n+        $this->loginUser(self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_USER', self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+\n+        return $user;\n+    }\n+\n+    private function createRole(bool $isAdmin = false): Role\n+    {\n+        $role = new Role();\n+        $role->setName('Role');\n+        $role->setIsAdmin($isAdmin);\n+\n+        $this->em->persist($role);\n+\n+        return $role;\n+    }\n+\n+    private function createUser(Role $role): User\n+    {\n+        $user = new User();\n+        $user->setFirstName('Jhon');\n+        $user->setLastName('Doe');\n+        $user->setUsername(self::USERNAME);\n+        $user->setEmail('john.doe@email.com');\n+        $encoder = self::$container->get('security.encoder_factory')->getEncoder($user);\n+        $user->setPassword($encoder->encodePassword('mautic', null));\n+        $user->setRole($role);\n+\n+        $this->em->persist($user);\n+\n+        return $user;\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/22bdd0796ca6e1e985708b89ad5c07147630fecd",
        "url": "https://api.github.com/repos/mautic/mautic/commits/22bdd0796ca6e1e985708b89ad5c07147630fecd",
        "html_url": "https://github.com/mautic/mautic/commit/22bdd0796ca6e1e985708b89ad5c07147630fecd",
        "message": "Merge pull request from GHSA-qjx3-2g35-6hv8\n\n* - included new permission to denied unauthorized access\n- included functional tests\n\n* - take out import permission\n\n* - change permission parameters from lead to user data\n\n* - change permission parameters from lead to user data\n\n---------\n\nCo-authored-by: Lenon Leite <lenonleite@gmail.com>\nCo-authored-by: lenonleite <lenonleite@github.com>\nCo-authored-by: lenonleite <lenonleite@cience.com>",
        "files": [
            {
                "sha": "6205ac8c39438dff8ba388619a8df043b15e18ba",
                "filename": "app/bundles/LeadBundle/Controller/CompanyController.php",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/mautic/mautic/blob/22bdd0796ca6e1e985708b89ad5c07147630fecd/app%2Fbundles%2FLeadBundle%2FController%2FCompanyController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/22bdd0796ca6e1e985708b89ad5c07147630fecd/app%2Fbundles%2FLeadBundle%2FController%2FCompanyController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FController%2FCompanyController.php?ref=22bdd0796ca6e1e985708b89ad5c07147630fecd",
                "patch": "@@ -818,13 +818,19 @@ public function mergeAction($objectId)\n         //set some permissions\n         $permissions = $this->get('mautic.security')->isGranted(\n             [\n+                'lead:leads:viewown',\n                 'lead:leads:viewother',\n                 'lead:leads:create',\n                 'lead:leads:editother',\n                 'lead:leads:deleteother',\n             ],\n             'RETURN_ARRAY'\n         );\n+\n+        if (!$permissions['lead:leads:viewown'] && !$permissions['lead:leads:viewother']) {\n+            return $this->accessDenied();\n+        }\n+\n         /** @var CompanyModel $model */\n         $model            = $this->getModel('lead.company');\n         $secondaryCompany = $model->getEntity($objectId);"
            },
            {
                "sha": "b68427e24eafae65279101b96ef8c03f23d8512c",
                "filename": "app/bundles/LeadBundle/Controller/LeadController.php",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/mautic/mautic/blob/22bdd0796ca6e1e985708b89ad5c07147630fecd/app%2Fbundles%2FLeadBundle%2FController%2FLeadController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/22bdd0796ca6e1e985708b89ad5c07147630fecd/app%2Fbundles%2FLeadBundle%2FController%2FLeadController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FController%2FLeadController.php?ref=22bdd0796ca6e1e985708b89ad5c07147630fecd",
                "patch": "@@ -208,6 +208,28 @@ public function indexAction($page = 1)\n      */\n     public function quickAddAction()\n     {\n+        // set some permissions\n+        $permissions = $this->get('mautic.security')->isGranted(\n+            [\n+                'lead:leads:viewown',\n+                'lead:leads:viewother',\n+                'lead:leads:create',\n+                'lead:leads:editown',\n+                'lead:leads:editother',\n+            ],\n+            'RETURN_ARRAY'\n+        );\n+\n+        if (\n+            !$permissions['lead:leads:viewown']\n+            && !$permissions['lead:leads:viewother']\n+            && !$permissions['lead:leads:create']\n+            && !$permissions['lead:leads:editown']\n+            && !$permissions['lead:leads:editother']\n+        ) {\n+            return $this->accessDenied();\n+        }\n+\n         /** @var \\Mautic\\LeadBundle\\Model\\LeadModel $model */\n         $model = $this->getModel('lead.lead');\n \n@@ -1831,6 +1853,10 @@ public function batchStagesAction($objectId = 0)\n      */\n     public function batchOwnersAction($objectId = 0)\n     {\n+        if (!$this->get('mautic.security')->isGranted('user:users:view')) {\n+            return $this->accessDenied();\n+        }\n+\n         if ('POST' == $this->request->getMethod()) {\n             /** @var \\Mautic\\LeadBundle\\Model\\LeadModel $model */\n             $model = $this->getModel('lead');"
            },
            {
                "sha": "22e600e58b9e278ad457f3d000491e2e78ebf84c",
                "filename": "app/bundles/LeadBundle/Tests/Functional/Controller/CompanyControllerTest.php",
                "status": "added",
                "additions": 71,
                "deletions": 0,
                "changes": 71,
                "blob_url": "https://github.com/mautic/mautic/blob/22bdd0796ca6e1e985708b89ad5c07147630fecd/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FCompanyControllerTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/22bdd0796ca6e1e985708b89ad5c07147630fecd/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FCompanyControllerTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FCompanyControllerTest.php?ref=22bdd0796ca6e1e985708b89ad5c07147630fecd",
                "patch": "@@ -0,0 +1,71 @@\n+<?php\n+\n+namespace Mautic\\LeadBundle\\Tests\\Functional\\Controller;\n+\n+use Mautic\\CoreBundle\\Test\\MauticMysqlTestCase;\n+use Mautic\\UserBundle\\Entity\\Role;\n+use Mautic\\UserBundle\\Entity\\User;\n+\n+class CompanyControllerTest extends MauticMysqlTestCase\n+{\n+    public const USERNAME = 'jhony';\n+\n+    public function testMergeAction(): void\n+    {\n+        $this->client->request('GET', '/s/companies/merge/1');\n+        $clientResponse         = $this->client->getResponse();\n+        $this->assertEquals(200, $clientResponse->getStatusCode());\n+    }\n+\n+    public function testMergeActionWithoutPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request('GET', '/s/companies/merge/1');\n+        $clientResponse         = $this->client->getResponse();\n+        $this->assertEquals(403, $clientResponse->getStatusCode());\n+    }\n+\n+    private function createAndLoginUser(): User\n+    {\n+        // Create non-admin role\n+        $role = $this->createRole();\n+        // Create non-admin user\n+        $user = $this->createUser($role);\n+\n+        $this->em->flush();\n+        $this->em->detach($role);\n+\n+        $this->loginUser(self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_USER', self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+\n+        return $user;\n+    }\n+\n+    private function createRole(bool $isAdmin = false): Role\n+    {\n+        $role = new Role();\n+        $role->setName('Role');\n+        $role->setIsAdmin($isAdmin);\n+\n+        $this->em->persist($role);\n+\n+        return $role;\n+    }\n+\n+    private function createUser(Role $role): User\n+    {\n+        $user = new User();\n+        $user->setFirstName('Jhony');\n+        $user->setLastName('Doe');\n+        $user->setUsername(self::USERNAME);\n+        $user->setEmail('john.doe@email.com');\n+        $encoder = self::$container->get('security.encoder_factory')->getEncoder($user);\n+        $user->setPassword($encoder->encodePassword('mautic', null));\n+        $user->setRole($role);\n+\n+        $this->em->persist($user);\n+\n+        return $user;\n+    }\n+}"
            },
            {
                "sha": "6fa2cc251f88fbedb8f50333b70431b337615e5a",
                "filename": "app/bundles/LeadBundle/Tests/Functional/Controller/LeadControllerTest.php",
                "status": "added",
                "additions": 92,
                "deletions": 0,
                "changes": 92,
                "blob_url": "https://github.com/mautic/mautic/blob/22bdd0796ca6e1e985708b89ad5c07147630fecd/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FLeadControllerTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/22bdd0796ca6e1e985708b89ad5c07147630fecd/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FLeadControllerTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FLeadBundle%2FTests%2FFunctional%2FController%2FLeadControllerTest.php?ref=22bdd0796ca6e1e985708b89ad5c07147630fecd",
                "patch": "@@ -0,0 +1,92 @@\n+<?php\n+\n+namespace Mautic\\LeadBundle\\Tests\\Functional\\Controller;\n+\n+use Mautic\\CoreBundle\\Test\\MauticMysqlTestCase;\n+use Mautic\\UserBundle\\Entity\\Role;\n+use Mautic\\UserBundle\\Entity\\User;\n+use Symfony\\Component\\HttpFoundation\\Request;\n+\n+class LeadControllerTest extends MauticMysqlTestCase\n+{\n+    public const USERNAME = 'jhony';\n+\n+    public function testAccessContactQuickAddWithPermission(): void\n+    {\n+        $this->setAdminUser();\n+        $this->client->request(Request::METHOD_GET, '/s/contacts/quickAdd');\n+        $this->assertResponseStatusCodeSame(200, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    private function setAdminUser(): void\n+    {\n+        $this->loginUser('admin');\n+        $this->client->setServerParameter('PHP_AUTH_USER', 'admin');\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+    }\n+\n+    public function testAccessContactQuickAddWithNoPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request(Request::METHOD_GET, '/s/contacts/quickAdd');\n+        $this->assertResponseStatusCodeSame(403, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    public function testAccessContactBatchOwnersNoPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request(Request::METHOD_GET, '/s/contacts/batchOwners');\n+        $this->assertResponseStatusCodeSame(403, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    public function testAccessContactBatchOwnersPermission(): void\n+    {\n+        $this->setAdminUser();\n+        $this->client->request(Request::METHOD_GET, '/s/contacts/batchOwners');\n+        $this->assertResponseStatusCodeSame(200, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    private function createAndLoginUser(): User\n+    {\n+        // Create non-admin role\n+        $role = $this->createRole();\n+        // Create non-admin user\n+        $user = $this->createUser($role);\n+\n+        $this->em->flush();\n+        $this->em->detach($role);\n+\n+        $this->loginUser(self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_USER', self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+\n+        return $user;\n+    }\n+\n+    private function createRole(bool $isAdmin = false): Role\n+    {\n+        $role = new Role();\n+        $role->setName('Role');\n+        $role->setIsAdmin($isAdmin);\n+\n+        $this->em->persist($role);\n+\n+        return $role;\n+    }\n+\n+    private function createUser(Role $role): User\n+    {\n+        $user = new User();\n+        $user->setFirstName('Jhony');\n+        $user->setLastName('Doe');\n+        $user->setUsername(self::USERNAME);\n+        $user->setEmail('john.doe@email.com');\n+        $encoder = self::$container->get('security.encoder_factory')->getEncoder($user);\n+        $user->setPassword($encoder->encodePassword('mautic', null));\n+        $user->setRole($role);\n+\n+        $this->em->persist($user);\n+\n+        return $user;\n+    }\n+}"
            },
            {
                "sha": "7eb9e50225d3b0bd008be373f33f54d5b53cf70e",
                "filename": "plugins/MauticSocialBundle/Controller/MonitoringController.php",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/mautic/mautic/blob/22bdd0796ca6e1e985708b89ad5c07147630fecd/plugins%2FMauticSocialBundle%2FController%2FMonitoringController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/22bdd0796ca6e1e985708b89ad5c07147630fecd/plugins%2FMauticSocialBundle%2FController%2FMonitoringController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/plugins%2FMauticSocialBundle%2FController%2FMonitoringController.php?ref=22bdd0796ca6e1e985708b89ad5c07147630fecd",
                "patch": "@@ -17,6 +17,10 @@ class MonitoringController extends FormController\n      */\n     public function indexAction($page = 1)\n     {\n+        if (!$this->get('mautic.security')->isGranted('mauticSocial:monitoring:view')) {\n+            return $this->accessDenied();\n+        }\n+\n         $session = $this->get('session');\n \n         $this->setListFilters();"
            },
            {
                "sha": "796abbea47e38c3da23fa81232c2caf2320a71de",
                "filename": "plugins/MauticSocialBundle/Tests/Functional/Controller/MonitoringControllerTest.php",
                "status": "added",
                "additions": 101,
                "deletions": 0,
                "changes": 101,
                "blob_url": "https://github.com/mautic/mautic/blob/22bdd0796ca6e1e985708b89ad5c07147630fecd/plugins%2FMauticSocialBundle%2FTests%2FFunctional%2FController%2FMonitoringControllerTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/22bdd0796ca6e1e985708b89ad5c07147630fecd/plugins%2FMauticSocialBundle%2FTests%2FFunctional%2FController%2FMonitoringControllerTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/plugins%2FMauticSocialBundle%2FTests%2FFunctional%2FController%2FMonitoringControllerTest.php?ref=22bdd0796ca6e1e985708b89ad5c07147630fecd",
                "patch": "@@ -0,0 +1,101 @@\n+<?php\n+\n+namespace MauticPlugin\\MauticSocialBundle\\Tests\\Functional\\Controller;\n+\n+use Mautic\\CoreBundle\\Test\\MauticMysqlTestCase;\n+use Mautic\\UserBundle\\Entity\\Role;\n+use Mautic\\UserBundle\\Entity\\User;\n+\n+class MonitoringControllerTest extends MauticMysqlTestCase\n+{\n+    public const USERNAME = 'jhony';\n+\n+    public function testIndex(): void\n+    {\n+        $this->client->request('GET', '/s/monitoring');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(200, $response->getStatusCode());\n+    }\n+\n+    public function testNew(): void\n+    {\n+        $this->client->request('GET', '/s/monitoring/new');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(200, $response->getStatusCode());\n+    }\n+\n+    public function testEdit(): void\n+    {\n+        $this->client->request('GET', '/s/monitoring/edit/1');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(200, $response->getStatusCode());\n+    }\n+\n+    public function testIndexWithoutPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request('GET', '/s/monitoring');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(403, $response->getStatusCode());\n+    }\n+\n+    public function testNewWithoutPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request('GET', '/s/monitoring/new');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(403, $response->getStatusCode());\n+    }\n+\n+    public function testEditWithoutPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $this->client->request('GET', '/s/monitoring/edit/1');\n+        $response = $this->client->getResponse();\n+        $this->assertEquals(403, $response->getStatusCode());\n+    }\n+\n+    private function createAndLoginUser(): User\n+    {\n+        // Create non-admin role\n+        $role = $this->createRole();\n+        // Create non-admin user\n+        $user = $this->createUser($role);\n+\n+        $this->em->flush();\n+        $this->em->detach($role);\n+\n+        $this->loginUser(self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_USER', self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+\n+        return $user;\n+    }\n+\n+    private function createRole(bool $isAdmin = false): Role\n+    {\n+        $role = new Role();\n+        $role->setName('Role');\n+        $role->setIsAdmin($isAdmin);\n+\n+        $this->em->persist($role);\n+\n+        return $role;\n+    }\n+\n+    private function createUser(Role $role): User\n+    {\n+        $user = new User();\n+        $user->setFirstName('John');\n+        $user->setLastName('Doe');\n+        $user->setUsername(self::USERNAME);\n+        $user->setEmail('john.doe@email.com');\n+        $encoder = self::$container->get('security.encoder_factory')->getEncoder($user);\n+        $user->setPassword($encoder->encodePassword('mautic', null));\n+        $user->setRole($role);\n+\n+        $this->em->persist($user);\n+\n+        return $user;\n+    }\n+}"
            },
            {
                "sha": "2b5dddc2a4d5f461fef38a3a182dffa7113d96ea",
                "filename": "plugins/MauticTagManagerBundle/Controller/TagController.php",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/mautic/mautic/blob/22bdd0796ca6e1e985708b89ad5c07147630fecd/plugins%2FMauticTagManagerBundle%2FController%2FTagController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/22bdd0796ca6e1e985708b89ad5c07147630fecd/plugins%2FMauticTagManagerBundle%2FController%2FTagController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/plugins%2FMauticTagManagerBundle%2FController%2FTagController.php?ref=22bdd0796ca6e1e985708b89ad5c07147630fecd",
                "patch": "@@ -231,6 +231,10 @@ public function newAction()\n      */\n     public function editAction($objectId, $ignorePost = false)\n     {\n+        if (!$this->get('mautic.security')->isGranted('tagManager:tagManager:edit')) {\n+            return $this->accessDenied();\n+        }\n+\n         $postActionVars = $this->getPostActionVars($objectId);\n \n         try {"
            },
            {
                "sha": "547f20536c25e0d0c9aaa3ec1e5414783d141a53",
                "filename": "plugins/MauticTagManagerBundle/Tests/Functional/Controller/TagControllerTest.php",
                "status": "modified",
                "additions": 56,
                "deletions": 0,
                "changes": 56,
                "blob_url": "https://github.com/mautic/mautic/blob/22bdd0796ca6e1e985708b89ad5c07147630fecd/plugins%2FMauticTagManagerBundle%2FTests%2FFunctional%2FController%2FTagControllerTest.php",
                "raw_url": "https://github.com/mautic/mautic/raw/22bdd0796ca6e1e985708b89ad5c07147630fecd/plugins%2FMauticTagManagerBundle%2FTests%2FFunctional%2FController%2FTagControllerTest.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/plugins%2FMauticTagManagerBundle%2FTests%2FFunctional%2FController%2FTagControllerTest.php?ref=22bdd0796ca6e1e985708b89ad5c07147630fecd",
                "patch": "@@ -8,11 +8,15 @@\n use Mautic\\LeadBundle\\Entity\\Tag;\n use Mautic\\LeadBundle\\Entity\\TagRepository;\n use Mautic\\LeadBundle\\Model\\TagModel;\n+use Mautic\\UserBundle\\Entity\\Role;\n+use Mautic\\UserBundle\\Entity\\User;\n use PHPUnit\\Framework\\Assert;\n use Symfony\\Component\\HttpFoundation\\Request;\n \n class TagControllerTest extends MauticMysqlTestCase\n {\n+    public const USERNAME = 'jhony';\n+\n     /**\n      * @var TagRepository\n      */\n@@ -183,4 +187,56 @@ public function testEmptyTagShouldThrowValidationError(): void\n         Assert::assertTrue($this->client->getResponse()->isOk());\n         Assert::assertStringContainsString('A value is required.', $this->client->getResponse()->getContent());\n     }\n+\n+    public function testEditTagWithNoPermission(): void\n+    {\n+        $this->createAndLoginUser();\n+        $tag     = $this->tagRepository->findOneBy([]);\n+        $this->client->request(Request::METHOD_GET, '/s/tags/edit/'.$tag->getId());\n+        $this->assertResponseStatusCodeSame(403, (string) $this->client->getResponse()->getStatusCode());\n+    }\n+\n+    private function createAndLoginUser(): User\n+    {\n+        // Create non-admin role\n+        $role = $this->createRole();\n+        // Create non-admin user\n+        $user = $this->createUser($role);\n+\n+        $this->em->flush();\n+        $this->em->detach($role);\n+\n+        $this->loginUser(self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_USER', self::USERNAME);\n+        $this->client->setServerParameter('PHP_AUTH_PW', 'mautic');\n+\n+        return $user;\n+    }\n+\n+    private function createRole(bool $isAdmin = false): Role\n+    {\n+        $role = new Role();\n+        $role->setName('Role');\n+        $role->setIsAdmin($isAdmin);\n+\n+        $this->em->persist($role);\n+\n+        return $role;\n+    }\n+\n+    private function createUser(Role $role): User\n+    {\n+        $user = new User();\n+        $user->setFirstName('Jhon');\n+        $user->setLastName('Doe');\n+        $user->setUsername(self::USERNAME);\n+        $user->setEmail('john.doe@email.com');\n+        $encoder = self::$container->get('security.encoder_factory')->getEncoder($user);\n+        $user->setPassword($encoder->encodePassword('mautic', null));\n+        $user->setRole($role);\n+\n+        $this->em->persist($user);\n+\n+        return $user;\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/guardrails-ai/guardrails/commits/ab12701e8c3ef41273ff9b3912f2e4e28ae8306f",
        "url": "https://api.github.com/repos/guardrails-ai/guardrails/commits/ab12701e8c3ef41273ff9b3912f2e4e28ae8306f",
        "html_url": "https://github.com/guardrails-ai/guardrails/commit/ab12701e8c3ef41273ff9b3912f2e4e28ae8306f",
        "message": "Merge pull request #1073 from guardrails-ai/eval-fix\n\nsafe eval",
        "files": [
            {
                "sha": "b6d60ba0213350c6d19348a30f681607c17d43b9",
                "filename": "guardrails/utils/validator_utils.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/guardrails-ai/guardrails/blob/ab12701e8c3ef41273ff9b3912f2e4e28ae8306f/guardrails%2Futils%2Fvalidator_utils.py",
                "raw_url": "https://github.com/guardrails-ai/guardrails/raw/ab12701e8c3ef41273ff9b3912f2e4e28ae8306f/guardrails%2Futils%2Fvalidator_utils.py",
                "contents_url": "https://api.github.com/repos/guardrails-ai/guardrails/contents/guardrails%2Futils%2Fvalidator_utils.py?ref=ab12701e8c3ef41273ff9b3912f2e4e28ae8306f",
                "patch": "@@ -1,6 +1,7 @@\n # ruff: noqa\n \"\"\"This module contains the constants and utils used by the validator.py.\"\"\"\n \n+from ast import literal_eval\n from typing import Any, Dict, List, Optional, Tuple, Type, Union, cast\n \n from guardrails_api_client import ValidatorReference\n@@ -33,7 +34,7 @@ def parse_rail_arguments(arg_tokens: List[str]) -> List[Any]:\n                 #   and be responsible for parsing them to the correct types.\n                 # Option 2: We use something like the Validator Manifest that describes the arguments\n                 #   to parse the values from the string WITHOUT an eval.\n-                t = eval(t)\n+                t = literal_eval(t)\n             except (ValueError, SyntaxError, NameError) as e:\n                 raise ValueError(\n                     f\"Python expression `{t}` is not valid, \""
            },
            {
                "sha": "07399ecfdcd01c049945b12053463de6fb5a6d73",
                "filename": "tests/unit_tests/test_datatypes.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/guardrails-ai/guardrails/blob/ab12701e8c3ef41273ff9b3912f2e4e28ae8306f/tests%2Funit_tests%2Ftest_datatypes.py",
                "raw_url": "https://github.com/guardrails-ai/guardrails/raw/ab12701e8c3ef41273ff9b3912f2e4e28ae8306f/tests%2Funit_tests%2Ftest_datatypes.py",
                "contents_url": "https://api.github.com/repos/guardrails-ai/guardrails/contents/tests%2Funit_tests%2Ftest_datatypes.py?ref=ab12701e8c3ef41273ff9b3912f2e4e28ae8306f",
                "patch": "@@ -22,7 +22,7 @@ def __init__(self, *args, **kwargs):\n         (\"test-validator: a\", [\"a\"]),\n         (\"test-validator: a b\", [\"a\", \"b\"]),\n         (\n-            \"test-validator: {list(range(5))} a b\",\n+            \"test-validator: {[0,1,2,3,4]} a b\",\n             [[0, 1, 2, 3, 4], \"a\", \"b\"],\n         ),\n         (\"test-validator: {[1, 2, 3]} a b\", [[1, 2, 3], \"a\", \"b\"]),\n@@ -31,7 +31,7 @@ def __init__(self, *args, **kwargs):\n             [{\"a\": 1, \"b\": 2}, \"c\", \"d\"],\n         ),\n         (\n-            \"test-validator: {1 + 2} {{'a': 1, 'b': 2}} c d\",\n+            \"test-validator: {3} {{'a': 1, 'b': 2}} c d\",\n             [3, {\"a\": 1, \"b\": 2}, \"c\", \"d\"],\n         ),\n     ],"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mautic/mautic/commits/e6d58de241b8c34126042dcb314d60eb5fc7b151",
        "url": "https://api.github.com/repos/mautic/mautic/commits/e6d58de241b8c34126042dcb314d60eb5fc7b151",
        "html_url": "https://github.com/mautic/mautic/commit/e6d58de241b8c34126042dcb314d60eb5fc7b151",
        "message": "Merge pull request from GHSA-fhcx-f7jg-jx3f\n\nCo-authored-by: lenonleite <lenonleite@gmail.com>",
        "files": [
            {
                "sha": "28ca34310e6d19027f8882935e9e2058f9d1a848",
                "filename": "app/bundles/DashboardBundle/Controller/DashboardController.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mautic/mautic/blob/e6d58de241b8c34126042dcb314d60eb5fc7b151/app%2Fbundles%2FDashboardBundle%2FController%2FDashboardController.php",
                "raw_url": "https://github.com/mautic/mautic/raw/e6d58de241b8c34126042dcb314d60eb5fc7b151/app%2Fbundles%2FDashboardBundle%2FController%2FDashboardController.php",
                "contents_url": "https://api.github.com/repos/mautic/mautic/contents/app%2Fbundles%2FDashboardBundle%2FController%2FDashboardController.php?ref=e6d58de241b8c34126042dcb314d60eb5fc7b151",
                "patch": "@@ -572,6 +572,7 @@ function ($a, $b) {\n      */\n     private function getNameFromRequest()\n     {\n-        return $this->request->get('name', (new \\DateTime())->format('Y-m-dTH:i:s'));\n+        $name = $this->request->get('name', (new \\DateTime())->format('Y-m-dTH:i:s'));\n+        return InputHelper::clean($name);\n     }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/coredns/coredns/commits/604a902e2c7e0317aecaa3666124079c75a31573",
        "url": "https://api.github.com/repos/coredns/coredns/commits/604a902e2c7e0317aecaa3666124079c75a31573",
        "html_url": "https://github.com/coredns/coredns/commit/604a902e2c7e0317aecaa3666124079c75a31573",
        "message": "plugin/forward: Continue waiting after receiving malformed responses (#6014)\n\n* forward: continue waiting after malformed responses\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* add test\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* fix test\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* clean up\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* clean up\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* move test to /test/. Add build tag.\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* install libpcap-dev for e2e tests\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* sudo the test\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* remove stray err check\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* disable the test\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* use -exec flag to run test binary as root\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* run new test by itself in a new workflow\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* fix test name\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* only for udp\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* remove libpcap test workflow action\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* remove test, since it cant run in ci\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n* and remove gopacket package\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>\r\n\r\n---------\r\n\r\nSigned-off-by: Chris O'Haver <cohaver@infoblox.com>",
        "files": [
            {
                "sha": "b60a1a2379d1f6028adfa8bea2efa6f58b386761",
                "filename": "plugin/pkg/proxy/connect.go",
                "status": "modified",
                "additions": 12,
                "deletions": 2,
                "changes": 14,
                "blob_url": "https://github.com/coredns/coredns/blob/604a902e2c7e0317aecaa3666124079c75a31573/plugin%2Fpkg%2Fproxy%2Fconnect.go",
                "raw_url": "https://github.com/coredns/coredns/raw/604a902e2c7e0317aecaa3666124079c75a31573/plugin%2Fpkg%2Fproxy%2Fconnect.go",
                "contents_url": "https://api.github.com/repos/coredns/coredns/contents/plugin%2Fpkg%2Fproxy%2Fconnect.go?ref=604a902e2c7e0317aecaa3666124079c75a31573",
                "patch": "@@ -7,6 +7,7 @@ package proxy\n import (\n \t\"context\"\n \t\"io\"\n+\t\"net\"\n \t\"strconv\"\n \t\"sync/atomic\"\n \t\"time\"\n@@ -117,11 +118,20 @@ func (p *Proxy) Connect(ctx context.Context, state request.Request, opts Options\n \tfor {\n \t\tret, err = pc.c.ReadMsg()\n \t\tif err != nil {\n-\t\t\tpc.c.Close() // not giving it back\n+\t\t\t// For UDP, if the error is not a network error keep waiting for a valid response to prevent malformed\n+\t\t\t// spoofs from blocking the upstream response.\n+\t\t\t// In the case this is a legitimate malformed response from the upstream, this will result in a timeout.\n+\t\t\tif proto == \"udp\" {\n+\t\t\t\tif _, ok := err.(net.Error); !ok {\n+\t\t\t\t\tcontinue\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tpc.c.Close() // connection closed by peer, close the persistent connection\n \t\t\tif err == io.EOF && cached {\n \t\t\t\treturn nil, ErrCachedClosed\n \t\t\t}\n-\t\t\t// recovery the origin Id after upstream.\n+\n+\t\t\t// recover the origin Id after upstream.\n \t\t\tif ret != nil {\n \t\t\t\tret.Id = originId\n \t\t\t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vercel/next.js/commits/bd164d53af259c05f1ab434004bcfdd3837d7cda",
        "url": "https://api.github.com/repos/vercel/next.js/commits/bd164d53af259c05f1ab434004bcfdd3837d7cda",
        "html_url": "https://github.com/vercel/next.js/commit/bd164d53af259c05f1ab434004bcfdd3837d7cda",
        "message": "Remove invalid fallback revalidate value (#69990)\n\nThis removes our invalid revalidate default fallback when a revalidate\nvalue isn't returned from render as render should always return a valid\nvalue. We also already have an invariant when an invalid revalidate\nvalue is returned we just need to ensure that case could be hit\nproperly. This also fixes some invalid test cases which were sending\ninvalid headers.\n\nx-ref: [slack\nthread](https://vercel.slack.com/archives/C0676QZBWKS/p1726061828198529?thread_ts=1720714625.621179&cid=C0676QZBWKS)",
        "files": [
            {
                "sha": "b93eac09f5676b0d7fab6410004c6051b1cdc546",
                "filename": "packages/next/src/server/base-server.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 4,
                "changes": 5,
                "blob_url": "https://github.com/vercel/next.js/blob/bd164d53af259c05f1ab434004bcfdd3837d7cda/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
                "raw_url": "https://github.com/vercel/next.js/raw/bd164d53af259c05f1ab434004bcfdd3837d7cda/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
                "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=bd164d53af259c05f1ab434004bcfdd3837d7cda",
                "patch": "@@ -2385,10 +2385,7 @@ export default abstract class Server<ServerOptions extends Options = Options> {\n \n         return {\n           ...result,\n-          revalidate:\n-            result.revalidate !== undefined\n-              ? result.revalidate\n-              : /* default to minimum revalidate (this should be an invariant) */ 1,\n+          revalidate: result.revalidate,\n         }\n       },\n       {"
            },
            {
                "sha": "c1e8f4171478d0d26157c0f3988420f8afb1ba17",
                "filename": "packages/next/src/server/render.tsx",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/vercel/next.js/blob/bd164d53af259c05f1ab434004bcfdd3837d7cda/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
                "raw_url": "https://github.com/vercel/next.js/raw/bd164d53af259c05f1ab434004bcfdd3837d7cda/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
                "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx?ref=bd164d53af259c05f1ab434004bcfdd3837d7cda",
                "patch": "@@ -1067,6 +1067,7 @@ export async function renderToHTMLImpl(\n           })\n       )\n       canAccessRes = false\n+      renderResultMeta.revalidate = 0\n     } catch (serverSidePropsError: any) {\n       // remove not found error code to prevent triggering legacy\n       // 404 rendering"
            },
            {
                "sha": "32b3c59d45012220a22c12fc66bcfefadeb0c535",
                "filename": "test/production/standalone-mode/required-server-files/required-server-files-i18n.test.ts",
                "status": "modified",
                "additions": 10,
                "deletions": 6,
                "changes": 16,
                "blob_url": "https://github.com/vercel/next.js/blob/bd164d53af259c05f1ab434004bcfdd3837d7cda/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-i18n.test.ts",
                "raw_url": "https://github.com/vercel/next.js/raw/bd164d53af259c05f1ab434004bcfdd3837d7cda/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-i18n.test.ts",
                "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-i18n.test.ts?ref=bd164d53af259c05f1ab434004bcfdd3837d7cda",
                "patch": "@@ -344,12 +344,16 @@ describe('required server files i18n', () => {\n     expect(isNaN(data2.random)).toBe(false)\n     expect(data2.random).not.toBe(data.random)\n \n-    const html3 = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n-      headers: {\n-        'x-matched-path': '/dynamic/[slug]?slug=%5Bslug%5D.json',\n-        'x-now-route-matches': '1=second&nxtPslug=second',\n-      },\n-    })\n+    const html3 = await renderViaHTTP(\n+      appPort,\n+      '/some-other-path?nxtPslug=second',\n+      undefined,\n+      {\n+        headers: {\n+          'x-matched-path': '/dynamic/[slug]?slug=%5Bslug%5D.json',\n+        },\n+      }\n+    )\n     const $3 = cheerio.load(html3)\n     const data3 = JSON.parse($3('#props').text())\n "
            },
            {
                "sha": "0bab6b06c5cefc7b1596276253a2d11b9dfccdfc",
                "filename": "test/production/standalone-mode/required-server-files/required-server-files.test.ts",
                "status": "modified",
                "additions": 10,
                "deletions": 6,
                "changes": 16,
                "blob_url": "https://github.com/vercel/next.js/blob/bd164d53af259c05f1ab434004bcfdd3837d7cda/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files.test.ts",
                "raw_url": "https://github.com/vercel/next.js/raw/bd164d53af259c05f1ab434004bcfdd3837d7cda/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files.test.ts",
                "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files.test.ts?ref=bd164d53af259c05f1ab434004bcfdd3837d7cda",
                "patch": "@@ -617,12 +617,16 @@ describe('required server files', () => {\n     expect(isNaN(data2.random)).toBe(false)\n     expect(data2.random).not.toBe(data.random)\n \n-    const html3 = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n-      headers: {\n-        'x-matched-path': '/dynamic/[slug]',\n-        'x-now-route-matches': '1=second&nxtPslug=second',\n-      },\n-    })\n+    const html3 = await renderViaHTTP(\n+      appPort,\n+      '/some-other-path?nxtPslug=second',\n+      undefined,\n+      {\n+        headers: {\n+          'x-matched-path': '/dynamic/[slug]',\n+        },\n+      }\n+    )\n     const $3 = cheerio.load(html3)\n     const data3 = JSON.parse($3('#props').text())\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vercel/next.js/commits/7ed7f125e07ef0517a331009ed7e32691ba403d3",
        "url": "https://api.github.com/repos/vercel/next.js/commits/7ed7f125e07ef0517a331009ed7e32691ba403d3",
        "html_url": "https://github.com/vercel/next.js/commit/7ed7f125e07ef0517a331009ed7e32691ba403d3",
        "message": "Remove invalid fallback revalidate value (#69990)\n\nThis removes our invalid revalidate default fallback when a revalidate\nvalue isn't returned from render as render should always return a valid\nvalue. We also already have an invariant when an invalid revalidate\nvalue is returned we just need to ensure that case could be hit\nproperly. This also fixes some invalid test cases which were sending\ninvalid headers.\n\nx-ref: [slack\nthread](https://vercel.slack.com/archives/C0676QZBWKS/p1726061828198529?thread_ts=1720714625.621179&cid=C0676QZBWKS)",
        "files": [
            {
                "sha": "b39edf583d07eb14e5af7aacad229f74ef0bb9d0",
                "filename": "packages/next/src/server/base-server.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 4,
                "changes": 5,
                "blob_url": "https://github.com/vercel/next.js/blob/7ed7f125e07ef0517a331009ed7e32691ba403d3/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
                "raw_url": "https://github.com/vercel/next.js/raw/7ed7f125e07ef0517a331009ed7e32691ba403d3/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
                "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=7ed7f125e07ef0517a331009ed7e32691ba403d3",
                "patch": "@@ -2573,10 +2573,7 @@ export default abstract class Server<ServerOptions extends Options = Options> {\n \n         return {\n           ...result,\n-          revalidate:\n-            result.revalidate !== undefined\n-              ? result.revalidate\n-              : /* default to minimum revalidate (this should be an invariant) */ 1,\n+          revalidate: result.revalidate,\n         }\n       },\n       {"
            },
            {
                "sha": "2cc3e37ff2d9f2d29fd9fceb849eeca892f7d937",
                "filename": "packages/next/src/server/render.tsx",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/vercel/next.js/blob/7ed7f125e07ef0517a331009ed7e32691ba403d3/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
                "raw_url": "https://github.com/vercel/next.js/raw/7ed7f125e07ef0517a331009ed7e32691ba403d3/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
                "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx?ref=7ed7f125e07ef0517a331009ed7e32691ba403d3",
                "patch": "@@ -1089,6 +1089,7 @@ export async function renderToHTMLImpl(\n           })\n       )\n       canAccessRes = false\n+      metadata.revalidate = 0\n     } catch (serverSidePropsError: any) {\n       // remove not found error code to prevent triggering legacy\n       // 404 rendering"
            },
            {
                "sha": "b99348c68990530b721a91c88c227ba0fe5f518a",
                "filename": "test/production/standalone-mode/required-server-files/required-server-files-i18n.test.ts",
                "status": "modified",
                "additions": 10,
                "deletions": 6,
                "changes": 16,
                "blob_url": "https://github.com/vercel/next.js/blob/7ed7f125e07ef0517a331009ed7e32691ba403d3/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-i18n.test.ts",
                "raw_url": "https://github.com/vercel/next.js/raw/7ed7f125e07ef0517a331009ed7e32691ba403d3/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-i18n.test.ts",
                "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-i18n.test.ts?ref=7ed7f125e07ef0517a331009ed7e32691ba403d3",
                "patch": "@@ -345,12 +345,16 @@ describe('required server files i18n', () => {\n     expect(isNaN(data2.random)).toBe(false)\n     expect(data2.random).not.toBe(data.random)\n \n-    const html3 = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n-      headers: {\n-        'x-matched-path': '/dynamic/[slug]?slug=%5Bslug%5D.json',\n-        'x-now-route-matches': '1=second&nxtPslug=second',\n-      },\n-    })\n+    const html3 = await renderViaHTTP(\n+      appPort,\n+      '/some-other-path?nxtPslug=second',\n+      undefined,\n+      {\n+        headers: {\n+          'x-matched-path': '/dynamic/[slug]?slug=%5Bslug%5D.json',\n+        },\n+      }\n+    )\n     const $3 = cheerio.load(html3)\n     const data3 = JSON.parse($3('#props').text())\n "
            },
            {
                "sha": "2d8c58fdee4126b41612651c947645f35a4a90fc",
                "filename": "test/production/standalone-mode/required-server-files/required-server-files.test.ts",
                "status": "modified",
                "additions": 10,
                "deletions": 6,
                "changes": 16,
                "blob_url": "https://github.com/vercel/next.js/blob/7ed7f125e07ef0517a331009ed7e32691ba403d3/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files.test.ts",
                "raw_url": "https://github.com/vercel/next.js/raw/7ed7f125e07ef0517a331009ed7e32691ba403d3/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files.test.ts",
                "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files.test.ts?ref=7ed7f125e07ef0517a331009ed7e32691ba403d3",
                "patch": "@@ -622,12 +622,16 @@ describe('required server files', () => {\n     expect(isNaN(data2.random)).toBe(false)\n     expect(data2.random).not.toBe(data.random)\n \n-    const html3 = await renderViaHTTP(appPort, '/some-other-path', undefined, {\n-      headers: {\n-        'x-matched-path': '/dynamic/[slug]',\n-        'x-now-route-matches': '1=second&nxtPslug=second',\n-      },\n-    })\n+    const html3 = await renderViaHTTP(\n+      appPort,\n+      '/some-other-path?nxtPslug=second',\n+      undefined,\n+      {\n+        headers: {\n+          'x-matched-path': '/dynamic/[slug]',\n+        },\n+      }\n+    )\n     const $3 = cheerio.load(html3)\n     const data3 = JSON.parse($3('#props').text())\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/2ddd8541ec3b2d2e5b698749e0f2362ef28056bd",
        "url": "https://api.github.com/repos/vitejs/vite/commits/2ddd8541ec3b2d2e5b698749e0f2362ef28056bd",
        "html_url": "https://github.com/vitejs/vite/commit/2ddd8541ec3b2d2e5b698749e0f2362ef28056bd",
        "message": "fix: backport #18115, DOM Clobbering in",
        "files": [
            {
                "sha": "24e5118c7767b179921464f0f526a077f8b0f11b",
                "filename": "packages/vite/src/node/build.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/2ddd8541ec3b2d2e5b698749e0f2362ef28056bd/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/2ddd8541ec3b2d2e5b698749e0f2362ef28056bd/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts?ref=2ddd8541ec3b2d2e5b698749e0f2362ef28056bd",
                "patch": "@@ -1005,7 +1005,7 @@ const getRelativeUrlFromDocument = (relativePath: string, umd = false) =>\n   getResolveUrl(\n     `'${relativePath}', ${\n       umd ? `typeof document === 'undefined' ? location.href : ` : ''\n-    }document.currentScript && document.currentScript.src || document.baseURI`\n+    }document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI`\n   )\n \n const relativeUrlMechanisms: Record<"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/179b17773cf35c73ddb041f9e6c703fd9f3126af",
        "url": "https://api.github.com/repos/vitejs/vite/commits/179b17773cf35c73ddb041f9e6c703fd9f3126af",
        "html_url": "https://github.com/vitejs/vite/commit/179b17773cf35c73ddb041f9e6c703fd9f3126af",
        "message": "fix: avoid DOM Clobbering gadget in `getRelativeUrlFromDocument` (#18115)",
        "files": [
            {
                "sha": "e3e7291fbb4150907041627a0901023feaff8087",
                "filename": "packages/vite/src/node/build.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/179b17773cf35c73ddb041f9e6c703fd9f3126af/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/179b17773cf35c73ddb041f9e6c703fd9f3126af/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts?ref=179b17773cf35c73ddb041f9e6c703fd9f3126af",
                "patch": "@@ -1133,7 +1133,7 @@ const getRelativeUrlFromDocument = (relativePath: string, umd = false) =>\n   getResolveUrl(\n     `'${escapeId(partialEncodeURIPath(relativePath))}', ${\n       umd ? `typeof document === 'undefined' ? location.href : ` : ''\n-    }document.currentScript && document.currentScript.src || document.baseURI`,\n+    }document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI`,\n   )\n \n const getFileUrlFromFullPath = (path: string) =>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/e8127166979e7ace6eeaa2c3b733c8994caa31f3",
        "url": "https://api.github.com/repos/vitejs/vite/commits/e8127166979e7ace6eeaa2c3b733c8994caa31f3",
        "html_url": "https://github.com/vitejs/vite/commit/e8127166979e7ace6eeaa2c3b733c8994caa31f3",
        "message": "fix: avoid DOM Clobbering gadget in `getRelativeUrlFromDocument` (#18115)",
        "files": [
            {
                "sha": "64432fc53e99c2cd8e47ea56378501651999603f",
                "filename": "packages/vite/src/node/build.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/e8127166979e7ace6eeaa2c3b733c8994caa31f3/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/e8127166979e7ace6eeaa2c3b733c8994caa31f3/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts?ref=e8127166979e7ace6eeaa2c3b733c8994caa31f3",
                "patch": "@@ -1100,7 +1100,7 @@ const getRelativeUrlFromDocument = (relativePath: string, umd = false) =>\n   getResolveUrl(\n     `'${escapeId(relativePath)}', ${\n       umd ? `typeof document === 'undefined' ? location.href : ` : ''\n-    }document.currentScript && document.currentScript.src || document.baseURI`,\n+    }document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI`,\n   )\n \n const getFileUrlFromFullPath = (path: string) =>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/2691bb3ff6b073b41fb9046909e1e03a74e36675",
        "url": "https://api.github.com/repos/vitejs/vite/commits/2691bb3ff6b073b41fb9046909e1e03a74e36675",
        "html_url": "https://github.com/vitejs/vite/commit/2691bb3ff6b073b41fb9046909e1e03a74e36675",
        "message": "fix: avoid DOM Clobbering gadget in `getRelativeUrlFromDocument` (#18115)",
        "files": [
            {
                "sha": "8cd93f695f48efc7a35f56d1aed2d846134c1b30",
                "filename": "packages/vite/src/node/build.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/2691bb3ff6b073b41fb9046909e1e03a74e36675/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/2691bb3ff6b073b41fb9046909e1e03a74e36675/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts?ref=2691bb3ff6b073b41fb9046909e1e03a74e36675",
                "patch": "@@ -1133,7 +1133,7 @@ const getRelativeUrlFromDocument = (relativePath: string, umd = false) =>\n   getResolveUrl(\n     `'${escapeId(partialEncodeURIPath(relativePath))}', ${\n       umd ? `typeof document === 'undefined' ? location.href : ` : ''\n-    }document.currentScript && document.currentScript.src || document.baseURI`,\n+    }document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI`,\n   )\n \n const getFileUrlFromFullPath = (path: string) =>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/ebb94c5b3bf41950f45562595adec117a4d0ba5e",
        "url": "https://api.github.com/repos/vitejs/vite/commits/ebb94c5b3bf41950f45562595adec117a4d0ba5e",
        "html_url": "https://github.com/vitejs/vite/commit/ebb94c5b3bf41950f45562595adec117a4d0ba5e",
        "message": "fix: avoid DOM Clobbering gadget in `getRelativeUrlFromDocument` (#18115)",
        "files": [
            {
                "sha": "63cd27e0df3605a99b6bee1158862e7c4039af37",
                "filename": "packages/vite/src/node/build.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/ebb94c5b3bf41950f45562595adec117a4d0ba5e/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/ebb94c5b3bf41950f45562595adec117a4d0ba5e/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts?ref=ebb94c5b3bf41950f45562595adec117a4d0ba5e",
                "patch": "@@ -1131,7 +1131,7 @@ const getRelativeUrlFromDocument = (relativePath: string, umd = false) =>\n   getResolveUrl(\n     `'${escapeId(partialEncodeURIPath(relativePath))}', ${\n       umd ? `typeof document === 'undefined' ? location.href : ` : ''\n-    }document.currentScript && document.currentScript.src || document.baseURI`,\n+    }document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI`,\n   )\n \n const getFileUrlFromFullPath = (path: string) =>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/ade1d89660e17eedfd35652165b0c26905259fad",
        "url": "https://api.github.com/repos/vitejs/vite/commits/ade1d89660e17eedfd35652165b0c26905259fad",
        "html_url": "https://github.com/vitejs/vite/commit/ade1d89660e17eedfd35652165b0c26905259fad",
        "message": "fix: avoid DOM Clobbering gadget in `getRelativeUrlFromDocument` (#18115)",
        "files": [
            {
                "sha": "fbb4a26cffc416a36182b999ac0a83f1eeac9982",
                "filename": "packages/vite/src/node/build.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/ade1d89660e17eedfd35652165b0c26905259fad/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/ade1d89660e17eedfd35652165b0c26905259fad/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fbuild.ts?ref=ade1d89660e17eedfd35652165b0c26905259fad",
                "patch": "@@ -1297,7 +1297,7 @@ const getRelativeUrlFromDocument = (relativePath: string, umd = false) =>\n   getResolveUrl(\n     `'${escapeId(partialEncodeURIPath(relativePath))}', ${\n       umd ? `typeof document === 'undefined' ? location.href : ` : ''\n-    }document.currentScript && document.currentScript.src || document.baseURI`,\n+    }document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT' && document.currentScript.src || document.baseURI`,\n   )\n \n const getFileUrlFromFullPath = (path: string) =>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/8339d7408668686bae56eaccbfdc7b87612904bd",
        "url": "https://api.github.com/repos/vitejs/vite/commits/8339d7408668686bae56eaccbfdc7b87612904bd",
        "html_url": "https://github.com/vitejs/vite/commit/8339d7408668686bae56eaccbfdc7b87612904bd",
        "message": "fix: fs raw query (#18112)",
        "files": [
            {
                "sha": "11c0543e336d7a0d0981ab770ab0c71340d41280",
                "filename": "packages/vite/src/node/server/middlewares/static.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/8339d7408668686bae56eaccbfdc7b87612904bd/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/8339d7408668686bae56eaccbfdc7b87612904bd/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts?ref=8339d7408668686bae56eaccbfdc7b87612904bd",
                "patch": "@@ -229,7 +229,7 @@ export function isFileServingAllowed(\n   return false\n }\n \n-function ensureServingAccess(\n+export function ensureServingAccess(\n   url: string,\n   server: ViteDevServer,\n   res: ServerResponse,"
            },
            {
                "sha": "a98307799831f09a720c5635619e4f4ff0d76e0b",
                "filename": "packages/vite/src/node/server/middlewares/transform.ts",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/vitejs/vite/blob/8339d7408668686bae56eaccbfdc7b87612904bd/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/8339d7408668686bae56eaccbfdc7b87612904bd/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts?ref=8339d7408668686bae56eaccbfdc7b87612904bd",
                "patch": "@@ -12,6 +12,7 @@ import {\n   isJSRequest,\n   normalizePath,\n   prettifyUrl,\n+  rawRE,\n   removeImportQuery,\n   removeTimestampQuery,\n   urlRE,\n@@ -35,6 +36,7 @@ import { ERR_CLOSED_SERVER } from '../pluginContainer'\n import { getDepsOptimizer } from '../../optimizer'\n import { cleanUrl, unwrapId, withTrailingSlash } from '../../../shared/utils'\n import { NULL_BYTE_PLACEHOLDER } from '../../../shared/constants'\n+import { ensureServingAccess } from './static'\n \n const debugCache = createDebugger('vite:cache')\n \n@@ -158,6 +160,13 @@ export function transformMiddleware(\n         warnAboutExplicitPublicPathInUrl(url)\n       }\n \n+      if (\n+        (rawRE.test(url) || urlRE.test(url)) &&\n+        !ensureServingAccess(url, server, res, next)\n+      ) {\n+        return\n+      }\n+\n       if (\n         isJSRequest(url) ||\n         isImportRequest(url) ||"
            },
            {
                "sha": "16ecc0b78dc2952dc75dcd834eabe1e407d7c962",
                "filename": "playground/fs-serve/__tests__/fs-serve.spec.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/vitejs/vite/blob/8339d7408668686bae56eaccbfdc7b87612904bd/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/8339d7408668686bae56eaccbfdc7b87612904bd/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts?ref=8339d7408668686bae56eaccbfdc7b87612904bd",
                "patch": "@@ -77,6 +77,11 @@ describe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('404')"
            },
            {
                "sha": "fb1276d79fea22f149961b53dcf1a870ae0f6932",
                "filename": "playground/fs-serve/root/src/index.html",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/vitejs/vite/blob/8339d7408668686bae56eaccbfdc7b87612904bd/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "raw_url": "https://github.com/vitejs/vite/raw/8339d7408668686bae56eaccbfdc7b87612904bd/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html?ref=8339d7408668686bae56eaccbfdc7b87612904bd",
                "patch": "@@ -35,6 +35,8 @@ <h2>Safe /@fs/ Fetch</h2>\n <h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch-status\"></pre>\n <pre class=\"unsafe-fs-fetch\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n@@ -188,6 +190,24 @@ <h2>Denied</h2>\n       console.error(e)\n     })\n \n+  // not imported before, outside of root, treated as unsafe\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch(\n     joinUrlSegments("
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/a6da45082b6e73ddfdcdcc06bb5414f976a388d6",
        "url": "https://api.github.com/repos/vitejs/vite/commits/a6da45082b6e73ddfdcdcc06bb5414f976a388d6",
        "html_url": "https://github.com/vitejs/vite/commit/a6da45082b6e73ddfdcdcc06bb5414f976a388d6",
        "message": "fix: backport #18112, fs raw query",
        "files": [
            {
                "sha": "ca8fcd4999bb8887117284d77b289830ec551ece",
                "filename": "packages/vite/src/node/plugins/asset.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/vitejs/vite/blob/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/packages%2Fvite%2Fsrc%2Fnode%2Fplugins%2Fasset.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/packages%2Fvite%2Fsrc%2Fnode%2Fplugins%2Fasset.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fplugins%2Fasset.ts?ref=a6da45082b6e73ddfdcdcc06bb5414f976a388d6",
                "patch": "@@ -29,8 +29,8 @@ export const duplicateAssets = new WeakMap<\n   Map<string, OutputAsset>\n >()\n \n-const rawRE = /(\\?|&)raw(?:&|$)/\n-const urlRE = /(\\?|&)url(?:&|$)/\n+export const rawRE = /(\\?|&)raw(?:&|$)/\n+export const urlRE = /(\\?|&)url(?:&|$)/\n \n const assetCache = new WeakMap<ResolvedConfig, Map<string, string>>()\n "
            },
            {
                "sha": "304aa781dca2b8299fa65890416dc858ea70028f",
                "filename": "packages/vite/src/node/server/middlewares/static.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts?ref=a6da45082b6e73ddfdcdcc06bb5414f976a388d6",
                "patch": "@@ -174,7 +174,7 @@ export function isFileServingAllowed(\n   return false\n }\n \n-function ensureServingAccess(\n+export function ensureServingAccess(\n   url: string,\n   server: ViteDevServer,\n   res: ServerResponse,"
            },
            {
                "sha": "a11119e68bf983fc3b693d0994c260a38f17a318",
                "filename": "packages/vite/src/node/server/middlewares/transform.ts",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/vitejs/vite/blob/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts?ref=a6da45082b6e73ddfdcdcc06bb5414f976a388d6",
                "patch": "@@ -35,6 +35,8 @@ import {\n   ERR_OUTDATED_OPTIMIZED_DEP\n } from '../../plugins/optimizedDeps'\n import { getDepsOptimizer } from '../../optimizer'\n+import { rawRE, urlRE } from '../../plugins/asset'\n+import { ensureServingAccess } from './static'\n \n const debugCache = createDebugger('vite:cache')\n const isDebug = !!process.env.DEBUG\n@@ -147,6 +149,13 @@ export function transformMiddleware(\n         }\n       }\n \n+      if (\n+        (rawRE.test(url) || urlRE.test(url)) &&\n+        !ensureServingAccess(url, server, res, next)\n+      ) {\n+        return\n+      }\n+\n       if (\n         isJSRequest(url) ||\n         isImportRequest(url) ||"
            },
            {
                "sha": "fefbc419e43b2ac569ccae071028cacd25a71ab8",
                "filename": "playground/fs-serve/__tests__/fs-serve.spec.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/vitejs/vite/blob/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts?ref=a6da45082b6e73ddfdcdcc06bb5414f976a388d6",
                "patch": "@@ -76,6 +76,11 @@ describe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('403')"
            },
            {
                "sha": "b8ed6b184896926d0da32d98bceb69dea080ba68",
                "filename": "playground/fs-serve/root/src/index.html",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/vitejs/vite/blob/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "raw_url": "https://github.com/vitejs/vite/raw/a6da45082b6e73ddfdcdcc06bb5414f976a388d6/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html?ref=a6da45082b6e73ddfdcdcc06bb5414f976a388d6",
                "patch": "@@ -35,6 +35,8 @@ <h2>Safe /@fs/ Fetch</h2>\n <h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch-status\"></pre>\n <pre class=\"unsafe-fs-fetch\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n@@ -166,6 +168,24 @@ <h2>Denied</h2>\n       console.error(e)\n     })\n \n+  // not imported before, outside of root, treated as unsafe\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch('/@fs/' + ROOT + '/root/src/%2e%2e%2f%2e%2e%2funsafe%2ejson')\n     .then((r) => {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/b901438f99e667f76662840826eec91c8ab3b3e7",
        "url": "https://api.github.com/repos/vitejs/vite/commits/b901438f99e667f76662840826eec91c8ab3b3e7",
        "html_url": "https://github.com/vitejs/vite/commit/b901438f99e667f76662840826eec91c8ab3b3e7",
        "message": "fix: backport #18112, fs raw query",
        "files": [
            {
                "sha": "879047412809599788ebd8d7207a00780405bafe",
                "filename": "packages/vite/src/node/plugins/asset.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/b901438f99e667f76662840826eec91c8ab3b3e7/packages%2Fvite%2Fsrc%2Fnode%2Fplugins%2Fasset.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/b901438f99e667f76662840826eec91c8ab3b3e7/packages%2Fvite%2Fsrc%2Fnode%2Fplugins%2Fasset.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fplugins%2Fasset.ts?ref=b901438f99e667f76662840826eec91c8ab3b3e7",
                "patch": "@@ -29,7 +29,7 @@ import { FS_PREFIX } from '../constants'\n \n export const assetUrlRE = /__VITE_ASSET__([a-z\\d]+)__(?:\\$_(.*?)__)?/g\n \n-const rawRE = /(?:\\?|&)raw(?:&|$)/\n+export const rawRE = /(?:\\?|&)raw(?:&|$)/\n export const urlRE = /(\\?|&)url(?:&|$)/\n const jsSourceMapRE = /\\.[cm]?js\\.map$/\n const unnededFinalQueryCharRE = /[?&]$/"
            },
            {
                "sha": "c80f5e44bdda26df5bbd99d6a143f224afbee578",
                "filename": "packages/vite/src/node/server/middlewares/static.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/b901438f99e667f76662840826eec91c8ab3b3e7/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/b901438f99e667f76662840826eec91c8ab3b3e7/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts?ref=b901438f99e667f76662840826eec91c8ab3b3e7",
                "patch": "@@ -211,7 +211,7 @@ export function isFileServingAllowed(\n   return false\n }\n \n-function ensureServingAccess(\n+export function ensureServingAccess(\n   url: string,\n   server: ViteDevServer,\n   res: ServerResponse,"
            },
            {
                "sha": "4bc1042c63608491526c934d922eacc91f0c76aa",
                "filename": "packages/vite/src/node/server/middlewares/transform.ts",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/vitejs/vite/blob/b901438f99e667f76662840826eec91c8ab3b3e7/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/b901438f99e667f76662840826eec91c8ab3b3e7/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts?ref=b901438f99e667f76662840826eec91c8ab3b3e7",
                "patch": "@@ -38,7 +38,8 @@ import {\n } from '../../plugins/optimizedDeps'\n import { ERR_CLOSED_SERVER } from '../pluginContainer'\n import { getDepsOptimizer } from '../../optimizer'\n-import { urlRE } from '../../plugins/asset'\n+import { rawRE, urlRE } from '../../plugins/asset'\n+import { ensureServingAccess } from './static'\n \n const debugCache = createDebugger('vite:cache')\n \n@@ -166,6 +167,13 @@ export function transformMiddleware(\n         }\n       }\n \n+      if (\n+        (rawRE.test(url) || urlRE.test(url)) &&\n+        !ensureServingAccess(url, server, res, next)\n+      ) {\n+        return\n+      }\n+\n       if (\n         isJSRequest(url) ||\n         isImportRequest(url) ||"
            },
            {
                "sha": "16ecc0b78dc2952dc75dcd834eabe1e407d7c962",
                "filename": "playground/fs-serve/__tests__/fs-serve.spec.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/vitejs/vite/blob/b901438f99e667f76662840826eec91c8ab3b3e7/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/b901438f99e667f76662840826eec91c8ab3b3e7/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts?ref=b901438f99e667f76662840826eec91c8ab3b3e7",
                "patch": "@@ -77,6 +77,11 @@ describe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('404')"
            },
            {
                "sha": "fb1276d79fea22f149961b53dcf1a870ae0f6932",
                "filename": "playground/fs-serve/root/src/index.html",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/vitejs/vite/blob/b901438f99e667f76662840826eec91c8ab3b3e7/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "raw_url": "https://github.com/vitejs/vite/raw/b901438f99e667f76662840826eec91c8ab3b3e7/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html?ref=b901438f99e667f76662840826eec91c8ab3b3e7",
                "patch": "@@ -35,6 +35,8 @@ <h2>Safe /@fs/ Fetch</h2>\n <h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch-status\"></pre>\n <pre class=\"unsafe-fs-fetch\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n@@ -188,6 +190,24 @@ <h2>Denied</h2>\n       console.error(e)\n     })\n \n+  // not imported before, outside of root, treated as unsafe\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch(\n     joinUrlSegments("
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34",
        "url": "https://api.github.com/repos/vitejs/vite/commits/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34",
        "html_url": "https://github.com/vitejs/vite/commit/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34",
        "message": "fix: fs raw query (#18112)",
        "files": [
            {
                "sha": "6cb8a0c383a77f9f15e8161dc0ae4658decff49e",
                "filename": "packages/vite/src/node/server/middlewares/static.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts?ref=6820bb3b9a54334f3268fc5ee1e967d2e1c0db34",
                "patch": "@@ -232,7 +232,7 @@ export function isFileServingAllowed(\n   return false\n }\n \n-function ensureServingAccess(\n+export function ensureServingAccess(\n   url: string,\n   server: ViteDevServer,\n   res: ServerResponse,"
            },
            {
                "sha": "b56ccb76ff9ef31a8a87ea5fa671532cb912b142",
                "filename": "packages/vite/src/node/server/middlewares/transform.ts",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/vitejs/vite/blob/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts?ref=6820bb3b9a54334f3268fc5ee1e967d2e1c0db34",
                "patch": "@@ -12,6 +12,7 @@ import {\n   isJSRequest,\n   normalizePath,\n   prettifyUrl,\n+  rawRE,\n   removeImportQuery,\n   removeTimestampQuery,\n   urlRE,\n@@ -35,6 +36,7 @@ import { ERR_CLOSED_SERVER } from '../pluginContainer'\n import { getDepsOptimizer } from '../../optimizer'\n import { cleanUrl, unwrapId, withTrailingSlash } from '../../../shared/utils'\n import { NULL_BYTE_PLACEHOLDER } from '../../../shared/constants'\n+import { ensureServingAccess } from './static'\n \n const debugCache = createDebugger('vite:cache')\n \n@@ -161,6 +163,13 @@ export function transformMiddleware(\n         warnAboutExplicitPublicPathInUrl(url)\n       }\n \n+      if (\n+        (rawRE.test(url) || urlRE.test(url)) &&\n+        !ensureServingAccess(url, server, res, next)\n+      ) {\n+        return\n+      }\n+\n       if (\n         isJSRequest(url) ||\n         isImportRequest(url) ||"
            },
            {
                "sha": "16ecc0b78dc2952dc75dcd834eabe1e407d7c962",
                "filename": "playground/fs-serve/__tests__/fs-serve.spec.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/vitejs/vite/blob/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts?ref=6820bb3b9a54334f3268fc5ee1e967d2e1c0db34",
                "patch": "@@ -77,6 +77,11 @@ describe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('404')"
            },
            {
                "sha": "fb1276d79fea22f149961b53dcf1a870ae0f6932",
                "filename": "playground/fs-serve/root/src/index.html",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/vitejs/vite/blob/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "raw_url": "https://github.com/vitejs/vite/raw/6820bb3b9a54334f3268fc5ee1e967d2e1c0db34/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html?ref=6820bb3b9a54334f3268fc5ee1e967d2e1c0db34",
                "patch": "@@ -35,6 +35,8 @@ <h2>Safe /@fs/ Fetch</h2>\n <h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch-status\"></pre>\n <pre class=\"unsafe-fs-fetch\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n@@ -188,6 +190,24 @@ <h2>Denied</h2>\n       console.error(e)\n     })\n \n+  // not imported before, outside of root, treated as unsafe\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch(\n     joinUrlSegments("
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitejs/vite/commits/4573a6fd6f1b097fb7296a3e135e0646b996b249",
        "url": "https://api.github.com/repos/vitejs/vite/commits/4573a6fd6f1b097fb7296a3e135e0646b996b249",
        "html_url": "https://github.com/vitejs/vite/commit/4573a6fd6f1b097fb7296a3e135e0646b996b249",
        "message": "fix: fs raw query (#18112)",
        "files": [
            {
                "sha": "11c0543e336d7a0d0981ab770ab0c71340d41280",
                "filename": "packages/vite/src/node/server/middlewares/static.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/vitejs/vite/blob/4573a6fd6f1b097fb7296a3e135e0646b996b249/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/4573a6fd6f1b097fb7296a3e135e0646b996b249/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Fstatic.ts?ref=4573a6fd6f1b097fb7296a3e135e0646b996b249",
                "patch": "@@ -229,7 +229,7 @@ export function isFileServingAllowed(\n   return false\n }\n \n-function ensureServingAccess(\n+export function ensureServingAccess(\n   url: string,\n   server: ViteDevServer,\n   res: ServerResponse,"
            },
            {
                "sha": "a98307799831f09a720c5635619e4f4ff0d76e0b",
                "filename": "packages/vite/src/node/server/middlewares/transform.ts",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/vitejs/vite/blob/4573a6fd6f1b097fb7296a3e135e0646b996b249/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/4573a6fd6f1b097fb7296a3e135e0646b996b249/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/packages%2Fvite%2Fsrc%2Fnode%2Fserver%2Fmiddlewares%2Ftransform.ts?ref=4573a6fd6f1b097fb7296a3e135e0646b996b249",
                "patch": "@@ -12,6 +12,7 @@ import {\n   isJSRequest,\n   normalizePath,\n   prettifyUrl,\n+  rawRE,\n   removeImportQuery,\n   removeTimestampQuery,\n   urlRE,\n@@ -35,6 +36,7 @@ import { ERR_CLOSED_SERVER } from '../pluginContainer'\n import { getDepsOptimizer } from '../../optimizer'\n import { cleanUrl, unwrapId, withTrailingSlash } from '../../../shared/utils'\n import { NULL_BYTE_PLACEHOLDER } from '../../../shared/constants'\n+import { ensureServingAccess } from './static'\n \n const debugCache = createDebugger('vite:cache')\n \n@@ -158,6 +160,13 @@ export function transformMiddleware(\n         warnAboutExplicitPublicPathInUrl(url)\n       }\n \n+      if (\n+        (rawRE.test(url) || urlRE.test(url)) &&\n+        !ensureServingAccess(url, server, res, next)\n+      ) {\n+        return\n+      }\n+\n       if (\n         isJSRequest(url) ||\n         isImportRequest(url) ||"
            },
            {
                "sha": "16ecc0b78dc2952dc75dcd834eabe1e407d7c962",
                "filename": "playground/fs-serve/__tests__/fs-serve.spec.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/vitejs/vite/blob/4573a6fd6f1b097fb7296a3e135e0646b996b249/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "raw_url": "https://github.com/vitejs/vite/raw/4573a6fd6f1b097fb7296a3e135e0646b996b249/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2F__tests__%2Ffs-serve.spec.ts?ref=4573a6fd6f1b097fb7296a3e135e0646b996b249",
                "patch": "@@ -77,6 +77,11 @@ describe.runIf(isServe)('main', () => {\n     expect(await page.textContent('.unsafe-fs-fetch-status')).toBe('403')\n   })\n \n+  test('unsafe fs fetch', async () => {\n+    expect(await page.textContent('.unsafe-fs-fetch-raw')).toBe('')\n+    expect(await page.textContent('.unsafe-fs-fetch-raw-status')).toBe('403')\n+  })\n+\n   test('unsafe fs fetch with special characters (#8498)', async () => {\n     expect(await page.textContent('.unsafe-fs-fetch-8498')).toBe('')\n     expect(await page.textContent('.unsafe-fs-fetch-8498-status')).toBe('404')"
            },
            {
                "sha": "fb1276d79fea22f149961b53dcf1a870ae0f6932",
                "filename": "playground/fs-serve/root/src/index.html",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/vitejs/vite/blob/4573a6fd6f1b097fb7296a3e135e0646b996b249/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "raw_url": "https://github.com/vitejs/vite/raw/4573a6fd6f1b097fb7296a3e135e0646b996b249/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html",
                "contents_url": "https://api.github.com/repos/vitejs/vite/contents/playground%2Ffs-serve%2Froot%2Fsrc%2Findex.html?ref=4573a6fd6f1b097fb7296a3e135e0646b996b249",
                "patch": "@@ -35,6 +35,8 @@ <h2>Safe /@fs/ Fetch</h2>\n <h2>Unsafe /@fs/ Fetch</h2>\n <pre class=\"unsafe-fs-fetch-status\"></pre>\n <pre class=\"unsafe-fs-fetch\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw-status\"></pre>\n+<pre class=\"unsafe-fs-fetch-raw\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-status\"></pre>\n <pre class=\"unsafe-fs-fetch-8498\"></pre>\n <pre class=\"unsafe-fs-fetch-8498-2-status\"></pre>\n@@ -188,6 +190,24 @@ <h2>Denied</h2>\n       console.error(e)\n     })\n \n+  // not imported before, outside of root, treated as unsafe\n+  fetch(\n+    joinUrlSegments(\n+      base,\n+      joinUrlSegments('/@fs/', ROOT) + '/unsafe.json?import&raw',\n+    ),\n+  )\n+    .then((r) => {\n+      text('.unsafe-fs-fetch-raw-status', r.status)\n+      return r.json()\n+    })\n+    .then((data) => {\n+      text('.unsafe-fs-fetch-raw', JSON.stringify(data))\n+    })\n+    .catch((e) => {\n+      console.error(e)\n+    })\n+\n   // outside root with special characters #8498\n   fetch(\n     joinUrlSegments("
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/contao/contao/commits/63409c6bdfd95197d9906e229d765b630d45742e",
        "url": "https://api.github.com/repos/contao/contao/commits/63409c6bdfd95197d9906e229d765b630d45742e",
        "html_url": "https://github.com/contao/contao/commit/63409c6bdfd95197d9906e229d765b630d45742e",
        "message": "Merge commit from fork\n\n* Check if path is mounted in FileSelector\n\n* Use Path::isBasePath()\n\nCo-authored-by: Fritz Michael Gschwantner <fmg@inspiredminds.at>\n\n* Coding style\n\nCo-authored-by: Leo Feyer <1192057+leofeyer@users.noreply.github.com>\n\n---------\n\nCo-authored-by: Fritz Michael Gschwantner <fmg@inspiredminds.at>\nCo-authored-by: Leo Feyer <1192057+leofeyer@users.noreply.github.com>",
        "files": [
            {
                "sha": "ba79151118a7f8bcacdefd04ebbd9aeb8d14a048",
                "filename": "core-bundle/src/Resources/contao/widgets/FileSelector.php",
                "status": "modified",
                "additions": 37,
                "deletions": 0,
                "changes": 37,
                "blob_url": "https://github.com/contao/contao/blob/63409c6bdfd95197d9906e229d765b630d45742e/core-bundle%2Fsrc%2FResources%2Fcontao%2Fwidgets%2FFileSelector.php",
                "raw_url": "https://github.com/contao/contao/raw/63409c6bdfd95197d9906e229d765b630d45742e/core-bundle%2Fsrc%2FResources%2Fcontao%2Fwidgets%2FFileSelector.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fsrc%2FResources%2Fcontao%2Fwidgets%2FFileSelector.php?ref=63409c6bdfd95197d9906e229d765b630d45742e",
                "patch": "@@ -362,6 +362,11 @@ public function generateAjax($strFolder, $strField, $level, $mount=false)\n \t */\n \tprotected function renderFiletree($path, $intMargin, $mount=false, $blnProtected=true, $arrFound=array())\n \t{\n+\t\tif (!$this->isMounted($path))\n+\t\t{\n+\t\t\tthrow new \\RuntimeException('Folder \"' . $path . '\" is not mounted or cannot be found.');\n+\t\t}\n+\n \t\t// Invalid path\n \t\tif (!is_dir($path))\n \t\t{\n@@ -665,6 +670,38 @@ protected function isProtectedPath($path)\n \n \t\treturn true;\n \t}\n+\n+\tprotected function isMounted($path)\n+\t{\n+\t\tif (Validator::isInsecurePath($path))\n+\t\t{\n+\t\t\tthrow new \\RuntimeException('Insecure path ' . $path);\n+\t\t}\n+\n+\t\t$this->import(BackendUser::class, 'User');\n+\n+\t\t$path = StringUtil::stripRootDir($path);\n+\t\t$filemounts = array();\n+\n+\t\tif ($this->User->isAdmin)\n+\t\t{\n+\t\t\t$filemounts[] = System::getContainer()->getParameter('contao.upload_path');\n+\t\t}\n+\t\telseif (\\is_array($this->User->filemounts))\n+\t\t{\n+\t\t\t$filemounts = $this->User->filemounts;\n+\t\t}\n+\n+\t\tforeach ($filemounts as $filemount)\n+\t\t{\n+\t\t\tif (Path::isBasePath($filemount, $path))\n+\t\t\t{\n+\t\t\t\treturn true;\n+\t\t\t}\n+\t\t}\n+\n+\t\treturn false;\n+\t}\n }\n \n class_alias(FileSelector::class, 'FileSelector');"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/contao/contao/commits/f3db59ffe5a6c0e1f705b3230ebd5ff16865280e",
        "url": "https://api.github.com/repos/contao/contao/commits/f3db59ffe5a6c0e1f705b3230ebd5ff16865280e",
        "html_url": "https://github.com/contao/contao/commit/f3db59ffe5a6c0e1f705b3230ebd5ff16865280e",
        "message": "Merge commit from fork\n\n* Prevent files without extension to be uploaded and to be renamed to another file type\n\n* CS\n\nCo-authored-by: Martin Ausw\u00f6ger <martin@auswoeger.com>\n\n---------\n\nCo-authored-by: Martin Ausw\u00f6ger <martin@auswoeger.com>",
        "files": [
            {
                "sha": "c8fd85124f44bce6c273ae4a2a62459371df8b56",
                "filename": "core-bundle/contao/classes/FileUpload.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/contao/contao/blob/f3db59ffe5a6c0e1f705b3230ebd5ff16865280e/core-bundle%2Fcontao%2Fclasses%2FFileUpload.php",
                "raw_url": "https://github.com/contao/contao/raw/f3db59ffe5a6c0e1f705b3230ebd5ff16865280e/core-bundle%2Fcontao%2Fclasses%2FFileUpload.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fcontao%2Fclasses%2FFileUpload.php?ref=f3db59ffe5a6c0e1f705b3230ebd5ff16865280e",
                "patch": "@@ -10,6 +10,7 @@\n \n namespace Contao;\n \n+use Symfony\\Component\\Filesystem\\Path;\n use Symfony\\Component\\HttpFoundation\\File\\UploadedFile;\n \n /**\n@@ -144,7 +145,7 @@ public function uploadTo($strTarget)\n \t\t\t}\n \t\t\telse\n \t\t\t{\n-\t\t\t\t$strExtension = strtolower(substr($file['name'], strrpos($file['name'], '.') + 1));\n+\t\t\t\t$strExtension = Path::getExtension($file['name'], true);\n \n \t\t\t\t// Image is too big\n \t\t\t\tif (\\in_array($strExtension, array('gif', 'jpg', 'jpeg', 'png', 'webp', 'avif', 'heic', 'jxl')) && Config::get('imageWidth') && Config::get('imageHeight') && System::getContainer()->getParameter('contao.image.reject_large_uploads'))"
            },
            {
                "sha": "ea7e8067136d879c5204934e04eef8d845a8857d",
                "filename": "core-bundle/contao/dca/tl_files.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/contao/contao/blob/f3db59ffe5a6c0e1f705b3230ebd5ff16865280e/core-bundle%2Fcontao%2Fdca%2Ftl_files.php",
                "raw_url": "https://github.com/contao/contao/raw/f3db59ffe5a6c0e1f705b3230ebd5ff16865280e/core-bundle%2Fcontao%2Fdca%2Ftl_files.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fcontao%2Fdca%2Ftl_files.php?ref=f3db59ffe5a6c0e1f705b3230ebd5ff16865280e",
                "patch": "@@ -27,6 +27,7 @@\n use Contao\\StringUtil;\n use Contao\\System;\n use Contao\\Validator;\n+use Symfony\\Component\\Filesystem\\Path;\n use Symfony\\Component\\Finder\\Finder;\n \n $GLOBALS['TL_DCA']['tl_files'] = array\n@@ -480,7 +481,7 @@ public function adjustPalettes(string $strPalette, DataContainer $dc)\n \t\t}\n \n \t\t// Only show the important part fields for images\n-\t\tif ($blnIsFolder || !in_array(strtolower(substr($dc->id, strrpos($dc->id, '.') + 1)), System::getContainer()->getParameter('contao.image.valid_extensions')))\n+\t\tif ($blnIsFolder || !in_array(Path::getExtension($dc->id, true), System::getContainer()->getParameter('contao.image.valid_extensions')))\n \t\t{\n \t\t\t$strPalette = PaletteManipulator::create()\n \t\t\t\t->removeField(array('importantPartX', 'importantPartY', 'importantPartWidth', 'importantPartHeight'))"
            },
            {
                "sha": "5cf995090077560e0c40a3eddc6d52b1cff1d210",
                "filename": "core-bundle/contao/drivers/DC_Folder.php",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/contao/contao/blob/f3db59ffe5a6c0e1f705b3230ebd5ff16865280e/core-bundle%2Fcontao%2Fdrivers%2FDC_Folder.php",
                "raw_url": "https://github.com/contao/contao/raw/f3db59ffe5a6c0e1f705b3230ebd5ff16865280e/core-bundle%2Fcontao%2Fdrivers%2FDC_Folder.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fcontao%2Fdrivers%2FDC_Folder.php?ref=f3db59ffe5a6c0e1f705b3230ebd5ff16865280e",
                "patch": "@@ -906,7 +906,7 @@ public function copy($source=null, $destination=null)\n \t\t{\n \t\t\t$count = 1;\n \t\t\t$new = $destination;\n-\t\t\t$ext = strtolower(substr($destination, strrpos($destination, '.') + 1));\n+\t\t\t$ext = Path::getExtension($destination, true);\n \n \t\t\tif ($ext === 'twig')\n \t\t\t{\n@@ -2243,6 +2243,14 @@ protected function save($varValue)\n \t\t\t\t}\n \t\t\t}\n \n+\t\t\t// Check the full path to see if the file extension has changed, because if\n+\t\t\t// $this->strExtension is empty, a new extension could otherwise be added to\n+\t\t\t// $varValue and change the file type!\n+\t\t\tif (Path::getExtension($varValue . $this->strExtension) !== Path::getExtension($this->varValue . $this->strExtension))\n+\t\t\t{\n+\t\t\t\tthrow new \\Exception($GLOBALS['TL_LANG']['ERR']['invalidName']);\n+\t\t\t}\n+\n \t\t\t// The target exists\n \t\t\tif (strcasecmp($this->strPath . '/' . $this->varValue . $this->strExtension, $this->strPath . '/' . $varValue . $this->strExtension) !== 0 && file_exists($this->strRootDir . '/' . $this->strPath . '/' . $varValue . $this->strExtension))\n \t\t\t{"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/contao/contao/commits/9445d509f12a7f1b68a4794dcc5e3e459b363ebb",
        "url": "https://api.github.com/repos/contao/contao/commits/9445d509f12a7f1b68a4794dcc5e3e459b363ebb",
        "html_url": "https://github.com/contao/contao/commit/9445d509f12a7f1b68a4794dcc5e3e459b363ebb",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "c8fd85124f44bce6c273ae4a2a62459371df8b56",
                "filename": "core-bundle/contao/classes/FileUpload.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/contao/contao/blob/9445d509f12a7f1b68a4794dcc5e3e459b363ebb/core-bundle%2Fcontao%2Fclasses%2FFileUpload.php",
                "raw_url": "https://github.com/contao/contao/raw/9445d509f12a7f1b68a4794dcc5e3e459b363ebb/core-bundle%2Fcontao%2Fclasses%2FFileUpload.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fcontao%2Fclasses%2FFileUpload.php?ref=9445d509f12a7f1b68a4794dcc5e3e459b363ebb",
                "patch": "@@ -10,6 +10,7 @@\n \n namespace Contao;\n \n+use Symfony\\Component\\Filesystem\\Path;\n use Symfony\\Component\\HttpFoundation\\File\\UploadedFile;\n \n /**\n@@ -144,7 +145,7 @@ public function uploadTo($strTarget)\n \t\t\t}\n \t\t\telse\n \t\t\t{\n-\t\t\t\t$strExtension = strtolower(substr($file['name'], strrpos($file['name'], '.') + 1));\n+\t\t\t\t$strExtension = Path::getExtension($file['name'], true);\n \n \t\t\t\t// Image is too big\n \t\t\t\tif (\\in_array($strExtension, array('gif', 'jpg', 'jpeg', 'png', 'webp', 'avif', 'heic', 'jxl')) && Config::get('imageWidth') && Config::get('imageHeight') && System::getContainer()->getParameter('contao.image.reject_large_uploads'))"
            },
            {
                "sha": "553734b0d39ae70c78f3e50d7a667d44beb5cd23",
                "filename": "core-bundle/contao/dca/tl_files.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/contao/contao/blob/9445d509f12a7f1b68a4794dcc5e3e459b363ebb/core-bundle%2Fcontao%2Fdca%2Ftl_files.php",
                "raw_url": "https://github.com/contao/contao/raw/9445d509f12a7f1b68a4794dcc5e3e459b363ebb/core-bundle%2Fcontao%2Fdca%2Ftl_files.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fcontao%2Fdca%2Ftl_files.php?ref=9445d509f12a7f1b68a4794dcc5e3e459b363ebb",
                "patch": "@@ -27,6 +27,7 @@\n use Contao\\StringUtil;\n use Contao\\System;\n use Contao\\Validator;\n+use Symfony\\Component\\Filesystem\\Path;\n use Symfony\\Component\\Finder\\Finder;\n \n $GLOBALS['TL_DCA']['tl_files'] = array\n@@ -480,7 +481,7 @@ public function adjustPalettes(string $strPalette, DataContainer $dc)\n \t\t}\n \n \t\t// Only show the important part fields for images\n-\t\tif ($blnIsFolder || !in_array(strtolower(substr($dc->id, strrpos($dc->id, '.') + 1)), System::getContainer()->getParameter('contao.image.valid_extensions')))\n+\t\tif ($blnIsFolder || !in_array(Path::getExtension($dc->id, true), System::getContainer()->getParameter('contao.image.valid_extensions')))\n \t\t{\n \t\t\t$strPalette = PaletteManipulator::create()\n \t\t\t\t->removeField(array('importantPartX', 'importantPartY', 'importantPartWidth', 'importantPartHeight'))"
            },
            {
                "sha": "e24859cf0f3e9794148925ab5c32a760d872b4a3",
                "filename": "core-bundle/contao/drivers/DC_Folder.php",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/contao/contao/blob/9445d509f12a7f1b68a4794dcc5e3e459b363ebb/core-bundle%2Fcontao%2Fdrivers%2FDC_Folder.php",
                "raw_url": "https://github.com/contao/contao/raw/9445d509f12a7f1b68a4794dcc5e3e459b363ebb/core-bundle%2Fcontao%2Fdrivers%2FDC_Folder.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fcontao%2Fdrivers%2FDC_Folder.php?ref=9445d509f12a7f1b68a4794dcc5e3e459b363ebb",
                "patch": "@@ -922,7 +922,7 @@ public function copy($source=null, $destination=null)\n \t\t{\n \t\t\t$count = 1;\n \t\t\t$new = $destination;\n-\t\t\t$ext = strtolower(substr($destination, strrpos($destination, '.') + 1));\n+\t\t\t$ext = Path::getExtension($destination, true);\n \n \t\t\tif ($ext === 'twig')\n \t\t\t{\n@@ -2279,6 +2279,14 @@ protected function save($varValue)\n \t\t\t\t}\n \t\t\t}\n \n+\t\t\t// Check the full path to see if the file extension has changed, because if\n+\t\t\t// $this->strExtension is empty, a new extension could otherwise be added to\n+\t\t\t// $varValue and change the file type!\n+\t\t\tif (Path::getExtension($varValue . $this->strExtension) !== Path::getExtension($this->varValue . $this->strExtension))\n+\t\t\t{\n+\t\t\t\tthrow new \\Exception($GLOBALS['TL_LANG']['ERR']['invalidName']);\n+\t\t\t}\n+\n \t\t\t// The target exists\n \t\t\tif (strcasecmp($this->strPath . '/' . $this->varValue . $this->strExtension, $this->strPath . '/' . $varValue . $this->strExtension) !== 0 && file_exists($this->strRootDir . '/' . $this->strPath . '/' . $varValue . $this->strExtension))\n \t\t\t{"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/contao/contao/commits/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3",
        "url": "https://api.github.com/repos/contao/contao/commits/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3",
        "html_url": "https://github.com/contao/contao/commit/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3",
        "message": "Merge commit from fork\n\n* Prevent files without extension to be uploaded and to be renamed to another file type\n\n* Shorten the comparison\n\nCo-authored-by: Fritz Michael Gschwantner <fmg@inspiredminds.at>\n\n---------\n\nCo-authored-by: Fritz Michael Gschwantner <fmg@inspiredminds.at>",
        "files": [
            {
                "sha": "e9a867a2dfce08b134cabb55be192da33444366d",
                "filename": "core-bundle/src/Resources/contao/classes/FileUpload.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/contao/contao/blob/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3/core-bundle%2Fsrc%2FResources%2Fcontao%2Fclasses%2FFileUpload.php",
                "raw_url": "https://github.com/contao/contao/raw/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3/core-bundle%2Fsrc%2FResources%2Fcontao%2Fclasses%2FFileUpload.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fsrc%2FResources%2Fcontao%2Fclasses%2FFileUpload.php?ref=a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3",
                "patch": "@@ -10,6 +10,7 @@\n \n namespace Contao;\n \n+use Symfony\\Component\\Filesystem\\Path;\n use Symfony\\Component\\HttpFoundation\\File\\UploadedFile;\n \n /**\n@@ -144,7 +145,7 @@ public function uploadTo($strTarget)\n \t\t\t}\n \t\t\telse\n \t\t\t{\n-\t\t\t\t$strExtension = strtolower(substr($file['name'], strrpos($file['name'], '.') + 1));\n+\t\t\t\t$strExtension = Path::getExtension($file['name'], true);\n \n \t\t\t\t// Image is too big\n \t\t\t\tif (\\in_array($strExtension, array('gif', 'jpg', 'jpeg', 'png', 'webp', 'avif', 'heic', 'jxl')) && System::getContainer()->getParameter('contao.image.reject_large_uploads'))"
            },
            {
                "sha": "23e5ed002c6372578bc13a2e5ca226368f7da84e",
                "filename": "core-bundle/src/Resources/contao/dca/tl_files.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/contao/contao/blob/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3/core-bundle%2Fsrc%2FResources%2Fcontao%2Fdca%2Ftl_files.php",
                "raw_url": "https://github.com/contao/contao/raw/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3/core-bundle%2Fsrc%2FResources%2Fcontao%2Fdca%2Ftl_files.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fsrc%2FResources%2Fcontao%2Fdca%2Ftl_files.php?ref=a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3",
                "patch": "@@ -25,6 +25,7 @@\n use Contao\\StringUtil;\n use Contao\\System;\n use Contao\\Validator;\n+use Symfony\\Component\\Filesystem\\Path;\n use Symfony\\Component\\Finder\\Finder;\n \n $GLOBALS['TL_DCA']['tl_files'] = array\n@@ -496,7 +497,7 @@ public function adjustPalettes(DataContainer $dc)\n \t\t}\n \n \t\t// Only show the important part fields for images\n-\t\tif ($blnIsFolder || !in_array(strtolower(substr($dc->id, strrpos($dc->id, '.') + 1)), System::getContainer()->getParameter('contao.image.valid_extensions')))\n+\t\tif ($blnIsFolder || !in_array(Path::getExtension($dc->id, true), System::getContainer()->getParameter('contao.image.valid_extensions')))\n \t\t{\n \t\t\tPaletteManipulator::create()\n \t\t\t\t->removeField(array('importantPartX', 'importantPartY', 'importantPartWidth', 'importantPartHeight'))"
            },
            {
                "sha": "54dcbf51d9b2599d054cbaacc3708889a43ad94d",
                "filename": "core-bundle/src/Resources/contao/drivers/DC_Folder.php",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/contao/contao/blob/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3/core-bundle%2Fsrc%2FResources%2Fcontao%2Fdrivers%2FDC_Folder.php",
                "raw_url": "https://github.com/contao/contao/raw/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3/core-bundle%2Fsrc%2FResources%2Fcontao%2Fdrivers%2FDC_Folder.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fsrc%2FResources%2Fcontao%2Fdrivers%2FDC_Folder.php?ref=a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3",
                "patch": "@@ -890,7 +890,7 @@ public function copy($source=null, $destination=null)\n \t\t{\n \t\t\t$count = 1;\n \t\t\t$new = $destination;\n-\t\t\t$ext = strtolower(substr($destination, strrpos($destination, '.') + 1));\n+\t\t\t$ext = Path::getExtension($destination, true);\n \n \t\t\t// Add a suffix if the file exists\n \t\t\twhile (file_exists($this->strRootDir . '/' . $new) && $count < 12)\n@@ -2304,6 +2304,14 @@ protected function save($varValue)\n \t\t\t\t}\n \t\t\t}\n \n+\t\t\t// Check the full path to see if the file extension has changed, because if\n+\t\t\t// $this->strExtension is empty, a new extension could otherwise be added to\n+\t\t\t// $varValue and change the file type!\n+\t\t\tif (Path::getExtension($varValue . $this->strExtension) !== Path::getExtension($this->varValue . $this->strExtension))\n+\t\t\t{\n+\t\t\t\tthrow new \\Exception($GLOBALS['TL_LANG']['ERR']['invalidName']);\n+\t\t\t}\n+\n \t\t\t// The target exists\n \t\t\tif (strcasecmp($this->strPath . '/' . $this->varValue . $this->strExtension, $this->strPath . '/' . $varValue . $this->strExtension) !== 0 && file_exists($this->strRootDir . '/' . $this->strPath . '/' . $varValue . $this->strExtension))\n \t\t\t{"
            },
            {
                "sha": "39b0525dcd25be0712de4e6e2cb7b4a4e0658beb",
                "filename": "core-bundle/src/Resources/contao/library/Contao/GdImage.php",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/contao/contao/blob/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3/core-bundle%2Fsrc%2FResources%2Fcontao%2Flibrary%2FContao%2FGdImage.php",
                "raw_url": "https://github.com/contao/contao/raw/a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3/core-bundle%2Fsrc%2FResources%2Fcontao%2Flibrary%2FContao%2FGdImage.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fsrc%2FResources%2Fcontao%2Flibrary%2FContao%2FGdImage.php?ref=a7e39f96ac8fdc281f7caaa96e01deb0e24ac7d3",
                "patch": "@@ -10,6 +10,8 @@\n \n namespace Contao;\n \n+use Symfony\\Component\\Filesystem\\Path;\n+\n trigger_deprecation('contao/core-bundle', '4.3', 'Using the \"Contao\\GdImage\" class has been deprecated and will no longer work in Contao 5.0. Use the Imagine library instead.');\n \n /**\n@@ -157,7 +159,7 @@ public function setResource($gdResource)\n \tpublic function saveToFile($path)\n \t{\n \t\t$arrGdInfo = gd_info();\n-\t\t$extension = strtolower(substr($path, strrpos($path, '.') + 1));\n+\t\t$extension = Path::getExtension($path, true);\n \n \t\t// Fallback to PNG if GIF ist not supported\n \t\tif ($extension == 'gif' && !$arrGdInfo['GIF Create Support'])"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/druid/commits/74cab7a76c99da457c3a883939cc0b03301b8771",
        "url": "https://api.github.com/repos/apache/druid/commits/74cab7a76c99da457c3a883939cc0b03301b8771",
        "html_url": "https://github.com/apache/druid/commit/74cab7a76c99da457c3a883939cc0b03301b8771",
        "message": "Improve exception handling in extension druid-pac4j (#16979)\n\nChanges:\n- Simplify exception handling in `CryptoService` by just catching a `Exception`\n- Throw a `DruidException` as the exception is user facing\n- Log the exception for easier debugging\n- Add a test to verify thrown exception\n\n(cherry picked from commit d5b64ba2e3a4848f4d62157d9d50fec4953563fc)",
        "files": [
            {
                "sha": "e2f46a4062ea288cb905a07b77d5ab230ee86fbc",
                "filename": "extensions-core/druid-pac4j/src/test/java/org/apache/druid/security/pac4j/Pac4jSessionStoreTest.java",
                "status": "modified",
                "additions": 39,
                "deletions": 3,
                "changes": 42,
                "blob_url": "https://github.com/apache/druid/blob/74cab7a76c99da457c3a883939cc0b03301b8771/extensions-core%2Fdruid-pac4j%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fdruid%2Fsecurity%2Fpac4j%2FPac4jSessionStoreTest.java",
                "raw_url": "https://github.com/apache/druid/raw/74cab7a76c99da457c3a883939cc0b03301b8771/extensions-core%2Fdruid-pac4j%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fdruid%2Fsecurity%2Fpac4j%2FPac4jSessionStoreTest.java",
                "contents_url": "https://api.github.com/repos/apache/druid/contents/extensions-core%2Fdruid-pac4j%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fdruid%2Fsecurity%2Fpac4j%2FPac4jSessionStoreTest.java?ref=74cab7a76c99da457c3a883939cc0b03301b8771",
                "patch": "@@ -19,6 +19,7 @@\n \n package org.apache.druid.security.pac4j;\n \n+import org.apache.druid.error.DruidException;\n import org.easymock.Capture;\n import org.easymock.EasyMock;\n import org.junit.Assert;\n@@ -41,7 +42,7 @@ public class Pac4jSessionStoreTest\n   @Test\n   public void testSetAndGet()\n   {\n-    Pac4jSessionStore<WebContext> sessionStore = new Pac4jSessionStore(COOKIE_PASSPHRASE);\n+    Pac4jSessionStore<WebContext> sessionStore = new Pac4jSessionStore<>(COOKIE_PASSPHRASE);\n \n     WebContext webContext1 = EasyMock.mock(WebContext.class);\n     EasyMock.expect(webContext1.getScheme()).andReturn(\"https\");\n@@ -68,7 +69,7 @@ public void testSetAndGet()\n   @Test\n   public void testSetAndGetClearUserProfile()\n   {\n-    Pac4jSessionStore<WebContext> sessionStore = new Pac4jSessionStore(COOKIE_PASSPHRASE);\n+    Pac4jSessionStore<WebContext> sessionStore = new Pac4jSessionStore<>(COOKIE_PASSPHRASE);\n \n     WebContext webContext1 = EasyMock.mock(WebContext.class);\n     EasyMock.expect(webContext1.getScheme()).andReturn(\"https\");\n@@ -78,6 +79,7 @@ public void testSetAndGetClearUserProfile()\n     EasyMock.replay(webContext1);\n \n     CommonProfile profile = new CommonProfile();\n+    profile.setId(\"profile1\");\n     profile.addAttribute(CommonProfileDefinition.DISPLAY_NAME, \"name\");\n     sessionStore.set(webContext1, \"pac4jUserProfiles\", profile);\n \n@@ -99,7 +101,7 @@ public void testSetAndGetClearUserProfile()\n   @Test\n   public void testSetAndGetClearUserMultipleProfile()\n   {\n-    Pac4jSessionStore<WebContext> sessionStore = new Pac4jSessionStore(COOKIE_PASSPHRASE);\n+    Pac4jSessionStore<WebContext> sessionStore = new Pac4jSessionStore<>(COOKIE_PASSPHRASE);\n \n     WebContext webContext1 = EasyMock.mock(WebContext.class);\n     EasyMock.expect(webContext1.getScheme()).andReturn(\"https\");\n@@ -109,8 +111,10 @@ public void testSetAndGetClearUserMultipleProfile()\n     EasyMock.replay(webContext1);\n \n     CommonProfile profile1 = new CommonProfile();\n+    profile1.setId(\"profile1\");\n     profile1.addAttribute(CommonProfileDefinition.DISPLAY_NAME, \"name1\");\n     CommonProfile profile2 = new CommonProfile();\n+    profile2.setId(\"profile2\");\n     profile2.addAttribute(CommonProfileDefinition.DISPLAY_NAME, \"name2\");\n     Map<String, CommonProfile> profiles = new HashMap<>();\n     profiles.put(\"profile1\", profile1);\n@@ -131,4 +135,36 @@ public void testSetAndGetClearUserMultipleProfile()\n     Assert.assertTrue(Objects.requireNonNull(value).isPresent());\n     Assert.assertEquals(2, ((Map<String, CommonProfile>) value.get()).size());\n   }\n+\n+  @Test\n+  public void testGetWithWrongPassphraseThrowsDruidException()\n+  {\n+    final WebContext webContext = EasyMock.mock(WebContext.class);\n+    EasyMock.expect(webContext.getScheme()).andReturn(\"https\");\n+\n+    final Capture<Cookie> cookieCapture = EasyMock.newCapture();\n+    EasyMock.expect(webContext.getRequestCookies())\n+            .andAnswer(() -> Collections.singleton(cookieCapture.getValue()));\n+\n+    webContext.addResponseCookie(EasyMock.capture(cookieCapture));\n+    EasyMock.expectLastCall().once();\n+    EasyMock.replay(webContext);\n+\n+    // Create a cookie with an invalid passphrase\n+    new Pac4jSessionStore<>(\"invalid-passphrase\").set(webContext, \"key\", \"value\");\n+\n+    // Verify that trying to decrypt the invalid cookie throws an exception\n+    final Pac4jSessionStore<WebContext> sessionStore = new Pac4jSessionStore<>(COOKIE_PASSPHRASE);\n+    DruidException exception = Assert.assertThrows(\n+        DruidException.class,\n+        () -> sessionStore.get(webContext, \"key\")\n+    );\n+    Assert.assertEquals(\n+        \"Decryption failed. Check service logs.\",\n+        exception.getMessage()\n+    );\n+    Assert.assertNull(exception.getCause());\n+\n+    EasyMock.verify(webContext);\n+  }\n }"
            },
            {
                "sha": "92d4f6602c456917ea053f6988391b475c261876",
                "filename": "processing/src/main/java/org/apache/druid/crypto/CryptoService.java",
                "status": "modified",
                "additions": 10,
                "deletions": 10,
                "changes": 20,
                "blob_url": "https://github.com/apache/druid/blob/74cab7a76c99da457c3a883939cc0b03301b8771/processing%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fdruid%2Fcrypto%2FCryptoService.java",
                "raw_url": "https://github.com/apache/druid/raw/74cab7a76c99da457c3a883939cc0b03301b8771/processing%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fdruid%2Fcrypto%2FCryptoService.java",
                "contents_url": "https://api.github.com/repos/apache/druid/contents/processing%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fdruid%2Fcrypto%2FCryptoService.java?ref=74cab7a76c99da457c3a883939cc0b03301b8771",
                "patch": "@@ -20,25 +20,21 @@\n package org.apache.druid.crypto;\n \n import com.google.common.base.Preconditions;\n+import org.apache.druid.error.InternalServerError;\n import org.apache.druid.java.util.common.StringUtils;\n+import org.apache.druid.java.util.common.logger.Logger;\n \n import javax.annotation.Nullable;\n-import javax.crypto.BadPaddingException;\n import javax.crypto.Cipher;\n-import javax.crypto.IllegalBlockSizeException;\n-import javax.crypto.NoSuchPaddingException;\n import javax.crypto.SecretKey;\n import javax.crypto.SecretKeyFactory;\n import javax.crypto.spec.IvParameterSpec;\n import javax.crypto.spec.PBEKeySpec;\n import javax.crypto.spec.SecretKeySpec;\n import java.nio.ByteBuffer;\n-import java.security.InvalidAlgorithmParameterException;\n-import java.security.InvalidKeyException;\n import java.security.NoSuchAlgorithmException;\n import java.security.SecureRandom;\n import java.security.spec.InvalidKeySpecException;\n-import java.security.spec.InvalidParameterSpecException;\n import java.security.spec.KeySpec;\n \n /**\n@@ -50,6 +46,8 @@\n  */\n public class CryptoService\n {\n+  private static final Logger log = new Logger(CryptoService.class);\n+\n   // Based on Javadocs on SecureRandom, It is threadsafe as well.\n   private static final SecureRandom SECURE_RANDOM_INSTANCE = new SecureRandom();\n \n@@ -125,8 +123,9 @@ public byte[] encrypt(byte[] plain)\n           ecipher.doFinal(plain)\n       ).toByteAray();\n     }\n-    catch (InvalidKeySpecException | NoSuchAlgorithmException | NoSuchPaddingException | InvalidKeyException | InvalidParameterSpecException | IllegalBlockSizeException | BadPaddingException ex) {\n-      throw new RuntimeException(ex);\n+    catch (Exception ex) {\n+      log.noStackTrace().warn(ex, \"Encryption failed\");\n+      throw InternalServerError.exception(\"Encryption failed. Check service logs.\");\n     }\n   }\n \n@@ -145,8 +144,9 @@ public byte[] decrypt(byte[] data)\n       dcipher.init(Cipher.DECRYPT_MODE, secret, new IvParameterSpec(encryptedData.getIv()));\n       return dcipher.doFinal(encryptedData.getCipher());\n     }\n-    catch (InvalidKeySpecException | NoSuchAlgorithmException | InvalidAlgorithmParameterException | NoSuchPaddingException | InvalidKeyException | IllegalBlockSizeException | BadPaddingException ex) {\n-      throw new RuntimeException(ex);\n+    catch (Exception ex) {\n+      log.noStackTrace().warn(ex, \"Decryption failed\");\n+      throw InternalServerError.exception(\"Decryption failed. Check service logs.\");\n     }\n   }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/contao/contao/commits/d105224e14ddc84f27cd8802b553369decdcbe66",
        "url": "https://api.github.com/repos/contao/contao/commits/d105224e14ddc84f27cd8802b553369decdcbe66",
        "html_url": "https://github.com/contao/contao/commit/d105224e14ddc84f27cd8802b553369decdcbe66",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "880465b2c599f05a710b8f736528d593b22df998",
                "filename": "core-bundle/contao/pages/PageRegular.php",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/contao/contao/blob/d105224e14ddc84f27cd8802b553369decdcbe66/core-bundle%2Fcontao%2Fpages%2FPageRegular.php",
                "raw_url": "https://github.com/contao/contao/raw/d105224e14ddc84f27cd8802b553369decdcbe66/core-bundle%2Fcontao%2Fpages%2FPageRegular.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fcontao%2Fpages%2FPageRegular.php?ref=d105224e14ddc84f27cd8802b553369decdcbe66",
                "patch": "@@ -221,7 +221,10 @@ private function prepare($objPage)\n \t\t// Canonical\n \t\tif ($objPage->enableCanonical)\n \t\t{\n-\t\t\t$this->Template->canonical = htmlspecialchars($headBag->getCanonicalUriForRequest($request), ENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML5);\n+\t\t\t$this->Template->canonical = htmlspecialchars(\n+\t\t\t\tstr_replace(array('{', '}'), array('%7B', '%7D'), $headBag->getCanonicalUriForRequest($request)),\n+\t\t\t\tENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML5\n+\t\t\t);\n \t\t}\n \n \t\t// Fall back to the default title tag"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/contao/contao/commits/ffe05cda5310dc2bd259d1391197f3849dab8590",
        "url": "https://api.github.com/repos/contao/contao/commits/ffe05cda5310dc2bd259d1391197f3849dab8590",
        "html_url": "https://github.com/contao/contao/commit/ffe05cda5310dc2bd259d1391197f3849dab8590",
        "message": "Merge commit from fork\n\n* Strip insert tags from canonical URL\n\n* Encode special URL characters\n\nCo-authored-by: Martin Ausw\u00f6ger <martin@auswoeger.com>\n\n* CS\n\n---------\n\nCo-authored-by: Leo Feyer <1192057+leofeyer@users.noreply.github.com>\nCo-authored-by: Martin Ausw\u00f6ger <martin@auswoeger.com>",
        "files": [
            {
                "sha": "917505eac7ac5410ea100ddd0131d50ab8b615ec",
                "filename": "core-bundle/src/Resources/contao/pages/PageRegular.php",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/contao/contao/blob/ffe05cda5310dc2bd259d1391197f3849dab8590/core-bundle%2Fsrc%2FResources%2Fcontao%2Fpages%2FPageRegular.php",
                "raw_url": "https://github.com/contao/contao/raw/ffe05cda5310dc2bd259d1391197f3849dab8590/core-bundle%2Fsrc%2FResources%2Fcontao%2Fpages%2FPageRegular.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fsrc%2FResources%2Fcontao%2Fpages%2FPageRegular.php?ref=ffe05cda5310dc2bd259d1391197f3849dab8590",
                "patch": "@@ -239,7 +239,10 @@ protected function prepare($objPage)\n \t\t// Canonical\n \t\tif ($objPage->enableCanonical)\n \t\t{\n-\t\t\t$this->Template->canonical = htmlspecialchars($headBag->getCanonicalUriForRequest($request), ENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML5);\n+\t\t\t$this->Template->canonical = htmlspecialchars(\n+\t\t\t\tstr_replace(array('{', '}'), array('%7B', '%7D'), $headBag->getCanonicalUriForRequest($request)),\n+\t\t\t\tENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML5\n+\t\t\t);\n \t\t}\n \n \t\t// Fall back to the default title tag"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/contao/contao/commits/1c28e9ac7a7b915134962a59681a8701a44ccbe2",
        "url": "https://api.github.com/repos/contao/contao/commits/1c28e9ac7a7b915134962a59681a8701a44ccbe2",
        "html_url": "https://github.com/contao/contao/commit/1c28e9ac7a7b915134962a59681a8701a44ccbe2",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "880465b2c599f05a710b8f736528d593b22df998",
                "filename": "core-bundle/contao/pages/PageRegular.php",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/contao/contao/blob/1c28e9ac7a7b915134962a59681a8701a44ccbe2/core-bundle%2Fcontao%2Fpages%2FPageRegular.php",
                "raw_url": "https://github.com/contao/contao/raw/1c28e9ac7a7b915134962a59681a8701a44ccbe2/core-bundle%2Fcontao%2Fpages%2FPageRegular.php",
                "contents_url": "https://api.github.com/repos/contao/contao/contents/core-bundle%2Fcontao%2Fpages%2FPageRegular.php?ref=1c28e9ac7a7b915134962a59681a8701a44ccbe2",
                "patch": "@@ -221,7 +221,10 @@ private function prepare($objPage)\n \t\t// Canonical\n \t\tif ($objPage->enableCanonical)\n \t\t{\n-\t\t\t$this->Template->canonical = htmlspecialchars($headBag->getCanonicalUriForRequest($request), ENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML5);\n+\t\t\t$this->Template->canonical = htmlspecialchars(\n+\t\t\t\tstr_replace(array('{', '}'), array('%7B', '%7D'), $headBag->getCanonicalUriForRequest($request)),\n+\t\t\t\tENT_QUOTES | ENT_SUBSTITUTE | ENT_HTML5\n+\t\t\t);\n \t\t}\n \n \t\t// Fall back to the default title tag"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/wireui/wireui/commits/a457654912055f4dcc559da04d4e319f76b80fc5",
        "url": "https://api.github.com/repos/wireui/wireui/commits/a457654912055f4dcc559da04d4e319f76b80fc5",
        "html_url": "https://github.com/wireui/wireui/commit/a457654912055f4dcc559da04d4e319f76b80fc5",
        "message": "Merge pull request #964 from wireui/refactor\n\nRefactor",
        "files": [
            {
                "sha": "b8790f2be7dbf55e6b2af2b6dbc072593d5e27dd",
                "filename": "composer.lock",
                "status": "modified",
                "additions": 132,
                "deletions": 204,
                "changes": 336,
                "blob_url": "https://github.com/wireui/wireui/blob/a457654912055f4dcc559da04d4e319f76b80fc5/composer.lock",
                "raw_url": "https://github.com/wireui/wireui/raw/a457654912055f4dcc559da04d4e319f76b80fc5/composer.lock",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/composer.lock?ref=a457654912055f4dcc559da04d4e319f76b80fc5",
                "patch": "@@ -1052,16 +1052,16 @@\n         },\n         {\n             \"name\": \"laravel/framework\",\n-            \"version\": \"v11.21.0\",\n+            \"version\": \"v11.23.5\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/laravel/framework.git\",\n-                \"reference\": \"9d9d36708d56665b12185493f684abce38ad2d30\"\n+                \"reference\": \"16b31ab0e1dad5cb2ed6dcc1818c02f02fc48453\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/laravel/framework/zipball/9d9d36708d56665b12185493f684abce38ad2d30\",\n-                \"reference\": \"9d9d36708d56665b12185493f684abce38ad2d30\",\n+                \"url\": \"https://api.github.com/repos/laravel/framework/zipball/16b31ab0e1dad5cb2ed6dcc1818c02f02fc48453\",\n+                \"reference\": \"16b31ab0e1dad5cb2ed6dcc1818c02f02fc48453\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n@@ -1123,6 +1123,7 @@\n                 \"illuminate/bus\": \"self.version\",\n                 \"illuminate/cache\": \"self.version\",\n                 \"illuminate/collections\": \"self.version\",\n+                \"illuminate/concurrency\": \"self.version\",\n                 \"illuminate/conditionable\": \"self.version\",\n                 \"illuminate/config\": \"self.version\",\n                 \"illuminate/console\": \"self.version\",\n@@ -1165,7 +1166,7 @@\n                 \"league/flysystem-sftp-v3\": \"^3.0\",\n                 \"mockery/mockery\": \"^1.6\",\n                 \"nyholm/psr7\": \"^1.2\",\n-                \"orchestra/testbench-core\": \"^9.1.5\",\n+                \"orchestra/testbench-core\": \"^9.4.0\",\n                 \"pda/pheanstalk\": \"^5.0\",\n                 \"phpstan/phpstan\": \"^1.11.5\",\n                 \"phpunit/phpunit\": \"^10.5|^11.0\",\n@@ -1223,6 +1224,7 @@\n                     \"src/Illuminate/Events/functions.php\",\n                     \"src/Illuminate/Filesystem/functions.php\",\n                     \"src/Illuminate/Foundation/helpers.php\",\n+                    \"src/Illuminate/Log/functions.php\",\n                     \"src/Illuminate/Support/helpers.php\"\n                 ],\n                 \"psr-4\": {\n@@ -1254,7 +1256,7 @@\n                 \"issues\": \"https://github.com/laravel/framework/issues\",\n                 \"source\": \"https://github.com/laravel/framework\"\n             },\n-            \"time\": \"2024-08-20T15:00:52+00:00\"\n+            \"time\": \"2024-09-13T13:36:30+00:00\"\n         },\n         {\n             \"name\": \"laravel/prompts\",\n@@ -2108,16 +2110,16 @@\n         },\n         {\n             \"name\": \"nunomaduro/termwind\",\n-            \"version\": \"v2.0.1\",\n+            \"version\": \"v2.1.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/nunomaduro/termwind.git\",\n-                \"reference\": \"58c4c58cf23df7f498daeb97092e34f5259feb6a\"\n+                \"reference\": \"e5f21eade88689536c0cdad4c3cd75f3ed26e01a\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/nunomaduro/termwind/zipball/58c4c58cf23df7f498daeb97092e34f5259feb6a\",\n-                \"reference\": \"58c4c58cf23df7f498daeb97092e34f5259feb6a\",\n+                \"url\": \"https://api.github.com/repos/nunomaduro/termwind/zipball/e5f21eade88689536c0cdad4c3cd75f3ed26e01a\",\n+                \"reference\": \"e5f21eade88689536c0cdad4c3cd75f3ed26e01a\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n@@ -2127,11 +2129,11 @@\n             },\n             \"require-dev\": {\n                 \"ergebnis/phpstan-rules\": \"^2.2.0\",\n-                \"illuminate/console\": \"^11.0.0\",\n-                \"laravel/pint\": \"^1.14.0\",\n-                \"mockery/mockery\": \"^1.6.7\",\n-                \"pestphp/pest\": \"^2.34.1\",\n-                \"phpstan/phpstan\": \"^1.10.59\",\n+                \"illuminate/console\": \"^11.1.1\",\n+                \"laravel/pint\": \"^1.15.0\",\n+                \"mockery/mockery\": \"^1.6.11\",\n+                \"pestphp/pest\": \"^2.34.6\",\n+                \"phpstan/phpstan\": \"^1.10.66\",\n                 \"phpstan/phpstan-strict-rules\": \"^1.5.2\",\n                 \"symfony/var-dumper\": \"^7.0.4\",\n                 \"thecodingmachine/phpstan-strict-rules\": \"^1.0.0\"\n@@ -2176,7 +2178,7 @@\n             ],\n             \"support\": {\n                 \"issues\": \"https://github.com/nunomaduro/termwind/issues\",\n-                \"source\": \"https://github.com/nunomaduro/termwind/tree/v2.0.1\"\n+                \"source\": \"https://github.com/nunomaduro/termwind/tree/v2.1.0\"\n             },\n             \"funding\": [\n                 {\n@@ -2192,7 +2194,7 @@\n                     \"type\": \"github\"\n                 }\n             ],\n-            \"time\": \"2024-03-06T16:17:14+00:00\"\n+            \"time\": \"2024-09-05T15:25:50+00:00\"\n         },\n         {\n             \"name\": \"phpoption/phpoption\",\n@@ -2582,16 +2584,16 @@\n         },\n         {\n             \"name\": \"psr/log\",\n-            \"version\": \"3.0.1\",\n+            \"version\": \"3.0.2\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/php-fig/log.git\",\n-                \"reference\": \"79dff0b268932c640297f5208d6298f71855c03e\"\n+                \"reference\": \"f16e1d5863e37f8d8c2a01719f5b34baa2b714d3\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/php-fig/log/zipball/79dff0b268932c640297f5208d6298f71855c03e\",\n-                \"reference\": \"79dff0b268932c640297f5208d6298f71855c03e\",\n+                \"url\": \"https://api.github.com/repos/php-fig/log/zipball/f16e1d5863e37f8d8c2a01719f5b34baa2b714d3\",\n+                \"reference\": \"f16e1d5863e37f8d8c2a01719f5b34baa2b714d3\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n@@ -2626,9 +2628,9 @@\n                 \"psr-3\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/php-fig/log/tree/3.0.1\"\n+                \"source\": \"https://github.com/php-fig/log/tree/3.0.2\"\n             },\n-            \"time\": \"2024-08-21T13:31:24+00:00\"\n+            \"time\": \"2024-09-11T13:17:53+00:00\"\n         },\n         {\n             \"name\": \"psr/simple-cache\",\n@@ -3857,20 +3859,20 @@\n         },\n         {\n             \"name\": \"symfony/polyfill-ctype\",\n-            \"version\": \"v1.30.0\",\n+            \"version\": \"v1.31.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/symfony/polyfill-ctype.git\",\n-                \"reference\": \"0424dff1c58f028c451efff2045f5d92410bd540\"\n+                \"reference\": \"a3cc8b044a6ea513310cbd48ef7333b384945638\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-ctype/zipball/0424dff1c58f028c451efff2045f5d92410bd540\",\n-                \"reference\": \"0424dff1c58f028c451efff2045f5d92410bd540\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-ctype/zipball/a3cc8b044a6ea513310cbd48ef7333b384945638\",\n+                \"reference\": \"a3cc8b044a6ea513310cbd48ef7333b384945638\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n-                \"php\": \">=7.1\"\n+                \"php\": \">=7.2\"\n             },\n             \"provide\": {\n                 \"ext-ctype\": \"*\"\n@@ -3916,7 +3918,7 @@\n                 \"portable\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-ctype/tree/v1.30.0\"\n+                \"source\": \"https://github.com/symfony/polyfill-ctype/tree/v1.31.0\"\n             },\n             \"funding\": [\n                 {\n@@ -3932,24 +3934,24 @@\n                     \"type\": \"tidelift\"\n                 }\n             ],\n-            \"time\": \"2024-05-31T15:07:36+00:00\"\n+            \"time\": \"2024-09-09T11:45:10+00:00\"\n         },\n         {\n             \"name\": \"symfony/polyfill-intl-grapheme\",\n-            \"version\": \"v1.30.0\",\n+            \"version\": \"v1.31.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/symfony/polyfill-intl-grapheme.git\",\n-                \"reference\": \"64647a7c30b2283f5d49b874d84a18fc22054b7a\"\n+                \"reference\": \"b9123926e3b7bc2f98c02ad54f6a4b02b91a8abe\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-grapheme/zipball/64647a7c30b2283f5d49b874d84a18fc22054b7a\",\n-                \"reference\": \"64647a7c30b2283f5d49b874d84a18fc22054b7a\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-grapheme/zipball/b9123926e3b7bc2f98c02ad54f6a4b02b91a8abe\",\n+                \"reference\": \"b9123926e3b7bc2f98c02ad54f6a4b02b91a8abe\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n-                \"php\": \">=7.1\"\n+                \"php\": \">=7.2\"\n             },\n             \"suggest\": {\n                 \"ext-intl\": \"For best performance\"\n@@ -3994,7 +3996,7 @@\n                 \"shim\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-intl-grapheme/tree/v1.30.0\"\n+                \"source\": \"https://github.com/symfony/polyfill-intl-grapheme/tree/v1.31.0\"\n             },\n             \"funding\": [\n                 {\n@@ -4010,26 +4012,25 @@\n                     \"type\": \"tidelift\"\n                 }\n             ],\n-            \"time\": \"2024-05-31T15:07:36+00:00\"\n+            \"time\": \"2024-09-09T11:45:10+00:00\"\n         },\n         {\n             \"name\": \"symfony/polyfill-intl-idn\",\n-            \"version\": \"v1.30.0\",\n+            \"version\": \"v1.31.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/symfony/polyfill-intl-idn.git\",\n-                \"reference\": \"a6e83bdeb3c84391d1dfe16f42e40727ce524a5c\"\n+                \"reference\": \"c36586dcf89a12315939e00ec9b4474adcb1d773\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-idn/zipball/a6e83bdeb3c84391d1dfe16f42e40727ce524a5c\",\n-                \"reference\": \"a6e83bdeb3c84391d1dfe16f42e40727ce524a5c\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-idn/zipball/c36586dcf89a12315939e00ec9b4474adcb1d773\",\n+                \"reference\": \"c36586dcf89a12315939e00ec9b4474adcb1d773\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n-                \"php\": \">=7.1\",\n-                \"symfony/polyfill-intl-normalizer\": \"^1.10\",\n-                \"symfony/polyfill-php72\": \"^1.10\"\n+                \"php\": \">=7.2\",\n+                \"symfony/polyfill-intl-normalizer\": \"^1.10\"\n             },\n             \"suggest\": {\n                 \"ext-intl\": \"For best performance\"\n@@ -4078,7 +4079,7 @@\n                 \"shim\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-intl-idn/tree/v1.30.0\"\n+                \"source\": \"https://github.com/symfony/polyfill-intl-idn/tree/v1.31.0\"\n             },\n             \"funding\": [\n                 {\n@@ -4094,24 +4095,24 @@\n                     \"type\": \"tidelift\"\n                 }\n             ],\n-            \"time\": \"2024-05-31T15:07:36+00:00\"\n+            \"time\": \"2024-09-09T11:45:10+00:00\"\n         },\n         {\n             \"name\": \"symfony/polyfill-intl-normalizer\",\n-            \"version\": \"v1.30.0\",\n+            \"version\": \"v1.31.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/symfony/polyfill-intl-normalizer.git\",\n-                \"reference\": \"a95281b0be0d9ab48050ebd988b967875cdb9fdb\"\n+                \"reference\": \"3833d7255cc303546435cb650316bff708a1c75c\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-normalizer/zipball/a95281b0be0d9ab48050ebd988b967875cdb9fdb\",\n-                \"reference\": \"a95281b0be0d9ab48050ebd988b967875cdb9fdb\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-intl-normalizer/zipball/3833d7255cc303546435cb650316bff708a1c75c\",\n+                \"reference\": \"3833d7255cc303546435cb650316bff708a1c75c\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n-                \"php\": \">=7.1\"\n+                \"php\": \">=7.2\"\n             },\n             \"suggest\": {\n                 \"ext-intl\": \"For best performance\"\n@@ -4159,7 +4160,7 @@\n                 \"shim\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-intl-normalizer/tree/v1.30.0\"\n+                \"source\": \"https://github.com/symfony/polyfill-intl-normalizer/tree/v1.31.0\"\n             },\n             \"funding\": [\n                 {\n@@ -4175,24 +4176,24 @@\n                     \"type\": \"tidelift\"\n                 }\n             ],\n-            \"time\": \"2024-05-31T15:07:36+00:00\"\n+            \"time\": \"2024-09-09T11:45:10+00:00\"\n         },\n         {\n             \"name\": \"symfony/polyfill-mbstring\",\n-            \"version\": \"v1.30.0\",\n+            \"version\": \"v1.31.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/symfony/polyfill-mbstring.git\",\n-                \"reference\": \"fd22ab50000ef01661e2a31d850ebaa297f8e03c\"\n+                \"reference\": \"85181ba99b2345b0ef10ce42ecac37612d9fd341\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-mbstring/zipball/fd22ab50000ef01661e2a31d850ebaa297f8e03c\",\n-                \"reference\": \"fd22ab50000ef01661e2a31d850ebaa297f8e03c\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-mbstring/zipball/85181ba99b2345b0ef10ce42ecac37612d9fd341\",\n+                \"reference\": \"85181ba99b2345b0ef10ce42ecac37612d9fd341\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n-                \"php\": \">=7.1\"\n+                \"php\": \">=7.2\"\n             },\n             \"provide\": {\n                 \"ext-mbstring\": \"*\"\n@@ -4239,80 +4240,7 @@\n                 \"shim\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-mbstring/tree/v1.30.0\"\n-            },\n-            \"funding\": [\n-                {\n-                    \"url\": \"https://symfony.com/sponsor\",\n-                    \"type\": \"custom\"\n-                },\n-                {\n-                    \"url\": \"https://github.com/fabpot\",\n-                    \"type\": \"github\"\n-                },\n-                {\n-                    \"url\": \"https://tidelift.com/funding/github/packagist/symfony/symfony\",\n-                    \"type\": \"tidelift\"\n-                }\n-            ],\n-            \"time\": \"2024-06-19T12:30:46+00:00\"\n-        },\n-        {\n-            \"name\": \"symfony/polyfill-php72\",\n-            \"version\": \"v1.30.0\",\n-            \"source\": {\n-                \"type\": \"git\",\n-                \"url\": \"https://github.com/symfony/polyfill-php72.git\",\n-                \"reference\": \"10112722600777e02d2745716b70c5db4ca70442\"\n-            },\n-            \"dist\": {\n-                \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-php72/zipball/10112722600777e02d2745716b70c5db4ca70442\",\n-                \"reference\": \"10112722600777e02d2745716b70c5db4ca70442\",\n-                \"shasum\": \"\"\n-            },\n-            \"require\": {\n-                \"php\": \">=7.1\"\n-            },\n-            \"type\": \"library\",\n-            \"extra\": {\n-                \"thanks\": {\n-                    \"name\": \"symfony/polyfill\",\n-                    \"url\": \"https://github.com/symfony/polyfill\"\n-                }\n-            },\n-            \"autoload\": {\n-                \"files\": [\n-                    \"bootstrap.php\"\n-                ],\n-                \"psr-4\": {\n-                    \"Symfony\\\\Polyfill\\\\Php72\\\\\": \"\"\n-                }\n-            },\n-            \"notification-url\": \"https://packagist.org/downloads/\",\n-            \"license\": [\n-                \"MIT\"\n-            ],\n-            \"authors\": [\n-                {\n-                    \"name\": \"Nicolas Grekas\",\n-                    \"email\": \"p@tchwork.com\"\n-                },\n-                {\n-                    \"name\": \"Symfony Community\",\n-                    \"homepage\": \"https://symfony.com/contributors\"\n-                }\n-            ],\n-            \"description\": \"Symfony polyfill backporting some PHP 7.2+ features to lower PHP versions\",\n-            \"homepage\": \"https://symfony.com\",\n-            \"keywords\": [\n-                \"compatibility\",\n-                \"polyfill\",\n-                \"portable\",\n-                \"shim\"\n-            ],\n-            \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-php72/tree/v1.30.0\"\n+                \"source\": \"https://github.com/symfony/polyfill-mbstring/tree/v1.31.0\"\n             },\n             \"funding\": [\n                 {\n@@ -4328,24 +4256,24 @@\n                     \"type\": \"tidelift\"\n                 }\n             ],\n-            \"time\": \"2024-06-19T12:30:46+00:00\"\n+            \"time\": \"2024-09-09T11:45:10+00:00\"\n         },\n         {\n             \"name\": \"symfony/polyfill-php80\",\n-            \"version\": \"v1.30.0\",\n+            \"version\": \"v1.31.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/symfony/polyfill-php80.git\",\n-                \"reference\": \"77fa7995ac1b21ab60769b7323d600a991a90433\"\n+                \"reference\": \"60328e362d4c2c802a54fcbf04f9d3fb892b4cf8\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-php80/zipball/77fa7995ac1b21ab60769b7323d600a991a90433\",\n-                \"reference\": \"77fa7995ac1b21ab60769b7323d600a991a90433\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-php80/zipball/60328e362d4c2c802a54fcbf04f9d3fb892b4cf8\",\n+                \"reference\": \"60328e362d4c2c802a54fcbf04f9d3fb892b4cf8\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n-                \"php\": \">=7.1\"\n+                \"php\": \">=7.2\"\n             },\n             \"type\": \"library\",\n             \"extra\": {\n@@ -4392,7 +4320,7 @@\n                 \"shim\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-php80/tree/v1.30.0\"\n+                \"source\": \"https://github.com/symfony/polyfill-php80/tree/v1.31.0\"\n             },\n             \"funding\": [\n                 {\n@@ -4408,24 +4336,24 @@\n                     \"type\": \"tidelift\"\n                 }\n             ],\n-            \"time\": \"2024-05-31T15:07:36+00:00\"\n+            \"time\": \"2024-09-09T11:45:10+00:00\"\n         },\n         {\n             \"name\": \"symfony/polyfill-php83\",\n-            \"version\": \"v1.30.0\",\n+            \"version\": \"v1.31.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/symfony/polyfill-php83.git\",\n-                \"reference\": \"dbdcdf1a4dcc2743591f1079d0c35ab1e2dcbbc9\"\n+                \"reference\": \"2fb86d65e2d424369ad2905e83b236a8805ba491\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-php83/zipball/dbdcdf1a4dcc2743591f1079d0c35ab1e2dcbbc9\",\n-                \"reference\": \"dbdcdf1a4dcc2743591f1079d0c35ab1e2dcbbc9\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-php83/zipball/2fb86d65e2d424369ad2905e83b236a8805ba491\",\n+                \"reference\": \"2fb86d65e2d424369ad2905e83b236a8805ba491\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n-                \"php\": \">=7.1\"\n+                \"php\": \">=7.2\"\n             },\n             \"type\": \"library\",\n             \"extra\": {\n@@ -4468,7 +4396,7 @@\n                 \"shim\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-php83/tree/v1.30.0\"\n+                \"source\": \"https://github.com/symfony/polyfill-php83/tree/v1.31.0\"\n             },\n             \"funding\": [\n                 {\n@@ -4484,24 +4412,24 @@\n                     \"type\": \"tidelift\"\n                 }\n             ],\n-            \"time\": \"2024-06-19T12:35:24+00:00\"\n+            \"time\": \"2024-09-09T11:45:10+00:00\"\n         },\n         {\n             \"name\": \"symfony/polyfill-uuid\",\n-            \"version\": \"v1.30.0\",\n+            \"version\": \"v1.31.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/symfony/polyfill-uuid.git\",\n-                \"reference\": \"2ba1f33797470debcda07fe9dce20a0003df18e9\"\n+                \"reference\": \"21533be36c24be3f4b1669c4725c7d1d2bab4ae2\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-uuid/zipball/2ba1f33797470debcda07fe9dce20a0003df18e9\",\n-                \"reference\": \"2ba1f33797470debcda07fe9dce20a0003df18e9\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-uuid/zipball/21533be36c24be3f4b1669c4725c7d1d2bab4ae2\",\n+                \"reference\": \"21533be36c24be3f4b1669c4725c7d1d2bab4ae2\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n-                \"php\": \">=7.1\"\n+                \"php\": \">=7.2\"\n             },\n             \"provide\": {\n                 \"ext-uuid\": \"*\"\n@@ -4547,7 +4475,7 @@\n                 \"uuid\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-uuid/tree/v1.30.0\"\n+                \"source\": \"https://github.com/symfony/polyfill-uuid/tree/v1.31.0\"\n             },\n             \"funding\": [\n                 {\n@@ -4563,7 +4491,7 @@\n                     \"type\": \"tidelift\"\n                 }\n             ],\n-            \"time\": \"2024-05-31T15:07:36+00:00\"\n+            \"time\": \"2024-09-09T11:45:10+00:00\"\n         },\n         {\n             \"name\": \"symfony/process\",\n@@ -6142,16 +6070,16 @@\n         },\n         {\n             \"name\": \"laravel/pint\",\n-            \"version\": \"v1.17.2\",\n+            \"version\": \"v1.17.3\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/laravel/pint.git\",\n-                \"reference\": \"e8a88130a25e3f9d4d5785e6a1afca98268ab110\"\n+                \"reference\": \"9d77be916e145864f10788bb94531d03e1f7b482\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/laravel/pint/zipball/e8a88130a25e3f9d4d5785e6a1afca98268ab110\",\n-                \"reference\": \"e8a88130a25e3f9d4d5785e6a1afca98268ab110\",\n+                \"url\": \"https://api.github.com/repos/laravel/pint/zipball/9d77be916e145864f10788bb94531d03e1f7b482\",\n+                \"reference\": \"9d77be916e145864f10788bb94531d03e1f7b482\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n@@ -6162,13 +6090,13 @@\n                 \"php\": \"^8.1.0\"\n             },\n             \"require-dev\": {\n-                \"friendsofphp/php-cs-fixer\": \"^3.61.1\",\n-                \"illuminate/view\": \"^10.48.18\",\n+                \"friendsofphp/php-cs-fixer\": \"^3.64.0\",\n+                \"illuminate/view\": \"^10.48.20\",\n                 \"larastan/larastan\": \"^2.9.8\",\n                 \"laravel-zero/framework\": \"^10.4.0\",\n                 \"mockery/mockery\": \"^1.6.12\",\n                 \"nunomaduro/termwind\": \"^1.15.1\",\n-                \"pestphp/pest\": \"^2.35.0\"\n+                \"pestphp/pest\": \"^2.35.1\"\n             },\n             \"bin\": [\n                 \"builds/pint\"\n@@ -6204,7 +6132,7 @@\n                 \"issues\": \"https://github.com/laravel/pint/issues\",\n                 \"source\": \"https://github.com/laravel/pint\"\n             },\n-            \"time\": \"2024-08-06T15:11:54+00:00\"\n+            \"time\": \"2024-09-03T15:00:28+00:00\"\n         },\n         {\n             \"name\": \"laravel/tinker\",\n@@ -6493,16 +6421,16 @@\n         },\n         {\n             \"name\": \"nikic/php-parser\",\n-            \"version\": \"v5.1.0\",\n+            \"version\": \"v5.2.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/nikic/PHP-Parser.git\",\n-                \"reference\": \"683130c2ff8c2739f4822ff7ac5c873ec529abd1\"\n+                \"reference\": \"23c79fbbfb725fb92af9bcf41065c8e9a0d49ddb\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/nikic/PHP-Parser/zipball/683130c2ff8c2739f4822ff7ac5c873ec529abd1\",\n-                \"reference\": \"683130c2ff8c2739f4822ff7ac5c873ec529abd1\",\n+                \"url\": \"https://api.github.com/repos/nikic/PHP-Parser/zipball/23c79fbbfb725fb92af9bcf41065c8e9a0d49ddb\",\n+                \"reference\": \"23c79fbbfb725fb92af9bcf41065c8e9a0d49ddb\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n@@ -6545,9 +6473,9 @@\n             ],\n             \"support\": {\n                 \"issues\": \"https://github.com/nikic/PHP-Parser/issues\",\n-                \"source\": \"https://github.com/nikic/PHP-Parser/tree/v5.1.0\"\n+                \"source\": \"https://github.com/nikic/PHP-Parser/tree/v5.2.0\"\n             },\n-            \"time\": \"2024-07-01T20:03:41+00:00\"\n+            \"time\": \"2024-09-15T16:40:33+00:00\"\n         },\n         {\n             \"name\": \"nunomaduro/collision\",\n@@ -6919,16 +6847,16 @@\n         },\n         {\n             \"name\": \"orchestra/testbench-core\",\n-            \"version\": \"v9.4.0\",\n+            \"version\": \"v9.4.1\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/orchestral/testbench-core.git\",\n-                \"reference\": \"422827e195741ca397408eced09ca473ebbb4086\"\n+                \"reference\": \"b1f1a046cafd07d2a7b0cb96e9a2911aee160515\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/orchestral/testbench-core/zipball/422827e195741ca397408eced09ca473ebbb4086\",\n-                \"reference\": \"422827e195741ca397408eced09ca473ebbb4086\",\n+                \"url\": \"https://api.github.com/repos/orchestral/testbench-core/zipball/b1f1a046cafd07d2a7b0cb96e9a2911aee160515\",\n+                \"reference\": \"b1f1a046cafd07d2a7b0cb96e9a2911aee160515\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n@@ -7005,20 +6933,20 @@\n                 \"issues\": \"https://github.com/orchestral/testbench/issues\",\n                 \"source\": \"https://github.com/orchestral/testbench-core\"\n             },\n-            \"time\": \"2024-08-26T05:01:33+00:00\"\n+            \"time\": \"2024-09-12T10:54:24+00:00\"\n         },\n         {\n             \"name\": \"orchestra/testbench-dusk\",\n-            \"version\": \"v9.7.0\",\n+            \"version\": \"v9.7.1\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/orchestral/testbench-dusk.git\",\n-                \"reference\": \"2396698c35416965cf0aca676dbd5a3649ea0702\"\n+                \"reference\": \"7bfbce414963a583df7abe1f35c2e92677b187b9\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/orchestral/testbench-dusk/zipball/2396698c35416965cf0aca676dbd5a3649ea0702\",\n-                \"reference\": \"2396698c35416965cf0aca676dbd5a3649ea0702\",\n+                \"url\": \"https://api.github.com/repos/orchestral/testbench-dusk/zipball/7bfbce414963a583df7abe1f35c2e92677b187b9\",\n+                \"reference\": \"7bfbce414963a583df7abe1f35c2e92677b187b9\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n@@ -7071,9 +6999,9 @@\n             \"description\": \"Laravel Dusk Testing Helper for Packages Development\",\n             \"support\": {\n                 \"issues\": \"https://github.com/orchestral/testbench-dusk/issues\",\n-                \"source\": \"https://github.com/orchestral/testbench-dusk/tree/v9.7.0\"\n+                \"source\": \"https://github.com/orchestral/testbench-dusk/tree/v9.7.1\"\n             },\n-            \"time\": \"2024-08-26T06:38:19+00:00\"\n+            \"time\": \"2024-09-12T11:03:19+00:00\"\n         },\n         {\n             \"name\": \"orchestra/workbench\",\n@@ -8019,16 +7947,16 @@\n         },\n         {\n             \"name\": \"phpstan/phpdoc-parser\",\n-            \"version\": \"1.30.0\",\n+            \"version\": \"1.30.1\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/phpstan/phpdoc-parser.git\",\n-                \"reference\": \"5ceb0e384997db59f38774bf79c2a6134252c08f\"\n+                \"reference\": \"51b95ec8670af41009e2b2b56873bad96682413e\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/phpstan/phpdoc-parser/zipball/5ceb0e384997db59f38774bf79c2a6134252c08f\",\n-                \"reference\": \"5ceb0e384997db59f38774bf79c2a6134252c08f\",\n+                \"url\": \"https://api.github.com/repos/phpstan/phpdoc-parser/zipball/51b95ec8670af41009e2b2b56873bad96682413e\",\n+                \"reference\": \"51b95ec8670af41009e2b2b56873bad96682413e\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n@@ -8060,22 +7988,22 @@\n             \"description\": \"PHPDoc parser with support for nullable, intersection and generic types\",\n             \"support\": {\n                 \"issues\": \"https://github.com/phpstan/phpdoc-parser/issues\",\n-                \"source\": \"https://github.com/phpstan/phpdoc-parser/tree/1.30.0\"\n+                \"source\": \"https://github.com/phpstan/phpdoc-parser/tree/1.30.1\"\n             },\n-            \"time\": \"2024-08-29T09:54:52+00:00\"\n+            \"time\": \"2024-09-07T20:13:05+00:00\"\n         },\n         {\n             \"name\": \"phpstan/phpstan\",\n-            \"version\": \"1.12.0\",\n+            \"version\": \"1.12.3\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/phpstan/phpstan.git\",\n-                \"reference\": \"384af967d35b2162f69526c7276acadce534d0e1\"\n+                \"reference\": \"0fcbf194ab63d8159bb70d9aa3e1350051632009\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/phpstan/phpstan/zipball/384af967d35b2162f69526c7276acadce534d0e1\",\n-                \"reference\": \"384af967d35b2162f69526c7276acadce534d0e1\",\n+                \"url\": \"https://api.github.com/repos/phpstan/phpstan/zipball/0fcbf194ab63d8159bb70d9aa3e1350051632009\",\n+                \"reference\": \"0fcbf194ab63d8159bb70d9aa3e1350051632009\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n@@ -8120,7 +8048,7 @@\n                     \"type\": \"github\"\n                 }\n             ],\n-            \"time\": \"2024-08-27T09:18:05+00:00\"\n+            \"time\": \"2024-09-09T08:10:35+00:00\"\n         },\n         {\n             \"name\": \"phpunit/php-code-coverage\",\n@@ -8625,21 +8553,21 @@\n         },\n         {\n             \"name\": \"rector/rector\",\n-            \"version\": \"1.2.4\",\n+            \"version\": \"1.2.5\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/rectorphp/rector.git\",\n-                \"reference\": \"42a4aa23b48b4cfc8ebfeac2b570364e27744381\"\n+                \"reference\": \"e98aa793ca3fcd17e893cfaf9103ac049775d339\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/rectorphp/rector/zipball/42a4aa23b48b4cfc8ebfeac2b570364e27744381\",\n-                \"reference\": \"42a4aa23b48b4cfc8ebfeac2b570364e27744381\",\n+                \"url\": \"https://api.github.com/repos/rectorphp/rector/zipball/e98aa793ca3fcd17e893cfaf9103ac049775d339\",\n+                \"reference\": \"e98aa793ca3fcd17e893cfaf9103ac049775d339\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n                 \"php\": \"^7.2|^8.0\",\n-                \"phpstan/phpstan\": \"^1.11.11\"\n+                \"phpstan/phpstan\": \"^1.12.2\"\n             },\n             \"conflict\": {\n                 \"rector/rector-doctrine\": \"*\",\n@@ -8672,15 +8600,15 @@\n             ],\n             \"support\": {\n                 \"issues\": \"https://github.com/rectorphp/rector/issues\",\n-                \"source\": \"https://github.com/rectorphp/rector/tree/1.2.4\"\n+                \"source\": \"https://github.com/rectorphp/rector/tree/1.2.5\"\n             },\n             \"funding\": [\n                 {\n                     \"url\": \"https://github.com/tomasvotruba\",\n                     \"type\": \"github\"\n                 }\n             ],\n-            \"time\": \"2024-08-23T09:03:01+00:00\"\n+            \"time\": \"2024-09-08T17:43:24+00:00\"\n         },\n         {\n             \"name\": \"sebastian/cli-parser\",\n@@ -9885,20 +9813,20 @@\n         },\n         {\n             \"name\": \"symfony/polyfill-iconv\",\n-            \"version\": \"v1.30.0\",\n+            \"version\": \"v1.31.0\",\n             \"source\": {\n                 \"type\": \"git\",\n                 \"url\": \"https://github.com/symfony/polyfill-iconv.git\",\n-                \"reference\": \"c027e6a3c6aee334663ec21f5852e89738abc805\"\n+                \"reference\": \"48becf00c920479ca2e910c22a5a39e5d47ca956\"\n             },\n             \"dist\": {\n                 \"type\": \"zip\",\n-                \"url\": \"https://api.github.com/repos/symfony/polyfill-iconv/zipball/c027e6a3c6aee334663ec21f5852e89738abc805\",\n-                \"reference\": \"c027e6a3c6aee334663ec21f5852e89738abc805\",\n+                \"url\": \"https://api.github.com/repos/symfony/polyfill-iconv/zipball/48becf00c920479ca2e910c22a5a39e5d47ca956\",\n+                \"reference\": \"48becf00c920479ca2e910c22a5a39e5d47ca956\",\n                 \"shasum\": \"\"\n             },\n             \"require\": {\n-                \"php\": \">=7.1\"\n+                \"php\": \">=7.2\"\n             },\n             \"provide\": {\n                 \"ext-iconv\": \"*\"\n@@ -9945,7 +9873,7 @@\n                 \"shim\"\n             ],\n             \"support\": {\n-                \"source\": \"https://github.com/symfony/polyfill-iconv/tree/v1.30.0\"\n+                \"source\": \"https://github.com/symfony/polyfill-iconv/tree/v1.31.0\"\n             },\n             \"funding\": [\n                 {\n@@ -9961,7 +9889,7 @@\n                     \"type\": \"tidelift\"\n                 }\n             ],\n-            \"time\": \"2024-05-31T15:07:36+00:00\"\n+            \"time\": \"2024-09-09T11:45:10+00:00\"\n         },\n         {\n             \"name\": \"symfony/stopwatch\","
            },
            {
                "sha": "b30ef8ab8fd9fcc8837f52f9a959e569ccb90d7d",
                "filename": "src/Http/Controllers/ButtonController.php",
                "status": "modified",
                "additions": 8,
                "deletions": 19,
                "changes": 27,
                "blob_url": "https://github.com/wireui/wireui/blob/a457654912055f4dcc559da04d4e319f76b80fc5/src%2FHttp%2FControllers%2FButtonController.php",
                "raw_url": "https://github.com/wireui/wireui/raw/a457654912055f4dcc559da04d4e319f76b80fc5/src%2FHttp%2FControllers%2FButtonController.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/src%2FHttp%2FControllers%2FButtonController.php?ref=a457654912055f4dcc559da04d4e319f76b80fc5",
                "patch": "@@ -3,40 +3,29 @@\n namespace WireUi\\Http\\Controllers;\n \n use Illuminate\\Http\\Response;\n+use Illuminate\\Support\\Facades\\Blade;\n use Illuminate\\View\\ComponentAttributeBag;\n use WireUi\\Http\\Requests\\ButtonRequest;\n-use WireUi\\Support\\BladeCompiler;\n \n class ButtonController extends Controller\n {\n-    private BladeCompiler $compiler;\n-\n-    public function __construct(BladeCompiler $compiler)\n-    {\n-        $this->compiler = $compiler;\n-    }\n-\n     public function __invoke(ButtonRequest $request): Response\n     {\n-        $blade = <<<EOT\n+        $blade = <<<'BLADE'\n             <x-dynamic-component\n                 :component=\"WireUi::component('button')\"\n-                {$this->attributes($request->all())->toHtml()}\n+                :attributes=\"$attributes\"\n             />\n-        EOT;\n+        BLADE;\n+\n+        $attributes = new ComponentAttributeBag($request->validated());\n \n-        $html = $this->compiler->compile($blade);\n+        $html = Blade::render($blade, ['attributes' => $attributes]);\n \n         return response($html)->withHeaders([\n             'Content-Type' => 'text/html; charset=utf-8',\n             'Cache-Control' => 'public, only-if-cached, max-age=31536000',\n+            'Content-Security-Policy' => \"default-src 'self'; script-src 'none';\",\n         ]);\n     }\n-\n-    protected function attributes(array $attributes): ComponentAttributeBag\n-    {\n-        $attributes = new ComponentAttributeBag($attributes);\n-\n-        return $attributes->whereDoesntStartWith(':');\n-    }\n }"
            },
            {
                "sha": "d3a3c661d3c0d8538e97cc22f40416d5d038297d",
                "filename": "src/Support/BladeCompiler.php",
                "status": "removed",
                "additions": 0,
                "deletions": 49,
                "changes": 49,
                "blob_url": "https://github.com/wireui/wireui/blob/9571fa86dfc7719ac1915c103abd4693b8e77b43/src%2FSupport%2FBladeCompiler.php",
                "raw_url": "https://github.com/wireui/wireui/raw/9571fa86dfc7719ac1915c103abd4693b8e77b43/src%2FSupport%2FBladeCompiler.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/src%2FSupport%2FBladeCompiler.php?ref=9571fa86dfc7719ac1915c103abd4693b8e77b43",
                "patch": "@@ -1,49 +0,0 @@\n-<?php\n-\n-namespace WireUi\\Support;\n-\n-use Exception;\n-use Illuminate\\Support\\Facades\\Blade;\n-use Illuminate\\View\\Factory;\n-use Throwable;\n-\n-class BladeCompiler\n-{\n-    public function compile(string $html, array $data = []): string\n-    {\n-        $safeHtml = (new SafeEval)->evaluate($html);\n-\n-        $blade = Blade::compileString($safeHtml);\n-\n-        return $this->compileString($blade, $data);\n-    }\n-\n-    private function compileString(string $blade, array $data): string\n-    {\n-        $data['__env'] = app(Factory::class);\n-\n-        $obLevel = ob_get_level();\n-\n-        ob_start();\n-\n-        extract($data, EXTR_SKIP);\n-\n-        try {\n-            eval(\"?> {$blade}\");\n-        } catch (Exception $e) {\n-            while (ob_get_level() > $obLevel) {\n-                ob_end_clean();\n-            }\n-\n-            throw $e;\n-        } catch (Throwable $e) {\n-            while (ob_get_level() > $obLevel) {\n-                ob_end_clean();\n-            }\n-\n-            throw new Exception($e);\n-        }\n-\n-        return ob_get_clean();\n-    }\n-}"
            },
            {
                "sha": "45bcc49c1ac179f2f90422f8972f96d578b0f4ff",
                "filename": "src/Support/SafeEval.php",
                "status": "removed",
                "additions": 0,
                "deletions": 17,
                "changes": 17,
                "blob_url": "https://github.com/wireui/wireui/blob/9571fa86dfc7719ac1915c103abd4693b8e77b43/src%2FSupport%2FSafeEval.php",
                "raw_url": "https://github.com/wireui/wireui/raw/9571fa86dfc7719ac1915c103abd4693b8e77b43/src%2FSupport%2FSafeEval.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/src%2FSupport%2FSafeEval.php?ref=9571fa86dfc7719ac1915c103abd4693b8e77b43",
                "patch": "@@ -1,17 +0,0 @@\n-<?php\n-\n-namespace WireUi\\Support;\n-\n-use Illuminate\\Support\\Str;\n-\n-class SafeEval\n-{\n-    public const DIRECTIVES_REGEX = '/\\B@(@?\\w+(?:::\\w+)?)([ \\t]*)(\\( ( (?>[^()]+) | (?3) )* \\))?/x';\n-\n-    private const SECURITY_REPLACES = ['{{{', '}}}', '{{', '}}', '{!!', '!!}', '<?php', '<?=', '<?', '?>'];\n-\n-    public function evaluate(string $code): string\n-    {\n-        return Str::of($code)->replace(self::SECURITY_REPLACES, '')->replaceMatches(self::DIRECTIVES_REGEX, '');\n-    }\n-}"
            },
            {
                "sha": "14b2483c46deb50334525604d710b84458d5711d",
                "filename": "tests/Unit/Http/Controllers/ButtonControllerTest.php",
                "status": "modified",
                "additions": 2,
                "deletions": 18,
                "changes": 20,
                "blob_url": "https://github.com/wireui/wireui/blob/a457654912055f4dcc559da04d4e319f76b80fc5/tests%2FUnit%2FHttp%2FControllers%2FButtonControllerTest.php",
                "raw_url": "https://github.com/wireui/wireui/raw/a457654912055f4dcc559da04d4e319f76b80fc5/tests%2FUnit%2FHttp%2FControllers%2FButtonControllerTest.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/tests%2FUnit%2FHttp%2FControllers%2FButtonControllerTest.php?ref=a457654912055f4dcc559da04d4e319f76b80fc5",
                "patch": "@@ -3,9 +3,7 @@\n namespace Tests\\Unit\\Http\\Controllers;\n \n use Illuminate\\Support\\Str;\n-use Illuminate\\View\\ComponentAttributeBag;\n use Symfony\\Component\\HttpFoundation\\Response;\n-use WireUi\\Http\\Controllers\\ButtonController;\n \n test('it should render the button with attributes', function () {\n     $params = ['type' => 'primary', 'label' => 'Click me'];\n@@ -20,25 +18,11 @@\n \n     $this->getJson(route('wireui.render.button', $params))\n         ->assertSee('<button', escape: false)\n+        ->assertDontSee('strtoupper')\n+        ->assertDontSee('Click me')\n         ->assertDontSee('CLICK ME');\n });\n \n-test('it should filter the attributes to keep safe', function () {\n-    $attributes = [\n-        'color' => 'primary',\n-        ':label' => \"strtoupper('Click me')\",\n-        ':type' => \"config('app.name')\",\n-    ];\n-\n-    /** @var ButtonController $controller */\n-    $controller = resolve(ButtonController::class);\n-\n-    /** @var ComponentAttributeBag $filteredAttributes */\n-    $filteredAttributes = $this->invokeMethod($controller, 'attributes', [$attributes]);\n-\n-    $this->assertSame(['color' => 'primary'], $filteredAttributes->getAttributes());\n-});\n-\n test('it should validate the request', function (string $attribute, string $rule) {\n     $this->getJson(route('wireui.render.button', [$attribute => ['invalid-value']]))\n         ->assertStatus(Response::HTTP_UNPROCESSABLE_ENTITY)"
            },
            {
                "sha": "3e6b4923705d2219baf6a29363d97f886d150af5",
                "filename": "tests/Unit/Support/SafeEvalTest.php",
                "status": "removed",
                "additions": 0,
                "deletions": 54,
                "changes": 54,
                "blob_url": "https://github.com/wireui/wireui/blob/9571fa86dfc7719ac1915c103abd4693b8e77b43/tests%2FUnit%2FSupport%2FSafeEvalTest.php",
                "raw_url": "https://github.com/wireui/wireui/raw/9571fa86dfc7719ac1915c103abd4693b8e77b43/tests%2FUnit%2FSupport%2FSafeEvalTest.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/tests%2FUnit%2FSupport%2FSafeEvalTest.php?ref=9571fa86dfc7719ac1915c103abd4693b8e77b43",
                "patch": "@@ -1,54 +0,0 @@\n-<?php\n-\n-namespace Tests\\Unit\\Support;\n-\n-use WireUi\\Support\\SafeEval;\n-\n-test('it should assert directives regex matches', function () {\n-    $blade = '\n-    <div>\n-        @if(true) @endif\n-        @directive()\n-        @once\n-    </div>\n-    ';\n-\n-    $matches = [];\n-\n-    preg_match_all(SafeEval::DIRECTIVES_REGEX, $blade, $matches);\n-\n-    $this->assertCount(4, $matches[0]);\n-});\n-\n-test('it_should_assert_safe_eval_removes_risk_content', function () {\n-    $html = <<<'EOT'\n-        {{{ $variable }}}\n-        {{ $variable }}\n-        {!! $variable !!}\n-        <?php echo \"text\"; ?>\n-        <?= \"text\" ?>\n-        <? echo \"text\" ?>\n-\n-        @directive() @endDirective\n-        @directive($first, $second) @endDirective\n-        @directive() inside content @endDirective @endDirective\n-        @once\n-    EOT;\n-\n-    $escaped = (new SafeEval)->evaluate($html);\n-\n-    expect($escaped)->not->toContain('{{{ $variable }}}');\n-    expect($escaped)->not->toContain('{{ $variable }}');\n-    expect($escaped)->not->toContain('{!! $variable !!}');\n-    expect($escaped)->not->toContain('<?php echo \"text\"; ?>');\n-    expect($escaped)->not->toContain('<?= \"text\" ?>');\n-    expect($escaped)->not->toContain('@directive($first, $second) @endDirective');\n-    expect($escaped)->not->toContain('@directive() inside content @endDirective @endDirective');\n-    expect($escaped)->not->toContain('@once');\n-\n-    expect($escaped)->toContain('$variable');\n-    expect($escaped)->toContain('echo \"text\";');\n-    expect($escaped)->toContain('\"text\"');\n-    expect($escaped)->toContain('echo \"text\"');\n-    expect($escaped)->toContain('inside content');\n-});"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/wireui/wireui/commits/784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
        "url": "https://api.github.com/repos/wireui/wireui/commits/784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
        "html_url": "https://github.com/wireui/wireui/commit/784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
        "message": "Merge pull request #965 from wireui/fix-xss-on-1.0\n\nrefactor button controller",
        "files": [
            {
                "sha": "71b43edd719b7949ed37a131c2e70cdcf7e6398f",
                "filename": ".github/workflows/tests.yml",
                "status": "modified",
                "additions": 3,
                "deletions": 14,
                "changes": 17,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/.github%2Fworkflows%2Ftests.yml",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/.github%2Fworkflows%2Ftests.yml",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/.github%2Fworkflows%2Ftests.yml?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -28,12 +28,12 @@ jobs:\n \n     steps:\n       - name: Checkout\n-        uses: actions/checkout@v2\n+        uses: actions/checkout@v4\n \n       - name: Setup Node and run tests\n-        uses: actions/setup-node@v1\n+        uses: actions/setup-node@v4\n         with:\n-          node-version: \"16.x\"\n+          node-version: \"20.x\"\n       - run: yarn install --frozen-lockfile\n       - run: yarn lint\n       - run: yarn build\n@@ -47,17 +47,6 @@ jobs:\n           tools: composer:v2\n           coverage: none\n \n-      - name: Get composer cache directory\n-        id: composer-cache\n-        run: echo \"::set-output name=dir::$(composer config cache-files-dir)\"\n-\n-      - name: Cache composer dependencies\n-        uses: actions/cache@v2\n-        with:\n-          path: ${{ steps.composer-cache.outputs.dir }}\n-          key: dependencies-laravel-${{ matrix.laravel }}-php-${{ matrix.php }}-composer-${{ hashFiles('composer.json') }}\n-          restore-keys: dependencies-laravel-${{ matrix.laravel }}-php-${{ matrix.php }}-composer-\n-\n       - name: Install Composer dependencies\n         run: |\n           composer require \"laravel/framework:${{ matrix.laravel }}\" --no-interaction --no-update"
            },
            {
                "sha": "246288bd8686a48ad63551c699e65ad62173b7d1",
                "filename": "composer.lock",
                "status": "modified",
                "additions": 1549,
                "deletions": 865,
                "changes": 2414,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/composer.lock",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/composer.lock",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/composer.lock?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e"
            },
            {
                "sha": "071d43ce98695270cefbaf8086b720dd5849cdee",
                "filename": "dist/mix-manifest.json",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/dist%2Fmix-manifest.json",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/dist%2Fmix-manifest.json",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/dist%2Fmix-manifest.json?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -1,4 +1,4 @@\n {\n-    \"/wireui.js\": \"/wireui.js?id=4ba058198b57c5c941399dae270ff7d2\",\n-    \"/wireui.css\": \"/wireui.css?id=03214a0c69fbb6de4516a6905982f9d6\"\n+    \"/wireui.js\": \"/wireui.js?id=9cba48ce336ad8f2d33cfdbc61ffd374\",\n+    \"/wireui.css\": \"/wireui.css?id=0646fdc2c0e3844ab8c80577d778c1c8\"\n }"
            },
            {
                "sha": "4acf56bb939db147ba2a114b21dc6724423c19ec",
                "filename": "dist/wireui.css",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/dist%2Fwireui.css",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/dist%2Fwireui.css",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/dist%2Fwireui.css?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e"
            },
            {
                "sha": "2bb9b84e92f8e60846d8bc820b038b8a2869ba94",
                "filename": "dist/wireui.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/dist%2Fwireui.js",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/dist%2Fwireui.js",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/dist%2Fwireui.js?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e"
            },
            {
                "sha": "c24371015489b7720eacd4d9ec188dd7fdd1c41c",
                "filename": "package.json",
                "status": "modified",
                "additions": 17,
                "deletions": 17,
                "changes": 34,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/package.json",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/package.json",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/package.json?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -12,35 +12,35 @@\n         \"test\": \"jest\"\n     },\n     \"dependencies\": {\n-        \"@floating-ui/dom\": \"^1.5.3\",\n-        \"@types/lodash.debounce\": \"^4.0.8\",\n-        \"@wireui/alpinejs-hold-directive\": \"^1.0.1\",\n-        \"alpinejs\": \"^3.13.2\",\n-        \"dayjs\": \"^1.11.10\",\n+        \"@floating-ui/dom\": \"^1.6.11\",\n+        \"@types/lodash.debounce\": \"^4.0.9\",\n+        \"@wireui/alpinejs-hold-directive\": \"^1.0.3\",\n+        \"alpinejs\": \"^3.14.1\",\n+        \"dayjs\": \"^1.11.13\",\n         \"lodash.debounce\": \"^4.0.8\",\n         \"lodash.kebabcase\": \"^4.1.1\",\n-        \"qs\": \"^6.11.2\"\n+        \"qs\": \"^6.13.0\"\n     },\n     \"devDependencies\": {\n-        \"@tailwindcss/forms\": \"^0.5.6\",\n-        \"@types/jest\": \"^29.5.6\",\n+        \"@tailwindcss/forms\": \"^0.5.9\",\n+        \"@types/jest\": \"^29.5.13\",\n         \"@types/tailwindcss\": \"^3.1.0\",\n         \"@typescript-eslint/eslint-plugin\": \"^6.8.0\",\n         \"@typescript-eslint/parser\": \"^6.8.0\",\n-        \"autoprefixer\": \"^10.4.16\",\n+        \"autoprefixer\": \"^10.4.20\",\n         \"eslint\": \"^8.52.0\",\n-        \"eslint-plugin-import\": \"^2.28.1\",\n+        \"eslint-plugin-import\": \"^2.30.0\",\n         \"jest\": \"^29.7.0\",\n         \"jest-environment-jsdom\": \"^29.7.0\",\n         \"jest-extended\": \"^4.0.2\",\n         \"laravel-mix\": \"^6.0.49\",\n-        \"postcss\": \"^8.4.31\",\n-        \"postcss-import\": \"^15.1.0\",\n-        \"tailwindcss\": \"^3.3.3\",\n-        \"ts-jest\": \"^29.1.1\",\n-        \"ts-loader\": \"^9.5.0\",\n-        \"ts-node\": \"^10.9.1\",\n-        \"typescript\": \"^5.2.2\"\n+        \"postcss\": \"^8.4.47\",\n+        \"postcss-import\": \"^16.1.0\",\n+        \"tailwindcss\": \"^3.4.11\",\n+        \"ts-jest\": \"^29.2.5\",\n+        \"ts-loader\": \"^9.5.1\",\n+        \"ts-node\": \"^10.9.2\",\n+        \"typescript\": \"^5.6.2\"\n     },\n     \"packageManager\": \"yarn@1.22.21+sha1.1959a18351b811cdeedbd484a8f86c3cc3bbaf72\"\n }"
            },
            {
                "sha": "d831400f1b074fcd504c6a28157c515773de5fc3",
                "filename": "src/Http/Controllers/ButtonController.php",
                "status": "modified",
                "additions": 8,
                "deletions": 19,
                "changes": 27,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/src%2FHttp%2FControllers%2FButtonController.php",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/src%2FHttp%2FControllers%2FButtonController.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/src%2FHttp%2FControllers%2FButtonController.php?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -3,40 +3,29 @@\n namespace WireUi\\Http\\Controllers;\n \n use Illuminate\\Http\\Response;\n+use Illuminate\\Support\\Facades\\Blade;\n use Illuminate\\View\\ComponentAttributeBag;\n use WireUi\\Http\\Requests\\ButtonRequest;\n-use WireUi\\Support\\BladeCompiler;\n \n class ButtonController extends Controller\n {\n-    private BladeCompiler $compiler;\n-\n-    public function __construct(BladeCompiler $compiler)\n-    {\n-        $this->compiler = $compiler;\n-    }\n-\n     public function __invoke(ButtonRequest $request): Response\n     {\n-        $blade = <<<EOT\n+        $blade = <<<'BLADE'\n             <x-dynamic-component\n                 :component=\"WireUi::component('button')\"\n-                {$this->attributes($request->all())->toHtml()}\n+                :attributes=\"$attributes\"\n             />\n-        EOT;\n+        BLADE;\n+\n+        $attributes = new ComponentAttributeBag($request->validated());\n \n-        $html = $this->compiler->compile($blade);\n+        $html = Blade::render($blade, ['attributes' => $attributes]);\n \n         return response($html)->withHeaders([\n             'Content-Type'  => 'text/html; charset=utf-8',\n             'Cache-Control' => 'public, only-if-cached, max-age=31536000',\n+            'Content-Security-Policy' => \"default-src 'self'; script-src 'none';\",\n         ]);\n     }\n-\n-    protected function attributes(array $attributes): ComponentAttributeBag\n-    {\n-        $attributes = new ComponentAttributeBag($attributes);\n-\n-        return $attributes->whereDoesntStartWith(':');\n-    }\n }"
            },
            {
                "sha": "37182b3ba01d75ac1c2c62bb412a5181cbdf68ac",
                "filename": "src/Http/Requests/ButtonRequest.php",
                "status": "modified",
                "additions": 13,
                "deletions": 17,
                "changes": 30,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/src%2FHttp%2FRequests%2FButtonRequest.php",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/src%2FHttp%2FRequests%2FButtonRequest.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/src%2FHttp%2FRequests%2FButtonRequest.php?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -3,30 +3,26 @@\n namespace WireUi\\Http\\Requests;\n \n use Illuminate\\Foundation\\Http\\FormRequest;\n-use Illuminate\\Validation\\Rule;\n-use WireUi\\Facades\\WireUi;\n-use WireUi\\View\\Components\\BaseButton;\n \n class ButtonRequest extends FormRequest\n {\n     public function rules(): array\n     {\n-        $buttonClass = WireUi::components()->resolveClass('button');\n-\n-        /** @var BaseButton $button */\n-        $button = new $buttonClass();\n-\n         return [\n-            'color'     => ['sometimes', Rule::in(array_keys($button->defaultColors()))],\n-            'size'      => ['sometimes', Rule::in(array_keys($button->sizes()))],\n-            'iconSize'  => ['sometimes', Rule::in(array_keys($button->iconSizes()))],\n-            'label'     => 'sometimes|string',\n+            'label' => 'sometimes|string',\n+            'variant' => 'sometimes|string',\n+            'color' => 'sometimes|string',\n+            'size' => 'sometimes|string',\n+            'icon' => 'sometimes|string',\n             'rightIcon' => 'sometimes|string',\n-            'icon'      => 'sometimes|string',\n-            'rounded'   => 'sometimes|boolean',\n-            'squared'   => 'sometimes|boolean',\n-            'bordered'  => 'sometimes|boolean',\n-            'flat'      => 'sometimes|boolean',\n+            'iconSize' => 'sometimes|string',\n+            'rounded' => 'sometimes|boolean',\n+            'squared' => 'sometimes|boolean',\n+            'bordered' => 'sometimes|boolean',\n+            'solid' => 'sometimes|boolean',\n+            'outline' => 'sometimes|boolean',\n+            'flat' => 'sometimes|boolean',\n+            'light' => 'sometimes|boolean',\n         ];\n     }\n }"
            },
            {
                "sha": "dbbf6d73f587ce398b6f53c2f7cd78f523489ac3",
                "filename": "src/Support/BladeCompiler.php",
                "status": "removed",
                "additions": 0,
                "deletions": 46,
                "changes": 46,
                "blob_url": "https://github.com/wireui/wireui/blob/2df3270440a59c1920fb166f51a9da6cbb1ee872/src%2FSupport%2FBladeCompiler.php",
                "raw_url": "https://github.com/wireui/wireui/raw/2df3270440a59c1920fb166f51a9da6cbb1ee872/src%2FSupport%2FBladeCompiler.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/src%2FSupport%2FBladeCompiler.php?ref=2df3270440a59c1920fb166f51a9da6cbb1ee872",
                "patch": "@@ -1,46 +0,0 @@\n-<?php\n-\n-namespace WireUi\\Support;\n-\n-use Exception;\n-use Illuminate\\Support\\Facades\\Blade;\n-use Illuminate\\View\\Factory;\n-use Throwable;\n-\n-class BladeCompiler\n-{\n-    public function compile(string $html, array $data = []): string\n-    {\n-        $safeHtml = (new SafeEval())->evaluate($html);\n-\n-        $blade = Blade::compileString($safeHtml);\n-\n-        return $this->compileString($blade, $data);\n-    }\n-\n-    private function compileString(string $blade, array $data): string\n-    {\n-        $data['__env'] = app(Factory::class);\n-        $obLevel       = ob_get_level();\n-        ob_start();\n-        extract($data, EXTR_SKIP);\n-\n-        try {\n-            eval(\"?> {$blade}\");\n-        } catch (Exception $e) {\n-            while (ob_get_level() > $obLevel) {\n-                ob_end_clean();\n-            }\n-\n-            throw $e;\n-        } catch (Throwable $e) {\n-            while (ob_get_level() > $obLevel) {\n-                ob_end_clean();\n-            }\n-\n-            throw new Exception($e);\n-        }\n-\n-        return ob_get_clean();\n-    }\n-}"
            },
            {
                "sha": "69b413140746c4fee7391262142d71c071ef006e",
                "filename": "src/Support/SafeEval.php",
                "status": "removed",
                "additions": 0,
                "deletions": 30,
                "changes": 30,
                "blob_url": "https://github.com/wireui/wireui/blob/2df3270440a59c1920fb166f51a9da6cbb1ee872/src%2FSupport%2FSafeEval.php",
                "raw_url": "https://github.com/wireui/wireui/raw/2df3270440a59c1920fb166f51a9da6cbb1ee872/src%2FSupport%2FSafeEval.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/src%2FSupport%2FSafeEval.php?ref=2df3270440a59c1920fb166f51a9da6cbb1ee872",
                "patch": "@@ -1,30 +0,0 @@\n-<?php\n-\n-namespace WireUi\\Support;\n-\n-use Illuminate\\Support\\Str;\n-\n-class SafeEval\n-{\n-    private const SECURITY_REPLACES = [\n-        '{{{',\n-        '}}}',\n-        '{{',\n-        '}}',\n-        '{!!',\n-        '!!}',\n-        '<?php',\n-        '<?=',\n-        '<?',\n-        '?>',\n-    ];\n-\n-    public const DIRECTIVES_REGEX = '/\\B@(@?\\w+(?:::\\w+)?)([ \\t]*)(\\( ( (?>[^()]+) | (?3) )* \\))?/x';\n-\n-    public function evaluate(string $code): string\n-    {\n-        return Str::of($code)\n-            ->replace(self::SECURITY_REPLACES, '')\n-            ->replaceMatches(self::DIRECTIVES_REGEX, '');\n-    }\n-}"
            },
            {
                "sha": "3d47371b7d97808454bd7d3b5bba6ad024ff0330",
                "filename": "tests/Unit/Controllers/ButtonControllerTest.php",
                "status": "modified",
                "additions": 0,
                "deletions": 20,
                "changes": 20,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/tests%2FUnit%2FControllers%2FButtonControllerTest.php",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/tests%2FUnit%2FControllers%2FButtonControllerTest.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/tests%2FUnit%2FControllers%2FButtonControllerTest.php?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -28,26 +28,6 @@ public function test_if_the_malicious_attributes_are_ignored()\n             ->assertDontSee('CLICK ME');\n     }\n \n-    public function test_if_the_attributes_safe_filtered()\n-    {\n-        $attributes = [\n-            'color'  => 'primary',\n-            ':label' => \"strtoupper('Click me')\",\n-            ':type'  => \"config('app.name')\",\n-        ];\n-\n-        /** @var ButtonController $controller */\n-        $controller = resolve(ButtonController::class);\n-\n-        /** @var ComponentAttributeBag $filteredAttributes */\n-        $filteredAttributes = $this->invokeMethod($controller, 'attributes', [$attributes]);\n-\n-        $this->assertSame(\n-            ['color' => 'primary'],\n-            $filteredAttributes->getAttributes()\n-        );\n-    }\n-\n     /**\n      * @dataProvider validationProvider\n      */"
            },
            {
                "sha": "14b2483c46deb50334525604d710b84458d5711d",
                "filename": "tests/Unit/Http/Controllers/ButtonControllerTest.php",
                "status": "added",
                "additions": 38,
                "deletions": 0,
                "changes": 38,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/tests%2FUnit%2FHttp%2FControllers%2FButtonControllerTest.php",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/tests%2FUnit%2FHttp%2FControllers%2FButtonControllerTest.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/tests%2FUnit%2FHttp%2FControllers%2FButtonControllerTest.php?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -0,0 +1,38 @@\n+<?php\n+\n+namespace Tests\\Unit\\Http\\Controllers;\n+\n+use Illuminate\\Support\\Str;\n+use Symfony\\Component\\HttpFoundation\\Response;\n+\n+test('it should render the button with attributes', function () {\n+    $params = ['type' => 'primary', 'label' => 'Click me'];\n+\n+    $this->getJson(route('wireui.render.button', $params))\n+        ->assertSee('<button', escape: false)\n+        ->assertSee('Click me');\n+});\n+\n+test('it should ignore the malicious attributes', function () {\n+    $params = [':label' => \"strtoupper('Click me')\"];\n+\n+    $this->getJson(route('wireui.render.button', $params))\n+        ->assertSee('<button', escape: false)\n+        ->assertDontSee('strtoupper')\n+        ->assertDontSee('Click me')\n+        ->assertDontSee('CLICK ME');\n+});\n+\n+test('it should validate the request', function (string $attribute, string $rule) {\n+    $this->getJson(route('wireui.render.button', [$attribute => ['invalid-value']]))\n+        ->assertStatus(Response::HTTP_UNPROCESSABLE_ENTITY)\n+        ->assertJsonValidationErrors([\n+            $attribute => trans(\"validation.{$rule}\", ['attribute' => Str::of($attribute)->headline()->lower()]),\n+        ]);\n+})->with('button::validate');\n+\n+test('it should render a button', function (string $attribute, string|bool $value) {\n+    $this->getJson(route('wireui.render.button', [$attribute => $value]))\n+        ->assertStatus(Response::HTTP_OK)\n+        ->assertSessionHasNoErrors();\n+})->with('button::render');"
            },
            {
                "sha": "5e7e91104d5b4728a95294841a479597b856b638",
                "filename": "tests/Unit/Http/Datasets.php",
                "status": "added",
                "additions": 117,
                "deletions": 0,
                "changes": 117,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/tests%2FUnit%2FHttp%2FDatasets.php",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/tests%2FUnit%2FHttp%2FDatasets.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/tests%2FUnit%2FHttp%2FDatasets.php?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -0,0 +1,117 @@\n+<?php\n+\n+namespace Tests\\Unit\\Http;\n+\n+dataset('button::validate', [\n+    'label' => [\n+        'attribute' => 'label',\n+        'rule' => 'string',\n+    ],\n+    'variant' => [\n+        'attribute' => 'variant',\n+        'rule' => 'string',\n+    ],\n+    'color' => [\n+        'attribute' => 'color',\n+        'rule' => 'string',\n+    ],\n+    'size' => [\n+        'attribute' => 'size',\n+        'rule' => 'string',\n+    ],\n+    'icon' => [\n+        'attribute' => 'icon',\n+        'rule' => 'string',\n+    ],\n+    'rightIcon' => [\n+        'attribute' => 'rightIcon',\n+        'rule' => 'string',\n+    ],\n+    'iconSize' => [\n+        'attribute' => 'iconSize',\n+        'rule' => 'string',\n+    ],\n+    'rounded' => [\n+        'attribute' => 'rounded',\n+        'rule' => 'boolean',\n+    ],\n+    'squared' => [\n+        'attribute' => 'squared',\n+        'rule' => 'boolean',\n+    ],\n+    'bordered' => [\n+        'attribute' => 'bordered',\n+        'rule' => 'boolean',\n+    ],\n+    'solid' => [\n+        'attribute' => 'solid',\n+        'rule' => 'boolean',\n+    ],\n+    'outline' => [\n+        'attribute' => 'outline',\n+        'rule' => 'boolean',\n+    ],\n+    'flat' => [\n+        'attribute' => 'flat',\n+        'rule' => 'boolean',\n+    ],\n+]);\n+\n+dataset('button::render', [\n+    'label' => [\n+        'attribute' => 'label',\n+        'value' => 'My Label',\n+    ],\n+    'variant' => [\n+        'attribute' => 'variant',\n+        'value' => 'solid',\n+    ],\n+    'color' => [\n+        'attribute' => 'color',\n+        'value' => 'primary',\n+    ],\n+    'size' => [\n+        'attribute' => 'size',\n+        'value' => 'xl',\n+    ],\n+    'icon' => [\n+        'attribute' => 'icon',\n+        'value' => 'home',\n+    ],\n+    'rightIcon' => [\n+        'attribute' => 'rightIcon',\n+        'value' => 'user',\n+    ],\n+    'iconSize' => [\n+        'attribute' => 'iconSize',\n+        'value' => 'sm',\n+    ],\n+    'rounded' => [\n+        'attribute' => 'rounded',\n+        'value' => true,\n+    ],\n+    'squared' => [\n+        'attribute' => 'squared',\n+        'value' => true,\n+    ],\n+    'bordered' => [\n+        'attribute' => 'bordered',\n+        'value' => true,\n+    ],\n+    'solid' => [\n+        'attribute' => 'solid',\n+        'value' => true,\n+    ],\n+    'outline' => [\n+        'attribute' => 'outline',\n+        'value' => true,\n+    ],\n+    'flat' => [\n+        'attribute' => 'flat',\n+        'value' => true,\n+    ],\n+    'light' => [\n+        'attribute' => 'light',\n+        'value' => true,\n+    ],\n+]);"
            },
            {
                "sha": "66cfe3a1adce5c00938651ca685435c184c20f2f",
                "filename": "tests/Unit/SafeEvalTest.php",
                "status": "removed",
                "additions": 0,
                "deletions": 61,
                "changes": 61,
                "blob_url": "https://github.com/wireui/wireui/blob/2df3270440a59c1920fb166f51a9da6cbb1ee872/tests%2FUnit%2FSafeEvalTest.php",
                "raw_url": "https://github.com/wireui/wireui/raw/2df3270440a59c1920fb166f51a9da6cbb1ee872/tests%2FUnit%2FSafeEvalTest.php",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/tests%2FUnit%2FSafeEvalTest.php?ref=2df3270440a59c1920fb166f51a9da6cbb1ee872",
                "patch": "@@ -1,61 +0,0 @@\n-<?php\n-\n-namespace Tests\\Unit;\n-\n-use WireUi\\Support\\SafeEval;\n-\n-class SafeEvalTest extends UnitTestCase\n-{\n-    /** @test */\n-    public function it_should_assert_directives_regex_matches()\n-    {\n-        $blade = '\n-        <div>\n-            @if(true) @endif\n-            @directive()\n-            @once\n-        </div>\n-        ';\n-\n-        $matches = [];\n-\n-        preg_match_all(SafeEval::DIRECTIVES_REGEX, $blade, $matches);\n-\n-        $this->assertCount(4, $matches[0]);\n-    }\n-\n-    /** @test */\n-    public function it_should_assert_safe_eval_removes_risk_content()\n-    {\n-        $html = '\n-            {{{ $variable }}}\n-            {{ $variable }}\n-            {!! $variable !!}\n-            <?php echo \"text\"; ?>\n-            <?= \"text\" ?>\n-            <? echo \"text\" ?>\n-\n-            @directive() @endDirective\n-            @directive($first, $second) @endDirective\n-            @directive() inside content @endDirective @endDirective\n-            @once\n-        ';\n-\n-        $escaped = (new SafeEval())->evaluate($html);\n-\n-        $this->assertStringNotContainsString('{{{ $variable }}}', $escaped);\n-        $this->assertStringNotContainsString('{{ $variable }}', $escaped);\n-        $this->assertStringNotContainsString('{!! $variable !!}', $escaped);\n-        $this->assertStringNotContainsString('<?php echo \"text\"; ?>', $escaped);\n-        $this->assertStringNotContainsString('<?= \"text\" ?>', $escaped);\n-        $this->assertStringNotContainsString('@directive($first, $second) @endDirective', $escaped);\n-        $this->assertStringNotContainsString('@directive() inside content @endDirective @endDirective', $escaped);\n-        $this->assertStringNotContainsString('@once', $escaped);\n-\n-        $this->assertStringContainsString('$variable', $escaped);\n-        $this->assertStringContainsString('echo \"text\";', $escaped);\n-        $this->assertStringContainsString('\"text\"', $escaped);\n-        $this->assertStringContainsString('echo \"text\"', $escaped);\n-        $this->assertStringContainsString('inside content', $escaped);\n-    }\n-}"
            },
            {
                "sha": "97c5dfa0c74e764fca2941693d82c8569d17afb9",
                "filename": "ts/alpine/magic/props.ts",
                "status": "modified",
                "additions": 9,
                "deletions": 3,
                "changes": 12,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/ts%2Falpine%2Fmagic%2Fprops.ts",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/ts%2Falpine%2Fmagic%2Fprops.ts",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/ts%2Falpine%2Fmagic%2Fprops.ts?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -10,9 +10,15 @@ export const props = function (el: HTMLElement): object {\n }\n \n export function watchProps (component: Component, callback: CallableFunction): void {\n-  const observer = new MutationObserver(\n-    (mutations) => callback(mutations)\n-  )\n+  const observer = new MutationObserver(mutations => {\n+    const wasChanged = mutations.some(\n+      mutation => mutation.attributeName === 'x-props'\n+    )\n+\n+    if (wasChanged) {\n+      callback(mutations)\n+    }\n+  })\n \n   observer.observe(component.$root, { attributes: true })\n "
            },
            {
                "sha": "4e0f10674cc3dd6351a70363c1ffeaa3a01d3046",
                "filename": "yarn.lock",
                "status": "modified",
                "additions": 755,
                "deletions": 220,
                "changes": 975,
                "blob_url": "https://github.com/wireui/wireui/blob/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/yarn.lock",
                "raw_url": "https://github.com/wireui/wireui/raw/784c4f110e58eb41d0f2bdecd4655ea417f16e7e/yarn.lock",
                "contents_url": "https://api.github.com/repos/wireui/wireui/contents/yarn.lock?ref=784c4f110e58eb41d0f2bdecd4655ea417f16e7e",
                "patch": "@@ -1005,25 +1005,25 @@\n   resolved \"https://registry.yarnpkg.com/@eslint/js/-/js-8.52.0.tgz#78fe5f117840f69dc4a353adf9b9cd926353378c\"\n   integrity sha512-mjZVbpaeMZludF2fsWLD0Z9gCref1Tk4i9+wddjRvpUNqqcndPkBD09N/Mapey0b3jaXbLm2kICwFv2E64QinA==\n \n-\"@floating-ui/core@^1.4.2\":\n-  version \"1.5.0\"\n-  resolved \"https://registry.yarnpkg.com/@floating-ui/core/-/core-1.5.0.tgz#5c05c60d5ae2d05101c3021c1a2a350ddc027f8c\"\n-  integrity sha512-kK1h4m36DQ0UHGj5Ah4db7R0rHemTqqO0QLvUqi1/mUUp3LuAWbWxdxSIf/XsnH9VS6rRVPLJCncjRzUvyCLXg==\n+\"@floating-ui/core@^1.6.0\":\n+  version \"1.6.8\"\n+  resolved \"https://registry.yarnpkg.com/@floating-ui/core/-/core-1.6.8.tgz#aa43561be075815879305965020f492cdb43da12\"\n+  integrity sha512-7XJ9cPU+yI2QeLS+FCSlqNFZJq8arvswefkZrYI1yQBbftw6FyrZOxYSh+9S7z7TpeWlRt9zJ5IhM1WIL334jA==\n   dependencies:\n-    \"@floating-ui/utils\" \"^0.1.3\"\n+    \"@floating-ui/utils\" \"^0.2.8\"\n \n-\"@floating-ui/dom@^1.5.3\":\n-  version \"1.5.3\"\n-  resolved \"https://registry.yarnpkg.com/@floating-ui/dom/-/dom-1.5.3.tgz#54e50efcb432c06c23cd33de2b575102005436fa\"\n-  integrity sha512-ClAbQnEqJAKCJOEbbLo5IUlZHkNszqhuxS4fHAVxRPXPya6Ysf2G8KypnYcOTpx6I8xcgF9bbHb6g/2KpbV8qA==\n+\"@floating-ui/dom@^1.6.11\":\n+  version \"1.6.11\"\n+  resolved \"https://registry.yarnpkg.com/@floating-ui/dom/-/dom-1.6.11.tgz#8631857838d34ee5712339eb7cbdfb8ad34da723\"\n+  integrity sha512-qkMCxSR24v2vGkhYDo/UzxfJN3D4syqSjyuTFz6C7XcpU1pASPRieNI0Kj5VP3/503mOfYiGY891ugBX1GlABQ==\n   dependencies:\n-    \"@floating-ui/core\" \"^1.4.2\"\n-    \"@floating-ui/utils\" \"^0.1.3\"\n+    \"@floating-ui/core\" \"^1.6.0\"\n+    \"@floating-ui/utils\" \"^0.2.8\"\n \n-\"@floating-ui/utils@^0.1.3\":\n-  version \"0.1.6\"\n-  resolved \"https://registry.yarnpkg.com/@floating-ui/utils/-/utils-0.1.6.tgz#22958c042e10b67463997bd6ea7115fe28cbcaf9\"\n-  integrity sha512-OfX7E2oUDYxtBvsuS4e/jSn4Q9Qb6DzgeYtsAdkPZ47znpoNsMgZw0+tVijiv3uGNR6dgNlty6r9rzIzHjtd/A==\n+\"@floating-ui/utils@^0.2.8\":\n+  version \"0.2.8\"\n+  resolved \"https://registry.yarnpkg.com/@floating-ui/utils/-/utils-0.2.8.tgz#21a907684723bbbaa5f0974cf7730bd797eb8e62\"\n+  integrity sha512-kym7SodPp8/wloecOpcmSnWJsK7M0E5Wg8UcFA+uO4B9s5d0ywXOEro/8HM9x0rW+TljRzul/14UYz3TleT3ig==\n \n \"@humanwhocodes/config-array@^0.11.13\":\n   version \"0.11.13\"\n@@ -1392,6 +1392,11 @@\n     \"@nodelib/fs.scandir\" \"2.1.5\"\n     fastq \"^1.6.0\"\n \n+\"@rtsao/scc@^1.1.0\":\n+  version \"1.1.0\"\n+  resolved \"https://registry.yarnpkg.com/@rtsao/scc/-/scc-1.1.0.tgz#927dd2fae9bc3361403ac2c7a00c32ddce9ad7e8\"\n+  integrity sha512-zt6OdqaDoOnJ1ZYsCYGt9YmWzDXl4vQdKTyJev62gFhRGKdx7mcT54V9KIjg+d2wi9EXsPvAPKe7i7WjfVWB8g==\n+\n \"@sinclair/typebox@^0.24.1\":\n   version \"0.24.20\"\n   resolved \"https://registry.yarnpkg.com/@sinclair/typebox/-/typebox-0.24.20.tgz#11a657875de6008622d53f56e063a6347c51a6dd\"\n@@ -1416,10 +1421,10 @@\n   dependencies:\n     \"@sinonjs/commons\" \"^2.0.0\"\n \n-\"@tailwindcss/forms@^0.5.6\":\n-  version \"0.5.6\"\n-  resolved \"https://registry.yarnpkg.com/@tailwindcss/forms/-/forms-0.5.6.tgz#29c6c2b032b363e0c5110efed1499867f6d7e868\"\n-  integrity sha512-Fw+2BJ0tmAwK/w01tEFL5TiaJBX1NLT1/YbWgvm7ws3Qcn11kiXxzNTEQDMs5V3mQemhB56l3u0i9dwdzSQldA==\n+\"@tailwindcss/forms@^0.5.9\":\n+  version \"0.5.9\"\n+  resolved \"https://registry.yarnpkg.com/@tailwindcss/forms/-/forms-0.5.9.tgz#b495c12575d6eae5865b2cbd9876b26d89f16f61\"\n+  integrity sha512-tM4XVr2+UVTxXJzey9Twx48c1gcxFStqn1pQz0tRsX8o3DvxhN5oY5pvyAbUx7VTaZxpej4Zzvc6h+1RJBzpIg==\n   dependencies:\n     mini-svg-data-uri \"^1.2.3\"\n \n@@ -1641,10 +1646,10 @@\n   dependencies:\n     \"@types/istanbul-lib-report\" \"*\"\n \n-\"@types/jest@^29.5.6\":\n-  version \"29.5.6\"\n-  resolved \"https://registry.yarnpkg.com/@types/jest/-/jest-29.5.6.tgz#f4cf7ef1b5b0bfc1aa744e41b24d9cc52533130b\"\n-  integrity sha512-/t9NnzkOpXb4Nfvg17ieHE6EeSjDS2SGSpNYfoLbUAeL/EOueU/RSdOWFpfQTXBEM7BguYW1XQ0EbM+6RlIh6w==\n+\"@types/jest@^29.5.13\":\n+  version \"29.5.13\"\n+  resolved \"https://registry.yarnpkg.com/@types/jest/-/jest-29.5.13.tgz#8bc571659f401e6a719a7bf0dbcb8b78c71a8adc\"\n+  integrity sha512-wd+MVEZCHt23V0/L642O5APvspWply/rGY5BcW4SUETo2UzPU3Z26qr8jC2qxpimI2jjx9h7+2cj2FwIr01bXg==\n   dependencies:\n     expect \"^29.0.0\"\n     pretty-format \"^29.0.0\"\n@@ -1673,10 +1678,10 @@\n   resolved \"https://registry.yarnpkg.com/@types/json5/-/json5-0.0.29.tgz#ee28707ae94e11d2b827bcbe5270bcea7f3e71ee\"\n   integrity sha512-dRLjCWHYg4oaA77cxO64oO+7JwCwnIzkZPdrrC71jQmQtlhM556pwKo5bUzqvZndkVbeFLIIi+9TC40JNF5hNQ==\n \n-\"@types/lodash.debounce@^4.0.8\":\n-  version \"4.0.8\"\n-  resolved \"https://registry.yarnpkg.com/@types/lodash.debounce/-/lodash.debounce-4.0.8.tgz#d5fe36a35aa57773e05d960b3e3c703fd9ffb8b3\"\n-  integrity sha512-REumepIJjQFSOaBUoj81U5ZzF9YIhovzE2Lm6ejUbycmwx597k2ivG1cVfPtAj4eVuSbGoZDkJR0sRIahsE6/Q==\n+\"@types/lodash.debounce@^4.0.9\":\n+  version \"4.0.9\"\n+  resolved \"https://registry.yarnpkg.com/@types/lodash.debounce/-/lodash.debounce-4.0.9.tgz#0f5f21c507bce7521b5e30e7a24440975ac860a5\"\n+  integrity sha512-Ma5JcgTREwpLRwMM+XwBR7DaWe96nC38uCBDFKZWbNKD+osjVzdpnUSwBcqCptrp16sSOLBAUb50Car5I0TCsQ==\n   dependencies:\n     \"@types/lodash\" \"*\"\n \n@@ -2028,10 +2033,10 @@\n   resolved \"https://registry.yarnpkg.com/@webpack-cli/serve/-/serve-1.6.1.tgz#0de2875ac31b46b6c5bb1ae0a7d7f0ba5678dffe\"\n   integrity sha512-gNGTiTrjEVQ0OcVnzsRSqTxaBSr+dmTfm+qJsCDluky8uhdLWep7Gcr62QsAKHTMxjCS/8nEITsmFAhfIx+QSw==\n \n-\"@wireui/alpinejs-hold-directive@^1.0.1\":\n-  version \"1.0.1\"\n-  resolved \"https://registry.yarnpkg.com/@wireui/alpinejs-hold-directive/-/alpinejs-hold-directive-1.0.1.tgz#73bf2914cbfa2d61f8b513a083b861b65446a667\"\n-  integrity sha512-5VDn1sNdXU4cFdnNU4J+p4g7FWS8PrSe8MlJiwqiJdDHSxlmtw+eXS5t18vyNNBuA3QQibhzvscPBzp20zjPBA==\n+\"@wireui/alpinejs-hold-directive@^1.0.3\":\n+  version \"1.0.3\"\n+  resolved \"https://registry.yarnpkg.com/@wireui/alpinejs-hold-directive/-/alpinejs-hold-directive-1.0.3.tgz#ca9be9fd0be0002036ff3572780c49296fcbe56a\"\n+  integrity sha512-SzpGS3tPk7tDeBiAlrI3ZQoyDUBW/q393CgrDvmJ+VFK7BkyY92TbgLpQeOmJVmhoTzDNEFNnlOPLvc21kZxAw==\n   dependencies:\n     alpinejs \"^3.10.3\"\n \n@@ -2163,10 +2168,10 @@ alpinejs@^3.10.3:\n   dependencies:\n     \"@vue/reactivity\" \"~3.1.1\"\n \n-alpinejs@^3.13.2:\n-  version \"3.13.2\"\n-  resolved \"https://registry.yarnpkg.com/alpinejs/-/alpinejs-3.13.2.tgz#19723278b14bd9d1cc46859b5ac6225fcce2c228\"\n-  integrity sha512-WzojeeN082kLZznGI1HAuP8yFJSWqJ1fGdz2mUjj45H4y0XwToE7fFqtI3mCPRR+BpcSbxT/NL+FyPnYAWSltw==\n+alpinejs@^3.14.1:\n+  version \"3.14.1\"\n+  resolved \"https://registry.yarnpkg.com/alpinejs/-/alpinejs-3.14.1.tgz#549e056c3b75e57c0f23076a13cde09da684ba0a\"\n+  integrity sha512-ICar8UsnRZAYvv/fCNfNeKMXNoXGUfwHrjx7LqXd08zIP95G2d9bAOuaL97re+1mgt/HojqHsfdOLo/A5LuWgQ==\n   dependencies:\n     \"@vue/reactivity\" \"~3.1.1\"\n \n@@ -2249,6 +2254,14 @@ array-buffer-byte-length@^1.0.0:\n     call-bind \"^1.0.2\"\n     is-array-buffer \"^3.0.1\"\n \n+array-buffer-byte-length@^1.0.1:\n+  version \"1.0.1\"\n+  resolved \"https://registry.yarnpkg.com/array-buffer-byte-length/-/array-buffer-byte-length-1.0.1.tgz#1e5583ec16763540a27ae52eed99ff899223568f\"\n+  integrity sha512-ahC5W1xgou+KTXix4sAO8Ki12Q+jf4i0+tmk3sC+zgcynshkHxzpXdImBehiUYKKKDwvfFiJl1tZt6ewscS1Mg==\n+  dependencies:\n+    call-bind \"^1.0.5\"\n+    is-array-buffer \"^3.0.4\"\n+\n array-flatten@1.1.1:\n   version \"1.1.1\"\n   resolved \"https://registry.yarnpkg.com/array-flatten/-/array-flatten-1.1.1.tgz#9a5f699051b1e7073328f2a008968b64ea2955d2\"\n@@ -2259,51 +2272,53 @@ array-flatten@^2.1.2:\n   resolved \"https://registry.yarnpkg.com/array-flatten/-/array-flatten-2.1.2.tgz#24ef80a28c1a893617e2149b0c6d0d788293b099\"\n   integrity sha512-hNfzcOV8W4NdualtqBFPyVO+54DSJuZGY9qT4pRroB6S9e3iiido2ISIC5h9R2sPJ8H3FHCIiEnsv1lPXO3KtQ==\n \n-array-includes@^3.1.6:\n-  version \"3.1.6\"\n-  resolved \"https://registry.yarnpkg.com/array-includes/-/array-includes-3.1.6.tgz#9e9e720e194f198266ba9e18c29e6a9b0e4b225f\"\n-  integrity sha512-sgTbLvL6cNnw24FnbaDyjmvddQ2ML8arZsgaJhoABMoplz/4QRhtrYS+alr1BUM1Bwp6dhx8vVCBSLG+StwOFw==\n+array-includes@^3.1.8:\n+  version \"3.1.8\"\n+  resolved \"https://registry.yarnpkg.com/array-includes/-/array-includes-3.1.8.tgz#5e370cbe172fdd5dd6530c1d4aadda25281ba97d\"\n+  integrity sha512-itaWrbYbqpGXkGhZPGUulwnhVf5Hpy1xiCFsGqyIGglbBxmG5vSjxQen3/WGOjPpNEv1RtBLKxbmVXm8HpJStQ==\n   dependencies:\n-    call-bind \"^1.0.2\"\n-    define-properties \"^1.1.4\"\n-    es-abstract \"^1.20.4\"\n-    get-intrinsic \"^1.1.3\"\n+    call-bind \"^1.0.7\"\n+    define-properties \"^1.2.1\"\n+    es-abstract \"^1.23.2\"\n+    es-object-atoms \"^1.0.0\"\n+    get-intrinsic \"^1.2.4\"\n     is-string \"^1.0.7\"\n \n array-union@^2.1.0:\n   version \"2.1.0\"\n   resolved \"https://registry.yarnpkg.com/array-union/-/array-union-2.1.0.tgz#b798420adbeb1de828d84acd8a2e23d3efe85e8d\"\n   integrity sha512-HGyxoOTYUyCM6stUe6EJgnd4EoewAI7zMdfqO+kGjnlZmBDz/cR5pf8r/cR4Wq60sL/p0IkcjUEEPwS3GFrIyw==\n \n-array.prototype.findlastindex@^1.2.2:\n-  version \"1.2.2\"\n-  resolved \"https://registry.yarnpkg.com/array.prototype.findlastindex/-/array.prototype.findlastindex-1.2.2.tgz#bc229aef98f6bd0533a2bc61ff95209875526c9b\"\n-  integrity sha512-tb5thFFlUcp7NdNF6/MpDk/1r/4awWG1FIz3YqDf+/zJSTezBb+/5WViH41obXULHVpDzoiCLpJ/ZO9YbJMsdw==\n+array.prototype.findlastindex@^1.2.5:\n+  version \"1.2.5\"\n+  resolved \"https://registry.yarnpkg.com/array.prototype.findlastindex/-/array.prototype.findlastindex-1.2.5.tgz#8c35a755c72908719453f87145ca011e39334d0d\"\n+  integrity sha512-zfETvRFA8o7EiNn++N5f/kaCw221hrpGsDmcpndVupkPzEc1Wuf3VgC0qby1BbHs7f5DVYjgtEU2LLh5bqeGfQ==\n   dependencies:\n-    call-bind \"^1.0.2\"\n-    define-properties \"^1.1.4\"\n-    es-abstract \"^1.20.4\"\n-    es-shim-unscopables \"^1.0.0\"\n-    get-intrinsic \"^1.1.3\"\n+    call-bind \"^1.0.7\"\n+    define-properties \"^1.2.1\"\n+    es-abstract \"^1.23.2\"\n+    es-errors \"^1.3.0\"\n+    es-object-atoms \"^1.0.0\"\n+    es-shim-unscopables \"^1.0.2\"\n \n-array.prototype.flat@^1.3.1:\n-  version \"1.3.1\"\n-  resolved \"https://registry.yarnpkg.com/array.prototype.flat/-/array.prototype.flat-1.3.1.tgz#ffc6576a7ca3efc2f46a143b9d1dda9b4b3cf5e2\"\n-  integrity sha512-roTU0KWIOmJ4DRLmwKd19Otg0/mT3qPNt0Qb3GWW8iObuZXxrjB/pzn0R3hqpRSWg4HCwqx+0vwOnWnvlOyeIA==\n+array.prototype.flat@^1.3.2:\n+  version \"1.3.2\"\n+  resolved \"https://registry.yarnpkg.com/array.prototype.flat/-/array.prototype.flat-1.3.2.tgz#1476217df8cff17d72ee8f3ba06738db5b387d18\"\n+  integrity sha512-djYB+Zx2vLewY8RWlNCUdHjDXs2XOgm602S9E7P/UpHgfeHL00cRiIF+IN/G/aUJ7kGPb6yO/ErDI5V2s8iycA==\n   dependencies:\n     call-bind \"^1.0.2\"\n-    define-properties \"^1.1.4\"\n-    es-abstract \"^1.20.4\"\n+    define-properties \"^1.2.0\"\n+    es-abstract \"^1.22.1\"\n     es-shim-unscopables \"^1.0.0\"\n \n-array.prototype.flatmap@^1.3.1:\n-  version \"1.3.1\"\n-  resolved \"https://registry.yarnpkg.com/array.prototype.flatmap/-/array.prototype.flatmap-1.3.1.tgz#1aae7903c2100433cb8261cd4ed310aab5c4a183\"\n-  integrity sha512-8UGn9O1FDVvMNB0UlLv4voxRMze7+FpHyF5mSMRjWHUMlpoDViniy05870VlxhfgTnLbpuwTzvD76MTtWxB/mQ==\n+array.prototype.flatmap@^1.3.2:\n+  version \"1.3.2\"\n+  resolved \"https://registry.yarnpkg.com/array.prototype.flatmap/-/array.prototype.flatmap-1.3.2.tgz#c9a7c6831db8e719d6ce639190146c24bbd3e527\"\n+  integrity sha512-Ewyx0c9PmpcsByhSW4r+9zDU7sGjFc86qf/kKtuSCRdhfbk0SNLLkaT5qvcHnRGgc5NP/ly/y+qkXkqONX54CQ==\n   dependencies:\n     call-bind \"^1.0.2\"\n-    define-properties \"^1.1.4\"\n-    es-abstract \"^1.20.4\"\n+    define-properties \"^1.2.0\"\n+    es-abstract \"^1.22.1\"\n     es-shim-unscopables \"^1.0.0\"\n \n arraybuffer.prototype.slice@^1.0.1:\n@@ -2318,6 +2333,20 @@ arraybuffer.prototype.slice@^1.0.1:\n     is-array-buffer \"^3.0.2\"\n     is-shared-array-buffer \"^1.0.2\"\n \n+arraybuffer.prototype.slice@^1.0.3:\n+  version \"1.0.3\"\n+  resolved \"https://registry.yarnpkg.com/arraybuffer.prototype.slice/-/arraybuffer.prototype.slice-1.0.3.tgz#097972f4255e41bc3425e37dc3f6421cf9aefde6\"\n+  integrity sha512-bMxMKAjg13EBSVscxTaYA4mRc5t1UAXa2kXiGTNfZ079HIWXEkKmkgFrh/nJqamaLSrXO5H4WFFkPEaLJWbs3A==\n+  dependencies:\n+    array-buffer-byte-length \"^1.0.1\"\n+    call-bind \"^1.0.5\"\n+    define-properties \"^1.2.1\"\n+    es-abstract \"^1.22.3\"\n+    es-errors \"^1.2.1\"\n+    get-intrinsic \"^1.2.3\"\n+    is-array-buffer \"^3.0.4\"\n+    is-shared-array-buffer \"^1.0.2\"\n+\n asn1.js@^5.2.0:\n   version \"5.4.1\"\n   resolved \"https://registry.yarnpkg.com/asn1.js/-/asn1.js-5.4.1.tgz#11a980b84ebb91781ce35b0fdc2ee294e3783f07\"\n@@ -2336,6 +2365,11 @@ assert@^1.1.1:\n     object-assign \"^4.1.1\"\n     util \"0.10.3\"\n \n+async@^3.2.3:\n+  version \"3.2.6\"\n+  resolved \"https://registry.yarnpkg.com/async/-/async-3.2.6.tgz#1b0728e14929d51b85b449b7f06e27c1145e38ce\"\n+  integrity sha512-htCUDlxyyCLMgaM3xXg0C0LW2xqfuQ6p05pCEIsXuyQ+a1koYKTuBMzRNwmybfLgvJDMd0r1LTn4+E0Ti6C2AA==\n+\n asynckit@^0.4.0:\n   version \"0.4.0\"\n   resolved \"https://registry.yarnpkg.com/asynckit/-/asynckit-0.4.0.tgz#c79ed97f7f34cb8f2ba1bc9790bcc366474b4b79\"\n@@ -2353,23 +2387,30 @@ autoprefixer@^10.4.0:\n     picocolors \"^1.0.0\"\n     postcss-value-parser \"^4.2.0\"\n \n-autoprefixer@^10.4.16:\n-  version \"10.4.16\"\n-  resolved \"https://registry.yarnpkg.com/autoprefixer/-/autoprefixer-10.4.16.tgz#fad1411024d8670880bdece3970aa72e3572feb8\"\n-  integrity sha512-7vd3UC6xKp0HLfua5IjZlcXvGAGy7cBAXTg2lyQ/8WpNhd6SiZ8Be+xm3FyBSYJx5GKcpRCzBh7RH4/0dnY+uQ==\n+autoprefixer@^10.4.20:\n+  version \"10.4.20\"\n+  resolved \"https://registry.yarnpkg.com/autoprefixer/-/autoprefixer-10.4.20.tgz#5caec14d43976ef42e32dcb4bd62878e96be5b3b\"\n+  integrity sha512-XY25y5xSv/wEoqzDyXXME4AFfkZI0P23z6Fs3YgymDnKJkCGOnkL0iTxCa85UTqaSgfcqyf3UA6+c7wUvx/16g==\n   dependencies:\n-    browserslist \"^4.21.10\"\n-    caniuse-lite \"^1.0.30001538\"\n-    fraction.js \"^4.3.6\"\n+    browserslist \"^4.23.3\"\n+    caniuse-lite \"^1.0.30001646\"\n+    fraction.js \"^4.3.7\"\n     normalize-range \"^0.1.2\"\n-    picocolors \"^1.0.0\"\n+    picocolors \"^1.0.1\"\n     postcss-value-parser \"^4.2.0\"\n \n available-typed-arrays@^1.0.5:\n   version \"1.0.5\"\n   resolved \"https://registry.yarnpkg.com/available-typed-arrays/-/available-typed-arrays-1.0.5.tgz#92f95616501069d07d10edb2fc37d3e1c65123b7\"\n   integrity sha512-DMD0KiN46eipeziST1LPP/STfDU0sufISXmjSgvVsoU2tqxctQeASejWcfNtxYKqETM1UxQ8sp2OrSBWpHY6sw==\n \n+available-typed-arrays@^1.0.7:\n+  version \"1.0.7\"\n+  resolved \"https://registry.yarnpkg.com/available-typed-arrays/-/available-typed-arrays-1.0.7.tgz#a5cc375d6a03c2efc87a553f3e0b1522def14846\"\n+  integrity sha512-wvUjBtSGN7+7SjNpq/9M2Tg350UZD3q62IFZLbRAR1bSMlCo1ZaeW+BJ+D090e4hIIZLBcTDWe4Mh4jvUDajzQ==\n+  dependencies:\n+    possible-typed-array-names \"^1.0.0\"\n+\n babel-jest@^29.7.0:\n   version \"29.7.0\"\n   resolved \"https://registry.yarnpkg.com/babel-jest/-/babel-jest-29.7.0.tgz#f4369919225b684c56085998ac63dbd05be020d5\"\n@@ -2547,6 +2588,13 @@ brace-expansion@^1.1.7:\n     balanced-match \"^1.0.0\"\n     concat-map \"0.0.1\"\n \n+brace-expansion@^2.0.1:\n+  version \"2.0.1\"\n+  resolved \"https://registry.yarnpkg.com/brace-expansion/-/brace-expansion-2.0.1.tgz#1edc459e0f0c548486ecf9fc99f2221364b9a0ae\"\n+  integrity sha512-XnAIvQ8eM+kC6aULx6wuQiwVsnzsi9d3WxzV3FpWTGA19F621kwdbsAcFKXgKUHZWsy+mY6iL1sHTxWEFCytDA==\n+  dependencies:\n+    balanced-match \"^1.0.0\"\n+\n braces@^3.0.2, braces@~3.0.2:\n   version \"3.0.2\"\n   resolved \"https://registry.yarnpkg.com/braces/-/braces-3.0.2.tgz#3454e1a462ee8d599e236df336cd9ea4f8afe107\"\n@@ -2636,17 +2684,17 @@ browserslist@^4.0.0, browserslist@^4.14.5, browserslist@^4.16.6, browserslist@^4\n     node-releases \"^2.0.3\"\n     picocolors \"^1.0.0\"\n \n-browserslist@^4.21.10:\n-  version \"4.21.10\"\n-  resolved \"https://registry.yarnpkg.com/browserslist/-/browserslist-4.21.10.tgz#dbbac576628c13d3b2231332cb2ec5a46e015bb0\"\n-  integrity sha512-bipEBdZfVH5/pwrvqc+Ub0kUPVfGUhlKxbvfD+z1BDnPEO/X98ruXGA1WP5ASpAFKan7Qr6j736IacbZQuAlKQ==\n+browserslist@^4.23.3:\n+  version \"4.23.3\"\n+  resolved \"https://registry.yarnpkg.com/browserslist/-/browserslist-4.23.3.tgz#debb029d3c93ebc97ffbc8d9cbb03403e227c800\"\n+  integrity sha512-btwCFJVjI4YWDNfau8RhZ+B1Q/VLoUITrm3RlP6y1tYGWIOa+InuYiRGXUBXo8nA1qKmHMyLB/iVQg5TT4eFoA==\n   dependencies:\n-    caniuse-lite \"^1.0.30001517\"\n-    electron-to-chromium \"^1.4.477\"\n-    node-releases \"^2.0.13\"\n-    update-browserslist-db \"^1.0.11\"\n+    caniuse-lite \"^1.0.30001646\"\n+    electron-to-chromium \"^1.5.4\"\n+    node-releases \"^2.0.18\"\n+    update-browserslist-db \"^1.1.0\"\n \n-bs-logger@0.x:\n+bs-logger@^0.2.6:\n   version \"0.2.6\"\n   resolved \"https://registry.yarnpkg.com/bs-logger/-/bs-logger-0.2.6.tgz#eb7d365307a72cf974cc6cda76b68354ad336bd8\"\n   integrity sha512-pd8DCoxmbgc7hyPKOvxtqNcjYoOsABPQdcCUjGp3d42VR2CX1ORhk2A87oqqu5R1kk+76nsxZupkmyd+MVtCog==\n@@ -2702,6 +2750,17 @@ call-bind@^1.0.0, call-bind@^1.0.2:\n     function-bind \"^1.1.1\"\n     get-intrinsic \"^1.0.2\"\n \n+call-bind@^1.0.5, call-bind@^1.0.6, call-bind@^1.0.7:\n+  version \"1.0.7\"\n+  resolved \"https://registry.yarnpkg.com/call-bind/-/call-bind-1.0.7.tgz#06016599c40c56498c18769d2730be242b6fa3b9\"\n+  integrity sha512-GHTSNSYICQ7scH7sZ+M2rFopRoLh8t2bLSW6BbgrtLsahOIB5iyAVJf9GjWK3cYTDaMj4XdBpM1cA6pIS0Kv2w==\n+  dependencies:\n+    es-define-property \"^1.0.0\"\n+    es-errors \"^1.3.0\"\n+    function-bind \"^1.1.2\"\n+    get-intrinsic \"^1.2.4\"\n+    set-function-length \"^1.2.1\"\n+\n callsites@^3.0.0:\n   version \"3.1.0\"\n   resolved \"https://registry.yarnpkg.com/callsites/-/callsites-3.1.0.tgz#b3630abd8943432f54b3f0519238e33cd7df2f73\"\n@@ -2740,15 +2799,10 @@ caniuse-api@^3.0.0:\n     lodash.memoize \"^4.1.2\"\n     lodash.uniq \"^4.5.0\"\n \n-caniuse-lite@^1.0.0, caniuse-lite@^1.0.30001332, caniuse-lite@^1.0.30001335, caniuse-lite@^1.0.30001517:\n-  version \"1.0.30001524\"\n-  resolved \"https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001524.tgz\"\n-  integrity sha512-Jj917pJtYg9HSJBF95HVX3Cdr89JUyLT4IZ8SvM5aDRni95swKgYi3TgYLH5hnGfPE/U1dg6IfZ50UsIlLkwSA==\n-\n-caniuse-lite@^1.0.30001538:\n-  version \"1.0.30001553\"\n-  resolved \"https://registry.yarnpkg.com/caniuse-lite/-/caniuse-lite-1.0.30001553.tgz#e64e7dc8fd4885cd246bb476471420beb5e474b5\"\n-  integrity sha512-N0ttd6TrFfuqKNi+pMgWJTb9qrdJu4JSpgPFLe/lrD19ugC6fZgF0pUewRowDwzdDnb9V41mFcdlYgl/PyKf4A==\n+caniuse-lite@^1.0.0, caniuse-lite@^1.0.30001332, caniuse-lite@^1.0.30001335, caniuse-lite@^1.0.30001646:\n+  version \"1.0.30001660\"\n+  resolved \"https://registry.yarnpkg.com/caniuse-lite/-/caniuse-lite-1.0.30001660.tgz#31218de3463fabb44d0b7607b652e56edf2e2355\"\n+  integrity sha512-GacvNTTuATm26qC74pt+ad1fW15mlQ/zuTzzY1ZoIzECTP8HURDfF43kNxPgf7H1jmelCBQTTbBNxdSXOA7Bqg==\n \n chalk@^2.0.0:\n   version \"2.4.2\"\n@@ -2759,7 +2813,7 @@ chalk@^2.0.0:\n     escape-string-regexp \"^1.0.5\"\n     supports-color \"^5.3.0\"\n \n-chalk@^4.0.0, chalk@^4.1.0, chalk@^4.1.2:\n+chalk@^4.0.0, chalk@^4.0.2, chalk@^4.1.0, chalk@^4.1.2:\n   version \"4.1.2\"\n   resolved \"https://registry.yarnpkg.com/chalk/-/chalk-4.1.2.tgz#aac4e2b7734a740867aeb16bf02aad556a1e7a01\"\n   integrity sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==\n@@ -3254,10 +3308,37 @@ data-urls@^3.0.2:\n     whatwg-mimetype \"^3.0.0\"\n     whatwg-url \"^11.0.0\"\n \n-dayjs@^1.11.10:\n-  version \"1.11.10\"\n-  resolved \"https://registry.yarnpkg.com/dayjs/-/dayjs-1.11.10.tgz#68acea85317a6e164457d6d6947564029a6a16a0\"\n-  integrity sha512-vjAczensTgRcqDERK0SR2XMwsF/tSvnvlv6VcF2GIhg6Sx4yOIt/irsr1RDJsKiIyBzJDpCoXiWWq28MqH2cnQ==\n+data-view-buffer@^1.0.1:\n+  version \"1.0.1\"\n+  resolved \"https://registry.yarnpkg.com/data-view-buffer/-/data-view-buffer-1.0.1.tgz#8ea6326efec17a2e42620696e671d7d5a8bc66b2\"\n+  integrity sha512-0lht7OugA5x3iJLOWFhWK/5ehONdprk0ISXqVFn/NFrDu+cuc8iADFrGQz5BnRK7LLU3JmkbXSxaqX+/mXYtUA==\n+  dependencies:\n+    call-bind \"^1.0.6\"\n+    es-errors \"^1.3.0\"\n+    is-data-view \"^1.0.1\"\n+\n+data-view-byte-length@^1.0.1:\n+  version \"1.0.1\"\n+  resolved \"https://registry.yarnpkg.com/data-view-byte-length/-/data-view-byte-length-1.0.1.tgz#90721ca95ff280677eb793749fce1011347669e2\"\n+  integrity sha512-4J7wRJD3ABAzr8wP+OcIcqq2dlUKp4DVflx++hs5h5ZKydWMI6/D/fAot+yh6g2tHh8fLFTvNOaVN357NvSrOQ==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    es-errors \"^1.3.0\"\n+    is-data-view \"^1.0.1\"\n+\n+data-view-byte-offset@^1.0.0:\n+  version \"1.0.0\"\n+  resolved \"https://registry.yarnpkg.com/data-view-byte-offset/-/data-view-byte-offset-1.0.0.tgz#5e0bbfb4828ed2d1b9b400cd8a7d119bca0ff18a\"\n+  integrity sha512-t/Ygsytq+R995EJ5PZlD4Cu56sWa8InXySaViRzw9apusqsOO2bQP+SbYzAhR0pFKoB+43lYy8rWban9JSuXnA==\n+  dependencies:\n+    call-bind \"^1.0.6\"\n+    es-errors \"^1.3.0\"\n+    is-data-view \"^1.0.1\"\n+\n+dayjs@^1.11.13:\n+  version \"1.11.13\"\n+  resolved \"https://registry.yarnpkg.com/dayjs/-/dayjs-1.11.13.tgz#92430b0139055c3ebb60150aa13e860a4b5a366c\"\n+  integrity sha512-oaMBel6gjolK862uaPQOVTA7q3TZhuSvuMQAAglQDOWYO9A91IrAOUJEyKVlqJlHE0vq5p5UXxzdPfMH/x6xNg==\n \n debug@2.6.9:\n   version \"2.6.9\"\n@@ -3307,6 +3388,15 @@ default-gateway@^6.0.3:\n   dependencies:\n     execa \"^5.0.0\"\n \n+define-data-property@^1.0.1, define-data-property@^1.1.4:\n+  version \"1.1.4\"\n+  resolved \"https://registry.yarnpkg.com/define-data-property/-/define-data-property-1.1.4.tgz#894dc141bb7d3060ae4366f6a0107e68fbe48c5e\"\n+  integrity sha512-rBMvIzlpA8v6E+SJZoo++HAYqsLrkg7MSfIinMPFhmkorw7X+dOXVJQs+QT69zGkzMyfDnIMN2Wid1+NbL3T+A==\n+  dependencies:\n+    es-define-property \"^1.0.0\"\n+    es-errors \"^1.3.0\"\n+    gopd \"^1.0.1\"\n+\n define-lazy-prop@^2.0.0:\n   version \"2.0.0\"\n   resolved \"https://registry.yarnpkg.com/define-lazy-prop/-/define-lazy-prop-2.0.0.tgz#3f7ae421129bcaaac9bc74905c98a0009ec9ee7f\"\n@@ -3328,6 +3418,15 @@ define-properties@^1.2.0:\n     has-property-descriptors \"^1.0.0\"\n     object-keys \"^1.1.1\"\n \n+define-properties@^1.2.1:\n+  version \"1.2.1\"\n+  resolved \"https://registry.yarnpkg.com/define-properties/-/define-properties-1.2.1.tgz#10781cc616eb951a80a034bafcaa7377f6af2b6c\"\n+  integrity sha512-8QmQKqEASLd5nx0U1B1okLElbUuuttJ/AnYmRXbbbGDWh6uS208EjD4Xqq/I9wK7u0v6O08XhTWnt5XtEbR6Dg==\n+  dependencies:\n+    define-data-property \"^1.0.1\"\n+    has-property-descriptors \"^1.0.0\"\n+    object-keys \"^1.1.1\"\n+\n defined@^1.0.0:\n   version \"1.0.0\"\n   resolved \"https://registry.yarnpkg.com/defined/-/defined-1.0.0.tgz#c98d9bcef75674188e110969151199e39b1fa693\"\n@@ -3519,15 +3618,22 @@ ee-first@1.1.1:\n   resolved \"https://registry.yarnpkg.com/ee-first/-/ee-first-1.1.1.tgz#590c61156b0ae2f4f0255732a158b266bc56b21d\"\n   integrity sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==\n \n+ejs@^3.1.10:\n+  version \"3.1.10\"\n+  resolved \"https://registry.yarnpkg.com/ejs/-/ejs-3.1.10.tgz#69ab8358b14e896f80cc39e62087b88500c3ac3b\"\n+  integrity sha512-UeJmFfOrAQS8OJWPZ4qtgHyWExa088/MtK5UEyoJGFH67cDEXkZSviOiKRCZ4Xij0zxI3JECgYs3oKx+AizQBA==\n+  dependencies:\n+    jake \"^10.8.5\"\n+\n electron-to-chromium@^1.4.118:\n   version \"1.4.141\"\n   resolved \"https://registry.yarnpkg.com/electron-to-chromium/-/electron-to-chromium-1.4.141.tgz#4dd9119e8a99f1c83c51dfcf1bed79ea541f08d6\"\n   integrity sha512-mfBcbqc0qc6RlxrsIgLG2wCqkiPAjEezHxGTu7p3dHHFOurH4EjS9rFZndX5axC8264rI1Pcbw8uQP39oZckeA==\n \n-electron-to-chromium@^1.4.477:\n-  version \"1.4.505\"\n-  resolved \"https://registry.yarnpkg.com/electron-to-chromium/-/electron-to-chromium-1.4.505.tgz#00571ade5975b58413f0f56a665b065bfc29cdfc\"\n-  integrity sha512-0A50eL5BCCKdxig2SsCXhpuztnB9PfUgRMojj5tMvt8O54lbwz3t6wNgnpiTRosw5QjlJB7ixhVyeg8daLQwSQ==\n+electron-to-chromium@^1.5.4:\n+  version \"1.5.24\"\n+  resolved \"https://registry.yarnpkg.com/electron-to-chromium/-/electron-to-chromium-1.5.24.tgz#b3cd2f71b7a84bac340d862e3b7b0aadf48478de\"\n+  integrity sha512-0x0wLCmpdKFCi9ulhvYZebgcPmHTkFVUfU2wzDykadkslKwT4oAmDTHEKLnlrDsMGZe4B+ksn8quZfZjYsBetA==\n \n elliptic@^6.5.3, elliptic@^6.5.4:\n   version \"6.5.4\"\n@@ -3705,11 +3811,82 @@ es-abstract@^1.22.1:\n     unbox-primitive \"^1.0.2\"\n     which-typed-array \"^1.1.10\"\n \n+es-abstract@^1.22.3, es-abstract@^1.23.0, es-abstract@^1.23.2:\n+  version \"1.23.3\"\n+  resolved \"https://registry.yarnpkg.com/es-abstract/-/es-abstract-1.23.3.tgz#8f0c5a35cd215312573c5a27c87dfd6c881a0aa0\"\n+  integrity sha512-e+HfNH61Bj1X9/jLc5v1owaLYuHdeHHSQlkhCBiTK8rBvKaULl/beGMxwrMXjpYrv4pz22BlY570vVePA2ho4A==\n+  dependencies:\n+    array-buffer-byte-length \"^1.0.1\"\n+    arraybuffer.prototype.slice \"^1.0.3\"\n+    available-typed-arrays \"^1.0.7\"\n+    call-bind \"^1.0.7\"\n+    data-view-buffer \"^1.0.1\"\n+    data-view-byte-length \"^1.0.1\"\n+    data-view-byte-offset \"^1.0.0\"\n+    es-define-property \"^1.0.0\"\n+    es-errors \"^1.3.0\"\n+    es-object-atoms \"^1.0.0\"\n+    es-set-tostringtag \"^2.0.3\"\n+    es-to-primitive \"^1.2.1\"\n+    function.prototype.name \"^1.1.6\"\n+    get-intrinsic \"^1.2.4\"\n+    get-symbol-description \"^1.0.2\"\n+    globalthis \"^1.0.3\"\n+    gopd \"^1.0.1\"\n+    has-property-descriptors \"^1.0.2\"\n+    has-proto \"^1.0.3\"\n+    has-symbols \"^1.0.3\"\n+    hasown \"^2.0.2\"\n+    internal-slot \"^1.0.7\"\n+    is-array-buffer \"^3.0.4\"\n+    is-callable \"^1.2.7\"\n+    is-data-view \"^1.0.1\"\n+    is-negative-zero \"^2.0.3\"\n+    is-regex \"^1.1.4\"\n+    is-shared-array-buffer \"^1.0.3\"\n+    is-string \"^1.0.7\"\n+    is-typed-array \"^1.1.13\"\n+    is-weakref \"^1.0.2\"\n+    object-inspect \"^1.13.1\"\n+    object-keys \"^1.1.1\"\n+    object.assign \"^4.1.5\"\n+    regexp.prototype.flags \"^1.5.2\"\n+    safe-array-concat \"^1.1.2\"\n+    safe-regex-test \"^1.0.3\"\n+    string.prototype.trim \"^1.2.9\"\n+    string.prototype.trimend \"^1.0.8\"\n+    string.prototype.trimstart \"^1.0.8\"\n+    typed-array-buffer \"^1.0.2\"\n+    typed-array-byte-length \"^1.0.1\"\n+    typed-array-byte-offset \"^1.0.2\"\n+    typed-array-length \"^1.0.6\"\n+    unbox-primitive \"^1.0.2\"\n+    which-typed-array \"^1.1.15\"\n+\n+es-define-property@^1.0.0:\n+  version \"1.0.0\"\n+  resolved \"https://registry.yarnpkg.com/es-define-property/-/es-define-property-1.0.0.tgz#c7faefbdff8b2696cf5f46921edfb77cc4ba3845\"\n+  integrity sha512-jxayLKShrEqqzJ0eumQbVhTYQM27CfT1T35+gCgDFoL82JLsXqTJ76zv6A0YLOgEnLUMvLzsDsGIrl8NFpT2gQ==\n+  dependencies:\n+    get-intrinsic \"^1.2.4\"\n+\n+es-errors@^1.2.1, es-errors@^1.3.0:\n+  version \"1.3.0\"\n+  resolved \"https://registry.yarnpkg.com/es-errors/-/es-errors-1.3.0.tgz#05f75a25dab98e4fb1dcd5e1472c0546d5057c8f\"\n+  integrity sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==\n+\n es-module-lexer@^0.9.0:\n   version \"0.9.3\"\n   resolved \"https://registry.yarnpkg.com/es-module-lexer/-/es-module-lexer-0.9.3.tgz#6f13db00cc38417137daf74366f535c8eb438f19\"\n   integrity sha512-1HQ2M2sPtxwnvOvT1ZClHyQDiggdNjURWpY2we6aMKCQiUVxTmVs2UYPLIrD84sS+kMdUwfBSylbJPwNnBrnHQ==\n \n+es-object-atoms@^1.0.0:\n+  version \"1.0.0\"\n+  resolved \"https://registry.yarnpkg.com/es-object-atoms/-/es-object-atoms-1.0.0.tgz#ddb55cd47ac2e240701260bc2a8e31ecb643d941\"\n+  integrity sha512-MZ4iQ6JwHOBQjahnjwaC1ZtIBH+2ohjamzAO3oaHcXYup7qxjF2fixyH+Q71voWHeOkI2q/TnJao/KfXYIZWbw==\n+  dependencies:\n+    es-errors \"^1.3.0\"\n+\n es-set-tostringtag@^2.0.1:\n   version \"2.0.1\"\n   resolved \"https://registry.yarnpkg.com/es-set-tostringtag/-/es-set-tostringtag-2.0.1.tgz#338d502f6f674301d710b80c8592de8a15f09cd8\"\n@@ -3719,13 +3896,29 @@ es-set-tostringtag@^2.0.1:\n     has \"^1.0.3\"\n     has-tostringtag \"^1.0.0\"\n \n+es-set-tostringtag@^2.0.3:\n+  version \"2.0.3\"\n+  resolved \"https://registry.yarnpkg.com/es-set-tostringtag/-/es-set-tostringtag-2.0.3.tgz#8bb60f0a440c2e4281962428438d58545af39777\"\n+  integrity sha512-3T8uNMC3OQTHkFUsFq8r/BwAXLHvU/9O9mE0fBc/MY5iq/8H7ncvO947LmYA6ldWw9Uh8Yhf25zu6n7nML5QWQ==\n+  dependencies:\n+    get-intrinsic \"^1.2.4\"\n+    has-tostringtag \"^1.0.2\"\n+    hasown \"^2.0.1\"\n+\n es-shim-unscopables@^1.0.0:\n   version \"1.0.0\"\n   resolved \"https://registry.yarnpkg.com/es-shim-unscopables/-/es-shim-unscopables-1.0.0.tgz#702e632193201e3edf8713635d083d378e510241\"\n   integrity sha512-Jm6GPcCdC30eMLbZ2x8z2WuRwAws3zTBBKuusffYVUrNj/GVSUAZ+xKMaUpfNDR5IbyNA5LJbaecoUVbmUcB1w==\n   dependencies:\n     has \"^1.0.3\"\n \n+es-shim-unscopables@^1.0.2:\n+  version \"1.0.2\"\n+  resolved \"https://registry.yarnpkg.com/es-shim-unscopables/-/es-shim-unscopables-1.0.2.tgz#1f6942e71ecc7835ed1c8a83006d8771a63a3763\"\n+  integrity sha512-J3yBRXCzDu4ULnQwxyToo/OjdMx6akgVC7K6few0a7F/0wLtmKKN7I73AH5T2836UuXRqN7Qg+IIUw/+YJksRw==\n+  dependencies:\n+    hasown \"^2.0.0\"\n+\n es-to-primitive@^1.2.1:\n   version \"1.2.1\"\n   resolved \"https://registry.yarnpkg.com/es-to-primitive/-/es-to-primitive-1.2.1.tgz#e55cd4c9cdc188bcefb03b366c736323fc5c898a\"\n@@ -3740,6 +3933,11 @@ escalade@^3.1.1:\n   resolved \"https://registry.yarnpkg.com/escalade/-/escalade-3.1.1.tgz#d8cfdc7000965c5a0174b4a82eaa5c0552742e40\"\n   integrity sha512-k0er2gUkLf8O0zKJiAhmkTnJlTvINGv7ygDNPbeIsX/TJjGJZHuh9B2UxbsaEkmlEo9MfhrSzmhIlhRlI2GXnw==\n \n+escalade@^3.1.2:\n+  version \"3.2.0\"\n+  resolved \"https://registry.yarnpkg.com/escalade/-/escalade-3.2.0.tgz#011a3f69856ba189dffa7dc8fcce99d2a87903e5\"\n+  integrity sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==\n+\n escape-html@~1.0.3:\n   version \"1.0.3\"\n   resolved \"https://registry.yarnpkg.com/escape-html/-/escape-html-1.0.3.tgz#0258eae4d3d0c0974de1c169188ef0051d1d1988\"\n@@ -3772,44 +3970,45 @@ escodegen@^2.0.0:\n   optionalDependencies:\n     source-map \"~0.6.1\"\n \n-eslint-import-resolver-node@^0.3.7:\n-  version \"0.3.7\"\n-  resolved \"https://registry.yarnpkg.com/eslint-import-resolver-node/-/eslint-import-resolver-node-0.3.7.tgz#83b375187d412324a1963d84fa664377a23eb4d7\"\n-  integrity sha512-gozW2blMLJCeFpBwugLTGyvVjNoeo1knonXAcatC6bjPBZitotxdWf7Gimr25N4c0AAOo4eOUfaG82IJPDpqCA==\n+eslint-import-resolver-node@^0.3.9:\n+  version \"0.3.9\"\n+  resolved \"https://registry.yarnpkg.com/eslint-import-resolver-node/-/eslint-import-resolver-node-0.3.9.tgz#d4eaac52b8a2e7c3cd1903eb00f7e053356118ac\"\n+  integrity sha512-WFj2isz22JahUv+B788TlO3N6zL3nNJGU8CcZbPZvVEkBPaJdCV4vy5wyghty5ROFbCRnm132v8BScu5/1BQ8g==\n   dependencies:\n     debug \"^3.2.7\"\n-    is-core-module \"^2.11.0\"\n-    resolve \"^1.22.1\"\n+    is-core-module \"^2.13.0\"\n+    resolve \"^1.22.4\"\n \n-eslint-module-utils@^2.8.0:\n-  version \"2.8.0\"\n-  resolved \"https://registry.yarnpkg.com/eslint-module-utils/-/eslint-module-utils-2.8.0.tgz#e439fee65fc33f6bba630ff621efc38ec0375c49\"\n-  integrity sha512-aWajIYfsqCKRDgUfjEXNN/JlrzauMuSEy5sbd7WXbtW3EH6A6MpwEh42c7qD+MqQo9QMJ6fWLAeIJynx0g6OAw==\n+eslint-module-utils@^2.9.0:\n+  version \"2.11.0\"\n+  resolved \"https://registry.yarnpkg.com/eslint-module-utils/-/eslint-module-utils-2.11.0.tgz#b99b211ca4318243f09661fae088f373ad5243c4\"\n+  integrity sha512-gbBE5Hitek/oG6MUVj6sFuzEjA/ClzNflVrLovHi/JgLdC7fiN5gLAY1WIPW1a0V5I999MnsrvVrCOGmmVqDBQ==\n   dependencies:\n     debug \"^3.2.7\"\n \n-eslint-plugin-import@^2.28.1:\n-  version \"2.28.1\"\n-  resolved \"https://registry.yarnpkg.com/eslint-plugin-import/-/eslint-plugin-import-2.28.1.tgz#63b8b5b3c409bfc75ebaf8fb206b07ab435482c4\"\n-  integrity sha512-9I9hFlITvOV55alzoKBI+K9q74kv0iKMeY6av5+umsNwayt59fz692daGyjR+oStBQgx6nwR9rXldDev3Clw+A==\n+eslint-plugin-import@^2.30.0:\n+  version \"2.30.0\"\n+  resolved \"https://registry.yarnpkg.com/eslint-plugin-import/-/eslint-plugin-import-2.30.0.tgz#21ceea0fc462657195989dd780e50c92fe95f449\"\n+  integrity sha512-/mHNE9jINJfiD2EKkg1BKyPyUk4zdnT54YgbOgfjSakWT5oyX/qQLVNTkehyfpcMxZXMy1zyonZ2v7hZTX43Yw==\n   dependencies:\n-    array-includes \"^3.1.6\"\n-    array.prototype.findlastindex \"^1.2.2\"\n-    array.prototype.flat \"^1.3.1\"\n-    array.prototype.flatmap \"^1.3.1\"\n+    \"@rtsao/scc\" \"^1.1.0\"\n+    array-includes \"^3.1.8\"\n+    array.prototype.findlastindex \"^1.2.5\"\n+    array.prototype.flat \"^1.3.2\"\n+    array.prototype.flatmap \"^1.3.2\"\n     debug \"^3.2.7\"\n     doctrine \"^2.1.0\"\n-    eslint-import-resolver-node \"^0.3.7\"\n-    eslint-module-utils \"^2.8.0\"\n-    has \"^1.0.3\"\n-    is-core-module \"^2.13.0\"\n+    eslint-import-resolver-node \"^0.3.9\"\n+    eslint-module-utils \"^2.9.0\"\n+    hasown \"^2.0.2\"\n+    is-core-module \"^2.15.1\"\n     is-glob \"^4.0.3\"\n     minimatch \"^3.1.2\"\n-    object.fromentries \"^2.0.6\"\n-    object.groupby \"^1.0.0\"\n-    object.values \"^1.1.6\"\n+    object.fromentries \"^2.0.8\"\n+    object.groupby \"^1.0.3\"\n+    object.values \"^1.2.0\"\n     semver \"^6.3.1\"\n-    tsconfig-paths \"^3.14.2\"\n+    tsconfig-paths \"^3.15.0\"\n \n eslint-scope@5.1.1:\n   version \"5.1.1\"\n@@ -4042,10 +4241,10 @@ fast-glob@^3.0.3, fast-glob@^3.2.11, fast-glob@^3.2.9:\n     merge2 \"^1.3.0\"\n     micromatch \"^4.0.4\"\n \n-fast-glob@^3.2.12:\n-  version \"3.2.12\"\n-  resolved \"https://registry.yarnpkg.com/fast-glob/-/fast-glob-3.2.12.tgz#7f39ec99c2e6ab030337142da9e0c18f37afae80\"\n-  integrity sha512-DVj4CQIYYow0BlaelwK1pHl5n5cRSJfM60UA0zK891sVInoPri2Ekj7+e1CT3/3qxXenpI+nBBmQAcJPJgaj4w==\n+fast-glob@^3.3.0:\n+  version \"3.3.2\"\n+  resolved \"https://registry.yarnpkg.com/fast-glob/-/fast-glob-3.3.2.tgz#a904501e57cfdd2ffcded45e99a54fef55e46129\"\n+  integrity sha512-oX2ruAFQwf/Orj8m737Y5adxDQO0LAB7/S5MnxCdTNDd4p6BsyIVsv9JQsATbTSq8KHRpLwIHbVlUNatxd+1Ow==\n   dependencies:\n     \"@nodelib/fs.stat\" \"^2.0.2\"\n     \"@nodelib/fs.walk\" \"^1.2.3\"\n@@ -4109,6 +4308,13 @@ file-type@^12.0.0:\n   resolved \"https://registry.yarnpkg.com/file-type/-/file-type-12.4.2.tgz#a344ea5664a1d01447ee7fb1b635f72feb6169d9\"\n   integrity sha512-UssQP5ZgIOKelfsaB5CuGAL+Y+q7EmONuiwF3N5HAH0t27rvrttgi6Ra9k/+DVaY9UF6+ybxu5pOXLUdA8N7Vg==\n \n+filelist@^1.0.4:\n+  version \"1.0.4\"\n+  resolved \"https://registry.yarnpkg.com/filelist/-/filelist-1.0.4.tgz#f78978a1e944775ff9e62e744424f215e58352b5\"\n+  integrity sha512-w1cEuf3S+DrLCQL7ET6kz+gmlJdbq9J7yXCSjK/OZCPA+qEN1WyF4ZAf0YYJa4/shHJra2t/d/r8SV4Ji+x+8Q==\n+  dependencies:\n+    minimatch \"^5.0.1\"\n+\n fill-range@^7.0.1:\n   version \"7.0.1\"\n   resolved \"https://registry.yarnpkg.com/fill-range/-/fill-range-7.0.1.tgz#1919a6a7c75fe38b2c7c77e5198535da9acdda40\"\n@@ -4198,7 +4404,7 @@ fraction.js@^4.2.0:\n   resolved \"https://registry.yarnpkg.com/fraction.js/-/fraction.js-4.2.0.tgz#448e5109a313a3527f5a3ab2119ec4cf0e0e2950\"\n   integrity sha512-MhLuK+2gUcnZe8ZHlaaINnQLl0xRIGRfcGk2yl8xoQAfHrSsL3rYu6FCmBdkdbhc9EPlwyGHewaRsvwRMJtAlA==\n \n-fraction.js@^4.3.6:\n+fraction.js@^4.3.7:\n   version \"4.3.7\"\n   resolved \"https://registry.yarnpkg.com/fraction.js/-/fraction.js-4.3.7.tgz#06ca0085157e42fda7f9e726e79fefc4068840f7\"\n   integrity sha512-ZsDfxO51wGAXREY55a7la9LScWpwv9RxIrYABrlvOFBlH/ShPnrtsXeuUIfXKKOVicNxQ+o8JTbJvjS4M89yew==\n@@ -4237,6 +4443,11 @@ function-bind@^1.1.1:\n   resolved \"https://registry.yarnpkg.com/function-bind/-/function-bind-1.1.1.tgz#a56899d3ea3c9bab874bb9773b7c5ede92f4895d\"\n   integrity sha512-yIovAzMX49sF8Yl58fSCWJ5svSLuaibPxXQJFLmBObTuCr0Mf1KiPopGM9NiFjiYBCbfaa2Fh6breQ6ANVTI0A==\n \n+function-bind@^1.1.2:\n+  version \"1.1.2\"\n+  resolved \"https://registry.yarnpkg.com/function-bind/-/function-bind-1.1.2.tgz#2c02d864d97f3ea6c8830c464cbd11ab6eab7a1c\"\n+  integrity sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==\n+\n function.prototype.name@^1.1.5:\n   version \"1.1.5\"\n   resolved \"https://registry.yarnpkg.com/function.prototype.name/-/function.prototype.name-1.1.5.tgz#cce0505fe1ffb80503e6f9e46cc64e46a12a9621\"\n@@ -4247,6 +4458,16 @@ function.prototype.name@^1.1.5:\n     es-abstract \"^1.19.0\"\n     functions-have-names \"^1.2.2\"\n \n+function.prototype.name@^1.1.6:\n+  version \"1.1.6\"\n+  resolved \"https://registry.yarnpkg.com/function.prototype.name/-/function.prototype.name-1.1.6.tgz#cdf315b7d90ee77a4c6ee216c3c3362da07533fd\"\n+  integrity sha512-Z5kx79swU5P27WEayXM1tBi5Ze/lbIyiNgU3qyXUOf9b2rgXYyF9Dy9Cx+IQv/Lc8WCG6L82zwUPpSS9hGehIg==\n+  dependencies:\n+    call-bind \"^1.0.2\"\n+    define-properties \"^1.2.0\"\n+    es-abstract \"^1.22.1\"\n+    functions-have-names \"^1.2.3\"\n+\n functions-have-names@^1.2.2, functions-have-names@^1.2.3:\n   version \"1.2.3\"\n   resolved \"https://registry.yarnpkg.com/functions-have-names/-/functions-have-names-1.2.3.tgz#0404fe4ee2ba2f607f0e0ec3c80bae994133b834\"\n@@ -4290,6 +4511,17 @@ get-intrinsic@^1.2.0, get-intrinsic@^1.2.1:\n     has-proto \"^1.0.1\"\n     has-symbols \"^1.0.3\"\n \n+get-intrinsic@^1.2.3, get-intrinsic@^1.2.4:\n+  version \"1.2.4\"\n+  resolved \"https://registry.yarnpkg.com/get-intrinsic/-/get-intrinsic-1.2.4.tgz#e385f5a4b5227d449c3eabbad05494ef0abbeadd\"\n+  integrity sha512-5uYhsJH8VJBTv7oslg4BznJYhDoRI6waYCxMmCdnTrcCrHA/fCFKoTFz2JKKE0HdDFUF7/oQuhzumXJK7paBRQ==\n+  dependencies:\n+    es-errors \"^1.3.0\"\n+    function-bind \"^1.1.2\"\n+    has-proto \"^1.0.1\"\n+    has-symbols \"^1.0.3\"\n+    hasown \"^2.0.0\"\n+\n get-package-type@^0.1.0:\n   version \"0.1.0\"\n   resolved \"https://registry.yarnpkg.com/get-package-type/-/get-package-type-0.1.0.tgz#8de2d803cff44df3bc6c456e6668b36c3926e11a\"\n@@ -4308,6 +4540,15 @@ get-symbol-description@^1.0.0:\n     call-bind \"^1.0.2\"\n     get-intrinsic \"^1.1.1\"\n \n+get-symbol-description@^1.0.2:\n+  version \"1.0.2\"\n+  resolved \"https://registry.yarnpkg.com/get-symbol-description/-/get-symbol-description-1.0.2.tgz#533744d5aa20aca4e079c8e5daf7fd44202821f5\"\n+  integrity sha512-g0QYk1dZBxGwk+Ngc+ltRH2IBp2f7zBkBMBJZCDerh6EhlhSR6+9irMCuT/09zD6qkarHUSn529sK/yL4S27mg==\n+  dependencies:\n+    call-bind \"^1.0.5\"\n+    es-errors \"^1.3.0\"\n+    get-intrinsic \"^1.2.4\"\n+\n glob-parent@^5.1.2, glob-parent@~5.1.2:\n   version \"5.1.2\"\n   resolved \"https://registry.yarnpkg.com/glob-parent/-/glob-parent-5.1.2.tgz#869832c58034fe68a4093c17dc15e8340d8401c4\"\n@@ -4445,11 +4686,23 @@ has-property-descriptors@^1.0.0:\n   dependencies:\n     get-intrinsic \"^1.1.1\"\n \n+has-property-descriptors@^1.0.2:\n+  version \"1.0.2\"\n+  resolved \"https://registry.yarnpkg.com/has-property-descriptors/-/has-property-descriptors-1.0.2.tgz#963ed7d071dc7bf5f084c5bfbe0d1b6222586854\"\n+  integrity sha512-55JNKuIW+vq4Ke1BjOTjM2YctQIvCT7GFzHwmfZPGo5wnrgkid0YQtnAleFSqumZm4az3n2BS+erby5ipJdgrg==\n+  dependencies:\n+    es-define-property \"^1.0.0\"\n+\n has-proto@^1.0.1:\n   version \"1.0.1\"\n   resolved \"https://registry.yarnpkg.com/has-proto/-/has-proto-1.0.1.tgz#1885c1305538958aff469fef37937c22795408e0\"\n   integrity sha512-7qE+iP+O+bgF9clE5+UoBFzE65mlBiVj3tKCrlNQ0Ogwm0BjpT/gK4SlLYDMybDh5I3TCTKnPPa0oMG7JDYrhg==\n \n+has-proto@^1.0.3:\n+  version \"1.0.3\"\n+  resolved \"https://registry.yarnpkg.com/has-proto/-/has-proto-1.0.3.tgz#b31ddfe9b0e6e9914536a6ab286426d0214f77fd\"\n+  integrity sha512-SJ1amZAJUiZS+PhsVLf5tGydlaVB8EdFpaSO4gmiUKUOxk8qzn5AIy4ZeJUmh22znIdk/uMAUT2pl3FxzVUH+Q==\n+\n has-symbols@^1.0.1, has-symbols@^1.0.2, has-symbols@^1.0.3:\n   version \"1.0.3\"\n   resolved \"https://registry.yarnpkg.com/has-symbols/-/has-symbols-1.0.3.tgz#bb7b2c4349251dce87b125f7bdf874aa7c8b39f8\"\n@@ -4462,6 +4715,13 @@ has-tostringtag@^1.0.0:\n   dependencies:\n     has-symbols \"^1.0.2\"\n \n+has-tostringtag@^1.0.2:\n+  version \"1.0.2\"\n+  resolved \"https://registry.yarnpkg.com/has-tostringtag/-/has-tostringtag-1.0.2.tgz#2cdc42d40bef2e5b4eeab7c01a73c54ce7ab5abc\"\n+  integrity sha512-NqADB8VjPFLM2V0VvHUewwwsw0ZWBaIdgo+ieHtK3hasLz4qeCRjYcqfB6AQrBggRKppKF8L52/VqdVsO47Dlw==\n+  dependencies:\n+    has-symbols \"^1.0.3\"\n+\n has@^1.0.3:\n   version \"1.0.3\"\n   resolved \"https://registry.yarnpkg.com/has/-/has-1.0.3.tgz#722d7cbfc1f6aa8241f16dd814e011e1f41e8796\"\n@@ -4491,6 +4751,13 @@ hash.js@^1.0.0, hash.js@^1.0.3:\n     inherits \"^2.0.3\"\n     minimalistic-assert \"^1.0.1\"\n \n+hasown@^2.0.0, hasown@^2.0.1, hasown@^2.0.2:\n+  version \"2.0.2\"\n+  resolved \"https://registry.yarnpkg.com/hasown/-/hasown-2.0.2.tgz#003eaf91be7adc372e84ec59dc37252cedb80003\"\n+  integrity sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==\n+  dependencies:\n+    function-bind \"^1.1.2\"\n+\n he@^1.2.0:\n   version \"1.2.0\"\n   resolved \"https://registry.yarnpkg.com/he/-/he-1.2.0.tgz#84ae65fa7eafb165fddb61566ae14baf05664f0f\"\n@@ -4768,6 +5035,15 @@ internal-slot@^1.0.5:\n     has \"^1.0.3\"\n     side-channel \"^1.0.4\"\n \n+internal-slot@^1.0.7:\n+  version \"1.0.7\"\n+  resolved \"https://registry.yarnpkg.com/internal-slot/-/internal-slot-1.0.7.tgz#c06dcca3ed874249881007b0a5523b172a190802\"\n+  integrity sha512-NGnrKwXzSms2qUUih/ILZ5JBqNTSa1+ZmP6flaIp6KmSElgE9qdndzS3cqjrDovwFdmwsGsLdeFgB6suw+1e9g==\n+  dependencies:\n+    es-errors \"^1.3.0\"\n+    hasown \"^2.0.0\"\n+    side-channel \"^1.0.4\"\n+\n interpret@^2.2.0:\n   version \"2.2.0\"\n   resolved \"https://registry.yarnpkg.com/interpret/-/interpret-2.2.0.tgz#1a78a0b5965c40a5416d007ad6f50ad27c417df9\"\n@@ -4801,6 +5077,14 @@ is-array-buffer@^3.0.2:\n     get-intrinsic \"^1.2.0\"\n     is-typed-array \"^1.1.10\"\n \n+is-array-buffer@^3.0.4:\n+  version \"3.0.4\"\n+  resolved \"https://registry.yarnpkg.com/is-array-buffer/-/is-array-buffer-3.0.4.tgz#7a1f92b3d61edd2bc65d24f130530ea93d7fae98\"\n+  integrity sha512-wcjaerHw0ydZwfhiKbXJWLDY8A7yV7KhjQOpb83hGgGfId/aQa4TOvwyzn2PuswW2gPCYEL/nEAiSVpdOj1lXw==\n+  dependencies:\n+    call-bind \"^1.0.2\"\n+    get-intrinsic \"^1.2.1\"\n+\n is-arrayish@^0.2.1:\n   version \"0.2.1\"\n   resolved \"https://registry.yarnpkg.com/is-arrayish/-/is-arrayish-0.2.1.tgz#77c99840527aa8ecb1a8ba697b80645a7a926a9d\"\n@@ -4843,27 +5127,34 @@ is-callable@^1.1.4, is-callable@^1.2.4:\n   resolved \"https://registry.yarnpkg.com/is-callable/-/is-callable-1.2.4.tgz#47301d58dd0259407865547853df6d61fe471945\"\n   integrity sha512-nsuwtxZfMX67Oryl9LCQ+upnC0Z0BgpwntpS89m1H/TLF0zNfzfLMV/9Wa/6MZsj0acpEjAO0KF1xT6ZdLl95w==\n \n-is-core-module@^2.11.0:\n-  version \"2.11.0\"\n-  resolved \"https://registry.yarnpkg.com/is-core-module/-/is-core-module-2.11.0.tgz#ad4cb3e3863e814523c96f3f58d26cc570ff0144\"\n-  integrity sha512-RRjxlvLDkD1YJwDbroBHMb+cukurkDWNyHx7D3oNB5x9rb5ogcksMC5wHCadcXoo67gVr/+3GFySh3134zi6rw==\n-  dependencies:\n-    has \"^1.0.3\"\n-\n is-core-module@^2.13.0:\n   version \"2.13.0\"\n   resolved \"https://registry.yarnpkg.com/is-core-module/-/is-core-module-2.13.0.tgz#bb52aa6e2cbd49a30c2ba68c42bf3435ba6072db\"\n   integrity sha512-Z7dk6Qo8pOCp3l4tsX2C5ZVas4V+UxwQodwZhLopL91TX8UyyHEXafPcyoeeWuLrwzHcr3igO78wNLwHJHsMCQ==\n   dependencies:\n     has \"^1.0.3\"\n \n+is-core-module@^2.15.1:\n+  version \"2.15.1\"\n+  resolved \"https://registry.yarnpkg.com/is-core-module/-/is-core-module-2.15.1.tgz#a7363a25bee942fefab0de13bf6aa372c82dcc37\"\n+  integrity sha512-z0vtXSwucUJtANQWldhbtbt7BnL0vxiFjIdDLAatwhDYty2bad6s+rijD6Ri4YuYJubLzIJLUidCh09e1djEVQ==\n+  dependencies:\n+    hasown \"^2.0.2\"\n+\n is-core-module@^2.8.1, is-core-module@^2.9.0:\n   version \"2.9.0\"\n   resolved \"https://registry.yarnpkg.com/is-core-module/-/is-core-module-2.9.0.tgz#e1c34429cd51c6dd9e09e0799e396e27b19a9c69\"\n   integrity sha512-+5FPy5PnwmO3lvfMb0AsoPaBG+5KHUI0wYFXOtYPnVVVspTFUuMZNfNaNVRt3FZadstu2c8x23vykRW/NBoU6A==\n   dependencies:\n     has \"^1.0.3\"\n \n+is-data-view@^1.0.1:\n+  version \"1.0.1\"\n+  resolved \"https://registry.yarnpkg.com/is-data-view/-/is-data-view-1.0.1.tgz#4b4d3a511b70f3dc26d42c03ca9ca515d847759f\"\n+  integrity sha512-AHkaJrsUVW6wq6JS8y3JnM/GJF/9cf+k20+iDzlSaJrinEo5+7vRiteOSwBhHRiAyQATN1AmY4hwzxJKPmYf+w==\n+  dependencies:\n+    is-typed-array \"^1.1.13\"\n+\n is-date-object@^1.0.1:\n   version \"1.0.5\"\n   resolved \"https://registry.yarnpkg.com/is-date-object/-/is-date-object-1.0.5.tgz#0841d5536e724c25597bf6ea62e1bd38298df31f\"\n@@ -4903,6 +5194,11 @@ is-negative-zero@^2.0.2:\n   resolved \"https://registry.yarnpkg.com/is-negative-zero/-/is-negative-zero-2.0.2.tgz#7bf6f03a28003b8b3965de3ac26f664d765f3150\"\n   integrity sha512-dqJvarLawXsFbNDeJW7zAz8ItJ9cd28YufuuFzh0G8pNHjJMnY08Dv7sYX2uF5UpQOwieAeOExEYAWWfu7ZZUA==\n \n+is-negative-zero@^2.0.3:\n+  version \"2.0.3\"\n+  resolved \"https://registry.yarnpkg.com/is-negative-zero/-/is-negative-zero-2.0.3.tgz#ced903a027aca6381b777a5743069d7376a49747\"\n+  integrity sha512-5KoIu2Ngpyek75jXodFvnafB6DJgr3u8uuK0LEZJjrU19DrMD3EVERaR8sjz8CCGgpZvxPl9SuE1GMVPFHx1mw==\n+\n is-number-object@^1.0.4:\n   version \"1.0.7\"\n   resolved \"https://registry.yarnpkg.com/is-number-object/-/is-number-object-1.0.7.tgz#59d50ada4c45251784e9904f5246c742f07a42fc\"\n@@ -4952,6 +5248,13 @@ is-shared-array-buffer@^1.0.2:\n   dependencies:\n     call-bind \"^1.0.2\"\n \n+is-shared-array-buffer@^1.0.3:\n+  version \"1.0.3\"\n+  resolved \"https://registry.yarnpkg.com/is-shared-array-buffer/-/is-shared-array-buffer-1.0.3.tgz#1237f1cba059cdb62431d378dcc37d9680181688\"\n+  integrity sha512-nA2hv5XIhLR3uVzDDfCIknerhx8XUKnstuOERPNNIinXG7v9u+ohXF67vxm4TPTEPU6lm61ZkwP3c9PCB97rhg==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+\n is-stream@^2.0.0:\n   version \"2.0.1\"\n   resolved \"https://registry.yarnpkg.com/is-stream/-/is-stream-2.0.1.tgz#fac1e3d53b97ad5a9d0ae9cef2389f5810a5c077\"\n@@ -4982,6 +5285,13 @@ is-typed-array@^1.1.10, is-typed-array@^1.1.9:\n     gopd \"^1.0.1\"\n     has-tostringtag \"^1.0.0\"\n \n+is-typed-array@^1.1.13:\n+  version \"1.1.13\"\n+  resolved \"https://registry.yarnpkg.com/is-typed-array/-/is-typed-array-1.1.13.tgz#d6c5ca56df62334959322d7d7dd1cca50debe229\"\n+  integrity sha512-uZ25/bUAlUY5fR4OKT4rZQEBrzQWYV9ZJYGGsUmEJ6thodVJ1HX64ePQ6Z0qPWP+m+Uq6e9UugrE38jeYsDSMw==\n+  dependencies:\n+    which-typed-array \"^1.1.14\"\n+\n is-weakref@^1.0.2:\n   version \"1.0.2\"\n   resolved \"https://registry.yarnpkg.com/is-weakref/-/is-weakref-1.0.2.tgz#9529f383a9338205e89765e0392efc2f100f06f2\"\n@@ -5069,6 +5379,16 @@ istanbul-reports@^3.1.3:\n     html-escaper \"^2.0.0\"\n     istanbul-lib-report \"^3.0.0\"\n \n+jake@^10.8.5:\n+  version \"10.9.2\"\n+  resolved \"https://registry.yarnpkg.com/jake/-/jake-10.9.2.tgz#6ae487e6a69afec3a5e167628996b59f35ae2b7f\"\n+  integrity sha512-2P4SQ0HrLQ+fw6llpLnOaGAvN2Zu6778SJMrCUwns4fOoG9ayrTiZk3VV8sCPkVZF8ab0zksVpS8FDY5pRCNBA==\n+  dependencies:\n+    async \"^3.2.3\"\n+    chalk \"^4.0.2\"\n+    filelist \"^1.0.4\"\n+    minimatch \"^3.1.2\"\n+\n jest-changed-files@^29.7.0:\n   version \"29.7.0\"\n   resolved \"https://registry.yarnpkg.com/jest-changed-files/-/jest-changed-files-29.7.0.tgz#1c06d07e77c78e1585d020424dedc10d6e17ac3a\"\n@@ -5515,10 +5835,10 @@ jest@^29.7.0:\n     import-local \"^3.0.2\"\n     jest-cli \"^29.7.0\"\n \n-jiti@^1.18.2:\n-  version \"1.19.3\"\n-  resolved \"https://registry.yarnpkg.com/jiti/-/jiti-1.19.3.tgz#ef554f76465b3c2b222dc077834a71f0d4a37569\"\n-  integrity sha512-5eEbBDQT/jF1xg6l36P+mWGGoH9Spuy0PCdSr2dtWRDGC6ph/w9ZCL4lmESW8f8F7MwT3XKescfP0wnZWAKL9w==\n+jiti@^1.21.0:\n+  version \"1.21.6\"\n+  resolved \"https://registry.yarnpkg.com/jiti/-/jiti-1.21.6.tgz#6c7f7398dd4b3142767f9a168af2f317a428d268\"\n+  integrity sha512-2yTgeWTWzMWkHu6Jp9NKgePDaYHbntiwvYuuJLbbN9vl7DC9DvXKOB2BC3ZZ92D3cvV/aflH0osDfwpHepQ53w==\n \n js-tokens@^4.0.0:\n   version \"4.0.0\"\n@@ -5788,7 +6108,7 @@ lodash.kebabcase@^4.1.1:\n   resolved \"https://registry.yarnpkg.com/lodash.kebabcase/-/lodash.kebabcase-4.1.1.tgz#8489b1cb0d29ff88195cceca448ff6d6cc295c36\"\n   integrity sha1-hImxyw0p/4gZXM7KRI/21swpXDY=\n \n-lodash.memoize@4.x, lodash.memoize@^4.1.2:\n+lodash.memoize@^4.1.2:\n   version \"4.1.2\"\n   resolved \"https://registry.yarnpkg.com/lodash.memoize/-/lodash.memoize-4.1.2.tgz#bcc6c49a42a2840ed997f323eada5ecd182e0bfe\"\n   integrity sha1-vMbEmkKihA7Zl/Mj6tpezRguC/4=\n@@ -5834,7 +6154,7 @@ make-dir@^3.0.0, make-dir@^3.0.2, make-dir@^3.1.0:\n   dependencies:\n     semver \"^6.0.0\"\n \n-make-error@1.x, make-error@^1.1.1:\n+make-error@^1.1.1, make-error@^1.3.6:\n   version \"1.3.6\"\n   resolved \"https://registry.yarnpkg.com/make-error/-/make-error-1.3.6.tgz#2eb2e37ea9b67c4891f684a1394799af484cf7a2\"\n   integrity sha512-s8UhlNe7vPKomQhC1qFelMokr/Sc3AgNbso3n74mVPA5LTZwkB9NlXf4XPamLxJE8h0gh73rM94xvwRT2CVInw==\n@@ -5970,6 +6290,13 @@ minimatch@^3.0.4, minimatch@^3.0.5, minimatch@^3.1.1, minimatch@^3.1.2:\n   dependencies:\n     brace-expansion \"^1.1.7\"\n \n+minimatch@^5.0.1:\n+  version \"5.1.6\"\n+  resolved \"https://registry.yarnpkg.com/minimatch/-/minimatch-5.1.6.tgz#1cfcb8cf5522ea69952cd2af95ae09477f122a96\"\n+  integrity sha512-lKwV/1brpG6mBUFHtb7NUmtABCb2WZZmm2wNiOA5hAb8VdCS4B3dtMWyvcoViccwAW/COERjXLt0zP1zXUN26g==\n+  dependencies:\n+    brace-expansion \"^2.0.1\"\n+\n minimist@^1.2.0, minimist@^1.2.6:\n   version \"1.2.7\"\n   resolved \"https://registry.yarnpkg.com/minimist/-/minimist-1.2.7.tgz#daa1c4d91f507390437c6a8bc01078e7000c4d18\"\n@@ -6017,6 +6344,11 @@ nanoid@^3.3.6:\n   resolved \"https://registry.yarnpkg.com/nanoid/-/nanoid-3.3.6.tgz#443380c856d6e9f9824267d960b4236ad583ea4c\"\n   integrity sha512-BGcqMMJuToF7i1rt+2PWSNVnWIkGCU78jBG3RxO/bZlnZPK2Cmi2QaffxGO/2RvWi9sL+FAiRiXMgsyxQ1DIDA==\n \n+nanoid@^3.3.7:\n+  version \"3.3.7\"\n+  resolved \"https://registry.yarnpkg.com/nanoid/-/nanoid-3.3.7.tgz#d0c301a691bc8d54efa0a2226ccf3fe2fd656bd8\"\n+  integrity sha512-eSRppjcPIatRIMC1U6UngP8XFcz8MQWGQdt1MTBQ7NaAmvXDfvNxbvWV3x2y6CdEUciCSsDHDQZbhYaB8QEo2g==\n+\n natural-compare@^1.4.0:\n   version \"1.4.0\"\n   resolved \"https://registry.yarnpkg.com/natural-compare/-/natural-compare-1.4.0.tgz#4abebfeed7541f2c27acfb29bdbbd15c8d5ba4f7\"\n@@ -6091,10 +6423,10 @@ node-notifier@^9.0.0:\n     uuid \"^8.3.0\"\n     which \"^2.0.2\"\n \n-node-releases@^2.0.13:\n-  version \"2.0.13\"\n-  resolved \"https://registry.yarnpkg.com/node-releases/-/node-releases-2.0.13.tgz#d5ed1627c23e3461e819b02e57b75e4899b1c81d\"\n-  integrity sha512-uYr7J37ae/ORWdZeQ1xxMJe3NtdmqMC/JZK+geofDrkLUApKRHPd18/TxtBOJ4A0/+uUIliorNrfYV6s1b02eQ==\n+node-releases@^2.0.18:\n+  version \"2.0.18\"\n+  resolved \"https://registry.yarnpkg.com/node-releases/-/node-releases-2.0.18.tgz#f010e8d35e2fe8d6b2944f03f70213ecedc4ca3f\"\n+  integrity sha512-d9VeXT4SJ7ZeOqGX6R5EM022wpL+eWPooLI+5UpWn2jCT1aosUQEhQP214x33Wkwx3JQMvIm+tIoVOdodFS40g==\n \n node-releases@^2.0.3:\n   version \"2.0.5\"\n@@ -6155,6 +6487,11 @@ object-inspect@^1.12.2, object-inspect@^1.12.3:\n   resolved \"https://registry.yarnpkg.com/object-inspect/-/object-inspect-1.12.3.tgz#ba62dffd67ee256c8c086dfae69e016cd1f198b9\"\n   integrity sha512-geUvdk7c+eizMNUDkRpW1wJwgfOiOeHbxBR/hLXK1aT6zmVSO0jsQcs7fj6MGw89jC/cjGfLcNOrtMYtGqm81g==\n \n+object-inspect@^1.13.1:\n+  version \"1.13.2\"\n+  resolved \"https://registry.yarnpkg.com/object-inspect/-/object-inspect-1.13.2.tgz#dea0088467fb991e67af4058147a24824a3043ff\"\n+  integrity sha512-IRZSRuzJiynemAXPYtPe5BoI/RESNYR7TYm50MC5Mqbd3Jmw5y790sErYw3V6SryFJD64b74qQQs9wn5Bg/k3g==\n+\n object-keys@^1.1.1:\n   version \"1.1.1\"\n   resolved \"https://registry.yarnpkg.com/object-keys/-/object-keys-1.1.1.tgz#1c47f272df277f3b1daf061677d9c82e2322c60e\"\n@@ -6180,33 +6517,43 @@ object.assign@^4.1.4:\n     has-symbols \"^1.0.3\"\n     object-keys \"^1.1.1\"\n \n-object.fromentries@^2.0.6:\n-  version \"2.0.7\"\n-  resolved \"https://registry.yarnpkg.com/object.fromentries/-/object.fromentries-2.0.7.tgz#71e95f441e9a0ea6baf682ecaaf37fa2a8d7e616\"\n-  integrity sha512-UPbPHML6sL8PI/mOqPwsH4G6iyXcCGzLin8KvEPenOZN5lpCNBZZQ+V62vdjB1mQHrmqGQt5/OJzemUA+KJmEA==\n+object.assign@^4.1.5:\n+  version \"4.1.5\"\n+  resolved \"https://registry.yarnpkg.com/object.assign/-/object.assign-4.1.5.tgz#3a833f9ab7fdb80fc9e8d2300c803d216d8fdbb0\"\n+  integrity sha512-byy+U7gp+FVwmyzKPYhW2h5l3crpmGsxl7X2s8y43IgxvG4g3QZ6CffDtsNQy1WsmZpQbO+ybo0AlW7TY6DcBQ==\n   dependencies:\n-    call-bind \"^1.0.2\"\n-    define-properties \"^1.2.0\"\n-    es-abstract \"^1.22.1\"\n+    call-bind \"^1.0.5\"\n+    define-properties \"^1.2.1\"\n+    has-symbols \"^1.0.3\"\n+    object-keys \"^1.1.1\"\n \n-object.groupby@^1.0.0:\n-  version \"1.0.1\"\n-  resolved \"https://registry.yarnpkg.com/object.groupby/-/object.groupby-1.0.1.tgz#d41d9f3c8d6c778d9cbac86b4ee9f5af103152ee\"\n-  integrity sha512-HqaQtqLnp/8Bn4GL16cj+CUYbnpe1bh0TtEaWvybszDG4tgxCJuRpV8VGuvNaI1fAnI4lUJzDG55MXcOH4JZcQ==\n+object.fromentries@^2.0.8:\n+  version \"2.0.8\"\n+  resolved \"https://registry.yarnpkg.com/object.fromentries/-/object.fromentries-2.0.8.tgz#f7195d8a9b97bd95cbc1999ea939ecd1a2b00c65\"\n+  integrity sha512-k6E21FzySsSK5a21KRADBd/NGneRegFO5pLHfdQLpRDETUNJueLXs3WCzyQ3tFRDYgbq3KHGXfTbi2bs8WQ6rQ==\n   dependencies:\n-    call-bind \"^1.0.2\"\n-    define-properties \"^1.2.0\"\n-    es-abstract \"^1.22.1\"\n-    get-intrinsic \"^1.2.1\"\n+    call-bind \"^1.0.7\"\n+    define-properties \"^1.2.1\"\n+    es-abstract \"^1.23.2\"\n+    es-object-atoms \"^1.0.0\"\n \n-object.values@^1.1.6:\n-  version \"1.1.6\"\n-  resolved \"https://registry.yarnpkg.com/object.values/-/object.values-1.1.6.tgz#4abbaa71eba47d63589d402856f908243eea9b1d\"\n-  integrity sha512-FVVTkD1vENCsAcwNs9k6jea2uHC/X0+JcjG8YA60FN5CMaJmG95wT9jek/xX9nornqGRrBkKtzuAu2wuHpKqvw==\n+object.groupby@^1.0.3:\n+  version \"1.0.3\"\n+  resolved \"https://registry.yarnpkg.com/object.groupby/-/object.groupby-1.0.3.tgz#9b125c36238129f6f7b61954a1e7176148d5002e\"\n+  integrity sha512-+Lhy3TQTuzXI5hevh8sBGqbmurHbbIjAi0Z4S63nthVLmLxfbj4T54a4CfZrXIrt9iP4mVAPYMo/v99taj3wjQ==\n   dependencies:\n-    call-bind \"^1.0.2\"\n-    define-properties \"^1.1.4\"\n-    es-abstract \"^1.20.4\"\n+    call-bind \"^1.0.7\"\n+    define-properties \"^1.2.1\"\n+    es-abstract \"^1.23.2\"\n+\n+object.values@^1.2.0:\n+  version \"1.2.0\"\n+  resolved \"https://registry.yarnpkg.com/object.values/-/object.values-1.2.0.tgz#65405a9d92cee68ac2d303002e0b8470a4d9ab1b\"\n+  integrity sha512-yBYjY9QX2hnRmZHAjG/f13MzmBzxzYgQhFrke06TTyKY5zSTEqkOeukBzIdVA3j3ulu8Qa3MbVFShV7T2RmGtQ==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    define-properties \"^1.2.1\"\n+    es-object-atoms \"^1.0.0\"\n \n obuf@^1.0.0, obuf@^1.1.2:\n   version \"1.1.2\"\n@@ -6435,6 +6782,11 @@ picocolors@^1.0.0:\n   resolved \"https://registry.yarnpkg.com/picocolors/-/picocolors-1.0.0.tgz#cb5bdc74ff3f51892236eaf79d68bc44564ab81c\"\n   integrity sha512-1fygroTLlHu66zi26VoTDv8yRgm0Fccecssto+MhsZ0D/DGW2sm8E8AjW7NU5VVTRt5GxbeZ5qBuJr+HyLYkjQ==\n \n+picocolors@^1.0.1, picocolors@^1.1.0:\n+  version \"1.1.0\"\n+  resolved \"https://registry.yarnpkg.com/picocolors/-/picocolors-1.1.0.tgz#5358b76a78cde483ba5cef6a9dc9671440b27d59\"\n+  integrity sha512-TQ92mBOW0l3LeMeyLV6mzy/kWr8lkd/hp3mTg7wYK7zJhuBStmGMBG0BdeDZS/dZx1IukaX6Bk11zcln25o1Aw==\n+\n picomatch@^2.0.4, picomatch@^2.2.1, picomatch@^2.2.3, picomatch@^2.3.1:\n   version \"2.3.1\"\n   resolved \"https://registry.yarnpkg.com/picomatch/-/picomatch-2.3.1.tgz#3ba3833733646d9d3e4995946c1365a67fb07a42\"\n@@ -6462,6 +6814,11 @@ pkg-dir@^4.1.0, pkg-dir@^4.2.0:\n   dependencies:\n     find-up \"^4.0.0\"\n \n+possible-typed-array-names@^1.0.0:\n+  version \"1.0.0\"\n+  resolved \"https://registry.yarnpkg.com/possible-typed-array-names/-/possible-typed-array-names-1.0.0.tgz#89bb63c6fada2c3e90adc4a647beeeb39cc7bf8f\"\n+  integrity sha512-d7Uw+eZoloe0EHDIYoe+bQ5WXnGMOpmiZFTuMWCwpjzzkL2nTjcKiAk4hh8TjnGye2TwWOk3UXucZ+3rbmBa8Q==\n+\n postcss-calc@^8.2.3:\n   version \"8.2.4\"\n   resolved \"https://registry.yarnpkg.com/postcss-calc/-/postcss-calc-8.2.4.tgz#77b9c29bfcbe8a07ff6693dc87050828889739a5\"\n@@ -6526,6 +6883,15 @@ postcss-import@^15.1.0:\n     read-cache \"^1.0.0\"\n     resolve \"^1.1.7\"\n \n+postcss-import@^16.1.0:\n+  version \"16.1.0\"\n+  resolved \"https://registry.yarnpkg.com/postcss-import/-/postcss-import-16.1.0.tgz#258732175518129667fe1e2e2a05b19b5654b96a\"\n+  integrity sha512-7hsAZ4xGXl4MW+OKEWCnF6T5jqBw80/EE9aXg1r2yyn1RsVEU8EtKXbijEODa+rg7iih4bKf7vlvTGYR4CnPNg==\n+  dependencies:\n+    postcss-value-parser \"^4.0.0\"\n+    read-cache \"^1.0.0\"\n+    resolve \"^1.1.7\"\n+\n postcss-js@^4.0.0:\n   version \"4.0.0\"\n   resolved \"https://registry.yarnpkg.com/postcss-js/-/postcss-js-4.0.0.tgz#31db79889531b80dc7bc9b0ad283e418dce0ac00\"\n@@ -6797,14 +7163,14 @@ postcss@^8.4.23:\n     picocolors \"^1.0.0\"\n     source-map-js \"^1.0.2\"\n \n-postcss@^8.4.31:\n-  version \"8.4.31\"\n-  resolved \"https://registry.yarnpkg.com/postcss/-/postcss-8.4.31.tgz#92b451050a9f914da6755af352bdc0192508656d\"\n-  integrity sha512-PS08Iboia9mts/2ygV3eLpY5ghnUcfLV/EXTOW1E2qYxJKGGBUtNjN76FYHnMs36RmARn41bC0AZmn+rR0OVpQ==\n+postcss@^8.4.47:\n+  version \"8.4.47\"\n+  resolved \"https://registry.yarnpkg.com/postcss/-/postcss-8.4.47.tgz#5bf6c9a010f3e724c503bf03ef7947dcb0fea365\"\n+  integrity sha512-56rxCq7G/XfB4EkXq9Egn5GCqugWvDFjafDOThIdMBsI15iqPqR5r15TfSr1YPYeEI19YeaXMCbY6u88Y76GLQ==\n   dependencies:\n-    nanoid \"^3.3.6\"\n-    picocolors \"^1.0.0\"\n-    source-map-js \"^1.0.2\"\n+    nanoid \"^3.3.7\"\n+    picocolors \"^1.1.0\"\n+    source-map-js \"^1.2.1\"\n \n prelude-ls@^1.2.1:\n   version \"1.2.1\"\n@@ -6909,12 +7275,12 @@ qs@6.10.3:\n   dependencies:\n     side-channel \"^1.0.4\"\n \n-qs@^6.11.2:\n-  version \"6.11.2\"\n-  resolved \"https://registry.yarnpkg.com/qs/-/qs-6.11.2.tgz#64bea51f12c1f5da1bc01496f48ffcff7c69d7d9\"\n-  integrity sha512-tDNIz22aBzCDxLtVH++VnTfzxlfeK5CbqohpSqpJgj1Wg/cQbStNAz3NuqCs5vV+pjBsK4x4pN9HlVh7rcYRiA==\n+qs@^6.13.0:\n+  version \"6.13.0\"\n+  resolved \"https://registry.yarnpkg.com/qs/-/qs-6.13.0.tgz#6ca3bd58439f7e245655798997787b0d88a51906\"\n+  integrity sha512-+38qI9SOr8tfZ4QmJNplMUxqjbe7LKvvZgWdExBOmd+egZTtjLB67Gu0HRX3u/XOq7UU2Nx6nsjvS16Z9uwfpg==\n   dependencies:\n-    side-channel \"^1.0.4\"\n+    side-channel \"^1.0.6\"\n \n querystring-es3@^0.2.0:\n   version \"0.2.1\"\n@@ -7065,6 +7431,16 @@ regexp.prototype.flags@^1.5.0:\n     define-properties \"^1.2.0\"\n     functions-have-names \"^1.2.3\"\n \n+regexp.prototype.flags@^1.5.2:\n+  version \"1.5.2\"\n+  resolved \"https://registry.yarnpkg.com/regexp.prototype.flags/-/regexp.prototype.flags-1.5.2.tgz#138f644a3350f981a858c44f6bb1a61ff59be334\"\n+  integrity sha512-NcDiDkTLuPR+++OCKB0nWafEmhg/Da8aUPLPMQbK+bxKKCm1/S5he+AqYa4PlMCVBalb4/yxIRub6qkEx5yJbw==\n+  dependencies:\n+    call-bind \"^1.0.6\"\n+    define-properties \"^1.2.1\"\n+    es-errors \"^1.3.0\"\n+    set-function-name \"^2.0.1\"\n+\n regexpu-core@^5.0.1:\n   version \"5.0.1\"\n   resolved \"https://registry.yarnpkg.com/regexpu-core/-/regexpu-core-5.0.1.tgz#c531122a7840de743dcf9c83e923b5560323ced3\"\n@@ -7163,6 +7539,15 @@ resolve@^1.22.2:\n     path-parse \"^1.0.7\"\n     supports-preserve-symlinks-flag \"^1.0.0\"\n \n+resolve@^1.22.4:\n+  version \"1.22.8\"\n+  resolved \"https://registry.yarnpkg.com/resolve/-/resolve-1.22.8.tgz#b6c87a9f2aa06dfab52e3d70ac8cde321fa5a48d\"\n+  integrity sha512-oKWePCxqpd6FlLvGV1VU0x7bkPmmCNolxzjMf4NczoDnQcIWrAF+cPtZn5i6n+RfD2d9i0tzpKnG6Yk168yIyw==\n+  dependencies:\n+    is-core-module \"^2.13.0\"\n+    path-parse \"^1.0.7\"\n+    supports-preserve-symlinks-flag \"^1.0.0\"\n+\n retry@^0.13.1:\n   version \"0.13.1\"\n   resolved \"https://registry.yarnpkg.com/retry/-/retry-0.13.1.tgz#185b1587acf67919d63b357349e03537b2484658\"\n@@ -7205,6 +7590,16 @@ safe-array-concat@^1.0.0:\n     has-symbols \"^1.0.3\"\n     isarray \"^2.0.5\"\n \n+safe-array-concat@^1.1.2:\n+  version \"1.1.2\"\n+  resolved \"https://registry.yarnpkg.com/safe-array-concat/-/safe-array-concat-1.1.2.tgz#81d77ee0c4e8b863635227c721278dd524c20edb\"\n+  integrity sha512-vj6RsCsWBCf19jIeHEfkRMw8DPiBb+DMXklQ/1SGDHOMlHdPUkZXFQ2YdplS23zESTijAcurb1aSgJA3AgMu1Q==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    get-intrinsic \"^1.2.4\"\n+    has-symbols \"^1.0.3\"\n+    isarray \"^2.0.5\"\n+\n safe-buffer@5.1.2, safe-buffer@~5.1.0, safe-buffer@~5.1.1:\n   version \"5.1.2\"\n   resolved \"https://registry.yarnpkg.com/safe-buffer/-/safe-buffer-5.1.2.tgz#991ec69d296e0313747d59bdfd2b745c35f8828d\"\n@@ -7224,6 +7619,15 @@ safe-regex-test@^1.0.0:\n     get-intrinsic \"^1.1.3\"\n     is-regex \"^1.1.4\"\n \n+safe-regex-test@^1.0.3:\n+  version \"1.0.3\"\n+  resolved \"https://registry.yarnpkg.com/safe-regex-test/-/safe-regex-test-1.0.3.tgz#a5b4c0f06e0ab50ea2c395c14d8371232924c377\"\n+  integrity sha512-CdASjNJPvRa7roO6Ra/gLYBTzYzzPyyBXxIMdGW3USQLyjWEls2RgW5UBTXaQVp+OrpeCK3bLem8smtmheoRuw==\n+  dependencies:\n+    call-bind \"^1.0.6\"\n+    es-errors \"^1.3.0\"\n+    is-regex \"^1.1.4\"\n+\n \"safer-buffer@>= 2.1.2 < 3\", \"safer-buffer@>= 2.1.2 < 3.0.0\", safer-buffer@^2.1.0:\n   version \"2.1.2\"\n   resolved \"https://registry.yarnpkg.com/safer-buffer/-/safer-buffer-2.1.2.tgz#44fa161b0187b9549dd84bb91802f9bd8385cd6a\"\n@@ -7305,6 +7709,11 @@ semver@^7.5.3, semver@^7.5.4:\n   dependencies:\n     lru-cache \"^6.0.0\"\n \n+semver@^7.6.3:\n+  version \"7.6.3\"\n+  resolved \"https://registry.yarnpkg.com/semver/-/semver-7.6.3.tgz#980f7b5550bc175fb4dc09403085627f9eb33143\"\n+  integrity sha512-oVekP1cKtI+CTDvHWYFUcMtsK/00wmAEfyqKfNdARm8u1wNVhSgaX7A8d4UuIlUI5e84iEwOhs7ZPYRmzU9U6A==\n+\n send@0.18.0:\n   version \"0.18.0\"\n   resolved \"https://registry.yarnpkg.com/send/-/send-0.18.0.tgz#670167cc654b05f5aa4a767f9113bb371bc706be\"\n@@ -7354,6 +7763,28 @@ serve-static@1.15.0:\n     parseurl \"~1.3.3\"\n     send \"0.18.0\"\n \n+set-function-length@^1.2.1:\n+  version \"1.2.2\"\n+  resolved \"https://registry.yarnpkg.com/set-function-length/-/set-function-length-1.2.2.tgz#aac72314198eaed975cf77b2c3b6b880695e5449\"\n+  integrity sha512-pgRc4hJ4/sNjWCSS9AmnS40x3bNMDTknHgL5UaMBTMyJnU90EgWh1Rz+MC9eFu4BuN/UwZjKQuY/1v3rM7HMfg==\n+  dependencies:\n+    define-data-property \"^1.1.4\"\n+    es-errors \"^1.3.0\"\n+    function-bind \"^1.1.2\"\n+    get-intrinsic \"^1.2.4\"\n+    gopd \"^1.0.1\"\n+    has-property-descriptors \"^1.0.2\"\n+\n+set-function-name@^2.0.1:\n+  version \"2.0.2\"\n+  resolved \"https://registry.yarnpkg.com/set-function-name/-/set-function-name-2.0.2.tgz#16a705c5a0dc2f5e638ca96d8a8cd4e1c2b90985\"\n+  integrity sha512-7PGFlmtwsEADb0WYyvCMa1t+yke6daIG4Wirafur5kcf+MhUnPms1UeR0CKQdTZD81yESwMHbtn+TR+dMviakQ==\n+  dependencies:\n+    define-data-property \"^1.1.4\"\n+    es-errors \"^1.3.0\"\n+    functions-have-names \"^1.2.3\"\n+    has-property-descriptors \"^1.0.2\"\n+\n setimmediate@^1.0.4:\n   version \"1.0.5\"\n   resolved \"https://registry.yarnpkg.com/setimmediate/-/setimmediate-1.0.5.tgz#290cbb232e306942d7d7ea9b83732ab7856f8285\"\n@@ -7410,6 +7841,16 @@ side-channel@^1.0.4:\n     get-intrinsic \"^1.0.2\"\n     object-inspect \"^1.9.0\"\n \n+side-channel@^1.0.6:\n+  version \"1.0.6\"\n+  resolved \"https://registry.yarnpkg.com/side-channel/-/side-channel-1.0.6.tgz#abd25fb7cd24baf45466406b1096b7831c9215f2\"\n+  integrity sha512-fDW/EZ6Q9RiO8eFG8Hj+7u/oW+XrPTIChwCOM2+th2A6OblDtYYIpve9m+KvI9Z4C9qSEXlaGR6bTEYHReuglA==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    es-errors \"^1.3.0\"\n+    get-intrinsic \"^1.2.4\"\n+    object-inspect \"^1.13.1\"\n+\n signal-exit@^3.0.3, signal-exit@^3.0.7:\n   version \"3.0.7\"\n   resolved \"https://registry.yarnpkg.com/signal-exit/-/signal-exit-3.0.7.tgz#a9a1767f8af84155114eaabd73f99273c8f59ad9\"\n@@ -7444,6 +7885,11 @@ source-map-js@^1.0.2:\n   resolved \"https://registry.yarnpkg.com/source-map-js/-/source-map-js-1.0.2.tgz#adbc361d9c62df380125e7f161f71c826f1e490c\"\n   integrity sha512-R0XvVJ9WusLiqTCEiGCmICCMplcCkIwwR11mOSD9CR5u+IXYdiseeEuXCVAjS54zqwkLcPNnmU4OeJ6tUrWhDw==\n \n+source-map-js@^1.2.1:\n+  version \"1.2.1\"\n+  resolved \"https://registry.yarnpkg.com/source-map-js/-/source-map-js-1.2.1.tgz#1ce5650fddd87abc099eda37dcff024c2667ae46\"\n+  integrity sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==\n+\n source-map-support@0.5.13:\n   version \"0.5.13\"\n   resolved \"https://registry.yarnpkg.com/source-map-support/-/source-map-support-0.5.13.tgz#31b24a9c2e73c2de85066c0feb7d44767ed52932\"\n@@ -7577,6 +8023,16 @@ string.prototype.trim@^1.2.7:\n     define-properties \"^1.1.4\"\n     es-abstract \"^1.20.4\"\n \n+string.prototype.trim@^1.2.9:\n+  version \"1.2.9\"\n+  resolved \"https://registry.yarnpkg.com/string.prototype.trim/-/string.prototype.trim-1.2.9.tgz#b6fa326d72d2c78b6df02f7759c73f8f6274faa4\"\n+  integrity sha512-klHuCNxiMZ8MlsOihJhJEBJAiMVqU3Z2nEXWfWnIqjN0gEFS9J9+IxKozWWtQGcgoa1WUZzLjKPTr4ZHNFTFxw==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    define-properties \"^1.2.1\"\n+    es-abstract \"^1.23.0\"\n+    es-object-atoms \"^1.0.0\"\n+\n string.prototype.trimend@^1.0.5:\n   version \"1.0.5\"\n   resolved \"https://registry.yarnpkg.com/string.prototype.trimend/-/string.prototype.trimend-1.0.5.tgz#914a65baaab25fbdd4ee291ca7dde57e869cb8d0\"\n@@ -7595,6 +8051,15 @@ string.prototype.trimend@^1.0.6:\n     define-properties \"^1.1.4\"\n     es-abstract \"^1.20.4\"\n \n+string.prototype.trimend@^1.0.8:\n+  version \"1.0.8\"\n+  resolved \"https://registry.yarnpkg.com/string.prototype.trimend/-/string.prototype.trimend-1.0.8.tgz#3651b8513719e8a9f48de7f2f77640b26652b229\"\n+  integrity sha512-p73uL5VCHCO2BZZ6krwwQE3kCzM7NKmis8S//xEC6fQonchbum4eP6kR4DLEjQFO3Wnj3Fuo8NM0kOSjVdHjZQ==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    define-properties \"^1.2.1\"\n+    es-object-atoms \"^1.0.0\"\n+\n string.prototype.trimstart@^1.0.5:\n   version \"1.0.5\"\n   resolved \"https://registry.yarnpkg.com/string.prototype.trimstart/-/string.prototype.trimstart-1.0.5.tgz#5466d93ba58cfa2134839f81d7f42437e8c01fef\"\n@@ -7613,6 +8078,15 @@ string.prototype.trimstart@^1.0.6:\n     define-properties \"^1.1.4\"\n     es-abstract \"^1.20.4\"\n \n+string.prototype.trimstart@^1.0.8:\n+  version \"1.0.8\"\n+  resolved \"https://registry.yarnpkg.com/string.prototype.trimstart/-/string.prototype.trimstart-1.0.8.tgz#7ee834dda8c7c17eff3118472bb35bfedaa34dde\"\n+  integrity sha512-UXSH262CSZY1tfu3G3Secr6uGLCFVPMhIqHjlgCUtCCcgihYc/xKs9djMTMUOb2j1mVSeU8EU6NWc/iQKU6Gfg==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    define-properties \"^1.2.1\"\n+    es-object-atoms \"^1.0.0\"\n+\n string_decoder@^1.0.0, string_decoder@^1.1.1:\n   version \"1.3.0\"\n   resolved \"https://registry.yarnpkg.com/string_decoder/-/string_decoder-1.3.0.tgz#42f114594a46cf1a8e30b0a84f56c78c3edac21e\"\n@@ -7755,20 +8229,20 @@ tailwindcss@*:\n     quick-lru \"^5.1.1\"\n     resolve \"^1.22.1\"\n \n-tailwindcss@^3.3.3:\n-  version \"3.3.3\"\n-  resolved \"https://registry.yarnpkg.com/tailwindcss/-/tailwindcss-3.3.3.tgz#90da807393a2859189e48e9e7000e6880a736daf\"\n-  integrity sha512-A0KgSkef7eE4Mf+nKJ83i75TMyq8HqY3qmFIJSWy8bNt0v1lG7jUcpGpoTFxAwYcWOphcTBLPPJg+bDfhDf52w==\n+tailwindcss@^3.4.11:\n+  version \"3.4.11\"\n+  resolved \"https://registry.yarnpkg.com/tailwindcss/-/tailwindcss-3.4.11.tgz#4d6df41acc05a1d0291b1319490db8df375ab709\"\n+  integrity sha512-qhEuBcLemjSJk5ajccN9xJFtM/h0AVCPaA6C92jNP+M2J8kX+eMJHI7R2HFKUvvAsMpcfLILMCFYSeDwpMmlUg==\n   dependencies:\n     \"@alloc/quick-lru\" \"^5.2.0\"\n     arg \"^5.0.2\"\n     chokidar \"^3.5.3\"\n     didyoumean \"^1.2.2\"\n     dlv \"^1.1.3\"\n-    fast-glob \"^3.2.12\"\n+    fast-glob \"^3.3.0\"\n     glob-parent \"^6.0.2\"\n     is-glob \"^4.0.3\"\n-    jiti \"^1.18.2\"\n+    jiti \"^1.21.0\"\n     lilconfig \"^2.1.0\"\n     micromatch \"^4.0.5\"\n     normalize-path \"^3.0.0\"\n@@ -7918,35 +8392,36 @@ ts-interface-checker@^0.1.9:\n   resolved \"https://registry.yarnpkg.com/ts-interface-checker/-/ts-interface-checker-0.1.13.tgz#784fd3d679722bc103b1b4b8030bcddb5db2a699\"\n   integrity sha512-Y/arvbn+rrz3JCKl9C4kVNfTfSm2/mEp5FSz5EsZSANGPSlQrpRI5M4PKF+mJnE52jOO90PnPSc3Ur3bTQw0gA==\n \n-ts-jest@^29.1.1:\n-  version \"29.1.1\"\n-  resolved \"https://registry.yarnpkg.com/ts-jest/-/ts-jest-29.1.1.tgz#f58fe62c63caf7bfcc5cc6472082f79180f0815b\"\n-  integrity sha512-D6xjnnbP17cC85nliwGiL+tpoKN0StpgE0TeOjXQTU6MVCfsB4v7aW05CgQ/1OywGb0x/oy9hHFnN+sczTiRaA==\n+ts-jest@^29.2.5:\n+  version \"29.2.5\"\n+  resolved \"https://registry.yarnpkg.com/ts-jest/-/ts-jest-29.2.5.tgz#591a3c108e1f5ebd013d3152142cb5472b399d63\"\n+  integrity sha512-KD8zB2aAZrcKIdGk4OwpJggeLcH1FgrICqDSROWqlnJXGCXK4Mn6FcdK2B6670Xr73lHMG1kHw8R87A0ecZ+vA==\n   dependencies:\n-    bs-logger \"0.x\"\n-    fast-json-stable-stringify \"2.x\"\n+    bs-logger \"^0.2.6\"\n+    ejs \"^3.1.10\"\n+    fast-json-stable-stringify \"^2.1.0\"\n     jest-util \"^29.0.0\"\n     json5 \"^2.2.3\"\n-    lodash.memoize \"4.x\"\n-    make-error \"1.x\"\n-    semver \"^7.5.3\"\n-    yargs-parser \"^21.0.1\"\n+    lodash.memoize \"^4.1.2\"\n+    make-error \"^1.3.6\"\n+    semver \"^7.6.3\"\n+    yargs-parser \"^21.1.1\"\n \n-ts-loader@^9.5.0:\n-  version \"9.5.0\"\n-  resolved \"https://registry.yarnpkg.com/ts-loader/-/ts-loader-9.5.0.tgz#f0a51dda37cc4d8e43e6cb14edebbc599b0c3aa2\"\n-  integrity sha512-LLlB/pkB4q9mW2yLdFMnK3dEHbrBjeZTYguaaIfusyojBgAGf5kF+O6KcWqiGzWqHk0LBsoolrp4VftEURhybg==\n+ts-loader@^9.5.1:\n+  version \"9.5.1\"\n+  resolved \"https://registry.yarnpkg.com/ts-loader/-/ts-loader-9.5.1.tgz#63d5912a86312f1fbe32cef0859fb8b2193d9b89\"\n+  integrity sha512-rNH3sK9kGZcH9dYzC7CewQm4NtxJTjSEVRJ2DyBZR7f8/wcta+iV44UPCXc5+nzDzivKtlzV6c9P4e+oFhDLYg==\n   dependencies:\n     chalk \"^4.1.0\"\n     enhanced-resolve \"^5.0.0\"\n     micromatch \"^4.0.0\"\n     semver \"^7.3.4\"\n     source-map \"^0.7.4\"\n \n-ts-node@^10.9.1:\n-  version \"10.9.1\"\n-  resolved \"https://registry.yarnpkg.com/ts-node/-/ts-node-10.9.1.tgz#e73de9102958af9e1f0b168a6ff320e25adcff4b\"\n-  integrity sha512-NtVysVPkxxrwFGUUxGYhfux8k78pQB3JqYBXlLRZgdGUqTO5wU/UyHop5p70iEbGhB7q5KmiZiU0Y3KlJrScEw==\n+ts-node@^10.9.2:\n+  version \"10.9.2\"\n+  resolved \"https://registry.yarnpkg.com/ts-node/-/ts-node-10.9.2.tgz#70f021c9e185bccdca820e26dc413805c101c71f\"\n+  integrity sha512-f0FFpIdcHgn8zcPSbf1dRevwt047YMnaiJM3u2w2RewrB+fob/zePZcrOyQoLMMO7aBIddLcQIEK5dYjkLnGrQ==\n   dependencies:\n     \"@cspotcode/source-map-support\" \"^0.8.0\"\n     \"@tsconfig/node10\" \"^1.0.7\"\n@@ -7962,10 +8437,10 @@ ts-node@^10.9.1:\n     v8-compile-cache-lib \"^3.0.1\"\n     yn \"3.1.1\"\n \n-tsconfig-paths@^3.14.2:\n-  version \"3.14.2\"\n-  resolved \"https://registry.yarnpkg.com/tsconfig-paths/-/tsconfig-paths-3.14.2.tgz#6e32f1f79412decd261f92d633a9dc1cfa99f088\"\n-  integrity sha512-o/9iXgCYc5L/JxCHPe3Hvh8Q/2xm5Z+p18PESBU6Ff33695QnCHBEjcytY2q19ua7Mbl/DavtBOLq+oG0RCL+g==\n+tsconfig-paths@^3.15.0:\n+  version \"3.15.0\"\n+  resolved \"https://registry.yarnpkg.com/tsconfig-paths/-/tsconfig-paths-3.15.0.tgz#5299ec605e55b1abb23ec939ef15edaf483070d4\"\n+  integrity sha512-2Ac2RgzDe/cn48GvOe3M+o82pEFewD3UPbyoUHHdKasHwJKjds4fLXWf/Ux5kATBKN20oaFGu+jbElp1pos0mg==\n   dependencies:\n     \"@types/json5\" \"^0.0.29\"\n     json5 \"^1.0.2\"\n@@ -8028,6 +8503,15 @@ typed-array-buffer@^1.0.0:\n     get-intrinsic \"^1.2.1\"\n     is-typed-array \"^1.1.10\"\n \n+typed-array-buffer@^1.0.2:\n+  version \"1.0.2\"\n+  resolved \"https://registry.yarnpkg.com/typed-array-buffer/-/typed-array-buffer-1.0.2.tgz#1867c5d83b20fcb5ccf32649e5e2fc7424474ff3\"\n+  integrity sha512-gEymJYKZtKXzzBzM4jqa9w6Q1Jjm7x2d+sh19AdsD4wqnMPDYyvwpsIc2Q/835kHuo3BEQ7CjelGhfTsoBb2MQ==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    es-errors \"^1.3.0\"\n+    is-typed-array \"^1.1.13\"\n+\n typed-array-byte-length@^1.0.0:\n   version \"1.0.0\"\n   resolved \"https://registry.yarnpkg.com/typed-array-byte-length/-/typed-array-byte-length-1.0.0.tgz#d787a24a995711611fb2b87a4052799517b230d0\"\n@@ -8038,6 +8522,17 @@ typed-array-byte-length@^1.0.0:\n     has-proto \"^1.0.1\"\n     is-typed-array \"^1.1.10\"\n \n+typed-array-byte-length@^1.0.1:\n+  version \"1.0.1\"\n+  resolved \"https://registry.yarnpkg.com/typed-array-byte-length/-/typed-array-byte-length-1.0.1.tgz#d92972d3cff99a3fa2e765a28fcdc0f1d89dec67\"\n+  integrity sha512-3iMJ9q0ao7WE9tWcaYKIptkNBuOIcZCCT0d4MRvuuH88fEoEH62IuQe0OtraD3ebQEoTRk8XCBoknUNc1Y67pw==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    for-each \"^0.3.3\"\n+    gopd \"^1.0.1\"\n+    has-proto \"^1.0.3\"\n+    is-typed-array \"^1.1.13\"\n+\n typed-array-byte-offset@^1.0.0:\n   version \"1.0.0\"\n   resolved \"https://registry.yarnpkg.com/typed-array-byte-offset/-/typed-array-byte-offset-1.0.0.tgz#cbbe89b51fdef9cd6aaf07ad4707340abbc4ea0b\"\n@@ -8049,6 +8544,18 @@ typed-array-byte-offset@^1.0.0:\n     has-proto \"^1.0.1\"\n     is-typed-array \"^1.1.10\"\n \n+typed-array-byte-offset@^1.0.2:\n+  version \"1.0.2\"\n+  resolved \"https://registry.yarnpkg.com/typed-array-byte-offset/-/typed-array-byte-offset-1.0.2.tgz#f9ec1acb9259f395093e4567eb3c28a580d02063\"\n+  integrity sha512-Ous0vodHa56FviZucS2E63zkgtgrACj7omjwd/8lTEMEPFFyjfixMZ1ZXenpgCFBBt4EC1J2XsyVS2gkG0eTFA==\n+  dependencies:\n+    available-typed-arrays \"^1.0.7\"\n+    call-bind \"^1.0.7\"\n+    for-each \"^0.3.3\"\n+    gopd \"^1.0.1\"\n+    has-proto \"^1.0.3\"\n+    is-typed-array \"^1.1.13\"\n+\n typed-array-length@^1.0.4:\n   version \"1.0.4\"\n   resolved \"https://registry.yarnpkg.com/typed-array-length/-/typed-array-length-1.0.4.tgz#89d83785e5c4098bec72e08b319651f0eac9c1bb\"\n@@ -8058,10 +8565,22 @@ typed-array-length@^1.0.4:\n     for-each \"^0.3.3\"\n     is-typed-array \"^1.1.9\"\n \n-typescript@^5.2.2:\n-  version \"5.2.2\"\n-  resolved \"https://registry.yarnpkg.com/typescript/-/typescript-5.2.2.tgz#5ebb5e5a5b75f085f22bc3f8460fba308310fa78\"\n-  integrity sha512-mI4WrpHsbCIcwT9cF4FZvr80QUeKvsUsUvKDoR+X/7XHQH98xYD8YHZg7ANtz2GtZt/CBq2QJ0thkGJMHfqc1w==\n+typed-array-length@^1.0.6:\n+  version \"1.0.6\"\n+  resolved \"https://registry.yarnpkg.com/typed-array-length/-/typed-array-length-1.0.6.tgz#57155207c76e64a3457482dfdc1c9d1d3c4c73a3\"\n+  integrity sha512-/OxDN6OtAk5KBpGb28T+HZc2M+ADtvRxXrKKbUwtsLgdoxgX13hyy7ek6bFRl5+aBs2yZzB0c4CnQfAtVypW/g==\n+  dependencies:\n+    call-bind \"^1.0.7\"\n+    for-each \"^0.3.3\"\n+    gopd \"^1.0.1\"\n+    has-proto \"^1.0.3\"\n+    is-typed-array \"^1.1.13\"\n+    possible-typed-array-names \"^1.0.0\"\n+\n+typescript@^5.6.2:\n+  version \"5.6.2\"\n+  resolved \"https://registry.yarnpkg.com/typescript/-/typescript-5.6.2.tgz#d1de67b6bef77c41823f822df8f0b3bcff60a5a0\"\n+  integrity sha512-NW8ByodCSNCwZeghjN3o+JX5OFH0Ojg6sadjEKY4huZ52TqbJTJnDo5+Tw98lSy63NZvi4n+ez5m2u5d4PkZyw==\n \n unbox-primitive@^1.0.2:\n   version \"1.0.2\"\n@@ -8111,13 +8630,13 @@ unpipe@1.0.0, unpipe@~1.0.0:\n   resolved \"https://registry.yarnpkg.com/unpipe/-/unpipe-1.0.0.tgz#b2bf4ee8514aae6165b4817829d21b2ef49904ec\"\n   integrity sha1-sr9O6FFKrmFltIF4KdIbLvSZBOw=\n \n-update-browserslist-db@^1.0.11:\n-  version \"1.0.11\"\n-  resolved \"https://registry.yarnpkg.com/update-browserslist-db/-/update-browserslist-db-1.0.11.tgz#9a2a641ad2907ae7b3616506f4b977851db5b940\"\n-  integrity sha512-dCwEFf0/oT85M1fHBg4F0jtLwJrutGoHSQXCh7u4o2t1drG+c0a9Flnqww6XUKSfQMPpJBRjU8d4RXB09qtvaA==\n+update-browserslist-db@^1.1.0:\n+  version \"1.1.0\"\n+  resolved \"https://registry.yarnpkg.com/update-browserslist-db/-/update-browserslist-db-1.1.0.tgz#7ca61c0d8650766090728046e416a8cde682859e\"\n+  integrity sha512-EdRAaAyk2cUE1wOf2DkEhzxqOQvFOoRJFNS6NeyJ01Gp2beMRpBAINjM2iDXE3KCuKhwnvHIQCJm6ThL2Z+HzQ==\n   dependencies:\n-    escalade \"^3.1.1\"\n-    picocolors \"^1.0.0\"\n+    escalade \"^3.1.2\"\n+    picocolors \"^1.0.1\"\n \n uri-js@^4.2.2:\n   version \"4.4.1\"\n@@ -8438,6 +8957,17 @@ which-typed-array@^1.1.10:\n     gopd \"^1.0.1\"\n     has-tostringtag \"^1.0.0\"\n \n+which-typed-array@^1.1.14, which-typed-array@^1.1.15:\n+  version \"1.1.15\"\n+  resolved \"https://registry.yarnpkg.com/which-typed-array/-/which-typed-array-1.1.15.tgz#264859e9b11a649b388bfaaf4f767df1f779b38d\"\n+  integrity sha512-oV0jmFtUky6CXfkqehVvBP/LSWJ2sy4vWMioiENyJLePrBO/yKyV9OyJySfAKosh+RYkIl5zJCNZ8/4JncrpdA==\n+  dependencies:\n+    available-typed-arrays \"^1.0.7\"\n+    call-bind \"^1.0.7\"\n+    for-each \"^0.3.3\"\n+    gopd \"^1.0.1\"\n+    has-tostringtag \"^1.0.2\"\n+\n which-typed-array@^1.1.9:\n   version \"1.1.9\"\n   resolved \"https://registry.yarnpkg.com/which-typed-array/-/which-typed-array-1.1.9.tgz#307cf898025848cf995e795e8423c7f337efbde6\"\n@@ -8534,11 +9064,16 @@ yaml@^2.1.1:\n   resolved \"https://registry.yarnpkg.com/yaml/-/yaml-2.3.2.tgz#f522db4313c671a0ca963a75670f1c12ea909144\"\n   integrity sha512-N/lyzTPaJasoDmfV7YTrYCI0G/3ivm/9wdG0aHuheKowWQwGTsK0Eoiw6utmzAnI6pkJa0DUVygvp3spqqEKXg==\n \n-yargs-parser@^21.0.0, yargs-parser@^21.0.1:\n+yargs-parser@^21.0.0:\n   version \"21.0.1\"\n   resolved \"https://registry.yarnpkg.com/yargs-parser/-/yargs-parser-21.0.1.tgz#0267f286c877a4f0f728fceb6f8a3e4cb95c6e35\"\n   integrity sha512-9BK1jFpLzJROCI5TzwZL/TU4gqjK5xiHV/RfWLOahrjAko/e4DJkRDZQXfvqAsiZzzYhgAzbgz6lg48jcm4GLg==\n \n+yargs-parser@^21.1.1:\n+  version \"21.1.1\"\n+  resolved \"https://registry.yarnpkg.com/yargs-parser/-/yargs-parser-21.1.1.tgz#9096bceebf990d21bb31fa9516e0ede294a77d35\"\n+  integrity sha512-tVpsJW7DdjecAiFpbIB1e3qxIQsE6NoPc5/eTdrbbIC4h0LVsWhnoa3g+m2HclBIujHzsxZ4VJVA+GUuc2/LBw==\n+\n yargs@^17.2.1, yargs@^17.3.1:\n   version \"17.5.1\"\n   resolved \"https://registry.yarnpkg.com/yargs/-/yargs-17.5.1.tgz#e109900cab6fcb7fd44b1d8249166feb0b36e58e\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/commits/cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
        "url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/commits/cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
        "html_url": "https://github.com/devise-two-factor/devise-two-factor/commit/cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
        "message": "Merge commit from fork\n\nPrepare v6.0.0",
        "files": [
            {
                "sha": "488e528caa06373f637950ff3923c432d401e1b9",
                "filename": ".markdownlint.json",
                "status": "added",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/.markdownlint.json",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/.markdownlint.json",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/.markdownlint.json?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -0,0 +1,6 @@\n+{\n+  \"MD026\": false,\n+  \"MD029\": false,\n+  \"MD031\": false,\n+  \"MD034\": false\n+}"
            },
            {
                "sha": "e2f1516dcd214d691887918602b30d94ade099e4",
                "filename": "README.md",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/README.md",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/README.md",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/README.md?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -15,9 +15,7 @@ We welcome pull requests, bug reports, and other contributions. We're especially\n \n ## Example App\n \n-An example Rails 4 application is provided in the `demo` directory. It showcases a minimal example of Devise-Two-Factor in action, and can act as a reference for integrating the gem into your own application.\n-\n-For the demo app to work, create an encryption key and store it as an environment variable. One way to do this is to create a file named `local_env.yml` in the application root. Set the value of `ENCRYPTION_KEY` in the YML file. That value will be loaded into the application environment by `application.rb`.\n+See [examples](demo/README.md).\n \n ## Getting Started\n "
            },
            {
                "sha": "eabf1b5ed3337d55456595d1174215479af7b14f",
                "filename": "SECURITY.md",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/SECURITY.md",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/SECURITY.md",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/SECURITY.md?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -2,4 +2,4 @@\n \n ## Reporting a Vulnerability\n \n-Please report any vulnerabilities to the [Synopsys PSIRT](https://www.synopsys.com/company/legal/vulnerability-disclosure-policy.html).\n+Please report any vulnerabilities to the [Black Duck PSIRT](psirt@blackduck.com)."
            },
            {
                "sha": "8e4c076d28fa0b7e6deb396226337abcba4dee64",
                "filename": "UPGRADING.md",
                "status": "modified",
                "additions": 26,
                "deletions": 12,
                "changes": 38,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/UPGRADING.md",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/UPGRADING.md",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/UPGRADING.md?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -1,8 +1,25 @@\n-# Upgrading from 4.x to 5.x\n+# Upgrading\n \n-## Background\n+## Upgrading from 5.x to 6.x\n \n-### Database columns in version 4.x and older\n+### save!\n+\n+`consume_otp!` and `invalidate_otp_backup_code!` now call `save!` instead of `save` (or nothing at all in the case of `invalide_otp_backup_code!`). If you manually called `save`/`save!` after calling `invalidate_otp_backup_code` you may be able to remove it.\n+\n+### Secret Lengths\n+\n+The `otp_secret_length` and `otp_backup_code_length` options have changed to be the number of random bytes that are generated.\n+If you had configured these values you may want to change them if you wish to keep the same output length.\n+\n+`otp_secret_length` now has a default value of 20, generating a 160 bit secret key with an output length length of 32 bytes.\n+\n+`otp_backup_code_length` now has a default value of 16, generating a 32 byte backup code.\n+\n+## Upgrading from 4.x to 5.x\n+\n+### Background\n+\n+#### Database columns in version 4.x and older\n \n Versions 4.x and older stored the OTP secret in an attribute called `encrypted_otp_secret` using the [attr_encrypted](https://github.com/attr-encrypted/attr_encrypted) gem. This gem is currently unmaintained which is part of the motivation for moving to Rails encrypted attributes. This attribute was backed by three database columns:\n \n@@ -21,7 +38,7 @@ otp_required_for_login\n \n A fresh install of 4.x would create all five of the database columns above.\n \n-### Database columns in version 5.x and later\n+#### Database columns in version 5.x and later\n \n Versions 5+ of this gem uses a single [Rails 7+ encrypted attribute](https://edgeguides.rubyonrails.org/active_record_encryption.html) named `otp_secret`to store the OTP secret in the database table (usually `users` but will be whatever model you picked).\n \n@@ -33,18 +50,15 @@ consumed_timestep\n otp_required_for_login\n ```\n \n-### Upgrading from 4.x to 5.x\n-\n-\n We have attempted to make the upgrade as painless as possible but unfortunately because of the secret storage change, it cannot be as simple as `bundle update devise-two-factor` :heart:\n \n-#### Assumptions\n+### Assumptions\n \n This guide assumes you are upgrading an existing Rails 6 app (with `devise` and `devise-two-factor`) to Rails 7.\n \n This gem must be upgraded **as part of a Rails 7 upgrade**. See [the official Rails upgrading guide](https://guides.rubyonrails.org/upgrading_ruby_on_rails.html) for an overview of upgrading Rails.\n \n-#### Phase 1: Upgrading devise-two-factor as part of Rails 7 upgrade\n+### Phase 1: Upgrading devise-two-factor as part of Rails 7 upgrade\n \n 1. Update the version constraint for Rails in your `Gemfile` to your desired version e.g. `gem \"rails\", \"~> 7.0.3\"`\n 1. Run `bundle install` and resolve any issues with dependencies.\n@@ -149,7 +163,7 @@ You can now deploy your upgraded application and devise-two-factor should work a\n \n This gem will fall back to **reading** the OTP secret from the legacy columns if it cannot find one in the new `otp_secret` column. When you **write** a new OTP secret it will always be written to the new `otp_secret` column.\n \n-#### Phase 2: Clean up\n+### Phase 2: Clean up\n \n This \"clean up\" phase can happen at the same time as your initial deployment but teams managing existing apps will likely want to do clean-up as separate, later deployments.\n \n@@ -200,7 +214,7 @@ This \"clean up\" phase can happen at the same time as your initial deployment but\n     devise :two_factor_authenticatable\n     ```\n \n-# Guide to upgrading from 2.x to 3.x\n+## Upgrading from 2.x to 3.x\n \n Pull request #76 allows for compatibility with `attr_encrypted` 3.0, which should be used due to a security vulnerability discovered in 2.0.\n \n@@ -220,7 +234,7 @@ class User < ActiveRecord::Base\n          :otp_secret_encryption_key => ENV['DEVISE_TWO_FACTOR_ENCRYPTION_KEY']\n ```\n \n-# Guide to upgrading from 1.x to 2.x\n+## Upgrading from 1.x to 2.x\n \n Pull request #43 added a new field to protect against \"shoulder-surfing\" attacks. If upgrading, you'll need to add the `:consumed_timestep` column to your `Users` model.\n "
            },
            {
                "sha": "6a502e997fe5a1e212bd42f75f312d70c56d6a0a",
                "filename": "demo/.gitignore",
                "status": "removed",
                "additions": 0,
                "deletions": 16,
                "changes": 16,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2F.gitignore",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2F.gitignore",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2F.gitignore?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,16 +0,0 @@\n-# See https://help.github.com/articles/ignoring-files for more about ignoring files.\n-#\n-# If you find yourself ignoring temporary files generated by your text editor\n-# or operating system, you probably want to add a global ignore instead:\n-#   git config --global core.excludesfile '~/.gitignore_global'\n-\n-# Ignore bundler config.\n-/.bundle\n-\n-# Ignore the default SQLite database.\n-/db/*.sqlite3\n-/db/*.sqlite3-journal\n-\n-# Ignore all logfiles and tempfiles.\n-/log/*.log\n-/tmp"
            },
            {
                "sha": "b88c714e4d4c66aad3cad7016e90886b9be9dc5d",
                "filename": "demo/Gemfile",
                "status": "removed",
                "additions": 0,
                "deletions": 16,
                "changes": 16,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2FGemfile",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2FGemfile",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2FGemfile?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,16 +0,0 @@\n-source 'https://rubygems.org'\n-\n-gem 'rails', '4.2.7.1'\n-gem 'sqlite3'\n-gem 'sass-rails', '~> 4.0.3'\n-gem 'uglifier', '>= 1.3.0'\n-gem 'coffee-rails', '~> 4.0.0'\n-# See https://github.com/sstephenson/execjs#readme for more supported runtimes\n-# gem 'therubyracer',  platforms: :ruby\n-\n-gem 'jquery-rails'\n-gem 'turbolinks'\n-\n-gem 'devise'\n-gem 'devise-two-factor', path: '../'\n-gem 'rqrcode-rails3'"
            },
            {
                "sha": "a5b8c2a39b2e36b475ab8569054289797a8183f5",
                "filename": "demo/README.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/demo%2FREADME.md",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/demo%2FREADME.md",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2FREADME.md?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -0,0 +1,5 @@\n+# Demo\n+\n+Examples have been moved to their own repositories!\n+\n+* [Rails 7.1](https://github.com/devise-two-factor/example-rails_7_1)"
            },
            {
                "sha": "dd4e97e22e159a585b20e21028f964827d5afa4e",
                "filename": "demo/README.rdoc",
                "status": "removed",
                "additions": 0,
                "deletions": 28,
                "changes": 28,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2FREADME.rdoc",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2FREADME.rdoc",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2FREADME.rdoc?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,28 +0,0 @@\n-== README\n-\n-This README would normally document whatever steps are necessary to get the\n-application up and running.\n-\n-Things you may want to cover:\n-\n-* Ruby version\n-\n-* System dependencies\n-\n-* Configuration\n-\n-* Database creation\n-\n-* Database initialization\n-\n-* How to run the test suite\n-\n-* Services (job queues, cache servers, search engines, etc.)\n-\n-* Deployment instructions\n-\n-* ...\n-\n-\n-Please feel free to use a different markup language if you do not plan to run\n-<tt>rake doc:app</tt>."
            },
            {
                "sha": "ba6b733dd2358d858f00445ebd91c214f0f5d2e5",
                "filename": "demo/Rakefile",
                "status": "removed",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2FRakefile",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2FRakefile",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2FRakefile?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,6 +0,0 @@\n-# Add your own tasks in files placed in lib/tasks ending in .rake,\n-# for example lib/tasks/capistrano.rake, and they will automatically be available to Rake.\n-\n-require File.expand_path('../config/application', __FILE__)\n-\n-Rails.application.load_tasks"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/app/assets/images/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fimages%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fimages%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fassets%2Fimages%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "d6925fa431be1ac585bf9a481e98f75107a6e6fb",
                "filename": "demo/app/assets/javascripts/application.js",
                "status": "removed",
                "additions": 0,
                "deletions": 16,
                "changes": 16,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fjavascripts%2Fapplication.js",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fjavascripts%2Fapplication.js",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fassets%2Fjavascripts%2Fapplication.js?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,16 +0,0 @@\n-// This is a manifest file that'll be compiled into application.js, which will include all the files\n-// listed below.\n-//\n-// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,\n-// or vendor/assets/javascripts of plugins, if any, can be referenced here using a relative path.\n-//\n-// It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the\n-// compiled file.\n-//\n-// Read Sprockets README (https://github.com/sstephenson/sprockets#sprockets-directives) for details\n-// about supported directives.\n-//\n-//= require jquery\n-//= require jquery_ujs\n-//= require turbolinks\n-//= require_tree ."
            },
            {
                "sha": "24f83d18bbd38c24c4f7c3c2fc360cd68e857a2a",
                "filename": "demo/app/assets/javascripts/home.js.coffee",
                "status": "removed",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fjavascripts%2Fhome.js.coffee",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fjavascripts%2Fhome.js.coffee",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fassets%2Fjavascripts%2Fhome.js.coffee?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,3 +0,0 @@\n-# Place all the behaviors and hooks related to the matching controller here.\n-# All this logic will automatically be available in application.js.\n-# You can use CoffeeScript in this file: http://coffeescript.org/"
            },
            {
                "sha": "a443db3401278f21dee3f448f317487a642967a9",
                "filename": "demo/app/assets/stylesheets/application.css",
                "status": "removed",
                "additions": 0,
                "deletions": 15,
                "changes": 15,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fstylesheets%2Fapplication.css",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fstylesheets%2Fapplication.css",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fassets%2Fstylesheets%2Fapplication.css?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,15 +0,0 @@\n-/*\n- * This is a manifest file that'll be compiled into application.css, which will include all the files\n- * listed below.\n- *\n- * Any CSS and SCSS file within this directory, lib/assets/stylesheets, vendor/assets/stylesheets,\n- * or vendor/assets/stylesheets of plugins, if any, can be referenced here using a relative path.\n- *\n- * You're free to add application-wide styles to this file and they'll appear at the bottom of the\n- * compiled file so the styles you add here take precedence over styles defined in any styles\n- * defined in the other CSS/SCSS files in this directory. It is generally better to create a new\n- * file per style scope.\n- *\n- *= require_tree .\n- *= require_self\n- */"
            },
            {
                "sha": "f0ddc6846ae428e58ea9741cadd1e1c3a11bb967",
                "filename": "demo/app/assets/stylesheets/home.css.scss",
                "status": "removed",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fstylesheets%2Fhome.css.scss",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fassets%2Fstylesheets%2Fhome.css.scss",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fassets%2Fstylesheets%2Fhome.css.scss?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,3 +0,0 @@\n-// Place all the styles related to the home controller here.\n-// They will automatically be included in application.css.\n-// You can use Sass (SCSS) here: http://sass-lang.com/"
            },
            {
                "sha": "b3e8c920c3bc4353feb783e79cc657b9e23c8b67",
                "filename": "demo/app/controllers/application_controller.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 13,
                "changes": 13,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fcontrollers%2Fapplication_controller.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fcontrollers%2Fapplication_controller.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fcontrollers%2Fapplication_controller.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,13 +0,0 @@\n-class ApplicationController < ActionController::Base\n-  # Prevent CSRF attacks by raising an exception.\n-  # For APIs, you may want to use :null_session instead.\n-  protect_from_forgery with: :exception\n-\n-  before_action :configure_permitted_parameters, if: :devise_controller?\n-\n-  protected\n-\n-  def configure_permitted_parameters\n-    devise_parameter_sanitizer.permit(:sign_in, keys: [:otp_attempt])\n-  end\n-end"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/app/controllers/concerns/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fcontrollers%2Fconcerns%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fcontrollers%2Fconcerns%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fcontrollers%2Fconcerns%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "95f29929cad2de8b30a4d823197d72354bfb9114",
                "filename": "demo/app/controllers/home_controller.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fcontrollers%2Fhome_controller.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fcontrollers%2Fhome_controller.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fcontrollers%2Fhome_controller.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,4 +0,0 @@\n-class HomeController < ApplicationController\n-  def index\n-  end\n-end"
            },
            {
                "sha": "951bf6ae924233dad96d06d1c6fe6607999ce0a2",
                "filename": "demo/app/controllers/users_controller.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 14,
                "changes": 14,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fcontrollers%2Fusers_controller.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fcontrollers%2Fusers_controller.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fcontrollers%2Fusers_controller.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,14 +0,0 @@\n-class UsersController < ApplicationController\n-  def disable_otp\n-    current_user.otp_required_for_login = false\n-    current_user.save!\n-    redirect_to home_index_path\n-  end\n-\n-  def enable_otp\n-    current_user.otp_secret = User.generate_otp_secret\n-    current_user.otp_required_for_login = true\n-    current_user.save!\n-    redirect_to home_index_path\n-  end\n-end"
            },
            {
                "sha": "de6be7945c6a59798eb0ace177df38b05e98c2f0",
                "filename": "demo/app/helpers/application_helper.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 2,
                "changes": 2,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fhelpers%2Fapplication_helper.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fhelpers%2Fapplication_helper.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fhelpers%2Fapplication_helper.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,2 +0,0 @@\n-module ApplicationHelper\n-end"
            },
            {
                "sha": "23de56ac60aace0b1cc98dba68407ddcecc7614a",
                "filename": "demo/app/helpers/home_helper.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 2,
                "changes": 2,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fhelpers%2Fhome_helper.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fhelpers%2Fhome_helper.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fhelpers%2Fhome_helper.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,2 +0,0 @@\n-module HomeHelper\n-end"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/app/mailers/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fmailers%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fmailers%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fmailers%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/app/models/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fmodels%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fmodels%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fmodels%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/app/models/concerns/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fmodels%2Fconcerns%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fmodels%2Fconcerns%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fmodels%2Fconcerns%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "3bd01dc1341036abb24077719985467e53fb4247",
                "filename": "demo/app/models/user.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fmodels%2Fuser.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fmodels%2Fuser.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fmodels%2Fuser.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,6 +0,0 @@\n-class User < ActiveRecord::Base\n-  devise :two_factor_authenticatable\n-\n-  devise :registerable, :recoverable, :rememberable,\n-         :trackable, :validatable\n-end"
            },
            {
                "sha": "65ba288037d5e9e642a41296d3848f4f52a08040",
                "filename": "demo/app/views/devise/confirmations/new.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 12,
                "changes": 12,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fconfirmations%2Fnew.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fconfirmations%2Fnew.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fconfirmations%2Fnew.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,12 +0,0 @@\n-<h2>Resend confirmation instructions</h2>\n-\n-<%= form_for(resource, as: resource_name, url: confirmation_path(resource_name), html: { method: :post }) do |f| %>\n-  <%= devise_error_messages! %>\n-\n-  <div><%= f.label :email %><br />\n-  <%= f.email_field :email, autofocus: true %></div>\n-\n-  <div><%= f.submit \"Resend confirmation instructions\" %></div>\n-<% end %>\n-\n-<%= render \"devise/shared/links\" %>"
            },
            {
                "sha": "dc55f64f69e2541d12e6ffd6e3f4a413e8b828b2",
                "filename": "demo/app/views/devise/mailer/confirmation_instructions.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fmailer%2Fconfirmation_instructions.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fmailer%2Fconfirmation_instructions.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fmailer%2Fconfirmation_instructions.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,5 +0,0 @@\n-<p>Welcome <%= @email %>!</p>\n-\n-<p>You can confirm your account email through the link below:</p>\n-\n-<p><%= link_to 'Confirm my account', confirmation_url(@resource, confirmation_token: @token) %></p>"
            },
            {
                "sha": "f667dc12fe34929983021920c39f4ca061c4fd4f",
                "filename": "demo/app/views/devise/mailer/reset_password_instructions.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 8,
                "changes": 8,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fmailer%2Freset_password_instructions.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fmailer%2Freset_password_instructions.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fmailer%2Freset_password_instructions.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,8 +0,0 @@\n-<p>Hello <%= @resource.email %>!</p>\n-\n-<p>Someone has requested a link to change your password. You can do this through the link below.</p>\n-\n-<p><%= link_to 'Change my password', edit_password_url(@resource, reset_password_token: @token) %></p>\n-\n-<p>If you didn't request this, please ignore this email.</p>\n-<p>Your password won't change until you access the link above and create a new one.</p>"
            },
            {
                "sha": "41e148bf2ac2d8b3f108e15c45f8a2e75fb0b07e",
                "filename": "demo/app/views/devise/mailer/unlock_instructions.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 7,
                "changes": 7,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fmailer%2Funlock_instructions.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fmailer%2Funlock_instructions.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fmailer%2Funlock_instructions.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,7 +0,0 @@\n-<p>Hello <%= @resource.email %>!</p>\n-\n-<p>Your account has been locked due to an excessive number of unsuccessful sign in attempts.</p>\n-\n-<p>Click the link below to unlock your account:</p>\n-\n-<p><%= link_to 'Unlock my account', unlock_url(@resource, unlock_token: @token) %></p>"
            },
            {
                "sha": "553509886e2506acf38e044554baeff428a49511",
                "filename": "demo/app/views/devise/passwords/edit.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 16,
                "changes": 16,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fpasswords%2Fedit.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fpasswords%2Fedit.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fpasswords%2Fedit.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,16 +0,0 @@\n-<h2>Change your password</h2>\n-\n-<%= form_for(resource, as: resource_name, url: password_path(resource_name), html: { method: :put }) do |f| %>\n-  <%= devise_error_messages! %>\n-  <%= f.hidden_field :reset_password_token %>\n-\n-  <div><%= f.label :password, \"New password\" %><br />\n-    <%= f.password_field :password, autofocus: true, autocomplete: \"off\" %></div>\n-\n-  <div><%= f.label :password_confirmation, \"Confirm new password\" %><br />\n-    <%= f.password_field :password_confirmation, autocomplete: \"off\" %></div>\n-\n-  <div><%= f.submit \"Change my password\" %></div>\n-<% end %>\n-\n-<%= render \"devise/shared/links\" %>"
            },
            {
                "sha": "ea1d46e3d829f61983cb978ff15cb74f47a07ea8",
                "filename": "demo/app/views/devise/passwords/new.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 12,
                "changes": 12,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fpasswords%2Fnew.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fpasswords%2Fnew.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fpasswords%2Fnew.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,12 +0,0 @@\n-<h2>Forgot your password?</h2>\n-\n-<%= form_for(resource, as: resource_name, url: password_path(resource_name), html: { method: :post }) do |f| %>\n-  <%= devise_error_messages! %>\n-\n-  <div><%= f.label :email %><br />\n-  <%= f.email_field :email, autofocus: true %></div>\n-\n-  <div><%= f.submit \"Send me reset password instructions\" %></div>\n-<% end %>\n-\n-<%= render \"devise/shared/links\" %>"
            },
            {
                "sha": "808d62c9eed95646c2269e9479767294c5c01591",
                "filename": "demo/app/views/devise/registrations/edit.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 29,
                "changes": 29,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fregistrations%2Fedit.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fregistrations%2Fedit.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fregistrations%2Fedit.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,29 +0,0 @@\n-<h2>Edit <%= resource_name.to_s.humanize %></h2>\n-\n-<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>\n-  <%= devise_error_messages! %>\n-\n-  <div><%= f.label :email %><br />\n-  <%= f.email_field :email, autofocus: true %></div>\n-\n-  <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>\n-    <div>Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>\n-  <% end %>\n-\n-  <div><%= f.label :password %> <i>(leave blank if you don't want to change it)</i><br />\n-    <%= f.password_field :password, autocomplete: \"off\" %></div>\n-\n-  <div><%= f.label :password_confirmation %><br />\n-    <%= f.password_field :password_confirmation, autocomplete: \"off\" %></div>\n-\n-  <div><%= f.label :current_password %> <i>(we need your current password to confirm your changes)</i><br />\n-    <%= f.password_field :current_password, autocomplete: \"off\" %></div>\n-\n-  <div><%= f.submit \"Update\" %></div>\n-<% end %>\n-\n-<h3>Cancel my account</h3>\n-\n-<p>Unhappy? <%= button_to \"Cancel my account\", registration_path(resource_name), data: { confirm: \"Are you sure?\" }, method: :delete %></p>\n-\n-<%= link_to \"Back\", :back %>"
            },
            {
                "sha": "234de913adad19ea7083b2c64f173614af652f61",
                "filename": "demo/app/views/devise/registrations/new.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 18,
                "changes": 18,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fregistrations%2Fnew.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fregistrations%2Fnew.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fregistrations%2Fnew.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,18 +0,0 @@\n-<h2>Sign up</h2>\n-\n-<%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>\n-  <%= devise_error_messages! %>\n-\n-  <div><%= f.label :email %><br />\n-  <%= f.email_field :email, autofocus: true %></div>\n-\n-  <div><%= f.label :password %><br />\n-    <%= f.password_field :password, autocomplete: \"off\" %></div>\n-\n-  <div><%= f.label :password_confirmation %><br />\n-    <%= f.password_field :password_confirmation, autocomplete: \"off\" %></div>\n-\n-  <div><%= f.submit \"Sign up\" %></div>\n-<% end %>\n-\n-<%= render \"devise/shared/links\" %>"
            },
            {
                "sha": "42ae056d27e9ff66e5e14d7898b3ecca6d9fcf2c",
                "filename": "demo/app/views/devise/sessions/new.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 20,
                "changes": 20,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fsessions%2Fnew.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fsessions%2Fnew.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fsessions%2Fnew.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,20 +0,0 @@\n-<h2>Sign in</h2>\n-\n-<%= form_for(resource, as: resource_name, url: session_path(resource_name)) do |f| %>\n-  <div><%= f.label :email %><br />\n-  <%= f.email_field :email, autofocus: true %></div>\n-\n-  <div><%= f.label :password %><br />\n-    <%= f.password_field :password, autocomplete: \"off\" %></div>\n-\n-  <div><%= f.label :otp_attempt %><br />\n-    <%= f.text_field :otp_attempt %> </div>\n-\n-  <% if devise_mapping.rememberable? -%>\n-    <div><%= f.check_box :remember_me %> <%= f.label :remember_me %></div>\n-  <% end -%>\n-\n-  <div><%= f.submit \"Sign in\" %></div>\n-<% end %>\n-\n-<%= render \"devise/shared/links\" %>"
            },
            {
                "sha": "d84bdde999ad7f4d19a5876189f01b82e096114c",
                "filename": "demo/app/views/devise/shared/_links.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 25,
                "changes": 25,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fshared%2F_links.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Fshared%2F_links.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Fshared%2F_links.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,25 +0,0 @@\n-<%- if controller_name != 'sessions' %>\n-  <%= link_to \"Sign in\", new_session_path(resource_name) %><br />\n-<% end -%>\n-\n-<%- if devise_mapping.registerable? && controller_name != 'registrations' %>\n-  <%= link_to \"Sign up\", new_registration_path(resource_name) %><br />\n-<% end -%>\n-\n-<%- if devise_mapping.recoverable? && controller_name != 'passwords' && controller_name != 'registrations' %>\n-  <%= link_to \"Forgot your password?\", new_password_path(resource_name) %><br />\n-<% end -%>\n-\n-<%- if devise_mapping.confirmable? && controller_name != 'confirmations' %>\n-  <%= link_to \"Didn't receive confirmation instructions?\", new_confirmation_path(resource_name) %><br />\n-<% end -%>\n-\n-<%- if devise_mapping.lockable? && resource_class.unlock_strategy_enabled?(:email) && controller_name != 'unlocks' %>\n-  <%= link_to \"Didn't receive unlock instructions?\", new_unlock_path(resource_name) %><br />\n-<% end -%>\n-\n-<%- if devise_mapping.omniauthable? %>\n-  <%- resource_class.omniauth_providers.each do |provider| %>\n-    <%= link_to \"Sign in with #{provider.to_s.titleize}\", omniauth_authorize_path(resource_name, provider) %><br />\n-  <% end -%>\n-<% end -%>"
            },
            {
                "sha": "6fb5612bf8b963b8df1ab84b9905302635509c38",
                "filename": "demo/app/views/devise/unlocks/new.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 12,
                "changes": 12,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Funlocks%2Fnew.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fdevise%2Funlocks%2Fnew.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fdevise%2Funlocks%2Fnew.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,12 +0,0 @@\n-<h2>Resend unlock instructions</h2>\n-\n-<%= form_for(resource, as: resource_name, url: unlock_path(resource_name), html: { method: :post }) do |f| %>\n-  <%= devise_error_messages! %>\n-\n-  <div><%= f.label :email %><br />\n-  <%= f.email_field :email, autofocus: true %></div>\n-\n-  <div><%= f.submit \"Resend unlock instructions\" %></div>\n-<% end %>\n-\n-<%= render \"devise/shared/links\" %>"
            },
            {
                "sha": "4271863f90f88ae294d8df8c23570c3d48e39c4f",
                "filename": "demo/app/views/home/index.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 20,
                "changes": 20,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fhome%2Findex.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Fhome%2Findex.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Fhome%2Findex.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,20 +0,0 @@\n-<% if !current_user %>\n-  <%= link_to \"Sign up\", new_user_registration_path %>\n-  <%= link_to \"Login\", new_user_session_path %>\n-<% end %>\n-\n-<% if current_user %>\n-  <% if !current_user.otp_required_for_login %>\n-    <%= button_to \"Enable 2FA\", users_enable_otp_path, :method => :post %>\n-  <% end %>\n-\n-  <% if current_user.otp_required_for_login %>\n-    <%= button_to \"Disable 2FA\", users_disable_otp_path, :method => :post %>\n-    <%= raw RQRCode::render_qrcode(current_user.otp_provisioning_uri(current_user.email, issuer: \"Devise-Two-Factor-Demo\"),\n-                                   :svg,\n-                                   :level => :l,\n-                                   :unit => 2) %>\n-    <br>\n-  <% end %>\n-  <%= link_to \"Log out\", destroy_user_session_path, :method => :delete %>\n-<% end %>"
            },
            {
                "sha": "24ff7c26f746fcd2f1f2276fb0fff1945acdfb83",
                "filename": "demo/app/views/layouts/application.html.erb",
                "status": "removed",
                "additions": 0,
                "deletions": 17,
                "changes": 17,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Flayouts%2Fapplication.html.erb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fapp%2Fviews%2Flayouts%2Fapplication.html.erb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fapp%2Fviews%2Flayouts%2Fapplication.html.erb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,17 +0,0 @@\n-<!DOCTYPE html>\n-<html>\n-<head>\n-  <title>DeviseTwoFactorDemo</title>\n-  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>\n-  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>\n-  <%= csrf_meta_tags %>\n-</head>\n-<body>\n-\n-<%= content_tag :div, flash[:notice] if flash[:notice] %>\n-<%= content_tag :div, flash[:alert] if flash[:alert] %>\n-\n-<%= yield %>\n-\n-</body>\n-</html>"
            },
            {
                "sha": "66e9889e8b4aeea1af13e2396fb70594232a2ae3",
                "filename": "demo/bin/bundle",
                "status": "removed",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fbin%2Fbundle",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fbin%2Fbundle",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fbin%2Fbundle?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,3 +0,0 @@\n-#!/usr/bin/env ruby\n-ENV['BUNDLE_GEMFILE'] ||= File.expand_path('../../Gemfile', __FILE__)\n-load Gem.bin_path('bundler', 'bundle')"
            },
            {
                "sha": "728cd85aa58268dedadf285d2c2c6649a14a77b5",
                "filename": "demo/bin/rails",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fbin%2Frails",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fbin%2Frails",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fbin%2Frails?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,4 +0,0 @@\n-#!/usr/bin/env ruby\n-APP_PATH = File.expand_path('../../config/application',  __FILE__)\n-require_relative '../config/boot'\n-require 'rails/commands'"
            },
            {
                "sha": "17240489f64832c9ce080088e27780d3dc3ee29a",
                "filename": "demo/bin/rake",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fbin%2Frake",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fbin%2Frake",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fbin%2Frake?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,4 +0,0 @@\n-#!/usr/bin/env ruby\n-require_relative '../config/boot'\n-require 'rake'\n-Rake.application.run"
            },
            {
                "sha": "5bc2a619e83ea182b17e2507c5e0f2f07f7cf18c",
                "filename": "demo/config.ru",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig.ru",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig.ru",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig.ru?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,4 +0,0 @@\n-# This file is used by Rack-based servers to start the application.\n-\n-require ::File.expand_path('../config/environment',  __FILE__)\n-run Rails.application"
            },
            {
                "sha": "9d470b15d07ec7323a3d4e821b9e9ab877190e61",
                "filename": "demo/config/application.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 28,
                "changes": 28,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fapplication.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fapplication.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Fapplication.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,28 +0,0 @@\n-require File.expand_path('../boot', __FILE__)\n-\n-require 'rails/all'\n-\n-# Require the gems listed in Gemfile, including any gems\n-# you've limited to :test, :development, or :production.\n-Bundler.require(*Rails.groups)\n-\n-module DeviseTwoFactorDemo\n-  class Application < Rails::Application\n-    # Settings in config/environments/* take precedence over those specified here.\n-    # Application configuration should go into files in config/initializers\n-    # -- all .rb files in that directory are automatically loaded.\n-\n-    env_file = File.join(Rails.root, 'config', 'local_env.yml')\n-    YAML.load(File.open(env_file)).each do |key, value| \n-      ENV[key.to_s] = value \n-    end if File.exists?(env_file)\n-\n-    # Set Time.zone default to the specified zone and make Active Record auto-convert to this zone.\n-    # Run \"rake -D time\" for a list of tasks for finding time zone names. Default is UTC.\n-    # config.time_zone = 'Central Time (US & Canada)'\n-\n-    # The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.\n-    # config.i18n.load_path += Dir[Rails.root.join('my', 'locales', '*.{rb,yml}').to_s]\n-    # config.i18n.default_locale = :de\n-  end\n-end"
            },
            {
                "sha": "5e5f0c1fac0bcde58936530ada4fd08abcaf5a64",
                "filename": "demo/config/boot.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fboot.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fboot.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Fboot.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,4 +0,0 @@\n-# Set up gems listed in the Gemfile.\n-ENV['BUNDLE_GEMFILE'] ||= File.expand_path('../../Gemfile', __FILE__)\n-\n-require 'bundler/setup' if File.exist?(ENV['BUNDLE_GEMFILE'])"
            },
            {
                "sha": "1c1a37ca8df8dafd501066d54086ca5693f4b204",
                "filename": "demo/config/database.yml",
                "status": "removed",
                "additions": 0,
                "deletions": 25,
                "changes": 25,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fdatabase.yml",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fdatabase.yml",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Fdatabase.yml?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,25 +0,0 @@\n-# SQLite version 3.x\n-#   gem install sqlite3\n-#\n-#   Ensure the SQLite 3 gem is defined in your Gemfile\n-#   gem 'sqlite3'\n-#\n-default: &default\n-  adapter: sqlite3\n-  pool: 5\n-  timeout: 5000\n-\n-development:\n-  <<: *default\n-  database: db/development.sqlite3\n-\n-# Warning: The database defined as \"test\" will be erased and\n-# re-generated from your development database when you run \"rake\".\n-# Do not set this db to the same as development or production.\n-test:\n-  <<: *default\n-  database: db/test.sqlite3\n-\n-production:\n-  <<: *default\n-  database: db/production.sqlite3"
            },
            {
                "sha": "ee8d90dc651948269f1b869953ff04774e737307",
                "filename": "demo/config/environment.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fenvironment.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fenvironment.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Fenvironment.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,5 +0,0 @@\n-# Load the Rails application.\n-require File.expand_path('../application', __FILE__)\n-\n-# Initialize the Rails application.\n-Rails.application.initialize!"
            },
            {
                "sha": "ddf0e90cc4213a9fd70c53cbfb8b434c83d3c0ef",
                "filename": "demo/config/environments/development.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 37,
                "changes": 37,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fenvironments%2Fdevelopment.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fenvironments%2Fdevelopment.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Fenvironments%2Fdevelopment.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,37 +0,0 @@\n-Rails.application.configure do\n-  # Settings specified here will take precedence over those in config/application.rb.\n-\n-  # In the development environment your application's code is reloaded on\n-  # every request. This slows down response time but is perfect for development\n-  # since you don't have to restart the web server when you make code changes.\n-  config.cache_classes = false\n-\n-  # Do not eager load code on boot.\n-  config.eager_load = false\n-\n-  # Show full error reports and disable caching.\n-  config.consider_all_requests_local       = true\n-  config.action_controller.perform_caching = false\n-\n-  # Don't care if the mailer can't send.\n-  config.action_mailer.raise_delivery_errors = false\n-\n-  # Print deprecation notices to the Rails logger.\n-  config.active_support.deprecation = :log\n-\n-  # Raise an error on page load if there are pending migrations.\n-  config.active_record.migration_error = :page_load\n-\n-  # Debug mode disables concatenation and preprocessing of assets.\n-  # This option may cause significant delays in view rendering with a large\n-  # number of complex assets.\n-  config.assets.debug = true\n-\n-  # Adds additional error checking when serving assets at runtime.\n-  # Checks for improperly declared sprockets dependencies.\n-  # Raises helpful error messages.\n-  config.assets.raise_runtime_errors = true\n-\n-  # Raises error for missing translations\n-  # config.action_view.raise_on_missing_translations = true\n-end"
            },
            {
                "sha": "47d3553b6b4041928a269cc21d4cd5181554c7be",
                "filename": "demo/config/environments/production.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 83,
                "changes": 83,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fenvironments%2Fproduction.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fenvironments%2Fproduction.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Fenvironments%2Fproduction.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,83 +0,0 @@\n-Rails.application.configure do\n-  # Settings specified here will take precedence over those in config/application.rb.\n-\n-  # Code is not reloaded between requests.\n-  config.cache_classes = true\n-\n-  # Eager load code on boot. This eager loads most of Rails and\n-  # your application in memory, allowing both threaded web servers\n-  # and those relying on copy on write to perform better.\n-  # Rake tasks automatically ignore this option for performance.\n-  config.eager_load = true\n-\n-  # Full error reports are disabled and caching is turned on.\n-  config.consider_all_requests_local       = false\n-  config.action_controller.perform_caching = true\n-\n-  # Enable Rack::Cache to put a simple HTTP cache in front of your application\n-  # Add `rack-cache` to your Gemfile before enabling this.\n-  # For large-scale production use, consider using a caching reverse proxy like nginx, varnish or squid.\n-  # config.action_dispatch.rack_cache = true\n-\n-  # Disable Rails's static asset server (Apache or nginx will already do this).\n-  config.serve_static_assets = false\n-\n-  # Compress JavaScripts and CSS.\n-  config.assets.js_compressor = :uglifier\n-  # config.assets.css_compressor = :sass\n-\n-  # Do not fallback to assets pipeline if a precompiled asset is missed.\n-  config.assets.compile = false\n-\n-  # Generate digests for assets URLs.\n-  config.assets.digest = true\n-\n-  # Version of your assets, change this if you want to expire all your assets.\n-  config.assets.version = '1.0'\n-\n-  # Specifies the header that your server uses for sending files.\n-  # config.action_dispatch.x_sendfile_header = \"X-Sendfile\" # for apache\n-  # config.action_dispatch.x_sendfile_header = 'X-Accel-Redirect' # for nginx\n-\n-  # Force all access to the app over SSL, use Strict-Transport-Security, and use secure cookies.\n-  # config.force_ssl = true\n-\n-  # Set to :debug to see everything in the log.\n-  config.log_level = :info\n-\n-  # Prepend all log lines with the following tags.\n-  # config.log_tags = [ :subdomain, :uuid ]\n-\n-  # Use a different logger for distributed setups.\n-  # config.logger = ActiveSupport::TaggedLogging.new(SyslogLogger.new)\n-\n-  # Use a different cache store in production.\n-  # config.cache_store = :mem_cache_store\n-\n-  # Enable serving of images, stylesheets, and JavaScripts from an asset server.\n-  # config.action_controller.asset_host = \"http://assets.example.com\"\n-\n-  # Precompile additional assets.\n-  # application.js, application.css, and all non-JS/CSS in app/assets folder are already added.\n-  # config.assets.precompile += %w( search.js )\n-\n-  # Ignore bad email addresses and do not raise email delivery errors.\n-  # Set this to true and configure the email server for immediate delivery to raise delivery errors.\n-  # config.action_mailer.raise_delivery_errors = false\n-\n-  # Enable locale fallbacks for I18n (makes lookups for any locale fall back to\n-  # the I18n.default_locale when a translation cannot be found).\n-  config.i18n.fallbacks = true\n-\n-  # Send deprecation notices to registered listeners.\n-  config.active_support.deprecation = :notify\n-\n-  # Disable automatic flushing of the log to improve performance.\n-  # config.autoflush_log = false\n-\n-  # Use default logging formatter so that PID and timestamp are not suppressed.\n-  config.log_formatter = ::Logger::Formatter.new\n-\n-  # Do not dump schema after migrations.\n-  config.active_record.dump_schema_after_migration = false\n-end"
            },
            {
                "sha": "053f5b66d7f1746078024c7a74c637d4773135d0",
                "filename": "demo/config/environments/test.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 39,
                "changes": 39,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fenvironments%2Ftest.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fenvironments%2Ftest.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Fenvironments%2Ftest.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,39 +0,0 @@\n-Rails.application.configure do\n-  # Settings specified here will take precedence over those in config/application.rb.\n-\n-  # The test environment is used exclusively to run your application's\n-  # test suite. You never need to work with it otherwise. Remember that\n-  # your test database is \"scratch space\" for the test suite and is wiped\n-  # and recreated between test runs. Don't rely on the data there!\n-  config.cache_classes = true\n-\n-  # Do not eager load code on boot. This avoids loading your whole application\n-  # just for the purpose of running a single test. If you are using a tool that\n-  # preloads Rails for running tests, you may have to set it to true.\n-  config.eager_load = false\n-\n-  # Configure static asset server for tests with Cache-Control for performance.\n-  config.serve_static_assets  = true\n-  config.static_cache_control = 'public, max-age=3600'\n-\n-  # Show full error reports and disable caching.\n-  config.consider_all_requests_local       = true\n-  config.action_controller.perform_caching = false\n-\n-  # Raise exceptions instead of rendering exception templates.\n-  config.action_dispatch.show_exceptions = false\n-\n-  # Disable request forgery protection in test environment.\n-  config.action_controller.allow_forgery_protection = false\n-\n-  # Tell Action Mailer not to deliver emails to the real world.\n-  # The :test delivery method accumulates sent emails in the\n-  # ActionMailer::Base.deliveries array.\n-  config.action_mailer.delivery_method = :test\n-\n-  # Print deprecation notices to the stderr.\n-  config.active_support.deprecation = :stderr\n-\n-  # Raises error for missing translations\n-  # config.action_view.raise_on_missing_translations = true\n-end"
            },
            {
                "sha": "59385cdf379bd06a8d2326dcd4de6d5cd5d3f5b0",
                "filename": "demo/config/initializers/backtrace_silencers.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 7,
                "changes": 7,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fbacktrace_silencers.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fbacktrace_silencers.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Finitializers%2Fbacktrace_silencers.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,7 +0,0 @@\n-# Be sure to restart your server when you modify this file.\n-\n-# You can add backtrace silencers for libraries that you're using but don't wish to see in your backtraces.\n-# Rails.backtrace_cleaner.add_silencer { |line| line =~ /my_noisy_library/ }\n-\n-# You can also remove all the silencers if you're trying to debug a problem that might stem from framework code.\n-# Rails.backtrace_cleaner.remove_silencers!"
            },
            {
                "sha": "7a06a89f0f9df784b2087d18b248f8d8c770eb72",
                "filename": "demo/config/initializers/cookies_serializer.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fcookies_serializer.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fcookies_serializer.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Finitializers%2Fcookies_serializer.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,3 +0,0 @@\n-# Be sure to restart your server when you modify this file.\n-\n-Rails.application.config.action_dispatch.cookies_serializer = :json\n\\ No newline at end of file"
            },
            {
                "sha": "43543eb1a152e245804d728c833b641964d2e31c",
                "filename": "demo/config/initializers/devise.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 18,
                "changes": 18,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fdevise.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fdevise.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Finitializers%2Fdevise.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,18 +0,0 @@\n-Devise.setup do |config|\n-  config.warden do |manager|\n-    manager.default_strategies(:scope => :user).unshift :two_factor_authenticatable\n-  end\n-\n-  config.mailer_sender = 'please-change-me-at-config-initializers-devise@example.com'\n-\n-  require 'devise/orm/active_record'\n-\n-  config.case_insensitive_keys = [ :email ]\n-  config.strip_whitespace_keys = [ :email ]\n-  config.skip_session_storage = [:http_auth]\n-  config.stretches = Rails.env.test? ? 1 : 10\n-  config.reconfirmable = true\n-  config.password_length = 8..128\n-  config.reset_password_within = 6.hours\n-  config.sign_out_via = :delete\n-end"
            },
            {
                "sha": "4a994e1e7bb7ce28dcec98bad48b9a891d7dec51",
                "filename": "demo/config/initializers/filter_parameter_logging.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Ffilter_parameter_logging.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Ffilter_parameter_logging.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Finitializers%2Ffilter_parameter_logging.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,4 +0,0 @@\n-# Be sure to restart your server when you modify this file.\n-\n-# Configure sensitive parameters which will be filtered from the log file.\n-Rails.application.config.filter_parameters += [:password]"
            },
            {
                "sha": "ac033bf9dc846101320c96a5ce8aceb8c96ec098",
                "filename": "demo/config/initializers/inflections.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 16,
                "changes": 16,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Finflections.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Finflections.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Finitializers%2Finflections.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,16 +0,0 @@\n-# Be sure to restart your server when you modify this file.\n-\n-# Add new inflection rules using the following format. Inflections\n-# are locale specific, and you may define rules for as many different\n-# locales as you wish. All of these examples are active by default:\n-# ActiveSupport::Inflector.inflections(:en) do |inflect|\n-#   inflect.plural /^(ox)$/i, '\\1en'\n-#   inflect.singular /^(ox)en/i, '\\1'\n-#   inflect.irregular 'person', 'people'\n-#   inflect.uncountable %w( fish sheep )\n-# end\n-\n-# These inflection rules are supported but not enabled by default:\n-# ActiveSupport::Inflector.inflections(:en) do |inflect|\n-#   inflect.acronym 'RESTful'\n-# end"
            },
            {
                "sha": "dc1899682b01c3a6d9673faf746e235fb64fc4d2",
                "filename": "demo/config/initializers/mime_types.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fmime_types.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fmime_types.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Finitializers%2Fmime_types.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,4 +0,0 @@\n-# Be sure to restart your server when you modify this file.\n-\n-# Add new mime types for use in respond_to blocks:\n-# Mime::Type.register \"text/richtext\", :rtf"
            },
            {
                "sha": "80fcd5cf675d315edd597eee8f0029c7f9a595fe",
                "filename": "demo/config/initializers/session_store.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fsession_store.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fsession_store.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Finitializers%2Fsession_store.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,3 +0,0 @@\n-# Be sure to restart your server when you modify this file.\n-\n-Rails.application.config.session_store :cookie_store, key: '_DeviseTwoFactorDemo_session'"
            },
            {
                "sha": "33725e95fd22b9053f75ef6626aa1af781ebe947",
                "filename": "demo/config/initializers/wrap_parameters.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 14,
                "changes": 14,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fwrap_parameters.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Finitializers%2Fwrap_parameters.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Finitializers%2Fwrap_parameters.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,14 +0,0 @@\n-# Be sure to restart your server when you modify this file.\n-\n-# This file contains settings for ActionController::ParamsWrapper which\n-# is enabled by default.\n-\n-# Enable parameter wrapping for JSON. You can disable this by setting :format to an empty array.\n-ActiveSupport.on_load(:action_controller) do\n-  wrap_parameters format: [:json] if respond_to?(:wrap_parameters)\n-end\n-\n-# To enable root element in JSON for ActiveRecord objects.\n-# ActiveSupport.on_load(:active_record) do\n-#  self.include_root_in_json = true\n-# end"
            },
            {
                "sha": "abccdb087d9eb1c06d9ff2c638fdb82fd986c47a",
                "filename": "demo/config/locales/devise.en.yml",
                "status": "removed",
                "additions": 0,
                "deletions": 59,
                "changes": 59,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Flocales%2Fdevise.en.yml",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Flocales%2Fdevise.en.yml",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Flocales%2Fdevise.en.yml?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,59 +0,0 @@\n-# Additional translations at https://github.com/plataformatec/devise/wiki/I18n\n-\n-en:\n-  devise:\n-    confirmations:\n-      confirmed: \"Your account was successfully confirmed.\"\n-      send_instructions: \"You will receive an email with instructions about how to confirm your account in a few minutes.\"\n-      send_paranoid_instructions: \"If your email address exists in our database, you will receive an email with instructions about how to confirm your account in a few minutes.\"\n-    failure:\n-      already_authenticated: \"You are already signed in.\"\n-      inactive: \"Your account is not activated yet.\"\n-      invalid: \"Invalid email or password.\"\n-      locked: \"Your account is locked.\"\n-      last_attempt: \"You have one more attempt before your account will be locked.\"\n-      not_found_in_database: \"Invalid email or password.\"\n-      timeout: \"Your session expired. Please sign in again to continue.\"\n-      unauthenticated: \"You need to sign in or sign up before continuing.\"\n-      unconfirmed: \"You have to confirm your account before continuing.\"\n-    mailer:\n-      confirmation_instructions:\n-        subject: \"Confirmation instructions\"\n-      reset_password_instructions:\n-        subject: \"Reset password instructions\"\n-      unlock_instructions:\n-        subject: \"Unlock Instructions\"\n-    omniauth_callbacks:\n-      failure: \"Could not authenticate you from %{kind} because \\\"%{reason}\\\".\"\n-      success: \"Successfully authenticated from %{kind} account.\"\n-    passwords:\n-      no_token: \"You can't access this page without coming from a password reset email. If you do come from a password reset email, please make sure you used the full URL provided.\"\n-      send_instructions: \"You will receive an email with instructions on how to reset your password in a few minutes.\"\n-      send_paranoid_instructions: \"If your email address exists in our database, you will receive a password recovery link at your email address in a few minutes.\"\n-      updated: \"Your password was changed successfully. You are now signed in.\"\n-      updated_not_active: \"Your password was changed successfully.\"\n-    registrations:\n-      destroyed: \"Bye! Your account was successfully cancelled. We hope to see you again soon.\"\n-      signed_up: \"Welcome! You have signed up successfully.\"\n-      signed_up_but_inactive: \"You have signed up successfully. However, we could not sign you in because your account is not yet activated.\"\n-      signed_up_but_locked: \"You have signed up successfully. However, we could not sign you in because your account is locked.\"\n-      signed_up_but_unconfirmed: \"A message with a confirmation link has been sent to your email address. Please open the link to activate your account.\"\n-      update_needs_confirmation: \"You updated your account successfully, but we need to verify your new email address. Please check your email and click on the confirm link to finalize confirming your new email address.\"\n-      updated: \"You updated your account successfully.\"\n-    sessions:\n-      signed_in: \"Signed in successfully.\"\n-      signed_out: \"Signed out successfully.\"\n-    unlocks:\n-      send_instructions: \"You will receive an email with instructions about how to unlock your account in a few minutes.\"\n-      send_paranoid_instructions: \"If your account exists, you will receive an email with instructions about how to unlock it in a few minutes.\"\n-      unlocked: \"Your account has been unlocked successfully. Please sign in to continue.\"\n-  errors:\n-    messages:\n-      already_confirmed: \"was already confirmed, please try signing in\"\n-      confirmation_period_expired: \"needs to be confirmed within %{period}, please request a new one\"\n-      expired: \"has expired, please request a new one\"\n-      not_found: \"not found\"\n-      not_locked: \"was not locked\"\n-      not_saved:\n-        one: \"1 error prohibited this %{resource} from being saved:\"\n-        other: \"%{count} errors prohibited this %{resource} from being saved:\""
            },
            {
                "sha": "0653957166e8182880bb87b56e36c257c988dd92",
                "filename": "demo/config/locales/en.yml",
                "status": "removed",
                "additions": 0,
                "deletions": 23,
                "changes": 23,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Flocales%2Fen.yml",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Flocales%2Fen.yml",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Flocales%2Fen.yml?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,23 +0,0 @@\n-# Files in the config/locales directory are used for internationalization\n-# and are automatically loaded by Rails. If you want to use locales other\n-# than English, add the necessary files in this directory.\n-#\n-# To use the locales, use `I18n.t`:\n-#\n-#     I18n.t 'hello'\n-#\n-# In views, this is aliased to just `t`:\n-#\n-#     <%= t('hello') %>\n-#\n-# To use a different locale, set it with `I18n.locale`:\n-#\n-#     I18n.locale = :es\n-#\n-# This would use the information in config/locales/es.yml.\n-#\n-# To learn more, please read the Rails Internationalization guide\n-# available at http://guides.rubyonrails.org/i18n.html.\n-\n-en:\n-  hello: \"Hello world\""
            },
            {
                "sha": "bcd765eedc454d20a34a51310b7a5046529ae2a8",
                "filename": "demo/config/routes.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Froutes.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Froutes.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Froutes.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,9 +0,0 @@\n-Rails.application.routes.draw do\n-  get 'home/index'\n-  post 'users/enable_otp'\n-  post 'users/disable_otp'\n-\n-  devise_for :users\n-\n-  root to: \"home#index\", via: [:get, :post]\n-end"
            },
            {
                "sha": "3d12a2a2a771f5dab6e1e56087a7c687d51538c9",
                "filename": "demo/config/secrets.yml",
                "status": "removed",
                "additions": 0,
                "deletions": 22,
                "changes": 22,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fsecrets.yml",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fconfig%2Fsecrets.yml",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fconfig%2Fsecrets.yml?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,22 +0,0 @@\n-# Be sure to restart your server when you modify this file.\n-\n-# Your secret key is used for verifying the integrity of signed cookies.\n-# If you change this key, all old signed cookies will become invalid!\n-\n-# Make sure the secret is at least 30 characters and all random,\n-# no regular words or you'll be exposed to dictionary attacks.\n-# You can use `rake secret` to generate a secure secret key.\n-\n-# Make sure the secrets in this file are kept private\n-# if you're sharing your code publicly.\n-\n-development:\n-  secret_key_base: c8c845b85a69d2b67ec99c1912ddcde63f0fcd05a74052f396daf68a2688d576c203bdc239c9423a0cf88218e201d30616959d5eeceea00eedf915677ecd373b\n-\n-test:\n-  secret_key_base: df468dd66c4b0f143354d216d96cdb8542ffe215afd78ebf977f7a8bfdb93010db134320cb738d27385bd7884cd73f3f22f90b147d4d176c3c8d0d63d5427fa9\n-\n-# Do not keep production secrets in the repository,\n-# instead read values from the environment.\n-production:\n-  secret_key_base: <%= ENV[\"SECRET_KEY_BASE\"] %>"
            },
            {
                "sha": "cf497c272bc127307d081e2e1101a99ad735cdc5",
                "filename": "demo/db/migrate/20140515190128_devise_create_users.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 42,
                "changes": 42,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fdb%2Fmigrate%2F20140515190128_devise_create_users.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fdb%2Fmigrate%2F20140515190128_devise_create_users.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fdb%2Fmigrate%2F20140515190128_devise_create_users.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,42 +0,0 @@\n-class DeviseCreateUsers < ActiveRecord::Migration\n-  def change\n-    create_table(:users) do |t|\n-      ## Database authenticatable\n-      t.string :email,              null: false, default: \"\"\n-      t.string :encrypted_password, null: false, default: \"\"\n-\n-      ## Recoverable\n-      t.string   :reset_password_token\n-      t.datetime :reset_password_sent_at\n-\n-      ## Rememberable\n-      t.datetime :remember_created_at\n-\n-      ## Trackable\n-      t.integer  :sign_in_count, default: 0, null: false\n-      t.datetime :current_sign_in_at\n-      t.datetime :last_sign_in_at\n-      t.string   :current_sign_in_ip\n-      t.string   :last_sign_in_ip\n-\n-      ## Confirmable\n-      # t.string   :confirmation_token\n-      # t.datetime :confirmed_at\n-      # t.datetime :confirmation_sent_at\n-      # t.string   :unconfirmed_email # Only if using reconfirmable\n-\n-      ## Lockable\n-      # t.integer  :failed_attempts, default: 0, null: false # Only if lock strategy is :failed_attempts\n-      # t.string   :unlock_token # Only if unlock strategy is :email or :both\n-      # t.datetime :locked_at\n-\n-\n-      t.timestamps\n-    end\n-\n-    add_index :users, :email,                unique: true\n-    add_index :users, :reset_password_token, unique: true\n-    # add_index :users, :confirmation_token,   unique: true\n-    # add_index :users, :unlock_token,         unique: true\n-  end\n-end"
            },
            {
                "sha": "61fe49407488e89dd8451dd0fb7bdb059e1bf33b",
                "filename": "demo/db/migrate/20140516191259_add_devise_two_factor_to_users.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fdb%2Fmigrate%2F20140516191259_add_devise_two_factor_to_users.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fdb%2Fmigrate%2F20140516191259_add_devise_two_factor_to_users.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fdb%2Fmigrate%2F20140516191259_add_devise_two_factor_to_users.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,9 +0,0 @@\n-class AddDeviseTwoFactorToUsers < ActiveRecord::Migration\n-  def change\n-    add_column :users, :encrypted_otp_secret, :string\n-    add_column :users, :encrypted_otp_secret_iv, :string\n-    add_column :users, :encrypted_otp_secret_salt, :string\n-    add_column :users, :consumed_timestep, :integer\n-    add_column :users, :otp_required_for_login, :boolean\n-  end\n-end"
            },
            {
                "sha": "01f3e3672f79356c14b12e185dc207c21a91516b",
                "filename": "demo/db/schema.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 39,
                "changes": 39,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fdb%2Fschema.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fdb%2Fschema.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fdb%2Fschema.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,39 +0,0 @@\n-# encoding: UTF-8\n-# This file is auto-generated from the current state of the database. Instead\n-# of editing this file, please use the migrations feature of Active Record to\n-# incrementally modify your database, and then regenerate this schema definition.\n-#\n-# Note that this schema.rb definition is the authoritative source for your\n-# database schema. If you need to create the application database on another\n-# system, you should be using db:schema:load, not running all the migrations\n-# from scratch. The latter is a flawed and unsustainable approach (the more migrations\n-# you'll amass, the slower it'll run and the greater likelihood for issues).\n-#\n-# It's strongly recommended that you check this file into your version control system.\n-\n-ActiveRecord::Schema.define(version: 20140516191259) do\n-\n-  create_table \"users\", force: :cascade do |t|\n-    t.string   \"email\",                     default: \"\", null: false\n-    t.string   \"encrypted_password\",        default: \"\", null: false\n-    t.string   \"reset_password_token\"\n-    t.datetime \"reset_password_sent_at\"\n-    t.datetime \"remember_created_at\"\n-    t.integer  \"sign_in_count\",             default: 0,  null: false\n-    t.datetime \"current_sign_in_at\"\n-    t.datetime \"last_sign_in_at\"\n-    t.string   \"current_sign_in_ip\"\n-    t.string   \"last_sign_in_ip\"\n-    t.datetime \"created_at\"\n-    t.datetime \"updated_at\"\n-    t.string   \"encrypted_otp_secret\"\n-    t.string   \"encrypted_otp_secret_iv\"\n-    t.string   \"encrypted_otp_secret_salt\"\n-    t.integer  \"consumed_timestep\"\n-    t.boolean  \"otp_required_for_login\"\n-  end\n-\n-  add_index \"users\", [\"email\"], name: \"index_users_on_email\", unique: true\n-  add_index \"users\", [\"reset_password_token\"], name: \"index_users_on_reset_password_token\", unique: true\n-\n-end"
            },
            {
                "sha": "4edb1e857ee6c203463c7fa0387aae32496ec93d",
                "filename": "demo/db/seeds.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 7,
                "changes": 7,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fdb%2Fseeds.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fdb%2Fseeds.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fdb%2Fseeds.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,7 +0,0 @@\n-# This file should contain all the record creation needed to seed the database with its default values.\n-# The data can then be loaded with the rake db:seed (or created alongside the db with db:setup).\n-#\n-# Examples:\n-#\n-#   cities = City.create([{ name: 'Chicago' }, { name: 'Copenhagen' }])\n-#   Mayor.create(name: 'Emanuel', city: cities.first)"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/lib/assets/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Flib%2Fassets%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Flib%2Fassets%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Flib%2Fassets%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/lib/tasks/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Flib%2Ftasks%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Flib%2Ftasks%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Flib%2Ftasks%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/log/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Flog%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Flog%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Flog%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "b612547fc21d079889046e65d1fb135ec6921eaa",
                "filename": "demo/public/404.html",
                "status": "removed",
                "additions": 0,
                "deletions": 67,
                "changes": 67,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2F404.html",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2F404.html",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fpublic%2F404.html?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,67 +0,0 @@\n-<!DOCTYPE html>\n-<html>\n-<head>\n-  <title>The page you were looking for doesn't exist (404)</title>\n-  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n-  <style>\n-  body {\n-    background-color: #EFEFEF;\n-    color: #2E2F30;\n-    text-align: center;\n-    font-family: arial, sans-serif;\n-    margin: 0;\n-  }\n-\n-  div.dialog {\n-    width: 95%;\n-    max-width: 33em;\n-    margin: 4em auto 0;\n-  }\n-\n-  div.dialog > div {\n-    border: 1px solid #CCC;\n-    border-right-color: #999;\n-    border-left-color: #999;\n-    border-bottom-color: #BBB;\n-    border-top: #B00100 solid 4px;\n-    border-top-left-radius: 9px;\n-    border-top-right-radius: 9px;\n-    background-color: white;\n-    padding: 7px 12% 0;\n-    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);\n-  }\n-\n-  h1 {\n-    font-size: 100%;\n-    color: #730E15;\n-    line-height: 1.5em;\n-  }\n-\n-  div.dialog > p {\n-    margin: 0 0 1em;\n-    padding: 1em;\n-    background-color: #F7F7F7;\n-    border: 1px solid #CCC;\n-    border-right-color: #999;\n-    border-left-color: #999;\n-    border-bottom-color: #999;\n-    border-bottom-left-radius: 4px;\n-    border-bottom-right-radius: 4px;\n-    border-top-color: #DADADA;\n-    color: #666;\n-    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);\n-  }\n-  </style>\n-</head>\n-\n-<body>\n-  <!-- This file lives in public/404.html -->\n-  <div class=\"dialog\">\n-    <div>\n-      <h1>The page you were looking for doesn't exist.</h1>\n-      <p>You may have mistyped the address or the page may have moved.</p>\n-    </div>\n-    <p>If you are the application owner check the logs for more information.</p>\n-  </div>\n-</body>\n-</html>"
            },
            {
                "sha": "a21f82b3bdb817ecbc43f74c6fe360300739418a",
                "filename": "demo/public/422.html",
                "status": "removed",
                "additions": 0,
                "deletions": 67,
                "changes": 67,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2F422.html",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2F422.html",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fpublic%2F422.html?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,67 +0,0 @@\n-<!DOCTYPE html>\n-<html>\n-<head>\n-  <title>The change you wanted was rejected (422)</title>\n-  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n-  <style>\n-  body {\n-    background-color: #EFEFEF;\n-    color: #2E2F30;\n-    text-align: center;\n-    font-family: arial, sans-serif;\n-    margin: 0;\n-  }\n-\n-  div.dialog {\n-    width: 95%;\n-    max-width: 33em;\n-    margin: 4em auto 0;\n-  }\n-\n-  div.dialog > div {\n-    border: 1px solid #CCC;\n-    border-right-color: #999;\n-    border-left-color: #999;\n-    border-bottom-color: #BBB;\n-    border-top: #B00100 solid 4px;\n-    border-top-left-radius: 9px;\n-    border-top-right-radius: 9px;\n-    background-color: white;\n-    padding: 7px 12% 0;\n-    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);\n-  }\n-\n-  h1 {\n-    font-size: 100%;\n-    color: #730E15;\n-    line-height: 1.5em;\n-  }\n-\n-  div.dialog > p {\n-    margin: 0 0 1em;\n-    padding: 1em;\n-    background-color: #F7F7F7;\n-    border: 1px solid #CCC;\n-    border-right-color: #999;\n-    border-left-color: #999;\n-    border-bottom-color: #999;\n-    border-bottom-left-radius: 4px;\n-    border-bottom-right-radius: 4px;\n-    border-top-color: #DADADA;\n-    color: #666;\n-    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);\n-  }\n-  </style>\n-</head>\n-\n-<body>\n-  <!-- This file lives in public/422.html -->\n-  <div class=\"dialog\">\n-    <div>\n-      <h1>The change you wanted was rejected.</h1>\n-      <p>Maybe you tried to change something you didn't have access to.</p>\n-    </div>\n-    <p>If you are the application owner check the logs for more information.</p>\n-  </div>\n-</body>\n-</html>"
            },
            {
                "sha": "061abc587dcac4cdb1d62a890e4fd4bb20b8cb61",
                "filename": "demo/public/500.html",
                "status": "removed",
                "additions": 0,
                "deletions": 66,
                "changes": 66,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2F500.html",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2F500.html",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fpublic%2F500.html?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,66 +0,0 @@\n-<!DOCTYPE html>\n-<html>\n-<head>\n-  <title>We're sorry, but something went wrong (500)</title>\n-  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n-  <style>\n-  body {\n-    background-color: #EFEFEF;\n-    color: #2E2F30;\n-    text-align: center;\n-    font-family: arial, sans-serif;\n-    margin: 0;\n-  }\n-\n-  div.dialog {\n-    width: 95%;\n-    max-width: 33em;\n-    margin: 4em auto 0;\n-  }\n-\n-  div.dialog > div {\n-    border: 1px solid #CCC;\n-    border-right-color: #999;\n-    border-left-color: #999;\n-    border-bottom-color: #BBB;\n-    border-top: #B00100 solid 4px;\n-    border-top-left-radius: 9px;\n-    border-top-right-radius: 9px;\n-    background-color: white;\n-    padding: 7px 12% 0;\n-    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);\n-  }\n-\n-  h1 {\n-    font-size: 100%;\n-    color: #730E15;\n-    line-height: 1.5em;\n-  }\n-\n-  div.dialog > p {\n-    margin: 0 0 1em;\n-    padding: 1em;\n-    background-color: #F7F7F7;\n-    border: 1px solid #CCC;\n-    border-right-color: #999;\n-    border-left-color: #999;\n-    border-bottom-color: #999;\n-    border-bottom-left-radius: 4px;\n-    border-bottom-right-radius: 4px;\n-    border-top-color: #DADADA;\n-    color: #666;\n-    box-shadow: 0 3px 8px rgba(50, 50, 50, 0.17);\n-  }\n-  </style>\n-</head>\n-\n-<body>\n-  <!-- This file lives in public/500.html -->\n-  <div class=\"dialog\">\n-    <div>\n-      <h1>We're sorry, but something went wrong.</h1>\n-    </div>\n-    <p>If you are the application owner check the logs for more information.</p>\n-  </div>\n-</body>\n-</html>"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/public/favicon.ico",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2Ffavicon.ico",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2Ffavicon.ico",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fpublic%2Ffavicon.ico?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "3c9c7c01f30b90e009de2d15952ae83230f8e37a",
                "filename": "demo/public/robots.txt",
                "status": "removed",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2Frobots.txt",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fpublic%2Frobots.txt",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fpublic%2Frobots.txt?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,5 +0,0 @@\n-# See http://www.robotstxt.org/robotstxt.html for documentation on how to use the robots.txt file\n-#\n-# To ban all spiders from the entire site uncomment the next two lines:\n-# User-agent: *\n-# Disallow: /"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/test/controllers/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fcontrollers%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fcontrollers%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Fcontrollers%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "0d9bb47c3ea774dd1cb167e41028c745aab34253",
                "filename": "demo/test/controllers/home_controller_test.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fcontrollers%2Fhome_controller_test.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fcontrollers%2Fhome_controller_test.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Fcontrollers%2Fhome_controller_test.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,9 +0,0 @@\n-require 'test_helper'\n-\n-class HomeControllerTest < ActionController::TestCase\n-  test \"should get index\" do\n-    get :index\n-    assert_response :success\n-  end\n-\n-end"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/test/fixtures/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Ffixtures%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Ffixtures%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Ffixtures%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "937a0c002e426861e33bb25a2a8ce2b20b3efaa3",
                "filename": "demo/test/fixtures/users.yml",
                "status": "removed",
                "additions": 0,
                "deletions": 11,
                "changes": 11,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Ffixtures%2Fusers.yml",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Ffixtures%2Fusers.yml",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Ffixtures%2Fusers.yml?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,11 +0,0 @@\n-# Read about fixtures at http://api.rubyonrails.org/classes/ActiveRecord/FixtureSet.html\n-\n-# This model initially had no columns defined.  If you add columns to the\n-# model remove the '{}' from the fixture names and add the columns immediately\n-# below each fixture, per the syntax in the comments below\n-#\n-one: {}\n-# column: value\n-#\n-two: {}\n-#  column: value"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/test/helpers/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fhelpers%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fhelpers%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Fhelpers%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "4740a18dac0674ee4b171b550b3953a280f30957",
                "filename": "demo/test/helpers/home_helper_test.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fhelpers%2Fhome_helper_test.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fhelpers%2Fhome_helper_test.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Fhelpers%2Fhome_helper_test.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,4 +0,0 @@\n-require 'test_helper'\n-\n-class HomeHelperTest < ActionView::TestCase\n-end"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/test/integration/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fintegration%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fintegration%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Fintegration%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/test/mailers/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fmailers%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fmailers%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Fmailers%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/test/models/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fmodels%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fmodels%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Fmodels%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "82f61e0109663ddb34c9850653978c5280db0d59",
                "filename": "demo/test/models/user_test.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 7,
                "changes": 7,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fmodels%2Fuser_test.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Fmodels%2Fuser_test.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Fmodels%2Fuser_test.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,7 +0,0 @@\n-require 'test_helper'\n-\n-class UserTest < ActiveSupport::TestCase\n-  # test \"the truth\" do\n-  #   assert true\n-  # end\n-end"
            },
            {
                "sha": "bf95f818896aa79c8da7d425ce5e18a3896561df",
                "filename": "demo/test/test_helper.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 13,
                "changes": 13,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Ftest_helper.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Ftest%2Ftest_helper.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Ftest%2Ftest_helper.rb?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96",
                "patch": "@@ -1,13 +0,0 @@\n-ENV['RAILS_ENV'] ||= 'test'\n-require File.expand_path('../../config/environment', __FILE__)\n-require 'rails/test_help'\n-\n-class ActiveSupport::TestCase\n-  # Setup all fixtures in test/fixtures/*.yml for all tests in alphabetical order.\n-  #\n-  # Note: You'll currently still have to declare fixtures explicitly in integration tests\n-  # -- they do not yet inherit this setting\n-  fixtures :all\n-\n-  # Add more helper methods to be used by all tests here...\n-end"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/vendor/assets/javascripts/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fvendor%2Fassets%2Fjavascripts%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fvendor%2Fassets%2Fjavascripts%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fvendor%2Fassets%2Fjavascripts%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "demo/vendor/assets/stylesheets/.keep",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fvendor%2Fassets%2Fstylesheets%2F.keep",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/bb9f435d1d1a17a7f52f62c547ae53bcdceabb96/demo%2Fvendor%2Fassets%2Fstylesheets%2F.keep",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/demo%2Fvendor%2Fassets%2Fstylesheets%2F.keep?ref=bb9f435d1d1a17a7f52f62c547ae53bcdceabb96"
            },
            {
                "sha": "7bb12dd6a1137a4a00c2214d69f649eb6771415c",
                "filename": "lib/devise-two-factor.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise-two-factor.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise-two-factor.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/lib%2Fdevise-two-factor.rb?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -3,9 +3,10 @@\n require 'devise_two_factor/strategies'\n \n module Devise\n-  # The length of generated OTP secrets\n+  # The length of randomly generated OTP shared secret (in bytes).\n+  # The secrets will be base32-encoded and have a length 1.6 times the configured value.\n   mattr_accessor :otp_secret_length\n-  @@otp_secret_length = 24\n+  @@otp_secret_length = 20\n \n   # The number of seconds before and after the current\n   # time for which codes will be accepted\n@@ -20,7 +21,8 @@ module Devise\n   mattr_accessor :otp_encrypted_attribute_options\n   @@otp_encrypted_attribute_options = {}\n \n-  # The length of all generated OTP backup codes\n+  # The length of randomly generated OTP backup codes (in bytes).\n+  # The codes will be hex-encoded and have a length twice the configured value.\n   mattr_accessor :otp_backup_code_length\n   @@otp_backup_code_length = 16\n "
            },
            {
                "sha": "9bdfba90cf3062844df6b39448fcba406ee61df3",
                "filename": "lib/devise_two_factor/models/two_factor_authenticatable.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fmodels%2Ftwo_factor_authenticatable.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fmodels%2Ftwo_factor_authenticatable.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/lib%2Fdevise_two_factor%2Fmodels%2Ftwo_factor_authenticatable.rb?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -81,7 +81,8 @@ def clean_up_passwords\n       def consume_otp!\n         if self.consumed_timestep != current_otp_timestep\n           self.consumed_timestep = current_otp_timestep\n-          return save(validate: false)\n+          save!(validate: false)\n+          return true\n         end\n \n         false\n@@ -93,8 +94,9 @@ module ClassMethods\n                                     :otp_encrypted_attribute_options,\n                                     :otp_secret_encryption_key)\n \n+        # Geneartes an OTP secret of the specified length, returning it after Base32 encoding.\n         def generate_otp_secret(otp_secret_length = self.otp_secret_length)\n-          ROTP::Base32.random_base32(otp_secret_length)\n+          ROTP::Base32.random(otp_secret_length)\n         end\n \n         # Return value will be splatted with ** so return a version of the"
            },
            {
                "sha": "631582b2c9f834e1013789ba87a39ab6e9045be0",
                "filename": "lib/devise_two_factor/models/two_factor_backupable.rb",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fmodels%2Ftwo_factor_backupable.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fmodels%2Ftwo_factor_backupable.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/lib%2Fdevise_two_factor%2Fmodels%2Ftwo_factor_backupable.rb?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -20,7 +20,7 @@ def generate_otp_backup_codes!\n         code_length     = self.class.otp_backup_code_length\n \n         number_of_codes.times do\n-          codes << SecureRandom.hex(code_length / 2) # Hexstring has length 2*n\n+          codes << SecureRandom.hex(code_length)\n         end\n \n         hashed_codes = codes.map { |code| Devise::Encryptor.digest(self.class, code) }\n@@ -39,6 +39,7 @@ def invalidate_otp_backup_code!(code)\n \n           codes.delete(backup_code)\n           self.otp_backup_codes = codes\n+          save!(validate: false)\n           return true\n         end\n "
            },
            {
                "sha": "bfbf8d330699a2048b242a41ed8e9c2aa4804052",
                "filename": "lib/devise_two_factor/spec_helpers/two_factor_authenticatable_shared_examples.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fspec_helpers%2Ftwo_factor_authenticatable_shared_examples.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fspec_helpers%2Ftwo_factor_authenticatable_shared_examples.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/lib%2Fdevise_two_factor%2Fspec_helpers%2Ftwo_factor_authenticatable_shared_examples.rb?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -13,8 +13,8 @@\n   end\n \n   describe '#otp_secret' do\n-    it 'should be of the configured length' do\n-      expect(subject.otp_secret.length).to eq(subject.class.otp_secret_length)\n+    it 'should be of the expected length' do\n+      expect(subject.otp_secret.length).to eq(subject.class.otp_secret_length*8/5)\n     end\n   end\n \n@@ -129,11 +129,11 @@\n     let(:issuer)            { 'Tinfoil' }\n \n     it 'should return uri with specified account' do\n-      expect(subject.otp_provisioning_uri(account)).to match(%r{otpauth://totp/#{CGI.escape(account)}\\?secret=\\w{#{otp_secret_length}}})\n+      expect(subject.otp_provisioning_uri(account)).to match(%r{otpauth://totp/#{CGI.escape(account)}\\?secret=\\w{#{otp_secret_length*8/5}}})\n     end\n \n     it 'should return uri with issuer option' do\n-      expect(subject.otp_provisioning_uri(account, issuer: issuer)).to match(%r{otpauth://totp/#{issuer}:#{CGI.escape(account)}\\?.*secret=\\w{#{otp_secret_length}}(&|$)})\n+      expect(subject.otp_provisioning_uri(account, issuer: issuer)).to match(%r{otpauth://totp/#{issuer}:#{CGI.escape(account)}\\?.*secret=\\w{#{otp_secret_length*8/5}}(&|$)})\n       expect(subject.otp_provisioning_uri(account, issuer: issuer)).to match(%r{otpauth://totp/#{issuer}:#{CGI.escape(account)}\\?.*issuer=#{issuer}(&|$)})\n     end\n   end"
            },
            {
                "sha": "bcaf15f30b05666cab0bdb6a622417dc8b9cace0",
                "filename": "lib/devise_two_factor/spec_helpers/two_factor_backupable_shared_examples.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fspec_helpers%2Ftwo_factor_backupable_shared_examples.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fspec_helpers%2Ftwo_factor_backupable_shared_examples.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/lib%2Fdevise_two_factor%2Fspec_helpers%2Ftwo_factor_backupable_shared_examples.rb?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -17,7 +17,7 @@\n \n       it 'generates recovery codes of the correct length' do\n         @plaintext_codes.each do |code|\n-          expect(code.length).to eq(subject.class.otp_backup_code_length)\n+          expect(code.length).to eq(subject.class.otp_backup_code_length*2)\n         end\n       end\n "
            },
            {
                "sha": "cc029b3ea4e8607358bfbb2df0a977862ad89387",
                "filename": "lib/devise_two_factor/strategies/two_factor_backupable.rb",
                "status": "modified",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fstrategies%2Ftwo_factor_backupable.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fstrategies%2Ftwo_factor_backupable.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/lib%2Fdevise_two_factor%2Fstrategies%2Ftwo_factor_backupable.rb?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -6,9 +6,6 @@ def authenticate!\n         resource = mapping.to.find_for_database_authentication(authentication_hash)\n \n         if validate(resource) { resource.invalidate_otp_backup_code!(params[scope]['otp_attempt']) }\n-          # Devise fails to authenticate invalidated resources, but if we've\n-          # gotten here, the object changed (Since we deleted a recovery code)\n-          resource.save!\n           super\n         end\n "
            },
            {
                "sha": "e7959d4a534d017e81fb1b8f7aae75d601167a49",
                "filename": "lib/devise_two_factor/version.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fversion.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/lib%2Fdevise_two_factor%2Fversion.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/lib%2Fdevise_two_factor%2Fversion.rb?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -1,3 +1,3 @@\n module DeviseTwoFactor\n-  VERSION = '5.1.0'.freeze\n+  VERSION = '6.0.0'.freeze\n end"
            },
            {
                "sha": "ed3510b711387bab206ab8f0b7576f20bd4155ad",
                "filename": "spec/devise/models/two_factor_authenticatable_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/spec%2Fdevise%2Fmodels%2Ftwo_factor_authenticatable_spec.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/spec%2Fdevise%2Fmodels%2Ftwo_factor_authenticatable_spec.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/spec%2Fdevise%2Fmodels%2Ftwo_factor_authenticatable_spec.rb?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -18,7 +18,7 @@ def self.encrypts(*attrs)\n \n   attr_accessor :consumed_timestep\n \n-  def save(validate)\n+  def save!(_)\n     # noop for testing\n     true\n   end"
            },
            {
                "sha": "d1444195b7d761e2ed0e8deac37b031dfae16cf1",
                "filename": "spec/devise/models/two_factor_backupable_spec.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/devise-two-factor/devise-two-factor/blob/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/spec%2Fdevise%2Fmodels%2Ftwo_factor_backupable_spec.rb",
                "raw_url": "https://github.com/devise-two-factor/devise-two-factor/raw/cc6f34423d9c6af9f3e02be478c3c40dc7462e19/spec%2Fdevise%2Fmodels%2Ftwo_factor_backupable_spec.rb",
                "contents_url": "https://api.github.com/repos/devise-two-factor/devise-two-factor/contents/spec%2Fdevise%2Fmodels%2Ftwo_factor_backupable_spec.rb?ref=cc6f34423d9c6af9f3e02be478c3c40dc7462e19",
                "patch": "@@ -17,6 +17,10 @@ def self.encrypts(*attrs)\n   devise :two_factor_authenticatable, :two_factor_backupable\n \n   attr_accessor :otp_backup_codes\n+\n+  def save!(_)\n+    true\n+  end\n end\n \n describe ::Devise::Models::TwoFactorBackupable do"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vllm-project/vllm/commits/e25fee57c2e69161bd261f5986dc5aeb198bbd42",
        "url": "https://api.github.com/repos/vllm-project/vllm/commits/e25fee57c2e69161bd261f5986dc5aeb198bbd42",
        "html_url": "https://github.com/vllm-project/vllm/commit/e25fee57c2e69161bd261f5986dc5aeb198bbd42",
        "message": "[BugFix] Fix server crash on empty prompt (#7746)\n\nSigned-off-by: Max de Bayser <mbayser@br.ibm.com>",
        "files": [
            {
                "sha": "565dfa01346cc4150a90f69224af649deae5c1e0",
                "filename": "tests/entrypoints/llm/test_prompt_validation.py",
                "status": "added",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/vllm-project/vllm/blob/e25fee57c2e69161bd261f5986dc5aeb198bbd42/tests%2Fentrypoints%2Fllm%2Ftest_prompt_validation.py",
                "raw_url": "https://github.com/vllm-project/vllm/raw/e25fee57c2e69161bd261f5986dc5aeb198bbd42/tests%2Fentrypoints%2Fllm%2Ftest_prompt_validation.py",
                "contents_url": "https://api.github.com/repos/vllm-project/vllm/contents/tests%2Fentrypoints%2Fllm%2Ftest_prompt_validation.py?ref=e25fee57c2e69161bd261f5986dc5aeb198bbd42",
                "patch": "@@ -0,0 +1,9 @@\n+import pytest\n+\n+from vllm import LLM\n+\n+\n+def test_empty_prompt():\n+    llm = LLM(model=\"gpt2\")\n+    with pytest.raises(ValueError, match='Prompt cannot be empty'):\n+        llm.generate([\"\"])"
            },
            {
                "sha": "0a573a0066d320debb66b584d0a8d037d034ec0b",
                "filename": "tests/entrypoints/openai/test_prompt_validation.py",
                "status": "added",
                "additions": 22,
                "deletions": 0,
                "changes": 22,
                "blob_url": "https://github.com/vllm-project/vllm/blob/e25fee57c2e69161bd261f5986dc5aeb198bbd42/tests%2Fentrypoints%2Fopenai%2Ftest_prompt_validation.py",
                "raw_url": "https://github.com/vllm-project/vllm/raw/e25fee57c2e69161bd261f5986dc5aeb198bbd42/tests%2Fentrypoints%2Fopenai%2Ftest_prompt_validation.py",
                "contents_url": "https://api.github.com/repos/vllm-project/vllm/contents/tests%2Fentrypoints%2Fopenai%2Ftest_prompt_validation.py?ref=e25fee57c2e69161bd261f5986dc5aeb198bbd42",
                "patch": "@@ -0,0 +1,22 @@\n+# imports for guided decoding tests\n+import re\n+\n+import openai\n+import pytest\n+\n+from ...utils import RemoteOpenAIServer\n+\n+\n+@pytest.mark.asyncio\n+async def test_empty_prompt():\n+    model_name = \"gpt2\"\n+    server_args = [\"--enforce-eager\"]\n+    with RemoteOpenAIServer(model_name, server_args) as remote_server:\n+        client = remote_server.get_async_client()\n+\n+        with pytest.raises(openai.BadRequestError,\n+                           match=re.compile('.+Prompt cannot be empty.+')):\n+            await client.completions.create(model=model_name,\n+                                            prompt=\"\",\n+                                            max_tokens=5,\n+                                            temperature=0.0)"
            },
            {
                "sha": "8c98b64181d06b27da4c86b0ba4a4d090f7745a1",
                "filename": "vllm/engine/llm_engine.py",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/vllm-project/vllm/blob/e25fee57c2e69161bd261f5986dc5aeb198bbd42/vllm%2Fengine%2Fllm_engine.py",
                "raw_url": "https://github.com/vllm-project/vllm/raw/e25fee57c2e69161bd261f5986dc5aeb198bbd42/vllm%2Fengine%2Fllm_engine.py",
                "contents_url": "https://api.github.com/repos/vllm-project/vllm/contents/vllm%2Fengine%2Fllm_engine.py?ref=e25fee57c2e69161bd261f5986dc5aeb198bbd42",
                "patch": "@@ -591,6 +591,7 @@ def _add_processed_request(\n         prompt_adapter_request: Optional[PromptAdapterRequest],\n         trace_headers: Optional[Mapping[str, str]] = None,\n     ) -> None:\n+        self._validate_model_inputs(processed_inputs)\n         # Create the sequences.\n         block_size = self.cache_config.block_size\n         seq_id = next(self.seq_counter)\n@@ -1647,3 +1648,10 @@ def is_encoder_decoder_model(self):\n \n     def is_embedding_model(self):\n         return self.model_config.is_embedding_model\n+\n+    def _validate_model_inputs(self, inputs: Union[LLMInputs,\n+                                                   EncoderDecoderLLMInputs]):\n+        prompt_key = \"encoder_prompt_token_ids\" \\\n+            if self.is_encoder_decoder_model() else \"prompt_token_ids\"\n+        if not inputs.get(prompt_key):\n+            raise ValueError(\"Prompt cannot be empty\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/langchain-ai/langchain/commits/77209f315efd13442ec51c67719ba37dfaa44511",
        "url": "https://api.github.com/repos/langchain-ai/langchain/commits/77209f315efd13442ec51c67719ba37dfaa44511",
        "html_url": "https://github.com/langchain-ai/langchain/commit/77209f315efd13442ec51c67719ba37dfaa44511",
        "message": "community[patch]: FAISS VectorStore deserializer should be opt-in (#22861)\n\nFAISS deserializer uses pickle module. Users have to opt-in to\r\nde-serialize.",
        "files": [
            {
                "sha": "1dfb653524a6eca2c571335c0b920a3fb9cb795c",
                "filename": "libs/community/langchain_community/vectorstores/faiss.py",
                "status": "modified",
                "additions": 15,
                "deletions": 0,
                "changes": 15,
                "blob_url": "https://github.com/langchain-ai/langchain/blob/77209f315efd13442ec51c67719ba37dfaa44511/libs%2Fcommunity%2Flangchain_community%2Fvectorstores%2Ffaiss.py",
                "raw_url": "https://github.com/langchain-ai/langchain/raw/77209f315efd13442ec51c67719ba37dfaa44511/libs%2Fcommunity%2Flangchain_community%2Fvectorstores%2Ffaiss.py",
                "contents_url": "https://api.github.com/repos/langchain-ai/langchain/contents/libs%2Fcommunity%2Flangchain_community%2Fvectorstores%2Ffaiss.py?ref=77209f315efd13442ec51c67719ba37dfaa44511",
                "patch": "@@ -1105,9 +1105,24 @@ def deserialize_from_bytes(\n         cls,\n         serialized: bytes,\n         embeddings: Embeddings,\n+        *,\n+        allow_dangerous_deserialization: bool = False,\n         **kwargs: Any,\n     ) -> FAISS:\n         \"\"\"Deserialize FAISS index, docstore, and index_to_docstore_id from bytes.\"\"\"\n+        if not allow_dangerous_deserialization:\n+            raise ValueError(\n+                \"The de-serialization relies loading a pickle file. \"\n+                \"Pickle files can be modified to deliver a malicious payload that \"\n+                \"results in execution of arbitrary code on your machine.\"\n+                \"You will need to set `allow_dangerous_deserialization` to `True` to \"\n+                \"enable deserialization. If you do this, make sure that you \"\n+                \"trust the source of the data. For example, if you are loading a \"\n+                \"file that you created, and know that no one else has modified the \"\n+                \"file, then this is safe to do. Do not set this to `True` if you are \"\n+                \"loading a file from an untrusted source (e.g., some random site on \"\n+                \"the internet.).\"\n+            )\n         index, docstore, index_to_docstore_id = pickle.loads(serialized)\n         return cls(embeddings, index, docstore, index_to_docstore_id, **kwargs)\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/langchain-ai/langchain/commits/604dfe2d99246b0c09f047c604f0c63eafba31e7",
        "url": "https://api.github.com/repos/langchain-ai/langchain/commits/604dfe2d99246b0c09f047c604f0c63eafba31e7",
        "html_url": "https://github.com/langchain-ai/langchain/commit/604dfe2d99246b0c09f047c604f0c63eafba31e7",
        "message": "community[patch]: Force opt-in for WebResearchRetriever (CVE-2024-3095) (#24451)\n\nThis PR addresses the issue raised by (CVE-2024-3095)\r\n\r\nhttps://huntr.com/bounties/e62d4895-2901-405b-9559-38276b6a5273\r\n\r\nUnfortunately, we didn't do a good job writing the initial report. It's\r\npointing at both the wrong package and the wrong code.\r\n\r\nThe affected code is the Web Retriever not the AsyncHTMLLoader, and the\r\nWebRetriever lives in langchain-community\r\n\r\nThe vulnerable code lives here: \r\n\r\nhttps://github.com/langchain-ai/langchain/blob/0bd3f4e1292c085f22bef1fff16059851e11d042/libs/community/langchain_community/retrievers/web_research.py#L233-L233\r\n\r\n\r\nThis PR adds a forced opt-in for users to make sure they are aware of\r\nthe risk and can mitigate by configuring a proxy:\r\n\r\n\r\nhttps://github.com/langchain-ai/langchain/blob/0bd3f4e1292c085f22bef1fff16059851e11d042/libs/community/langchain_community/retrievers/web_research.py#L84-L84",
        "files": [
            {
                "sha": "2187225f38b49978bd6869a46c71888cd4e35b9b",
                "filename": "libs/community/langchain_community/retrievers/web_research.py",
                "status": "modified",
                "additions": 30,
                "deletions": 1,
                "changes": 31,
                "blob_url": "https://github.com/langchain-ai/langchain/blob/604dfe2d99246b0c09f047c604f0c63eafba31e7/libs%2Fcommunity%2Flangchain_community%2Fretrievers%2Fweb_research.py",
                "raw_url": "https://github.com/langchain-ai/langchain/raw/604dfe2d99246b0c09f047c604f0c63eafba31e7/libs%2Fcommunity%2Flangchain_community%2Fretrievers%2Fweb_research.py",
                "contents_url": "https://api.github.com/repos/langchain-ai/langchain/contents/libs%2Fcommunity%2Flangchain_community%2Fretrievers%2Fweb_research.py?ref=604dfe2d99246b0c09f047c604f0c63eafba31e7",
                "patch": "@@ -1,6 +1,6 @@\n import logging\n import re\n-from typing import List, Optional\n+from typing import Any, List, Optional\n \n from langchain.chains import LLMChain\n from langchain.chains.prompt_selector import ConditionalPromptSelector\n@@ -81,6 +81,35 @@ class WebResearchRetriever(BaseRetriever):\n         \"check .netrc for proxy configuration\",\n     )\n \n+    allow_dangerous_requests: bool = False\n+    \"\"\"A flag to force users to acknowledge the risks of SSRF attacks when using \n+    this retriever.\n+    \n+    Users should set this flag to `True` if they have taken the necessary precautions\n+    to prevent SSRF attacks when using this retriever.\n+    \n+    For example, users can run the requests through a properly configured\n+    proxy and prevent the crawler from accidentally crawling internal resources.\n+    \"\"\"\n+\n+    def __init__(self, **kwargs: Any) -> None:\n+        \"\"\"Initialize the retriever.\"\"\"\n+        allow_dangerous_requests = kwargs.get(\"allow_dangerous_requests\", False)\n+        if not allow_dangerous_requests:\n+            raise ValueError(\n+                \"WebResearchRetriever crawls URLs surfaced through \"\n+                \"the provided search engine. It is possible that some of those URLs \"\n+                \"will end up pointing to machines residing on an internal network, \"\n+                \"leading\"\n+                \"to an SSRF (Server-Side Request Forgery) attack. \"\n+                \"To protect yourself against that risk, you can run the requests \"\n+                \"through a proxy and prevent the crawler from accidentally crawling \"\n+                \"internal resources.\"\n+                \"If've taken the necessary precautions, you can set \"\n+                \"`allow_dangerous_requests` to `True`.\"\n+            )\n+        super().__init__(**kwargs)\n+\n     @classmethod\n     def from_llm(\n         cls,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/czim/file-handling/commits/95dfda850536bf35e684619598b9d02f4c97680d",
        "url": "https://api.github.com/repos/czim/file-handling/commits/95dfda850536bf35e684619598b9d02f4c97680d",
        "html_url": "https://github.com/czim/file-handling/commit/95dfda850536bf35e684619598b9d02f4c97680d",
        "message": "Security fixes for legacy version",
        "files": [
            {
                "sha": "80423a80af64a503b3c3e17775ed48a1d380f305",
                "filename": "README.md",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/czim/file-handling/blob/95dfda850536bf35e684619598b9d02f4c97680d/README.md",
                "raw_url": "https://github.com/czim/file-handling/raw/95dfda850536bf35e684619598b9d02f4c97680d/README.md",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/README.md?ref=95dfda850536bf35e684619598b9d02f4c97680d",
                "patch": "@@ -33,7 +33,13 @@ Here's an example of how to set up variant processing in general:\n     $helper      = new \\Czim\\FileHandling\\Support\\Content\\MimeTypeHelper;\n     $interpreter = new \\Czim\\FileHandling\\Support\\Content\\UploadedContentInterpreter;\n     $downloader  = new \\Czim\\FileHandling\\Support\\Download\\UrlDownloader($helper);\n-    $factory     = new \\Czim\\FileHandling\\Storage\\File\\StorableFileFactory($helper, $interpreter, $downloader);\n+    $validator   = new \\Czim\\FileHandling\\Support\\Download\\UriValidator();\n+    $factory     = new \\Czim\\FileHandling\\Storage\\File\\StorableFileFactory(\n+        $helper,\n+        $interpreter,\n+        $downloader,\n+        $validator\n+    );\n \n     $file = $factory->makeFromLocalPath($sourcePath);\n "
            },
            {
                "sha": "5b4926b718bb960c3c4acd96dc0037872bc3f94d",
                "filename": "src/Contracts/Support/UriValidatorInterface.php",
                "status": "added",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/czim/file-handling/blob/95dfda850536bf35e684619598b9d02f4c97680d/src%2FContracts%2FSupport%2FUriValidatorInterface.php",
                "raw_url": "https://github.com/czim/file-handling/raw/95dfda850536bf35e684619598b9d02f4c97680d/src%2FContracts%2FSupport%2FUriValidatorInterface.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FContracts%2FSupport%2FUriValidatorInterface.php?ref=95dfda850536bf35e684619598b9d02f4c97680d",
                "patch": "@@ -0,0 +1,8 @@\n+<?php\n+\n+namespace Czim\\FileHandling\\Contracts\\Support;\n+\n+interface UriValidatorInterface\n+{\n+    public function isValid(string $url): bool;\n+}"
            },
            {
                "sha": "c9d601b5f9a41dd2dbbfe53dce8de8db3eb2b3c4",
                "filename": "src/Exceptions/UriNotAllowedOnRetrieveRemoteFileException.php",
                "status": "added",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/czim/file-handling/blob/95dfda850536bf35e684619598b9d02f4c97680d/src%2FExceptions%2FUriNotAllowedOnRetrieveRemoteFileException.php",
                "raw_url": "https://github.com/czim/file-handling/raw/95dfda850536bf35e684619598b9d02f4c97680d/src%2FExceptions%2FUriNotAllowedOnRetrieveRemoteFileException.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FExceptions%2FUriNotAllowedOnRetrieveRemoteFileException.php?ref=95dfda850536bf35e684619598b9d02f4c97680d",
                "patch": "@@ -0,0 +1,7 @@\n+<?php\n+\n+namespace Czim\\FileHandling\\Exceptions;\n+\n+class UriNotAllowedOnRetrieveRemoteFileException extends CouldNotRetrieveRemoteFileException\n+{\n+}"
            },
            {
                "sha": "9593df977be8449a9cf344c41bfb6c77f123cc33",
                "filename": "src/Storage/File/StorableFileFactory.php",
                "status": "modified",
                "additions": 24,
                "deletions": 15,
                "changes": 39,
                "blob_url": "https://github.com/czim/file-handling/blob/95dfda850536bf35e684619598b9d02f4c97680d/src%2FStorage%2FFile%2FStorableFileFactory.php",
                "raw_url": "https://github.com/czim/file-handling/raw/95dfda850536bf35e684619598b9d02f4c97680d/src%2FStorage%2FFile%2FStorableFileFactory.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FStorage%2FFile%2FStorableFileFactory.php?ref=95dfda850536bf35e684619598b9d02f4c97680d",
                "patch": "@@ -7,10 +7,12 @@\n use Czim\\FileHandling\\Contracts\\Support\\ContentInterpreterInterface;\n use Czim\\FileHandling\\Contracts\\Support\\MimeTypeHelperInterface;\n use Czim\\FileHandling\\Contracts\\Support\\RawContentInterface;\n+use Czim\\FileHandling\\Contracts\\Support\\UriValidatorInterface;\n use Czim\\FileHandling\\Contracts\\Support\\UrlDownloaderInterface;\n use Czim\\FileHandling\\Enums\\ContentTypes;\n use Czim\\FileHandling\\Exceptions\\CouldNotReadDataException;\n use Czim\\FileHandling\\Exceptions\\CouldNotRetrieveRemoteFileException;\n+use Czim\\FileHandling\\Exceptions\\UriNotAllowedOnRetrieveRemoteFileException;\n use Czim\\FileHandling\\Support\\Content\\RawContent;\n use Exception;\n use SplFileInfo;\n@@ -34,25 +36,27 @@ class StorableFileFactory implements StorableFileFactoryInterface\n      */\n     protected $downloader;\n \n+    /**\n+     * @var UriValidatorInterface\n+     */\n+    protected $uriValidator;\n+\n     /**\n      * @var bool\n      */\n     protected $markNextUploaded = false;\n \n \n-    /**\n-     * @param MimeTypeHelperInterface     $mimeTypeHelper\n-     * @param ContentInterpreterInterface $contentInterpreter\n-     * @param UrlDownloaderInterface      $downloader\n-     */\n     public function __construct(\n         MimeTypeHelperInterface $mimeTypeHelper,\n         ContentInterpreterInterface $contentInterpreter,\n-        UrlDownloaderInterface $downloader\n+        UrlDownloaderInterface $downloader,\n+        UriValidatorInterface $uriValidator\n     ) {\n         $this->mimeTypeHelper = $mimeTypeHelper;\n         $this->interpreter    = $contentInterpreter;\n         $this->downloader     = $downloader;\n+        $this->uriValidator   = $uriValidator;\n     }\n \n     /**\n@@ -165,6 +169,12 @@ public function makeFromLocalPath($path, $name = null, $mimeType = null)\n      */\n     public function makeFromUrl($url, $name = null, $mimeType = null)\n     {\n+        if (! $this->uriValidator->isValid($url)) {\n+            throw new UriNotAllowedOnRetrieveRemoteFileException(\n+                \"Not allowed to retrieve file from '{$url}'\"\n+            );\n+        }\n+\n         try {\n             $localPath = $this->downloader->download($url);\n \n@@ -283,18 +293,17 @@ public function makeFromRawData($data, $name = null, $mimeType = null)\n      */\n     protected function interpretFromRawContent(RawContentInterface $data, $name, $mimeType)\n     {\n-        switch ($this->interpreter->interpret($data)) {\n-\n-            case ContentTypes::URI:\n-                return $this->makeFromUrl($data->content(), $name, $mimeType);\n+        $type = $this->interpreter->interpret($data);\n \n-            case ContentTypes::DATAURI:\n-                return $this->makeFromDataUri($data, $name, $mimeType);\n+        if ($type === ContentTypes::URI && $this->uriValidator->isValid($data->content())) {\n+            return $this->makeFromUrl($data->content(), $name, $mimeType);\n+        }\n \n-            case ContentTypes::RAW:\n-            default:\n-                return $this->makeFromRawData($data, $name, $mimeType);\n+        if ($type === ContentTypes::DATAURI) {\n+            return $this->makeFromDataUri($data, $name, $mimeType);\n         }\n+\n+        return $this->makeFromRawData($data, $name, $mimeType);\n     }\n \n     /**"
            },
            {
                "sha": "ffc339a577e04047d064c48c3bb8f5d79e3057e5",
                "filename": "src/Support/Content/UploadedContentInterpreter.php",
                "status": "modified",
                "additions": 0,
                "deletions": 31,
                "changes": 31,
                "blob_url": "https://github.com/czim/file-handling/blob/95dfda850536bf35e684619598b9d02f4c97680d/src%2FSupport%2FContent%2FUploadedContentInterpreter.php",
                "raw_url": "https://github.com/czim/file-handling/raw/95dfda850536bf35e684619598b9d02f4c97680d/src%2FSupport%2FContent%2FUploadedContentInterpreter.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FSupport%2FContent%2FUploadedContentInterpreter.php?ref=95dfda850536bf35e684619598b9d02f4c97680d",
                "patch": "@@ -25,7 +25,6 @@ public function interpret(RawContentInterface $content)\n         // Treat any string longer than 2048 characters as full data\n         if (    $content->size() <= static::FULL_DATA_THRESHOLD\n             && filter_var($content->content(), FILTER_VALIDATE_URL)\n-            && $this->isUrlWithAllowedProtocol($content->content())\n         ) {\n             return ContentTypes::URI;\n         }\n@@ -37,34 +36,4 @@ public function interpret(RawContentInterface $content)\n \n         return ContentTypes::RAW;\n     }\n-\n-    /**\n-     * @param string $url\n-     * @return bool\n-     */\n-    protected function isUrlWithAllowedProtocol(string $url)\n-    {\n-        foreach ($this->getAllowedUrlProtocols() as $protocol) {\n-            if (strpos($url, $protocol . '://') === 0) {\n-                return true;\n-            }\n-        }\n-\n-        return false;\n-    }\n-\n-    /**\n-     * Do not allow 'file' here, unless you are *very* certain you know what you're doing.\n-     * Otherwise attacks are possible where secrets may be exposed because local files may be 'downloaded'.\n-     *\n-     * @return array<int, string>\n-     */\n-    protected function getAllowedUrlProtocols()\n-    {\n-        return [\n-            'http',\n-            'https',\n-            'ftp',\n-        ];\n-    }\n }"
            },
            {
                "sha": "23c7729dfd6d8f43cf5c98d8c04efc7f8bd8fb10",
                "filename": "src/Support/Download/UriValidator.php",
                "status": "added",
                "additions": 94,
                "deletions": 0,
                "changes": 94,
                "blob_url": "https://github.com/czim/file-handling/blob/95dfda850536bf35e684619598b9d02f4c97680d/src%2FSupport%2FDownload%2FUriValidator.php",
                "raw_url": "https://github.com/czim/file-handling/raw/95dfda850536bf35e684619598b9d02f4c97680d/src%2FSupport%2FDownload%2FUriValidator.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FSupport%2FDownload%2FUriValidator.php?ref=95dfda850536bf35e684619598b9d02f4c97680d",
                "patch": "@@ -0,0 +1,94 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+namespace Czim\\FileHandling\\Support\\Download;\n+\n+use Czim\\FileHandling\\Contracts\\Support\\UriValidatorInterface;\n+\n+/**\n+ * By default this validator will report ANY URI as invalid.\n+ * This is intentional to minimize security risks.\n+ *\n+ * The allowLocalUri() and allowRemoteUri() methods offer ways to deliberately open the package up to these risks.\n+ */\n+class UriValidator implements UriValidatorInterface\n+{\n+    /**\n+     * @var bool\n+     */\n+    protected $allowLocalFileUri = false;\n+\n+    /**\n+     * @var bool\n+     */\n+    protected $allowRemoteUri = false;\n+\n+\n+    /**\n+     * This is a major security risk, so use with care.\n+     * Any local file path \"file://...\" will be valid, allowing file handling to download from the local filesystem.\n+     */\n+    public function allowLocalUri(): void\n+    {\n+        $this->allowLocalFileUri = true;\n+    }\n+\n+    /**\n+     * This is a security risk, so use with care.\n+     * Any remote path \"https://...\", \"ftp://...\" will be valid, allowing file handling to download from remote systems.\n+     */\n+    public function allowRemoteUri(): void\n+    {\n+        $this->allowRemoteUri = true;\n+    }\n+\n+    public function isValid(string $url): bool\n+    {\n+        if (! filter_var($url, FILTER_VALIDATE_URL)) {\n+            return false;\n+        }\n+\n+        return $this->isUrlWithAllowedProtocol($url);\n+    }\n+\n+    protected function isUrlWithAllowedProtocol(string $url): bool\n+    {\n+        $allowedProtocols = $this->getAllowedUrlProtocols();\n+\n+        if (empty($allowedProtocols)) {\n+            return false;\n+        }\n+\n+        foreach ($allowedProtocols as $protocol) {\n+            if (strpos($url, $protocol . '://') === 0) {\n+                return true;\n+            }\n+        }\n+\n+        return false;\n+    }\n+\n+    /**\n+     * Do not allow 'file' here, unless you are *very* certain you know what you're doing.\n+     * Otherwise attacks are possible where secrets may be exposed because local files may be 'downloaded'.\n+     *\n+     * @return array<int, string>\n+     */\n+    protected function getAllowedUrlProtocols(): array\n+    {\n+        $allowed = [];\n+\n+        if ($this->allowLocalFileUri) {\n+            $allowed[] = 'file';\n+        }\n+\n+        if ($this->allowRemoteUri) {\n+            $allowed[] = 'http';\n+            $allowed[] = 'https';\n+            $allowed[] = 'ftp';\n+        }\n+\n+        return $allowed;\n+    }\n+}"
            },
            {
                "sha": "eb39c0fc9582ae9ca650ea106a63147668f7f652",
                "filename": "tests/Unit/Storage/File/StorableFileFactoryTest.php",
                "status": "modified",
                "additions": 113,
                "deletions": 14,
                "changes": 127,
                "blob_url": "https://github.com/czim/file-handling/blob/95dfda850536bf35e684619598b9d02f4c97680d/tests%2FUnit%2FStorage%2FFile%2FStorableFileFactoryTest.php",
                "raw_url": "https://github.com/czim/file-handling/raw/95dfda850536bf35e684619598b9d02f4c97680d/tests%2FUnit%2FStorage%2FFile%2FStorableFileFactoryTest.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/tests%2FUnit%2FStorage%2FFile%2FStorableFileFactoryTest.php?ref=95dfda850536bf35e684619598b9d02f4c97680d",
                "patch": "@@ -4,10 +4,12 @@\n use Czim\\FileHandling\\Contracts\\Support\\ContentInterpreterInterface;\n use Czim\\FileHandling\\Contracts\\Support\\MimeTypeHelperInterface;\n use Czim\\FileHandling\\Contracts\\Support\\RawContentInterface;\n+use Czim\\FileHandling\\Contracts\\Support\\UriValidatorInterface;\n use Czim\\FileHandling\\Contracts\\Support\\UrlDownloaderInterface;\n use Czim\\FileHandling\\Enums\\ContentTypes;\n use Czim\\FileHandling\\Exceptions\\CouldNotReadDataException;\n use Czim\\FileHandling\\Exceptions\\CouldNotRetrieveRemoteFileException;\n+use Czim\\FileHandling\\Exceptions\\UriNotAllowedOnRetrieveRemoteFileException;\n use Czim\\FileHandling\\Storage\\File\\RawStorableFile;\n use Czim\\FileHandling\\Storage\\File\\SplFileInfoStorableFile;\n use Czim\\FileHandling\\Storage\\File\\StorableFileFactory;\n@@ -35,9 +37,14 @@ class StorableFileFactoryTest extends TestCase\n     /**\n      * @test\n      */\n-    function it_returns_a_storable_file_intance_as_is()\n+    function it_returns_a_storable_file_instance_as_is()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $file = new RawStorableFile;\n         $file->setData('random content');\n@@ -54,7 +61,12 @@ function it_returns_a_storable_file_intance_as_is()\n      */\n     function it_makes_a_storable_file_instance_from_an_uploaded_file_instance()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $testPath = realpath(__DIR__ . '/../../../resources/test.txt');\n \n@@ -73,7 +85,12 @@ function it_makes_a_storable_file_instance_from_an_uploaded_file_instance()\n      */\n     function it_makes_a_storable_file_instance_from_spl_file_info()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $info = new SplFileInfo($this->getExampleLocalPath());\n \n@@ -90,7 +107,12 @@ function it_makes_a_storable_file_instance_from_spl_file_info()\n      */\n     function it_makes_a_storable_file_instance_with_custom_name_and_mimetype()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $info = new SplFileInfo($this->getExampleLocalPath());\n \n@@ -106,7 +128,12 @@ function it_makes_a_storable_file_instance_with_custom_name_and_mimetype()\n      */\n     function it_makes_a_storable_file_instance_from_local_path()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $path = realpath(dirname(__DIR__) . '/../../../' . static::XML_TEST_FILE);\n \n@@ -118,20 +145,48 @@ function it_makes_a_storable_file_instance_from_local_path()\n         static::assertEquals('application/xml', $file->mimeType());\n     }\n \n+    /**\n+     * @test\n+     */\n+    function it_blocks_loading_from_any_url_given_validator_response()\n+    {\n+        $validator = $this->getMockUriValidator();\n+\n+        $validator->expects('isValid')->with('http://test.com/test.xml?page=23')->andReturn(false);\n+\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $validator\n+        );\n+\n+        $this->expectException(UriNotAllowedOnRetrieveRemoteFileException::class);\n+        $factory->makeFromUrl('http://test.com/test.xml?page=23');\n+    }\n+\n     /**\n      * @test\n      */\n     function it_makes_a_storable_file_instance_from_a_url()\n     {\n         $downloader = $this->getMockDownloader();\n+        $validator  = $this->getMockUriValidator();\n \n         $path = realpath(dirname(__DIR__) . '/../../../' . static::XML_TEST_FILE);\n \n+        $validator->expects('isValid')->with('http://test.com/test.xml?page=23')->andReturn(true);\n+\n         $downloader->shouldReceive('download')\n             ->with('http://test.com/test.xml?page=23')\n             ->andReturn($path);\n \n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $downloader);\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $downloader,\n+            $validator\n+        );\n \n         $file = $factory->makeFromUrl('http://test.com/test.xml?page=23');\n \n@@ -149,12 +204,20 @@ function it_throws_an_exception_if_url_could_not_be_downloaded_from()\n         $this->expectException(CouldNotRetrieveRemoteFileException::class);\n \n         $downloader = $this->getMockDownloader();\n+        $validator  = $this->getMockUriValidator();\n+\n+        $validator->expects('isValid')->andReturn(true);\n \n         $downloader->shouldReceive('download')\n             ->with('http://test.com/test.xml')\n             ->andThrow(ErrorException::class, 'testing');\n \n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $downloader);\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $downloader,\n+            $validator\n+        );\n \n         $factory->makeFromUrl('http://test.com/test.xml');\n     }\n@@ -167,7 +230,12 @@ function it_makes_a_storable_file_from_a_datauri()\n         $mimeTypeHelper = $this->getMockMimeTypeHelper();\n         $mimeTypeHelper->shouldReceive('guessExtensionForMimeType')->with('image/gif')->andReturn('gif');\n \n-        $factory = new StorableFileFactory($mimeTypeHelper, $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $mimeTypeHelper,\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $rawData = $this->getExampleDataUri();\n \n@@ -192,7 +260,12 @@ function it_makes_a_storable_file_from_a_datauri()\n      */\n     function it_makes_a_storable_file_instance_from_raw_data()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $rawData = $this->getExampleRawData();\n \n@@ -220,6 +293,7 @@ function it_makes_storable_file_instances_for_interpreted_source_data()\n         $mimeGuesser = $this->getMockMimeTypeHelper();\n         $interpreter = $this->getMockInterpreter();\n         $downloader  = $this->getMockDownloader();\n+        $validator   = $this->getMockUriValidator();\n \n         // Data URI expectation\n         $interpreter->shouldReceive('interpret')\n@@ -242,6 +316,8 @@ function it_makes_storable_file_instances_for_interpreted_source_data()\n             }))\n             ->andReturn(ContentTypes::RAW);\n \n+        $validator->shouldReceive('isValid')->andReturn(true);\n+\n         // Expectations for download logic\n         $downloader->shouldReceive('download')\n             ->with('http://yourfilehere.com')\n@@ -251,7 +327,7 @@ function it_makes_storable_file_instances_for_interpreted_source_data()\n         $mimeGuesser->shouldReceive('guessExtensionForMimeType')->with('application/xml')->andReturn('xml');\n \n \n-        $factory = new StorableFileFactory($mimeGuesser, $interpreter, $downloader);\n+        $factory = new StorableFileFactory($mimeGuesser, $interpreter, $downloader, $validator);\n \n         $file = $factory->makeFromAny(new SplFileInfo($this->getExampleLocalPath()));\n         static::assertInstanceOf(SplFileInfoStorableFile::class, $file);\n@@ -271,7 +347,12 @@ function it_makes_storable_file_instances_for_interpreted_source_data()\n      */\n     function it_marks_a_file_uploaded_with_fluent_syntax()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $info = new SplFileInfo($this->getExampleLocalPath());\n \n@@ -292,7 +373,12 @@ function it_throws_an_exception_if_any_data_is_not_a_string()\n     {\n         $this->expectException(UnexpectedValueException::class);\n \n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $factory->makeFromAny(['not', 'a string']);\n     }\n@@ -304,7 +390,12 @@ function it_throws_an_exception_if_data_uri_cannot_be_interpreted()\n     {\n         $this->expectException(CouldNotReadDataException::class);\n \n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $factory->makeFromDataUri('_data://invalid/mimetype,base32brokencontent', 'name.txt');\n     }\n@@ -340,6 +431,14 @@ protected function getMockDownloader()\n         return Mockery::mock(UrlDownloaderInterface::class);\n     }\n \n+    /**\n+     * @return Mockery\\Mock|Mockery\\MockInterface|UriValidatorInterface\n+     */\n+    protected function getMockUriValidator()\n+    {\n+        return Mockery::mock(UriValidatorInterface::class);\n+    }\n+\n     protected function getExampleLocalPath(): string\n     {\n         return realpath(dirname(__DIR__) . '/../../../' . static::XML_TEST_FILE);"
            },
            {
                "sha": "a3826d5da676cd9047eb962a06373a82d1350f28",
                "filename": "tests/Unit/Support/Download/UriValidatorTest.php",
                "status": "added",
                "additions": 70,
                "deletions": 0,
                "changes": 70,
                "blob_url": "https://github.com/czim/file-handling/blob/95dfda850536bf35e684619598b9d02f4c97680d/tests%2FUnit%2FSupport%2FDownload%2FUriValidatorTest.php",
                "raw_url": "https://github.com/czim/file-handling/raw/95dfda850536bf35e684619598b9d02f4c97680d/tests%2FUnit%2FSupport%2FDownload%2FUriValidatorTest.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/tests%2FUnit%2FSupport%2FDownload%2FUriValidatorTest.php?ref=95dfda850536bf35e684619598b9d02f4c97680d",
                "patch": "@@ -0,0 +1,70 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+namespace Unit\\Support\\Download;\n+\n+use Czim\\FileHandling\\Support\\Download\\UriValidator;\n+use Czim\\FileHandling\\Test\\TestCase;\n+\n+class UriValidatorTest extends TestCase\n+{\n+    /**\n+     * @test\n+     */\n+    public function it_considers_any_uri_invalid_by_default()\n+    {\n+        $validator = new UriValidator();\n+\n+        static::assertFalse($validator->isValid('file://../local.file'));\n+        static::assertFalse($validator->isValid('http://anything.test'));\n+        static::assertFalse($validator->isValid('https://anything.test'));\n+        static::assertFalse($validator->isValid('ftp://anything.test'));\n+    }\n+\n+    /**\n+     * @test\n+     */\n+    public function it_considers_any_remote_uri_valid_when_configured_to()\n+    {\n+        $validator = new UriValidator();\n+\n+        $validator->allowRemoteUri();\n+\n+        static::assertFalse($validator->isValid('file://../local.file'));\n+        static::assertTrue($validator->isValid('http://anything.test'));\n+        static::assertTrue($validator->isValid('https://anything.test'));\n+        static::assertTrue($validator->isValid('ftp://anything.test'));\n+    }\n+\n+    /**\n+     * @test\n+     */\n+    public function it_considers_local_uri_valid_when_configured_to()\n+    {\n+        $validator = new UriValidator();\n+\n+        $validator->allowLocalUri();\n+\n+        static::assertTrue($validator->isValid('file://../local.file'));\n+        static::assertFalse($validator->isValid('http://anything.test'));\n+        static::assertFalse($validator->isValid('https://anything.test'));\n+        static::assertFalse($validator->isValid('ftp://anything.test'));\n+    }\n+\n+    /**\n+     * @test\n+     */\n+    public function it_any_uri_valid_when_configured_to()\n+    {\n+        $validator = new UriValidator();\n+\n+        $validator->allowRemoteUri();\n+        $validator->allowLocalUri();\n+\n+        static::assertTrue($validator->isValid('file://../local.file'));\n+        static::assertTrue($validator->isValid('http://anything.test'));\n+        static::assertTrue($validator->isValid('https://anything.test'));\n+        static::assertTrue($validator->isValid('ftp://anything.test'));\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/czim/file-handling/commits/dcf879896efe3457f51af9c8eab9f70dfc709a99",
        "url": "https://api.github.com/repos/czim/file-handling/commits/dcf879896efe3457f51af9c8eab9f70dfc709a99",
        "html_url": "https://github.com/czim/file-handling/commit/dcf879896efe3457f51af9c8eab9f70dfc709a99",
        "message": "Block remove and local uri as interpretable raw content by default",
        "files": [
            {
                "sha": "5b4926b718bb960c3c4acd96dc0037872bc3f94d",
                "filename": "src/Contracts/Support/UriValidatorInterface.php",
                "status": "added",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/czim/file-handling/blob/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FContracts%2FSupport%2FUriValidatorInterface.php",
                "raw_url": "https://github.com/czim/file-handling/raw/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FContracts%2FSupport%2FUriValidatorInterface.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FContracts%2FSupport%2FUriValidatorInterface.php?ref=dcf879896efe3457f51af9c8eab9f70dfc709a99",
                "patch": "@@ -0,0 +1,8 @@\n+<?php\n+\n+namespace Czim\\FileHandling\\Contracts\\Support;\n+\n+interface UriValidatorInterface\n+{\n+    public function isValid(string $url): bool;\n+}"
            },
            {
                "sha": "c9d601b5f9a41dd2dbbfe53dce8de8db3eb2b3c4",
                "filename": "src/Exceptions/UriNotAllowedOnRetrieveRemoteFileException.php",
                "status": "added",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/czim/file-handling/blob/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FExceptions%2FUriNotAllowedOnRetrieveRemoteFileException.php",
                "raw_url": "https://github.com/czim/file-handling/raw/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FExceptions%2FUriNotAllowedOnRetrieveRemoteFileException.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FExceptions%2FUriNotAllowedOnRetrieveRemoteFileException.php?ref=dcf879896efe3457f51af9c8eab9f70dfc709a99",
                "patch": "@@ -0,0 +1,7 @@\n+<?php\n+\n+namespace Czim\\FileHandling\\Exceptions;\n+\n+class UriNotAllowedOnRetrieveRemoteFileException extends CouldNotRetrieveRemoteFileException\n+{\n+}"
            },
            {
                "sha": "241d07532aeea85aafbf1e08093ac85dfdc6e4f7",
                "filename": "src/Storage/File/StorableFileFactory.php",
                "status": "modified",
                "additions": 24,
                "deletions": 15,
                "changes": 39,
                "blob_url": "https://github.com/czim/file-handling/blob/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FStorage%2FFile%2FStorableFileFactory.php",
                "raw_url": "https://github.com/czim/file-handling/raw/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FStorage%2FFile%2FStorableFileFactory.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FStorage%2FFile%2FStorableFileFactory.php?ref=dcf879896efe3457f51af9c8eab9f70dfc709a99",
                "patch": "@@ -8,10 +8,12 @@\n use Czim\\FileHandling\\Contracts\\Support\\ContentInterpreterInterface;\n use Czim\\FileHandling\\Contracts\\Support\\MimeTypeHelperInterface;\n use Czim\\FileHandling\\Contracts\\Support\\RawContentInterface;\n+use Czim\\FileHandling\\Contracts\\Support\\UriValidatorInterface;\n use Czim\\FileHandling\\Contracts\\Support\\UrlDownloaderInterface;\n use Czim\\FileHandling\\Enums\\ContentTypes;\n use Czim\\FileHandling\\Exceptions\\CouldNotReadDataException;\n use Czim\\FileHandling\\Exceptions\\CouldNotRetrieveRemoteFileException;\n+use Czim\\FileHandling\\Exceptions\\UriNotAllowedOnRetrieveRemoteFileException;\n use Czim\\FileHandling\\Support\\Content\\RawContent;\n use Exception;\n use SplFileInfo;\n@@ -34,25 +36,27 @@ class StorableFileFactory implements StorableFileFactoryInterface\n      */\n     protected $downloader;\n \n+    /**\n+     * @var UriValidatorInterface\n+     */\n+    protected $uriValidator;\n+\n     /**\n      * @var bool\n      */\n     protected $markNextUploaded = false;\n \n \n-    /**\n-     * @param MimeTypeHelperInterface     $mimeTypeHelper\n-     * @param ContentInterpreterInterface $contentInterpreter\n-     * @param UrlDownloaderInterface      $downloader\n-     */\n     public function __construct(\n         MimeTypeHelperInterface $mimeTypeHelper,\n         ContentInterpreterInterface $contentInterpreter,\n-        UrlDownloaderInterface $downloader\n+        UrlDownloaderInterface $downloader,\n+        UriValidatorInterface $uriValidator\n     ) {\n         $this->mimeTypeHelper = $mimeTypeHelper;\n         $this->interpreter    = $contentInterpreter;\n         $this->downloader     = $downloader;\n+        $this->uriValidator   = $uriValidator;\n     }\n \n     /**\n@@ -165,6 +169,12 @@ public function makeFromLocalPath(string $path, ?string $name = null, ?string $m\n      */\n     public function makeFromUrl(string $url, ?string $name = null, ?string $mimeType = null): StorableFileInterface\n     {\n+        if (! $this->uriValidator->isValid($url)) {\n+            throw new UriNotAllowedOnRetrieveRemoteFileException(\n+                \"Not allowed to retrieve file from '{$url}'\"\n+            );\n+        }\n+\n         try {\n             $localPath = $this->downloader->download($url);\n         } catch (Exception $e) {\n@@ -281,18 +291,17 @@ public function makeFromRawData($data, ?string $name = null, ?string $mimeType =\n      */\n     protected function interpretFromRawContent(RawContentInterface $data, ?string $name, ?string $mimeType): StorableFileInterface\n     {\n-        switch ($this->interpreter->interpret($data)) {\n-\n-            case ContentTypes::URI:\n-                return $this->makeFromUrl($data->content(), $name, $mimeType);\n+        $type = $this->interpreter->interpret($data);\n \n-            case ContentTypes::DATAURI:\n-                return $this->makeFromDataUri($data, $name, $mimeType);\n+        if ($type === ContentTypes::URI && $this->uriValidator->isValid($data->content())) {\n+            return $this->makeFromUrl($data->content(), $name, $mimeType);\n+        }\n \n-            case ContentTypes::RAW:\n-            default:\n-                return $this->makeFromRawData($data, $name, $mimeType);\n+        if ($type === ContentTypes::DATAURI) {\n+            return $this->makeFromDataUri($data, $name, $mimeType);\n         }\n+\n+        return $this->makeFromRawData($data, $name, $mimeType);\n     }\n \n     /**"
            },
            {
                "sha": "62c7a61f021c6c86d263fbd53f7dd371c262e5a7",
                "filename": "src/Support/Content/UploadedContentInterpreter.php",
                "status": "modified",
                "additions": 0,
                "deletions": 27,
                "changes": 27,
                "blob_url": "https://github.com/czim/file-handling/blob/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FSupport%2FContent%2FUploadedContentInterpreter.php",
                "raw_url": "https://github.com/czim/file-handling/raw/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FSupport%2FContent%2FUploadedContentInterpreter.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FSupport%2FContent%2FUploadedContentInterpreter.php?ref=dcf879896efe3457f51af9c8eab9f70dfc709a99",
                "patch": "@@ -26,7 +26,6 @@ public function interpret(RawContentInterface $content): string\n         if (\n             $content->size() <= static::FULL_DATA_THRESHOLD\n             && filter_var($content->content(), FILTER_VALIDATE_URL)\n-            && $this->isUrlWithAllowedProtocol($content->content())\n         ) {\n             return ContentTypes::URI;\n         }\n@@ -40,30 +39,4 @@ public function interpret(RawContentInterface $content): string\n \n         return ContentTypes::RAW;\n     }\n-\n-    protected function isUrlWithAllowedProtocol(string $url): bool\n-    {\n-        foreach ($this->getAllowedUrlProtocols() as $protocol) {\n-            if (strpos($url, $protocol . '://') === 0) {\n-                return true;\n-            }\n-        }\n-\n-        return false;\n-    }\n-\n-    /**\n-     * Do not allow 'file' here, unless you are *very* certain you know what you're doing.\n-     * Otherwise attacks are possible where secrets may be exposed because local files may be 'downloaded'.\n-     *\n-     * @return array<int, string>\n-     */\n-    protected function getAllowedUrlProtocols(): array\n-    {\n-        return [\n-            'http',\n-            'https',\n-            'ftp',\n-        ];\n-    }\n }"
            },
            {
                "sha": "23c7729dfd6d8f43cf5c98d8c04efc7f8bd8fb10",
                "filename": "src/Support/Download/UriValidator.php",
                "status": "added",
                "additions": 94,
                "deletions": 0,
                "changes": 94,
                "blob_url": "https://github.com/czim/file-handling/blob/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FSupport%2FDownload%2FUriValidator.php",
                "raw_url": "https://github.com/czim/file-handling/raw/dcf879896efe3457f51af9c8eab9f70dfc709a99/src%2FSupport%2FDownload%2FUriValidator.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/src%2FSupport%2FDownload%2FUriValidator.php?ref=dcf879896efe3457f51af9c8eab9f70dfc709a99",
                "patch": "@@ -0,0 +1,94 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+namespace Czim\\FileHandling\\Support\\Download;\n+\n+use Czim\\FileHandling\\Contracts\\Support\\UriValidatorInterface;\n+\n+/**\n+ * By default this validator will report ANY URI as invalid.\n+ * This is intentional to minimize security risks.\n+ *\n+ * The allowLocalUri() and allowRemoteUri() methods offer ways to deliberately open the package up to these risks.\n+ */\n+class UriValidator implements UriValidatorInterface\n+{\n+    /**\n+     * @var bool\n+     */\n+    protected $allowLocalFileUri = false;\n+\n+    /**\n+     * @var bool\n+     */\n+    protected $allowRemoteUri = false;\n+\n+\n+    /**\n+     * This is a major security risk, so use with care.\n+     * Any local file path \"file://...\" will be valid, allowing file handling to download from the local filesystem.\n+     */\n+    public function allowLocalUri(): void\n+    {\n+        $this->allowLocalFileUri = true;\n+    }\n+\n+    /**\n+     * This is a security risk, so use with care.\n+     * Any remote path \"https://...\", \"ftp://...\" will be valid, allowing file handling to download from remote systems.\n+     */\n+    public function allowRemoteUri(): void\n+    {\n+        $this->allowRemoteUri = true;\n+    }\n+\n+    public function isValid(string $url): bool\n+    {\n+        if (! filter_var($url, FILTER_VALIDATE_URL)) {\n+            return false;\n+        }\n+\n+        return $this->isUrlWithAllowedProtocol($url);\n+    }\n+\n+    protected function isUrlWithAllowedProtocol(string $url): bool\n+    {\n+        $allowedProtocols = $this->getAllowedUrlProtocols();\n+\n+        if (empty($allowedProtocols)) {\n+            return false;\n+        }\n+\n+        foreach ($allowedProtocols as $protocol) {\n+            if (strpos($url, $protocol . '://') === 0) {\n+                return true;\n+            }\n+        }\n+\n+        return false;\n+    }\n+\n+    /**\n+     * Do not allow 'file' here, unless you are *very* certain you know what you're doing.\n+     * Otherwise attacks are possible where secrets may be exposed because local files may be 'downloaded'.\n+     *\n+     * @return array<int, string>\n+     */\n+    protected function getAllowedUrlProtocols(): array\n+    {\n+        $allowed = [];\n+\n+        if ($this->allowLocalFileUri) {\n+            $allowed[] = 'file';\n+        }\n+\n+        if ($this->allowRemoteUri) {\n+            $allowed[] = 'http';\n+            $allowed[] = 'https';\n+            $allowed[] = 'ftp';\n+        }\n+\n+        return $allowed;\n+    }\n+}"
            },
            {
                "sha": "85edc79c4d97aacae9b7c07632b8c5b360f7fd75",
                "filename": "tests/Unit/Storage/File/StorableFileFactoryTest.php",
                "status": "modified",
                "additions": 113,
                "deletions": 14,
                "changes": 127,
                "blob_url": "https://github.com/czim/file-handling/blob/dcf879896efe3457f51af9c8eab9f70dfc709a99/tests%2FUnit%2FStorage%2FFile%2FStorableFileFactoryTest.php",
                "raw_url": "https://github.com/czim/file-handling/raw/dcf879896efe3457f51af9c8eab9f70dfc709a99/tests%2FUnit%2FStorage%2FFile%2FStorableFileFactoryTest.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/tests%2FUnit%2FStorage%2FFile%2FStorableFileFactoryTest.php?ref=dcf879896efe3457f51af9c8eab9f70dfc709a99",
                "patch": "@@ -5,10 +5,12 @@\n use Czim\\FileHandling\\Contracts\\Support\\ContentInterpreterInterface;\n use Czim\\FileHandling\\Contracts\\Support\\MimeTypeHelperInterface;\n use Czim\\FileHandling\\Contracts\\Support\\RawContentInterface;\n+use Czim\\FileHandling\\Contracts\\Support\\UriValidatorInterface;\n use Czim\\FileHandling\\Contracts\\Support\\UrlDownloaderInterface;\n use Czim\\FileHandling\\Enums\\ContentTypes;\n use Czim\\FileHandling\\Exceptions\\CouldNotReadDataException;\n use Czim\\FileHandling\\Exceptions\\CouldNotRetrieveRemoteFileException;\n+use Czim\\FileHandling\\Exceptions\\UriNotAllowedOnRetrieveRemoteFileException;\n use Czim\\FileHandling\\Storage\\File\\RawStorableFile;\n use Czim\\FileHandling\\Storage\\File\\SplFileInfoStorableFile;\n use Czim\\FileHandling\\Storage\\File\\StorableFileFactory;\n@@ -36,9 +38,14 @@ class StorableFileFactoryTest extends TestCase\n     /**\n      * @test\n      */\n-    function it_returns_a_storable_file_intance_as_is()\n+    function it_returns_a_storable_file_instance_as_is()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $file = new RawStorableFile();\n         $file->setData('random content');\n@@ -55,7 +62,12 @@ function it_returns_a_storable_file_intance_as_is()\n      */\n     function it_makes_a_storable_file_instance_from_an_uploaded_file_instance()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $testPath = realpath(__DIR__ . '/../../../resources/test.txt');\n \n@@ -74,7 +86,12 @@ function it_makes_a_storable_file_instance_from_an_uploaded_file_instance()\n      */\n     function it_makes_a_storable_file_instance_from_spl_file_info()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $info = new SplFileInfo($this->getExampleLocalPath());\n \n@@ -91,7 +108,12 @@ function it_makes_a_storable_file_instance_from_spl_file_info()\n      */\n     function it_makes_a_storable_file_instance_with_custom_name_and_mimetype()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $info = new SplFileInfo($this->getExampleLocalPath());\n \n@@ -107,7 +129,12 @@ function it_makes_a_storable_file_instance_with_custom_name_and_mimetype()\n      */\n     function it_makes_a_storable_file_instance_from_local_path()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $path = realpath(dirname(__DIR__) . '/../../../' . static::XML_TEST_FILE);\n \n@@ -119,20 +146,48 @@ function it_makes_a_storable_file_instance_from_local_path()\n         static::assertEquals('application/xml', $file->mimeType());\n     }\n \n+    /**\n+     * @test\n+     */\n+    function it_blocks_loading_from_any_url_given_validator_response()\n+    {\n+        $validator = $this->getMockUriValidator();\n+\n+        $validator->expects('isValid')->with('http://test.com/test.xml?page=23')->andReturn(false);\n+\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $validator\n+        );\n+\n+        $this->expectException(UriNotAllowedOnRetrieveRemoteFileException::class);\n+        $factory->makeFromUrl('http://test.com/test.xml?page=23');\n+    }\n+\n     /**\n      * @test\n      */\n     function it_makes_a_storable_file_instance_from_a_url()\n     {\n         $downloader = $this->getMockDownloader();\n+        $validator  = $this->getMockUriValidator();\n \n         $path = realpath(dirname(__DIR__) . '/../../../' . static::XML_TEST_FILE);\n \n+        $validator->expects('isValid')->with('http://test.com/test.xml?page=23')->andReturn(true);\n+\n         $downloader->shouldReceive('download')\n             ->with('http://test.com/test.xml?page=23')\n             ->andReturn($path);\n \n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $downloader);\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $downloader,\n+            $validator\n+        );\n \n         $file = $factory->makeFromUrl('http://test.com/test.xml?page=23');\n \n@@ -150,12 +205,20 @@ function it_throws_an_exception_if_url_could_not_be_downloaded_from()\n         $this->expectException(CouldNotRetrieveRemoteFileException::class);\n \n         $downloader = $this->getMockDownloader();\n+        $validator  = $this->getMockUriValidator();\n+\n+        $validator->expects('isValid')->andReturn(true);\n \n         $downloader->shouldReceive('download')\n             ->with('http://test.com/test.xml')\n             ->andThrow(new ErrorException('testing'));\n \n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $downloader);\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $downloader,\n+            $validator\n+        );\n \n         $factory->makeFromUrl('http://test.com/test.xml');\n     }\n@@ -168,7 +231,12 @@ function it_makes_a_storable_file_from_a_datauri()\n         $mimeTypeHelper = $this->getMockMimeTypeHelper();\n         $mimeTypeHelper->shouldReceive('guessExtensionForMimeType')->with('image/gif')->andReturn('gif');\n \n-        $factory = new StorableFileFactory($mimeTypeHelper, $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $mimeTypeHelper,\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $rawData = $this->getExampleDataUri();\n \n@@ -193,7 +261,12 @@ function it_makes_a_storable_file_from_a_datauri()\n      */\n     function it_makes_a_storable_file_instance_from_raw_data()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $rawData = $this->getExampleRawData();\n \n@@ -221,6 +294,7 @@ function it_makes_storable_file_instances_for_interpreted_source_data()\n         $mimeGuesser = $this->getMockMimeTypeHelper();\n         $interpreter = $this->getMockInterpreter();\n         $downloader  = $this->getMockDownloader();\n+        $validator   = $this->getMockUriValidator();\n \n         // Data URI expectation\n         $interpreter->shouldReceive('interpret')\n@@ -243,6 +317,8 @@ function it_makes_storable_file_instances_for_interpreted_source_data()\n             }))\n             ->andReturn(ContentTypes::RAW);\n \n+        $validator->shouldReceive('isValid')->andReturn(true);\n+\n         // Expectations for download logic\n         $downloader->shouldReceive('download')\n             ->with('http://yourfilehere.com')\n@@ -252,7 +328,7 @@ function it_makes_storable_file_instances_for_interpreted_source_data()\n         $mimeGuesser->shouldReceive('guessExtensionForMimeType')->with('application/xml')->andReturn('xml');\n \n \n-        $factory = new StorableFileFactory($mimeGuesser, $interpreter, $downloader);\n+        $factory = new StorableFileFactory($mimeGuesser, $interpreter, $downloader, $validator);\n \n         $file = $factory->makeFromAny(new SplFileInfo($this->getExampleLocalPath()));\n         static::assertInstanceOf(SplFileInfoStorableFile::class, $file);\n@@ -272,7 +348,12 @@ function it_makes_storable_file_instances_for_interpreted_source_data()\n      */\n     function it_marks_a_file_uploaded_with_fluent_syntax()\n     {\n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $info = new SplFileInfo($this->getExampleLocalPath());\n \n@@ -293,7 +374,12 @@ function it_throws_an_exception_if_any_data_is_not_a_string()\n     {\n         $this->expectException(UnexpectedValueException::class);\n \n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $factory->makeFromAny(['not', 'a string']);\n     }\n@@ -305,7 +391,12 @@ function it_throws_an_exception_if_data_uri_cannot_be_interpreted()\n     {\n         $this->expectException(CouldNotReadDataException::class);\n \n-        $factory = new StorableFileFactory($this->getMockMimeTypeHelper(), $this->getMockInterpreter(), $this->getMockDownloader());\n+        $factory = new StorableFileFactory(\n+            $this->getMockMimeTypeHelper(),\n+            $this->getMockInterpreter(),\n+            $this->getMockDownloader(),\n+            $this->getMockUriValidator()\n+        );\n \n         $factory->makeFromDataUri('_data://invalid/mimetype,base32brokencontent', 'name.txt');\n     }\n@@ -341,6 +432,14 @@ protected function getMockDownloader()\n         return Mockery::mock(UrlDownloaderInterface::class);\n     }\n \n+    /**\n+     * @return Mockery\\Mock|Mockery\\MockInterface|UriValidatorInterface\n+     */\n+    protected function getMockUriValidator()\n+    {\n+        return Mockery::mock(UriValidatorInterface::class);\n+    }\n+\n     protected function getExampleLocalPath(): string\n     {\n         return realpath(dirname(__DIR__) . '/../../../' . static::XML_TEST_FILE);"
            },
            {
                "sha": "89adad608ad77060f7342f6c56bfb15216b10a0d",
                "filename": "tests/Unit/Support/Content/UploadedContentInterpreterTest.php",
                "status": "modified",
                "additions": 0,
                "deletions": 23,
                "changes": 23,
                "blob_url": "https://github.com/czim/file-handling/blob/dcf879896efe3457f51af9c8eab9f70dfc709a99/tests%2FUnit%2FSupport%2FContent%2FUploadedContentInterpreterTest.php",
                "raw_url": "https://github.com/czim/file-handling/raw/dcf879896efe3457f51af9c8eab9f70dfc709a99/tests%2FUnit%2FSupport%2FContent%2FUploadedContentInterpreterTest.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/tests%2FUnit%2FSupport%2FContent%2FUploadedContentInterpreterTest.php?ref=dcf879896efe3457f51af9c8eab9f70dfc709a99",
                "patch": "@@ -55,29 +55,6 @@ function it_returns_raw_for_non_url_non_datauri_content()\n         );\n     }\n \n-    /**\n-     * @test\n-     */\n-    function it_returns_raw_for_disallowed_uri_content()\n-    {\n-        $interpreter = new UploadedContentInterpreter();\n-\n-        static::assertEquals(\n-            ContentTypes::RAW,\n-            $interpreter->interpret(new RawContent('file://local/file'))\n-        );\n-\n-        static::assertEquals(\n-            ContentTypes::RAW,\n-            $interpreter->interpret(new RawContent('wss://somewhere:777'))\n-        );\n-\n-        static::assertEquals(\n-            ContentTypes::RAW,\n-            $interpreter->interpret(new RawContent('://without/protocol'))\n-        );\n-    }\n-\n \n     protected function getExampleDataUri(): string\n     {"
            },
            {
                "sha": "a3826d5da676cd9047eb962a06373a82d1350f28",
                "filename": "tests/Unit/Support/Download/UriValidatorTest.php",
                "status": "added",
                "additions": 70,
                "deletions": 0,
                "changes": 70,
                "blob_url": "https://github.com/czim/file-handling/blob/dcf879896efe3457f51af9c8eab9f70dfc709a99/tests%2FUnit%2FSupport%2FDownload%2FUriValidatorTest.php",
                "raw_url": "https://github.com/czim/file-handling/raw/dcf879896efe3457f51af9c8eab9f70dfc709a99/tests%2FUnit%2FSupport%2FDownload%2FUriValidatorTest.php",
                "contents_url": "https://api.github.com/repos/czim/file-handling/contents/tests%2FUnit%2FSupport%2FDownload%2FUriValidatorTest.php?ref=dcf879896efe3457f51af9c8eab9f70dfc709a99",
                "patch": "@@ -0,0 +1,70 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+namespace Unit\\Support\\Download;\n+\n+use Czim\\FileHandling\\Support\\Download\\UriValidator;\n+use Czim\\FileHandling\\Test\\TestCase;\n+\n+class UriValidatorTest extends TestCase\n+{\n+    /**\n+     * @test\n+     */\n+    public function it_considers_any_uri_invalid_by_default()\n+    {\n+        $validator = new UriValidator();\n+\n+        static::assertFalse($validator->isValid('file://../local.file'));\n+        static::assertFalse($validator->isValid('http://anything.test'));\n+        static::assertFalse($validator->isValid('https://anything.test'));\n+        static::assertFalse($validator->isValid('ftp://anything.test'));\n+    }\n+\n+    /**\n+     * @test\n+     */\n+    public function it_considers_any_remote_uri_valid_when_configured_to()\n+    {\n+        $validator = new UriValidator();\n+\n+        $validator->allowRemoteUri();\n+\n+        static::assertFalse($validator->isValid('file://../local.file'));\n+        static::assertTrue($validator->isValid('http://anything.test'));\n+        static::assertTrue($validator->isValid('https://anything.test'));\n+        static::assertTrue($validator->isValid('ftp://anything.test'));\n+    }\n+\n+    /**\n+     * @test\n+     */\n+    public function it_considers_local_uri_valid_when_configured_to()\n+    {\n+        $validator = new UriValidator();\n+\n+        $validator->allowLocalUri();\n+\n+        static::assertTrue($validator->isValid('file://../local.file'));\n+        static::assertFalse($validator->isValid('http://anything.test'));\n+        static::assertFalse($validator->isValid('https://anything.test'));\n+        static::assertFalse($validator->isValid('ftp://anything.test'));\n+    }\n+\n+    /**\n+     * @test\n+     */\n+    public function it_any_uri_valid_when_configured_to()\n+    {\n+        $validator = new UriValidator();\n+\n+        $validator->allowRemoteUri();\n+        $validator->allowLocalUri();\n+\n+        static::assertTrue($validator->isValid('file://../local.file'));\n+        static::assertTrue($validator->isValid('http://anything.test'));\n+        static::assertTrue($validator->isValid('https://anything.test'));\n+        static::assertTrue($validator->isValid('ftp://anything.test'));\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openshift/builder/commits/0b62633adfa2836465202bc851885e078ec888d1",
        "url": "https://api.github.com/repos/openshift/builder/commits/0b62633adfa2836465202bc851885e078ec888d1",
        "html_url": "https://github.com/openshift/builder/commit/0b62633adfa2836465202bc851885e078ec888d1",
        "message": "CVE-2024-7387: Prevent Build Inputs \"Zip-Slip\"\n\nBuildConfig-driven builds allow developers to specify additional\n`Secrets` and/or `ConfigMaps` whose file contents can be referenced\nduring the build. For `Docker` strategy builds, this is accoplished\nby copying the file contents of the `Secret` or `ConfigMap` directly\nto a path within the build's source code using the `cp` Linux command.\n\nPreviously, an attacker could maliciously craft their source code and\nbuild `Secrets` or `ConfigMaps` in such a way that they could overwrite\nthe `cp` command and execute arbitrary code. Due to the way build pods\nare constructed, these commands then run as root in a privileged\ncontainer, with full Linux capabilies and `unconfined` Seccomp policy.\nAn attacker can then escalate their privileges through multiple attack\nvectors - for example, by obtaining the credentials of the host node's\nkubelet.\n\nThis change blocks the primary attack vector by requiring the\nultimate destination of the referenced `Secret` or `ConfigMap` to be a\nchild directory of the source code root, thereby preventing the\noverwrite of the `cp` Linux command. This only applies to builds which\nuse the `Docker` strategy during execution. Builds which use the\n`Source` or `Custom` build strategy are not affected.\n\nThis patch also uses methods that may be considered out of date or\ndeprecated in golang 1.22 or later. This is done deliberately to allow\nclean cherrypicks to OpenShift 3.11 and other, older versions of\nOpenShift 4.x.\n\nSigned-off-by: Adam Kaplan <adam.kaplan@redhat.com>",
        "files": [
            {
                "sha": "5ce54aac01b2fbfe4c1d2c9407271168c9160e33",
                "filename": "pkg/build/builder/docker.go",
                "status": "modified",
                "additions": 21,
                "deletions": 2,
                "changes": 23,
                "blob_url": "https://github.com/openshift/builder/blob/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Fdocker.go",
                "raw_url": "https://github.com/openshift/builder/raw/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Fdocker.go",
                "contents_url": "https://api.github.com/repos/openshift/builder/contents/pkg%2Fbuild%2Fbuilder%2Fdocker.go?ref=0b62633adfa2836465202bc851885e078ec888d1",
                "patch": "@@ -238,14 +238,33 @@ func (d *DockerBuilder) copySecrets(secrets []buildapiv1.SecretBuildSource, targ\n }\n \n func (d *DockerBuilder) copyLocalObject(s localObjectBuildSource, sourceDir, targetDir string) error {\n+\tif !filepath.IsAbs(sourceDir) {\n+\t\treturn fmt.Errorf(\"cannot copy local object - source directory %q must be an absolute path\", sourceDir)\n+\n+\t}\n+\tif !filepath.IsAbs(targetDir) {\n+\t\treturn fmt.Errorf(\"cannot copy local object - target directory %q must be an absolute path\", targetDir)\n+\t}\n \tdstDir := filepath.Join(targetDir, s.DestinationPath())\n \tif err := os.MkdirAll(dstDir, 0777); err != nil {\n \t\treturn err\n \t}\n+\t// Evaluate symlinks at the destination dir. EvalSymlinks calls filepath.Clean, ensuring the\n+\t// returned path is an absolute path (we checked targetDir and thus dstDir is absolute above).\n+\tdstDir, err := filepath.EvalSymlinks(dstDir)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\t// sourceDir and targetDir should always be absolute paths, therefore HasPrefix can verify if\n+\t// dstDir is a subdirectory of targetDir.\n+\tif !strings.HasPrefix(dstDir, targetDir) {\n+\t\treturn fmt.Errorf(\"destination path %q is outside of the target directory %q\", dstDir, targetDir)\n+\t}\n+\n \tlog.V(3).Infof(\"Copying files from the build source %q to %q\", s.LocalObjectRef().Name, dstDir)\n \n-\t// Build sources contain nested directories and fairly baroque links. To prevent extra data being\n-\t// copied, perform the following steps:\n+\t// Build sources from Secrets or ConfigMaps contain nested directories and fairly baroque links.\n+\t// To prevent extra data being copied, perform the following steps:\n \t//\n \t// 1. Only top level files and directories within the secret directory are candidates\n \t// 2. Any item starting with '..' is ignored"
            },
            {
                "sha": "8046be241657490e63e34676335034a3d78a4d66",
                "filename": "pkg/build/builder/docker_test.go",
                "status": "modified",
                "additions": 213,
                "deletions": 0,
                "changes": 213,
                "blob_url": "https://github.com/openshift/builder/blob/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Fdocker_test.go",
                "raw_url": "https://github.com/openshift/builder/raw/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Fdocker_test.go",
                "contents_url": "https://api.github.com/repos/openshift/builder/contents/pkg%2Fbuild%2Fbuilder%2Fdocker_test.go?ref=0b62633adfa2836465202bc851885e078ec888d1",
                "patch": "@@ -4,6 +4,7 @@ import (\n \t\"bytes\"\n \t\"context\"\n \t\"fmt\"\n+\t\"io\"\n \t\"io/ioutil\"\n \t\"os\"\n \t\"path/filepath\"\n@@ -594,3 +595,215 @@ USER 1001`\n \t\t}\n \t}\n }\n+\n+// TestCopyLocalObject verifies that we are able to copy mounted Kubernetes Secret or ConfigMap\n+// data to the build directory. The build directory is typically where git source code is cloned,\n+// though other sources of code may be used as well.\n+func TestCopyLocalObject(t *testing.T) {\n+\t// Test scenario consists of a file tree that simulates the git clone environment\n+\t// /tmp/source-code-xxxx\n+\t// \u251c\u2500\u2500 git-data\n+\t// \u2502   \u251c\u2500\u2500 Dockerfile\n+\t// \u2502   \u2514\u2500\u2500 hello.txt\n+\t// \u2502   \u2514\u2500\u2500 linkSrc\n+\t// \u2502       \u2514\u2500\u2500 link -> ../linkDst\n+\t// |   \u2514\u2500\u2500 linkDst\n+\t// \u251c\u2500\u2500 secrets\n+\t// \u2502   \u2514\u2500\u2500 test\n+\t// \u2502       \u2514\u2500\u2500 secret.txt\n+\t// TODO: Update the structure of the `secrets` directory so it more closely matches what\n+\t// Kubernetes does when it mounts secrets/configmaps.\n+\tbuildDir, err := os.MkdirTemp(\"\", \"source-code\")\n+\tt.Logf(\"buildDir: %s\", buildDir)\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to create temp dir: %v\", err)\n+\t}\n+\tdefer func() {\n+\t\tif err := os.RemoveAll(buildDir); err != nil {\n+\t\t\tt.Fatalf(\"failed to clean up temp dir: %v\", err)\n+\t\t}\n+\t}()\n+\t// Set up secrets/test directory, with \"secret.txt\" file\n+\tsecretRoot := filepath.Join(buildDir, \"secrets\")\n+\ttestSecretFile := filepath.Join(secretRoot, \"test\", \"sourceSecret.txt\")\n+\terr = fsCopyFile(\"testdata/fakesecret/sourceSecret.txt\", testSecretFile)\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to copy secret data: %v\", err)\n+\t}\n+\tif _, err := os.Stat(testSecretFile); err != nil {\n+\t\tt.Fatalf(\"failed to stat %q: %v\", testSecretFile, err)\n+\t}\n+\t// Set up \"git-data\" directory as fake \"git source\"\n+\tgitRoot := filepath.Join(buildDir, \"git-data\")\n+\n+\terr = filepath.Walk(\"testdata/fakesource\", func(path string, info os.FileInfo, err error) error {\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t\tif info.IsDir() {\n+\t\t\treturn nil\n+\t\t}\n+\t\tdstBase := filepath.Base(path)\n+\t\treturn fsCopyFile(path, filepath.Join(gitRoot, dstBase))\n+\t})\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to copy test data: %v\", err)\n+\t}\n+\t// Git source may contain symlinks. This is OK as long as the symlink is relative and remains\n+\t// within the git source tree.\n+\tlinkSrc := filepath.Join(gitRoot, \"linkSrc\")\n+\terr = os.MkdirAll(linkSrc, os.ModePerm)\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to create test directory %q: %v\", linkSrc, err)\n+\t}\n+\tlinkDst := filepath.Join(gitRoot, \"linkDst\")\n+\terr = os.MkdirAll(linkDst, os.ModePerm)\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to create test directory %q: %v\", linkDst, err)\n+\t}\n+\t// Create symlink from linkSrc/link to linkDst (directory)\n+\terr = os.Symlink(\"../linkDst\", filepath.Join(linkSrc, \"link\"))\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to create symlink to linkDst directory: %v\", err)\n+\t}\n+\tdockerBuilder := &DockerBuilder{\n+\t\tinputDir: buildDir,\n+\t}\n+\tlocalObj := buildapiv1.SecretBuildSource{\n+\t\tSecret: corev1.LocalObjectReference{\n+\t\t\tName: \"test\",\n+\t\t},\n+\t\tDestinationDir: \"secrets\",\n+\t}\n+\terr = dockerBuilder.copyLocalObject(secretSource(localObj), secretRoot, gitRoot)\n+\tif err != nil {\n+\t\tt.Errorf(\"unexpected error copying local secret: %v\", err)\n+\t}\n+\t// sourceSecret.txt should be copied to git-data/secrets/sourceSecret.txt\n+\texpectedFile := filepath.Join(gitRoot, \"secrets\", \"sourceSecret.txt\")\n+\tif _, err := os.Stat(expectedFile); err != nil {\n+\t\tt.Errorf(\"failed to stat %q: %v\", expectedFile, err)\n+\t}\n+\t// Try again, this time copying to a destination that happens to be a symlink to another\n+\t// directory\n+\tlocalObj.DestinationDir = filepath.Join(\"linkSrc\", \"link\")\n+\terr = dockerBuilder.copyLocalObject(secretSource(localObj), secretRoot, gitRoot)\n+\tif err != nil {\n+\t\tt.Errorf(\"unexpected error copying local secret: %v\", err)\n+\t}\n+\t// sourceSecret.txt should be copied to git-data/linkSrc/link/sourceSecret.txt\n+\texpectedFile = filepath.Join(gitRoot, \"linkSrc\", \"link\", \"sourceSecret.txt\")\n+\tif _, err := os.Stat(expectedFile); err != nil {\n+\t\tt.Errorf(\"failed to stat %q: %v\", expectedFile, err)\n+\t}\n+\t// sourceSecret.txt should also show up in git-data/linkDst/sourceSecret.txt\n+\texpectedFile = filepath.Join(gitRoot, \"linkDst\", \"sourceSecret.txt\")\n+\tif _, err := os.Stat(expectedFile); err != nil {\n+\t\tt.Errorf(\"failed to stat %q: %v\", expectedFile, err)\n+\t}\n+\n+}\n+\n+// TestCopyLocalObjectZipSlip verifies that any copied Secret or ConfigMap is not able to be placed\n+// outside of the target directory. A well-crafted symbolic link can otherwise allow secret data\n+// to be placed in a location outside of our trusted target dirctory.\n+func TestCopyLocalObjectZipSlip(t *testing.T) {\n+\t// Test scenario consists of a file tree that simulates the git clone environment\n+\t// /tmp/source-code-xxxx\n+\t// \u251c\u2500\u2500 git-data\n+\t// \u2502   \u251c\u2500\u2500 Dockerfile\n+\t// \u2502   \u2514\u2500\u2500 hello.txt\n+\t// \u2502   \u2514\u2500\u2500 pwn-link -> /tmp/source-code-xxxx/pwned\n+\t// \u251c\u2500\u2500 secrets\n+\t// \u2502   \u2514\u2500\u2500 test\n+\t// \u2502       \u2514\u2500\u2500 pwned.txt\n+\t// \u2514\u2500\u2500 pwned\n+\t//\n+\t// If data ends up in the \"pwned\" directory, we have a \"zip-slip\" vulnerability.\n+\tbuildDir, err := os.MkdirTemp(\"\", \"source-code\")\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to create temp dir: %v\", err)\n+\t}\n+\tdefer func() {\n+\t\tif err := os.RemoveAll(buildDir); err != nil {\n+\t\t\tt.Fatalf(\"failed to clean up temp dir: %v\", err)\n+\t\t}\n+\t}()\n+\t// Set up secrets/test directory, with \"pwned.txt\" file\n+\tsecretRoot := filepath.Join(buildDir, \"secrets\")\n+\ttestPwnedFile := filepath.Join(secretRoot, \"test\", \"pwned.txt\")\n+\terr = fsCopyFile(\"testdata/fakesecret/pwned.txt\", testPwnedFile)\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to copy secret data: %v\", err)\n+\t}\n+\tif _, err := os.Stat(testPwnedFile); err != nil {\n+\t\tt.Fatalf(\"failed to stat pwned.txt: %v\", err)\n+\t}\n+\tpwnedPath := filepath.Join(buildDir, \"pwned\")\n+\terr = os.MkdirAll(pwnedPath, os.ModePerm)\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to create test directory %q: %v\", pwnedPath, err)\n+\t}\n+\t// Set up \"git-data\" directory as fake \"git source\"\n+\tgitRoot := filepath.Join(buildDir, \"git-data\")\n+\terr = filepath.Walk(\"testdata/fakesource\", func(path string, info os.FileInfo, err error) error {\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t\tif info.IsDir() {\n+\t\t\treturn nil\n+\t\t}\n+\t\tdstBase := filepath.Base(path)\n+\t\treturn fsCopyFile(path, filepath.Join(gitRoot, dstBase))\n+\t})\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to copy test data: %v\", err)\n+\t}\n+\t// Add symlink to \"pwned\" directory in the git root\n+\terr = os.Symlink(pwnedPath, filepath.Join(gitRoot, \"pwn-link\"))\n+\tif err != nil {\n+\t\tt.Fatalf(\"failed to create symlink to pwned directory: %v\", err)\n+\t}\n+\tdockerBuilder := &DockerBuilder{\n+\t\tinputDir: buildDir,\n+\t}\n+\tlocalObj := buildapiv1.SecretBuildSource{\n+\t\tSecret: corev1.LocalObjectReference{\n+\t\t\tName: \"test\",\n+\t\t},\n+\t\tDestinationDir: \"pwn-link\",\n+\t}\n+\terr = dockerBuilder.copyLocalObject(secretSource(localObj), secretRoot, gitRoot)\n+\tif err == nil {\n+\t\tt.Error(\"expected copyLocalObject to fail if the secret tries to write its contents outside the destination directory\")\n+\t}\n+\tif err != nil && !strings.Contains(err.Error(), \"outside of the target directory\") {\n+\t\tt.Errorf(\"expected error message to contain %q, got: %v\", \"outside of the target directory\", err)\n+\t}\n+\t// Can we stat the pwned.txt file?\n+\tbadPwnedFile := filepath.Join(pwnedPath, \"pwned.txt\")\n+\tif _, err := os.Stat(badPwnedFile); err == nil {\n+\t\tt.Errorf(\"secret file %q was copied outside of the trusted build directory to %q\", testPwnedFile, badPwnedFile)\n+\t}\n+}\n+\n+func fsCopyFile(srcPath, dstPath string) error {\n+\tsrcFile, err := os.Open(srcPath)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tdefer srcFile.Close()\n+\tparentDir := filepath.Dir(dstPath)\n+\tif err := os.MkdirAll(parentDir, os.ModePerm); err != nil {\n+\t\treturn err\n+\t}\n+\tdstFile, err := os.Create(dstPath)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tdefer dstFile.Close()\n+\tif _, err := io.Copy(dstFile, srcFile); err != nil {\n+\t\treturn err\n+\t}\n+\treturn nil\n+}"
            },
            {
                "sha": "5df7b629fd38b22c78de909333bbcdacc8a67d59",
                "filename": "pkg/build/builder/testdata/fakesecret/pwned.txt",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/openshift/builder/blob/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesecret%2Fpwned.txt",
                "raw_url": "https://github.com/openshift/builder/raw/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesecret%2Fpwned.txt",
                "contents_url": "https://api.github.com/repos/openshift/builder/contents/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesecret%2Fpwned.txt?ref=0b62633adfa2836465202bc851885e078ec888d1",
                "patch": "@@ -0,0 +1 @@\n+Womp womp - you've been pwned!"
            },
            {
                "sha": "2fc07e73dd673c10361814b1a27bdfef1cff5b3a",
                "filename": "pkg/build/builder/testdata/fakesecret/sourceSecret.txt",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/openshift/builder/blob/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesecret%2FsourceSecret.txt",
                "raw_url": "https://github.com/openshift/builder/raw/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesecret%2FsourceSecret.txt",
                "contents_url": "https://api.github.com/repos/openshift/builder/contents/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesecret%2FsourceSecret.txt?ref=0b62633adfa2836465202bc851885e078ec888d1",
                "patch": "@@ -0,0 +1,2 @@\n+Top secret data!\n+This should be copied into the same directory as the source code."
            },
            {
                "sha": "6f06e5f09b1c8a41e66a56ac4602893541422f3e",
                "filename": "pkg/build/builder/testdata/fakesource/Dockerfile",
                "status": "added",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/openshift/builder/blob/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesource%2FDockerfile",
                "raw_url": "https://github.com/openshift/builder/raw/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesource%2FDockerfile",
                "contents_url": "https://api.github.com/repos/openshift/builder/contents/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesource%2FDockerfile?ref=0b62633adfa2836465202bc851885e078ec888d1",
                "patch": "@@ -0,0 +1,7 @@\n+FROM registry.access.redhat.com/ubi9/ubi-minimal:latest\n+\n+WORKDIR /opt/app-root/src\n+\n+COPY hello.txt hello.txt\n+\n+CMD [\"cat\", \"hello.txt\"]"
            },
            {
                "sha": "bac9d621284bee61c74dadf3a76fb3852319109f",
                "filename": "pkg/build/builder/testdata/fakesource/hello.txt",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/openshift/builder/blob/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesource%2Fhello.txt",
                "raw_url": "https://github.com/openshift/builder/raw/0b62633adfa2836465202bc851885e078ec888d1/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesource%2Fhello.txt",
                "contents_url": "https://api.github.com/repos/openshift/builder/contents/pkg%2Fbuild%2Fbuilder%2Ftestdata%2Ffakesource%2Fhello.txt?ref=0b62633adfa2836465202bc851885e078ec888d1",
                "patch": "@@ -0,0 +1 @@\n+Hello OpenShift!"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/the-djmaze/snappymail/commits/cfbc47488a6b2e2ae4be484f501ee1a3485f542e",
        "url": "https://api.github.com/repos/the-djmaze/snappymail/commits/cfbc47488a6b2e2ae4be484f501ee1a3485f542e",
        "html_url": "https://github.com/the-djmaze/snappymail/commit/cfbc47488a6b2e2ae4be484f501ee1a3485f542e",
        "message": "cleanHtml use allowedTags instead of disallowedTags and improved CSS handling",
        "files": [
            {
                "sha": "0b55792e0cabc1b62b0a9795711156e420d65bcd",
                "filename": "dev/Common/Html.js",
                "status": "modified",
                "additions": 60,
                "deletions": 25,
                "changes": 85,
                "blob_url": "https://github.com/the-djmaze/snappymail/blob/cfbc47488a6b2e2ae4be484f501ee1a3485f542e/dev%2FCommon%2FHtml.js",
                "raw_url": "https://github.com/the-djmaze/snappymail/raw/cfbc47488a6b2e2ae4be484f501ee1a3485f542e/dev%2FCommon%2FHtml.js",
                "contents_url": "https://api.github.com/repos/the-djmaze/snappymail/contents/dev%2FCommon%2FHtml.js?ref=cfbc47488a6b2e2ae4be484f501ee1a3485f542e",
                "patch": "@@ -17,14 +17,34 @@ const\n \t\t\"'\": '&#x27;'\n \t},\n \n-\tdisallowedTags = [\n-\t\t'svg','script','title','link','base','meta',\n-\t\t'input','output','select','button','textarea',\n-\t\t'bgsound','keygen','source','object','embed','applet','iframe','frame','frameset','video','audio','area','map'\n-\t\t// not supported by <template> element\n-//\t\t,'html','head','body'\n+\tkeepTagContent = 'form,button,data', // font\n+\n+\tallowedTags = [\n+\t\t// Structural Elements:\n+\t\t'blockquote','br','div','figcaption','figure','h1','h2','h3','h4','h5','h6','hgroup','hr','p','wbr',\n+\t\t'article','aside','header','footer','main','section',\n+\t\t'details','summary',\n+\t\t// List Elements\n+\t\t'dd','dl','dt','li','ol','ul',\n+\t\t// Text Formatting Elements\n+\t\t'a','abbr','address','b','bdi','bdo','cite','code','del','dfn',\n+\t\t'em','i','ins','kbd','mark','pre','q','rp','rt','ruby','s','samp','small',\n+\t\t'span','strong','sub','sup','time','u','var',\n+\t\t// Deprecated by HTML Standard\n+\t\t'acronym','big','center','dir','font','marquee',\n+\t\t'nobr','noembed','noframes','plaintext','rb','rtc','strike','tt',\n+\t\t// Media Elements\n+\t\t'img',//'picture','source',\n+\t\t// Table Elements\n+\t\t'caption','col','colgroup','table','tbody','td','tfoot','th','thead','tr',\n+\t\t// Disallowed but converted later\n+\t\t'style','xmp'\n \t].join(','),\n \n+\tnonEmptyTags = [\n+\t\t'A','B','EM','I','SPAN','STRONG'\n+\t],\n+\n \tblockquoteSwitcher = () => {\n \t\tSettingsUserStore.collapseBlockquotes() &&\n //\t\ttmpl.content.querySelectorAll('blockquote').forEach(node => {\n@@ -102,8 +122,10 @@ const\n \t},\n \n \tcleanCSS = source =>\n-\t\tsource.trim().replace(/(^|;)\\s*-(ms|webkit)-[^;]+(;|$)/g, '')\n-\t\t\t.replace(/white-space[^;]+(;|$)/g, '')\n+\t\tsource.trim()\n+\t\t\t.replace(/;\\s*-[^;]+/g, '')\n+\t\t\t.replace(/^\\s*-[^;]+(;|$)/g, '')\n+\t\t\t.replace(/white-space[^;]+/g, '')\n \t\t\t// Drop Microsoft Office style properties\n //\t\t\t.replace(/mso-[^:;]+:[^;]+/gi, '')\n \t,\n@@ -145,14 +167,14 @@ const\n \t\tif (source) {\n \t\t\tsource = source\n \t\t\t\t// strip comments\n-\t\t\t\t.replace(/\\/\\*[\\s\\S]*?\\*\\/|<!--|-->/gi, '')\n-\t\t\t\t// strip import statements\n-\t\t\t\t.replace(/@import .*?;/gi , '')\n-\t\t\t\t// strip keyframe statements\n-\t\t\t\t.replace(/((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})/gi, '');\n+\t\t\t\t.replace(/\\/\\*[\\s\\S]*?\\*\\//gi, '')\n+\t\t\t\t// strip MS Word comments\n+\t\t\t\t.replace(/<!--[\\s\\S]*?-->/gi, '');\n+\t\t\t\t// strip HTML\n+//\t\t\t\t.replace(/<\\/?[a-z][\\s\\S]*?>/gi, '');\n \n \t\t\t// unified regex to match css & media queries together\n-\t\t\tlet unified = /((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})/gi,\n+\t\t\tlet unified = /(?:(\\s*?@(?:media)[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(?:([\\s\\S]*?){([\\s\\S]*?)})/gi,\n \t\t\t\tarr;\n \n \t\t\twhile (true) {\n@@ -161,7 +183,7 @@ const\n \t\t\t\t\tbreak;\n \t\t\t\t}\n \n-\t\t\t\tlet selector = arr[arr[2] === undefined ? 5 : 2].split('\\r\\n').join('\\n').trim()\n+\t\t\t\tlet selector = arr[arr[2] === undefined ? 3 : 1].split('\\r\\n').join('\\n').trim()\n \t\t\t\t\t// Never have more than a single line break in a row\n \t\t\t\t\t.replace(/\\n+/, \"\\n\")\n \t\t\t\t\t// Remove :root and html\n@@ -173,13 +195,14 @@ const\n \t\t\t\t\tcss.push({\n \t\t\t\t\t\tselector: selector,\n \t\t\t\t\t\ttype: 'media',\n-\t\t\t\t\t\tsubStyles: parseCSS(arr[3] + '\\n}') //recursively parse media query inner css\n+\t\t\t\t\t\tsubStyles: parseCSS(arr[2] + '\\n}') //recursively parse media query inner css\n \t\t\t\t\t});\n \t\t\t\t} else if (selector && !selector.includes('@')) {\n \t\t\t\t\t// we have standard css\n+\t\t\t\t\t// ignores @import, @keyframe, @font-face statements\n \t\t\t\t\tcss.push({\n \t\t\t\t\t\tselector: selector,\n-\t\t\t\t\t\trules: cleanCSS(arr[6])\n+\t\t\t\t\t\trules: cleanCSS(arr[4])\n \t\t\t\t\t});\n \t\t\t\t}\n \t\t\t}\n@@ -258,9 +281,6 @@ export const\n \t\t\t\t'abbr', 'scope',\n \t\t\t\t// td\n \t\t\t\t'colspan', 'rowspan', 'headers'\n-\t\t\t],\n-\t\t\tnonEmptyTags = [\n-\t\t\t\t'A','B','EM','I','SPAN','STRONG'\n \t\t\t];\n \n \t\tif (SettingsUserStore.allowStyles()) {\n@@ -307,13 +327,21 @@ export const\n \t\t\t}\n \t\t});\n \n+\t\t// https://github.com/the-djmaze/snappymail/issues/1125\n+\t\ttmpl.content.querySelectorAll(keepTagContent).forEach(oElement => replaceWithChildren(oElement));\n+\n \t\ttmpl.content.querySelectorAll(\n-\t\t\tdisallowedTags\n+\t\t\t':not('+allowedTags+')'\n \t\t\t+ (0 < bqLevel ? ',' + (new Array(1 + bqLevel).fill('blockquote').join(' ')) : '')\n \t\t).forEach(oElement => oElement.remove());\n-\n-\t\t// https://github.com/the-djmaze/snappymail/issues/1125\n-\t\ttmpl.content.querySelectorAll('form,button').forEach(oElement => replaceWithChildren(oElement));\n+/*\t\t// Is this slower or faster?\n+\t\t).forEach(oElement => {\n+\t\t\tif (!node || !node.contains(oElement)) {\n+\t\t\t\toElement.remove();\n+\t\t\t\tnode = oElement;\n+\t\t\t}\n+\t\t});\n+*/\n \n \t\t// https://github.com/the-djmaze/snappymail/issues/1641\n \t\tlet body = tmpl.content.querySelector('.mail-body');\n@@ -346,6 +374,13 @@ export const\n \t\t\t\treturn;\n \t\t\t}\n \n+\t\t\tif ('XMP' === name) {\n+\t\t\t\tconst pre = createElement('pre');\n+\t\t\t\tpre.innerHTML = encodeHtml(oElement.innerHTML);\n+\t\t\t\toElement.replaceWith(pre);\n+\t\t\t\treturn;\n+\t\t\t}\n+\n \t\t\t// \\MailSo\\Base\\HtmlUtils::ClearTags()\n \t\t\tif ('none' == oStyle.display\n \t\t\t || 'hidden' == oStyle.visibility\n@@ -432,7 +467,7 @@ export const\n \t\t\t}\n \n //\t\t\tif (['CENTER','FORM'].includes(name)) {\n-\t\t\tif ('O:P' === name || (nonEmptyTags.includes(name) && ('' == oElement.textContent.trim()))) {\n+\t\t\tif (nonEmptyTags.includes(name) && ('' == oElement.textContent.trim())) {\n \t\t\t\t('A' !== name || !oElement.querySelector('IMG')) && replaceWithChildren(oElement);\n \t\t\t\treturn;\n \t\t\t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/decidim/decidim/commits/47adca81cabea898005ec07b130b008f2a2be99f",
        "url": "https://api.github.com/repos/decidim/decidim/commits/47adca81cabea898005ec07b130b008f2a2be99f",
        "html_url": "https://github.com/decidim/decidim/commit/47adca81cabea898005ec07b130b008f2a2be99f",
        "message": "Prevents showing a malformed value in WYSIWYG editor (#12925)\n\n* Prevents showing a malformed value in WYSIWYG editor\r\n\r\n* Add spec\r\n\r\n* Fix spec",
        "files": [
            {
                "sha": "1789c1b755ff469f329b0c504b381e58b1bda042",
                "filename": "decidim-admin/spec/system/admin_manages_organization_spec.rb",
                "status": "modified",
                "additions": 26,
                "deletions": 1,
                "changes": 27,
                "blob_url": "https://github.com/decidim/decidim/blob/47adca81cabea898005ec07b130b008f2a2be99f/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/47adca81cabea898005ec07b130b008f2a2be99f/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_spec.rb?ref=47adca81cabea898005ec07b130b008f2a2be99f",
                "patch": "@@ -221,7 +221,7 @@\n           expect(page).to have_content(\"Organization updated successfully\")\n           expect(find(\n             \"#organization-admin_terms_of_use_body-tabs-admin_terms_of_use_body-panel-0 .editor .ql-editor\"\n-          )[\"innerHTML\"]).to eq(\"<p>bar baz</p>\")\n+          )[\"innerHTML\"]).to eq(\"<p>bar baz</p><p><br></p>\")\n         end\n       end\n \n@@ -468,6 +468,31 @@\n           )\n         end\n       end\n+\n+      context \"when adding malformed content\" do\n+        let(:organization) { create(:organization, admin_terms_of_use_body: {}) }\n+\n+        it \"does not saves it\" do\n+          WebMock.stub_request(:get, \"http://example.org/x\").to_return(status: 404)\n+\n+          accept_alert do\n+            page.execute_script(\n+              <<~JS\n+                var element = document.querySelector(\"#organization-admin_terms_of_use_body-tabs-admin_terms_of_use_body-panel-0 div[contenteditable='true'].ql-editor\");\n+                element.innerHTML = \"testing <img src='http://example.org/x' onerror=alert(1) >\";\n+              JS\n+            )\n+          end\n+\n+          click_button \"Update\"\n+\n+          sleep 1\n+\n+          expect(find(\n+            \"#organization-admin_terms_of_use_body-tabs-admin_terms_of_use_body-panel-0 .editor .ql-editor\"\n+          )[\"innerHTML\"]).to eq(\"<p>testing</p><p><img src=\\\"http://example.org/x\\\"></p>\")\n+        end\n+      end\n     end\n   end\n "
            },
            {
                "sha": "312ed678fed746b5972791b813844a679b656391",
                "filename": "decidim-core/lib/decidim/form_builder.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 1,
                "changes": 14,
                "blob_url": "https://github.com/decidim/decidim/blob/47adca81cabea898005ec07b130b008f2a2be99f/decidim-core%2Flib%2Fdecidim%2Fform_builder.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/47adca81cabea898005ec07b130b008f2a2be99f/decidim-core%2Flib%2Fdecidim%2Fform_builder.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Flib%2Fdecidim%2Fform_builder.rb?ref=47adca81cabea898005ec07b130b008f2a2be99f",
                "patch": "@@ -1,6 +1,7 @@\n # frozen_string_literal: true\n \n require \"foundation_rails_helper/form_builder\"\n+require_relative \"../../app/helpers/decidim/sanitize_helper\"\n \n module Decidim\n   # This custom FormBuilder adds fields needed to deal with translatable fields,\n@@ -9,6 +10,7 @@ class FormBuilder < FoundationRailsHelper::FormBuilder\n     include ActionView::Context\n     include Decidim::TranslatableAttributes\n     include Decidim::Map::Autocomplete::FormBuilder\n+    include Decidim::SanitizeHelper\n \n     # Public: generates a check boxes input from a collection and adds help\n     # text and errors.\n@@ -192,11 +194,12 @@ def editor(name, options = {})\n       options.delete(:required)\n       hashtaggable = options.delete(:hashtaggable)\n       hidden_options = extract_validations(name, options).merge(options)\n+      sanitized_value = sanitize_editor_value(object.send(name))\n \n       content_tag(:div, class: \"editor #{\"hashtags__container\" if hashtaggable}\") do\n         template = \"\"\n         template += label(name, label_text + required_for_attribute(name)) if options.fetch(:label, true)\n-        template += hidden_field(name, hidden_options)\n+        template += hidden_field(name, hidden_options.merge(value: sanitized_value))\n         template += content_tag(:div, nil, class: \"editor-container #{\"js-hashtags\" if hashtaggable}\", data: {\n                                   toolbar: toolbar,\n                                   disabled: options[:disabled],\n@@ -941,5 +944,14 @@ def resource_class(attribute)\n \n       object.class\n     end\n+\n+    # Private: Sanitize editor values to prevent malformed values being display in the\n+    # WYSIWYG editor\n+    #\n+    def sanitize_editor_value(value)\n+      sanitized_value = decidim_sanitize_editor_admin(value)\n+\n+      sanitized_value == %(<div class=\"ql-editor-display\"></div>) ? \"\" : sanitized_value\n+    end\n   end\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/decidim/decidim/commits/ff755e23814aeb56e9089fc08006a5d3faee47b6",
        "url": "https://api.github.com/repos/decidim/decidim/commits/ff755e23814aeb56e9089fc08006a5d3faee47b6",
        "html_url": "https://github.com/decidim/decidim/commit/ff755e23814aeb56e9089fc08006a5d3faee47b6",
        "message": "Backport 'Refactor malformed titles in admin logs (part 1)' to v0.27 (#13084)\n\n* Refactor malformed titles in admin logs (part 1)\r\n\r\n* Fix admin logs\r\n\r\n* Properly escape log entries\r\n\r\n* Add debates Presenter\r\n\r\n* Remove AdminLog::DebatePresenter\r\n\r\n* Fix presenter usage\r\n\r\n* More cleanup\r\n\r\n* Running linters\r\n\r\n* Fix specs\r\n\r\n* Running linters\r\n\r\n* Add admin log entries\r\n\r\n* Add admin logs specs\r\n\r\n* Fix specs\r\n\r\n* Proposals and sortitions\r\n\r\n* Fix pipeline\r\n\r\n* Fix pipeline\r\n\r\n* Add participatory process pages\r\n\r\n* More logs\r\n\r\n* Refactor\r\n\r\n* lint\r\n\r\n* Refactor\r\n\r\n* Finalize the assembly types\r\n\r\n* more refactor\r\n\r\n* Fix blogs\r\n\r\n* fix decidim-conferences\r\n\r\n* Reformat the code\r\n\r\n* update specs\r\n\r\n* Refactor\r\n\r\n* Running rubocops\r\n\r\n* Fix meetings specs\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Apply review recommendation\r\n\r\n* Fix spec\r\n\r\n* Fix specs\r\n\r\n* Fix blogs specs\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Lint\r\n\r\n---------\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Fix syntax errors in PR\r\n\r\n* fix specs\r\n\r\n* Fix more specs\r\n\r\n* Running linters\r\n\r\n* Fix specs\r\n\r\n* Even more specs\r\n\r\n* Fix specs\r\n\r\n---------\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>",
        "files": [
            {
                "sha": "8f00c194ca403364a531a2ebb42daec6b3d8bd34",
                "filename": "decidim-accountability/spec/shared/manage_results_examples.rb",
                "status": "modified",
                "additions": 14,
                "deletions": 23,
                "changes": 37,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-accountability%2Fspec%2Fshared%2Fmanage_results_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-accountability%2Fspec%2Fshared%2Fmanage_results_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-accountability%2Fspec%2Fshared%2Fmanage_results_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -29,20 +29,15 @@\n   context \"when having existing proposals\" do\n     let!(:proposal_component) { create(:proposal_component, participatory_space: participatory_space) }\n     let!(:proposals) { create_list :proposal, 5, component: proposal_component, skip_injection: true }\n+    let(:attributes) { attributes_for(:result, component: current_component) }\n \n     it \"updates a result\" do\n       within find(\"tr\", text: translated(result.title)) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_result\" do\n-        fill_in_i18n(\n-          :result_title,\n-          \"#result-title-tabs\",\n-          en: \"My new title\",\n-          es: \"Mi nuevo t\u00edtulo\",\n-          ca: \"El meu nou t\u00edtol\"\n-        )\n+        fill_in_i18n(:result_title, \"#result-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n         proposals_pick(select_data_picker(:result_proposals, multiple: true), proposals.last(2))\n \n@@ -52,28 +47,20 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My new title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated result\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n \n     it \"creates a new result\", :slow do\n       click_link \"New Result\", match: :first\n \n       within \".new_result\" do\n-        fill_in_i18n(\n-          :result_title,\n-          \"#result-title-tabs\",\n-          en: \"My result\",\n-          es: \"Mi result\",\n-          ca: \"El meu result\"\n-        )\n-        fill_in_i18n_editor(\n-          :result_description,\n-          \"#result-description-tabs\",\n-          en: \"A longer description\",\n-          es: \"Descripci\u00f3n m\u00e1s larga\",\n-          ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-        )\n+        fill_in_i18n(:result_title, \"#result-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:result_description, \"#result-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n         proposals_pick(select_data_picker(:result_proposals, multiple: true), proposals.first(2))\n         scope_pick(select_data_picker(:result_decidim_scope_id), scope)\n@@ -85,8 +72,12 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My result\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created result\")\n+      expect(page).to have_content(attributes[:title][\"en\"])\n     end\n   end\n "
            },
            {
                "sha": "587809e79d9cc22191a8a41699829b5adb140cfe",
                "filename": "decidim-accountability/spec/shared/manage_statuses_examples.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 20,
                "changes": 33,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-accountability%2Fspec%2Fshared%2Fmanage_statuses_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-accountability%2Fspec%2Fshared%2Fmanage_statuses_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-accountability%2Fspec%2Fshared%2Fmanage_statuses_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -1,6 +1,8 @@\n # frozen_string_literal: true\n \n RSpec.shared_examples \"manage statuses\" do\n+  let(:attributes) { attributes_for(:status) }\n+\n   it \"updates a status\" do\n     within find(\"tr\", text: status.key) do\n       click_link \"Edit\"\n@@ -10,9 +12,7 @@\n       fill_in_i18n(\n         :status_name,\n         \"#status-name-tabs\",\n-        en: \"My new name\",\n-        es: \"Mi nuevo nombre\",\n-        ca: \"El meu nou nom\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -21,8 +21,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My new name\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:name])} status\")\n   end\n \n   it \"creates a new status\" do\n@@ -31,21 +34,8 @@\n     within \".new_status\" do\n       fill_in :status_key, with: \"status_key_1\"\n \n-      fill_in_i18n(\n-        :status_name,\n-        \"#status-name-tabs\",\n-        en: \"A longer name\",\n-        es: \"Nombre m\u00e1s larga\",\n-        ca: \"Nom m\u00e9s llarga\"\n-      )\n-\n-      fill_in_i18n(\n-        :status_description,\n-        \"#status-description-tabs\",\n-        en: \"A longer description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:status_name, \"#status-name-tabs\", **attributes[:name].except(\"machine_translations\"))\n+      fill_in_i18n(:status_description, \"#status-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n       fill_in :status_progress, with: 75\n \n@@ -56,8 +46,11 @@\n \n     within \"table\" do\n       expect(page).to have_content(\"status_key_1\")\n-      expect(page).to have_content(\"A longer name\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:name])} status\")\n   end\n \n   describe \"deleting a result\" do"
            },
            {
                "sha": "b99739f1ebac558059da11ac0b0a64b5df1b136e",
                "filename": "decidim-accountability/spec/shared/manage_timeline_examples.rb",
                "status": "added",
                "additions": 48,
                "deletions": 0,
                "changes": 48,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-accountability%2Fspec%2Fshared%2Fmanage_timeline_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-accountability%2Fspec%2Fshared%2Fmanage_timeline_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-accountability%2Fspec%2Fshared%2Fmanage_timeline_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -0,0 +1,48 @@\n+# frozen_string_literal: true\n+\n+RSpec.shared_examples \"manage timeline\" do\n+  let(:attributes) { attributes_for(:timeline_entry, result: result) }\n+\n+  it \"updates a timeline entry\", versioning: true do\n+    visit current_path\n+    click_on \"Edit\", match: :first\n+\n+    within \".edit_timeline_entry\" do\n+      fill_in :timeline_entry_entry_date, with: Date.current.strftime(\"%d/%m/%Y\")\n+      fill_in_i18n(:timeline_entry_title, \"#timeline_entry-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:timeline_entry_description, \"#timeline_entry-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n+      find(\"*[type=submit]\").click\n+    end\n+\n+    expect(page).to have_admin_callout(\"successfully\")\n+\n+    within \"table\" do\n+      expect(page).to have_content(translated(attributes[:title]))\n+    end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:title])} timeline entry\")\n+  end\n+\n+  it \"creates a timeline entry\", versioning: true do\n+    click_on \"New Timeline entry\", match: :first\n+\n+    within \".new_timeline_entry\" do\n+      fill_in :timeline_entry_entry_date, with: Date.current.strftime(\"%d/%m/%Y\")\n+      fill_in_i18n(:timeline_entry_title, \"#timeline_entry-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:timeline_entry_description, \"#timeline_entry-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n+      find(\"*[type=submit]\").click\n+    end\n+\n+    expect(page).to have_admin_callout(\"successfully\")\n+\n+    within \"table\" do\n+      expect(page).to have_content(translated(attributes[:title]))\n+    end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} timeline entry\")\n+  end\n+end"
            },
            {
                "sha": "cbc092a2b658e9f6e5a09fb5f37de6db391b4ed0",
                "filename": "decidim-accountability/spec/system/admin/admin_manages_accountability_spec.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-accountability%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_accountability_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-accountability%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_accountability_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-accountability%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_accountability_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -34,4 +34,17 @@\n \n     it_behaves_like \"manage statuses\"\n   end\n+\n+  describe \"timeline\" do\n+    before do\n+      visit_component_admin\n+      within \"tr\", text: translated(result.title) do\n+        click_on \"Project evolution\"\n+      end\n+    end\n+\n+    let!(:timeline_entry) { create(:timeline_entry, result: result) }\n+\n+    it_behaves_like \"manage timeline\"\n+  end\n end"
            },
            {
                "sha": "dc5758d8ebbfb08588cd8ea5997a38fc1b8d458c",
                "filename": "decidim-admin/lib/decidim/admin/test/manage_attachment_collections_examples.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachment_collections_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachment_collections_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachment_collections_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -18,9 +18,9 @@\n       click_link translated(attachment_collection.name, locale: :en)\n     end\n \n-    expect(page).to have_selector(\"input#attachment_collection_name_en[value='#{translated(attachment_collection.name, locale: :en)}']\")\n-    expect(page).to have_selector(\"input#attachment_collection_weight[value='#{attachment_collection.weight}']\")\n-    expect(page).to have_selector(\"input#attachment_collection_description_en[value='#{translated(attachment_collection.description, locale: :en)}']\")\n+    expect(page).to have_selector(%(input#attachment_collection_name_en[value=\"#{translated(attachment_collection.name, locale: :en)}\"]))\n+    expect(page).to have_selector(%(input#attachment_collection_weight[value=\"#{attachment_collection.weight}\"]))\n+    expect(page).to have_selector(%(input#attachment_collection_description_en[value=\"#{translated(attachment_collection.description, locale: :en)}\"]))\n   end\n \n   it \"can add attachment collections to a process\" do"
            },
            {
                "sha": "68c4f020fe61c798f9464852982d00d1c726ff37",
                "filename": "decidim-admin/lib/decidim/admin/test/manage_attachments_examples.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachments_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachments_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachments_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -22,9 +22,9 @@\n         click_link translated(attachment.title, locale: :en)\n       end\n \n-      expect(page).to have_selector(\"input#attachment_title_en[value='#{translated(attachment.title, locale: :en)}']\")\n-      expect(page).to have_selector(\"input#attachment_description_en[value='#{translated(attachment.description, locale: :en)}']\")\n-      expect(page).to have_selector(\"input#attachment_weight[value='#{attachment.weight}']\")\n+      expect(page).to have_selector(%(input#attachment_title_en[value=\"#{translated(attachment.title, locale: :en)}\"]))\n+      expect(page).to have_selector(%(input#attachment_description_en[value=\"#{translated(attachment.description, locale: :en)}\"]))\n+      expect(page).to have_selector(%(input#attachment_weight[value=\"#{attachment.weight}\"]))\n       expect(page).to have_select(\"attachment_attachment_collection_id\", selected: translated(attachment_collection.name, locale: :en))\n       expect(page).to have_css(\"img[src~='#{attachment.url}']\")\n     end"
            },
            {
                "sha": "10b5d9495eee08c778b7679524267e04865b7d0a",
                "filename": "decidim-admin/lib/decidim/admin/test/manage_categories_examples.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_categories_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_categories_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_categories_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -12,7 +12,7 @@\n       click_link translated(category.name, locale: :en)\n     end\n \n-    expect(page).to have_selector(\"input#category_name_en[value='#{translated(category.name, locale: :en)}']\")\n+    expect(page).to have_selector(%(input#category_name_en[value=\"#{translated(category.name, locale: :en)}\"]))\n     expect(page).to have_selector(\"input#category_weight[value='#{category.weight}']\")\n \n     expect(page).to have_selector(\"select#category_parent_id\")"
            },
            {
                "sha": "e7d03d01542902f8b370947e3ed4d2996c8a956d",
                "filename": "decidim-assemblies/spec/shared/manage_assemblies_examples.rb",
                "status": "modified",
                "additions": 25,
                "deletions": 12,
                "changes": 37,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assemblies_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assemblies_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assemblies_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -6,40 +6,53 @@\n     let(:image3_path) { Decidim::Dev.asset(image3_filename) }\n \n     let(:assembly_parent_id_options) { page.find(\"#assembly_parent_id\").find_all(\"option\").map(&:value) }\n+    let(:attributes) { attributes_for(:assembly, organization: organization) }\n \n     before do\n       click_link translated(assembly.title)\n     end\n \n     it \"updates an assembly\" do\n-      fill_in_i18n(\n-        :assembly_title,\n-        \"#assembly-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+      fill_in_i18n(:assembly_title, \"#assembly-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n       dynamically_attach_file(:assembly_banner_image, image3_path, remove_before: true)\n \n       within \".edit_assembly\" do\n         expect(assembly_parent_id_options).not_to include(assembly.id)\n-        fill_in \"assembly[creation_date]\", with: Date.yesterday\n-        fill_in \"assembly[included_at]\", with: Date.current\n-        fill_in \"assembly[duration]\", with: Date.tomorrow\n-        fill_in \"assembly[closing_date]\", with: Date.tomorrow\n+        fill_in_i18n(:assembly_subtitle, \"#assembly-subtitle-tabs\", **attributes[:subtitle].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_short_description, \"#assembly-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_description, \"#assembly-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_purpose_of_action, \"#assembly-purpose_of_action-tabs\", **attributes[:purpose_of_action].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_composition, \"#assembly-composition-tabs\", **attributes[:composition].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_internal_organisation, \"#assembly-internal_organisation-tabs\", **attributes[:internal_organisation].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_announcement, \"#assembly-announcement-tabs\", **attributes[:announcement].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_closing_date_reason, \"#assembly-closing_date_reason-tabs\", **attributes[:closing_date_reason].except(\"machine_translations\"))\n+\n+        fill_in_i18n(:assembly_participatory_scope, \"#assembly-participatory_scope-tabs\", **attributes[:participatory_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_participatory_structure, \"#assembly-participatory_structure-tabs\", **attributes[:participatory_structure].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_meta_scope, \"#assembly-meta_scope-tabs\", **attributes[:meta_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_local_area, \"#assembly-local_area-tabs\", **attributes[:local_area].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_target, \"#assembly-target-tabs\", **attributes[:target].except(\"machine_translations\"))\n+\n+        fill_in :assembly_creation_date, with: Date.yesterday.strftime(\"%d/%m/%Y\"), fill_options: { clear: :backspace }\n+        fill_in :assembly_included_at, with: Date.current.strftime(\"%d/%m/%Y\"), fill_options: { clear: :backspace }\n+        fill_in :assembly_duration, with: Date.tomorrow.strftime(\"%d/%m/%Y\"), fill_options: { clear: :backspace }\n+        fill_in :assembly_closing_date, with: Date.tomorrow.strftime(\"%d/%m/%Y\"), fill_options: { clear: :backspace }\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \".container\" do\n-        expect(page).to have_selector(\"input[value='My new title']\")\n+        expect(page).to have_selector(%(input[value=\"#{translated(attributes[:title])}\"]))\n         expect(page).to have_css(\"img[src*='#{image3_filename}']\")\n         expect(page).to have_css(\"input[value='#{Date.yesterday}']\")\n         expect(page).to have_css(\"input[value='#{Date.current}']\")\n         expect(page).to have_css(\"input[value='#{Date.tomorrow}']\", count: 2)\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} assembly\")\n     end\n   end\n "
            },
            {
                "sha": "a2cfe44af76273f266755b03b58b9bc8ec668a6b",
                "filename": "decidim-assemblies/spec/shared/manage_assembly_admins_examples.rb",
                "status": "modified",
                "additions": 9,
                "deletions": 3,
                "changes": 12,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_admins_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_admins_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_admins_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage assembly admins examples\" do\n   let(:other_user) { create :user, organization: organization, email: \"my_email@example.org\" }\n+  let(:attributes) { attributes_for(:user, organization: organization) }\n \n   let!(:assembly_admin) do\n     create :assembly_admin,\n@@ -23,12 +24,12 @@\n     end\n   end\n \n-  it \"creates a new assembly admin\" do\n+  it \"creates a new assembly admin\", versioning: true do\n     find(\".card-title a.new\").click\n \n     within \".new_assembly_user_role\" do\n       fill_in :assembly_user_role_email, with: other_user.email\n-      fill_in :assembly_user_role_name, with: \"John Doe\"\n+      fill_in :assembly_user_role_name, with: attributes[:name]\n       select \"Administrator\", from: :assembly_user_role_role\n \n       find(\"*[type=submit]\").click\n@@ -39,6 +40,9 @@\n     within \"#assembly_admins table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited #{other_user.name} to the #{translated(assembly.title)} assembly\")\n   end\n \n   describe \"when managing different users\" do\n@@ -47,7 +51,7 @@\n       visit current_path\n     end\n \n-    it \"updates a assembly admin\" do\n+    it \"updates a assembly admin\", versioning: true do\n       within \"#assembly_admins\" do\n         within find(\"#assembly_admins tr\", text: other_user.email) do\n           click_link \"Edit\"\n@@ -65,6 +69,8 @@\n       within \"#assembly_admins table\" do\n         expect(page).to have_content(\"Collaborator\")\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"changed the role of #{other_user.name} in the #{translated(assembly.title)} assembly\")\n     end\n \n     it \"deletes a assembly_user_role\" do"
            },
            {
                "sha": "9a2ebc66a1b2108e678bfd9b47417d5354386257",
                "filename": "decidim-assemblies/spec/shared/manage_assembly_members_examples.rb",
                "status": "modified",
                "additions": 18,
                "deletions": 12,
                "changes": 30,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_members_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_members_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_members_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -10,18 +10,18 @@\n \n   context \"without existing user\" do\n     let!(:assembly_member) { create(:assembly_member, assembly: assembly) }\n+    let(:attributes) { attributes_for(:assembly_member, assembly: assembly) }\n \n-    it \"creates a new assembly member\" do\n+    it \"creates a new assembly member\", versioning: true do\n       find(\".card-title a.new\").click\n \n       execute_script(\"$('#assembly_member_designation_date').focus()\")\n       find(\".datepicker-days .active\").click\n \n       within \".new_assembly_member\" do\n-        fill_in(\n-          :assembly_member_full_name,\n-          with: \"Daisy O'connor\"\n-        )\n+        fill_in(:assembly_member_full_name, with: attributes[:full_name])\n+        fill_in(:assembly_member_gender, with: attributes[:gender])\n+        fill_in(:assembly_member_birthplace, with: attributes[:birthplace])\n       end\n \n       dynamically_attach_file(:assembly_member_non_user_avatar, Decidim::Dev.asset(\"avatar.jpg\")) do\n@@ -38,8 +38,11 @@\n       expect(page).to have_current_path decidim_admin_assemblies.assembly_members_path(assembly)\n \n       within \"#assembly_members table\" do\n-        expect(page).to have_content(\"Daisy O'connor\")\n+        expect(page).to have_content(attributes[:full_name])\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{attributes[:full_name]} member\")\n     end\n   end\n \n@@ -99,6 +102,7 @@\n \n   describe \"when managing other assembly members\" do\n     let!(:assembly_member) { create(:assembly_member, assembly: assembly) }\n+    let(:attributes) { attributes_for(:assembly_member, assembly: assembly) }\n \n     before do\n       visit current_path\n@@ -110,16 +114,15 @@\n       end\n     end\n \n-    it \"updates an assembly member\" do\n+    it \"updates an assembly member\", versioning: true do\n       within find(\"#assembly_members tr\", text: assembly_member.full_name) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_assembly_member\" do\n-        fill_in(\n-          :assembly_member_full_name,\n-          with: \"Alicia O'connor\"\n-        )\n+        fill_in(:assembly_member_full_name, with: attributes[:full_name])\n+        fill_in(:assembly_member_gender, with: attributes[:gender])\n+        fill_in(:assembly_member_birthplace, with: attributes[:birthplace])\n \n         find(\"*[type=submit]\").click\n       end\n@@ -128,8 +131,11 @@\n       expect(page).to have_current_path decidim_admin_assemblies.assembly_members_path(assembly)\n \n       within \"#assembly_members table\" do\n-        expect(page).to have_content(\"Alicia O'connor\")\n+        expect(page).to have_content(attributes[:full_name])\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{assembly_member.full_name} member\")\n     end\n \n     it \"deletes the assembly member\" do"
            },
            {
                "sha": "5a33495ce088b01da340a7f72c2d5fa5e1bf6a66",
                "filename": "decidim-assemblies/spec/system/admin/admin_manages_assemblies_spec.rb",
                "status": "modified",
                "additions": 21,
                "deletions": 30,
                "changes": 51,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -14,6 +14,7 @@\n \n     let(:image2_filename) { \"city2.jpeg\" }\n     let(:image2_path) { Decidim::Dev.asset(image2_filename) }\n+    let(:attributes) { attributes_for(:assembly, organization: organization) }\n \n     before do\n       click_link \"New assembly\"\n@@ -25,36 +26,23 @@\n \n     it_behaves_like \"having a rich text editor for field\", \"#closing_date_reason_div\", \"content\"\n \n-    it \"creates a new assembly\" do\n+    it \"creates a new assembly\", versioning: true do\n       within \".new_assembly\" do\n-        fill_in_i18n(\n-          :assembly_title,\n-          \"#assembly-title-tabs\",\n-          en: \"My assembly\",\n-          es: \"Mi proceso participativo\",\n-          ca: \"El meu proc\u00e9s participatiu\"\n-        )\n-        fill_in_i18n(\n-          :assembly_subtitle,\n-          \"#assembly-subtitle-tabs\",\n-          en: \"Subtitle\",\n-          es: \"Subt\u00edtulo\",\n-          ca: \"Subt\u00edtol\"\n-        )\n-        fill_in_i18n_editor(\n-          :assembly_short_description,\n-          \"#assembly-short_description-tabs\",\n-          en: \"Short description\",\n-          es: \"Descripci\u00f3n corta\",\n-          ca: \"Descripci\u00f3 curta\"\n-        )\n-        fill_in_i18n_editor(\n-          :assembly_description,\n-          \"#assembly-description-tabs\",\n-          en: \"A longer description\",\n-          es: \"Descripci\u00f3n m\u00e1s larga\",\n-          ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-        )\n+        fill_in_i18n(:assembly_title, \"#assembly-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_subtitle, \"#assembly-subtitle-tabs\", **attributes[:subtitle].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_short_description, \"#assembly-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_description, \"#assembly-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_purpose_of_action, \"#assembly-purpose_of_action-tabs\", **attributes[:purpose_of_action].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_composition, \"#assembly-composition-tabs\", **attributes[:composition].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_internal_organisation, \"#assembly-internal_organisation-tabs\", **attributes[:internal_organisation].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_announcement, \"#assembly-announcement-tabs\", **attributes[:announcement].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_closing_date_reason, \"#assembly-closing_date_reason-tabs\", **attributes[:closing_date_reason].except(\"machine_translations\"))\n+\n+        fill_in_i18n(:assembly_participatory_scope, \"#assembly-participatory_scope-tabs\", **attributes[:participatory_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_participatory_structure, \"#assembly-participatory_structure-tabs\", **attributes[:participatory_structure].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_meta_scope, \"#assembly-meta_scope-tabs\", **attributes[:meta_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_local_area, \"#assembly-local_area-tabs\", **attributes[:local_area].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_target, \"#assembly-target-tabs\", **attributes[:target].except(\"machine_translations\"))\n \n         fill_in :assembly_slug, with: \"slug\"\n         fill_in :assembly_hashtag, with: \"#hashtag\"\n@@ -72,8 +60,11 @@\n \n       within \".container\" do\n         expect(page).to have_current_path decidim_admin_assemblies.assemblies_path(q: { parent_id_eq: parent_assembly&.id })\n-        expect(page).to have_content(\"My assembly\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} assembly\")\n     end\n   end\n "
            },
            {
                "sha": "3d151b5a567d4d4b8179060e36a1958fc372a8ca",
                "filename": "decidim-assemblies/spec/system/admin/admin_manages_assemblies_types_spec.rb",
                "status": "modified",
                "additions": 14,
                "deletions": 11,
                "changes": 25,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_types_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,11 +2,12 @@\n \n require \"spec_helper\"\n \n-describe \"Admin manages assemblies\", type: :system do\n+describe \"Admin manages assemblies types\", type: :system do\n   include Decidim::SanitizeHelper\n \n   let(:admin) { create :user, :admin, :confirmed }\n   let(:organization) { admin.organization }\n+  let(:attributes) { attributes_for(:assemblies_type) }\n \n   describe \"Managing assemblies types\" do\n     before do\n@@ -15,21 +16,22 @@\n       visit decidim_admin_assemblies.assemblies_types_path\n     end\n \n-    it \"can create new assemblies types\" do\n+    it \"can create new assemblies types\", versioning: true do\n       click_link \"New assembly type\"\n \n       within \".new_assembly_type\" do\n-        fill_in_i18n :assemblies_type_title, \"#assemblies_type-title-tabs\", en: \"My assembly type\",\n-                                                                            es: \"Mi assembly type\",\n-                                                                            ca: \"La meva assembly type\"\n+        fill_in_i18n :assemblies_type_title, \"#assemblies_type-title-tabs\", **attributes[:title].except(\"machine_translations\")\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My assembly type\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} assembly type\")\n     end\n \n     context \"with existing assemblies types\" do\n@@ -45,23 +47,24 @@\n         end\n       end\n \n-      it \"can edit them\" do\n+      it \"can edit them\", versioning: true do\n         within find(\"tr\", text: translated(assembly_type.title)) do\n           click_link \"Edit\"\n         end\n \n         within \".edit_assembly_type\" do\n-          fill_in_i18n :assemblies_type_title, \"#assemblies_type-title-tabs\", en: \"Another assembly type\",\n-                                                                              es: \"Otra assembly type\",\n-                                                                              ca: \"Una altra assembly type\"\n+          fill_in_i18n :assemblies_type_title, \"#assemblies_type-title-tabs\", **attributes[:title].except(\"machine_translations\")\n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n \n         within \"table\" do\n-          expect(page).to have_content(\"Another assembly type\")\n+          expect(page).to have_content(translated(attributes[:title]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} assembly type\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "fc536f2666a21ffbcdc456033894779dfe3906d3",
                "filename": "decidim-blogs/spec/shared/manage_posts_examples.rb",
                "status": "modified",
                "additions": 22,
                "deletions": 34,
                "changes": 56,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-blogs%2Fspec%2Fshared%2Fmanage_posts_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-blogs%2Fspec%2Fshared%2Fmanage_posts_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-blogs%2Fspec%2Fshared%2Fmanage_posts_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -1,67 +1,50 @@\n # frozen_string_literal: true\n \n-shared_examples \"manage posts\" do\n+# we really need the audit_check variable, as it seems that a process admin should not be able to see the admin logs\n+# Therefore, as long we do have the logs checks in this shared example, we need to have the config flag.\n+shared_examples \"manage posts\" do |audit_check: true|\n   it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='post-body-tabs']\", \"full\" do\n     before do\n       within find(\"tr\", text: translated(post1.title)) do\n         click_link \"Edit\"\n       end\n     end\n   end\n+  let(:attributes) { attributes_for(:post) }\n \n-  it \"updates a post\" do\n+  it \"updates a post\", versioning: true do\n     within find(\"tr\", text: translated(post1.title)) do\n       click_link \"Edit\"\n     end\n \n     within \".edit_post\" do\n       expect(page).to have_select(\"post_decidim_author_id\", selected: author.name)\n \n-      fill_in_i18n(\n-        :post_title,\n-        \"#post-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n-      fill_in_i18n_editor(\n-        :post_body,\n-        \"#post-body-tabs\",\n-        en: \"A longer description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:post_title, \"#post-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:post_body, \"#post-body-tabs\", **attributes[:body].except(\"machine_translations\"))\n \n       find(\"*[type=submit]\").click\n     end\n \n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My new title\")\n+      expect(page).to have_content(translated(attributes[:title]))\n       expect(page).to have_content(\"Post title 2\")\n       expect(page).to have_content(author.name)\n     end\n+\n+    if audit_check == true\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} blog post\")\n+    end\n   end\n \n-  it \"creates a new post\", :slow do\n+  it \"creates a new post\", versioning: true do\n     find(\".card-title a.button\").click\n \n-    fill_in_i18n(\n-      :post_title,\n-      \"#post-title-tabs\",\n-      en: \"My post\",\n-      es: \"Mi post\",\n-      ca: \"El meu post\"\n-    )\n-\n-    fill_in_i18n_editor(\n-      :post_body,\n-      \"#post-body-tabs\",\n-      en: \"A description\",\n-      es: \"Descripci\u00f3n\",\n-      ca: \"Descripci\u00f3\"\n-    )\n+    fill_in_i18n(:post_title, \"#post-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+    fill_in_i18n_editor(:post_body, \"#post-body-tabs\", **attributes[:body].except(\"machine_translations\"))\n \n     within \".new_post\" do\n       find(\"*[type=submit]\").click\n@@ -70,10 +53,15 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My post\")\n+      expect(page).to have_content(translated(attributes[:title]))\n       expect(page).to have_content(\"Post title 1\")\n       expect(page).to have_content(\"Post title 2\")\n     end\n+\n+    if audit_check == true\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} blog post\")\n+    end\n   end\n \n   describe \"deleting a post\" do"
            },
            {
                "sha": "1f181b959300939f175e8d6a93b86c62a87054b4",
                "filename": "decidim-blogs/spec/system/process_admin_manages_post_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-blogs%2Fspec%2Fsystem%2Fprocess_admin_manages_post_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-blogs%2Fspec%2Fsystem%2Fprocess_admin_manages_post_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-blogs%2Fspec%2Fsystem%2Fprocess_admin_manages_post_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -10,5 +10,5 @@\n \n   include_context \"when managing a component as a process admin\"\n \n-  it_behaves_like \"manage posts\"\n+  it_behaves_like \"manage posts\", audit_check: false\n end"
            },
            {
                "sha": "90abbfb0807f995831e40fb63e8c944194a94032",
                "filename": "decidim-budgets/app/views/decidim/budgets/admin/projects/index.html.erb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-budgets%2Fapp%2Fviews%2Fdecidim%2Fbudgets%2Fadmin%2Fprojects%2Findex.html.erb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-budgets%2Fapp%2Fviews%2Fdecidim%2Fbudgets%2Fadmin%2Fprojects%2Findex.html.erb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-budgets%2Fapp%2Fviews%2Fdecidim%2Fbudgets%2Fadmin%2Fprojects%2Findex.html.erb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -3,7 +3,7 @@\n   <div class=\"card-divider\">\n     <h2 class=\"card-title flex--sbc\">\n       <div>\n-        <%= link_to decidim_escape_translated(budget.title), budgets_path %> &gt;\n+        <%= link_to decidim_escape_translated(budget.title).html_safe, budgets_path %> &gt;\n         <%= t(\".title\") %>\n         <span id=\"js-selected-resources-count\" class=\"component-counter component-counter--inline\" title=\"<%= t(\"decidim.budgets.admin.projects.index.selected\") %>\"></span>\n       </div>"
            },
            {
                "sha": "3f78c2e31414e7cc08af7426b94b9d2f7d89e37a",
                "filename": "decidim-budgets/spec/shared/manage_projects_examples.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 25,
                "changes": 41,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-budgets%2Fspec%2Fshared%2Fmanage_projects_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-budgets%2Fspec%2Fshared%2Fmanage_projects_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-budgets%2Fspec%2Fshared%2Fmanage_projects_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -140,24 +140,14 @@\n     end\n   end\n \n-  it \"creates a new project\", :slow do\n+  let(:attributes) { attributes_for(:project) }\n+\n+  it \"creates a new project\", versioning: true do\n     find(\".card-title a.button.new\").click\n \n     within \".new_project\" do\n-      fill_in_i18n(\n-        :project_title,\n-        \"#project-title-tabs\",\n-        en: \"My project\",\n-        es: \"Mi proyecto\",\n-        ca: \"El meu projecte\"\n-      )\n-      fill_in_i18n_editor(\n-        :project_description,\n-        \"#project-description-tabs\",\n-        en: \"A longer description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:project_title, \"#project-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:project_description, \"#project-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n       fill_in :project_budget_amount, with: 22_000_000\n \n       scope_pick select_data_picker(:project_decidim_scope_id), scope\n@@ -169,8 +159,10 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My project\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} project\")\n   end\n \n   context \"when deleting a project\" do\n@@ -196,20 +188,16 @@\n   context \"when having existing proposals\" do\n     let!(:proposal_component) { create(:proposal_component, participatory_space: participatory_space) }\n     let!(:proposals) { create_list :proposal, 5, component: proposal_component, skip_injection: true }\n+    let(:attributes) { attributes_for(:project) }\n \n-    it \"updates a project\" do\n+    it \"updates a project\", versioning: true do\n       within find(\"tr\", text: translated(project.title)) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_project\" do\n-        fill_in_i18n(\n-          :project_title,\n-          \"#project-title-tabs\",\n-          en: \"My new title\",\n-          es: \"Mi nuevo t\u00edtulo\",\n-          ca: \"El meu nou t\u00edtol\"\n-        )\n+        fill_in_i18n(:project_title, \"#project-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:project_description, \"#project-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n         proposals_pick(select_data_picker(:project_proposals, multiple: true), proposals.last(2))\n \n@@ -219,8 +207,11 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My new title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} project\")\n     end\n \n     it \"removes proposals from project\", :slow do"
            },
            {
                "sha": "2dc6a6fabdf479fd839d12aafa1eb8aaff76e3b5",
                "filename": "decidim-budgets/spec/system/admin_manages_budgets_spec.rb",
                "status": "modified",
                "additions": 17,
                "deletions": 27,
                "changes": 44,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_budgets_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_budgets_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_budgets_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -3,12 +3,12 @@\n require \"spec_helper\"\n \n describe \"Admin manages budgets\", type: :system do\n-  let(:budget) { create :budget, component: current_component }\n+  let!(:budget) { create :budget, component: current_component }\n   let(:manifest_name) { \"budgets\" }\n+  let(:attributes) { attributes_for(:budget) }\n \n   include_context \"when managing a component as an admin\"\n   before do\n-    budget\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n     visit_component_admin\n@@ -20,26 +20,15 @@\n     it_behaves_like \"having a rich text editor\", \"new_budget\", \"content\"\n   end\n \n-  it \"creates a new budget\" do\n+  it \"creates a new budget\", versioning: true do\n     within \".card-title\" do\n       click_link \"New Budget\"\n     end\n \n     within \".new_budget\" do\n-      fill_in_i18n(\n-        :budget_title,\n-        \"#budget-title-tabs\",\n-        en: \"My Budget\",\n-        es: \"Mi Presupuesto\",\n-        ca: \"El meu Pressupost\"\n-      )\n-      fill_in_i18n_editor(\n-        :budget_description,\n-        \"#budget-description-tabs\",\n-        en: \"Long description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:budget_title, \"#budget-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:budget_description, \"#budget-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n       fill_in :budget_weight, with: 1\n       fill_in :budget_total_budget, with: 100_000_00\n       scope_pick select_data_picker(:budget_decidim_scope_id), scope\n@@ -54,24 +43,22 @@\n     end\n \n     within \"table\" do\n-      expect(page).to have_content(\"My Budget\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} budget\")\n   end\n \n-  describe \"updating a budget\" do\n+  describe \"updating a budget\", versioning: true do\n     it \"updates a budget\" do\n       within find(\"tr\", text: translated(budget.title)) do\n         page.find(\".action-icon--edit\").click\n       end\n \n       within \".edit_budget\" do\n-        fill_in_i18n(\n-          :budget_title,\n-          \"#budget-title-tabs\",\n-          en: \"My new title\",\n-          es: \"Mi nuevo t\u00edtulo\",\n-          ca: \"El meu nou t\u00edtol\"\n-        )\n+        fill_in_i18n(:budget_title, \"#budget-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:budget_description, \"#budget-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -81,8 +68,11 @@\n       end\n \n       within \"table\" do\n-        expect(page).to have_content(\"My new title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} budget\")\n     end\n   end\n "
            },
            {
                "sha": "a9e763472399f7733f7b968b8ae9968459bdff19",
                "filename": "decidim-budgets/spec/system/admin_manages_projects_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_projects_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_projects_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_projects_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -5,13 +5,12 @@\n \n describe \"Admin manages projects\", type: :system do\n   let(:manifest_name) { \"budgets\" }\n-  let(:budget) { create :budget, component: current_component }\n+  let!(:budget) { create :budget, component: current_component }\n   let!(:project) { create :project, budget: budget }\n \n   include_context \"when managing a component as an admin\"\n \n   before do\n-    budget\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n     visit_component_admin"
            },
            {
                "sha": "6ad825483c220fcdb2b0e4b768436a5b7fde1af9",
                "filename": "decidim-conferences/spec/shared/manage_conference_admins_examples.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 3,
                "changes": 11,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_admins_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_admins_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_admins_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage conference admins examples\" do\n   let(:other_user) { create :user, organization: organization, email: \"my_email@example.org\" }\n+  let(:attributes) { attributes_for(:user, organization: organization) }\n \n   let!(:conference_admin) do\n     create :conference_admin,\n@@ -23,12 +24,12 @@\n     end\n   end\n \n-  it \"creates a new conference admin\" do\n+  it \"creates a new conference admin\", versioning: true do\n     find(\".card-title a.new\").click\n \n     within \".new_conference_user_role\" do\n       fill_in :conference_user_role_email, with: other_user.email\n-      fill_in :conference_user_role_name, with: \"John Doe\"\n+      fill_in :conference_user_role_name, with: attributes[:name]\n       select \"Administrator\", from: :conference_user_role_role\n \n       find(\"*[type=submit]\").click\n@@ -39,6 +40,8 @@\n     within \"#conference_admins table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited #{other_user.name} to the #{translated(conference.title)} conference\")\n   end\n \n   describe \"when managing different users\" do\n@@ -47,7 +50,7 @@\n       visit current_path\n     end\n \n-    it \"updates a conference admin\" do\n+    it \"updates a conference admin\", versioning: true do\n       within \"#conference_admins\" do\n         within find(\"#conference_admins tr\", text: other_user.email) do\n           click_link \"Edit\"\n@@ -65,6 +68,8 @@\n       within \"#conference_admins table\" do\n         expect(page).to have_content(\"Collaborator\")\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"changed the role of #{other_user.name} in the #{translated(conference.title)} conference\")\n     end\n \n     it \"deletes a conference_user_role\" do"
            },
            {
                "sha": "fd5643c53c60d2fb7d3a8f6b42ec2aeb34bceb24",
                "filename": "decidim-conferences/spec/shared/manage_conference_speakers_examples.rb",
                "status": "modified",
                "additions": 17,
                "deletions": 12,
                "changes": 29,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_speakers_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_speakers_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_speakers_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage conference speakers examples\" do\n   let!(:conference_speaker) { create(:conference_speaker, conference: conference) }\n+  let(:attributes) { attributes_for(:conference_speaker, conference: conference) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -17,14 +18,14 @@\n   end\n \n   context \"without existing user\" do\n-    it \"creates a new conference speaker\" do\n+    it \"creates a new conference speaker\", versioning: true do\n       find(\".card-title a.new\").click\n \n       within \".new_conference_speaker\" do\n-        fill_in(\n-          :conference_speaker_full_name,\n-          with: \"Daisy O'connor\"\n-        )\n+        fill_in(:conference_speaker_full_name, with: attributes[:full_name])\n+        fill_in_i18n(:conference_speaker_position, \"#conference_speaker-position-tabs\", **attributes[:position].except(\"machine_translations\"))\n+        fill_in_i18n(:conference_speaker_affiliation, \"#conference_speaker-affiliation-tabs\", **attributes[:affiliation].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_speaker_short_bio, \"#conference_speaker-short_bio-tabs\", **attributes[:short_bio].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -33,8 +34,10 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_speakers_path(conference)\n \n       within \"#conference_speakers table\" do\n-        expect(page).to have_content(\"Daisy O'connor\")\n+        expect(page).to have_content(attributes[:full_name])\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{attributes[:full_name]} speaker in the\")\n     end\n   end\n \n@@ -65,16 +68,16 @@\n       visit current_path\n     end\n \n-    it \"updates an conference speaker\" do\n+    it \"updates an conference speaker\", versioning: true do\n       within find(\"#conference_speakers tr\", text: conference_speaker.full_name) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_conference_speaker\" do\n-        fill_in(\n-          :conference_speaker_full_name,\n-          with: \"Alicia O'connor\"\n-        )\n+        fill_in(:conference_speaker_full_name, with: attributes[:full_name])\n+        fill_in_i18n(:conference_speaker_position, \"#conference_speaker-position-tabs\", **attributes[:position].except(\"machine_translations\"))\n+        fill_in_i18n(:conference_speaker_affiliation, \"#conference_speaker-affiliation-tabs\", **attributes[:affiliation].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_speaker_short_bio, \"#conference_speaker-short_bio-tabs\", **attributes[:short_bio].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -83,8 +86,10 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_speakers_path(conference)\n \n       within \"#conference_speakers table\" do\n-        expect(page).to have_content(\"Alicia O'connor\")\n+        expect(page).to have_content(attributes[:full_name])\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{conference_speaker.full_name} speaker in the\")\n     end\n \n     it \"deletes the conference speaker\" do"
            },
            {
                "sha": "3e3e8965201f31a890e055c88444565e2692ed21",
                "filename": "decidim-conferences/spec/shared/manage_conferences_examples.rb",
                "status": "modified",
                "additions": 22,
                "deletions": 39,
                "changes": 61,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_conferences_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_conferences_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_conferences_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -7,6 +7,7 @@\n \n     let(:image2_filename) { \"city2.jpeg\" }\n     let(:image2_path) { Decidim::Dev.asset(image2_filename) }\n+    let(:attributes) { attributes_for(:conference) }\n \n     before do\n       click_link \"New Conference\"\n@@ -17,36 +18,13 @@\n     end\n     it_behaves_like \"having a rich text editor for field\", \"#conference_registrations_terms\", \"content\"\n \n-    it \"creates a new conference\" do\n+    it \"creates a new conference\", versioning: true do\n       within \".new_conference\" do\n-        fill_in_i18n(\n-          :conference_title,\n-          \"#conference-title-tabs\",\n-          en: \"My conference\",\n-          es: \"Mi proceso participativo\",\n-          ca: \"El meu proc\u00e9s participatiu\"\n-        )\n-        fill_in_i18n(\n-          :conference_slogan,\n-          \"#conference-slogan-tabs\",\n-          en: \"Slogan\",\n-          es: \"Eslogan\",\n-          ca: \"Esl\u00f3gan\"\n-        )\n-        fill_in_i18n_editor(\n-          :conference_short_description,\n-          \"#conference-short_description-tabs\",\n-          en: \"Short description\",\n-          es: \"Descripci\u00f3n corta\",\n-          ca: \"Descripci\u00f3 curta\"\n-        )\n-        fill_in_i18n_editor(\n-          :conference_description,\n-          \"#conference-description-tabs\",\n-          en: \"A longer description\",\n-          es: \"Descripci\u00f3n m\u00e1s larga\",\n-          ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-        )\n+        fill_in_i18n(:conference_title, \"#conference-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n(:conference_slogan, \"#conference-slogan-tabs\", **attributes[:slogan].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_short_description, \"#conference-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_description, \"#conference-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_objectives, \"#conference-objectives-tabs\", **attributes[:objectives].except(\"machine_translations\"))\n \n         fill_in :conference_slug, with: \"slug\"\n         fill_in :conference_hashtag, with: \"#hashtag\"\n@@ -66,39 +44,44 @@\n \n       within \".container\" do\n         expect(page).to have_current_path decidim_admin_conferences.conferences_path\n-        expect(page).to have_content(\"My conference\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} conference\")\n     end\n   end\n \n   describe \"updating a conference\" do\n     let(:image3_filename) { \"city3.jpeg\" }\n     let(:image3_path) { Decidim::Dev.asset(image3_filename) }\n+    let(:attributes) { attributes_for(:conference) }\n \n     before do\n       click_link translated(conference.title)\n     end\n \n-    it \"updates a conference\" do\n-      fill_in_i18n(\n-        :conference_title,\n-        \"#conference-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+    it \"updates a conference\", versioning: true do\n       dynamically_attach_file(:conference_banner_image, image3_path, remove_before: true)\n \n       within \".edit_conference\" do\n+        fill_in_i18n(:conference_title, \"#conference-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n(:conference_slogan, \"#conference-slogan-tabs\", **attributes[:slogan].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_short_description, \"#conference-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_description, \"#conference-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_objectives, \"#conference-objectives-tabs\", **attributes[:objectives].except(\"machine_translations\"))\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \".container\" do\n-        expect(page).to have_selector(\"input[value='My new title']\")\n+        expect(page).to have_selector(%(input[value=\"#{translated(attributes[:title])}\"]))\n         expect(page).to have_css(\"img[src*='#{image3_filename}']\")\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} conference\")\n     end\n   end\n "
            },
            {
                "sha": "60eece53a4c8bd2f7761294f5e013bafc5c90a15",
                "filename": "decidim-conferences/spec/shared/manage_media_links_examples.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 14,
                "changes": 27,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_media_links_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_media_links_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_media_links_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -1,6 +1,8 @@\n # frozen_string_literal: true\n \n shared_examples \"manage media links examples\" do\n+  let!(:attributes) { attributes_for(:media_link, conference: conference) }\n+\n   before do\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n@@ -13,14 +15,12 @@\n       click_link \"New Media Link\"\n     end\n \n-    it \"creates a new media link\" do\n+    it \"creates a new media link\", versioning: true do\n       within \".new_media_link\" do\n         fill_in_i18n(\n           :conference_media_link_title,\n           \"#conference_media_link-title-tabs\",\n-          en: \"Media Link en\",\n-          es: \"Media Link es\",\n-          ca: \"Media Link ca\"\n+          **attributes[:title].except(\"machine_translations\")\n         )\n \n         fill_in :conference_media_link_link, with: \"https://decidim.org\"\n@@ -34,8 +34,11 @@\n \n       within \".container\" do\n         expect(page).to have_current_path decidim_admin_conferences.conference_media_links_path(conference)\n-        expect(page).to have_content(\"Media Link en\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} media link\")\n     end\n   end\n \n@@ -52,19 +55,13 @@\n       end\n     end\n \n-    it \"updates a conference media links\" do\n+    it \"updates a conference media links\", versioning: true do\n       within find(\"#media_links tr\", text: translated(media_link.title)) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_media_link\" do\n-        fill_in_i18n(\n-          :conference_media_link_title,\n-          \"#conference_media_link-title-tabs\",\n-          en: \"Media Link update en\",\n-          es: \"Media Link update es\",\n-          ca: \"Media Link update ca\"\n-        )\n+        fill_in_i18n(:conference_media_link_title, \"#conference_media_link-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n         fill_in :conference_media_link_link, with: \"https://decidim.org\"\n         fill_in :conference_media_link_weight, with: 2\n@@ -77,8 +74,10 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_media_links_path(conference)\n \n       within \"#media_links table\" do\n-        expect(page).to have_content(\"Media Link update en\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(media_link.title)} media link\")\n     end\n \n     it \"deletes the conference media link\" do"
            },
            {
                "sha": "8bc1281e553b876236f5018c8b4e0428b66d6340",
                "filename": "decidim-conferences/spec/shared/manage_partners_examples.rb",
                "status": "modified",
                "additions": 31,
                "deletions": 6,
                "changes": 37,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_partners_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_partners_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_partners_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage partners examples\" do\n   let!(:conference_partner) { create(:partner, conference: conference) }\n+  let!(:attributes) { attributes_for(:partner, conference: conference) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -17,20 +18,42 @@\n   end\n \n   describe \"when managing other conference partners\" do\n+    let(:image1_filename) { \"city.jpeg\" }\n+    let(:image1_path) { Decidim::Dev.asset(image1_filename) }\n+\n     before do\n       visit current_path\n     end\n \n-    it \"updates a conference partners\" do\n+    it \"creates a conference partner\", versioning: true do\n+      click_on \"New Partner\"\n+      dynamically_attach_file(:conference_partner_logo, image1_path)\n+\n+      within \".new_partner\" do\n+        fill_in(:conference_partner_name, with: attributes[:name])\n+\n+        select(\"Collaborator\", from: :conference_partner_partner_type)\n+\n+        find(\"*[type=submit]\").click\n+      end\n+      expect(page).to have_admin_callout(\"successfully\")\n+      expect(page).to have_current_path decidim_admin_conferences.conference_partners_path(conference)\n+\n+      within \"#partners table\" do\n+        expect(page).to have_content(attributes[:name])\n+        expect(page).to have_content(\"Collaborator\")\n+      end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the partner #{attributes[:name]}\")\n+    end\n+\n+    it \"updates a conference partners\", versioning: true do\n       within find(\"#partners tr\", text: conference_partner.name) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_partner\" do\n-        fill_in(\n-          :conference_partner_name,\n-          with: \"Partner name\"\n-        )\n+        fill_in(:conference_partner_name, with: attributes[:name])\n \n         select(\n           \"Collaborator\",\n@@ -44,9 +67,11 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_partners_path(conference)\n \n       within \"#partners table\" do\n-        expect(page).to have_content(\"Partner name\")\n+        expect(page).to have_content(attributes[:name])\n         expect(page).to have_content(\"Collaborator\")\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the partner #{conference_partner.name}\")\n     end\n \n     context \"when the partner type is already a Collaborator\" do"
            },
            {
                "sha": "1eba25dd25233d5e677c7e377990ee3b530d2714",
                "filename": "decidim-conferences/spec/shared/manage_registration_types_examples.rb",
                "status": "modified",
                "additions": 30,
                "deletions": 8,
                "changes": 38,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_registration_types_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fshared%2Fmanage_registration_types_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_registration_types_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage registration types examples\" do\n   let!(:registration_type) { create(:registration_type, conference: conference) }\n+  let(:attributes) { attributes_for(:registration_type, conference: conference) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -21,19 +22,37 @@\n       visit current_path\n     end\n \n+    it \"creates a conference registration types\", versioning: true do\n+      click_on \"New Registration type\"\n+\n+      within \".new_registration_type\" do\n+        fill_in_i18n(:conference_registration_type_title, \"#conference_registration_type-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_registration_type_description, \"#conference_registration_type-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n+        fill_in(:conference_registration_type_weight, with: 4)\n+\n+        find(\"*[type=submit]\").click\n+      end\n+\n+      expect(page).to have_admin_callout(\"successfully\")\n+      expect(page).to have_current_path decidim_admin_conferences.conference_registration_types_path(conference)\n+\n+      within \"#registration_types table\" do\n+        expect(page).to have_content(translated(attributes[:title]))\n+      end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} registration type\")\n+    end\n+\n     it \"updates a conference registration types\" do\n       within find(\"#registration_types tr\", text: translated(registration_type.title)) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_registration_type\" do\n-        fill_in_i18n(\n-          :conference_registration_type_title,\n-          \"#conference_registration_type-title-tabs\",\n-          en: \"Registration type title\",\n-          es: \"Registration type title es\",\n-          ca: \"Registration type title ca\"\n-        )\n+        fill_in_i18n(:conference_registration_type_title, \"#conference_registration_type-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_registration_type_description, \"#conference_registration_type-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -42,8 +61,11 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_registration_types_path(conference)\n \n       within \"#registration_types table\" do\n-        expect(page).to have_content(\"Registration type title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(registration_type.title)} registration type\")\n     end\n \n     it \"deletes the conference registration type\" do"
            },
            {
                "sha": "581fd44e49189d40a9b87cf389d95d1d978ecbc1",
                "filename": "decidim-conferences/spec/system/media_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fsystem%2Fmedia_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-conferences%2Fspec%2Fsystem%2Fmedia_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fsystem%2Fmedia_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -86,7 +86,7 @@ def visit_conference\n \n     it \"shows them ordered\" do\n       within \"div.wrapper .documents\" do\n-        expect(decidim_escape_translated(first_document.title).gsub(\"&quot;\", \"\\\"\")).to appear_before(decidim_escape_translated(last_document.title).gsub(\"&quot;\", \"\\\"\"))\n+        expect(decidim_escape_translated(first_document.title).gsub(\"&#39;\", \"\\'\")).to appear_before(decidim_escape_translated(last_document.title).gsub(\"&#39;\", \"\\'\"))\n       end\n \n       within \"div.wrapper .images\" do"
            },
            {
                "sha": "09a7742e505d017e91df31bf6a77875ec219b3ab",
                "filename": "decidim-core/app/cells/decidim/follow_button_cell.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Fapp%2Fcells%2Fdecidim%2Ffollow_button_cell.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Fapp%2Fcells%2Fdecidim%2Ffollow_button_cell.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Fapp%2Fcells%2Fdecidim%2Ffollow_button_cell.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -46,7 +46,7 @@ def icon_options\n \n     def render_screen_reader_title_for(resource)\n       content_tag :span, class: \"show-for-sr\" do\n-        decidim_html_escape(resource_title(resource))\n+        decidim_sanitize_translated(resource_title(resource))\n       end\n     end\n "
            },
            {
                "sha": "36a2ced49a9905debbaf582466a2d0a155bb69ed",
                "filename": "decidim-core/app/presenters/decidim/log/resource_presenter.rb",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -10,6 +10,8 @@ module Log\n     # overwrite `BasePresenter#resource_presenter` to return your custom resource presenter.\n     # The only requirement for custom renderers is that they should respond to `present`.\n     class ResourcePresenter\n+      include Decidim::SanitizeHelper\n+\n       # Public: Initializes the presenter.\n       #\n       # resource - An instance of a model that can be located by\n@@ -65,7 +67,11 @@ def resource_path\n       #\n       # Returns an HTML-safe String.\n       def present_resource_name\n-        h.translated_attribute extra[\"title\"]\n+        if resource.present? && resource.respond_to?(:presenter) && resource.presenter.respond_to?(:title)\n+          resource.presenter.title(html_escape: true)\n+        else\n+          decidim_escape_translated(extra[\"title\"]).html_safe\n+        end\n       end\n     end\n   end"
            },
            {
                "sha": "270e006cc5f0705e657f7f24b1f48a2d368ae673",
                "filename": "decidim-core/app/services/decidim/log/diff_changeset_calculator.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Fapp%2Fservices%2Fdecidim%2Flog%2Fdiff_changeset_calculator.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Fapp%2Fservices%2Fdecidim%2Flog%2Fdiff_changeset_calculator.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Fapp%2Fservices%2Fdecidim%2Flog%2Fdiff_changeset_calculator.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -86,7 +86,7 @@ def generate_i18n_changeset(attribute, values, type)\n         locales.flat_map do |locale|\n           previous_value = values.first.try(:[], locale)\n           new_value = values.last.try(:[], locale)\n-          if previous_value == new_value\n+          if previous_value == new_value || (previous_value.nil? && new_value.blank?)\n             nil\n           else\n             label = generate_label(attribute, locale)"
            },
            {
                "sha": "f664fb56717830bfe570668a333caefceb7d7bbb",
                "filename": "decidim-core/lib/decidim/core/test/factories.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Flib%2Fdecidim%2Fcore%2Ftest%2Ffactories.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Flib%2Fdecidim%2Fcore%2Ftest%2Ffactories.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Flib%2Fdecidim%2Fcore%2Ftest%2Ffactories.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -9,7 +9,7 @@\n require \"decidim/comments/test/factories\"\n \n def generate_component_name(locales, manifest_name, skip_injection: false)\n-  prepend = skip_injection ? \"\" : \"<script>alert(\\\"#{manifest_name}\\\");</script>\"\n+  prepend = skip_injection ? \"\" : \"<script>alert('#{manifest_name}');</script>\"\n \n   Decidim::Components::Namer.new(locales, manifest_name).i18n_name.transform_values { |v| [prepend, v].compact_blank.join(\" \") }\n end\n@@ -26,7 +26,7 @@ def generate_localized_word(field = nil, skip_injection: false)\n     if skip_injection\n       Faker::Lorem.word\n     else\n-      \"<script>alert(\\\"#{field}\\\");</script> #{Faker::Lorem.word}\"\n+      \"<script>alert('#{field}');</script> #{Faker::Lorem.word}\"\n     end\n   end\n end\n@@ -38,7 +38,7 @@ def generate_localized_title(field = nil, skip_injection: false)\n     if skip_injection\n       generate(:title)\n     else\n-      \"<script>alert(\\\"#{field}\\\");</script> #{generate(:title)}\"\n+      \"<script>alert('#{field}');</script> #{generate(:title)}\"\n     end\n   end\n end"
            },
            {
                "sha": "00c813b37442ecd6d4ace5cbb917e7fde59c3c33",
                "filename": "decidim-core/lib/decidim/core/test/shared_examples/has_attachment_collections.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Flib%2Fdecidim%2Fcore%2Ftest%2Fshared_examples%2Fhas_attachment_collections.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Flib%2Fdecidim%2Fcore%2Ftest%2Fshared_examples%2Fhas_attachment_collections.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Flib%2Fdecidim%2Fcore%2Ftest%2Fshared_examples%2Fhas_attachment_collections.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -39,9 +39,9 @@\n \n     it \"shows them ordered\" do\n       within \".attachments .documents\" do\n-        expect(decidim_escape_translated(first_attachment_collection.name).gsub(\"&quot;\",\n-                                                                                \"\\\"\")).to appear_before(decidim_escape_translated(last_attachment_collection.name).gsub(\"&quot;\",\n-                                                                                                                                                                        \"\\\"\"))\n+        expect(decidim_escape_translated(first_attachment_collection.name).gsub(\"&#39;\",\n+                                                                                \"\\'\")).to appear_before(decidim_escape_translated(last_attachment_collection.name).gsub(\"&#39;\",\n+                                                                                                                                                                        \"\\'\"))\n       end\n     end\n   end"
            },
            {
                "sha": "5fd41ac0b51bb879b83c0a8213f689be61ec3074",
                "filename": "decidim-core/lib/decidim/core/test/shared_examples/has_attachments.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Flib%2Fdecidim%2Fcore%2Ftest%2Fshared_examples%2Fhas_attachments.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-core%2Flib%2Fdecidim%2Fcore%2Ftest%2Fshared_examples%2Fhas_attachments.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Flib%2Fdecidim%2Fcore%2Ftest%2Fshared_examples%2Fhas_attachments.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -35,7 +35,7 @@\n \n     it \"shows them ordered\" do\n       within \"div.wrapper .documents\" do\n-        expect(decidim_escape_translated(first_document.title).gsub(\"&quot;\", \"\\\"\")).to appear_before(decidim_escape_translated(last_document.title).gsub(\"&quot;\", \"\\\"\"))\n+        expect(decidim_escape_translated(first_document.title).gsub(\"&#39;\", \"\\'\")).to appear_before(decidim_escape_translated(last_document.title).gsub(\"&#39;\", \"\\'\"))\n       end\n \n       within \"div.wrapper .images\" do"
            },
            {
                "sha": "b7a744eab646432cfb523f7d286348d21e2768f2",
                "filename": "decidim-debates/app/models/decidim/debates/debate.rb",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-debates%2Fapp%2Fmodels%2Fdecidim%2Fdebates%2Fdebate.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-debates%2Fapp%2Fmodels%2Fdecidim%2Fdebates%2Fdebate.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fapp%2Fmodels%2Fdecidim%2Fdebates%2Fdebate.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -56,6 +56,12 @@ class Debate < Debates::ApplicationRecord\n       }\n       scope_search_multi :with_any_state, [:open, :closed]\n \n+      # Returns the presenter for this debate, to be used in the views.\n+      # Required by ResourceRenderer.\n+      def presenter\n+        Decidim::Debates::DebatePresenter.new(self)\n+      end\n+\n       def self.log_presenter_class_for(_log)\n         Decidim::Debates::AdminLog::DebatePresenter\n       end"
            },
            {
                "sha": "6a5ba3bcb2bd473a804a144897fc272514c40af1",
                "filename": "decidim-debates/app/presenters/decidim/debates/admin_log/debate_presenter.rb",
                "status": "modified",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fdebate_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fdebate_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fdebate_presenter.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -15,10 +15,6 @@ module AdminLog\n       class DebatePresenter < Decidim::Log::BasePresenter\n         private\n \n-        def resource_presenter\n-          @resource_presenter ||= Decidim::Debates::Log::ResourcePresenter.new(action_log.resource, h, action_log.extra[\"resource\"])\n-        end\n-\n         def diff_fields_mapping\n           {\n             description: \"Decidim::Debates::AdminLog::ValueTypes::DebateTitleDescriptionPresenter\","
            },
            {
                "sha": "c61c1b8e909e93f3f63df0c6f797f58a8c958aac",
                "filename": "decidim-debates/app/presenters/decidim/debates/admin_log/value_types/debate_title_description_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fvalue_types%2Fdebate_title_description_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fvalue_types%2Fdebate_title_description_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fvalue_types%2Fdebate_title_description_presenter.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -10,7 +10,7 @@ class DebateTitleDescriptionPresenter < Decidim::Log::ValueTypes::DefaultPresent\n           def present\n             return unless value\n \n-            renderer = Decidim::ContentRenderers::HashtagRenderer.new(h.translated_attribute(value))\n+            renderer = Decidim::ContentRenderers::HashtagRenderer.new(h.decidim_escape_translated(value))\n             renderer.render(links: false).html_safe\n           end\n         end"
            },
            {
                "sha": "1804ee80e35ccd7beaa9c49c48093ca0e8be63be",
                "filename": "decidim-debates/app/presenters/decidim/debates/log/resource_presenter.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 18,
                "changes": 18,
                "blob_url": "https://github.com/decidim/decidim/blob/6f446ff54ed3e8bdb575e0dc50934c5aa4a483b1/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Flog%2Fresource_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/6f446ff54ed3e8bdb575e0dc50934c5aa4a483b1/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Flog%2Fresource_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Flog%2Fresource_presenter.rb?ref=6f446ff54ed3e8bdb575e0dc50934c5aa4a483b1",
                "patch": "@@ -1,18 +0,0 @@\n-# frozen_string_literal: true\n-\n-module Decidim\n-  module Debates\n-    module Log\n-      class ResourcePresenter < Decidim::Log::ResourcePresenter\n-        private\n-\n-        # Private: Presents resource name.\n-        #\n-        # Returns an HTML-safe String.\n-        def present_resource_name\n-          Decidim::Debates::DebatePresenter.new(resource).title\n-        end\n-      end\n-    end\n-  end\n-end"
            },
            {
                "sha": "d3aa3091aa21cc3c1a36dffbf1feb26b2ee4d447",
                "filename": "decidim-debates/spec/shared/manage_debates_examples.rb",
                "status": "modified",
                "additions": 30,
                "deletions": 63,
                "changes": 93,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-debates%2Fspec%2Fshared%2Fmanage_debates_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-debates%2Fspec%2Fshared%2Fmanage_debates_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fspec%2Fshared%2Fmanage_debates_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,6 +2,7 @@\n \n RSpec.shared_examples \"manage debates\" do\n   let!(:debate) { create :debate, category: category, component: current_component }\n+  let(:attributes) { attributes_for(:debate, :closed, component: current_component) }\n \n   before { visit_component_admin }\n \n@@ -25,19 +26,15 @@\n   end\n \n   describe \"updating a debate\" do\n-    it \"updates a debate\" do\n+    it \"updates a debate\", versioning: true do\n       within find(\"tr\", text: translated(debate.title)) do\n         page.find(\".action-icon--edit\").click\n       end\n \n       within \".edit_debate\" do\n-        fill_in_i18n(\n-          :debate_title,\n-          \"#debate-title-tabs\",\n-          en: \"My new title\",\n-          es: \"Mi nuevo t\u00edtulo\",\n-          ca: \"El meu nou t\u00edtol\"\n-        )\n+        fill_in_i18n(:debate_title, \"#debate-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:debate_description, \"#debate-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:debate_instructions, \"#debate-instructions-tabs\", **attributes[:instructions].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -47,8 +44,11 @@\n       end\n \n       within \"table\" do\n-        expect(page).to have_content(\"My new title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} debate on the\")\n     end\n \n     context \"when the debate has an author\" do\n@@ -74,33 +74,15 @@\n     end\n   end\n \n-  it \"creates a new finite debate\" do\n+  it \"creates a new finite debate\", versioning: true do\n     within \".card-title\" do\n       click_link \"New Debate\"\n     end\n \n     within \".new_debate\" do\n-      fill_in_i18n(\n-        :debate_title,\n-        \"#debate-title-tabs\",\n-        en: \"My debate\",\n-        es: \"Mi debate\",\n-        ca: \"El meu debat\"\n-      )\n-      fill_in_i18n_editor(\n-        :debate_description,\n-        \"#debate-description-tabs\",\n-        en: \"Long description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n-      fill_in_i18n_editor(\n-        :debate_instructions,\n-        \"#debate-instructions-tabs\",\n-        en: \"Long instructions\",\n-        es: \"Instrucciones m\u00e1s largas\",\n-        ca: \"Instruccions m\u00e9s llargues\"\n-      )\n+      fill_in_i18n(:debate_title, \"#debate-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:debate_description, \"#debate-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:debate_instructions, \"#debate-instructions-tabs\", **attributes[:instructions].except(\"machine_translations\"))\n \n       choose \"Finite\"\n     end\n@@ -126,8 +108,11 @@\n     end\n \n     within \"table\" do\n-      expect(page).to have_content(\"My debate\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} debate on the\")\n   end\n \n   it \"creates a new open debate\" do\n@@ -136,27 +121,9 @@\n     end\n \n     within \".new_debate\" do\n-      fill_in_i18n(\n-        :debate_title,\n-        \"#debate-title-tabs\",\n-        en: \"My debate\",\n-        es: \"Mi debate\",\n-        ca: \"El meu debat\"\n-      )\n-      fill_in_i18n_editor(\n-        :debate_description,\n-        \"#debate-description-tabs\",\n-        en: \"Long description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n-      fill_in_i18n_editor(\n-        :debate_instructions,\n-        \"#debate-instructions-tabs\",\n-        en: \"Long instructions\",\n-        es: \"Instrucciones m\u00e1s largas\",\n-        ca: \"Instruccions m\u00e9s llargues\"\n-      )\n+      fill_in_i18n(:debate_title, \"#debate-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:debate_description, \"#debate-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:debate_instructions, \"#debate-instructions-tabs\", **attributes[:instructions].except(\"machine_translations\"))\n \n       choose \"Open\"\n     end\n@@ -175,8 +142,11 @@\n     end\n \n     within \"table\" do\n-      expect(page).to have_content(\"My debate\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} debate on the\")\n   end\n \n   describe \"deleting a debate\" do\n@@ -213,20 +183,14 @@\n     end\n   end\n \n-  describe \"closing a debate\" do\n+  describe \"closing a debate\", versioning: true do\n     it \"closes a debate\" do\n       within find(\"tr\", text: translated(debate.title)) do\n         page.find(\".action-icon--close\").click\n       end\n \n       within \".edit_close_debate\" do\n-        fill_in_i18n_editor(\n-          :debate_conclusions,\n-          \"#debate-conclusions-tabs\",\n-          en: \"The debate was great\",\n-          es: \"El debate fu\u00e9 genial\",\n-          ca: \"El debat ha anat molt b\u00e9\"\n-        )\n+        fill_in_i18n_editor(:debate_conclusions, \"#debate-conclusions-tabs\", **attributes[:conclusions].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -242,7 +206,10 @@\n         end\n       end\n \n-      expect(page).to have_content(\"The debate was great\")\n+      expect(page).to have_content(strip_tags(translated(attributes[:conclusions])).strip)\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"performed some action on #{translated(debate.title)} in\")\n     end\n \n     context \"when the debate has an author\" do"
            },
            {
                "sha": "8a1af0036ee0e65e1e3217db9c8136c6a5cd892e",
                "filename": "decidim-meetings/app/presenters/decidim/meetings/admin_log/meeting_presenter.rb",
                "status": "modified",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fmeeting_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fmeeting_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fmeeting_presenter.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -15,10 +15,6 @@ module AdminLog\n       class MeetingPresenter < Decidim::Log::BasePresenter\n         private\n \n-        def resource_presenter\n-          @resource_presenter ||= Decidim::Meetings::Log::ResourcePresenter.new(action_log.resource, h, action_log.extra[\"resource\"])\n-        end\n-\n         def diff_fields_mapping\n           {\n             address: :string,"
            },
            {
                "sha": "02694535b0d5ea1b69411aa4998b79e6fa56d667",
                "filename": "decidim-meetings/app/presenters/decidim/meetings/admin_log/value_types/meeting_title_description_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fvalue_types%2Fmeeting_title_description_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fvalue_types%2Fmeeting_title_description_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fvalue_types%2Fmeeting_title_description_presenter.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -10,7 +10,7 @@ class MeetingTitleDescriptionPresenter < Decidim::Log::ValueTypes::DefaultPresen\n           def present\n             return unless value\n \n-            renderer = Decidim::ContentRenderers::HashtagRenderer.new(h.translated_attribute(value))\n+            renderer = Decidim::ContentRenderers::HashtagRenderer.new(h.decidim_escape_translated(value))\n             renderer.render(links: false).html_safe\n           end\n         end"
            },
            {
                "sha": "4ee659a9232848871438f5b13545f393203660da",
                "filename": "decidim-meetings/app/presenters/decidim/meetings/log/resource_presenter.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 18,
                "changes": 18,
                "blob_url": "https://github.com/decidim/decidim/blob/6f446ff54ed3e8bdb575e0dc50934c5aa4a483b1/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Flog%2Fresource_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/6f446ff54ed3e8bdb575e0dc50934c5aa4a483b1/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Flog%2Fresource_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Flog%2Fresource_presenter.rb?ref=6f446ff54ed3e8bdb575e0dc50934c5aa4a483b1",
                "patch": "@@ -1,18 +0,0 @@\n-# frozen_string_literal: true\n-\n-module Decidim\n-  module Meetings\n-    module Log\n-      class ResourcePresenter < Decidim::Log::ResourcePresenter\n-        private\n-\n-        # Private: Presents resource name.\n-        #\n-        # Returns an HTML-safe String.\n-        def present_resource_name\n-          Decidim::Meetings::MeetingPresenter.new(resource).title\n-        end\n-      end\n-    end\n-  end\n-end"
            },
            {
                "sha": "6694ba6979719e508c4e9cf76e554300205906e0",
                "filename": "decidim-meetings/spec/cells/decidim/meetings/meeting_highlighted_list_item_cell_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fspec%2Fcells%2Fdecidim%2Fmeetings%2Fmeeting_highlighted_list_item_cell_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fspec%2Fcells%2Fdecidim%2Fmeetings%2Fmeeting_highlighted_list_item_cell_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fspec%2Fcells%2Fdecidim%2Fmeetings%2Fmeeting_highlighted_list_item_cell_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -19,7 +19,7 @@ module Decidim::Meetings\n \n     context \"when title contains special html entities\" do\n       it \"escapes them correctly\" do\n-        expect(subject.to_s).to include(decidim_escape_translated(meeting.title).gsub(\"&quot;\", \"\\\"\"))\n+        expect(subject.to_s).to include(decidim_escape_translated(meeting.title).gsub(\"&#39;\", \"\\'\"))\n       end\n     end\n   end"
            },
            {
                "sha": "942ad440c648c7c19bc7dcd4fb81ccd300a2b0ad",
                "filename": "decidim-meetings/spec/cells/decidim/meetings/meeting_list_item_cell_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fspec%2Fcells%2Fdecidim%2Fmeetings%2Fmeeting_list_item_cell_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fspec%2Fcells%2Fdecidim%2Fmeetings%2Fmeeting_list_item_cell_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fspec%2Fcells%2Fdecidim%2Fmeetings%2Fmeeting_list_item_cell_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -17,7 +17,7 @@ module Decidim::Meetings\n \n     context \"when title contains special html entities\" do\n       it \"escapes them correctly\" do\n-        expect(subject.to_s).to include(decidim_escape_translated(meeting.title).gsub(\"&quot;\", \"\\\"\"))\n+        expect(subject.to_s).to include(decidim_escape_translated(meeting.title).gsub(\"&#39;\", \"\\'\"))\n       end\n     end\n   end"
            },
            {
                "sha": "6986789c3b283440728496ff86e5555a8bff2cf5",
                "filename": "decidim-meetings/spec/system/admin/admin_manages_meetings_spec.rb",
                "status": "modified",
                "additions": 25,
                "deletions": 38,
                "changes": 63,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_meetings_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-meetings%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_meetings_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_meetings_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -10,6 +10,12 @@\n   let(:latitude) { 40.1234 }\n   let(:longitude) { 2.1234 }\n   let(:service_titles) { [\"This is the first service\", \"This is the second service\"] }\n+  let(:base_date) { Time.new.utc }\n+  let(:meeting_start_date) { base_date.strftime(\"%d/%m/%Y\") }\n+  let(:meeting_start_time) { base_date.utc.strftime(\"%H:%M\") }\n+  let(:meeting_end_date) { ((base_date + 2.days) + 1.month).strftime(\"%d/%m/%Y\") }\n+  let(:meeting_end_time) { (base_date + 4.hours).strftime(\"%H:%M\") }\n+  let(:attributes) { attributes_for(:meeting, component: current_component) }\n \n   include_context \"when managing a component as an admin\"\n \n@@ -153,13 +159,12 @@\n     end\n \n     within \".edit_meeting\" do\n-      fill_in_i18n(\n-        :meeting_title,\n-        \"#meeting-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+      fill_in_i18n(:meeting_title, \"#meeting-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+\n+      fill_in_i18n(:meeting_location, \"#meeting-location-tabs\", **attributes[:location].except(\"machine_translations\"))\n+      fill_in_i18n(:meeting_location_hints, \"#meeting-location_hints-tabs\", **attributes[:location_hints].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:meeting_description, \"#meeting-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n       fill_in_geocoding :meeting_address, with: address\n \n       find(\"*[type=submit]\").click\n@@ -168,8 +173,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My new title\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:title])} meeting on the\")\n   end\n \n   it \"sets registration enabled to true when registration type is on this platform\" do\n@@ -265,40 +273,16 @@\n     expect(page).to have_current_path(meeting_path)\n   end\n \n-  it \"creates a new meeting\", :slow, :serves_geocoding_autocomplete do # rubocop:disable RSpec/ExampleLength\n+  it \"creates a new meeting\", :slow, :serves_geocoding_autocomplete do\n     find(\".card-title a.button\").click\n \n-    fill_in_i18n(\n-      :meeting_title,\n-      \"#meeting-title-tabs\",\n-      en: \"My meeting\",\n-      es: \"Mi meeting\",\n-      ca: \"El meu meeting\"\n-    )\n+    fill_in_i18n(:meeting_title, \"#meeting-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n     select \"In person\", from: :meeting_type_of_meeting\n \n-    fill_in_i18n(\n-      :meeting_location,\n-      \"#meeting-location-tabs\",\n-      en: \"Location\",\n-      es: \"Location\",\n-      ca: \"Location\"\n-    )\n-    fill_in_i18n(\n-      :meeting_location_hints,\n-      \"#meeting-location_hints-tabs\",\n-      en: \"Location hints\",\n-      es: \"Location hints\",\n-      ca: \"Location hints\"\n-    )\n-    fill_in_i18n_editor(\n-      :meeting_description,\n-      \"#meeting-description-tabs\",\n-      en: \"A longer description\",\n-      es: \"Descripci\u00f3n m\u00e1s larga\",\n-      ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-    )\n+    fill_in_i18n(:meeting_location, \"#meeting-location-tabs\", **attributes[:location].except(\"machine_translations\"))\n+    fill_in_i18n(:meeting_location_hints, \"#meeting-location_hints-tabs\", **attributes[:location_hints].except(\"machine_translations\"))\n+    fill_in_i18n_editor(:meeting_description, \"#meeting-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n     fill_in_geocoding :meeting_address, with: address\n     fill_in_services\n@@ -325,8 +309,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My meeting\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} meeting on the\")\n   end\n \n   context \"when using the front-end geocoder\", :serves_geocoding_autocomplete do"
            },
            {
                "sha": "8c4ac2e9c9913c938a84b003017f7b8063ccf087",
                "filename": "decidim-pages/spec/system/admin_spec.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 9,
                "changes": 17,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-pages%2Fspec%2Fsystem%2Fadmin_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-pages%2Fspec%2Fsystem%2Fadmin_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-pages%2Fspec%2Fsystem%2Fadmin_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -21,25 +21,24 @@\n       visit_component_admin\n     end\n \n-    it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='page-body-tabs']\", \"full\"\n+    let!(:attributes) { attributes_for(:static_page) }\n \n-    it \"updates the page\" do\n-      new_body = {\n-        en: \"<p>New body</p>\",\n-        ca: \"<p>Nou cos</p>\",\n-        es: \"<p>Nuevo cuerpo</p>\"\n-      }\n+    it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='page-body-tabs']\", \"full\"\n \n+    it \"updates the page\", versioning: true do\n       within \"form.edit_page\" do\n-        fill_in_i18n_editor(:page_body, \"#page-body-tabs\", new_body)\n+        fill_in_i18n_editor(:page_body, \"#page-body-tabs\", **attributes[:content].except(\"machine_translations\"))\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       visit_component\n \n-      expect(page).to have_content(\"New body\")\n+      expect(page).to have_content(translated(component.name).upcase)\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(component.name)} page\")\n     end\n   end\n "
            },
            {
                "sha": "3ab702baa78d9e5139b75c23854d13b5dd3b5cc1",
                "filename": "decidim-participatory_processes/app/cells/decidim/participatory_processes/process_m_cell.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fapp%2Fcells%2Fdecidim%2Fparticipatory_processes%2Fprocess_m_cell.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fapp%2Fcells%2Fdecidim%2Fparticipatory_processes%2Fprocess_m_cell.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fapp%2Fcells%2Fdecidim%2Fparticipatory_processes%2Fprocess_m_cell.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -43,7 +43,7 @@ def resource_image_path\n \n       def step_cta_text\n         if translated_in_current_locale?(model.active_step&.cta_text)\n-          translated_attribute(model.active_step.cta_text)\n+          decidim_escape_translated(model.active_step.cta_text)\n         else\n           t(model.cta_button_text_key_accessible, resource_name: title, scope: \"layouts.decidim.participatory_processes.participatory_process\")\n         end"
            },
            {
                "sha": "16a240e2ac47b4387a1caabc38651ea0bc008351",
                "filename": "decidim-participatory_processes/lib/decidim/participatory_processes/test/factories.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Flib%2Fdecidim%2Fparticipatory_processes%2Ftest%2Ffactories.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Flib%2Fdecidim%2Fparticipatory_processes%2Ftest%2Ffactories.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Flib%2Fdecidim%2Fparticipatory_processes%2Ftest%2Ffactories.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -124,6 +124,7 @@\n     end\n     title { generate_localized_title(:participatory_process_step_title, skip_injection: skip_injection) }\n     description { generate_localized_description(:participatory_process_step_description, skip_injection: skip_injection) }\n+    cta_text { generate_localized_description(:participatory_process_step_cta_text, skip_injection: skip_injection) }\n     start_date { 1.month.ago }\n     end_date { 2.months.from_now }\n     position { nil }"
            },
            {
                "sha": "a7f82e3e7909ca281b2f2ec6f96041513ccf7b07",
                "filename": "decidim-participatory_processes/spec/shared/manage_process_admins_examples.rb",
                "status": "modified",
                "additions": 10,
                "deletions": 3,
                "changes": 13,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_admins_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_admins_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_admins_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage process admins examples\" do\n   let(:other_user) { create :user, organization: organization, email: \"my_email@example.org\" }\n+  let(:attributes) { attributes_for(:user, organization: organization) }\n \n   let!(:process_admin) do\n     create :process_admin,\n@@ -23,12 +24,12 @@\n     end\n   end\n \n-  it \"creates a new process admin\" do\n+  it \"creates a new process admin\", versioning: true do\n     find(\".card-title a.new\").click\n \n     within \".new_participatory_process_user_role\" do\n       fill_in :participatory_process_user_role_email, with: other_user.email\n-      fill_in :participatory_process_user_role_name, with: \"John Doe\"\n+      fill_in :participatory_process_user_role_name, with: attributes[:name]\n       select \"Administrator\", from: :participatory_process_user_role_role\n \n       find(\"*[type=submit]\").click\n@@ -39,6 +40,9 @@\n     within \"#process_admins table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited the participant #{other_user.name} to the #{translated(participatory_process.title)} participatory process\")\n   end\n \n   describe \"when managing different users\" do\n@@ -48,7 +52,7 @@\n       visit current_path\n     end\n \n-    it \"updates a process admin\" do\n+    it \"updates a process admin\", versioning: true do\n       within \"#process_admins\" do\n         within find(\"#process_admins tr\", text: other_user.email) do\n           click_link \"Edit\"\n@@ -66,6 +70,9 @@\n       within \"#process_admins table\" do\n         expect(page).to have_content(\"Administrator\")\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"changed the role of the participant #{other_user.name} in the #{translated(participatory_process.title)} participatory process\")\n     end\n \n     it \"deletes a participatory_process_user_role\" do"
            },
            {
                "sha": "f9c278ee478f51452728204de94b9763b5c64fe2",
                "filename": "decidim-participatory_processes/spec/shared/manage_process_steps_examples.rb",
                "status": "modified",
                "additions": 17,
                "deletions": 18,
                "changes": 35,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_steps_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_steps_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_steps_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -9,6 +9,7 @@\n       active: active\n     )\n   end\n+  let(:attributes) { attributes_for(:participatory_process_step, participatory_process: participatory_process) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -21,23 +22,20 @@\n     before { find(\".card-title a.button\").click }\n   end\n \n-  it \"creates a new participatory_process\" do\n+  it \"creates a new participatory_process\", versioning: true do\n     find(\".card-title a.button\").click\n \n     fill_in_i18n(\n       :participatory_process_step_title,\n       \"#participatory_process_step-title-tabs\",\n-      en: \"My participatory process step\",\n-      es: \"Mi fase de proceso participativo\",\n-      ca: \"La meva fase de proc\u00e9s participatiu\"\n+      **attributes[:title].except(\"machine_translations\")\n     )\n     fill_in_i18n_editor(\n       :participatory_process_step_description,\n       \"#participatory_process_step-description-tabs\",\n-      en: \"A longer description\",\n-      es: \"Descripci\u00f3n m\u00e1s larga\",\n-      ca: \"Descripci\u00f3 m\u00e9s llarga\"\n+      **attributes[:description].except(\"machine_translations\")\n     )\n+    fill_in_i18n(:participatory_process_step_cta_text, \"#participatory_process_step-cta_text-tabs\", **attributes[:cta_text].except(\"machine_translations\"))\n \n     page.execute_script(\"$('#participatory_process_step_start_date').focus()\")\n     page.find(\".datepicker-dropdown .day:not(.new)\", text: \"12\").click\n@@ -56,37 +54,38 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#steps table\" do\n-      expect(page).to have_content(\"My participatory process step\")\n+      expect(page).to have_content(translated(attributes[:title]))\n       expect(page).to have_content(\"12,\")\n       expect(page).to have_content(\"22,\")\n     end\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} phase in\")\n   end\n \n-  it \"updates a participatory_process_step\" do\n+  it \"updates a participatory_process_step\", versioning: true do\n     within \"#steps\" do\n       within find(\"tr\", text: translated(process_step.title)) do\n         click_link \"Edit\"\n       end\n     end\n \n     within \".edit_participatory_process_step\" do\n-      fill_in_i18n(\n-        :participatory_process_step_title,\n-        \"#participatory_process_step-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+      fill_in_i18n(:participatory_process_step_title, \"#participatory_process_step-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_step_description, \"#participatory_process_step-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_step_cta_text, \"#participatory_process_step-cta_text-tabs\", **attributes[:cta_text].except(\"machine_translations\"))\n \n       find(\"*[type=submit]\").click\n     end\n \n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#steps table\" do\n-      expect(page).to have_content(\"My new title\")\n-      click_link(\"My new title\")\n+      expect(page).to have_content(translated(attributes[:title]))\n+      click_link(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:title])} phase in\")\n   end\n \n   context \"when deleting a participatory process step\" do"
            },
            {
                "sha": "82f21012cfc273b411bbf34b94313baedee7bab5",
                "filename": "decidim-participatory_processes/spec/shared/manage_processes_examples.rb",
                "status": "modified",
                "additions": 17,
                "deletions": 8,
                "changes": 25,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_processes_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_processes_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_processes_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -88,19 +88,25 @@ def filter_by_group(group_title)\n   context \"when updating a participatory process\" do\n     let(:image3_filename) { \"city3.jpeg\" }\n     let(:image3_path) { Decidim::Dev.asset(image3_filename) }\n+    let(:attributes) { attributes_for(:participatory_process, organization: organization) }\n \n     before do\n       click_link translated(participatory_process.title)\n     end\n \n     it \"updates a participatory_process\" do\n-      fill_in_i18n(\n-        :participatory_process_title,\n-        \"#participatory_process-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+      fill_in_i18n(:participatory_process_title, \"#participatory_process-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_subtitle, \"#participatory_process-subtitle-tabs\", **attributes[:subtitle].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_short_description, \"#participatory_process-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_description, \"#participatory_process-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_announcement, \"#participatory_process-announcement-tabs\", **attributes[:announcement].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_developer_group, \"#participatory_process-developer_group-tabs\", **attributes[:developer_group].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_local_area, \"#participatory_process-local_area-tabs\", **attributes[:local_area].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_meta_scope, \"#participatory_process-meta_scope-tabs\", **attributes[:meta_scope].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_target, \"#participatory_process-target-tabs\", **attributes[:target].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_participatory_scope, \"#participatory_process-participatory_scope-tabs\", **attributes[:participatory_scope].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_participatory_structure, \"#participatory_process-participatory_structure-tabs\", **attributes[:participatory_structure].except(\"machine_translations\"))\n+\n       dynamically_attach_file(:participatory_process_banner_image, image3_path, remove_before: true)\n \n       page.execute_script(\"$('#participatory_process_end_date').focus()\")\n@@ -113,9 +119,12 @@ def filter_by_group(group_title)\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \".container\" do\n-        expect(page).to have_selector(\"input[value='My new title']\")\n+        expect(page).to have_selector(%(input[value=\"#{translated(attributes[:title])}\"]))\n         expect(page).to have_css(\"img[src*='#{image3_filename}']\")\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} participatory process\")\n     end\n   end\n "
            },
            {
                "sha": "dcf83d0bd7b3dfb4377f7846906c3e6938068482",
                "filename": "decidim-participatory_processes/spec/system/admin/admin_manages_participatory_process_groups_spec.rb",
                "status": "modified",
                "additions": 24,
                "deletions": 49,
                "changes": 73,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_groups_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_groups_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_groups_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -8,7 +8,7 @@\n   let!(:participatory_processes) do\n     create_list(:participatory_process, 3, organization: organization)\n   end\n-\n+  let(:attributes) { attributes_for(:participatory_process_group, organization: organization) }\n   let(:image1_filename) { \"city.jpeg\" }\n   let(:image1_path) { Decidim::Dev.asset(image1_filename) }\n \n@@ -22,33 +22,16 @@\n     before { find(\".card-title .new\").click }\n   end\n \n-  it \"creates a new participatory process group\" do\n+  it \"creates a new participatory process group\", versioning: true do\n     find(\".card-title .new\").click\n \n     within \".new_participatory_process_group\" do\n-      fill_in_i18n(\n-        :participatory_process_group_title,\n-        \"#participatory_process_group-title-tabs\",\n-        en: \"My group\",\n-        es: \"Mi grupo\",\n-        ca: \"El meu grup\"\n-      )\n-      fill_in_i18n_editor(\n-        :participatory_process_group_description,\n-        \"#participatory_process_group-description-tabs\",\n-        en: \"A longer description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:participatory_process_group_title, \"#participatory_process_group-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_group_developer_group, \"#participatory_process_group-developer_group-tabs\", **attributes[:developer_group].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_group_description, \"#participatory_process_group-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n       fill_in :participatory_process_group_hashtag, with: \"hashtag\"\n       fill_in :participatory_process_group_group_url, with: \"http://example.org\"\n-      fill_in_i18n(\n-        :participatory_process_group_developer_group,\n-        \"#participatory_process_group-developer_group-tabs\",\n-        en: \"X corporation\",\n-        es: \"La corporaci\u00f3n X\",\n-        ca: \"La corporaci\u00f3 X\"\n-      )\n       select participatory_processes.first.title[\"en\"], from: :participatory_process_group_participatory_process_ids\n     end\n \n@@ -59,12 +42,17 @@\n     end\n \n     expect(page).to have_admin_callout(\"successfully\")\n-    expect(page).to have_field(:participatory_process_group_title_en, with: \"My group\")\n+    expect(page).to have_field(:participatory_process_group_title_en, with: translated(attributes[:title]))\n     expect(page).to have_field(:participatory_process_group_hashtag, with: \"hashtag\")\n     expect(page).to have_field(:participatory_process_group_group_url, with: \"http://example.org\")\n-    expect(page).to have_field(:participatory_process_group_developer_group_en, with: \"X corporation\")\n+    expect(page).to have_field(:participatory_process_group_developer_group_en, with: translated(attributes[:developer_group]))\n     expect(page).to have_select(\"Related processes\", selected: participatory_processes.first.title[\"en\"])\n     expect(page).to have_css(\"img[src*='#{image1_filename}']\")\n+\n+    expect(page).to have_admin_callout(\"successfully\")\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} participatory process group\")\n   end\n \n   context \"with existing groups\" do\n@@ -84,29 +72,13 @@\n       end\n \n       within \".edit_participatory_process_group\" do\n-        fill_in_i18n(\n-          :participatory_process_group_title,\n-          \"#participatory_process_group-title-tabs\",\n-          en: \"My old group\",\n-          es: \"Mi grupo antiguo\",\n-          ca: \"El meu grup antic\"\n-        )\n-        fill_in_i18n_editor(\n-          :participatory_process_group_description,\n-          \"#participatory_process_group-description-tabs\",\n-          en: \"New description\",\n-          es: \"Nueva descripci\u00f3n\",\n-          ca: \"Nova descripci\u00f3\"\n-        )\n+        fill_in_i18n(:participatory_process_group_title, \"#participatory_process_group-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:participatory_process_group_description, \"#participatory_process_group-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n         fill_in :participatory_process_group_hashtag, with: \"new_hashtag\"\n         fill_in :participatory_process_group_group_url, with: \"http://new-example.org\"\n-        fill_in_i18n(\n-          :participatory_process_group_developer_group,\n-          \"#participatory_process_group-developer_group-tabs\",\n-          en: \"Z corporation\",\n-          es: \"La corporaci\u00f3n Z\",\n-          ca: \"La corporaci\u00f3 Z\"\n-        )\n+        fill_in_i18n(:participatory_process_group_developer_group, \"#participatory_process_group-developer_group-tabs\", **attributes[:developer_group].except(\"machine_translations\"))\n+\n         select participatory_processes.last.title[\"en\"], from: :participatory_process_group_participatory_process_ids\n       end\n \n@@ -117,13 +89,16 @@\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_field(:participatory_process_group_title_en, with: \"My old group\")\n-      expect(page).to have_content(\"New description\")\n+      expect(page).to have_field(:participatory_process_group_title_en, with: translated(attributes[:title]))\n+      expect(page).to have_content(strip_tags(translated(attributes[:description])).strip)\n       expect(page).to have_field(:participatory_process_group_hashtag, with: \"new_hashtag\")\n       expect(page).to have_field(:participatory_process_group_group_url, with: \"http://new-example.org\")\n-      expect(page).to have_field(:participatory_process_group_developer_group_en, with: \"Z corporation\")\n+      expect(page).to have_field(:participatory_process_group_developer_group_en, with: translated(attributes[:developer_group]))\n       expect(page).to have_select(\"Related processes\", selected: participatory_processes.last.title[\"en\"])\n       expect(page).to have_css(\"img[src*='#{image2_filename}']\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} participatory process group\")\n     end\n \n     it \"validates the group attributes\" do"
            },
            {
                "sha": "53fed2e8fd4fe2cce7e5b0c080eab221d9422022",
                "filename": "decidim-participatory_processes/spec/system/admin/admin_manages_participatory_process_types_spec.rb",
                "status": "modified",
                "additions": 14,
                "deletions": 17,
                "changes": 31,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_types_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -8,6 +8,7 @@\n   let!(:participatory_processes) do\n     create_list(:participatory_process, 3, organization: organization)\n   end\n+  let(:attributes) { attributes_for(:participatory_process_type, organization: organization) }\n \n   describe \"Managing participatory process types\" do\n     before do\n@@ -16,25 +17,23 @@\n       visit decidim_admin_participatory_processes.participatory_process_types_path\n     end\n \n-    it \"can create new participatory process types\" do\n+    it \"can create new participatory process types\", versioning: true do\n       click_link \"New process type\"\n \n       within \".new_participatory_process_type\" do\n-        fill_in_i18n(\n-          :participatory_process_type_title,\n-          \"#participatory_process_type-title-tabs\",\n-          en: \"My participatory process type\",\n-          es: \"Mi tipo de proceso participativo\",\n-          ca: \"El meu tipus de proc\u00e9s participatiu \"\n-        )\n+        fill_in_i18n(:participatory_process_type_title, \"#participatory_process_type-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My participatory process type\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} participatory process type\")\n     end\n \n     context \"with existing participatory process types\" do\n@@ -56,21 +55,19 @@\n         end\n \n         within \".edit_participatory_process_type\" do\n-          fill_in_i18n(\n-            :participatory_process_type_title,\n-            \"#participatory_process_type-title-tabs\",\n-            en: \"Another participatory process type\",\n-            es: \"Otro tipo de proceso participativo\",\n-            ca: \"Un altre tipus de proc\u00e9s participatiu\"\n-          )\n+          fill_in_i18n(:participatory_process_type_title, \"#participatory_process_type-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+\n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n \n         within \"table\" do\n-          expect(page).to have_content(\"Another participatory process type\")\n+          expect(page).to have_content(translated(attributes[:title]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} participatory process type\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "00841266132b2501266d843baeac0d099b17ed72",
                "filename": "decidim-participatory_processes/spec/system/admin/admin_manages_participatory_processes_spec.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 28,
                "changes": 44,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_processes_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_processes_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_processes_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -24,6 +24,7 @@\n \n     let(:image2_filename) { \"city2.jpeg\" }\n     let(:image2_path) { Decidim::Dev.asset(image2_filename) }\n+    let(:attributes) { attributes_for(:participatory_process, organization: organization) }\n \n     before do\n       click_link \"New process\"\n@@ -35,34 +36,18 @@\n \n     it \"creates a new participatory process\" do\n       within \".new_participatory_process\" do\n-        fill_in_i18n(\n-          :participatory_process_title,\n-          \"#participatory_process-title-tabs\",\n-          en: \"My participatory process\",\n-          es: \"Mi proceso participativo\",\n-          ca: \"El meu proc\u00e9s participatiu\"\n-        )\n-        fill_in_i18n(\n-          :participatory_process_subtitle,\n-          \"#participatory_process-subtitle-tabs\",\n-          en: \"Subtitle\",\n-          es: \"Subt\u00edtulo\",\n-          ca: \"Subt\u00edtol\"\n-        )\n-        fill_in_i18n_editor(\n-          :participatory_process_short_description,\n-          \"#participatory_process-short_description-tabs\",\n-          en: \"Short description\",\n-          es: \"Descripci\u00f3n corta\",\n-          ca: \"Descripci\u00f3 curta\"\n-        )\n-        fill_in_i18n_editor(\n-          :participatory_process_description,\n-          \"#participatory_process-description-tabs\",\n-          en: \"A longer description\",\n-          es: \"Descripci\u00f3n m\u00e1s larga\",\n-          ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-        )\n+        fill_in_i18n(:participatory_process_title, \"#participatory_process-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_subtitle, \"#participatory_process-subtitle-tabs\", **attributes[:subtitle].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:participatory_process_short_description, \"#participatory_process-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:participatory_process_description, \"#participatory_process-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:participatory_process_announcement, \"#participatory_process-announcement-tabs\", **attributes[:announcement].except(\"machine_translations\"))\n+\n+        fill_in_i18n(:participatory_process_developer_group, \"#participatory_process-developer_group-tabs\", **attributes[:developer_group].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_local_area, \"#participatory_process-local_area-tabs\", **attributes[:local_area].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_meta_scope, \"#participatory_process-meta_scope-tabs\", **attributes[:meta_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_target, \"#participatory_process-target-tabs\", **attributes[:target].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_participatory_scope, \"#participatory_process-participatory_scope-tabs\", **attributes[:participatory_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_participatory_structure, \"#participatory_process-participatory_structure-tabs\", **attributes[:participatory_structure].except(\"machine_translations\"))\n \n         group_title = participatory_process_groups.first.title[\"en\"]\n         select group_title, from: :participatory_process_participatory_process_group_id\n@@ -86,6 +71,9 @@\n         expect(page).to have_content(\"Phases\")\n         expect(page).to have_content(\"Introduction\")\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} participatory process\")\n     end\n   end\n "
            },
            {
                "sha": "728bbd12e8eb38d8997d7c8669218b99a7fb9635",
                "filename": "decidim-participatory_processes/spec/types/participatory_process_step_type_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Ftypes%2Fparticipatory_process_step_type_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-participatory_processes%2Fspec%2Ftypes%2Fparticipatory_process_step_type_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Ftypes%2Fparticipatory_process_step_type_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -80,7 +80,7 @@ module ParticipatoryProcesses\n         let(:query) { '{ callToActionText { locales translation(locale:\"en\") } }' }\n \n         it \"returns the step's call to action text\" do\n-          expect(response[\"callToActionText\"][\"locales\"]).to include(*model.cta_text.keys)\n+          expect(response[\"callToActionText\"][\"locales\"]).to include(*model.cta_text.except(\"machine_translations\").keys)\n           expect(response[\"callToActionText\"][\"translation\"]).to eq(model.cta_text[\"en\"])\n         end\n       end"
            },
            {
                "sha": "ab4eedc29ac1d8dfdcf28e0eb9c923073c843af4",
                "filename": "decidim-proposals/app/presenters/decidim/proposals/admin_log/proposal_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 5,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fproposal_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fproposal_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fproposal_presenter.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -15,13 +15,9 @@ module AdminLog\n       class ProposalPresenter < Decidim::Log::BasePresenter\n         private\n \n-        def resource_presenter\n-          @resource_presenter ||= Decidim::Proposals::Log::ResourcePresenter.new(action_log.resource, h, action_log.extra[\"resource\"])\n-        end\n-\n         def diff_fields_mapping\n           {\n-            title: \"Decidim::Proposals::AdminLog::ValueTypes::ProposalTitleBodyPresenter\",\n+            title: :i18n,\n             body: \"Decidim::Proposals::AdminLog::ValueTypes::ProposalTitleBodyPresenter\",\n             state: \"Decidim::Proposals::AdminLog::ValueTypes::ProposalStatePresenter\",\n             answered_at: :date,"
            },
            {
                "sha": "0ef814386db18cc565e33f91332b90ab54a77268",
                "filename": "decidim-proposals/app/presenters/decidim/proposals/admin_log/value_types/proposal_title_body_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -5,12 +5,10 @@ module Proposals\n     module AdminLog\n       module ValueTypes\n         class ProposalTitleBodyPresenter < Decidim::Log::ValueTypes::DefaultPresenter\n-          include Decidim::TranslatableAttributes\n-\n           def present\n             return unless value\n \n-            translated_value = translated_attribute(value)\n+            translated_value = h.decidim_escape_translated(value)\n             return if translated_value.blank?\n \n             renderer = Decidim::ContentRenderers::HashtagRenderer.new(translated_value)"
            },
            {
                "sha": "fbacf6cacd08310329679879bbee757ec8fd3204",
                "filename": "decidim-proposals/app/presenters/decidim/proposals/log/resource_presenter.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 22,
                "changes": 22,
                "blob_url": "https://github.com/decidim/decidim/blob/6f446ff54ed3e8bdb575e0dc50934c5aa4a483b1/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fresource_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/6f446ff54ed3e8bdb575e0dc50934c5aa4a483b1/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fresource_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fresource_presenter.rb?ref=6f446ff54ed3e8bdb575e0dc50934c5aa4a483b1",
                "patch": "@@ -1,22 +0,0 @@\n-# frozen_string_literal: true\n-\n-module Decidim\n-  module Proposals\n-    module Log\n-      class ResourcePresenter < Decidim::Log::ResourcePresenter\n-        private\n-\n-        # Private: Presents resource name.\n-        #\n-        # Returns an HTML-safe String.\n-        def present_resource_name\n-          if resource.present?\n-            Decidim::Proposals::ProposalPresenter.new(resource).title\n-          else\n-            super\n-          end\n-        end\n-      end\n-    end\n-  end\n-end"
            },
            {
                "sha": "bcad1f8180ff95d77ff3d35740cf3c1dfaab6230",
                "filename": "decidim-proposals/app/presenters/decidim/proposals/log/valuation_assignment_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fvaluation_assignment_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fvaluation_assignment_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fvaluation_assignment_presenter.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -11,7 +11,7 @@ class ValuationAssignmentPresenter < Decidim::Log::ResourcePresenter\n         # Returns an HTML-safe String.\n         def present_resource_name\n           if resource.present?\n-            Decidim::Proposals::ProposalPresenter.new(resource.proposal).title\n+            resource.proposal.presenter.title(html_escape: true)\n           else\n             super\n           end"
            },
            {
                "sha": "309e28c4351d8fe5f95cb539a8de6268b048aa6a",
                "filename": "decidim-proposals/lib/decidim/proposals/test/factories.rb",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Flib%2Fdecidim%2Fproposals%2Ftest%2Ffactories.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Flib%2Fdecidim%2Fproposals%2Ftest%2Ffactories.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Flib%2Fdecidim%2Fproposals%2Ftest%2Ffactories.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -433,7 +433,13 @@\n     transient do\n       skip_injection { false }\n     end\n-    body { Faker::Lorem.sentences(number: 3).join(\"\\n\") }\n+    body do\n+      if skip_injection\n+        generate(:title)\n+      else\n+        \"<script>alert(\\\"proposal_note_body\\\");</script> #{generate(:title)}\"\n+      end\n+    end\n     proposal { build(:proposal, skip_injection: skip_injection) }\n     author { build(:user, organization: proposal.organization, skip_injection: skip_injection) }\n   end"
            },
            {
                "sha": "8c8ea06d9c547e971a175fc604b36e98fad3b522",
                "filename": "decidim-proposals/spec/presenters/decidim/log/resource_presenter_spec.rb",
                "status": "renamed",
                "additions": 1,
                "deletions": 6,
                "changes": 7,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,7 +2,7 @@\n \n require \"spec_helper\"\n \n-describe Decidim::Proposals::Log::ResourcePresenter, type: :helper do\n+describe Decidim::Log::ResourcePresenter, type: :helper do\n   let(:presenter) { described_class.new(resource, helper, extra) }\n   let(:resource) { create(:proposal, title: Faker::Book.unique.title) }\n   let(:extra) do\n@@ -12,11 +12,6 @@\n   end\n   let(:resource_path) { Decidim::ResourceLocatorPresenter.new(resource).path }\n \n-  before do\n-    helper.extend(Decidim::ApplicationHelper)\n-    helper.extend(Decidim::TranslationsHelper)\n-  end\n-\n   context \"when the resource exists\" do\n     it \"links to its public page with the name of the proposal\" do\n       html = presenter.present",
                "previous_filename": "decidim-proposals/spec/presenters/decidim/proposals/log/resource_presenter_spec.rb"
            },
            {
                "sha": "6b105536f92abbae48c13575be0c6137110614f3",
                "filename": "decidim-proposals/spec/presenters/decidim/proposals/admin_log/value_types/proposal_title_body_presenter_spec.rb",
                "status": "modified",
                "additions": 10,
                "deletions": 3,
                "changes": 13,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -2,16 +2,23 @@\n \n require \"spec_helper\"\n \n-describe Decidim::Proposals::AdminLog::ValueTypes::ProposalTitleBodyPresenter do\n-  subject { described_class.new(value, _helpers) }\n+describe Decidim::Proposals::AdminLog::ValueTypes::ProposalTitleBodyPresenter, type: :helper do\n+  subject { described_class.new(value, helper) }\n+\n+  before do\n+    module FooBar\n+      include Decidim::SanitizeHelper\n+    end\n+\n+    helper.extend FooBar\n+  end\n \n   let(:value) do\n     {\n       \"en\" => \"My value\",\n       \"es\" => \"My title in Spanish\"\n     }\n   end\n-  let(:_helpers) { nil }\n \n   describe \"#present\" do\n     it \"handles i18n fields\" do"
            },
            {
                "sha": "e5c310186df15d6f709bd3f8888eb990314d42dc",
                "filename": "decidim-proposals/spec/shared/manage_proposals_examples.rb",
                "status": "modified",
                "additions": 9,
                "deletions": 5,
                "changes": 14,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fshared%2Fmanage_proposals_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fshared%2Fmanage_proposals_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fshared%2Fmanage_proposals_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -66,6 +66,8 @@\n         end\n \n         context \"when process is not related to any scope\" do\n+          let(:attributes) { attributes_for(:proposal, component: current_component) }\n+\n           it \"can be related to a scope\" do\n             click_link \"New proposal\"\n \n@@ -74,12 +76,12 @@\n             end\n           end\n \n-          it \"creates a new proposal\", :slow do\n+          it \"creates a new proposal\", versioning: true do\n             click_link \"New proposal\"\n \n             within \".new_proposal\" do\n-              fill_in_i18n :proposal_title, \"#proposal-title-tabs\", en: \"Make decidim great again\"\n-              fill_in_i18n_editor :proposal_body, \"#proposal-body-tabs\", en: \"Decidim is great but it can be better\"\n+              fill_in_i18n :proposal_title, \"#proposal-title-tabs\", **attributes[:title].except(\"machine_translations\")\n+              fill_in_i18n_editor :proposal_body, \"#proposal-body-tabs\", **attributes[:body].except(\"machine_translations\")\n               select translated(category.name), from: :proposal_category_id\n               scope_pick select_data_picker(:proposal_scope_id), scope\n               find(\"*[type=submit]\").click\n@@ -90,11 +92,13 @@\n             within \"table\" do\n               proposal = Decidim::Proposals::Proposal.last\n \n-              expect(page).to have_content(\"Make decidim great again\")\n-              expect(translated(proposal.body)).to eq(\"<p>Decidim is great but it can be better</p>\")\n+              expect(page).to have_content(translated(attributes[:title]))\n+              expect(translated(proposal.body)).to eq(\"<p>#{strip_tags(translated(attributes[:body]))}</p>\")\n               expect(proposal.category).to eq(category)\n               expect(proposal.scope).to eq(scope)\n             end\n+            visit decidim_admin.root_path\n+            expect(page).to have_content(\"created the #{translated(attributes[:title])} proposal\")\n           end\n         end\n "
            },
            {
                "sha": "8ba4a460786fc89a62e19044ba6a862434789271",
                "filename": "decidim-proposals/spec/system/admin/admin_edits_proposal_spec.rb",
                "status": "modified",
                "additions": 10,
                "deletions": 6,
                "changes": 16,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_edits_proposal_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_edits_proposal_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_edits_proposal_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -22,25 +22,29 @@\n   end\n \n   describe \"editing an official proposal\" do\n-    let(:new_title) { \"This is my proposal new title\" }\n-    let(:new_body) { \"This is my proposal new body\" }\n+    let(:attributes) { attributes_for(:proposal, component: current_component) }\n \n     it \"can be updated\" do\n       visit_component_admin\n \n       find(\"a.action-icon--edit-proposal\").click\n       expect(page).to have_content \"Update proposal\"\n \n-      fill_in_i18n :proposal_title, \"#proposal-title-tabs\", en: new_title\n-      fill_in_i18n_editor :proposal_body, \"#proposal-body-tabs\", en: new_body\n+      fill_in_i18n :proposal_title, \"#proposal-title-tabs\", **attributes[:title].except(\"machine_translations\")\n+      fill_in_i18n_editor :proposal_body, \"#proposal-body-tabs\", **attributes[:body].except(\"machine_translations\")\n       click_button \"Update\"\n \n       preview_window = window_opened_by { find(\"a.action-icon--preview\").click }\n \n       within_window preview_window do\n-        expect(page).to have_content(new_title)\n-        expect(page).to have_content(new_body)\n+        expect(page).to have_content(translated(attributes[:title]))\n+        expect(page).to have_content(strip_tags(translated(attributes[:body])).strip)\n       end\n+\n+      expect(page).to have_admin_callout(\"successfully\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} official proposal\")\n     end\n \n     context \"when the proposal has some votes\" do"
            },
            {
                "sha": "2028756a3183326563ef52eafa1d9ef5ed69f31b",
                "filename": "decidim-proposals/spec/system/admin/admin_manages_proposal_valuators_spec.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_proposal_valuators_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_proposal_valuators_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_proposal_valuators_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -52,6 +52,11 @@\n           expect(page).to have_selector(\"td.valuators-count\", text: 1)\n         end\n       end\n+\n+      it \"displays log\" do\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"assigned the #{translated(proposal.title)} proposal to a valuator\")\n+      end\n     end\n   end\n "
            },
            {
                "sha": "be5d4a5a6bfb7ff7eee0711612a9eb38b712360a",
                "filename": "decidim-proposals/spec/system/admin/index_proposal_notes_spec.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 4,
                "changes": 12,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Findex_proposal_notes_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Findex_proposal_notes_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Findex_proposal_notes_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -9,6 +9,7 @@\n   let(:manifest_name) { \"proposals\" }\n   let(:proposal) { create(:proposal, component: component) }\n   let(:participatory_space) { component.participatory_space }\n+  let(:attributes) { attributes_for(:proposal_note) }\n \n   let(:body) { \"New awesome body\" }\n   let(:proposal_notes_count) { 5 }\n@@ -32,24 +33,27 @@\n   it \"shows proposal notes for the current proposal\" do\n     proposal_notes.each do |proposal_note|\n       expect(page).to have_content(proposal_note.author.name)\n-      expect(page).to have_content(proposal_note.body)\n+      expect(page).to have_content(decidim_sanitize_translated(proposal_note.body))\n     end\n     expect(page).to have_selector(\"form\")\n   end\n \n   context \"when the form has a text inside body\" do\n-    it \"creates a proposal note\", :slow do\n+    it \"creates a proposal note\", versioning: true do\n       within \".new_proposal_note\" do\n-        fill_in :proposal_note_body, with: body\n+        fill_in :proposal_note_body, with: attributes[:body]\n \n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \".comment-thread .card:last-child\" do\n-        expect(page).to have_content(\"New awesome body\")\n+        expect(page).to have_content(decidim_sanitize_translated(attributes[:body]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"left a private note on the #{translated(proposal.title)} proposal\")\n     end\n   end\n "
            },
            {
                "sha": "e748fd794029e2aff5d7c4a1d9e7bf42088d1a1e",
                "filename": "decidim-proposals/spec/system/amendable/amendment_diff_spec.rb",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Famendable%2Famendment_diff_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Famendable%2Famendment_diff_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fsystem%2Famendable%2Famendment_diff_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -133,14 +133,14 @@\n     end\n \n     context \"and the proposal author is reviewing an emendation to their proposal before accepting it\" do\n-      let(:user) { proposal.creator_author }\n+      let!(:user) { proposal.creator_author }\n \n       before do\n         proposal.update(title: { en: \"Updated long enough title\" }, body: { en: \"Updated one liner body\" })\n         # The last version of the emendation should hold the amending attribute values.\n         emendation.update(title: { en: \"Amended long enough title\" }, body: { en: \"Amended one liner body\" })\n-        visit emendation_path\n         login_as user, scope: :user\n+        visit emendation_path\n         visit decidim.review_amend_path(amendment)\n       end\n "
            },
            {
                "sha": "803a4a801d82bb20c47cb48b7eba7e3af68d7388",
                "filename": "decidim-proposals/spec/system/collaborative_drafts_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Fcollaborative_drafts_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-proposals%2Fspec%2Fsystem%2Fcollaborative_drafts_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fsystem%2Fcollaborative_drafts_spec.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -91,7 +91,7 @@\n       end\n \n       let(:html_body) { strip_tags(collaborative_draft.body).gsub(/\\n/, \" \").strip }\n-      let(:stripped_body) { %(alert(\"collaborative_draft_body\"); #{html_body}) }\n+      let(:stripped_body) { %(alert('collaborative_draft_body'); #{html_body}) }\n \n       it \"shows the title\" do\n         expect(page).to have_content(collaborative_draft.title)"
            },
            {
                "sha": "4706e96ecd21043c5d74b2cf888ca6e43701ceba",
                "filename": "decidim-sortitions/spec/shared/manage_sortitions_examples.rb",
                "status": "modified",
                "additions": 9,
                "deletions": 23,
                "changes": 32,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-sortitions%2Fspec%2Fshared%2Fmanage_sortitions_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-sortitions%2Fspec%2Fshared%2Fmanage_sortitions_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-sortitions%2Fspec%2Fshared%2Fmanage_sortitions_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -56,37 +56,20 @@\n       let(:sortition_dice) { ::Faker::Number.between(from: 1, to: 6) }\n       let(:sortition_target_items) { ::Faker::Number.between(from: 1, to: 10) }\n       let!(:proposal) { create :proposal, component: proposal_component }\n+      let(:attributes) { attributes_for(:sortition, component: current_component) }\n \n       it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='sortition-additional_info-tabs']\", \"full\"\n       it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='sortition-witnesses-tabs']\", \"content\"\n \n-      it \"shows the sortition details\" do\n+      it \"shows the sortition details\", versioning: true do\n         within \".new_sortition\" do\n           fill_in :sortition_dice, with: sortition_dice\n           fill_in :sortition_target_items, with: sortition_target_items\n           select translated(proposal_component.name), from: :sortition_decidim_proposals_component_id\n-          fill_in_i18n_editor(\n-            :sortition_witnesses,\n-            \"#sortition-witnesses-tabs\",\n-            en: \"Witnesses\",\n-            es: \"Testigos\",\n-            ca: \"Testimonis\"\n-          )\n-          fill_in_i18n_editor(\n-            :sortition_additional_info,\n-            \"#sortition-additional_info-tabs\",\n-            en: \"additional info\",\n-            es: \"Informaci\u00f3n adicional\",\n-            ca: \"Informaci\u00f3 adicional\"\n-          )\n-\n-          fill_in_i18n(\n-            :sortition_title,\n-            \"#sortition-title-tabs\",\n-            en: \"Title\",\n-            es: \"T\u00edtulo\",\n-            ca: \"T\u00edtol\"\n-          )\n+\n+          fill_in_i18n_editor(:sortition_witnesses, \"#sortition-witnesses-tabs\", **attributes[:witnesses].except(\"machine_translations\"))\n+          fill_in_i18n_editor(:sortition_additional_info, \"#sortition-additional_info-tabs\", **attributes[:additional_info].except(\"machine_translations\"))\n+          fill_in_i18n(:sortition_title, \"#sortition-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n           accept_confirm { find(\"*[type=submit]\").click }\n         end\n@@ -114,6 +97,9 @@\n             expect(page).to have_content(translated(p.title))\n           end\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"created the #{translated(attributes[:title])} sortition\")\n       end\n     end\n   end"
            },
            {
                "sha": "1cebd42893b5bde72e917f8be215079a434620ab",
                "filename": "decidim-sortitions/spec/shared/update_sortitions_examples.rb",
                "status": "modified",
                "additions": 7,
                "deletions": 16,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-sortitions%2Fspec%2Fshared%2Fupdate_sortitions_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/ff755e23814aeb56e9089fc08006a5d3faee47b6/decidim-sortitions%2Fspec%2Fshared%2Fupdate_sortitions_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-sortitions%2Fspec%2Fshared%2Fupdate_sortitions_examples.rb?ref=ff755e23814aeb56e9089fc08006a5d3faee47b6",
                "patch": "@@ -3,6 +3,7 @@\n shared_examples \"update sortitions\" do\n   describe \"update sortition data\" do\n     let!(:sortition) { create(:sortition, component: current_component) }\n+    let(:attributes) { attributes_for(:sortition, component: current_component) }\n \n     before do\n       visit_component_admin\n@@ -24,28 +25,18 @@\n     end\n \n     context \"when updates a sortition\" do\n-      it \"Redirects to sortitions view\" do\n+      it \"Redirects to sortitions view\", versioning: true do\n         within \".edit_sortition\" do\n-          fill_in_i18n_editor(\n-            :sortition_additional_info,\n-            \"#sortition-additional_info-tabs\",\n-            en: \"Additional info\",\n-            es: \"Informaci\u00f3n adicional\",\n-            ca: \"Informaci\u00f3 adicional\"\n-          )\n-\n-          fill_in_i18n(\n-            :sortition_title,\n-            \"#sortition-title-tabs\",\n-            en: \"Title\",\n-            es: \"T\u00edtulo\",\n-            ca: \"T\u00edtol\"\n-          )\n+          fill_in_i18n_editor(:sortition_additional_info, \"#sortition-additional_info-tabs\", **attributes[:additional_info].except(\"machine_translations\"))\n+          fill_in_i18n(:sortition_title, \"#sortition-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} sortition\")\n       end\n     end\n   end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/decidim/decidim/commits/23fc8d702a4976727f78617f5e42353d67931645",
        "url": "https://api.github.com/repos/decidim/decidim/commits/23fc8d702a4976727f78617f5e42353d67931645",
        "html_url": "https://github.com/decidim/decidim/commit/23fc8d702a4976727f78617f5e42353d67931645",
        "message": "Backport 'Refactor malformed titles in admin logs (part 2)' to v0.28 (#13083)\n\n* Refactor malformed titles in admin logs (part 2)\r\n\r\n* Refactor admin logs\r\n\r\n* Component presenters\r\n\r\n* Various logs\r\n\r\n* More logs\r\n\r\n* Add logs for moderation\r\n\r\n* Fix spec\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Add missing spec\r\n\r\n---------\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Fix failing specs\r\n\r\n---------\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>",
        "files": [
            {
                "sha": "f62f93bbed95f1d8c87dd9f3d5a01ffd5fcf6b64",
                "filename": "decidim-admin/lib/decidim/admin/test/manage_attachment_collections_examples.rb",
                "status": "modified",
                "additions": 12,
                "deletions": 11,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachment_collections_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachment_collections_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachment_collections_examples.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage attachment collections examples\" do\n   let!(:attachment_collection) { create(:attachment_collection, collection_for:) }\n+  let(:attributes) { attributes_for(:attachment_collection) }\n \n   before do\n     visit current_path\n@@ -30,17 +31,13 @@\n       fill_in_i18n(\n         :attachment_collection_name,\n         \"#attachment_collection-name-tabs\",\n-        en: \"Application forms\",\n-        es: \"Formularios de solicitud\",\n-        ca: \"Formularis de sol\u00b7licitud\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       fill_in_i18n(\n         :attachment_collection_description,\n         \"#attachment_collection-description-tabs\",\n-        en: \"Contains the application forms\",\n-        es: \"Contiene los formularios de solicitud\",\n-        ca: \"Cont\u00e9 els formularis de sol\u00b7licitud\"\n+        **attributes[:description].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -49,8 +46,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#attachment_collections table\" do\n-      expect(page).to have_text(\"Application forms\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:name])} attachment collection\")\n   end\n \n   it \"can update an attachment collection\" do\n@@ -64,9 +64,7 @@\n       fill_in_i18n(\n         :attachment_collection_name,\n         \"#attachment_collection-name-tabs\",\n-        en: \"Latest application forms\",\n-        es: \"\u00daltimos formularios de solicitud\",\n-        ca: \"\u00daltims formularis de sol\u00b7licitud\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -75,8 +73,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#attachment_collections table\" do\n-      expect(page).to have_text(\"Latest application forms\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:name])} attachment collection\")\n   end\n \n   context \"when deleting a attachment collection\" do"
            },
            {
                "sha": "42213caf06ca99b957da657cf99262c146f84df5",
                "filename": "decidim-admin/lib/decidim/admin/test/manage_categories_examples.rb",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_categories_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_categories_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_categories_examples.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -1,6 +1,7 @@\n # frozen_string_literal: true\n \n shared_examples \"manage categories examples\" do\n+  let(:attributes) { attributes_for(:category) }\n   it \"lists all the categories for the process\" do\n     within \"#categories table\" do\n       expect(page).to have_content(translated(category.name, locale: :en))\n@@ -25,9 +26,7 @@\n       fill_in_i18n(\n         :category_name,\n         \"#category-name-tabs\",\n-        en: \"My category\",\n-        es: \"Mi categor\u00eda\",\n-        ca: \"La meva categoria\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -36,8 +35,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#categories table\" do\n-      expect(page).to have_content(\"My category\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"added the #{translated(attributes[:name])} category to the\")\n   end\n \n   it \"updates a category\" do\n@@ -51,9 +53,7 @@\n       fill_in_i18n(\n         :category_name,\n         \"#category-name-tabs\",\n-        en: \"My new name\",\n-        es: \"Mi nuevo nombre\",\n-        ca: \"El meu nou nom\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -62,8 +62,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#categories table\" do\n-      expect(page).to have_content(\"My new name\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:name])} category in the\")\n   end\n \n   context \"when deleting a category\" do"
            },
            {
                "sha": "bed106f957acdddf19a28129ccd6f29d9af55747",
                "filename": "decidim-admin/lib/decidim/admin/test/manage_hide_content_examples.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_hide_content_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_hide_content_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_hide_content_examples.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -54,6 +54,10 @@\n       click_button I18n.t(\"decidim.admin.block_user.new.action\")\n \n       expect(content.reload).to be_hidden\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"blocked user\")\n+      expect(page).to have_content(\"hid a resource of type\")\n     end\n   end\n end"
            },
            {
                "sha": "81761771df991dcfc65636455c8cc760d03a79c9",
                "filename": "decidim-admin/spec/system/admin_manages_help_sections_spec.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_help_sections_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_help_sections_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_help_sections_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -28,6 +28,9 @@\n \n       help_content = Decidim::ContextualHelpSection.find_content(organization, :participatory_processes)\n       expect(help_content).to include(\"en\" => \"<p>Well hello!</p>\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the Participatory processes help section\")\n     end\n \n     it \"destroys the section when it is empty\" do"
            },
            {
                "sha": "f15c9cfccbd149e71721f23ec85fad2fbb435cd8",
                "filename": "decidim-admin/spec/system/admin_manages_newsletters_spec.rb",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_newsletters_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_newsletters_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_newsletters_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -7,6 +7,7 @@\n \n describe \"Admin manages newsletters\" do\n   let(:organization) { create(:organization) }\n+  let!(:attributes) { attributes_for(:newsletter, organization:) }\n   let(:user) { create(:user, :admin, :confirmed, name: \"Sarah Kerrigan\", organization:) }\n   let!(:deliverable_users) { create_list(:user, 5, :confirmed, newsletter_notifications_at: Time.current, organization:) }\n \n@@ -41,9 +42,7 @@\n         fill_in_i18n(\n           :newsletter_subject,\n           \"#newsletter-subject-tabs\",\n-          en: \"A fancy newsletter for %{name}\",\n-          es: \"Un correo electr\u00f3nico muy chulo para %{name}\",\n-          ca: \"Un correu electr\u00f2nic flipant per a %{name}\"\n+          **attributes[:subject].except(\"machine_translations\")\n         )\n \n         fill_in_i18n_editor(\n@@ -82,7 +81,10 @@\n       end\n \n       expect(page).to have_content(\"Preview\")\n-      expect(page).to have_content(\"A fancy newsletter for #{user.name}\")\n+      expect(page).to have_content(translated(attributes[:subject]))\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:subject])} newsletter\")\n     end\n   end\n \n@@ -148,9 +150,7 @@\n         fill_in_i18n(\n           :newsletter_subject,\n           \"#newsletter-subject-tabs\",\n-          en: \"A fancy newsletter\",\n-          es: \"Un correo electr\u00f3nico muy chulo\",\n-          ca: \"Un correu electr\u00f2nic flipant\"\n+          **attributes[:subject].except(\"machine_translations\")\n         )\n \n         fill_in_i18n_editor(\n@@ -165,7 +165,10 @@\n       end\n \n       expect(page).to have_content(\"Preview\")\n-      expect(page).to have_content(\"A fancy newsletter\")\n+      expect(page).to have_content(translated(attributes[:subject]))\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:subject])} newsletter\")\n     end\n   end\n "
            },
            {
                "sha": "fcd7e28ddeb9614511007f4d3c5ead7a596fcf62",
                "filename": "decidim-admin/spec/system/admin_manages_organization_area_types_spec.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 10,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_area_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_area_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_area_types_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -5,6 +5,7 @@\n describe \"Admin manages area types\" do\n   let(:admin) { create(:user, :admin, :confirmed) }\n   let(:organization) { admin.organization }\n+  let(:attributes) { attributes_for(:area_type) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -24,17 +25,13 @@\n       fill_in_i18n(\n         :area_type_name,\n         \"#area_type-name-tabs\",\n-        en: \"Sectorial en\",\n-        es: \"Sectorial es\",\n-        ca: \"Sectorial ca\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       fill_in_i18n(\n         :area_type_plural,\n         \"#area_type-plural-tabs\",\n-        en: \"Sectorials en\",\n-        es: \"Sectoriales es\",\n-        ca: \"Sectorials ca\"\n+        **attributes[:plural].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -43,8 +40,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"Sectorial en\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:name])} area type\")\n   end\n \n   context \"with existing area_types\" do\n@@ -69,22 +69,25 @@\n         fill_in_i18n(\n           :area_type_name,\n           \"#area_type-name-tabs\",\n-          en: \"Not Sectorial en\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         fill_in_i18n(\n           :area_type_plural,\n           \"#area_type-plural-tabs\",\n-          en: \"This is the new pluarl\"\n+          **attributes[:plural].except(\"machine_translations\")\n         )\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"Not Sectorial en\")\n+        expect(page).to have_content(translated(attributes[:name]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:name])} area type\")\n     end\n \n     it \"can delete them\" do"
            },
            {
                "sha": "533cc09521d4154a722f79a875c266d29b8da11d",
                "filename": "decidim-admin/spec/system/admin_manages_organization_areas_spec.rb",
                "status": "modified",
                "additions": 12,
                "deletions": 8,
                "changes": 20,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_areas_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_areas_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_areas_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -7,6 +7,7 @@\n \n   let(:admin) { create(:user, :admin, :confirmed) }\n   let(:organization) { admin.organization }\n+  let(:attributes) { attributes_for(:area) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -26,9 +27,8 @@\n       click_link \"Add\"\n \n       within \".item__edit-form\" do\n-        fill_in_i18n :area_name, \"#area-name-tabs\", en: \"My area\",\n-                                                    es: \"Mi area\",\n-                                                    ca: \"La meva area\"\n+        fill_in_i18n :area_name, \"#area-name-tabs\", **attributes[:name].except(\"machine_translations\")\n+\n         select area_type.name[\"en\"], from: :area_area_type_id\n \n         find(\"*[type=submit]\").click\n@@ -37,8 +37,11 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My area\")\n+        expect(page).to have_content(translated(attributes[:name]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:name])} area\")\n     end\n \n     context \"with existing areas\" do\n@@ -61,17 +64,18 @@\n         end\n \n         within \".item__edit-form\" do\n-          fill_in_i18n :area_name, \"#area-name-tabs\", en: \"Another area\",\n-                                                      es: \"Otra area\",\n-                                                      ca: \"Una altra area\"\n+          fill_in_i18n :area_name, \"#area-name-tabs\", **attributes[:name].except(\"machine_translations\")\n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n \n         within \"table\" do\n-          expect(page).to have_content(\"Another area\")\n+          expect(page).to have_content(translated(attributes[:name]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:name])} area\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "7c7108f2a4cebc18a7bf20d436554c62fa52ed60",
                "filename": "decidim-admin/spec/system/admin_manages_organization_scope_types_spec.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 10,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scope_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scope_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scope_types_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -5,6 +5,7 @@\n describe \"Admin manages scope types\" do\n   let(:admin) { create(:user, :admin, :confirmed) }\n   let(:organization) { admin.organization }\n+  let!(:attributes) { attributes_for(:scope_type) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -24,17 +25,13 @@\n       fill_in_i18n(\n         :scope_type_name,\n         \"#scope_type-name-tabs\",\n-        en: \"Territorial en\",\n-        es: \"Territorial es\",\n-        ca: \"Territorial ca\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       fill_in_i18n(\n         :scope_type_plural,\n         \"#scope_type-plural-tabs\",\n-        en: \"Territorials en\",\n-        es: \"Territoriales es\",\n-        ca: \"Territorials ca\"\n+        **attributes[:plural].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -43,8 +40,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"Territorial en\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:name])} scope type\")\n   end\n \n   context \"with existing scope_types\" do\n@@ -69,22 +69,25 @@\n         fill_in_i18n(\n           :scope_type_name,\n           \"#scope_type-name-tabs\",\n-          en: \"Not Territorial en\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         fill_in_i18n(\n           :scope_type_plural,\n           \"#scope_type-plural-tabs\",\n-          en: \"This is the new pluarl\"\n+          **attributes[:plural].except(\"machine_translations\")\n         )\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"Not Territorial en\")\n+        expect(page).to have_content(translated(attributes[:name]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:name])} scope type\")\n     end\n \n     it \"can delete them\" do"
            },
            {
                "sha": "2a268801b0d3211a977970084d89cb0880530a74",
                "filename": "decidim-admin/spec/system/admin_manages_organization_scopes_spec.rb",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scopes_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scopes_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scopes_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -7,6 +7,7 @@\n \n   let(:admin) { create(:user, :admin, :confirmed) }\n   let(:organization) { admin.organization }\n+  let!(:attributes) { attributes_for(:scope) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -26,9 +27,7 @@\n       click_link \"Add\"\n \n       within \".new_scope\" do\n-        fill_in_i18n :scope_name, \"#scope-name-tabs\", en: \"My nice district\",\n-                                                      es: \"Mi lindo distrito\",\n-                                                      ca: \"El meu bonic barri\"\n+        fill_in_i18n :scope_name, \"#scope-name-tabs\", **attributes[:name].except(\"machine_translations\")\n         fill_in \"Code\", with: \"MY-DISTRICT\"\n         select scope_type.name[\"en\"], from: :scope_scope_type_id\n \n@@ -38,8 +37,11 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My nice district\")\n+        expect(page).to have_content(translated(attributes[:name]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:name])} scope\")\n     end\n \n     context \"with existing scopes\" do\n@@ -55,17 +57,18 @@\n         end\n \n         within \".edit_scope\" do\n-          fill_in_i18n :scope_name, \"#scope-name-tabs\", en: \"Another district\",\n-                                                        es: \"Otro distrito\",\n-                                                        ca: \"Un altre districte\"\n+          fill_in_i18n :scope_name, \"#scope-name-tabs\", **attributes[:name].except(\"machine_translations\")\n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n \n         within \"table\" do\n-          expect(page).to have_content(\"Another district\")\n+          expect(page).to have_content(translated(attributes[:name]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:name])} scope\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "b880c7082afa11c0434356c46000bd37c9179625",
                "filename": "decidim-admin/spec/system/admin_manages_organization_spec.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -6,6 +6,7 @@\n   include ActionView::Helpers::SanitizeHelper\n \n   let(:organization) { create(:organization) }\n+  let(:attributes) { attributes_for(:organization) }\n   let(:user) { create(:user, :admin, :confirmed, organization:) }\n \n   before do\n@@ -17,7 +18,7 @@\n     it \"updates the values from the form\" do\n       visit decidim_admin.edit_organization_path\n \n-      fill_in \"Name\", with: \"My super-uber organization\"\n+      fill_in :organization_name, with: attributes[:name]\n \n       %w(X Facebook Instagram YouTube GitHub).each do |network|\n         within \"#organization_social_handlers\" do\n@@ -38,6 +39,9 @@\n \n       click_button \"Update\"\n       expect(page).to have_content(\"updated successfully\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the organization settings\")\n     end\n \n     it \"marks the comments_max_length as required\" do"
            },
            {
                "sha": "2b243f9760bf556fa95f6daddc9011e91aa786da",
                "filename": "decidim-admin/spec/system/static_pages_spec.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 10,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fstatic_pages_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-admin%2Fspec%2Fsystem%2Fstatic_pages_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fstatic_pages_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -148,6 +148,7 @@\n \n   describe \"Managing pages\" do\n     let!(:topic) { create(:static_page_topic, organization:) }\n+    let(:attributes) { attributes_for(:static_page) }\n \n     before do\n       login_as admin, scope: :user\n@@ -172,17 +173,13 @@\n         fill_in_i18n(\n           :static_page_title,\n           \"#static_page-title-tabs\",\n-          en: \"Welcome to Decidim\",\n-          es: \"Te damos la bienvendida a Decidim\",\n-          ca: \"Et donem la benvinguda a Decidim\"\n+          **attributes[:title].except(\"machine_translations\")\n         )\n \n         fill_in_i18n_editor(\n           :static_page_content,\n           \"#static_page-content-tabs\",\n-          en: \"<p>Some HTML content</p>\",\n-          es: \"<p>Contenido HTML</p>\",\n-          ca: \"<p>Contingut HTML</p>\"\n+          **attributes[:content].except(\"machine_translations\")\n         )\n \n         select topic.title[I18n.locale.to_s], from: :static_page_topic_id\n@@ -192,8 +189,11 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within find(\".card\", text: topic.title[I18n.locale.to_s]) do\n-        expect(page).to have_css(\"tr\", text: \"Welcome to Decidim\")\n+        expect(page).to have_css(\"tr\", text: translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} static page\")\n     end\n \n     context \"with existing pages\" do\n@@ -223,12 +223,12 @@\n           fill_in_i18n(\n             :static_page_title,\n             \"#static_page-title-tabs\",\n-            en: \"Not welcomed anymore\"\n+            **attributes[:title].except(\"machine_translations\")\n           )\n           fill_in_i18n_editor(\n             :static_page_content,\n             \"#static_page-content-tabs\",\n-            en: \"This is the new <strong>content</strong>\"\n+            **attributes[:content].except(\"machine_translations\")\n           )\n           select topic.title[I18n.locale.to_s], from: :static_page_topic_id\n           find(\"*[type=submit]\").click\n@@ -237,8 +237,11 @@\n         expect(page).to have_admin_callout(\"successfully\")\n \n         within find(\".card\", text: topic.title[I18n.locale.to_s]) do\n-          expect(page).to have_css(\"tr\", text: \"Not welcomed anymore\")\n+          expect(page).to have_css(\"tr\", text: translated(attributes[:title]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} static page\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "8b03d191c62c756f74d08538428f71dee1e17c2d",
                "filename": "decidim-assemblies/spec/shared/manage_assembly_components_examples.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 10,
                "changes": 26,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_components_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_components_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_components_examples.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -1,6 +1,8 @@\n # frozen_string_literal: true\n \n shared_examples \"manage assembly components\" do\n+  let!(:attributes) { attributes_for(:component, participatory_space: assembly) }\n+\n   before do\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n@@ -20,9 +22,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My component\",\n-          ca: \"La meva funcionalitat\",\n-          es: \"Mi funcionalitat\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -49,12 +49,17 @@\n \n     it \"is successfully created\" do\n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n+    end\n+\n+    it \"has a successful admin log\" do\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created #{translated(attributes[:name])} in #{translated(assembly.title)}\")\n     end\n \n     context \"and then edit it\" do\n       before do\n-        within find(\"tr\", text: \"My component\") do\n+        within \"tr\", text: translated(attributes[:name]) do\n           click_link \"Configure\"\n         end\n       end\n@@ -103,9 +108,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My updated component\",\n-          ca: \"La meva funcionalitat actualitzada\",\n-          es: \"Mi funcionalidad actualizada\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -120,9 +123,9 @@\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My updated component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n \n-      within find(\"tr\", text: \"My updated component\") do\n+      within \"tr\", text: translated(attributes[:name]) do\n         click_link \"Configure\"\n       end\n \n@@ -133,6 +136,9 @@\n       within \".default-step-settings\" do\n         expect(all(\"input[type=checkbox]\").first).to be_checked\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated #{translated(attributes[:name])} in #{translated(assembly.title)}\")\n     end\n   end\n "
            },
            {
                "sha": "e8b783c57b39758a1dd6eabca301ce420780a0dc",
                "filename": "decidim-assemblies/spec/shared/manage_assembly_private_users_examples.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_private_users_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_private_users_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_private_users_examples.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -35,6 +35,9 @@\n     within \"#private_users table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited #{other_user.name} to be a private participant\")\n   end\n \n   describe \"when import a batch of private users from csv\" do"
            },
            {
                "sha": "590bfe21616903a24cf77bf91873e3831f88137e",
                "filename": "decidim-conferences/spec/shared/manage_conference_components_examples.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 10,
                "changes": 26,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_components_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_components_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_components_examples.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -1,6 +1,8 @@\n # frozen_string_literal: true\n \n shared_examples \"manage conference components\" do\n+  let!(:attributes) { attributes_for(:component, participatory_space: conference) }\n+\n   before do\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n@@ -20,9 +22,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My component\",\n-          ca: \"La meva funcionalitat\",\n-          es: \"Mi funcionalitat\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -49,12 +49,17 @@\n \n     it \"is successfully created\" do\n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n+    end\n+\n+    it \"has a successful admin log\" do\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created #{translated(attributes[:name])} in #{translated(conference.title)}\")\n     end\n \n     context \"and then edit it\" do\n       before do\n-        within find(\"tr\", text: \"My component\") do\n+        within \"tr\", text: translated(attributes[:name]) do\n           click_link \"Configure\"\n         end\n       end\n@@ -103,9 +108,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My updated component\",\n-          ca: \"La meva funcionalitat actualitzada\",\n-          es: \"Mi funcionalidad actualizada\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -120,9 +123,9 @@\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My updated component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n \n-      within find(\"tr\", text: \"My updated component\") do\n+      within \"tr\", text: translated(attributes[:name]) do\n         click_link \"Configure\"\n       end\n \n@@ -133,6 +136,9 @@\n       within \".default-step-settings\" do\n         expect(all(\"input[type=checkbox]\").first).to be_checked\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated #{translated(attributes[:name])} in #{translated(conference.title)}\")\n     end\n   end\n "
            },
            {
                "sha": "d2a5b63c3c45a3b9062c2908db4a6f2cc3498ff1",
                "filename": "decidim-core/app/presenters/decidim/admin_log/organization_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Fadmin_log%2Forganization_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Fadmin_log%2Forganization_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Fadmin_log%2Forganization_presenter.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -26,7 +26,7 @@ def diff_fields_mapping\n \n       def settings_attributes_mapping\n         {\n-          name: :string,\n+          name: :i18n,\n           default_locale: :locale,\n           reference_prefix: :string,\n           twitter_handler: :string,"
            },
            {
                "sha": "4192ed4d98e53a4b4b5303505fa8dbf8516d75be",
                "filename": "decidim-initiatives/spec/system/admin/admin_manages_initiative_components_spec.rb",
                "status": "modified",
                "additions": 15,
                "deletions": 10,
                "changes": 25,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiative_components_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiative_components_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiative_components_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -7,6 +7,7 @@\n   let(:user) { create(:user, :admin, :confirmed, organization:) }\n \n   let!(:initiative) { create(:initiative, organization:) }\n+  let!(:attributes) { attributes_for(:component, participatory_space: initiative) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -28,9 +29,7 @@\n           fill_in_i18n(\n             :component_name,\n             \"#component-name-tabs\",\n-            en: \"My component\",\n-            ca: \"El meu component\",\n-            es: \"Mi componente\"\n+            **attributes[:name].except(\"machine_translations\")\n           )\n \n           within \".global-settings\" do\n@@ -57,12 +56,17 @@\n \n     it \"is successfully created\" do\n       expect(page).to have_admin_callout(\"Component created successfully.\")\n-      expect(page).to have_content(\"My component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n+    end\n+\n+    it \"has a successful admin log\" do\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created #{translated(attributes[:name])} in #{translated(initiative.title)}\")\n     end\n \n     context \"and then edit it\" do\n       before do\n-        within find(\"tr\", text: \"My component\") do\n+        within \"tr\", text: translated(attributes[:name]) do\n           page.find(\".action-icon--configure\").click\n         end\n       end\n@@ -111,9 +115,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My updated component\",\n-          ca: \"El meu component actualitzat\",\n-          es: \"Mi componente actualizado\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -128,9 +130,9 @@\n       end\n \n       expect(page).to have_admin_callout(\"The component was updated successfully.\")\n-      expect(page).to have_content(\"My updated component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n \n-      within find(\"tr\", text: \"My updated component\") do\n+      within \"tr\", text: translated(attributes[:name]) do\n         page.find(\".action-icon--configure\").click\n       end\n \n@@ -141,6 +143,9 @@\n       within \".default-step-settings\" do\n         expect(all(\"input[type=checkbox]\").first).to be_checked\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated #{translated(attributes[:name])} in #{translated(initiative.title)}\")\n     end\n   end\n "
            },
            {
                "sha": "d57ab0c56dfb497b2c79a59db008151dddd5e38d",
                "filename": "decidim-initiatives/spec/system/admin/admin_manages_initiatives_types_spec.rb",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiatives_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiatives_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiatives_types_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -6,6 +6,7 @@\n   let(:organization) { create(:organization) }\n   let(:user) { create(:user, :admin, :confirmed, organization:) }\n   let!(:initiatives_type) { create(:initiatives_type, organization:) }\n+  let(:attributes) { attributes_for(:initiatives_type) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -26,13 +27,13 @@\n       fill_in_i18n(\n         :initiatives_type_title,\n         \"#initiatives_type-title-tabs\",\n-        en: \"My initiative type\"\n+        **attributes[:title].except(\"machine_translations\")\n       )\n \n       fill_in_i18n_editor(\n         :initiatives_type_description,\n         \"#initiatives_type-description-tabs\",\n-        en: \"A longer description\"\n+        **attributes[:description].except(\"machine_translations\")\n       )\n \n       select(\"Online\", from: \"Signature type\")\n@@ -42,6 +43,9 @@\n       click_button \"Create\"\n \n       expect(page).to have_admin_callout(\"A new initiative type has been successfully created\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} initiatives type\")\n     end\n   end\n \n@@ -54,7 +58,12 @@\n       fill_in_i18n(\n         :initiatives_type_title,\n         \"#initiatives_type-title-tabs\",\n-        en: \"My updated initiative type\"\n+        **attributes[:title].except(\"machine_translations\")\n+      )\n+      fill_in_i18n_editor(\n+        :initiatives_type_description,\n+        \"#initiatives_type-description-tabs\",\n+        **attributes[:description].except(\"machine_translations\")\n       )\n \n       select(\"Mixed\", from: \"Signature type\")\n@@ -67,6 +76,9 @@\n       click_button \"Update\"\n \n       expect(page).to have_admin_callout(\"The initiative type has been successfully updated\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} initiatives type\")\n     end\n   end\n "
            },
            {
                "sha": "d9238502476a074ad52c9716411086f3d1995046",
                "filename": "decidim-initiatives/spec/system/admin/update_initiative_spec.rb",
                "status": "modified",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fupdate_initiative_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fupdate_initiative_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fupdate_initiative_spec.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -15,6 +15,8 @@ def submit_and_validate\n \n   context \"when initiative update\" do\n     context \"and user is admin\" do\n+      let(:attributes) { attributes_for(:initiative, organization:) }\n+\n       before do\n         switch_to_host(organization.host)\n         login_as user, scope: :user\n@@ -29,6 +31,25 @@ def submit_and_validate\n         submit_and_validate\n       end\n \n+      it \"updates the initiative\" do\n+        page.find(\".action-icon--edit\").click\n+\n+        fill_in_i18n(\n+          :initiative_title,\n+          \"#initiative-title-tabs\",\n+          **attributes[:title].except(\"machine_translations\")\n+        )\n+        fill_in_i18n_editor(\n+          :initiative_description,\n+          \"#initiative-description-tabs\",\n+          **attributes[:description].except(\"machine_translations\")\n+        )\n+        submit_and_validate\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} initiative\")\n+      end\n+\n       context \"when initiative is in created state\" do\n         before do\n           initiative.created!"
            },
            {
                "sha": "cff283cbad5ddd4ddc0798dfee195481c2e9a37e",
                "filename": "decidim-participatory_processes/spec/shared/manage_participatory_process_private_users_examples.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_participatory_process_private_users_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_participatory_process_private_users_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_participatory_process_private_users_examples.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -35,6 +35,9 @@\n     within \"#private_users table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited #{other_user.name} to be a private participant\")\n   end\n \n   describe \"when import a batch of private users from csv\" do"
            },
            {
                "sha": "8c96819644cdbf8cc4d5c6944ca03e23702978bc",
                "filename": "decidim-participatory_processes/spec/shared/manage_process_components_examples.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 10,
                "changes": 26,
                "blob_url": "https://github.com/decidim/decidim/blob/23fc8d702a4976727f78617f5e42353d67931645/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_components_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/23fc8d702a4976727f78617f5e42353d67931645/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_components_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_components_examples.rb?ref=23fc8d702a4976727f78617f5e42353d67931645",
                "patch": "@@ -4,6 +4,8 @@\n   let!(:participatory_process) do\n     create(:participatory_process, :with_steps, organization:)\n   end\n+  let!(:attributes) { attributes_for(:component, participatory_space: participatory_process) }\n+\n   let(:step_id) { participatory_process.steps.first.id }\n \n   before do\n@@ -30,9 +32,7 @@\n           fill_in_i18n(\n             :component_name,\n             \"#component-name-tabs\",\n-            en: \"My component\",\n-            ca: \"La meva funcionalitat\",\n-            es: \"Mi funcionalitat\"\n+            **attributes[:name].except(\"machine_translations\")\n           )\n \n           within \".global-settings\" do\n@@ -59,12 +59,17 @@\n \n       it \"is successfully created\" do\n         expect(page).to have_admin_callout(\"successfully\")\n-        expect(page).to have_content(\"My component\")\n+        expect(page).to have_content(translated(attributes[:name]))\n+      end\n+\n+      it \"has a successful admin log\" do\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"created #{translated(attributes[:name])} in #{translated(participatory_process.title)}\")\n       end\n \n       context \"and then edit it\" do\n         before do\n-          within find(\"tr\", text: \"My component\") do\n+          within \"tr\", text: translated(attributes[:name]) do\n             click_link \"Configure\"\n           end\n         end\n@@ -194,9 +199,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My updated component\",\n-          ca: \"La meva funcionalitat actualitzada\",\n-          es: \"Mi funcionalidad actualizada\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -211,9 +214,9 @@\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My updated component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n \n-      within find(\"tr\", text: \"My updated component\") do\n+      within \"tr\", text: translated(attributes[:name]) do\n         click_link \"Configure\"\n       end\n \n@@ -224,6 +227,9 @@\n       within \".step-settings\" do\n         expect(all(\"input[type=checkbox]\").first).to be_checked\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated #{translated(attributes[:name])} in #{translated(participatory_process.title)}\")\n     end\n \n     context \"when the process does not have active steps\" do"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/decidim/decidim/commits/e494235d559be13dd1f8694345e6f6bba762d1c0",
        "url": "https://api.github.com/repos/decidim/decidim/commits/e494235d559be13dd1f8694345e6f6bba762d1c0",
        "html_url": "https://github.com/decidim/decidim/commit/e494235d559be13dd1f8694345e6f6bba762d1c0",
        "message": "Backport 'Refactor malformed titles in admin logs (part 1)' to v0.28 (#13082)\n\n* Refactor malformed titles in admin logs (part 1)\r\n\r\n* Fix admin logs\r\n\r\n* Properly escape log entries\r\n\r\n* Add debates Presenter\r\n\r\n* Remove AdminLog::DebatePresenter\r\n\r\n* Fix presenter usage\r\n\r\n* More cleanup\r\n\r\n* Running linters\r\n\r\n* Fix specs\r\n\r\n* Running linters\r\n\r\n* Add admin log entries\r\n\r\n* Add admin logs specs\r\n\r\n* Fix specs\r\n\r\n* Proposals and sortitions\r\n\r\n* Fix pipeline\r\n\r\n* Fix pipeline\r\n\r\n* Add participatory process pages\r\n\r\n* More logs\r\n\r\n* Refactor\r\n\r\n* lint\r\n\r\n* Refactor\r\n\r\n* Finalize the assembly types\r\n\r\n* more refactor\r\n\r\n* Fix blogs\r\n\r\n* fix decidim-conferences\r\n\r\n* Reformat the code\r\n\r\n* update specs\r\n\r\n* Refactor\r\n\r\n* Running rubocops\r\n\r\n* Fix meetings specs\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Apply review recommendation\r\n\r\n* Fix spec\r\n\r\n* Fix specs\r\n\r\n* Fix blogs specs\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Lint\r\n\r\n---------\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Fix failing specs\r\n\r\n---------\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>",
        "files": [
            {
                "sha": "fb66a44729f6f8426071f5ee8b84485f39153f41",
                "filename": "decidim-accountability/spec/shared/manage_results_examples.rb",
                "status": "modified",
                "additions": 14,
                "deletions": 23,
                "changes": 37,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-accountability%2Fspec%2Fshared%2Fmanage_results_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-accountability%2Fspec%2Fshared%2Fmanage_results_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-accountability%2Fspec%2Fshared%2Fmanage_results_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -31,20 +31,15 @@\n   context \"when having existing proposals\" do\n     let!(:proposal_component) { create(:proposal_component, participatory_space:) }\n     let!(:proposals) { create_list(:proposal, 5, component: proposal_component) }\n+    let(:attributes) { attributes_for(:result, component: current_component) }\n \n     it \"updates a result\" do\n       within find(\"tr\", text: translated(result.title)) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_result\" do\n-        fill_in_i18n(\n-          :result_title,\n-          \"#result-title-tabs\",\n-          en: \"My new title\",\n-          es: \"Mi nuevo t\u00edtulo\",\n-          ca: \"El meu nou t\u00edtol\"\n-        )\n+        fill_in_i18n(:result_title, \"#result-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n         tom_select(\"#proposals_list\", option_id: proposals.first(2).map(&:id))\n \n@@ -54,28 +49,20 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My new title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated result\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n \n     it \"creates a new result\", :slow do\n       click_link \"New result\", match: :first\n \n       within \".new_result\" do\n-        fill_in_i18n(\n-          :result_title,\n-          \"#result-title-tabs\",\n-          en: \"My result\",\n-          es: \"Mi result\",\n-          ca: \"El meu result\"\n-        )\n-        fill_in_i18n_editor(\n-          :result_description,\n-          \"#result-description-tabs\",\n-          en: \"A longer description\",\n-          es: \"Descripci\u00f3n m\u00e1s larga\",\n-          ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-        )\n+        fill_in_i18n(:result_title, \"#result-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:result_description, \"#result-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n         tom_select(\"#proposals_list\", option_id: proposals.first(2).map(&:id))\n \n@@ -88,8 +75,12 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My result\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created result\")\n+      expect(page).to have_content(attributes[:title][\"en\"])\n     end\n   end\n "
            },
            {
                "sha": "55b632b97ea027172c060a32414497cbaea7c41d",
                "filename": "decidim-accountability/spec/shared/manage_statuses_examples.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 20,
                "changes": 33,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-accountability%2Fspec%2Fshared%2Fmanage_statuses_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-accountability%2Fspec%2Fshared%2Fmanage_statuses_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-accountability%2Fspec%2Fshared%2Fmanage_statuses_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -1,6 +1,8 @@\n # frozen_string_literal: true\n \n RSpec.shared_examples \"manage statuses\" do\n+  let(:attributes) { attributes_for(:status) }\n+\n   it \"updates a status\" do\n     within find(\"tr\", text: status.key) do\n       click_link \"Edit\"\n@@ -10,9 +12,7 @@\n       fill_in_i18n(\n         :status_name,\n         \"#status-name-tabs\",\n-        en: \"My new name\",\n-        es: \"Mi nuevo nombre\",\n-        ca: \"El meu nou nom\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -21,8 +21,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My new name\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:name])} status\")\n   end\n \n   it \"creates a new status\" do\n@@ -31,21 +34,8 @@\n     within \".new_status\" do\n       fill_in :status_key, with: \"status_key_1\"\n \n-      fill_in_i18n(\n-        :status_name,\n-        \"#status-name-tabs\",\n-        en: \"A longer name\",\n-        es: \"Nombre m\u00e1s larga\",\n-        ca: \"Nom m\u00e9s llarga\"\n-      )\n-\n-      fill_in_i18n(\n-        :status_description,\n-        \"#status-description-tabs\",\n-        en: \"A longer description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:status_name, \"#status-name-tabs\", **attributes[:name].except(\"machine_translations\"))\n+      fill_in_i18n(:status_description, \"#status-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n       fill_in :status_progress, with: 75\n \n@@ -56,8 +46,11 @@\n \n     within \"table\" do\n       expect(page).to have_content(\"status_key_1\")\n-      expect(page).to have_content(\"A longer name\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:name])} status\")\n   end\n \n   describe \"deleting a result\" do"
            },
            {
                "sha": "2857db3df1b4bee2523b519ed16402ba4b99b241",
                "filename": "decidim-accountability/spec/shared/manage_timeline_examples.rb",
                "status": "added",
                "additions": 48,
                "deletions": 0,
                "changes": 48,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-accountability%2Fspec%2Fshared%2Fmanage_timeline_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-accountability%2Fspec%2Fshared%2Fmanage_timeline_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-accountability%2Fspec%2Fshared%2Fmanage_timeline_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -0,0 +1,48 @@\n+# frozen_string_literal: true\n+\n+RSpec.shared_examples \"manage timeline\" do\n+  let(:attributes) { attributes_for(:timeline_entry, result:) }\n+\n+  it \"updates a timeline entry\", versioning: true do\n+    visit current_path\n+    click_on \"Edit\", match: :first\n+\n+    within \".edit_timeline_entry\" do\n+      fill_in :timeline_entry_entry_date, with: Date.current.strftime(\"%d/%m/%Y\")\n+      fill_in_i18n(:timeline_entry_title, \"#timeline_entry-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:timeline_entry_description, \"#timeline_entry-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n+      find(\"*[type=submit]\").click\n+    end\n+\n+    expect(page).to have_admin_callout(\"successfully\")\n+\n+    within \"table\" do\n+      expect(page).to have_content(translated(attributes[:title]))\n+    end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:title])} timeline entry\")\n+  end\n+\n+  it \"creates a timeline entry\", versioning: true do\n+    click_on \"New timeline entry\", match: :first\n+\n+    within \".new_timeline_entry\" do\n+      fill_in :timeline_entry_entry_date, with: Date.current.strftime(\"%d/%m/%Y\")\n+      fill_in_i18n(:timeline_entry_title, \"#timeline_entry-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:timeline_entry_description, \"#timeline_entry-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n+      find(\"*[type=submit]\").click\n+    end\n+\n+    expect(page).to have_admin_callout(\"successfully\")\n+\n+    within \"table\" do\n+      expect(page).to have_content(translated(attributes[:title]))\n+    end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} timeline entry\")\n+  end\n+end"
            },
            {
                "sha": "ccfed9fb4078c66e55bbb666a2b08af0302e3cbd",
                "filename": "decidim-accountability/spec/system/admin/admin_manages_accountability_spec.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-accountability%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_accountability_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-accountability%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_accountability_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-accountability%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_accountability_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -35,4 +35,17 @@\n \n     it_behaves_like \"manage statuses\"\n   end\n+\n+  describe \"timeline\" do\n+    before do\n+      visit_component_admin\n+      within \"tr\", text: translated(result.title) do\n+        click_on \"Project evolution\"\n+      end\n+    end\n+\n+    let!(:timeline_entry) { create(:timeline_entry, result:) }\n+\n+    it_behaves_like \"manage timeline\"\n+  end\n end"
            },
            {
                "sha": "4d494fc608c26656c1c6c846363a9277c53d6ecd",
                "filename": "decidim-assemblies/spec/shared/manage_assemblies_examples.rb",
                "status": "modified",
                "additions": 28,
                "deletions": 15,
                "changes": 43,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assemblies_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assemblies_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assemblies_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -6,40 +6,53 @@\n     let(:image3_path) { Decidim::Dev.asset(image3_filename) }\n \n     let(:assembly_parent_id_options) { page.find(\"#assembly_parent_id\").find_all(\"option\").map(&:value) }\n+    let(:attributes) { attributes_for(:assembly, :with_content_blocks, organization:, blocks_manifests: [:announcement]) }\n \n     before do\n       click_link \"Configure\"\n     end\n \n     it \"updates an assembly\" do\n-      fill_in_i18n(\n-        :assembly_title,\n-        \"#assembly-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+      fill_in_i18n(:assembly_title, \"#assembly-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n       dynamically_attach_file(:assembly_banner_image, image3_path, remove_before: true)\n \n       within \".edit_assembly\" do\n         expect(assembly_parent_id_options).not_to include(assembly.id)\n-        fill_in \"assembly[creation_date]\", with: Date.yesterday\n-        fill_in \"assembly[included_at]\", with: Date.current\n-        fill_in \"assembly[duration]\", with: Date.tomorrow\n-        fill_in \"assembly[closing_date]\", with: Date.tomorrow\n+        fill_in_i18n(:assembly_subtitle, \"#assembly-subtitle-tabs\", **attributes[:subtitle].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_short_description, \"#assembly-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_description, \"#assembly-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_purpose_of_action, \"#assembly-purpose_of_action-tabs\", **attributes[:purpose_of_action].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_composition, \"#assembly-composition-tabs\", **attributes[:composition].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_internal_organisation, \"#assembly-internal_organisation-tabs\", **attributes[:internal_organisation].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_announcement, \"#assembly-announcement-tabs\", **attributes[:announcement].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_closing_date_reason, \"#assembly-closing_date_reason-tabs\", **attributes[:closing_date_reason].except(\"machine_translations\"))\n+\n+        fill_in_i18n(:assembly_participatory_scope, \"#assembly-participatory_scope-tabs\", **attributes[:participatory_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_participatory_structure, \"#assembly-participatory_structure-tabs\", **attributes[:participatory_structure].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_meta_scope, \"#assembly-meta_scope-tabs\", **attributes[:meta_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_local_area, \"#assembly-local_area-tabs\", **attributes[:local_area].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_target, \"#assembly-target-tabs\", **attributes[:target].except(\"machine_translations\"))\n+\n+        fill_in :assembly_creation_date, with: Date.yesterday.strftime(\"%d/%m/%Y\"), fill_options: { clear: :backspace }\n+        fill_in :assembly_included_at, with: Date.current.strftime(\"%d/%m/%Y\"), fill_options: { clear: :backspace }\n+        fill_in :assembly_duration, with: Date.tomorrow.strftime(\"%d/%m/%Y\"), fill_options: { clear: :backspace }\n+        fill_in :assembly_closing_date, with: Date.tomorrow.strftime(\"%d/%m/%Y\"), fill_options: { clear: :backspace }\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"[data-content]\" do\n-        expect(page).to have_selector(\"input[value='My new title']\")\n+        expect(page).to have_selector(\"input[value='#{translated(attributes[:title])}']\")\n         expect(page).to have_css(\"img[src*='#{image3_filename}']\")\n-        expect(page).to have_css(\"input[value='#{Date.yesterday}']\")\n-        expect(page).to have_css(\"input[value='#{Date.current}']\")\n-        expect(page).to have_css(\"input[value='#{Date.tomorrow}']\", count: 2)\n+        expect(page).to have_css(\"input[value='#{Date.yesterday.strftime(\"%Y-%d-%m\")}']\")\n+        expect(page).to have_css(\"input[value='#{Date.current.strftime(\"%Y-%d-%m\")}']\")\n+        expect(page).to have_css(\"input[value='#{Date.tomorrow.strftime(\"%Y-%d-%m\")}']\", count: 2)\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} assembly\")\n     end\n   end\n "
            },
            {
                "sha": "922e0163ebdbdc6b18f9159fb92518f145feb91a",
                "filename": "decidim-assemblies/spec/shared/manage_assembly_admins_examples.rb",
                "status": "modified",
                "additions": 9,
                "deletions": 3,
                "changes": 12,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_admins_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_admins_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_admins_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage assembly admins examples\" do\n   let(:other_user) { create(:user, organization:, email: \"my_email@example.org\") }\n+  let(:attributes) { attributes_for(:user, organization:) }\n \n   let!(:assembly_admin) do\n     create(:assembly_admin,\n@@ -25,12 +26,12 @@\n     end\n   end\n \n-  it \"creates a new assembly admin\" do\n+  it \"creates a new assembly admin\", versioning: true do\n     click_link \"New assembly admin\"\n \n     within \".new_assembly_user_role\" do\n       fill_in :assembly_user_role_email, with: other_user.email\n-      fill_in :assembly_user_role_name, with: \"John Doe\"\n+      fill_in :assembly_user_role_name, with: attributes[:name]\n       select \"Administrator\", from: :assembly_user_role_role\n \n       find(\"*[type=submit]\").click\n@@ -41,6 +42,9 @@\n     within \"#assembly_admins table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited #{other_user.name} to the #{translated(assembly.title)} assembly\")\n   end\n \n   describe \"when managing different users\" do\n@@ -49,7 +53,7 @@\n       visit current_path\n     end\n \n-    it \"updates an assembly admin\" do\n+    it \"updates an assembly admin\", versioning: true do\n       within \"#assembly_admins\" do\n         within find(\"#assembly_admins tr\", text: other_user.email) do\n           click_link \"Edit\"\n@@ -67,6 +71,8 @@\n       within \"#assembly_admins table\" do\n         expect(page).to have_content(\"Collaborator\")\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"changed the role of #{other_user.name} in the #{translated(assembly.title)} assembly\")\n     end\n \n     it \"deletes an assembly_user_role\" do"
            },
            {
                "sha": "83c567d371355839d86373e3ddf124bdc6d7fc59",
                "filename": "decidim-assemblies/spec/shared/manage_assembly_members_examples.rb",
                "status": "modified",
                "additions": 18,
                "deletions": 12,
                "changes": 30,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_members_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_members_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_members_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -12,17 +12,17 @@\n \n   context \"without existing user\" do\n     let!(:assembly_member) { create(:assembly_member, assembly:) }\n+    let(:attributes) { attributes_for(:assembly_member, assembly:) }\n \n-    it \"creates a new assembly member\" do\n+    it \"creates a new assembly member\", versioning: true do\n       click_link \"New assembly member\"\n \n       fill_in :assembly_member_designation_date, with: Time.current\n \n       within \".new_assembly_member\" do\n-        fill_in(\n-          :assembly_member_full_name,\n-          with: \"Daisy O'connor\"\n-        )\n+        fill_in(:assembly_member_full_name, with: attributes[:full_name])\n+        fill_in(:assembly_member_gender, with: attributes[:gender])\n+        fill_in(:assembly_member_birthplace, with: attributes[:birthplace])\n       end\n \n       dynamically_attach_file(:assembly_member_non_user_avatar, Decidim::Dev.asset(\"avatar.jpg\")) do\n@@ -39,8 +39,11 @@\n       expect(page).to have_current_path decidim_admin_assemblies.assembly_members_path(assembly)\n \n       within \"#assembly_members table\" do\n-        expect(page).to have_content(\"Daisy O'connor\")\n+        expect(page).to have_content(attributes[:full_name])\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{attributes[:full_name]} member\")\n     end\n   end\n \n@@ -98,6 +101,7 @@\n \n   describe \"when managing other assembly members\" do\n     let!(:assembly_member) { create(:assembly_member, assembly:) }\n+    let(:attributes) { attributes_for(:assembly_member, assembly:) }\n \n     before do\n       visit current_path\n@@ -109,16 +113,15 @@\n       end\n     end\n \n-    it \"updates an assembly member\" do\n+    it \"updates an assembly member\", versioning: true do\n       within find(\"#assembly_members tr\", text: assembly_member.full_name) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_assembly_member\" do\n-        fill_in(\n-          :assembly_member_full_name,\n-          with: \"Alicia O'connor\"\n-        )\n+        fill_in(:assembly_member_full_name, with: attributes[:full_name])\n+        fill_in(:assembly_member_gender, with: attributes[:gender])\n+        fill_in(:assembly_member_birthplace, with: attributes[:birthplace])\n \n         find(\"*[type=submit]\").click\n       end\n@@ -127,8 +130,11 @@\n       expect(page).to have_current_path decidim_admin_assemblies.assembly_members_path(assembly)\n \n       within \"#assembly_members table\" do\n-        expect(page).to have_content(\"Alicia O'connor\")\n+        expect(page).to have_content(attributes[:full_name])\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{assembly_member.full_name} member\")\n     end\n \n     it \"deletes the assembly member\" do"
            },
            {
                "sha": "7f68f2f7287784462bec68216b86bc9623749b40",
                "filename": "decidim-assemblies/spec/system/admin/admin_manages_assemblies_spec.rb",
                "status": "modified",
                "additions": 21,
                "deletions": 30,
                "changes": 51,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -45,6 +45,7 @@\n \n     let(:image2_filename) { \"city2.jpeg\" }\n     let(:image2_path) { Decidim::Dev.asset(image2_filename) }\n+    let(:attributes) { attributes_for(:assembly, :with_content_blocks, organization:, blocks_manifests: [:announcement]) }\n \n     before do\n       click_link \"New assembly\"\n@@ -56,36 +57,23 @@\n \n     it_behaves_like \"having a rich text editor for field\", \"#closing_date_reason_div\", \"content\"\n \n-    it \"creates a new assembly\" do\n+    it \"creates a new assembly\", versioning: true do\n       within \".new_assembly\" do\n-        fill_in_i18n(\n-          :assembly_title,\n-          \"#assembly-title-tabs\",\n-          en: \"My assembly\",\n-          es: \"Mi proceso participativo\",\n-          ca: \"El meu proc\u00e9s participatiu\"\n-        )\n-        fill_in_i18n(\n-          :assembly_subtitle,\n-          \"#assembly-subtitle-tabs\",\n-          en: \"Subtitle\",\n-          es: \"Subt\u00edtulo\",\n-          ca: \"Subt\u00edtol\"\n-        )\n-        fill_in_i18n_editor(\n-          :assembly_short_description,\n-          \"#assembly-short_description-tabs\",\n-          en: \"Short description\",\n-          es: \"Descripci\u00f3n corta\",\n-          ca: \"Descripci\u00f3 curta\"\n-        )\n-        fill_in_i18n_editor(\n-          :assembly_description,\n-          \"#assembly-description-tabs\",\n-          en: \"A longer description\",\n-          es: \"Descripci\u00f3n m\u00e1s larga\",\n-          ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-        )\n+        fill_in_i18n(:assembly_title, \"#assembly-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_subtitle, \"#assembly-subtitle-tabs\", **attributes[:subtitle].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_short_description, \"#assembly-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_description, \"#assembly-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_purpose_of_action, \"#assembly-purpose_of_action-tabs\", **attributes[:purpose_of_action].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_composition, \"#assembly-composition-tabs\", **attributes[:composition].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_internal_organisation, \"#assembly-internal_organisation-tabs\", **attributes[:internal_organisation].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_announcement, \"#assembly-announcement-tabs\", **attributes[:announcement].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:assembly_closing_date_reason, \"#assembly-closing_date_reason-tabs\", **attributes[:closing_date_reason].except(\"machine_translations\"))\n+\n+        fill_in_i18n(:assembly_participatory_scope, \"#assembly-participatory_scope-tabs\", **attributes[:participatory_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_participatory_structure, \"#assembly-participatory_structure-tabs\", **attributes[:participatory_structure].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_meta_scope, \"#assembly-meta_scope-tabs\", **attributes[:meta_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_local_area, \"#assembly-local_area-tabs\", **attributes[:local_area].except(\"machine_translations\"))\n+        fill_in_i18n(:assembly_target, \"#assembly-target-tabs\", **attributes[:target].except(\"machine_translations\"))\n \n         fill_in :assembly_slug, with: \"slug\"\n         fill_in :assembly_hashtag, with: \"#hashtag\"\n@@ -103,8 +91,11 @@\n \n       within \"[data-content]\" do\n         expect(page).to have_current_path decidim_admin_assemblies.assemblies_path(q: { parent_id_eq: parent_assembly&.id })\n-        expect(page).to have_content(\"My assembly\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} assembly\")\n     end\n   end\n "
            },
            {
                "sha": "c3b48b1cf9a1abda0a0618869a189103e05bd726",
                "filename": "decidim-assemblies/spec/system/admin/admin_manages_assemblies_types_spec.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 18,
                "changes": 34,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_assemblies_types_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,11 +2,10 @@\n \n require \"spec_helper\"\n \n-describe \"Admin manages assemblies\" do\n-  include Decidim::SanitizeHelper\n-\n+describe \"Admin manages assemblies types\" do\n   let(:admin) { create(:user, :admin, :confirmed) }\n   let(:organization) { admin.organization }\n+  let(:attributes) { attributes_for(:assemblies_type) }\n \n   describe \"Managing assemblies types\" do\n     before do\n@@ -15,27 +14,25 @@\n       visit decidim_admin_assemblies.assemblies_types_path\n     end\n \n-    it \"can create new assemblies types\" do\n+    it \"can create new assemblies types\", versioning: true do\n       within \"[data-content]\" do\n         click_link \"New assembly type\"\n \n         within \".new_assembly_type\" do\n-          fill_in_i18n(\n-            :assemblies_type_title,\n-            \"#assemblies_type-title-tabs\",\n-            en: \"My assembly type\",\n-            es: \"Mi assembly type\",\n-            ca: \"La meva assembly type\"\n-          )\n+          fill_in_i18n(:assemblies_type_title, \"#assemblies_type-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+\n           find(\"*[type=submit]\").click\n         end\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My assembly type\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} assembly type\")\n     end\n \n     context \"with existing assemblies types\" do\n@@ -51,23 +48,24 @@\n         end\n       end\n \n-      it \"can edit them\" do\n-        within find(\"tr\", text: translated(assembly_type.title)) do\n+      it \"can edit them\", versioning: true do\n+        within \"tr\", text: translated(assembly_type.title) do\n           click_link \"Edit\"\n         end\n \n         within \".edit_assembly_type\" do\n-          fill_in_i18n :assemblies_type_title, \"#assemblies_type-title-tabs\", en: \"Another assembly type\",\n-                                                                              es: \"Otra assembly type\",\n-                                                                              ca: \"Una altra assembly type\"\n+          fill_in_i18n :assemblies_type_title, \"#assemblies_type-title-tabs\", **attributes[:title].except(\"machine_translations\")\n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n \n         within \"table\" do\n-          expect(page).to have_content(\"Another assembly type\")\n+          expect(page).to have_content(translated(attributes[:title]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} assembly type\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "b6fb1e6a47a973519de5f57f94f2a1a1903b55e0",
                "filename": "decidim-blogs/spec/shared/manage_posts_examples.rb",
                "status": "modified",
                "additions": 22,
                "deletions": 34,
                "changes": 56,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-blogs%2Fspec%2Fshared%2Fmanage_posts_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-blogs%2Fspec%2Fshared%2Fmanage_posts_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-blogs%2Fspec%2Fshared%2Fmanage_posts_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -1,67 +1,50 @@\n # frozen_string_literal: true\n \n-shared_examples \"manage posts\" do\n+# we really need the audit_check variable, as it seems that a process admin should not be able to see the admin logs\n+# Therefore, as long we do have the logs checks in this shared example, we need to have the config flag.\n+shared_examples \"manage posts\" do |audit_check: true|\n   it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='post-body-tabs']\", \"full\" do\n     before do\n       within find(\"tr\", text: translated(post1.title)) do\n         click_link \"Edit\"\n       end\n     end\n   end\n+  let(:attributes) { attributes_for(:post) }\n \n-  it \"updates a post\" do\n+  it \"updates a post\", versioning: true do\n     within find(\"tr\", text: translated(post1.title)) do\n       click_link \"Edit\"\n     end\n \n     within \".edit_post\" do\n       expect(page).to have_select(\"post_decidim_author_id\", selected: author.name)\n \n-      fill_in_i18n(\n-        :post_title,\n-        \"#post-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n-      fill_in_i18n_editor(\n-        :post_body,\n-        \"#post-body-tabs\",\n-        en: \"A longer description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:post_title, \"#post-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:post_body, \"#post-body-tabs\", **attributes[:body].except(\"machine_translations\"))\n \n       find(\"*[type=submit]\").click\n     end\n \n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My new title\")\n+      expect(page).to have_content(translated(attributes[:title]))\n       expect(page).to have_content(\"Post title 2\")\n       expect(page).to have_content(author.name)\n     end\n+\n+    if audit_check == true\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} blog post\")\n+    end\n   end\n \n-  it \"creates a new post\" do\n+  it \"creates a new post\", versioning: true do\n     click_link \"New post\"\n \n-    fill_in_i18n(\n-      :post_title,\n-      \"#post-title-tabs\",\n-      en: \"My post\",\n-      es: \"Mi post\",\n-      ca: \"El meu post\"\n-    )\n-\n-    fill_in_i18n_editor(\n-      :post_body,\n-      \"#post-body-tabs\",\n-      en: \"A description\",\n-      es: \"Descripci\u00f3n\",\n-      ca: \"Descripci\u00f3\"\n-    )\n+    fill_in_i18n(:post_title, \"#post-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+    fill_in_i18n_editor(:post_body, \"#post-body-tabs\", **attributes[:body].except(\"machine_translations\"))\n \n     within \".new_post\" do\n       find(\"*[type=submit]\").click\n@@ -70,10 +53,15 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My post\")\n+      expect(page).to have_content(translated(attributes[:title]))\n       expect(page).to have_content(\"Post title 1\")\n       expect(page).to have_content(\"Post title 2\")\n     end\n+\n+    if audit_check == true\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} blog post\")\n+    end\n   end\n \n   describe \"deleting a post\" do"
            },
            {
                "sha": "02bd0652dcb0e66c61013906b18495eb1cbcc5dc",
                "filename": "decidim-blogs/spec/system/process_admin_manages_post_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-blogs%2Fspec%2Fsystem%2Fprocess_admin_manages_post_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-blogs%2Fspec%2Fsystem%2Fprocess_admin_manages_post_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-blogs%2Fspec%2Fsystem%2Fprocess_admin_manages_post_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -10,5 +10,5 @@\n \n   include_context \"when managing a component as a process admin\"\n \n-  it_behaves_like \"manage posts\"\n+  it_behaves_like \"manage posts\", audit_check: false\n end"
            },
            {
                "sha": "49c11687bbdf43229b25d2ba40e3f32658ce349a",
                "filename": "decidim-budgets/spec/shared/manage_projects_examples.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 25,
                "changes": 41,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-budgets%2Fspec%2Fshared%2Fmanage_projects_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-budgets%2Fspec%2Fshared%2Fmanage_projects_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-budgets%2Fspec%2Fshared%2Fmanage_projects_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -140,26 +140,16 @@\n     end\n   end\n \n-  it \"creates a new project\", :slow do\n+  let(:attributes) { attributes_for(:project) }\n+\n+  it \"creates a new project\", versioning: true do\n     within \".bulk-actions-budgets\" do\n       click_link \"New project\"\n     end\n \n     within \".new_project\" do\n-      fill_in_i18n(\n-        :project_title,\n-        \"#project-title-tabs\",\n-        en: \"My project\",\n-        es: \"Mi proyecto\",\n-        ca: \"El meu projecte\"\n-      )\n-      fill_in_i18n_editor(\n-        :project_description,\n-        \"#project-description-tabs\",\n-        en: \"A longer description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:project_title, \"#project-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:project_description, \"#project-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n       fill_in :project_budget_amount, with: 22_000_000\n \n       select translated(scope.name), from: :project_decidim_scope_id\n@@ -171,8 +161,10 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My project\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} project\")\n   end\n \n   context \"when deleting a project\" do\n@@ -198,20 +190,16 @@\n   context \"when having existing proposals\" do\n     let!(:proposal_component) { create(:proposal_component, participatory_space:) }\n     let!(:proposals) { create_list(:proposal, 5, component: proposal_component) }\n+    let(:attributes) { attributes_for(:project) }\n \n-    it \"updates a project\" do\n+    it \"updates a project\", versioning: true do\n       within find(\"tr\", text: translated(project.title)) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_project\" do\n-        fill_in_i18n(\n-          :project_title,\n-          \"#project-title-tabs\",\n-          en: \"My new title\",\n-          es: \"Mi nuevo t\u00edtulo\",\n-          ca: \"El meu nou t\u00edtol\"\n-        )\n+        fill_in_i18n(:project_title, \"#project-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:project_description, \"#project-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n         tom_select(\"#proposals_list\", option_id: proposals.last(2).map(&:id))\n \n@@ -221,8 +209,11 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My new title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} project\")\n     end\n \n     it \"removes proposals from project\", :slow do"
            },
            {
                "sha": "4a43d60a9ee0d00a17f2c7f8f18df8232080dc42",
                "filename": "decidim-budgets/spec/system/admin_manages_budgets_spec.rb",
                "status": "modified",
                "additions": 17,
                "deletions": 27,
                "changes": 44,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_budgets_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_budgets_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_budgets_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -3,12 +3,12 @@\n require \"spec_helper\"\n \n describe \"Admin manages budgets\" do\n-  let(:budget) { create(:budget, component: current_component) }\n+  let!(:budget) { create(:budget, component: current_component) }\n   let(:manifest_name) { \"budgets\" }\n+  let(:attributes) { attributes_for(:budget) }\n \n   include_context \"when managing a component as an admin\"\n   before do\n-    budget\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n     visit_component_admin\n@@ -20,24 +20,13 @@\n     it_behaves_like \"having a rich text editor\", \"new_budget\", \"content\"\n   end\n \n-  it \"creates a new budget\" do\n+  it \"creates a new budget\", versioning: true do\n     click_link \"New budget\"\n \n     within \".new_budget\" do\n-      fill_in_i18n(\n-        :budget_title,\n-        \"#budget-title-tabs\",\n-        en: \"My Budget\",\n-        es: \"Mi Presupuesto\",\n-        ca: \"El meu Pressupost\"\n-      )\n-      fill_in_i18n_editor(\n-        :budget_description,\n-        \"#budget-description-tabs\",\n-        en: \"Long description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:budget_title, \"#budget-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:budget_description, \"#budget-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n       fill_in :budget_weight, with: 1\n       fill_in :budget_total_budget, with: 100_000_00\n       select translated(scope.name), from: :budget_decidim_scope_id\n@@ -48,33 +37,34 @@\n     expect(page).to have_admin_callout(\"Budget successfully created.\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My Budget\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} budget\")\n   end\n \n-  describe \"updating a budget\" do\n+  describe \"updating a budget\", versioning: true do\n     it \"updates a budget\" do\n       within find(\"tr\", text: translated(budget.title)) do\n         page.find(\".action-icon--edit\").click\n       end\n \n       within \".edit_budget\" do\n-        fill_in_i18n(\n-          :budget_title,\n-          \"#budget-title-tabs\",\n-          en: \"My new title\",\n-          es: \"Mi nuevo t\u00edtulo\",\n-          ca: \"El meu nou t\u00edtol\"\n-        )\n+        fill_in_i18n(:budget_title, \"#budget-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:budget_description, \"#budget-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n       end\n \n       click_button \"Update budget\"\n \n       expect(page).to have_admin_callout(\"Budget successfully updated.\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My new title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} budget\")\n     end\n   end\n "
            },
            {
                "sha": "709d2095a8c027772e808fa889c6a30eedb57150",
                "filename": "decidim-budgets/spec/system/admin_manages_projects_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_projects_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_projects_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-budgets%2Fspec%2Fsystem%2Fadmin_manages_projects_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -4,14 +4,13 @@\n \n describe \"Admin manages projects\" do\n   let(:manifest_name) { \"budgets\" }\n-  let(:budget) { create(:budget, component: current_component) }\n+  let!(:budget) { create(:budget, component: current_component) }\n   let!(:project) { create(:project, budget:) }\n   let!(:destination_budget) { create(:budget, component: current_component) }\n \n   include_context \"when managing a component as an admin\"\n \n   before do\n-    budget\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n     visit_component_admin"
            },
            {
                "sha": "e72e2e9accf195d93bed7ee5ce17d0654c5dec98",
                "filename": "decidim-conferences/spec/shared/manage_conference_admins_examples.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 3,
                "changes": 11,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_admins_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_admins_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_admins_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage conference admins examples\" do\n   let(:other_user) { create(:user, organization:, email: \"my_email@example.org\") }\n+  let(:attributes) { attributes_for(:user, organization:) }\n \n   let!(:conference_admin) do\n     create(:conference_admin,\n@@ -25,12 +26,12 @@\n     end\n   end\n \n-  it \"creates a new conference admin\" do\n+  it \"creates a new conference admin\", versioning: true do\n     click_link \"New conference admin\"\n \n     within \".new_conference_user_role\" do\n       fill_in :conference_user_role_email, with: other_user.email\n-      fill_in :conference_user_role_name, with: \"John Doe\"\n+      fill_in :conference_user_role_name, with: attributes[:name]\n       select \"Administrator\", from: :conference_user_role_role\n \n       find(\"*[type=submit]\").click\n@@ -41,6 +42,8 @@\n     within \"#conference_admins table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited #{other_user.name} to the #{translated(conference.title)} conference\")\n   end\n \n   describe \"when managing different users\" do\n@@ -49,7 +52,7 @@\n       visit current_path\n     end\n \n-    it \"updates a conference admin\" do\n+    it \"updates a conference admin\", versioning: true do\n       within \"#conference_admins\" do\n         within find(\"#conference_admins tr\", text: other_user.email) do\n           click_link \"Edit\"\n@@ -67,6 +70,8 @@\n       within \"#conference_admins table\" do\n         expect(page).to have_content(\"Collaborator\")\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"changed the role of #{other_user.name} in the #{translated(conference.title)} conference\")\n     end\n \n     it \"deletes a conference_user_role\" do"
            },
            {
                "sha": "918e093fe9f2fbceb17618a8bb16d28f1cd47f77",
                "filename": "decidim-conferences/spec/shared/manage_conference_speakers_examples.rb",
                "status": "modified",
                "additions": 17,
                "deletions": 12,
                "changes": 29,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_speakers_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_speakers_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_speakers_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage conference speakers examples\" do\n   let!(:conference_speaker) { create(:conference_speaker, conference:) }\n+  let(:attributes) { attributes_for(:conference_speaker, conference:) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -19,14 +20,14 @@\n   end\n \n   context \"without existing user\" do\n-    it \"creates a new conference speaker\" do\n+    it \"creates a new conference speaker\", versioning: true do\n       click_link \"New speaker\"\n \n       within \".new_conference_speaker\" do\n-        fill_in(\n-          :conference_speaker_full_name,\n-          with: \"Daisy O'connor\"\n-        )\n+        fill_in(:conference_speaker_full_name, with: attributes[:full_name])\n+        fill_in_i18n(:conference_speaker_position, \"#conference_speaker-position-tabs\", **attributes[:position].except(\"machine_translations\"))\n+        fill_in_i18n(:conference_speaker_affiliation, \"#conference_speaker-affiliation-tabs\", **attributes[:affiliation].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_speaker_short_bio, \"#conference_speaker-short_bio-tabs\", **attributes[:short_bio].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -35,8 +36,10 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_speakers_path(conference)\n \n       within \"#conference_speakers table\" do\n-        expect(page).to have_content(\"Daisy O'connor\")\n+        expect(page).to have_content(attributes[:full_name])\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{attributes[:full_name]} speaker in the\")\n     end\n   end\n \n@@ -67,16 +70,16 @@\n       visit current_path\n     end\n \n-    it \"updates a conference speaker\" do\n+    it \"updates a conference speaker\", versioning: true do\n       within find(\"#conference_speakers tr\", text: conference_speaker.full_name) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_conference_speaker\" do\n-        fill_in(\n-          :conference_speaker_full_name,\n-          with: \"Alicia O'connor\"\n-        )\n+        fill_in(:conference_speaker_full_name, with: attributes[:full_name])\n+        fill_in_i18n(:conference_speaker_position, \"#conference_speaker-position-tabs\", **attributes[:position].except(\"machine_translations\"))\n+        fill_in_i18n(:conference_speaker_affiliation, \"#conference_speaker-affiliation-tabs\", **attributes[:affiliation].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_speaker_short_bio, \"#conference_speaker-short_bio-tabs\", **attributes[:short_bio].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -85,8 +88,10 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_speakers_path(conference)\n \n       within \"#conference_speakers table\" do\n-        expect(page).to have_content(\"Alicia O'connor\")\n+        expect(page).to have_content(attributes[:full_name])\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{conference_speaker.full_name} speaker in the\")\n     end\n \n     it \"deletes the conference speaker\" do"
            },
            {
                "sha": "c01ea84b3e958b3604b252f9793bbfc1ffabbcc4",
                "filename": "decidim-conferences/spec/shared/manage_conferences_examples.rb",
                "status": "modified",
                "additions": 22,
                "deletions": 39,
                "changes": 61,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_conferences_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_conferences_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_conferences_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -7,6 +7,7 @@\n \n     let(:image2_filename) { \"city2.jpeg\" }\n     let(:image2_path) { Decidim::Dev.asset(image2_filename) }\n+    let(:attributes) { attributes_for(:conference) }\n \n     before do\n       click_link \"New conference\"\n@@ -17,36 +18,13 @@\n     end\n     it_behaves_like \"having a rich text editor for field\", \"#conference_registrations_terms\", \"content\"\n \n-    it \"creates a new conference\" do\n+    it \"creates a new conference\", versioning: true do\n       within \".new_conference\" do\n-        fill_in_i18n(\n-          :conference_title,\n-          \"#conference-title-tabs\",\n-          en: \"My conference\",\n-          es: \"Mi proceso participativo\",\n-          ca: \"El meu proc\u00e9s participatiu\"\n-        )\n-        fill_in_i18n(\n-          :conference_slogan,\n-          \"#conference-slogan-tabs\",\n-          en: \"Slogan\",\n-          es: \"Eslogan\",\n-          ca: \"Esl\u00f3gan\"\n-        )\n-        fill_in_i18n_editor(\n-          :conference_short_description,\n-          \"#conference-short_description-tabs\",\n-          en: \"Short description\",\n-          es: \"Descripci\u00f3n corta\",\n-          ca: \"Descripci\u00f3 curta\"\n-        )\n-        fill_in_i18n_editor(\n-          :conference_description,\n-          \"#conference-description-tabs\",\n-          en: \"A longer description\",\n-          es: \"Descripci\u00f3n m\u00e1s larga\",\n-          ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-        )\n+        fill_in_i18n(:conference_title, \"#conference-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n(:conference_slogan, \"#conference-slogan-tabs\", **attributes[:slogan].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_short_description, \"#conference-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_description, \"#conference-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_objectives, \"#conference-objectives-tabs\", **attributes[:objectives].except(\"machine_translations\"))\n \n         fill_in :conference_weight, with: 1\n         fill_in :conference_slug, with: \"slug\"\n@@ -67,41 +45,46 @@\n \n       within \"[data-content]\" do\n         expect(page).to have_current_path decidim_admin_conferences.conferences_path\n-        expect(page).to have_content(\"My conference\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} conference\")\n     end\n   end\n \n   describe \"updating a conference\" do\n     let(:image3_filename) { \"city3.jpeg\" }\n     let(:image3_path) { Decidim::Dev.asset(image3_filename) }\n+    let(:attributes) { attributes_for(:conference) }\n \n     before do\n       within find(\"tr\", text: translated(conference.title)) do\n         click_link \"Configure\"\n       end\n     end\n \n-    it \"updates a conference\" do\n-      fill_in_i18n(\n-        :conference_title,\n-        \"#conference-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+    it \"updates a conference\", versioning: true do\n       dynamically_attach_file(:conference_banner_image, image3_path, remove_before: true)\n \n       within \".edit_conference\" do\n+        fill_in_i18n(:conference_title, \"#conference-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n(:conference_slogan, \"#conference-slogan-tabs\", **attributes[:slogan].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_short_description, \"#conference-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_description, \"#conference-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_objectives, \"#conference-objectives-tabs\", **attributes[:objectives].except(\"machine_translations\"))\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"[data-content]\" do\n-        expect(page).to have_selector(\"input[value='My new title']\")\n+        expect(page).to have_selector(\"input[value='#{translated(attributes[:title])}']\")\n         expect(page).to have_css(\"img[src*='#{image3_filename}']\")\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} conference\")\n     end\n   end\n "
            },
            {
                "sha": "515649fca5f2fbb96868a58c23fe559cf68c9d06",
                "filename": "decidim-conferences/spec/shared/manage_media_links_examples.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 18,
                "changes": 31,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_media_links_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_media_links_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_media_links_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -1,6 +1,8 @@\n # frozen_string_literal: true\n \n shared_examples \"manage media links examples\" do\n+  let!(:attributes) { attributes_for(:media_link, conference:) }\n+\n   before do\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n@@ -15,16 +17,10 @@\n       click_link \"New media link\"\n     end\n \n-    it \"creates a new media link\" do\n+    it \"creates a new media link\", versioning: true do\n       within \"[data-content]\" do\n         within \".new_media_link\" do\n-          fill_in_i18n(\n-            :conference_media_link_title,\n-            \"#conference_media_link-title-tabs\",\n-            en: \"Media Link en\",\n-            es: \"Media Link es\",\n-            ca: \"Media Link ca\"\n-          )\n+          fill_in_i18n(:conference_media_link_title, \"#conference_media_link-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n           fill_in :conference_media_link_link, with: \"https://decidim.org\"\n           fill_in :conference_media_link_weight, with: 2\n@@ -38,8 +34,11 @@\n \n       within \"[data-content]\" do\n         expect(page).to have_current_path decidim_admin_conferences.conference_media_links_path(conference)\n-        expect(page).to have_content(\"Media Link en\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} media link\")\n     end\n   end\n \n@@ -56,19 +55,13 @@\n       end\n     end\n \n-    it \"updates a conference media links\" do\n+    it \"updates a conference media links\", versioning: true do\n       within find(\"#media_links tr\", text: translated(media_link.title)) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_media_link\" do\n-        fill_in_i18n(\n-          :conference_media_link_title,\n-          \"#conference_media_link-title-tabs\",\n-          en: \"Media Link update en\",\n-          es: \"Media Link update es\",\n-          ca: \"Media Link update ca\"\n-        )\n+        fill_in_i18n(:conference_media_link_title, \"#conference_media_link-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n         fill_in :conference_media_link_link, with: \"https://decidim.org\"\n         fill_in :conference_media_link_weight, with: 2\n@@ -81,8 +74,10 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_media_links_path(conference)\n \n       within \"#media_links table\" do\n-        expect(page).to have_content(\"Media Link update en\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(media_link.title)} media link\")\n     end\n \n     it \"deletes the conference media link\" do"
            },
            {
                "sha": "812e6e4f54b0cb6c9f4f5ae532a67ff6a7ba7f84",
                "filename": "decidim-conferences/spec/shared/manage_partners_examples.rb",
                "status": "modified",
                "additions": 31,
                "deletions": 6,
                "changes": 37,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_partners_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_partners_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_partners_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage partners examples\" do\n   let!(:conference_partner) { create(:partner, conference:) }\n+  let!(:attributes) { attributes_for(:partner, conference:) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -19,20 +20,42 @@\n   end\n \n   describe \"when managing other conference partners\" do\n+    let(:image1_filename) { \"city.jpeg\" }\n+    let(:image1_path) { Decidim::Dev.asset(image1_filename) }\n+\n     before do\n       visit current_path\n     end\n \n-    it \"updates a conference partners\" do\n+    it \"creates a conference partner\", versioning: true do\n+      click_on \"New partner\"\n+      dynamically_attach_file(:conference_partner_logo, image1_path)\n+\n+      within \".new_partner\" do\n+        fill_in(:conference_partner_name, with: attributes[:name])\n+\n+        select(\"Collaborator\", from: :conference_partner_partner_type)\n+\n+        find(\"*[type=submit]\").click\n+      end\n+      expect(page).to have_admin_callout(\"successfully\")\n+      expect(page).to have_current_path decidim_admin_conferences.conference_partners_path(conference)\n+\n+      within \"#partners table\" do\n+        expect(page).to have_content(attributes[:name])\n+        expect(page).to have_content(\"Collaborator\")\n+      end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the partner #{attributes[:name]}\")\n+    end\n+\n+    it \"updates a conference partners\", versioning: true do\n       within find(\"#partners tr\", text: conference_partner.name) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_partner\" do\n-        fill_in(\n-          :conference_partner_name,\n-          with: \"Partner name\"\n-        )\n+        fill_in(:conference_partner_name, with: attributes[:name])\n \n         select(\n           \"Collaborator\",\n@@ -46,9 +69,11 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_partners_path(conference)\n \n       within \"#partners table\" do\n-        expect(page).to have_content(\"Partner name\")\n+        expect(page).to have_content(attributes[:name])\n         expect(page).to have_content(\"Collaborator\")\n       end\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the partner #{conference_partner.name}\")\n     end\n \n     context \"when the partner type is already a Collaborator\" do"
            },
            {
                "sha": "864ca1df887c38eb22ffc2d1f37ddf390bb3c3e7",
                "filename": "decidim-conferences/spec/shared/manage_registration_types_examples.rb",
                "status": "modified",
                "additions": 30,
                "deletions": 8,
                "changes": 38,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_registration_types_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-conferences%2Fspec%2Fshared%2Fmanage_registration_types_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_registration_types_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage registration types examples\" do\n   let!(:registration_type) { create(:registration_type, conference:) }\n+  let(:attributes) { attributes_for(:registration_type, conference:) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -23,19 +24,37 @@\n       visit current_path\n     end\n \n+    it \"creates a conference registration types\", versioning: true do\n+      click_on \"New registration type\"\n+\n+      within \".new_registration_type\" do\n+        fill_in_i18n(:conference_registration_type_title, \"#conference_registration_type-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_registration_type_description, \"#conference_registration_type-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n+        fill_in(:conference_registration_type_weight, with: 4)\n+\n+        find(\"*[type=submit]\").click\n+      end\n+\n+      expect(page).to have_admin_callout(\"successfully\")\n+      expect(page).to have_current_path decidim_admin_conferences.conference_registration_types_path(conference)\n+\n+      within \"#registration_types table\" do\n+        expect(page).to have_content(translated(attributes[:title]))\n+      end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} registration type\")\n+    end\n+\n     it \"updates a conference registration types\" do\n       within find(\"#registration_types tr\", text: translated(registration_type.title)) do\n         click_link \"Edit\"\n       end\n \n       within \".edit_registration_type\" do\n-        fill_in_i18n(\n-          :conference_registration_type_title,\n-          \"#conference_registration_type-title-tabs\",\n-          en: \"Registration type title\",\n-          es: \"Registration type title es\",\n-          ca: \"Registration type title ca\"\n-        )\n+        fill_in_i18n(:conference_registration_type_title, \"#conference_registration_type-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:conference_registration_type_description, \"#conference_registration_type-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -44,8 +63,11 @@\n       expect(page).to have_current_path decidim_admin_conferences.conference_registration_types_path(conference)\n \n       within \"#registration_types table\" do\n-        expect(page).to have_content(\"Registration type title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(registration_type.title)} registration type\")\n     end\n \n     it \"deletes the conference registration type\" do"
            },
            {
                "sha": "3b0584ecee1390c4489018b7d2c26c7f12485b9d",
                "filename": "decidim-core/app/presenters/decidim/log/resource_presenter.rb",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -10,6 +10,8 @@ module Log\n     # overwrite `BasePresenter#resource_presenter` to return your custom resource presenter.\n     # The only requirement for custom renderers is that they should respond to `present`.\n     class ResourcePresenter\n+      include Decidim::SanitizeHelper\n+\n       # Public: Initializes the presenter.\n       #\n       # resource - An instance of a model that can be located by\n@@ -65,7 +67,11 @@ def resource_path\n       #\n       # Returns an HTML-safe String.\n       def present_resource_name\n-        h.translated_attribute extra[\"title\"]\n+        if resource.present? && resource.respond_to?(:presenter) && resource.presenter.respond_to?(:title)\n+          resource.presenter.title(html_escape: true)\n+        else\n+          decidim_escape_translated(extra[\"title\"]).html_safe\n+        end\n       end\n     end\n   end"
            },
            {
                "sha": "8ccec572a4511f5153d09fe930219bc1b7485ab0",
                "filename": "decidim-core/app/services/decidim/log/diff_changeset_calculator.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-core%2Fapp%2Fservices%2Fdecidim%2Flog%2Fdiff_changeset_calculator.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-core%2Fapp%2Fservices%2Fdecidim%2Flog%2Fdiff_changeset_calculator.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Fapp%2Fservices%2Fdecidim%2Flog%2Fdiff_changeset_calculator.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -86,7 +86,7 @@ def generate_i18n_changeset(attribute, values, type)\n         locales.flat_map do |locale|\n           previous_value = values.first.try(:[], locale)\n           new_value = values.last.try(:[], locale)\n-          if previous_value == new_value\n+          if previous_value == new_value || (previous_value.nil? && new_value.blank?)\n             nil\n           else\n             label = generate_label(attribute, locale)"
            },
            {
                "sha": "531d4b74e47304601875da942f82f343c6a85d9b",
                "filename": "decidim-debates/app/models/decidim/debates/debate.rb",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-debates%2Fapp%2Fmodels%2Fdecidim%2Fdebates%2Fdebate.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-debates%2Fapp%2Fmodels%2Fdecidim%2Fdebates%2Fdebate.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fapp%2Fmodels%2Fdecidim%2Fdebates%2Fdebate.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -56,6 +56,12 @@ class Debate < Debates::ApplicationRecord\n       }\n       scope_search_multi :with_any_state, [:open, :closed]\n \n+      # Returns the presenter for this debate, to be used in the views.\n+      # Required by ResourceRenderer.\n+      def presenter\n+        Decidim::Debates::DebatePresenter.new(self)\n+      end\n+\n       def self.log_presenter_class_for(_log)\n         Decidim::Debates::AdminLog::DebatePresenter\n       end"
            },
            {
                "sha": "2eb3068f2f7687664e730b2b16f1d2b2870f6183",
                "filename": "decidim-debates/app/presenters/decidim/debates/admin_log/debate_presenter.rb",
                "status": "modified",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fdebate_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fdebate_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fdebate_presenter.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -15,10 +15,6 @@ module AdminLog\n       class DebatePresenter < Decidim::Log::BasePresenter\n         private\n \n-        def resource_presenter\n-          @resource_presenter ||= Decidim::Debates::Log::ResourcePresenter.new(action_log.resource, h, action_log.extra[\"resource\"])\n-        end\n-\n         def diff_fields_mapping\n           {\n             description: \"Decidim::Debates::AdminLog::ValueTypes::DebateTitleDescriptionPresenter\","
            },
            {
                "sha": "c61c1b8e909e93f3f63df0c6f797f58a8c958aac",
                "filename": "decidim-debates/app/presenters/decidim/debates/admin_log/value_types/debate_title_description_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fvalue_types%2Fdebate_title_description_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fvalue_types%2Fdebate_title_description_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Fadmin_log%2Fvalue_types%2Fdebate_title_description_presenter.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -10,7 +10,7 @@ class DebateTitleDescriptionPresenter < Decidim::Log::ValueTypes::DefaultPresent\n           def present\n             return unless value\n \n-            renderer = Decidim::ContentRenderers::HashtagRenderer.new(h.translated_attribute(value))\n+            renderer = Decidim::ContentRenderers::HashtagRenderer.new(h.decidim_escape_translated(value))\n             renderer.render(links: false).html_safe\n           end\n         end"
            },
            {
                "sha": "1804ee80e35ccd7beaa9c49c48093ca0e8be63be",
                "filename": "decidim-debates/app/presenters/decidim/debates/log/resource_presenter.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 18,
                "changes": 18,
                "blob_url": "https://github.com/decidim/decidim/blob/dccce6e1fbe1edc379f23b1d03cac2b05fbcbc19/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Flog%2Fresource_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/dccce6e1fbe1edc379f23b1d03cac2b05fbcbc19/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Flog%2Fresource_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fapp%2Fpresenters%2Fdecidim%2Fdebates%2Flog%2Fresource_presenter.rb?ref=dccce6e1fbe1edc379f23b1d03cac2b05fbcbc19",
                "patch": "@@ -1,18 +0,0 @@\n-# frozen_string_literal: true\n-\n-module Decidim\n-  module Debates\n-    module Log\n-      class ResourcePresenter < Decidim::Log::ResourcePresenter\n-        private\n-\n-        # Private: Presents resource name.\n-        #\n-        # Returns an HTML-safe String.\n-        def present_resource_name\n-          Decidim::Debates::DebatePresenter.new(resource).title\n-        end\n-      end\n-    end\n-  end\n-end"
            },
            {
                "sha": "9444be2fbfd27c6223e86cd72c79a5af56c43cef",
                "filename": "decidim-debates/spec/shared/manage_debates_examples.rb",
                "status": "modified",
                "additions": 30,
                "deletions": 63,
                "changes": 93,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-debates%2Fspec%2Fshared%2Fmanage_debates_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-debates%2Fspec%2Fshared%2Fmanage_debates_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-debates%2Fspec%2Fshared%2Fmanage_debates_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,6 +2,7 @@\n \n RSpec.shared_examples \"manage debates\" do\n   let!(:debate) { create(:debate, category:, component: current_component) }\n+  let(:attributes) { attributes_for(:debate, :closed, component: current_component) }\n \n   before { visit_component_admin }\n \n@@ -39,28 +40,27 @@\n   end\n \n   describe \"updating a debate\" do\n-    it \"updates a debate\" do\n+    it \"updates a debate\", versioning: true do\n       within find(\"tr\", text: translated(debate.title)) do\n         page.find(\".action-icon--edit\").click\n       end\n \n       within \".edit_debate\" do\n-        fill_in_i18n(\n-          :debate_title,\n-          \"#debate-title-tabs\",\n-          en: \"My new title\",\n-          es: \"Mi nuevo t\u00edtulo\",\n-          ca: \"El meu nou t\u00edtol\"\n-        )\n+        fill_in_i18n(:debate_title, \"#debate-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:debate_description, \"#debate-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:debate_instructions, \"#debate-instructions-tabs\", **attributes[:instructions].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout \"Debate successfully updated\"\n \n       within \"table\" do\n-        expect(page).to have_content(\"My new title\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} debate on the\")\n     end\n \n     context \"when the debate has an author\" do\n@@ -88,31 +88,13 @@\n     end\n   end\n \n-  it \"creates a new finite debate\" do\n+  it \"creates a new finite debate\", versioning: true do\n     click_link \"New debate\"\n \n     within \".new_debate\" do\n-      fill_in_i18n(\n-        :debate_title,\n-        \"#debate-title-tabs\",\n-        en: \"My debate\",\n-        es: \"Mi debate\",\n-        ca: \"El meu debat\"\n-      )\n-      fill_in_i18n_editor(\n-        :debate_description,\n-        \"#debate-description-tabs\",\n-        en: \"Long description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n-      fill_in_i18n_editor(\n-        :debate_instructions,\n-        \"#debate-instructions-tabs\",\n-        en: \"Long instructions\",\n-        es: \"Instrucciones m\u00e1s largas\",\n-        ca: \"Instruccions m\u00e9s llargues\"\n-      )\n+      fill_in_i18n(:debate_title, \"#debate-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:debate_description, \"#debate-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:debate_instructions, \"#debate-instructions-tabs\", **attributes[:instructions].except(\"machine_translations\"))\n \n       choose \"Finite\"\n     end\n@@ -129,35 +111,20 @@\n     expect(page).to have_admin_callout \"Debate successfully created\"\n \n     within \"table\" do\n-      expect(page).to have_content(\"My debate\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} debate on the\")\n   end\n \n   it \"creates a new open debate\" do\n     click_link \"New debate\"\n \n     within \".new_debate\" do\n-      fill_in_i18n(\n-        :debate_title,\n-        \"#debate-title-tabs\",\n-        en: \"My debate\",\n-        es: \"Mi debate\",\n-        ca: \"El meu debat\"\n-      )\n-      fill_in_i18n_editor(\n-        :debate_description,\n-        \"#debate-description-tabs\",\n-        en: \"Long description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n-      fill_in_i18n_editor(\n-        :debate_instructions,\n-        \"#debate-instructions-tabs\",\n-        en: \"Long instructions\",\n-        es: \"Instrucciones m\u00e1s largas\",\n-        ca: \"Instruccions m\u00e9s llargues\"\n-      )\n+      fill_in_i18n(:debate_title, \"#debate-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:debate_description, \"#debate-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:debate_instructions, \"#debate-instructions-tabs\", **attributes[:instructions].except(\"machine_translations\"))\n \n       choose \"Open\"\n     end\n@@ -174,8 +141,11 @@\n     expect(page).to have_admin_callout \"Debate successfully created\"\n \n     within \"table\" do\n-      expect(page).to have_content(\"My debate\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} debate on the\")\n   end\n \n   describe \"deleting a debate\" do\n@@ -210,20 +180,14 @@\n     end\n   end\n \n-  describe \"closing a debate\" do\n+  describe \"closing a debate\", versioning: true do\n     it \"closes a debate\" do\n       within find(\"tr\", text: translated(debate.title)) do\n         page.find(\".action-icon--close\").click\n       end\n \n       within \".edit_close_debate\" do\n-        fill_in_i18n_editor(\n-          :debate_conclusions,\n-          \"#debate-conclusions-tabs\",\n-          en: \"The debate was great\",\n-          es: \"El debate fu\u00e9 genial\",\n-          ca: \"El debat ha anat molt b\u00e9\"\n-        )\n+        fill_in_i18n_editor(:debate_conclusions, \"#debate-conclusions-tabs\", **attributes[:conclusions].except(\"machine_translations\"))\n \n         find(\"*[type=submit]\").click\n       end\n@@ -237,7 +201,10 @@\n         end\n       end\n \n-      expect(page).to have_content(\"The debate was great\")\n+      expect(page).to have_content(strip_tags(translated(attributes[:conclusions])).strip)\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"performed some action on #{translated(debate.title)} in\")\n     end\n \n     context \"when the debate has an author\" do"
            },
            {
                "sha": "1feb2202166f488012b47f0ebc38c37eccbf2c24",
                "filename": "decidim-meetings/app/presenters/decidim/meetings/admin_log/meeting_presenter.rb",
                "status": "modified",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fmeeting_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fmeeting_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fmeeting_presenter.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -15,10 +15,6 @@ module AdminLog\n       class MeetingPresenter < Decidim::Log::BasePresenter\n         private\n \n-        def resource_presenter\n-          @resource_presenter ||= Decidim::Meetings::Log::ResourcePresenter.new(action_log.resource, h, action_log.extra[\"resource\"])\n-        end\n-\n         def diff_fields_mapping\n           {\n             address: :string,"
            },
            {
                "sha": "02694535b0d5ea1b69411aa4998b79e6fa56d667",
                "filename": "decidim-meetings/app/presenters/decidim/meetings/admin_log/value_types/meeting_title_description_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fvalue_types%2Fmeeting_title_description_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fvalue_types%2Fmeeting_title_description_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Fadmin_log%2Fvalue_types%2Fmeeting_title_description_presenter.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -10,7 +10,7 @@ class MeetingTitleDescriptionPresenter < Decidim::Log::ValueTypes::DefaultPresen\n           def present\n             return unless value\n \n-            renderer = Decidim::ContentRenderers::HashtagRenderer.new(h.translated_attribute(value))\n+            renderer = Decidim::ContentRenderers::HashtagRenderer.new(h.decidim_escape_translated(value))\n             renderer.render(links: false).html_safe\n           end\n         end"
            },
            {
                "sha": "4ee659a9232848871438f5b13545f393203660da",
                "filename": "decidim-meetings/app/presenters/decidim/meetings/log/resource_presenter.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 18,
                "changes": 18,
                "blob_url": "https://github.com/decidim/decidim/blob/dccce6e1fbe1edc379f23b1d03cac2b05fbcbc19/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Flog%2Fresource_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/dccce6e1fbe1edc379f23b1d03cac2b05fbcbc19/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Flog%2Fresource_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fapp%2Fpresenters%2Fdecidim%2Fmeetings%2Flog%2Fresource_presenter.rb?ref=dccce6e1fbe1edc379f23b1d03cac2b05fbcbc19",
                "patch": "@@ -1,18 +0,0 @@\n-# frozen_string_literal: true\n-\n-module Decidim\n-  module Meetings\n-    module Log\n-      class ResourcePresenter < Decidim::Log::ResourcePresenter\n-        private\n-\n-        # Private: Presents resource name.\n-        #\n-        # Returns an HTML-safe String.\n-        def present_resource_name\n-          Decidim::Meetings::MeetingPresenter.new(resource).title\n-        end\n-      end\n-    end\n-  end\n-end"
            },
            {
                "sha": "9ec232c0999aa1430d18ddcf3c74d8882a18f406",
                "filename": "decidim-meetings/spec/system/admin/admin_manages_meetings_spec.rb",
                "status": "modified",
                "additions": 24,
                "deletions": 37,
                "changes": 61,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-meetings%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_meetings_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-meetings%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_meetings_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-meetings%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_meetings_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -10,6 +10,12 @@\n   let(:latitude) { 40.1234 }\n   let(:longitude) { 2.1234 }\n   let(:service_titles) { [\"This is the first service\", \"This is the second service\"] }\n+  let(:base_date) { Time.new.utc }\n+  let(:meeting_start_date) { base_date.strftime(\"%d/%m/%Y\") }\n+  let(:meeting_start_time) { base_date.utc.strftime(\"%H:%M\") }\n+  let(:meeting_end_date) { ((base_date + 2.days) + 1.month).strftime(\"%d/%m/%Y\") }\n+  let(:meeting_end_time) { (base_date + 4.hours).strftime(\"%H:%M\") }\n+  let(:attributes) { attributes_for(:meeting, component: current_component) }\n \n   include_context \"when managing a component as an admin\"\n \n@@ -153,13 +159,12 @@\n     end\n \n     within \".edit_meeting\" do\n-      fill_in_i18n(\n-        :meeting_title,\n-        \"#meeting-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+      fill_in_i18n(:meeting_title, \"#meeting-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+\n+      fill_in_i18n(:meeting_location, \"#meeting-location-tabs\", **attributes[:location].except(\"machine_translations\"))\n+      fill_in_i18n(:meeting_location_hints, \"#meeting-location_hints-tabs\", **attributes[:location_hints].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:meeting_description, \"#meeting-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n       fill_in_geocoding :meeting_address, with: address\n \n       find(\"*[type=submit]\").click\n@@ -168,8 +173,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My new title\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:title])} meeting on the\")\n   end\n \n   it \"sets registration enabled to true when registration type is on this platform\" do\n@@ -268,37 +276,13 @@\n   it \"creates a new meeting\", :serves_geocoding_autocomplete do\n     click_link \"New meeting\"\n \n-    fill_in_i18n(\n-      :meeting_title,\n-      \"#meeting-title-tabs\",\n-      en: \"My meeting\",\n-      es: \"Mi meeting\",\n-      ca: \"El meu meeting\"\n-    )\n+    fill_in_i18n(:meeting_title, \"#meeting-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n     select \"In person\", from: :meeting_type_of_meeting\n \n-    fill_in_i18n(\n-      :meeting_location,\n-      \"#meeting-location-tabs\",\n-      en: \"Location\",\n-      es: \"Location\",\n-      ca: \"Location\"\n-    )\n-    fill_in_i18n(\n-      :meeting_location_hints,\n-      \"#meeting-location_hints-tabs\",\n-      en: \"Location hints\",\n-      es: \"Location hints\",\n-      ca: \"Location hints\"\n-    )\n-    fill_in_i18n_editor(\n-      :meeting_description,\n-      \"#meeting-description-tabs\",\n-      en: \"A longer description\",\n-      es: \"Descripci\u00f3n m\u00e1s larga\",\n-      ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-    )\n+    fill_in_i18n(:meeting_location, \"#meeting-location-tabs\", **attributes[:location].except(\"machine_translations\"))\n+    fill_in_i18n(:meeting_location_hints, \"#meeting-location_hints-tabs\", **attributes[:location_hints].except(\"machine_translations\"))\n+    fill_in_i18n_editor(:meeting_description, \"#meeting-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n     fill_in_geocoding :meeting_address, with: address\n     fill_in_services\n@@ -318,8 +302,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"My meeting\")\n+      expect(page).to have_content(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} meeting on the\")\n   end\n \n   context \"when using the front-end geocoder\", :serves_geocoding_autocomplete do"
            },
            {
                "sha": "18279e561e0c22c9025575123b25d123c3bf4a95",
                "filename": "decidim-pages/spec/system/admin_spec.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 9,
                "changes": 17,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-pages%2Fspec%2Fsystem%2Fadmin_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-pages%2Fspec%2Fsystem%2Fadmin_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-pages%2Fspec%2Fsystem%2Fadmin_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -21,25 +21,24 @@\n       visit_component_admin\n     end\n \n-    it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='page-body-tabs']\", \"full\"\n+    let!(:attributes) { attributes_for(:static_page) }\n \n-    it \"updates the page\" do\n-      new_body = {\n-        en: \"<p>New body</p>\",\n-        ca: \"<p>Nou cos</p>\",\n-        es: \"<p>Nuevo cuerpo</p>\"\n-      }\n+    it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='page-body-tabs']\", \"full\"\n \n+    it \"updates the page\", versioning: true do\n       within \"form.edit_page\" do\n-        fill_in_i18n_editor(:page_body, \"#page-body-tabs\", new_body)\n+        fill_in_i18n_editor(:page_body, \"#page-body-tabs\", **attributes[:content].except(\"machine_translations\"))\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       visit_component\n \n-      expect(page).to have_content(\"New body\")\n+      expect(page).to have_content(translated(component.name))\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(component.name)} page\")\n     end\n   end\n "
            },
            {
                "sha": "4e04a9c4edb11f45e21a0505d748d01cf7ad25f8",
                "filename": "decidim-participatory_processes/lib/decidim/participatory_processes/test/factories.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Flib%2Fdecidim%2Fparticipatory_processes%2Ftest%2Ffactories.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Flib%2Fdecidim%2Fparticipatory_processes%2Ftest%2Ffactories.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Flib%2Fdecidim%2Fparticipatory_processes%2Ftest%2Ffactories.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -141,6 +141,7 @@\n     end\n     title { generate_localized_title(:participatory_process_step_title, skip_injection:) }\n     description { generate_localized_description(:participatory_process_step_description, skip_injection:) }\n+    cta_text { generate_localized_description(:participatory_process_step_cta_text, skip_injection:) }\n     start_date { 1.month.ago }\n     end_date { 2.months.from_now }\n     position { nil }"
            },
            {
                "sha": "0e7da1ff6619007960305bb9b95a37718e08b0f8",
                "filename": "decidim-participatory_processes/spec/shared/manage_process_admins_examples.rb",
                "status": "modified",
                "additions": 10,
                "deletions": 3,
                "changes": 13,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_admins_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_admins_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_admins_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage process admins examples\" do\n   let(:other_user) { create(:user, organization:, email: \"my_email@example.org\") }\n+  let(:attributes) { attributes_for(:user, organization:) }\n \n   let!(:process_admin) do\n     create(:process_admin,\n@@ -25,12 +26,12 @@\n     end\n   end\n \n-  it \"creates a new process admin\" do\n+  it \"creates a new process admin\", versioning: true do\n     click_link \"New process admin\"\n \n     within \".new_participatory_process_user_role\" do\n       fill_in :participatory_process_user_role_email, with: other_user.email\n-      fill_in :participatory_process_user_role_name, with: \"John Doe\"\n+      fill_in :participatory_process_user_role_name, with: attributes[:name]\n       select \"Administrator\", from: :participatory_process_user_role_role\n \n       find(\"*[type=submit]\").click\n@@ -41,6 +42,9 @@\n     within \"#process_admins table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited the participant #{other_user.name} to the #{translated(participatory_process.title)} participatory process\")\n   end\n \n   describe \"when managing different users\" do\n@@ -50,7 +54,7 @@\n       visit current_path\n     end\n \n-    it \"updates a process admin\" do\n+    it \"updates a process admin\", versioning: true do\n       within \"#process_admins\" do\n         within find(\"#process_admins tr\", text: other_user.email) do\n           click_link \"Edit\"\n@@ -68,6 +72,9 @@\n       within \"#process_admins table\" do\n         expect(page).to have_content(\"Administrator\")\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"changed the role of the participant #{other_user.name} in the #{translated(participatory_process.title)} participatory process\")\n     end\n \n     it \"deletes a participatory_process_user_role\" do"
            },
            {
                "sha": "3ba69c7f0ddcf7ba490b69f1fbae420cea057124",
                "filename": "decidim-participatory_processes/spec/shared/manage_process_steps_examples.rb",
                "status": "modified",
                "additions": 17,
                "deletions": 18,
                "changes": 35,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_steps_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_steps_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_steps_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -9,6 +9,7 @@\n       active:\n     )\n   end\n+  let(:attributes) { attributes_for(:participatory_process_step, participatory_process:) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -23,23 +24,20 @@\n     before { click_link \"New phase\" }\n   end\n \n-  it \"creates a new participatory_process\" do\n+  it \"creates a new participatory_process\", versioning: true do\n     click_link \"New phase\"\n \n     fill_in_i18n(\n       :participatory_process_step_title,\n       \"#participatory_process_step-title-tabs\",\n-      en: \"My participatory process step\",\n-      es: \"Mi fase de proceso participativo\",\n-      ca: \"La meva fase de proc\u00e9s participatiu\"\n+      **attributes[:title].except(\"machine_translations\")\n     )\n     fill_in_i18n_editor(\n       :participatory_process_step_description,\n       \"#participatory_process_step-description-tabs\",\n-      en: \"A longer description\",\n-      es: \"Descripci\u00f3n m\u00e1s larga\",\n-      ca: \"Descripci\u00f3 m\u00e9s llarga\"\n+      **attributes[:description].except(\"machine_translations\")\n     )\n+    fill_in_i18n(:participatory_process_step_cta_text, \"#participatory_process_step-cta_text-tabs\", **attributes[:cta_text].except(\"machine_translations\"))\n \n     fill_in :participatory_process_step_start_date, with: Time.current.change(day: 12)\n     fill_in :participatory_process_step_end_date, with: Time.current.change(day: 22)\n@@ -51,37 +49,38 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#steps table\" do\n-      expect(page).to have_content(\"My participatory process step\")\n+      expect(page).to have_content(translated(attributes[:title]))\n       expect(page).to have_content(\"12,\")\n       expect(page).to have_content(\"22,\")\n     end\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} phase in\")\n   end\n \n-  it \"updates a participatory_process_step\" do\n+  it \"updates a participatory_process_step\", versioning: true do\n     within \"#steps\" do\n       within find(\"tr\", text: translated(process_step.title)) do\n         click_link \"Edit\"\n       end\n     end\n \n     within \".edit_participatory_process_step\" do\n-      fill_in_i18n(\n-        :participatory_process_step_title,\n-        \"#participatory_process_step-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+      fill_in_i18n(:participatory_process_step_title, \"#participatory_process_step-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_step_description, \"#participatory_process_step-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_step_cta_text, \"#participatory_process_step-cta_text-tabs\", **attributes[:cta_text].except(\"machine_translations\"))\n \n       find(\"*[type=submit]\").click\n     end\n \n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#steps table\" do\n-      expect(page).to have_content(\"My new title\")\n-      click_link(\"My new title\")\n+      expect(page).to have_content(translated(attributes[:title]))\n+      click_link(translated(attributes[:title]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:title])} phase in\")\n   end\n \n   context \"when deleting a participatory process step\" do"
            },
            {
                "sha": "dff2f8c1bcb937a376d39110e9a482d9732179db",
                "filename": "decidim-participatory_processes/spec/shared/manage_processes_examples.rb",
                "status": "modified",
                "additions": 17,
                "deletions": 8,
                "changes": 25,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_processes_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_processes_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_processes_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -85,6 +85,7 @@ def filter_by_group(group_title)\n   context \"when updating a participatory process\" do\n     let(:image3_filename) { \"city3.jpeg\" }\n     let(:image3_path) { Decidim::Dev.asset(image3_filename) }\n+    let(:attributes) { attributes_for(:participatory_process, organization:) }\n \n     before do\n       within find(\"tr\", text: translated(participatory_process.title)) do\n@@ -97,13 +98,18 @@ def filter_by_group(group_title)\n     end\n \n     it \"updates a participatory_process\" do\n-      fill_in_i18n(\n-        :participatory_process_title,\n-        \"#participatory_process-title-tabs\",\n-        en: \"My new title\",\n-        es: \"Mi nuevo t\u00edtulo\",\n-        ca: \"El meu nou t\u00edtol\"\n-      )\n+      fill_in_i18n(:participatory_process_title, \"#participatory_process-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_subtitle, \"#participatory_process-subtitle-tabs\", **attributes[:subtitle].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_short_description, \"#participatory_process-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_description, \"#participatory_process-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_announcement, \"#participatory_process-announcement-tabs\", **attributes[:announcement].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_developer_group, \"#participatory_process-developer_group-tabs\", **attributes[:developer_group].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_local_area, \"#participatory_process-local_area-tabs\", **attributes[:local_area].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_meta_scope, \"#participatory_process-meta_scope-tabs\", **attributes[:meta_scope].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_target, \"#participatory_process-target-tabs\", **attributes[:target].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_participatory_scope, \"#participatory_process-participatory_scope-tabs\", **attributes[:participatory_scope].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_participatory_structure, \"#participatory_process-participatory_structure-tabs\", **attributes[:participatory_structure].except(\"machine_translations\"))\n+\n       dynamically_attach_file(:participatory_process_banner_image, image3_path, remove_before: true)\n \n       fill_in :participatory_process_end_date, with: Time.current.change(day: 22)\n@@ -115,9 +121,12 @@ def filter_by_group(group_title)\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"[data-content]\" do\n-        expect(page).to have_selector(\"input[value='My new title']\")\n+        expect(page).to have_selector(\"input[value='#{translated(attributes[:title])}']\")\n         expect(page).to have_css(\"img[src*='#{image3_filename}']\")\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} participatory process\")\n     end\n   end\n "
            },
            {
                "sha": "1aafb3fb005c9ade4e6531ae75b714e12020bc99",
                "filename": "decidim-participatory_processes/spec/system/admin/admin_manages_participatory_process_groups_spec.rb",
                "status": "modified",
                "additions": 24,
                "deletions": 49,
                "changes": 73,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_groups_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_groups_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_groups_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -8,7 +8,7 @@\n   let!(:participatory_processes) do\n     create_list(:participatory_process, 3, organization:)\n   end\n-\n+  let(:attributes) { attributes_for(:participatory_process_group, organization:) }\n   let(:image1_filename) { \"city.jpeg\" }\n   let(:image1_path) { Decidim::Dev.asset(image1_filename) }\n \n@@ -26,35 +26,18 @@\n     end\n   end\n \n-  it \"creates a new participatory process group\" do\n+  it \"creates a new participatory process group\", versioning: true do\n     within \"div.process-title\" do\n       click_link \"New process group\"\n     end\n \n     within \".new_participatory_process_group\" do\n-      fill_in_i18n(\n-        :participatory_process_group_title,\n-        \"#participatory_process_group-title-tabs\",\n-        en: \"My group\",\n-        es: \"Mi grupo\",\n-        ca: \"El meu grup\"\n-      )\n-      fill_in_i18n_editor(\n-        :participatory_process_group_description,\n-        \"#participatory_process_group-description-tabs\",\n-        en: \"A longer description\",\n-        es: \"Descripci\u00f3n m\u00e1s larga\",\n-        ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-      )\n+      fill_in_i18n(:participatory_process_group_title, \"#participatory_process_group-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+      fill_in_i18n(:participatory_process_group_developer_group, \"#participatory_process_group-developer_group-tabs\", **attributes[:developer_group].except(\"machine_translations\"))\n+      fill_in_i18n_editor(:participatory_process_group_description, \"#participatory_process_group-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n       fill_in :participatory_process_group_hashtag, with: \"hashtag\"\n       fill_in :participatory_process_group_group_url, with: \"http://example.org\"\n-      fill_in_i18n(\n-        :participatory_process_group_developer_group,\n-        \"#participatory_process_group-developer_group-tabs\",\n-        en: \"X corporation\",\n-        es: \"La corporaci\u00f3n X\",\n-        ca: \"La corporaci\u00f3 X\"\n-      )\n       select participatory_processes.first.title[\"en\"], from: :participatory_process_group_participatory_process_ids\n     end\n \n@@ -65,12 +48,17 @@\n     end\n \n     expect(page).to have_admin_callout(\"successfully\")\n-    expect(page).to have_field(:participatory_process_group_title_en, with: \"My group\")\n+    expect(page).to have_field(:participatory_process_group_title_en, with: translated(attributes[:title]))\n     expect(page).to have_field(:participatory_process_group_hashtag, with: \"hashtag\")\n     expect(page).to have_field(:participatory_process_group_group_url, with: \"http://example.org\")\n-    expect(page).to have_field(:participatory_process_group_developer_group_en, with: \"X corporation\")\n+    expect(page).to have_field(:participatory_process_group_developer_group_en, with: translated(attributes[:developer_group]))\n     expect(page).to have_select(\"Related processes\", selected: participatory_processes.first.title[\"en\"])\n     expect(page).to have_css(\"img[src*='#{image1_filename}']\")\n+\n+    expect(page).to have_admin_callout(\"successfully\")\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:title])} participatory process group\")\n   end\n \n   context \"with existing groups\" do\n@@ -90,29 +78,13 @@\n       end\n \n       within \".edit_participatory_process_group\" do\n-        fill_in_i18n(\n-          :participatory_process_group_title,\n-          \"#participatory_process_group-title-tabs\",\n-          en: \"My old group\",\n-          es: \"Mi grupo antiguo\",\n-          ca: \"El meu grup antic\"\n-        )\n-        fill_in_i18n_editor(\n-          :participatory_process_group_description,\n-          \"#participatory_process_group-description-tabs\",\n-          en: \"New description\",\n-          es: \"Nueva descripci\u00f3n\",\n-          ca: \"Nova descripci\u00f3\"\n-        )\n+        fill_in_i18n(:participatory_process_group_title, \"#participatory_process_group-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:participatory_process_group_description, \"#participatory_process_group-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+\n         fill_in :participatory_process_group_hashtag, with: \"new_hashtag\"\n         fill_in :participatory_process_group_group_url, with: \"http://new-example.org\"\n-        fill_in_i18n(\n-          :participatory_process_group_developer_group,\n-          \"#participatory_process_group-developer_group-tabs\",\n-          en: \"Z corporation\",\n-          es: \"La corporaci\u00f3n Z\",\n-          ca: \"La corporaci\u00f3 Z\"\n-        )\n+        fill_in_i18n(:participatory_process_group_developer_group, \"#participatory_process_group-developer_group-tabs\", **attributes[:developer_group].except(\"machine_translations\"))\n+\n         select participatory_processes.last.title[\"en\"], from: :participatory_process_group_participatory_process_ids\n       end\n \n@@ -123,13 +95,16 @@\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_field(:participatory_process_group_title_en, with: \"My old group\")\n-      expect(page).to have_content(\"New description\")\n+      expect(page).to have_field(:participatory_process_group_title_en, with: translated(attributes[:title]))\n+      expect(page).to have_content(strip_tags(translated(attributes[:description])).strip)\n       expect(page).to have_field(:participatory_process_group_hashtag, with: \"new_hashtag\")\n       expect(page).to have_field(:participatory_process_group_group_url, with: \"http://new-example.org\")\n-      expect(page).to have_field(:participatory_process_group_developer_group_en, with: \"Z corporation\")\n+      expect(page).to have_field(:participatory_process_group_developer_group_en, with: translated(attributes[:developer_group]))\n       expect(page).to have_select(\"Related processes\", selected: participatory_processes.last.title[\"en\"])\n       expect(page).to have_css(\"img[src*='#{image2_filename}']\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} participatory process group\")\n     end\n \n     it \"validates the group attributes\" do"
            },
            {
                "sha": "0528fe1d2cb4ac1d852fe5d8d333c7fb26243caf",
                "filename": "decidim-participatory_processes/spec/system/admin/admin_manages_participatory_process_types_spec.rb",
                "status": "modified",
                "additions": 14,
                "deletions": 17,
                "changes": 31,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_process_types_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -8,6 +8,7 @@\n   let!(:participatory_processes) do\n     create_list(:participatory_process, 3, organization:)\n   end\n+  let(:attributes) { attributes_for(:participatory_process_type, organization:) }\n \n   describe \"Managing participatory process types\" do\n     before do\n@@ -16,25 +17,23 @@\n       visit decidim_admin_participatory_processes.participatory_process_types_path\n     end\n \n-    it \"can create new participatory process types\" do\n+    it \"can create new participatory process types\", versioning: true do\n       click_link \"New process type\"\n \n       within \".new_participatory_process_type\" do\n-        fill_in_i18n(\n-          :participatory_process_type_title,\n-          \"#participatory_process_type-title-tabs\",\n-          en: \"My participatory process type\",\n-          es: \"Mi tipo de proceso participativo\",\n-          ca: \"El meu tipus de proc\u00e9s participatiu \"\n-        )\n+        fill_in_i18n(:participatory_process_type_title, \"#participatory_process_type-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My participatory process type\")\n+        expect(page).to have_content(translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} participatory process type\")\n     end\n \n     context \"with existing participatory process types\" do\n@@ -56,21 +55,19 @@\n         end\n \n         within \".edit_participatory_process_type\" do\n-          fill_in_i18n(\n-            :participatory_process_type_title,\n-            \"#participatory_process_type-title-tabs\",\n-            en: \"Another participatory process type\",\n-            es: \"Otro tipo de proceso participativo\",\n-            ca: \"Un altre tipus de proc\u00e9s participatiu\"\n-          )\n+          fill_in_i18n(:participatory_process_type_title, \"#participatory_process_type-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+\n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n \n         within \"table\" do\n-          expect(page).to have_content(\"Another participatory process type\")\n+          expect(page).to have_content(translated(attributes[:title]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} participatory process type\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "f03d78979c65dfeeff6452a1df945de0224a660f",
                "filename": "decidim-participatory_processes/spec/system/admin/admin_manages_participatory_processes_spec.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 28,
                "changes": 44,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_processes_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_processes_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_participatory_processes_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -55,6 +55,7 @@\n \n     let(:image2_filename) { \"city2.jpeg\" }\n     let(:image2_path) { Decidim::Dev.asset(image2_filename) }\n+    let(:attributes) { attributes_for(:participatory_process, organization:) }\n \n     before do\n       click_link \"New process\"\n@@ -66,34 +67,18 @@\n \n     it \"creates a new participatory process\" do\n       within \".new_participatory_process\" do\n-        fill_in_i18n(\n-          :participatory_process_title,\n-          \"#participatory_process-title-tabs\",\n-          en: \"My participatory process\",\n-          es: \"Mi proceso participativo\",\n-          ca: \"El meu proc\u00e9s participatiu\"\n-        )\n-        fill_in_i18n(\n-          :participatory_process_subtitle,\n-          \"#participatory_process-subtitle-tabs\",\n-          en: \"Subtitle\",\n-          es: \"Subt\u00edtulo\",\n-          ca: \"Subt\u00edtol\"\n-        )\n-        fill_in_i18n_editor(\n-          :participatory_process_short_description,\n-          \"#participatory_process-short_description-tabs\",\n-          en: \"Short description\",\n-          es: \"Descripci\u00f3n corta\",\n-          ca: \"Descripci\u00f3 curta\"\n-        )\n-        fill_in_i18n_editor(\n-          :participatory_process_description,\n-          \"#participatory_process-description-tabs\",\n-          en: \"A longer description\",\n-          es: \"Descripci\u00f3n m\u00e1s larga\",\n-          ca: \"Descripci\u00f3 m\u00e9s llarga\"\n-        )\n+        fill_in_i18n(:participatory_process_title, \"#participatory_process-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_subtitle, \"#participatory_process-subtitle-tabs\", **attributes[:subtitle].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:participatory_process_short_description, \"#participatory_process-short_description-tabs\", **attributes[:short_description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:participatory_process_description, \"#participatory_process-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n+        fill_in_i18n_editor(:participatory_process_announcement, \"#participatory_process-announcement-tabs\", **attributes[:announcement].except(\"machine_translations\"))\n+\n+        fill_in_i18n(:participatory_process_developer_group, \"#participatory_process-developer_group-tabs\", **attributes[:developer_group].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_local_area, \"#participatory_process-local_area-tabs\", **attributes[:local_area].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_meta_scope, \"#participatory_process-meta_scope-tabs\", **attributes[:meta_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_target, \"#participatory_process-target-tabs\", **attributes[:target].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_participatory_scope, \"#participatory_process-participatory_scope-tabs\", **attributes[:participatory_scope].except(\"machine_translations\"))\n+        fill_in_i18n(:participatory_process_participatory_structure, \"#participatory_process-participatory_structure-tabs\", **attributes[:participatory_structure].except(\"machine_translations\"))\n \n         group_title = participatory_process_groups.first.title[\"en\"]\n         select group_title, from: :participatory_process_participatory_process_group_id\n@@ -117,6 +102,9 @@\n         expect(page).to have_content(\"Phases\")\n         expect(page).to have_content(\"Introduction\")\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} participatory process\")\n     end\n   end\n "
            },
            {
                "sha": "572730f1484630280b28a6b5e585ebb79ff9fbc5",
                "filename": "decidim-participatory_processes/spec/types/participatory_process_step_type_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Ftypes%2Fparticipatory_process_step_type_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-participatory_processes%2Fspec%2Ftypes%2Fparticipatory_process_step_type_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Ftypes%2Fparticipatory_process_step_type_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -80,7 +80,7 @@ module ParticipatoryProcesses\n         let(:query) { '{ callToActionText { locales translation(locale:\"en\") } }' }\n \n         it \"returns the step's call to action text\" do\n-          expect(response[\"callToActionText\"][\"locales\"]).to include(*model.cta_text.keys)\n+          expect(response[\"callToActionText\"][\"locales\"]).to include(*model.cta_text.except(\"machine_translations\").keys)\n           expect(response[\"callToActionText\"][\"translation\"]).to eq(model.cta_text[\"en\"])\n         end\n       end"
            },
            {
                "sha": "a8e88721ee939ff8da9a37d583311fa3ca1c6926",
                "filename": "decidim-proposals/app/presenters/decidim/proposals/admin_log/proposal_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 5,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fproposal_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fproposal_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fproposal_presenter.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -15,13 +15,9 @@ module AdminLog\n       class ProposalPresenter < Decidim::Log::BasePresenter\n         private\n \n-        def resource_presenter\n-          @resource_presenter ||= Decidim::Proposals::Log::ResourcePresenter.new(action_log.resource, h, action_log.extra[\"resource\"])\n-        end\n-\n         def diff_fields_mapping\n           {\n-            title: \"Decidim::Proposals::AdminLog::ValueTypes::ProposalTitleBodyPresenter\",\n+            title: :i18n,\n             body: \"Decidim::Proposals::AdminLog::ValueTypes::ProposalTitleBodyPresenter\",\n             state: \"Decidim::Proposals::AdminLog::ValueTypes::ProposalStatePresenter\",\n             answered_at: :date,"
            },
            {
                "sha": "0ef814386db18cc565e33f91332b90ab54a77268",
                "filename": "decidim-proposals/app/presenters/decidim/proposals/admin_log/value_types/proposal_title_body_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -5,12 +5,10 @@ module Proposals\n     module AdminLog\n       module ValueTypes\n         class ProposalTitleBodyPresenter < Decidim::Log::ValueTypes::DefaultPresenter\n-          include Decidim::TranslatableAttributes\n-\n           def present\n             return unless value\n \n-            translated_value = translated_attribute(value)\n+            translated_value = h.decidim_escape_translated(value)\n             return if translated_value.blank?\n \n             renderer = Decidim::ContentRenderers::HashtagRenderer.new(translated_value)"
            },
            {
                "sha": "fbacf6cacd08310329679879bbee757ec8fd3204",
                "filename": "decidim-proposals/app/presenters/decidim/proposals/log/resource_presenter.rb",
                "status": "removed",
                "additions": 0,
                "deletions": 22,
                "changes": 22,
                "blob_url": "https://github.com/decidim/decidim/blob/dccce6e1fbe1edc379f23b1d03cac2b05fbcbc19/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fresource_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/dccce6e1fbe1edc379f23b1d03cac2b05fbcbc19/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fresource_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fresource_presenter.rb?ref=dccce6e1fbe1edc379f23b1d03cac2b05fbcbc19",
                "patch": "@@ -1,22 +0,0 @@\n-# frozen_string_literal: true\n-\n-module Decidim\n-  module Proposals\n-    module Log\n-      class ResourcePresenter < Decidim::Log::ResourcePresenter\n-        private\n-\n-        # Private: Presents resource name.\n-        #\n-        # Returns an HTML-safe String.\n-        def present_resource_name\n-          if resource.present?\n-            Decidim::Proposals::ProposalPresenter.new(resource).title\n-          else\n-            super\n-          end\n-        end\n-      end\n-    end\n-  end\n-end"
            },
            {
                "sha": "bcad1f8180ff95d77ff3d35740cf3c1dfaab6230",
                "filename": "decidim-proposals/app/presenters/decidim/proposals/log/valuation_assignment_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fvaluation_assignment_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fvaluation_assignment_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fapp%2Fpresenters%2Fdecidim%2Fproposals%2Flog%2Fvaluation_assignment_presenter.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -11,7 +11,7 @@ class ValuationAssignmentPresenter < Decidim::Log::ResourcePresenter\n         # Returns an HTML-safe String.\n         def present_resource_name\n           if resource.present?\n-            Decidim::Proposals::ProposalPresenter.new(resource.proposal).title\n+            resource.proposal.presenter.title(html_escape: true)\n           else\n             super\n           end"
            },
            {
                "sha": "eece899cc960be2aaaeb2e29c6301e8b72c09772",
                "filename": "decidim-proposals/lib/decidim/proposals/test/factories.rb",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Flib%2Fdecidim%2Fproposals%2Ftest%2Ffactories.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Flib%2Fdecidim%2Fproposals%2Ftest%2Ffactories.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Flib%2Fdecidim%2Fproposals%2Ftest%2Ffactories.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -441,7 +441,13 @@\n     transient do\n       skip_injection { false }\n     end\n-    body { Faker::Lorem.sentences(number: 3).join(\"\\n\") }\n+    body do\n+      if skip_injection\n+        generate(:title)\n+      else\n+        \"<script>alert(\\\"proposal_note_body\\\");</script> #{generate(:title)}\"\n+      end\n+    end\n     proposal { build(:proposal, skip_injection:) }\n     author { build(:user, organization: proposal.organization, skip_injection:) }\n   end"
            },
            {
                "sha": "ef5e175390437921c2181bc78808038273d9bdaf",
                "filename": "decidim-proposals/spec/presenters/decidim/log/resource_presenter_spec.rb",
                "status": "renamed",
                "additions": 1,
                "deletions": 6,
                "changes": 7,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Flog%2Fresource_presenter_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,7 +2,7 @@\n \n require \"spec_helper\"\n \n-describe Decidim::Proposals::Log::ResourcePresenter, type: :helper do\n+describe Decidim::Log::ResourcePresenter, type: :helper do\n   let(:presenter) { described_class.new(resource, helper, extra) }\n   let(:resource) { create(:proposal, title: Faker::Book.unique.title) }\n   let(:extra) do\n@@ -12,11 +12,6 @@\n   end\n   let(:resource_path) { Decidim::ResourceLocatorPresenter.new(resource).path }\n \n-  before do\n-    helper.extend(Decidim::ApplicationHelper)\n-    helper.extend(Decidim::TranslationsHelper)\n-  end\n-\n   context \"when the resource exists\" do\n     it \"links to its public page with the name of the proposal\" do\n       html = presenter.present",
                "previous_filename": "decidim-proposals/spec/presenters/decidim/proposals/log/resource_presenter_spec.rb"
            },
            {
                "sha": "6b105536f92abbae48c13575be0c6137110614f3",
                "filename": "decidim-proposals/spec/presenters/decidim/proposals/admin_log/value_types/proposal_title_body_presenter_spec.rb",
                "status": "modified",
                "additions": 10,
                "deletions": 3,
                "changes": 13,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fpresenters%2Fdecidim%2Fproposals%2Fadmin_log%2Fvalue_types%2Fproposal_title_body_presenter_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -2,16 +2,23 @@\n \n require \"spec_helper\"\n \n-describe Decidim::Proposals::AdminLog::ValueTypes::ProposalTitleBodyPresenter do\n-  subject { described_class.new(value, _helpers) }\n+describe Decidim::Proposals::AdminLog::ValueTypes::ProposalTitleBodyPresenter, type: :helper do\n+  subject { described_class.new(value, helper) }\n+\n+  before do\n+    module FooBar\n+      include Decidim::SanitizeHelper\n+    end\n+\n+    helper.extend FooBar\n+  end\n \n   let(:value) do\n     {\n       \"en\" => \"My value\",\n       \"es\" => \"My title in Spanish\"\n     }\n   end\n-  let(:_helpers) { nil }\n \n   describe \"#present\" do\n     it \"handles i18n fields\" do"
            },
            {
                "sha": "2ffa9576a6e1fd08de2f81b2951404a1374bf84b",
                "filename": "decidim-proposals/spec/shared/manage_proposals_examples.rb",
                "status": "modified",
                "additions": 9,
                "deletions": 5,
                "changes": 14,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fshared%2Fmanage_proposals_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fshared%2Fmanage_proposals_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fshared%2Fmanage_proposals_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -66,6 +66,8 @@\n         end\n \n         context \"when process is not related to any scope\" do\n+          let(:attributes) { attributes_for(:proposal, component: current_component) }\n+\n           it \"can be related to a scope\" do\n             click_link \"New proposal\"\n \n@@ -74,12 +76,12 @@\n             end\n           end\n \n-          it \"creates a new proposal\", :slow do\n+          it \"creates a new proposal\", versioning: true do\n             click_link \"New proposal\"\n \n             within \".new_proposal\" do\n-              fill_in_i18n :proposal_title, \"#proposal-title-tabs\", en: \"Make decidim great again\"\n-              fill_in_i18n_editor :proposal_body, \"#proposal-body-tabs\", en: \"Decidim is great but it can be better\"\n+              fill_in_i18n :proposal_title, \"#proposal-title-tabs\", **attributes[:title].except(\"machine_translations\")\n+              fill_in_i18n_editor :proposal_body, \"#proposal-body-tabs\", **attributes[:body].except(\"machine_translations\")\n               select translated(category.name), from: :proposal_category_id\n               select translated(scope.name), from: :proposal_scope_id\n               find(\"*[type=submit]\").click\n@@ -90,11 +92,13 @@\n             within \"table\" do\n               proposal = Decidim::Proposals::Proposal.last\n \n-              expect(page).to have_content(\"Make decidim great again\")\n-              expect(translated(proposal.body)).to eq(\"<p>Decidim is great but it can be better</p>\")\n+              expect(page).to have_content(translated(attributes[:title]))\n+              expect(translated(proposal.body)).to eq(\"<p>#{strip_tags(translated(attributes[:body]))}</p>\")\n               expect(proposal.category).to eq(category)\n               expect(proposal.scope).to eq(scope)\n             end\n+            visit decidim_admin.root_path\n+            expect(page).to have_content(\"created the #{translated(attributes[:title])} proposal\")\n           end\n         end\n "
            },
            {
                "sha": "1e993c82f123fa7e2de1f924e622d4a84eb8c300",
                "filename": "decidim-proposals/spec/system/admin/admin_edits_proposal_spec.rb",
                "status": "modified",
                "additions": 10,
                "deletions": 6,
                "changes": 16,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_edits_proposal_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_edits_proposal_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_edits_proposal_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -22,25 +22,29 @@\n   end\n \n   describe \"editing an official proposal\" do\n-    let(:new_title) { \"This is my proposal new title\" }\n-    let(:new_body) { \"This is my proposal new body\" }\n+    let(:attributes) { attributes_for(:proposal, component: current_component) }\n \n     it \"can be updated\" do\n       visit_component_admin\n \n       find(\"a.action-icon--edit-proposal\").click\n       expect(page).to have_content \"Update proposal\"\n \n-      fill_in_i18n :proposal_title, \"#proposal-title-tabs\", en: new_title\n-      fill_in_i18n_editor :proposal_body, \"#proposal-body-tabs\", en: new_body\n+      fill_in_i18n :proposal_title, \"#proposal-title-tabs\", **attributes[:title].except(\"machine_translations\")\n+      fill_in_i18n_editor :proposal_body, \"#proposal-body-tabs\", **attributes[:body].except(\"machine_translations\")\n       click_button \"Update\"\n \n       preview_window = window_opened_by { find(\"a.action-icon--preview\").click }\n \n       within_window preview_window do\n-        expect(page).to have_content(new_title)\n-        expect(page).to have_content(new_body)\n+        expect(page).to have_content(translated(attributes[:title]))\n+        expect(page).to have_content(strip_tags(translated(attributes[:body])).strip)\n       end\n+\n+      expect(page).to have_admin_callout(\"successfully\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} official proposal\")\n     end\n \n     context \"when the proposal has some votes\" do"
            },
            {
                "sha": "13401326f3d4d287918d20c71e24f9435b8bdbe3",
                "filename": "decidim-proposals/spec/system/admin/admin_manages_proposal_valuators_spec.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_proposal_valuators_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_proposal_valuators_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_proposal_valuators_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -52,6 +52,11 @@\n           expect(page).to have_selector(\"td.valuators-count\", text: 1)\n         end\n       end\n+\n+      it \"displays log\" do\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"assigned the #{translated(proposal.title)} proposal to a valuator\")\n+      end\n     end\n   end\n "
            },
            {
                "sha": "7f3680bf7574bdb9bc45085b970739f7e6dca469",
                "filename": "decidim-proposals/spec/system/admin/index_proposal_notes_spec.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 4,
                "changes": 12,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Findex_proposal_notes_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Findex_proposal_notes_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-proposals%2Fspec%2Fsystem%2Fadmin%2Findex_proposal_notes_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -9,6 +9,7 @@\n   let(:manifest_name) { \"proposals\" }\n   let(:proposal) { create(:proposal, component:) }\n   let(:participatory_space) { component.participatory_space }\n+  let(:attributes) { attributes_for(:proposal_note) }\n \n   let(:body) { \"New awesome body\" }\n   let(:proposal_notes_count) { 5 }\n@@ -33,15 +34,15 @@\n   it \"shows proposal notes for the current proposal\" do\n     proposal_notes.each do |proposal_note|\n       expect(page).to have_content(proposal_note.author.name)\n-      expect(page).to have_content(proposal_note.body)\n+      expect(page).to have_content(decidim_sanitize_translated(proposal_note.body))\n     end\n     expect(page).to have_selector(\"form\")\n   end\n \n   context \"when the form has a text inside body\" do\n-    it \"creates a proposal note\", :slow do\n+    it \"creates a proposal note\", versioning: true do\n       within \".new_proposal_note\" do\n-        fill_in :proposal_note_body, with: body\n+        fill_in :proposal_note_body, with: attributes[:body]\n \n         find(\"*[type=submit]\").click\n       end\n@@ -50,8 +51,11 @@\n \n       click_button \"Private notes\"\n       within \".component__show_notes-grid .comment:last-child\" do\n-        expect(page).to have_content(\"New awesome body\")\n+        expect(page).to have_content(decidim_sanitize_translated(attributes[:body]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"left a private note on the #{translated(proposal.title)} proposal\")\n     end\n   end\n "
            },
            {
                "sha": "8bbe9f8f0b7eb550818f1e5fa729e12ab03d8384",
                "filename": "decidim-sortitions/spec/shared/manage_sortitions_examples.rb",
                "status": "modified",
                "additions": 9,
                "deletions": 23,
                "changes": 32,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-sortitions%2Fspec%2Fshared%2Fmanage_sortitions_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-sortitions%2Fspec%2Fshared%2Fmanage_sortitions_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-sortitions%2Fspec%2Fshared%2Fmanage_sortitions_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -56,37 +56,20 @@\n       let(:sortition_dice) { Faker::Number.between(from: 1, to: 6) }\n       let(:sortition_target_items) { Faker::Number.between(from: 1, to: 10) }\n       let!(:proposal) { create(:proposal, component: proposal_component) }\n+      let(:attributes) { attributes_for(:sortition, component: current_component) }\n \n       it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='sortition-additional_info-tabs']\", \"full\"\n       it_behaves_like \"having a rich text editor for field\", \".tabs-content[data-tabs-content='sortition-witnesses-tabs']\", \"content\"\n \n-      it \"shows the sortition details\" do\n+      it \"shows the sortition details\", versioning: true do\n         within \".new_sortition\" do\n           fill_in :sortition_dice, with: sortition_dice\n           fill_in :sortition_target_items, with: sortition_target_items\n           select translated(proposal_component.name), from: :sortition_decidim_proposals_component_id\n-          fill_in_i18n_editor(\n-            :sortition_witnesses,\n-            \"#sortition-witnesses-tabs\",\n-            en: \"Witnesses\",\n-            es: \"Testigos\",\n-            ca: \"Testimonis\"\n-          )\n-          fill_in_i18n_editor(\n-            :sortition_additional_info,\n-            \"#sortition-additional_info-tabs\",\n-            en: \"additional info\",\n-            es: \"Informaci\u00f3n adicional\",\n-            ca: \"Informaci\u00f3 adicional\"\n-          )\n-\n-          fill_in_i18n(\n-            :sortition_title,\n-            \"#sortition-title-tabs\",\n-            en: \"Title\",\n-            es: \"T\u00edtulo\",\n-            ca: \"T\u00edtol\"\n-          )\n+\n+          fill_in_i18n_editor(:sortition_witnesses, \"#sortition-witnesses-tabs\", **attributes[:witnesses].except(\"machine_translations\"))\n+          fill_in_i18n_editor(:sortition_additional_info, \"#sortition-additional_info-tabs\", **attributes[:additional_info].except(\"machine_translations\"))\n+          fill_in_i18n(:sortition_title, \"#sortition-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n           accept_confirm { find(\"*[type=submit]\").click }\n         end\n@@ -114,6 +97,9 @@\n             expect(page).to have_content(translated(p.title))\n           end\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"created the #{translated(attributes[:title])} sortition\")\n       end\n     end\n   end"
            },
            {
                "sha": "1cebd42893b5bde72e917f8be215079a434620ab",
                "filename": "decidim-sortitions/spec/shared/update_sortitions_examples.rb",
                "status": "modified",
                "additions": 7,
                "deletions": 16,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-sortitions%2Fspec%2Fshared%2Fupdate_sortitions_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-sortitions%2Fspec%2Fshared%2Fupdate_sortitions_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-sortitions%2Fspec%2Fshared%2Fupdate_sortitions_examples.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -3,6 +3,7 @@\n shared_examples \"update sortitions\" do\n   describe \"update sortition data\" do\n     let!(:sortition) { create(:sortition, component: current_component) }\n+    let(:attributes) { attributes_for(:sortition, component: current_component) }\n \n     before do\n       visit_component_admin\n@@ -24,28 +25,18 @@\n     end\n \n     context \"when updates a sortition\" do\n-      it \"Redirects to sortitions view\" do\n+      it \"Redirects to sortitions view\", versioning: true do\n         within \".edit_sortition\" do\n-          fill_in_i18n_editor(\n-            :sortition_additional_info,\n-            \"#sortition-additional_info-tabs\",\n-            en: \"Additional info\",\n-            es: \"Informaci\u00f3n adicional\",\n-            ca: \"Informaci\u00f3 adicional\"\n-          )\n-\n-          fill_in_i18n(\n-            :sortition_title,\n-            \"#sortition-title-tabs\",\n-            en: \"Title\",\n-            es: \"T\u00edtulo\",\n-            ca: \"T\u00edtol\"\n-          )\n+          fill_in_i18n_editor(:sortition_additional_info, \"#sortition-additional_info-tabs\", **attributes[:additional_info].except(\"machine_translations\"))\n+          fill_in_i18n(:sortition_title, \"#sortition-title-tabs\", **attributes[:title].except(\"machine_translations\"))\n \n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} sortition\")\n       end\n     end\n   end"
            },
            {
                "sha": "47cf9bfabdddac2f56b5bfbfa17309345de8fdd0",
                "filename": "decidim-templates/spec/system/admin/admin_manages_proposal_answer_templates_spec.rb",
                "status": "modified",
                "additions": 22,
                "deletions": 18,
                "changes": 40,
                "blob_url": "https://github.com/decidim/decidim/blob/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-templates%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_proposal_answer_templates_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/e494235d559be13dd1f8694345e6f6bba762d1c0/decidim-templates%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_proposal_answer_templates_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-templates%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_proposal_answer_templates_spec.rb?ref=e494235d559be13dd1f8694345e6f6bba762d1c0",
                "patch": "@@ -3,8 +3,14 @@\n require \"spec_helper\"\n \n describe \"Admin manages proposal answer templates\" do\n+  let(:description) { \"A component\" }\n   let!(:organization) { create(:organization) }\n   let!(:user) { create(:user, :admin, :confirmed, organization:) }\n+  let(:participatory_space) { create(:participatory_process, title: { en: \"A participatory process\" }, organization:) }\n+  let!(:templatable) { create(:proposal_component, name: { en: description }, participatory_space:) }\n+  let(:field_values) { { internal_state: \"not_answered\" } }\n+  let!(:template) { create(:template, target: :proposal_answer, organization:, templatable:, field_values:) }\n+  let(:attributes) { attributes_for(:template, target: :proposal_answer, organization:, templatable:, field_values:) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -39,31 +45,24 @@\n   end\n \n   describe \"creating a proposal_answer_template\" do\n-    let(:participatory_process) { create(:participatory_process, title: { en: \"A participatory process\" }, organization:) }\n-    let!(:proposals_component) { create(:component, manifest_name: :proposals, name: { en: \"A component\" }, participatory_space: participatory_process) }\n-\n     before do\n       within \".layout-content\" do\n         click_link(\"New\")\n       end\n     end\n \n-    shared_examples \"creates a new template with scopes\" do |scope_name|\n+    shared_examples \"creates a new template with scopes\", versioning: true do |scope_name|\n       it \"creates a new template\" do\n         within \".new_proposal_answer_template\" do\n           fill_in_i18n(\n             :proposal_answer_template_name,\n             \"#proposal_answer_template-name-tabs\",\n-            en: \"My template\",\n-            es: \"Mi plantilla\",\n-            ca: \"La meva plantilla\"\n+            **attributes[:name].except(\"machine_translations\")\n           )\n           fill_in_i18n_editor(\n             :proposal_answer_template_description,\n             \"#proposal_answer_template-description-tabs\",\n-            en: \"Description\",\n-            es: \"Descripci\u00f3n\",\n-            ca: \"Descripci\u00f3\"\n+            **attributes[:description].except(\"machine_translations\")\n           )\n \n           choose \"Not answered\"\n@@ -76,8 +75,12 @@\n         expect(page).to have_current_path decidim_admin_templates.proposal_answer_templates_path\n         within \".table-list\" do\n           expect(page).to have_i18n_content(scope_name)\n-          expect(page).to have_content(\"My template\")\n+          expect(page).to have_content(translated(attributes[:name]))\n         end\n+        expect(page).to have_admin_callout(\"successfully\")\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"created the #{translated(attributes[:name])} questionnaire template\")\n       end\n     end\n \n@@ -87,23 +90,20 @@\n \n   describe \"updating a template\" do\n     let!(:template) { create(:template, :proposal_answer, organization:) }\n-    let(:participatory_process) { create(:participatory_process, title: { en: \"A participatory process\" }, organization:) }\n-    let!(:proposals_component) { create(:component, manifest_name: :proposals, name: { en: \"A component\" }, participatory_space: participatory_process) }\n \n     before do\n       visit decidim_admin_templates.proposal_answer_templates_path\n       click_link translated(template.name)\n     end\n \n     shared_examples \"updates a template with scopes\" do |scope_name|\n-      it \"updates a template\" do\n+      it \"updates a template\", versioning: true do\n         fill_in_i18n(\n           :proposal_answer_template_name,\n           \"#proposal_answer_template-name-tabs\",\n-          en: \"My new name\",\n-          es: \"Mi nuevo nombre\",\n-          ca: \"El meu nou nom\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n+        fill_in_i18n_editor(:proposal_answer_template_description, \"#proposal_answer_template-description-tabs\", **attributes[:description].except(\"machine_translations\"))\n \n         select scope_name, from: :proposal_answer_template_component_constraint\n \n@@ -115,8 +115,12 @@\n         expect(page).to have_current_path decidim_admin_templates.proposal_answer_templates_path\n         within \".table-list\" do\n           expect(page).to have_i18n_content(scope_name)\n-          expect(page).to have_content(\"My new name\")\n+          expect(page).to have_content(translated(attributes[:name]))\n         end\n+        expect(page).to have_admin_callout(\"successfully\")\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:name])} questionnaire template\")\n       end\n     end\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/decidim/decidim/commits/9d79f09a2d38c87feb28725670d6cc1f55c22072",
        "url": "https://api.github.com/repos/decidim/decidim/commits/9d79f09a2d38c87feb28725670d6cc1f55c22072",
        "html_url": "https://github.com/decidim/decidim/commit/9d79f09a2d38c87feb28725670d6cc1f55c22072",
        "message": "Backport 'Refactor malformed titles in admin logs (part 2)' to v0.27 (#13085)\n\n* Refactor malformed titles in admin logs (part 2)\r\n\r\n* Refactor admin logs\r\n\r\n* Component presenters\r\n\r\n* Various logs\r\n\r\n* More logs\r\n\r\n* Add logs for moderation\r\n\r\n* Fix spec\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Add missing spec\r\n\r\n---------\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>\r\n\r\n* Fix syntax errors in PR\r\n\r\n* Fix specs\r\n\r\n* Add specs\r\n\r\n* Fix failing spec\r\n\r\n---------\r\n\r\nCo-authored-by: Andr\u00e9s Pereira de Lucena <andreslucena@users.noreply.github.com>",
        "files": [
            {
                "sha": "d9594699d4ee09c9d5c4882af8b3150650f62422",
                "filename": "decidim-admin/lib/decidim/admin/test/manage_attachment_collections_examples.rb",
                "status": "modified",
                "additions": 12,
                "deletions": 11,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachment_collections_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachment_collections_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_attachment_collections_examples.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -2,6 +2,7 @@\n \n shared_examples \"manage attachment collections examples\" do\n   let!(:attachment_collection) { create(:attachment_collection, collection_for: collection_for) }\n+  let(:attributes) { attributes_for(:attachment_collection) }\n \n   before do\n     visit current_path\n@@ -30,17 +31,13 @@\n       fill_in_i18n(\n         :attachment_collection_name,\n         \"#attachment_collection-name-tabs\",\n-        en: \"Application forms\",\n-        es: \"Formularios de solicitud\",\n-        ca: \"Formularis de sol\u00b7licitud\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       fill_in_i18n(\n         :attachment_collection_description,\n         \"#attachment_collection-description-tabs\",\n-        en: \"Contains the application forms\",\n-        es: \"Contiene los formularios de solicitud\",\n-        ca: \"Cont\u00e9 els formularis de sol\u00b7licitud\"\n+        **attributes[:description].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -49,8 +46,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#attachment_collections table\" do\n-      expect(page).to have_link(\"Application forms\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:name])} attachment collection\")\n   end\n \n   it \"can update an attachment collection\" do\n@@ -64,9 +64,7 @@\n       fill_in_i18n(\n         :attachment_collection_name,\n         \"#attachment_collection-name-tabs\",\n-        en: \"Latest application forms\",\n-        es: \"\u00daltimos formularios de solicitud\",\n-        ca: \"\u00daltims formularis de sol\u00b7licitud\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -75,8 +73,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#attachment_collections table\" do\n-      expect(page).to have_link(\"Latest application forms\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:name])} attachment collection\")\n   end\n \n   context \"when deleting a attachment collection\" do"
            },
            {
                "sha": "7e855654caa04409610e4da41f827c693d9b04e9",
                "filename": "decidim-admin/lib/decidim/admin/test/manage_categories_examples.rb",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_categories_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_categories_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_categories_examples.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -1,6 +1,7 @@\n # frozen_string_literal: true\n \n shared_examples \"manage categories examples\" do\n+  let(:attributes) { attributes_for(:category) }\n   it \"lists all the categories for the process\" do\n     within \"#categories table\" do\n       expect(page).to have_content(translated(category.name, locale: :en))\n@@ -25,9 +26,7 @@\n       fill_in_i18n(\n         :category_name,\n         \"#category-name-tabs\",\n-        en: \"My category\",\n-        es: \"Mi categor\u00eda\",\n-        ca: \"La meva categoria\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -36,8 +35,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#categories table\" do\n-      expect(page).to have_content(\"My category\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"added the #{translated(attributes[:name])} category to the\")\n   end\n \n   it \"updates a category\" do\n@@ -51,9 +53,7 @@\n       fill_in_i18n(\n         :category_name,\n         \"#category-name-tabs\",\n-        en: \"My new name\",\n-        es: \"Mi nuevo nombre\",\n-        ca: \"El meu nou nom\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -62,8 +62,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"#categories table\" do\n-      expect(page).to have_content(\"My new name\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"updated the #{translated(attributes[:name])} category in the\")\n   end\n \n   context \"when deleting a category\" do"
            },
            {
                "sha": "4512623fcefe69a1c3873b1daf9e02f350392343",
                "filename": "decidim-admin/lib/decidim/admin/test/manage_moderations_examples.rb",
                "status": "modified",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_moderations_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_moderations_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Flib%2Fdecidim%2Fadmin%2Ftest%2Fmanage_moderations_examples.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -77,15 +77,6 @@\n       expect(page).to have_admin_callout(\"Resource successfully unreported\")\n     end\n \n-    it \"user can hide a resource\" do\n-      within \"tr[data-id=\\\"#{moderation.id}\\\"]\" do\n-        click_link \"Hide\"\n-      end\n-\n-      expect(page).to have_admin_callout(\"Resource successfully hidden\")\n-      expect(page).to have_no_content(moderation.reportable.reported_content_url)\n-    end\n-\n     it \"user can sort by report count\" do\n       moderations.each_with_index { |moderation, index| moderation.update(report_count: index + 1) }\n       moderations_ordered_by_report_count_asc = moderations.sort_by(&:report_count)"
            },
            {
                "sha": "24851c9284772ba905dcbd440e61d6e022a74f90",
                "filename": "decidim-admin/spec/system/admin_manage_moderated_users_spec.rb",
                "status": "modified",
                "additions": 22,
                "deletions": 0,
                "changes": 22,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manage_moderated_users_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manage_moderated_users_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manage_moderated_users_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -176,5 +176,27 @@\n \n       it_behaves_like \"a paginated collection\", url: true\n     end\n+\n+    context \"when the user is blocked\" do\n+      let!(:first_user) { create(:user, :confirmed, organization: organization) }\n+\n+      before do\n+        visit decidim_admin.moderated_users_path\n+      end\n+\n+      it \"displays the proper log\" do\n+        within find(\"tr\", text: first_user.name) do\n+          click_link \"Block\"\n+        end\n+        fill_in :block_user_justification, with: \"This user is a spammer\" * 2 # to have at least 15 chars\n+\n+        click_on I18n.t(\"decidim.admin.block_user.new.action\")\n+\n+        expect(first_user.reload).to be_blocked\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"blocked user\")\n+      end\n+    end\n   end\n end"
            },
            {
                "sha": "4740029a5741101ccdfee538c5ea296fb3b066ec",
                "filename": "decidim-admin/spec/system/admin_manages_global_moderations_spec.rb",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_global_moderations_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_global_moderations_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_global_moderations_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -28,6 +28,18 @@\n \n   it_behaves_like \"manage moderations\" do\n     let(:moderations_link_text) { \"Global moderations\" }\n+\n+    it \"user can hide a resource\" do\n+      within \"tr[data-id=\\\"#{moderation.id}\\\"]\" do\n+        click_link \"Hide\"\n+      end\n+\n+      expect(page).to have_admin_callout(\"Resource successfully hidden\")\n+      expect(page).to have_no_content(moderation.reportable.reported_content_url)\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"hid a resource of type\")\n+    end\n   end\n \n   it_behaves_like \"sorted moderations\" do"
            },
            {
                "sha": "daddca47138cec87de7f1604f2ed296c773e41ce",
                "filename": "decidim-admin/spec/system/admin_manages_help_sections_spec.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_help_sections_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_help_sections_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_help_sections_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -30,6 +30,9 @@\n \n       help_content = Decidim::ContextualHelpSection.find_content(organization, :participatory_processes)\n       expect(help_content).to include(\"en\" => \"<p>Well hello!</p>\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the Participatory processes help section\")\n     end\n \n     it \"destroys the section when it is empty\" do"
            },
            {
                "sha": "03e8310c1b5cc54f61ee957108c909c622091244",
                "filename": "decidim-admin/spec/system/admin_manages_newsletters_spec.rb",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_newsletters_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_newsletters_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_newsletters_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -7,6 +7,7 @@\n \n describe \"Admin manages newsletters\", type: :system do\n   let(:organization) { create(:organization) }\n+  let!(:attributes) { attributes_for(:newsletter, organization: organization) }\n   let(:user) { create(:user, :admin, :confirmed, name: \"Sarah Kerrigan\", organization: organization) }\n   let!(:deliverable_users) { create_list(:user, 5, :confirmed, newsletter_notifications_at: Time.current, organization: organization) }\n \n@@ -43,9 +44,7 @@\n         fill_in_i18n(\n           :newsletter_subject,\n           \"#newsletter-subject-tabs\",\n-          en: \"A fancy newsletter for %{name}\",\n-          es: \"Un correo electr\u00f3nico muy chulo para %{name}\",\n-          ca: \"Un correu electr\u00f2nic flipant per a %{name}\"\n+          **attributes[:subject].except(\"machine_translations\")\n         )\n \n         fill_in_i18n_editor(\n@@ -84,7 +83,10 @@\n       end\n \n       expect(page).to have_content(\"Preview\")\n-      expect(page).to have_content(\"A fancy newsletter for #{user.name}\")\n+      expect(page).to have_content(translated(attributes[:subject]))\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:subject])} newsletter\")\n     end\n   end\n \n@@ -128,9 +130,7 @@\n         fill_in_i18n(\n           :newsletter_subject,\n           \"#newsletter-subject-tabs\",\n-          en: \"A fancy newsletter\",\n-          es: \"Un correo electr\u00f3nico muy chulo\",\n-          ca: \"Un correu electr\u00f2nic flipant\"\n+          **attributes[:subject].except(\"machine_translations\")\n         )\n \n         fill_in_i18n_editor(\n@@ -145,7 +145,10 @@\n       end\n \n       expect(page).to have_content(\"Preview\")\n-      expect(page).to have_content(\"A fancy newsletter\")\n+      expect(page).to have_content(translated(attributes[:subject]))\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:subject])} newsletter\")\n     end\n   end\n "
            },
            {
                "sha": "1ede90110e274024284f4af473e39e1350b7297d",
                "filename": "decidim-admin/spec/system/admin_manages_organization_area_types_spec.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 10,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_area_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_area_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_area_types_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -5,6 +5,7 @@\n describe \"Admin manages area types\", type: :system do\n   let(:admin) { create :user, :admin, :confirmed }\n   let(:organization) { admin.organization }\n+  let(:attributes) { attributes_for(:area_type) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -23,17 +24,13 @@\n       fill_in_i18n(\n         :area_type_name,\n         \"#area_type-name-tabs\",\n-        en: \"Sectorial en\",\n-        es: \"Sectorial es\",\n-        ca: \"Sectorial ca\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       fill_in_i18n(\n         :area_type_plural,\n         \"#area_type-plural-tabs\",\n-        en: \"Sectorials en\",\n-        es: \"Sectoriales es\",\n-        ca: \"Sectorials ca\"\n+        **attributes[:plural].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -42,8 +39,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"Sectorial en\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:name])} area type\")\n   end\n \n   context \"with existing area_types\" do\n@@ -68,22 +68,25 @@\n         fill_in_i18n(\n           :area_type_name,\n           \"#area_type-name-tabs\",\n-          en: \"Not Sectorial en\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         fill_in_i18n(\n           :area_type_plural,\n           \"#area_type-plural-tabs\",\n-          en: \"This is the new pluarl\"\n+          **attributes[:plural].except(\"machine_translations\")\n         )\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"Not Sectorial en\")\n+        expect(page).to have_content(translated(attributes[:name]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:name])} area type\")\n     end\n \n     it \"can delete them\" do"
            },
            {
                "sha": "085c42a6da0e903a69908bd2f1605bb7e196b04d",
                "filename": "decidim-admin/spec/system/admin_manages_organization_areas_spec.rb",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_areas_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_areas_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_areas_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -7,6 +7,7 @@\n \n   let(:admin) { create :user, :admin, :confirmed }\n   let(:organization) { admin.organization }\n+  let(:attributes) { attributes_for(:area) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -26,9 +27,7 @@\n       click_link \"Add\"\n \n       within \".new_area\" do\n-        fill_in_i18n :area_name, \"#area-name-tabs\", en: \"My area\",\n-                                                    es: \"Mi area\",\n-                                                    ca: \"La meva area\"\n+        fill_in_i18n :area_name, \"#area-name-tabs\", **attributes[:name].except(\"machine_translations\")\n         select area_type.name[\"en\"], from: :area_area_type_id\n \n         find(\"*[type=submit]\").click\n@@ -37,8 +36,11 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My area\")\n+        expect(page).to have_content(translated(attributes[:name]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:name])} area\")\n     end\n \n     context \"with existing areas\" do\n@@ -61,17 +63,18 @@\n         end\n \n         within \".edit_area\" do\n-          fill_in_i18n :area_name, \"#area-name-tabs\", en: \"Another area\",\n-                                                      es: \"Otra area\",\n-                                                      ca: \"Una altra area\"\n+          fill_in_i18n :area_name, \"#area-name-tabs\", **attributes[:name].except(\"machine_translations\")\n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n \n         within \"table\" do\n-          expect(page).to have_content(\"Another area\")\n+          expect(page).to have_content(translated(attributes[:name]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:name])} area\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "193363ee9637f519bfe7135fcfd62a1175b36c82",
                "filename": "decidim-admin/spec/system/admin_manages_organization_scope_types_spec.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 10,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scope_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scope_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scope_types_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -5,6 +5,7 @@\n describe \"Admin manages scope types\", type: :system do\n   let(:admin) { create :user, :admin, :confirmed }\n   let(:organization) { admin.organization }\n+  let!(:attributes) { attributes_for(:scope_type) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -23,17 +24,13 @@\n       fill_in_i18n(\n         :scope_type_name,\n         \"#scope_type-name-tabs\",\n-        en: \"Territorial en\",\n-        es: \"Territorial es\",\n-        ca: \"Territorial ca\"\n+        **attributes[:name].except(\"machine_translations\")\n       )\n \n       fill_in_i18n(\n         :scope_type_plural,\n         \"#scope_type-plural-tabs\",\n-        en: \"Territorials en\",\n-        es: \"Territoriales es\",\n-        ca: \"Territorials ca\"\n+        **attributes[:plural].except(\"machine_translations\")\n       )\n \n       find(\"*[type=submit]\").click\n@@ -42,8 +39,11 @@\n     expect(page).to have_admin_callout(\"successfully\")\n \n     within \"table\" do\n-      expect(page).to have_content(\"Territorial en\")\n+      expect(page).to have_content(translated(attributes[:name]))\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"created the #{translated(attributes[:name])} scope type\")\n   end\n \n   context \"with existing scope_types\" do\n@@ -68,22 +68,25 @@\n         fill_in_i18n(\n           :scope_type_name,\n           \"#scope_type-name-tabs\",\n-          en: \"Not Territorial en\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         fill_in_i18n(\n           :scope_type_plural,\n           \"#scope_type-plural-tabs\",\n-          en: \"This is the new pluarl\"\n+          **attributes[:plural].except(\"machine_translations\")\n         )\n         find(\"*[type=submit]\").click\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"Not Territorial en\")\n+        expect(page).to have_content(translated(attributes[:name]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:name])} scope type\")\n     end\n \n     it \"can delete them\" do"
            },
            {
                "sha": "b5a354439c90bb705959dacb94eb3d231901b6f6",
                "filename": "decidim-admin/spec/system/admin_manages_organization_scopes_spec.rb",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scopes_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scopes_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_scopes_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -7,6 +7,7 @@\n \n   let(:admin) { create :user, :admin, :confirmed }\n   let(:organization) { admin.organization }\n+  let!(:attributes) { attributes_for(:scope) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -26,9 +27,7 @@\n       click_link \"Add\"\n \n       within \".new_scope\" do\n-        fill_in_i18n :scope_name, \"#scope-name-tabs\", en: \"My nice district\",\n-                                                      es: \"Mi lindo distrito\",\n-                                                      ca: \"El meu bonic barri\"\n+        fill_in_i18n :scope_name, \"#scope-name-tabs\", **attributes[:name].except(\"machine_translations\")\n         fill_in \"Code\", with: \"MY-DISTRICT\"\n         select scope_type.name[\"en\"], from: :scope_scope_type_id\n \n@@ -38,8 +37,11 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within \"table\" do\n-        expect(page).to have_content(\"My nice district\")\n+        expect(page).to have_content(translated(attributes[:name]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:name])} scope\")\n     end\n \n     context \"with existing scopes\" do\n@@ -55,17 +57,18 @@\n         end\n \n         within \".edit_scope\" do\n-          fill_in_i18n :scope_name, \"#scope-name-tabs\", en: \"Another district\",\n-                                                        es: \"Otro distrito\",\n-                                                        ca: \"Un altre districte\"\n+          fill_in_i18n :scope_name, \"#scope-name-tabs\", **attributes[:name].except(\"machine_translations\")\n           find(\"*[type=submit]\").click\n         end\n \n         expect(page).to have_admin_callout(\"successfully\")\n \n         within \"table\" do\n-          expect(page).to have_content(\"Another district\")\n+          expect(page).to have_content(translated(attributes[:name]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:name])} scope\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "0c821fadffe43aa7915add2a27174ff6c37741f8",
                "filename": "decidim-admin/spec/system/admin_manages_organization_spec.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fadmin_manages_organization_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -6,6 +6,7 @@\n   include ActionView::Helpers::SanitizeHelper\n \n   let(:organization) { create(:organization) }\n+  let(:attributes) { attributes_for(:organization) }\n   let(:user) { create(:user, :admin, :confirmed, organization: organization) }\n \n   before do\n@@ -17,7 +18,7 @@\n     it \"updates the values from the form\" do\n       visit decidim_admin.edit_organization_path\n \n-      fill_in \"Name\", with: \"My super-uber organization\"\n+      fill_in :organization_name, with: attributes[:name]\n \n       %w(X Facebook Instagram YouTube GitHub).each do |network|\n         within \"#organization_social_handlers\" do\n@@ -38,6 +39,9 @@\n \n       click_button \"Update\"\n       expect(page).to have_content(\"updated successfully\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the organization settings\")\n     end\n \n     it \"marks the comments_max_length as required\" do"
            },
            {
                "sha": "4e2493bf12e16f70f02eeb5030d4880ceff4f067",
                "filename": "decidim-admin/spec/system/static_pages_spec.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 10,
                "changes": 23,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fstatic_pages_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-admin%2Fspec%2Fsystem%2Fstatic_pages_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-admin%2Fspec%2Fsystem%2Fstatic_pages_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -137,6 +137,7 @@\n \n   describe \"Managing pages\" do\n     let!(:topic) { create(:static_page_topic, organization: organization) }\n+    let(:attributes) { attributes_for(:static_page) }\n \n     before do\n       login_as admin, scope: :user\n@@ -163,17 +164,13 @@\n         fill_in_i18n(\n           :static_page_title,\n           \"#static_page-title-tabs\",\n-          en: \"Welcome to Decidim\",\n-          es: \"Te damos la bienvendida a Decidim\",\n-          ca: \"Et donem la benvinguda a Decidim\"\n+          **attributes[:title].except(\"machine_translations\")\n         )\n \n         fill_in_i18n_editor(\n           :static_page_content,\n           \"#static_page-content-tabs\",\n-          en: \"<p>Some HTML content</p>\",\n-          es: \"<p>Contenido HTML</p>\",\n-          ca: \"<p>Contingut HTML</p>\"\n+          **attributes[:content].except(\"machine_translations\")\n         )\n \n         select topic.title[I18n.locale.to_s], from: \"Topic\"\n@@ -183,8 +180,11 @@\n       expect(page).to have_admin_callout(\"successfully\")\n \n       within find(\".card\", text: topic.title[I18n.locale.to_s]) do\n-        expect(page).to have_css(\"tr\", text: \"Welcome to Decidim\")\n+        expect(page).to have_css(\"tr\", text: translated(attributes[:title]))\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} static page\")\n     end\n \n     context \"with existing pages\" do\n@@ -214,12 +214,12 @@\n           fill_in_i18n(\n             :static_page_title,\n             \"#static_page-title-tabs\",\n-            en: \"Not welcomed anymore\"\n+            **attributes[:title].except(\"machine_translations\")\n           )\n           fill_in_i18n_editor(\n             :static_page_content,\n             \"#static_page-content-tabs\",\n-            en: \"This is the new <strong>content</strong>\"\n+            **attributes[:content].except(\"machine_translations\")\n           )\n           select topic.title[I18n.locale.to_s], from: \"Topic\"\n           find(\"*[type=submit]\").click\n@@ -228,8 +228,11 @@\n         expect(page).to have_admin_callout(\"successfully\")\n \n         within find(\".card\", text: topic.title[I18n.locale.to_s]) do\n-          expect(page).to have_css(\"tr\", text: \"Not welcomed anymore\")\n+          expect(page).to have_css(\"tr\", text: translated(attributes[:title]))\n         end\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} static page\")\n       end\n \n       it \"can delete them\" do"
            },
            {
                "sha": "a05220fc091df583bfb73b8d9c7a93bc5128b8fc",
                "filename": "decidim-assemblies/spec/shared/manage_assembly_components_examples.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 10,
                "changes": 26,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_components_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_components_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_components_examples.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -1,6 +1,8 @@\n # frozen_string_literal: true\n \n shared_examples \"manage assembly components\" do\n+  let!(:attributes) { attributes_for(:component, participatory_space: assembly) }\n+\n   before do\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n@@ -20,9 +22,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My component\",\n-          ca: \"La meva funcionalitat\",\n-          es: \"Mi funcionalitat\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -49,12 +49,17 @@\n \n     it \"is successfully created\" do\n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n+    end\n+\n+    it \"has a successful admin log\" do\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created #{translated(attributes[:name])} in #{translated(assembly.title)}\")\n     end\n \n     context \"and then edit it\" do\n       before do\n-        within find(\"tr\", text: \"My component\") do\n+        within \"tr\", text: translated(attributes[:name]) do\n           click_link \"Configure\"\n         end\n       end\n@@ -103,9 +108,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My updated component\",\n-          ca: \"La meva funcionalitat actualitzada\",\n-          es: \"Mi funcionalidad actualizada\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -120,9 +123,9 @@\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My updated component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n \n-      within find(\"tr\", text: \"My updated component\") do\n+      within \"tr\", text: translated(attributes[:name]) do\n         click_link \"Configure\"\n       end\n \n@@ -133,6 +136,9 @@\n       within \".default-step-settings\" do\n         expect(all(\"input[type=checkbox]\").first).to be_checked\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated #{translated(attributes[:name])} in #{translated(assembly.title)}\")\n     end\n   end\n "
            },
            {
                "sha": "4a0b109431afef537d135ac5626a07e51f13ab07",
                "filename": "decidim-assemblies/spec/shared/manage_assembly_private_users_examples.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_private_users_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_private_users_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-assemblies%2Fspec%2Fshared%2Fmanage_assembly_private_users_examples.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -33,6 +33,9 @@\n     within \"#private_users table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited #{other_user.name} to be a private participant\")\n   end\n \n   describe \"when import a batch of private users from csv\" do"
            },
            {
                "sha": "3ae1bd8acc185d786800da49d9d9b68188b612a6",
                "filename": "decidim-conferences/spec/shared/manage_conference_components_examples.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 10,
                "changes": 26,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_components_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_components_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-conferences%2Fspec%2Fshared%2Fmanage_conference_components_examples.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -1,6 +1,8 @@\n # frozen_string_literal: true\n \n shared_examples \"manage conference components\" do\n+  let!(:attributes) { attributes_for(:component, participatory_space: conference) }\n+\n   before do\n     switch_to_host(organization.host)\n     login_as user, scope: :user\n@@ -20,9 +22,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My component\",\n-          ca: \"La meva funcionalitat\",\n-          es: \"Mi funcionalitat\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -49,12 +49,17 @@\n \n     it \"is successfully created\" do\n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n+    end\n+\n+    it \"has a successful admin log\" do\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created #{translated(attributes[:name])} in #{translated(conference.title)}\")\n     end\n \n     context \"and then edit it\" do\n       before do\n-        within find(\"tr\", text: \"My component\") do\n+        within \"tr\", text: translated(attributes[:name]) do\n           click_link \"Configure\"\n         end\n       end\n@@ -103,9 +108,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My updated component\",\n-          ca: \"La meva funcionalitat actualitzada\",\n-          es: \"Mi funcionalidad actualizada\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -120,9 +123,9 @@\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My updated component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n \n-      within find(\"tr\", text: \"My updated component\") do\n+      within \"tr\", text: translated(attributes[:name]) do\n         click_link \"Configure\"\n       end\n \n@@ -133,6 +136,9 @@\n       within \".default-step-settings\" do\n         expect(all(\"input[type=checkbox]\").first).to be_checked\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated #{translated(attributes[:name])} in #{translated(conference.title)}\")\n     end\n   end\n "
            },
            {
                "sha": "6707058b49442a3286d88fc68c339b4f9769ec84",
                "filename": "decidim-core/app/presenters/decidim/admin_log/organization_presenter.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Fadmin_log%2Forganization_presenter.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Fadmin_log%2Forganization_presenter.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-core%2Fapp%2Fpresenters%2Fdecidim%2Fadmin_log%2Forganization_presenter.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -26,7 +26,7 @@ def diff_fields_mapping\n \n       def settings_attributes_mapping\n         {\n-          name: :string,\n+          name: :i18n,\n           default_locale: :locale,\n           reference_prefix: :string,\n           twitter_handler: :string,"
            },
            {
                "sha": "3f80717efd0a2014ba4f0b794ae991d139444ec1",
                "filename": "decidim-initiatives/spec/system/admin/admin_manages_initiative_components_spec.rb",
                "status": "modified",
                "additions": 15,
                "deletions": 10,
                "changes": 25,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiative_components_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiative_components_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiative_components_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -7,6 +7,7 @@\n   let(:user) { create(:user, :admin, :confirmed, organization: organization) }\n \n   let!(:initiative) { create(:initiative, organization: organization) }\n+  let!(:attributes) { attributes_for(:component, participatory_space: initiative) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -27,9 +28,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My component\",\n-          ca: \"El meu component\",\n-          es: \"Mi componente\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -59,12 +58,17 @@\n         expect(page).to have_content(\"successfully\")\n       end\n \n-      expect(page).to have_content(\"My component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n+    end\n+\n+    it \"has a successful admin log\" do\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created #{translated(attributes[:name])} in #{translated(initiative.title)}\")\n     end\n \n     context \"and then edit it\" do\n       before do\n-        within find(\"tr\", text: \"My component\") do\n+        within \"tr\", text: translated(attributes[:name]) do\n           page.find(\".action-icon--configure\").click\n         end\n       end\n@@ -115,9 +119,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My updated component\",\n-          ca: \"El meu component actualitzat\",\n-          es: \"Mi componente actualizado\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -135,9 +137,9 @@\n         expect(page).to have_content(\"successfully\")\n       end\n \n-      expect(page).to have_content(\"My updated component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n \n-      within find(\"tr\", text: \"My updated component\") do\n+      within \"tr\", text: translated(attributes[:name]) do\n         page.find(\".action-icon--configure\").click\n       end\n \n@@ -148,6 +150,9 @@\n       within \".default-step-settings\" do\n         expect(all(\"input[type=checkbox]\").first).to be_checked\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated #{translated(attributes[:name])} in #{translated(initiative.title)}\")\n     end\n   end\n "
            },
            {
                "sha": "55f5a7f33a542fd96320598f341e49556415d13b",
                "filename": "decidim-initiatives/spec/system/admin/admin_manages_initiatives_types_spec.rb",
                "status": "modified",
                "additions": 17,
                "deletions": 9,
                "changes": 26,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiatives_types_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiatives_types_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fadmin_manages_initiatives_types_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -6,6 +6,7 @@\n   let(:organization) { create(:organization) }\n   let(:user) { create(:user, :admin, :confirmed, organization: organization) }\n   let!(:initiatives_type) { create(:initiatives_type, organization: organization) }\n+  let(:attributes) { attributes_for(:initiatives_type) }\n \n   before do\n     switch_to_host(organization.host)\n@@ -26,13 +27,13 @@\n       fill_in_i18n(\n         :initiatives_type_title,\n         \"#initiatives_type-title-tabs\",\n-        en: \"My initiative type\"\n+        **attributes[:title].except(\"machine_translations\")\n       )\n \n       fill_in_i18n_editor(\n         :initiatives_type_description,\n         \"#initiatives_type-description-tabs\",\n-        en: \"A longer description\"\n+        **attributes[:description].except(\"machine_translations\")\n       )\n \n       select(\"Online\", from: \"Signature type\")\n@@ -41,9 +42,10 @@\n \n       click_button \"Create\"\n \n-      within \".callout-wrapper\" do\n-        expect(page).to have_content(\"A new initiative type has been successfully created\")\n-      end\n+      expect(page).to have_admin_callout(\"A new initiative type has been successfully created\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"created the #{translated(attributes[:title])} initiatives type\")\n     end\n   end\n \n@@ -56,7 +58,12 @@\n       fill_in_i18n(\n         :initiatives_type_title,\n         \"#initiatives_type-title-tabs\",\n-        en: \"My updated initiative type\"\n+        **attributes[:title].except(\"machine_translations\")\n+      )\n+      fill_in_i18n_editor(\n+        :initiatives_type_description,\n+        \"#initiatives_type-description-tabs\",\n+        **attributes[:description].except(\"machine_translations\")\n       )\n \n       select(\"Mixed\", from: \"Signature type\")\n@@ -68,9 +75,10 @@\n \n       click_button \"Update\"\n \n-      within \".callout-wrapper\" do\n-        expect(page).to have_content(\"The initiative type has been successfully updated\")\n-      end\n+      expect(page).to have_admin_callout(\"The initiative type has been successfully updated\")\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated the #{translated(attributes[:title])} initiatives type\")\n     end\n   end\n "
            },
            {
                "sha": "49470d2165351b6e661462f8bb51c02499ec2802",
                "filename": "decidim-initiatives/spec/system/admin/update_initiative_spec.rb",
                "status": "modified",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fupdate_initiative_spec.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fupdate_initiative_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-initiatives%2Fspec%2Fsystem%2Fadmin%2Fupdate_initiative_spec.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -15,6 +15,8 @@ def submit_and_validate\n \n   context \"when initiative update\" do\n     context \"and user is admin\" do\n+      let(:attributes) { attributes_for(:initiative, organization: organization) }\n+\n       before do\n         switch_to_host(organization.host)\n         login_as user, scope: :user\n@@ -29,6 +31,25 @@ def submit_and_validate\n         submit_and_validate\n       end\n \n+      it \"updates the initiative\" do\n+        page.find(\".action-icon--edit\").click\n+\n+        fill_in_i18n(\n+          :initiative_title,\n+          \"#initiative-title-tabs\",\n+          **attributes[:title].except(\"machine_translations\")\n+        )\n+        fill_in_i18n_editor(\n+          :initiative_description,\n+          \"#initiative-description-tabs\",\n+          **attributes[:description].except(\"machine_translations\")\n+        )\n+        submit_and_validate\n+\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"updated the #{translated(attributes[:title])} initiative\")\n+      end\n+\n       context \"when initiative is in created state\" do\n         before do\n           initiative.created!"
            },
            {
                "sha": "7564d6966a26a914db6393f34b1b2b6fe1a5e9ff",
                "filename": "decidim-participatory_processes/spec/shared/manage_participatory_process_private_users_examples.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_participatory_process_private_users_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_participatory_process_private_users_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_participatory_process_private_users_examples.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -33,6 +33,9 @@\n     within \"#private_users table\" do\n       expect(page).to have_content(other_user.email)\n     end\n+\n+    visit decidim_admin.root_path\n+    expect(page).to have_content(\"invited #{other_user.name} to be a private participant\")\n   end\n \n   describe \"when import a batch of private users from csv\" do"
            },
            {
                "sha": "97dfa8e3b6c6fcfa168230115cffabc9db7ceb1f",
                "filename": "decidim-participatory_processes/spec/shared/manage_process_components_examples.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 10,
                "changes": 26,
                "blob_url": "https://github.com/decidim/decidim/blob/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_components_examples.rb",
                "raw_url": "https://github.com/decidim/decidim/raw/9d79f09a2d38c87feb28725670d6cc1f55c22072/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_components_examples.rb",
                "contents_url": "https://api.github.com/repos/decidim/decidim/contents/decidim-participatory_processes%2Fspec%2Fshared%2Fmanage_process_components_examples.rb?ref=9d79f09a2d38c87feb28725670d6cc1f55c22072",
                "patch": "@@ -4,6 +4,8 @@\n   let!(:participatory_process) do\n     create(:participatory_process, :with_steps, organization: organization)\n   end\n+  let!(:attributes) { attributes_for(:component, participatory_space: participatory_process) }\n+\n   let(:step_id) { participatory_process.steps.first.id }\n \n   before do\n@@ -30,9 +32,7 @@\n           fill_in_i18n(\n             :component_name,\n             \"#component-name-tabs\",\n-            en: \"My component\",\n-            ca: \"La meva funcionalitat\",\n-            es: \"Mi funcionalitat\"\n+            **attributes[:name].except(\"machine_translations\")\n           )\n \n           within \".global-settings\" do\n@@ -59,12 +59,17 @@\n \n       it \"is successfully created\" do\n         expect(page).to have_admin_callout(\"successfully\")\n-        expect(page).to have_content(\"My component\")\n+        expect(page).to have_content(translated(attributes[:name]))\n+      end\n+\n+      it \"has a successful admin log\" do\n+        visit decidim_admin.root_path\n+        expect(page).to have_content(\"created #{translated(attributes[:name])} in #{translated(participatory_process.title)}\")\n       end\n \n       context \"and then edit it\" do\n         before do\n-          within find(\"tr\", text: \"My component\") do\n+          within \"tr\", text: translated(attributes[:name]) do\n             click_link \"Configure\"\n           end\n         end\n@@ -194,9 +199,7 @@\n         fill_in_i18n(\n           :component_name,\n           \"#component-name-tabs\",\n-          en: \"My updated component\",\n-          ca: \"La meva funcionalitat actualitzada\",\n-          es: \"Mi funcionalidad actualizada\"\n+          **attributes[:name].except(\"machine_translations\")\n         )\n \n         within \".global-settings\" do\n@@ -211,9 +214,9 @@\n       end\n \n       expect(page).to have_admin_callout(\"successfully\")\n-      expect(page).to have_content(\"My updated component\")\n+      expect(page).to have_content(translated(attributes[:name]))\n \n-      within find(\"tr\", text: \"My updated component\") do\n+      within \"tr\", text: translated(attributes[:name]) do\n         click_link \"Configure\"\n       end\n \n@@ -224,6 +227,9 @@\n       within \".step-settings\" do\n         expect(all(\"input[type=checkbox]\").first).to be_checked\n       end\n+\n+      visit decidim_admin.root_path\n+      expect(page).to have_content(\"updated #{translated(attributes[:name])} in #{translated(participatory_process.title)}\")\n     end\n \n     context \"when the process doesn't have active steps\" do"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cure53/DOMPurify/commits/26e1d69ca7f769f5c558619d644d90dd8bf26ebc",
        "url": "https://api.github.com/repos/cure53/DOMPurify/commits/26e1d69ca7f769f5c558619d644d90dd8bf26ebc",
        "html_url": "https://github.com/cure53/DOMPurify/commit/26e1d69ca7f769f5c558619d644d90dd8bf26ebc",
        "message": "fix: Merged prototype pollution check into 2.x",
        "files": [
            {
                "sha": "01152d750c71c48a5467406c5949e1127c40f4cc",
                "filename": "dist/purify.cjs.js",
                "status": "modified",
                "additions": 11,
                "deletions": 4,
                "changes": 15,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.cjs.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.cjs.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.cjs.js?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc",
                "patch": "@@ -112,6 +112,7 @@ var stringIndexOf = unapply(String.prototype.indexOf);\n var stringTrim = unapply(String.prototype.trim);\n var regExpTest = unapply(RegExp.prototype.test);\n var typeErrorCreate = unconstruct(TypeError);\n+var numberIsNaN = unapply(Number.isNaN);\n function unapply(func) {\n   return function (thisArg) {\n     for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n@@ -1269,8 +1270,11 @@ function createDOMPurify() {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (shadowNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (shadowNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(shadowNode.__depth)) {\n         _forceRemove(shadowNode);\n       }\n \n@@ -1421,8 +1425,11 @@ function createDOMPurify() {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (currentNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (currentNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(currentNode.__depth)) {\n         _forceRemove(currentNode);\n       }\n "
            },
            {
                "sha": "ce9f8175fdb707707d7661c4f53ae0a754afc296",
                "filename": "dist/purify.cjs.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.cjs.js.map",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.cjs.js.map",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.cjs.js.map?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc"
            },
            {
                "sha": "78492faae61c2f309c5c077b4b0d6ee10f543c06",
                "filename": "dist/purify.es.js",
                "status": "modified",
                "additions": 11,
                "deletions": 4,
                "changes": 15,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.es.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.es.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.es.js?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc",
                "patch": "@@ -110,6 +110,7 @@ var stringIndexOf = unapply(String.prototype.indexOf);\n var stringTrim = unapply(String.prototype.trim);\n var regExpTest = unapply(RegExp.prototype.test);\n var typeErrorCreate = unconstruct(TypeError);\n+var numberIsNaN = unapply(Number.isNaN);\n function unapply(func) {\n   return function (thisArg) {\n     for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n@@ -1267,8 +1268,11 @@ function createDOMPurify() {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (shadowNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (shadowNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(shadowNode.__depth)) {\n         _forceRemove(shadowNode);\n       }\n \n@@ -1419,8 +1423,11 @@ function createDOMPurify() {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (currentNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (currentNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(currentNode.__depth)) {\n         _forceRemove(currentNode);\n       }\n "
            },
            {
                "sha": "2b70a6d8e3cbeba988b334a0327863336abaa25b",
                "filename": "dist/purify.es.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.es.js.map",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.es.js.map",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.es.js.map?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc"
            },
            {
                "sha": "9ec9a821bfd13d0b4862d9822493de9439f0b3a5",
                "filename": "dist/purify.js",
                "status": "modified",
                "additions": 11,
                "deletions": 4,
                "changes": 15,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.js?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc",
                "patch": "@@ -116,6 +116,7 @@\n   var stringTrim = unapply(String.prototype.trim);\n   var regExpTest = unapply(RegExp.prototype.test);\n   var typeErrorCreate = unconstruct(TypeError);\n+  var numberIsNaN = unapply(Number.isNaN);\n   function unapply(func) {\n     return function (thisArg) {\n       for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n@@ -1273,8 +1274,11 @@\n           }\n         }\n \n-        /* Remove an element if nested too deeply to avoid mXSS */\n-        if (shadowNode.__depth >= MAX_NESTING_DEPTH) {\n+        /*\n+         * Remove an element if nested too deeply to avoid mXSS\n+         * or if the __depth might have been tampered with\n+         */\n+        if (shadowNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(shadowNode.__depth)) {\n           _forceRemove(shadowNode);\n         }\n \n@@ -1425,8 +1429,11 @@\n           }\n         }\n \n-        /* Remove an element if nested too deeply to avoid mXSS */\n-        if (currentNode.__depth >= MAX_NESTING_DEPTH) {\n+        /*\n+         * Remove an element if nested too deeply to avoid mXSS\n+         * or if the __depth might have been tampered with\n+         */\n+        if (currentNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(currentNode.__depth)) {\n           _forceRemove(currentNode);\n         }\n "
            },
            {
                "sha": "d7f78fe1a3c51d204ed0b09f501cf8916840edf7",
                "filename": "dist/purify.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.js.map",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.js.map",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.js.map?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc"
            },
            {
                "sha": "eaeebc732c4457ed66bb0927b0c6993d8606a28a",
                "filename": "dist/purify.min.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.min.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.min.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.min.js?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc",
                "patch": "@@ -1,3 +1,3 @@\n /*! @license DOMPurify 2.5.3 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.5.3/LICENSE */\n-!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):(e=\"undefined\"!=typeof globalThis?globalThis:e||self).DOMPurify=t()}(this,(function(){\"use strict\";function e(t){return e=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},e(t)}function t(e,n){return t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(e,n)}function n(e,r,o){return n=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,n,r){var o=[null];o.push.apply(o,n);var a=new(Function.bind.apply(e,o));return r&&t(a,r.prototype),a},n.apply(null,arguments)}function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if(\"undefined\"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e[\"@@iterator\"])return Array.from(e)}(e)||function(e,t){if(!e)return;if(\"string\"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var a=Object.hasOwnProperty,i=Object.setPrototypeOf,l=Object.isFrozen,c=Object.getPrototypeOf,u=Object.getOwnPropertyDescriptor,s=Object.freeze,m=Object.seal,f=Object.create,p=\"undefined\"!=typeof Reflect&&Reflect,d=p.apply,h=p.construct;d||(d=function(e,t,n){return e.apply(t,n)}),s||(s=function(e){return e}),m||(m=function(e){return e}),h||(h=function(e,t){return n(e,r(t))});var g,y=C(Array.prototype.forEach),b=C(Array.prototype.pop),_=C(Array.prototype.push),v=C(String.prototype.toLowerCase),T=C(String.prototype.toString),N=C(String.prototype.match),E=C(String.prototype.replace),A=C(String.prototype.indexOf),S=C(String.prototype.trim),w=C(RegExp.prototype.test),x=(g=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h(g,t)});function C(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return d(e,t,r)}}function O(e,t,n){var r;n=null!==(r=n)&&void 0!==r?r:v,i&&i(e,null);for(var o=t.length;o--;){var a=t[o];if(\"string\"==typeof a){var c=n(a);c!==a&&(l(t)||(t[o]=c),a=c)}e[a]=!0}return e}function k(e){var t,n=f(null);for(t in e)!0===d(a,e,[t])&&(n[t]=e[t]);return n}function L(e,t){for(;null!==e;){var n=u(e,t);if(n){if(n.get)return C(n.get);if(\"function\"==typeof n.value)return C(n.value)}e=c(e)}return function(e){return console.warn(\"fallback value for\",e),null}}var D=s([\"a\",\"abbr\",\"acronym\",\"address\",\"area\",\"article\",\"aside\",\"audio\",\"b\",\"bdi\",\"bdo\",\"big\",\"blink\",\"blockquote\",\"body\",\"br\",\"button\",\"canvas\",\"caption\",\"center\",\"cite\",\"code\",\"col\",\"colgroup\",\"content\",\"data\",\"datalist\",\"dd\",\"decorator\",\"del\",\"details\",\"dfn\",\"dialog\",\"dir\",\"div\",\"dl\",\"dt\",\"element\",\"em\",\"fieldset\",\"figcaption\",\"figure\",\"font\",\"footer\",\"form\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"head\",\"header\",\"hgroup\",\"hr\",\"html\",\"i\",\"img\",\"input\",\"ins\",\"kbd\",\"label\",\"legend\",\"li\",\"main\",\"map\",\"mark\",\"marquee\",\"menu\",\"menuitem\",\"meter\",\"nav\",\"nobr\",\"ol\",\"optgroup\",\"option\",\"output\",\"p\",\"picture\",\"pre\",\"progress\",\"q\",\"rp\",\"rt\",\"ruby\",\"s\",\"samp\",\"section\",\"select\",\"shadow\",\"small\",\"source\",\"spacer\",\"span\",\"strike\",\"strong\",\"style\",\"sub\",\"summary\",\"sup\",\"table\",\"tbody\",\"td\",\"template\",\"textarea\",\"tfoot\",\"th\",\"thead\",\"time\",\"tr\",\"track\",\"tt\",\"u\",\"ul\",\"var\",\"video\",\"wbr\"]),R=s([\"svg\",\"a\",\"altglyph\",\"altglyphdef\",\"altglyphitem\",\"animatecolor\",\"animatemotion\",\"animatetransform\",\"circle\",\"clippath\",\"defs\",\"desc\",\"ellipse\",\"filter\",\"font\",\"g\",\"glyph\",\"glyphref\",\"hkern\",\"image\",\"line\",\"lineargradient\",\"marker\",\"mask\",\"metadata\",\"mpath\",\"path\",\"pattern\",\"polygon\",\"polyline\",\"radialgradient\",\"rect\",\"stop\",\"style\",\"switch\",\"symbol\",\"text\",\"textpath\",\"title\",\"tref\",\"tspan\",\"view\",\"vkern\"]),M=s([\"feBlend\",\"feColorMatrix\",\"feComponentTransfer\",\"feComposite\",\"feConvolveMatrix\",\"feDiffuseLighting\",\"feDisplacementMap\",\"feDistantLight\",\"feFlood\",\"feFuncA\",\"feFuncB\",\"feFuncG\",\"feFuncR\",\"feGaussianBlur\",\"feImage\",\"feMerge\",\"feMergeNode\",\"feMorphology\",\"feOffset\",\"fePointLight\",\"feSpecularLighting\",\"feSpotLight\",\"feTile\",\"feTurbulence\"]),I=s([\"animate\",\"color-profile\",\"cursor\",\"discard\",\"fedropshadow\",\"font-face\",\"font-face-format\",\"font-face-name\",\"font-face-src\",\"font-face-uri\",\"foreignobject\",\"hatch\",\"hatchpath\",\"mesh\",\"meshgradient\",\"meshpatch\",\"meshrow\",\"missing-glyph\",\"script\",\"set\",\"solidcolor\",\"unknown\",\"use\"]),F=s([\"math\",\"menclose\",\"merror\",\"mfenced\",\"mfrac\",\"mglyph\",\"mi\",\"mlabeledtr\",\"mmultiscripts\",\"mn\",\"mo\",\"mover\",\"mpadded\",\"mphantom\",\"mroot\",\"mrow\",\"ms\",\"mspace\",\"msqrt\",\"mstyle\",\"msub\",\"msup\",\"msubsup\",\"mtable\",\"mtd\",\"mtext\",\"mtr\",\"munder\",\"munderover\"]),U=s([\"maction\",\"maligngroup\",\"malignmark\",\"mlongdiv\",\"mscarries\",\"mscarry\",\"msgroup\",\"mstack\",\"msline\",\"msrow\",\"semantics\",\"annotation\",\"annotation-xml\",\"mprescripts\",\"none\"]),H=s([\"#text\"]),z=s([\"accept\",\"action\",\"align\",\"alt\",\"autocapitalize\",\"autocomplete\",\"autopictureinpicture\",\"autoplay\",\"background\",\"bgcolor\",\"border\",\"capture\",\"cellpadding\",\"cellspacing\",\"checked\",\"cite\",\"class\",\"clear\",\"color\",\"cols\",\"colspan\",\"controls\",\"controlslist\",\"coords\",\"crossorigin\",\"datetime\",\"decoding\",\"default\",\"dir\",\"disabled\",\"disablepictureinpicture\",\"disableremoteplayback\",\"download\",\"draggable\",\"enctype\",\"enterkeyhint\",\"face\",\"for\",\"headers\",\"height\",\"hidden\",\"high\",\"href\",\"hreflang\",\"id\",\"inputmode\",\"integrity\",\"ismap\",\"kind\",\"label\",\"lang\",\"list\",\"loading\",\"loop\",\"low\",\"max\",\"maxlength\",\"media\",\"method\",\"min\",\"minlength\",\"multiple\",\"muted\",\"name\",\"nonce\",\"noshade\",\"novalidate\",\"nowrap\",\"open\",\"optimum\",\"pattern\",\"placeholder\",\"playsinline\",\"poster\",\"preload\",\"pubdate\",\"radiogroup\",\"readonly\",\"rel\",\"required\",\"rev\",\"reversed\",\"role\",\"rows\",\"rowspan\",\"spellcheck\",\"scope\",\"selected\",\"shape\",\"size\",\"sizes\",\"span\",\"srclang\",\"start\",\"src\",\"srcset\",\"step\",\"style\",\"summary\",\"tabindex\",\"title\",\"translate\",\"type\",\"usemap\",\"valign\",\"value\",\"width\",\"xmlns\",\"slot\"]),P=s([\"accent-height\",\"accumulate\",\"additive\",\"alignment-baseline\",\"ascent\",\"attributename\",\"attributetype\",\"azimuth\",\"basefrequency\",\"baseline-shift\",\"begin\",\"bias\",\"by\",\"class\",\"clip\",\"clippathunits\",\"clip-path\",\"clip-rule\",\"color\",\"color-interpolation\",\"color-interpolation-filters\",\"color-profile\",\"color-rendering\",\"cx\",\"cy\",\"d\",\"dx\",\"dy\",\"diffuseconstant\",\"direction\",\"display\",\"divisor\",\"dur\",\"edgemode\",\"elevation\",\"end\",\"fill\",\"fill-opacity\",\"fill-rule\",\"filter\",\"filterunits\",\"flood-color\",\"flood-opacity\",\"font-family\",\"font-size\",\"font-size-adjust\",\"font-stretch\",\"font-style\",\"font-variant\",\"font-weight\",\"fx\",\"fy\",\"g1\",\"g2\",\"glyph-name\",\"glyphref\",\"gradientunits\",\"gradienttransform\",\"height\",\"href\",\"id\",\"image-rendering\",\"in\",\"in2\",\"k\",\"k1\",\"k2\",\"k3\",\"k4\",\"kerning\",\"keypoints\",\"keysplines\",\"keytimes\",\"lang\",\"lengthadjust\",\"letter-spacing\",\"kernelmatrix\",\"kernelunitlength\",\"lighting-color\",\"local\",\"marker-end\",\"marker-mid\",\"marker-start\",\"markerheight\",\"markerunits\",\"markerwidth\",\"maskcontentunits\",\"maskunits\",\"max\",\"mask\",\"media\",\"method\",\"mode\",\"min\",\"name\",\"numoctaves\",\"offset\",\"operator\",\"opacity\",\"order\",\"orient\",\"orientation\",\"origin\",\"overflow\",\"paint-order\",\"path\",\"pathlength\",\"patterncontentunits\",\"patterntransform\",\"patternunits\",\"points\",\"preservealpha\",\"preserveaspectratio\",\"primitiveunits\",\"r\",\"rx\",\"ry\",\"radius\",\"refx\",\"refy\",\"repeatcount\",\"repeatdur\",\"restart\",\"result\",\"rotate\",\"scale\",\"seed\",\"shape-rendering\",\"specularconstant\",\"specularexponent\",\"spreadmethod\",\"startoffset\",\"stddeviation\",\"stitchtiles\",\"stop-color\",\"stop-opacity\",\"stroke-dasharray\",\"stroke-dashoffset\",\"stroke-linecap\",\"stroke-linejoin\",\"stroke-miterlimit\",\"stroke-opacity\",\"stroke\",\"stroke-width\",\"style\",\"surfacescale\",\"systemlanguage\",\"tabindex\",\"targetx\",\"targety\",\"transform\",\"transform-origin\",\"text-anchor\",\"text-decoration\",\"text-rendering\",\"textlength\",\"type\",\"u1\",\"u2\",\"unicode\",\"values\",\"viewbox\",\"visibility\",\"version\",\"vert-adv-y\",\"vert-origin-x\",\"vert-origin-y\",\"width\",\"word-spacing\",\"wrap\",\"writing-mode\",\"xchannelselector\",\"ychannelselector\",\"x\",\"x1\",\"x2\",\"xmlns\",\"y\",\"y1\",\"y2\",\"z\",\"zoomandpan\"]),j=s([\"accent\",\"accentunder\",\"align\",\"bevelled\",\"close\",\"columnsalign\",\"columnlines\",\"columnspan\",\"denomalign\",\"depth\",\"dir\",\"display\",\"displaystyle\",\"encoding\",\"fence\",\"frame\",\"height\",\"href\",\"id\",\"largeop\",\"length\",\"linethickness\",\"lspace\",\"lquote\",\"mathbackground\",\"mathcolor\",\"mathsize\",\"mathvariant\",\"maxsize\",\"minsize\",\"movablelimits\",\"notation\",\"numalign\",\"open\",\"rowalign\",\"rowlines\",\"rowspacing\",\"rowspan\",\"rspace\",\"rquote\",\"scriptlevel\",\"scriptminsize\",\"scriptsizemultiplier\",\"selection\",\"separator\",\"separators\",\"stretchy\",\"subscriptshift\",\"supscriptshift\",\"symmetric\",\"voffset\",\"width\",\"xmlns\"]),B=s([\"xlink:href\",\"xml:id\",\"xlink:title\",\"xml:space\",\"xmlns:xlink\"]),G=m(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm),W=m(/<%[\\w\\W]*|[\\w\\W]*%>/gm),q=m(/\\${[\\w\\W]*}/gm),Y=m(/^data-[\\-\\w.\\u00B7-\\uFFFF]/),$=m(/^aria-[\\-\\w]+$/),K=m(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i),V=m(/^(?:\\w+script|data):/i),X=m(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g),Z=m(/^html$/i),J=m(/^[a-z][.\\w]*(-[.\\w]+)+$/i),Q=function(){return\"undefined\"==typeof window?null:window};var ee=function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q(),o=function(e){return t(e)};if(o.version=\"2.5.3\",o.removed=[],!n||!n.document||9!==n.document.nodeType)return o.isSupported=!1,o;var a=n.document,i=n.document,l=n.DocumentFragment,c=n.HTMLTemplateElement,u=n.Node,m=n.Element,f=n.NodeFilter,p=n.NamedNodeMap,d=void 0===p?n.NamedNodeMap||n.MozNamedAttrMap:p,h=n.HTMLFormElement,g=n.DOMParser,C=n.trustedTypes,ee=m.prototype,te=L(ee,\"cloneNode\"),ne=L(ee,\"nextSibling\"),re=L(ee,\"childNodes\"),oe=L(ee,\"parentNode\");if(\"function\"==typeof c){var ae=i.createElement(\"template\");ae.content&&ae.content.ownerDocument&&(i=ae.content.ownerDocument)}var ie=function(t,n){if(\"object\"!==e(t)||\"function\"!=typeof t.createPolicy)return null;var r=null,o=\"data-tt-policy-suffix\";n.currentScript&&n.currentScript.hasAttribute(o)&&(r=n.currentScript.getAttribute(o));var a=\"dompurify\"+(r?\"#\"+r:\"\");try{return t.createPolicy(a,{createHTML:function(e){return e},createScriptURL:function(e){return e}})}catch(e){return console.warn(\"TrustedTypes policy \"+a+\" could not be created.\"),null}}(C,a),le=ie?ie.createHTML(\"\"):\"\",ce=i,ue=ce.implementation,se=ce.createNodeIterator,me=ce.createDocumentFragment,fe=ce.getElementsByTagName,pe=a.importNode,de={};try{de=k(i).documentMode?i.documentMode:{}}catch(e){}var he={};o.isSupported=\"function\"==typeof oe&&ue&&void 0!==ue.createHTMLDocument&&9!==de;var ge,ye,be=G,_e=W,ve=q,Te=Y,Ne=$,Ee=V,Ae=X,Se=J,we=K,xe=null,Ce=O({},[].concat(r(D),r(R),r(M),r(F),r(H))),Oe=null,ke=O({},[].concat(r(z),r(P),r(j),r(B))),Le=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),De=null,Re=null,Me=!0,Ie=!0,Fe=!1,Ue=!0,He=!1,ze=!0,Pe=!1,je=!1,Be=!1,Ge=!1,We=!1,qe=!1,Ye=!0,$e=!1,Ke=!0,Ve=!1,Xe={},Ze=null,Je=O({},[\"annotation-xml\",\"audio\",\"colgroup\",\"desc\",\"foreignobject\",\"head\",\"iframe\",\"math\",\"mi\",\"mn\",\"mo\",\"ms\",\"mtext\",\"noembed\",\"noframes\",\"noscript\",\"plaintext\",\"script\",\"style\",\"svg\",\"template\",\"thead\",\"title\",\"video\",\"xmp\"]),Qe=null,et=O({},[\"audio\",\"video\",\"img\",\"source\",\"image\",\"track\"]),tt=null,nt=O({},[\"alt\",\"class\",\"for\",\"id\",\"label\",\"name\",\"pattern\",\"placeholder\",\"role\",\"summary\",\"title\",\"value\",\"style\",\"xmlns\"]),rt=\"http://www.w3.org/1998/Math/MathML\",ot=\"http://www.w3.org/2000/svg\",at=\"http://www.w3.org/1999/xhtml\",it=at,lt=!1,ct=null,ut=O({},[rt,ot,at],T),st=[\"application/xhtml+xml\",\"text/html\"],mt=null,ft=i.createElement(\"form\"),pt=function(e){return e instanceof RegExp||e instanceof Function},dt=function(t){mt&&mt===t||(t&&\"object\"===e(t)||(t={}),t=k(t),ge=ge=-1===st.indexOf(t.PARSER_MEDIA_TYPE)?\"text/html\":t.PARSER_MEDIA_TYPE,ye=\"application/xhtml+xml\"===ge?T:v,xe=\"ALLOWED_TAGS\"in t?O({},t.ALLOWED_TAGS,ye):Ce,Oe=\"ALLOWED_ATTR\"in t?O({},t.ALLOWED_ATTR,ye):ke,ct=\"ALLOWED_NAMESPACES\"in t?O({},t.ALLOWED_NAMESPACES,T):ut,tt=\"ADD_URI_SAFE_ATTR\"in t?O(k(nt),t.ADD_URI_SAFE_ATTR,ye):nt,Qe=\"ADD_DATA_URI_TAGS\"in t?O(k(et),t.ADD_DATA_URI_TAGS,ye):et,Ze=\"FORBID_CONTENTS\"in t?O({},t.FORBID_CONTENTS,ye):Je,De=\"FORBID_TAGS\"in t?O({},t.FORBID_TAGS,ye):{},Re=\"FORBID_ATTR\"in t?O({},t.FORBID_ATTR,ye):{},Xe=\"USE_PROFILES\"in t&&t.USE_PROFILES,Me=!1!==t.ALLOW_ARIA_ATTR,Ie=!1!==t.ALLOW_DATA_ATTR,Fe=t.ALLOW_UNKNOWN_PROTOCOLS||!1,Ue=!1!==t.ALLOW_SELF_CLOSE_IN_ATTR,He=t.SAFE_FOR_TEMPLATES||!1,ze=!1!==t.SAFE_FOR_XML,Pe=t.WHOLE_DOCUMENT||!1,Ge=t.RETURN_DOM||!1,We=t.RETURN_DOM_FRAGMENT||!1,qe=t.RETURN_TRUSTED_TYPE||!1,Be=t.FORCE_BODY||!1,Ye=!1!==t.SANITIZE_DOM,$e=t.SANITIZE_NAMED_PROPS||!1,Ke=!1!==t.KEEP_CONTENT,Ve=t.IN_PLACE||!1,we=t.ALLOWED_URI_REGEXP||we,it=t.NAMESPACE||at,Le=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&pt(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Le.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&pt(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Le.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&\"boolean\"==typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Le.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),He&&(Ie=!1),We&&(Ge=!0),Xe&&(xe=O({},r(H)),Oe=[],!0===Xe.html&&(O(xe,D),O(Oe,z)),!0===Xe.svg&&(O(xe,R),O(Oe,P),O(Oe,B)),!0===Xe.svgFilters&&(O(xe,M),O(Oe,P),O(Oe,B)),!0===Xe.mathMl&&(O(xe,F),O(Oe,j),O(Oe,B))),t.ADD_TAGS&&(xe===Ce&&(xe=k(xe)),O(xe,t.ADD_TAGS,ye)),t.ADD_ATTR&&(Oe===ke&&(Oe=k(Oe)),O(Oe,t.ADD_ATTR,ye)),t.ADD_URI_SAFE_ATTR&&O(tt,t.ADD_URI_SAFE_ATTR,ye),t.FORBID_CONTENTS&&(Ze===Je&&(Ze=k(Ze)),O(Ze,t.FORBID_CONTENTS,ye)),Ke&&(xe[\"#text\"]=!0),Pe&&O(xe,[\"html\",\"head\",\"body\"]),xe.table&&(O(xe,[\"tbody\"]),delete De.tbody),s&&s(t),mt=t)},ht=O({},[\"mi\",\"mo\",\"mn\",\"ms\",\"mtext\"]),gt=O({},[\"foreignobject\",\"annotation-xml\"]),yt=O({},[\"title\",\"style\",\"font\",\"a\",\"script\"]),bt=O({},R);O(bt,M),O(bt,I);var _t=O({},F);O(_t,U);var vt=function(e){_(o.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=le}catch(t){e.remove()}}},Tt=function(e,t){try{_(o.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){_(o.removed,{attribute:null,from:t})}if(t.removeAttribute(e),\"is\"===e&&!Oe[e])if(Ge||We)try{vt(t)}catch(e){}else try{t.setAttribute(e,\"\")}catch(e){}},Nt=function(e){var t,n;if(Be)e=\"<remove></remove>\"+e;else{var r=N(e,/^[\\r\\n\\t ]+/);n=r&&r[0]}\"application/xhtml+xml\"===ge&&it===at&&(e='<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>'+e+\"</body></html>\");var o=ie?ie.createHTML(e):e;if(it===at)try{t=(new g).parseFromString(o,ge)}catch(e){}if(!t||!t.documentElement){t=ue.createDocument(it,\"template\",null);try{t.documentElement.innerHTML=lt?le:o}catch(e){}}var a=t.body||t.documentElement;return e&&n&&a.insertBefore(i.createTextNode(n),a.childNodes[0]||null),it===at?fe.call(t,Pe?\"html\":\"body\")[0]:Pe?t.documentElement:a},Et=function(e){return se.call(e.ownerDocument||e,e,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null,!1)},At=function(e){return e instanceof h&&(void 0!==e.__depth&&\"number\"!=typeof e.__depth||void 0!==e.__removalCount&&\"number\"!=typeof e.__removalCount||\"string\"!=typeof e.nodeName||\"string\"!=typeof e.textContent||\"function\"!=typeof e.removeChild||!(e.attributes instanceof d)||\"function\"!=typeof e.removeAttribute||\"function\"!=typeof e.setAttribute||\"string\"!=typeof e.namespaceURI||\"function\"!=typeof e.insertBefore||\"function\"!=typeof e.hasChildNodes)},St=function(t){return\"object\"===e(u)?t instanceof u:t&&\"object\"===e(t)&&\"number\"==typeof t.nodeType&&\"string\"==typeof t.nodeName},wt=function(e,t,n){he[e]&&y(he[e],(function(e){e.call(o,t,n,mt)}))},xt=function(e){var t;if(wt(\"beforeSanitizeElements\",e,null),At(e))return vt(e),!0;if(w(/[\\u0080-\\uFFFF]/,e.nodeName))return vt(e),!0;var n=ye(e.nodeName);if(wt(\"uponSanitizeElement\",e,{tagName:n,allowedTags:xe}),e.hasChildNodes()&&!St(e.firstElementChild)&&(!St(e.content)||!St(e.content.firstElementChild))&&w(/<[/\\w]/g,e.innerHTML)&&w(/<[/\\w]/g,e.textContent))return vt(e),!0;if(\"select\"===n&&w(/<template/i,e.innerHTML))return vt(e),!0;if(7===e.nodeType)return vt(e),!0;if(ze&&8===e.nodeType&&w(/<[/\\w]/g,e.data))return vt(e),!0;if(!xe[n]||De[n]){if(!De[n]&&Ot(n)){if(Le.tagNameCheck instanceof RegExp&&w(Le.tagNameCheck,n))return!1;if(Le.tagNameCheck instanceof Function&&Le.tagNameCheck(n))return!1}if(Ke&&!Ze[n]){var r=oe(e)||e.parentNode,a=re(e)||e.childNodes;if(a&&r)for(var i=a.length-1;i>=0;--i){var l=te(a[i],!0);l.__removalCount=(e.__removalCount||0)+1,r.insertBefore(l,ne(e))}}return vt(e),!0}return e instanceof m&&!function(e){var t=oe(e);t&&t.tagName||(t={namespaceURI:it,tagName:\"template\"});var n=v(e.tagName),r=v(t.tagName);return!!ct[e.namespaceURI]&&(e.namespaceURI===ot?t.namespaceURI===at?\"svg\"===n:t.namespaceURI===rt?\"svg\"===n&&(\"annotation-xml\"===r||ht[r]):Boolean(bt[n]):e.namespaceURI===rt?t.namespaceURI===at?\"math\"===n:t.namespaceURI===ot?\"math\"===n&&gt[r]:Boolean(_t[n]):e.namespaceURI===at?!(t.namespaceURI===ot&&!gt[r])&&!(t.namespaceURI===rt&&!ht[r])&&!_t[n]&&(yt[n]||!bt[n]):!(\"application/xhtml+xml\"!==ge||!ct[e.namespaceURI]))}(e)?(vt(e),!0):\"noscript\"!==n&&\"noembed\"!==n&&\"noframes\"!==n||!w(/<\\/no(script|embed|frames)/i,e.innerHTML)?(He&&3===e.nodeType&&(t=e.textContent,t=E(t,be,\" \"),t=E(t,_e,\" \"),t=E(t,ve,\" \"),e.textContent!==t&&(_(o.removed,{element:e.cloneNode()}),e.textContent=t)),wt(\"afterSanitizeElements\",e,null),!1):(vt(e),!0)},Ct=function(e,t,n){if(Ye&&(\"id\"===t||\"name\"===t)&&(n in i||n in ft||\"__depth\"===n||\"__removalCount\"===n))return!1;if(Ie&&!Re[t]&&w(Te,t));else if(Me&&w(Ne,t));else if(!Oe[t]||Re[t]){if(!(Ot(e)&&(Le.tagNameCheck instanceof RegExp&&w(Le.tagNameCheck,e)||Le.tagNameCheck instanceof Function&&Le.tagNameCheck(e))&&(Le.attributeNameCheck instanceof RegExp&&w(Le.attributeNameCheck,t)||Le.attributeNameCheck instanceof Function&&Le.attributeNameCheck(t))||\"is\"===t&&Le.allowCustomizedBuiltInElements&&(Le.tagNameCheck instanceof RegExp&&w(Le.tagNameCheck,n)||Le.tagNameCheck instanceof Function&&Le.tagNameCheck(n))))return!1}else if(tt[t]);else if(w(we,E(n,Ae,\"\")));else if(\"src\"!==t&&\"xlink:href\"!==t&&\"href\"!==t||\"script\"===e||0!==A(n,\"data:\")||!Qe[e]){if(Fe&&!w(Ee,E(n,Ae,\"\")));else if(n)return!1}else;return!0},Ot=function(e){return\"annotation-xml\"!==e&&N(e,Se)},kt=function(t){var n,r,a,i;wt(\"beforeSanitizeAttributes\",t,null);var l=t.attributes;if(l){var c={attrName:\"\",attrValue:\"\",keepAttr:!0,allowedAttributes:Oe};for(i=l.length;i--;){var u=n=l[i],s=u.name,m=u.namespaceURI;if(r=\"value\"===s?n.value:S(n.value),a=ye(s),c.attrName=a,c.attrValue=r,c.keepAttr=!0,c.forceKeepAttr=void 0,wt(\"uponSanitizeAttribute\",t,c),r=c.attrValue,!c.forceKeepAttr&&(Tt(s,t),c.keepAttr))if(Ue||!w(/\\/>/i,r))if(ze&&w(/((--!?|])>)|<\\/(style|title)/i,r))Tt(s,t);else{He&&(r=E(r,be,\" \"),r=E(r,_e,\" \"),r=E(r,ve,\" \"));var f=ye(t.nodeName);if(Ct(f,a,r)){if(!$e||\"id\"!==a&&\"name\"!==a||(Tt(s,t),r=\"user-content-\"+r),ie&&\"object\"===e(C)&&\"function\"==typeof C.getAttributeType)if(m);else switch(C.getAttributeType(f,a)){case\"TrustedHTML\":r=ie.createHTML(r);break;case\"TrustedScriptURL\":r=ie.createScriptURL(r)}try{m?t.setAttributeNS(m,s,r):t.setAttribute(s,r),At(t)?vt(t):b(o.removed)}catch(e){}}}else Tt(s,t)}wt(\"afterSanitizeAttributes\",t,null)}},Lt=function e(t){var n,r=Et(t);for(wt(\"beforeSanitizeShadowDOM\",t,null);n=r.nextNode();)if(wt(\"uponSanitizeShadowNode\",n,null),!xt(n)){var o=oe(n);1===n.nodeType&&(o&&o.__depth?n.__depth=(n.__removalCount||0)+o.__depth+1:n.__depth=1),n.__depth>=255&&vt(n),n.content instanceof l&&(n.content.__depth=n.__depth,e(n.content)),kt(n)}wt(\"afterSanitizeShadowDOM\",t,null)};return o.sanitize=function(t){var r,i,c,s,m,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((lt=!t)&&(t=\"\\x3c!--\\x3e\"),\"string\"!=typeof t&&!St(t)){if(\"function\"!=typeof t.toString)throw x(\"toString is not a function\");if(\"string\"!=typeof(t=t.toString()))throw x(\"dirty is not a string, aborting\")}if(!o.isSupported){if(\"object\"===e(n.toStaticHTML)||\"function\"==typeof n.toStaticHTML){if(\"string\"==typeof t)return n.toStaticHTML(t);if(St(t))return n.toStaticHTML(t.outerHTML)}return t}if(je||dt(f),o.removed=[],\"string\"==typeof t&&(Ve=!1),Ve){if(t.nodeName){var p=ye(t.nodeName);if(!xe[p]||De[p])throw x(\"root node is forbidden and cannot be sanitized in-place\")}}else if(t instanceof u)1===(i=(r=Nt(\"\\x3c!----\\x3e\")).ownerDocument.importNode(t,!0)).nodeType&&\"BODY\"===i.nodeName||\"HTML\"===i.nodeName?r=i:r.appendChild(i);else{if(!Ge&&!He&&!Pe&&-1===t.indexOf(\"<\"))return ie&&qe?ie.createHTML(t):t;if(!(r=Nt(t)))return Ge?null:qe?le:\"\"}r&&Be&&vt(r.firstChild);for(var d=Et(Ve?t:r);c=d.nextNode();)if((3!==c.nodeType||c!==s)&&!xt(c)){var h=oe(c);1===c.nodeType&&(h&&h.__depth?c.__depth=(c.__removalCount||0)+h.__depth+1:c.__depth=1),c.__depth>=255&&vt(c),c.content instanceof l&&(c.content.__depth=c.__depth,Lt(c.content)),kt(c),s=c}if(s=null,Ve)return t;if(Ge){if(We)for(m=me.call(r.ownerDocument);r.firstChild;)m.appendChild(r.firstChild);else m=r;return(Oe.shadowroot||Oe.shadowrootmod)&&(m=pe.call(a,m,!0)),m}var g=Pe?r.outerHTML:r.innerHTML;return Pe&&xe[\"!doctype\"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&w(Z,r.ownerDocument.doctype.name)&&(g=\"<!DOCTYPE \"+r.ownerDocument.doctype.name+\">\\n\"+g),He&&(g=E(g,be,\" \"),g=E(g,_e,\" \"),g=E(g,ve,\" \")),ie&&qe?ie.createHTML(g):g},o.setConfig=function(e){dt(e),je=!0},o.clearConfig=function(){mt=null,je=!1},o.isValidAttribute=function(e,t,n){mt||dt({});var r=ye(e),o=ye(t);return Ct(r,o,n)},o.addHook=function(e,t){\"function\"==typeof t&&(he[e]=he[e]||[],_(he[e],t))},o.removeHook=function(e){if(he[e])return b(he[e])},o.removeHooks=function(e){he[e]&&(he[e]=[])},o.removeAllHooks=function(){he={}},o}();return ee}));\n+!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):(e=\"undefined\"!=typeof globalThis?globalThis:e||self).DOMPurify=t()}(this,(function(){\"use strict\";function e(t){return e=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},e(t)}function t(e,n){return t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(e,n)}function n(e,r,o){return n=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct:function(e,n,r){var o=[null];o.push.apply(o,n);var a=new(Function.bind.apply(e,o));return r&&t(a,r.prototype),a},n.apply(null,arguments)}function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if(\"undefined\"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e[\"@@iterator\"])return Array.from(e)}(e)||function(e,t){if(!e)return;if(\"string\"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var a=Object.hasOwnProperty,i=Object.setPrototypeOf,l=Object.isFrozen,c=Object.getPrototypeOf,u=Object.getOwnPropertyDescriptor,s=Object.freeze,m=Object.seal,f=Object.create,p=\"undefined\"!=typeof Reflect&&Reflect,d=p.apply,h=p.construct;d||(d=function(e,t,n){return e.apply(t,n)}),s||(s=function(e){return e}),m||(m=function(e){return e}),h||(h=function(e,t){return n(e,r(t))});var g,y=O(Array.prototype.forEach),b=O(Array.prototype.pop),_=O(Array.prototype.push),v=O(String.prototype.toLowerCase),T=O(String.prototype.toString),N=O(String.prototype.match),E=O(String.prototype.replace),A=O(String.prototype.indexOf),S=O(String.prototype.trim),w=O(RegExp.prototype.test),x=(g=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h(g,t)}),C=O(Number.isNaN);function O(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return d(e,t,r)}}function k(e,t,n){var r;n=null!==(r=n)&&void 0!==r?r:v,i&&i(e,null);for(var o=t.length;o--;){var a=t[o];if(\"string\"==typeof a){var c=n(a);c!==a&&(l(t)||(t[o]=c),a=c)}e[a]=!0}return e}function L(e){var t,n=f(null);for(t in e)!0===d(a,e,[t])&&(n[t]=e[t]);return n}function D(e,t){for(;null!==e;){var n=u(e,t);if(n){if(n.get)return O(n.get);if(\"function\"==typeof n.value)return O(n.value)}e=c(e)}return function(e){return console.warn(\"fallback value for\",e),null}}var R=s([\"a\",\"abbr\",\"acronym\",\"address\",\"area\",\"article\",\"aside\",\"audio\",\"b\",\"bdi\",\"bdo\",\"big\",\"blink\",\"blockquote\",\"body\",\"br\",\"button\",\"canvas\",\"caption\",\"center\",\"cite\",\"code\",\"col\",\"colgroup\",\"content\",\"data\",\"datalist\",\"dd\",\"decorator\",\"del\",\"details\",\"dfn\",\"dialog\",\"dir\",\"div\",\"dl\",\"dt\",\"element\",\"em\",\"fieldset\",\"figcaption\",\"figure\",\"font\",\"footer\",\"form\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"head\",\"header\",\"hgroup\",\"hr\",\"html\",\"i\",\"img\",\"input\",\"ins\",\"kbd\",\"label\",\"legend\",\"li\",\"main\",\"map\",\"mark\",\"marquee\",\"menu\",\"menuitem\",\"meter\",\"nav\",\"nobr\",\"ol\",\"optgroup\",\"option\",\"output\",\"p\",\"picture\",\"pre\",\"progress\",\"q\",\"rp\",\"rt\",\"ruby\",\"s\",\"samp\",\"section\",\"select\",\"shadow\",\"small\",\"source\",\"spacer\",\"span\",\"strike\",\"strong\",\"style\",\"sub\",\"summary\",\"sup\",\"table\",\"tbody\",\"td\",\"template\",\"textarea\",\"tfoot\",\"th\",\"thead\",\"time\",\"tr\",\"track\",\"tt\",\"u\",\"ul\",\"var\",\"video\",\"wbr\"]),M=s([\"svg\",\"a\",\"altglyph\",\"altglyphdef\",\"altglyphitem\",\"animatecolor\",\"animatemotion\",\"animatetransform\",\"circle\",\"clippath\",\"defs\",\"desc\",\"ellipse\",\"filter\",\"font\",\"g\",\"glyph\",\"glyphref\",\"hkern\",\"image\",\"line\",\"lineargradient\",\"marker\",\"mask\",\"metadata\",\"mpath\",\"path\",\"pattern\",\"polygon\",\"polyline\",\"radialgradient\",\"rect\",\"stop\",\"style\",\"switch\",\"symbol\",\"text\",\"textpath\",\"title\",\"tref\",\"tspan\",\"view\",\"vkern\"]),I=s([\"feBlend\",\"feColorMatrix\",\"feComponentTransfer\",\"feComposite\",\"feConvolveMatrix\",\"feDiffuseLighting\",\"feDisplacementMap\",\"feDistantLight\",\"feFlood\",\"feFuncA\",\"feFuncB\",\"feFuncG\",\"feFuncR\",\"feGaussianBlur\",\"feImage\",\"feMerge\",\"feMergeNode\",\"feMorphology\",\"feOffset\",\"fePointLight\",\"feSpecularLighting\",\"feSpotLight\",\"feTile\",\"feTurbulence\"]),F=s([\"animate\",\"color-profile\",\"cursor\",\"discard\",\"fedropshadow\",\"font-face\",\"font-face-format\",\"font-face-name\",\"font-face-src\",\"font-face-uri\",\"foreignobject\",\"hatch\",\"hatchpath\",\"mesh\",\"meshgradient\",\"meshpatch\",\"meshrow\",\"missing-glyph\",\"script\",\"set\",\"solidcolor\",\"unknown\",\"use\"]),U=s([\"math\",\"menclose\",\"merror\",\"mfenced\",\"mfrac\",\"mglyph\",\"mi\",\"mlabeledtr\",\"mmultiscripts\",\"mn\",\"mo\",\"mover\",\"mpadded\",\"mphantom\",\"mroot\",\"mrow\",\"ms\",\"mspace\",\"msqrt\",\"mstyle\",\"msub\",\"msup\",\"msubsup\",\"mtable\",\"mtd\",\"mtext\",\"mtr\",\"munder\",\"munderover\"]),H=s([\"maction\",\"maligngroup\",\"malignmark\",\"mlongdiv\",\"mscarries\",\"mscarry\",\"msgroup\",\"mstack\",\"msline\",\"msrow\",\"semantics\",\"annotation\",\"annotation-xml\",\"mprescripts\",\"none\"]),z=s([\"#text\"]),P=s([\"accept\",\"action\",\"align\",\"alt\",\"autocapitalize\",\"autocomplete\",\"autopictureinpicture\",\"autoplay\",\"background\",\"bgcolor\",\"border\",\"capture\",\"cellpadding\",\"cellspacing\",\"checked\",\"cite\",\"class\",\"clear\",\"color\",\"cols\",\"colspan\",\"controls\",\"controlslist\",\"coords\",\"crossorigin\",\"datetime\",\"decoding\",\"default\",\"dir\",\"disabled\",\"disablepictureinpicture\",\"disableremoteplayback\",\"download\",\"draggable\",\"enctype\",\"enterkeyhint\",\"face\",\"for\",\"headers\",\"height\",\"hidden\",\"high\",\"href\",\"hreflang\",\"id\",\"inputmode\",\"integrity\",\"ismap\",\"kind\",\"label\",\"lang\",\"list\",\"loading\",\"loop\",\"low\",\"max\",\"maxlength\",\"media\",\"method\",\"min\",\"minlength\",\"multiple\",\"muted\",\"name\",\"nonce\",\"noshade\",\"novalidate\",\"nowrap\",\"open\",\"optimum\",\"pattern\",\"placeholder\",\"playsinline\",\"poster\",\"preload\",\"pubdate\",\"radiogroup\",\"readonly\",\"rel\",\"required\",\"rev\",\"reversed\",\"role\",\"rows\",\"rowspan\",\"spellcheck\",\"scope\",\"selected\",\"shape\",\"size\",\"sizes\",\"span\",\"srclang\",\"start\",\"src\",\"srcset\",\"step\",\"style\",\"summary\",\"tabindex\",\"title\",\"translate\",\"type\",\"usemap\",\"valign\",\"value\",\"width\",\"xmlns\",\"slot\"]),j=s([\"accent-height\",\"accumulate\",\"additive\",\"alignment-baseline\",\"ascent\",\"attributename\",\"attributetype\",\"azimuth\",\"basefrequency\",\"baseline-shift\",\"begin\",\"bias\",\"by\",\"class\",\"clip\",\"clippathunits\",\"clip-path\",\"clip-rule\",\"color\",\"color-interpolation\",\"color-interpolation-filters\",\"color-profile\",\"color-rendering\",\"cx\",\"cy\",\"d\",\"dx\",\"dy\",\"diffuseconstant\",\"direction\",\"display\",\"divisor\",\"dur\",\"edgemode\",\"elevation\",\"end\",\"fill\",\"fill-opacity\",\"fill-rule\",\"filter\",\"filterunits\",\"flood-color\",\"flood-opacity\",\"font-family\",\"font-size\",\"font-size-adjust\",\"font-stretch\",\"font-style\",\"font-variant\",\"font-weight\",\"fx\",\"fy\",\"g1\",\"g2\",\"glyph-name\",\"glyphref\",\"gradientunits\",\"gradienttransform\",\"height\",\"href\",\"id\",\"image-rendering\",\"in\",\"in2\",\"k\",\"k1\",\"k2\",\"k3\",\"k4\",\"kerning\",\"keypoints\",\"keysplines\",\"keytimes\",\"lang\",\"lengthadjust\",\"letter-spacing\",\"kernelmatrix\",\"kernelunitlength\",\"lighting-color\",\"local\",\"marker-end\",\"marker-mid\",\"marker-start\",\"markerheight\",\"markerunits\",\"markerwidth\",\"maskcontentunits\",\"maskunits\",\"max\",\"mask\",\"media\",\"method\",\"mode\",\"min\",\"name\",\"numoctaves\",\"offset\",\"operator\",\"opacity\",\"order\",\"orient\",\"orientation\",\"origin\",\"overflow\",\"paint-order\",\"path\",\"pathlength\",\"patterncontentunits\",\"patterntransform\",\"patternunits\",\"points\",\"preservealpha\",\"preserveaspectratio\",\"primitiveunits\",\"r\",\"rx\",\"ry\",\"radius\",\"refx\",\"refy\",\"repeatcount\",\"repeatdur\",\"restart\",\"result\",\"rotate\",\"scale\",\"seed\",\"shape-rendering\",\"specularconstant\",\"specularexponent\",\"spreadmethod\",\"startoffset\",\"stddeviation\",\"stitchtiles\",\"stop-color\",\"stop-opacity\",\"stroke-dasharray\",\"stroke-dashoffset\",\"stroke-linecap\",\"stroke-linejoin\",\"stroke-miterlimit\",\"stroke-opacity\",\"stroke\",\"stroke-width\",\"style\",\"surfacescale\",\"systemlanguage\",\"tabindex\",\"targetx\",\"targety\",\"transform\",\"transform-origin\",\"text-anchor\",\"text-decoration\",\"text-rendering\",\"textlength\",\"type\",\"u1\",\"u2\",\"unicode\",\"values\",\"viewbox\",\"visibility\",\"version\",\"vert-adv-y\",\"vert-origin-x\",\"vert-origin-y\",\"width\",\"word-spacing\",\"wrap\",\"writing-mode\",\"xchannelselector\",\"ychannelselector\",\"x\",\"x1\",\"x2\",\"xmlns\",\"y\",\"y1\",\"y2\",\"z\",\"zoomandpan\"]),B=s([\"accent\",\"accentunder\",\"align\",\"bevelled\",\"close\",\"columnsalign\",\"columnlines\",\"columnspan\",\"denomalign\",\"depth\",\"dir\",\"display\",\"displaystyle\",\"encoding\",\"fence\",\"frame\",\"height\",\"href\",\"id\",\"largeop\",\"length\",\"linethickness\",\"lspace\",\"lquote\",\"mathbackground\",\"mathcolor\",\"mathsize\",\"mathvariant\",\"maxsize\",\"minsize\",\"movablelimits\",\"notation\",\"numalign\",\"open\",\"rowalign\",\"rowlines\",\"rowspacing\",\"rowspan\",\"rspace\",\"rquote\",\"scriptlevel\",\"scriptminsize\",\"scriptsizemultiplier\",\"selection\",\"separator\",\"separators\",\"stretchy\",\"subscriptshift\",\"supscriptshift\",\"symmetric\",\"voffset\",\"width\",\"xmlns\"]),G=s([\"xlink:href\",\"xml:id\",\"xlink:title\",\"xml:space\",\"xmlns:xlink\"]),W=m(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm),q=m(/<%[\\w\\W]*|[\\w\\W]*%>/gm),Y=m(/\\${[\\w\\W]*}/gm),$=m(/^data-[\\-\\w.\\u00B7-\\uFFFF]/),K=m(/^aria-[\\-\\w]+$/),V=m(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i),X=m(/^(?:\\w+script|data):/i),Z=m(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g),J=m(/^html$/i),Q=m(/^[a-z][.\\w]*(-[.\\w]+)+$/i),ee=function(){return\"undefined\"==typeof window?null:window};var te=function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee(),o=function(e){return t(e)};if(o.version=\"2.5.3\",o.removed=[],!n||!n.document||9!==n.document.nodeType)return o.isSupported=!1,o;var a=n.document,i=n.document,l=n.DocumentFragment,c=n.HTMLTemplateElement,u=n.Node,m=n.Element,f=n.NodeFilter,p=n.NamedNodeMap,d=void 0===p?n.NamedNodeMap||n.MozNamedAttrMap:p,h=n.HTMLFormElement,g=n.DOMParser,O=n.trustedTypes,te=m.prototype,ne=D(te,\"cloneNode\"),re=D(te,\"nextSibling\"),oe=D(te,\"childNodes\"),ae=D(te,\"parentNode\");if(\"function\"==typeof c){var ie=i.createElement(\"template\");ie.content&&ie.content.ownerDocument&&(i=ie.content.ownerDocument)}var le=function(t,n){if(\"object\"!==e(t)||\"function\"!=typeof t.createPolicy)return null;var r=null,o=\"data-tt-policy-suffix\";n.currentScript&&n.currentScript.hasAttribute(o)&&(r=n.currentScript.getAttribute(o));var a=\"dompurify\"+(r?\"#\"+r:\"\");try{return t.createPolicy(a,{createHTML:function(e){return e},createScriptURL:function(e){return e}})}catch(e){return console.warn(\"TrustedTypes policy \"+a+\" could not be created.\"),null}}(O,a),ce=le?le.createHTML(\"\"):\"\",ue=i,se=ue.implementation,me=ue.createNodeIterator,fe=ue.createDocumentFragment,pe=ue.getElementsByTagName,de=a.importNode,he={};try{he=L(i).documentMode?i.documentMode:{}}catch(e){}var ge={};o.isSupported=\"function\"==typeof ae&&se&&void 0!==se.createHTMLDocument&&9!==he;var ye,be,_e=W,ve=q,Te=Y,Ne=$,Ee=K,Ae=X,Se=Z,we=Q,xe=V,Ce=null,Oe=k({},[].concat(r(R),r(M),r(I),r(U),r(z))),ke=null,Le=k({},[].concat(r(P),r(j),r(B),r(G))),De=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Re=null,Me=null,Ie=!0,Fe=!0,Ue=!1,He=!0,ze=!1,Pe=!0,je=!1,Be=!1,Ge=!1,We=!1,qe=!1,Ye=!1,$e=!0,Ke=!1,Ve=!0,Xe=!1,Ze={},Je=null,Qe=k({},[\"annotation-xml\",\"audio\",\"colgroup\",\"desc\",\"foreignobject\",\"head\",\"iframe\",\"math\",\"mi\",\"mn\",\"mo\",\"ms\",\"mtext\",\"noembed\",\"noframes\",\"noscript\",\"plaintext\",\"script\",\"style\",\"svg\",\"template\",\"thead\",\"title\",\"video\",\"xmp\"]),et=null,tt=k({},[\"audio\",\"video\",\"img\",\"source\",\"image\",\"track\"]),nt=null,rt=k({},[\"alt\",\"class\",\"for\",\"id\",\"label\",\"name\",\"pattern\",\"placeholder\",\"role\",\"summary\",\"title\",\"value\",\"style\",\"xmlns\"]),ot=\"http://www.w3.org/1998/Math/MathML\",at=\"http://www.w3.org/2000/svg\",it=\"http://www.w3.org/1999/xhtml\",lt=it,ct=!1,ut=null,st=k({},[ot,at,it],T),mt=[\"application/xhtml+xml\",\"text/html\"],ft=null,pt=i.createElement(\"form\"),dt=function(e){return e instanceof RegExp||e instanceof Function},ht=function(t){ft&&ft===t||(t&&\"object\"===e(t)||(t={}),t=L(t),ye=ye=-1===mt.indexOf(t.PARSER_MEDIA_TYPE)?\"text/html\":t.PARSER_MEDIA_TYPE,be=\"application/xhtml+xml\"===ye?T:v,Ce=\"ALLOWED_TAGS\"in t?k({},t.ALLOWED_TAGS,be):Oe,ke=\"ALLOWED_ATTR\"in t?k({},t.ALLOWED_ATTR,be):Le,ut=\"ALLOWED_NAMESPACES\"in t?k({},t.ALLOWED_NAMESPACES,T):st,nt=\"ADD_URI_SAFE_ATTR\"in t?k(L(rt),t.ADD_URI_SAFE_ATTR,be):rt,et=\"ADD_DATA_URI_TAGS\"in t?k(L(tt),t.ADD_DATA_URI_TAGS,be):tt,Je=\"FORBID_CONTENTS\"in t?k({},t.FORBID_CONTENTS,be):Qe,Re=\"FORBID_TAGS\"in t?k({},t.FORBID_TAGS,be):{},Me=\"FORBID_ATTR\"in t?k({},t.FORBID_ATTR,be):{},Ze=\"USE_PROFILES\"in t&&t.USE_PROFILES,Ie=!1!==t.ALLOW_ARIA_ATTR,Fe=!1!==t.ALLOW_DATA_ATTR,Ue=t.ALLOW_UNKNOWN_PROTOCOLS||!1,He=!1!==t.ALLOW_SELF_CLOSE_IN_ATTR,ze=t.SAFE_FOR_TEMPLATES||!1,Pe=!1!==t.SAFE_FOR_XML,je=t.WHOLE_DOCUMENT||!1,We=t.RETURN_DOM||!1,qe=t.RETURN_DOM_FRAGMENT||!1,Ye=t.RETURN_TRUSTED_TYPE||!1,Ge=t.FORCE_BODY||!1,$e=!1!==t.SANITIZE_DOM,Ke=t.SANITIZE_NAMED_PROPS||!1,Ve=!1!==t.KEEP_CONTENT,Xe=t.IN_PLACE||!1,xe=t.ALLOWED_URI_REGEXP||xe,lt=t.NAMESPACE||it,De=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&dt(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(De.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&dt(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(De.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&\"boolean\"==typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(De.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ze&&(Fe=!1),qe&&(We=!0),Ze&&(Ce=k({},r(z)),ke=[],!0===Ze.html&&(k(Ce,R),k(ke,P)),!0===Ze.svg&&(k(Ce,M),k(ke,j),k(ke,G)),!0===Ze.svgFilters&&(k(Ce,I),k(ke,j),k(ke,G)),!0===Ze.mathMl&&(k(Ce,U),k(ke,B),k(ke,G))),t.ADD_TAGS&&(Ce===Oe&&(Ce=L(Ce)),k(Ce,t.ADD_TAGS,be)),t.ADD_ATTR&&(ke===Le&&(ke=L(ke)),k(ke,t.ADD_ATTR,be)),t.ADD_URI_SAFE_ATTR&&k(nt,t.ADD_URI_SAFE_ATTR,be),t.FORBID_CONTENTS&&(Je===Qe&&(Je=L(Je)),k(Je,t.FORBID_CONTENTS,be)),Ve&&(Ce[\"#text\"]=!0),je&&k(Ce,[\"html\",\"head\",\"body\"]),Ce.table&&(k(Ce,[\"tbody\"]),delete Re.tbody),s&&s(t),ft=t)},gt=k({},[\"mi\",\"mo\",\"mn\",\"ms\",\"mtext\"]),yt=k({},[\"foreignobject\",\"annotation-xml\"]),bt=k({},[\"title\",\"style\",\"font\",\"a\",\"script\"]),_t=k({},M);k(_t,I),k(_t,F);var vt=k({},U);k(vt,H);var Tt=function(e){_(o.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){try{e.outerHTML=ce}catch(t){e.remove()}}},Nt=function(e,t){try{_(o.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){_(o.removed,{attribute:null,from:t})}if(t.removeAttribute(e),\"is\"===e&&!ke[e])if(We||qe)try{Tt(t)}catch(e){}else try{t.setAttribute(e,\"\")}catch(e){}},Et=function(e){var t,n;if(Ge)e=\"<remove></remove>\"+e;else{var r=N(e,/^[\\r\\n\\t ]+/);n=r&&r[0]}\"application/xhtml+xml\"===ye&&lt===it&&(e='<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>'+e+\"</body></html>\");var o=le?le.createHTML(e):e;if(lt===it)try{t=(new g).parseFromString(o,ye)}catch(e){}if(!t||!t.documentElement){t=se.createDocument(lt,\"template\",null);try{t.documentElement.innerHTML=ct?ce:o}catch(e){}}var a=t.body||t.documentElement;return e&&n&&a.insertBefore(i.createTextNode(n),a.childNodes[0]||null),lt===it?pe.call(t,je?\"html\":\"body\")[0]:je?t.documentElement:a},At=function(e){return me.call(e.ownerDocument||e,e,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null,!1)},St=function(e){return e instanceof h&&(void 0!==e.__depth&&\"number\"!=typeof e.__depth||void 0!==e.__removalCount&&\"number\"!=typeof e.__removalCount||\"string\"!=typeof e.nodeName||\"string\"!=typeof e.textContent||\"function\"!=typeof e.removeChild||!(e.attributes instanceof d)||\"function\"!=typeof e.removeAttribute||\"function\"!=typeof e.setAttribute||\"string\"!=typeof e.namespaceURI||\"function\"!=typeof e.insertBefore||\"function\"!=typeof e.hasChildNodes)},wt=function(t){return\"object\"===e(u)?t instanceof u:t&&\"object\"===e(t)&&\"number\"==typeof t.nodeType&&\"string\"==typeof t.nodeName},xt=function(e,t,n){ge[e]&&y(ge[e],(function(e){e.call(o,t,n,ft)}))},Ct=function(e){var t;if(xt(\"beforeSanitizeElements\",e,null),St(e))return Tt(e),!0;if(w(/[\\u0080-\\uFFFF]/,e.nodeName))return Tt(e),!0;var n=be(e.nodeName);if(xt(\"uponSanitizeElement\",e,{tagName:n,allowedTags:Ce}),e.hasChildNodes()&&!wt(e.firstElementChild)&&(!wt(e.content)||!wt(e.content.firstElementChild))&&w(/<[/\\w]/g,e.innerHTML)&&w(/<[/\\w]/g,e.textContent))return Tt(e),!0;if(\"select\"===n&&w(/<template/i,e.innerHTML))return Tt(e),!0;if(7===e.nodeType)return Tt(e),!0;if(Pe&&8===e.nodeType&&w(/<[/\\w]/g,e.data))return Tt(e),!0;if(!Ce[n]||Re[n]){if(!Re[n]&&kt(n)){if(De.tagNameCheck instanceof RegExp&&w(De.tagNameCheck,n))return!1;if(De.tagNameCheck instanceof Function&&De.tagNameCheck(n))return!1}if(Ve&&!Je[n]){var r=ae(e)||e.parentNode,a=oe(e)||e.childNodes;if(a&&r)for(var i=a.length-1;i>=0;--i){var l=ne(a[i],!0);l.__removalCount=(e.__removalCount||0)+1,r.insertBefore(l,re(e))}}return Tt(e),!0}return e instanceof m&&!function(e){var t=ae(e);t&&t.tagName||(t={namespaceURI:lt,tagName:\"template\"});var n=v(e.tagName),r=v(t.tagName);return!!ut[e.namespaceURI]&&(e.namespaceURI===at?t.namespaceURI===it?\"svg\"===n:t.namespaceURI===ot?\"svg\"===n&&(\"annotation-xml\"===r||gt[r]):Boolean(_t[n]):e.namespaceURI===ot?t.namespaceURI===it?\"math\"===n:t.namespaceURI===at?\"math\"===n&&yt[r]:Boolean(vt[n]):e.namespaceURI===it?!(t.namespaceURI===at&&!yt[r])&&!(t.namespaceURI===ot&&!gt[r])&&!vt[n]&&(bt[n]||!_t[n]):!(\"application/xhtml+xml\"!==ye||!ut[e.namespaceURI]))}(e)?(Tt(e),!0):\"noscript\"!==n&&\"noembed\"!==n&&\"noframes\"!==n||!w(/<\\/no(script|embed|frames)/i,e.innerHTML)?(ze&&3===e.nodeType&&(t=e.textContent,t=E(t,_e,\" \"),t=E(t,ve,\" \"),t=E(t,Te,\" \"),e.textContent!==t&&(_(o.removed,{element:e.cloneNode()}),e.textContent=t)),xt(\"afterSanitizeElements\",e,null),!1):(Tt(e),!0)},Ot=function(e,t,n){if($e&&(\"id\"===t||\"name\"===t)&&(n in i||n in pt||\"__depth\"===n||\"__removalCount\"===n))return!1;if(Fe&&!Me[t]&&w(Ne,t));else if(Ie&&w(Ee,t));else if(!ke[t]||Me[t]){if(!(kt(e)&&(De.tagNameCheck instanceof RegExp&&w(De.tagNameCheck,e)||De.tagNameCheck instanceof Function&&De.tagNameCheck(e))&&(De.attributeNameCheck instanceof RegExp&&w(De.attributeNameCheck,t)||De.attributeNameCheck instanceof Function&&De.attributeNameCheck(t))||\"is\"===t&&De.allowCustomizedBuiltInElements&&(De.tagNameCheck instanceof RegExp&&w(De.tagNameCheck,n)||De.tagNameCheck instanceof Function&&De.tagNameCheck(n))))return!1}else if(nt[t]);else if(w(xe,E(n,Se,\"\")));else if(\"src\"!==t&&\"xlink:href\"!==t&&\"href\"!==t||\"script\"===e||0!==A(n,\"data:\")||!et[e]){if(Ue&&!w(Ae,E(n,Se,\"\")));else if(n)return!1}else;return!0},kt=function(e){return\"annotation-xml\"!==e&&N(e,we)},Lt=function(t){var n,r,a,i;xt(\"beforeSanitizeAttributes\",t,null);var l=t.attributes;if(l){var c={attrName:\"\",attrValue:\"\",keepAttr:!0,allowedAttributes:ke};for(i=l.length;i--;){var u=n=l[i],s=u.name,m=u.namespaceURI;if(r=\"value\"===s?n.value:S(n.value),a=be(s),c.attrName=a,c.attrValue=r,c.keepAttr=!0,c.forceKeepAttr=void 0,xt(\"uponSanitizeAttribute\",t,c),r=c.attrValue,!c.forceKeepAttr&&(Nt(s,t),c.keepAttr))if(He||!w(/\\/>/i,r))if(Pe&&w(/((--!?|])>)|<\\/(style|title)/i,r))Nt(s,t);else{ze&&(r=E(r,_e,\" \"),r=E(r,ve,\" \"),r=E(r,Te,\" \"));var f=be(t.nodeName);if(Ot(f,a,r)){if(!Ke||\"id\"!==a&&\"name\"!==a||(Nt(s,t),r=\"user-content-\"+r),le&&\"object\"===e(O)&&\"function\"==typeof O.getAttributeType)if(m);else switch(O.getAttributeType(f,a)){case\"TrustedHTML\":r=le.createHTML(r);break;case\"TrustedScriptURL\":r=le.createScriptURL(r)}try{m?t.setAttributeNS(m,s,r):t.setAttribute(s,r),St(t)?Tt(t):b(o.removed)}catch(e){}}}else Nt(s,t)}xt(\"afterSanitizeAttributes\",t,null)}},Dt=function e(t){var n,r=At(t);for(xt(\"beforeSanitizeShadowDOM\",t,null);n=r.nextNode();)if(xt(\"uponSanitizeShadowNode\",n,null),!Ct(n)){var o=ae(n);1===n.nodeType&&(o&&o.__depth?n.__depth=(n.__removalCount||0)+o.__depth+1:n.__depth=1),(n.__depth>=255||C(n.__depth))&&Tt(n),n.content instanceof l&&(n.content.__depth=n.__depth,e(n.content)),Lt(n)}xt(\"afterSanitizeShadowDOM\",t,null)};return o.sanitize=function(t){var r,i,c,s,m,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((ct=!t)&&(t=\"\\x3c!--\\x3e\"),\"string\"!=typeof t&&!wt(t)){if(\"function\"!=typeof t.toString)throw x(\"toString is not a function\");if(\"string\"!=typeof(t=t.toString()))throw x(\"dirty is not a string, aborting\")}if(!o.isSupported){if(\"object\"===e(n.toStaticHTML)||\"function\"==typeof n.toStaticHTML){if(\"string\"==typeof t)return n.toStaticHTML(t);if(wt(t))return n.toStaticHTML(t.outerHTML)}return t}if(Be||ht(f),o.removed=[],\"string\"==typeof t&&(Xe=!1),Xe){if(t.nodeName){var p=be(t.nodeName);if(!Ce[p]||Re[p])throw x(\"root node is forbidden and cannot be sanitized in-place\")}}else if(t instanceof u)1===(i=(r=Et(\"\\x3c!----\\x3e\")).ownerDocument.importNode(t,!0)).nodeType&&\"BODY\"===i.nodeName||\"HTML\"===i.nodeName?r=i:r.appendChild(i);else{if(!We&&!ze&&!je&&-1===t.indexOf(\"<\"))return le&&Ye?le.createHTML(t):t;if(!(r=Et(t)))return We?null:Ye?ce:\"\"}r&&Ge&&Tt(r.firstChild);for(var d=At(Xe?t:r);c=d.nextNode();)if((3!==c.nodeType||c!==s)&&!Ct(c)){var h=ae(c);1===c.nodeType&&(h&&h.__depth?c.__depth=(c.__removalCount||0)+h.__depth+1:c.__depth=1),(c.__depth>=255||C(c.__depth))&&Tt(c),c.content instanceof l&&(c.content.__depth=c.__depth,Dt(c.content)),Lt(c),s=c}if(s=null,Xe)return t;if(We){if(qe)for(m=fe.call(r.ownerDocument);r.firstChild;)m.appendChild(r.firstChild);else m=r;return(ke.shadowroot||ke.shadowrootmod)&&(m=de.call(a,m,!0)),m}var g=je?r.outerHTML:r.innerHTML;return je&&Ce[\"!doctype\"]&&r.ownerDocument&&r.ownerDocument.doctype&&r.ownerDocument.doctype.name&&w(J,r.ownerDocument.doctype.name)&&(g=\"<!DOCTYPE \"+r.ownerDocument.doctype.name+\">\\n\"+g),ze&&(g=E(g,_e,\" \"),g=E(g,ve,\" \"),g=E(g,Te,\" \")),le&&Ye?le.createHTML(g):g},o.setConfig=function(e){ht(e),Be=!0},o.clearConfig=function(){ft=null,Be=!1},o.isValidAttribute=function(e,t,n){ft||ht({});var r=be(e),o=be(t);return Ot(r,o,n)},o.addHook=function(e,t){\"function\"==typeof t&&(ge[e]=ge[e]||[],_(ge[e],t))},o.removeHook=function(e){if(ge[e])return b(ge[e])},o.removeHooks=function(e){ge[e]&&(ge[e]=[])},o.removeAllHooks=function(){ge={}},o}();return te}));\n //# sourceMappingURL=purify.min.js.map"
            },
            {
                "sha": "79db364206750fe1a72f68dab062375dfc643900",
                "filename": "dist/purify.min.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.min.js.map",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/dist%2Fpurify.min.js.map",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.min.js.map?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc"
            },
            {
                "sha": "5db74df3a5a2a78cf2c16b8f76d53d10dee4838f",
                "filename": "src/purify.js",
                "status": "modified",
                "additions": 17,
                "deletions": 4,
                "changes": 21,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/src%2Fpurify.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/src%2Fpurify.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/src%2Fpurify.js?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc",
                "patch": "@@ -14,6 +14,7 @@ import {\n   stringToString,\n   stringIndexOf,\n   stringTrim,\n+  numberIsNaN,\n   regExpTest,\n   typeErrorCreate,\n   lookupGetter,\n@@ -1403,8 +1404,14 @@ function createDOMPurify(window = getGlobal()) {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (shadowNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (\n+        shadowNode.__depth >= MAX_NESTING_DEPTH ||\n+        numberIsNaN(shadowNode.__depth)\n+      ) {\n         _forceRemove(shadowNode);\n       }\n \n@@ -1570,8 +1577,14 @@ function createDOMPurify(window = getGlobal()) {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (currentNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (\n+        currentNode.__depth >= MAX_NESTING_DEPTH ||\n+        numberIsNaN(currentNode.__depth)\n+      ) {\n         _forceRemove(currentNode);\n       }\n "
            },
            {
                "sha": "cc738f63cd49d3c54d56d4f0e10f8d6a4cd5c5b9",
                "filename": "src/utils.js",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/src%2Futils.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/26e1d69ca7f769f5c558619d644d90dd8bf26ebc/src%2Futils.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/src%2Futils.js?ref=26e1d69ca7f769f5c558619d644d90dd8bf26ebc",
                "patch": "@@ -50,6 +50,8 @@ const regExpTest = unapply(RegExp.prototype.test);\n \n const typeErrorCreate = unconstruct(TypeError);\n \n+const numberIsNaN = unapply(Number.isNaN);\n+\n export function unapply(func) {\n   return (thisArg, ...args) => apply(func, thisArg, args);\n }\n@@ -155,6 +157,8 @@ export {\n   stringToLowerCase,\n   stringToString,\n   stringTrim,\n+  // Number\n+  numberIsNaN,\n   // Errors\n   typeErrorCreate,\n   // Other"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cure53/DOMPurify/commits/1e520262bf4c66b5efda49e2316d6d1246ca7b21",
        "url": "https://api.github.com/repos/cure53/DOMPurify/commits/1e520262bf4c66b5efda49e2316d6d1246ca7b21",
        "html_url": "https://github.com/cure53/DOMPurify/commit/1e520262bf4c66b5efda49e2316d6d1246ca7b21",
        "message": "fix: Hardened the depth tracking code against prototype pollution",
        "files": [
            {
                "sha": "754f6301d2728b07e332111b7cf65e36ad95c719",
                "filename": "dist/purify.cjs.js",
                "status": "modified",
                "additions": 11,
                "deletions": 4,
                "changes": 15,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.cjs.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.cjs.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.cjs.js?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21",
                "patch": "@@ -50,6 +50,7 @@ const stringTrim = unapply(String.prototype.trim);\n const objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\n const regExpTest = unapply(RegExp.prototype.test);\n const typeErrorCreate = unconstruct(TypeError);\n+const numberIsNaN = unapply(Number.isNaN);\n \n /**\n  * Creates a new function that calls the given function with a specified thisArg and arguments.\n@@ -1309,8 +1310,11 @@ function createDOMPurify() {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (shadowNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (shadowNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(shadowNode.__depth)) {\n         _forceRemove(shadowNode);\n       }\n \n@@ -1447,8 +1451,11 @@ function createDOMPurify() {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (currentNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (currentNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(currentNode.__depth)) {\n         _forceRemove(currentNode);\n       }\n "
            },
            {
                "sha": "b5b946e6ef89dcca961a9c9533a1d648d181a150",
                "filename": "dist/purify.cjs.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.cjs.js.map",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.cjs.js.map",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.cjs.js.map?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21"
            },
            {
                "sha": "25ad9dd95af4b7293ceae1204f78da74c5dfede6",
                "filename": "dist/purify.es.mjs",
                "status": "modified",
                "additions": 11,
                "deletions": 4,
                "changes": 15,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.es.mjs",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.es.mjs",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.es.mjs?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21",
                "patch": "@@ -48,6 +48,7 @@ const stringTrim = unapply(String.prototype.trim);\n const objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\n const regExpTest = unapply(RegExp.prototype.test);\n const typeErrorCreate = unconstruct(TypeError);\n+const numberIsNaN = unapply(Number.isNaN);\n \n /**\n  * Creates a new function that calls the given function with a specified thisArg and arguments.\n@@ -1307,8 +1308,11 @@ function createDOMPurify() {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (shadowNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (shadowNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(shadowNode.__depth)) {\n         _forceRemove(shadowNode);\n       }\n \n@@ -1445,8 +1449,11 @@ function createDOMPurify() {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (currentNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (currentNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(currentNode.__depth)) {\n         _forceRemove(currentNode);\n       }\n "
            },
            {
                "sha": "c99b709c08b4b5db68120a2908d1e71aecc51c99",
                "filename": "dist/purify.es.mjs.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.es.mjs.map",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.es.mjs.map",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.es.mjs.map?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21"
            },
            {
                "sha": "1d75fdd70a3aa4c930ba65a02e1a8be049749054",
                "filename": "dist/purify.js",
                "status": "modified",
                "additions": 11,
                "deletions": 4,
                "changes": 15,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.js?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21",
                "patch": "@@ -54,6 +54,7 @@\n   const objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\n   const regExpTest = unapply(RegExp.prototype.test);\n   const typeErrorCreate = unconstruct(TypeError);\n+  const numberIsNaN = unapply(Number.isNaN);\n \n   /**\n    * Creates a new function that calls the given function with a specified thisArg and arguments.\n@@ -1313,8 +1314,11 @@\n           }\n         }\n \n-        /* Remove an element if nested too deeply to avoid mXSS */\n-        if (shadowNode.__depth >= MAX_NESTING_DEPTH) {\n+        /*\n+         * Remove an element if nested too deeply to avoid mXSS\n+         * or if the __depth might have been tampered with\n+         */\n+        if (shadowNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(shadowNode.__depth)) {\n           _forceRemove(shadowNode);\n         }\n \n@@ -1451,8 +1455,11 @@\n           }\n         }\n \n-        /* Remove an element if nested too deeply to avoid mXSS */\n-        if (currentNode.__depth >= MAX_NESTING_DEPTH) {\n+        /*\n+         * Remove an element if nested too deeply to avoid mXSS\n+         * or if the __depth might have been tampered with\n+         */\n+        if (currentNode.__depth >= MAX_NESTING_DEPTH || numberIsNaN(currentNode.__depth)) {\n           _forceRemove(currentNode);\n         }\n "
            },
            {
                "sha": "e18cb712f79e86b51e49bd332c5cc312e495f868",
                "filename": "dist/purify.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.js.map",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.js.map",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.js.map?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21"
            },
            {
                "sha": "c352432d5826effe04d95a0aedb073a98b69a2b6",
                "filename": "dist/purify.min.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.min.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.min.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.min.js?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21",
                "patch": "@@ -1,3 +1,3 @@\n /*! @license DOMPurify 3.1.2 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.1.2/LICENSE */\n-!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):(e=\"undefined\"!=typeof globalThis?globalThis:e||self).DOMPurify=t()}(this,(function(){\"use strict\";const{entries:e,setPrototypeOf:t,isFrozen:n,getPrototypeOf:o,getOwnPropertyDescriptor:r}=Object;let{freeze:i,seal:a,create:l}=Object,{apply:c,construct:s}=\"undefined\"!=typeof Reflect&&Reflect;i||(i=function(e){return e}),a||(a=function(e){return e}),c||(c=function(e,t,n){return e.apply(t,n)}),s||(s=function(e,t){return new e(...t)});const u=b(Array.prototype.forEach),m=b(Array.prototype.pop),p=b(Array.prototype.push),f=b(String.prototype.toLowerCase),d=b(String.prototype.toString),h=b(String.prototype.match),g=b(String.prototype.replace),_=b(String.prototype.indexOf),T=b(String.prototype.trim),y=b(Object.prototype.hasOwnProperty),E=b(RegExp.prototype.test),A=(N=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s(N,t)});var N;function b(e){return function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return c(e,t,o)}}function S(e,o){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;t&&t(e,null);let i=o.length;for(;i--;){let t=o[i];if(\"string\"==typeof t){const e=r(t);e!==t&&(n(o)||(o[i]=e),t=e)}e[t]=!0}return e}function R(e){for(let t=0;t<e.length;t++){y(e,t)||(e[t]=null)}return e}function w(t){const n=l(null);for(const[o,r]of e(t)){y(t,o)&&(Array.isArray(r)?n[o]=R(r):r&&\"object\"==typeof r&&r.constructor===Object?n[o]=w(r):n[o]=r)}return n}function C(e,t){for(;null!==e;){const n=r(e,t);if(n){if(n.get)return b(n.get);if(\"function\"==typeof n.value)return b(n.value)}e=o(e)}return function(){return null}}const v=i([\"a\",\"abbr\",\"acronym\",\"address\",\"area\",\"article\",\"aside\",\"audio\",\"b\",\"bdi\",\"bdo\",\"big\",\"blink\",\"blockquote\",\"body\",\"br\",\"button\",\"canvas\",\"caption\",\"center\",\"cite\",\"code\",\"col\",\"colgroup\",\"content\",\"data\",\"datalist\",\"dd\",\"decorator\",\"del\",\"details\",\"dfn\",\"dialog\",\"dir\",\"div\",\"dl\",\"dt\",\"element\",\"em\",\"fieldset\",\"figcaption\",\"figure\",\"font\",\"footer\",\"form\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"head\",\"header\",\"hgroup\",\"hr\",\"html\",\"i\",\"img\",\"input\",\"ins\",\"kbd\",\"label\",\"legend\",\"li\",\"main\",\"map\",\"mark\",\"marquee\",\"menu\",\"menuitem\",\"meter\",\"nav\",\"nobr\",\"ol\",\"optgroup\",\"option\",\"output\",\"p\",\"picture\",\"pre\",\"progress\",\"q\",\"rp\",\"rt\",\"ruby\",\"s\",\"samp\",\"section\",\"select\",\"shadow\",\"small\",\"source\",\"spacer\",\"span\",\"strike\",\"strong\",\"style\",\"sub\",\"summary\",\"sup\",\"table\",\"tbody\",\"td\",\"template\",\"textarea\",\"tfoot\",\"th\",\"thead\",\"time\",\"tr\",\"track\",\"tt\",\"u\",\"ul\",\"var\",\"video\",\"wbr\"]),L=i([\"svg\",\"a\",\"altglyph\",\"altglyphdef\",\"altglyphitem\",\"animatecolor\",\"animatemotion\",\"animatetransform\",\"circle\",\"clippath\",\"defs\",\"desc\",\"ellipse\",\"filter\",\"font\",\"g\",\"glyph\",\"glyphref\",\"hkern\",\"image\",\"line\",\"lineargradient\",\"marker\",\"mask\",\"metadata\",\"mpath\",\"path\",\"pattern\",\"polygon\",\"polyline\",\"radialgradient\",\"rect\",\"stop\",\"style\",\"switch\",\"symbol\",\"text\",\"textpath\",\"title\",\"tref\",\"tspan\",\"view\",\"vkern\"]),D=i([\"feBlend\",\"feColorMatrix\",\"feComponentTransfer\",\"feComposite\",\"feConvolveMatrix\",\"feDiffuseLighting\",\"feDisplacementMap\",\"feDistantLight\",\"feDropShadow\",\"feFlood\",\"feFuncA\",\"feFuncB\",\"feFuncG\",\"feFuncR\",\"feGaussianBlur\",\"feImage\",\"feMerge\",\"feMergeNode\",\"feMorphology\",\"feOffset\",\"fePointLight\",\"feSpecularLighting\",\"feSpotLight\",\"feTile\",\"feTurbulence\"]),O=i([\"animate\",\"color-profile\",\"cursor\",\"discard\",\"font-face\",\"font-face-format\",\"font-face-name\",\"font-face-src\",\"font-face-uri\",\"foreignobject\",\"hatch\",\"hatchpath\",\"mesh\",\"meshgradient\",\"meshpatch\",\"meshrow\",\"missing-glyph\",\"script\",\"set\",\"solidcolor\",\"unknown\",\"use\"]),x=i([\"math\",\"menclose\",\"merror\",\"mfenced\",\"mfrac\",\"mglyph\",\"mi\",\"mlabeledtr\",\"mmultiscripts\",\"mn\",\"mo\",\"mover\",\"mpadded\",\"mphantom\",\"mroot\",\"mrow\",\"ms\",\"mspace\",\"msqrt\",\"mstyle\",\"msub\",\"msup\",\"msubsup\",\"mtable\",\"mtd\",\"mtext\",\"mtr\",\"munder\",\"munderover\",\"mprescripts\"]),k=i([\"maction\",\"maligngroup\",\"malignmark\",\"mlongdiv\",\"mscarries\",\"mscarry\",\"msgroup\",\"mstack\",\"msline\",\"msrow\",\"semantics\",\"annotation\",\"annotation-xml\",\"mprescripts\",\"none\"]),M=i([\"#text\"]),I=i([\"accept\",\"action\",\"align\",\"alt\",\"autocapitalize\",\"autocomplete\",\"autopictureinpicture\",\"autoplay\",\"background\",\"bgcolor\",\"border\",\"capture\",\"cellpadding\",\"cellspacing\",\"checked\",\"cite\",\"class\",\"clear\",\"color\",\"cols\",\"colspan\",\"controls\",\"controlslist\",\"coords\",\"crossorigin\",\"datetime\",\"decoding\",\"default\",\"dir\",\"disabled\",\"disablepictureinpicture\",\"disableremoteplayback\",\"download\",\"draggable\",\"enctype\",\"enterkeyhint\",\"face\",\"for\",\"headers\",\"height\",\"hidden\",\"high\",\"href\",\"hreflang\",\"id\",\"inputmode\",\"integrity\",\"ismap\",\"kind\",\"label\",\"lang\",\"list\",\"loading\",\"loop\",\"low\",\"max\",\"maxlength\",\"media\",\"method\",\"min\",\"minlength\",\"multiple\",\"muted\",\"name\",\"nonce\",\"noshade\",\"novalidate\",\"nowrap\",\"open\",\"optimum\",\"pattern\",\"placeholder\",\"playsinline\",\"poster\",\"preload\",\"pubdate\",\"radiogroup\",\"readonly\",\"rel\",\"required\",\"rev\",\"reversed\",\"role\",\"rows\",\"rowspan\",\"spellcheck\",\"scope\",\"selected\",\"shape\",\"size\",\"sizes\",\"span\",\"srclang\",\"start\",\"src\",\"srcset\",\"step\",\"style\",\"summary\",\"tabindex\",\"title\",\"translate\",\"type\",\"usemap\",\"valign\",\"value\",\"width\",\"wrap\",\"xmlns\",\"slot\"]),U=i([\"accent-height\",\"accumulate\",\"additive\",\"alignment-baseline\",\"ascent\",\"attributename\",\"attributetype\",\"azimuth\",\"basefrequency\",\"baseline-shift\",\"begin\",\"bias\",\"by\",\"class\",\"clip\",\"clippathunits\",\"clip-path\",\"clip-rule\",\"color\",\"color-interpolation\",\"color-interpolation-filters\",\"color-profile\",\"color-rendering\",\"cx\",\"cy\",\"d\",\"dx\",\"dy\",\"diffuseconstant\",\"direction\",\"display\",\"divisor\",\"dur\",\"edgemode\",\"elevation\",\"end\",\"fill\",\"fill-opacity\",\"fill-rule\",\"filter\",\"filterunits\",\"flood-color\",\"flood-opacity\",\"font-family\",\"font-size\",\"font-size-adjust\",\"font-stretch\",\"font-style\",\"font-variant\",\"font-weight\",\"fx\",\"fy\",\"g1\",\"g2\",\"glyph-name\",\"glyphref\",\"gradientunits\",\"gradienttransform\",\"height\",\"href\",\"id\",\"image-rendering\",\"in\",\"in2\",\"k\",\"k1\",\"k2\",\"k3\",\"k4\",\"kerning\",\"keypoints\",\"keysplines\",\"keytimes\",\"lang\",\"lengthadjust\",\"letter-spacing\",\"kernelmatrix\",\"kernelunitlength\",\"lighting-color\",\"local\",\"marker-end\",\"marker-mid\",\"marker-start\",\"markerheight\",\"markerunits\",\"markerwidth\",\"maskcontentunits\",\"maskunits\",\"max\",\"mask\",\"media\",\"method\",\"mode\",\"min\",\"name\",\"numoctaves\",\"offset\",\"operator\",\"opacity\",\"order\",\"orient\",\"orientation\",\"origin\",\"overflow\",\"paint-order\",\"path\",\"pathlength\",\"patterncontentunits\",\"patterntransform\",\"patternunits\",\"points\",\"preservealpha\",\"preserveaspectratio\",\"primitiveunits\",\"r\",\"rx\",\"ry\",\"radius\",\"refx\",\"refy\",\"repeatcount\",\"repeatdur\",\"restart\",\"result\",\"rotate\",\"scale\",\"seed\",\"shape-rendering\",\"specularconstant\",\"specularexponent\",\"spreadmethod\",\"startoffset\",\"stddeviation\",\"stitchtiles\",\"stop-color\",\"stop-opacity\",\"stroke-dasharray\",\"stroke-dashoffset\",\"stroke-linecap\",\"stroke-linejoin\",\"stroke-miterlimit\",\"stroke-opacity\",\"stroke\",\"stroke-width\",\"style\",\"surfacescale\",\"systemlanguage\",\"tabindex\",\"targetx\",\"targety\",\"transform\",\"transform-origin\",\"text-anchor\",\"text-decoration\",\"text-rendering\",\"textlength\",\"type\",\"u1\",\"u2\",\"unicode\",\"values\",\"viewbox\",\"visibility\",\"version\",\"vert-adv-y\",\"vert-origin-x\",\"vert-origin-y\",\"width\",\"word-spacing\",\"wrap\",\"writing-mode\",\"xchannelselector\",\"ychannelselector\",\"x\",\"x1\",\"x2\",\"xmlns\",\"y\",\"y1\",\"y2\",\"z\",\"zoomandpan\"]),P=i([\"accent\",\"accentunder\",\"align\",\"bevelled\",\"close\",\"columnsalign\",\"columnlines\",\"columnspan\",\"denomalign\",\"depth\",\"dir\",\"display\",\"displaystyle\",\"encoding\",\"fence\",\"frame\",\"height\",\"href\",\"id\",\"largeop\",\"length\",\"linethickness\",\"lspace\",\"lquote\",\"mathbackground\",\"mathcolor\",\"mathsize\",\"mathvariant\",\"maxsize\",\"minsize\",\"movablelimits\",\"notation\",\"numalign\",\"open\",\"rowalign\",\"rowlines\",\"rowspacing\",\"rowspan\",\"rspace\",\"rquote\",\"scriptlevel\",\"scriptminsize\",\"scriptsizemultiplier\",\"selection\",\"separator\",\"separators\",\"stretchy\",\"subscriptshift\",\"supscriptshift\",\"symmetric\",\"voffset\",\"width\",\"xmlns\"]),F=i([\"xlink:href\",\"xml:id\",\"xlink:title\",\"xml:space\",\"xmlns:xlink\"]),H=a(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm),z=a(/<%[\\w\\W]*|[\\w\\W]*%>/gm),B=a(/\\${[\\w\\W]*}/gm),W=a(/^data-[\\-\\w.\\u00B7-\\uFFFF]/),G=a(/^aria-[\\-\\w]+$/),Y=a(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i),j=a(/^(?:\\w+script|data):/i),X=a(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g),q=a(/^html$/i),$=a(/^[a-z][.\\w]*(-[.\\w]+)+$/i);var K=Object.freeze({__proto__:null,MUSTACHE_EXPR:H,ERB_EXPR:z,TMPLIT_EXPR:B,DATA_ATTR:W,ARIA_ATTR:G,IS_ALLOWED_URI:Y,IS_SCRIPT_OR_DATA:j,ATTR_WHITESPACE:X,DOCTYPE_NAME:q,CUSTOM_ELEMENT:$});const V=1,Z=3,J=7,Q=8,ee=9,te=function(){return\"undefined\"==typeof window?null:window},ne=function(e,t){if(\"object\"!=typeof e||\"function\"!=typeof e.createPolicy)return null;let n=null;const o=\"data-tt-policy-suffix\";t&&t.hasAttribute(o)&&(n=t.getAttribute(o));const r=\"dompurify\"+(n?\"#\"+n:\"\");try{return e.createPolicy(r,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn(\"TrustedTypes policy \"+r+\" could not be created.\"),null}};var oe=function t(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te();const o=e=>t(e);if(o.version=\"3.1.2\",o.removed=[],!n||!n.document||n.document.nodeType!==ee)return o.isSupported=!1,o;let{document:r}=n;const a=r,c=a.currentScript,{DocumentFragment:s,HTMLTemplateElement:N,Node:b,Element:R,NodeFilter:H,NamedNodeMap:z=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:B,DOMParser:W,trustedTypes:G}=n,j=R.prototype,X=C(j,\"cloneNode\"),$=C(j,\"nextSibling\"),oe=C(j,\"childNodes\"),re=C(j,\"parentNode\");if(\"function\"==typeof N){const e=r.createElement(\"template\");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let ie,ae=\"\";const{implementation:le,createNodeIterator:ce,createDocumentFragment:se,getElementsByTagName:ue}=r,{importNode:me}=a;let pe={};o.isSupported=\"function\"==typeof e&&\"function\"==typeof re&&le&&void 0!==le.createHTMLDocument;const{MUSTACHE_EXPR:fe,ERB_EXPR:de,TMPLIT_EXPR:he,DATA_ATTR:ge,ARIA_ATTR:_e,IS_SCRIPT_OR_DATA:Te,ATTR_WHITESPACE:ye,CUSTOM_ELEMENT:Ee}=K;let{IS_ALLOWED_URI:Ae}=K,Ne=null;const be=S({},[...v,...L,...D,...x,...M]);let Se=null;const Re=S({},[...I,...U,...P,...F]);let we=Object.seal(l(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ce=null,ve=null,Le=!0,De=!0,Oe=!1,xe=!0,ke=!1,Me=!0,Ie=!1,Ue=!1,Pe=!1,Fe=!1,He=!1,ze=!1,Be=!0,We=!1;const Ge=\"user-content-\";let Ye=!0,je=!1,Xe={},qe=null;const $e=S({},[\"annotation-xml\",\"audio\",\"colgroup\",\"desc\",\"foreignobject\",\"head\",\"iframe\",\"math\",\"mi\",\"mn\",\"mo\",\"ms\",\"mtext\",\"noembed\",\"noframes\",\"noscript\",\"plaintext\",\"script\",\"style\",\"svg\",\"template\",\"thead\",\"title\",\"video\",\"xmp\"]);let Ke=null;const Ve=S({},[\"audio\",\"video\",\"img\",\"source\",\"image\",\"track\"]);let Ze=null;const Je=S({},[\"alt\",\"class\",\"for\",\"id\",\"label\",\"name\",\"pattern\",\"placeholder\",\"role\",\"summary\",\"title\",\"value\",\"style\",\"xmlns\"]),Qe=\"http://www.w3.org/1998/Math/MathML\",et=\"http://www.w3.org/2000/svg\",tt=\"http://www.w3.org/1999/xhtml\";let nt=tt,ot=!1,rt=null;const it=S({},[Qe,et,tt],d);let at=null;const lt=[\"application/xhtml+xml\",\"text/html\"],ct=\"text/html\";let st=null,ut=null;const mt=255,pt=r.createElement(\"form\"),ft=function(e){return e instanceof RegExp||e instanceof Function},dt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ut||ut!==e){if(e&&\"object\"==typeof e||(e={}),e=w(e),at=-1===lt.indexOf(e.PARSER_MEDIA_TYPE)?ct:e.PARSER_MEDIA_TYPE,st=\"application/xhtml+xml\"===at?d:f,Ne=y(e,\"ALLOWED_TAGS\")?S({},e.ALLOWED_TAGS,st):be,Se=y(e,\"ALLOWED_ATTR\")?S({},e.ALLOWED_ATTR,st):Re,rt=y(e,\"ALLOWED_NAMESPACES\")?S({},e.ALLOWED_NAMESPACES,d):it,Ze=y(e,\"ADD_URI_SAFE_ATTR\")?S(w(Je),e.ADD_URI_SAFE_ATTR,st):Je,Ke=y(e,\"ADD_DATA_URI_TAGS\")?S(w(Ve),e.ADD_DATA_URI_TAGS,st):Ve,qe=y(e,\"FORBID_CONTENTS\")?S({},e.FORBID_CONTENTS,st):$e,Ce=y(e,\"FORBID_TAGS\")?S({},e.FORBID_TAGS,st):{},ve=y(e,\"FORBID_ATTR\")?S({},e.FORBID_ATTR,st):{},Xe=!!y(e,\"USE_PROFILES\")&&e.USE_PROFILES,Le=!1!==e.ALLOW_ARIA_ATTR,De=!1!==e.ALLOW_DATA_ATTR,Oe=e.ALLOW_UNKNOWN_PROTOCOLS||!1,xe=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,ke=e.SAFE_FOR_TEMPLATES||!1,Me=!1!==e.SAFE_FOR_XML,Ie=e.WHOLE_DOCUMENT||!1,Fe=e.RETURN_DOM||!1,He=e.RETURN_DOM_FRAGMENT||!1,ze=e.RETURN_TRUSTED_TYPE||!1,Pe=e.FORCE_BODY||!1,Be=!1!==e.SANITIZE_DOM,We=e.SANITIZE_NAMED_PROPS||!1,Ye=!1!==e.KEEP_CONTENT,je=e.IN_PLACE||!1,Ae=e.ALLOWED_URI_REGEXP||Y,nt=e.NAMESPACE||tt,we=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&ft(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(we.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&ft(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(we.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&\"boolean\"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(we.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ke&&(De=!1),He&&(Fe=!0),Xe&&(Ne=S({},M),Se=[],!0===Xe.html&&(S(Ne,v),S(Se,I)),!0===Xe.svg&&(S(Ne,L),S(Se,U),S(Se,F)),!0===Xe.svgFilters&&(S(Ne,D),S(Se,U),S(Se,F)),!0===Xe.mathMl&&(S(Ne,x),S(Se,P),S(Se,F))),e.ADD_TAGS&&(Ne===be&&(Ne=w(Ne)),S(Ne,e.ADD_TAGS,st)),e.ADD_ATTR&&(Se===Re&&(Se=w(Se)),S(Se,e.ADD_ATTR,st)),e.ADD_URI_SAFE_ATTR&&S(Ze,e.ADD_URI_SAFE_ATTR,st),e.FORBID_CONTENTS&&(qe===$e&&(qe=w(qe)),S(qe,e.FORBID_CONTENTS,st)),Ye&&(Ne[\"#text\"]=!0),Ie&&S(Ne,[\"html\",\"head\",\"body\"]),Ne.table&&(S(Ne,[\"tbody\"]),delete Ce.tbody),e.TRUSTED_TYPES_POLICY){if(\"function\"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw A('TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.');if(\"function\"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw A('TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.');ie=e.TRUSTED_TYPES_POLICY,ae=ie.createHTML(\"\")}else void 0===ie&&(ie=ne(G,c)),null!==ie&&\"string\"==typeof ae&&(ae=ie.createHTML(\"\"));i&&i(e),ut=e}},ht=S({},[\"mi\",\"mo\",\"mn\",\"ms\",\"mtext\"]),gt=S({},[\"foreignobject\",\"annotation-xml\"]),_t=S({},[\"title\",\"style\",\"font\",\"a\",\"script\"]),Tt=S({},[...L,...D,...O]),yt=S({},[...x,...k]),Et=function(e){let t=re(e);t&&t.tagName||(t={namespaceURI:nt,tagName:\"template\"});const n=f(e.tagName),o=f(t.tagName);return!!rt[e.namespaceURI]&&(e.namespaceURI===et?t.namespaceURI===tt?\"svg\"===n:t.namespaceURI===Qe?\"svg\"===n&&(\"annotation-xml\"===o||ht[o]):Boolean(Tt[n]):e.namespaceURI===Qe?t.namespaceURI===tt?\"math\"===n:t.namespaceURI===et?\"math\"===n&&gt[o]:Boolean(yt[n]):e.namespaceURI===tt?!(t.namespaceURI===et&&!gt[o])&&(!(t.namespaceURI===Qe&&!ht[o])&&(!yt[n]&&(_t[n]||!Tt[n]))):!(\"application/xhtml+xml\"!==at||!rt[e.namespaceURI]))},At=function(e){p(o.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){e.remove()}},Nt=function(e,t){try{p(o.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){p(o.removed,{attribute:null,from:t})}if(t.removeAttribute(e),\"is\"===e&&!Se[e])if(Fe||He)try{At(t)}catch(e){}else try{t.setAttribute(e,\"\")}catch(e){}},bt=function(e){let t=null,n=null;if(Pe)e=\"<remove></remove>\"+e;else{const t=h(e,/^[\\r\\n\\t ]+/);n=t&&t[0]}\"application/xhtml+xml\"===at&&nt===tt&&(e='<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>'+e+\"</body></html>\");const o=ie?ie.createHTML(e):e;if(nt===tt)try{t=(new W).parseFromString(o,at)}catch(e){}if(!t||!t.documentElement){t=le.createDocument(nt,\"template\",null);try{t.documentElement.innerHTML=ot?ae:o}catch(e){}}const i=t.body||t.documentElement;return e&&n&&i.insertBefore(r.createTextNode(n),i.childNodes[0]||null),nt===tt?ue.call(t,Ie?\"html\":\"body\")[0]:Ie?t.documentElement:i},St=function(e){return ce.call(e.ownerDocument||e,e,H.SHOW_ELEMENT|H.SHOW_COMMENT|H.SHOW_TEXT|H.SHOW_PROCESSING_INSTRUCTION|H.SHOW_CDATA_SECTION,null)},Rt=function(e){return e instanceof B&&(void 0!==e.__depth&&\"number\"!=typeof e.__depth||void 0!==e.__removalCount&&\"number\"!=typeof e.__removalCount||\"string\"!=typeof e.nodeName||\"string\"!=typeof e.textContent||\"function\"!=typeof e.removeChild||!(e.attributes instanceof z)||\"function\"!=typeof e.removeAttribute||\"function\"!=typeof e.setAttribute||\"string\"!=typeof e.namespaceURI||\"function\"!=typeof e.insertBefore||\"function\"!=typeof e.hasChildNodes)},wt=function(e){return\"function\"==typeof b&&e instanceof b},Ct=function(e,t,n){pe[e]&&u(pe[e],(e=>{e.call(o,t,n,ut)}))},vt=function(e){let t=null;if(Ct(\"beforeSanitizeElements\",e,null),Rt(e))return At(e),!0;const n=st(e.nodeName);if(Ct(\"uponSanitizeElement\",e,{tagName:n,allowedTags:Ne}),e.hasChildNodes()&&!wt(e.firstElementChild)&&E(/<[/\\w]/g,e.innerHTML)&&E(/<[/\\w]/g,e.textContent))return At(e),!0;if(e.nodeType===J)return At(e),!0;if(Me&&e.nodeType===Q&&E(/<[/\\w]/g,e.data))return At(e),!0;if(!Ne[n]||Ce[n]){if(!Ce[n]&&Dt(n)){if(we.tagNameCheck instanceof RegExp&&E(we.tagNameCheck,n))return!1;if(we.tagNameCheck instanceof Function&&we.tagNameCheck(n))return!1}if(Ye&&!qe[n]){const t=re(e)||e.parentNode,n=oe(e)||e.childNodes;if(n&&t){for(let o=n.length-1;o>=0;--o){const r=X(n[o],!0);r.__removalCount=(e.__removalCount||0)+1,t.insertBefore(r,$(e))}}}return At(e),!0}return e instanceof R&&!Et(e)?(At(e),!0):\"noscript\"!==n&&\"noembed\"!==n&&\"noframes\"!==n||!E(/<\\/no(script|embed|frames)/i,e.innerHTML)?(ke&&e.nodeType===Z&&(t=e.textContent,u([fe,de,he],(e=>{t=g(t,e,\" \")})),e.textContent!==t&&(p(o.removed,{element:e.cloneNode()}),e.textContent=t)),Ct(\"afterSanitizeElements\",e,null),!1):(At(e),!0)},Lt=function(e,t,n){if(Be&&(\"id\"===t||\"name\"===t)&&(n in r||n in pt||\"__depth\"===n||\"__removalCount\"===n))return!1;if(De&&!ve[t]&&E(ge,t));else if(Le&&E(_e,t));else if(!Se[t]||ve[t]){if(!(Dt(e)&&(we.tagNameCheck instanceof RegExp&&E(we.tagNameCheck,e)||we.tagNameCheck instanceof Function&&we.tagNameCheck(e))&&(we.attributeNameCheck instanceof RegExp&&E(we.attributeNameCheck,t)||we.attributeNameCheck instanceof Function&&we.attributeNameCheck(t))||\"is\"===t&&we.allowCustomizedBuiltInElements&&(we.tagNameCheck instanceof RegExp&&E(we.tagNameCheck,n)||we.tagNameCheck instanceof Function&&we.tagNameCheck(n))))return!1}else if(Ze[t]);else if(E(Ae,g(n,ye,\"\")));else if(\"src\"!==t&&\"xlink:href\"!==t&&\"href\"!==t||\"script\"===e||0!==_(n,\"data:\")||!Ke[e]){if(Oe&&!E(Te,g(n,ye,\"\")));else if(n)return!1}else;return!0},Dt=function(e){return\"annotation-xml\"!==e&&h(e,Ee)},Ot=function(e){Ct(\"beforeSanitizeAttributes\",e,null);const{attributes:t}=e;if(!t)return;const n={attrName:\"\",attrValue:\"\",keepAttr:!0,allowedAttributes:Se};let r=t.length;for(;r--;){const i=t[r],{name:a,namespaceURI:l,value:c}=i,s=st(a);let p=\"value\"===a?c:T(c);if(n.attrName=s,n.attrValue=p,n.keepAttr=!0,n.forceKeepAttr=void 0,Ct(\"uponSanitizeAttribute\",e,n),p=n.attrValue,n.forceKeepAttr)continue;if(Nt(a,e),!n.keepAttr)continue;if(!xe&&E(/\\/>/i,p)){Nt(a,e);continue}if(Me&&E(/((--!?|])>)|<\\/(style|title)/i,p)){Nt(a,e);continue}ke&&u([fe,de,he],(e=>{p=g(p,e,\" \")}));const f=st(e.nodeName);if(Lt(f,s,p)){if(!We||\"id\"!==s&&\"name\"!==s||(Nt(a,e),p=Ge+p),ie&&\"object\"==typeof G&&\"function\"==typeof G.getAttributeType)if(l);else switch(G.getAttributeType(f,s)){case\"TrustedHTML\":p=ie.createHTML(p);break;case\"TrustedScriptURL\":p=ie.createScriptURL(p)}try{l?e.setAttributeNS(l,a,p):e.setAttribute(a,p),Rt(e)?At(e):m(o.removed)}catch(e){}}}Ct(\"afterSanitizeAttributes\",e,null)},xt=function e(t){let n=null;const o=St(t);for(Ct(\"beforeSanitizeShadowDOM\",t,null);n=o.nextNode();){if(Ct(\"uponSanitizeShadowNode\",n,null),vt(n))continue;const t=re(n);n.nodeType===V&&(t&&t.__depth?n.__depth=(n.__removalCount||0)+t.__depth+1:n.__depth=1),n.__depth>=mt&&At(n),n.content instanceof s&&(n.content.__depth=n.__depth,e(n.content)),Ot(n)}Ct(\"afterSanitizeShadowDOM\",t,null)};return o.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null,i=null,l=null;if(ot=!e,ot&&(e=\"\\x3c!--\\x3e\"),\"string\"!=typeof e&&!wt(e)){if(\"function\"!=typeof e.toString)throw A(\"toString is not a function\");if(\"string\"!=typeof(e=e.toString()))throw A(\"dirty is not a string, aborting\")}if(!o.isSupported)return e;if(Ue||dt(t),o.removed=[],\"string\"==typeof e&&(je=!1),je){if(e.nodeName){const t=st(e.nodeName);if(!Ne[t]||Ce[t])throw A(\"root node is forbidden and cannot be sanitized in-place\")}}else if(e instanceof b)n=bt(\"\\x3c!----\\x3e\"),r=n.ownerDocument.importNode(e,!0),r.nodeType===V&&\"BODY\"===r.nodeName||\"HTML\"===r.nodeName?n=r:n.appendChild(r);else{if(!Fe&&!ke&&!Ie&&-1===e.indexOf(\"<\"))return ie&&ze?ie.createHTML(e):e;if(n=bt(e),!n)return Fe?null:ze?ae:\"\"}n&&Pe&&At(n.firstChild);const c=St(je?e:n);for(;i=c.nextNode();){if(vt(i))continue;const e=re(i);i.nodeType===V&&(e&&e.__depth?i.__depth=(i.__removalCount||0)+e.__depth+1:i.__depth=1),i.__depth>=mt&&At(i),i.content instanceof s&&(i.content.__depth=i.__depth,xt(i.content)),Ot(i)}if(je)return e;if(Fe){if(He)for(l=se.call(n.ownerDocument);n.firstChild;)l.appendChild(n.firstChild);else l=n;return(Se.shadowroot||Se.shadowrootmode)&&(l=me.call(a,l,!0)),l}let m=Ie?n.outerHTML:n.innerHTML;return Ie&&Ne[\"!doctype\"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&E(q,n.ownerDocument.doctype.name)&&(m=\"<!DOCTYPE \"+n.ownerDocument.doctype.name+\">\\n\"+m),ke&&u([fe,de,he],(e=>{m=g(m,e,\" \")})),ie&&ze?ie.createHTML(m):m},o.setConfig=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};dt(e),Ue=!0},o.clearConfig=function(){ut=null,Ue=!1},o.isValidAttribute=function(e,t,n){ut||dt({});const o=st(e),r=st(t);return Lt(o,r,n)},o.addHook=function(e,t){\"function\"==typeof t&&(pe[e]=pe[e]||[],p(pe[e],t))},o.removeHook=function(e){if(pe[e])return m(pe[e])},o.removeHooks=function(e){pe[e]&&(pe[e]=[])},o.removeAllHooks=function(){pe={}},o}();return oe}));\n+!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):(e=\"undefined\"!=typeof globalThis?globalThis:e||self).DOMPurify=t()}(this,(function(){\"use strict\";const{entries:e,setPrototypeOf:t,isFrozen:n,getPrototypeOf:o,getOwnPropertyDescriptor:r}=Object;let{freeze:i,seal:a,create:l}=Object,{apply:c,construct:s}=\"undefined\"!=typeof Reflect&&Reflect;i||(i=function(e){return e}),a||(a=function(e){return e}),c||(c=function(e,t,n){return e.apply(t,n)}),s||(s=function(e,t){return new e(...t)});const u=S(Array.prototype.forEach),m=S(Array.prototype.pop),p=S(Array.prototype.push),f=S(String.prototype.toLowerCase),d=S(String.prototype.toString),h=S(String.prototype.match),g=S(String.prototype.replace),_=S(String.prototype.indexOf),T=S(String.prototype.trim),y=S(Object.prototype.hasOwnProperty),E=S(RegExp.prototype.test),A=(N=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s(N,t)});var N;const b=S(Number.isNaN);function S(e){return function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return c(e,t,o)}}function R(e,o){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;t&&t(e,null);let i=o.length;for(;i--;){let t=o[i];if(\"string\"==typeof t){const e=r(t);e!==t&&(n(o)||(o[i]=e),t=e)}e[t]=!0}return e}function w(e){for(let t=0;t<e.length;t++){y(e,t)||(e[t]=null)}return e}function C(t){const n=l(null);for(const[o,r]of e(t)){y(t,o)&&(Array.isArray(r)?n[o]=w(r):r&&\"object\"==typeof r&&r.constructor===Object?n[o]=C(r):n[o]=r)}return n}function v(e,t){for(;null!==e;){const n=r(e,t);if(n){if(n.get)return S(n.get);if(\"function\"==typeof n.value)return S(n.value)}e=o(e)}return function(){return null}}const L=i([\"a\",\"abbr\",\"acronym\",\"address\",\"area\",\"article\",\"aside\",\"audio\",\"b\",\"bdi\",\"bdo\",\"big\",\"blink\",\"blockquote\",\"body\",\"br\",\"button\",\"canvas\",\"caption\",\"center\",\"cite\",\"code\",\"col\",\"colgroup\",\"content\",\"data\",\"datalist\",\"dd\",\"decorator\",\"del\",\"details\",\"dfn\",\"dialog\",\"dir\",\"div\",\"dl\",\"dt\",\"element\",\"em\",\"fieldset\",\"figcaption\",\"figure\",\"font\",\"footer\",\"form\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"head\",\"header\",\"hgroup\",\"hr\",\"html\",\"i\",\"img\",\"input\",\"ins\",\"kbd\",\"label\",\"legend\",\"li\",\"main\",\"map\",\"mark\",\"marquee\",\"menu\",\"menuitem\",\"meter\",\"nav\",\"nobr\",\"ol\",\"optgroup\",\"option\",\"output\",\"p\",\"picture\",\"pre\",\"progress\",\"q\",\"rp\",\"rt\",\"ruby\",\"s\",\"samp\",\"section\",\"select\",\"shadow\",\"small\",\"source\",\"spacer\",\"span\",\"strike\",\"strong\",\"style\",\"sub\",\"summary\",\"sup\",\"table\",\"tbody\",\"td\",\"template\",\"textarea\",\"tfoot\",\"th\",\"thead\",\"time\",\"tr\",\"track\",\"tt\",\"u\",\"ul\",\"var\",\"video\",\"wbr\"]),D=i([\"svg\",\"a\",\"altglyph\",\"altglyphdef\",\"altglyphitem\",\"animatecolor\",\"animatemotion\",\"animatetransform\",\"circle\",\"clippath\",\"defs\",\"desc\",\"ellipse\",\"filter\",\"font\",\"g\",\"glyph\",\"glyphref\",\"hkern\",\"image\",\"line\",\"lineargradient\",\"marker\",\"mask\",\"metadata\",\"mpath\",\"path\",\"pattern\",\"polygon\",\"polyline\",\"radialgradient\",\"rect\",\"stop\",\"style\",\"switch\",\"symbol\",\"text\",\"textpath\",\"title\",\"tref\",\"tspan\",\"view\",\"vkern\"]),O=i([\"feBlend\",\"feColorMatrix\",\"feComponentTransfer\",\"feComposite\",\"feConvolveMatrix\",\"feDiffuseLighting\",\"feDisplacementMap\",\"feDistantLight\",\"feDropShadow\",\"feFlood\",\"feFuncA\",\"feFuncB\",\"feFuncG\",\"feFuncR\",\"feGaussianBlur\",\"feImage\",\"feMerge\",\"feMergeNode\",\"feMorphology\",\"feOffset\",\"fePointLight\",\"feSpecularLighting\",\"feSpotLight\",\"feTile\",\"feTurbulence\"]),x=i([\"animate\",\"color-profile\",\"cursor\",\"discard\",\"font-face\",\"font-face-format\",\"font-face-name\",\"font-face-src\",\"font-face-uri\",\"foreignobject\",\"hatch\",\"hatchpath\",\"mesh\",\"meshgradient\",\"meshpatch\",\"meshrow\",\"missing-glyph\",\"script\",\"set\",\"solidcolor\",\"unknown\",\"use\"]),k=i([\"math\",\"menclose\",\"merror\",\"mfenced\",\"mfrac\",\"mglyph\",\"mi\",\"mlabeledtr\",\"mmultiscripts\",\"mn\",\"mo\",\"mover\",\"mpadded\",\"mphantom\",\"mroot\",\"mrow\",\"ms\",\"mspace\",\"msqrt\",\"mstyle\",\"msub\",\"msup\",\"msubsup\",\"mtable\",\"mtd\",\"mtext\",\"mtr\",\"munder\",\"munderover\",\"mprescripts\"]),M=i([\"maction\",\"maligngroup\",\"malignmark\",\"mlongdiv\",\"mscarries\",\"mscarry\",\"msgroup\",\"mstack\",\"msline\",\"msrow\",\"semantics\",\"annotation\",\"annotation-xml\",\"mprescripts\",\"none\"]),I=i([\"#text\"]),U=i([\"accept\",\"action\",\"align\",\"alt\",\"autocapitalize\",\"autocomplete\",\"autopictureinpicture\",\"autoplay\",\"background\",\"bgcolor\",\"border\",\"capture\",\"cellpadding\",\"cellspacing\",\"checked\",\"cite\",\"class\",\"clear\",\"color\",\"cols\",\"colspan\",\"controls\",\"controlslist\",\"coords\",\"crossorigin\",\"datetime\",\"decoding\",\"default\",\"dir\",\"disabled\",\"disablepictureinpicture\",\"disableremoteplayback\",\"download\",\"draggable\",\"enctype\",\"enterkeyhint\",\"face\",\"for\",\"headers\",\"height\",\"hidden\",\"high\",\"href\",\"hreflang\",\"id\",\"inputmode\",\"integrity\",\"ismap\",\"kind\",\"label\",\"lang\",\"list\",\"loading\",\"loop\",\"low\",\"max\",\"maxlength\",\"media\",\"method\",\"min\",\"minlength\",\"multiple\",\"muted\",\"name\",\"nonce\",\"noshade\",\"novalidate\",\"nowrap\",\"open\",\"optimum\",\"pattern\",\"placeholder\",\"playsinline\",\"poster\",\"preload\",\"pubdate\",\"radiogroup\",\"readonly\",\"rel\",\"required\",\"rev\",\"reversed\",\"role\",\"rows\",\"rowspan\",\"spellcheck\",\"scope\",\"selected\",\"shape\",\"size\",\"sizes\",\"span\",\"srclang\",\"start\",\"src\",\"srcset\",\"step\",\"style\",\"summary\",\"tabindex\",\"title\",\"translate\",\"type\",\"usemap\",\"valign\",\"value\",\"width\",\"wrap\",\"xmlns\",\"slot\"]),P=i([\"accent-height\",\"accumulate\",\"additive\",\"alignment-baseline\",\"ascent\",\"attributename\",\"attributetype\",\"azimuth\",\"basefrequency\",\"baseline-shift\",\"begin\",\"bias\",\"by\",\"class\",\"clip\",\"clippathunits\",\"clip-path\",\"clip-rule\",\"color\",\"color-interpolation\",\"color-interpolation-filters\",\"color-profile\",\"color-rendering\",\"cx\",\"cy\",\"d\",\"dx\",\"dy\",\"diffuseconstant\",\"direction\",\"display\",\"divisor\",\"dur\",\"edgemode\",\"elevation\",\"end\",\"fill\",\"fill-opacity\",\"fill-rule\",\"filter\",\"filterunits\",\"flood-color\",\"flood-opacity\",\"font-family\",\"font-size\",\"font-size-adjust\",\"font-stretch\",\"font-style\",\"font-variant\",\"font-weight\",\"fx\",\"fy\",\"g1\",\"g2\",\"glyph-name\",\"glyphref\",\"gradientunits\",\"gradienttransform\",\"height\",\"href\",\"id\",\"image-rendering\",\"in\",\"in2\",\"k\",\"k1\",\"k2\",\"k3\",\"k4\",\"kerning\",\"keypoints\",\"keysplines\",\"keytimes\",\"lang\",\"lengthadjust\",\"letter-spacing\",\"kernelmatrix\",\"kernelunitlength\",\"lighting-color\",\"local\",\"marker-end\",\"marker-mid\",\"marker-start\",\"markerheight\",\"markerunits\",\"markerwidth\",\"maskcontentunits\",\"maskunits\",\"max\",\"mask\",\"media\",\"method\",\"mode\",\"min\",\"name\",\"numoctaves\",\"offset\",\"operator\",\"opacity\",\"order\",\"orient\",\"orientation\",\"origin\",\"overflow\",\"paint-order\",\"path\",\"pathlength\",\"patterncontentunits\",\"patterntransform\",\"patternunits\",\"points\",\"preservealpha\",\"preserveaspectratio\",\"primitiveunits\",\"r\",\"rx\",\"ry\",\"radius\",\"refx\",\"refy\",\"repeatcount\",\"repeatdur\",\"restart\",\"result\",\"rotate\",\"scale\",\"seed\",\"shape-rendering\",\"specularconstant\",\"specularexponent\",\"spreadmethod\",\"startoffset\",\"stddeviation\",\"stitchtiles\",\"stop-color\",\"stop-opacity\",\"stroke-dasharray\",\"stroke-dashoffset\",\"stroke-linecap\",\"stroke-linejoin\",\"stroke-miterlimit\",\"stroke-opacity\",\"stroke\",\"stroke-width\",\"style\",\"surfacescale\",\"systemlanguage\",\"tabindex\",\"targetx\",\"targety\",\"transform\",\"transform-origin\",\"text-anchor\",\"text-decoration\",\"text-rendering\",\"textlength\",\"type\",\"u1\",\"u2\",\"unicode\",\"values\",\"viewbox\",\"visibility\",\"version\",\"vert-adv-y\",\"vert-origin-x\",\"vert-origin-y\",\"width\",\"word-spacing\",\"wrap\",\"writing-mode\",\"xchannelselector\",\"ychannelselector\",\"x\",\"x1\",\"x2\",\"xmlns\",\"y\",\"y1\",\"y2\",\"z\",\"zoomandpan\"]),F=i([\"accent\",\"accentunder\",\"align\",\"bevelled\",\"close\",\"columnsalign\",\"columnlines\",\"columnspan\",\"denomalign\",\"depth\",\"dir\",\"display\",\"displaystyle\",\"encoding\",\"fence\",\"frame\",\"height\",\"href\",\"id\",\"largeop\",\"length\",\"linethickness\",\"lspace\",\"lquote\",\"mathbackground\",\"mathcolor\",\"mathsize\",\"mathvariant\",\"maxsize\",\"minsize\",\"movablelimits\",\"notation\",\"numalign\",\"open\",\"rowalign\",\"rowlines\",\"rowspacing\",\"rowspan\",\"rspace\",\"rquote\",\"scriptlevel\",\"scriptminsize\",\"scriptsizemultiplier\",\"selection\",\"separator\",\"separators\",\"stretchy\",\"subscriptshift\",\"supscriptshift\",\"symmetric\",\"voffset\",\"width\",\"xmlns\"]),H=i([\"xlink:href\",\"xml:id\",\"xlink:title\",\"xml:space\",\"xmlns:xlink\"]),z=a(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm),B=a(/<%[\\w\\W]*|[\\w\\W]*%>/gm),W=a(/\\${[\\w\\W]*}/gm),G=a(/^data-[\\-\\w.\\u00B7-\\uFFFF]/),Y=a(/^aria-[\\-\\w]+$/),j=a(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i),X=a(/^(?:\\w+script|data):/i),q=a(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g),$=a(/^html$/i),K=a(/^[a-z][.\\w]*(-[.\\w]+)+$/i);var V=Object.freeze({__proto__:null,MUSTACHE_EXPR:z,ERB_EXPR:B,TMPLIT_EXPR:W,DATA_ATTR:G,ARIA_ATTR:Y,IS_ALLOWED_URI:j,IS_SCRIPT_OR_DATA:X,ATTR_WHITESPACE:q,DOCTYPE_NAME:$,CUSTOM_ELEMENT:K});const Z=1,J=3,Q=7,ee=8,te=9,ne=function(){return\"undefined\"==typeof window?null:window},oe=function(e,t){if(\"object\"!=typeof e||\"function\"!=typeof e.createPolicy)return null;let n=null;const o=\"data-tt-policy-suffix\";t&&t.hasAttribute(o)&&(n=t.getAttribute(o));const r=\"dompurify\"+(n?\"#\"+n:\"\");try{return e.createPolicy(r,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn(\"TrustedTypes policy \"+r+\" could not be created.\"),null}};var re=function t(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne();const o=e=>t(e);if(o.version=\"3.1.2\",o.removed=[],!n||!n.document||n.document.nodeType!==te)return o.isSupported=!1,o;let{document:r}=n;const a=r,c=a.currentScript,{DocumentFragment:s,HTMLTemplateElement:N,Node:S,Element:w,NodeFilter:z,NamedNodeMap:B=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:W,DOMParser:G,trustedTypes:Y}=n,X=w.prototype,q=v(X,\"cloneNode\"),K=v(X,\"nextSibling\"),re=v(X,\"childNodes\"),ie=v(X,\"parentNode\");if(\"function\"==typeof N){const e=r.createElement(\"template\");e.content&&e.content.ownerDocument&&(r=e.content.ownerDocument)}let ae,le=\"\";const{implementation:ce,createNodeIterator:se,createDocumentFragment:ue,getElementsByTagName:me}=r,{importNode:pe}=a;let fe={};o.isSupported=\"function\"==typeof e&&\"function\"==typeof ie&&ce&&void 0!==ce.createHTMLDocument;const{MUSTACHE_EXPR:de,ERB_EXPR:he,TMPLIT_EXPR:ge,DATA_ATTR:_e,ARIA_ATTR:Te,IS_SCRIPT_OR_DATA:ye,ATTR_WHITESPACE:Ee,CUSTOM_ELEMENT:Ae}=V;let{IS_ALLOWED_URI:Ne}=V,be=null;const Se=R({},[...L,...D,...O,...k,...I]);let Re=null;const we=R({},[...U,...P,...F,...H]);let Ce=Object.seal(l(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ve=null,Le=null,De=!0,Oe=!0,xe=!1,ke=!0,Me=!1,Ie=!0,Ue=!1,Pe=!1,Fe=!1,He=!1,ze=!1,Be=!1,We=!0,Ge=!1;const Ye=\"user-content-\";let je=!0,Xe=!1,qe={},$e=null;const Ke=R({},[\"annotation-xml\",\"audio\",\"colgroup\",\"desc\",\"foreignobject\",\"head\",\"iframe\",\"math\",\"mi\",\"mn\",\"mo\",\"ms\",\"mtext\",\"noembed\",\"noframes\",\"noscript\",\"plaintext\",\"script\",\"style\",\"svg\",\"template\",\"thead\",\"title\",\"video\",\"xmp\"]);let Ve=null;const Ze=R({},[\"audio\",\"video\",\"img\",\"source\",\"image\",\"track\"]);let Je=null;const Qe=R({},[\"alt\",\"class\",\"for\",\"id\",\"label\",\"name\",\"pattern\",\"placeholder\",\"role\",\"summary\",\"title\",\"value\",\"style\",\"xmlns\"]),et=\"http://www.w3.org/1998/Math/MathML\",tt=\"http://www.w3.org/2000/svg\",nt=\"http://www.w3.org/1999/xhtml\";let ot=nt,rt=!1,it=null;const at=R({},[et,tt,nt],d);let lt=null;const ct=[\"application/xhtml+xml\",\"text/html\"],st=\"text/html\";let ut=null,mt=null;const pt=255,ft=r.createElement(\"form\"),dt=function(e){return e instanceof RegExp||e instanceof Function},ht=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!mt||mt!==e){if(e&&\"object\"==typeof e||(e={}),e=C(e),lt=-1===ct.indexOf(e.PARSER_MEDIA_TYPE)?st:e.PARSER_MEDIA_TYPE,ut=\"application/xhtml+xml\"===lt?d:f,be=y(e,\"ALLOWED_TAGS\")?R({},e.ALLOWED_TAGS,ut):Se,Re=y(e,\"ALLOWED_ATTR\")?R({},e.ALLOWED_ATTR,ut):we,it=y(e,\"ALLOWED_NAMESPACES\")?R({},e.ALLOWED_NAMESPACES,d):at,Je=y(e,\"ADD_URI_SAFE_ATTR\")?R(C(Qe),e.ADD_URI_SAFE_ATTR,ut):Qe,Ve=y(e,\"ADD_DATA_URI_TAGS\")?R(C(Ze),e.ADD_DATA_URI_TAGS,ut):Ze,$e=y(e,\"FORBID_CONTENTS\")?R({},e.FORBID_CONTENTS,ut):Ke,ve=y(e,\"FORBID_TAGS\")?R({},e.FORBID_TAGS,ut):{},Le=y(e,\"FORBID_ATTR\")?R({},e.FORBID_ATTR,ut):{},qe=!!y(e,\"USE_PROFILES\")&&e.USE_PROFILES,De=!1!==e.ALLOW_ARIA_ATTR,Oe=!1!==e.ALLOW_DATA_ATTR,xe=e.ALLOW_UNKNOWN_PROTOCOLS||!1,ke=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,Me=e.SAFE_FOR_TEMPLATES||!1,Ie=!1!==e.SAFE_FOR_XML,Ue=e.WHOLE_DOCUMENT||!1,He=e.RETURN_DOM||!1,ze=e.RETURN_DOM_FRAGMENT||!1,Be=e.RETURN_TRUSTED_TYPE||!1,Fe=e.FORCE_BODY||!1,We=!1!==e.SANITIZE_DOM,Ge=e.SANITIZE_NAMED_PROPS||!1,je=!1!==e.KEEP_CONTENT,Xe=e.IN_PLACE||!1,Ne=e.ALLOWED_URI_REGEXP||j,ot=e.NAMESPACE||nt,Ce=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&dt(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Ce.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&dt(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Ce.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&\"boolean\"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Ce.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Me&&(Oe=!1),ze&&(He=!0),qe&&(be=R({},I),Re=[],!0===qe.html&&(R(be,L),R(Re,U)),!0===qe.svg&&(R(be,D),R(Re,P),R(Re,H)),!0===qe.svgFilters&&(R(be,O),R(Re,P),R(Re,H)),!0===qe.mathMl&&(R(be,k),R(Re,F),R(Re,H))),e.ADD_TAGS&&(be===Se&&(be=C(be)),R(be,e.ADD_TAGS,ut)),e.ADD_ATTR&&(Re===we&&(Re=C(Re)),R(Re,e.ADD_ATTR,ut)),e.ADD_URI_SAFE_ATTR&&R(Je,e.ADD_URI_SAFE_ATTR,ut),e.FORBID_CONTENTS&&($e===Ke&&($e=C($e)),R($e,e.FORBID_CONTENTS,ut)),je&&(be[\"#text\"]=!0),Ue&&R(be,[\"html\",\"head\",\"body\"]),be.table&&(R(be,[\"tbody\"]),delete ve.tbody),e.TRUSTED_TYPES_POLICY){if(\"function\"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw A('TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.');if(\"function\"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw A('TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.');ae=e.TRUSTED_TYPES_POLICY,le=ae.createHTML(\"\")}else void 0===ae&&(ae=oe(Y,c)),null!==ae&&\"string\"==typeof le&&(le=ae.createHTML(\"\"));i&&i(e),mt=e}},gt=R({},[\"mi\",\"mo\",\"mn\",\"ms\",\"mtext\"]),_t=R({},[\"foreignobject\",\"annotation-xml\"]),Tt=R({},[\"title\",\"style\",\"font\",\"a\",\"script\"]),yt=R({},[...D,...O,...x]),Et=R({},[...k,...M]),At=function(e){let t=ie(e);t&&t.tagName||(t={namespaceURI:ot,tagName:\"template\"});const n=f(e.tagName),o=f(t.tagName);return!!it[e.namespaceURI]&&(e.namespaceURI===tt?t.namespaceURI===nt?\"svg\"===n:t.namespaceURI===et?\"svg\"===n&&(\"annotation-xml\"===o||gt[o]):Boolean(yt[n]):e.namespaceURI===et?t.namespaceURI===nt?\"math\"===n:t.namespaceURI===tt?\"math\"===n&&_t[o]:Boolean(Et[n]):e.namespaceURI===nt?!(t.namespaceURI===tt&&!_t[o])&&(!(t.namespaceURI===et&&!gt[o])&&(!Et[n]&&(Tt[n]||!yt[n]))):!(\"application/xhtml+xml\"!==lt||!it[e.namespaceURI]))},Nt=function(e){p(o.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){e.remove()}},bt=function(e,t){try{p(o.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){p(o.removed,{attribute:null,from:t})}if(t.removeAttribute(e),\"is\"===e&&!Re[e])if(He||ze)try{Nt(t)}catch(e){}else try{t.setAttribute(e,\"\")}catch(e){}},St=function(e){let t=null,n=null;if(Fe)e=\"<remove></remove>\"+e;else{const t=h(e,/^[\\r\\n\\t ]+/);n=t&&t[0]}\"application/xhtml+xml\"===lt&&ot===nt&&(e='<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>'+e+\"</body></html>\");const o=ae?ae.createHTML(e):e;if(ot===nt)try{t=(new G).parseFromString(o,lt)}catch(e){}if(!t||!t.documentElement){t=ce.createDocument(ot,\"template\",null);try{t.documentElement.innerHTML=rt?le:o}catch(e){}}const i=t.body||t.documentElement;return e&&n&&i.insertBefore(r.createTextNode(n),i.childNodes[0]||null),ot===nt?me.call(t,Ue?\"html\":\"body\")[0]:Ue?t.documentElement:i},Rt=function(e){return se.call(e.ownerDocument||e,e,z.SHOW_ELEMENT|z.SHOW_COMMENT|z.SHOW_TEXT|z.SHOW_PROCESSING_INSTRUCTION|z.SHOW_CDATA_SECTION,null)},wt=function(e){return e instanceof W&&(void 0!==e.__depth&&\"number\"!=typeof e.__depth||void 0!==e.__removalCount&&\"number\"!=typeof e.__removalCount||\"string\"!=typeof e.nodeName||\"string\"!=typeof e.textContent||\"function\"!=typeof e.removeChild||!(e.attributes instanceof B)||\"function\"!=typeof e.removeAttribute||\"function\"!=typeof e.setAttribute||\"string\"!=typeof e.namespaceURI||\"function\"!=typeof e.insertBefore||\"function\"!=typeof e.hasChildNodes)},Ct=function(e){return\"function\"==typeof S&&e instanceof S},vt=function(e,t,n){fe[e]&&u(fe[e],(e=>{e.call(o,t,n,mt)}))},Lt=function(e){let t=null;if(vt(\"beforeSanitizeElements\",e,null),wt(e))return Nt(e),!0;const n=ut(e.nodeName);if(vt(\"uponSanitizeElement\",e,{tagName:n,allowedTags:be}),e.hasChildNodes()&&!Ct(e.firstElementChild)&&E(/<[/\\w]/g,e.innerHTML)&&E(/<[/\\w]/g,e.textContent))return Nt(e),!0;if(e.nodeType===Q)return Nt(e),!0;if(Ie&&e.nodeType===ee&&E(/<[/\\w]/g,e.data))return Nt(e),!0;if(!be[n]||ve[n]){if(!ve[n]&&Ot(n)){if(Ce.tagNameCheck instanceof RegExp&&E(Ce.tagNameCheck,n))return!1;if(Ce.tagNameCheck instanceof Function&&Ce.tagNameCheck(n))return!1}if(je&&!$e[n]){const t=ie(e)||e.parentNode,n=re(e)||e.childNodes;if(n&&t){for(let o=n.length-1;o>=0;--o){const r=q(n[o],!0);r.__removalCount=(e.__removalCount||0)+1,t.insertBefore(r,K(e))}}}return Nt(e),!0}return e instanceof w&&!At(e)?(Nt(e),!0):\"noscript\"!==n&&\"noembed\"!==n&&\"noframes\"!==n||!E(/<\\/no(script|embed|frames)/i,e.innerHTML)?(Me&&e.nodeType===J&&(t=e.textContent,u([de,he,ge],(e=>{t=g(t,e,\" \")})),e.textContent!==t&&(p(o.removed,{element:e.cloneNode()}),e.textContent=t)),vt(\"afterSanitizeElements\",e,null),!1):(Nt(e),!0)},Dt=function(e,t,n){if(We&&(\"id\"===t||\"name\"===t)&&(n in r||n in ft||\"__depth\"===n||\"__removalCount\"===n))return!1;if(Oe&&!Le[t]&&E(_e,t));else if(De&&E(Te,t));else if(!Re[t]||Le[t]){if(!(Ot(e)&&(Ce.tagNameCheck instanceof RegExp&&E(Ce.tagNameCheck,e)||Ce.tagNameCheck instanceof Function&&Ce.tagNameCheck(e))&&(Ce.attributeNameCheck instanceof RegExp&&E(Ce.attributeNameCheck,t)||Ce.attributeNameCheck instanceof Function&&Ce.attributeNameCheck(t))||\"is\"===t&&Ce.allowCustomizedBuiltInElements&&(Ce.tagNameCheck instanceof RegExp&&E(Ce.tagNameCheck,n)||Ce.tagNameCheck instanceof Function&&Ce.tagNameCheck(n))))return!1}else if(Je[t]);else if(E(Ne,g(n,Ee,\"\")));else if(\"src\"!==t&&\"xlink:href\"!==t&&\"href\"!==t||\"script\"===e||0!==_(n,\"data:\")||!Ve[e]){if(xe&&!E(ye,g(n,Ee,\"\")));else if(n)return!1}else;return!0},Ot=function(e){return\"annotation-xml\"!==e&&h(e,Ae)},xt=function(e){vt(\"beforeSanitizeAttributes\",e,null);const{attributes:t}=e;if(!t)return;const n={attrName:\"\",attrValue:\"\",keepAttr:!0,allowedAttributes:Re};let r=t.length;for(;r--;){const i=t[r],{name:a,namespaceURI:l,value:c}=i,s=ut(a);let p=\"value\"===a?c:T(c);if(n.attrName=s,n.attrValue=p,n.keepAttr=!0,n.forceKeepAttr=void 0,vt(\"uponSanitizeAttribute\",e,n),p=n.attrValue,n.forceKeepAttr)continue;if(bt(a,e),!n.keepAttr)continue;if(!ke&&E(/\\/>/i,p)){bt(a,e);continue}if(Ie&&E(/((--!?|])>)|<\\/(style|title)/i,p)){bt(a,e);continue}Me&&u([de,he,ge],(e=>{p=g(p,e,\" \")}));const f=ut(e.nodeName);if(Dt(f,s,p)){if(!Ge||\"id\"!==s&&\"name\"!==s||(bt(a,e),p=Ye+p),ae&&\"object\"==typeof Y&&\"function\"==typeof Y.getAttributeType)if(l);else switch(Y.getAttributeType(f,s)){case\"TrustedHTML\":p=ae.createHTML(p);break;case\"TrustedScriptURL\":p=ae.createScriptURL(p)}try{l?e.setAttributeNS(l,a,p):e.setAttribute(a,p),wt(e)?Nt(e):m(o.removed)}catch(e){}}}vt(\"afterSanitizeAttributes\",e,null)},kt=function e(t){let n=null;const o=Rt(t);for(vt(\"beforeSanitizeShadowDOM\",t,null);n=o.nextNode();){if(vt(\"uponSanitizeShadowNode\",n,null),Lt(n))continue;const t=ie(n);n.nodeType===Z&&(t&&t.__depth?n.__depth=(n.__removalCount||0)+t.__depth+1:n.__depth=1),(n.__depth>=pt||b(n.__depth))&&Nt(n),n.content instanceof s&&(n.content.__depth=n.__depth,e(n.content)),xt(n)}vt(\"afterSanitizeShadowDOM\",t,null)};return o.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null,i=null,l=null;if(rt=!e,rt&&(e=\"\\x3c!--\\x3e\"),\"string\"!=typeof e&&!Ct(e)){if(\"function\"!=typeof e.toString)throw A(\"toString is not a function\");if(\"string\"!=typeof(e=e.toString()))throw A(\"dirty is not a string, aborting\")}if(!o.isSupported)return e;if(Pe||ht(t),o.removed=[],\"string\"==typeof e&&(Xe=!1),Xe){if(e.nodeName){const t=ut(e.nodeName);if(!be[t]||ve[t])throw A(\"root node is forbidden and cannot be sanitized in-place\")}}else if(e instanceof S)n=St(\"\\x3c!----\\x3e\"),r=n.ownerDocument.importNode(e,!0),r.nodeType===Z&&\"BODY\"===r.nodeName||\"HTML\"===r.nodeName?n=r:n.appendChild(r);else{if(!He&&!Me&&!Ue&&-1===e.indexOf(\"<\"))return ae&&Be?ae.createHTML(e):e;if(n=St(e),!n)return He?null:Be?le:\"\"}n&&Fe&&Nt(n.firstChild);const c=Rt(Xe?e:n);for(;i=c.nextNode();){if(Lt(i))continue;const e=ie(i);i.nodeType===Z&&(e&&e.__depth?i.__depth=(i.__removalCount||0)+e.__depth+1:i.__depth=1),(i.__depth>=pt||b(i.__depth))&&Nt(i),i.content instanceof s&&(i.content.__depth=i.__depth,kt(i.content)),xt(i)}if(Xe)return e;if(He){if(ze)for(l=ue.call(n.ownerDocument);n.firstChild;)l.appendChild(n.firstChild);else l=n;return(Re.shadowroot||Re.shadowrootmode)&&(l=pe.call(a,l,!0)),l}let m=Ue?n.outerHTML:n.innerHTML;return Ue&&be[\"!doctype\"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&E($,n.ownerDocument.doctype.name)&&(m=\"<!DOCTYPE \"+n.ownerDocument.doctype.name+\">\\n\"+m),Me&&u([de,he,ge],(e=>{m=g(m,e,\" \")})),ae&&Be?ae.createHTML(m):m},o.setConfig=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ht(e),Pe=!0},o.clearConfig=function(){mt=null,Pe=!1},o.isValidAttribute=function(e,t,n){mt||ht({});const o=ut(e),r=ut(t);return Dt(o,r,n)},o.addHook=function(e,t){\"function\"==typeof t&&(fe[e]=fe[e]||[],p(fe[e],t))},o.removeHook=function(e){if(fe[e])return m(fe[e])},o.removeHooks=function(e){fe[e]&&(fe[e]=[])},o.removeAllHooks=function(){fe={}},o}();return re}));\n //# sourceMappingURL=purify.min.js.map"
            },
            {
                "sha": "485fdc3ad7604959fff2df13362e83eb7c02bcb0",
                "filename": "dist/purify.min.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.min.js.map",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/dist%2Fpurify.min.js.map",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/dist%2Fpurify.min.js.map?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21"
            },
            {
                "sha": "538b48a538b67e84ff90cccccb52339574a73577",
                "filename": "src/purify.js",
                "status": "modified",
                "additions": 17,
                "deletions": 4,
                "changes": 21,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/src%2Fpurify.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/src%2Fpurify.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/src%2Fpurify.js?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21",
                "patch": "@@ -15,6 +15,7 @@ import {\n   stringToString,\n   stringIndexOf,\n   stringTrim,\n+  numberIsNaN,\n   regExpTest,\n   typeErrorCreate,\n   lookupGetter,\n@@ -1426,8 +1427,14 @@ function createDOMPurify(window = getGlobal()) {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (shadowNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (\n+        shadowNode.__depth >= MAX_NESTING_DEPTH ||\n+        numberIsNaN(shadowNode.__depth)\n+      ) {\n         _forceRemove(shadowNode);\n       }\n \n@@ -1577,8 +1584,14 @@ function createDOMPurify(window = getGlobal()) {\n         }\n       }\n \n-      /* Remove an element if nested too deeply to avoid mXSS */\n-      if (currentNode.__depth >= MAX_NESTING_DEPTH) {\n+      /*\n+       * Remove an element if nested too deeply to avoid mXSS\n+       * or if the __depth might have been tampered with\n+       */\n+      if (\n+        currentNode.__depth >= MAX_NESTING_DEPTH ||\n+        numberIsNaN(currentNode.__depth)\n+      ) {\n         _forceRemove(currentNode);\n       }\n "
            },
            {
                "sha": "5959988ebf430cd685aeeb0ce404b29c291bdeff",
                "filename": "src/utils.js",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/src%2Futils.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/src%2Futils.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/src%2Futils.js?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21",
                "patch": "@@ -52,6 +52,8 @@ const regExpTest = unapply(RegExp.prototype.test);\n \n const typeErrorCreate = unconstruct(TypeError);\n \n+const numberIsNaN = unapply(Number.isNaN);\n+\n /**\n  * Creates a new function that calls the given function with a specified thisArg and arguments.\n  *\n@@ -215,6 +217,8 @@ export {\n   stringToLowerCase,\n   stringToString,\n   stringTrim,\n+  // Number\n+  numberIsNaN,\n   // Errors\n   typeErrorCreate,\n   // Other"
            },
            {
                "sha": "1e56b8159d2ad125e4056f6fb5c60f6e03666b0d",
                "filename": "test/test-suite.js",
                "status": "modified",
                "additions": 0,
                "deletions": 96,
                "changes": 96,
                "blob_url": "https://github.com/cure53/DOMPurify/blob/1e520262bf4c66b5efda49e2316d6d1246ca7b21/test%2Ftest-suite.js",
                "raw_url": "https://github.com/cure53/DOMPurify/raw/1e520262bf4c66b5efda49e2316d6d1246ca7b21/test%2Ftest-suite.js",
                "contents_url": "https://api.github.com/repos/cure53/DOMPurify/contents/test%2Ftest-suite.js?ref=1e520262bf4c66b5efda49e2316d6d1246ca7b21",
                "patch": "@@ -2104,101 +2104,5 @@\n       let clean = DOMPurify.sanitize(dirty, config);\n       assert.contains(clean, expected);\n     });\n-    \n-    QUnit.test('Test proper handling of nesting-based mXSS 1/3', function (assert) {\n-      \n-      let dirty = `${`<div>`.repeat(250)}${`</div>`.repeat(250)}<img>`;\n-      let expected = `${`<div>`.repeat(250)}${`</div>`.repeat(250)}<img>`;\n-      let clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-\n-      dirty = `${`<div>`.repeat(255)}${`</div>`.repeat(255)}<img>`;\n-      expected = `${`<div>`.repeat(253)}${`</div>`.repeat(253)}<img>`;\n-      clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-\n-      dirty = `${`<div>`.repeat(257)}${`</div>`.repeat(257)}<img>`;\n-      expected = `${`<div>`.repeat(253)}${`</div>`.repeat(253)}<img>`;\n-      clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-      \n-      dirty = `<div><template>${`<div>`.repeat(257)}${`</div>`.repeat(257)}<img>`;\n-      expected = `<div><template>${`<div>`.repeat(251)}${`</div>`.repeat(251)}<img></template></div>`;\n-      clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-\n-      dirty = `<div><template>${`<r>`.repeat(255)}<img>${`</r>`.repeat(\n-        255\n-      )}</template></div><img>`;\n-      expected = `<div><template></template></div><img>`;\n-      clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-      \n-    });\n-    \n-    QUnit.test('Test proper handling of nesting-based mXSS 2/3', function (assert) {\n-      \n-      let dirty = `<form><input name=\"__depth\">${`<div>`.repeat(500)}${`</div>`.repeat(500)}<img>`;\n-      let expected = [\n-          ``,\n-          `<form><input>${`<div>`.repeat(252)}${`</div>`.repeat(252)}<img></form>`,\n-      ];\n-      let clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-      \n-      dirty = `<form><input name=\"__depth\"></form>${`<div>`.repeat(500)}${`</div>`.repeat(500)}<img>`;\n-      expected = [\n-          `${`<div>`.repeat(253)}${`</div>`.repeat(253)}<img>`,\n-          `<form><input></form>${`<div>`.repeat(253)}${`</div>`.repeat(253)}<img>`\n-      ];\n-      clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-\n-      dirty = `<form><input name=\"__removalCount\">${`<div>`.repeat(\n-        500\n-      )}${`</div>`.repeat(500)}<img>`;\n-      expected = [\n-        ``,\n-        `<form><input>${`<div>`.repeat(\n-          252\n-        )}${`</div>`.repeat(252)}<img></form>`,\n-      ];\n-      clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-\n-      dirty = `<form><input name=\"__removalCount\"></form>${`<div>`.repeat(\n-        500\n-      )}${`</div>`.repeat(500)}<img>`;\n-      expected = [\n-        `${`<div>`.repeat(253)}${`</div>`.repeat(253)}<img>`,\n-        `<form><input></form>${`<div>`.repeat(\n-          253\n-        )}${`</div>`.repeat(253)}<img>`,\n-      ];\n-      clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-\n-      dirty = `<form><input name=\"parentNode\"></form>${`<div>`.repeat(\n-        500\n-      )}${`</div>`.repeat(500)}<img>`;\n-      expected = [\n-        `<form><input></form>${`<div>`.repeat(253)}${`</div>`.repeat(253)}<img>`\n-      ];\n-      clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-    });\n-    \n-    QUnit.test('Test proper handling of nesting-based mXSS 3/3', function (assert) {\n-      \n-      let dirty = `<form><input name=\"__depth\">`;\n-      let expected = [``, `<form><input></form>`];\n-      let clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-\n-      dirty = `<form><input name=\"__removalCount\">`;\n-      expected = [``, `<form><input></form>`];\n-      clean = DOMPurify.sanitize(dirty);\n-      assert.contains(clean, expected);\n-    });\n   };\n });\n\\ No newline at end of file"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/MISP/MISP/commits/3a5227d7b3d4518ac109af61979a00145a0de6fa",
        "url": "https://api.github.com/repos/MISP/MISP/commits/3a5227d7b3d4518ac109af61979a00145a0de6fa",
        "html_url": "https://github.com/MISP/MISP/commit/3a5227d7b3d4518ac109af61979a00145a0de6fa",
        "message": "fix: [security] Ensure proper sanitization of sensitive fields in user-login-profiles\n\nPrevent other org-admins (from the same org) to view sensitive fields of\nother org-admins when they confirmed their login session\n\n- As reported by Sharad Kumar Dahal of Green Tick Nepal Pvt. Ltd",
        "files": [
            {
                "sha": "1e8385ac66da331c134864b2d6a8445167d24727",
                "filename": "app/Controller/UserLoginProfilesController.php",
                "status": "modified",
                "additions": 37,
                "deletions": 1,
                "changes": 38,
                "blob_url": "https://github.com/MISP/MISP/blob/3a5227d7b3d4518ac109af61979a00145a0de6fa/app%2FController%2FUserLoginProfilesController.php",
                "raw_url": "https://github.com/MISP/MISP/raw/3a5227d7b3d4518ac109af61979a00145a0de6fa/app%2FController%2FUserLoginProfilesController.php",
                "contents_url": "https://api.github.com/repos/MISP/MISP/contents/app%2FController%2FUserLoginProfilesController.php?ref=3a5227d7b3d4518ac109af61979a00145a0de6fa",
                "patch": "@@ -18,6 +18,32 @@ class UserLoginProfilesController extends AppController\n         )\n     );\n \n+    private $user_allowed_fields = [\n+        'id',\n+        'org_id',\n+        'server_id',\n+        'email',\n+        'autoalert',\n+        'invited_by',\n+        'gpgkey',\n+        'certif_public',\n+        'nids_sid',\n+        'termsaccepted',\n+        'newsread',\n+        'role_id',\n+        'change_pw',\n+        'contactalert',\n+        'disabled',\n+        'expiration',\n+        'current_login',\n+        'last_login',\n+        'last_api_access',\n+        'force_logout',\n+        'date_created',\n+        'date_modified',\n+        'last_pw_change',\n+    ];\n+\n     public function index($user_id = null)\n     {\n         $delete_buttons = false;\n@@ -35,7 +61,17 @@ public function index($user_id = null)\n             $delete_buttons = true;\n         }\n         $this->CRUD->index([\n-            'conditions' => $conditions\n+            'conditions' => $conditions,\n+            'afterFind' => function(array $userLoginProfiles) {\n+                foreach ($userLoginProfiles as $i => $userLoginProfile) {\n+                    foreach ($userLoginProfile['User'] as $field => $value) {\n+                        if (!in_array($field, $this->user_allowed_fields)) {\n+                            unset($userLoginProfiles[$i]['User'][$field]);\n+                        }\n+                    }\n+                }\n+                return $userLoginProfiles;\n+            }\n         ]);\n         if ($this->IndexFilter->isRest()) {\n             return $this->restResponsePayload;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/man-group/dtale/commits/b6e30969390520d1400b55acbb13e5487b8472e8",
        "url": "https://api.github.com/repos/man-group/dtale/commits/b6e30969390520d1400b55acbb13e5487b8472e8",
        "html_url": "https://github.com/man-group/dtale/commit/b6e30969390520d1400b55acbb13e5487b8472e8",
        "message": "Added check for custom filtering before using custom queries in charts",
        "files": [
            {
                "sha": "b23aabd348d7eb75690d813678f070fd62589cc4",
                "filename": "dtale/dash_application/layout/layout.py",
                "status": "modified",
                "additions": 24,
                "deletions": 20,
                "changes": 44,
                "blob_url": "https://github.com/man-group/dtale/blob/b6e30969390520d1400b55acbb13e5487b8472e8/dtale%2Fdash_application%2Flayout%2Flayout.py",
                "raw_url": "https://github.com/man-group/dtale/raw/b6e30969390520d1400b55acbb13e5487b8472e8/dtale%2Fdash_application%2Flayout%2Flayout.py",
                "contents_url": "https://api.github.com/repos/man-group/dtale/contents/dtale%2Fdash_application%2Flayout%2Flayout.py?ref=b6e30969390520d1400b55acbb13e5487b8472e8",
                "patch": "@@ -1709,27 +1709,31 @@ def show_map_style(show):\n             ),\n             className=\"row pt-3 pb-3 charts-filters\",\n         ),\n-        html.Div(\n+        (\n             html.Div(\n-                [\n-                    html.Div(\n-                        [\n-                            query_label,\n-                            dcc.Input(\n-                                id=\"query-input\",\n-                                type=\"text\",\n-                                placeholder=query_placeholder,\n-                                className=\"form-control\",\n-                                value=query_value,\n-                                style={\"lineHeight\": \"inherit\"},\n-                            ),\n-                        ],\n-                        className=\"input-group mr-3\",\n-                    )\n-                ],\n-                className=\"col\",\n-            ),\n-            className=\"row pt-3 pb-3 charts-filters\",\n+                html.Div(\n+                    [\n+                        html.Div(\n+                            [\n+                                query_label,\n+                                dcc.Input(\n+                                    id=\"query-input\",\n+                                    type=\"text\",\n+                                    placeholder=query_placeholder,\n+                                    className=\"form-control\",\n+                                    value=query_value,\n+                                    style={\"lineHeight\": \"inherit\"},\n+                                ),\n+                            ],\n+                            className=\"input-group mr-3\",\n+                        )\n+                    ],\n+                    className=\"col\",\n+                ),\n+                className=\"row pt-3 pb-3 charts-filters\",\n+            )\n+            if global_state.load_flag(inputs[\"data_id\"], \"enable_custom_filters\", False)\n+            else None\n         ),\n         html.Div(\n             html.Div("
            },
            {
                "sha": "4acfc984d7988ab85d7bdbeaffdf8a7265791837",
                "filename": "dtale/views.py",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/man-group/dtale/blob/b6e30969390520d1400b55acbb13e5487b8472e8/dtale%2Fviews.py",
                "raw_url": "https://github.com/man-group/dtale/raw/b6e30969390520d1400b55acbb13e5487b8472e8/dtale%2Fviews.py",
                "contents_url": "https://api.github.com/repos/man-group/dtale/contents/dtale%2Fviews.py?ref=b6e30969390520d1400b55acbb13e5487b8472e8",
                "patch": "@@ -3380,9 +3380,12 @@ def get_chart_data(data_id):\n         max: maxY,\n     } or {error: 'Exception message', traceback: 'Exception stacktrace'}\n     \"\"\"\n+    custom_query = None\n+    if global_state.load_flag(data_id, \"enable_custom_filters\", False):\n+        custom_query = get_str_arg(request, \"query\")\n     data = run_query(\n         handle_predefined(data_id),\n-        build_query(data_id, get_str_arg(request, \"query\")),\n+        build_query(data_id, custom_query),\n         global_state.get_context_variables(data_id),\n     )\n     x = get_str_arg(request, \"x\")"
            },
            {
                "sha": "6154bfa5b9aa37a419d4b7322f02be91edb01bd8",
                "filename": "tests/dtale/test_views.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/man-group/dtale/blob/b6e30969390520d1400b55acbb13e5487b8472e8/tests%2Fdtale%2Ftest_views.py",
                "raw_url": "https://github.com/man-group/dtale/raw/b6e30969390520d1400b55acbb13e5487b8472e8/tests%2Fdtale%2Ftest_views.py",
                "contents_url": "https://api.github.com/repos/man-group/dtale/contents/tests%2Fdtale%2Ftest_views.py?ref=b6e30969390520d1400b55acbb13e5487b8472e8",
                "patch": "@@ -1975,6 +1975,7 @@ def test_get_chart_data(unittest, rolling_data):\n \n     with app.test_client() as c:\n         build_data_inst({c.port: test_data})\n+        global_state.set_app_settings(dict(enable_custom_filters=True))\n         response = c.get(\n             \"/dtale/chart-data/{}\".format(c.port),\n             query_string=dict(query=\"missing_col == 'blah'\"),\n@@ -1997,6 +1998,7 @@ def test_get_chart_data(unittest, rolling_data):\n             response_data[\"error\"],\n             'query \"security_id == 51\" found no data, please alter',\n         )\n+    global_state.set_app_settings(dict(enable_custom_filters=False))\n \n     df = pd.DataFrame([dict(a=i, b=np.nan) for i in range(100)])\n     df, _ = views.format_data(df)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/ansible/commits/8a87e1c5d37422bc99d27ad4237d185cc233e035",
        "url": "https://api.github.com/repos/ansible/ansible/commits/8a87e1c5d37422bc99d27ad4237d185cc233e035",
        "html_url": "https://github.com/ansible/ansible/commit/8a87e1c5d37422bc99d27ad4237d185cc233e035",
        "message": "no_log avoid masking booleans (#82217) (#82235)\n\n* no_log avoid masking booleans (#82217)\r\n\r\n* no_log avoid masking booleans\r\n\r\n* clog\r\n\r\n* fix issues\r\n\r\n(cherry picked from commit 6e448edc63ecfdaf3f6ebb2e015e2d3c12dd1d95)\r\n\r\n* unused boil is hot",
        "files": [
            {
                "sha": "2fc499ddd9f2ddfd52b6af3511f23a4c1ae4104c",
                "filename": "changelogs/fragments/no_log_booly.yml",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/ansible/ansible/blob/8a87e1c5d37422bc99d27ad4237d185cc233e035/changelogs%2Ffragments%2Fno_log_booly.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/8a87e1c5d37422bc99d27ad4237d185cc233e035/changelogs%2Ffragments%2Fno_log_booly.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/changelogs%2Ffragments%2Fno_log_booly.yml?ref=8a87e1c5d37422bc99d27ad4237d185cc233e035",
                "patch": "@@ -0,0 +1,2 @@\n+bugfixes:\n+  - module no_log will no longer affect top level booleans, for example ``no_log_module_parameter='a'`` will no longer hide ``changed=False`` as a 'no log value' (matches 'a')."
            },
            {
                "sha": "19ca0aaf9fa50f8d4e551dba36a4040652a7c4f5",
                "filename": "lib/ansible/module_utils/basic.py",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/ansible/ansible/blob/8a87e1c5d37422bc99d27ad4237d185cc233e035/lib%2Fansible%2Fmodule_utils%2Fbasic.py",
                "raw_url": "https://github.com/ansible/ansible/raw/8a87e1c5d37422bc99d27ad4237d185cc233e035/lib%2Fansible%2Fmodule_utils%2Fbasic.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Fmodule_utils%2Fbasic.py?ref=8a87e1c5d37422bc99d27ad4237d185cc233e035",
                "patch": "@@ -1489,7 +1489,19 @@ def _return_formatted(self, kwargs):\n         if deprecations:\n             kwargs['deprecations'] = deprecations\n \n+        # preserve bools/none from no_log\n+        # TODO: once python version on target high enough, dict comprh\n+        preserved = {}\n+        for k, v in kwargs.items():\n+            if v is None or isinstance(v, bool):\n+                preserved[k] = v\n+\n+        # strip no_log collisions\n         kwargs = remove_values(kwargs, self.no_log_values)\n+\n+        # return preserved\n+        kwargs.update(preserved)\n+\n         print('\\n%s' % self.jsonify(kwargs))\n \n     def exit_json(self, **kwargs):"
            },
            {
                "sha": "035228c88261fa9838b28ec4fcd36ad9fb2e3d41",
                "filename": "test/integration/targets/module_no_log/library/module_that_has_secret.py",
                "status": "added",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/ansible/ansible/blob/8a87e1c5d37422bc99d27ad4237d185cc233e035/test%2Fintegration%2Ftargets%2Fmodule_no_log%2Flibrary%2Fmodule_that_has_secret.py",
                "raw_url": "https://github.com/ansible/ansible/raw/8a87e1c5d37422bc99d27ad4237d185cc233e035/test%2Fintegration%2Ftargets%2Fmodule_no_log%2Flibrary%2Fmodule_that_has_secret.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fmodule_no_log%2Flibrary%2Fmodule_that_has_secret.py?ref=8a87e1c5d37422bc99d27ad4237d185cc233e035",
                "patch": "@@ -0,0 +1,19 @@\n+#!/usr/bin/python\n+from __future__ import (absolute_import, division, print_function)\n+__metaclass__ = type\n+\n+from ansible.module_utils.basic import AnsibleModule\n+\n+\n+def main():\n+    module = AnsibleModule(argument_spec=dict(\n+        secret=dict(no_log=True),\n+        notsecret=dict(no_log=False),\n+    ))\n+\n+    msg = \"My secret is: (%s), but don't tell %s\" % (module.params['secret'], module.params['notsecret'])\n+    module.exit_json(msg=msg, changed=bool(module.params['secret'] == module.params['notsecret']))\n+\n+\n+if __name__ == '__main__':\n+    main()"
            },
            {
                "sha": "bf024105f3de1c2514d982e684b309a809598b72",
                "filename": "test/integration/targets/module_no_log/tasks/main.yml",
                "status": "modified",
                "additions": 38,
                "deletions": 0,
                "changes": 38,
                "blob_url": "https://github.com/ansible/ansible/blob/8a87e1c5d37422bc99d27ad4237d185cc233e035/test%2Fintegration%2Ftargets%2Fmodule_no_log%2Ftasks%2Fmain.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/8a87e1c5d37422bc99d27ad4237d185cc233e035/test%2Fintegration%2Ftargets%2Fmodule_no_log%2Ftasks%2Fmain.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fmodule_no_log%2Ftasks%2Fmain.yml?ref=8a87e1c5d37422bc99d27ad4237d185cc233e035",
                "patch": "@@ -59,3 +59,41 @@\n       # 2) the AnsibleModule.log method is not working\n       - good_message in grep.stdout\n       - bad_message not in grep.stdout\n+\n+- name: Ensure we do not obscure what we should not\n+  block:\n+    - module_that_has_secret:\n+        secret: u\n+        notsecret: u\n+      register: ouch\n+      ignore_errors: true\n+\n+    - name: no log wont obscure booleans when True, but still hide in msg\n+      assert:\n+        that:\n+          - ouch['changed'] is boolean\n+          - \"'*' in ouch['msg']\"\n+\n+    - module_that_has_secret:\n+        secret: a\n+        notsecret: b\n+      register: ouch\n+      ignore_errors: true\n+\n+    - name: no log wont obscure booleans when False, but still hide in msg\n+      assert:\n+        that:\n+          - ouch['changed'] is boolean\n+          - \"'*' in ouch['msg']\"\n+\n+    - module_that_has_secret:\n+        secret: True\n+        notsecret: False\n+      register: ouch\n+      ignore_errors: true\n+\n+    - name: no log does not hide bool values\n+      assert:\n+        that:\n+          - ouch['changed'] is boolean\n+          - \"'*' not in ouch['msg']\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/berriai/litellm/commits/ba1912afd1b19e38d3704bb156adf887f91ae1e0",
        "url": "https://api.github.com/repos/BerriAI/litellm/commits/ba1912afd1b19e38d3704bb156adf887f91ae1e0",
        "html_url": "https://github.com/BerriAI/litellm/commit/ba1912afd1b19e38d3704bb156adf887f91ae1e0",
        "message": "add check for is_request_body_safe",
        "files": [
            {
                "sha": "2a111e1ba213cb3d22649e36b7f57dd8e4971d46",
                "filename": "litellm/proxy/auth/auth_checks.py",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/BerriAI/litellm/blob/ba1912afd1b19e38d3704bb156adf887f91ae1e0/litellm%2Fproxy%2Fauth%2Fauth_checks.py",
                "raw_url": "https://github.com/BerriAI/litellm/raw/ba1912afd1b19e38d3704bb156adf887f91ae1e0/litellm%2Fproxy%2Fauth%2Fauth_checks.py",
                "contents_url": "https://api.github.com/repos/BerriAI/litellm/contents/litellm%2Fproxy%2Fauth%2Fauth_checks.py?ref=ba1912afd1b19e38d3704bb156adf887f91ae1e0",
                "patch": "@@ -40,6 +40,22 @@\n all_routes = LiteLLMRoutes.openai_routes.value + LiteLLMRoutes.management_routes.value\n \n \n+def is_request_body_safe(request_body: dict) -> bool:\n+    \"\"\"\n+    Check if the request body is safe.\n+\n+    A malicious user can set the \ufeffapi_base to their own domain and invoke POST /chat/completions to intercept and steal the OpenAI API key.\n+    Relevant issue: https://huntr.com/bounties/4001e1a2-7b7a-4776-a3ae-e6692ec3d997\n+    \"\"\"\n+    banned_params = [\"api_base\", \"base_url\"]\n+\n+    for param in banned_params:\n+        if param in request_body:\n+            raise ValueError(f\"BadRequest: {param} is not allowed in request body\")\n+\n+    return True\n+\n+\n def common_checks(\n     request_body: dict,\n     team_object: Optional[LiteLLM_TeamTable],\n@@ -60,6 +76,7 @@ def common_checks(\n     6. [OPTIONAL] If 'enforce_end_user' enabled - did developer pass in 'user' param for openai endpoints\n     7. [OPTIONAL] If 'litellm.max_budget' is set (>0), is proxy under budget\n     8. [OPTIONAL] If guardrails modified - is request allowed to change this\n+    9. Check if request body is safe\n     \"\"\"\n     _model = request_body.get(\"model\", None)\n     if team_object is not None and team_object.blocked is True:\n@@ -199,6 +216,7 @@ def common_checks(\n                     \"error\": \"Your team does not have permission to modify guardrails.\"\n                 },\n             )\n+    is_request_body_safe(request_body=request_body)\n     return True\n \n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/spring-projects/spring-framework/commits/d86bf8b2056429edf5494456cffcb2b243331c49",
        "url": "https://api.github.com/repos/spring-projects/spring-framework/commits/d86bf8b2056429edf5494456cffcb2b243331c49",
        "html_url": "https://github.com/spring-projects/spring-framework/commit/d86bf8b2056429edf5494456cffcb2b243331c49",
        "message": "Align RouterFunctions resource handling\n\nCloses: gh-33434",
        "files": [
            {
                "sha": "b5ee5b46967834a1a0d252c64e9a06190772266b",
                "filename": "spring-webflux/src/main/java/org/springframework/web/reactive/function/server/PathResourceLookupFunction.java",
                "status": "modified",
                "additions": 93,
                "deletions": 14,
                "changes": 107,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/d86bf8b2056429edf5494456cffcb2b243331c49/spring-webflux%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Freactive%2Ffunction%2Fserver%2FPathResourceLookupFunction.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/d86bf8b2056429edf5494456cffcb2b243331c49/spring-webflux%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Freactive%2Ffunction%2Fserver%2FPathResourceLookupFunction.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-webflux%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Freactive%2Ffunction%2Fserver%2FPathResourceLookupFunction.java?ref=d86bf8b2056429edf5494456cffcb2b243331c49",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2022 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -18,6 +18,7 @@\n \n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.net.URLDecoder;\n import java.nio.charset.StandardCharsets;\n import java.util.function.Function;\n \n@@ -30,6 +31,7 @@\n import org.springframework.util.Assert;\n import org.springframework.util.ResourceUtils;\n import org.springframework.util.StringUtils;\n+import org.springframework.web.util.UriUtils;\n import org.springframework.web.util.pattern.PathPattern;\n import org.springframework.web.util.pattern.PathPatternParser;\n \n@@ -63,13 +65,17 @@ public Mono<Resource> apply(ServerRequest request) {\n \n \t\tpathContainer = this.pattern.extractPathWithinPattern(pathContainer);\n \t\tString path = processPath(pathContainer.value());\n-\t\tif (path.contains(\"%\")) {\n-\t\t\tpath = StringUtils.uriDecode(path, StandardCharsets.UTF_8);\n+\t\tif (!StringUtils.hasText(path) || isInvalidPath(path)) {\n+\t\t\treturn Mono.empty();\n \t\t}\n-\t\tif (!StringUtils.hasLength(path) || isInvalidPath(path)) {\n+\t\tif (isInvalidEncodedInputPath(path)) {\n \t\t\treturn Mono.empty();\n \t\t}\n \n+\t\tif (!(this.location instanceof UrlResource)) {\n+\t\t\tpath = UriUtils.decode(path, StandardCharsets.UTF_8);\n+\t\t}\n+\n \t\ttry {\n \t\t\tResource resource = this.location.createRelative(path);\n \t\t\tif (resource.isReadable() && isResourceUnderLocation(resource)) {\n@@ -84,7 +90,47 @@ public Mono<Resource> apply(ServerRequest request) {\n \t\t}\n \t}\n \n-\tprivate String processPath(String path) {\n+\t/**\n+\t * Process the given resource path.\n+\t * <p>The default implementation replaces:\n+\t * <ul>\n+\t * <li>Backslash with forward slash.\n+\t * <li>Duplicate occurrences of slash with a single slash.\n+\t * <li>Any combination of leading slash and control characters (00-1F and 7F)\n+\t * with a single \"/\" or \"\". For example {@code \"  / // foo/bar\"}\n+\t * becomes {@code \"/foo/bar\"}.\n+\t * </ul>\n+\t */\n+\tprotected String processPath(String path) {\n+\t\tpath = StringUtils.replace(path, \"\\\\\", \"/\");\n+\t\tpath = cleanDuplicateSlashes(path);\n+\t\treturn cleanLeadingSlash(path);\n+\t}\n+\n+\tprivate String cleanDuplicateSlashes(String path) {\n+\t\tStringBuilder sb = null;\n+\t\tchar prev = 0;\n+\t\tfor (int i = 0; i < path.length(); i++) {\n+\t\t\tchar curr = path.charAt(i);\n+\t\t\ttry {\n+\t\t\t\tif (curr == '/' && prev == '/') {\n+\t\t\t\t\tif (sb == null) {\n+\t\t\t\t\t\tsb = new StringBuilder(path.substring(0, i));\n+\t\t\t\t\t}\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (sb != null) {\n+\t\t\t\t\tsb.append(path.charAt(i));\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tfinally {\n+\t\t\t\tprev = curr;\n+\t\t\t}\n+\t\t}\n+\t\treturn (sb != null ? sb.toString() : path);\n+\t}\n+\n+\tprivate String cleanLeadingSlash(String path) {\n \t\tboolean slash = false;\n \t\tfor (int i = 0; i < path.length(); i++) {\n \t\t\tif (path.charAt(i) == '/') {\n@@ -94,8 +140,7 @@ else if (path.charAt(i) > ' ' && path.charAt(i) != 127) {\n \t\t\t\tif (i == 0 || (i == 1 && slash)) {\n \t\t\t\t\treturn path;\n \t\t\t\t}\n-\t\t\t\tpath = slash ? \"/\" + path.substring(i) : path.substring(i);\n-\t\t\t\treturn path;\n+\t\t\t\treturn (slash ? \"/\" + path.substring(i) : path.substring(i));\n \t\t\t}\n \t\t}\n \t\treturn (slash ? \"/\" : \"\");\n@@ -117,6 +162,31 @@ private boolean isInvalidPath(String path) {\n \t\treturn false;\n \t}\n \n+\t/**\n+\t * Check whether the given path contains invalid escape sequences.\n+\t * @param path the path to validate\n+\t * @return {@code true} if the path is invalid, {@code false} otherwise\n+\t */\n+\tprivate boolean isInvalidEncodedInputPath(String path) {\n+\t\tif (path.contains(\"%\")) {\n+\t\t\ttry {\n+\t\t\t\t// Use URLDecoder (vs UriUtils) to preserve potentially decoded UTF-8 chars\n+\t\t\t\tString decodedPath = URLDecoder.decode(path, StandardCharsets.UTF_8);\n+\t\t\t\tif (isInvalidPath(decodedPath)) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\t\t\t\tdecodedPath = processPath(decodedPath);\n+\t\t\t\tif (isInvalidPath(decodedPath)) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tcatch (IllegalArgumentException ex) {\n+\t\t\t\t// May not be possible to decode...\n+\t\t\t}\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n \tprivate boolean isResourceUnderLocation(Resource resource) throws IOException {\n \t\tif (resource.getClass() != this.location.getClass()) {\n \t\t\treturn false;\n@@ -142,15 +212,24 @@ else if (resource instanceof ClassPathResource classPathResource) {\n \t\t\treturn true;\n \t\t}\n \t\tlocationPath = (locationPath.endsWith(\"/\") || locationPath.isEmpty() ? locationPath : locationPath + \"/\");\n-\t\tif (!resourcePath.startsWith(locationPath)) {\n-\t\t\treturn false;\n-\t\t}\n-\t\tif (resourcePath.contains(\"%\") && StringUtils.uriDecode(resourcePath, StandardCharsets.UTF_8).contains(\"../\")) {\n-\t\t\treturn false;\n-\t\t}\n-\t\treturn true;\n+\t\treturn (resourcePath.startsWith(locationPath) && !isInvalidEncodedInputPath(resourcePath));\n \t}\n \n+\tprivate boolean isInvalidEncodedResourcePath(String resourcePath) {\n+\t\tif (resourcePath.contains(\"%\")) {\n+\t\t\t// Use URLDecoder (vs UriUtils) to preserve potentially decoded UTF-8 chars...\n+\t\t\ttry {\n+\t\t\t\tString decodedPath = URLDecoder.decode(resourcePath, StandardCharsets.UTF_8);\n+\t\t\t\tif (decodedPath.contains(\"../\") || decodedPath.contains(\"..\\\\\")) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tcatch (IllegalArgumentException ex) {\n+\t\t\t\t// May not be possible to decode...\n+\t\t\t}\n+\t\t}\n+\t\treturn false;\n+\t}\n \n \t@Override\n \tpublic String toString() {"
            },
            {
                "sha": "e9c700f10f75ef4b2af24c853c830f476db7ebb6",
                "filename": "spring-webmvc/src/main/java/org/springframework/web/servlet/function/PathResourceLookupFunction.java",
                "status": "modified",
                "additions": 93,
                "deletions": 11,
                "changes": 104,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/d86bf8b2056429edf5494456cffcb2b243331c49/spring-webmvc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fservlet%2Ffunction%2FPathResourceLookupFunction.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/d86bf8b2056429edf5494456cffcb2b243331c49/spring-webmvc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fservlet%2Ffunction%2FPathResourceLookupFunction.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-webmvc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fweb%2Fservlet%2Ffunction%2FPathResourceLookupFunction.java?ref=d86bf8b2056429edf5494456cffcb2b243331c49",
                "patch": "@@ -18,6 +18,7 @@\n \n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.net.URLDecoder;\n import java.nio.charset.StandardCharsets;\n import java.util.Optional;\n import java.util.function.Function;\n@@ -29,13 +30,16 @@\n import org.springframework.util.Assert;\n import org.springframework.util.ResourceUtils;\n import org.springframework.util.StringUtils;\n+import org.springframework.web.context.support.ServletContextResource;\n+import org.springframework.web.util.UriUtils;\n import org.springframework.web.util.pattern.PathPattern;\n import org.springframework.web.util.pattern.PathPatternParser;\n \n /**\n  * Lookup function used by {@link RouterFunctions#resources(String, Resource)}.\n  *\n  * @author Arjen Poutsma\n+ * @author Rossen Stoyanchev\n  * @since 5.2\n  */\n class PathResourceLookupFunction implements Function<ServerRequest, Optional<Resource>> {\n@@ -62,13 +66,17 @@ public Optional<Resource> apply(ServerRequest request) {\n \n \t\tpathContainer = this.pattern.extractPathWithinPattern(pathContainer);\n \t\tString path = processPath(pathContainer.value());\n-\t\tif (path.contains(\"%\")) {\n-\t\t\tpath = StringUtils.uriDecode(path, StandardCharsets.UTF_8);\n+\t\tif (!StringUtils.hasText(path) || isInvalidPath(path)) {\n+\t\t\treturn Optional.empty();\n \t\t}\n-\t\tif (!StringUtils.hasLength(path) || isInvalidPath(path)) {\n+\t\tif (isInvalidEncodedInputPath(path)) {\n \t\t\treturn Optional.empty();\n \t\t}\n \n+\t\tif (!(this.location instanceof UrlResource)) {\n+\t\t\tpath = UriUtils.decode(path, StandardCharsets.UTF_8);\n+\t\t}\n+\n \t\ttry {\n \t\t\tResource resource = this.location.createRelative(path);\n \t\t\tif (resource.isReadable() && isResourceUnderLocation(resource)) {\n@@ -83,7 +91,47 @@ public Optional<Resource> apply(ServerRequest request) {\n \t\t}\n \t}\n \n-\tprivate String processPath(String path) {\n+\t/**\n+\t * Process the given resource path.\n+\t * <p>The default implementation replaces:\n+\t * <ul>\n+\t * <li>Backslash with forward slash.\n+\t * <li>Duplicate occurrences of slash with a single slash.\n+\t * <li>Any combination of leading slash and control characters (00-1F and 7F)\n+\t * with a single \"/\" or \"\". For example {@code \"  / // foo/bar\"}\n+\t * becomes {@code \"/foo/bar\"}.\n+\t * </ul>\n+\t */\n+\tprotected String processPath(String path) {\n+\t\tpath = StringUtils.replace(path, \"\\\\\", \"/\");\n+\t\tpath = cleanDuplicateSlashes(path);\n+\t\treturn cleanLeadingSlash(path);\n+\t}\n+\n+\tprivate String cleanDuplicateSlashes(String path) {\n+\t\tStringBuilder sb = null;\n+\t\tchar prev = 0;\n+\t\tfor (int i = 0; i < path.length(); i++) {\n+\t\t\tchar curr = path.charAt(i);\n+\t\t\ttry {\n+\t\t\t\tif ((curr == '/') && (prev == '/')) {\n+\t\t\t\t\tif (sb == null) {\n+\t\t\t\t\t\tsb = new StringBuilder(path.substring(0, i));\n+\t\t\t\t\t}\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\tif (sb != null) {\n+\t\t\t\t\tsb.append(path.charAt(i));\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tfinally {\n+\t\t\t\tprev = curr;\n+\t\t\t}\n+\t\t}\n+\t\treturn sb != null ? sb.toString() : path;\n+\t}\n+\n+\tprivate String cleanLeadingSlash(String path) {\n \t\tboolean slash = false;\n \t\tfor (int i = 0; i < path.length(); i++) {\n \t\t\tif (path.charAt(i) == '/') {\n@@ -93,8 +141,7 @@ else if (path.charAt(i) > ' ' && path.charAt(i) != 127) {\n \t\t\t\tif (i == 0 || (i == 1 && slash)) {\n \t\t\t\t\treturn path;\n \t\t\t\t}\n-\t\t\t\tpath = slash ? \"/\" + path.substring(i) : path.substring(i);\n-\t\t\t\treturn path;\n+\t\t\t\treturn (slash ? \"/\" + path.substring(i) : path.substring(i));\n \t\t\t}\n \t\t}\n \t\treturn (slash ? \"/\" : \"\");\n@@ -113,6 +160,26 @@ private boolean isInvalidPath(String path) {\n \t\treturn path.contains(\"..\") && StringUtils.cleanPath(path).contains(\"../\");\n \t}\n \n+\tprivate boolean isInvalidEncodedInputPath(String path) {\n+\t\tif (path.contains(\"%\")) {\n+\t\t\ttry {\n+\t\t\t\t// Use URLDecoder (vs UriUtils) to preserve potentially decoded UTF-8 chars\n+\t\t\t\tString decodedPath = URLDecoder.decode(path, StandardCharsets.UTF_8);\n+\t\t\t\tif (isInvalidPath(decodedPath)) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\t\t\t\tdecodedPath = processPath(decodedPath);\n+\t\t\t\tif (isInvalidPath(decodedPath)) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tcatch (IllegalArgumentException ex) {\n+\t\t\t\t// May not be possible to decode...\n+\t\t\t}\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n \tprivate boolean isResourceUnderLocation(Resource resource) throws IOException {\n \t\tif (resource.getClass() != this.location.getClass()) {\n \t\t\treturn false;\n@@ -129,6 +196,10 @@ else if (resource instanceof ClassPathResource classPathResource) {\n \t\t\tresourcePath = classPathResource.getPath();\n \t\t\tlocationPath = StringUtils.cleanPath(((ClassPathResource) this.location).getPath());\n \t\t}\n+\t\telse if (resource instanceof ServletContextResource servletContextResource) {\n+\t\t\tresourcePath = servletContextResource.getPath();\n+\t\t\tlocationPath = StringUtils.cleanPath(((ServletContextResource) this.location).getPath());\n+\t\t}\n \t\telse {\n \t\t\tresourcePath = resource.getURL().getPath();\n \t\t\tlocationPath = StringUtils.cleanPath(this.location.getURL().getPath());\n@@ -138,13 +209,24 @@ else if (resource instanceof ClassPathResource classPathResource) {\n \t\t\treturn true;\n \t\t}\n \t\tlocationPath = (locationPath.endsWith(\"/\") || locationPath.isEmpty() ? locationPath : locationPath + \"/\");\n-\t\tif (!resourcePath.startsWith(locationPath)) {\n-\t\t\treturn false;\n-\t\t}\n-\t\treturn !resourcePath.contains(\"%\") ||\n-\t\t\t\t!StringUtils.uriDecode(resourcePath, StandardCharsets.UTF_8).contains(\"../\");\n+\t\treturn (resourcePath.startsWith(locationPath) && !isInvalidEncodedResourcePath(resourcePath));\n \t}\n \n+\tprivate boolean isInvalidEncodedResourcePath(String resourcePath) {\n+\t\tif (resourcePath.contains(\"%\")) {\n+\t\t\t// Use URLDecoder (vs UriUtils) to preserve potentially decoded UTF-8 chars...\n+\t\t\ttry {\n+\t\t\t\tString decodedPath = URLDecoder.decode(resourcePath, StandardCharsets.UTF_8);\n+\t\t\t\tif (decodedPath.contains(\"../\") || decodedPath.contains(\"..\\\\\")) {\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tcatch (IllegalArgumentException ex) {\n+\t\t\t\t// May not be possible to decode...\n+\t\t\t}\n+\t\t}\n+\t\treturn false;\n+\t}\n \n \t@Override\n \tpublic String toString() {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Secreto31126/whatsapp-api-js/commits/56620c65126427496a94d176082fbd8393a95b6d",
        "url": "https://api.github.com/repos/Secreto31126/whatsapp-api-js/commits/56620c65126427496a94d176082fbd8393a95b6d",
        "html_url": "https://github.com/Secreto31126/whatsapp-api-js/commit/56620c65126427496a94d176082fbd8393a95b6d",
        "message": "Merge pull request #371 from felixarjuna/fix-verify-signature-double-negation\n\nFix verify signature double negation",
        "files": [
            {
                "sha": "8300e141a82d0d4c51197cbbba3dcb4d266ef71a",
                "filename": "src/index.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Secreto31126/whatsapp-api-js/blob/56620c65126427496a94d176082fbd8393a95b6d/src%2Findex.ts",
                "raw_url": "https://github.com/Secreto31126/whatsapp-api-js/raw/56620c65126427496a94d176082fbd8393a95b6d/src%2Findex.ts",
                "contents_url": "https://api.github.com/repos/Secreto31126/whatsapp-api-js/contents/src%2Findex.ts?ref=56620c65126427496a94d176082fbd8393a95b6d",
                "patch": "@@ -976,7 +976,7 @@ export class WhatsAppAPI<EmittersReturnType = void> {\n             .map((b) => b.toString(16).padStart(2, \"0\"))\n             .join(\"\");\n \n-        return signature !== check;\n+        return signature === check;\n     }\n \n     /**"
            },
            {
                "sha": "7faa1bb691ccb83e58eda7b5e6ff63afad0b14ec",
                "filename": "test/index.test.cjs",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/Secreto31126/whatsapp-api-js/blob/56620c65126427496a94d176082fbd8393a95b6d/test%2Findex.test.cjs",
                "raw_url": "https://github.com/Secreto31126/whatsapp-api-js/raw/56620c65126427496a94d176082fbd8393a95b6d/test%2Findex.test.cjs",
                "contents_url": "https://api.github.com/repos/Secreto31126/whatsapp-api-js/contents/test%2Findex.test.cjs?ref=56620c65126427496a94d176082fbd8393a95b6d",
                "patch": "@@ -1629,7 +1629,11 @@ describe(\"WhatsAppAPI\", function () {\n \n                     it(\"should throw 401 if the signature doesn't match the hash\", async function () {\n                         await rejects(\n-                            Whatsapp.post(valid_message_mock, body, \"wrong\"),\n+                            Whatsapp.post(\n+                                valid_message_mock,\n+                                body,\n+                                \"sha256=wrong\"\n+                            ),\n                             threw(401)\n                         );\n                     });"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/discourse/discourse-calendar/commits/81e1c8e3c4c02276fb890da7e3f684259aeb685c",
        "url": "https://api.github.com/repos/discourse/discourse-calendar/commits/81e1c8e3c4c02276fb890da7e3f684259aeb685c",
        "html_url": "https://github.com/discourse/discourse-calendar/commit/81e1c8e3c4c02276fb890da7e3f684259aeb685c",
        "message": "SECURITY: Fix XSS in calendar event name (#607)\n\nWe need to sanitize event names to prevent XSS from occurring in events.",
        "files": [
            {
                "sha": "c682b38f7da1270ca160b4d2759aaa0e2628c2db",
                "filename": "assets/javascripts/discourse/initializers/discourse-calendar.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/discourse/discourse-calendar/blob/81e1c8e3c4c02276fb890da7e3f684259aeb685c/assets%2Fjavascripts%2Fdiscourse%2Finitializers%2Fdiscourse-calendar.js",
                "raw_url": "https://github.com/discourse/discourse-calendar/raw/81e1c8e3c4c02276fb890da7e3f684259aeb685c/assets%2Fjavascripts%2Fdiscourse%2Finitializers%2Fdiscourse-calendar.js",
                "contents_url": "https://api.github.com/repos/discourse/discourse-calendar/contents/assets%2Fjavascripts%2Fdiscourse%2Finitializers%2Fdiscourse-calendar.js?ref=81e1c8e3c4c02276fb890da7e3f684259aeb685c",
                "patch": "@@ -1,5 +1,6 @@\n import { isPresent } from \"@ember/utils\";\n import $ from \"jquery\";\n+import { escape } from \"pretty-text/sanitizer\";\n import { Promise } from \"rsvp\";\n import { ajax } from \"discourse/lib/ajax\";\n import loadScript from \"discourse/lib/load-script\";\n@@ -581,7 +582,7 @@ function initializeDiscourseCalendar(api) {\n     if (detail.message.length > 100) {\n       popupText += \"\u2026\";\n     }\n-    event.extendedProps.htmlContent = popupText;\n+    event.extendedProps.htmlContent = escape(popupText);\n     event.title = event.title.replace(/<img[^>]*>/g, \"\");\n     calendar.addEvent(event);\n   }"
            },
            {
                "sha": "515a377f319076b0418c9761b668375d0cd679bb",
                "filename": "assets/javascripts/discourse/lib/full-calendar-default-options.js",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/discourse/discourse-calendar/blob/81e1c8e3c4c02276fb890da7e3f684259aeb685c/assets%2Fjavascripts%2Fdiscourse%2Flib%2Ffull-calendar-default-options.js",
                "raw_url": "https://github.com/discourse/discourse-calendar/raw/81e1c8e3c4c02276fb890da7e3f684259aeb685c/assets%2Fjavascripts%2Fdiscourse%2Flib%2Ffull-calendar-default-options.js",
                "contents_url": "https://api.github.com/repos/discourse/discourse-calendar/contents/assets%2Fjavascripts%2Fdiscourse%2Flib%2Ffull-calendar-default-options.js?ref=81e1c8e3c4c02276fb890da7e3f684259aeb685c",
                "patch": "@@ -1,3 +1,4 @@\n+import { escape } from \"pretty-text/sanitizer\";\n import {\n   getCalendarButtonsText,\n   getCurrentBcp47Locale,\n@@ -13,7 +14,8 @@ export default function fullCalendarDefaultOptions() {\n     buttonText: getCalendarButtonsText(),\n     eventMouseEnter: function ({ event, jsEvent }) {\n       destroyPopover();\n-      const htmlContent = event.title;\n+\n+      const htmlContent = escape(event.title);\n       buildPopover(jsEvent, htmlContent);\n     },\n     eventMouseLeave: function () {"
            },
            {
                "sha": "22a7ecbae1e472bad222307c229ca0743b4bc2b7",
                "filename": "plugin.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/discourse/discourse-calendar/blob/81e1c8e3c4c02276fb890da7e3f684259aeb685c/plugin.rb",
                "raw_url": "https://github.com/discourse/discourse-calendar/raw/81e1c8e3c4c02276fb890da7e3f684259aeb685c/plugin.rb",
                "contents_url": "https://api.github.com/repos/discourse/discourse-calendar/contents/plugin.rb?ref=81e1c8e3c4c02276fb890da7e3f684259aeb685c",
                "patch": "@@ -3,7 +3,7 @@\n # name: discourse-calendar\n # about: Adds the ability to create a dynamic calendar with events in a topic.\n # meta_topic_id: 97376\n-# version: 0.4\n+# version: 0.5\n # author: Daniel Waterworth, Joffrey Jaffeux\n # url: https://github.com/discourse/discourse-calendar\n "
            },
            {
                "sha": "092422194d88072a02663cac33fcd6f3cdfcb93b",
                "filename": "test/javascripts/acceptance/category-events-calendar-test.js",
                "status": "modified",
                "additions": 35,
                "deletions": 1,
                "changes": 36,
                "blob_url": "https://github.com/discourse/discourse-calendar/blob/81e1c8e3c4c02276fb890da7e3f684259aeb685c/test%2Fjavascripts%2Facceptance%2Fcategory-events-calendar-test.js",
                "raw_url": "https://github.com/discourse/discourse-calendar/raw/81e1c8e3c4c02276fb890da7e3f684259aeb685c/test%2Fjavascripts%2Facceptance%2Fcategory-events-calendar-test.js",
                "contents_url": "https://api.github.com/repos/discourse/discourse-calendar/contents/test%2Fjavascripts%2Facceptance%2Fcategory-events-calendar-test.js?ref=81e1c8e3c4c02276fb890da7e3f684259aeb685c",
                "patch": "@@ -74,17 +74,51 @@ acceptance(\"Discourse Calendar - Category Events Calendar\", function (needs) {\n             },\n             name: \"Awesome Event 2\",\n           },\n+          {\n+            id: 67502,\n+            starts_at: moment()\n+              .tz(\"Asia/Calcutta\")\n+              .add(2, \"days\")\n+              .format(\"YYYY-MM-DDT15:14:00.000Z\"),\n+            ends_at: moment()\n+              .tz(\"Asia/Calcutta\")\n+              .add(2, \"days\")\n+              .format(\"YYYY-MM-DDT16:14:00.000Z\"),\n+            timezone: \"Asia/Calcutta\",\n+            post: {\n+              id: 67502,\n+              post_number: 1,\n+              url: \"/t/this-is-an-event/18451/1\",\n+              topic: {\n+                id: 18451,\n+                title: \"This is an event\",\n+                category_slug: \"awesome-category\",\n+              },\n+            },\n+            name: \"Awesome Event 3<script>alert('my awesome event');</script>\",\n+          },\n         ],\n       });\n     });\n   });\n \n+  test(\"event name is escaped correctly\", async (assert) => {\n+    await visit(\"/c/bug/1\");\n+\n+    assert\n+      .dom(\".fc-event[href='/t/-/18451/1'] .fc-title\")\n+      .hasText(\n+        \"Awesome Event 3<script>alert('my awesome event');</script>\",\n+        \"Elements should be escaped and appear as text rather than be the actual element.\"\n+      );\n+  });\n+\n   test(\"events display the color configured in the map_events_to_color site setting\", async (assert) => {\n     await visit(\"/c/bug/1\");\n \n     assert\n       .dom(\".fc-event\")\n-      .exists({ count: 2 }, \"One event is displayed on the calendar\");\n+      .exists({ count: 3 }, \"One event is displayed on the calendar\");\n \n     assert.dom(\".fc-event[href='/t/-/18449/1']\").hasStyle({\n       \"background-color\": \"rgb(231, 76, 60)\","
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/espressif/esp-now/commits/4e30db50d541b2909d278ef0db05de1a3d7190ef",
        "url": "https://api.github.com/repos/espressif/esp-now/commits/4e30db50d541b2909d278ef0db05de1a3d7190ef",
        "html_url": "https://github.com/espressif/esp-now/commit/4e30db50d541b2909d278ef0db05de1a3d7190ef",
        "message": "Storage cleartext and ciphertext use separated caches",
        "files": [
            {
                "sha": "362509688844ee3c3224dabd4954ab2b9e238eb8",
                "filename": "src/espnow/src/espnow.c",
                "status": "modified",
                "additions": 23,
                "deletions": 8,
                "changes": 31,
                "blob_url": "https://github.com/espressif/esp-now/blob/4e30db50d541b2909d278ef0db05de1a3d7190ef/src%2Fespnow%2Fsrc%2Fespnow.c",
                "raw_url": "https://github.com/espressif/esp-now/raw/4e30db50d541b2909d278ef0db05de1a3d7190ef/src%2Fespnow%2Fsrc%2Fespnow.c",
                "contents_url": "https://api.github.com/repos/espressif/esp-now/contents/src%2Fespnow%2Fsrc%2Fespnow.c?ref=4e30db50d541b2909d278ef0db05de1a3d7190ef",
                "patch": "@@ -124,7 +124,7 @@ static uint32_t g_buffered_num;\n static struct {\n     uint8_t type;\n     uint16_t magic;\n-} __attribute__((packed)) g_msg_magic_cache[ESPNOW_MSG_CACHE] = {0};\n+} __attribute__((packed)) g_msg_magic_cache[ESPNOW_MSG_CACHE] = {0}, g_msg_magic_sec_cache[ESPNOW_MSG_CACHE] = {0};\n \n static espnow_addr_t ESPNOW_ADDR_SELF       = {0};\n const espnow_addr_t ESPNOW_ADDR_NONE        = {0};\n@@ -250,11 +250,21 @@ void espnow_recv_cb(const uint8_t *addr, const uint8_t *data, int size)\n         }\n     }\n \n-    for (size_t i = 0, index = g_msg_magic_cache_next; i < ESPNOW_MSG_CACHE;\n-            i++, index = (g_msg_magic_cache_next + i) % ESPNOW_MSG_CACHE) {\n-        if (g_msg_magic_cache[index].type == espnow_data->type\n-                && g_msg_magic_cache[index].magic == frame_head->magic) {\n-            return ;\n+    if (!frame_head->security) {\n+        for (size_t i = 0, index = g_msg_magic_cache_next; i < ESPNOW_MSG_CACHE;\n+                i++, index = (g_msg_magic_cache_next + i) % ESPNOW_MSG_CACHE) {\n+            if (g_msg_magic_cache[index].type == espnow_data->type\n+                    && g_msg_magic_cache[index].magic == frame_head->magic) {\n+                return ;\n+            }\n+        }\n+    } else {\n+        for (size_t i = 0, index = g_msg_magic_cache_next; i < ESPNOW_MSG_CACHE;\n+                i++, index = (g_msg_magic_cache_next + i) % ESPNOW_MSG_CACHE) {\n+            if (g_msg_magic_sec_cache[index].type == espnow_data->type\n+                    && g_msg_magic_sec_cache[index].magic == frame_head->magic) {\n+                return ;\n+            }\n         }\n     }\n #if CONFIG_IDF_TARGET_ESP32C6\n@@ -374,8 +384,13 @@ void espnow_recv_cb(const uint8_t *addr, const uint8_t *data, int size)\n \n EXIT:\n     g_msg_magic_cache_next = (g_msg_magic_cache_next + 1) % ESPNOW_MSG_CACHE;\n-    g_msg_magic_cache[g_msg_magic_cache_next].type  = espnow_data->type;\n-    g_msg_magic_cache[g_msg_magic_cache_next].magic = frame_head->magic;\n+    if (!frame_head->security) {\n+        g_msg_magic_cache[g_msg_magic_cache_next].type  = espnow_data->type;\n+        g_msg_magic_cache[g_msg_magic_cache_next].magic = frame_head->magic;\n+    } else {\n+        g_msg_magic_sec_cache[g_msg_magic_cache_next].type  = espnow_data->type;\n+        g_msg_magic_sec_cache[g_msg_magic_cache_next].magic = frame_head->magic;\n+    }\n }\n \n /**< callback function of sending ESPNOW data */"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/espressif/esp-now/commits/b03a1b4593713fa4bf0038a87edca01f10114a7a",
        "url": "https://api.github.com/repos/espressif/esp-now/commits/b03a1b4593713fa4bf0038a87edca01f10114a7a",
        "html_url": "https://github.com/espressif/esp-now/commit/b03a1b4593713fa4bf0038a87edca01f10114a7a",
        "message": "fix: The size of the data must be match with addr number for group type message",
        "files": [
            {
                "sha": "6f36777340bb6eee647a0a260668219611989487",
                "filename": "src/espnow/src/espnow.c",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/espressif/esp-now/blob/b03a1b4593713fa4bf0038a87edca01f10114a7a/src%2Fespnow%2Fsrc%2Fespnow.c",
                "raw_url": "https://github.com/espressif/esp-now/raw/b03a1b4593713fa4bf0038a87edca01f10114a7a/src%2Fespnow%2Fsrc%2Fespnow.c",
                "contents_url": "https://api.github.com/repos/espressif/esp-now/contents/src%2Fespnow%2Fsrc%2Fespnow.c?ref=b03a1b4593713fa4bf0038a87edca01f10114a7a",
                "patch": "@@ -302,12 +302,17 @@ void espnow_recv_cb(const uint8_t *addr, const uint8_t *data, int size)\n \n         ESP_LOGD(TAG, \">1.2< group_id: \" MACSTR \", dest_addr: \" MACSTR,\n                  MAC2STR(group_info->group_id), MAC2STR(espnow_data->dest_addr));\n-        ESP_LOGD(TAG, \">1.2< addr_mun: %d, dest_addr: \" MACSTR, group_info->addrs_num,\n+        ESP_LOGD(TAG, \">1.2< addrs_num: %d, dest_addr: \" MACSTR, group_info->addrs_num,\n                  MAC2STR(group_info->addrs_list[0]));\n \n         if (group_info->addrs_num == 1 && ESPNOW_ADDR_IS_BROADCAST(group_info->addrs_list[0])) {\n             set_group_flag = true;\n         } else {\n+            if (espnow_data->size < (sizeof(espnow_group_info_t) + group_info->addrs_num * ESPNOW_ADDR_LEN)) {\n+                ESP_LOGD(TAG, \"[%s, %d] The size %d of the data must match with total size for addrs_num: %d\", __func__, __LINE__, espnow_data->size, group_info->addrs_num);\n+                return;\n+            }\n+\n             for (size_t i = 0; i < group_info->addrs_num; i++) {\n                 if (ESPNOW_ADDR_IS_SELF(group_info->addrs_list[i])) {\n                     set_group_flag = true;\n@@ -735,13 +740,13 @@ esp_err_t espnow_set_group(const uint8_t addrs_list[][ESPNOW_ADDR_LEN], size_t a\n     }\n \n     group_info->type = type;\n-    group_info->addrs_num = addrs_num;\n     memcpy(group_info->group_id, group_id, ESPNOW_ADDR_LEN);\n \n     for (int i = 0; addrs_num > 0; ++i) {\n         size_t send_addrs_num = (addrs_num > 32) ? 32 : addrs_num;\n         addrs_num -= send_addrs_num;\n         espnow_data->size = sizeof(espnow_group_info_t) + send_addrs_num * ESPNOW_ADDR_LEN;\n+        group_info->addrs_num = send_addrs_num;\n         memcpy(group_info->addrs_list, addrs_list + i * 32, send_addrs_num * ESPNOW_ADDR_LEN);\n         frame_head->magic += i;\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "html_url": "https://github.com/mindsdb/mindsdb/commit/11a4db792ad36cf704f7307c7602128b17752c80",
        "message": "Replace eval with literal_eval (#9533)",
        "files": [
            {
                "sha": "3267797beb9b3eb3befb0788581a7984e547614c",
                "filename": "mindsdb/integrations/handlers/chromadb_handler/chromadb_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n import sys\n from typing import List, Optional\n \n@@ -329,7 +330,7 @@ def insert(self, table_name: str, data: pd.DataFrame):\n         # ensure metadata is a dict, convert to dict if it is a string\n         if data.get(TableField.METADATA.value) is not None:\n             data[TableField.METADATA.value] = data[TableField.METADATA.value].apply(\n-                lambda x: x if isinstance(x, dict) else eval(x)\n+                lambda x: x if isinstance(x, dict) else ast.literal_eval(x)\n             )\n \n         # convert to dict"
            },
            {
                "sha": "4651b4e8db07d2e94117cbc3c168c94e90adde7d",
                "filename": "mindsdb/integrations/handlers/sharepoint_handler/sharepoint_api.py",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime, timezone\n from typing import Text, List, Dict, Any\n \n@@ -249,10 +250,10 @@ def create_a_list(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/\"\n         payload = {}\n         if column:\n-            column = eval(column)\n+            column = ast.literal_eval(column)\n             payload[\"column\"] = column\n         payload[\"displayName\"] = display_name\n-        payload[\"list\"] = eval(list_template)\n+        payload[\"list\"] = ast.literal_eval(list_template)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)\n \n     def get_site_columns_by_site(\n@@ -410,7 +411,7 @@ def create_a_site_column(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/columns/\"\n         payload = {}\n         if text:\n-            text = eval(text)\n+            text = ast.literal_eval(text)\n             payload[\"text\"] = text\n         payload[\"name\"] = name\n         if enforce_unique_values is not None:\n@@ -574,5 +575,5 @@ def create_an_item(self, site_id: str, list_id: str, fields: str) -> None:\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/{list_id}/items/\"\n         payload = {}\n         if fields:\n-            payload[\"fields\"] = eval(fields)\n+            payload[\"fields\"] = ast.literal_eval(fields)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)"
            },
            {
                "sha": "b57703405999753c8eb42c979399668ae4371d54",
                "filename": "mindsdb/integrations/handlers/weaviate_handler/weaviate_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime\n from typing import List, Optional\n \n@@ -335,7 +336,7 @@ def select(\n             # assuming there would be only one vector based search per query\n             vector_filter = vector_filter[0]\n             near_vector = {\n-                \"vector\": eval(vector_filter.value)\n+                \"vector\": ast.literal_eval(vector_filter.value)\n                 if isinstance(vector_filter.value, str)\n                 else vector_filter.value\n             }"
            },
            {
                "sha": "b8dc8608966089f3bb35757a6fb0a105a93200d8",
                "filename": "mindsdb/integrations/libs/vectordatabase_handler.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -242,7 +242,7 @@ def _dispatch_update(self, query: Update):\n             if k == TableField.EMBEDDINGS.value and isinstance(v, str):\n                 # it could be embeddings in string\n                 try:\n-                    v = eval(v)\n+                    v = ast.literal_eval(v)\n                 except Exception:\n                     pass\n             row[k] = v"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "html_url": "https://github.com/mindsdb/mindsdb/commit/11a4db792ad36cf704f7307c7602128b17752c80",
        "message": "Replace eval with literal_eval (#9533)",
        "files": [
            {
                "sha": "3267797beb9b3eb3befb0788581a7984e547614c",
                "filename": "mindsdb/integrations/handlers/chromadb_handler/chromadb_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n import sys\n from typing import List, Optional\n \n@@ -329,7 +330,7 @@ def insert(self, table_name: str, data: pd.DataFrame):\n         # ensure metadata is a dict, convert to dict if it is a string\n         if data.get(TableField.METADATA.value) is not None:\n             data[TableField.METADATA.value] = data[TableField.METADATA.value].apply(\n-                lambda x: x if isinstance(x, dict) else eval(x)\n+                lambda x: x if isinstance(x, dict) else ast.literal_eval(x)\n             )\n \n         # convert to dict"
            },
            {
                "sha": "4651b4e8db07d2e94117cbc3c168c94e90adde7d",
                "filename": "mindsdb/integrations/handlers/sharepoint_handler/sharepoint_api.py",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime, timezone\n from typing import Text, List, Dict, Any\n \n@@ -249,10 +250,10 @@ def create_a_list(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/\"\n         payload = {}\n         if column:\n-            column = eval(column)\n+            column = ast.literal_eval(column)\n             payload[\"column\"] = column\n         payload[\"displayName\"] = display_name\n-        payload[\"list\"] = eval(list_template)\n+        payload[\"list\"] = ast.literal_eval(list_template)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)\n \n     def get_site_columns_by_site(\n@@ -410,7 +411,7 @@ def create_a_site_column(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/columns/\"\n         payload = {}\n         if text:\n-            text = eval(text)\n+            text = ast.literal_eval(text)\n             payload[\"text\"] = text\n         payload[\"name\"] = name\n         if enforce_unique_values is not None:\n@@ -574,5 +575,5 @@ def create_an_item(self, site_id: str, list_id: str, fields: str) -> None:\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/{list_id}/items/\"\n         payload = {}\n         if fields:\n-            payload[\"fields\"] = eval(fields)\n+            payload[\"fields\"] = ast.literal_eval(fields)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)"
            },
            {
                "sha": "b57703405999753c8eb42c979399668ae4371d54",
                "filename": "mindsdb/integrations/handlers/weaviate_handler/weaviate_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime\n from typing import List, Optional\n \n@@ -335,7 +336,7 @@ def select(\n             # assuming there would be only one vector based search per query\n             vector_filter = vector_filter[0]\n             near_vector = {\n-                \"vector\": eval(vector_filter.value)\n+                \"vector\": ast.literal_eval(vector_filter.value)\n                 if isinstance(vector_filter.value, str)\n                 else vector_filter.value\n             }"
            },
            {
                "sha": "b8dc8608966089f3bb35757a6fb0a105a93200d8",
                "filename": "mindsdb/integrations/libs/vectordatabase_handler.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -242,7 +242,7 @@ def _dispatch_update(self, query: Update):\n             if k == TableField.EMBEDDINGS.value and isinstance(v, str):\n                 # it could be embeddings in string\n                 try:\n-                    v = eval(v)\n+                    v = ast.literal_eval(v)\n                 except Exception:\n                     pass\n             row[k] = v"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "html_url": "https://github.com/mindsdb/mindsdb/commit/11a4db792ad36cf704f7307c7602128b17752c80",
        "message": "Replace eval with literal_eval (#9533)",
        "files": [
            {
                "sha": "3267797beb9b3eb3befb0788581a7984e547614c",
                "filename": "mindsdb/integrations/handlers/chromadb_handler/chromadb_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n import sys\n from typing import List, Optional\n \n@@ -329,7 +330,7 @@ def insert(self, table_name: str, data: pd.DataFrame):\n         # ensure metadata is a dict, convert to dict if it is a string\n         if data.get(TableField.METADATA.value) is not None:\n             data[TableField.METADATA.value] = data[TableField.METADATA.value].apply(\n-                lambda x: x if isinstance(x, dict) else eval(x)\n+                lambda x: x if isinstance(x, dict) else ast.literal_eval(x)\n             )\n \n         # convert to dict"
            },
            {
                "sha": "4651b4e8db07d2e94117cbc3c168c94e90adde7d",
                "filename": "mindsdb/integrations/handlers/sharepoint_handler/sharepoint_api.py",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime, timezone\n from typing import Text, List, Dict, Any\n \n@@ -249,10 +250,10 @@ def create_a_list(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/\"\n         payload = {}\n         if column:\n-            column = eval(column)\n+            column = ast.literal_eval(column)\n             payload[\"column\"] = column\n         payload[\"displayName\"] = display_name\n-        payload[\"list\"] = eval(list_template)\n+        payload[\"list\"] = ast.literal_eval(list_template)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)\n \n     def get_site_columns_by_site(\n@@ -410,7 +411,7 @@ def create_a_site_column(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/columns/\"\n         payload = {}\n         if text:\n-            text = eval(text)\n+            text = ast.literal_eval(text)\n             payload[\"text\"] = text\n         payload[\"name\"] = name\n         if enforce_unique_values is not None:\n@@ -574,5 +575,5 @@ def create_an_item(self, site_id: str, list_id: str, fields: str) -> None:\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/{list_id}/items/\"\n         payload = {}\n         if fields:\n-            payload[\"fields\"] = eval(fields)\n+            payload[\"fields\"] = ast.literal_eval(fields)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)"
            },
            {
                "sha": "b57703405999753c8eb42c979399668ae4371d54",
                "filename": "mindsdb/integrations/handlers/weaviate_handler/weaviate_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime\n from typing import List, Optional\n \n@@ -335,7 +336,7 @@ def select(\n             # assuming there would be only one vector based search per query\n             vector_filter = vector_filter[0]\n             near_vector = {\n-                \"vector\": eval(vector_filter.value)\n+                \"vector\": ast.literal_eval(vector_filter.value)\n                 if isinstance(vector_filter.value, str)\n                 else vector_filter.value\n             }"
            },
            {
                "sha": "b8dc8608966089f3bb35757a6fb0a105a93200d8",
                "filename": "mindsdb/integrations/libs/vectordatabase_handler.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -242,7 +242,7 @@ def _dispatch_update(self, query: Update):\n             if k == TableField.EMBEDDINGS.value and isinstance(v, str):\n                 # it could be embeddings in string\n                 try:\n-                    v = eval(v)\n+                    v = ast.literal_eval(v)\n                 except Exception:\n                     pass\n             row[k] = v"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "html_url": "https://github.com/mindsdb/mindsdb/commit/11a4db792ad36cf704f7307c7602128b17752c80",
        "message": "Replace eval with literal_eval (#9533)",
        "files": [
            {
                "sha": "3267797beb9b3eb3befb0788581a7984e547614c",
                "filename": "mindsdb/integrations/handlers/chromadb_handler/chromadb_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n import sys\n from typing import List, Optional\n \n@@ -329,7 +330,7 @@ def insert(self, table_name: str, data: pd.DataFrame):\n         # ensure metadata is a dict, convert to dict if it is a string\n         if data.get(TableField.METADATA.value) is not None:\n             data[TableField.METADATA.value] = data[TableField.METADATA.value].apply(\n-                lambda x: x if isinstance(x, dict) else eval(x)\n+                lambda x: x if isinstance(x, dict) else ast.literal_eval(x)\n             )\n \n         # convert to dict"
            },
            {
                "sha": "4651b4e8db07d2e94117cbc3c168c94e90adde7d",
                "filename": "mindsdb/integrations/handlers/sharepoint_handler/sharepoint_api.py",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime, timezone\n from typing import Text, List, Dict, Any\n \n@@ -249,10 +250,10 @@ def create_a_list(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/\"\n         payload = {}\n         if column:\n-            column = eval(column)\n+            column = ast.literal_eval(column)\n             payload[\"column\"] = column\n         payload[\"displayName\"] = display_name\n-        payload[\"list\"] = eval(list_template)\n+        payload[\"list\"] = ast.literal_eval(list_template)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)\n \n     def get_site_columns_by_site(\n@@ -410,7 +411,7 @@ def create_a_site_column(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/columns/\"\n         payload = {}\n         if text:\n-            text = eval(text)\n+            text = ast.literal_eval(text)\n             payload[\"text\"] = text\n         payload[\"name\"] = name\n         if enforce_unique_values is not None:\n@@ -574,5 +575,5 @@ def create_an_item(self, site_id: str, list_id: str, fields: str) -> None:\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/{list_id}/items/\"\n         payload = {}\n         if fields:\n-            payload[\"fields\"] = eval(fields)\n+            payload[\"fields\"] = ast.literal_eval(fields)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)"
            },
            {
                "sha": "b57703405999753c8eb42c979399668ae4371d54",
                "filename": "mindsdb/integrations/handlers/weaviate_handler/weaviate_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime\n from typing import List, Optional\n \n@@ -335,7 +336,7 @@ def select(\n             # assuming there would be only one vector based search per query\n             vector_filter = vector_filter[0]\n             near_vector = {\n-                \"vector\": eval(vector_filter.value)\n+                \"vector\": ast.literal_eval(vector_filter.value)\n                 if isinstance(vector_filter.value, str)\n                 else vector_filter.value\n             }"
            },
            {
                "sha": "b8dc8608966089f3bb35757a6fb0a105a93200d8",
                "filename": "mindsdb/integrations/libs/vectordatabase_handler.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -242,7 +242,7 @@ def _dispatch_update(self, query: Update):\n             if k == TableField.EMBEDDINGS.value and isinstance(v, str):\n                 # it could be embeddings in string\n                 try:\n-                    v = eval(v)\n+                    v = ast.literal_eval(v)\n                 except Exception:\n                     pass\n             row[k] = v"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "html_url": "https://github.com/mindsdb/mindsdb/commit/11a4db792ad36cf704f7307c7602128b17752c80",
        "message": "Replace eval with literal_eval (#9533)",
        "files": [
            {
                "sha": "3267797beb9b3eb3befb0788581a7984e547614c",
                "filename": "mindsdb/integrations/handlers/chromadb_handler/chromadb_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n import sys\n from typing import List, Optional\n \n@@ -329,7 +330,7 @@ def insert(self, table_name: str, data: pd.DataFrame):\n         # ensure metadata is a dict, convert to dict if it is a string\n         if data.get(TableField.METADATA.value) is not None:\n             data[TableField.METADATA.value] = data[TableField.METADATA.value].apply(\n-                lambda x: x if isinstance(x, dict) else eval(x)\n+                lambda x: x if isinstance(x, dict) else ast.literal_eval(x)\n             )\n \n         # convert to dict"
            },
            {
                "sha": "4651b4e8db07d2e94117cbc3c168c94e90adde7d",
                "filename": "mindsdb/integrations/handlers/sharepoint_handler/sharepoint_api.py",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime, timezone\n from typing import Text, List, Dict, Any\n \n@@ -249,10 +250,10 @@ def create_a_list(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/\"\n         payload = {}\n         if column:\n-            column = eval(column)\n+            column = ast.literal_eval(column)\n             payload[\"column\"] = column\n         payload[\"displayName\"] = display_name\n-        payload[\"list\"] = eval(list_template)\n+        payload[\"list\"] = ast.literal_eval(list_template)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)\n \n     def get_site_columns_by_site(\n@@ -410,7 +411,7 @@ def create_a_site_column(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/columns/\"\n         payload = {}\n         if text:\n-            text = eval(text)\n+            text = ast.literal_eval(text)\n             payload[\"text\"] = text\n         payload[\"name\"] = name\n         if enforce_unique_values is not None:\n@@ -574,5 +575,5 @@ def create_an_item(self, site_id: str, list_id: str, fields: str) -> None:\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/{list_id}/items/\"\n         payload = {}\n         if fields:\n-            payload[\"fields\"] = eval(fields)\n+            payload[\"fields\"] = ast.literal_eval(fields)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)"
            },
            {
                "sha": "b57703405999753c8eb42c979399668ae4371d54",
                "filename": "mindsdb/integrations/handlers/weaviate_handler/weaviate_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime\n from typing import List, Optional\n \n@@ -335,7 +336,7 @@ def select(\n             # assuming there would be only one vector based search per query\n             vector_filter = vector_filter[0]\n             near_vector = {\n-                \"vector\": eval(vector_filter.value)\n+                \"vector\": ast.literal_eval(vector_filter.value)\n                 if isinstance(vector_filter.value, str)\n                 else vector_filter.value\n             }"
            },
            {
                "sha": "b8dc8608966089f3bb35757a6fb0a105a93200d8",
                "filename": "mindsdb/integrations/libs/vectordatabase_handler.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -242,7 +242,7 @@ def _dispatch_update(self, query: Update):\n             if k == TableField.EMBEDDINGS.value and isinstance(v, str):\n                 # it could be embeddings in string\n                 try:\n-                    v = eval(v)\n+                    v = ast.literal_eval(v)\n                 except Exception:\n                     pass\n             row[k] = v"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "url": "https://api.github.com/repos/mindsdb/mindsdb/commits/11a4db792ad36cf704f7307c7602128b17752c80",
        "html_url": "https://github.com/mindsdb/mindsdb/commit/11a4db792ad36cf704f7307c7602128b17752c80",
        "message": "Replace eval with literal_eval (#9533)",
        "files": [
            {
                "sha": "3267797beb9b3eb3befb0788581a7984e547614c",
                "filename": "mindsdb/integrations/handlers/chromadb_handler/chromadb_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fchromadb_handler%2Fchromadb_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n import sys\n from typing import List, Optional\n \n@@ -329,7 +330,7 @@ def insert(self, table_name: str, data: pd.DataFrame):\n         # ensure metadata is a dict, convert to dict if it is a string\n         if data.get(TableField.METADATA.value) is not None:\n             data[TableField.METADATA.value] = data[TableField.METADATA.value].apply(\n-                lambda x: x if isinstance(x, dict) else eval(x)\n+                lambda x: x if isinstance(x, dict) else ast.literal_eval(x)\n             )\n \n         # convert to dict"
            },
            {
                "sha": "4651b4e8db07d2e94117cbc3c168c94e90adde7d",
                "filename": "mindsdb/integrations/handlers/sharepoint_handler/sharepoint_api.py",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fsharepoint_handler%2Fsharepoint_api.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime, timezone\n from typing import Text, List, Dict, Any\n \n@@ -249,10 +250,10 @@ def create_a_list(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/\"\n         payload = {}\n         if column:\n-            column = eval(column)\n+            column = ast.literal_eval(column)\n             payload[\"column\"] = column\n         payload[\"displayName\"] = display_name\n-        payload[\"list\"] = eval(list_template)\n+        payload[\"list\"] = ast.literal_eval(list_template)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)\n \n     def get_site_columns_by_site(\n@@ -410,7 +411,7 @@ def create_a_site_column(\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/columns/\"\n         payload = {}\n         if text:\n-            text = eval(text)\n+            text = ast.literal_eval(text)\n             payload[\"text\"] = text\n         payload[\"name\"] = name\n         if enforce_unique_values is not None:\n@@ -574,5 +575,5 @@ def create_an_item(self, site_id: str, list_id: str, fields: str) -> None:\n         url = f\"https://graph.microsoft.com/v1.0/sites/{site_id}/lists/{list_id}/items/\"\n         payload = {}\n         if fields:\n-            payload[\"fields\"] = eval(fields)\n+            payload[\"fields\"] = ast.literal_eval(fields)\n         create_an_entity(url=url, payload=payload, bearer_token=self.bearer_token)"
            },
            {
                "sha": "b57703405999753c8eb42c979399668ae4371d54",
                "filename": "mindsdb/integrations/handlers/weaviate_handler/weaviate_handler.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fweaviate_handler%2Fweaviate_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -1,3 +1,4 @@\n+import ast\n from datetime import datetime\n from typing import List, Optional\n \n@@ -335,7 +336,7 @@ def select(\n             # assuming there would be only one vector based search per query\n             vector_filter = vector_filter[0]\n             near_vector = {\n-                \"vector\": eval(vector_filter.value)\n+                \"vector\": ast.literal_eval(vector_filter.value)\n                 if isinstance(vector_filter.value, str)\n                 else vector_filter.value\n             }"
            },
            {
                "sha": "b8dc8608966089f3bb35757a6fb0a105a93200d8",
                "filename": "mindsdb/integrations/libs/vectordatabase_handler.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/11a4db792ad36cf704f7307c7602128b17752c80/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Flibs%2Fvectordatabase_handler.py?ref=11a4db792ad36cf704f7307c7602128b17752c80",
                "patch": "@@ -242,7 +242,7 @@ def _dispatch_update(self, query: Update):\n             if k == TableField.EMBEDDINGS.value and isinstance(v, str):\n                 # it could be embeddings in string\n                 try:\n-                    v = eval(v)\n+                    v = ast.literal_eval(v)\n                 except Exception:\n                     pass\n             row[k] = v"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/eclipse-ee4j/glassfish/commits/06b80012761d07f6e40e40aa6b0133465b0bd145",
        "url": "https://api.github.com/repos/eclipse-ee4j/glassfish/commits/06b80012761d07f6e40e40aa6b0133465b0bd145",
        "html_url": "https://github.com/eclipse-ee4j/glassfish/commit/06b80012761d07f6e40e40aa6b0133465b0bd145",
        "message": "Merge pull request #24655 from arjantijms/form_no_protocol_relative_redirect\n\nAvoid protocol relative redirects",
        "files": [
            {
                "sha": "d8ce327834b17341fcd429412b741db12471e5b9",
                "filename": "appserver/web/web-core/src/main/java/org/apache/catalina/authenticator/FormAuthenticator.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/eclipse-ee4j/glassfish/blob/06b80012761d07f6e40e40aa6b0133465b0bd145/appserver%2Fweb%2Fweb-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FFormAuthenticator.java",
                "raw_url": "https://github.com/eclipse-ee4j/glassfish/raw/06b80012761d07f6e40e40aa6b0133465b0bd145/appserver%2Fweb%2Fweb-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FFormAuthenticator.java",
                "contents_url": "https://api.github.com/repos/eclipse-ee4j/glassfish/contents/appserver%2Fweb%2Fweb-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FFormAuthenticator.java?ref=06b80012761d07f6e40e40aa6b0133465b0bd145",
                "patch": "@@ -532,6 +532,11 @@ protected String savedRequestURL(Session session) {\n             sb.append(saved.getQueryString());\n         }\n \n+        // Avoid protocol relative redirects\n+        while (sb.length() > 1 && sb.charAt(1) == '/') {\n+            sb.deleteCharAt(0);\n+        }\n+\n         return sb.toString();\n     }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/lukeed/dset/commits/16d6154e085bef01e99f01330e5a421a7f098afa",
        "url": "https://api.github.com/repos/lukeed/dset/commits/16d6154e085bef01e99f01330e5a421a7f098afa",
        "html_url": "https://github.com/lukeed/dset/commit/16d6154e085bef01e99f01330e5a421a7f098afa",
        "message": "fix: prevent __proto__ assignment via implicit string",
        "files": [
            {
                "sha": "804654dfb07b33c1d8ad0f763ba3bf9cd07119af",
                "filename": "readme.md",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/lukeed/dset/blob/16d6154e085bef01e99f01330e5a421a7f098afa/readme.md",
                "raw_url": "https://github.com/lukeed/dset/raw/16d6154e085bef01e99f01330e5a421a7f098afa/readme.md",
                "contents_url": "https://api.github.com/repos/lukeed/dset/contents/readme.md?ref=16d6154e085bef01e99f01330e5a421a7f098afa",
                "patch": "@@ -1,6 +1,6 @@\n # dset [![CI](https://github.com/lukeed/dset/workflows/CI/badge.svg?branch=master&event=push)](https://github.com/lukeed/dset/actions) [![codecov](https://badgen.net/codecov/c/github/lukeed/dset)](https://codecov.io/gh/lukeed/dset)\n \n-> A tiny (194B) utility for safely writing deep Object values~!\n+> A tiny (197B) utility for safely writing deep Object values~!\n \n For _accessing_ deep object properties, please see [`dlv`](https://github.com/developit/dlv).\n \n@@ -17,15 +17,15 @@ $ npm install --save dset\n There are two \"versions\" of `dset` available:\n \n #### `dset`\n-> **Size (gzip):** 194 bytes<br>\n+> **Size (gzip):** 197 bytes<br>\n > **Availability:** [CommonJS](https://unpkg.com/dset/dist/index.js), [ES Module](https://unpkg.com/dset/dist/index.mjs), [UMD](https://unpkg.com/dset/dist/index.min.js)\n \n ```js\n import { dset } from 'dset';\n ```\n \n #### `dset/merge`\n-> **Size (gzip):** 288 bytes<br>\n+> **Size (gzip):** 307 bytes<br>\n > **Availability:** [CommonJS](https://unpkg.com/dset/merge/index.js), [ES Module](https://unpkg.com/dset/merge/index.mjs), [UMD](https://unpkg.com/dset/merge/index.min.js)\n \n ```js"
            },
            {
                "sha": "85fd6a720bae064352ce58da0ad97f6c071f6bc1",
                "filename": "src/index.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/lukeed/dset/blob/16d6154e085bef01e99f01330e5a421a7f098afa/src%2Findex.js",
                "raw_url": "https://github.com/lukeed/dset/raw/16d6154e085bef01e99f01330e5a421a7f098afa/src%2Findex.js",
                "contents_url": "https://api.github.com/repos/lukeed/dset/contents/src%2Findex.js?ref=16d6154e085bef01e99f01330e5a421a7f098afa",
                "patch": "@@ -2,7 +2,7 @@ export function dset(obj, keys, val) {\n \tkeys.split && (keys=keys.split('.'));\n \tvar i=0, l=keys.length, t=obj, x, k;\n \twhile (i < l) {\n-\t\tk = keys[i++];\n+\t\tk = ''+keys[i++];\n \t\tif (k === '__proto__' || k === 'constructor' || k === 'prototype') break;\n \t\tt = t[k] = (i === l) ? val : (typeof(x=t[k])===typeof(keys)) ? x : (keys[i]*0 !== 0 || !!~(''+keys[i]).indexOf('.')) ? {} : [];\n \t}"
            },
            {
                "sha": "4b5f0dce6112a58a9fbcd70c8d8e667df8d0a8b6",
                "filename": "src/merge.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/lukeed/dset/blob/16d6154e085bef01e99f01330e5a421a7f098afa/src%2Fmerge.js",
                "raw_url": "https://github.com/lukeed/dset/raw/16d6154e085bef01e99f01330e5a421a7f098afa/src%2Fmerge.js",
                "contents_url": "https://api.github.com/repos/lukeed/dset/contents/src%2Fmerge.js?ref=16d6154e085bef01e99f01330e5a421a7f098afa",
                "patch": "@@ -19,7 +19,7 @@ export function dset(obj, keys, val) {\n \tkeys.split && (keys=keys.split('.'));\n \tvar i=0, l=keys.length, t=obj, x, k;\n \twhile (i < l) {\n-\t\tk = keys[i++];\n+\t\tk = ''+keys[i++];\n \t\tif (k === '__proto__' || k === 'constructor' || k === 'prototype') break;\n \t\tt = t[k] = (i === l) ? merge(t[k],val) : (typeof(x=t[k])===typeof keys) ? x : (keys[i]*0 !== 0 || !!~(''+keys[i]).indexOf('.')) ? {} : [];\n \t}"
            },
            {
                "sha": "8d338edf13640b8be8534b193c957a81cba76e9f",
                "filename": "test/suites/pollution.js",
                "status": "modified",
                "additions": 18,
                "deletions": 1,
                "changes": 19,
                "blob_url": "https://github.com/lukeed/dset/blob/16d6154e085bef01e99f01330e5a421a7f098afa/test%2Fsuites%2Fpollution.js",
                "raw_url": "https://github.com/lukeed/dset/raw/16d6154e085bef01e99f01330e5a421a7f098afa/test%2Fsuites%2Fpollution.js",
                "contents_url": "https://api.github.com/repos/lukeed/dset/contents/test%2Fsuites%2Fpollution.js?ref=16d6154e085bef01e99f01330e5a421a7f098afa",
                "patch": "@@ -38,6 +38,23 @@ export default function (dset) {\n \t\tassert.is(Object.create(null).hello, undefined);\n \t});\n \n+\tpollution('should protect against [\"__proto__\"] assignment :: implicit string', () => {\n+\t\tlet input = { abc: 123 };\n+\t\tlet before = input.__proto__;\n+\n+\t\tdset(input, [['__proto__'], 'polluted'], true);\n+\n+\t\tassert.equal(input.__proto__, before);\n+\t\tassert.equal(input, { abc: 123 });\n+\n+\t\tassert.is({}.polluted, undefined);\n+\t\tassert.is(input.polluted, undefined);\n+\t\tassert.is((new Object).polluted, undefined);\n+\t\tassert.is(Object.create(null).polluted, undefined);\n+\t});\n+\n+\n+\n \tpollution('should ignore \"prototype\" assignment', () => {\n \t\tlet input = { a: 123 };\n \t\tdset(input, 'a.prototype.hello', 'world');\n@@ -85,7 +102,7 @@ export default function (dset) {\n \t\t});\n \t});\n \n-\t// Test for CVE-2022-25645 - CWE-1321 \n+\t// Test for CVE-2022-25645 - CWE-1321\n \tpollution('should ignore JSON.parse crafted object with \"__proto__\" key', () => {\n \t\tlet a = { b: { c: 1 } };\n \t\tassert.is(a.polluted, undefined);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/omniauth/omniauth-saml/commits/4274e9d57e65f2dcaae4aa3b2accf831494f2ddd",
        "url": "https://api.github.com/repos/omniauth/omniauth-saml/commits/4274e9d57e65f2dcaae4aa3b2accf831494f2ddd",
        "html_url": "https://github.com/omniauth/omniauth-saml/commit/4274e9d57e65f2dcaae4aa3b2accf831494f2ddd",
        "message": "feat: new release 2.2.0",
        "files": [
            {
                "sha": "55e582f8a132149363c9e3f863cc4e23b42e7b68",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/omniauth/omniauth-saml/blob/4274e9d57e65f2dcaae4aa3b2accf831494f2ddd/CHANGELOG.md",
                "raw_url": "https://github.com/omniauth/omniauth-saml/raw/4274e9d57e65f2dcaae4aa3b2accf831494f2ddd/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/omniauth/omniauth-saml/contents/CHANGELOG.md?ref=4274e9d57e65f2dcaae4aa3b2accf831494f2ddd",
                "patch": "@@ -1,3 +1,15 @@\n+<a name=\"v2.2.0\"></a>\n+### v2.2.0 (2024-09-10)\n+\n+This release fixes:\n+\n+* [GHSA-jw9c-mfg7-9rx2](https://github.com/SAML-Toolkits/ruby-saml/security/advisories/GHSA-jw9c-mfg7-9rx2)\n+* [GHSA-cvp8-5r8g-fhvq](https://github.com/omniauth/omniauth-saml/security/advisories/GHSA-cvp8-5r8g-fhvq)\n+\n+#### Chores\n+\n+* use semantic versioning for ruby-saml as per gem build hints ([e17f460](/../../commit/e17f460))\n+\n <a name=\"v2.1.1\"></a>\n ### v2.1.1 (2024-09-10)\n "
            },
            {
                "sha": "47ef560f4a7668df5b99a803876946eab5febc03",
                "filename": "lib/omniauth-saml/version.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/omniauth/omniauth-saml/blob/4274e9d57e65f2dcaae4aa3b2accf831494f2ddd/lib%2Fomniauth-saml%2Fversion.rb",
                "raw_url": "https://github.com/omniauth/omniauth-saml/raw/4274e9d57e65f2dcaae4aa3b2accf831494f2ddd/lib%2Fomniauth-saml%2Fversion.rb",
                "contents_url": "https://api.github.com/repos/omniauth/omniauth-saml/contents/lib%2Fomniauth-saml%2Fversion.rb?ref=4274e9d57e65f2dcaae4aa3b2accf831494f2ddd",
                "patch": "@@ -1,5 +1,5 @@\n module OmniAuth\n   module SAML\n-    VERSION = '2.1.1'\n+    VERSION = '2.2.0'\n   end\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/SAML-Toolkits/ruby-saml/commits/1ec5392bc506fe43a02dbb66b68741051c5ffeae",
        "url": "https://api.github.com/repos/SAML-Toolkits/ruby-saml/commits/1ec5392bc506fe43a02dbb66b68741051c5ffeae",
        "html_url": "https://github.com/SAML-Toolkits/ruby-saml/commit/1ec5392bc506fe43a02dbb66b68741051c5ffeae",
        "message": "Release 1.12.3 to include critical vulnerability CVE-2024-45409 fix",
        "files": [
            {
                "sha": "39d9b646159ff481c450e518c1e0e3e02e4e3a48",
                "filename": "changelog.md",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/SAML-Toolkits/ruby-saml/blob/1ec5392bc506fe43a02dbb66b68741051c5ffeae/changelog.md",
                "raw_url": "https://github.com/SAML-Toolkits/ruby-saml/raw/1ec5392bc506fe43a02dbb66b68741051c5ffeae/changelog.md",
                "contents_url": "https://api.github.com/repos/SAML-Toolkits/ruby-saml/contents/changelog.md?ref=1ec5392bc506fe43a02dbb66b68741051c5ffeae",
                "patch": "@@ -1,5 +1,8 @@\n # RubySaml Changelog\n \n+### 1.12.3 (Sep 10, 2024)\n+* Fix for critical vulnerability CVE-2024-45409: SAML authentication bypass via Incorrect XPath selector\n+\n ### 1.12.2 (Apr 08, 2022)\n * [575](https://github.com/onelogin/ruby-saml/pull/575) Fix SloLogoutresponse bug on LogoutRequest\n "
            },
            {
                "sha": "2c4f603aed22b90aece00578e4e76eee601a6ab6",
                "filename": "lib/onelogin/ruby-saml/version.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/SAML-Toolkits/ruby-saml/blob/1ec5392bc506fe43a02dbb66b68741051c5ffeae/lib%2Fonelogin%2Fruby-saml%2Fversion.rb",
                "raw_url": "https://github.com/SAML-Toolkits/ruby-saml/raw/1ec5392bc506fe43a02dbb66b68741051c5ffeae/lib%2Fonelogin%2Fruby-saml%2Fversion.rb",
                "contents_url": "https://api.github.com/repos/SAML-Toolkits/ruby-saml/contents/lib%2Fonelogin%2Fruby-saml%2Fversion.rb?ref=1ec5392bc506fe43a02dbb66b68741051c5ffeae",
                "patch": "@@ -1,5 +1,5 @@\n module OneLogin\n   module RubySaml\n-    VERSION = '1.12.2'\n+    VERSION = '1.12.3'\n   end\n end"
            },
            {
                "sha": "652b8ae60e4179940142b593cbe08ae44e7063ce",
                "filename": "lib/xml_security.rb",
                "status": "modified",
                "additions": 20,
                "deletions": 7,
                "changes": 27,
                "blob_url": "https://github.com/SAML-Toolkits/ruby-saml/blob/1ec5392bc506fe43a02dbb66b68741051c5ffeae/lib%2Fxml_security.rb",
                "raw_url": "https://github.com/SAML-Toolkits/ruby-saml/raw/1ec5392bc506fe43a02dbb66b68741051c5ffeae/lib%2Fxml_security.rb",
                "contents_url": "https://api.github.com/repos/SAML-Toolkits/ruby-saml/contents/lib%2Fxml_security.rb?ref=1ec5392bc506fe43a02dbb66b68741051c5ffeae",
                "patch": "@@ -312,17 +312,30 @@ def validate_signature(base64_cert, soft = true)\n       canon_string = noko_signed_info_element.canonicalize(canon_algorithm)\n       noko_sig_element.remove\n \n+      # get signed info\n+      signed_info_element = REXML::XPath.first(\n+        sig_element,\n+        \"./ds:SignedInfo\",\n+        { \"ds\" => DSIG }\n+      )\n+\n       # get inclusive namespaces\n       inclusive_namespaces = extract_inclusive_namespaces\n \n       # check digests\n-      ref = REXML::XPath.first(sig_element, \"//ds:Reference\", {\"ds\"=>DSIG})\n+      ref = REXML::XPath.first(signed_info_element, \"./ds:Reference\", {\"ds\"=>DSIG})\n \n-      hashed_element = document.at_xpath(\"//*[@ID=$id]\", nil, { 'id' => extract_signed_element_id })\n+      reference_nodes = document.xpath(\"//*[@ID=$id]\", nil, { 'id' => extract_signed_element_id })\n+\n+      if reference_nodes.length > 1 # ensures no elements with same ID to prevent signature wrapping attack.\n+        return append_error(\"Duplicated IDs found\", soft)\n+      end\n+\n+      hashed_element = reference_nodes[0]\n \n       canon_algorithm = canon_algorithm REXML::XPath.first(\n-        ref,\n-        '//ds:CanonicalizationMethod',\n+        signed_info_element,\n+        './ds:CanonicalizationMethod',\n         { \"ds\" => DSIG }\n       )\n \n@@ -332,13 +345,13 @@ def validate_signature(base64_cert, soft = true)\n \n       digest_algorithm = algorithm(REXML::XPath.first(\n         ref,\n-        \"//ds:DigestMethod\",\n+        \"./ds:DigestMethod\",\n         { \"ds\" => DSIG }\n       ))\n       hash = digest_algorithm.digest(canon_hashed_element)\n       encoded_digest_value = REXML::XPath.first(\n         ref,\n-        \"//ds:DigestValue\",\n+        \"./ds:DigestValue\",\n         { \"ds\" => DSIG }\n       )\n       digest_value = Base64.decode64(OneLogin::RubySaml::Utils.element_text(encoded_digest_value))\n@@ -364,7 +377,7 @@ def validate_signature(base64_cert, soft = true)\n     def process_transforms(ref, canon_algorithm)\n       transforms = REXML::XPath.match(\n         ref,\n-        \"//ds:Transforms/ds:Transform\",\n+        \"./ds:Transforms/ds:Transform\",\n         { \"ds\" => DSIG }\n       )\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/SAML-Toolkits/ruby-saml/commits/4865d030cae9705ee5cdb12415c654c634093ae7",
        "url": "https://api.github.com/repos/SAML-Toolkits/ruby-saml/commits/4865d030cae9705ee5cdb12415c654c634093ae7",
        "html_url": "https://github.com/SAML-Toolkits/ruby-saml/commit/4865d030cae9705ee5cdb12415c654c634093ae7",
        "message": "Merge commit from fork\n\n* Use correct XPaths and resolve to correct elements\n\n* Update xml_security.rb\n\n* Block references that resolve to multiple nodes to prevent signature wrapping attacks",
        "files": [
            {
                "sha": "f731d4642d73ce4d36b5e594b24d1d27c175052b",
                "filename": "lib/xml_security.rb",
                "status": "modified",
                "additions": 19,
                "deletions": 7,
                "changes": 26,
                "blob_url": "https://github.com/SAML-Toolkits/ruby-saml/blob/4865d030cae9705ee5cdb12415c654c634093ae7/lib%2Fxml_security.rb",
                "raw_url": "https://github.com/SAML-Toolkits/ruby-saml/raw/4865d030cae9705ee5cdb12415c654c634093ae7/lib%2Fxml_security.rb",
                "contents_url": "https://api.github.com/repos/SAML-Toolkits/ruby-saml/contents/lib%2Fxml_security.rb?ref=4865d030cae9705ee5cdb12415c654c634093ae7",
                "patch": "@@ -310,17 +310,29 @@ def validate_signature(base64_cert, soft = true)\n       canon_string = noko_signed_info_element.canonicalize(canon_algorithm)\n       noko_sig_element.remove\n \n+      # get signed info\n+      signed_info_element = REXML::XPath.first(\n+        sig_element,\n+        \"./ds:SignedInfo\",\n+        { \"ds\" => DSIG }\n+      )\n       # get inclusive namespaces\n       inclusive_namespaces = extract_inclusive_namespaces\n \n       # check digests\n-      ref = REXML::XPath.first(sig_element, \"//ds:Reference\", {\"ds\"=>DSIG})\n+      ref = REXML::XPath.first(signed_info_element, \"./ds:Reference\", {\"ds\"=>DSIG})\n \n-      hashed_element = document.at_xpath(\"//*[@ID=$id]\", nil, { 'id' => extract_signed_element_id })\n+      reference_nodes = document.xpath(\"//*[@ID=$id]\", nil, { 'id' => extract_signed_element_id })\n+\n+      if reference_nodes.length > 1 # ensures no elements with same ID to prevent signature wrapping attack.\n+        return append_error(\"Digest Mismatch\", soft)\n+      end\n+\n+      hashed_element = reference_nodes[0]\n \n       canon_algorithm = canon_algorithm REXML::XPath.first(\n-        ref,\n-        '//ds:CanonicalizationMethod',\n+        signed_info_element,\n+        './ds:CanonicalizationMethod',\n         { \"ds\" => DSIG }\n       )\n \n@@ -330,13 +342,13 @@ def validate_signature(base64_cert, soft = true)\n \n       digest_algorithm = algorithm(REXML::XPath.first(\n         ref,\n-        \"//ds:DigestMethod\",\n+        \"./ds:DigestMethod\",\n         { \"ds\" => DSIG }\n       ))\n       hash = digest_algorithm.digest(canon_hashed_element)\n       encoded_digest_value = REXML::XPath.first(\n         ref,\n-        \"//ds:DigestValue\",\n+        \"./ds:DigestValue\",\n         { \"ds\" => DSIG }\n       )\n       digest_value = Base64.decode64(OneLogin::RubySaml::Utils.element_text(encoded_digest_value))\n@@ -362,7 +374,7 @@ def validate_signature(base64_cert, soft = true)\n     def process_transforms(ref, canon_algorithm)\n       transforms = REXML::XPath.match(\n         ref,\n-        \"//ds:Transforms/ds:Transform\",\n+        \"./ds:Transforms/ds:Transform\",\n         { \"ds\" => DSIG }\n       )\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/omniauth/omniauth-saml/commits/6c681fd082ab3daf271821897a40ab3417382e29",
        "url": "https://api.github.com/repos/omniauth/omniauth-saml/commits/6c681fd082ab3daf271821897a40ab3417382e29",
        "html_url": "https://github.com/omniauth/omniauth-saml/commit/6c681fd082ab3daf271821897a40ab3417382e29",
        "message": "Merge pull request #222 from omniauth/chore/bump-dependencies\n\nchore: bump dependencies and remove ruby eol versions",
        "files": [
            {
                "sha": "2738f0cb52c1549c7ac725618aeca5c6ae749ca4",
                "filename": ".github/workflows/ruby.yml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/omniauth/omniauth-saml/blob/6c681fd082ab3daf271821897a40ab3417382e29/.github%2Fworkflows%2Fruby.yml",
                "raw_url": "https://github.com/omniauth/omniauth-saml/raw/6c681fd082ab3daf271821897a40ab3417382e29/.github%2Fworkflows%2Fruby.yml",
                "contents_url": "https://api.github.com/repos/omniauth/omniauth-saml/contents/.github%2Fworkflows%2Fruby.yml?ref=6c681fd082ab3daf271821897a40ab3417382e29",
                "patch": "@@ -15,7 +15,7 @@ jobs:\n     runs-on: ubuntu-latest\n     strategy:\n       matrix:\n-        ruby-version: ['2.6', '2.7', '3.0', '3.1', '3.2', 'jruby-head']\n+        ruby-version: ['3.1', '3.2', '3.3', 'jruby-head']\n \n     steps:\n     - uses: actions/checkout@v2"
            },
            {
                "sha": "3dbf77bf7fde52df62f928b443c7ebb373467044",
                "filename": "README.md",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/omniauth/omniauth-saml/blob/6c681fd082ab3daf271821897a40ab3417382e29/README.md",
                "raw_url": "https://github.com/omniauth/omniauth-saml/raw/6c681fd082ab3daf271821897a40ab3417382e29/README.md",
                "contents_url": "https://api.github.com/repos/omniauth/omniauth-saml/contents/README.md?ref=6c681fd082ab3daf271821897a40ab3417382e29",
                "patch": "@@ -15,8 +15,8 @@ https://github.com/omniauth/omniauth-saml\n \n ## Requirements\n \n-* [OmniAuth](http://www.omniauth.org/) 1.3+\n-* Ruby 2.4.x+\n+* [OmniAuth](http://www.omniauth.org/) 2.1+\n+* Ruby 3.1.x+\n \n ## Versioning\n "
            },
            {
                "sha": "89cde5e9f5945927c87621bcc3604c58e6f2827b",
                "filename": "omniauth-saml.gemspec",
                "status": "modified",
                "additions": 9,
                "deletions": 9,
                "changes": 18,
                "blob_url": "https://github.com/omniauth/omniauth-saml/blob/6c681fd082ab3daf271821897a40ab3417382e29/omniauth-saml.gemspec",
                "raw_url": "https://github.com/omniauth/omniauth-saml/raw/6c681fd082ab3daf271821897a40ab3417382e29/omniauth-saml.gemspec",
                "contents_url": "https://api.github.com/repos/omniauth/omniauth-saml/contents/omniauth-saml.gemspec?ref=6c681fd082ab3daf271821897a40ab3417382e29",
                "patch": "@@ -11,17 +11,17 @@ Gem::Specification.new do |gem|\n   gem.email         = 'rajiv@alum.mit.edu'\n   gem.homepage      = 'https://github.com/omniauth/omniauth-saml'\n \n-  gem.required_ruby_version = '>= 2.4'\n+  gem.required_ruby_version = '>= 3.1'\n \n-  gem.add_runtime_dependency 'omniauth', '~> 2.0'\n-  gem.add_runtime_dependency 'ruby-saml', '~> 1.12'\n+  gem.add_runtime_dependency 'omniauth', '~> 2.1'\n+  gem.add_runtime_dependency 'ruby-saml', '>= 1.17'\n \n-  gem.add_development_dependency 'rake', '>= 12.3.3'\n-  gem.add_development_dependency 'rspec', '~>3.4'\n-  gem.add_development_dependency 'simplecov', '~> 0.11'\n-  gem.add_development_dependency 'rack-test', '~> 0.6', '>= 0.6.3'\n-  gem.add_development_dependency 'conventional-changelog', '~> 1.2'\n-  gem.add_development_dependency 'coveralls', '>= 0.8.23'\n+  gem.add_development_dependency 'rake', '~> 13.2'\n+  gem.add_development_dependency 'rspec', '~> 3.13'\n+  gem.add_development_dependency 'simplecov', '~> 0.10'\n+  gem.add_development_dependency 'rack-test', '~> 2.1'\n+  gem.add_development_dependency 'conventional-changelog', '~> 1.3'\n+  gem.add_development_dependency 'coveralls', '~> 0.8'\n \n   gem.files         = ['README.md', 'CHANGELOG.md', 'LICENSE.md'] + Dir['lib/**/*.rb']\n   gem.test_files    = Dir['spec/**/*.rb']"
            },
            {
                "sha": "25f4272f8373bb066374e0d0e1c9e71e78cea34a",
                "filename": "spec/omniauth/strategies/saml_spec.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/omniauth/omniauth-saml/blob/6c681fd082ab3daf271821897a40ab3417382e29/spec%2Fomniauth%2Fstrategies%2Fsaml_spec.rb",
                "raw_url": "https://github.com/omniauth/omniauth-saml/raw/6c681fd082ab3daf271821897a40ab3417382e29/spec%2Fomniauth%2Fstrategies%2Fsaml_spec.rb",
                "contents_url": "https://api.github.com/repos/omniauth/omniauth-saml/contents/spec%2Fomniauth%2Fstrategies%2Fsaml_spec.rb?ref=6c681fd082ab3daf271821897a40ab3417382e29",
                "patch": "@@ -410,7 +410,7 @@ def test_default_relay_state(static_default_relay_state = nil, &block_default_re\n \n     it 'should get SP metadata page' do\n       expect(last_response.status).to eq 200\n-      expect(last_response.header[\"Content-Type\"]).to eq \"application/xml\"\n+      expect(last_response.headers[\"Content-Type\"]).to eq \"application/xml\"\n     end\n \n     it 'should configure attributes consuming service' do"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/directus/directus/commits/4aace0bbe57232e38cd6a287ee475293e46dc91b",
        "url": "https://api.github.com/repos/directus/directus/commits/4aace0bbe57232e38cd6a287ee475293e46dc91b",
        "html_url": "https://github.com/directus/directus/commit/4aace0bbe57232e38cd6a287ee475293e46dc91b",
        "message": "Merge commit from fork\n\n* Exclude all auth from response caching\n\n* Add changeset",
        "files": [
            {
                "sha": "32d1d59da4a339abb8a1ffaaf597cbac12ec33bc",
                "filename": ".changeset/orange-suns-fry.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/directus/directus/blob/4aace0bbe57232e38cd6a287ee475293e46dc91b/.changeset%2Forange-suns-fry.md",
                "raw_url": "https://github.com/directus/directus/raw/4aace0bbe57232e38cd6a287ee475293e46dc91b/.changeset%2Forange-suns-fry.md",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/.changeset%2Forange-suns-fry.md?ref=4aace0bbe57232e38cd6a287ee475293e46dc91b",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@directus/api': patch\n+---\n+\n+Fixed an issue that could cause the response cache to misbehave"
            },
            {
                "sha": "505e77e01aeda5bfaa2fbfac8f6b213c670a7134",
                "filename": "api/src/middleware/respond.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/directus/directus/blob/4aace0bbe57232e38cd6a287ee475293e46dc91b/api%2Fsrc%2Fmiddleware%2Frespond.ts",
                "raw_url": "https://github.com/directus/directus/raw/4aace0bbe57232e38cd6a287ee475293e46dc91b/api%2Fsrc%2Fmiddleware%2Frespond.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Fmiddleware%2Frespond.ts?ref=4aace0bbe57232e38cd6a287ee475293e46dc91b",
                "patch": "@@ -27,6 +27,7 @@ export const respond: RequestHandler = asyncHandler(async (req, res) => {\n \n \tif (\n \t\t(req.method.toLowerCase() === 'get' || req.originalUrl?.startsWith('/graphql')) &&\n+\t\treq.originalUrl?.startsWith('/auth') === false &&\n \t\tenv['CACHE_ENABLED'] === true &&\n \t\tcache &&\n \t\t!req.sanitizedQuery.export &&"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/directus/directus/commits/769fa22797bff5a9231599883b391e013f122e52",
        "url": "https://api.github.com/repos/directus/directus/commits/769fa22797bff5a9231599883b391e013f122e52",
        "html_url": "https://github.com/directus/directus/commit/769fa22797bff5a9231599883b391e013f122e52",
        "message": "Merge commit from fork\n\n* Exclude all auth from response caching\n\n* Add changeset",
        "files": [
            {
                "sha": "32d1d59da4a339abb8a1ffaaf597cbac12ec33bc",
                "filename": ".changeset/orange-suns-fry.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/directus/directus/blob/769fa22797bff5a9231599883b391e013f122e52/.changeset%2Forange-suns-fry.md",
                "raw_url": "https://github.com/directus/directus/raw/769fa22797bff5a9231599883b391e013f122e52/.changeset%2Forange-suns-fry.md",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/.changeset%2Forange-suns-fry.md?ref=769fa22797bff5a9231599883b391e013f122e52",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@directus/api': patch\n+---\n+\n+Fixed an issue that could cause the response cache to misbehave"
            },
            {
                "sha": "19c93c84889817612c9c946770021068bb6e65a6",
                "filename": "api/src/middleware/respond.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/directus/directus/blob/769fa22797bff5a9231599883b391e013f122e52/api%2Fsrc%2Fmiddleware%2Frespond.ts",
                "raw_url": "https://github.com/directus/directus/raw/769fa22797bff5a9231599883b391e013f122e52/api%2Fsrc%2Fmiddleware%2Frespond.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Fmiddleware%2Frespond.ts?ref=769fa22797bff5a9231599883b391e013f122e52",
                "patch": "@@ -27,6 +27,7 @@ export const respond: RequestHandler = asyncHandler(async (req, res) => {\n \n \tif (\n \t\t(req.method.toLowerCase() === 'get' || req.originalUrl?.startsWith('/graphql')) &&\n+\t\treq.originalUrl?.startsWith('/auth') === false &&\n \t\tenv['CACHE_ENABLED'] === true &&\n \t\tcache &&\n \t\t!req.sanitizedQuery.export &&"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/man-group/dtale/commits/b6e30969390520d1400b55acbb13e5487b8472e8",
        "url": "https://api.github.com/repos/man-group/dtale/commits/b6e30969390520d1400b55acbb13e5487b8472e8",
        "html_url": "https://github.com/man-group/dtale/commit/b6e30969390520d1400b55acbb13e5487b8472e8",
        "message": "Added check for custom filtering before using custom queries in charts",
        "files": [
            {
                "sha": "b23aabd348d7eb75690d813678f070fd62589cc4",
                "filename": "dtale/dash_application/layout/layout.py",
                "status": "modified",
                "additions": 24,
                "deletions": 20,
                "changes": 44,
                "blob_url": "https://github.com/man-group/dtale/blob/b6e30969390520d1400b55acbb13e5487b8472e8/dtale%2Fdash_application%2Flayout%2Flayout.py",
                "raw_url": "https://github.com/man-group/dtale/raw/b6e30969390520d1400b55acbb13e5487b8472e8/dtale%2Fdash_application%2Flayout%2Flayout.py",
                "contents_url": "https://api.github.com/repos/man-group/dtale/contents/dtale%2Fdash_application%2Flayout%2Flayout.py?ref=b6e30969390520d1400b55acbb13e5487b8472e8",
                "patch": "@@ -1709,27 +1709,31 @@ def show_map_style(show):\n             ),\n             className=\"row pt-3 pb-3 charts-filters\",\n         ),\n-        html.Div(\n+        (\n             html.Div(\n-                [\n-                    html.Div(\n-                        [\n-                            query_label,\n-                            dcc.Input(\n-                                id=\"query-input\",\n-                                type=\"text\",\n-                                placeholder=query_placeholder,\n-                                className=\"form-control\",\n-                                value=query_value,\n-                                style={\"lineHeight\": \"inherit\"},\n-                            ),\n-                        ],\n-                        className=\"input-group mr-3\",\n-                    )\n-                ],\n-                className=\"col\",\n-            ),\n-            className=\"row pt-3 pb-3 charts-filters\",\n+                html.Div(\n+                    [\n+                        html.Div(\n+                            [\n+                                query_label,\n+                                dcc.Input(\n+                                    id=\"query-input\",\n+                                    type=\"text\",\n+                                    placeholder=query_placeholder,\n+                                    className=\"form-control\",\n+                                    value=query_value,\n+                                    style={\"lineHeight\": \"inherit\"},\n+                                ),\n+                            ],\n+                            className=\"input-group mr-3\",\n+                        )\n+                    ],\n+                    className=\"col\",\n+                ),\n+                className=\"row pt-3 pb-3 charts-filters\",\n+            )\n+            if global_state.load_flag(inputs[\"data_id\"], \"enable_custom_filters\", False)\n+            else None\n         ),\n         html.Div(\n             html.Div("
            },
            {
                "sha": "4acfc984d7988ab85d7bdbeaffdf8a7265791837",
                "filename": "dtale/views.py",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/man-group/dtale/blob/b6e30969390520d1400b55acbb13e5487b8472e8/dtale%2Fviews.py",
                "raw_url": "https://github.com/man-group/dtale/raw/b6e30969390520d1400b55acbb13e5487b8472e8/dtale%2Fviews.py",
                "contents_url": "https://api.github.com/repos/man-group/dtale/contents/dtale%2Fviews.py?ref=b6e30969390520d1400b55acbb13e5487b8472e8",
                "patch": "@@ -3380,9 +3380,12 @@ def get_chart_data(data_id):\n         max: maxY,\n     } or {error: 'Exception message', traceback: 'Exception stacktrace'}\n     \"\"\"\n+    custom_query = None\n+    if global_state.load_flag(data_id, \"enable_custom_filters\", False):\n+        custom_query = get_str_arg(request, \"query\")\n     data = run_query(\n         handle_predefined(data_id),\n-        build_query(data_id, get_str_arg(request, \"query\")),\n+        build_query(data_id, custom_query),\n         global_state.get_context_variables(data_id),\n     )\n     x = get_str_arg(request, \"x\")"
            },
            {
                "sha": "6154bfa5b9aa37a419d4b7322f02be91edb01bd8",
                "filename": "tests/dtale/test_views.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/man-group/dtale/blob/b6e30969390520d1400b55acbb13e5487b8472e8/tests%2Fdtale%2Ftest_views.py",
                "raw_url": "https://github.com/man-group/dtale/raw/b6e30969390520d1400b55acbb13e5487b8472e8/tests%2Fdtale%2Ftest_views.py",
                "contents_url": "https://api.github.com/repos/man-group/dtale/contents/tests%2Fdtale%2Ftest_views.py?ref=b6e30969390520d1400b55acbb13e5487b8472e8",
                "patch": "@@ -1975,6 +1975,7 @@ def test_get_chart_data(unittest, rolling_data):\n \n     with app.test_client() as c:\n         build_data_inst({c.port: test_data})\n+        global_state.set_app_settings(dict(enable_custom_filters=True))\n         response = c.get(\n             \"/dtale/chart-data/{}\".format(c.port),\n             query_string=dict(query=\"missing_col == 'blah'\"),\n@@ -1997,6 +1998,7 @@ def test_get_chart_data(unittest, rolling_data):\n             response_data[\"error\"],\n             'query \"security_id == 51\" found no data, please alter',\n         )\n+    global_state.set_app_settings(dict(enable_custom_filters=False))\n \n     df = pd.DataFrame([dict(a=i, b=np.nan) for i in range(100)])\n     df, _ = views.format_data(df)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/DamienHarper/auditor-bundle/commits/42ba2940d8b99467de0c806ea5655cc1c6882cd1",
        "url": "https://api.github.com/repos/DamienHarper/auditor-bundle/commits/42ba2940d8b99467de0c806ea5655cc1c6882cd1",
        "html_url": "https://github.com/DamienHarper/auditor-bundle/commit/42ba2940d8b99467de0c806ea5655cc1c6882cd1",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "ab35c61fa30f87a2c3224c3ee29879b9650978da",
                "filename": "src/Resources/views/Audit/helpers/helper.html.twig",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/DamienHarper/auditor-bundle/blob/42ba2940d8b99467de0c806ea5655cc1c6882cd1/src%2FResources%2Fviews%2FAudit%2Fhelpers%2Fhelper.html.twig",
                "raw_url": "https://github.com/DamienHarper/auditor-bundle/raw/42ba2940d8b99467de0c806ea5655cc1c6882cd1/src%2FResources%2Fviews%2FAudit%2Fhelpers%2Fhelper.html.twig",
                "contents_url": "https://api.github.com/repos/DamienHarper/auditor-bundle/contents/src%2FResources%2Fviews%2FAudit%2Fhelpers%2Fhelper.html.twig?ref=42ba2940d8b99467de0c806ea5655cc1c6882cd1",
                "patch": "@@ -65,12 +65,12 @@\n \n     {{ ('audit.audit_details.summary.' ~ action)|trans({\n         '%source_link%': path('dh_auditor_show_entity_history', { 'entity': helper.namespaceToParam(entity), 'id': entry.getObjectId() }),\n-        '%source%': source_subject,\n-        '%source_label%': source_label,\n-        '%target_link%': target_link,\n-        '%target%': target_subject,\n-        '%target_label%': target_label,\n-        '%user%': entry.getUsername() is null ? 'audit.audit_details.summary.unkown_user'|trans(domain='auditor') : entry.getUsername(),\n+        '%source%': source_subject|escape,\n+        '%source_label%': source_label|escape,\n+        '%target_link%': target_link|escape,\n+        '%target%': target_subject|escape,\n+        '%target_label%': target_label|escape,\n+        '%user%': entry.getUsername() is null ? 'audit.audit_details.summary.unkown_user'|trans(domain='auditor') : entry.getUsername()|escape,\n         '%ip%': entry.getIp() is not empty ? ', IP: ' ~ entry.getIp() : '',\n     }, domain='auditor')|raw }}\n {% endmacro %}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/DamienHarper/auditor-bundle/commits/e7deb377fa89677d44973b486d26d6a7374233ae",
        "url": "https://api.github.com/repos/DamienHarper/auditor-bundle/commits/e7deb377fa89677d44973b486d26d6a7374233ae",
        "html_url": "https://github.com/DamienHarper/auditor-bundle/commit/e7deb377fa89677d44973b486d26d6a7374233ae",
        "message": "CVE-2024-45592 fix\n\n(cherry picked from commit 42ba2940d8b99467de0c806ea5655cc1c6882cd1)",
        "files": [
            {
                "sha": "ab35c61fa30f87a2c3224c3ee29879b9650978da",
                "filename": "src/Resources/views/Audit/helpers/helper.html.twig",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/DamienHarper/auditor-bundle/blob/e7deb377fa89677d44973b486d26d6a7374233ae/src%2FResources%2Fviews%2FAudit%2Fhelpers%2Fhelper.html.twig",
                "raw_url": "https://github.com/DamienHarper/auditor-bundle/raw/e7deb377fa89677d44973b486d26d6a7374233ae/src%2FResources%2Fviews%2FAudit%2Fhelpers%2Fhelper.html.twig",
                "contents_url": "https://api.github.com/repos/DamienHarper/auditor-bundle/contents/src%2FResources%2Fviews%2FAudit%2Fhelpers%2Fhelper.html.twig?ref=e7deb377fa89677d44973b486d26d6a7374233ae",
                "patch": "@@ -65,12 +65,12 @@\n \n     {{ ('audit.audit_details.summary.' ~ action)|trans({\n         '%source_link%': path('dh_auditor_show_entity_history', { 'entity': helper.namespaceToParam(entity), 'id': entry.getObjectId() }),\n-        '%source%': source_subject,\n-        '%source_label%': source_label,\n-        '%target_link%': target_link,\n-        '%target%': target_subject,\n-        '%target_label%': target_label,\n-        '%user%': entry.getUsername() is null ? 'audit.audit_details.summary.unkown_user'|trans(domain='auditor') : entry.getUsername(),\n+        '%source%': source_subject|escape,\n+        '%source_label%': source_label|escape,\n+        '%target_link%': target_link|escape,\n+        '%target%': target_subject|escape,\n+        '%target_label%': target_label|escape,\n+        '%user%': entry.getUsername() is null ? 'audit.audit_details.summary.unkown_user'|trans(domain='auditor') : entry.getUsername()|escape,\n         '%ip%': entry.getIp() is not empty ? ', IP: ' ~ entry.getIp() : '',\n     }, domain='auditor')|raw }}\n {% endmacro %}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/9cbca9808300797c67779bb9a665d85cf9e3d4b8",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/9cbca9808300797c67779bb9a665d85cf9e3d4b8",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/9cbca9808300797c67779bb9a665d85cf9e3d4b8",
        "message": "XWIKI-22052: Improve right handling in page history resources\n\n* Add unit tests for the page history resources.",
        "files": [
            {
                "sha": "eaf8dd38ca35cf4688fb86fa47bf463d1785298e",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/main/java/org/xwiki/rest/internal/resources/pages/PageHistoryResourceImpl.java",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImpl.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImpl.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImpl.java?ref=9cbca9808300797c67779bb9a665d85cf9e3d4b8",
                "patch": "@@ -23,9 +23,13 @@\n import java.util.Date;\n import java.util.List;\n \n+import javax.inject.Inject;\n import javax.inject.Named;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.Response;\n \n import org.xwiki.component.annotation.Component;\n+import org.xwiki.model.reference.DocumentReference;\n import org.xwiki.query.Query;\n import org.xwiki.query.QueryException;\n import org.xwiki.rest.XWikiResource;\n@@ -35,6 +39,9 @@\n import org.xwiki.rest.model.jaxb.History;\n import org.xwiki.rest.model.jaxb.HistorySummary;\n import org.xwiki.rest.resources.pages.PageHistoryResource;\n+import org.xwiki.security.authorization.AccessDeniedException;\n+import org.xwiki.security.authorization.ContextualAuthorizationManager;\n+import org.xwiki.security.authorization.Right;\n \n import com.xpn.xwiki.doc.rcs.XWikiRCSNodeId;\n \n@@ -45,11 +52,22 @@\n @Named(\"org.xwiki.rest.internal.resources.pages.PageHistoryResourceImpl\")\n public class PageHistoryResourceImpl extends XWikiResource implements PageHistoryResource\n {\n+    @Inject\n+    private ContextualAuthorizationManager contextualAuthorizationManager;\n+\n     @Override\n     public History getPageHistory(String wikiName, String spaceName, String pageName, Integer start, Integer number,\n             String order, Boolean withPrettyNames) throws XWikiRestException\n     {\n         List<String> spaces = parseSpaceSegments(spaceName);\n+\n+        DocumentReference documentReference = new DocumentReference(wikiName, spaces, pageName);\n+        try {\n+            this.contextualAuthorizationManager.checkAccess(Right.VIEW, documentReference);\n+        } catch (AccessDeniedException e) {\n+            throw new WebApplicationException(Response.Status.UNAUTHORIZED);\n+        }\n+\n         String spaceId = Utils.getLocalSpaceId(spaces);\n \n         History history = new History();"
            },
            {
                "sha": "4b145c78a194aea6a080ab9c0adaece42b883fa3",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/main/java/org/xwiki/rest/internal/resources/pages/PageTranslationHistoryResourceImpl.java",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImpl.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImpl.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImpl.java?ref=9cbca9808300797c67779bb9a665d85cf9e3d4b8",
                "patch": "@@ -23,9 +23,13 @@\n import java.util.Date;\n import java.util.List;\n \n+import javax.inject.Inject;\n import javax.inject.Named;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.Response;\n \n import org.xwiki.component.annotation.Component;\n+import org.xwiki.model.reference.DocumentReference;\n import org.xwiki.query.Query;\n import org.xwiki.query.QueryException;\n import org.xwiki.rest.XWikiResource;\n@@ -35,6 +39,9 @@\n import org.xwiki.rest.model.jaxb.History;\n import org.xwiki.rest.model.jaxb.HistorySummary;\n import org.xwiki.rest.resources.pages.PageTranslationHistoryResource;\n+import org.xwiki.security.authorization.AccessDeniedException;\n+import org.xwiki.security.authorization.ContextualAuthorizationManager;\n+import org.xwiki.security.authorization.Right;\n \n import com.xpn.xwiki.doc.rcs.XWikiRCSNodeId;\n \n@@ -45,11 +52,22 @@\n @Named(\"org.xwiki.rest.internal.resources.pages.PageTranslationHistoryResourceImpl\")\n public class PageTranslationHistoryResourceImpl extends XWikiResource implements PageTranslationHistoryResource\n {\n+    @Inject\n+    private ContextualAuthorizationManager contextualAuthorizationManager;\n+\n     @Override\n     public History getPageTranslationHistory(String wikiName, String spaceName, String pageName, String language,\n             Integer start, Integer number, String order, Boolean withPrettyNames) throws XWikiRestException\n     {\n         List<String> spaces = parseSpaceSegments(spaceName);\n+\n+        DocumentReference documentReference = new DocumentReference(wikiName, spaces, pageName);\n+        try {\n+            this.contextualAuthorizationManager.checkAccess(Right.VIEW, documentReference);\n+        } catch (AccessDeniedException e) {\n+            throw new WebApplicationException(Response.Status.UNAUTHORIZED);\n+        }\n+\n         String spaceId = Utils.getLocalSpaceId(spaces);\n \n         History history = new History();"
            },
            {
                "sha": "9de27b7e8cc057f83b44e4281a41824ffb6d66ac",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/test/java/org/xwiki/rest/internal/resources/pages/AbstractPageHistoryResourceImplTest.java",
                "status": "added",
                "additions": 187,
                "deletions": 0,
                "changes": 187,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FAbstractPageHistoryResourceImplTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FAbstractPageHistoryResourceImplTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FAbstractPageHistoryResourceImplTest.java?ref=9cbca9808300797c67779bb9a665d85cf9e3d4b8",
                "patch": "@@ -0,0 +1,187 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.rest.internal.resources.pages;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.sql.Timestamp;\n+import java.time.Instant;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.inject.Named;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.UriInfo;\n+\n+import org.apache.commons.lang3.reflect.FieldUtils;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mock;\n+import org.suigeneris.jrcs.rcs.Version;\n+import org.xwiki.component.manager.ComponentLookupException;\n+import org.xwiki.component.manager.ComponentManager;\n+import org.xwiki.model.reference.DocumentReference;\n+import org.xwiki.query.Query;\n+import org.xwiki.query.QueryException;\n+import org.xwiki.query.QueryManager;\n+import org.xwiki.rest.XWikiResource;\n+import org.xwiki.rest.XWikiRestException;\n+import org.xwiki.rest.model.jaxb.History;\n+import org.xwiki.rest.model.jaxb.HistorySummary;\n+import org.xwiki.security.authorization.AccessDeniedException;\n+import org.xwiki.security.authorization.ContextualAuthorizationManager;\n+import org.xwiki.security.authorization.Right;\n+import org.xwiki.test.junit5.mockito.MockComponent;\n+import org.xwiki.test.mockito.MockitoComponentManager;\n+\n+import com.xpn.xwiki.doc.rcs.XWikiRCSNodeId;\n+import com.xpn.xwiki.web.Utils;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyInt;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.doThrow;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Abstract base class for tests for page history with and without translation.\n+ *\n+ * @version $Id$\n+ */\n+public abstract class AbstractPageHistoryResourceImplTest\n+{\n+    protected static final String WIKI_NAME = \"wiki\";\n+\n+    protected static final String PAGE_NAME = \"page\";\n+\n+    protected static final int START = 8;\n+\n+    protected static final int LIMIT = 11;\n+\n+    private static final List<String> SPACE_NAMES = List.of(\"parent\", \"space\");\n+\n+    protected static final String SPACE_URL = String.join(\"/spaces/\", SPACE_NAMES);\n+\n+    private static final DocumentReference DOCUMENT_REFERENCE =\n+        new DocumentReference(WIKI_NAME, SPACE_NAMES, PAGE_NAME);\n+\n+    private static final DocumentReference USER_REFERENCE = new DocumentReference(\"xwiki\", \"XWiki\", \"user\");\n+\n+    private static final String AUTHOR = \"author\";\n+\n+    private static final String COMMENT = \"comment\";\n+\n+    @MockComponent\n+    private QueryManager queryManager;\n+\n+    @MockComponent\n+    private ContextualAuthorizationManager contextualAuthorizationManager;\n+\n+    @MockComponent\n+    @Named(\"context\")\n+    private ComponentManager contextComponentManager;\n+\n+    @Mock\n+    private UriInfo uriInfo;\n+\n+    protected abstract History getTranslationHistory() throws XWikiRestException;\n+\n+    @BeforeEach\n+    void setUp(MockitoComponentManager componentManager)\n+        throws ComponentLookupException, URISyntaxException, IllegalAccessException\n+    {\n+        Utils.setComponentManager(componentManager);\n+\n+        // Because XWikiResource injects the context component manager, it exists as a mock, and we thus need to mock\n+        // its behavior - otherwise it would just be ignored.\n+        when(this.contextComponentManager.getInstance(any()))\n+            .thenAnswer(invocation -> componentManager.getInstance(invocation.getArgument(0)));\n+        when(this.contextComponentManager.getInstance(any(), any()))\n+            .thenAnswer(\n+                invocation -> componentManager.getInstance(invocation.getArgument(0), invocation.getArgument(1)));\n+\n+        when(this.uriInfo.getBaseUri()).thenReturn(new URI(\"https://test/\"));\n+\n+        injectURIInfo();\n+    }\n+\n+    abstract void injectURIInfo() throws IllegalAccessException;\n+\n+    protected void injectURIInfo(XWikiResource resource) throws IllegalAccessException\n+    {\n+        FieldUtils.writeField(resource, \"uriInfo\", this.uriInfo, true);\n+    }\n+\n+    @Test\n+    void getPageTranslationHistoryAccessDenied() throws AccessDeniedException, XWikiRestException\n+    {\n+        doThrow(new AccessDeniedException(Right.VIEW, DOCUMENT_REFERENCE, USER_REFERENCE))\n+            .when(this.contextualAuthorizationManager).checkAccess(Right.VIEW, DOCUMENT_REFERENCE);\n+\n+        WebApplicationException exception = assertThrows(WebApplicationException.class, this::getTranslationHistory);\n+\n+        assertEquals(401, exception.getResponse().getStatus());\n+    }\n+\n+    @Test\n+    void getPageTranslationHistory() throws XWikiRestException, QueryException\n+    {\n+        Query mockQuery = mock();\n+        when(this.queryManager.createQuery(any(), eq(Query.XWQL))).thenReturn(mockQuery);\n+        when(mockQuery.bindValue(any(), any())).thenReturn(mockQuery);\n+        when(mockQuery.setOffset(anyInt())).thenReturn(mockQuery);\n+        when(mockQuery.setLimit(anyInt())).thenReturn(mockQuery);\n+        when(mockQuery.setWiki(any())).thenReturn(mockQuery);\n+        XWikiRCSNodeId nodeId = new XWikiRCSNodeId(DOCUMENT_REFERENCE.getWikiReference(), 42, new Version(2, 3));\n+        Instant now = Instant.now();\n+        String spaceName = String.join(\".\", SPACE_NAMES);\n+        when(mockQuery.execute()).thenReturn(Collections.singletonList(\n+            new Object[] { spaceName, PAGE_NAME, nodeId, Timestamp.from(now), AUTHOR, COMMENT }));\n+        History history = getTranslationHistory();\n+        // Verify that the query was correctly constructed.\n+        verify(mockQuery).bindValue(\"space\", spaceName);\n+        verify(mockQuery).bindValue(\"name\", PAGE_NAME);\n+        String language = getLanguage();\n+        if (language != null) {\n+            verify(mockQuery).bindValue(\"language\", language);\n+        }\n+        verify(mockQuery).setOffset(START);\n+        verify(mockQuery).setLimit(LIMIT);\n+        verify(mockQuery).setWiki(WIKI_NAME);\n+        // Verify that the history summary was correctly constructed.\n+        assertEquals(1, history.getHistorySummaries().size());\n+        HistorySummary historySummary = history.getHistorySummaries().get(0);\n+        assertEquals(\"parent.space\", historySummary.getSpace());\n+        assertEquals(PAGE_NAME, historySummary.getName());\n+        assertEquals(2, historySummary.getMajorVersion());\n+        assertEquals(3, historySummary.getMinorVersion());\n+        // Compare the modified date to the current time.\n+        assertEquals(now.getEpochSecond(), historySummary.getModified().getTime().getTime() / 1000);\n+        assertEquals(AUTHOR, historySummary.getModifier());\n+        assertEquals(COMMENT, historySummary.getComment());\n+        assertEquals(language, historySummary.getLanguage());\n+    }\n+\n+    protected abstract String getLanguage();\n+}"
            },
            {
                "sha": "739136d92ec6b9ca08f2be080c1e0fb41f173421",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/test/java/org/xwiki/rest/internal/resources/pages/PageHistoryResourceImplTest.java",
                "status": "added",
                "additions": 58,
                "deletions": 0,
                "changes": 58,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImplTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImplTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImplTest.java?ref=9cbca9808300797c67779bb9a665d85cf9e3d4b8",
                "patch": "@@ -0,0 +1,58 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.rest.internal.resources.pages;\n+\n+import org.xwiki.rest.XWikiRestException;\n+import org.xwiki.rest.model.jaxb.History;\n+import org.xwiki.test.junit5.mockito.ComponentTest;\n+import org.xwiki.test.junit5.mockito.InjectMockComponents;\n+\n+import com.xpn.xwiki.test.reference.ReferenceComponentList;\n+\n+/**\n+ * Unit test for {@link PageHistoryResourceImpl}.\n+ *\n+ * @version $Id$\n+ */\n+@ComponentTest\n+@ReferenceComponentList\n+public class PageHistoryResourceImplTest extends AbstractPageHistoryResourceImplTest\n+{\n+    @InjectMockComponents\n+    private PageHistoryResourceImpl pageHistoryResource;\n+\n+    @Override\n+    protected History getTranslationHistory() throws XWikiRestException\n+    {\n+        return this.pageHistoryResource.getPageHistory(WIKI_NAME, SPACE_URL, PAGE_NAME, START, LIMIT, \"order\", false);\n+    }\n+\n+    @Override\n+    protected String getLanguage()\n+    {\n+        return null;\n+    }\n+\n+    @Override\n+    void injectURIInfo() throws IllegalAccessException\n+    {\n+        injectURIInfo(this.pageHistoryResource);\n+    }\n+}"
            },
            {
                "sha": "712bec32d6d659f3555aaacefd7f768a253c5081",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/test/java/org/xwiki/rest/internal/resources/pages/PageTranslationHistoryResourceImplTest.java",
                "status": "added",
                "additions": 59,
                "deletions": 0,
                "changes": 59,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImplTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/9cbca9808300797c67779bb9a665d85cf9e3d4b8/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImplTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImplTest.java?ref=9cbca9808300797c67779bb9a665d85cf9e3d4b8",
                "patch": "@@ -0,0 +1,59 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.rest.internal.resources.pages;\n+\n+import org.xwiki.rest.XWikiRestException;\n+import org.xwiki.rest.model.jaxb.History;\n+import org.xwiki.test.junit5.mockito.ComponentTest;\n+import org.xwiki.test.junit5.mockito.InjectMockComponents;\n+\n+import com.xpn.xwiki.test.reference.ReferenceComponentList;\n+\n+/**\n+ * Unit tests for {@link PageTranslationHistoryResourceImpl}.\n+ *\n+ * @version $Id$\n+ */\n+@ComponentTest\n+@ReferenceComponentList\n+class PageTranslationHistoryResourceImplTest extends AbstractPageHistoryResourceImplTest\n+{\n+    @InjectMockComponents\n+    private PageTranslationHistoryResourceImpl pageTranslationHistoryResource;\n+\n+    @Override\n+    protected History getTranslationHistory() throws XWikiRestException\n+    {\n+        return this.pageTranslationHistoryResource.getPageTranslationHistory(WIKI_NAME, SPACE_URL, PAGE_NAME,\n+            getLanguage(), START, LIMIT, \"order\", false);\n+    }\n+\n+    @Override\n+    protected String getLanguage()\n+    {\n+        return \"language\";\n+    }\n+\n+    @Override\n+    void injectURIInfo() throws IllegalAccessException\n+    {\n+        injectURIInfo(this.pageTranslationHistoryResource);\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/26482ee5d29fc21f31134d1ee13db48716e89e0f",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/26482ee5d29fc21f31134d1ee13db48716e89e0f",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/26482ee5d29fc21f31134d1ee13db48716e89e0f",
        "message": "XWIKI-22052: Improve right handling in page history resources\n\n* Add unit tests for the page history resources.\n\n(cherry picked from commit 9cbca9808300797c67779bb9a665d85cf9e3d4b8)",
        "files": [
            {
                "sha": "eaf8dd38ca35cf4688fb86fa47bf463d1785298e",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/main/java/org/xwiki/rest/internal/resources/pages/PageHistoryResourceImpl.java",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImpl.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImpl.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImpl.java?ref=26482ee5d29fc21f31134d1ee13db48716e89e0f",
                "patch": "@@ -23,9 +23,13 @@\n import java.util.Date;\n import java.util.List;\n \n+import javax.inject.Inject;\n import javax.inject.Named;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.Response;\n \n import org.xwiki.component.annotation.Component;\n+import org.xwiki.model.reference.DocumentReference;\n import org.xwiki.query.Query;\n import org.xwiki.query.QueryException;\n import org.xwiki.rest.XWikiResource;\n@@ -35,6 +39,9 @@\n import org.xwiki.rest.model.jaxb.History;\n import org.xwiki.rest.model.jaxb.HistorySummary;\n import org.xwiki.rest.resources.pages.PageHistoryResource;\n+import org.xwiki.security.authorization.AccessDeniedException;\n+import org.xwiki.security.authorization.ContextualAuthorizationManager;\n+import org.xwiki.security.authorization.Right;\n \n import com.xpn.xwiki.doc.rcs.XWikiRCSNodeId;\n \n@@ -45,11 +52,22 @@\n @Named(\"org.xwiki.rest.internal.resources.pages.PageHistoryResourceImpl\")\n public class PageHistoryResourceImpl extends XWikiResource implements PageHistoryResource\n {\n+    @Inject\n+    private ContextualAuthorizationManager contextualAuthorizationManager;\n+\n     @Override\n     public History getPageHistory(String wikiName, String spaceName, String pageName, Integer start, Integer number,\n             String order, Boolean withPrettyNames) throws XWikiRestException\n     {\n         List<String> spaces = parseSpaceSegments(spaceName);\n+\n+        DocumentReference documentReference = new DocumentReference(wikiName, spaces, pageName);\n+        try {\n+            this.contextualAuthorizationManager.checkAccess(Right.VIEW, documentReference);\n+        } catch (AccessDeniedException e) {\n+            throw new WebApplicationException(Response.Status.UNAUTHORIZED);\n+        }\n+\n         String spaceId = Utils.getLocalSpaceId(spaces);\n \n         History history = new History();"
            },
            {
                "sha": "4b145c78a194aea6a080ab9c0adaece42b883fa3",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/main/java/org/xwiki/rest/internal/resources/pages/PageTranslationHistoryResourceImpl.java",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImpl.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImpl.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImpl.java?ref=26482ee5d29fc21f31134d1ee13db48716e89e0f",
                "patch": "@@ -23,9 +23,13 @@\n import java.util.Date;\n import java.util.List;\n \n+import javax.inject.Inject;\n import javax.inject.Named;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.Response;\n \n import org.xwiki.component.annotation.Component;\n+import org.xwiki.model.reference.DocumentReference;\n import org.xwiki.query.Query;\n import org.xwiki.query.QueryException;\n import org.xwiki.rest.XWikiResource;\n@@ -35,6 +39,9 @@\n import org.xwiki.rest.model.jaxb.History;\n import org.xwiki.rest.model.jaxb.HistorySummary;\n import org.xwiki.rest.resources.pages.PageTranslationHistoryResource;\n+import org.xwiki.security.authorization.AccessDeniedException;\n+import org.xwiki.security.authorization.ContextualAuthorizationManager;\n+import org.xwiki.security.authorization.Right;\n \n import com.xpn.xwiki.doc.rcs.XWikiRCSNodeId;\n \n@@ -45,11 +52,22 @@\n @Named(\"org.xwiki.rest.internal.resources.pages.PageTranslationHistoryResourceImpl\")\n public class PageTranslationHistoryResourceImpl extends XWikiResource implements PageTranslationHistoryResource\n {\n+    @Inject\n+    private ContextualAuthorizationManager contextualAuthorizationManager;\n+\n     @Override\n     public History getPageTranslationHistory(String wikiName, String spaceName, String pageName, String language,\n             Integer start, Integer number, String order, Boolean withPrettyNames) throws XWikiRestException\n     {\n         List<String> spaces = parseSpaceSegments(spaceName);\n+\n+        DocumentReference documentReference = new DocumentReference(wikiName, spaces, pageName);\n+        try {\n+            this.contextualAuthorizationManager.checkAccess(Right.VIEW, documentReference);\n+        } catch (AccessDeniedException e) {\n+            throw new WebApplicationException(Response.Status.UNAUTHORIZED);\n+        }\n+\n         String spaceId = Utils.getLocalSpaceId(spaces);\n \n         History history = new History();"
            },
            {
                "sha": "9de27b7e8cc057f83b44e4281a41824ffb6d66ac",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/test/java/org/xwiki/rest/internal/resources/pages/AbstractPageHistoryResourceImplTest.java",
                "status": "added",
                "additions": 187,
                "deletions": 0,
                "changes": 187,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FAbstractPageHistoryResourceImplTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FAbstractPageHistoryResourceImplTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FAbstractPageHistoryResourceImplTest.java?ref=26482ee5d29fc21f31134d1ee13db48716e89e0f",
                "patch": "@@ -0,0 +1,187 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.rest.internal.resources.pages;\n+\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.sql.Timestamp;\n+import java.time.Instant;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import javax.inject.Named;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.UriInfo;\n+\n+import org.apache.commons.lang3.reflect.FieldUtils;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mock;\n+import org.suigeneris.jrcs.rcs.Version;\n+import org.xwiki.component.manager.ComponentLookupException;\n+import org.xwiki.component.manager.ComponentManager;\n+import org.xwiki.model.reference.DocumentReference;\n+import org.xwiki.query.Query;\n+import org.xwiki.query.QueryException;\n+import org.xwiki.query.QueryManager;\n+import org.xwiki.rest.XWikiResource;\n+import org.xwiki.rest.XWikiRestException;\n+import org.xwiki.rest.model.jaxb.History;\n+import org.xwiki.rest.model.jaxb.HistorySummary;\n+import org.xwiki.security.authorization.AccessDeniedException;\n+import org.xwiki.security.authorization.ContextualAuthorizationManager;\n+import org.xwiki.security.authorization.Right;\n+import org.xwiki.test.junit5.mockito.MockComponent;\n+import org.xwiki.test.mockito.MockitoComponentManager;\n+\n+import com.xpn.xwiki.doc.rcs.XWikiRCSNodeId;\n+import com.xpn.xwiki.web.Utils;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.anyInt;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.doThrow;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Abstract base class for tests for page history with and without translation.\n+ *\n+ * @version $Id$\n+ */\n+public abstract class AbstractPageHistoryResourceImplTest\n+{\n+    protected static final String WIKI_NAME = \"wiki\";\n+\n+    protected static final String PAGE_NAME = \"page\";\n+\n+    protected static final int START = 8;\n+\n+    protected static final int LIMIT = 11;\n+\n+    private static final List<String> SPACE_NAMES = List.of(\"parent\", \"space\");\n+\n+    protected static final String SPACE_URL = String.join(\"/spaces/\", SPACE_NAMES);\n+\n+    private static final DocumentReference DOCUMENT_REFERENCE =\n+        new DocumentReference(WIKI_NAME, SPACE_NAMES, PAGE_NAME);\n+\n+    private static final DocumentReference USER_REFERENCE = new DocumentReference(\"xwiki\", \"XWiki\", \"user\");\n+\n+    private static final String AUTHOR = \"author\";\n+\n+    private static final String COMMENT = \"comment\";\n+\n+    @MockComponent\n+    private QueryManager queryManager;\n+\n+    @MockComponent\n+    private ContextualAuthorizationManager contextualAuthorizationManager;\n+\n+    @MockComponent\n+    @Named(\"context\")\n+    private ComponentManager contextComponentManager;\n+\n+    @Mock\n+    private UriInfo uriInfo;\n+\n+    protected abstract History getTranslationHistory() throws XWikiRestException;\n+\n+    @BeforeEach\n+    void setUp(MockitoComponentManager componentManager)\n+        throws ComponentLookupException, URISyntaxException, IllegalAccessException\n+    {\n+        Utils.setComponentManager(componentManager);\n+\n+        // Because XWikiResource injects the context component manager, it exists as a mock, and we thus need to mock\n+        // its behavior - otherwise it would just be ignored.\n+        when(this.contextComponentManager.getInstance(any()))\n+            .thenAnswer(invocation -> componentManager.getInstance(invocation.getArgument(0)));\n+        when(this.contextComponentManager.getInstance(any(), any()))\n+            .thenAnswer(\n+                invocation -> componentManager.getInstance(invocation.getArgument(0), invocation.getArgument(1)));\n+\n+        when(this.uriInfo.getBaseUri()).thenReturn(new URI(\"https://test/\"));\n+\n+        injectURIInfo();\n+    }\n+\n+    abstract void injectURIInfo() throws IllegalAccessException;\n+\n+    protected void injectURIInfo(XWikiResource resource) throws IllegalAccessException\n+    {\n+        FieldUtils.writeField(resource, \"uriInfo\", this.uriInfo, true);\n+    }\n+\n+    @Test\n+    void getPageTranslationHistoryAccessDenied() throws AccessDeniedException, XWikiRestException\n+    {\n+        doThrow(new AccessDeniedException(Right.VIEW, DOCUMENT_REFERENCE, USER_REFERENCE))\n+            .when(this.contextualAuthorizationManager).checkAccess(Right.VIEW, DOCUMENT_REFERENCE);\n+\n+        WebApplicationException exception = assertThrows(WebApplicationException.class, this::getTranslationHistory);\n+\n+        assertEquals(401, exception.getResponse().getStatus());\n+    }\n+\n+    @Test\n+    void getPageTranslationHistory() throws XWikiRestException, QueryException\n+    {\n+        Query mockQuery = mock();\n+        when(this.queryManager.createQuery(any(), eq(Query.XWQL))).thenReturn(mockQuery);\n+        when(mockQuery.bindValue(any(), any())).thenReturn(mockQuery);\n+        when(mockQuery.setOffset(anyInt())).thenReturn(mockQuery);\n+        when(mockQuery.setLimit(anyInt())).thenReturn(mockQuery);\n+        when(mockQuery.setWiki(any())).thenReturn(mockQuery);\n+        XWikiRCSNodeId nodeId = new XWikiRCSNodeId(DOCUMENT_REFERENCE.getWikiReference(), 42, new Version(2, 3));\n+        Instant now = Instant.now();\n+        String spaceName = String.join(\".\", SPACE_NAMES);\n+        when(mockQuery.execute()).thenReturn(Collections.singletonList(\n+            new Object[] { spaceName, PAGE_NAME, nodeId, Timestamp.from(now), AUTHOR, COMMENT }));\n+        History history = getTranslationHistory();\n+        // Verify that the query was correctly constructed.\n+        verify(mockQuery).bindValue(\"space\", spaceName);\n+        verify(mockQuery).bindValue(\"name\", PAGE_NAME);\n+        String language = getLanguage();\n+        if (language != null) {\n+            verify(mockQuery).bindValue(\"language\", language);\n+        }\n+        verify(mockQuery).setOffset(START);\n+        verify(mockQuery).setLimit(LIMIT);\n+        verify(mockQuery).setWiki(WIKI_NAME);\n+        // Verify that the history summary was correctly constructed.\n+        assertEquals(1, history.getHistorySummaries().size());\n+        HistorySummary historySummary = history.getHistorySummaries().get(0);\n+        assertEquals(\"parent.space\", historySummary.getSpace());\n+        assertEquals(PAGE_NAME, historySummary.getName());\n+        assertEquals(2, historySummary.getMajorVersion());\n+        assertEquals(3, historySummary.getMinorVersion());\n+        // Compare the modified date to the current time.\n+        assertEquals(now.getEpochSecond(), historySummary.getModified().getTime().getTime() / 1000);\n+        assertEquals(AUTHOR, historySummary.getModifier());\n+        assertEquals(COMMENT, historySummary.getComment());\n+        assertEquals(language, historySummary.getLanguage());\n+    }\n+\n+    protected abstract String getLanguage();\n+}"
            },
            {
                "sha": "739136d92ec6b9ca08f2be080c1e0fb41f173421",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/test/java/org/xwiki/rest/internal/resources/pages/PageHistoryResourceImplTest.java",
                "status": "added",
                "additions": 58,
                "deletions": 0,
                "changes": 58,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImplTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImplTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageHistoryResourceImplTest.java?ref=26482ee5d29fc21f31134d1ee13db48716e89e0f",
                "patch": "@@ -0,0 +1,58 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.rest.internal.resources.pages;\n+\n+import org.xwiki.rest.XWikiRestException;\n+import org.xwiki.rest.model.jaxb.History;\n+import org.xwiki.test.junit5.mockito.ComponentTest;\n+import org.xwiki.test.junit5.mockito.InjectMockComponents;\n+\n+import com.xpn.xwiki.test.reference.ReferenceComponentList;\n+\n+/**\n+ * Unit test for {@link PageHistoryResourceImpl}.\n+ *\n+ * @version $Id$\n+ */\n+@ComponentTest\n+@ReferenceComponentList\n+public class PageHistoryResourceImplTest extends AbstractPageHistoryResourceImplTest\n+{\n+    @InjectMockComponents\n+    private PageHistoryResourceImpl pageHistoryResource;\n+\n+    @Override\n+    protected History getTranslationHistory() throws XWikiRestException\n+    {\n+        return this.pageHistoryResource.getPageHistory(WIKI_NAME, SPACE_URL, PAGE_NAME, START, LIMIT, \"order\", false);\n+    }\n+\n+    @Override\n+    protected String getLanguage()\n+    {\n+        return null;\n+    }\n+\n+    @Override\n+    void injectURIInfo() throws IllegalAccessException\n+    {\n+        injectURIInfo(this.pageHistoryResource);\n+    }\n+}"
            },
            {
                "sha": "712bec32d6d659f3555aaacefd7f768a253c5081",
                "filename": "xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/test/java/org/xwiki/rest/internal/resources/pages/PageTranslationHistoryResourceImplTest.java",
                "status": "added",
                "additions": 59,
                "deletions": 0,
                "changes": 59,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImplTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/26482ee5d29fc21f31134d1ee13db48716e89e0f/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImplTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-rest%2Fxwiki-platform-rest-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frest%2Finternal%2Fresources%2Fpages%2FPageTranslationHistoryResourceImplTest.java?ref=26482ee5d29fc21f31134d1ee13db48716e89e0f",
                "patch": "@@ -0,0 +1,59 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.rest.internal.resources.pages;\n+\n+import org.xwiki.rest.XWikiRestException;\n+import org.xwiki.rest.model.jaxb.History;\n+import org.xwiki.test.junit5.mockito.ComponentTest;\n+import org.xwiki.test.junit5.mockito.InjectMockComponents;\n+\n+import com.xpn.xwiki.test.reference.ReferenceComponentList;\n+\n+/**\n+ * Unit tests for {@link PageTranslationHistoryResourceImpl}.\n+ *\n+ * @version $Id$\n+ */\n+@ComponentTest\n+@ReferenceComponentList\n+class PageTranslationHistoryResourceImplTest extends AbstractPageHistoryResourceImplTest\n+{\n+    @InjectMockComponents\n+    private PageTranslationHistoryResourceImpl pageTranslationHistoryResource;\n+\n+    @Override\n+    protected History getTranslationHistory() throws XWikiRestException\n+    {\n+        return this.pageTranslationHistoryResource.getPageTranslationHistory(WIKI_NAME, SPACE_URL, PAGE_NAME,\n+            getLanguage(), START, LIMIT, \"order\", false);\n+    }\n+\n+    @Override\n+    protected String getLanguage()\n+    {\n+        return \"language\";\n+    }\n+\n+    @Override\n+    void injectURIInfo() throws IllegalAccessException\n+    {\n+        injectURIInfo(this.pageTranslationHistoryResource);\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/expressjs/body-parser/commits/b2695c4450f06ba3b0ccf48d872a229bb41c9bce",
        "url": "https://api.github.com/repos/expressjs/body-parser/commits/b2695c4450f06ba3b0ccf48d872a229bb41c9bce",
        "html_url": "https://github.com/expressjs/body-parser/commit/b2695c4450f06ba3b0ccf48d872a229bb41c9bce",
        "message": "Merge commit from fork\n\n* feat: add option to customize the depth\n\nMain Changes:\n- Update documentation to reflect the new features and errors\n- Update the changelog\n- Upgrade to `qs@6.13.0`\n- Add the `depth` option to define the depth of parsing while parsing the query string\n- Enable the `strictDepth` option by default in `qs.parse`\n- Add a 400 status code when the depth of the query string exceeds the limit defined by the `depth` option\n\n* chore: reduce the default depth limit to 32\n\nMain Changes:\n- Breaking Change: Set default depth limit to 32\n- Update documentation\n- Update the HISTORY",
        "files": [
            {
                "sha": "ffb80f32f02ae9bbc9e4b43df7b93b24138b5c2c",
                "filename": "HISTORY.md",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/expressjs/body-parser/blob/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/HISTORY.md",
                "raw_url": "https://github.com/expressjs/body-parser/raw/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/HISTORY.md",
                "contents_url": "https://api.github.com/repos/expressjs/body-parser/contents/HISTORY.md?ref=b2695c4450f06ba3b0ccf48d872a229bb41c9bce",
                "patch": "@@ -1,6 +1,9 @@\n unreleased\n-==========\n-  * deps: qs@6.12.3\n+===================\n+\n+  * deps: qs@6.13.0\n+  * add `depth` option to customize the depth level in the parser\n+  * IMPORTANT: The default `depth` level for parsing URL-encoded data is now `32` (previously was `Infinity`)\n \n 1.20.2 / 2023-02-21\n ==================="
            },
            {
                "sha": "f6661b7d33c16808aaa4a19624666bc52f5cb639",
                "filename": "README.md",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/expressjs/body-parser/blob/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/README.md",
                "raw_url": "https://github.com/expressjs/body-parser/raw/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/README.md",
                "contents_url": "https://api.github.com/repos/expressjs/body-parser/contents/README.md?ref=b2695c4450f06ba3b0ccf48d872a229bb41c9bce",
                "patch": "@@ -278,6 +278,10 @@ The `verify` option, if supplied, is called as `verify(req, res, buf, encoding)`\n where `buf` is a `Buffer` of the raw request body and `encoding` is the\n encoding of the request. The parsing can be aborted by throwing an error.\n \n+#### depth\n+\n+The `depth` option is used to configure the maximum depth of the `qs` library when `extended` is `true`. This allows you to limit the amount of keys that are parsed and can be useful to prevent certain types of abuse. Defaults to `32`. It is recommended to keep this value as low as possible.\n+\n ## Errors\n \n The middlewares provided by this module create errors using the\n@@ -374,6 +378,10 @@ as well as in the `encoding` property. The `status` property is set to `415`,\n the `type` property is set to `'encoding.unsupported'`, and the `encoding`\n property is set to the encoding that is unsupported.\n \n+### The input exceeded the depth\n+\n+This error occurs when using `bodyParser.urlencoded` with the `extended` property set to `true` and the input exceeds the configured `depth` option. The `status` property is set to `400`. It is recommended to review the `depth` option and evaluate if it requires a higher value. When the `depth` option is set to `32` (default value), the error will not be thrown.\n+\n ## Examples\n \n ### Express/Connect top-level generic"
            },
            {
                "sha": "886a3ce237e629ee81b14dec517d7ee37a47a1be",
                "filename": "lib/types/urlencoded.js",
                "status": "modified",
                "additions": 30,
                "deletions": 7,
                "changes": 37,
                "blob_url": "https://github.com/expressjs/body-parser/blob/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/lib%2Ftypes%2Furlencoded.js",
                "raw_url": "https://github.com/expressjs/body-parser/raw/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/lib%2Ftypes%2Furlencoded.js",
                "contents_url": "https://api.github.com/repos/expressjs/body-parser/contents/lib%2Ftypes%2Furlencoded.js?ref=b2695c4450f06ba3b0ccf48d872a229bb41c9bce",
                "patch": "@@ -55,6 +55,9 @@ function urlencoded (options) {\n     : opts.limit\n   var type = opts.type || 'application/x-www-form-urlencoded'\n   var verify = opts.verify || false\n+  var depth = typeof opts.depth !== 'number'\n+    ? Number(opts.depth || 32)\n+    : opts.depth\n \n   if (verify !== false && typeof verify !== 'function') {\n     throw new TypeError('option verify must be function')\n@@ -118,7 +121,8 @@ function urlencoded (options) {\n       encoding: charset,\n       inflate: inflate,\n       limit: limit,\n-      verify: verify\n+      verify: verify,\n+      depth: depth\n     })\n   }\n }\n@@ -133,12 +137,20 @@ function extendedparser (options) {\n   var parameterLimit = options.parameterLimit !== undefined\n     ? options.parameterLimit\n     : 1000\n+\n+  var depth = typeof options.depth !== 'number'\n+    ? Number(options.depth || 32)\n+    : options.depth\n   var parse = parser('qs')\n \n   if (isNaN(parameterLimit) || parameterLimit < 1) {\n     throw new TypeError('option parameterLimit must be a positive number')\n   }\n \n+  if(isNaN(depth) || depth < 0) {\n+    throw new TypeError('option depth must be a zero or a positive number')\n+  }\n+\n   if (isFinite(parameterLimit)) {\n     parameterLimit = parameterLimit | 0\n   }\n@@ -156,12 +168,23 @@ function extendedparser (options) {\n     var arrayLimit = Math.max(100, paramCount)\n \n     debug('parse extended urlencoding')\n-    return parse(body, {\n-      allowPrototypes: true,\n-      arrayLimit: arrayLimit,\n-      depth: Infinity,\n-      parameterLimit: parameterLimit\n-    })\n+    try {\n+      return parse(body, {\n+        allowPrototypes: true,\n+        arrayLimit: arrayLimit,\n+        depth: depth,\n+        strictDepth: true,\n+        parameterLimit: parameterLimit\n+      })\n+    } catch (err) {\n+      if (err instanceof RangeError) {\n+        throw createError(400, 'The input exceeded the depth', {\n+          type: 'querystring.parse.rangeError'\n+        })\n+      } else {\n+        throw err\n+      }\n+    }\n   }\n }\n "
            },
            {
                "sha": "014453238486b13c33a12834ececd4c4bb29e1c9",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/expressjs/body-parser/blob/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/package.json",
                "raw_url": "https://github.com/expressjs/body-parser/raw/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/package.json",
                "contents_url": "https://api.github.com/repos/expressjs/body-parser/contents/package.json?ref=b2695c4450f06ba3b0ccf48d872a229bb41c9bce",
                "patch": "@@ -17,7 +17,7 @@\n     \"http-errors\": \"2.0.0\",\n     \"iconv-lite\": \"0.4.24\",\n     \"on-finished\": \"2.4.1\",\n-    \"qs\": \"6.12.3\",\n+    \"qs\": \"6.13.0\",\n     \"raw-body\": \"2.5.2\",\n     \"type-is\": \"~1.6.18\",\n     \"unpipe\": \"1.0.0\""
            },
            {
                "sha": "fa5a815c62ab7a21336ad1c1444d683cfd70546f",
                "filename": "test/urlencoded.js",
                "status": "modified",
                "additions": 80,
                "deletions": 2,
                "changes": 82,
                "blob_url": "https://github.com/expressjs/body-parser/blob/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/test%2Furlencoded.js",
                "raw_url": "https://github.com/expressjs/body-parser/raw/b2695c4450f06ba3b0ccf48d872a229bb41c9bce/test%2Furlencoded.js",
                "contents_url": "https://api.github.com/repos/expressjs/body-parser/contents/test%2Furlencoded.js?ref=b2695c4450f06ba3b0ccf48d872a229bb41c9bce",
                "patch": "@@ -195,7 +195,7 @@ describe('bodyParser.urlencoded()', function () {\n       it('should parse deep object', function (done) {\n         var str = 'foo'\n \n-        for (var i = 0; i < 500; i++) {\n+        for (var i = 0; i < 32; i++) {\n           str += '[p]'\n         }\n \n@@ -213,13 +213,91 @@ describe('bodyParser.urlencoded()', function () {\n             var depth = 0\n             var ref = obj.foo\n             while ((ref = ref.p)) { depth++ }\n-            assert.strictEqual(depth, 500)\n+            assert.strictEqual(depth, 32)\n           })\n           .expect(200, done)\n       })\n     })\n   })\n \n+\n+  describe('with depth option', function () {\n+    describe('when custom value set', function () {\n+\n+      it('should reject non possitive numbers', function () {\n+        assert.throws(createServer.bind(null, { extended: true, depth: -1 }),\n+          /TypeError: option depth must be a zero or a positive number/)\n+        assert.throws(createServer.bind(null, { extended: true, depth: NaN }),\n+          /TypeError: option depth must be a zero or a positive number/)\n+        assert.throws(createServer.bind(null, { extended: true, depth: \"beep\" }),\n+          /TypeError: option depth must be a zero or a positive number/)\n+      })\n+\n+\n+      it('should parse up to the specified depth', function (done) {\n+        this.server = createServer({ extended:true,  depth: 10 })\n+        request(this.server)\n+          .post('/')\n+          .set('Content-Type', 'application/x-www-form-urlencoded')\n+          .send('a[b][c][d]=value')\n+          .expect(200, '{\"a\":{\"b\":{\"c\":{\"d\":\"value\"}}}}', done)\n+      })\n+\n+      it('should not parse beyond the specified depth', function (done) {\n+        this.server = createServer({ extended:true,  depth: 1 })\n+        request(this.server)\n+          .post('/')\n+          .set('Content-Type', 'application/x-www-form-urlencoded')\n+          .send('a[b][c][d][e]=value')\n+          .expect(400, '[querystring.parse.rangeError] The input exceeded the depth', done)\n+      })\n+    })\n+    \n+\n+    describe('when default value', function () {\n+      before(function () {\n+        this.server = createServer({ })\n+      })\n+\n+      it('should parse deeply nested objects', function (done) {\n+        var deepObject = 'a'\n+        for (var i = 0; i < 32; i++) {\n+          deepObject += '[p]'\n+        }\n+        deepObject += '=value'\n+  \n+        request(this.server)\n+          .post('/')\n+          .set('Content-Type', 'application/x-www-form-urlencoded')\n+          .send(deepObject)\n+          .expect(function (res) {\n+            var obj = JSON.parse(res.text)\n+            var depth = 0\n+            var ref = obj.a\n+            while ((ref = ref.p)) { depth++ }\n+            assert.strictEqual(depth, 32)\n+          })\n+          .expect(200, done)\n+      })\n+\n+      it('should not parse beyond the specified depth', function (done) {\n+        var deepObject = 'a';\n+        for (var i = 0; i < 33; i++) {\n+          deepObject += '[p]';\n+        }\n+        deepObject += '=value';\n+\n+        request(this.server)\n+          .post('/')\n+          .set('Content-Type', 'application/x-www-form-urlencoded')\n+          .send(deepObject)\n+          .expect(400, '[querystring.parse.rangeError] The input exceeded the depth', done);\n+      });\n+  \n+    })\n+\n+  })\n+\n   describe('with inflate option', function () {\n     describe('when false', function () {\n       before(function () {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/NixOS/nix/commits/eb11c1499876cd4c9c188cbda5b1003b36ce2e59",
        "url": "https://api.github.com/repos/NixOS/nix/commits/eb11c1499876cd4c9c188cbda5b1003b36ce2e59",
        "html_url": "https://github.com/NixOS/nix/commit/eb11c1499876cd4c9c188cbda5b1003b36ce2e59",
        "message": "Merge commit from fork\n\nFix unsafe NAR unpacking (2.24)",
        "files": [
            {
                "sha": "458438cbdd59e047f92879a8c693ade1a5246137",
                "filename": "src/libutil/archive.cc",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/NixOS/nix/blob/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/src%2Flibutil%2Farchive.cc",
                "raw_url": "https://github.com/NixOS/nix/raw/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/src%2Flibutil%2Farchive.cc",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/src%2Flibutil%2Farchive.cc?ref=eb11c1499876cd4c9c188cbda5b1003b36ce2e59",
                "patch": "@@ -23,7 +23,7 @@ struct ArchiveSettings : Config\n             false,\n         #endif\n         \"use-case-hack\",\n-        \"Whether to enable a Darwin-specific hack for dealing with file name collisions.\"};\n+        \"Whether to enable a macOS-specific hack for dealing with file name case collisions.\"};\n };\n \n static ArchiveSettings archiveSettings;\n@@ -214,11 +214,13 @@ static void parse(FileSystemObjectSink & sink, Source & source, const CanonPath\n             else if (t == \"directory\") {\n                 sink.createDirectory(path);\n \n+                std::string prevName;\n+\n                 while (1) {\n                     s = getString();\n \n                     if (s == \"entry\") {\n-                        std::string name, prevName;\n+                        std::string name;\n \n                         s = getString();\n                         if (s != \"(\") throw badArchive(\"expected open tag\");\n@@ -241,6 +243,9 @@ static void parse(FileSystemObjectSink & sink, Source & source, const CanonPath\n                                         debug(\"case collision between '%1%' and '%2%'\", i->first, name);\n                                         name += caseHackSuffix;\n                                         name += std::to_string(++i->second);\n+                                        auto j = names.find(name);\n+                                        if (j != names.end())\n+                                            throw Error(\"NAR contains file name '%s' that collides with case-hacked file name '%s'\", prevName, j->first);\n                                     } else\n                                         names[name] = 0;\n                                 }"
            },
            {
                "sha": "a08cb0a4cf78be8b828f84a965ae1c03c4c7895d",
                "filename": "src/libutil/fs-sink.cc",
                "status": "modified",
                "additions": 10,
                "deletions": 9,
                "changes": 19,
                "blob_url": "https://github.com/NixOS/nix/blob/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/src%2Flibutil%2Ffs-sink.cc",
                "raw_url": "https://github.com/NixOS/nix/raw/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/src%2Flibutil%2Ffs-sink.cc",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/src%2Flibutil%2Ffs-sink.cc?ref=eb11c1499876cd4c9c188cbda5b1003b36ce2e59",
                "patch": "@@ -68,10 +68,19 @@ static RestoreSinkSettings restoreSinkSettings;\n \n static GlobalConfig::Register r1(&restoreSinkSettings);\n \n+static std::filesystem::path append(const std::filesystem::path & src, const CanonPath & path)\n+{\n+    auto dst = src;\n+    if (!path.rel().empty())\n+        dst /= path.rel();\n+    return dst;\n+}\n \n void RestoreSink::createDirectory(const CanonPath & path)\n {\n-    std::filesystem::create_directory(dstPath / path.rel());\n+    auto p = append(dstPath, path);\n+    if (!std::filesystem::create_directory(p))\n+        throw Error(\"path '%s' already exists\", p.string());\n };\n \n struct RestoreRegularFile : CreateRegularFileSink {\n@@ -82,14 +91,6 @@ struct RestoreRegularFile : CreateRegularFileSink {\n     void preallocateContents(uint64_t size) override;\n };\n \n-static std::filesystem::path append(const std::filesystem::path & src, const CanonPath & path)\n-{\n-    auto dst = src;\n-    if (!path.rel().empty())\n-        dst /= path.rel();\n-    return dst;\n-}\n-\n void RestoreSink::createRegularFile(const CanonPath & path, std::function<void(CreateRegularFileSink &)> func)\n {\n     auto p = append(dstPath, path);"
            },
            {
                "sha": "2eff86901c617be2a830d23074923cb5b3b69aa3",
                "filename": "tests/functional/case-collision.nar",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/NixOS/nix/blob/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Fcase-collision.nar",
                "raw_url": "https://github.com/NixOS/nix/raw/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Fcase-collision.nar",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/tests%2Ffunctional%2Fcase-collision.nar?ref=eb11c1499876cd4c9c188cbda5b1003b36ce2e59"
            },
            {
                "sha": "feddc65831e4505f8511ec1d4997ff7554604a4c",
                "filename": "tests/functional/case-hack.sh",
                "status": "removed",
                "additions": 0,
                "deletions": 24,
                "changes": 24,
                "blob_url": "https://github.com/NixOS/nix/blob/ae486b29100cb423afc48e4cbf1d5ac83d8dc000/tests%2Ffunctional%2Fcase-hack.sh",
                "raw_url": "https://github.com/NixOS/nix/raw/ae486b29100cb423afc48e4cbf1d5ac83d8dc000/tests%2Ffunctional%2Fcase-hack.sh",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/tests%2Ffunctional%2Fcase-hack.sh?ref=ae486b29100cb423afc48e4cbf1d5ac83d8dc000",
                "patch": "@@ -1,24 +0,0 @@\n-#!/usr/bin/env bash\n-\n-source common.sh\n-\n-TODO_NixOS\n-\n-clearStore\n-\n-rm -rf \"$TEST_ROOT/case\"\n-\n-opts=(\"--option\" \"use-case-hack\" \"true\")\n-\n-# Check whether restoring and dumping a NAR that contains case\n-# collisions is round-tripping, even on a case-insensitive system.\n-\n-nix-store \"${opts[@]}\" --restore \"$TEST_ROOT/case\" < case.nar\n-nix-store \"${opts[@]}\" --dump \"$TEST_ROOT/case\" > \"$TEST_ROOT/case.nar\"\n-cmp case.nar \"$TEST_ROOT/case.nar\"\n-[ \"$(nix-hash \"${opts[@]}\" --type sha256 \"$TEST_ROOT/case\")\" = \"$(nix-hash --flat --type sha256 case.nar)\" ]\n-\n-# Check whether we detect true collisions (e.g. those remaining after\n-# removal of the suffix).\n-touch \"$TEST_ROOT/case/xt_CONNMARK.h~nix~case~hack~3\"\n-(! nix-store \"${opts[@]}\" --dump \"$TEST_ROOT/case\" > /dev/null)"
            },
            {
                "sha": "1d0993ed4cab41a6d45907ac0c17026afd5471a2",
                "filename": "tests/functional/duplicate.nar",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/NixOS/nix/blob/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Fduplicate.nar",
                "raw_url": "https://github.com/NixOS/nix/raw/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Fduplicate.nar",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/tests%2Ffunctional%2Fduplicate.nar?ref=eb11c1499876cd4c9c188cbda5b1003b36ce2e59"
            },
            {
                "sha": "f618237650330b409aadb4898c62146d9926f4a9",
                "filename": "tests/functional/local.mk",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/NixOS/nix/blob/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Flocal.mk",
                "raw_url": "https://github.com/NixOS/nix/raw/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Flocal.mk",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/tests%2Ffunctional%2Flocal.mk?ref=eb11c1499876cd4c9c188cbda5b1003b36ce2e59",
                "patch": "@@ -90,7 +90,7 @@ nix_tests = \\\n   derivation-advanced-attributes.sh \\\n   import-derivation.sh \\\n   nix_path.sh \\\n-  case-hack.sh \\\n+  nars.sh \\\n   placeholders.sh \\\n   ssh-relay.sh \\\n   build.sh \\"
            },
            {
                "sha": "9f5f43dc6353c2387056298643d04b258916301b",
                "filename": "tests/functional/nars.sh",
                "status": "added",
                "additions": 94,
                "deletions": 0,
                "changes": 94,
                "blob_url": "https://github.com/NixOS/nix/blob/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Fnars.sh",
                "raw_url": "https://github.com/NixOS/nix/raw/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Fnars.sh",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/tests%2Ffunctional%2Fnars.sh?ref=eb11c1499876cd4c9c188cbda5b1003b36ce2e59",
                "patch": "@@ -0,0 +1,94 @@\n+#!/usr/bin/env bash\n+\n+source common.sh\n+\n+TODO_NixOS\n+\n+clearStore\n+\n+# Check that NARs with duplicate directory entries are rejected.\n+rm -rf \"$TEST_ROOT/out\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < duplicate.nar | grepQuiet \"NAR directory is not sorted\"\n+\n+# Check that nix-store --restore fails if the output already exists.\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < duplicate.nar | grepQuiet \"path '.*/out' already exists\"\n+\n+rm -rf \"$TEST_ROOT/out\"\n+echo foo > \"$TEST_ROOT/out\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < duplicate.nar | grepQuiet \"File exists\"\n+\n+rm -rf \"$TEST_ROOT/out\"\n+ln -s \"$TEST_ROOT/out2\" \"$TEST_ROOT/out\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < duplicate.nar | grepQuiet \"File exists\"\n+\n+mkdir -p \"$TEST_ROOT/out2\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < duplicate.nar | grepQuiet \"path '.*/out' already exists\"\n+\n+# The same, but for a regular file.\n+nix-store --dump ./nars.sh > \"$TEST_ROOT/tmp.nar\"\n+\n+rm -rf \"$TEST_ROOT/out\"\n+nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\" | grepQuiet \"File exists\"\n+\n+rm -rf \"$TEST_ROOT/out\"\n+mkdir -p \"$TEST_ROOT/out\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\" | grepQuiet \"File exists\"\n+\n+rm -rf \"$TEST_ROOT/out\"\n+ln -s \"$TEST_ROOT/out2\" \"$TEST_ROOT/out\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\" | grepQuiet \"File exists\"\n+\n+mkdir -p \"$TEST_ROOT/out2\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\" | grepQuiet \"File exists\"\n+\n+# The same, but for a symlink.\n+ln -sfn foo \"$TEST_ROOT/symlink\"\n+nix-store --dump \"$TEST_ROOT/symlink\" > \"$TEST_ROOT/tmp.nar\"\n+\n+rm -rf \"$TEST_ROOT/out\"\n+nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\"\n+[[ -L \"$TEST_ROOT/out\" ]]\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\" | grepQuiet \"File exists\"\n+\n+rm -rf \"$TEST_ROOT/out\"\n+mkdir -p \"$TEST_ROOT/out\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\" | grepQuiet \"File exists\"\n+\n+rm -rf \"$TEST_ROOT/out\"\n+ln -s \"$TEST_ROOT/out2\" \"$TEST_ROOT/out\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\" | grepQuiet \"File exists\"\n+\n+mkdir -p \"$TEST_ROOT/out2\"\n+expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < \"$TEST_ROOT/tmp.nar\" | grepQuiet \"File exists\"\n+\n+# Check whether restoring and dumping a NAR that contains case\n+# collisions is round-tripping, even on a case-insensitive system.\n+rm -rf \"$TEST_ROOT/case\"\n+opts=(\"--option\" \"use-case-hack\" \"true\")\n+nix-store \"${opts[@]}\" --restore \"$TEST_ROOT/case\" < case.nar\n+nix-store \"${opts[@]}\" --dump \"$TEST_ROOT/case\" > \"$TEST_ROOT/case.nar\"\n+cmp case.nar \"$TEST_ROOT/case.nar\"\n+[ \"$(nix-hash \"${opts[@]}\" --type sha256 \"$TEST_ROOT/case\")\" = \"$(nix-hash --flat --type sha256 case.nar)\" ]\n+\n+# Check whether we detect true collisions (e.g. those remaining after\n+# removal of the suffix).\n+touch \"$TEST_ROOT/case/xt_CONNMARK.h~nix~case~hack~3\"\n+(! nix-store \"${opts[@]}\" --dump \"$TEST_ROOT/case\" > /dev/null)\n+\n+# Detect NARs that have a directory entry that after case-hacking\n+# collides with another entry (e.g. a directory containing 'Test',\n+# 'Test~nix~case~hack~1' and 'test').\n+rm -rf \"$TEST_ROOT/case\"\n+expectStderr 1 nix-store \"${opts[@]}\" --restore \"$TEST_ROOT/case\" < case-collision.nar | grepQuiet \"NAR contains file name 'test' that collides with case-hacked file name 'Test~nix~case~hack~1'\"\n+\n+# Deserializing a NAR that contains file names that Unicode-normalize\n+# to the same name should fail on macOS but succeed on Linux.\n+rm -rf \"$TEST_ROOT/out\"\n+if [[ $(uname) = Darwin ]]; then\n+    expectStderr 1 nix-store --restore \"$TEST_ROOT/out\" < unnormalized.nar | grepQuiet \"path '.*/out/\u00e2' already exists\"\n+else\n+    nix-store --restore \"$TEST_ROOT/out\" < unnormalized.nar\n+    [[ -e $TEST_ROOT/out/a\u0302 ]]\n+    [[ -e $TEST_ROOT/out/\u00e2 ]]\n+fi"
            },
            {
                "sha": "4b7edb17e0b4a9b75cf2958e9f12cceca22d267c",
                "filename": "tests/functional/unnormalized.nar",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/NixOS/nix/blob/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Funnormalized.nar",
                "raw_url": "https://github.com/NixOS/nix/raw/eb11c1499876cd4c9c188cbda5b1003b36ce2e59/tests%2Ffunctional%2Funnormalized.nar",
                "contents_url": "https://api.github.com/repos/NixOS/nix/contents/tests%2Ffunctional%2Funnormalized.nar?ref=eb11c1499876cd4c9c188cbda5b1003b36ce2e59"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/yeti-platform/yeti/commits/f1f0082e7c165f148ae95f4deeb2786404797a39",
        "url": "https://api.github.com/repos/yeti-platform/yeti/commits/f1f0082e7c165f148ae95f4deeb2786404797a39",
        "html_url": "https://github.com/yeti-platform/yeti/commit/f1f0082e7c165f148ae95f4deeb2786404797a39",
        "message": "Add max length to tags (#1132)",
        "files": [
            {
                "sha": "ea48a3b3fb5a2f2619b7aaa942975ca22147681d",
                "filename": "core/schemas/tag.py",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/yeti-platform/yeti/blob/f1f0082e7c165f148ae95f4deeb2786404797a39/core%2Fschemas%2Ftag.py",
                "raw_url": "https://github.com/yeti-platform/yeti/raw/f1f0082e7c165f148ae95f4deeb2786404797a39/core%2Fschemas%2Ftag.py",
                "contents_url": "https://api.github.com/repos/yeti-platform/yeti/contents/core%2Fschemas%2Ftag.py?ref=f1f0082e7c165f148ae95f4deeb2786404797a39",
                "patch": "@@ -11,6 +11,8 @@\n \n DEFAULT_EXPIRATION = datetime.timedelta(days=30)  # Completely arbitrary\n \n+MAX_TAG_LENGTH = 50\n+\n \n def future():\n     return DEFAULT_EXPIRATION\n@@ -30,7 +32,7 @@ class Tag(YetiModel, database_arango.ArangoYetiConnector):\n     _collection_name: ClassVar[str] = \"tags\"\n     _type_filter: ClassVar[str | None] = None\n \n-    name: str\n+    name: str = Field(max_length=MAX_TAG_LENGTH)\n     count: int = 0\n     created: datetime.datetime = Field(default_factory=now)\n     default_expiration: datetime.timedelta = DEFAULT_EXPIRATION"
            },
            {
                "sha": "896127bf8575c0e044fc88574d81ee8a3f320620",
                "filename": "core/web/apiv2/observables.py",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/yeti-platform/yeti/blob/f1f0082e7c165f148ae95f4deeb2786404797a39/core%2Fweb%2Fapiv2%2Fobservables.py",
                "raw_url": "https://github.com/yeti-platform/yeti/raw/f1f0082e7c165f148ae95f4deeb2786404797a39/core%2Fweb%2Fapiv2%2Fobservables.py",
                "contents_url": "https://api.github.com/repos/yeti-platform/yeti/contents/core%2Fweb%2Fapiv2%2Fobservables.py?ref=f1f0082e7c165f148ae95f4deeb2786404797a39",
                "patch": "@@ -5,6 +5,7 @@\n \n from core.schemas import graph\n from core.schemas.observable import TYPE_MAPPING, Observable, ObservableType\n+from core.schemas.tag import MAX_TAG_LENGTH\n \n ObservableTypes = ()\n \n@@ -25,8 +26,10 @@ class TagRequestMixin(BaseModel):\n     @classmethod\n     def validate_tags(cls, value) -> list[str]:\n         for tag in value:\n-            if not tag:\n+            if not tag or not tag.strip():\n                 raise ValueError(\"Tags cannot be empty\")\n+            if len(tag) > MAX_TAG_LENGTH:\n+                raise ValueError(f\"Tag {tag} exceeds max length ({MAX_TAG_LENGTH})\")\n         return value\n \n "
            },
            {
                "sha": "53f69964c9e771f07c26ccd795b8d9e26276c5fb",
                "filename": "tests/apiv2/observables.py",
                "status": "modified",
                "additions": 23,
                "deletions": 0,
                "changes": 23,
                "blob_url": "https://github.com/yeti-platform/yeti/blob/f1f0082e7c165f148ae95f4deeb2786404797a39/tests%2Fapiv2%2Fobservables.py",
                "raw_url": "https://github.com/yeti-platform/yeti/raw/f1f0082e7c165f148ae95f4deeb2786404797a39/tests%2Fapiv2%2Fobservables.py",
                "contents_url": "https://api.github.com/repos/yeti-platform/yeti/contents/tests%2Fapiv2%2Fobservables.py?ref=f1f0082e7c165f148ae95f4deeb2786404797a39",
                "patch": "@@ -220,6 +220,29 @@ def test_create_observable_empty_tags(self):\n             data[\"detail\"][0][\"msg\"], \"Value error, Tags cannot be empty\", data\n         )\n \n+        response = client.post(\n+            \"/api/v2/observables/\",\n+            json={\"value\": \"toto.com\", \"type\": \"hostname\", \"tags\": [\" \"]},\n+        )\n+        data = response.json()\n+        self.assertEqual(response.status_code, 422, data)\n+        self.assertEqual(\n+            data[\"detail\"][0][\"msg\"], \"Value error, Tags cannot be empty\", data\n+        )\n+\n+    def test_create_observable_toolong_tag(self):\n+        response = client.post(\n+            \"/api/v2/observables/\",\n+            json={\"value\": \"toto.com\", \"type\": \"hostname\", \"tags\": [\"tag1\", \"a\" * 200]},\n+        )\n+        data = response.json()\n+        self.assertEqual(response.status_code, 422, data)\n+        self.assertEqual(\n+            data[\"detail\"][0][\"msg\"],\n+            f\"Value error, Tag {'a'*200} exceeds max length (50)\",\n+            data,\n+        )\n+\n     def test_create_extended_observable(self):\n         response = client.post(\n             \"/api/v2/observables/extended\","
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/LizardByte/Sunshine/commits/5fcd07ecb1428bfe245ad6fa349aead476c7e772",
        "url": "https://api.github.com/repos/LizardByte/Sunshine/commits/5fcd07ecb1428bfe245ad6fa349aead476c7e772",
        "html_url": "https://github.com/LizardByte/Sunshine/commit/5fcd07ecb1428bfe245ad6fa349aead476c7e772",
        "message": "Name and unpair individual clients (#2042)",
        "files": [
            {
                "sha": "a237c1fc3a7d00d114271bc5bf1dccb425f9b56f",
                "filename": "src/confighttp.cpp",
                "status": "modified",
                "additions": 59,
                "deletions": 2,
                "changes": 61,
                "blob_url": "https://github.com/LizardByte/Sunshine/blob/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src%2Fconfighttp.cpp",
                "raw_url": "https://github.com/LizardByte/Sunshine/raw/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src%2Fconfighttp.cpp",
                "contents_url": "https://api.github.com/repos/LizardByte/Sunshine/contents/src%2Fconfighttp.cpp?ref=5fcd07ecb1428bfe245ad6fa349aead476c7e772",
                "patch": "@@ -693,7 +693,8 @@ namespace confighttp {\n       // TODO: Input Validation\n       pt::read_json(ss, inputTree);\n       std::string pin = inputTree.get<std::string>(\"pin\");\n-      outputTree.put(\"status\", nvhttp::pin(pin));\n+      std::string name = inputTree.get<std::string>(\"name\");\n+      outputTree.put(\"status\", nvhttp::pin(pin, name));\n     }\n     catch (std::exception &e) {\n       BOOST_LOG(warning) << \"SavePin: \"sv << e.what();\n@@ -717,6 +718,60 @@ namespace confighttp {\n       response->write(data.str());\n     });\n     nvhttp::erase_all_clients();\n+    proc::proc.terminate();\n+    outputTree.put(\"status\", true);\n+  }\n+\n+  void\n+  unpair(resp_https_t response, req_https_t request) {\n+    if (!authenticate(response, request)) return;\n+\n+    print_req(request);\n+\n+    std::stringstream ss;\n+    ss << request->content.rdbuf();\n+\n+    pt::ptree inputTree, outputTree;\n+\n+    auto g = util::fail_guard([&]() {\n+      std::ostringstream data;\n+      pt::write_json(data, outputTree);\n+      response->write(data.str());\n+    });\n+\n+    try {\n+      // TODO: Input Validation\n+      pt::read_json(ss, inputTree);\n+      std::string uuid = inputTree.get<std::string>(\"uuid\");\n+      outputTree.put(\"status\", nvhttp::unpair_client(uuid));\n+    }\n+    catch (std::exception &e) {\n+      BOOST_LOG(warning) << \"Unpair: \"sv << e.what();\n+      outputTree.put(\"status\", false);\n+      outputTree.put(\"error\", e.what());\n+      return;\n+    }\n+  }\n+\n+  void\n+  listClients(resp_https_t response, req_https_t request) {\n+    if (!authenticate(response, request)) return;\n+\n+    print_req(request);\n+\n+    pt::ptree named_certs = nvhttp::get_all_clients();\n+\n+    pt::ptree outputTree;\n+\n+    outputTree.put(\"status\", false);\n+\n+    auto g = util::fail_guard([&]() {\n+      std::ostringstream data;\n+      pt::write_json(data, outputTree);\n+      response->write(data.str());\n+    });\n+\n+    outputTree.add_child(\"named_certs\", named_certs);\n     outputTree.put(\"status\", true);\n   }\n \n@@ -765,7 +820,9 @@ namespace confighttp {\n     server.resource[\"^/api/restart$\"][\"POST\"] = restart;\n     server.resource[\"^/api/password$\"][\"POST\"] = savePassword;\n     server.resource[\"^/api/apps/([0-9]+)$\"][\"DELETE\"] = deleteApp;\n-    server.resource[\"^/api/clients/unpair$\"][\"POST\"] = unpairAll;\n+    server.resource[\"^/api/clients/unpair-all$\"][\"POST\"] = unpairAll;\n+    server.resource[\"^/api/clients/list$\"][\"GET\"] = listClients;\n+    server.resource[\"^/api/clients/unpair$\"][\"POST\"] = unpair;\n     server.resource[\"^/api/apps/close$\"][\"POST\"] = closeApp;\n     server.resource[\"^/api/covers/upload$\"][\"POST\"] = uploadCover;\n     server.resource[\"^/images/sunshine.ico$\"][\"GET\"] = getFaviconImage;"
            },
            {
                "sha": "f03be3c76b9367a95f0b205acad632db10a9552b",
                "filename": "src/nvhttp.cpp",
                "status": "modified",
                "additions": 132,
                "deletions": 44,
                "changes": 176,
                "blob_url": "https://github.com/LizardByte/Sunshine/blob/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src%2Fnvhttp.cpp",
                "raw_url": "https://github.com/LizardByte/Sunshine/raw/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src%2Fnvhttp.cpp",
                "contents_url": "https://api.github.com/repos/LizardByte/Sunshine/contents/src%2Fnvhttp.cpp?ref=5fcd07ecb1428bfe245ad6fa349aead476c7e772",
                "patch": "@@ -117,9 +117,15 @@ namespace nvhttp {\n     std::string pkey;\n   } conf_intern;\n \n+  struct named_cert_t {\n+    std::string name;\n+    std::string uuid;\n+    std::string cert;\n+  };\n+\n   struct client_t {\n-    std::string uniqueID;\n     std::vector<std::string> certs;\n+    std::vector<named_cert_t> named_devices;\n   };\n \n   struct pair_session_t {\n@@ -145,7 +151,7 @@ namespace nvhttp {\n \n   // uniqueID, session\n   std::unordered_map<std::string, pair_session_t> map_id_sess;\n-  std::unordered_map<std::string, client_t> map_id_client;\n+  client_t client_root;\n   std::atomic<uint32_t> session_id_counter;\n \n   using args_t = SimpleWeb::CaseInsensitiveMultimap;\n@@ -189,22 +195,18 @@ namespace nvhttp {\n     root.erase(\"root\"s);\n \n     root.put(\"root.uniqueid\", http::unique_id);\n-    auto &nodes = root.add_child(\"root.devices\", pt::ptree {});\n-    for (auto &[_, client] : map_id_client) {\n-      pt::ptree node;\n-\n-      node.put(\"uniqueid\"s, client.uniqueID);\n-\n-      pt::ptree cert_nodes;\n-      for (auto &cert : client.certs) {\n-        pt::ptree cert_node;\n-        cert_node.put_value(cert);\n-        cert_nodes.push_back(std::make_pair(\"\"s, cert_node));\n-      }\n-      node.add_child(\"certs\"s, cert_nodes);\n-\n-      nodes.push_back(std::make_pair(\"\"s, node));\n+    client_t &client = client_root;\n+    pt::ptree node;\n+\n+    pt::ptree named_cert_nodes;\n+    for (auto &named_cert : client.named_devices) {\n+      pt::ptree named_cert_node;\n+      named_cert_node.put(\"name\"s, named_cert.name);\n+      named_cert_node.put(\"cert\"s, named_cert.cert);\n+      named_cert_node.put(\"uuid\"s, named_cert.uuid);\n+      named_cert_nodes.push_back(std::make_pair(\"\"s, named_cert_node));\n     }\n+    root.add_child(\"root.named_devices\"s, named_cert_nodes);\n \n     try {\n       pt::write_json(config::nvhttp.file_state, root);\n@@ -223,48 +225,79 @@ namespace nvhttp {\n       return;\n     }\n \n-    pt::ptree root;\n+    pt::ptree tree;\n     try {\n-      pt::read_json(config::nvhttp.file_state, root);\n+      pt::read_json(config::nvhttp.file_state, tree);\n     }\n     catch (std::exception &e) {\n       BOOST_LOG(error) << \"Couldn't read \"sv << config::nvhttp.file_state << \": \"sv << e.what();\n \n       return;\n     }\n \n-    auto unique_id_p = root.get_optional<std::string>(\"root.uniqueid\");\n+    auto unique_id_p = tree.get_optional<std::string>(\"root.uniqueid\");\n     if (!unique_id_p) {\n       // This file doesn't contain moonlight credentials\n       http::unique_id = uuid_util::uuid_t::generate().string();\n       return;\n     }\n     http::unique_id = std::move(*unique_id_p);\n \n-    auto device_nodes = root.get_child(\"root.devices\");\n-\n-    for (auto &[_, device_node] : device_nodes) {\n-      auto uniqID = device_node.get<std::string>(\"uniqueid\");\n-      auto &client = map_id_client.emplace(uniqID, client_t {}).first->second;\n-\n-      client.uniqueID = uniqID;\n+    auto root = tree.get_child(\"root\");\n+    client_t client;\n+\n+    // Import from old format\n+    if (root.get_child_optional(\"devices\")) {\n+      auto device_nodes = root.get_child(\"devices\");\n+      for (auto &[_, device_node] : device_nodes) {\n+        auto uniqID = device_node.get<std::string>(\"uniqueid\");\n+\n+        if (device_node.count(\"certs\")) {\n+          for (auto &[_, el] : device_node.get_child(\"certs\")) {\n+            named_cert_t named_cert;\n+            named_cert.name = \"\"s;\n+            named_cert.cert = el.get_value<std::string>();\n+            named_cert.uuid = uuid_util::uuid_t::generate().string();\n+            client.named_devices.emplace_back(named_cert);\n+            client.certs.emplace_back(named_cert.cert);\n+          }\n+        }\n+      }\n+    }\n \n-      for (auto &[_, el] : device_node.get_child(\"certs\")) {\n-        client.certs.emplace_back(el.get_value<std::string>());\n+    if (root.count(\"named_devices\")) {\n+      for (auto &[_, el] : root.get_child(\"named_devices\")) {\n+        named_cert_t named_cert;\n+        named_cert.name = el.get_child(\"name\").get_value<std::string>();\n+        named_cert.cert = el.get_child(\"cert\").get_value<std::string>();\n+        named_cert.uuid = el.get_child(\"uuid\").get_value<std::string>();\n+        client.named_devices.emplace_back(named_cert);\n+        client.certs.emplace_back(named_cert.cert);\n       }\n     }\n+\n+    // Empty certificate chain and import certs from file\n+    cert_chain.clear();\n+    for (auto &cert : client.certs) {\n+      cert_chain.add(crypto::x509(cert));\n+    }\n+    for (auto &named_cert : client.named_devices) {\n+      cert_chain.add(crypto::x509(named_cert.cert));\n+    }\n+\n+    client_root = client;\n   }\n \n   void\n   update_id_client(const std::string &uniqueID, std::string &&cert, op_e op) {\n     switch (op) {\n       case op_e::ADD: {\n-        auto &client = map_id_client[uniqueID];\n+        client_t &client = client_root;\n         client.certs.emplace_back(std::move(cert));\n-        client.uniqueID = uniqueID;\n       } break;\n       case op_e::REMOVE:\n-        map_id_client.erase(uniqueID);\n+        client_t client;\n+        client_root = client;\n         break;\n     }\n \n@@ -579,15 +612,16 @@ namespace nvhttp {\n   /**\n    * @brief Compare the user supplied pin to the Moonlight pin.\n    * @param pin The user supplied pin.\n+   * @param name The user supplied name.\n    * @return `true` if the pin is correct, `false` otherwise.\n    *\n    * EXAMPLES:\n    * ```cpp\n-   * bool pin_status = nvhttp::pin(\"1234\");\n+   * bool pin_status = nvhttp::pin(\"1234\", \"laptop\");\n    * ```\n    */\n   bool\n-  pin(std::string pin) {\n+  pin(std::string pin, std::string name) {\n     pt::ptree tree;\n     if (map_id_sess.empty()) {\n       return false;\n@@ -613,6 +647,14 @@ namespace nvhttp {\n     auto &sess = std::begin(map_id_sess)->second;\n     getservercert(sess, tree, pin);\n \n+    // set up named cert\n+    client_t &client = client_root;\n+    named_cert_t named_cert;\n+    named_cert.name = name;\n+    named_cert.cert = sess.client.cert;\n+    named_cert.uuid = uuid_util::uuid_t::generate().string();\n+    client.named_devices.emplace_back(named_cert);\n+\n     // response to the request for pin\n     std::ostringstream data;\n     pt::write_xml(data, tree);\n@@ -645,9 +687,7 @@ namespace nvhttp {\n       auto clientID = args.find(\"uniqueid\"s);\n \n       if (clientID != std::end(args)) {\n-        if (auto it = map_id_client.find(clientID->second); it != std::end(map_id_client)) {\n-          pair_status = 1;\n-        }\n+        pair_status = 1;\n       }\n     }\n \n@@ -742,6 +782,20 @@ namespace nvhttp {\n     response->close_connection_after_response = true;\n   }\n \n+  pt::ptree\n+  get_all_clients() {\n+    pt::ptree named_cert_nodes;\n+    client_t &client = client_root;\n+    for (auto &named_cert : client.named_devices) {\n+      pt::ptree named_cert_node;\n+      named_cert_node.put(\"name\"s, named_cert.name);\n+      named_cert_node.put(\"uuid\"s, named_cert.uuid);\n+      named_cert_nodes.push_back(std::make_pair(\"\"s, named_cert_node));\n+    }\n+\n+    return named_cert_nodes;\n+  }\n+\n   void\n   applist(resp_https_t response, req_https_t request) {\n     print_req<SimpleWeb::HTTPS>(request);\n@@ -1020,12 +1074,6 @@ namespace nvhttp {\n     conf_intern.pkey = file_handler::read_file(config::nvhttp.pkey.c_str());\n     conf_intern.servercert = file_handler::read_file(config::nvhttp.cert.c_str());\n \n-    for (auto &[_, client] : map_id_client) {\n-      for (auto &cert : client.certs) {\n-        cert_chain.add(crypto::x509(cert));\n-      }\n-    }\n-\n     auto add_cert = std::make_shared<safe::queue_t<crypto::x509_t>>(30);\n \n     // resume doesn't always get the parameter \"localAudioPlayMode\"\n@@ -1149,8 +1197,48 @@ namespace nvhttp {\n    */\n   void\n   erase_all_clients() {\n-    map_id_client.clear();\n+    client_t client;\n+    client_root = client;\n     cert_chain.clear();\n     save_state();\n   }\n+\n+  /**\n+   * @brief Remove single client.\n+   *\n+   * EXAMPLES:\n+   * ```cpp\n+   * nvhttp::unpair_client(\"4D7BB2DD-5704-A405-B41C-891A022932E1\");\n+   * ```\n+   */\n+  int\n+  unpair_client(std::string uuid) {\n+    int removed = 0;\n+    client_t &client = client_root;\n+    for (auto it = client.named_devices.begin(); it != client.named_devices.end();) {\n+      if ((*it).uuid == uuid) {\n+        // Find matching cert and remove it\n+        for (auto cert = client.certs.begin(); cert != client.certs.end();) {\n+          if ((*cert) == (*it).cert) {\n+            cert = client.certs.erase(cert);\n+            removed++;\n+          }\n+          else {\n+            ++cert;\n+          }\n+        }\n+\n+        // And then remove the named cert\n+        it = client.named_devices.erase(it);\n+        removed++;\n+      }\n+      else {\n+        ++it;\n+      }\n+    }\n+\n+    save_state();\n+    load_state();\n+    return removed;\n+  }\n }  // namespace nvhttp"
            },
            {
                "sha": "6fdf202ac299dba6d0855a69b39dc32bc8ee10a5",
                "filename": "src/nvhttp.h",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/LizardByte/Sunshine/blob/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src%2Fnvhttp.h",
                "raw_url": "https://github.com/LizardByte/Sunshine/raw/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src%2Fnvhttp.h",
                "contents_url": "https://api.github.com/repos/LizardByte/Sunshine/contents/src%2Fnvhttp.h?ref=5fcd07ecb1428bfe245ad6fa349aead476c7e772",
                "patch": "@@ -9,6 +9,9 @@\n // standard includes\n #include <string>\n \n+// lib includes\n+#include <boost/property_tree/ptree.hpp>\n+\n // local includes\n #include \"thread_safe.h\"\n \n@@ -43,7 +46,11 @@ namespace nvhttp {\n   void\n   start();\n   bool\n-  pin(std::string pin);\n+  pin(std::string pin, std::string name);\n+  int\n+  unpair_client(std::string uniqueid);\n+  boost::property_tree::ptree\n+  get_all_clients();\n   void\n   erase_all_clients();\n }  // namespace nvhttp"
            },
            {
                "sha": "d8ce1da5496256e75aaa9bd08310b12d7da8f156",
                "filename": "src_assets/common/assets/web/pin.html",
                "status": "modified",
                "additions": 30,
                "deletions": 28,
                "changes": 58,
                "blob_url": "https://github.com/LizardByte/Sunshine/blob/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src_assets%2Fcommon%2Fassets%2Fweb%2Fpin.html",
                "raw_url": "https://github.com/LizardByte/Sunshine/raw/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src_assets%2Fcommon%2Fassets%2Fweb%2Fpin.html",
                "contents_url": "https://api.github.com/repos/LizardByte/Sunshine/contents/src_assets%2Fcommon%2Fassets%2Fweb%2Fpin.html?ref=5fcd07ecb1428bfe245ad6fa349aead476c7e772",
                "patch": "@@ -8,10 +8,11 @@\n <body id=\"app\" v-cloak>\n   <Navbar></Navbar>\n   <div id=\"content\" class=\"container\">\n-    <h1 class=\"my-4\">{{ $t('pin.pin_pairing') }}</h1>\n-    <form action=\"\" class=\"form d-flex flex-column align-items-center\" id=\"form\">\n+    <h1 class=\"my-4 text-center\">{{ $t('pin.pin_pairing') }}</h1>\n+    <form class=\"form d-flex flex-column align-items-center\" id=\"form\" @submit.prevent=\"registerDevice\">\n       <div class=\"card flex-column d-flex p-4 mb-4\">\n-        <input type=\"text\" pattern=\"\\d*\" placeholder=\"PIN\" autofocus id=\"pin-input\" class=\"form-control my-4\" />\n+        <input type=\"text\" pattern=\"\\d*\" :placeholder=\"`${$t('navbar.pin')}`\" autofocus id=\"pin-input\" class=\"form-control mt-2\" required />\n+        <input type=\"text\" :placeholder=\"`${$t('pin.device_name')}`\" id=\"name-input\" class=\"form-control my-4\" required />\n         <button class=\"btn btn-primary\">{{ $t('pin.send') }}</button>\n       </div>\n       <div class=\"alert alert-warning\">\n@@ -24,37 +25,38 @@ <h1 class=\"my-4\">{{ $t('pin.pin_pairing') }}</h1>\n \n <script type=\"module\">\n   import { createApp } from 'vue'\n-  import i18n from './locale.js'\n+  import { initApp } from './init'\n   import Navbar from './Navbar.vue'\n-  import {initApp} from \"./init\";\n \n   let app = createApp({\n     components: {\n       Navbar\n+    },\n+    inject: ['i18n'],\n+    methods: {\n+      registerDevice(e) {\n+        let pin = document.querySelector(\"#pin-input\").value;\n+        let name = document.querySelector(\"#name-input\").value;\n+        document.querySelector(\"#status\").innerHTML = \"\";\n+        let b = JSON.stringify({pin: pin, name: name});\n+        fetch(\"/api/pin\", {method: \"POST\", body: b})\n+          .then((response) => response.json())\n+          .then((response) => {\n+            if (response.status.toString().toLowerCase() === \"true\") {\n+              document.querySelector(\n+                \"#status\"\n+              ).innerHTML = `<div class=\"alert alert-success\" role=\"alert\">${this.i18n.t('pin.pair_success')}</div>`;\n+              document.querySelector(\"#pin-input\").value = \"\";\n+              document.querySelector(\"#name-input\").value = \"\";\n+            } else {\n+              document.querySelector(\n+                \"#status\"\n+              ).innerHTML = `<div class=\"alert alert-danger\" role=\"alert\">${this.i18n.t('pin.pair_failure')}</div>`;\n+            }\n+          });\n+      }\n     }\n   });\n \n-  initApp(app, (app => {\n-    // this must be after mounting the app\n-    document.querySelector(\"#form\").addEventListener(\"submit\", (e) => {\n-      e.preventDefault();\n-      let pin = document.querySelector(\"#pin-input\").value;\n-      document.querySelector(\"#status\").innerHTML = \"\";\n-      let b = JSON.stringify({ pin: pin });\n-      fetch(\"/api/pin\", { method: \"POST\", body: b })\n-        .then((response) => response.json())\n-        .then((response) => {\n-          if (response.status.toString().toLowerCase() === \"true\") {\n-            document.querySelector(\n-              \"#status\"\n-            ).innerHTML = `<div class=\"alert alert-success\" role=\"alert\">${i18n.global.t('pin.pair_success')}</div>`;\n-            document.querySelector(\"#pin-input\").value = \"\";\n-          } else {\n-            document.querySelector(\n-              \"#status\"\n-            ).innerHTML = `<div class=\"alert alert-danger\" role=\"alert\">${i18n.global.t('pin.pair_failure')}</div>`;\n-          }\n-        });\n-    });\n-  }));\n+  initApp(app);\n </script>"
            },
            {
                "sha": "b0fcb0bd14a0a8820082156244a2596c523e92e2",
                "filename": "src_assets/common/assets/web/public/assets/locale/en.json",
                "status": "modified",
                "additions": 8,
                "deletions": 2,
                "changes": 10,
                "blob_url": "https://github.com/LizardByte/Sunshine/blob/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src_assets%2Fcommon%2Fassets%2Fweb%2Fpublic%2Fassets%2Flocale%2Fen.json",
                "raw_url": "https://github.com/LizardByte/Sunshine/raw/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src_assets%2Fcommon%2Fassets%2Fweb%2Fpublic%2Fassets%2Flocale%2Fen.json",
                "contents_url": "https://api.github.com/repos/LizardByte/Sunshine/contents/src_assets%2Fcommon%2Fassets%2Fweb%2Fpublic%2Fassets%2Flocale%2Fen.json?ref=5fcd07ecb1428bfe245ad6fa349aead476c7e772",
                "patch": "@@ -7,6 +7,7 @@\n     \"cancel\": \"Cancel\",\n     \"disabled\": \"Disabled\",\n     \"disabled_def\": \"Disabled (default)\",\n+    \"dismiss\": \"Dismiss\",\n     \"do_cmd\": \"Do Command\",\n     \"elevated\": \"Elevated\",\n     \"enabled\": \"Enabled\",\n@@ -353,6 +354,7 @@\n     \"success_msg\": \"Password has been changed successfully! This page will reload soon, your browser will ask you for the new credentials.\"\n   },\n   \"pin\": {\n+    \"device_name\": \"Device Name\",\n     \"pair_failure\": \"Pairing Failed: Check if the PIN is typed correctly\",\n     \"pair_success\": \"Success! Please check Moonlight to continue\",\n     \"pin_pairing\": \"PIN Pairing\",\n@@ -382,9 +384,13 @@\n     \"restart_sunshine_success\": \"Sunshine is restarting\",\n     \"troubleshooting\": \"Troubleshooting\",\n     \"unpair_all\": \"Unpair All\",\n-    \"unpair_all_desc\": \"Remove all your paired devices\",\n     \"unpair_all_error\": \"Error while unpairing\",\n-    \"unpair_all_success\": \"Unpair Successful!\"\n+    \"unpair_all_success\": \"All devices unpaired.\",\n+    \"unpair_desc\": \"Remove your paired devices. Individually unpaired devices with an active session will remain connected, but cannot start or resume a session.\",\n+    \"unpair_single_no_devices\": \"There are no paired devices.\",\n+    \"unpair_single_success\": \"However, the device(s) may still be in an active session. Use the 'Force Close' button above to end any open sessions.\",\n+    \"unpair_single_unknown\": \"Unknown Client\",\n+    \"unpair_title\": \"Unpair Devices\"\n   },\n   \"welcome\": {\n     \"confirm_password\": \"Confirm password\","
            },
            {
                "sha": "2a41666054af264054d44655f560f330c0031c29",
                "filename": "src_assets/common/assets/web/troubleshooting.html",
                "status": "modified",
                "additions": 61,
                "deletions": 19,
                "changes": 80,
                "blob_url": "https://github.com/LizardByte/Sunshine/blob/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src_assets%2Fcommon%2Fassets%2Fweb%2Ftroubleshooting.html",
                "raw_url": "https://github.com/LizardByte/Sunshine/raw/5fcd07ecb1428bfe245ad6fa349aead476c7e772/src_assets%2Fcommon%2Fassets%2Fweb%2Ftroubleshooting.html",
                "contents_url": "https://api.github.com/repos/LizardByte/Sunshine/contents/src_assets%2Fcommon%2Fassets%2Fweb%2Ftroubleshooting.html?ref=5fcd07ecb1428bfe245ad6fa349aead476c7e772",
                "patch": "@@ -75,24 +75,39 @@ <h2 id=\"restart\">{{ $t('troubleshooting.restart_sunshine') }}</h2>\n         </div>\n       </div>\n     </div>\n-    <!-- Unpair all Clients -->\n-    <div class=\"card p-2 my-4\">\n+    <!-- Unpair Clients -->\n+    <div class=\"card my-4\">\n       <div class=\"card-body\">\n-        <h2 id=\"unpair\">{{ $t('troubleshooting.unpair_all') }}</h2>\n-        <br>\n-        <p>{{ $t('troubleshooting.unpair_all_desc') }}</p>\n-        <div class=\"alert alert-success\" v-if=\"unpairAllStatus === true\">\n-          {{ $t('troubleshooting.unpair_all_success') }}\n-        </div>\n-        <div class=\"alert alert-danger\" v-if=\"unpairAllStatus === false\">\n-          {{ $t('troubleshooting.unpair_all_error') }}\n-        </div>\n-        <div>\n-          <button class=\"btn btn-danger\" :disabled=\"unpairAllPressed\" @click=\"unpairAll\">\n-            {{ $t('troubleshooting.unpair_all') }}\n-          </button>\n+        <div class=\"p-2\">\n+          <div class=\"d-flex justify-content-end align-items-center\">\n+            <h2 id=\"unpair\" class=\"text-center me-auto\">{{ $t('troubleshooting.unpair_title') }}</h2>\n+            <button class=\"btn btn-danger\" :disabled=\"unpairAllPressed\" @click=\"unpairAll\">\n+              {{ $t('troubleshooting.unpair_all') }}\n+            </button>\n+          </div>\n+          <br />\n+          <p class=\"mb-0\">{{ $t('troubleshooting.unpair_desc') }}</p>\n+          <div id=\"apply-alert\" class=\"alert alert-success d-flex align-items-center mt-3\" :style=\"{ 'display': (showApplyMessage ? 'flex !important': 'none !important') }\">\n+            <div class=\"me-2\"><b>{{ $t('_common.success') }}</b> {{ $t('troubleshooting.unpair_single_success') }}</div>\n+            <button class=\"btn btn-success ms-auto apply\" @click=\"clickedApplyBanner\">{{ $t('_common.dismiss') }}</button>\n+          </div>\n+          <div class=\"alert alert-success mt-3\" v-if=\"unpairAllStatus === true\">\n+            {{ $t('troubleshooting.unpair_all_success') }}\n+          </div>\n+          <div class=\"alert alert-danger mt-3\" v-if=\"unpairAllStatus === false\">\n+            {{ $t('troubleshooting.unpair_all_error') }}\n+          </div>\n         </div>\n       </div>\n+      <ul id=\"client-list\" class=\"list-group list-group-flush list-group-item-light\" v-if=\"clients && clients.length > 0\">\n+        <div v-for=\"client in clients\" class=\"list-group-item d-flex\">\n+          <div class=\"p-2 flex-grow-1\">{{client.name != \"\" ? client.name : $t('troubleshooting.unpair_single_unknown')}}</div><div class=\"me-2 ms-auto btn btn-danger\" @click=\"unpairSingle(client.uuid)\"><i class=\"fas fa-trash\"></i></div>\n+        </div>\n+      </ul>\n+      <ul v-else class=\"list-group list-group-flush list-group-item-light\">\n+        <div class=\"list-group-item p-3 text-center\"><em>{{ $t('troubleshooting.unpair_single_no_devices') }}</em></div>\n+      </ul>\n+      \n     </div>\n     <!-- Logs -->\n     <div class=\"card p-2 my-4\">\n@@ -123,14 +138,16 @@ <h2 id=\"logs\">{{ $t('troubleshooting.logs') }}</h2>\n       },\n       data() {\n         return {\n+          clients: [],\n           closeAppPressed: false,\n           closeAppStatus: null,\n-          unpairAllPressed: false,\n-          unpairAllStatus: null,\n-          restartPressed: false,\n           logs: 'Loading...',\n           logFilter: null,\n           logInterval: null,\n+          restartPressed: false,\n+          showApplyMessage: false,\n+          unpairAllPressed: false,\n+          unpairAllStatus: null,\n         };\n       },\n       computed: {\n@@ -146,6 +163,7 @@ <h2 id=\"logs\">{{ $t('troubleshooting.logs') }}</h2>\n           this.refreshLogs();\n         }, 5000);\n         this.refreshLogs();\n+        this.refreshClients();\n       },\n       beforeDestroy() {\n         clearInterval(this.logInterval);\n@@ -172,16 +190,40 @@ <h2 id=\"logs\">{{ $t('troubleshooting.logs') }}</h2>\n         },\n         unpairAll() {\n           this.unpairAllPressed = true;\n-          fetch(\"/api/clients/unpair\", { method: \"POST\" })\n+          fetch(\"/api/clients/unpair-all\", { method: \"POST\" })\n             .then((r) => r.json())\n             .then((r) => {\n               this.unpairAllPressed = false;\n               this.unpairAllStatus = r.status.toString() === \"true\";\n               setTimeout(() => {\n                 this.unpairAllStatus = null;\n               }, 5000);\n+              this.refreshClients();\n             });\n         },\n+        unpairSingle(uuid) {\n+          fetch(\"/api/clients/unpair\", { method: \"POST\", body: JSON.stringify({ uuid }) }).then(() => {\n+            this.showApplyMessage = true;\n+            this.refreshClients();\n+          });\n+        },\n+        refreshClients() {\n+          fetch(\"/api/clients/list\")\n+            .then((response) => response.json())\n+            .then((response) => {\n+              const clientList = document.querySelector(\"#client-list\");\n+              if (response.status === 'true' && response.named_certs && response.named_certs.length) {\n+                this.clients = response.named_certs.sort((a, b) => {\n+                  return (a.name.toLowerCase() > b.name.toLowerCase() || a.name == \"\" ? 1 : -1)\n+                });\n+              } else {\n+                this.clients = [];\n+              }\n+            });\n+        },\n+        clickedApplyBanner() {\n+          this.showApplyMessage = false;\n+        },\n         copyLogs() {\n           navigator.clipboard.writeText(this.actualLogs);\n         },"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/LizardByte/Sunshine/commits/fd7e68457a134102d1b30af5796c79f2aa623224",
        "url": "https://api.github.com/repos/LizardByte/Sunshine/commits/fd7e68457a134102d1b30af5796c79f2aa623224",
        "html_url": "https://github.com/LizardByte/Sunshine/commit/fd7e68457a134102d1b30af5796c79f2aa623224",
        "message": "Merge commit from fork\n\nPR #2042 introduced another location for storing authorized clients\nbut did not correctly consider how the load/store logic should differ\nfor those places. One location (named_devices) could contain clients\nwhich had not completed pairing, while the other (certs) had only\nfully paired clients.\n\nDespite differences in trust level of clients in each list, the logic\nfor loading/saving config treated them identically. The result is that\nclients that had not successfully completed pairing would be treated\nas fully paired after a state reload.\n\nFix this state confusion by consolidating to a single location for\nauthorized client state and ensuring it only contains information on\nfully paired clients.",
        "files": [
            {
                "sha": "7eec11000089e7b24548a0a9dd4dfd492cfd63a4",
                "filename": "src/nvhttp.cpp",
                "status": "modified",
                "additions": 11,
                "deletions": 39,
                "changes": 50,
                "blob_url": "https://github.com/LizardByte/Sunshine/blob/fd7e68457a134102d1b30af5796c79f2aa623224/src%2Fnvhttp.cpp",
                "raw_url": "https://github.com/LizardByte/Sunshine/raw/fd7e68457a134102d1b30af5796c79f2aa623224/src%2Fnvhttp.cpp",
                "contents_url": "https://api.github.com/repos/LizardByte/Sunshine/contents/src%2Fnvhttp.cpp?ref=fd7e68457a134102d1b30af5796c79f2aa623224",
                "patch": "@@ -142,14 +142,14 @@ namespace nvhttp {\n   };\n \n   struct client_t {\n-    std::vector<std::string> certs;\n     std::vector<named_cert_t> named_devices;\n   };\n \n   struct pair_session_t {\n     struct {\n       std::string uniqueID;\n       std::string cert;\n+      std::string name;\n     } client;\n \n     std::unique_ptr<crypto::aes_t> cipher_key;\n@@ -277,7 +277,6 @@ namespace nvhttp {\n             named_cert.cert = el.get_value<std::string>();\n             named_cert.uuid = uuid_util::uuid_t::generate().string();\n             client.named_devices.emplace_back(named_cert);\n-            client.certs.emplace_back(named_cert.cert);\n           }\n         }\n       }\n@@ -290,15 +289,11 @@ namespace nvhttp {\n         named_cert.cert = el.get_child(\"cert\").get_value<std::string>();\n         named_cert.uuid = el.get_child(\"uuid\").get_value<std::string>();\n         client.named_devices.emplace_back(named_cert);\n-        client.certs.emplace_back(named_cert.cert);\n       }\n     }\n \n     // Empty certificate chain and import certs from file\n     cert_chain.clear();\n-    for (auto &cert : client.certs) {\n-      cert_chain.add(crypto::x509(cert));\n-    }\n     for (auto &named_cert : client.named_devices) {\n       cert_chain.add(crypto::x509(named_cert.cert));\n     }\n@@ -307,17 +302,13 @@ namespace nvhttp {\n   }\n \n   void\n-  update_id_client(const std::string &uniqueID, std::string &&cert, op_e op) {\n-    switch (op) {\n-      case op_e::ADD: {\n-        client_t &client = client_root;\n-        client.certs.emplace_back(std::move(cert));\n-      } break;\n-      case op_e::REMOVE:\n-        client_t client;\n-        client_root = client;\n-        break;\n-    }\n+  add_authorized_client(const std::string &name, std::string &&cert) {\n+    client_t &client = client_root;\n+    named_cert_t named_cert;\n+    named_cert.name = name;\n+    named_cert.cert = std::move(cert);\n+    named_cert.uuid = uuid_util::uuid_t::generate().string();\n+    client.named_devices.emplace_back(named_cert);\n \n     if (!config::sunshine.flags[config::flag::FRESH_STATE]) {\n       save_state();\n@@ -485,9 +476,9 @@ namespace nvhttp {\n       tree.put(\"root.paired\", 1);\n       add_cert->raise(crypto::x509(client.cert));\n \n+      // The client is now successfully paired and will be authorized to connect\n       auto it = map_id_sess.find(client.uniqueID);\n-\n-      update_id_client(client.uniqueID, std::move(client.cert), op_e::ADD);\n+      add_authorized_client(client.name, std::move(client.cert));\n       map_id_sess.erase(it);\n     }\n     else {\n@@ -654,14 +645,7 @@ namespace nvhttp {\n \n     auto &sess = std::begin(map_id_sess)->second;\n     getservercert(sess, tree, pin);\n-\n-    // set up named cert\n-    client_t &client = client_root;\n-    named_cert_t named_cert;\n-    named_cert.name = name;\n-    named_cert.cert = sess.client.cert;\n-    named_cert.uuid = uuid_util::uuid_t::generate().string();\n-    client.named_devices.emplace_back(named_cert);\n+    sess.client.name = name;\n \n     // response to the request for pin\n     std::ostringstream data;\n@@ -1191,18 +1175,6 @@ namespace nvhttp {\n     client_t &client = client_root;\n     for (auto it = client.named_devices.begin(); it != client.named_devices.end();) {\n       if ((*it).uuid == uuid) {\n-        // Find matching cert and remove it\n-        for (auto cert = client.certs.begin(); cert != client.certs.end();) {\n-          if ((*cert) == (*it).cert) {\n-            cert = client.certs.erase(cert);\n-            removed++;\n-          }\n-          else {\n-            ++cert;\n-          }\n-        }\n-\n-        // And then remove the named cert\n         it = client.named_devices.erase(it);\n         removed++;\n       }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/bareos/bareos/commits/2a026698b87d13bd1c6275726b5e826702f81dd5",
        "url": "https://api.github.com/repos/bareos/bareos/commits/2a026698b87d13bd1c6275726b5e826702f81dd5",
        "html_url": "https://github.com/bareos/bareos/commit/2a026698b87d13bd1c6275726b5e826702f81dd5",
        "message": "Merge pull request #1875\n\nFix multiple ACL handling bugs",
        "files": [
            {
                "sha": "3130dceb5f66857443cb93548a863ef907fbb6e2",
                "filename": ".gitignore",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/.gitignore",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/.gitignore",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/.gitignore?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -1,6 +1,9 @@\n # generated version files\n cmake/BareosVersion.cmake\n \n+# python\n+__pycache__\n+\n # docs\n docs/manuals/source/include/autogenerated/*.rst.inc\n docs/manuals/source/include/autogenerated/autosummary/"
            },
            {
                "sha": "a556f188e557e4704897eadae4303fa1d0bd4c66",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/CHANGELOG.md",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/CHANGELOG.md?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -112,6 +112,7 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0\n - fix warnings on FreeBSD 13.3 compiler [PR #1881]\n - dir: fix crash on purge with job without client [PR #1857]\n - fix runtime status [PR #1872]\n+- Fix multiple ACL handling bugs [PR #1875]\n \n [PR #1538]: https://github.com/bareos/bareos/pull/1538\n [PR #1581]: https://github.com/bareos/bareos/pull/1581\n@@ -208,6 +209,7 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0\n [PR #1865]: https://github.com/bareos/bareos/pull/1865\n [PR #1868]: https://github.com/bareos/bareos/pull/1868\n [PR #1872]: https://github.com/bareos/bareos/pull/1872\n+[PR #1875]: https://github.com/bareos/bareos/pull/1875\n [PR #1878]: https://github.com/bareos/bareos/pull/1878\n [PR #1881]: https://github.com/bareos/bareos/pull/1881\n [PR #1883]: https://github.com/bareos/bareos/pull/1883"
            },
            {
                "sha": "c9ea4b7ab7dfa2820f7962c25aab39dc6194fc8e",
                "filename": "core/src/dird/dird_conf.cc",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/core%2Fsrc%2Fdird%2Fdird_conf.cc",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/core%2Fsrc%2Fdird%2Fdird_conf.cc",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/core%2Fsrc%2Fdird%2Fdird_conf.cc?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -174,7 +174,7 @@ static ResourceItem dir_items[] = {\n   { \"CatalogAcl\", CFG_TYPE_ACL, ITEM(resource, ACL_lists), Catalog_ACL, 0, NULL, NULL,\\\n      \"Lists the Catalog resources, this resource has access to. The special keyword *all* allows access to all Catalog resources.\" },\\\n   { \"WhereAcl\", CFG_TYPE_ACL, ITEM(resource, ACL_lists), Where_ACL, 0, NULL, NULL,\\\n-     \"Specifies the base directories, where files could be restored. An empty string allows restores to all directories.\" },\\\n+     \"Specifies the base directories, where files could be restored.\" },\\\n   { \"PluginOptionsAcl\", CFG_TYPE_ACL, ITEM(resource, ACL_lists), PluginOptions_ACL, 0, NULL, NULL,\\\n      \"Specifies the allowed plugin options. An empty strings allows all Plugin Options.\" }\n \n@@ -2790,7 +2790,7 @@ static void StoreAcl(LEX* lc, ResourceItem* item, int index, int pass)\n     LexGetToken(lc, BCT_STRING);\n     if (pass == 1) {\n       if (!IsAclEntryValid(lc->str, msg)) {\n-        Emsg1(M_ERROR, 0, T_(\"Cannot store Acl: %s\\n\"), msg.data());\n+        scan_err1(lc, T_(\"Cannot store Acl: %s\"), msg.data());\n         return;\n       }\n       list->append(strdup(lc->str));"
            },
            {
                "sha": "a9345fe00b2b3214b825de93d144ac5dbd31de51",
                "filename": "core/src/dird/ua_acl.cc",
                "status": "modified",
                "additions": 92,
                "deletions": 131,
                "changes": 223,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/core%2Fsrc%2Fdird%2Fua_acl.cc",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/core%2Fsrc%2Fdird%2Fua_acl.cc",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/core%2Fsrc%2Fdird%2Fua_acl.cc?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -3,7 +3,7 @@\n \n    Copyright (C) 2004-2008 Free Software Foundation Europe e.V.\n    Copyright (C) 2014-2016 Planets Communications B.V.\n-   Copyright (C) 2014-2022 Bareos GmbH & Co. KG\n+   Copyright (C) 2014-2024 Bareos GmbH & Co. KG\n \n    This program is Free Software; you can redistribute it and/or\n    modify it under the terms of version three of the GNU Affero General Public\n@@ -47,141 +47,104 @@ bool UaContext::AclAccessOk(int acl, const char* item, bool audit_event)\n  * A regexp uses the following chars:\n  * ., (, ), [, ], |, ^, $, +, ?, *\n  */\n-static bool is_regex(std::string string_to_check)\n+constexpr bool is_regex(std::string_view string_to_check)\n {\n-  return std::string::npos != string_to_check.find_first_of(\".()[]|^$+?*\");\n+  return string_to_check.npos != string_to_check.find_first_of(\".()[]|^$+?*\");\n }\n \n /**\n- * Loop over the items in the alist and verify if they match the given item\n- * that access was requested for.\n+ * acl_list_value: value of the ACL definition.\n+ * acl_list_compare_value: value ot compare against. This is identical to\n+ * acl_list_value or a modified acl_list_value to compare against.\n  */\n-static inline bool FindInAclList(alist<const char*>* list,\n-                                 int acl,\n-                                 const char* item,\n-                                 int len)\n+static inline bool CompareAclListValueWithItem(\n+    int acl,\n+    const char* acl_list_value,\n+    const char* acl_list_compare_value,\n+    const char* item,\n+    int item_length)\n {\n-  int rc;\n-  regex_t preg{};\n-  int nmatch = 1;\n-  bool retval = false;\n-  regmatch_t pmatch[1]{};\n-  const char* list_value;\n+  // gives full access\n+  if (Bstrcasecmp(\"*all*\", acl_list_compare_value)) {\n+    Dmsg2(1400, \"Global ACL found in %d %s\\n\", acl, acl_list_value);\n+    return true;\n+  }\n \n-  // See if we have an empty list.\n-  if (!list) {\n-    /*\n-     * Empty list for Where => empty where accept anything.\n-     * For any other list, reject everything.\n-     */\n-    if (len == 0 && acl == Where_ACL) {\n-      Dmsg0(1400, \"Empty Where_ACL allowing restore anywhere\\n\");\n-      retval = true;\n-    }\n-    goto bail_out;\n+  if (Bstrcasecmp(item, acl_list_compare_value)) {\n+    // Explicit match.\n+    Dmsg3(1400, \"ACL found %s in %d %s\\n\", item, acl, acl_list_value);\n+    return true;\n   }\n \n-  // Search list for item\n-  for (int i = 0; i < list->size(); i++) {\n-    list_value = (char*)list->get(i);\n+  /* If we didn't get an exact match see if we can use the pattern as a\n+   * regex. */\n+  if (is_regex(acl_list_compare_value)) {\n+    regex_t preg{};\n+    int rc = regcomp(&preg, acl_list_compare_value, REG_EXTENDED | REG_ICASE);\n+    if (rc != 0) {\n+      // Not a valid regular expression so skip it.\n+      Dmsg1(1400, \"Not a valid regex %s, ignoring for regex compare\\n\",\n+            acl_list_value);\n+      return false;\n+    }\n \n-    // See if this is a deny acl.\n-    if (*list_value == '!') {\n-      if (Bstrcasecmp(item, list_value + 1)) {\n-        // Explicit deny.\n-        Dmsg3(1400, \"Deny ACL found %s in %d %s\\n\", item, acl, list_value);\n-        goto bail_out;\n+    int nmatch = 1;\n+    regmatch_t pmatch[1]{};\n+    if (regexec(&preg, item, nmatch, pmatch, 0) == 0) {\n+      // Make sure its not a partial match but a full match.\n+      Dmsg2(1400, \"Found match start offset %d end offset %d\\n\",\n+            pmatch[0].rm_so, pmatch[0].rm_eo);\n+      if ((pmatch[0].rm_eo - pmatch[0].rm_so) >= item_length) {\n+        Dmsg3(1400, \"ACL found %s in %d using regex %s\\n\", item, acl,\n+              acl_list_value);\n+        regfree(&preg);\n+        return true;\n       }\n+    }\n+    regfree(&preg);\n+  }\n+  return false;\n+}\n \n-      /*\n-       * If we didn't get an exact match see if we can use the pattern as a\n-       * regex.\n-       */\n-      if (is_regex(list_value + 1)) {\n-        int match_length;\n-\n-        match_length = strlen(item);\n-        rc = regcomp(&preg, list_value + 1, REG_EXTENDED | REG_ICASE);\n-        if (rc != 0) {\n-          // Not a valid regular expression so skip it.\n-          Dmsg1(1400, \"Not a valid regex %s, ignoring for regex compare\\n\",\n-                list_value);\n-          continue;\n-        }\n-\n-        if (regexec(&preg, item, nmatch, pmatch, 0) == 0) {\n-          // Make sure its not a partial match but a full match.\n-          Dmsg2(1400, \"Found match start offset %d end offset %d\\n\",\n-                pmatch[0].rm_so, pmatch[0].rm_eo);\n-          if ((pmatch[0].rm_eo - pmatch[0].rm_so) >= match_length) {\n-            Dmsg3(1400, \"ACL found %s in %d using regex %s\\n\", item, acl,\n-                  list_value);\n-            regfree(&preg);\n-            goto bail_out;\n-          }\n-        }\n+/**\n+ * Loop over the items in the alist and verify if they match the given item\n+ * that access was requested for.\n+ */\n+static inline std::optional<bool> FindInAclList(alist<const char*>* list,\n+                                                int acl,\n+                                                const char* item,\n+                                                int item_length)\n+{\n+  // See if we have an empty list.\n+  if (!list || list->empty()) { return std::nullopt; }\n \n-        regfree(&preg);\n+  // Search list for item\n+  const char* list_value = nullptr;\n+  foreach_alist (list_value, list) {\n+    // See if this is a deny acl.\n+    if (*list_value == '!') {\n+      if (CompareAclListValueWithItem(acl, list_value, list_value + 1, item,\n+                                      item_length)) {\n+        return false;\n       }\n     } else {\n-      // gives full access\n-      if (Bstrcasecmp(\"*all*\", list_value)) {\n-        Dmsg2(1400, \"Global ACL found in %d %s\\n\", acl, list_value);\n-        retval = true;\n-        goto bail_out;\n-      }\n-\n-      if (Bstrcasecmp(item, list_value)) {\n-        Dmsg3(1400, \"ACL found %s in %d %s\\n\", item, acl, list_value);\n-        retval = true;\n-        goto bail_out;\n-      }\n-\n-      /*\n-       * If we didn't get an exact match see if we can use the pattern as a\n-       * regex.\n-       */\n-      if (is_regex(list_value)) {\n-        int match_length;\n-\n-        match_length = strlen(item);\n-        rc = regcomp(&preg, list_value, REG_EXTENDED | REG_ICASE);\n-        if (rc != 0) {\n-          // Not a valid regular expression so skip it.\n-          Dmsg1(1400, \"Not a valid regex %s, ignoring for regex compare\\n\",\n-                list_value);\n-          continue;\n-        }\n-\n-        if (regexec(&preg, item, nmatch, pmatch, 0) == 0) {\n-          // Make sure its not a partial match but a full match.\n-          Dmsg2(1400, \"Found match start offset %d end offset %d\\n\",\n-                pmatch[0].rm_so, pmatch[0].rm_eo);\n-          if ((pmatch[0].rm_eo - pmatch[0].rm_so) >= match_length) {\n-            Dmsg3(1400, \"ACL found %s in %d using regex %s\\n\", item, acl,\n-                  list_value);\n-            retval = true;\n-            regfree(&preg);\n-            goto bail_out;\n-          }\n-        }\n-\n-        regfree(&preg);\n+      if (CompareAclListValueWithItem(acl, list_value, list_value, item,\n+                                      item_length)) {\n+        return true;\n       }\n     }\n   }\n \n-bail_out:\n-  return retval;\n+  return std::nullopt;\n }\n \n // This version expects the length of the item which we must check.\n bool UaContext::AclAccessOk(int acl,\n                             const char* item,\n-                            int len,\n+                            int item_length,\n                             bool audit_event)\n {\n-  bool retval = false;\n+  std::optional<bool> retval;\n \n   // The resource name contains nasty characters\n   switch (acl) {\n@@ -203,27 +166,29 @@ bool UaContext::AclAccessOk(int acl,\n     goto bail_out;\n   }\n \n-  retval = FindInAclList(user_acl->ACL_lists[acl], acl, item, len);\n+  retval = FindInAclList(user_acl->ACL_lists[acl], acl, item, item_length);\n \n-  /*\n-   * If we didn't find a matching ACL try to use the profiles this console is\n-   * connected to.\n-   */\n-  if (!retval && user_acl->profiles && user_acl->profiles->size()) {\n-    ProfileResource* profile = nullptr;\n+  /* If we didn't find a matching ACL try to use the profiles this console is\n+   * connected to. */\n+  if (!retval.has_value()) {\n+    if (user_acl->profiles && user_acl->profiles->size()) {\n+      ProfileResource* profile = nullptr;\n \n-    foreach_alist (profile, user_acl->profiles) {\n-      retval = FindInAclList(profile->ACL_lists[acl], acl, item, len);\n+      foreach_alist (profile, user_acl->profiles) {\n+        retval = FindInAclList(profile->ACL_lists[acl], acl, item, item_length);\n \n-      // If we found a match break the loop.\n-      if (retval) { break; }\n+        // If we found a match break the loop.\n+        if (retval.has_value()) { break; }\n+      }\n     }\n   }\n \n bail_out:\n-  if (audit_event && !retval) { LogAuditEventAclFailure(acl, item); }\n+  if (audit_event && !retval.value_or(false)) {\n+    LogAuditEventAclFailure(acl, item);\n+  }\n \n-  return retval;\n+  return retval.value_or(false);\n }\n \n /**\n@@ -306,11 +271,9 @@ bool UaContext::IsResAllowed(BareosResource* res)\n \n   acl = RcodeToAcltype(res->rcode_);\n   if (acl == -1) {\n-    /*\n-     * For all resources for which we don't know an explicit mapping\n+    /* For all resources for which we don't know an explicit mapping\n      * to the right ACL we check if the Command ACL has access to the\n-     * configure command just as we do for suppressing sensitive data.\n-     */\n+     * configure command just as we do for suppressing sensitive data. */\n     return AclAccessOk(Command_ACL, \"configure\", false);\n   }\n \n@@ -330,11 +293,9 @@ BareosResource* UaContext::GetResWithName(int rcode,\n \n   acl = RcodeToAcltype(rcode);\n   if (acl == -1) {\n-    /*\n-     * For all resources for which we don't know an explicit mapping\n+    /* For all resources for which we don't know an explicit mapping\n      * to the right ACL we check if the Command ACL has access to the\n-     * configure command just as we do for suppressing sensitive data.\n-     */\n+     * configure command just as we do for suppressing sensitive data. */\n     if (!AclAccessOk(Command_ACL, \"configure\", false)) { goto bail_out; }\n   } else {\n     if (!AclAccessOk(acl, name, audit_event)) { goto bail_out; }"
            },
            {
                "sha": "2a748d17b9b957536f4257373831e9621e981b74",
                "filename": "core/src/dird/ua_cmds.cc",
                "status": "modified",
                "additions": 120,
                "deletions": 128,
                "changes": 248,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/core%2Fsrc%2Fdird%2Fua_cmds.cc",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/core%2Fsrc%2Fdird%2Fua_cmds.cc",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/core%2Fsrc%2Fdird%2Fua_cmds.cc?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -177,9 +177,9 @@ static struct ua_cmdstruct commands[] = {\n     {NT_(\".api\"), DotApiCmd, T_(\"Switch between different api modes\"),\n      NT_(\"[ 0 | 1 | 2 | off | on | json ] [compact=<yes|no>]\"), false, false},\n     {NT_(\".authorized\"), DotAuthorizedCmd, T_(\"Check for authorization\"),\n-     NT_(\"job=<job-name> | client=<client-name> | storage=<storage-name | \\n\"\n-         \"schedule=<schedule-name> | pool=<pool-name> | cmd=<command> | \\n\"\n-         \"fileset=<fileset-name> | catalog=<catalog>\"),\n+     NT_(\"job=<job-name> | client=<client-name> | storage=<storage-name> \"\n+         \"| schedule=<schedule-name> | pool=<pool-name> | cmd=<command> \"\n+         \"| fileset=<fileset-name> | catalog=<catalog>\"),\n      false, false},\n     {NT_(\".catalogs\"), DotCatalogsCmd, T_(\"List all catalog resources\"), NULL,\n      false, false},\n@@ -224,9 +224,9 @@ static struct ua_cmdstruct commands[] = {\n      NT_(\"[enabled | disabled]\"), false, false},\n     {NT_(\".status\"), DotStatusCmd, T_(\"Report status\"),\n      NT_(\"dir ( current | last | header | scheduled | running | terminated ) \"\n-         \"|\\n\"\n+         \"| \"\n          \"storage=<storage> [ header | waitreservation | devices | volumes | \"\n-         \"spooling | running | terminated ] |\\n\"\n+         \"spooling | running | terminated ] | \"\n          \"client=<client> [ header | terminated | running ]\"),\n      false, true},\n     {NT_(\".storages\"), DotStorageCmd, T_(\"List all storage resources\"),\n@@ -303,13 +303,12 @@ static struct ua_cmdstruct commands[] = {\n         \"mode\"),\n      NT_(\"on | off\"), false, false},\n     {NT_(\"help\"), help_cmd, T_(\"Print help on specific command\"),\n-     NT_(\"add autodisplay automount cancel configure create delete disable\\n\"\n-         \"\\tenable estimate exit gui label list llist\\n\"\n-         \"\\tmessages memory mount prune purge quit query\\n\"\n-         \"\\trestore relabel release reload run status\\n\"\n-         \"\\tsetbandwidth setdebug setip show sqlquery time trace truncate \"\n-         \"unmount\\n\"\n-         \"\\tumount update use var version wait\"),\n+     NT_(\"add autodisplay automount cancel configure create delete disable \"\n+         \"enable estimate exit gui label list llist \"\n+         \"messages memory mount prune purge quit query \"\n+         \"restore relabel release reload run status \"\n+         \"setbandwidth setdebug setip show sqlquery time trace truncate \"\n+         \"unmount umount update use var version wait\"),\n      false, false},\n     {NT_(\"import\"), ImportCmd,\n      T_(\"Import volumes from import/export slots to normal slots\"),\n@@ -321,127 +320,126 @@ static struct ua_cmdstruct commands[] = {\n          \"slot=<slot> [ drive = <drivenum>] [ barcodes ] [ encrypt ] [ yes ]\"),\n      false, true},\n     {NT_(\"list\"), list_cmd, T_(\"List objects from catalog\"),\n-     NT_(\"basefiles jobid=<jobid> | basefiles ujobid=<complete_name> |\\n\"\n+     NT_(\"basefiles jobid=<jobid> | basefiles ujobid=<complete_name> | \"\n          \"backups client=<client-name> [fileset=<fileset-name>] \"\n          \"[jobstatus=<status>] [level=<level>] [order=<asc|desc>] \"\n-         \"[limit=<number>] |\\n\"\n-         \"clients | copies jobid=<jobid> |\\n\"\n-         \"files jobid=<jobid> | files ujobid=<complete_name> |\\n\"\n-         \"filesets |\\n\"\n-         \"fileset [ jobid=<jobid> ] | fileset [ ujobid=<complete_name> ] |\\n\"\n-         \"fileset [ filesetid=<filesetid> ] | fileset [ jobid=<jobid> ] |\\n\"\n+         \"[limit=<number>] | \"\n+         \"clients | copies jobid=<jobid> | \"\n+         \"files jobid=<jobid> | files ujobid=<complete_name> | \"\n+         \"filesets | \"\n+         \"fileset [ jobid=<jobid> ] | fileset [ ujobid=<complete_name> ] | \"\n+         \"fileset [ filesetid=<filesetid> ] | fileset [ jobid=<jobid> ] | \"\n          \"jobs [job=<job-name>] [client=<client-name>] [jobstatus=<status>] \"\n          \"[jobtype=<jobtype>] [joblevel=<joblevel>] [volume=<volumename>] \"\n          \"[pool=<pool>] \"\n-         \"[days=<number>] [hours=<number>] [last] [count] |\\n\"\n+         \"[days=<number>] [hours=<number>] [last] [count] | \"\n          \"job=<job-name> [client=<client-name>] [jobstatus=<status>] \"\n          \"[jobtype=<jobtype>] [volume=<volumename>] [days=<number>] \"\n-         \"[hours=<number>] |\\n\"\n-         \"jobid=<jobid> | ujobid=<complete_name> |\\n\"\n-         \"joblog jobid=<jobid> | joblog ujobid=<complete_name> |\\n\"\n-         \"jobmedia jobid=<jobid> | jobmedia ujobid=<complete_name> |\\n\"\n-         \"jobtotals |\\n\"\n-         \"jobstatistics jobid=<jobid> |\\n\"\n-         \"log [ limit=<number> [ offset=<number> ] ] [reverse]|\\n\"\n+         \"[hours=<number>] | \"\n+         \"jobid=<jobid> | ujobid=<complete_name> | \"\n+         \"joblog jobid=<jobid> | joblog ujobid=<complete_name> | \"\n+         \"jobmedia jobid=<jobid> | jobmedia ujobid=<complete_name> | \"\n+         \"jobtotals | \"\n+         \"jobstatistics jobid=<jobid> | \"\n+         \"log [ limit=<number> [ offset=<number> ] ] [reverse]| \"\n          \"media [ jobid=<jobid> | ujobid=<complete_name> | pool=<pool-name> | \"\n-         \"all ] |\\n\"\n-         \"media=<media-name> |\\n\"\n-         \"nextvol job=<job-name> | nextvolume ujobid=<complete_name> |\\n\"\n-         \"pools |\\n\"\n-         \"pool=<pool-name> |\\n\"\n-         \"poolid=<poolid> |\\n\"\n-         \"storages |\\n\"\n+         \"all ] | \"\n+         \"media=<media-name> | \"\n+         \"nextvol job=<job-name> | nextvolume ujobid=<complete_name> | \"\n+         \"pools | \"\n+         \"pool=<pool-name> | \"\n+         \"poolid=<poolid> | \"\n+         \"storages | \"\n          \"volumes [ jobid=<jobid> | ujobid=<complete_name> | pool=<pool-name> \"\n-         \"| all ] [count] |\\n\"\n-         \"volume=<volume-name> |\\n\"\n-         \"volumeid=<volumeid> | mediaid=<volumeid> |\\n\"\n-         \"[current] | [enabled | disabled] |\\n\"\n+         \"| all ] [count] | \"\n+         \"volume=<volume-name> | \"\n+         \"volumeid=<volumeid> | mediaid=<volumeid> | \"\n+         \"[current] | [enabled | disabled] | \"\n          \"[limit=<number> [offset=<number>]]\"),\n      true, true},\n     {NT_(\"llist\"), LlistCmd, T_(\"Full or long list like list command\"),\n-     NT_(\"basefiles jobid=<jobid> | basefiles ujobid=<complete_name> |\\n\"\n+     NT_(\"basefiles jobid=<jobid> | basefiles ujobid=<complete_name> | \"\n          \"backups client=<client-name> [fileset=<fileset-name>] \"\n          \"[jobstatus=<status>] [level=<level>] [order=<asc|desc>] \"\n-         \"[limit=<number>] [days=<number>] [hours=<number>]|\\n\"\n-         \"clients | copies jobid=<jobid> |\\n\"\n-         \"files jobid=<jobid> | files ujobid=<complete_name> |\\n\"\n-         \"filesets |\\n\"\n-         \"fileset jobid=<jobid> | fileset ujobid=<complete_name> |\\n\"\n-         \"fileset [ filesetid=<filesetid> ] | fileset [ jobid=<jobid> ] |\\n\"\n+         \"[limit=<number>] [days=<number>] [hours=<number>] | \"\n+         \"clients | copies jobid=<jobid> | \"\n+         \"files jobid=<jobid> | files ujobid=<complete_name> | \"\n+         \"filesets | \"\n+         \"fileset jobid=<jobid> | fileset ujobid=<complete_name> | \"\n+         \"fileset [ filesetid=<filesetid> ] | fileset [ jobid=<jobid> ] | \"\n          \"jobs [job=<job-name>] [client=<client-name>] [jobstatus=<status>] \"\n          \"[jobtype=<jobtype>] [volume=<volumename>] [pool=<pool>] \"\n          \"[days=<number>] \"\n-         \"[hours=<number>] [last] [count] |\\n\"\n+         \"[hours=<number>] [last] [count] | \"\n          \"job=<job-name> [client=<client-name>] [jobstatus=<status>] \"\n          \"[jobtype=<jobtype>] [joblevel=<joblevel>] [volume=<volumename>] \"\n-         \"[days=<number>] [hours=<number>] |\\n\"\n-         \"jobid=<jobid> | ujobid=<complete_name> |\\n\"\n+         \"[days=<number>] [hours=<number>] | \"\n+         \"jobid=<jobid> | ujobid=<complete_name> | \"\n          \"joblog jobid=<jobid> [count] | joblog ujobid=<complete_name> [count] \"\n-         \"|\\n\"\n-         \"jobmedia jobid=<jobid> | jobmedia ujobid=<complete_name> |\\n\"\n-         \"jobtotals |\\n\"\n-         \"media [ jobid=<jobid> | ujobid=<complete_name> | pool=<pool-name> | \"\n-         \"all ] |\\n\"\n-         \"media=<media-name> |\\n\"\n-         \"nextvol job=<job-name> | nextvolume ujobid=<complete_name> |\\n\"\n-         \"pools |\\n\"\n-         \"pool=<pool-name> |\\n\"\n-         \"poolid=<poolid> |\\n\"\n+         \"| jobmedia jobid=<jobid> | jobmedia ujobid=<complete_name> \"\n+         \"| jobtotals \"\n+         \"| media [ jobid=<jobid> | ujobid=<complete_name> | pool=<pool-name> \"\n+         \"| all ] \"\n+         \"| media=<media-name> | \"\n+         \"nextvol job=<job-name> | nextvolume ujobid=<complete_name> | \"\n+         \"pools | \"\n+         \"pool=<pool-name> | \"\n+         \"poolid=<poolid> | \"\n          \"volumes [ jobid=<jobid> | ujobid=<complete_name> | pool=<pool-name> \"\n-         \"| all ] [count] |\\n\"\n-         \"volume=<volume-name> |\\n\"\n-         \"volumeid=<volumeid> | mediaid=<volumeid> |\\n\"\n-         \"[current] | [enabled | disabled] |\\n\"\n+         \"| all ] [count] | \"\n+         \"volume=<volume-name> | \"\n+         \"volumeid=<volumeid> | mediaid=<volumeid> | \"\n+         \"[current] | [enabled | disabled] | \"\n          \"[limit=<num> [offset=<number>]]\"),\n      true, true},\n     {NT_(\"messages\"), MessagesCmd, T_(\"Display pending messages\"), NT_(\"\"),\n      false, false},\n     {NT_(\"memory\"), MemoryCmd, T_(\"Print current memory usage\"), NT_(\"\"), true,\n      false},\n     {NT_(\"mount\"), MountCmd, T_(\"Mount storage\"),\n-     NT_(\"storage=<storage-name> slot=<num> drive=<drivenum>\\n\"\n-         \"\\tjobid=<jobid> | job=<job-name> | ujobid=<complete_name>\"),\n+     NT_(\"storage=<storage-name> slot=<num> drive=<drivenum> \"\n+         \"jobid=<jobid> | job=<job-name> | ujobid=<complete_name>\"),\n      false, true},\n     {NT_(\"move\"), move_cmd, T_(\"Move slots in an autochanger\"),\n      NT_(\"storage=<storage-name> srcslots=<slot-selection> \"\n          \"dstslots=<slot-selection>\"),\n      true, true},\n     {NT_(\"prune\"), PruneCmd, T_(\"Prune records from catalog\"),\n-     NT_(\"files [client=<client>] [pool=<pool>] [yes] |\\n\"\n-         \"jobs [client=<client>] [pool=<pool>] [yes] |\\n\"\n-         \"volume [all] [=volume] [pool=<pool>] [yes] |\\n\"\n-         \"stats [yes] |\\n\"\n-         \"directory [=directory] [client=<client>] [recursive] [yes] |\\n\"),\n+     NT_(\"files [client=<client>] [pool=<pool>] [yes] | \"\n+         \"jobs [client=<client>] [pool=<pool>] [yes] | \"\n+         \"volume [all] [=volume] [pool=<pool>] [yes] | \"\n+         \"stats [yes] | \"\n+         \"directory [=directory] [client=<client>] [recursive] [yes]\"),\n      true, true},\n     {NT_(\"purge\"), PurgeCmd, T_(\"Purge records from catalog\"),\n      NT_(\"[files [job=<job> | jobid=<jobid> | client=<client> | \"\n-         \"volume=<volume>]] |\\n\"\n+         \"volume=<volume>]] | \"\n          \"[jobs [client=<client> | volume=<volume>] | pool=<pool>] \"\n-         \"[jobstatus=<status>]] |\\n\"\n+         \"[jobstatus=<status>]] | \"\n          \"[volume[=<volume>] [storage=<storage>] [pool=<pool> | allpools] \"\n-         \"[devicetype=<type>] [drive=<drivenum>] [action=<action>]] |\\n\"\n+         \"[devicetype=<type>] [drive=<drivenum>] [action=<action>]] | \"\n          \"[quota [client=<client>]]\"),\n      true, true},\n     {NT_(\"quit\"), quit_cmd, T_(\"Terminate Bconsole session\"), NT_(\"\"), false,\n      false},\n     {NT_(\"query\"), QueryCmd, T_(\"Query catalog\"), NT_(\"\"), false, true},\n     {NT_(\"restore\"), RestoreCmd, T_(\"Restore files\"),\n      NT_(\"where=</path> client=<client-name> storage=<storage-name> \"\n-         \"bootstrap=<file>\\n\"\n-         \"\\trestorejob=<job-name> comment=<text> jobid=<jobid> \"\n-         \"fileset=<fileset-name>\\n\"\n-         \"\\treplace=<always|never|ifolder|ifnewer> \"\n-         \"pluginoptions=<plugin-options-string>\\n\"\n-         \"\\tregexwhere=<regex> fileregex=<regex> \"\n-         \"restoreclient=<client-name> backupformat=<format>\\n\"\n-         \"\\tpool=<pool-name> file=<filename> directory=<directory> \"\n-         \"before=<date>\\n\"\n-         \"\\tstrip_prefix=<prefix> add_prefix=<prefix> add_suffix=<suffix>\\n\"\n-         \"\\tselect=<date> select before current copies done all\"),\n+         \"bootstrap=<file> \"\n+         \"restorejob=<job-name> comment=<text> jobid=<jobid> \"\n+         \"fileset=<fileset-name> \"\n+         \"replace=<always|never|ifolder|ifnewer> \"\n+         \"pluginoptions=<plugin-options-string> \"\n+         \"regexwhere=<regex> fileregex=<regex> \"\n+         \"restoreclient=<client-name> backupformat=<format> \"\n+         \"pool=<pool-name> file=<filename> directory=<directory> \"\n+         \"before=<date> \"\n+         \"strip_prefix=<prefix> add_prefix=<prefix> add_suffix=<suffix> \"\n+         \"select=<date> select before current copies done all\"),\n      false, true},\n     {NT_(\"relabel\"), RelabelCmd, T_(\"Relabel a tape\"),\n-     NT_(\"storage=<storage-name> oldvolume=<old-volume-name>\\n\"\n-         \"\\tvolume=<new-volume-name> pool=<pool-name> [ encrypt ]\"),\n+     NT_(\"storage=<storage-name> oldvolume=<old-volume-name> \"\n+         \" volume=<new-volume-name> pool=<pool-name> [ encrypt ]\"),\n      false, true},\n     {NT_(\"release\"), ReleaseCmd, T_(\"Release storage\"),\n      NT_(\"storage=<storage-name> [ drive=<drivenum> ] [ alldrives ]\"), true,\n@@ -456,29 +454,29 @@ static struct ua_cmdstruct commands[] = {\n      true},\n     {NT_(\"run\"), RunCmd, T_(\"Run a job\"),\n      NT_(\"job=<job-name> client=<client-name> fileset=<fileset-name> \"\n-         \"level=<level>\\n\"\n-         \"\\tstorage=<storage-name> where=<directory-prefix> \"\n-         \"when=<universal-time-specification>\\n\"\n-         \"\\tpool=<pool-name> pluginoptions=<plugin-options-string> \"\n-         \"accurate=<yes|no> comment=<text>\\n\"\n-         \"\\tspooldata=<yes|no> priority=<number> jobid=<jobid> \"\n-         \"catalog=<catalog> migrationjob=<job-name>\\n\"\n-         \"\\tbackupclient=<client-name> backupformat=<format> \"\n-         \"nextpool=<pool-name>\\n\"\n-         \"\\tsince=<universal-time-specification> verifyjob=<job-name> \"\n-         \"verifylist=<verify-list>\\n\"\n-         \"\\tmigrationjob=<complete_name> yes\"),\n+         \"level=<level> \"\n+         \"storage=<storage-name> where=<directory-prefix> \"\n+         \"when=<universal-time-specification> \"\n+         \"pool=<pool-name> pluginoptions=<plugin-options-string> \"\n+         \"accurate=<yes|no> comment=<text> \"\n+         \"spooldata=<yes|no> priority=<number> jobid=<jobid> \"\n+         \"catalog=<catalog> migrationjob=<job-name> \"\n+         \"backupclient=<client-name> backupformat=<format> \"\n+         \"nextpool=<pool-name> \"\n+         \"since=<universal-time-specification> verifyjob=<job-name> \"\n+         \"verifylist=<verify-list> \"\n+         \"migrationjob=<complete_name> [ yes ]\"),\n      false, true},\n     {NT_(\"status\"), StatusCmd, T_(\"Report status\"),\n      NT_(\"all | dir=<dir-name> | director | scheduler | \"\n-         \"schedule=<schedule-name> | client=<client-name> |\\n\"\n-         \"storage=<storage-name> slots | days=<nr_days> | job=<job-name> |\\n\"\n+         \"schedule=<schedule-name> | client=<client-name> | \"\n+         \"storage=<storage-name> slots | days=<nr_days> | job=<job-name> | \"\n          \"subscriptions [detail] [unknown] [all] | configuration\"),\n      true, true},\n     {NT_(\"setbandwidth\"), SetbwlimitCmd, T_(\"Sets bandwidth\"),\n-     NT_(\"client=<client-name> | storage=<storage-name> | jobid=<jobid> |\\n\"\n-         \"\\tjob=<job-name> | ujobid=<unique-jobid> state=<job_state> | all\\n\"\n-         \"\\tlimit=<nn-kbs> [ yes ]\"),\n+     NT_(\"[ client=<client-name> | storage=<storage-name> | jobid=<jobid> \"\n+         \"| job=<job-name> | ujobid=<unique-jobid> state=<job_state> | all ] \"\n+         \"limit=<nn-kbs> [ yes ]\"),\n      true, true},\n     {NT_(\"setdebug\"), SetdebugCmd, T_(\"Sets debug level\"),\n      NT_(\"level=<nn> trace=0/1 timestamp=0/1 client=<client-name> | dir | \"\n@@ -497,14 +495,11 @@ static struct ua_cmdstruct commands[] = {\n          \"message=<message-resource-name> | \"\n          \"pool=<pool-name> | profile=<profile-name> | \"\n          \"schedule=<schedule-name> | storage=<storage-name> \"\n-         \"|\\n\"\n-         \"catalog | clients | consoles | directors | filesets | jobdefs | jobs \"\n-         \"| \"\n-         \"messages | pools | profiles | schedules | storages \"\n-         \"|\\n\"\n-         \"disabled [ clients | jobs | schedules ] \"\n-         \"|\\n\"\n-         \"all [verbose]\"),\n+         \"| catalog | clients | consoles | directors | filesets \"\n+         \"| jobdefs | jobs \"\n+         \"| messages | pools | profiles | schedules | storages \"\n+         \"| disabled [ clients | jobs | schedules ] \"\n+         \"| all [verbose]\"),\n      true, true},\n     {NT_(\"sqlquery\"), SqlqueryCmd, T_(\"Use SQL to query catalog\"), NT_(\"\"),\n      false, true},\n@@ -517,13 +512,13 @@ static struct ua_cmdstruct commands[] = {\n          \"[yes]\"),\n      true, true},\n     {NT_(\"unmount\"), UnmountCmd, T_(\"Unmount storage\"),\n-     NT_(\"storage=<storage-name> [ drive=<drivenum> ]\\n\"\n-         \"\\tjobid=<jobid> | job=<job-name> | ujobid=<complete_name>\"),\n+     NT_(\"storage=<storage-name> [ drive=<drivenum> ] \"\n+         \"jobid=<jobid> | job=<job-name> | ujobid=<complete_name>\"),\n      false, true},\n     {NT_(\"umount\"), UnmountCmd,\n      T_(\"Umount - for old-time Unix guys, see unmount\"),\n-     NT_(\"storage=<storage-name> [ drive=<drivenum> ]\\n\"\n-         \"\\tjobid=<jobid> | job=<job-name> | ujobid=<complete_name>\"),\n+     NT_(\"storage=<storage-name> [ drive=<drivenum> ] \"\n+         \"jobid=<jobid> | job=<job-name> | ujobid=<complete_name>\"),\n      false, true},\n     {NT_(\"update\"), UpdateCmd,\n      T_(\"Update volume, pool, slots, job or statistics\"),\n@@ -532,19 +527,15 @@ static struct ua_cmdstruct commands[] = {\n          \"actiononpurge=<action>] \"\n          \"[pool=<pool-name>] [recycle=<yes/no>] [slot=<number>] \"\n          \"[inchanger=<yes/no>]] \"\n-         \"|\\n\"\n-         \"[pool=<pool-name> \"\n+         \"| [pool=<pool-name> \"\n          \"[maxvolbytes=<size>] [maxvolfiles=<nb>] [maxvoljobs=<nb>]\"\n          \"[enabled=<yes/no>] [recyclepool=<pool-name>] \"\n-         \"[actiononpurge=<action>] |\\n\"\n+         \"[actiononpurge=<action>] | \"\n          \"slots [storage=<storage-name>] [scan]] \"\n-         \"|\\n\"\n-         \"[jobid=<jobid> [jobname=<name>] [starttime=<time-def>] \"\n-         \"[client=<client-name>]\\n\"\n+         \"| [jobid=<jobid> [jobname=<name>] [starttime=<time-def>] \"\n+         \"[client=<client-name>] \"\n          \"[filesetid=<fileset-id>] [jobtype=<job-type>]] \"\n-         \"|\\n\"\n-         \"[stats \"\n-         \"[days=<number>]]\"),\n+         \"| [stats [days=<number>]]\"),\n      true, true},\n     {NT_(\"use\"), use_cmd, T_(\"Use specific catalog\"), NT_(\"catalog=<catalog>\"),\n      false, true},\n@@ -587,16 +578,17 @@ bool Do_a_command(UaContext* ua)\n   len = strlen(ua->argk[0]);\n   for (i = 0; i < comsize; i++) { /* search for command */\n     if (bstrncasecmp(ua->argk[0], commands[i].key, len)) {\n-      // Check if command permitted, but \"quit\" and \"whoami\" is always OK\n-      if (!bstrcmp(ua->argk[0], NT_(\"quit\"))\n-          && !bstrcmp(ua->argk[0], NT_(\"whoami\"))\n-          && !ua->AclAccessOk(Command_ACL, ua->argk[0], true)) {\n+      const char* command = commands[i].key;\n+      // Check if command permitted, but \"exit/quit\" and \"whoami\" is always OK\n+      if (!bstrcmp(command, NT_(\"exit\")) && !bstrcmp(command, NT_(\"quit\"))\n+          && !bstrcmp(command, NT_(\"whoami\"))\n+          && !ua->AclAccessOk(Command_ACL, command, true)) {\n         break;\n       }\n \n       // Check if this command is authorized in RunScript\n       if (ua->runscript && !commands[i].allowed_in_runscript) {\n-        ua->ErrorMsg(T_(\"Can't use %s command in a runscript\"), ua->argk[0]);\n+        ua->ErrorMsg(T_(\"Can't use %s command in a runscript\"), command);\n         break;\n       }\n "
            },
            {
                "sha": "4c8eef73df01461b139d39b6bdfb503ee60b0b98",
                "filename": "core/src/dird/ua_run.cc",
                "status": "modified",
                "additions": 60,
                "deletions": 41,
                "changes": 101,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/core%2Fsrc%2Fdird%2Fua_run.cc",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/core%2Fsrc%2Fdird%2Fua_run.cc",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/core%2Fsrc%2Fdird%2Fua_run.cc?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -2,7 +2,7 @@\n \n    Copyright (C) 2001-2012 Free Software Foundation Europe e.V.\n    Copyright (C) 2011-2016 Planets Communications B.V.\n-   Copyright (C) 2013-2023 Bareos GmbH & Co. KG\n+   Copyright (C) 2013-2024 Bareos GmbH & Co. KG\n \n    This program is Free Software; you can redistribute it and/or\n    modify it under the terms of version three of the GNU Affero General Public\n@@ -49,6 +49,7 @@ static bool DisplayJobParameters(UaContext* ua,\n                                  JobControlRecord* jcr,\n                                  RunContext& rc);\n static void SelectWhereRegexp(UaContext* ua, JobControlRecord* jcr);\n+static bool GetPluginOptions(UaContext* ua, JobControlRecord* jcr);\n static bool ScanCommandLineArguments(UaContext* ua, RunContext& rc);\n static bool ResetRestoreContext(UaContext* ua,\n                                 JobControlRecord* jcr,\n@@ -723,29 +724,29 @@ int ModifyJobParameters(UaContext* ua, JobControlRecord* jcr, RunContext& rc)\n         } else if (jcr->is_JobType(JT_RESTORE)) { /* Where */\n           if (GetCmd(ua, T_(\"Please enter the full path prefix for restore (/ \"\n                             \"for none): \"))) {\n-            if (jcr->RegexWhere) { /* cannot use regexwhere and where */\n-              free(jcr->RegexWhere);\n-              jcr->RegexWhere = NULL;\n-            }\n-            if (jcr->where) {\n-              free(jcr->where);\n-              jcr->where = NULL;\n-            }\n-            if (IsPathSeparator(ua->cmd[0]) && ua->cmd[1] == '\\0') {\n-              ua->cmd[0] = 0;\n+            if (!ua->AclAccessOk(Where_ACL, ua->cmd, true)) {\n+              ua->SendMsg(\n+                  T_(\"No authorization for \\\"where\\\" specification.\\n\"));\n+            } else {\n+              if (jcr->RegexWhere) { /* cannot use regexwhere and where */\n+                free(jcr->RegexWhere);\n+                jcr->RegexWhere = NULL;\n+              }\n+              if (jcr->where) {\n+                free(jcr->where);\n+                jcr->where = NULL;\n+              }\n+              // \"/\" is treated as no prefix.\n+              if (IsPathSeparator(ua->cmd[0]) && ua->cmd[1] == '\\0') {\n+                ua->cmd[0] = 0;\n+              }\n+              jcr->where = strdup(ua->cmd);\n             }\n-            jcr->where = strdup(ua->cmd);\n             goto try_again;\n           }\n         } else { /* Plugin Options */\n-          if (GetCmd(ua, T_(\"Please enter Plugin Options string: \"))) {\n-            if (jcr->dir_impl->plugin_options) {\n-              free(jcr->dir_impl->plugin_options);\n-              jcr->dir_impl->plugin_options = NULL;\n-            }\n-            jcr->dir_impl->plugin_options = strdup(ua->cmd);\n-            goto try_again;\n-          }\n+          GetPluginOptions(ua, jcr);\n+          goto try_again;\n         }\n         break;\n       case 10:\n@@ -754,14 +755,8 @@ int ModifyJobParameters(UaContext* ua, JobControlRecord* jcr, RunContext& rc)\n           SelectWhereRegexp(ua, jcr);\n           goto try_again;\n         } else if (jcr->is_JobType(JT_BACKUP)) {\n-          if (GetCmd(ua, T_(\"Please enter Plugin Options string: \"))) {\n-            if (jcr->dir_impl->plugin_options) {\n-              free(jcr->dir_impl->plugin_options);\n-              jcr->dir_impl->plugin_options = NULL;\n-            }\n-            jcr->dir_impl->plugin_options = strdup(ua->cmd);\n-            goto try_again;\n-          }\n+          GetPluginOptions(ua, jcr);\n+          goto try_again;\n         }\n         break;\n       case 11:\n@@ -788,14 +783,8 @@ int ModifyJobParameters(UaContext* ua, JobControlRecord* jcr, RunContext& rc)\n         goto try_again;\n       case 13:\n         /* Plugin Options */\n-        if (GetCmd(ua, T_(\"Please enter Plugin Options string: \"))) {\n-          if (jcr->dir_impl->plugin_options) {\n-            free(jcr->dir_impl->plugin_options);\n-            jcr->dir_impl->plugin_options = NULL;\n-          }\n-          jcr->dir_impl->plugin_options = strdup(ua->cmd);\n-          goto try_again;\n-        }\n+        GetPluginOptions(ua, jcr);\n+        goto try_again;\n         break;\n       case -1: /* error or cancel */\n         return -1;\n@@ -1059,6 +1048,10 @@ static void SelectWhereRegexp(UaContext* ua, JobControlRecord* jcr)\n     case 3:\n       /* Add rwhere */\n       if (GetCmd(ua, T_(\"Please enter a valid regexp (!from!to!): \"))) {\n+        if (!ua->AclAccessOk(Where_ACL, ua->cmd, true)) {\n+          ua->SendMsg(T_(\"Denied by \\\"WhereACL\\\" configuration.\\n\"));\n+          goto try_again_reg;\n+        }\n         if (rwhere) free(rwhere);\n         rwhere = strdup(ua->cmd);\n       }\n@@ -1125,6 +1118,13 @@ static void SelectWhereRegexp(UaContext* ua, JobControlRecord* jcr)\n     jcr->RegexWhere = (char*)malloc(len * sizeof(char));\n     bregexp_build_where(jcr->RegexWhere, len, strip_prefix, add_prefix,\n                         add_suffix);\n+    if (!ua->AclAccessOk(Where_ACL, jcr->RegexWhere, true)) {\n+      ua->SendMsg(T_(\"Regex (%s) denied by \\\"WhereACL\\\" configuration.\\n\"),\n+                  jcr->RegexWhere);\n+      free(jcr->RegexWhere);\n+      jcr->RegexWhere = NULL;\n+      goto try_again_reg;\n+    }\n   }\n \n   regs = get_bregexps(jcr->RegexWhere);\n@@ -1146,6 +1146,24 @@ static void SelectWhereRegexp(UaContext* ua, JobControlRecord* jcr)\n   if (rwhere) { free(rwhere); }\n }\n \n+static bool GetPluginOptions(UaContext* ua, JobControlRecord* jcr)\n+{\n+  if (GetCmd(ua, T_(\"Please enter Plugin Options string: \"))) {\n+    if (!ua->AclAccessOk(PluginOptions_ACL, ua->cmd, true)) {\n+      ua->SendMsg(\n+          T_(\"No authorization for \\\"PluginOptions\\\" specification.\\n\"));\n+      return false;\n+    }\n+    if (jcr->dir_impl->plugin_options) {\n+      free(jcr->dir_impl->plugin_options);\n+      jcr->dir_impl->plugin_options = NULL;\n+    }\n+    jcr->dir_impl->plugin_options = strdup(ua->cmd);\n+    return true;\n+  }\n+  return false;\n+}\n+\n static void SelectJobLevel(UaContext* ua, JobControlRecord* jcr)\n {\n   if (jcr->is_JobType(JT_BACKUP)) {\n@@ -1606,16 +1624,16 @@ static bool DisplayJobParameters(UaContext* ua,\n       } else {\n         if (ua->api) ua->signal(BNET_RUN_CMD);\n         ua->SendMsg(T_(\"Run Restore job\\n\"\n-                       \"JobName:    %s\\n\"\n-                       \"Bootstrap:  %s\\n\"),\n+                       \"JobName:         %s\\n\"\n+                       \"Bootstrap:       %s\\n\"),\n                     job->resource_name_, NPRT(jcr->RestoreBootstrap));\n \n         /* RegexWhere is take before RestoreWhere */\n         if (jcr->RegexWhere || (job->RegexWhere && !jcr->where)) {\n-          ua->SendMsg(T_(\"RegexWhere: %s\\n\"),\n+          ua->SendMsg(T_(\"RegexWhere:      %s\\n\"),\n                       jcr->RegexWhere ? jcr->RegexWhere : job->RegexWhere);\n         } else {\n-          ua->SendMsg(T_(\"Where:      %s\\n\"),\n+          ua->SendMsg(T_(\"Where:           %s\\n\"),\n                       jcr->where ? jcr->where : NPRT(job->RestoreWhere));\n         }\n \n@@ -1880,7 +1898,8 @@ static bool ScanCommandLineArguments(UaContext* ua, RunContext& rc)\n             }\n             rc.where = ua->argv[i];\n             if (!ua->AclAccessOk(Where_ACL, rc.where, true)) {\n-              ua->SendMsg(T_(\"No authoriztion for \\\"where\\\" specification.\\n\"));\n+              ua->SendMsg(\n+                  T_(\"No authorization for \\\"where\\\" specification.\\n\"));\n               return false;\n             }\n             kw_ok = true;"
            },
            {
                "sha": "db1d8a4ff8b9b347c5b8666c689df9a1b7a8c602",
                "filename": "docs/manuals/source/include/autogenerated/bareos-dir-config-schema.json",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/docs%2Fmanuals%2Fsource%2Finclude%2Fautogenerated%2Fbareos-dir-config-schema.json",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/docs%2Fmanuals%2Fsource%2Finclude%2Fautogenerated%2Fbareos-dir-config-schema.json",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/docs%2Fmanuals%2Fsource%2Finclude%2Fautogenerated%2Fbareos-dir-config-schema.json?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -2384,7 +2384,7 @@\n           \"datatype\": \"ACL\",\n           \"code\": 8,\n           \"equals\": true,\n-          \"description\": \"Specifies the base directories, where files could be restored. An empty string allows restores to all directories.\"\n+          \"description\": \"Specifies the base directories, where files could be restored.\"\n         },\n         \"PluginOptionsAcl\": {\n           \"datatype\": \"ACL\",\n@@ -2463,7 +2463,7 @@\n           \"datatype\": \"ACL\",\n           \"code\": 8,\n           \"equals\": true,\n-          \"description\": \"Specifies the base directories, where files could be restored. An empty string allows restores to all directories.\"\n+          \"description\": \"Specifies the base directories, where files could be restored.\"\n         },\n         \"PluginOptionsAcl\": {\n           \"datatype\": \"ACL\",\n@@ -2651,7 +2651,7 @@\n           \"datatype\": \"ACL\",\n           \"code\": 8,\n           \"equals\": true,\n-          \"description\": \"Specifies the base directories, where files could be restored. An empty string allows restores to all directories.\"\n+          \"description\": \"Specifies the base directories, where files could be restored.\"\n         },\n         \"PluginOptionsAcl\": {\n           \"datatype\": \"ACL\","
            },
            {
                "sha": "6a32c1a2479322f9bd34f0431a803989ac20904d",
                "filename": "docs/manuals/source/manually_added_config_directive_descriptions/dir-console-WhereAcl.rst.inc",
                "status": "modified",
                "additions": 9,
                "deletions": 2,
                "changes": 11,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/docs%2Fmanuals%2Fsource%2Fmanually_added_config_directive_descriptions%2Fdir-console-WhereAcl.rst.inc",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/docs%2Fmanuals%2Fsource%2Fmanually_added_config_directive_descriptions%2Fdir-console-WhereAcl.rst.inc",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/docs%2Fmanuals%2Fsource%2Fmanually_added_config_directive_descriptions%2Fdir-console-WhereAcl.rst.inc?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -1,2 +1,9 @@\n-This directive permits you to specify where a restricted console can restore files. If this directive is not specified, only the default restore location is permitted (normally :file:`/tmp/bareos-restores`. If :strong:`*all*` is specified any path the user enters will be accepted. Any other value specified (there may be multiple :strong:`Where ACL`\\  directives) will restrict the user to use that path. For example, on a Unix system, if you specify\n-\"/\", the file will be restored to the original location.\n+This directive permits you to specify where a restricted console can restore files.\n+This ACL is only evaluated when changing the default restore path\n+specified in the restore job (typically :file:`/tmp/bareos-restores`).\n+If :strong:`*all*` is specified any path the user enters will be accepted.\n+Any other value specified\n+(there may be multiple :strong:`Where ACL`\\  directives)\n+will restrict the user to use that path.\n+For example, on a Unix system, if you specify \"/\",\n+the file will be restored to the original location."
            },
            {
                "sha": "effc9a17f9f786bb246837d3e6a3fa2d9f55236e",
                "filename": "python-bareos/.gitignore",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/python-bareos%2F.gitignore",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/python-bareos%2F.gitignore",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/python-bareos%2F.gitignore?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -16,7 +16,6 @@ develop-eggs\n .installed.cfg\n lib\n lib64\n-__pycache__\n \n # Installer logs\n pip-log.txt"
            },
            {
                "sha": "7798cb74f1832eb1318126b021648fd69edf0003",
                "filename": "systemtests/python-modules/bareos_unittest/json.py",
                "status": "modified",
                "additions": 46,
                "deletions": 24,
                "changes": 70,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Fpython-modules%2Fbareos_unittest%2Fjson.py",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Fpython-modules%2Fbareos_unittest%2Fjson.py",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Fpython-modules%2Fbareos_unittest%2Fjson.py?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -2,7 +2,7 @@\n #\n #   BAREOS - Backup Archiving REcovery Open Sourced\n #\n-#   Copyright (C) 2019-2022 Bareos GmbH & Co. KG\n+#   Copyright (C) 2019-2024 Bareos GmbH & Co. KG\n #\n #   This program is Free Software; you can redistribute it and/or\n #   modify it under the terms of version three of the GNU Affero General Public\n@@ -51,12 +51,20 @@ def check_resource(director, resourcesname, name):\n         logger = logging.getLogger()\n         rc = False\n         try:\n-            result = director.call(u\".{}\".format(resourcesname))\n-            for i in result[resourcesname]:\n-                if i[\"name\"] == name:\n-                    rc = True\n+            # .<resourcesname> only returns one result key,\n+            # but that can differ slightly from the called command,\n+            # e.g. \".console\" returns\n+            # \"result\": { \"consoles\": [ ... ] }\n+            # Therefore we check \"all\" keys of result\n+            # and do a substring match.\n+            result = director.call(\".{}\".format(resourcesname))\n+            for resourcetype in result.keys():\n+                if resourcetype.startswith(resourcesname):\n+                    for i in result[resourcetype]:\n+                        if i[\"name\"] == name:\n+                            rc = True\n         except Exception as e:\n-            logger.warn(str(e))\n+            logger.warning(str(e))\n         return rc\n \n     @staticmethod\n@@ -73,12 +81,10 @@ def configure_add(self, director, resourcesname, resourcename, cmd):\n             self.assertEqual(result[\"configure\"][\"add\"][\"name\"], resourcename)\n             self.assertTrue(\n                 self.check_resource(director, resourcesname, resourcename),\n-                u\"Failed to find resource {} in {}.\".format(\n-                    resourcename, resourcesname\n-                ),\n+                \"Failed to find resource {} in {}.\".format(resourcename, resourcesname),\n             )\n \n-    def wait_job(self, director, jobId, expected_status=u\"OK\"):\n+    def wait_job(self, director, jobId, expected_status=\"OK\"):\n         result = director.call(\"wait jobid={}\".format(jobId))\n         # \"result\": {\n         #    \"job\": {\n@@ -90,14 +96,14 @@ def wait_job(self, director, jobId, expected_status=u\"OK\"):\n         # }\n         self.assertEqual(result[\"job\"][\"jobstatuslong\"], expected_status)\n \n-    def run_job(self, director, jobname=None, level=None, extra=None, wait=False):\n+    def run_job(self, director, jobname, level=None, extra=None, wait=False):\n         logger = logging.getLogger()\n         run_parameter = [\"job={}\".format(jobname), \"yes\"]\n         if level:\n-            run_parameter.append(u\"level={}\".format(level))\n+            run_parameter.append(\"level={}\".format(level))\n         if extra:\n-            run_parameter.append(u\"{}\".format(extra))\n-        result = director.call(\"run {}\".format(u\" \".join(run_parameter)))\n+            run_parameter.append(\"{}\".format(extra))\n+        result = director.call(\"run {}\".format(\" \".join(run_parameter)))\n         jobId = result[\"run\"][\"jobid\"]\n         if wait:\n             self.wait_job(director, jobId)\n@@ -115,29 +121,45 @@ def run_restore(\n     ):\n         logger = logging.getLogger()\n         run_parameter = [\"client={}\".format(client)]\n-\n         if jobname:\n-            run_parameter.append(u\"restorejob={}\".format(jobname))\n+            run_parameter.append(\"restorejob={}\".format(jobname))\n         if jobid:\n-            run_parameter.append(u\"jobid={}\".format(jobid))\n+            run_parameter.append(\"jobid={}\".format(jobid))\n         if fileset:\n-            run_parameter.append(u\"fileset={}\".format(fileset))\n+            run_parameter.append(\"fileset={}\".format(fileset))\n         if extra:\n-            run_parameter.append(u\"{}\".format(extra))\n+            run_parameter.append(\"{}\".format(extra))\n         run_parameter += [\"select\", \"all\", \"done\", \"yes\"]\n-        result = director.call(\"restore {}\".format(u\" \".join(run_parameter)))\n+        result = director.call(\"restore {}\".format(\" \".join(run_parameter)))\n         jobId = result[\"run\"][\"jobid\"]\n         if wait:\n             self.wait_job(director, jobId)\n         return jobId\n \n+    def get_backup_jobid(self, director, jobname, level=\"F\", extra=None):\n+        \"\"\"\n+        Get a valid backup job jobid.\n+        If no such job exists,\n+        run such a job.\n+        \"\"\"\n+        result = director.call(\n+            \"list jobs job={} level={} jobstatus=T last\".format(jobname, level)\n+        )\n+        try:\n+            jobid = result[\"jobs\"][0][\"jobid\"]\n+            return jobid\n+        except IndexError:\n+            # there is no valid backup for these parameters.\n+            # run a backup job.\n+            return self.run_job(director, jobname, level, extra, wait=True)\n+\n     def _test_job_result(self, jobs, jobid):\n         logger = logging.getLogger()\n         for job in jobs:\n             if job[\"jobid\"] == jobid:\n                 files = int(job[\"jobfiles\"])\n-                logger.debug(u\"Job {} contains {} files.\".format(jobid, files))\n-                self.assertTrue(files >= 1, u\"Job {} contains no files.\".format(jobid))\n+                logger.debug(\"Job {} contains {} files.\".format(jobid, files))\n+                self.assertTrue(files >= 1, \"Job {} contains no files.\".format(jobid))\n                 return True\n         self.fail(\"Failed to find job {}\".format(jobid))\n         # add return to prevent pylint warning\n@@ -184,7 +206,7 @@ def _test_list_with_invalid_jobid(self, director, jobid):\n             self.assertEqual(\n                 len(result),\n                 0,\n-                u\"Command {} should not return results. Current result: {} visible\".format(\n+                \"Command {} should not return results. Current result: {} visible\".format(\n                     listcmd, str(result)\n                 ),\n             )\n@@ -222,4 +244,4 @@ def list_jobid(self, director, jobid):\n         try:\n             return result[\"jobs\"][0]\n         except KeyError:\n-            raise ValueError(u\"jobid {} does not exist\".format(jobid))\n+            raise ValueError(\"jobid {} does not exist\".format(jobid))"
            },
            {
                "sha": "0c38be74288315160cd86c559a0c6a2d7fd98faa",
                "filename": "systemtests/tests/CMakeLists.txt",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2FCMakeLists.txt",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2FCMakeLists.txt",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2FCMakeLists.txt?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -37,7 +37,6 @@ add_subdirectory(chflags)\n add_subdirectory(client-initiated)\n add_subdirectory(commandline-options)\n add_subdirectory(config-dump)\n-add_subdirectory(config-syntax-crash)\n add_subdirectory(copy-migrate)\n add_subdirectory(copy-archive-job)\n add_subdirectory(copy-remote-bscan)"
            },
            {
                "sha": "cfd54bc58685ffac377dcdc059adad1b832633c7",
                "filename": "systemtests/tests/config-syntax-crash/CMakeLists.txt",
                "status": "removed",
                "additions": 0,
                "deletions": 21,
                "changes": 21,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2FCMakeLists.txt",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2FCMakeLists.txt",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2FCMakeLists.txt?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,21 +0,0 @@\n-#   BAREOS\u00ae - Backup Archiving REcovery Open Sourced\n-#\n-#   Copyright (C) 2021-2021 Bareos GmbH & Co. KG\n-#\n-#   This program is Free Software; you can redistribute it and/or\n-#   modify it under the terms of version three of the GNU Affero General Public\n-#   License as published by the Free Software Foundation and included\n-#   in the file LICENSE.\n-#\n-#   This program is distributed in the hope that it will be useful, but\n-#   WITHOUT ANY WARRANTY; without even the implied warranty of\n-#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n-#   Affero General Public License for more details.\n-#\n-#   You should have received a copy of the GNU Affero General Public License\n-#   along with this program; if not, write to the Free Software\n-#   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA\n-#   02110-1301, USA.\n-\n-get_filename_component(BASENAME ${CMAKE_CURRENT_BINARY_DIR} NAME)\n-create_systemtest(${SYSTEMTEST_PREFIX} ${BASENAME})"
            },
            {
                "sha": "3c3385945f0dc214876748fa81a45a950ba17bf2",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/catalog/MyCatalog.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fcatalog%2FMyCatalog.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fcatalog%2FMyCatalog.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fcatalog%2FMyCatalog.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,6 +0,0 @@\n-Catalog {\n-  Name = MyCatalog\n-  dbname = \"@db_name@\"\n-  dbuser = \"@db_user@\"\n-  dbpassword = \"@db_password@\"\n-}"
            },
            {
                "sha": "59b61700966d7090483f8e54b752a3989a7de066",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/client/bareos-fd.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 7,
                "changes": 7,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fclient%2Fbareos-fd.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fclient%2Fbareos-fd.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fclient%2Fbareos-fd.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,7 +0,0 @@\n-Client {\n-  Name = bareos-fd\n-  Description = \"Client resource of the Director itself.\"\n-  Address = @hostname@\n-  Password = \"@fd_password@\"          # password for FileDaemon\n-  FD PORT = @fd_port@\n-}"
            },
            {
                "sha": "2bc45b7dd107263505ca7bc0b5af3ff93a4fdba8",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/director/bareos-dir.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 23,
                "changes": 23,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fdirector%2Fbareos-dir.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fdirector%2Fbareos-dir.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fdirector%2Fbareos-dir.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,23 +0,0 @@\n-Director {                            # define myself\n-  Name = bareos-dir\n-  QueryFile = \"@scriptdir@/query.sql\"\n-  Maximum Concurrent Jobs = 10\n-  Password = \"@dir_password@\"         # Console password\n-  Messages = Daemon\n-  Auditing = yes\n-\n-  # Enable the Heartbeat if you experience connection losses\n-  # (eg. because of your router or firewall configuration).\n-  # Additionally the Heartbeat can be enabled in bareos-sd and bareos-fd.\n-  #\n-  # Heartbeat Interval = 1 min\n-\n-  # remove comment from \"Plugin Directory\" to load plugins from specified directory.\n-  # if \"Plugin Names\" is defined, only the specified plugins will be loaded,\n-  # otherwise all director plugins (*-dir.so) from the \"Plugin Directory\".\n-  #\n-  # Plugin Directory = \"@python_plugin_module_src_dir@\"\n-  # Plugin Names = \"\"\n-  Working Directory =  \"@working_dir@\"\n-  DirPort = @dir_port@\n-}"
            },
            {
                "sha": "1dbd17581cff1e3cec4756b241b5c05e8b6fa5c1",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/fileset/Catalog.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 11,
                "changes": 11,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Ffileset%2FCatalog.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Ffileset%2FCatalog.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Ffileset%2FCatalog.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,11 +0,0 @@\n-FileSet {\n-  Name = \"Catalog\"\n-  Description = \"Backup the catalog dump and Bareos configuration files.\"\n-  Include {\n-    Options {\n-      Signature = XXH128\n-    }\n-    File = \"@working_dir@/@db_name@.sql\" # database dump\n-    File = \"@confdir@\"                   # configuration\n-  }\n-}"
            },
            {
                "sha": "e2acb53b5838fbc45da528f1088a80f38e72c5f8",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/fileset/SelfTest.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 11,
                "changes": 11,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Ffileset%2FSelfTest.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Ffileset%2FSelfTest.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Ffileset%2FSelfTest.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,11 +0,0 @@\n-FileSet {\n-  Name = \"SelfTest\"\n-  Description = \"fileset just to backup some files for selftest\"\n-  Include {\n-    Options {\n-      Signature = XXH128\n-    }\n-   #File = \"@sbindir@\"\n-    File=<@tmpdir@/file-list\n-  }\n-}"
            },
            {
                "sha": "89256864d9af783f17b0038e50794a6ec0e70b83",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/job/RestoreFiles.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 11,
                "changes": 11,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fjob%2FRestoreFiles.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fjob%2FRestoreFiles.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fjob%2FRestoreFiles.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,11 +0,0 @@\n-Job {\n-  Name = \"RestoreFiles\"\n-  Description = \"Standard Restore template. Only one such job is needed for all standard Jobs/Clients/Storage ...\"\n-  Type = Restore\n-  Client = bareos-fd\n-  FileSet = SelfTest\n-  Storage = File\n-  Pool = Incremental\n-  Messages = Standard\n-  Where = @tmp@/bareos-restores\n-}"
            },
            {
                "sha": "ca1891f9620772deca8aaebfe018b6141da02d45",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/job/backup-bareos-fd.conf",
                "status": "removed",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fjob%2Fbackup-bareos-fd.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fjob%2Fbackup-bareos-fd.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fjob%2Fbackup-bareos-fd.conf?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,5 +0,0 @@\n-Job {\n-  Name = \"backup-bareos-fd\"\n-  JobDefs = \"DefaultJob\"\n-  Client = \"bareos-fd\"\n-}"
            },
            {
                "sha": "563126477c9b93fd2133b4a544c200cad5a77c16",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/jobdefs/DefaultJob.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 15,
                "changes": 15,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fjobdefs%2FDefaultJob.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fjobdefs%2FDefaultJob.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fjobdefs%2FDefaultJob.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,15 +0,0 @@\n-JobDefs {\n-  Name = \"DefaultJob\"\n-  Type = Backup\n-  Level = Incremental\n-  Client = bareos-fd\n-  FileSet = \"SelfTest\"\n-  Storage = File\n-  Messages = Standard\n-  Pool = Incremental\n-  Priority = 10\n-  Write Bootstrap = \"@working_dir@/%c.bsr\"\n-  Full Backup Pool = Full                  # write Full Backups into \"Full\" Pool\n-  Differential Backup Pool = Differential  # write Diff Backups into \"Differential\" Pool\n-  Incremental Backup Pool = Incremental    # write Incr Backups into \"Incremental\" Pool\n-}"
            },
            {
                "sha": "cf6a8cfa1e202db11ae4f1a3aa40e569f65d6646",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/messages/Daemon.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 7,
                "changes": 7,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fmessages%2FDaemon.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fmessages%2FDaemon.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fmessages%2FDaemon.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,7 +0,0 @@\n-Messages {\n-  Name = Daemon\n-  Description = \"Message delivery for daemon messages (no job).\"\n-  console = all, !skipped, !saved, !audit\n-  append = \"@logdir@/bareos.log\" = all, !skipped, !audit\n-  append = \"@logdir@/bareos-audit.log\" = audit\n-}"
            },
            {
                "sha": "b3556ba8c231b5d6a225f6eac28aad3cf7203743",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/messages/Standard.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 7,
                "changes": 7,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fmessages%2FStandard.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fmessages%2FStandard.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fmessages%2FStandard.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,7 +0,0 @@\n-Messages {\n-  Name = Standard\n-  Description = \"Reasonable message delivery -- send most everything to email address and to the console.\"\n-  console = all, !skipped, !saved, !audit\n-  append = \"@logdir@/bareos.log\" = all, !skipped, !saved, !audit\n-  catalog = all, !skipped, !saved, !audit\n-}"
            },
            {
                "sha": "25ce24821ab95a68e01e621bbc4ab712fe17f33b",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/pool/Differential.conf",
                "status": "removed",
                "additions": 0,
                "deletions": 10,
                "changes": 10,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FDifferential.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FDifferential.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FDifferential.conf?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,10 +0,0 @@\n-Pool {\n-  Name = Differential\n-  Pool Type = Backup\n-  Recycle = yes                       # Bareos can automatically recycle Volumes\n-  AutoPrune = yes                     # Prune expired volumes\n-  Volume Retention = 90 days          # How long should the Differential Backups be kept? (#09)\n-  Maximum Volume Bytes = 10G          # Limit Volume size to something reasonable\n-  Maximum Volumes = 100               # Limit number of Volumes in Pool\n-  Label Format = \"Differential-\"      # Volumes will be labeled \"Differential-<volume-id>\"\n-}"
            },
            {
                "sha": "867fc66b4830ca85b3887f4a056fdbcac2db6258",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/pool/Full.conf",
                "status": "removed",
                "additions": 0,
                "deletions": 10,
                "changes": 10,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FFull.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FFull.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FFull.conf?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,10 +0,0 @@\n-Pool {\n-  Name = Full\n-  Pool Type = Backup\n-  Recycle = yes                       # Bareos can automatically recycle Volumes\n-  AutoPrune = yes                     # Prune expired volumes\n-  Volume Retention = 365 days         # How long should the Full Backups be kept? (#06)\n-  Maximum Volume Bytes = 50G          # Limit Volume size to something reasonable\n-  Maximum Volumes = 100               # Limit number of Volumes in Pool\n-  Label Format = \"Full-\"              # Volumes will be labeled \"Full-<volume-id>\"\n-}"
            },
            {
                "sha": "f4dbbab6650f00071b80af7d36e05d820abd5944",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/pool/Incremental.conf",
                "status": "removed",
                "additions": 0,
                "deletions": 10,
                "changes": 10,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FIncremental.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FIncremental.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FIncremental.conf?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,10 +0,0 @@\n-Pool {\n-  Name = Incremental\n-  Pool Type = Backup\n-  Recycle = yes                       # Bareos can automatically recycle Volumes\n-  AutoPrune = yes                     # Prune expired volumes\n-  Volume Retention = 30 days          # How long should the Incremental Backups be kept?  (#12)\n-  Maximum Volume Bytes = 1G           # Limit Volume size to something reasonable\n-  Maximum Volumes = 100               # Limit number of Volumes in Pool\n-  Label Format = \"Incremental-\"       # Volumes will be labeled \"Incremental-<volume-id>\"\n-}"
            },
            {
                "sha": "3a489b19871a36e8c596020ca203e68d444f4a1b",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/pool/Scratch.conf",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FScratch.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FScratch.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fpool%2FScratch.conf?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,4 +0,0 @@\n-Pool {\n-  Name = Scratch\n-  Pool Type = Scratch\n-}"
            },
            {
                "sha": "94747ffb39b899a5a205907983c11a0faec71252",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/profile/operator.conf",
                "status": "removed",
                "additions": 0,
                "deletions": 18,
                "changes": 18,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fprofile%2Foperator.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fprofile%2Foperator.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fprofile%2Foperator.conf?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,18 +0,0 @@\n-Profile {\n-   Name = operator\n-   Description = \"Profile allowing normal Bareos operations.\"\n-\n-   Command ACL = !.bvfs_clear_cache, !.exit, !.sql\n-   Command ACL = !configure, !create, !delete, !purge, !prune, !sqlquery, !umount, !unmount\n-   Command ACL = *all*\n-\n-   Catalog ACL = *all*\n-   Client ACL = *all*\n-   FileSet ACL = *all*\n-   Job ACL = *all*\n-   Plugin Options ACL = *all*\n-   Pool ACL = *all*\n-   Schedule ACL = *all*\n-   Storage ACL = *all*\n-   Where ACL = \"|!(){}\" # invalid chars\n-}"
            },
            {
                "sha": "a2622f719e2f114962eab4b13985a0253bba2d3c",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/storage/File.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 8,
                "changes": 8,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fstorage%2FFile.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fstorage%2FFile.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-dir.d%2Fstorage%2FFile.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,8 +0,0 @@\n-Storage {\n-  Name = File\n-  Address = @hostname@\n-  Password = \"@sd_password@\"\n-  Device = FileStorage\n-  Media Type = File\n-  SD Port = @sd_port@\n-}"
            },
            {
                "sha": "98a085900fe1c38ea906038c67b10cacb83a85ec",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-fd.d/client/myself.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 15,
                "changes": 15,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-fd.d%2Fclient%2Fmyself.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-fd.d%2Fclient%2Fmyself.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-fd.d%2Fclient%2Fmyself.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,15 +0,0 @@\n-Client {\n-  Name = @basename@-fd\n-  Maximum Concurrent Jobs = 20\n-\n-  # remove comment from \"Plugin Directory\" to load plugins from specified directory.\n-  # if \"Plugin Names\" is defined, only the specified plugins will be loaded,\n-  # otherwise all filedaemon plugins (*-fd.so) from the \"Plugin Directory\".\n-  #\n-  # Plugin Directory = \"@python_plugin_module_src_fd@\"\n-  # Plugin Names = \"\"\n-\n-  Working Directory =  \"@working_dir@\"\n-  FD Port = @fd_port@\n-\n-}"
            },
            {
                "sha": "c8dc7085a457d25d1c64f2145dc13466deb03845",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-fd.d/director/bareos-dir.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-fd.d%2Fdirector%2Fbareos-dir.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-fd.d%2Fdirector%2Fbareos-dir.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-fd.d%2Fdirector%2Fbareos-dir.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,5 +0,0 @@\n-Director {\n-  Name = bareos-dir\n-  Password = \"@fd_password@\"\n-  Description = \"Allow the configured Director to access this file daemon.\"\n-}"
            },
            {
                "sha": "97788e00573f1aa8ae21a29c2850a49c22efe810",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-fd.d/messages/Standard.conf",
                "status": "removed",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-fd.d%2Fmessages%2FStandard.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-fd.d%2Fmessages%2FStandard.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-fd.d%2Fmessages%2FStandard.conf?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,5 +0,0 @@\n-Messages {\n-  Name = Standard\n-  Director = bareos-dir = all, !skipped, !restored\n-  Description = \"Send relevant messages to the Director.\"\n-}"
            },
            {
                "sha": "11a639bc688f94b667743d891edd4097c9b5fc42",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-sd.d/device/FileStorage.conf",
                "status": "removed",
                "additions": 0,
                "deletions": 11,
                "changes": 11,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fdevice%2FFileStorage.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fdevice%2FFileStorage.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fdevice%2FFileStorage.conf?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,11 +0,0 @@\n-Device {\n-  Name = FileStorage\n-  Media Type = File\n-  Archive Device = storage\n-  LabelMedia = yes;                   # lets Bareos label unlabeled media\n-  Random Access = yes;\n-  AutomaticMount = yes;               # when device opened, read it\n-  RemovableMedia = no;\n-  AlwaysOpen = no;\n-  Description = \"File device. A connecting Director must have the same Name and MediaType.\"\n-}"
            },
            {
                "sha": "deef3360c2d5653ee31f663cb69a6e3d1b07cc26",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-sd.d/director/bareos-dir.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fdirector%2Fbareos-dir.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fdirector%2Fbareos-dir.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fdirector%2Fbareos-dir.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,5 +0,0 @@\n-Director {\n-  Name = bareos-dir\n-  Password = \"@sd_password@\"\n-  Description = \"Director, who is permitted to contact this storage daemon.\"\n-}"
            },
            {
                "sha": "468348e62fc6e8b781a5ff30ef86f31944340bca",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-sd.d/messages/Standard.conf",
                "status": "removed",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fmessages%2FStandard.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fmessages%2FStandard.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fmessages%2FStandard.conf?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,5 +0,0 @@\n-Messages {\n-  Name = Standard\n-  Director = bareos-dir = all\n-  Description = \"Send all messages to the Director.\"\n-}"
            },
            {
                "sha": "14e2fd4eb1d9be01c8f2d4ee14a6b50d1fd64266",
                "filename": "systemtests/tests/config-syntax-crash/etc/bareos/bareos-sd.d/storage/bareos-sd.conf.in",
                "status": "removed",
                "additions": 0,
                "deletions": 14,
                "changes": 14,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fstorage%2Fbareos-sd.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fstorage%2Fbareos-sd.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Fetc%2Fbareos%2Fbareos-sd.d%2Fstorage%2Fbareos-sd.conf.in?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,14 +0,0 @@\n-Storage {\n-  Name = bareos-sd\n-  Maximum Concurrent Jobs = 20\n-\n-  # remove comment from \"Plugin Directory\" to load plugins from specified directory.\n-  # if \"Plugin Names\" is defined, only the specified plugins will be loaded,\n-  # otherwise all storage plugins (*-sd.so) from the \"Plugin Directory\".\n-  #\n-  # Plugin Directory = \"@python_plugin_module_src_sd@\"\n-  # Plugin Names = \"\"\n-  Working Directory =  \"@working_dir@\"\n-  SD Port = @sd_port@\n-  @sd_backend_config@\n-}"
            },
            {
                "sha": "53cf586a6577812a3e82ff227098755f5a0eca21",
                "filename": "systemtests/tests/config-syntax-crash/testrunner",
                "status": "removed",
                "additions": 0,
                "deletions": 28,
                "changes": 28,
                "blob_url": "https://github.com/bareos/bareos/blob/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Ftestrunner",
                "raw_url": "https://github.com/bareos/bareos/raw/afbdb636689d8b531597bf1a4c2dfa61affa037d/systemtests%2Ftests%2Fconfig-syntax-crash%2Ftestrunner",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fconfig-syntax-crash%2Ftestrunner?ref=afbdb636689d8b531597bf1a4c2dfa61affa037d",
                "patch": "@@ -1,28 +0,0 @@\n-#!/bin/bash\n-set -e\n-set -o pipefail\n-set -u\n-#\n-# Start and stop the daemons to make sure our configuration does not crash them.\n-# This checks\n-# - an invalid entry in an ACL\n-#\n-TestName=\"$(basename \"$(pwd)\")\"\n-export TestName\n-\n-JobName=backup-bareos-fd\n-\n-#shellcheck source=../environment.in\n-. ./environment\n-\n-#shellcheck source=../scripts/functions\n-. \"${rscripts}\"/functions\n-\"${rscripts}\"/cleanup\n-\"${rscripts}\"/setup\n-\n-start_test\n-\n-start_bareos\n-stop_bareos\n-\n-end_test"
            },
            {
                "sha": "e1213f86f1f4f62017c684fcd9cd6878127288b3",
                "filename": "systemtests/tests/python-bareos/etc/bareos/bareos-dir.d/console/client-bareos-fd.conf",
                "status": "modified",
                "additions": 4,
                "deletions": 15,
                "changes": 19,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Fetc%2Fbareos%2Fbareos-dir.d%2Fconsole%2Fclient-bareos-fd.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Fetc%2Fbareos%2Fbareos-dir.d%2Fconsole%2Fclient-bareos-fd.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fpython-bareos%2Fetc%2Fbareos%2Fbareos-dir.d%2Fconsole%2Fclient-bareos-fd.conf?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -1,20 +1,9 @@\n Console {\n-   Name = client-bareos-fd\n-   Password = secret\n+   Name = \"client-bareos-fd\"\n+   Password = \"secret\"\n    TLS Enable = no\n \n-   # Command ACL from operator profile.\n-   Command ACL = !.bvfs_clear_cache, !.exit, !.sql\n-   Command ACL = !configure, !create, !delete, !purge, !prune, !sqlquery, !umount, !unmount\n-   Command ACL = *all*\n+   Profile = \"operator\"\n \n-   Catalog ACL = *all*\n-   Client ACL = \"bareos-fd\"\n-   FileSet ACL = *all*\n-   Job ACL = *all*\n-   Plugin Options ACL = *all*\n-   Pool ACL = *all*\n-   Schedule ACL = *all*\n-   Storage ACL = *all*\n-   Where ACL = *all*\n+   Client ACL = \"bareos-fd\", \"!*all*\"\n }"
            },
            {
                "sha": "2143eb176fbe43cb023199dcfe66941427256e1d",
                "filename": "systemtests/tests/python-bareos/etc/bareos/bareos-dir.d/console/limited-operator.conf",
                "status": "added",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Fetc%2Fbareos%2Fbareos-dir.d%2Fconsole%2Flimited-operator.conf",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Fetc%2Fbareos%2Fbareos-dir.d%2Fconsole%2Flimited-operator.conf",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fpython-bareos%2Fetc%2Fbareos%2Fbareos-dir.d%2Fconsole%2Flimited-operator.conf?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -0,0 +1,10 @@\n+Console {\n+   Name = \"limited-operator\"\n+   Password = \"secret\"\n+   TLS Enable = no\n+\n+   Profile = \"operator\"\n+\n+   Command ACL = \"!.consoles\"\n+   Where ACL = \"/.*/tmp/bareos-restores-limited-operator\", \"!*all*\"\n+}"
            },
            {
                "sha": "49d97bfede51448984740cc0398331a2babfbe55",
                "filename": "systemtests/tests/python-bareos/etc/bareos/bconsole-limited-operator.conf.in",
                "status": "renamed",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Fetc%2Fbareos%2Fbconsole-limited-operator.conf.in",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Fetc%2Fbareos%2Fbconsole-limited-operator.conf.in",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fpython-bareos%2Fetc%2Fbareos%2Fbconsole-limited-operator.conf.in?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -6,5 +6,10 @@ Director {\n   Name = @basename@-dir\n   DIRport = @dir_port@\n   Address = @hostname@\n-  Password = \"@dir_password@\"\n+  Password = \"INVALID\"\n+}\n+\n+Console {\n+  name = limited-operator\n+  password = secret\n }",
                "previous_filename": "systemtests/tests/config-syntax-crash/etc/bareos/bconsole.conf.in"
            },
            {
                "sha": "23368eb3bcd72e8962b906d204b67427e1ce6f84",
                "filename": "systemtests/tests/python-bareos/list_unittests.py",
                "status": "modified",
                "additions": 8,
                "deletions": 15,
                "changes": 23,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Flist_unittests.py",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Flist_unittests.py",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fpython-bareos%2Flist_unittests.py?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -3,7 +3,7 @@\n #\n #   BAREOS\u00ae - Backup Archiving REcovery Open Sourced\n #\n-#   Copyright (C) 2021-2022 Bareos GmbH & Co. KG\n+#   Copyright (C) 2021-2024 Bareos GmbH & Co. KG\n #\n #   This program is Free Software; you can redistribute it and/or\n #   modify it under the terms of version three of the GNU Affero General Public\n@@ -20,22 +20,15 @@\n #   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA\n #   02110-1301, USA.\n \n-\n-from __future__ import print_function\n import unittest\n \n \n-def list_tests_from(path, **kwargs):\n-    loader = unittest.TestLoader()\n-    suite = loader.discover(path, **kwargs)\n-    for atest in suite:\n-        tests = atest._tests\n-        for atest in tests:\n-            for btest in atest._tests:\n-                btestname = btest.__str__().split()\n-                print(btestname[1][1:-1] + \".\" + btestname[0])\n+def print_suite(suite):\n+    if hasattr(suite, \"__iter__\"):\n+        for x in suite:\n+            print_suite(x)\n+    else:\n+        print(suite)\n \n \n-if __name__ == \"__main__\":\n-    # list_tests_from(\".\", pattern=\"*test*.py\")\n-    list_tests_from(\".\")\n+print_suite(unittest.defaultTestLoader.discover(\".\"))"
            },
            {
                "sha": "891eb1ff376789cfd490ed27c066470c3728bbcc",
                "filename": "systemtests/tests/python-bareos/test_acl.py",
                "status": "modified",
                "additions": 101,
                "deletions": 9,
                "changes": 110,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Ftest_acl.py",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Ftest_acl.py",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fpython-bareos%2Ftest_acl.py?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -1,7 +1,7 @@\n #\n #   BAREOS - Backup Archiving REcovery Open Sourced\n #\n-#   Copyright (C) 2019-2023 Bareos GmbH & Co. KG\n+#   Copyright (C) 2019-2024 Bareos GmbH & Co. KG\n #\n #   This program is Free Software; you can redistribute it and/or\n #   modify it under the terms of version three of the GNU Affero General Public\n@@ -20,7 +20,6 @@\n \n # -*- coding: utf-8 -*-\n \n-from __future__ import print_function\n import json\n import logging\n import os\n@@ -136,7 +135,7 @@ def test_restore_with_client_acl(self):\n         logger.debug(str(result))\n         # TODO: This is a bug.\n         #       ACL checking does not work here,\n-        #       because this jobid should be accessable in this console.\n+        #       because this jobid should be accessible in this console.\n         # self.assertIn(b'No Job found for JobId', result)\n         result = console_bareos_fd.call(\"find *\")\n         logger.debug(str(result))\n@@ -160,7 +159,7 @@ def test_restore_with_client_acl(self):\n         #\n         # 5: Select the most recent backup for a client\n         #\n-        # Only the bareos-fd client should be accessable\n+        # Only the bareos-fd client should be accessible\n         # and is therefore autoselected.\n         #\n         result = console_bareos_fd.call(\"5\")\n@@ -300,12 +299,8 @@ def test_json_list_media_with_pool_acl(self):\n             ),\n         )\n \n-        # TODO:\n-        # IMHO this is a bug.\n         # This console should not see volumes in the Full pool.\n-        # It needs to be fixed in the server side code.\n-        with self.assertRaises(AssertionError):\n-            self._test_no_volume_in_pool(console_overwrite, console_password, \"Full\")\n+        self._test_no_volume_in_pool(console_overwrite, console_password, \"Full\")\n \n     def test_json_list_jobid_with_job_acl(self):\n         \"\"\"\n@@ -402,3 +397,100 @@ def test_status_subscription_admin(self):\n     def test_status_subscription_user_fails(self):\n         with self.assertRaises(bareos.exceptions.JsonRpcErrorReceivedException):\n             self._test_status_subscription(\"client-bareos-fd\", \"secret\")\n+\n+    def test_limited_command_acl(self):\n+        \"\"\"\n+        The console \"limited-operator\" uses the profile \"operator\",\n+        but disallows the command \".consoles\".\n+        \"\"\"\n+        logger = logging.getLogger()\n+\n+        username = \"limited-operator\"\n+        password = \"secret\"\n+\n+        console = bareos.bsock.DirectorConsoleJson(\n+            address=self.director_address,\n+            port=self.director_port,\n+            name=username,\n+            password=password,\n+            **self.director_extra_options\n+        )\n+\n+        # verify that the command \".consoles\" is not allowed.\n+        # We expect that the Bareos Director will return something like:\n+        # {\n+        #   \"jsonrpc\": \"2.0\",\n+        #   \"id\": null,\n+        #   \"error\": {\n+        #     \"code\": 1,\n+        #     \"message\": \"failed\",\n+        #     \"data\": {\n+        #       \"result\": {},\n+        #       \"messages\": {\n+        #         \"error\": [\n+        #           \".consoles: is an invalid command.\\n\"\n+        #         ]\n+        #       }\n+        #     }\n+        #   }\n+        # }\n+        # DirectorConsoleJson will raise an exception, if the result contains the \"error\" key.\n+        with self.assertRaises(bareos.exceptions.JsonRpcErrorReceivedException):\n+            result = console.call(\".consoles\")\n+\n+        # verify that substings of the \".consoles\" command are not allowed.\n+        with self.assertRaises(bareos.exceptions.JsonRpcErrorReceivedException):\n+            result = console.call(\".consol\")\n+\n+        # verify that other commands are allowed.\n+        result = console.call(\".jobs\")\n+        self.assertGreaterEqual(len(result[\"jobs\"]), 1)\n+\n+    def test_limiting_where_acl(self):\n+        \"\"\"\n+        Try different where options on restore.\n+        \"\"\"\n+        logger = logging.getLogger()\n+\n+        username = \"limited-operator\"\n+        password = \"secret\"\n+\n+        jobname = \"backup-bareos-fd\"\n+        client = \"bareos-fd\"\n+        # console WhereACL is expected to be:\n+        # WhereAcl = <allowed_restore_path>, \"!*all*\"\n+        allowed_restore_path = \"{}/tmp/bareos-restores-{}\".format(os.getcwd(), username)\n+\n+        console = bareos.bsock.DirectorConsoleJson(\n+            address=self.director_address,\n+            port=self.director_port,\n+            name=username,\n+            password=password,\n+            **self.director_extra_options\n+        )\n+\n+        # retrieve or create a jobid of a valid backup job\n+        backup_jobid = self.get_backup_jobid(console, jobname)\n+\n+        # restore with default where path\n+        restore_jobid = self.run_restore(console, client=client, jobid=backup_jobid)\n+\n+        # restore with allowed where path\n+        restore_jobid = self.run_restore(\n+            console,\n+            client=client,\n+            jobid=backup_jobid,\n+            extra=\"where={}\".format(allowed_restore_path),\n+        )\n+\n+        # try to restore with non-allowed where path\n+        with self.assertRaises(bareos.exceptions.JsonRpcErrorReceivedException):\n+            restore_jobid = self.run_restore(\n+                console, client=client, jobid=backup_jobid, extra=\"where=/tmp/INVALID\"\n+            )\n+\n+        # try to restore with non-allowed empty where path\n+        with self.assertRaises(bareos.exceptions.JsonRpcErrorReceivedException):\n+            restore_jobid = self.run_restore(\n+                console, client=client, jobid=backup_jobid, extra=\"where=\"\n+            )"
            },
            {
                "sha": "5f76ebe55a7e7f728e5106dba91793040db52c55",
                "filename": "systemtests/tests/python-bareos/test_json_config.py",
                "status": "modified",
                "additions": 50,
                "deletions": 5,
                "changes": 55,
                "blob_url": "https://github.com/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Ftest_json_config.py",
                "raw_url": "https://github.com/bareos/bareos/raw/2a026698b87d13bd1c6275726b5e826702f81dd5/systemtests%2Ftests%2Fpython-bareos%2Ftest_json_config.py",
                "contents_url": "https://api.github.com/repos/bareos/bareos/contents/systemtests%2Ftests%2Fpython-bareos%2Ftest_json_config.py?ref=2a026698b87d13bd1c6275726b5e826702f81dd5",
                "patch": "@@ -1,7 +1,7 @@\n #\n #   BAREOS - Backup Archiving REcovery Open Sourced\n #\n-#   Copyright (C) 2019-2021 Bareos GmbH & Co. KG\n+#   Copyright (C) 2019-2024 Bareos GmbH & Co. KG\n #\n #   This program is Free Software; you can redistribute it and/or\n #   modify it under the terms of version three of the GNU Affero General Public\n@@ -73,7 +73,7 @@ def test_show_command(self):\n \n         self.assertFalse(\n             self.check_resource(director, resourcesname, newclient),\n-            u\"Resource {} in {} already exists.\".format(newclient, resourcesname),\n+            \"Resource {} in {} already exists.\".format(newclient, resourcesname),\n         )\n \n         with self.assertRaises(bareos.exceptions.JsonRpcErrorReceivedException):\n@@ -83,7 +83,7 @@ def test_show_command(self):\n             director,\n             resourcesname,\n             newclient,\n-            u\"client={} password={} address=127.0.0.1\".format(newclient, newpassword),\n+            \"client={} password={} address=127.0.0.1\".format(newclient, newpassword),\n         )\n \n         director.call(\"show all\")\n@@ -122,14 +122,14 @@ def test_configure_add_with_quotes(self):\n \n         self.assertFalse(\n             self.check_resource(director, resourcesname, testname),\n-            u\"Resource {} in {} already exists.\".format(testname, resourcesname),\n+            \"Resource {} in {} already exists.\".format(testname, resourcesname),\n         )\n \n         self.configure_add(\n             director,\n             resourcesname,\n             testname,\n-            u'job jobdefs=DefaultJob name={} description=\"{}\" runafterjob=\"{}\" priority={}'.format(\n+            'job jobdefs=DefaultJob name={} description=\"{}\" runafterjob=\"{}\" priority={}'.format(\n                 testname, stringwithwhitespace, testscript, priority\n             ),\n         )\n@@ -150,3 +150,48 @@ def test_configure_add_with_quotes(self):\n             result[\"jobs\"][testname][\"priority\"],\n             priority,\n         )\n+\n+    def _test_configure_add_conole_with_where_acl(self, name, where_acl):\n+        username = self.get_operator_username()\n+        password = self.get_operator_password(username)\n+\n+        director = bareos.bsock.DirectorConsoleJson(\n+            address=self.director_address,\n+            port=self.director_port,\n+            name=username,\n+            password=password,\n+            **self.director_extra_options\n+        )\n+\n+        resourcetype = \"console\"\n+\n+        try:\n+            os.remove(\"etc/bareos/bareos-dir.d/{}/{}.conf\".format(resourcetype, name))\n+            director.call(\"reload\")\n+        except OSError:\n+            pass\n+\n+        self.assertFalse(\n+            self.check_resource(director, resourcetype, name),\n+            \"Resource {} in {} already exists.\".format(name, resourcetype),\n+        )\n+\n+        self.configure_add(\n+            director,\n+            resourcetype,\n+            name,\n+            '{} name={} password=secret profile=operator WhereACL=\"{}\"'.format(\n+                resourcetype, name, where_acl\n+            ),\n+        )\n+\n+        self.assertTrue(self.check_resource(director, resourcetype, name))\n+\n+    def test_configure_add_valid_where_acl(self):\n+        self._test_configure_add_conole_with_where_acl(\n+            \"valid-WhereAcl\", \"/tmp/validpath\"\n+        )\n+\n+    def test_configure_add_invalid_where_acl(self):\n+        with self.assertRaises(bareos.exceptions.JsonRpcErrorReceivedException):\n+            self._test_configure_add_conole_with_where_acl(\"invalid-WhereAcl\", \"|!(){}\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/expressjs/serve-static/commits/0c11fad159898cdc69fd9ab63269b72468ecaf6b",
        "url": "https://api.github.com/repos/expressjs/serve-static/commits/0c11fad159898cdc69fd9ab63269b72468ecaf6b",
        "html_url": "https://github.com/expressjs/serve-static/commit/0c11fad159898cdc69fd9ab63269b72468ecaf6b",
        "message": "Merge commit from fork\n\nCo-authored-by: Chris de Almeida <ctcpip@users.noreply.github.com>",
        "files": [
            {
                "sha": "3f3e64e9eaad83c4638b1a458ecfa6c49a6bebc1",
                "filename": "index.js",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/expressjs/serve-static/blob/0c11fad159898cdc69fd9ab63269b72468ecaf6b/index.js",
                "raw_url": "https://github.com/expressjs/serve-static/raw/0c11fad159898cdc69fd9ab63269b72468ecaf6b/index.js",
                "contents_url": "https://api.github.com/repos/expressjs/serve-static/contents/index.js?ref=0c11fad159898cdc69fd9ab63269b72468ecaf6b",
                "patch": "@@ -195,8 +195,7 @@ function createRedirectDirectoryListener () {\n \n     // reformat the URL\n     var loc = encodeUrl(url.format(originalUrl))\n-    var doc = createHtmlDocument('Redirecting', 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' +\n-      escapeHtml(loc) + '</a>')\n+    var doc = createHtmlDocument('Redirecting', 'Redirecting to ' + escapeHtml(loc))\n \n     // send redirect response\n     res.statusCode = 301"
            },
            {
                "sha": "7bce0389d757d71b68cc32eb2644f2644476bd5f",
                "filename": "test/test.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/expressjs/serve-static/blob/0c11fad159898cdc69fd9ab63269b72468ecaf6b/test%2Ftest.js",
                "raw_url": "https://github.com/expressjs/serve-static/raw/0c11fad159898cdc69fd9ab63269b72468ecaf6b/test%2Ftest.js",
                "contents_url": "https://api.github.com/repos/expressjs/serve-static/contents/test%2Ftest.js?ref=0c11fad159898cdc69fd9ab63269b72468ecaf6b",
                "patch": "@@ -483,7 +483,7 @@ describe('serveStatic()', function () {\n       request(server)\n         .get('/users')\n         .expect('Location', '/users/')\n-        .expect(301, /<a href=\"\\/users\\/\">/, done)\n+        .expect(301, /\\/users\\//, done)\n     })\n \n     it('should redirect directories with query string', function (done) {\n@@ -505,7 +505,7 @@ describe('serveStatic()', function () {\n         .get('/snow')\n         .expect('Location', '/snow%20%E2%98%83/')\n         .expect('Content-Type', /html/)\n-        .expect(301, />Redirecting to <a href=\"\\/snow%20%E2%98%83\\/\">\\/snow%20%E2%98%83\\/<\\/a></, done)\n+        .expect(301, />Redirecting to \\/snow%20%E2%98%83\\/</, done)\n     })\n \n     it('should respond with default Content-Security-Policy', function (done) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/expressjs/serve-static/commits/ce730896fddce1588111d9ef6fdf20896de5c6fa",
        "url": "https://api.github.com/repos/expressjs/serve-static/commits/ce730896fddce1588111d9ef6fdf20896de5c6fa",
        "html_url": "https://github.com/expressjs/serve-static/commit/ce730896fddce1588111d9ef6fdf20896de5c6fa",
        "message": "Merge commit from fork\n\nCo-authored-by: Chris de Almeida <ctcpip@users.noreply.github.com>",
        "files": [
            {
                "sha": "1bee46378e2739aa85ba83948671aa0e2a2fb569",
                "filename": "index.js",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/expressjs/serve-static/blob/ce730896fddce1588111d9ef6fdf20896de5c6fa/index.js",
                "raw_url": "https://github.com/expressjs/serve-static/raw/ce730896fddce1588111d9ef6fdf20896de5c6fa/index.js",
                "contents_url": "https://api.github.com/repos/expressjs/serve-static/contents/index.js?ref=ce730896fddce1588111d9ef6fdf20896de5c6fa",
                "patch": "@@ -194,8 +194,7 @@ function createRedirectDirectoryListener () {\n \n     // reformat the URL\n     var loc = encodeUrl(url.format(originalUrl))\n-    var doc = createHtmlDocument('Redirecting', 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' +\n-      escapeHtml(loc) + '</a>')\n+    var doc = createHtmlDocument('Redirecting', 'Redirecting to ' + escapeHtml(loc))\n \n     // send redirect response\n     res.statusCode = 301"
            },
            {
                "sha": "6984bcdfc341af08549a558090393bbd62d9a845",
                "filename": "test/test.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/expressjs/serve-static/blob/ce730896fddce1588111d9ef6fdf20896de5c6fa/test%2Ftest.js",
                "raw_url": "https://github.com/expressjs/serve-static/raw/ce730896fddce1588111d9ef6fdf20896de5c6fa/test%2Ftest.js",
                "contents_url": "https://api.github.com/repos/expressjs/serve-static/contents/test%2Ftest.js?ref=ce730896fddce1588111d9ef6fdf20896de5c6fa",
                "patch": "@@ -483,7 +483,7 @@ describe('serveStatic()', function () {\n       request(server)\n         .get('/users')\n         .expect('Location', '/users/')\n-        .expect(301, /<a href=\"\\/users\\/\">/, done)\n+        .expect(301, /\\/users\\//, done)\n     })\n \n     it('should redirect directories with query string', function (done) {\n@@ -505,7 +505,7 @@ describe('serveStatic()', function () {\n         .get('/snow')\n         .expect('Location', '/snow%20%E2%98%83/')\n         .expect('Content-Type', /html/)\n-        .expect(301, />Redirecting to <a href=\"\\/snow%20%E2%98%83\\/\">\\/snow%20%E2%98%83\\/<\\/a></, done)\n+        .expect(301, />Redirecting to \\/snow%20%E2%98%83\\/</, done)\n     })\n \n     it('should respond with default Content-Security-Policy', function (done) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pillarjs/send/commits/ae4f2989491b392ae2ef3b0015a019770ae65d35",
        "url": "https://api.github.com/repos/pillarjs/send/commits/ae4f2989491b392ae2ef3b0015a019770ae65d35",
        "html_url": "https://github.com/pillarjs/send/commit/ae4f2989491b392ae2ef3b0015a019770ae65d35",
        "message": "Merge commit from fork\n\nCo-authored-by: Chris de Almeida <ctcpip@users.noreply.github.com>",
        "files": [
            {
                "sha": "768f8ca60ccb772ef00c6a910753793ad73440c1",
                "filename": "index.js",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/pillarjs/send/blob/ae4f2989491b392ae2ef3b0015a019770ae65d35/index.js",
                "raw_url": "https://github.com/pillarjs/send/raw/ae4f2989491b392ae2ef3b0015a019770ae65d35/index.js",
                "contents_url": "https://api.github.com/repos/pillarjs/send/contents/index.js?ref=ae4f2989491b392ae2ef3b0015a019770ae65d35",
                "patch": "@@ -482,8 +482,7 @@ SendStream.prototype.redirect = function redirect (path) {\n   }\n \n   var loc = encodeUrl(collapseLeadingSlashes(this.path + '/'))\n-  var doc = createHtmlDocument('Redirecting', 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' +\n-    escapeHtml(loc) + '</a>')\n+  var doc = createHtmlDocument('Redirecting', 'Redirecting to ' + escapeHtml(loc))\n \n   // redirect\n   res.statusCode = 301"
            },
            {
                "sha": "7fa9dd7a7546061c594bdef8d18a6bdbd879ebbc",
                "filename": "test/send.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/pillarjs/send/blob/ae4f2989491b392ae2ef3b0015a019770ae65d35/test%2Fsend.js",
                "raw_url": "https://github.com/pillarjs/send/raw/ae4f2989491b392ae2ef3b0015a019770ae65d35/test%2Fsend.js",
                "contents_url": "https://api.github.com/repos/pillarjs/send/contents/test%2Fsend.js?ref=ae4f2989491b392ae2ef3b0015a019770ae65d35",
                "patch": "@@ -358,7 +358,7 @@ describe('send(file).pipe(res)', function () {\n         .get('/pets')\n         .expect('Location', '/pets/')\n         .expect('Content-Type', /html/)\n-        .expect(301, />Redirecting to <a href=\"\\/pets\\/\">\\/pets\\/<\\/a></, done)\n+        .expect(301, />Redirecting to \\/pets\\/</, done)\n     })\n \n     it('should respond with default Content-Security-Policy', function (done) {\n@@ -386,7 +386,7 @@ describe('send(file).pipe(res)', function () {\n         .get('/snow')\n         .expect('Location', '/snow%20%E2%98%83/')\n         .expect('Content-Type', /html/)\n-        .expect(301, />Redirecting to <a href=\"\\/snow%20%E2%98%83\\/\">\\/snow%20%E2%98%83\\/<\\/a></, done)\n+        .expect(301, />Redirecting to \\/snow%20%E2%98%83\\/</, done)\n     })\n   })\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dovecot/core/commits/f020e139c519121d9630a966310ea8e100ee33b7",
        "url": "https://api.github.com/repos/dovecot/core/commits/f020e139c519121d9630a966310ea8e100ee33b7",
        "html_url": "https://github.com/dovecot/core/commit/f020e139c519121d9630a966310ea8e100ee33b7",
        "message": "lib-mail: message-header-parser - Limit header block to 10MB by default",
        "files": [
            {
                "sha": "5e020bbeb33d48e1778eccc88315ca60d13c4cf4",
                "filename": "src/lib-mail/message-header-parser.c",
                "status": "modified",
                "additions": 37,
                "deletions": 11,
                "changes": 48,
                "blob_url": "https://github.com/dovecot/core/blob/f020e139c519121d9630a966310ea8e100ee33b7/src%2Flib-mail%2Fmessage-header-parser.c",
                "raw_url": "https://github.com/dovecot/core/raw/f020e139c519121d9630a966310ea8e100ee33b7/src%2Flib-mail%2Fmessage-header-parser.c",
                "contents_url": "https://api.github.com/repos/dovecot/core/contents/src%2Flib-mail%2Fmessage-header-parser.c?ref=f020e139c519121d9630a966310ea8e100ee33b7",
                "patch": "@@ -21,6 +21,9 @@ struct message_header_parser_ctx {\n \tstring_t *name;\n \tbuffer_t *value_buf;\n \n+\tsize_t header_block_max_size;\n+\tsize_t header_block_total_size;\n+\n \tenum message_header_parser_flags flags;\n \tbool skip_line:1;\n \tbool has_nuls:1;\n@@ -38,13 +41,29 @@ message_parse_header_init(struct istream *input, struct message_size *hdr_size,\n \tctx->name = str_new(default_pool, 128);\n \tctx->flags = flags;\n \tctx->value_buf = buffer_create_dynamic(default_pool, 4096);\n+\tctx->header_block_max_size = MESSAGE_HEADER_BLOCK_DEFAULT_MAX_SIZE;\n \ti_stream_ref(input);\n \n \tif (hdr_size != NULL)\n \t\ti_zero(hdr_size);\n \treturn ctx;\n }\n \n+void\n+message_parse_header_set_limit(struct message_header_parser_ctx *parser,\n+\t\t\t       size_t header_block_max_size)\n+{\n+\tparser->header_block_max_size = header_block_max_size;\n+}\n+\n+void\n+message_parse_header_lower_limit(struct message_header_parser_ctx *parser,\n+\t\t\t\t size_t header_block_max_size)\n+{\n+\tif (header_block_max_size < parser->header_block_max_size)\n+\t\tmessage_parse_header_set_limit(parser, header_block_max_size);\n+}\n+\n void message_parse_header_deinit(struct message_header_parser_ctx **_ctx)\n {\n \tstruct message_header_parser_ctx *ctx = *_ctx;\n@@ -77,6 +96,7 @@ int message_parse_header_next(struct message_header_parser_ctx *ctx,\n \t\t/* new header line */\n \t\tline->name_offset = ctx->input->v_offset;\n \t\tcolon_pos = UINT_MAX;\n+\t\tctx->header_block_total_size += ctx->value_buf->used;\n \t\tbuffer_set_used_size(ctx->value_buf, 0);\n \t}\n \n@@ -342,33 +362,39 @@ int message_parse_header_next(struct message_header_parser_ctx *ctx,\n \t\t}\n \t}\n \n+\tline->value_len = I_MIN(line->value_len, ctx->header_block_max_size);\n+\tsize_t line_value_size = line->value_len;\n+\tsize_t header_total_used = ctx->header_block_total_size + ctx->value_buf->used;\n+\tsize_t line_available = ctx->header_block_max_size <= header_total_used ? 0 :\n+\t\t\t\tctx->header_block_max_size - header_total_used;\n+\tline_value_size = I_MIN(line_value_size, line_available);\n+\n \tif (!line->continued) {\n \t\t/* first header line. make a copy of the line since we can't\n \t\t   really trust input stream not to lose it. */\n-\t\tbuffer_append(ctx->value_buf, line->value, line->value_len);\n+\t\tbuffer_append(ctx->value_buf, line->value, line_value_size);\n \t\tline->value = line->full_value = ctx->value_buf->data;\n-\t\tline->full_value_len = line->value_len;\n+\t\tline->full_value_len = line->value_len = line_value_size;\n \t} else if (line->use_full_value) {\n \t\t/* continue saving the full value. */\n \t\tif (last_no_newline) {\n \t\t\t/* line is longer than fit into our buffer, so we\n \t\t\t   were forced to break it into multiple\n \t\t\t   message_header_lines */\n-\t\t} else {\n-\t\t\tif (last_crlf)\n+\t\t} else if (line_value_size > 1) {\n+\t\t\tif (last_crlf && line_value_size > 2)\n \t\t\t\tbuffer_append_c(ctx->value_buf, '\\r');\n \t\t\tbuffer_append_c(ctx->value_buf, '\\n');\n \t\t}\n \t\tif ((ctx->flags & MESSAGE_HEADER_PARSER_FLAG_CLEAN_ONELINE) != 0 &&\n \t\t    line->value_len > 0 && line->value[0] != ' ' &&\n-\t\t    IS_LWSP(line->value[0])) {\n+\t\t    IS_LWSP(line->value[0]) &&\n+\t\t    line_value_size > 0) {\n \t\t\tbuffer_append_c(ctx->value_buf, ' ');\n-\t\t\tbuffer_append(ctx->value_buf,\n-\t\t\t\t      line->value + 1, line->value_len - 1);\n-\t\t} else {\n-\t\t\tbuffer_append(ctx->value_buf,\n-\t\t\t\t      line->value, line->value_len);\n-\t\t}\n+\t\t\tbuffer_append(ctx->value_buf, line->value + 1, line_value_size - 1);\n+\t\t} else\n+\t\t\tbuffer_append(ctx->value_buf, line->value, line_value_size);\n+\n \t\tline->full_value = ctx->value_buf->data;\n \t\tline->full_value_len = ctx->value_buf->used;\n \t} else {"
            },
            {
                "sha": "43cf95e56ae117d62925b934036ed9a8d1a12fb3",
                "filename": "src/lib-mail/message-header-parser.h",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/dovecot/core/blob/f020e139c519121d9630a966310ea8e100ee33b7/src%2Flib-mail%2Fmessage-header-parser.h",
                "raw_url": "https://github.com/dovecot/core/raw/f020e139c519121d9630a966310ea8e100ee33b7/src%2Flib-mail%2Fmessage-header-parser.h",
                "contents_url": "https://api.github.com/repos/dovecot/core/contents/src%2Flib-mail%2Fmessage-header-parser.h?ref=f020e139c519121d9630a966310ea8e100ee33b7",
                "patch": "@@ -1,6 +1,9 @@\n #ifndef MESSAGE_HEADER_PARSER_H\n #define MESSAGE_HEADER_PARSER_H\n \n+/* This can be overridden by message_parse_header_set_limit() */\n+#define MESSAGE_HEADER_BLOCK_DEFAULT_MAX_SIZE ((size_t) 10 * 1024*1024)\n+\n #define IS_LWSP(c) \\\n \t((c) == ' ' || (c) == '\\t')\n \n@@ -48,6 +51,13 @@ message_parse_header_init(struct istream *input, struct message_size *hdr_size,\n \t\t\t  enum message_header_parser_flags flags) ATTR_NULL(2);\n void message_parse_header_deinit(struct message_header_parser_ctx **ctx);\n \n+void\n+message_parse_header_set_limit(struct message_header_parser_ctx *parser,\n+\t\t\t       size_t header_block_max_size);\n+void\n+message_parse_header_lower_limit(struct message_header_parser_ctx *parser,\n+\t\t\t\t size_t header_block_max_size);\n+\n /* Read and return next header line. Returns 1 if header is returned, 0 if\n    input stream is non-blocking and more data needs to be read, -1 when all is\n    done or error occurred (see stream's error status). */"
            },
            {
                "sha": "93d8842002aa14f4bbed667da6e1552d1788b6fb",
                "filename": "src/lib-mail/test-message-header-parser.c",
                "status": "modified",
                "additions": 67,
                "deletions": 0,
                "changes": 67,
                "blob_url": "https://github.com/dovecot/core/blob/f020e139c519121d9630a966310ea8e100ee33b7/src%2Flib-mail%2Ftest-message-header-parser.c",
                "raw_url": "https://github.com/dovecot/core/raw/f020e139c519121d9630a966310ea8e100ee33b7/src%2Flib-mail%2Ftest-message-header-parser.c",
                "contents_url": "https://api.github.com/repos/dovecot/core/contents/src%2Flib-mail%2Ftest-message-header-parser.c?ref=f020e139c519121d9630a966310ea8e100ee33b7",
                "patch": "@@ -463,6 +463,71 @@ static void test_message_header_parser_extra_crlf_in_name(void)\n \ttest_end();\n }\n \n+#define assert_parsed_field(line, expected, actual, len) STMT_START {\t\t\\\n+\ttest_assert_idx(memcmp(expected, actual, strlen(expected)) == 0, line); \\\n+\ttest_assert_cmp_idx(strlen(expected), ==, len, line);\t\t\t\\\n+} STMT_END\n+\n+/* NOTE: implicit variables: (parser, hdr) */\n+#define assert_parse_line(line, exp_name, exp_value, exp_full) STMT_START {\t\t\\\n+\ttest_assert_idx(message_parse_header_next(parser, &hdr) > 0, line); \t\t\\\n+\tassert_parsed_field(line, exp_name,   hdr->name,       hdr->name_len);\t\t\\\n+\tassert_parsed_field(line, exp_value,  hdr->value,      hdr->value_len);\t\t\\\n+\tassert_parsed_field(line, exp_full,   hdr->full_value, hdr->full_value_len);\t\\\n+\tif (hdr->continues) hdr->use_full_value = TRUE;\t\t\t\t\t\\\n+} STMT_END\n+\n+static const unsigned char test_message_header_truncation_input[] =\n+\t/*01*/\t\"header1: this is short\\n\"\n+\t/*02*/\t\"header2: this is multiline\\n\"\n+\t/*03*/\t\" and long 343638404244464850525456586062\\n\"\n+\t/*04*/\t\" 64666870727476788082848688909294969800\\n\"\n+\t/*05*/\t\" 02040608101214161820222426283032343638\\n\"\n+\t/*06*/\t\"header3: I should not appear at all\\n\"\n+\t/*07*/\t\"\\n\";\n+\n+static void test_message_header_truncation_clean_oneline(void)\n+{\n+\ttest_begin(\"message header parser truncate + CLEAN_ONELINE flag\");\n+\tstruct message_header_line *hdr = NULL;\n+\tstruct istream *input = test_istream_create_data(test_message_header_truncation_input, sizeof(test_message_header_truncation_input));\n+\tstruct message_header_parser_ctx *parser = message_parse_header_init(input, NULL, MESSAGE_HEADER_PARSER_FLAG_CLEAN_ONELINE);\n+\tmessage_parse_header_set_limit(parser, 96);\n+\n+\tassert_parse_line( 1, \"header1\", \"this is short\",\t                     \"this is short\");\n+\tassert_parse_line( 2, \"header2\", \"this is multiline\", \t                     \"this is multiline\");\n+\tassert_parse_line( 3, \"header2\", \" and long 343638404244464850525456586062\", \"this is multiline and long 343638404244464850525456586062\");\n+\tassert_parse_line( 4, \"header2\", \" 64666870727476788082848688909294969800\",  \"this is multiline and long 343638404244464850525456586062 6466687072747678808284868\");\n+\tassert_parse_line( 5, \"header2\", \" 02040608101214161820222426283032343638\",  \"this is multiline and long 343638404244464850525456586062 6466687072747678808284868\");\n+\tassert_parse_line( 6, \"header3\", \"\", \"\");\n+\ttest_assert(message_parse_header_next(parser, &hdr) > 0 && hdr->eoh);\n+\n+\tmessage_parse_header_deinit(&parser);\n+\ti_stream_unref(&input);\n+\ttest_end();\n+}\n+\n+static void test_message_header_truncation_flag0(void)\n+{\n+\ttest_begin(\"message header parser truncate + NO flags\");\n+\tstruct message_header_line *hdr = NULL;\n+\tstruct istream *input = test_istream_create_data(test_message_header_truncation_input, sizeof(test_message_header_truncation_input));\n+\tstruct message_header_parser_ctx *parser = message_parse_header_init(input, NULL, 0);\n+\tmessage_parse_header_set_limit(parser, 96);\n+\n+\tassert_parse_line( 1, \"header1\", \"this is short\",\t                     \"this is short\");\n+\tassert_parse_line( 2, \"header2\", \"this is multiline\", \t                     \"this is multiline\");\n+\tassert_parse_line( 3, \"header2\", \" and long 343638404244464850525456586062\", \"this is multiline\\n and long 343638404244464850525456586062\");\n+\tassert_parse_line( 4, \"header2\", \" 64666870727476788082848688909294969800\",  \"this is multiline\\n and long 343638404244464850525456586062\\n 646668707274767880828486\");\n+\tassert_parse_line( 5, \"header2\", \" 02040608101214161820222426283032343638\",  \"this is multiline\\n and long 343638404244464850525456586062\\n 646668707274767880828486\");\n+\tassert_parse_line( 6, \"header3\", \"\", \"\");\n+\ttest_assert(message_parse_header_next(parser, &hdr) > 0 && hdr->eoh);\n+\n+\tmessage_parse_header_deinit(&parser);\n+\ti_stream_unref(&input);\n+\ttest_end();\n+}\n+\n int main(void)\n {\n \tstatic void (*const test_functions[])(void) = {\n@@ -473,6 +538,8 @@ int main(void)\n \t\ttest_message_header_parser_no_eoh,\n \t\ttest_message_header_parser_nul,\n \t\ttest_message_header_parser_extra_crlf_in_name,\n+\t\ttest_message_header_truncation_flag0,\n+\t\ttest_message_header_truncation_clean_oneline,\n \t\tNULL\n \t};\n \treturn test_run(test_functions);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/expressjs/express/commits/54271f69b511fea198471e6ff3400ab805d6b553",
        "url": "https://api.github.com/repos/expressjs/express/commits/54271f69b511fea198471e6ff3400ab805d6b553",
        "html_url": "https://github.com/expressjs/express/commit/54271f69b511fea198471e6ff3400ab805d6b553",
        "message": "fix: don't render redirect values in anchor href\n\nCo-authored-by: Ulises Gasc\u00f3n <ulisesgascongonzalez@gmail.com>",
        "files": [
            {
                "sha": "76b6b54a3b8f7947ba307f96d21dd7bbb5b2ef8f",
                "filename": "lib/response.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/expressjs/express/blob/54271f69b511fea198471e6ff3400ab805d6b553/lib%2Fresponse.js",
                "raw_url": "https://github.com/expressjs/express/raw/54271f69b511fea198471e6ff3400ab805d6b553/lib%2Fresponse.js",
                "contents_url": "https://api.github.com/repos/expressjs/express/contents/lib%2Fresponse.js?ref=54271f69b511fea198471e6ff3400ab805d6b553",
                "patch": "@@ -969,7 +969,7 @@ res.redirect = function redirect(url) {\n \n     html: function(){\n       var u = escapeHtml(address);\n-      body = '<p>' + statuses.message[status] + '. Redirecting to <a href=\"' + u + '\">' + u + '</a></p>'\n+      body = '<p>' + statuses.message[status] + '. Redirecting to ' + u + '</p>'\n     },\n \n     default: function(){"
            },
            {
                "sha": "f7214d933125cdc87aa9b7d7b66c368ff1acf349",
                "filename": "test/res.redirect.js",
                "status": "modified",
                "additions": 21,
                "deletions": 3,
                "changes": 24,
                "blob_url": "https://github.com/expressjs/express/blob/54271f69b511fea198471e6ff3400ab805d6b553/test%2Fres.redirect.js",
                "raw_url": "https://github.com/expressjs/express/raw/54271f69b511fea198471e6ff3400ab805d6b553/test%2Fres.redirect.js",
                "contents_url": "https://api.github.com/repos/expressjs/express/contents/test%2Fres.redirect.js?ref=54271f69b511fea198471e6ff3400ab805d6b553",
                "patch": "@@ -106,7 +106,7 @@ describe('res', function(){\n       .set('Accept', 'text/html')\n       .expect('Content-Type', /html/)\n       .expect('Location', 'http://google.com')\n-      .expect(302, '<p>Found. Redirecting to <a href=\"http://google.com\">http://google.com</a></p>', done)\n+      .expect(302, '<p>Found. Redirecting to http://google.com</p>', done)\n     })\n \n     it('should escape the url', function(done){\n@@ -122,9 +122,27 @@ describe('res', function(){\n       .set('Accept', 'text/html')\n       .expect('Content-Type', /html/)\n       .expect('Location', '%3Cla\\'me%3E')\n-      .expect(302, '<p>Found. Redirecting to <a href=\"%3Cla&#39;me%3E\">%3Cla&#39;me%3E</a></p>', done)\n+      .expect(302, '<p>Found. Redirecting to %3Cla&#39;me%3E</p>', done)\n     })\n \n+    it('should not render evil javascript links in anchor href (prevent XSS)', function(done){\n+      var app = express();\n+      var xss = 'javascript:eval(document.body.innerHTML=`<p>XSS</p>`);';\n+      var encodedXss = 'javascript:eval(document.body.innerHTML=%60%3Cp%3EXSS%3C/p%3E%60);';\n+\n+      app.use(function(req, res){\n+        res.redirect(xss);\n+      });\n+\n+      request(app)\n+      .get('/')\n+      .set('Host', 'http://example.com')\n+      .set('Accept', 'text/html')\n+      .expect('Content-Type', /html/)\n+      .expect('Location', encodedXss)\n+      .expect(302, '<p>Found. Redirecting to ' + encodedXss +'</p>', done);\n+    });\n+\n     it('should include the redirect type', function(done){\n       var app = express();\n \n@@ -137,7 +155,7 @@ describe('res', function(){\n       .set('Accept', 'text/html')\n       .expect('Content-Type', /html/)\n       .expect('Location', 'http://google.com')\n-      .expect(301, '<p>Moved Permanently. Redirecting to <a href=\"http://google.com\">http://google.com</a></p>', done);\n+      .expect(301, '<p>Moved Permanently. Redirecting to http://google.com</p>', done);\n     })\n   })\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/29b96b4a1de52824e1ca0f49a701183cc4ed476f",
        "url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/29b96b4a1de52824e1ca0f49a701183cc4ed476f",
        "html_url": "https://github.com/pillarjs/path-to-regexp/commit/29b96b4a1de52824e1ca0f49a701183cc4ed476f",
        "message": "Add backtrack protection to parameters",
        "files": [
            {
                "sha": "11503356d0853616077a24aa89dbd90c2deeca2c",
                "filename": "index.js",
                "status": "modified",
                "additions": 51,
                "deletions": 39,
                "changes": 90,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/29b96b4a1de52824e1ca0f49a701183cc4ed476f/index.js",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/29b96b4a1de52824e1ca0f49a701183cc4ed476f/index.js",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/index.js?ref=29b96b4a1de52824e1ca0f49a701183cc4ed476f",
                "patch": "@@ -1,13 +1,13 @@\n /**\n- * Expose `pathtoRegexp`.\n+ * Expose `pathToRegexp`.\n  */\n \n-module.exports = pathtoRegexp;\n+module.exports = pathToRegexp;\n \n /**\n  * Match matching groups in a regular expression.\n  */\n-var MATCHING_GROUP_REGEXP = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n+var MATCHING_GROUP_REGEXP = /\\\\.|\\((?:\\?<(.*?)>)?(?!\\?)/g;\n \n /**\n  * Normalize the given path string,\n@@ -25,7 +25,7 @@ var MATCHING_GROUP_REGEXP = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n  * @api private\n  */\n \n-function pathtoRegexp(path, keys, options) {\n+function pathToRegexp(path, keys, options) {\n   options = options || {};\n   keys = keys || [];\n   var strict = options.strict;\n@@ -36,10 +36,14 @@ function pathtoRegexp(path, keys, options) {\n   var keysOffset = keys.length;\n   var i = 0;\n   var name = 0;\n+  var pos = 0;\n+  var backtrack = '';\n   var m;\n \n   if (path instanceof RegExp) {\n     while (m = MATCHING_GROUP_REGEXP.exec(path.source)) {\n+      if (m[0][0] === '\\\\') continue;\n+\n       keys.push({\n         name: m[1] || name++,\n         optional: false,\n@@ -55,62 +59,68 @@ function pathtoRegexp(path, keys, options) {\n     // the same keys and options instance into every generation to get\n     // consistent matching groups before we join the sources together.\n     path = path.map(function (value) {\n-      return pathtoRegexp(value, keys, options).source;\n+      return pathToRegexp(value, keys, options).source;\n     });\n \n-    return new RegExp('(?:' + path.join('|') + ')', flags);\n+    return new RegExp(path.join('|'), flags);\n   }\n \n-  path = ('^' + path + (strict ? '' : path[path.length - 1] === '/' ? '?' : '/?'))\n-    .replace(/\\/\\(/g, '/(?:')\n-    .replace(/([\\/\\.])/g, '\\\\$1')\n-    .replace(/(\\\\\\/)?(\\\\\\.)?:(\\w+)(\\(.*?\\))?(\\*)?(\\?)?/g, function (match, slash, format, key, capture, star, optional, offset) {\n+  path = path.replace(\n+    /\\\\.|(\\/)?(\\.)?:(\\w+)(\\(.*?\\))?(\\*)?(\\?)?|[.*]|\\/\\(/g,\n+    function (match, slash, format, key, capture, star, optional, offset) {\n+      pos = offset + match.length;\n+\n+      if (match[0] === '\\\\') {\n+        backtrack += match;\n+        return match;\n+      }\n+\n+      if (match === '.') {\n+        backtrack += '\\\\.';\n+        extraOffset += 1;\n+        return '\\\\.';\n+      }\n+\n+      backtrack = slash || format ? '' : path.slice(pos, offset);\n+\n+      if (match === '*') {\n+        extraOffset += 3;\n+        return '(.*)';\n+      }\n+\n+      if (match === '/(') {\n+        backtrack += '/';\n+        extraOffset += 2;\n+        return '/(?:';\n+      }\n+\n       slash = slash || '';\n-      format = format || '';\n-      capture = capture || '([^\\\\/' + format + ']+?)';\n+      format = format ? '\\\\.' : '';\n       optional = optional || '';\n+      capture = capture ?\n+        capture.replace(/\\\\.|\\*/, function (m) { return m === '*' ? '(.*)' : m; }) :\n+        (backtrack ? '((?:(?!/|' + backtrack + ').)+?)' : '([^/' + format + ']+?)');\n \n       keys.push({\n         name: key,\n         optional: !!optional,\n         offset: offset + extraOffset\n       });\n \n-      var result = ''\n-        + (optional ? '' : slash)\n-        + '(?:'\n-        + format + (optional ? slash : '') + capture\n-        + (star ? '((?:[\\\\/' + format + '].+?)?)' : '')\n+      var result = '(?:'\n+        + format + slash + capture\n+        + (star ? '((?:[/' + format + '].+?)?)' : '')\n         + ')'\n         + optional;\n \n       extraOffset += result.length - match.length;\n \n       return result;\n-    })\n-    .replace(/\\*/g, function (star, index) {\n-      var len = keys.length\n-\n-      while (len-- > keysOffset && keys[len].offset > index) {\n-        keys[len].offset += 3; // Replacement length minus asterisk length.\n-      }\n-\n-      return '(.*)';\n     });\n \n   // This is a workaround for handling unnamed matching groups.\n   while (m = MATCHING_GROUP_REGEXP.exec(path)) {\n-    var escapeCount = 0;\n-    var index = m.index;\n-\n-    while (path.charAt(--index) === '\\\\') {\n-      escapeCount++;\n-    }\n-\n-    // It's possible to escape the bracket.\n-    if (escapeCount % 2 === 1) {\n-      continue;\n-    }\n+    if (m[0][0] === '\\\\') continue;\n \n     if (keysOffset + i === keys.length || keys[keysOffset + i].offset > m.index) {\n       keys.splice(keysOffset + i, 0, {\n@@ -123,12 +133,14 @@ function pathtoRegexp(path, keys, options) {\n     i++;\n   }\n \n+  path += strict ? '' : path[path.length - 1] === '/' ? '?' : '/?';\n+\n   // If the path is non-ending, match until the end or a slash.\n   if (end) {\n     path += '$';\n   } else if (path[path.length - 1] !== '/') {\n-    path += lookahead ? '(?=\\\\/|$)' : '(?:\\/|$)';\n+    path += lookahead ? '(?=/|$)' : '(?:/|$)';\n   }\n \n-  return new RegExp(path, flags);\n+  return new RegExp('^' + path, flags);\n };"
            },
            {
                "sha": "63ecb865b49822615c247e0c4b2725919bd4cf3d",
                "filename": "test.js",
                "status": "modified",
                "additions": 39,
                "deletions": 1,
                "changes": 40,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/29b96b4a1de52824e1ca0f49a701183cc4ed476f/test.js",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/29b96b4a1de52824e1ca0f49a701183cc4ed476f/test.js",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/test.js?ref=29b96b4a1de52824e1ca0f49a701183cc4ed476f",
                "patch": "@@ -763,6 +763,44 @@ describe('path-to-regexp', function () {\n       assert.equal(m[0], '/test.json');\n       assert.equal(m[1], 'test.json');\n     });\n+\n+    it('should match after a non-slash or format character', function () {\n+      var params = [];\n+      var re = pathToRegExp('/:x-:y', params);\n+      var m;\n+\n+      assert.equal(params.length, 2);\n+      assert.equal(params[0].name, 'x');\n+      assert.equal(params[0].optional, false);\n+      assert.equal(params[1].name, 'y');\n+      assert.equal(params[1].optional, false);\n+\n+      m = re.exec('/1-2');\n+\n+      assert.equal(m.length, 3);\n+      assert.equal(m[0], '/1-2');\n+      assert.equal(m[1], '1');\n+      assert.equal(m[2], '2');\n+    });\n+\n+    it('should replace asterisk in capture group', function () {\n+      var params = [];\n+      var re = pathToRegExp('/files/:file(*)', params);\n+      var m;\n+\n+      assert.equal(params.length, 2);\n+      assert.equal(params[0].name, 'file');\n+      assert.equal(params[0].optional, false);\n+      assert.equal(params[1].name, 0);\n+      assert.equal(params[1].optional, false);\n+\n+      m = re.exec('/files/test');\n+\n+      assert.equal(m.length, 3);\n+      assert.equal(m[0], '/files/test');\n+      assert.equal(m[1], 'test');\n+      assert.equal(m[2], 'test');\n+    })\n   });\n \n   describe('regexps', function () {\n@@ -812,7 +850,7 @@ describe('path-to-regexp', function () {\n       assert.equal(m[1], 'foo');\n       assert.equal(m[2], 'bar');\n       assert.equal(m[3], 'baz');\n-    })\n+    });\n   });\n \n   describe('arrays', function () {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/f1253b47b347dcb909e3e80b0eb2649109e59894",
        "url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/f1253b47b347dcb909e3e80b0eb2649109e59894",
        "html_url": "https://github.com/pillarjs/path-to-regexp/commit/f1253b47b347dcb909e3e80b0eb2649109e59894",
        "message": "Add backtrack protection to 6.x (#324)",
        "files": [
            {
                "sha": "9eb45e4ad55cb33983c47f0de2a90a8b278cc6d4",
                "filename": "package-lock.json",
                "status": "modified",
                "additions": 102,
                "deletions": 0,
                "changes": 102,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/f1253b47b347dcb909e3e80b0eb2649109e59894/package-lock.json",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/f1253b47b347dcb909e3e80b0eb2649109e59894/package-lock.json",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/package-lock.json?ref=f1253b47b347dcb909e3e80b0eb2649109e59894",
                "patch": "@@ -14,6 +14,7 @@\n         \"@types/node\": \"^20.4.9\",\n         \"@types/semver\": \"^7.3.1\",\n         \"@vitest/coverage-v8\": \"^1.4.0\",\n+        \"recheck\": \"^4.4.5\",\n         \"semver\": \"^7.3.5\",\n         \"size-limit\": \"^11.1.2\",\n         \"typescript\": \"^5.1.6\"\n@@ -2682,6 +2683,67 @@\n         \"node\": \">=8.10.0\"\n       }\n     },\n+    \"node_modules/recheck\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck/-/recheck-4.4.5.tgz\",\n+      \"integrity\": \"sha512-J80Ykhr+xxWtvWrfZfPpOR/iw2ijvb4WY8d9AVoN8oHsPP07JT1rCAalUSACMGxM1cvSocb6jppWFjVS6eTTrA==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">=14\"\n+      },\n+      \"optionalDependencies\": {\n+        \"recheck-jar\": \"4.4.5\",\n+        \"recheck-linux-x64\": \"4.4.5\",\n+        \"recheck-macos-x64\": \"4.4.5\",\n+        \"recheck-windows-x64\": \"4.4.5\"\n+      }\n+    },\n+    \"node_modules/recheck-jar\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck-jar/-/recheck-jar-4.4.5.tgz\",\n+      \"integrity\": \"sha512-a2kMzcfr+ntT0bObNLY22EUNV6Z6WeZ+DybRmPOUXVWzGcqhRcrK74tpgrYt3FdzTlSh85pqoryAPmrNkwLc0g==\",\n+      \"dev\": true,\n+      \"optional\": true\n+    },\n+    \"node_modules/recheck-linux-x64\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck-linux-x64/-/recheck-linux-x64-4.4.5.tgz\",\n+      \"integrity\": \"sha512-s8OVPCpiSGw+tLCxH3eei7Zp2AoL22kXqLmEtWXi0AnYNwfuTjZmeLn2aQjW8qhs8ZPSkxS7uRIRTeZqR5Fv/Q==\",\n+      \"cpu\": [\n+        \"x64\"\n+      ],\n+      \"dev\": true,\n+      \"optional\": true,\n+      \"os\": [\n+        \"linux\"\n+      ]\n+    },\n+    \"node_modules/recheck-macos-x64\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck-macos-x64/-/recheck-macos-x64-4.4.5.tgz\",\n+      \"integrity\": \"sha512-Ouup9JwwoKCDclt3Na8+/W2pVbt8FRpzjkDuyM32qTR2TOid1NI+P1GA6/VQAKEOjvaxgGjxhcP/WqAjN+EULA==\",\n+      \"cpu\": [\n+        \"x64\"\n+      ],\n+      \"dev\": true,\n+      \"optional\": true,\n+      \"os\": [\n+        \"darwin\"\n+      ]\n+    },\n+    \"node_modules/recheck-windows-x64\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck-windows-x64/-/recheck-windows-x64-4.4.5.tgz\",\n+      \"integrity\": \"sha512-mkpzLHu9G9Ztjx8HssJh9k/Xm1d1d/4OoT7etHqFk+k1NGzISCRXBD22DqYF9w8+J4QEzTAoDf8icFt0IGhOEQ==\",\n+      \"cpu\": [\n+        \"x64\"\n+      ],\n+      \"dev\": true,\n+      \"optional\": true,\n+      \"os\": [\n+        \"win32\"\n+      ]\n+    },\n     \"node_modules/restore-cursor\": {\n       \"version\": \"4.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/restore-cursor/-/restore-cursor-4.0.0.tgz\",\n@@ -5422,6 +5484,46 @@\n         \"picomatch\": \"^2.2.1\"\n       }\n     },\n+    \"recheck\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck/-/recheck-4.4.5.tgz\",\n+      \"integrity\": \"sha512-J80Ykhr+xxWtvWrfZfPpOR/iw2ijvb4WY8d9AVoN8oHsPP07JT1rCAalUSACMGxM1cvSocb6jppWFjVS6eTTrA==\",\n+      \"dev\": true,\n+      \"requires\": {\n+        \"recheck-jar\": \"4.4.5\",\n+        \"recheck-linux-x64\": \"4.4.5\",\n+        \"recheck-macos-x64\": \"4.4.5\",\n+        \"recheck-windows-x64\": \"4.4.5\"\n+      }\n+    },\n+    \"recheck-jar\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck-jar/-/recheck-jar-4.4.5.tgz\",\n+      \"integrity\": \"sha512-a2kMzcfr+ntT0bObNLY22EUNV6Z6WeZ+DybRmPOUXVWzGcqhRcrK74tpgrYt3FdzTlSh85pqoryAPmrNkwLc0g==\",\n+      \"dev\": true,\n+      \"optional\": true\n+    },\n+    \"recheck-linux-x64\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck-linux-x64/-/recheck-linux-x64-4.4.5.tgz\",\n+      \"integrity\": \"sha512-s8OVPCpiSGw+tLCxH3eei7Zp2AoL22kXqLmEtWXi0AnYNwfuTjZmeLn2aQjW8qhs8ZPSkxS7uRIRTeZqR5Fv/Q==\",\n+      \"dev\": true,\n+      \"optional\": true\n+    },\n+    \"recheck-macos-x64\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck-macos-x64/-/recheck-macos-x64-4.4.5.tgz\",\n+      \"integrity\": \"sha512-Ouup9JwwoKCDclt3Na8+/W2pVbt8FRpzjkDuyM32qTR2TOid1NI+P1GA6/VQAKEOjvaxgGjxhcP/WqAjN+EULA==\",\n+      \"dev\": true,\n+      \"optional\": true\n+    },\n+    \"recheck-windows-x64\": {\n+      \"version\": \"4.4.5\",\n+      \"resolved\": \"https://registry.npmjs.org/recheck-windows-x64/-/recheck-windows-x64-4.4.5.tgz\",\n+      \"integrity\": \"sha512-mkpzLHu9G9Ztjx8HssJh9k/Xm1d1d/4OoT7etHqFk+k1NGzISCRXBD22DqYF9w8+J4QEzTAoDf8icFt0IGhOEQ==\",\n+      \"dev\": true,\n+      \"optional\": true\n+    },\n     \"restore-cursor\": {\n       \"version\": \"4.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/restore-cursor/-/restore-cursor-4.0.0.tgz\","
            },
            {
                "sha": "2cda434f5f07bac133ce65f4db5cc2d59bb1af8d",
                "filename": "package.json",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/f1253b47b347dcb909e3e80b0eb2649109e59894/package.json",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/f1253b47b347dcb909e3e80b0eb2649109e59894/package.json",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/package.json?ref=f1253b47b347dcb909e3e80b0eb2649109e59894",
                "patch": "@@ -36,6 +36,7 @@\n     \"@types/node\": \"^20.4.9\",\n     \"@types/semver\": \"^7.3.1\",\n     \"@vitest/coverage-v8\": \"^1.4.0\",\n+    \"recheck\": \"^4.4.5\",\n     \"semver\": \"^7.3.5\",\n     \"size-limit\": \"^11.1.2\",\n     \"typescript\": \"^5.1.6\"\n@@ -46,7 +47,7 @@\n   \"size-limit\": [\n     {\n       \"path\": \"dist.es2015/index.js\",\n-      \"limit\": \"2 kB\"\n+      \"limit\": \"2.1 kB\"\n     }\n   ],\n   \"ts-scripts\": {"
            },
            {
                "sha": "ccf8f073c0ea01ea973967231a30f69fcec81d35",
                "filename": "redos.ts",
                "status": "added",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/f1253b47b347dcb909e3e80b0eb2649109e59894/redos.ts",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/f1253b47b347dcb909e3e80b0eb2649109e59894/redos.ts",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/redos.ts?ref=f1253b47b347dcb909e3e80b0eb2649109e59894",
                "patch": "@@ -0,0 +1,21 @@\n+import { checkSync } from \"recheck\";\n+import { pathToRegexp } from \"./src/index.js\";\n+\n+let safe = 0;\n+let fail = 0;\n+\n+const tests = [\"/:x{/foobar/:y}?-:z\"];\n+\n+for (const path of tests) {\n+  const regexp = pathToRegexp(path);\n+  const result = checkSync(regexp.source, regexp.flags);\n+  if (result.status === \"safe\") {\n+    safe++;\n+    console.log(\"Safe:\", path, String(regexp));\n+  } else {\n+    fail++;\n+    console.log(\"Fail:\", path, String(regexp));\n+  }\n+}\n+\n+console.log(\"Safe:\", safe, \"Fail:\", fail);"
            },
            {
                "sha": "22b3e91e60ccb98e876826bba93243696d2c70db",
                "filename": "src/index.spec.ts",
                "status": "modified",
                "additions": 32,
                "deletions": 47,
                "changes": 79,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/f1253b47b347dcb909e3e80b0eb2649109e59894/src%2Findex.spec.ts",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/f1253b47b347dcb909e3e80b0eb2649109e59894/src%2Findex.spec.ts",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/src%2Findex.spec.ts?ref=f1253b47b347dcb909e3e80b0eb2649109e59894",
                "patch": "@@ -1353,7 +1353,7 @@ const TESTS: Test[] = [\n         prefix: \".\",\n         suffix: \"\",\n         modifier: \"+\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!\\\\.)[^\\\\/#\\\\?])+?\",\n       },\n     ],\n     [\n@@ -1397,7 +1397,7 @@ const TESTS: Test[] = [\n         prefix: \".\",\n         suffix: \"\",\n         modifier: \"\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!\\\\.)[^\\\\/#\\\\?])+?\",\n       },\n       \".\",\n     ],\n@@ -1430,13 +1430,13 @@ const TESTS: Test[] = [\n         prefix: \".\",\n         suffix: \"\",\n         modifier: \"\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!\\\\.)[^\\\\/#\\\\?])+?\",\n       },\n     ],\n     [\n       [\"/route.html\", [\"/route.html\", \"route\", \"html\"]],\n       [\"/route\", null],\n-      [\"/route.html.json\", [\"/route.html.json\", \"route\", \"html.json\"]],\n+      [\"/route.html.json\", [\"/route.html.json\", \"route.html\", \"json\"]],\n     ],\n     [\n       [{}, null],\n@@ -1459,13 +1459,13 @@ const TESTS: Test[] = [\n         prefix: \".\",\n         suffix: \"\",\n         modifier: \"?\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!\\\\.)[^\\\\/#\\\\?])+?\",\n       },\n     ],\n     [\n       [\"/route\", [\"/route\", \"route\", undefined]],\n       [\"/route.json\", [\"/route.json\", \"route\", \"json\"]],\n-      [\"/route.json.html\", [\"/route.json.html\", \"route\", \"json.html\"]],\n+      [\"/route.json.html\", [\"/route.json.html\", \"route.json\", \"html\"]],\n     ],\n     [\n       [{ test: \"route\" }, \"/route\"],\n@@ -1491,13 +1491,13 @@ const TESTS: Test[] = [\n         prefix: \".\",\n         suffix: \"\",\n         modifier: \"?\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!\\\\.)[^\\\\/#\\\\?])+?\",\n       },\n     ],\n     [\n       [\"/route\", [\"/route\", \"route\", undefined]],\n       [\"/route.json\", [\"/route.json\", \"route\", \"json\"]],\n-      [\"/route.json.html\", [\"/route.json.html\", \"route\", \"json.html\"]],\n+      [\"/route.json.html\", [\"/route.json.html\", \"route.json\", \"html\"]],\n     ],\n     [\n       [{ test: \"route\" }, \"/route\"],\n@@ -2084,7 +2084,7 @@ const TESTS: Test[] = [\n         prefix: \"\",\n         suffix: \"\",\n         modifier: \"?\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!\\\\()[^\\\\/#\\\\?])+?\",\n       },\n       \")\",\n     ],\n@@ -2290,7 +2290,7 @@ const TESTS: Test[] = [\n         prefix: \".\",\n         suffix: \"\",\n         modifier: \"\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!\\\\.)[^\\\\/#\\\\?])+?\",\n       },\n     ],\n     [\n@@ -2356,14 +2356,14 @@ const TESTS: Test[] = [\n     [\n       {\n         name: \"foo\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!\\\\$)[^\\\\/#\\\\?])+?\",\n         prefix: \"$\",\n         suffix: \"\",\n         modifier: \"\",\n       },\n       {\n         name: \"bar\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!\\\\$)[^\\\\/#\\\\?])+?\",\n         prefix: \"$\",\n         suffix: \"\",\n         modifier: \"?\",\n@@ -2392,14 +2392,14 @@ const TESTS: Test[] = [\n       },\n       {\n         name: \"attr2\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!-)[^\\\\/#\\\\?])+?\",\n         prefix: \"-\",\n         suffix: \"\",\n         modifier: \"?\",\n       },\n       {\n         name: \"attr3\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n+        pattern: \"(?:(?!-)[^\\\\/#\\\\?])+?\",\n         prefix: \"-\",\n         suffix: \"\",\n         modifier: \"?\",\n@@ -2597,39 +2597,6 @@ const TESTS: Test[] = [\n       [{ foo: \"#\" }, null],\n     ],\n   ],\n-  /**\n-   * https://github.com/pillarjs/path-to-regexp/issues/260\n-   */\n-  [\n-    \":name*\",\n-    undefined,\n-    [\n-      {\n-        name: \"name\",\n-        prefix: \"\",\n-        suffix: \"\",\n-        modifier: \"*\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n-      },\n-    ],\n-    [[\"foobar\", [\"foobar\", \"foobar\"]]],\n-    [[{ name: \"foobar\" }, \"foobar\"]],\n-  ],\n-  [\n-    \":name+\",\n-    undefined,\n-    [\n-      {\n-        name: \"name\",\n-        prefix: \"\",\n-        suffix: \"\",\n-        modifier: \"+\",\n-        pattern: \"[^\\\\/#\\\\?]+?\",\n-      },\n-    ],\n-    [[\"foobar\", [\"foobar\", \"foobar\"]]],\n-    [[{ name: \"foobar\" }, \"foobar\"]],\n-  ],\n ];\n \n /**\n@@ -2799,6 +2766,24 @@ describe(\"path-to-regexp\", () => {\n         pathToRegexp.pathToRegexp(\"/foo?\");\n       }).toThrow(new TypeError(\"Unexpected MODIFIER at 4, expected END\"));\n     });\n+\n+    it(\"should throw on parameters without text between them\", () => {\n+      expect(() => {\n+        pathToRegexp.pathToRegexp(\"/:x:y\");\n+      }).toThrow(\n+        new TypeError(\n+          `Must have text between two parameters, missing text after \"x\"`,\n+        ),\n+      );\n+    });\n+\n+    it(\"should throw on unrepeatable params\", () => {\n+      expect(() => {\n+        pathToRegexp.pathToRegexp(\"/foo:x*\");\n+      }).toThrow(\n+        new TypeError(`Can not repeat \"x\" without a prefix and suffix`),\n+      );\n+    });\n   });\n \n   describe(\"tokens\", () => {"
            },
            {
                "sha": "83d00ead4e68e08a4f3ee4eaf6a9ed5d0030f6c8",
                "filename": "src/index.ts",
                "status": "modified",
                "additions": 27,
                "deletions": 7,
                "changes": 34,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/f1253b47b347dcb909e3e80b0eb2649109e59894/src%2Findex.ts",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/f1253b47b347dcb909e3e80b0eb2649109e59894/src%2Findex.ts",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/src%2Findex.ts?ref=f1253b47b347dcb909e3e80b0eb2649109e59894",
                "patch": "@@ -139,8 +139,7 @@ export interface ParseOptions {\n  */\n export function parse(str: string, options: ParseOptions = {}): Token[] {\n   const tokens = lexer(str);\n-  const { prefixes = \"./\" } = options;\n-  const defaultPattern = `[^${escapeString(options.delimiter || \"/#?\")}]+?`;\n+  const { prefixes = \"./\", delimiter = \"/#?\" } = options;\n   const result: Token[] = [];\n   let key = 0;\n   let i = 0;\n@@ -166,6 +165,25 @@ export function parse(str: string, options: ParseOptions = {}): Token[] {\n     return result;\n   };\n \n+  const isSafe = (value: string): boolean => {\n+    for (const char of delimiter) if (value.indexOf(char) > -1) return true;\n+    return false;\n+  };\n+\n+  const safePattern = (prefix: string) => {\n+    const prev = result[result.length - 1];\n+    const prevText = prefix || (prev && typeof prev === \"string\" ? prev : \"\");\n+\n+    if (prev && !prevText) {\n+      throw new TypeError(\n+        `Must have text between two parameters, missing text after \"${(prev as Key).name}\"`,\n+      );\n+    }\n+\n+    if (!prevText || isSafe(prevText)) return `[^${escapeString(delimiter)}]+?`;\n+    return `(?:(?!${escapeString(prevText)})[^${escapeString(delimiter)}])+?`;\n+  };\n+\n   while (i < tokens.length) {\n     const char = tryConsume(\"CHAR\");\n     const name = tryConsume(\"NAME\");\n@@ -188,7 +206,7 @@ export function parse(str: string, options: ParseOptions = {}): Token[] {\n         name: name || key++,\n         prefix,\n         suffix: \"\",\n-        pattern: pattern || defaultPattern,\n+        pattern: pattern || safePattern(prefix),\n         modifier: tryConsume(\"MODIFIER\") || \"\",\n       });\n       continue;\n@@ -216,7 +234,7 @@ export function parse(str: string, options: ParseOptions = {}): Token[] {\n \n       result.push({\n         name: name || (pattern ? key++ : \"\"),\n-        pattern: name && !pattern ? defaultPattern : pattern,\n+        pattern: name && !pattern ? safePattern(prefix) : pattern,\n         prefix,\n         suffix,\n         modifier: tryConsume(\"MODIFIER\") || \"\",\n@@ -564,10 +582,12 @@ export function tokensToRegexp(\n           }\n         } else {\n           if (token.modifier === \"+\" || token.modifier === \"*\") {\n-            route += `((?:${token.pattern})${token.modifier})`;\n-          } else {\n-            route += `(${token.pattern})${token.modifier}`;\n+            throw new TypeError(\n+              `Can not repeat \"${token.name}\" without a prefix and suffix`,\n+            );\n           }\n+\n+          route += `(${token.pattern})${token.modifier}`;\n         }\n       } else {\n         route += `(?:${prefix}${suffix})${token.modifier}`;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/d31670ae8f6e69cbfd56e835742195b7d10942ef",
        "url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/d31670ae8f6e69cbfd56e835742195b7d10942ef",
        "html_url": "https://github.com/pillarjs/path-to-regexp/commit/d31670ae8f6e69cbfd56e835742195b7d10942ef",
        "message": "Add backtrack protection to 3.x release (#321)",
        "files": [
            {
                "sha": "1326a12da184871dce4a05f90be5c702ded305dc",
                "filename": "index.js",
                "status": "modified",
                "additions": 12,
                "deletions": 1,
                "changes": 13,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/d31670ae8f6e69cbfd56e835742195b7d10942ef/index.js",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/d31670ae8f6e69cbfd56e835742195b7d10942ef/index.js",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/index.js?ref=d31670ae8f6e69cbfd56e835742195b7d10942ef",
                "patch": "@@ -90,6 +90,7 @@ function parse (str, options) {\n     var optional = modifier === '?' || modifier === '*'\n     var pattern = capture || group\n     var delimiter = prev || defaultDelimiter\n+    var prevText = prev || (typeof tokens[tokens.length - 1] === 'string' ? tokens[tokens.length - 1] : '')\n \n     tokens.push({\n       name: name || key++,\n@@ -99,7 +100,7 @@ function parse (str, options) {\n       repeat: repeat,\n       pattern: pattern\n         ? escapeGroup(pattern)\n-        : '[^' + escapeString(delimiter === defaultDelimiter ? delimiter : (delimiter + defaultDelimiter)) + ']+?'\n+        : restrictBacktrack(delimiter, defaultDelimiter, prevText)\n     })\n   }\n \n@@ -111,6 +112,16 @@ function parse (str, options) {\n   return tokens\n }\n \n+function restrictBacktrack (delimiter, defaultDelimiter, prevText) {\n+  var charGroup = '[^' + escapeString(delimiter === defaultDelimiter ? delimiter : (delimiter + defaultDelimiter)) + ']'\n+\n+  if (!prevText || prevText.indexOf(delimiter) > -1 || prevText.indexOf(defaultDelimiter) > -1) {\n+    return charGroup + '+?'\n+  }\n+\n+  return escapeString(prevText) + '|(?:(?!' + escapeString(prevText) + ')' + charGroup + ')+?'\n+}\n+\n /**\n  * Compile a string to a template function for the path.\n  *"
            },
            {
                "sha": "bd1f534d79a929048bd51e864077a49f17aa8f59",
                "filename": "package-lock.json",
                "status": "modified",
                "additions": 2343,
                "deletions": 1560,
                "changes": 3903,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/d31670ae8f6e69cbfd56e835742195b7d10942ef/package-lock.json",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/d31670ae8f6e69cbfd56e835742195b7d10942ef/package-lock.json",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/package-lock.json?ref=d31670ae8f6e69cbfd56e835742195b7d10942ef"
            },
            {
                "sha": "c3af886d80cfe1fd8686b35003ad5e5bbd1744e4",
                "filename": "test.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/d31670ae8f6e69cbfd56e835742195b7d10942ef/test.ts",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/d31670ae8f6e69cbfd56e835742195b7d10942ef/test.ts",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/test.ts?ref=d31670ae8f6e69cbfd56e835742195b7d10942ef",
                "patch": "@@ -2206,7 +2206,7 @@ var TESTS: Test[] = [\n         delimiter: '/',\n         optional: true,\n         repeat: false,\n-        pattern: '[^\\\\/]+?'\n+        pattern: '\\\\(|(?:(?!\\\\()[^\\\\/])+?'\n       },\n       ')'\n     ],\n@@ -2633,7 +2633,7 @@ var TESTS: Test[] = [\n         delimiter: '/',\n         name: 'attr2',\n         optional: true,\n-        pattern: '[^\\\\/]+?',\n+        pattern: '-|(?:(?!-)[^\\\\/])+?',\n         prefix: '',\n         repeat: false\n       }\n@@ -2642,7 +2642,7 @@ var TESTS: Test[] = [\n       ['name/1', null],\n       ['name/1-', ['name/1-', '1', undefined]],\n       ['name/1-2', ['name/1-2', '1', '2']],\n-      ['name/1-2-3', ['name/1-2-3', '1', '2-3']],\n+      ['name/1-2-3', ['name/1-2-3', '1-2', '3']],\n       ['name/foo-bar/route', null],\n       ['name/test/route', null]\n     ],"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485",
        "url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485",
        "html_url": "https://github.com/pillarjs/path-to-regexp/commit/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485",
        "message": "Add backtrack protection to 1.x release (#320)",
        "files": [
            {
                "sha": "73cd8b5862154d17aabe2e75501b50422139ae07",
                "filename": "index.js",
                "status": "modified",
                "additions": 11,
                "deletions": 2,
                "changes": 13,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485/index.js",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485/index.js",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/index.js?ref=925ac8e3c5780b02f58cbd4e52f95da8ad2ac485",
                "patch": "@@ -72,8 +72,9 @@ function parse (str, options) {\n     var partial = prefix != null && next != null && next !== prefix\n     var repeat = modifier === '+' || modifier === '*'\n     var optional = modifier === '?' || modifier === '*'\n-    var delimiter = res[2] || defaultDelimiter\n+    var delimiter = prefix || defaultDelimiter\n     var pattern = capture || group\n+    var prevText = prefix || (typeof tokens[tokens.length - 1] === 'string' ? tokens[tokens.length - 1] : '')\n \n     tokens.push({\n       name: name || key++,\n@@ -83,7 +84,7 @@ function parse (str, options) {\n       repeat: repeat,\n       partial: partial,\n       asterisk: !!asterisk,\n-      pattern: pattern ? escapeGroup(pattern) : (asterisk ? '.*' : '[^' + escapeString(delimiter) + ']+?')\n+      pattern: pattern ? escapeGroup(pattern) : (asterisk ? '.*' : restrictBacktrack(delimiter, prevText))\n     })\n   }\n \n@@ -100,6 +101,14 @@ function parse (str, options) {\n   return tokens\n }\n \n+function restrictBacktrack(delimiter, prevText) {\n+  if (!prevText || prevText.indexOf(delimiter) > -1) {\n+    return '[^' + escapeString(delimiter) + ']+?'\n+  }\n+\n+  return escapeString(prevText) + '|(?:(?!' + escapeString(prevText) + ')[^' + escapeString(delimiter) + '])+?'\n+}\n+\n /**\n  * Compile a string to a template function for the path.\n  *"
            },
            {
                "sha": "ddcac6e01248ff340fe6926eac7e64e0604c749a",
                "filename": "package-lock.json",
                "status": "added",
                "additions": 4226,
                "deletions": 0,
                "changes": 4226,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485/package-lock.json",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485/package-lock.json",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/package-lock.json?ref=925ac8e3c5780b02f58cbd4e52f95da8ad2ac485"
            },
            {
                "sha": "4b9f33101d3a94848367595a9601118a87fe9ecd",
                "filename": "package.json",
                "status": "modified",
                "additions": 4,
                "deletions": 6,
                "changes": 10,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485/package.json",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485/package.json",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/package.json?ref=925ac8e3c5780b02f58cbd4e52f95da8ad2ac485",
                "patch": "@@ -11,10 +11,9 @@\n   ],\n   \"scripts\": {\n     \"lint\": \"standard\",\n-    \"test-spec\": \"mocha --require ts-node/register -R spec --bail test.ts\",\n-    \"test-cov\": \"istanbul cover node_modules/mocha/bin/_mocha -- --require ts-node/register -R spec test.ts\",\n-    \"prepublish\": \"typings install\",\n-    \"test\": \"npm run lint && npm run test-cov\"\n+    \"test-spec\": \"mocha -R spec --bail test.js\",\n+    \"test-cov\": \"istanbul cover node_modules/mocha/bin/_mocha -- -R spec test.js\",\n+    \"test\": \"npm run test-cov\"\n   },\n   \"keywords\": [\n     \"express\",\n@@ -38,8 +37,7 @@\n     \"mocha\": \"~2.2.4\",\n     \"standard\": \"~3.7.3\",\n     \"ts-node\": \"^0.5.5\",\n-    \"typescript\": \"^1.8.7\",\n-    \"typings\": \"^1.0.4\"\n+    \"typescript\": \"^1.8.7\"\n   },\n   \"dependencies\": {\n     \"isarray\": \"0.0.1\""
            },
            {
                "sha": "92a7aae6a96bbbe90b0115f5c9ad77a6ab74b788",
                "filename": "test.js",
                "status": "renamed",
                "additions": 9,
                "deletions": 19,
                "changes": 28,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485/test.js",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/925ac8e3c5780b02f58cbd4e52f95da8ad2ac485/test.js",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/test.js?ref=925ac8e3c5780b02f58cbd4e52f95da8ad2ac485",
                "patch": "@@ -1,27 +1,17 @@\n /* global describe, it */\n \n-/// <reference path=\"typings/index.d.ts\" />\n-\n-import util = require('util')\n-import chai = require('chai')\n-import pathToRegexp = require('./index')\n+const util = require('util')\n+const chai = require('chai')\n+const pathToRegexp = require('./index')\n \n const expect = chai.expect\n \n-type Test = [\n-  pathToRegexp.Path,\n-  pathToRegexp.RegExpOptions & pathToRegexp.ParseOptions,\n-  pathToRegexp.Token[],\n-  Array<[string, string[]]>,\n-  Array<[any, string]>\n-]\n-\n /**\n  * An array of test cases with expected inputs and outputs.\n  *\n  * @type {Array}\n  */\n-var TESTS: Test[] = [\n+var TESTS = [\n   /**\n    * Simple paths.\n    */\n@@ -2062,7 +2052,7 @@ var TESTS: Test[] = [\n         repeat: false,\n         partial: false,\n         asterisk: false,\n-        pattern: '[^\\\\/]+?'\n+        pattern: '\\\\(|(?:(?!\\\\()[^\\\\/])+?'\n       },\n       ')'\n     ],\n@@ -2376,27 +2366,25 @@ describe('path-to-regexp', function () {\n       })\n \n       describe(util.inspect(path), function () {\n-        var re = pathToRegexp(path as string, opts)\n-\n         // Parsing and compiling is only supported with string input.\n         if (typeof path === 'string') {\n           it('should parse', function () {\n             expect(pathToRegexp.parse(path, opts)).to.deep.equal(tokens)\n           })\n \n           describe('compile', function () {\n-            var toPath = pathToRegexp.compile(path as string, opts)\n-\n             compileCases.forEach(function (io) {\n               var input = io[0]\n               var output = io[1]\n \n               if (output != null) {\n                 it('should compile using ' + util.inspect(input), function () {\n+                  var toPath = pathToRegexp.compile(path, opts)\n                   expect(toPath(input)).to.equal(output)\n                 })\n               } else {\n                 it('should not compile using ' + util.inspect(input), function () {\n+                  var toPath = pathToRegexp.compile(path, opts)\n                   expect(function () {\n                     toPath(input)\n                   }).to.throw(TypeError)\n@@ -2406,6 +2394,7 @@ describe('path-to-regexp', function () {\n           })\n         } else {\n           it('should parse keys', function () {\n+            var re = pathToRegexp(path, opts)\n             expect(re.keys).to.deep.equal(keys)\n           })\n         }\n@@ -2417,6 +2406,7 @@ describe('path-to-regexp', function () {\n             var message = 'should' + (output ? ' ' : ' not ') + 'match ' + util.inspect(input)\n \n             it(message, function () {\n+              var re = pathToRegexp(path, opts)\n               expect(exec(re, input)).to.deep.equal(output)\n             })\n           })",
                "previous_filename": "test.ts"
            },
            {
                "sha": "9993f2b3cd395364e8d1e7b70a2c02062d3a63fb",
                "filename": "typings.json",
                "status": "removed",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/32a14b0185ab23c1afae6dd7b624a01ce68fd470/typings.json",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/32a14b0185ab23c1afae6dd7b624a01ce68fd470/typings.json",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/typings.json?ref=32a14b0185ab23c1afae6dd7b624a01ce68fd470",
                "patch": "@@ -1,9 +0,0 @@\n-{\n-  \"devDependencies\": {\n-    \"chai\": \"registry:npm/chai#3.5.0+20160415060238\"\n-  },\n-  \"globalDevDependencies\": {\n-    \"mocha\": \"registry:env/mocha#2.2.5+20160321223601\",\n-    \"node\": \"registry:env/node#4.0.0+20160507210304\"\n-  }\n-}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/60f2121e9b66b7b622cc01080df0aabda9eedee6",
        "url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/60f2121e9b66b7b622cc01080df0aabda9eedee6",
        "html_url": "https://github.com/pillarjs/path-to-regexp/commit/60f2121e9b66b7b622cc01080df0aabda9eedee6",
        "message": "Rewrite and simplify API",
        "files": [
            {
                "sha": "263c0f79cccde0f35b77649fa45c6bb3734c9d0e",
                "filename": "Readme.md",
                "status": "modified",
                "additions": 49,
                "deletions": 182,
                "changes": 231,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/Readme.md",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/60f2121e9b66b7b622cc01080df0aabda9eedee6/Readme.md",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/Readme.md?ref=60f2121e9b66b7b622cc01080df0aabda9eedee6",
                "patch": "@@ -24,29 +24,9 @@ const { match, compile, parse } = require(\"path-to-regexp\");\n // parse(path, options?)\n ```\n \n-### Match\n-\n-The `match` function returns a function for transforming paths into parameters:\n-\n-- **path** A string.\n-- **options** _(optional)_ (See [parse](#parse) for more options)\n-  - **sensitive** Regexp will be case sensitive. (default: `false`)\n-  - **end** Validate the match reaches the end of the string. (default: `true`)\n-  - **decode** Function for decoding strings to params, or `false` to disable all processing. (default: `decodeURIComponent`)\n-\n-```js\n-const fn = match(\"/foo/:bar\");\n-```\n-\n-**Please note:** `path-to-regexp` is intended for ordered data (e.g. pathnames, hostnames). It can not handle arbitrarily ordered data (e.g. query strings, URL fragments, JSON, etc).\n-\n ### Parameters\n \n-Parameters match arbitrary strings in a path by matching up to the end of the segment, or up to any proceeding tokens.\n-\n-#### Named parameters\n-\n-Named parameters are defined by prefixing a colon to the parameter name (`:foo`). Parameter names can use any valid unicode identifier characters, similar to JavaScript.\n+Parameters match arbitrary strings in a path by matching up to the end of the segment, or up to any proceeding tokens. They are defined by prefixing a colon to the parameter name (`:foo`). Parameter names can use any valid JavaScript identifier, or be double quoted to use other characters (`:\"param-name\"`).\n \n ```js\n const fn = match(\"/:foo/:bar\");\n@@ -55,137 +35,54 @@ fn(\"/test/route\");\n //=> { path: '/test/route', params: { foo: 'test', bar: 'route' } }\n ```\n \n-##### Custom matching parameters\n-\n-Parameters can have a custom regexp, which overrides the default match (`[^/]+`). For example, you can match digits or names in a path:\n-\n-```js\n-const exampleNumbers = match(\"/icon-:foo(\\\\d+).png\");\n-\n-exampleNumbers(\"/icon-123.png\");\n-//=> { path: '/icon-123.png', params: { foo: '123' } }\n-\n-exampleNumbers(\"/icon-abc.png\");\n-//=> false\n-\n-const exampleWord = pathToRegexp(\"/(user|u)\");\n-\n-exampleWord(\"/u\");\n-//=> { path: '/u', params: { '0': 'u' } }\n-\n-exampleWord(\"/users\");\n-//=> false\n-```\n-\n-**Tip:** Backslashes need to be escaped with another backslash in JavaScript strings.\n-\n-#### Unnamed parameters\n-\n-It is possible to define a parameter without a name. The name will be numerically indexed:\n-\n-```js\n-const fn = match(\"/:foo/(.*)\");\n-\n-fn(\"/test/route\");\n-//=> { path: '/test/route', params: { '0': 'route', foo: 'test' } }\n-```\n-\n-#### Custom prefix and suffix\n-\n-Parameters can be wrapped in `{}` to create custom prefixes or suffixes for your segment:\n-\n-```js\n-const fn = match(\"{/:attr1}?{-:attr2}?{-:attr3}?\");\n-\n-fn(\"/test\");\n-//=> { path: '/test', params: { attr1: 'test' } }\n-\n-fn(\"/test-test\");\n-//=> { path: '/test-test', params: { attr1: 'test', attr2: 'test' } }\n-```\n-\n-#### Modifiers\n-\n-Modifiers are used after parameters with custom prefixes and suffixes (`{}`).\n-\n-##### Optional\n-\n-Parameters can be suffixed with a question mark (`?`) to make the parameter optional.\n-\n-```js\n-const fn = match(\"/:foo{/:bar}?\");\n-\n-fn(\"/test\");\n-//=> { path: '/test', params: { foo: 'test' } }\n-\n-fn(\"/test/route\");\n-//=> { path: '/test/route', params: { foo: 'test', bar: 'route' } }\n-```\n-\n-##### Zero or more\n+### Wildcard\n \n-Parameters can be suffixed with an asterisk (`*`) to denote a zero or more parameter matches.\n+Wildcard parameters match one or more characters across multiple segments. They are defined the same way as regular parameters, but are prefixed with an asterisk (`*foo`).\n \n ```js\n-const fn = match(\"{/:foo}*\");\n-\n-fn(\"/foo\");\n-//=> { path: '/foo', params: { foo: [ 'foo' ] } }\n+const fn = match(\"/*splat\");\n \n fn(\"/bar/baz\");\n-//=> { path: '/bar/baz', params: { foo: [ 'bar', 'baz' ] } }\n+//=> { path: '/bar/baz', params: { splat: [ 'bar', 'baz' ] } }\n ```\n \n-##### One or more\n+### Optional\n \n-Parameters can be suffixed with a plus sign (`+`) to denote a one or more parameter matches.\n+Braces can be used to define parts of the path that are optional.\n \n ```js\n-const fn = match(\"{/:foo}+\");\n+const fn = match(\"/users{/:id}/delete\");\n \n-fn(\"/\");\n-//=> false\n+fn(\"/users/delete\");\n+//=> { path: '/users/delete', params: {} }\n \n-fn(\"/bar/baz\");\n-//=> { path: '/bar/baz', params: { foo: [ 'bar', 'baz' ] } }\n+fn(\"/users/123/delete\");\n+//=> { path: '/users/123/delete', params: { id: '123' } }\n ```\n \n-##### Custom separator\n-\n-By default, parameters set the separator as the `prefix + suffix` of the token. Using `;` you can modify this:\n-\n-```js\n-const fn = match(\"/name{/:parts;-}+\");\n+## Match\n \n-fn(\"/name\");\n-//=> false\n+The `match` function returns a function for matching strings against a path:\n \n-fn(\"/bar/1-2-3\");\n-//=> { path: '/name/1-2-3', params: { parts: [ '1', '2', '3' ] } }\n-```\n-\n-#### Wildcard\n-\n-A wildcard is also supported. It is roughly equivalent to `(.*)`.\n+- **path** String or array of strings.\n+- **options** _(optional)_ (See [parse](#parse) for more options)\n+  - **sensitive** Regexp will be case sensitive. (default: `false`)\n+  - **end** Validate the match reaches the end of the string. (default: `true`)\n+  - **trailing** Allows optional trailing delimiter to match. (default: `true`)\n+  - **decode** Function for decoding strings to params, or `false` to disable all processing. (default: `decodeURIComponent`)\n \n ```js\n-const fn = match(\"/*\");\n-\n-fn(\"/\");\n-//=> { path: '/', params: {} }\n-\n-fn(\"/bar/baz\");\n-//=> { path: '/bar/baz', params: { '0': [ 'bar', 'baz' ] } }\n+const fn = match(\"/foo/:bar\");\n ```\n \n-### Compile (\"Reverse\" Path-To-RegExp)\n+**Please note:** `path-to-regexp` is intended for ordered data (e.g. pathnames, hostnames). It can not handle arbitrarily ordered data (e.g. query strings, URL fragments, JSON, etc).\n+\n+## Compile (\"Reverse\" Path-To-RegExp)\n \n The `compile` function will return a function for transforming parameters into a valid path:\n \n - **path** A string.\n - **options** (See [parse](#parse) for more options)\n-  - **sensitive** Regexp will be case sensitive. (default: `false`)\n-  - **validate** When `false` the function can produce an invalid (unmatched) path. (default: `true`)\n   - **encode** Function for encoding input strings for output into the path, or `false` to disable entirely. (default: `encodeURIComponent`)\n \n ```js\n@@ -194,46 +91,34 @@ const toPath = compile(\"/user/:id\");\n toPath({ id: \"name\" }); //=> \"/user/name\"\n toPath({ id: \"caf\u00e9\" }); //=> \"/user/caf%C3%A9\"\n \n-// When disabling `encode`, you need to make sure inputs are encoded correctly. No arrays are accepted.\n-const toPathRaw = compile(\"/user/:id\", { encode: false });\n-\n-toPathRaw({ id: \"%3A%2F\" }); //=> \"/user/%3A%2F\"\n-toPathRaw({ id: \":/\" }); //=> Throws, \"/user/:/\" when `validate` is `false`.\n-\n-const toPathRepeated = compile(\"{/:segment}+\");\n+const toPathRepeated = compile(\"/*segment\");\n \n toPathRepeated({ segment: [\"foo\"] }); //=> \"/foo\"\n toPathRepeated({ segment: [\"a\", \"b\", \"c\"] }); //=> \"/a/b/c\"\n \n-const toPathRegexp = compile(\"/user/:id(\\\\d+)\");\n+// When disabling `encode`, you need to make sure inputs are encoded correctly. No arrays are accepted.\n+const toPathRaw = compile(\"/user/:id\", { encode: false });\n \n-toPathRegexp({ id: \"123\" }); //=> \"/user/123\"\n+toPathRaw({ id: \"%3A%2F\" }); //=> \"/user/%3A%2F\"\n ```\n \n ## Developers\n \n - If you are rewriting paths with match and compile, consider using `encode: false` and `decode: false` to keep raw paths passed around.\n-- To ensure matches work on paths containing characters usually encoded, consider using [encodeurl](https://github.com/pillarjs/encodeurl) for `encodePath`.\n+- To ensure matches work on paths containing characters usually encoded, such as emoji, consider using [encodeurl](https://github.com/pillarjs/encodeurl) for `encodePath`.\n \n ### Parse\n \n-The `parse` function accepts a string and returns `TokenData`, the set of tokens and other metadata parsed from the input string. `TokenData` is can used with `$match` and `$compile`.\n+The `parse` function accepts a string and returns `TokenData`, the set of tokens and other metadata parsed from the input string. `TokenData` is can used with `match` and `compile`.\n \n - **path** A string.\n - **options** _(optional)_\n   - **delimiter** The default delimiter for segments, e.g. `[^/]` for `:named` parameters. (default: `'/'`)\n-  - **encodePath** A function for encoding input strings. (default: `x => x`, recommended: [`encodeurl`](https://github.com/pillarjs/encodeurl) for unicode encoding)\n+  - **encodePath** A function for encoding input strings. (default: `x => x`, recommended: [`encodeurl`](https://github.com/pillarjs/encodeurl))\n \n ### Tokens\n \n-The `tokens` returned by `TokenData` is an array of strings or keys, represented as objects, with the following properties:\n-\n-- `name` The name of the token\n-- `prefix` _(optional)_ The prefix string for the segment (e.g. `\"/\"`)\n-- `suffix` _(optional)_ The suffix string for the segment (e.g. `\"\"`)\n-- `pattern` _(optional)_ The pattern defined to match this token\n-- `modifier` _(optional)_ The modifier character used for the segment (e.g. `?`)\n-- `separator` _(optional)_ The string used to separate repeated parameters\n+`TokenData` is a sequence of tokens, currently of types `text`, `parameter`, `wildcard`, or `group`.\n \n ### Custom path\n \n@@ -242,9 +127,12 @@ In some applications, you may not be able to use the `path-to-regexp` syntax, bu\n ```js\n import { TokenData, match } from \"path-to-regexp\";\n \n-const tokens = [\"/\", { name: \"foo\" }];\n-const path = new TokenData(tokens, \"/\");\n-const fn = $match(path);\n+const tokens = [\n+  { type: \"text\", value: \"/\" },\n+  { type: \"parameter\", name: \"foo\" },\n+];\n+const path = new TokenData(tokens);\n+const fn = match(path);\n \n fn(\"/test\"); //=> { path: '/test', index: 0, params: { foo: 'test' } }\n ```\n@@ -253,55 +141,34 @@ fn(\"/test\"); //=> { path: '/test', index: 0, params: { foo: 'test' } }\n \n An effort has been made to ensure ambiguous paths from previous releases throw an error. This means you might be seeing an error when things worked before.\n \n-### Unexpected `?`, `*`, or `+`\n-\n-In previous major versions `/` and `.` were used as implicit prefixes of parameters. So `/:key?` was implicitly `{/:key}?`. For example:\n-\n-- `/:key?` \u2192 `{/:key}?` or `/:key*` \u2192 `{/:key}*` or `/:key+` \u2192 `{/:key}+`\n-- `.:key?` \u2192 `{.:key}?` or `.:key*` \u2192 `{.:key}*` or `.:key+` \u2192 `{.:key}+`\n-- `:key?` \u2192 `{:key}?` or `:key*` \u2192 `{:key}*` or `:key+` \u2192 `{:key}+`\n+### Unexpected `?` or `+`\n \n-### Unexpected `;`\n+In past releases, `?`, `*`, and `+` were used to denote optional or repeating parameters. As an alternative, try these:\n \n-Used as a [custom separator](#custom-separator) for repeated parameters.\n+- For optional (`?`), use an empty segment in a group such as `/:file{.:ext}`.\n+- For repeating (`+`), only wildcard matching is supported, such as `/*path`.\n+- For optional repeating (`*`), use a group and a wildcard parameter such as `/files{/*path}`.\n \n-### Unexpected `!`, `@`, or `,`\n+### Unexpected `(`, `)`, `[`, `]`, etc.\n \n-These characters have been reserved for future use.\n-\n-### Missing separator\n-\n-Repeated parameters must have a separator to be valid. For example, `{:foo}*` can't be used. Separators can be defined manually, such as `{:foo;/}*`, or they default to the suffix and prefix with the parameter, such as `{/:foo}*`.\n+Previous versions of Path-to-RegExp used these for RegExp features. This version no longer supports them so they've been reserved to avoid ambiguity. To use these characters literally, escape them with a backslash, e.g. `\"\\\\(\"`.\n \n ### Missing parameter name\n \n-Parameter names, the part after `:`, must be a valid JavaScript identifier. For example, it cannot start with a number or dash. If you want a parameter name that uses these characters you can wrap the name in quotes, e.g. `:\"my-name\"`.\n+Parameter names, the part after `:` or `*`, must be a valid JavaScript identifier. For example, it cannot start with a number or contain a dash. If you want a parameter name that uses these characters you can wrap the name in quotes, e.g. `:\"my-name\"`.\n \n ### Unterminated quote\n \n Parameter names can be wrapped in double quote characters, and this error means you forgot to close the quote character.\n \n-### Pattern cannot start with \"?\"\n-\n-Parameters in `path-to-regexp` must be basic groups. However, you can use features that require the `?` nested within the pattern. For example, `:foo((?!login)[^/]+)` is valid, but `:foo(?!login)` is not.\n-\n-### Capturing groups are not allowed\n-\n-A parameter pattern can not contain nested capturing groups.\n-\n-### Unbalanced or missing pattern\n-\n-A parameter pattern must have the expected number of parentheses. An unbalanced amount, such as `((?!login)` implies something has been written that is invalid. Check you didn't forget any parentheses.\n-\n ### Express <= 4.x\n \n Path-To-RegExp breaks compatibility with Express <= `4.x` in the following ways:\n \n-- The only part of the string that is a regex is within `()`.\n-  - In Express.js 4.x, everything was passed as-is after a simple replacement, so you could write `/[a-z]+` to match `/test`.\n-- The `?` optional character must be used after `{}`.\n+- Regexp characters can no longer be provided.\n+- The optional character `?` is no longer supported, use braces instead: `/:file{.:ext}`.\n - Some characters have new meaning or have been reserved (`{}?*+@!;`).\n-- The parameter name now supports all unicode identifier characters, previously it was only `[a-z0-9]`.\n+- The parameter name now supports all JavaScript identifier characters, previously it was only `[a-z0-9]`.\n \n ## License\n "
            },
            {
                "sha": "a57212a24ba7aac0648e2f57bfaa46ef337dba09",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/package.json",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/60f2121e9b66b7b622cc01080df0aabda9eedee6/package.json",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/package.json?ref=60f2121e9b66b7b622cc01080df0aabda9eedee6",
                "patch": "@@ -20,6 +20,7 @@\n     \"dist/\"\n   ],\n   \"scripts\": {\n+    \"bench\": \"vitest bench\",\n     \"build\": \"ts-scripts build\",\n     \"format\": \"ts-scripts format\",\n     \"lint\": \"ts-scripts lint\","
            },
            {
                "sha": "841cd073e94274ba3fe91bca1d0d0917c57b3e5d",
                "filename": "scripts/redos.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 7,
                "changes": 8,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/scripts%2Fredos.ts",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/60f2121e9b66b7b622cc01080df0aabda9eedee6/scripts%2Fredos.ts",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/scripts%2Fredos.ts?ref=60f2121e9b66b7b622cc01080df0aabda9eedee6",
                "patch": "@@ -5,13 +5,7 @@ import { MATCH_TESTS } from \"../src/cases.spec.js\";\n let safe = 0;\n let fail = 0;\n \n-const TESTS = new Set(MATCH_TESTS.map((test) => test.path));\n-// const TESTS = [\n-//   \":path([^\\\\.]+).:ext\",\n-//   \":path.:ext(\\\\w+)\",\n-//   \":path{.:ext([^\\\\.]+)}\",\n-//   \"/:path.:ext(\\\\\\\\w+)\",\n-// ];\n+const TESTS = MATCH_TESTS.map((x) => x.path);\n \n for (const path of TESTS) {\n   const { re } = match(path) as any;"
            },
            {
                "sha": "ef06e1f27cddeef4aa1302f8fb138618fc39d93c",
                "filename": "src/cases.spec.ts",
                "status": "modified",
                "additions": 329,
                "deletions": 1036,
                "changes": 1365,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/src%2Fcases.spec.ts",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/60f2121e9b66b7b622cc01080df0aabda9eedee6/src%2Fcases.spec.ts",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/src%2Fcases.spec.ts?ref=60f2121e9b66b7b622cc01080df0aabda9eedee6",
                "patch": "@@ -34,31 +34,56 @@ export interface MatchTestSet {\n export const PARSER_TESTS: ParserTestSet[] = [\n   {\n     path: \"/\",\n-    expected: [\"/\"],\n+    expected: [{ type: \"text\", value: \"/\" }],\n   },\n   {\n     path: \"/:test\",\n-    expected: [\"/\", { name: \"test\" }],\n+    expected: [\n+      { type: \"text\", value: \"/\" },\n+      { type: \"param\", name: \"test\" },\n+    ],\n   },\n   {\n     path: '/:\"0\"',\n-    expected: [\"/\", { name: \"0\" }],\n+    expected: [\n+      { type: \"text\", value: \"/\" },\n+      { type: \"param\", name: \"0\" },\n+    ],\n   },\n   {\n     path: \"/:_\",\n-    expected: [\"/\", { name: \"_\" }],\n+    expected: [\n+      { type: \"text\", value: \"/\" },\n+      { type: \"param\", name: \"_\" },\n+    ],\n   },\n   {\n     path: \"/:caf\u00e9\",\n-    expected: [\"/\", { name: \"caf\u00e9\" }],\n+    expected: [\n+      { type: \"text\", value: \"/\" },\n+      { type: \"param\", name: \"caf\u00e9\" },\n+    ],\n   },\n   {\n     path: '/:\"123\"',\n-    expected: [\"/\", { name: \"123\" }],\n+    expected: [\n+      { type: \"text\", value: \"/\" },\n+      { type: \"param\", name: \"123\" },\n+    ],\n   },\n   {\n     path: '/:\"1\\\\\"\\\\2\\\\\"3\"',\n-    expected: [\"/\", { name: '1\"2\"3' }],\n+    expected: [\n+      { type: \"text\", value: \"/\" },\n+      { type: \"param\", name: '1\"2\"3' },\n+    ],\n+  },\n+  {\n+    path: \"/*path\",\n+    expected: [\n+      { type: \"text\", value: \"/\" },\n+      { type: \"wildcard\", name: \"path\" },\n+    ],\n   },\n ];\n \n@@ -106,7 +131,6 @@ export const COMPILE_TESTS: CompileTestSet[] = [\n   },\n   {\n     path: \"/:test\",\n-    options: { validate: false },\n     tests: [\n       { input: undefined, expected: null },\n       { input: {}, expected: null },\n@@ -116,24 +140,14 @@ export const COMPILE_TESTS: CompileTestSet[] = [\n   },\n   {\n     path: \"/:test\",\n-    options: { validate: false, encode: false },\n+    options: { encode: false },\n     tests: [\n       { input: undefined, expected: null },\n       { input: {}, expected: null },\n       { input: { test: \"123\" }, expected: \"/123\" },\n       { input: { test: \"123/xyz\" }, expected: \"/123/xyz\" },\n     ],\n   },\n-  {\n-    path: \"/:test\",\n-    options: { encode: encodeURIComponent },\n-    tests: [\n-      { input: undefined, expected: null },\n-      { input: {}, expected: null },\n-      { input: { test: \"123\" }, expected: \"/123\" },\n-      { input: { test: \"123/xyz\" }, expected: \"/123%2Fxyz\" },\n-    ],\n-  },\n   {\n     path: \"/:test\",\n     options: { encode: () => \"static\" },\n@@ -145,56 +159,32 @@ export const COMPILE_TESTS: CompileTestSet[] = [\n     ],\n   },\n   {\n-    path: \"{/:test}?\",\n+    path: \"{/:test}\",\n     options: { encode: false },\n     tests: [\n       { input: undefined, expected: \"\" },\n       { input: {}, expected: \"\" },\n       { input: { test: undefined }, expected: \"\" },\n       { input: { test: \"123\" }, expected: \"/123\" },\n-      { input: { test: \"123/xyz\" }, expected: null },\n+      { input: { test: \"123/xyz\" }, expected: \"/123/xyz\" },\n     ],\n   },\n   {\n-    path: \"/:test(.*)\",\n-    options: { encode: false },\n+    path: \"/*test\",\n     tests: [\n       { input: undefined, expected: null },\n       { input: {}, expected: null },\n-      { input: { test: \"\" }, expected: \"/\" },\n-      { input: { test: \"123\" }, expected: \"/123\" },\n-      { input: { test: \"123/xyz\" }, expected: \"/123/xyz\" },\n-    ],\n-  },\n-  {\n-    path: \"{/:test}*\",\n-    tests: [\n-      { input: undefined, expected: \"\" },\n-      { input: {}, expected: \"\" },\n-      { input: { test: [] }, expected: \"\" },\n-      { input: { test: [\"\"] }, expected: null },\n+      { input: { test: [] }, expected: null },\n       { input: { test: [\"123\"] }, expected: \"/123\" },\n-      { input: { test: \"123/xyz\" }, expected: null },\n       { input: { test: [\"123\", \"xyz\"] }, expected: \"/123/xyz\" },\n     ],\n   },\n   {\n-    path: \"{/:test}*\",\n+    path: \"/*test\",\n     options: { encode: false },\n     tests: [\n-      { input: undefined, expected: \"\" },\n-      { input: {}, expected: \"\" },\n-      { input: { test: \"\" }, expected: null },\n       { input: { test: \"123\" }, expected: \"/123\" },\n       { input: { test: \"123/xyz\" }, expected: \"/123/xyz\" },\n-      { input: { test: [\"123\", \"xyz\"] }, expected: null },\n-    ],\n-  },\n-  {\n-    path: \"/{<:foo>}+\",\n-    tests: [\n-      { input: undefined, expected: null },\n-      { input: { foo: [\"x\", \"y\", \"z\"] }, expected: \"/<x><y><z>\" },\n     ],\n   },\n ];\n@@ -227,7 +217,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       { input: \"/test/route\", expected: false },\n       {\n         input: \"/test/\",\n-        expected: false,\n+        expected: { path: \"/test/\", params: {} },\n       },\n     ],\n   },\n@@ -242,7 +232,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       { input: \"/test\", expected: false },\n       {\n         input: \"/test//\",\n-        expected: false,\n+        expected: { path: \"/test//\", params: {} },\n       },\n     ],\n   },\n@@ -255,7 +245,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/route/\",\n-        expected: false,\n+        expected: { path: \"/route/\", params: { test: \"route\" } },\n       },\n       {\n         input: \"/route.json\",\n@@ -266,7 +256,10 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/route.json/\",\n-        expected: false,\n+        expected: {\n+          path: \"/route.json/\",\n+          params: { test: \"route.json\" },\n+        },\n       },\n       {\n         input: \"/route/test\",\n@@ -341,7 +334,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/test/\",\n-        expected: { path: \"/test\", params: {} },\n+        expected: { path: \"/test/\", params: {} },\n       },\n       {\n         input: \"/test////\",\n@@ -377,7 +370,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/test//\",\n-        expected: { path: \"/test/\", params: {} },\n+        expected: { path: \"/test//\", params: {} },\n       },\n       {\n         input: \"/test/route\",\n@@ -401,7 +394,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/route/\",\n-        expected: { path: \"/route\", params: { test: \"route\" } },\n+        expected: { path: \"/route/\", params: { test: \"route\" } },\n       },\n       {\n         input: \"/route.json\",\n@@ -413,7 +406,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       {\n         input: \"/route.json/\",\n         expected: {\n-          path: \"/route.json\",\n+          path: \"/route.json/\",\n           params: { test: \"route.json\" },\n         },\n       },\n@@ -477,7 +470,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/\",\n-        expected: { path: \"\", params: {} },\n+        expected: { path: \"/\", params: {} },\n       },\n       {\n         input: \"route\",\n@@ -498,7 +491,28 @@ export const MATCH_TESTS: MatchTestSet[] = [\n    * Optional.\n    */\n   {\n-    path: \"{/:test}?\",\n+    path: \"{/route}\",\n+    tests: [\n+      {\n+        input: \"\",\n+        expected: { path: \"\", params: {} },\n+      },\n+      {\n+        input: \"/\",\n+        expected: { path: \"/\", params: {} },\n+      },\n+      {\n+        input: \"/foo\",\n+        expected: false,\n+      },\n+      {\n+        input: \"/route\",\n+        expected: { path: \"/route\", params: {} },\n+      },\n+    ],\n+  },\n+  {\n+    path: \"{/:test}\",\n     tests: [\n       {\n         input: \"/route\",\n@@ -510,12 +524,12 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/\",\n-        expected: false,\n+        expected: { path: \"/\", params: {} },\n       },\n     ],\n   },\n   {\n-    path: \"{/:test}?/bar\",\n+    path: \"{/:test}/bar\",\n     tests: [\n       {\n         input: \"/bar\",\n@@ -527,12 +541,12 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/foo/bar/\",\n-        expected: false,\n+        expected: { path: \"/foo/bar/\", params: { test: \"foo\" } },\n       },\n     ],\n   },\n   {\n-    path: \"{/:test}?-bar\",\n+    path: \"{/:test}-bar\",\n     tests: [\n       {\n         input: \"-bar\",\n@@ -544,12 +558,12 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/foo-bar/\",\n-        expected: false,\n+        expected: { path: \"/foo-bar/\", params: { test: \"foo\" } },\n       },\n     ],\n   },\n   {\n-    path: \"/{:test}?-bar\",\n+    path: \"/{:test}-bar\",\n     tests: [\n       {\n         input: \"/-bar\",\n@@ -561,810 +575,266 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/foo-bar/\",\n-        expected: false,\n+        expected: { path: \"/foo-bar/\", params: { test: \"foo\" } },\n       },\n     ],\n   },\n \n   /**\n-   * Zero or more times.\n+   * No prefix characters.\n    */\n   {\n-    path: \"{/:test}*\",\n+    path: \"test\",\n     tests: [\n       {\n-        input: \"/\",\n-        expected: false,\n+        input: \"test\",\n+        expected: { path: \"test\", params: {} },\n       },\n       {\n-        input: \"//\",\n+        input: \"/test\",\n         expected: false,\n       },\n-      {\n-        input: \"/route\",\n-        expected: { path: \"/route\", params: { test: [\"route\"] } },\n-      },\n-      {\n-        input: \"/some/basic/route\",\n-        expected: {\n-          path: \"/some/basic/route\",\n-          params: { test: [\"some\", \"basic\", \"route\"] },\n-        },\n-      },\n     ],\n   },\n   {\n-    path: \"{/:test}*-bar\",\n+    path: \":test\",\n     tests: [\n       {\n-        input: \"-bar\",\n-        expected: { path: \"-bar\", params: {} },\n+        input: \"route\",\n+        expected: { path: \"route\", params: { test: \"route\" } },\n       },\n       {\n-        input: \"/-bar\",\n+        input: \"/route\",\n         expected: false,\n       },\n       {\n-        input: \"/foo-bar\",\n-        expected: { path: \"/foo-bar\", params: { test: [\"foo\"] } },\n+        input: \"route/\",\n+        expected: { path: \"route/\", params: { test: \"route\" } },\n+      },\n+    ],\n+  },\n+  {\n+    path: \"{:test}\",\n+    tests: [\n+      {\n+        input: \"test\",\n+        expected: { path: \"test\", params: { test: \"test\" } },\n       },\n       {\n-        input: \"/foo/baz-bar\",\n-        expected: {\n-          path: \"/foo/baz-bar\",\n-          params: { test: [\"foo\", \"baz\"] },\n-        },\n+        input: \"\",\n+        expected: { path: \"\", params: {} },\n       },\n     ],\n   },\n \n   /**\n-   * One or more times.\n+   * Formats.\n    */\n   {\n-    path: \"{/:test}+\",\n+    path: \"/test.json\",\n     tests: [\n       {\n-        input: \"/\",\n-        expected: false,\n+        input: \"/test.json\",\n+        expected: { path: \"/test.json\", params: {} },\n       },\n       {\n-        input: \"//\",\n+        input: \"/test\",\n         expected: false,\n       },\n-      {\n-        input: \"/route\",\n-        expected: { path: \"/route\", params: { test: [\"route\"] } },\n-      },\n-      {\n-        input: \"/some/basic/route\",\n-        expected: {\n-          path: \"/some/basic/route\",\n-          params: { test: [\"some\", \"basic\", \"route\"] },\n-        },\n-      },\n     ],\n   },\n   {\n-    path: \"{/:test}+-bar\",\n+    path: \"/:test.json\",\n     tests: [\n       {\n-        input: \"-bar\",\n+        input: \"/.json\",\n         expected: false,\n       },\n       {\n-        input: \"/-bar\",\n-        expected: false,\n+        input: \"/test.json\",\n+        expected: { path: \"/test.json\", params: { test: \"test\" } },\n       },\n       {\n-        input: \"/foo-bar\",\n-        expected: { path: \"/foo-bar\", params: { test: [\"foo\"] } },\n+        input: \"/route.json\",\n+        expected: { path: \"/route.json\", params: { test: \"route\" } },\n       },\n       {\n-        input: \"/foo/baz-bar\",\n-        expected: {\n-          path: \"/foo/baz-bar\",\n-          params: { test: [\"foo\", \"baz\"] },\n-        },\n+        input: \"/route.json.json\",\n+        expected: { path: \"/route.json.json\", params: { test: \"route.json\" } },\n       },\n     ],\n   },\n \n   /**\n-   * Custom parameters.\n+   * Format and path params.\n    */\n   {\n-    path: String.raw`/:test(\\d+)`,\n+    path: \"/:test.:format\",\n     tests: [\n       {\n-        input: \"/123\",\n-        expected: { path: \"/123\", params: { test: \"123\" } },\n+        input: \"/route.html\",\n+        expected: {\n+          path: \"/route.html\",\n+          params: { test: \"route\", format: \"html\" },\n+        },\n       },\n       {\n-        input: \"/abc\",\n+        input: \"/route\",\n         expected: false,\n       },\n       {\n-        input: \"/123/abc\",\n-        expected: false,\n+        input: \"/route.html.json\",\n+        expected: {\n+          path: \"/route.html.json\",\n+          params: { test: \"route.html\", format: \"json\" },\n+        },\n       },\n     ],\n   },\n   {\n-    path: String.raw`/:test(\\d+)-bar`,\n+    path: \"/:test{.:format}\",\n     tests: [\n       {\n-        input: \"-bar\",\n-        expected: false,\n+        input: \"/route\",\n+        expected: { path: \"/route\", params: { test: \"route\" } },\n       },\n       {\n-        input: \"/-bar\",\n-        expected: false,\n+        input: \"/route.json\",\n+        expected: {\n+          path: \"/route.json\",\n+          params: { test: \"route\", format: \"json\" },\n+        },\n       },\n       {\n-        input: \"/abc-bar\",\n-        expected: false,\n+        input: \"/route.json.html\",\n+        expected: {\n+          path: \"/route.json.html\",\n+          params: { test: \"route.json\", format: \"html\" },\n+        },\n       },\n+    ],\n+  },\n+  {\n+    path: \"/:test.:format\\\\z\",\n+    tests: [\n       {\n-        input: \"/123-bar\",\n-        expected: { path: \"/123-bar\", params: { test: \"123\" } },\n+        input: \"/route.htmlz\",\n+        expected: {\n+          path: \"/route.htmlz\",\n+          params: { test: \"route\", format: \"html\" },\n+        },\n       },\n       {\n-        input: \"/123/456-bar\",\n+        input: \"/route.html\",\n         expected: false,\n       },\n     ],\n   },\n+\n+  /**\n+   * Escaped characters.\n+   */\n   {\n-    path: \"/:test(.*)\",\n+    path: \"/\\\\(testing\\\\)\",\n     tests: [\n       {\n-        input: \"/\",\n-        expected: { path: \"/\", params: { test: \"\" } },\n+        input: \"/testing\",\n+        expected: false,\n       },\n       {\n-        input: \"/route\",\n-        expected: { path: \"/route\", params: { test: \"route\" } },\n+        input: \"/(testing)\",\n+        expected: { path: \"/(testing)\", params: {} },\n       },\n+    ],\n+  },\n+  {\n+    path: \"/.\\\\+\\\\*\\\\?\\\\{\\\\}=^\\\\!\\\\:$\\\\[\\\\]\\\\|\",\n+    tests: [\n       {\n-        input: \"/route/123\",\n-        expected: {\n-          path: \"/route/123\",\n-          params: { test: \"route/123\" },\n-        },\n+        input: \"/.+*?{}=^!:$[]|\",\n+        expected: { path: \"/.+*?{}=^!:$[]|\", params: {} },\n       },\n+    ],\n+  },\n+\n+  /**\n+   * Random examples.\n+   */\n+  {\n+    path: \"/:foo/:bar\",\n+    tests: [\n       {\n-        input: \"/;,:@&=/+$-_.!/~*()\",\n+        input: \"/match/route\",\n         expected: {\n-          path: \"/;,:@&=/+$-_.!/~*()\",\n-          params: { test: \";,:@&=/+$-_.!/~*()\" },\n+          path: \"/match/route\",\n+          params: { foo: \"match\", bar: \"route\" },\n         },\n       },\n     ],\n   },\n   {\n-    path: \"/:test([a-z]+)\",\n+    path: \"/:foo\\\\(test\\\\)/bar\",\n     tests: [\n       {\n-        input: \"/abc\",\n-        expected: { path: \"/abc\", params: { test: \"abc\" } },\n-      },\n-      {\n-        input: \"/123\",\n-        expected: false,\n+        input: \"/foo(test)/bar\",\n+        expected: { path: \"/foo(test)/bar\", params: { foo: \"foo\" } },\n       },\n       {\n-        input: \"/abc/123\",\n+        input: \"/foo/bar\",\n         expected: false,\n       },\n     ],\n   },\n   {\n-    path: \"/:test(this|that)\",\n+    path: \"/:foo\\\\?\",\n     tests: [\n       {\n-        input: \"/this\",\n-        expected: { path: \"/this\", params: { test: \"this\" } },\n-      },\n-      {\n-        input: \"/that\",\n-        expected: { path: \"/that\", params: { test: \"that\" } },\n+        input: \"/route?\",\n+        expected: { path: \"/route?\", params: { foo: \"route\" } },\n       },\n       {\n-        input: \"/foo\",\n+        input: \"/route\",\n         expected: false,\n       },\n     ],\n   },\n   {\n-    path: \"{/:test(abc|xyz)}*\",\n+    path: \"/{:pre}baz\",\n     tests: [\n       {\n-        input: \"/\",\n-        expected: false,\n+        input: \"/foobaz\",\n+        expected: { path: \"/foobaz\", params: { pre: \"foo\" } },\n       },\n       {\n-        input: \"/abc\",\n-        expected: { path: \"/abc\", params: { test: [\"abc\"] } },\n+        input: \"/baz\",\n+        expected: { path: \"/baz\", params: { pre: undefined } },\n       },\n+    ],\n+  },\n+  {\n+    path: \"/:foo\\\\(:bar\\\\)\",\n+    tests: [\n       {\n-        input: \"/abc/abc\",\n+        input: \"/hello(world)\",\n         expected: {\n-          path: \"/abc/abc\",\n-          params: { test: [\"abc\", \"abc\"] },\n+          path: \"/hello(world)\",\n+          params: { foo: \"hello\", bar: \"world\" },\n         },\n       },\n       {\n-        input: \"/xyz/xyz\",\n-        expected: {\n-          path: \"/xyz/xyz\",\n-          params: { test: [\"xyz\", \"xyz\"] },\n-        },\n+        input: \"/hello()\",\n+        expected: false,\n       },\n+    ],\n+  },\n+  {\n+    path: \"/:foo\\\\({:bar}\\\\)\",\n+    tests: [\n       {\n-        input: \"/abc/xyz\",\n+        input: \"/hello(world)\",\n         expected: {\n-          path: \"/abc/xyz\",\n-          params: { test: [\"abc\", \"xyz\"] },\n-        },\n-      },\n-      {\n-        input: \"/abc/xyz/abc/xyz\",\n-        expected: {\n-          path: \"/abc/xyz/abc/xyz\",\n-          params: { test: [\"abc\", \"xyz\", \"abc\", \"xyz\"] },\n-        },\n-      },\n-      {\n-        input: \"/xyzxyz\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * No prefix characters.\n-   */\n-  {\n-    path: \"test\",\n-    tests: [\n-      {\n-        input: \"test\",\n-        expected: { path: \"test\", params: {} },\n-      },\n-      {\n-        input: \"/test\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \":test\",\n-    tests: [\n-      {\n-        input: \"route\",\n-        expected: { path: \"route\", params: { test: \"route\" } },\n-      },\n-      {\n-        input: \"/route\",\n-        expected: false,\n-      },\n-      {\n-        input: \"route/\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"{:test}?\",\n-    tests: [\n-      {\n-        input: \"test\",\n-        expected: { path: \"test\", params: { test: \"test\" } },\n-      },\n-      {\n-        input: \"\",\n-        expected: { path: \"\", params: {} },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"{:test/}+\",\n-    tests: [\n-      {\n-        input: \"route/\",\n-        expected: { path: \"route/\", params: { test: [\"route\"] } },\n-      },\n-      {\n-        input: \"/route\",\n-        expected: false,\n-      },\n-      {\n-        input: \"\",\n-        expected: false,\n-      },\n-      {\n-        input: \"foo/bar/\",\n-        expected: {\n-          path: \"foo/bar/\",\n-          params: { test: [\"foo\", \"bar\"] },\n-        },\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * Formats.\n-   */\n-  {\n-    path: \"/test.json\",\n-    tests: [\n-      {\n-        input: \"/test.json\",\n-        expected: { path: \"/test.json\", params: {} },\n-      },\n-      {\n-        input: \"/test\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:test.json\",\n-    tests: [\n-      {\n-        input: \"/.json\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/test.json\",\n-        expected: { path: \"/test.json\", params: { test: \"test\" } },\n-      },\n-      {\n-        input: \"/route.json\",\n-        expected: { path: \"/route.json\", params: { test: \"route\" } },\n-      },\n-      {\n-        input: \"/route.json.json\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:test([^/]+).json\",\n-    tests: [\n-      {\n-        input: \"/route.json.json\",\n-        expected: {\n-          path: \"/route.json.json\",\n-          params: { test: \"route.json\" },\n-        },\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * Format params.\n-   */\n-  {\n-    path: \"/test.:format(\\\\w+)\",\n-    tests: [\n-      {\n-        input: \"/test.html\",\n-        expected: { path: \"/test.html\", params: { format: \"html\" } },\n-      },\n-      {\n-        input: \"/test\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/test.:format(\\\\w+).:format(\\\\w+)\",\n-    tests: [\n-      {\n-        input: \"/test.html.json\",\n-        expected: {\n-          path: \"/test.html.json\",\n-          params: { format: \"json\" },\n-        },\n-      },\n-      {\n-        input: \"/test.html\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/test{.:format(\\\\w+)}?\",\n-    tests: [\n-      {\n-        input: \"/test\",\n-        expected: { path: \"/test\", params: { format: undefined } },\n-      },\n-      {\n-        input: \"/test.html\",\n-        expected: { path: \"/test.html\", params: { format: \"html\" } },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/test{.:format(\\\\w+)}+\",\n-    tests: [\n-      {\n-        input: \"/test\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/test.html\",\n-        expected: {\n-          path: \"/test.html\",\n-          params: { format: [\"html\"] },\n-        },\n-      },\n-      {\n-        input: \"/test.html.json\",\n-        expected: {\n-          path: \"/test.html.json\",\n-          params: { format: [\"html\", \"json\"] },\n-        },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/test{.:format}+\",\n-    tests: [\n-      {\n-        input: \"/test\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/test.html\",\n-        expected: {\n-          path: \"/test.html\",\n-          params: { format: [\"html\"] },\n-        },\n-      },\n-      {\n-        input: \"/test.hbs.html\",\n-        expected: {\n-          path: \"/test.hbs.html\",\n-          params: { format: [\"hbs\", \"html\"] },\n-        },\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * Format and path params.\n-   */\n-  {\n-    path: \"/:test.:format\",\n-    tests: [\n-      {\n-        input: \"/route.html\",\n-        expected: {\n-          path: \"/route.html\",\n-          params: { test: \"route\", format: \"html\" },\n-        },\n-      },\n-      {\n-        input: \"/route\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/route.html.json\",\n-        expected: {\n-          path: \"/route.html.json\",\n-          params: { test: \"route\", format: \"html.json\" },\n-        },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:test{.:format}?\",\n-    tests: [\n-      {\n-        input: \"/route\",\n-        expected: { path: \"/route\", params: { test: \"route\" } },\n-      },\n-      {\n-        input: \"/route.json\",\n-        expected: {\n-          path: \"/route.json\",\n-          params: { test: \"route\", format: \"json\" },\n-        },\n-      },\n-      {\n-        input: \"/route.json.html\",\n-        expected: {\n-          path: \"/route.json.html\",\n-          params: { test: \"route\", format: \"json.html\" },\n-        },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:test.:format\\\\z\",\n-    tests: [\n-      {\n-        input: \"/route.htmlz\",\n-        expected: {\n-          path: \"/route.htmlz\",\n-          params: { test: \"route\", format: \"html\" },\n-        },\n-      },\n-      {\n-        input: \"/route.html\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * Unnamed params.\n-   */\n-  {\n-    path: \"/(\\\\d+)\",\n-    tests: [\n-      {\n-        input: \"/123\",\n-        expected: { path: \"/123\", params: { \"0\": \"123\" } },\n-      },\n-      {\n-        input: \"/abc\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/123/abc\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"{/(\\\\d+)}?\",\n-    tests: [\n-      {\n-        input: \"/\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/123\",\n-        expected: { path: \"/123\", params: { \"0\": \"123\" } },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/route\\\\(\\\\\\\\(\\\\d+\\\\\\\\)\\\\)\",\n-    tests: [\n-      {\n-        input: \"/route(\\\\123\\\\)\",\n-        expected: {\n-          path: \"/route(\\\\123\\\\)\",\n-          params: { \"0\": \"123\\\\\" },\n-        },\n-      },\n-      {\n-        input: \"/route(\\\\123)\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"{/route}?\",\n-    tests: [\n-      {\n-        input: \"\",\n-        expected: { path: \"\", params: {} },\n-      },\n-      {\n-        input: \"/\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/foo\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/route\",\n-        expected: { path: \"/route\", params: {} },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"{/(.*)}\",\n-    tests: [\n-      {\n-        input: \"/\",\n-        expected: { path: \"/\", params: { \"0\": \"\" } },\n-      },\n-      {\n-        input: \"/login\",\n-        expected: { path: \"/login\", params: { \"0\": \"login\" } },\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * Escaped characters.\n-   */\n-  {\n-    path: \"/\\\\(testing\\\\)\",\n-    tests: [\n-      {\n-        input: \"/testing\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/(testing)\",\n-        expected: { path: \"/(testing)\", params: {} },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/.\\\\+\\\\*\\\\?\\\\{\\\\}=^\\\\!\\\\:$[]\\\\|\",\n-    tests: [\n-      {\n-        input: \"/.+*?{}=^!:$[]|\",\n-        expected: { path: \"/.+*?{}=^!:$[]|\", params: {} },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/test/{:uid(u\\\\d+)}?{:cid(c\\\\d+)}?\",\n-    tests: [\n-      {\n-        input: \"/test/u123\",\n-        expected: { path: \"/test/u123\", params: { uid: \"u123\" } },\n-      },\n-      {\n-        input: \"/test/c123\",\n-        expected: { path: \"/test/c123\", params: { cid: \"c123\" } },\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * Unnamed group prefix.\n-   */\n-  {\n-    path: \"/{apple-}?icon-:res(\\\\d+).png\",\n-    tests: [\n-      {\n-        input: \"/icon-240.png\",\n-        expected: { path: \"/icon-240.png\", params: { res: \"240\" } },\n-      },\n-      {\n-        input: \"/apple-icon-240.png\",\n-        expected: {\n-          path: \"/apple-icon-240.png\",\n-          params: { res: \"240\" },\n-        },\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * Random examples.\n-   */\n-  {\n-    path: \"/:foo/:bar\",\n-    tests: [\n-      {\n-        input: \"/match/route\",\n-        expected: {\n-          path: \"/match/route\",\n-          params: { foo: \"match\", bar: \"route\" },\n-        },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:foo\\\\(test\\\\)/bar\",\n-    tests: [\n-      {\n-        input: \"/foo(test)/bar\",\n-        expected: { path: \"/foo(test)/bar\", params: { foo: \"foo\" } },\n-      },\n-      {\n-        input: \"/foo/bar\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:remote([\\\\w\\\\-\\\\.]+)/:user([\\\\w-]+)\",\n-    tests: [\n-      {\n-        input: \"/endpoint/user\",\n-        expected: {\n-          path: \"/endpoint/user\",\n-          params: { remote: \"endpoint\", user: \"user\" },\n-        },\n-      },\n-      {\n-        input: \"/endpoint/user-name\",\n-        expected: {\n-          path: \"/endpoint/user-name\",\n-          params: { remote: \"endpoint\", user: \"user-name\" },\n-        },\n-      },\n-      {\n-        input: \"/foo.bar/user-name\",\n-        expected: {\n-          path: \"/foo.bar/user-name\",\n-          params: { remote: \"foo.bar\", user: \"user-name\" },\n-        },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:foo\\\\?\",\n-    tests: [\n-      {\n-        input: \"/route?\",\n-        expected: { path: \"/route?\", params: { foo: \"route\" } },\n-      },\n-      {\n-        input: \"/route\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"{/:foo}+bar\",\n-    tests: [\n-      {\n-        input: \"/foobar\",\n-        expected: { path: \"/foobar\", params: { foo: [\"foo\"] } },\n-      },\n-      {\n-        input: \"/foo/bar\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/foo/barbar\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/{:pre}?baz\",\n-    tests: [\n-      {\n-        input: \"/foobaz\",\n-        expected: { path: \"/foobaz\", params: { pre: \"foo\" } },\n-      },\n-      {\n-        input: \"/baz\",\n-        expected: { path: \"/baz\", params: { pre: undefined } },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:foo\\\\(:bar\\\\)\",\n-    tests: [\n-      {\n-        input: \"/hello(world)\",\n-        expected: {\n-          path: \"/hello(world)\",\n-          params: { foo: \"hello\", bar: \"world\" },\n-        },\n-      },\n-      {\n-        input: \"/hello()\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:foo\\\\({:bar}?\\\\)\",\n-    tests: [\n-      {\n-        input: \"/hello(world)\",\n-        expected: {\n-          path: \"/hello(world)\",\n-          params: { foo: \"hello\", bar: \"world\" },\n+          path: \"/hello(world)\",\n+          params: { foo: \"hello\", bar: \"world\" },\n         },\n       },\n       {\n@@ -1377,27 +847,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n     ],\n   },\n   {\n-    path: \"/:postType(video|audio|text){(\\\\+.+)}?\",\n-    tests: [\n-      {\n-        input: \"/video\",\n-        expected: { path: \"/video\", params: { postType: \"video\" } },\n-      },\n-      {\n-        input: \"/video+test\",\n-        expected: {\n-          path: \"/video+test\",\n-          params: { 0: \"+test\", postType: \"video\" },\n-        },\n-      },\n-      {\n-        input: \"/video+\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"{/:foo}?{/:bar}?-ext\",\n+    path: \"{/:foo}{/:bar}-ext\",\n     tests: [\n       {\n         input: \"/-ext\",\n@@ -1428,7 +878,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n     ],\n   },\n   {\n-    path: \"/:required{/:optional}?-ext\",\n+    path: \"/:required{/:optional}-ext\",\n     tests: [\n       {\n         input: \"/foo-ext\",\n@@ -1545,7 +995,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n     ],\n   },\n   {\n-    path: \"mail{.:domain}?.com\",\n+    path: \"mail{.:domain}.com\",\n     options: {\n       delimiter: \".\",\n     },\n@@ -1608,7 +1058,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n    * Prefixes.\n    */\n   {\n-    path: \"{$:foo}{$:bar}?\",\n+    path: \"$:foo{$:bar}\",\n     tests: [\n       {\n         input: \"$x\",\n@@ -1621,20 +1071,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n     ],\n   },\n   {\n-    path: \"{$:foo}+\",\n-    tests: [\n-      {\n-        input: \"$x\",\n-        expected: { path: \"$x\", params: { foo: [\"x\"] } },\n-      },\n-      {\n-        input: \"$x$y\",\n-        expected: { path: \"$x$y\", params: { foo: [\"x\", \"y\"] } },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"name{/:attr1}?{-:attr2}?{-:attr3}?\",\n+    path: \"name{/:attr1}{-:attr2}{-:attr3}\",\n     tests: [\n       {\n         input: \"name\",\n@@ -1678,108 +1115,12 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n     ],\n   },\n-  {\n-    path: \"name{/:attrs;-}*\",\n-    tests: [\n-      {\n-        input: \"name\",\n-        expected: { path: \"name\", params: {} },\n-      },\n-      {\n-        input: \"name/1\",\n-        expected: {\n-          path: \"name/1\",\n-          params: { attrs: [\"1\"] },\n-        },\n-      },\n-      {\n-        input: \"name/1-2\",\n-        expected: {\n-          path: \"name/1-2\",\n-          params: { attrs: [\"1\", \"2\"] },\n-        },\n-      },\n-      {\n-        input: \"name/1-2-3\",\n-        expected: {\n-          path: \"name/1-2-3\",\n-          params: { attrs: [\"1\", \"2\", \"3\"] },\n-        },\n-      },\n-      {\n-        input: \"name/foo-bar/route\",\n-        expected: false,\n-      },\n-      {\n-        input: \"name/test/route\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * Nested parentheses.\n-   */\n-  {\n-    path: \"/:test(\\\\d+(?:\\\\.\\\\d+)?)\",\n-    tests: [\n-      {\n-        input: \"/123\",\n-        expected: { path: \"/123\", params: { test: \"123\" } },\n-      },\n-      {\n-        input: \"/abc\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/123/abc\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/123.123\",\n-        expected: { path: \"/123.123\", params: { test: \"123.123\" } },\n-      },\n-      {\n-        input: \"/123.abc\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:test((?!login)[^/]+)\",\n-    tests: [\n-      {\n-        input: \"/route\",\n-        expected: { path: \"/route\", params: { test: \"route\" } },\n-      },\n-      {\n-        input: \"/login\",\n-        expected: false,\n-      },\n-    ],\n-  },\n \n   /**\n    * https://github.com/pillarjs/path-to-regexp/issues/206\n    */\n   {\n-    path: \"/user{(s)}?/:user\",\n-    tests: [\n-      {\n-        input: \"/user/123\",\n-        expected: { path: \"/user/123\", params: { user: \"123\" } },\n-      },\n-      {\n-        input: \"/users/123\",\n-        expected: {\n-          path: \"/users/123\",\n-          params: { 0: \"s\", user: \"123\" },\n-        },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/user{s}?/:user\",\n+    path: \"/user{s}/:user\",\n     tests: [\n       {\n         input: \"/user/123\",\n@@ -1793,250 +1134,176 @@ export const MATCH_TESTS: MatchTestSet[] = [\n   },\n \n   /**\n-   * https://github.com/pillarjs/path-to-regexp/pull/270\n-   */\n-  {\n-    path: \"/files{/:path}*{.:ext}*\",\n-    tests: [\n-      {\n-        input: \"/files/hello/world.txt\",\n-        expected: {\n-          path: \"/files/hello/world.txt\",\n-          params: { path: [\"hello\", \"world\"], ext: [\"txt\"] },\n-        },\n-      },\n-      {\n-        input: \"/files/hello/world.txt.png\",\n-        expected: {\n-          path: \"/files/hello/world.txt.png\",\n-          params: { path: [\"hello\", \"world\"], ext: [\"txt\", \"png\"] },\n-        },\n-      },\n-      {\n-        input: \"/files/my/photo.jpg/gif\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/files{/:path}*{.:ext}?\",\n-    tests: [\n-      {\n-        input: \"/files/hello/world.txt\",\n-        expected: {\n-          path: \"/files/hello/world.txt\",\n-          params: { path: [\"hello\", \"world\"], ext: \"txt\" },\n-        },\n-      },\n-      {\n-        input: \"/files/my/photo.jpg/gif\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"#/*\",\n-    tests: [\n-      {\n-        input: \"#/\",\n-        expected: { path: \"#/\", params: {} },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/foo{/:bar}*\",\n-    tests: [\n-      {\n-        input: \"/foo/test1/test2\",\n-        expected: {\n-          path: \"/foo/test1/test2\",\n-          params: { bar: [\"test1\", \"test2\"] },\n-        },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/entity/:id/*\",\n-    tests: [\n-      {\n-        input: \"/entity/foo\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/entity/foo/\",\n-        expected: { path: \"/entity/foo/\", params: { id: \"foo\" } },\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/test/*\",\n-    tests: [\n-      {\n-        input: \"/test\",\n-        expected: false,\n-      },\n-      {\n-        input: \"/test/\",\n-        expected: { path: \"/test/\", params: {} },\n-      },\n-      {\n-        input: \"/test/route\",\n-        expected: { path: \"/test/route\", params: { \"0\": [\"route\"] } },\n-      },\n-      {\n-        input: \"/test/route/nested\",\n-        expected: {\n-          path: \"/test/route/nested\",\n-          params: { \"0\": [\"route\", \"nested\"] },\n-        },\n-      },\n-    ],\n-  },\n-\n-  /**\n-   * Asterisk wildcard.\n+   * Wildcard.\n    */\n   {\n-    path: \"/*\",\n+    path: \"/*path\",\n     tests: [\n       {\n         input: \"/\",\n-        expected: { path: \"/\", params: { \"0\": undefined } },\n+        expected: false,\n       },\n       {\n         input: \"/route\",\n-        expected: { path: \"/route\", params: { \"0\": [\"route\"] } },\n+        expected: { path: \"/route\", params: { path: [\"route\"] } },\n       },\n       {\n         input: \"/route/nested\",\n         expected: {\n           path: \"/route/nested\",\n-          params: { \"0\": [\"route\", \"nested\"] },\n+          params: { path: [\"route\", \"nested\"] },\n         },\n       },\n     ],\n   },\n   {\n-    path: \"*\",\n+    path: \"*path\",\n     tests: [\n       {\n         input: \"/\",\n-        expected: { path: \"/\", params: { \"0\": [\"\", \"\"] } },\n+        expected: { path: \"/\", params: { path: [\"\", \"\"] } },\n       },\n       {\n         input: \"/test\",\n-        expected: { path: \"/test\", params: { \"0\": [\"\", \"test\"] } },\n+        expected: { path: \"/test\", params: { path: [\"\", \"test\"] } },\n       },\n     ],\n   },\n   {\n-    path: \"*\",\n+    path: \"*path\",\n     options: { decode: false },\n     tests: [\n       {\n         input: \"/\",\n-        expected: { path: \"/\", params: { \"0\": \"/\" } },\n+        expected: { path: \"/\", params: { path: \"/\" } },\n       },\n       {\n         input: \"/test\",\n-        expected: { path: \"/test\", params: { \"0\": \"/test\" } },\n+        expected: { path: \"/test\", params: { path: \"/test\" } },\n       },\n     ],\n   },\n   {\n-    path: \"/*.:ext\",\n+    path: \"/*path.:ext\",\n     tests: [\n       {\n         input: \"/test.html\",\n         expected: {\n           path: \"/test.html\",\n-          params: { \"0\": [\"test\"], ext: \"html\" },\n+          params: { path: [\"test\"], ext: \"html\" },\n         },\n       },\n       {\n         input: \"/test.html/nested\",\n         expected: false,\n       },\n+      {\n+        input: \"/test.html/nested.json\",\n+        expected: {\n+          path: \"/test.html/nested.json\",\n+          params: { path: [\"test.html\", \"nested\"], ext: \"json\" },\n+        },\n+      },\n     ],\n   },\n   {\n-    path: \"/*{.:ext}?\",\n+    path: \"/:path.*ext\",\n     tests: [\n       {\n         input: \"/test.html\",\n         expected: {\n           path: \"/test.html\",\n-          params: { \"0\": [\"test.html\"], ext: undefined },\n+          params: { path: \"test\", ext: [\"html\"] },\n         },\n       },\n       {\n         input: \"/test.html/nested\",\n         expected: {\n-          params: {\n-            \"0\": [\"test.html\", \"nested\"],\n-          },\n           path: \"/test.html/nested\",\n+          params: { path: \"test\", ext: [\"html\", \"nested\"] },\n+        },\n+      },\n+      {\n+        input: \"/test.html/nested.json\",\n+        expected: {\n+          path: \"/test.html/nested.json\",\n+          params: { path: \"test\", ext: [\"html\", \"nested.json\"] },\n         },\n       },\n     ],\n   },\n   {\n-    path: \"/*{.:ext}*\",\n+    path: \"/*path{.:ext}\",\n     tests: [\n       {\n         input: \"/test.html\",\n         expected: {\n           path: \"/test.html\",\n-          params: { \"0\": [\"test.html\"], ext: undefined },\n+          params: { path: [\"test\"], ext: \"html\" },\n         },\n       },\n       {\n         input: \"/test.html/nested\",\n         expected: {\n           params: {\n-            \"0\": [\"test.html\", \"nested\"],\n+            path: [\"test.html\", \"nested\"],\n           },\n           path: \"/test.html/nested\",\n         },\n       },\n     ],\n   },\n-\n-  /**\n-   * Longer prefix.\n-   */\n   {\n-    path: \"/:foo{/test/:bar}?\",\n+    path: \"/entity/:id/*path\",\n     tests: [\n       {\n-        input: \"/route\",\n-        expected: { path: \"/route\", params: { foo: \"route\" } },\n+        input: \"/entity/foo\",\n+        expected: false,\n       },\n       {\n-        input: \"/route/test/again\",\n+        input: \"/entity/foo/path\",\n         expected: {\n-          path: \"/route/test/again\",\n-          params: { foo: \"route\", bar: \"again\" },\n+          path: \"/entity/foo/path\",\n+          params: { id: \"foo\", path: [\"path\"] },\n+        },\n+      },\n+    ],\n+  },\n+  {\n+    path: \"/*foo/:bar/*baz\",\n+    tests: [\n+      {\n+        input: \"/x/y/z\",\n+        expected: {\n+          path: \"/x/y/z\",\n+          params: { foo: [\"x\"], bar: \"y\", baz: [\"z\"] },\n+        },\n+      },\n+      {\n+        input: \"/1/2/3/4/5\",\n+        expected: {\n+          path: \"/1/2/3/4/5\",\n+          params: { foo: [\"1\", \"2\", \"3\"], bar: \"4\", baz: [\"5\"] },\n         },\n       },\n     ],\n   },\n \n   /**\n-   * Prefix and suffix as separator.\n+   * Longer prefix.\n    */\n   {\n-    path: \"/{<:foo>}+\",\n+    path: \"/:foo{/test/:bar}\",\n     tests: [\n       {\n-        input: \"/<test>\",\n-        expected: { path: \"/<test>\", params: { foo: [\"test\"] } },\n+        input: \"/route\",\n+        expected: { path: \"/route\", params: { foo: \"route\" } },\n       },\n       {\n-        input: \"/<test><again>\",\n+        input: \"/route/test/again\",\n         expected: {\n-          path: \"/<test><again>\",\n-          params: { foo: [\"test\", \"again\"] },\n+          path: \"/route/test/again\",\n+          params: { foo: \"route\", bar: \"again\" },\n         },\n       },\n     ],\n@@ -2046,7 +1313,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n    * Backtracking tests.\n    */\n   {\n-    path: \"{:foo/}?{:bar.}?\",\n+    path: \"{:foo/}{:bar.}\",\n     tests: [\n       {\n         input: \"\",\n@@ -2066,7 +1333,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n     ],\n   },\n   {\n-    path: \"/abc{abc:foo}?\",\n+    path: \"/abc{abc:foo}\",\n     tests: [\n       {\n         input: \"/abc\",\n@@ -2094,19 +1361,28 @@ export const MATCH_TESTS: MatchTestSet[] = [\n     ],\n   },\n   {\n-    path: \"/:foo{abc:bar}?\",\n+    path: \"/:foo{abc:bar}\",\n     tests: [\n       {\n         input: \"/abc\",\n-        expected: false,\n+        expected: {\n+          params: { foo: \"abc\" },\n+          path: \"/abc\",\n+        },\n       },\n       {\n         input: \"/abcabc\",\n-        expected: false,\n+        expected: {\n+          params: { foo: \"abcabc\" },\n+          path: \"/abcabc\",\n+        },\n       },\n       {\n         input: \"/abcabc123\",\n-        expected: false,\n+        expected: {\n+          params: { foo: \"abc\", bar: \"123\" },\n+          path: \"/abcabc123\",\n+        },\n       },\n       {\n         input: \"/acb\",\n@@ -2116,10 +1392,17 @@ export const MATCH_TESTS: MatchTestSet[] = [\n         },\n       },\n       {\n-        input: \"/acbabc123\",\n+        input: \"/123\",\n+        expected: {\n+          path: \"/123\",\n+          params: { foo: \"123\" },\n+        },\n+      },\n+      {\n+        input: \"/123abcabc\",\n         expected: {\n-          path: \"/acbabc123\",\n-          params: { foo: \"acb\", bar: \"123\" },\n+          path: \"/123abcabc\",\n+          params: { foo: \"123abcabc\" },\n         },\n       },\n     ],\n@@ -2137,20 +1420,14 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n       {\n         input: \"/abcabc123\",\n-        expected: false,\n-      },\n-    ],\n-  },\n-  {\n-    path: \"/:foo(.*){.:ext}?\",\n-    tests: [\n-      {\n-        input: \"/abc\",\n-        expected: { path: \"/abc\", params: { foo: \"abc\" } },\n+        expected: {\n+          path: \"/abcabc123\",\n+          params: { foo: \"abc\", bar: \"123\" },\n+        },\n       },\n       {\n-        input: \"/abc.txt\",\n-        expected: { path: \"/abc.txt\", params: { foo: \"abc.txt\" } },\n+        input: \"/123abcabc\",\n+        expected: false,\n       },\n     ],\n   },\n@@ -2186,6 +1463,22 @@ export const MATCH_TESTS: MatchTestSet[] = [\n       },\n     ],\n   },\n+  {\n+    path: \"/:foo{|:bar|}\",\n+    tests: [\n+      {\n+        input: \"/hello|world|\",\n+        expected: {\n+          path: \"/hello|world|\",\n+          params: { foo: \"hello\", bar: \"world\" },\n+        },\n+      },\n+      {\n+        input: \"/hello||\",\n+        expected: { path: \"/hello||\", params: { foo: \"hello||\" } },\n+      },\n+    ],\n+  },\n   {\n     path: \":foo\\\\@:bar\",\n     tests: [\n@@ -2204,7 +1497,7 @@ export const MATCH_TESTS: MatchTestSet[] = [\n    * Multi character delimiters.\n    */\n   {\n-    path: \"%25:foo{%25:bar}?\",\n+    path: \"%25:foo{%25:bar}\",\n     options: {\n       delimiter: \"%25\",\n     },"
            },
            {
                "sha": "9d392197eab1ef06ace43e5682ee3d0b16f9ed1f",
                "filename": "src/index.bench.ts",
                "status": "added",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/src%2Findex.bench.ts",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/60f2121e9b66b7b622cc01080df0aabda9eedee6/src%2Findex.bench.ts",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/src%2Findex.bench.ts?ref=60f2121e9b66b7b622cc01080df0aabda9eedee6",
                "patch": "@@ -0,0 +1,42 @@\n+import { bench } from \"vitest\";\n+import { match } from \"./index.js\";\n+\n+const PATHS: string[] = [\n+  \"/xyz\",\n+  \"/user\",\n+  \"/user/123\",\n+  \"/\" + \"a\".repeat(32_000),\n+  \"/-\" + \"-a\".repeat(8_000) + \"/-\",\n+  \"/||||\\x00|\" + \"||\".repeat(27387) + \"|\\x00\".repeat(27387) + \"/||/\",\n+];\n+\n+const STATIC_PATH_MATCH = match(\"/user\");\n+const SIMPLE_PATH_MATCH = match(\"/user/:id\");\n+const MULTI_SEGMENT_MATCH = match(\"/:x/:y\");\n+const MULTI_PATTERN_MATCH = match(\"/:x-:y\");\n+const TRICKY_PATTERN_MATCH = match(\"/:foo|:bar|\");\n+const ASTERISK_MATCH = match(\"/*foo\");\n+\n+bench(\"static path\", () => {\n+  for (const path of PATHS) STATIC_PATH_MATCH(path);\n+});\n+\n+bench(\"simple path\", () => {\n+  for (const path of PATHS) SIMPLE_PATH_MATCH(path);\n+});\n+\n+bench(\"multi segment\", () => {\n+  for (const path of PATHS) MULTI_SEGMENT_MATCH(path);\n+});\n+\n+bench(\"multi pattern\", () => {\n+  for (const path of PATHS) MULTI_PATTERN_MATCH(path);\n+});\n+\n+bench(\"tricky pattern\", () => {\n+  for (const path of PATHS) TRICKY_PATTERN_MATCH(path);\n+});\n+\n+bench(\"asterisk\", () => {\n+  for (const path of PATHS) ASTERISK_MATCH(path);\n+});"
            },
            {
                "sha": "c6da6313887c20652ec41888410af39f36511ab3",
                "filename": "src/index.spec.ts",
                "status": "modified",
                "additions": 50,
                "deletions": 124,
                "changes": 174,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/src%2Findex.spec.ts",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/60f2121e9b66b7b622cc01080df0aabda9eedee6/src%2Findex.spec.ts",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/src%2Findex.spec.ts?ref=60f2121e9b66b7b622cc01080df0aabda9eedee6",
                "patch": "@@ -6,89 +6,86 @@ import { PARSER_TESTS, COMPILE_TESTS, MATCH_TESTS } from \"./cases.spec.js\";\n  * Dynamically generate the entire test suite.\n  */\n describe(\"path-to-regexp\", () => {\n-  describe(\"arguments\", () => {\n-    it(\"should throw on non-capturing pattern\", () => {\n-      expect(() => match(\"/:foo(?:\\\\d+(\\\\.\\\\d+)?)\")).toThrow(\n+  describe(\"parse errors\", () => {\n+    it(\"should throw on unbalanced group\", () => {\n+      expect(() => parse(\"/{:foo,\")).toThrow(\n         new TypeError(\n-          'Pattern cannot start with \"?\" at 6: https://git.new/pathToRegexpError',\n+          \"Unexpected END at 7, expected }: https://git.new/pathToRegexpError\",\n         ),\n       );\n     });\n-\n-    it(\"should throw on nested capturing group\", () => {\n-      expect(() => match(\"/:foo(\\\\d+(\\\\.\\\\d+)?)\")).toThrow(\n+    it(\"should throw on nested unbalanced group\", () => {\n+      expect(() => parse(\"/{:foo/{x,y}\")).toThrow(\n         new TypeError(\n-          \"Capturing groups are not allowed at 9: https://git.new/pathToRegexpError\",\n+          \"Unexpected END at 12, expected }: https://git.new/pathToRegexpError\",\n         ),\n       );\n     });\n \n-    it(\"should throw on unbalanced pattern\", () => {\n-      expect(() => match(\"/:foo(abc\")).toThrow(\n+    it(\"should throw on missing param name\", () => {\n+      expect(() => parse(\"/:/\")).toThrow(\n         new TypeError(\n-          \"Unbalanced pattern at 5: https://git.new/pathToRegexpError\",\n+          \"Missing parameter name at 2: https://git.new/pathToRegexpError\",\n         ),\n       );\n     });\n \n-    it(\"should throw on unmatched )\", function () {\n-      expect(() => match(\"/:fooab)c\")).toThrow(\n-        new TypeError(\"Unmatched ) at 7: https://git.new/pathToRegexpError\"),\n-      );\n-    });\n-\n-    it(\"should throw on unmatched ) after other patterns\", function () {\n-      expect(() => match(\"/:test(\\\\w+)/:foo(\\\\d+))\")).toThrow(\n-        new TypeError(\"Unmatched ) at 21: https://git.new/pathToRegexpError\"),\n-      );\n-    });\n-\n-    it(\"should throw on missing pattern\", () => {\n-      expect(() => match(\"/:foo()\")).toThrow(\n+    it(\"should throw on missing wildcard name\", () => {\n+      expect(() => parse(\"/*/\")).toThrow(\n         new TypeError(\n-          \"Missing pattern at 5: https://git.new/pathToRegexpError\",\n+          \"Missing parameter name at 2: https://git.new/pathToRegexpError\",\n         ),\n       );\n     });\n \n-    it(\"should throw on missing name\", () => {\n-      expect(() => match(\"/:(test)\")).toThrow(\n+    it(\"should throw on unterminated quote\", () => {\n+      expect(() => parse('/:\"foo')).toThrow(\n         new TypeError(\n-          \"Missing parameter name at 2: https://git.new/pathToRegexpError\",\n+          \"Unterminated quote at 2: https://git.new/pathToRegexpError\",\n         ),\n       );\n     });\n+  });\n \n-    it(\"should throw on nested groups\", () => {\n-      expect(() => match(\"/{a{b:foo}}\")).toThrow(\n-        new TypeError(\n-          \"Unexpected { at 3, expected }: https://git.new/pathToRegexpError\",\n-        ),\n-      );\n+  describe(\"compile errors\", () => {\n+    it(\"should throw when a param is missing\", () => {\n+      const toPath = compile(\"/a/:b/c\");\n+\n+      expect(() => {\n+        toPath();\n+      }).toThrow(new TypeError(\"Missing parameters: b\"));\n     });\n \n-    it(\"should throw on repeat parameters without a separator\", () => {\n-      expect(() => match(\"{:x}*\")).toThrow(\n-        new TypeError(\n-          `Missing separator for \"x\": https://git.new/pathToRegexpError`,\n-        ),\n-      );\n+    it(\"should throw when expecting a repeated value\", () => {\n+      const toPath = compile(\"/*foo\");\n+\n+      expect(() => {\n+        toPath({ foo: [] });\n+      }).toThrow(new TypeError('Expected \"foo\" to be a non-empty array'));\n     });\n \n-    it(\"should throw on unterminated quote\", () => {\n-      expect(() => match('/:\"foo')).toThrow(\n-        new TypeError(\n-          \"Unterminated quote at 2: https://git.new/pathToRegexpError\",\n-        ),\n-      );\n+    it(\"should throw when param gets an array\", () => {\n+      const toPath = compile(\"/:foo\");\n+\n+      expect(() => {\n+        toPath({ foo: [] });\n+      }).toThrow(new TypeError('Expected \"foo\" to be a string'));\n     });\n \n-    it(\"should throw on invalid *\", () => {\n-      expect(() => match(\"/:foo*\")).toThrow(\n-        new TypeError(\n-          \"Unexpected * at 5, you probably want `/*` or `{/:foo}*`: https://git.new/pathToRegexpError\",\n-        ),\n-      );\n+    it(\"should throw when a wildcard is not an array\", () => {\n+      const toPath = compile(\"/*foo\");\n+\n+      expect(() => {\n+        toPath({ foo: \"a\" });\n+      }).toThrow(new TypeError('Expected \"foo\" to be a non-empty array'));\n+    });\n+\n+    it(\"should throw when a wildcard array value is not a string\", () => {\n+      const toPath = compile(\"/*foo\");\n+\n+      expect(() => {\n+        toPath({ foo: [1, \"a\"] as any });\n+      }).toThrow(new TypeError('Expected \"foo/0\" to be a string'));\n     });\n   });\n \n@@ -126,75 +123,4 @@ describe(\"path-to-regexp\", () => {\n       });\n     },\n   );\n-\n-  describe(\"compile errors\", () => {\n-    it(\"should throw when a required param is undefined\", () => {\n-      const toPath = compile(\"/a/:b/c\");\n-\n-      expect(() => {\n-        toPath();\n-      }).toThrow(new TypeError('Expected \"b\" to be a string'));\n-    });\n-\n-    it(\"should throw when it does not match the pattern\", () => {\n-      const toPath = compile(\"/:foo(\\\\d+)\");\n-\n-      expect(() => {\n-        toPath({ foo: \"abc\" });\n-      }).toThrow(new TypeError('Invalid value for \"foo\": \"abc\"'));\n-    });\n-\n-    it(\"should throw when expecting a repeated value\", () => {\n-      const toPath = compile(\"{/:foo}+\");\n-\n-      expect(() => {\n-        toPath({ foo: [] });\n-      }).toThrow(new TypeError('Invalid value for \"foo\": \"\"'));\n-    });\n-\n-    it(\"should throw when not expecting a repeated value\", () => {\n-      const toPath = compile(\"/:foo\");\n-\n-      expect(() => {\n-        toPath({ foo: [] });\n-      }).toThrow(new TypeError('Expected \"foo\" to be a string'));\n-    });\n-\n-    it(\"should throw when a repeated param is not an array\", () => {\n-      const toPath = compile(\"{/:foo}+\");\n-\n-      expect(() => {\n-        toPath({ foo: \"a\" });\n-      }).toThrow(new TypeError('Expected \"foo\" to be an array'));\n-    });\n-\n-    it(\"should throw when an array value is not a string\", () => {\n-      const toPath = compile(\"{/:foo}+\");\n-\n-      expect(() => {\n-        toPath({ foo: [1, \"a\"] as any });\n-      }).toThrow(new TypeError('Expected \"foo/0\" to be a string'));\n-    });\n-\n-    it(\"should throw when repeated value does not match\", () => {\n-      const toPath = compile(\"{/:foo(\\\\d+)}+\");\n-\n-      expect(() => {\n-        toPath({ foo: [\"1\", \"2\", \"3\", \"a\"] });\n-      }).toThrow(new TypeError('Invalid value for \"foo\": \"/1/2/3/a\"'));\n-    });\n-  });\n });\n-\n-/**\n- * Execute a regular expression and return a flat array for comparison.\n- *\n- * @param  {RegExp} re\n- * @param  {String} str\n- * @return {Array}\n- */\n-function exec(re: RegExp, str: string) {\n-  const match = re.exec(str);\n-\n-  return match && Array.prototype.slice.call(match);\n-}"
            },
            {
                "sha": "a63e3650485777485c84ababd67fc2e5402187a1",
                "filename": "src/index.ts",
                "status": "modified",
                "additions": 346,
                "deletions": 417,
                "changes": 763,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/src%2Findex.ts",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/60f2121e9b66b7b622cc01080df0aabda9eedee6/src%2Findex.ts",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/src%2Findex.ts?ref=60f2121e9b66b7b622cc01080df0aabda9eedee6",
                "patch": "@@ -15,24 +15,13 @@ export type Encode = (value: string) => string;\n export type Decode = (value: string) => string;\n \n export interface ParseOptions {\n-  /**\n-   * The default delimiter for segments. (default: `'/'`)\n-   */\n-  delimiter?: string;\n   /**\n    * A function for encoding input strings.\n    */\n   encodePath?: Encode;\n }\n \n-export interface PathOptions {\n-  /**\n-   * Regexp will be case sensitive. (default: `false`)\n-   */\n-  sensitive?: boolean;\n-}\n-\n-export interface MatchOptions extends PathOptions {\n+export interface MatchOptions {\n   /**\n    * Function for decoding strings for params, or `false` to disable entirely. (default: `decodeURIComponent`)\n    */\n@@ -41,35 +30,47 @@ export interface MatchOptions extends PathOptions {\n    * Matches the path completely without trailing characters. (default: `true`)\n    */\n   end?: boolean;\n-}\n-\n-export interface CompileOptions extends PathOptions {\n   /**\n-   * Verifies the function is producing a valid path. (default: `true`)\n+   * Allows optional trailing delimiter to match. (default: `true`)\n+   */\n+  trailing?: boolean;\n+  /**\n+   * Match will be case sensitive. (default: `false`)\n+   */\n+  sensitive?: boolean;\n+  /**\n+   * The default delimiter for segments. (default: `'/'`)\n    */\n-  validate?: boolean;\n+  delimiter?: string;\n+}\n+\n+export interface CompileOptions {\n   /**\n    * Function for encoding input strings for output into the path, or `false` to disable entirely. (default: `encodeURIComponent`)\n    */\n   encode?: Encode | false;\n+  /**\n+   * The default delimiter for segments. (default: `'/'`)\n+   */\n+  delimiter?: string;\n }\n \n type TokenType =\n   | \"{\"\n   | \"}\"\n-  | \";\"\n-  | \"*\"\n-  | \"+\"\n-  | \"?\"\n-  | \"NAME\"\n-  | \"PATTERN\"\n+  | \"WILDCARD\"\n+  | \"PARAM\"\n   | \"CHAR\"\n   | \"ESCAPED\"\n   | \"END\"\n-  // Reserved for use.\n-  | \"!\"\n-  | \"@\"\n-  | \",\";\n+  // Reserved for use or ambiguous due to past use.\n+  | \"(\"\n+  | \")\"\n+  | \"[\"\n+  | \"]\"\n+  | \"+\"\n+  | \"?\"\n+  | \"!\";\n \n /**\n  * Tokenizer results.\n@@ -81,153 +82,120 @@ interface LexToken {\n }\n \n const SIMPLE_TOKENS: Record<string, TokenType> = {\n-  \"!\": \"!\",\n-  \"@\": \"@\",\n-  \";\": \";\",\n-  \",\": \",\",\n-  \"*\": \"*\",\n-  \"+\": \"+\",\n-  \"?\": \"?\",\n+  // Groups.\n   \"{\": \"{\",\n   \"}\": \"}\",\n+  // Reserved.\n+  \"(\": \"(\",\n+  \")\": \")\",\n+  \"[\": \"[\",\n+  \"]\": \"]\",\n+  \"+\": \"+\",\n+  \"?\": \"?\",\n+  \"!\": \"!\",\n };\n \n+/**\n+ * Escape a regular expression string.\n+ */\n+function escape(str: string) {\n+  return str.replace(/[.+*?^${}()[\\]|/\\\\]/g, \"\\\\$&\");\n+}\n+\n+/**\n+ * Get the flags for a regexp from the options.\n+ */\n+function toFlags(options: { sensitive?: boolean }) {\n+  return options.sensitive ? \"s\" : \"is\";\n+}\n+\n /**\n  * Tokenize input string.\n  */\n-function lexer(str: string) {\n+function* lexer(str: string): Generator<LexToken, LexToken> {\n   const chars = [...str];\n-  const tokens: LexToken[] = [];\n   let i = 0;\n \n-  while (i < chars.length) {\n-    const value = chars[i];\n-    const type = SIMPLE_TOKENS[value];\n-\n-    if (type) {\n-      tokens.push({ type, index: i++, value });\n-      continue;\n-    }\n+  function name() {\n+    let value = \"\";\n \n-    if (value === \"\\\\\") {\n-      tokens.push({ type: \"ESCAPED\", index: i++, value: chars[i++] });\n-      continue;\n-    }\n-\n-    if (value === \":\") {\n-      let name = \"\";\n-\n-      if (ID_START.test(chars[++i])) {\n-        name += chars[i];\n-        while (ID_CONTINUE.test(chars[++i])) {\n-          name += chars[i];\n-        }\n-      } else if (chars[i] === '\"') {\n-        let pos = i;\n-\n-        while (i < chars.length) {\n-          if (chars[++i] === '\"') {\n-            i++;\n-            pos = 0;\n-            break;\n-          }\n-\n-          if (chars[i] === \"\\\\\") {\n-            name += chars[++i];\n-          } else {\n-            name += chars[i];\n-          }\n-        }\n-\n-        if (pos) {\n-          throw new TypeError(`Unterminated quote at ${pos}: ${DEBUG_URL}`);\n-        }\n-      }\n-\n-      if (!name) {\n-        throw new TypeError(`Missing parameter name at ${i}: ${DEBUG_URL}`);\n-      }\n-\n-      tokens.push({ type: \"NAME\", index: i, value: name });\n-      continue;\n-    }\n-\n-    if (value === \"(\") {\n-      const pos = i++;\n-      let count = 1;\n-      let pattern = \"\";\n-\n-      if (chars[i] === \"?\") {\n-        throw new TypeError(\n-          `Pattern cannot start with \"?\" at ${i}: ${DEBUG_URL}`,\n-        );\n+    if (ID_START.test(chars[++i])) {\n+      value += chars[i];\n+      while (ID_CONTINUE.test(chars[++i])) {\n+        value += chars[i];\n       }\n+    } else if (chars[i] === '\"') {\n+      let pos = i;\n \n       while (i < chars.length) {\n-        if (chars[i] === \"\\\\\") {\n-          pattern += chars[i++] + chars[i++];\n-          continue;\n+        if (chars[++i] === '\"') {\n+          i++;\n+          pos = 0;\n+          break;\n         }\n \n-        if (chars[i] === \")\") {\n-          count--;\n-          if (count === 0) {\n-            i++;\n-            break;\n-          }\n-        } else if (chars[i] === \"(\") {\n-          count++;\n-          if (chars[i + 1] !== \"?\") {\n-            throw new TypeError(\n-              `Capturing groups are not allowed at ${i}: ${DEBUG_URL}`,\n-            );\n-          }\n+        if (chars[i] === \"\\\\\") {\n+          value += chars[++i];\n+        } else {\n+          value += chars[i];\n         }\n-\n-        pattern += chars[i++];\n       }\n \n-      if (count) {\n-        throw new TypeError(`Unbalanced pattern at ${pos}: ${DEBUG_URL}`);\n+      if (pos) {\n+        throw new TypeError(`Unterminated quote at ${pos}: ${DEBUG_URL}`);\n       }\n-\n-      if (!pattern) {\n-        throw new TypeError(`Missing pattern at ${pos}: ${DEBUG_URL}`);\n-      }\n-\n-      tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n-      continue;\n     }\n \n-    if (value === \")\") {\n-      throw new TypeError(`Unmatched ) at ${i}: ${DEBUG_URL}`);\n+    if (!value) {\n+      throw new TypeError(`Missing parameter name at ${i}: ${DEBUG_URL}`);\n     }\n \n-    tokens.push({ type: \"CHAR\", index: i, value: chars[i++] });\n+    return value;\n   }\n \n-  tokens.push({ type: \"END\", index: i, value: \"\" });\n+  while (i < chars.length) {\n+    const value = chars[i];\n+    const type = SIMPLE_TOKENS[value];\n \n-  return new Iter(tokens);\n+    if (type) {\n+      yield { type, index: i++, value };\n+    } else if (value === \"\\\\\") {\n+      yield { type: \"ESCAPED\", index: i++, value: chars[i++] };\n+    } else if (value === \":\") {\n+      const value = name();\n+      yield { type: \"PARAM\", index: i, value };\n+    } else if (value === \"*\") {\n+      const value = name();\n+      yield { type: \"WILDCARD\", index: i, value };\n+    } else {\n+      yield { type: \"CHAR\", index: i, value: chars[i++] };\n+    }\n+  }\n+\n+  return { type: \"END\", index: i, value: \"\" };\n }\n \n class Iter {\n-  index = 0;\n+  #peek?: LexToken;\n \n-  constructor(private tokens: LexToken[]) {}\n+  constructor(private tokens: Generator<LexToken, LexToken>) {}\n \n   peek(): LexToken {\n-    return this.tokens[this.index];\n+    if (!this.#peek) {\n+      const next = this.tokens.next();\n+      this.#peek = next.value;\n+    }\n+    return this.#peek;\n   }\n \n-  tryConsume(type: LexToken[\"type\"]): string | undefined {\n+  tryConsume(type: TokenType): string | undefined {\n     const token = this.peek();\n     if (token.type !== type) return;\n-    this.index++;\n+    this.#peek = undefined; // Reset after consumed.\n     return token.value;\n   }\n \n-  consume(type: LexToken[\"type\"]): string {\n+  consume(type: TokenType): string {\n     const value = this.tryConsume(type);\n     if (value !== undefined) return value;\n     const { type: nextType, index } = this.peek();\n@@ -244,223 +212,216 @@ class Iter {\n     }\n     return result;\n   }\n+}\n \n-  modifier(): string | undefined {\n-    return this.tryConsume(\"?\") || this.tryConsume(\"*\") || this.tryConsume(\"+\");\n-  }\n+/**\n+ * Plain text.\n+ */\n+export interface Text {\n+  type: \"text\";\n+  value: string;\n }\n \n /**\n- * Tokenized path instance. Can we passed around instead of string.\n+ * A parameter designed to match arbitrary text within a segment.\n+ */\n+export interface Parameter {\n+  type: \"param\";\n+  name: string;\n+}\n+\n+/**\n+ * A wildcard parameter designed to match multiple segments.\n+ */\n+export interface Wildcard {\n+  type: \"wildcard\";\n+  name: string;\n+}\n+\n+/**\n+ * A set of possible tokens to expand when matching.\n+ */\n+export interface Group {\n+  type: \"group\";\n+  tokens: Token[];\n+}\n+\n+/**\n+ * A sequence of path match characters.\n+ */\n+export type Token = Text | Parameter | Wildcard | Group;\n+\n+/**\n+ * Tokenized path instance.\n  */\n export class TokenData {\n-  constructor(\n-    public readonly tokens: Token[],\n-    public readonly delimiter: string,\n-  ) {}\n+  constructor(public readonly tokens: Token[]) {}\n }\n \n /**\n  * Parse a string for the raw tokens.\n  */\n export function parse(str: string, options: ParseOptions = {}): TokenData {\n-  const { encodePath = NOOP_VALUE, delimiter = encodePath(DEFAULT_DELIMITER) } =\n-    options;\n-  const tokens: Token[] = [];\n-  const it = lexer(str);\n-  let key = 0;\n-\n-  do {\n-    const path = it.text();\n-    if (path) tokens.push(encodePath(path));\n-\n-    const name = it.tryConsume(\"NAME\");\n-    const pattern = it.tryConsume(\"PATTERN\");\n-\n-    if (name || pattern) {\n-      tokens.push({\n-        name: name || String(key++),\n-        pattern,\n-      });\n-\n-      const next = it.peek();\n-      if (next.type === \"*\") {\n-        throw new TypeError(\n-          `Unexpected * at ${next.index}, you probably want \\`/*\\` or \\`{/:foo}*\\`: ${DEBUG_URL}`,\n-        );\n+  const { encodePath = NOOP_VALUE } = options;\n+  const it = new Iter(lexer(str));\n+\n+  function consume(endType: TokenType): Token[] {\n+    const tokens: Token[] = [];\n+\n+    while (true) {\n+      const path = it.text();\n+      if (path) tokens.push({ type: \"text\", value: encodePath(path) });\n+\n+      const param = it.tryConsume(\"PARAM\");\n+      if (param) {\n+        tokens.push({\n+          type: \"param\",\n+          name: param,\n+        });\n+        continue;\n       }\n \n-      continue;\n-    }\n+      const wildcard = it.tryConsume(\"WILDCARD\");\n+      if (wildcard) {\n+        tokens.push({\n+          type: \"wildcard\",\n+          name: wildcard,\n+        });\n+        continue;\n+      }\n \n-    const asterisk = it.tryConsume(\"*\");\n-    if (asterisk) {\n-      tokens.push({\n-        name: String(key++),\n-        pattern: `${negate(delimiter)}*`,\n-        modifier: \"*\",\n-        separator: delimiter,\n-      });\n-      continue;\n-    }\n+      const open = it.tryConsume(\"{\");\n+      if (open) {\n+        tokens.push({\n+          type: \"group\",\n+          tokens: consume(\"}\"),\n+        });\n+        continue;\n+      }\n \n-    const open = it.tryConsume(\"{\");\n-    if (open) {\n-      const prefix = it.text();\n-      const name = it.tryConsume(\"NAME\");\n-      const pattern = it.tryConsume(\"PATTERN\");\n-      const suffix = it.text();\n-      const separator = it.tryConsume(\";\") && it.text();\n-\n-      it.consume(\"}\");\n-\n-      const modifier = it.modifier();\n-\n-      tokens.push({\n-        name: name || (pattern ? String(key++) : \"\"),\n-        prefix: encodePath(prefix),\n-        suffix: encodePath(suffix),\n-        pattern,\n-        modifier,\n-        separator,\n-      });\n-      continue;\n+      it.consume(endType);\n+      return tokens;\n     }\n+  }\n \n-    it.consume(\"END\");\n-    break;\n-  } while (true);\n+  const tokens = consume(\"END\");\n+  return new TokenData(tokens);\n+}\n+\n+/**\n+ * Transform tokens into a path building function.\n+ */\n+function $compile<P extends ParamData>(\n+  data: TokenData,\n+  options: CompileOptions,\n+): PathFunction<P> {\n+  const { encode = encodeURIComponent, delimiter = DEFAULT_DELIMITER } =\n+    options;\n+  const fn = tokensToFunction(data.tokens, delimiter, encode);\n \n-  return new TokenData(tokens, delimiter);\n+  return function path(data: P = {} as P) {\n+    const [path, ...missing] = fn(data);\n+    if (missing.length) {\n+      throw new TypeError(`Missing parameters: ${missing.join(\", \")}`);\n+    }\n+    return path;\n+  };\n }\n \n /**\n  * Compile a string to a template function for the path.\n  */\n export function compile<P extends ParamData = ParamData>(\n-  path: string,\n+  path: Path,\n   options: CompileOptions & ParseOptions = {},\n ) {\n-  return $compile<P>(parse(path, options), options);\n+  return $compile<P>(\n+    path instanceof TokenData ? path : parse(path, options),\n+    options,\n+  );\n }\n \n export type ParamData = Partial<Record<string, string | string[]>>;\n export type PathFunction<P extends ParamData> = (data?: P) => string;\n \n-/**\n- * Check if a key repeats.\n- */\n-export function isRepeat(key: Key) {\n-  return key.modifier === \"+\" || key.modifier === \"*\";\n-}\n+function tokensToFunction(\n+  tokens: Token[],\n+  delimiter: string,\n+  encode: Encode | false,\n+) {\n+  const encoders = tokens.map((token) =>\n+    tokenToFunction(token, delimiter, encode),\n+  );\n \n-/**\n- * Check if a key is optional.\n- */\n-export function isOptional(key: Key) {\n-  return key.modifier === \"?\" || key.modifier === \"*\";\n+  return (data: ParamData) => {\n+    const result: string[] = [\"\"];\n+\n+    for (const encoder of encoders) {\n+      const [value, ...extras] = encoder(data);\n+      result[0] += value;\n+      result.push(...extras);\n+    }\n+\n+    return result;\n+  };\n }\n \n /**\n  * Convert a single token into a path building function.\n  */\n-function keyToFunction(\n-  key: Key,\n+function tokenToFunction(\n+  token: Token,\n+  delimiter: string,\n   encode: Encode | false,\n-): (data: ParamData) => string {\n-  const encodeValue = encode || NOOP_VALUE;\n-  const { prefix = \"\", suffix = \"\", separator = suffix + prefix } = key;\n-\n-  if (encode && isRepeat(key)) {\n-    const stringify = (value: string, index: number) => {\n-      if (typeof value !== \"string\") {\n-        throw new TypeError(`Expected \"${key.name}/${index}\" to be a string`);\n-      }\n-      return encodeValue(value);\n-    };\n-\n-    const compile = (value: unknown) => {\n-      if (!Array.isArray(value)) {\n-        throw new TypeError(`Expected \"${key.name}\" to be an array`);\n-      }\n+): (data: ParamData) => string[] {\n+  if (token.type === \"text\") return () => [token.value];\n \n-      if (value.length === 0) return \"\";\n+  if (token.type === \"group\") {\n+    const fn = tokensToFunction(token.tokens, delimiter, encode);\n \n-      return prefix + value.map(stringify).join(separator) + suffix;\n+    return (data) => {\n+      const [value, ...missing] = fn(data);\n+      if (!missing.length) return [value];\n+      return [\"\"];\n     };\n+  }\n \n-    if (isOptional(key)) {\n-      return (data): string => {\n-        const value = data[key.name];\n-        if (value == null) return \"\";\n-        return value.length ? compile(value) : \"\";\n-      };\n-    }\n+  const encodeValue = encode || NOOP_VALUE;\n \n-    return (data): string => {\n-      const value = data[key.name];\n-      return compile(value);\n-    };\n-  }\n+  if (token.type === \"wildcard\" && encode !== false) {\n+    return (data) => {\n+      const value = data[token.name];\n+      if (value == null) return [\"\", token.name];\n \n-  const stringify = (value: unknown) => {\n-    if (typeof value !== \"string\") {\n-      throw new TypeError(`Expected \"${key.name}\" to be a string`);\n-    }\n-    return prefix + encodeValue(value) + suffix;\n-  };\n+      if (!Array.isArray(value) || value.length === 0) {\n+        throw new TypeError(`Expected \"${token.name}\" to be a non-empty array`);\n+      }\n \n-  if (isOptional(key)) {\n-    return (data): string => {\n-      const value = data[key.name];\n-      if (value == null) return \"\";\n-      return stringify(value);\n+      return [\n+        value\n+          .map((value, index) => {\n+            if (typeof value !== \"string\") {\n+              throw new TypeError(\n+                `Expected \"${token.name}/${index}\" to be a string`,\n+              );\n+            }\n+\n+            return encodeValue(value);\n+          })\n+          .join(delimiter),\n+      ];\n     };\n   }\n \n-  return (data): string => {\n-    const value = data[key.name];\n-    return stringify(value);\n-  };\n-}\n+  return (data) => {\n+    const value = data[token.name];\n+    if (value == null) return [\"\", token.name];\n \n-/**\n- * Transform tokens into a path building function.\n- */\n-export function $compile<P extends ParamData>(\n-  data: TokenData,\n-  options: CompileOptions,\n-): PathFunction<P> {\n-  const { encode = encodeURIComponent, validate = true } = options;\n-  const flags = toFlags(options);\n-  const sources = toRegExpSource(data, []);\n-\n-  // Compile all the tokens into regexps.\n-  const encoders: Array<(data: ParamData) => string> = data.tokens.map(\n-    (token, index) => {\n-      if (typeof token === \"string\") return () => token;\n-\n-      const fn = keyToFunction(token, encode);\n-      if (!validate) return fn;\n-\n-      const validRe = new RegExp(`^${sources[index]}$`, flags);\n-\n-      return (data) => {\n-        const value = fn(data);\n-        if (!validRe.test(value)) {\n-          throw new TypeError(\n-            `Invalid value for \"${token.name}\": ${JSON.stringify(value)}`,\n-          );\n-        }\n-        return value;\n-      };\n-    },\n-  );\n+    if (typeof value !== \"string\") {\n+      throw new TypeError(`Expected \"${token.name}\" to be a string`);\n+    }\n \n-  return function path(data: Record<string, any> = {}) {\n-    let path = \"\";\n-    for (const encoder of encoders) path += encoder(data);\n-    return path;\n+    return [encodeValue(value)];\n   };\n }\n \n@@ -485,42 +446,45 @@ export type MatchFunction<P extends ParamData> = (path: string) => Match<P>;\n /**\n  * Create path match function from `path-to-regexp` spec.\n  */\n-export function $match<P extends ParamData>(\n-  data: TokenData,\n+function $match<P extends ParamData>(\n+  data: TokenData[],\n   options: MatchOptions = {},\n ): MatchFunction<P> {\n-  const { decode = decodeURIComponent, end = true } = options;\n-  const { delimiter } = data;\n-  const keys: Key[] = [];\n+  const {\n+    decode = decodeURIComponent,\n+    delimiter = DEFAULT_DELIMITER,\n+    end = true,\n+    trailing = true,\n+  } = options;\n   const flags = toFlags(options);\n-  const sources = toRegExpSource(data, keys);\n-  const re = new RegExp(\n-    `^${sources.join(\"\")}(?=${escape(delimiter)}|$)`,\n-    flags,\n-  );\n-\n-  const decoders = keys.map((key) => {\n-    if (!decode) return NOOP_VALUE;\n+  const sources: string[] = [];\n+  const keys: Array<Parameter | Wildcard> = [];\n \n-    if (isRepeat(key)) {\n-      const { prefix = \"\", suffix = \"\", separator = suffix + prefix } = key;\n-      return (value: string) => value.split(separator).map(decode);\n+  for (const { tokens } of data) {\n+    for (const seq of flatten(tokens, 0, [])) {\n+      const regexp = sequenceToRegExp(seq, delimiter, keys);\n+      sources.push(regexp);\n     }\n+  }\n \n-    return decode;\n-  });\n+  let pattern = `^(?:${sources.join(\"|\")})`;\n+  if (trailing) pattern += `(?:${escape(delimiter)}$)?`;\n+  pattern += end ? \"$\" : `(?=${escape(delimiter)}|$)`;\n \n-  const isValid = end\n-    ? (a: string, b: string) => a.length === b.length\n-    : () => true;\n+  const re = new RegExp(pattern, flags);\n+\n+  const decoders = keys.map((key) => {\n+    if (decode === false) return NOOP_VALUE;\n+    if (key.type === \"param\") return decode;\n+    return (value: string) => value.split(delimiter).map(decode);\n+  });\n \n   return Object.assign(\n     function match(input: string) {\n       const m = re.exec(input);\n       if (!m) return false;\n \n       const { 0: path } = m;\n-      if (!isValid(input, path)) return false;\n       const params = Object.create(null);\n \n       for (let i = 1; i < m.length; i++) {\n@@ -537,132 +501,97 @@ export function $match<P extends ParamData>(\n   );\n }\n \n+export type Path = string | TokenData;\n+\n export function match<P extends ParamData>(\n-  path: string,\n+  path: Path | Path[],\n   options: MatchOptions & ParseOptions = {},\n ): MatchFunction<P> {\n-  return $match(parse(path, options), options);\n-}\n+  const paths = Array.isArray(path) ? path : [path];\n+  const items = paths.map((path) =>\n+    path instanceof TokenData ? path : parse(path, options),\n+  );\n \n-/**\n- * Escape a regular expression string.\n- */\n-function escape(str: string) {\n-  return str.replace(/[.+*?^${}()[\\]|/\\\\]/g, \"\\\\$&\");\n+  return $match(items, options);\n }\n \n /**\n- * Get the flags for a regexp from the options.\n+ * Flattened token set.\n  */\n-function toFlags(options: { sensitive?: boolean }) {\n-  return options.sensitive ? \"s\" : \"is\";\n-}\n+type Flattened = Text | Parameter | Wildcard;\n \n /**\n- * A key is a capture group in the regex.\n+ * Generate a flat list of sequence tokens from the given tokens.\n  */\n-export interface Key {\n-  name: string;\n-  prefix?: string;\n-  suffix?: string;\n-  pattern?: string;\n-  modifier?: string;\n-  separator?: string;\n-}\n+function* flatten(\n+  tokens: Token[],\n+  index: number,\n+  init: Flattened[],\n+): Generator<Flattened[]> {\n+  if (index === tokens.length) {\n+    return yield init;\n+  }\n \n-/**\n- * A token is a string (nothing special) or key metadata (capture group).\n- */\n-export type Token = string | Key;\n+  const token = tokens[index];\n+\n+  if (token.type === \"group\") {\n+    const fork = init.slice();\n+    for (const seq of flatten(token.tokens, 0, fork)) {\n+      yield* flatten(tokens, index + 1, seq);\n+    }\n+  } else {\n+    init.push(token);\n+  }\n+\n+  yield* flatten(tokens, index + 1, init);\n+}\n \n /**\n- * Convert a token into a regexp string (re-used for path validation).\n+ * Transform a flat sequence of tokens into a regular expression.\n  */\n-function toRegExpSource(data: TokenData, keys: Key[]): string[] {\n-  const sources = Array(data.tokens.length);\n+function sequenceToRegExp(\n+  tokens: Flattened[],\n+  delimiter: string,\n+  keys: Array<Parameter | Wildcard>,\n+): string {\n+  let result = \"\";\n   let backtrack = \"\";\n+  let isSafeSegmentParam = true;\n \n-  let i = data.tokens.length;\n+  for (let i = 0; i < tokens.length; i++) {\n+    const token = tokens[i];\n \n-  while (i--) {\n-    const token = data.tokens[i];\n-\n-    if (typeof token === \"string\") {\n-      backtrack = token;\n-      sources[i] = escape(token);\n+    if (token.type === \"text\") {\n+      result += escape(token.value);\n+      backtrack = token.value;\n+      isSafeSegmentParam ||= token.value.includes(delimiter);\n       continue;\n     }\n \n-    const {\n-      prefix = \"\",\n-      suffix = \"\",\n-      separator = suffix + prefix,\n-      modifier = \"\",\n-    } = token;\n-\n-    const pre = escape(prefix);\n-    const post = escape(suffix);\n-\n-    if (token.name) {\n-      backtrack = suffix || backtrack;\n-      keys.unshift(token);\n-\n-      if (isRepeat(token)) {\n-        if (!separator) {\n-          throw new TypeError(\n-            `Missing separator for \"${token.name}\": ${DEBUG_URL}`,\n-          );\n-        }\n+    if (token.type === \"param\" || token.type === \"wildcard\") {\n+      if (!isSafeSegmentParam && !backtrack) {\n+        throw new TypeError(`Missing text after \"${token.name}\": ${DEBUG_URL}`);\n+      }\n \n-        const mod = modifier === \"*\" ? \"?\" : \"\";\n-        const sep = escape(separator);\n-        const pattern =\n-          token.pattern || `${negate(data.delimiter, separator, backtrack)}+`;\n-\n-        sources[i] = wrap(\n-          pre,\n-          `(?:${pattern})(?:${sep}(?:${pattern}))*`,\n-          post,\n-          mod,\n-        );\n+      if (token.type === \"param\") {\n+        result += `(${negate(delimiter, isSafeSegmentParam ? \"\" : backtrack)}+)`;\n       } else {\n-        sources[i] = wrap(\n-          pre,\n-          token.pattern || `${negate(data.delimiter, backtrack)}+`,\n-          post,\n-          modifier,\n-        );\n+        result += `(.+)`;\n       }\n \n-      backtrack = prefix;\n-    } else {\n-      sources[i] = `(?:${pre}${post})${modifier}`;\n-      backtrack = `${prefix}${suffix}`;\n+      keys.push(token);\n+      backtrack = \"\";\n+      isSafeSegmentParam = false;\n+      continue;\n     }\n   }\n \n-  return sources;\n+  return result;\n }\n \n-function negate(...args: string[]) {\n-  const values = args.sort().filter((value, index, array) => {\n-    for (let i = 0; i < index; i++) {\n-      const v = array[i];\n-      if (v.length && value.startsWith(v)) return false;\n-    }\n-    return value.length > 0;\n-  });\n-\n+function negate(delimiter: string, backtrack: string) {\n+  const values = [delimiter, backtrack].filter(Boolean);\n   const isSimple = values.every((value) => value.length === 1);\n   if (isSimple) return `[^${escape(values.join(\"\"))}]`;\n-\n   return `(?:(?!${values.map(escape).join(\"|\")}).)`;\n }\n-\n-function wrap(pre: string, pattern: string, post: string, modifier: string) {\n-  if (pre || post) {\n-    return `(?:${pre}(${pattern})${post})${modifier}`;\n-  }\n-\n-  return `(${pattern})${modifier}`;\n-}"
            },
            {
                "sha": "3db8e883bb62117606b7ac1504cb2acbc69a767d",
                "filename": "tsconfig.build.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/60f2121e9b66b7b622cc01080df0aabda9eedee6/tsconfig.build.json",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/60f2121e9b66b7b622cc01080df0aabda9eedee6/tsconfig.build.json",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/tsconfig.build.json?ref=60f2121e9b66b7b622cc01080df0aabda9eedee6",
                "patch": "@@ -3,5 +3,5 @@\n   \"compilerOptions\": {\n     \"types\": []\n   },\n-  \"exclude\": [\"src/**/*.spec.ts\"]\n+  \"exclude\": [\"src/**/*.spec.ts\", \"src/**/*.bench.ts\"]\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/5e06da2f6794c695051605e26a01affa3a18f66b",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/5e06da2f6794c695051605e26a01affa3a18f66b",
        "html_url": "https://github.com/keycloak/keycloak/commit/5e06da2f6794c695051605e26a01affa3a18f66b",
        "message": "Honor turnOffChangeSessionIdOnLogin in SAML adapter (#186)\n\nCloses keycloak/keycloak-private#183\r\n\r\nSigned-off-by: rmartinc <rmartinc@redhat.com>",
        "files": [
            {
                "sha": "6dd6f0e7e3779fa35ff1d9c27c6db0d80fd98cb3",
                "filename": "adapters/saml/wildfly-elytron/src/main/java/org/keycloak/adapters/saml/elytron/ElytronSamlSessionStore.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/keycloak/keycloak/blob/5e06da2f6794c695051605e26a01affa3a18f66b/adapters%2Fsaml%2Fwildfly-elytron%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fadapters%2Fsaml%2Felytron%2FElytronSamlSessionStore.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/5e06da2f6794c695051605e26a01affa3a18f66b/adapters%2Fsaml%2Fwildfly-elytron%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fadapters%2Fsaml%2Felytron%2FElytronSamlSessionStore.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/adapters%2Fsaml%2Fwildfly-elytron%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fadapters%2Fsaml%2Felytron%2FElytronSamlSessionStore.java?ref=5e06da2f6794c695051605e26a01affa3a18f66b",
                "patch": "@@ -31,13 +31,9 @@\n import org.keycloak.adapters.spi.SessionIdMapper;\n import org.keycloak.adapters.spi.SessionIdMapperUpdater;\n import org.keycloak.common.util.KeycloakUriBuilder;\n-import org.keycloak.saml.processing.core.saml.v2.util.XMLTimeUtil;\n import org.wildfly.security.http.HttpScope;\n import org.wildfly.security.http.Scope;\n \n-import javax.xml.datatype.DatatypeConstants;\n-import javax.xml.datatype.XMLGregorianCalendar;\n-\n /**\n  * @author <a href=\"mailto:bill@burkecentral.com\">Bill Burke</a>\n  * @version $Revision: 1 $\n@@ -174,8 +170,12 @@ public void saveAccount(SamlSession account) {\n     }\n \n     protected String changeSessionId(HttpScope session) {\n-        if (!deployment.turnOffChangeSessionIdOnLogin()) return session.getID();\n-        else return session.getID();\n+        if (!deployment.turnOffChangeSessionIdOnLogin()) {\n+            if (!session.supportsChangeID() || !session.changeID()) {\n+                log.debug(\"Session ID cannot be changed although turnOffChangeSessionIdOnLogin is set to false\");\n+            }\n+        }\n+        return session.getID();\n     }\n \n     @Override"
            },
            {
                "sha": "b281decfba23a7cb97e8ac029078ec6857bd0643",
                "filename": "testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/InputServlet.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/5e06da2f6794c695051605e26a01affa3a18f66b/testsuite%2Fintegration-arquillian%2Ftest-apps%2Fservlets%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FInputServlet.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/5e06da2f6794c695051605e26a01affa3a18f66b/testsuite%2Fintegration-arquillian%2Ftest-apps%2Fservlets%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FInputServlet.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftest-apps%2Fservlets%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FInputServlet.java?ref=5e06da2f6794c695051605e26a01affa3a18f66b",
                "patch": "@@ -40,6 +40,7 @@ protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws Se\n         String appBase = ServletTestUtils.getUrlBase();\n         String actionUrl = appBase + \"/input-portal/secured/post\";\n \n+        req.getSession(true);\n         if (req.getRequestURI().endsWith(\"insecure\")) {\n             if (System.getProperty(\"insecure.user.principal.unsupported\") == null) Assert.assertNotNull(req.getUserPrincipal());\n             resp.setContentType(\"text/html\");\n@@ -65,6 +66,7 @@ protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws Se\n \n     @Override\n     protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n+        req.getSession(true);\n         if (!FORM_URLENCODED.equals(req.getContentType())) {\n             resp.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n             PrintWriter pw = resp.getWriter();"
            },
            {
                "sha": "26c65c281f0cc03b90c2bff5070e8eb51a2261b9",
                "filename": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLServletAdapterTest.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/5e06da2f6794c695051605e26a01affa3a18f66b/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FSAMLServletAdapterTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/5e06da2f6794c695051605e26a01affa3a18f66b/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FSAMLServletAdapterTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FSAMLServletAdapterTest.java?ref=5e06da2f6794c695051605e26a01affa3a18f66b",
                "patch": "@@ -1127,6 +1127,7 @@ public void idpInitiatedUnauthorizedLoginTest() {\n     public void testSavedPostRequest() {\n         inputPortalPage.navigateTo();\n         assertCurrentUrlStartsWith(inputPortalPage);\n+        String sessionId = driver.manage().getCookieNamed(\"JSESSIONID\").getValue();\n         inputPortalPage.execute(\"hello\");\n \n         assertCurrentUrlStartsWith(testRealmSAMLPostLoginPage);\n@@ -1137,6 +1138,7 @@ public void testSavedPostRequest() {\n         // test that user principal and KeycloakSecurityContext available\n         driver.navigate().to(inputPortalPage + \"/insecure\");\n         waitUntilElement(By.xpath(\"//body\")).text().contains(\"Insecure Page\");\n+        Assert.assertNotEquals(\"SessionID has not been changed at login\", sessionId, driver.manage().getCookieNamed(\"JSESSIONID\").getValue());\n \n         if (System.getProperty(\"insecure.user.principal.unsupported\") == null) waitUntilElement(By.xpath(\"//body\")).text().contains(\"UserPrincipal\");\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/2341d6ee7a3567c58fd6a04a419fe4403e13374c",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/2341d6ee7a3567c58fd6a04a419fe4403e13374c",
        "html_url": "https://github.com/keycloak/keycloak/commit/2341d6ee7a3567c58fd6a04a419fe4403e13374c",
        "message": "Honor turnOffChangeSessionIdOnLogin in SAML adapter (#185)\n\nCloses keycloak/keycloak-private#183\r\n\r\nSigned-off-by: rmartinc <rmartinc@redhat.com>",
        "files": [
            {
                "sha": "6dd6f0e7e3779fa35ff1d9c27c6db0d80fd98cb3",
                "filename": "adapters/saml/wildfly-elytron/src/main/java/org/keycloak/adapters/saml/elytron/ElytronSamlSessionStore.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/keycloak/keycloak/blob/2341d6ee7a3567c58fd6a04a419fe4403e13374c/adapters%2Fsaml%2Fwildfly-elytron%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fadapters%2Fsaml%2Felytron%2FElytronSamlSessionStore.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/2341d6ee7a3567c58fd6a04a419fe4403e13374c/adapters%2Fsaml%2Fwildfly-elytron%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fadapters%2Fsaml%2Felytron%2FElytronSamlSessionStore.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/adapters%2Fsaml%2Fwildfly-elytron%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fadapters%2Fsaml%2Felytron%2FElytronSamlSessionStore.java?ref=2341d6ee7a3567c58fd6a04a419fe4403e13374c",
                "patch": "@@ -31,13 +31,9 @@\n import org.keycloak.adapters.spi.SessionIdMapper;\n import org.keycloak.adapters.spi.SessionIdMapperUpdater;\n import org.keycloak.common.util.KeycloakUriBuilder;\n-import org.keycloak.saml.processing.core.saml.v2.util.XMLTimeUtil;\n import org.wildfly.security.http.HttpScope;\n import org.wildfly.security.http.Scope;\n \n-import javax.xml.datatype.DatatypeConstants;\n-import javax.xml.datatype.XMLGregorianCalendar;\n-\n /**\n  * @author <a href=\"mailto:bill@burkecentral.com\">Bill Burke</a>\n  * @version $Revision: 1 $\n@@ -174,8 +170,12 @@ public void saveAccount(SamlSession account) {\n     }\n \n     protected String changeSessionId(HttpScope session) {\n-        if (!deployment.turnOffChangeSessionIdOnLogin()) return session.getID();\n-        else return session.getID();\n+        if (!deployment.turnOffChangeSessionIdOnLogin()) {\n+            if (!session.supportsChangeID() || !session.changeID()) {\n+                log.debug(\"Session ID cannot be changed although turnOffChangeSessionIdOnLogin is set to false\");\n+            }\n+        }\n+        return session.getID();\n     }\n \n     @Override"
            },
            {
                "sha": "b281decfba23a7cb97e8ac029078ec6857bd0643",
                "filename": "testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/InputServlet.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/2341d6ee7a3567c58fd6a04a419fe4403e13374c/testsuite%2Fintegration-arquillian%2Ftest-apps%2Fservlets%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FInputServlet.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/2341d6ee7a3567c58fd6a04a419fe4403e13374c/testsuite%2Fintegration-arquillian%2Ftest-apps%2Fservlets%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FInputServlet.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftest-apps%2Fservlets%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FInputServlet.java?ref=2341d6ee7a3567c58fd6a04a419fe4403e13374c",
                "patch": "@@ -40,6 +40,7 @@ protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws Se\n         String appBase = ServletTestUtils.getUrlBase();\n         String actionUrl = appBase + \"/input-portal/secured/post\";\n \n+        req.getSession(true);\n         if (req.getRequestURI().endsWith(\"insecure\")) {\n             if (System.getProperty(\"insecure.user.principal.unsupported\") == null) Assert.assertNotNull(req.getUserPrincipal());\n             resp.setContentType(\"text/html\");\n@@ -65,6 +66,7 @@ protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws Se\n \n     @Override\n     protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n+        req.getSession(true);\n         if (!FORM_URLENCODED.equals(req.getContentType())) {\n             resp.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n             PrintWriter pw = resp.getWriter();"
            },
            {
                "sha": "f3f231d584e3bdeece225569b73e0ca7f47d3ec4",
                "filename": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLServletAdapterTest.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/2341d6ee7a3567c58fd6a04a419fe4403e13374c/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FSAMLServletAdapterTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/2341d6ee7a3567c58fd6a04a419fe4403e13374c/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FSAMLServletAdapterTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FSAMLServletAdapterTest.java?ref=2341d6ee7a3567c58fd6a04a419fe4403e13374c",
                "patch": "@@ -1134,6 +1134,7 @@ public void idpInitiatedUnauthorizedLoginTest() {\n     public void testSavedPostRequest() {\n         inputPortalPage.navigateTo();\n         assertCurrentUrlStartsWith(inputPortalPage);\n+        String sessionId = driver.manage().getCookieNamed(\"JSESSIONID\").getValue();\n         inputPortalPage.execute(\"hello\");\n \n         assertCurrentUrlStartsWith(testRealmSAMLPostLoginPage);\n@@ -1144,6 +1145,7 @@ public void testSavedPostRequest() {\n         // test that user principal and KeycloakSecurityContext available\n         driver.navigate().to(inputPortalPage + \"/insecure\");\n         waitUntilElement(By.xpath(\"//body\")).text().contains(\"Insecure Page\");\n+        Assert.assertNotEquals(\"SessionID has not been changed at login\", sessionId, driver.manage().getCookieNamed(\"JSESSIONID\").getValue());\n \n         if (System.getProperty(\"insecure.user.principal.unsupported\") == null) waitUntilElement(By.xpath(\"//body\")).text().contains(\"UserPrincipal\");\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/5b3de0c7e7f367103affe2f5167913a2ce021cf1",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/5b3de0c7e7f367103affe2f5167913a2ce021cf1",
        "html_url": "https://github.com/keycloak/keycloak/commit/5b3de0c7e7f367103affe2f5167913a2ce021cf1",
        "message": "Honor turnOffChangeSessionIdOnLogin in SAML adapter (#187)\n\nCloses keycloak/keycloak-private#183\r\n\r\nSigned-off-by: rmartinc <rmartinc@redhat.com>",
        "files": [
            {
                "sha": "6dd6f0e7e3779fa35ff1d9c27c6db0d80fd98cb3",
                "filename": "adapters/saml/wildfly-elytron/src/main/java/org/keycloak/adapters/saml/elytron/ElytronSamlSessionStore.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/keycloak/keycloak/blob/5b3de0c7e7f367103affe2f5167913a2ce021cf1/adapters%2Fsaml%2Fwildfly-elytron%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fadapters%2Fsaml%2Felytron%2FElytronSamlSessionStore.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/5b3de0c7e7f367103affe2f5167913a2ce021cf1/adapters%2Fsaml%2Fwildfly-elytron%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fadapters%2Fsaml%2Felytron%2FElytronSamlSessionStore.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/adapters%2Fsaml%2Fwildfly-elytron%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fadapters%2Fsaml%2Felytron%2FElytronSamlSessionStore.java?ref=5b3de0c7e7f367103affe2f5167913a2ce021cf1",
                "patch": "@@ -31,13 +31,9 @@\n import org.keycloak.adapters.spi.SessionIdMapper;\n import org.keycloak.adapters.spi.SessionIdMapperUpdater;\n import org.keycloak.common.util.KeycloakUriBuilder;\n-import org.keycloak.saml.processing.core.saml.v2.util.XMLTimeUtil;\n import org.wildfly.security.http.HttpScope;\n import org.wildfly.security.http.Scope;\n \n-import javax.xml.datatype.DatatypeConstants;\n-import javax.xml.datatype.XMLGregorianCalendar;\n-\n /**\n  * @author <a href=\"mailto:bill@burkecentral.com\">Bill Burke</a>\n  * @version $Revision: 1 $\n@@ -174,8 +170,12 @@ public void saveAccount(SamlSession account) {\n     }\n \n     protected String changeSessionId(HttpScope session) {\n-        if (!deployment.turnOffChangeSessionIdOnLogin()) return session.getID();\n-        else return session.getID();\n+        if (!deployment.turnOffChangeSessionIdOnLogin()) {\n+            if (!session.supportsChangeID() || !session.changeID()) {\n+                log.debug(\"Session ID cannot be changed although turnOffChangeSessionIdOnLogin is set to false\");\n+            }\n+        }\n+        return session.getID();\n     }\n \n     @Override"
            },
            {
                "sha": "b281decfba23a7cb97e8ac029078ec6857bd0643",
                "filename": "testsuite/integration-arquillian/test-apps/servlets/src/main/java/org/keycloak/testsuite/adapter/servlet/InputServlet.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/5b3de0c7e7f367103affe2f5167913a2ce021cf1/testsuite%2Fintegration-arquillian%2Ftest-apps%2Fservlets%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FInputServlet.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/5b3de0c7e7f367103affe2f5167913a2ce021cf1/testsuite%2Fintegration-arquillian%2Ftest-apps%2Fservlets%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FInputServlet.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftest-apps%2Fservlets%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FInputServlet.java?ref=5b3de0c7e7f367103affe2f5167913a2ce021cf1",
                "patch": "@@ -40,6 +40,7 @@ protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws Se\n         String appBase = ServletTestUtils.getUrlBase();\n         String actionUrl = appBase + \"/input-portal/secured/post\";\n \n+        req.getSession(true);\n         if (req.getRequestURI().endsWith(\"insecure\")) {\n             if (System.getProperty(\"insecure.user.principal.unsupported\") == null) Assert.assertNotNull(req.getUserPrincipal());\n             resp.setContentType(\"text/html\");\n@@ -65,6 +66,7 @@ protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws Se\n \n     @Override\n     protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {\n+        req.getSession(true);\n         if (!FORM_URLENCODED.equals(req.getContentType())) {\n             resp.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n             PrintWriter pw = resp.getWriter();"
            },
            {
                "sha": "6d3d7b527d6405c34f847e0918422e48847a8840",
                "filename": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/adapter/servlet/SAMLServletAdapterTest.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/5b3de0c7e7f367103affe2f5167913a2ce021cf1/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FSAMLServletAdapterTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/5b3de0c7e7f367103affe2f5167913a2ce021cf1/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FSAMLServletAdapterTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fadapter%2Fservlet%2FSAMLServletAdapterTest.java?ref=5b3de0c7e7f367103affe2f5167913a2ce021cf1",
                "patch": "@@ -1129,6 +1129,7 @@ public void idpInitiatedUnauthorizedLoginTest() {\n     public void testSavedPostRequest() {\n         inputPortalPage.navigateTo();\n         assertCurrentUrlStartsWith(inputPortalPage);\n+        String sessionId = driver.manage().getCookieNamed(\"JSESSIONID\").getValue();\n         inputPortalPage.execute(\"hello\");\n \n         assertCurrentUrlStartsWith(testRealmSAMLPostLoginPage);\n@@ -1139,6 +1140,7 @@ public void testSavedPostRequest() {\n         // test that user principal and KeycloakSecurityContext available\n         driver.navigate().to(inputPortalPage + \"/insecure\");\n         waitUntilElement(By.xpath(\"//body\")).text().contains(\"Insecure Page\");\n+        Assert.assertNotEquals(\"SessionID has not been changed at login\", sessionId, driver.manage().getCookieNamed(\"JSESSIONID\").getValue());\n \n         if (System.getProperty(\"insecure.user.principal.unsupported\") == null) waitUntilElement(By.xpath(\"//body\")).text().contains(\"UserPrincipal\");\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/twigphp/Twig/commits/2102dd135986db79192d26fb5f5817a566e0a7de",
        "url": "https://api.github.com/repos/twigphp/Twig/commits/2102dd135986db79192d26fb5f5817a566e0a7de",
        "html_url": "https://github.com/twigphp/Twig/commit/2102dd135986db79192d26fb5f5817a566e0a7de",
        "message": "Fix a security issue when an included sandboxed template has been loaded before without the sandbox context",
        "files": [
            {
                "sha": "18fc72b58474bc0fb3d69378600040be20c94f08",
                "filename": "src/Extension/CoreExtension.php",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/twigphp/Twig/blob/2102dd135986db79192d26fb5f5817a566e0a7de/src%2FExtension%2FCoreExtension.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/2102dd135986db79192d26fb5f5817a566e0a7de/src%2FExtension%2FCoreExtension.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/src%2FExtension%2FCoreExtension.php?ref=2102dd135986db79192d26fb5f5817a566e0a7de",
                "patch": "@@ -1268,13 +1268,6 @@ function twig_include(Environment $env, $context, $template, $variables = [], $w\n         if (!$alreadySandboxed = $sandbox->isSandboxed()) {\n             $sandbox->enableSandbox();\n         }\n-\n-        foreach ((\\is_array($template) ? $template : [$template]) as $name) {\n-            // if a Template instance is passed, it might have been instantiated outside of a sandbox, check security\n-            if ($name instanceof TemplateWrapper || $name instanceof Template) {\n-                $name->unwrap()->checkSecurity();\n-            }\n-        }\n     }\n \n     try {\n@@ -1287,6 +1280,10 @@ function twig_include(Environment $env, $context, $template, $variables = [], $w\n             }\n         }\n \n+        if ($isSandboxed && $loaded) {\n+            $loaded->unwrap()->checkSecurity();\n+        }\n+\n         return $loaded ? $loaded->render($variables) : '';\n     } finally {\n         if ($isSandboxed && !$alreadySandboxed) {"
            },
            {
                "sha": "0e73b8c136328a0603cde1ad377b5a3fd5abc82a",
                "filename": "tests/Extension/CoreTest.php",
                "status": "modified",
                "additions": 38,
                "deletions": 0,
                "changes": 38,
                "blob_url": "https://github.com/twigphp/Twig/blob/2102dd135986db79192d26fb5f5817a566e0a7de/tests%2FExtension%2FCoreTest.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/2102dd135986db79192d26fb5f5817a566e0a7de/tests%2FExtension%2FCoreTest.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/tests%2FExtension%2FCoreTest.php?ref=2102dd135986db79192d26fb5f5817a566e0a7de",
                "patch": "@@ -14,7 +14,11 @@\n use PHPUnit\\Framework\\TestCase;\n use Twig\\Environment;\n use Twig\\Error\\RuntimeError;\n+use Twig\\Extension\\SandboxExtension;\n+use Twig\\Loader\\ArrayLoader;\n use Twig\\Loader\\LoaderInterface;\n+use Twig\\Sandbox\\SecurityError;\n+use Twig\\Sandbox\\SecurityPolicy;\n \n class CoreTest extends TestCase\n {\n@@ -251,6 +255,40 @@ public function provideSliceFilterCases()\n             [[], new \\ArrayIterator([1, 2]), 3],\n         ];\n     }\n+\n+    public function testSandboxedInclude()\n+    {\n+        $twig = new Environment(new ArrayLoader([\n+            'index' => '{{ include(\"included\", sandboxed=true) }}',\n+            'included' => '{{ \"included\"|e }}',\n+        ]));\n+        $policy = new SecurityPolicy([], [], [], [], ['include']);\n+        $sandbox = new SandboxExtension($policy, false);\n+        $twig->addExtension($sandbox);\n+\n+        // We expect a compile error\n+        $this->expectException(SecurityError::class);\n+        $twig->render('index');\n+    }\n+\n+    public function testSandboxedIncludeWithPreloadedTemplate()\n+    {\n+        $twig = new Environment(new ArrayLoader([\n+            'index' => '{{ include(\"included\", sandboxed=true) }}',\n+            'included' => '{{ \"included\"|e }}',\n+        ]));\n+        $policy = new SecurityPolicy([], [], [], [], ['include']);\n+        $sandbox = new SandboxExtension($policy, false);\n+        $twig->addExtension($sandbox);\n+\n+        // The template is loaded without the sandbox enabled\n+        // so, no compile error\n+        $twig->load('included');\n+\n+        // We expect a runtime error\n+        $this->expectException(SecurityError::class);\n+        $twig->render('index');\n+    }\n }\n \n final class CoreTestIteratorAggregate implements \\IteratorAggregate"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/twigphp/Twig/commits/7afa198603de49d147e90d18062e7b9addcf5233",
        "url": "https://api.github.com/repos/twigphp/Twig/commits/7afa198603de49d147e90d18062e7b9addcf5233",
        "html_url": "https://github.com/twigphp/Twig/commit/7afa198603de49d147e90d18062e7b9addcf5233",
        "message": "Fix a security issue when an included sandboxed template has been loaded before without the sandbox context",
        "files": [
            {
                "sha": "bf1926cfb0e9c70f2959dccaac3e465d7bd79caf",
                "filename": "src/Extension/CoreExtension.php",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/twigphp/Twig/blob/7afa198603de49d147e90d18062e7b9addcf5233/src%2FExtension%2FCoreExtension.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/7afa198603de49d147e90d18062e7b9addcf5233/src%2FExtension%2FCoreExtension.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/src%2FExtension%2FCoreExtension.php?ref=7afa198603de49d147e90d18062e7b9addcf5233",
                "patch": "@@ -1569,13 +1569,6 @@ function twig_include(Environment $env, $context, $template, $variables = [], $w\n         if (!$alreadySandboxed = $sandbox->isSandboxed()) {\n             $sandbox->enableSandbox();\n         }\n-\n-        foreach ((\\is_array($template) ? $template : [$template]) as $name) {\n-            // if a Template instance is passed, it might have been instantiated outside of a sandbox, check security\n-            if ($name instanceof TemplateWrapper || $name instanceof Template) {\n-                $name->unwrap()->checkSecurity();\n-            }\n-        }\n     }\n \n     $loaded = null;\n@@ -1604,6 +1597,10 @@ function twig_include(Environment $env, $context, $template, $variables = [], $w\n     }\n \n     try {\n+        if ($isSandboxed && $loaded) {\n+            $loaded->unwrap()->checkSecurity();\n+        }\n+\n         $ret = $loaded ? $loaded->render($variables) : '';\n     } catch (\\Exception $e) {\n         if ($isSandboxed && !$alreadySandboxed) {"
            },
            {
                "sha": "c3907800d3504ab0426189105ab7e6748f24c4cd",
                "filename": "tests/Extension/CoreTest.php",
                "status": "modified",
                "additions": 38,
                "deletions": 0,
                "changes": 38,
                "blob_url": "https://github.com/twigphp/Twig/blob/7afa198603de49d147e90d18062e7b9addcf5233/tests%2FExtension%2FCoreTest.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/7afa198603de49d147e90d18062e7b9addcf5233/tests%2FExtension%2FCoreTest.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/tests%2FExtension%2FCoreTest.php?ref=7afa198603de49d147e90d18062e7b9addcf5233",
                "patch": "@@ -12,6 +12,10 @@\n  */\n \n use Twig\\Environment;\n+use Twig\\Extension\\SandboxExtension;\n+use Twig\\Loader\\ArrayLoader;\n+use Twig\\Sandbox\\SecurityError;\n+use Twig\\Sandbox\\SecurityPolicy;\n \n class CoreTest extends \\PHPUnit\\Framework\\TestCase\n {\n@@ -283,6 +287,40 @@ public function provideSliceFilterCases()\n             [[], new \\ArrayIterator([1, 2]), 3],\n         ];\n     }\n+\n+    public function testSandboxedInclude()\n+    {\n+        $twig = new Environment(new ArrayLoader([\n+            'index' => '{{ include(\"included\", sandboxed=true) }}',\n+            'included' => '{{ \"included\"|e }}',\n+        ]));\n+        $policy = new SecurityPolicy([], [], [], [], ['include']);\n+        $sandbox = new SandboxExtension($policy, false);\n+        $twig->addExtension($sandbox);\n+\n+        // We expect a compile error\n+        $this->expectException(SecurityError::class);\n+        $twig->render('index');\n+    }\n+\n+    public function testSandboxedIncludeWithPreloadedTemplate()\n+    {\n+        $twig = new Environment(new ArrayLoader([\n+            'index' => '{{ include(\"included\", sandboxed=true) }}',\n+            'included' => '{{ \"included\"|e }}',\n+        ]));\n+        $policy = new SecurityPolicy([], [], [], [], ['include']);\n+        $sandbox = new SandboxExtension($policy, false);\n+        $twig->addExtension($sandbox);\n+\n+        // The template is loaded without the sandbox enabled\n+        // so, no compile error\n+        $twig->load('included');\n+\n+        // We expect a runtime error\n+        $this->expectException(SecurityError::class);\n+        $twig->render('index');\n+    }\n }\n \n function foo_escaper_for_test(Environment $env, $string, $charset)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/twigphp/Twig/commits/41103dcdc2daab4c83cdd05b5b4fde5b7e41e635",
        "url": "https://api.github.com/repos/twigphp/Twig/commits/41103dcdc2daab4c83cdd05b5b4fde5b7e41e635",
        "html_url": "https://github.com/twigphp/Twig/commit/41103dcdc2daab4c83cdd05b5b4fde5b7e41e635",
        "message": "Fix a security issue when an included sandboxed template has been loaded before without the sandbox context",
        "files": [
            {
                "sha": "4b014b8df930ac9a36f706e40f6abf0ee178c1b8",
                "filename": "src/Extension/CoreExtension.php",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/twigphp/Twig/blob/41103dcdc2daab4c83cdd05b5b4fde5b7e41e635/src%2FExtension%2FCoreExtension.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/41103dcdc2daab4c83cdd05b5b4fde5b7e41e635/src%2FExtension%2FCoreExtension.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/src%2FExtension%2FCoreExtension.php?ref=41103dcdc2daab4c83cdd05b5b4fde5b7e41e635",
                "patch": "@@ -1400,13 +1400,6 @@ public static function include(Environment $env, $context, $template, $variables\n             if (!$alreadySandboxed = $sandbox->isSandboxed()) {\n                 $sandbox->enableSandbox();\n             }\n-\n-            foreach ((\\is_array($template) ? $template : [$template]) as $name) {\n-                // if a Template instance is passed, it might have been instantiated outside of a sandbox, check security\n-                if ($name instanceof TemplateWrapper || $name instanceof Template) {\n-                    $name->unwrap()->checkSecurity();\n-                }\n-            }\n         }\n \n         try {\n@@ -1419,6 +1412,10 @@ public static function include(Environment $env, $context, $template, $variables\n                 }\n             }\n \n+            if ($isSandboxed && $loaded) {\n+                $loaded->unwrap()->checkSecurity();\n+            }\n+\n             return $loaded ? $loaded->render($variables) : '';\n         } finally {\n             if ($isSandboxed && !$alreadySandboxed) {"
            },
            {
                "sha": "5b8268492a239be07e23fe3791a71632992b4f5b",
                "filename": "tests/Extension/CoreTest.php",
                "status": "modified",
                "additions": 39,
                "deletions": 0,
                "changes": 39,
                "blob_url": "https://github.com/twigphp/Twig/blob/41103dcdc2daab4c83cdd05b5b4fde5b7e41e635/tests%2FExtension%2FCoreTest.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/41103dcdc2daab4c83cdd05b5b4fde5b7e41e635/tests%2FExtension%2FCoreTest.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/tests%2FExtension%2FCoreTest.php?ref=41103dcdc2daab4c83cdd05b5b4fde5b7e41e635",
                "patch": "@@ -12,8 +12,13 @@\n  */\n \n use PHPUnit\\Framework\\TestCase;\n+use Twig\\Environment;\n use Twig\\Error\\RuntimeError;\n use Twig\\Extension\\CoreExtension;\n+use Twig\\Extension\\SandboxExtension;\n+use Twig\\Loader\\ArrayLoader;\n+use Twig\\Sandbox\\SecurityError;\n+use Twig\\Sandbox\\SecurityPolicy;\n \n class CoreTest extends TestCase\n {\n@@ -313,6 +318,40 @@ public function provideCompareCases()\n             [1, 42, \"\\x00\\x34\\x32\"],\n         ];\n     }\n+\n+    public function testSandboxedInclude()\n+    {\n+        $twig = new Environment(new ArrayLoader([\n+            'index' => '{{ include(\"included\", sandboxed=true) }}',\n+            'included' => '{{ \"included\"|e }}',\n+        ]));\n+        $policy = new SecurityPolicy(allowedFunctions: ['include']);\n+        $sandbox = new SandboxExtension($policy, false);\n+        $twig->addExtension($sandbox);\n+\n+        // We expect a compile error\n+        $this->expectException(SecurityError::class);\n+        $twig->render('index');\n+    }\n+\n+    public function testSandboxedIncludeWithPreloadedTemplate()\n+    {\n+        $twig = new Environment(new ArrayLoader([\n+            'index' => '{{ include(\"included\", sandboxed=true) }}',\n+            'included' => '{{ \"included\"|e }}',\n+        ]));\n+        $policy = new SecurityPolicy(allowedFunctions: ['include']);\n+        $sandbox = new SandboxExtension($policy, false);\n+        $twig->addExtension($sandbox);\n+\n+        // The template is loaded without the sandbox enabled\n+        // so, no compile error\n+        $twig->load('included');\n+\n+        // We expect a runtime error\n+        $this->expectException(SecurityError::class);\n+        $twig->render('index');\n+    }\n }\n \n final class CoreTestIteratorAggregate implements \\IteratorAggregate"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/twigphp/Twig/commits/11f68e2aeb526bfaf638e30d4420d8a710f3f7c6",
        "url": "https://api.github.com/repos/twigphp/Twig/commits/11f68e2aeb526bfaf638e30d4420d8a710f3f7c6",
        "html_url": "https://github.com/twigphp/Twig/commit/11f68e2aeb526bfaf638e30d4420d8a710f3f7c6",
        "message": "Fix a security issue when an included sandboxed template has been loaded before without the sandbox context",
        "files": [
            {
                "sha": "3ed27a35cc3d28900d6fa0182885034c366888bf",
                "filename": "src/Extension/CoreExtension.php",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/twigphp/Twig/blob/11f68e2aeb526bfaf638e30d4420d8a710f3f7c6/src%2FExtension%2FCoreExtension.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/11f68e2aeb526bfaf638e30d4420d8a710f3f7c6/src%2FExtension%2FCoreExtension.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/src%2FExtension%2FCoreExtension.php?ref=11f68e2aeb526bfaf638e30d4420d8a710f3f7c6",
                "patch": "@@ -1431,13 +1431,6 @@ public static function include(Environment $env, $context, $template, $variables\n             if (!$alreadySandboxed = $sandbox->isSandboxed()) {\n                 $sandbox->enableSandbox();\n             }\n-\n-            foreach ((\\is_array($template) ? $template : [$template]) as $name) {\n-                // if a Template instance is passed, it might have been instantiated outside of a sandbox, check security\n-                if ($name instanceof TemplateWrapper || $name instanceof Template) {\n-                    $name->unwrap()->checkSecurity();\n-                }\n-            }\n         }\n \n         try {\n@@ -1452,6 +1445,10 @@ public static function include(Environment $env, $context, $template, $variables\n                 return '';\n             }\n \n+            if ($isSandboxed) {\n+                $loaded->unwrap()->checkSecurity();\n+            }\n+\n             return $loaded->render($variables);\n         } finally {\n             if ($isSandboxed && !$alreadySandboxed) {"
            },
            {
                "sha": "6bb74807f86e9f8d489781a8ee00619ec19824a8",
                "filename": "tests/Extension/CoreTest.php",
                "status": "modified",
                "additions": 39,
                "deletions": 0,
                "changes": 39,
                "blob_url": "https://github.com/twigphp/Twig/blob/11f68e2aeb526bfaf638e30d4420d8a710f3f7c6/tests%2FExtension%2FCoreTest.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/11f68e2aeb526bfaf638e30d4420d8a710f3f7c6/tests%2FExtension%2FCoreTest.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/tests%2FExtension%2FCoreTest.php?ref=11f68e2aeb526bfaf638e30d4420d8a710f3f7c6",
                "patch": "@@ -12,8 +12,13 @@\n  */\n \n use PHPUnit\\Framework\\TestCase;\n+use Twig\\Environment;\n use Twig\\Error\\RuntimeError;\n use Twig\\Extension\\CoreExtension;\n+use Twig\\Extension\\SandboxExtension;\n+use Twig\\Loader\\ArrayLoader;\n+use Twig\\Sandbox\\SecurityError;\n+use Twig\\Sandbox\\SecurityPolicy;\n \n class CoreTest extends TestCase\n {\n@@ -354,6 +359,40 @@ public static function provideCompareCases()\n             [1, 42, \"\\x00\\x34\\x32\"],\n         ];\n     }\n+\n+    public function testSandboxedInclude()\n+    {\n+        $twig = new Environment(new ArrayLoader([\n+            'index' => '{{ include(\"included\", sandboxed: true) }}',\n+            'included' => '{{ \"included\"|e }}',\n+        ]));\n+        $policy = new SecurityPolicy(allowedFunctions: ['include']);\n+        $sandbox = new SandboxExtension($policy, false);\n+        $twig->addExtension($sandbox);\n+\n+        // We expect a compile error\n+        $this->expectException(SecurityError::class);\n+        $twig->render('index');\n+    }\n+\n+    public function testSandboxedIncludeWithPreloadedTemplate()\n+    {\n+        $twig = new Environment(new ArrayLoader([\n+            'index' => '{{ include(\"included\", sandboxed: true) }}',\n+            'included' => '{{ \"included\"|e }}',\n+        ]));\n+        $policy = new SecurityPolicy(allowedFunctions: ['include']);\n+        $sandbox = new SandboxExtension($policy, false);\n+        $twig->addExtension($sandbox);\n+\n+        // The template is loaded without the sandbox enabled\n+        // so, no compile error\n+        $twig->load('included');\n+\n+        // We expect a runtime error\n+        $this->expectException(SecurityError::class);\n+        $twig->render('index');\n+    }\n }\n \n final class CoreTestIteratorAggregate implements \\IteratorAggregate"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/craftcms/cms/commits/b7348942f8131b3868ec6f46d615baae50151bb8",
        "url": "https://api.github.com/repos/craftcms/cms/commits/b7348942f8131b3868ec6f46d615baae50151bb8",
        "html_url": "https://github.com/craftcms/cms/commit/b7348942f8131b3868ec6f46d615baae50151bb8",
        "message": "Fixed XSS vulnerabilities",
        "files": [
            {
                "sha": "b3ea3604d3a381b1e1a12c60fe3981811fce190c",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/craftcms/cms/blob/b7348942f8131b3868ec6f46d615baae50151bb8/CHANGELOG.md",
                "raw_url": "https://github.com/craftcms/cms/raw/b7348942f8131b3868ec6f46d615baae50151bb8/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/craftcms/cms/contents/CHANGELOG.md?ref=b7348942f8131b3868ec6f46d615baae50151bb8",
                "patch": "@@ -6,6 +6,7 @@\n - Fixed a bug where pressing <kbd>Shift</kbd> + <kbd>Spacebar</kbd> wasn\u2019t reliably opening the asset preview modal on the Assets index page. ([#14943](https://github.com/craftcms/cms/issues/14943))\n - Fixed a bug where pressing <kbd>Shift</kbd> + <kbd>Spacebar</kbd> within an asset preview modal wasn\u2019t closing the modal.\n - Fixed a bug where pressing arrow keys within asset preview modals wasn\u2019t retargeting the preview modal to adjacent assets. ([#14943](https://github.com/craftcms/cms/issues/14943))\n+- Fixed XSS vulnerabilities.\n \n ## 5.1.1 - 2024-05-02\n "
            },
            {
                "sha": "30bc2b12dbd17674aeb094f51290dc95e329faca",
                "filename": "src/base/Element.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/craftcms/cms/blob/b7348942f8131b3868ec6f46d615baae50151bb8/src%2Fbase%2FElement.php",
                "raw_url": "https://github.com/craftcms/cms/raw/b7348942f8131b3868ec6f46d615baae50151bb8/src%2Fbase%2FElement.php",
                "contents_url": "https://api.github.com/repos/craftcms/cms/contents/src%2Fbase%2FElement.php?ref=b7348942f8131b3868ec6f46d615baae50151bb8",
                "patch": "@@ -3204,7 +3204,7 @@ protected function uiLabel(): ?string\n      */\n     public function getChipLabelHtml(): string\n     {\n-        return $this->getUiLabel();\n+        return Html::encode($this->getUiLabel());\n     }\n \n     /**"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/external-secrets/external-secrets/commits/0368b9806f660fa6bc52cbbf3c6ccdb27c58bb35",
        "url": "https://api.github.com/repos/external-secrets/external-secrets/commits/0368b9806f660fa6bc52cbbf3c6ccdb27c58bb35",
        "html_url": "https://github.com/external-secrets/external-secrets/commit/0368b9806f660fa6bc52cbbf3c6ccdb27c58bb35",
        "message": "fix: add watch to validatingwebhookconfigs (#3845)\n\n* fix: add watch to validatingwebhookconfigs\r\n\r\nSigned-off-by: Gustavo Carvalho <gusfcarvalho@gmail.com>\r\n\r\n* fix: only patch/update are resource-bound\r\n\r\nSigned-off-by: Gustavo Carvalho <gusfcarvalho@gmail.com>\r\n\r\n---------\r\n\r\nSigned-off-by: Gustavo Carvalho <gusfcarvalho@gmail.com>",
        "files": [
            {
                "sha": "84a0c110bd04080da50a659a1401455eccc1c632",
                "filename": "deploy/charts/external-secrets/templates/cert-controller-rbac.yaml",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/external-secrets/external-secrets/blob/0368b9806f660fa6bc52cbbf3c6ccdb27c58bb35/deploy%2Fcharts%2Fexternal-secrets%2Ftemplates%2Fcert-controller-rbac.yaml",
                "raw_url": "https://github.com/external-secrets/external-secrets/raw/0368b9806f660fa6bc52cbbf3c6ccdb27c58bb35/deploy%2Fcharts%2Fexternal-secrets%2Ftemplates%2Fcert-controller-rbac.yaml",
                "contents_url": "https://api.github.com/repos/external-secrets/external-secrets/contents/deploy%2Fcharts%2Fexternal-secrets%2Ftemplates%2Fcert-controller-rbac.yaml?ref=0368b9806f660fa6bc52cbbf3c6ccdb27c58bb35",
                "patch": "@@ -22,6 +22,8 @@ rules:\n     - \"validatingwebhookconfigurations\"\n     verbs:\n     - \"list\"\n+    - \"watch\"\n+    - \"get\"\n   - apiGroups:\n     - \"admissionregistration.k8s.io\"\n     resources:\n@@ -30,8 +32,6 @@ rules:\n     - \"secretstore-validate\"\n     - \"externalsecret-validate\"\n     verbs:\n-    - \"get\"\n-    - \"watch\"\n     - \"update\"\n     - \"patch\"\n   - apiGroups:"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/external-secrets/external-secrets/commits/428a452fd2ad45935312f2c2c0d40bc37ce6e67c",
        "url": "https://api.github.com/repos/external-secrets/external-secrets/commits/428a452fd2ad45935312f2c2c0d40bc37ce6e67c",
        "html_url": "https://github.com/external-secrets/external-secrets/commit/428a452fd2ad45935312f2c2c0d40bc37ce6e67c",
        "message": "add the resourceNames(git commit -s) (#3822)\n\n* add the resourceNames\r\n\r\nSigned-off-by: younaman <952508578@qq.com>\r\n\r\n* fixed\r\n\r\nSigned-off-by: younaman <952508578@qq.com>\r\n\r\n* make helm.test.update\r\n\r\nSigned-off-by: younaman <952508578@qq.com>\r\n\r\n---------\r\n\r\nSigned-off-by: younaman <952508578@qq.com>\r\nCo-authored-by: Gergely Brautigam <182850+Skarlso@users.noreply.github.com>",
        "files": [
            {
                "sha": "83e49f0ae0ebc994a06b3cc23942e2b49efdc981",
                "filename": "deploy/charts/external-secrets/templates/cert-controller-rbac.yaml",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/external-secrets/external-secrets/blob/428a452fd2ad45935312f2c2c0d40bc37ce6e67c/deploy%2Fcharts%2Fexternal-secrets%2Ftemplates%2Fcert-controller-rbac.yaml",
                "raw_url": "https://github.com/external-secrets/external-secrets/raw/428a452fd2ad45935312f2c2c0d40bc37ce6e67c/deploy%2Fcharts%2Fexternal-secrets%2Ftemplates%2Fcert-controller-rbac.yaml",
                "contents_url": "https://api.github.com/repos/external-secrets/external-secrets/contents/deploy%2Fcharts%2Fexternal-secrets%2Ftemplates%2Fcert-controller-rbac.yaml?ref=428a452fd2ad45935312f2c2c0d40bc37ce6e67c",
                "patch": "@@ -21,8 +21,16 @@ rules:\n     resources:\n     - \"validatingwebhookconfigurations\"\n     verbs:\n-    - \"get\"\n     - \"list\"\n+  - apiGroups:\n+    - \"admissionregistration.k8s.io\"\n+    resources:\n+    - \"validatingwebhookconfigurations\"\n+    resourceNames:\n+    - \"secretstore-validate\"\n+    - \"externalsecret-validate\"\n+    verbs:\n+    - \"get\"\n     - \"watch\"\n     - \"update\"\n     - \"patch\""
            },
            {
                "sha": "6c137c00fdfe5039d910377d7d37918781939b46",
                "filename": "deploy/charts/external-secrets/tests/__snapshot__/crds_test.yaml.snap",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/external-secrets/external-secrets/blob/428a452fd2ad45935312f2c2c0d40bc37ce6e67c/deploy%2Fcharts%2Fexternal-secrets%2Ftests%2F__snapshot__%2Fcrds_test.yaml.snap",
                "raw_url": "https://github.com/external-secrets/external-secrets/raw/428a452fd2ad45935312f2c2c0d40bc37ce6e67c/deploy%2Fcharts%2Fexternal-secrets%2Ftests%2F__snapshot__%2Fcrds_test.yaml.snap",
                "contents_url": "https://api.github.com/repos/external-secrets/external-secrets/contents/deploy%2Fcharts%2Fexternal-secrets%2Ftests%2F__snapshot__%2Fcrds_test.yaml.snap?ref=428a452fd2ad45935312f2c2c0d40bc37ce6e67c",
                "patch": "@@ -4,7 +4,7 @@ should match snapshot of default values:\n     kind: CustomResourceDefinition\n     metadata:\n       annotations:\n-        controller-gen.kubebuilder.io/version: v0.15.0\n+        controller-gen.kubebuilder.io/version: v0.16.1\n       labels:\n         external-secrets.io/component: controller\n       name: secretstores.external-secrets.io"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/laurent22/joplin/commits/b220413a9b5ed55fb1f565ac786a5c231da8bc87",
        "url": "https://api.github.com/repos/laurent22/joplin/commits/b220413a9b5ed55fb1f565ac786a5c231da8bc87",
        "html_url": "https://github.com/laurent22/joplin/commit/b220413a9b5ed55fb1f565ac786a5c231da8bc87",
        "message": "Desktop: Security: Fix HTML parsing bug (#10876)",
        "files": [
            {
                "sha": "f731cd5a3450947e5eb3af0317118e8beef91ac0",
                "filename": "packages/app-cli/tests/md_to_html/sanitize_20.html",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/laurent22/joplin/blob/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Fapp-cli%2Ftests%2Fmd_to_html%2Fsanitize_20.html",
                "raw_url": "https://github.com/laurent22/joplin/raw/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Fapp-cli%2Ftests%2Fmd_to_html%2Fsanitize_20.html",
                "contents_url": "https://api.github.com/repos/laurent22/joplin/contents/packages%2Fapp-cli%2Ftests%2Fmd_to_html%2Fsanitize_20.html?ref=b220413a9b5ed55fb1f565ac786a5c231da8bc87",
                "patch": "@@ -0,0 +1,2 @@\n+<div class=\"jop-noMdConv\">\n+&lt;.a\n\\ No newline at end of file"
            },
            {
                "sha": "4da3453d23b918716f31e5b79294c66e3013afe9",
                "filename": "packages/app-cli/tests/md_to_html/sanitize_20.md",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/laurent22/joplin/blob/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Fapp-cli%2Ftests%2Fmd_to_html%2Fsanitize_20.md",
                "raw_url": "https://github.com/laurent22/joplin/raw/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Fapp-cli%2Ftests%2Fmd_to_html%2Fsanitize_20.md",
                "contents_url": "https://api.github.com/repos/laurent22/joplin/contents/packages%2Fapp-cli%2Ftests%2Fmd_to_html%2Fsanitize_20.md?ref=b220413a9b5ed55fb1f565ac786a5c231da8bc87",
                "patch": "@@ -0,0 +1,2 @@\n+<div>\n+<.a<iframe src=\"http://example.com/\" >\n\\ No newline at end of file"
            },
            {
                "sha": "69b0e8a96f28576f4d7f0d4fe0e1ed3b4d042a7a",
                "filename": "packages/fork-htmlparser2/README.md",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/laurent22/joplin/blob/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Ffork-htmlparser2%2FREADME.md",
                "raw_url": "https://github.com/laurent22/joplin/raw/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Ffork-htmlparser2%2FREADME.md",
                "contents_url": "https://api.github.com/repos/laurent22/joplin/contents/packages%2Ffork-htmlparser2%2FREADME.md?ref=b220413a9b5ed55fb1f565ac786a5c231da8bc87",
                "patch": "@@ -54,6 +54,8 @@ index 44b4371..bcd7cc2 100644\n          if (this._cbs.onend)\n ```\n \n+To fix an HTML parsing issue (tags were allowed to start with non-alphanumeric characters), [this upstream commit](https://github.com/fb55/htmlparser2/commit/bc010de9df09f2d730a69734e05e5175ea8bd2d7) has also been applied.\n+\n * * *\n \n # htmlparser2"
            },
            {
                "sha": "a744e697c4301be9783223840d899a80f0eb4ab0",
                "filename": "packages/fork-htmlparser2/src/Tokenizer.ts",
                "status": "modified",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/laurent22/joplin/blob/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Ffork-htmlparser2%2Fsrc%2FTokenizer.ts",
                "raw_url": "https://github.com/laurent22/joplin/raw/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Ffork-htmlparser2%2Fsrc%2FTokenizer.ts",
                "contents_url": "https://api.github.com/repos/laurent22/joplin/contents/packages%2Ffork-htmlparser2%2Fsrc%2FTokenizer.ts?ref=b220413a9b5ed55fb1f565ac786a5c231da8bc87",
                "patch": "@@ -32,6 +32,7 @@ const enum State {\n     //comments\n     BeforeComment,\n     InComment,\n+    InSpecialComment,\n     AfterComment1,\n     AfterComment2,\n \n@@ -87,6 +88,10 @@ function whitespace(c: string): boolean {\n     return c === \" \" || c === \"\\n\" || c === \"\\t\" || c === \"\\f\" || c === \"\\r\";\n }\n \n+function isASCIIAlpha(c: string): boolean {\n+    return (c >= 'a' && c <= 'z') || (c >= 'A' && c <= 'Z');\n+}\n+\n interface Callbacks {\n     onattribdata(value: string): void; //TODO implement the new event\n     onattribend(): void;\n@@ -282,6 +287,8 @@ export default class Tokenizer {\n         } else if (c === \"?\") {\n             this._state = State.InProcessingInstruction;\n             this._sectionStart = this._index + 1;\n+        } else if (!isASCIIAlpha(c)) {\n+            this._state = State.Text;\n         } else {\n             this._state =\n                 !this._xmlMode && (c === \"s\" || c === \"S\")\n@@ -309,6 +316,9 @@ export default class Tokenizer {\n                 this._state = State.Text;\n                 this._index--;\n             }\n+        } else if (!isASCIIAlpha(c)) {\n+            this._state = State.InSpecialComment;\n+            this._sectionStart = this._index;\n         } else {\n             this._state = State.InClosingTagName;\n             this._sectionStart = this._index;\n@@ -454,6 +464,15 @@ export default class Tokenizer {\n     _stateInComment(c: string) {\n         if (c === \"-\") this._state = State.AfterComment1;\n     }\n+    _stateInSpecialComment(c: string) {\n+        if (c === \">\") {\n+            this._cbs.oncomment(\n+                this._buffer.substring(this._sectionStart, this._index)\n+            );\n+            this._state = State.Text;\n+            this._sectionStart = this._index + 1;\n+        }\n+    }\n     _stateAfterComment1(c: string) {\n         if (c === \"-\") {\n             this._state = State.AfterComment2;\n@@ -702,6 +721,8 @@ export default class Tokenizer {\n                 this._stateInAttributeName(c);\n             } else if (this._state === State.InComment) {\n                 this._stateInComment(c);\n+            } else if (this._state === State.InSpecialComment) {\n+                this._stateInSpecialComment(c);\n             } else if (this._state === State.BeforeAttributeName) {\n                 this._stateBeforeAttributeName(c);\n             } else if (this._state === State.InTagName) {"
            },
            {
                "sha": "06f9b687c3a627b8a4dedeef86be6de55e6ccc05",
                "filename": "packages/fork-htmlparser2/src/__fixtures__/Events/34-not-alpha-tags.json",
                "status": "added",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/laurent22/joplin/blob/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Ffork-htmlparser2%2Fsrc%2F__fixtures__%2FEvents%2F34-not-alpha-tags.json",
                "raw_url": "https://github.com/laurent22/joplin/raw/b220413a9b5ed55fb1f565ac786a5c231da8bc87/packages%2Ffork-htmlparser2%2Fsrc%2F__fixtures__%2FEvents%2F34-not-alpha-tags.json",
                "contents_url": "https://api.github.com/repos/laurent22/joplin/contents/packages%2Ffork-htmlparser2%2Fsrc%2F__fixtures__%2FEvents%2F34-not-alpha-tags.json?ref=b220413a9b5ed55fb1f565ac786a5c231da8bc87",
                "patch": "@@ -0,0 +1,12 @@\n+{\n+  \"name\": \"tag names are not ASCII alpha\",\n+  \"options\": {\n+      \"parser\": {}\n+  },\n+  \"html\": \"<12>text</12>\",\n+  \"expected\": [\n+      { \"event\": \"text\", \"data\": [\"<12>text\"] },\n+      { \"event\": \"comment\", \"data\": [\"12\"] },\n+      { \"event\": \"commentend\", \"data\": [] }\n+  ]\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Alinto/sogo/commits/21468700718ed71774eaf2979ee59330fc569424",
        "url": "https://api.github.com/repos/Alinto/sogo/commits/21468700718ed71774eaf2979ee59330fc569424",
        "html_url": "https://github.com/Alinto/sogo/commit/21468700718ed71774eaf2979ee59330fc569424",
        "message": "fix(mail): Fix security @import css injection",
        "files": [
            {
                "sha": "d5b77c62d8cafc7bccba55ddc015b4ba0ac411df",
                "filename": "SoObjects/SOGo/NSString+Utilities.m",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/Alinto/sogo/blob/21468700718ed71774eaf2979ee59330fc569424/SoObjects%2FSOGo%2FNSString%2BUtilities.m",
                "raw_url": "https://github.com/Alinto/sogo/raw/21468700718ed71774eaf2979ee59330fc569424/SoObjects%2FSOGo%2FNSString%2BUtilities.m",
                "contents_url": "https://api.github.com/repos/Alinto/sogo/contents/SoObjects%2FSOGo%2FNSString%2BUtilities.m?ref=21468700718ed71774eaf2979ee59330fc569424",
                "patch": "@@ -1014,6 +1014,15 @@ - (NSString *) stringWithoutHTMLInjection: (BOOL)stripHTMLCode\n                                   options: NSRegularExpressionCaseInsensitive error:&error];\n       newResult = [regex stringByReplacingMatchesInString:result options:0 range:NSMakeRange(0, [result length]) withTemplate:@\"onmouseo***=\"];\n       result = [NSString stringWithString: newResult];\n+\n+      // Remove @import css (in style tags)\n+      regex = [NSRegularExpression regularExpressionWithPattern:@\"(<[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*s[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*t[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*y[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*l[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*e.*)([\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*@[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*i[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*m[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*p[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*o[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*r[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*t)(.*<[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*\\\\/[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*s[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*t[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*y[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*l[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*e[\\\\s\\\\u200B&#x09;&#x0A;&#x0D;\\\\\\\\0]*>)\" \n+                                  options: NSRegularExpressionCaseInsensitive error:&error];\n+      newResult = result;\n+      while([regex numberOfMatchesInString:newResult options:0 range:NSMakeRange(0, [newResult length])] > 0) {\n+        newResult = [regex stringByReplacingMatchesInString:newResult options:0 range:NSMakeRange(0, [newResult length]) withTemplate:@\"$1@im****$3\"];\n+      }\n+      result = [NSString stringWithString: newResult];\n     }\n   }  \n   NS_HANDLER"
            },
            {
                "sha": "d1384932e21afce7aa854672901aeb46458b58b8",
                "filename": "Tests/Unit/TestNSString+Utilities.m",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Alinto/sogo/blob/21468700718ed71774eaf2979ee59330fc569424/Tests%2FUnit%2FTestNSString%2BUtilities.m",
                "raw_url": "https://github.com/Alinto/sogo/raw/21468700718ed71774eaf2979ee59330fc569424/Tests%2FUnit%2FTestNSString%2BUtilities.m",
                "contents_url": "https://api.github.com/repos/Alinto/sogo/contents/Tests%2FUnit%2FTestNSString%2BUtilities.m?ref=21468700718ed71774eaf2979ee59330fc569424",
                "patch": "@@ -109,6 +109,7 @@ - (void) test_stringWithoutHTMLInjection\n   testEquals([[NSString stringWithString:@\"foobar <iframe src=\\\"\\\">bar</iframe>\"] stringWithoutHTMLInjection: NO], @\"foobar <ifr*** src=\\\"\\\">bar</iframe>\");\n   testEquals([[NSString stringWithString:@\"foobar <img onload=foo bar\"] stringWithoutHTMLInjection: NO], @\"foobar <img onl***=foo bar\");\n   testEquals([[NSString stringWithString:@\"foobar <img onmouseover=foo bar\"] stringWithoutHTMLInjection: NO], @\"foobar <img onmouseo***=foo bar\");\n+  testEquals([[NSString stringWithString:@\"<!DOCTYPE html><html><head><style>@import url(https://foo.bar/malicious.css);.foo{background-color: red; @import url(https://bar.foo/malicious2.css);</style></head><body><table><tr><td>A</td><td>B</td><td>C</td></tr></table></body></html>\"] stringWithoutHTMLInjection: NO], @\"<!DOCTYPE html><html><head><style>@im**** url(https://foo.bar/malicious.css);.foo{background-color: red; @im**** url(https://bar.foo/malicious2.css);</style></head><body><table><tr><td>A</td><td>B</td><td>C</td></tr></table></body></html>\");\n }\n \n - (void) test_stringCleanInvalidHTMLTags"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/gouniverse/cms/commits/3e661cdfb4beeb9fe2ad507cdb8104c0b17d072c",
        "url": "https://api.github.com/repos/gouniverse/cms/commits/3e661cdfb4beeb9fe2ad507cdb8104c0b17d072c",
        "html_url": "https://github.com/gouniverse/cms/commit/3e661cdfb4beeb9fe2ad507cdb8104c0b17d072c",
        "message": "fix potential XSS vulnerability",
        "files": [
            {
                "sha": "9f51dbecd9549e255aaa9806d7172bf9260b7a28",
                "filename": "PageBuildHtml.go",
                "status": "modified",
                "additions": 15,
                "deletions": 8,
                "changes": 23,
                "blob_url": "https://github.com/gouniverse/cms/blob/3e661cdfb4beeb9fe2ad507cdb8104c0b17d072c/PageBuildHtml.go",
                "raw_url": "https://github.com/gouniverse/cms/raw/3e661cdfb4beeb9fe2ad507cdb8104c0b17d072c/PageBuildHtml.go",
                "contents_url": "https://api.github.com/repos/gouniverse/cms/contents/PageBuildHtml.go?ref=3e661cdfb4beeb9fe2ad507cdb8104c0b17d072c",
                "patch": "@@ -4,6 +4,7 @@ import (\n \t\"net/http\"\n \t\"strings\"\n \n+\t\"github.com/gouniverse/hb\"\n \t\"github.com/samber/lo\"\n )\n \n@@ -12,18 +13,24 @@ func (cms *Cms) PageRenderHtmlByAlias(r *http.Request, alias string, language st\n \tpage, err := cms.PageFindByAlias(alias)\n \n \tif err != nil {\n-\t\tcms.LogStore.ErrorWithContext(\"At pageBuldHTMLByAlias\", err.Error())\n-\t\treturn \"Page with alias '\" + alias + \"' not found\"\n+\t\tcms.LogStore.ErrorWithContext(\"At PageRenderHtmlByAlias\", err.Error())\n+\t\treturn hb.NewDiv().\n+\t\t\tText(`Page with alias '`).Text(alias).Text(`' not found`).\n+\t\t\tToHTML()\n \t}\n \n \tif page == nil {\n-\t\treturn \"Page with alias '\" + alias + \"' not found\"\n+\t\treturn hb.NewDiv().\n+\t\t\tText(`Page with alias '`).Text(alias).Text(`' not found`).\n+\t\t\tToHTML()\n \t}\n \n \tpageAttrs, err := page.GetAttributes()\n \n \tif err != nil {\n-\t\treturn \"Page '\" + alias + \"' io exception\"\n+\t\treturn hb.NewDiv().\n+\t\t\tText(`Page with alias '`).Text(alias).Text(`' io exception`).\n+\t\t\tToHTML()\n \t}\n \n \tpageContent := \"\"\n@@ -60,7 +67,7 @@ func (cms *Cms) PageRenderHtmlByAlias(r *http.Request, alias string, language st\n \tfinalContent := lo.If(pageTemplateID == \"\", pageContent).ElseF(func() string {\n \t\tcontent, err := cms.TemplateContentFindByID(pageTemplateID)\n \t\tif err != nil {\n-\t\t\tcms.LogStore.ErrorWithContext(\"At pageBuldHTMLByAlias\", err.Error())\n+\t\t\tcms.LogStore.ErrorWithContext(\"At PageRenderHtmlByAlias\", err.Error())\n \t\t}\n \t\treturn content\n \t})\n@@ -82,19 +89,19 @@ func (cms *Cms) PageRenderHtmlByAlias(r *http.Request, alias string, language st\n \tfinalContent, err = cms.ContentRenderBlocks(finalContent)\n \n \tif err != nil {\n-\t\tcms.LogStore.ErrorWithContext(\"At pageBuldHTMLByAlias\", err.Error())\n+\t\tcms.LogStore.ErrorWithContext(\"At PageRenderHtmlByAlias\", err.Error())\n \t}\n \n \tfinalContent, err = cms.ContentRenderShortcodes(r, finalContent)\n \n \tif err != nil {\n-\t\tcms.LogStore.ErrorWithContext(\"At pageBuldHTMLByAlias\", err.Error())\n+\t\tcms.LogStore.ErrorWithContext(\"At PageRenderHtmlByAlias\", err.Error())\n \t}\n \n \tfinalContent, err = cms.ContentRenderTranslations(finalContent, language)\n \n \tif err != nil {\n-\t\tcms.LogStore.ErrorWithContext(\"At pageBuldHTMLByAlias\", err.Error())\n+\t\tcms.LogStore.ErrorWithContext(\"At PageRenderHtmlByAlias\", err.Error())\n \t}\n \n \treturn finalContent"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nodejs/node/commits/54cd268059626800dbe1e02a88b28d9538cf5587",
        "url": "https://api.github.com/repos/nodejs/node/commits/54cd268059626800dbe1e02a88b28d9538cf5587",
        "html_url": "https://github.com/nodejs/node/commit/54cd268059626800dbe1e02a88b28d9538cf5587",
        "message": "crypto: disable PKCS#1 padding for privateDecrypt\n\nRefs: https://hackerone.com/bugs?subject=nodejs&report_id=2269177\n\nDisable RSA_PKCS1_PADDING for crypto.privateDecrypt() in order\nto protect against the Marvin attack.\n\nIncludes a security revert flag that can be used to restore\nsupport.\n\nSigned-off-by: Michael Dawson <midawson@redhat.com>\nPR-URL: https://github.com/nodejs-private/node-private/pull/525\nRefs: https://hackerone.com/bugs?subject=nodejs&report_id=2269177\nReviewed-By: Rafael Gonzaga <rafael.nunu@hotmail.com>\nCVE-ID: CVE-2023-46809",
        "files": [
            {
                "sha": "8cc2b1786c98b90557d29cf92f9cef933025646c",
                "filename": "src/crypto/crypto_cipher.cc",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/nodejs/node/blob/54cd268059626800dbe1e02a88b28d9538cf5587/src%2Fcrypto%2Fcrypto_cipher.cc",
                "raw_url": "https://github.com/nodejs/node/raw/54cd268059626800dbe1e02a88b28d9538cf5587/src%2Fcrypto%2Fcrypto_cipher.cc",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fcrypto%2Fcrypto_cipher.cc?ref=54cd268059626800dbe1e02a88b28d9538cf5587",
                "patch": "@@ -1043,6 +1043,32 @@ void PublicKeyCipher::Cipher(const FunctionCallbackInfo<Value>& args) {\n   uint32_t padding;\n   if (!args[offset + 1]->Uint32Value(env->context()).To(&padding)) return;\n \n+  if (EVP_PKEY_cipher == EVP_PKEY_decrypt &&\n+      operation == PublicKeyCipher::kPrivate && padding == RSA_PKCS1_PADDING) {\n+    EVPKeyCtxPointer ctx(EVP_PKEY_CTX_new(pkey.get(), nullptr));\n+    CHECK(ctx);\n+\n+    if (EVP_PKEY_decrypt_init(ctx.get()) <= 0) {\n+      return ThrowCryptoError(env, ERR_get_error());\n+    }\n+\n+    int rsa_pkcs1_implicit_rejection =\n+        EVP_PKEY_CTX_ctrl_str(ctx.get(), \"rsa_pkcs1_implicit_rejection\", \"1\");\n+    // From the doc -2 means that the option is not supported.\n+    // The default for the option is enabled and if it has been\n+    // specifically disabled we want to respect that so we will\n+    // not throw an error if the option is supported regardless\n+    // of how it is set. The call to set the value\n+    // will not affect what is used since a different context is\n+    // used in the call if the option is supported\n+    if (rsa_pkcs1_implicit_rejection <= 0) {\n+      return THROW_ERR_INVALID_ARG_VALUE(\n+          env,\n+          \"RSA_PKCS1_PADDING is no longer supported for private decryption,\"\n+          \" this can be reverted with --security-revert=CVE-2024-PEND\");\n+    }\n+  }\n+\n   const EVP_MD* digest = nullptr;\n   if (args[offset + 2]->IsString()) {\n     const Utf8Value oaep_str(env->isolate(), args[offset + 2]);"
            },
            {
                "sha": "438037acc867c2bd6e34ffdcd1e706f8d0ff6a57",
                "filename": "test/parallel/test-crypto-rsa-dsa.js",
                "status": "modified",
                "additions": 30,
                "deletions": 12,
                "changes": 42,
                "blob_url": "https://github.com/nodejs/node/blob/54cd268059626800dbe1e02a88b28d9538cf5587/test%2Fparallel%2Ftest-crypto-rsa-dsa.js",
                "raw_url": "https://github.com/nodejs/node/raw/54cd268059626800dbe1e02a88b28d9538cf5587/test%2Fparallel%2Ftest-crypto-rsa-dsa.js",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-rsa-dsa.js?ref=54cd268059626800dbe1e02a88b28d9538cf5587",
                "patch": "@@ -221,19 +221,37 @@ function test_rsa(padding, encryptOaepHash, decryptOaepHash) {\n     oaepHash: encryptOaepHash\n   }, bufferToEncrypt);\n \n-  let decryptedBuffer = crypto.privateDecrypt({\n-    key: rsaKeyPem,\n-    padding: padding,\n-    oaepHash: decryptOaepHash\n-  }, encryptedBuffer);\n-  assert.deepStrictEqual(decryptedBuffer, input);\n \n-  decryptedBuffer = crypto.privateDecrypt({\n-    key: rsaPkcs8KeyPem,\n-    padding: padding,\n-    oaepHash: decryptOaepHash\n-  }, encryptedBuffer);\n-  assert.deepStrictEqual(decryptedBuffer, input);\n+  if (padding === constants.RSA_PKCS1_PADDING) {\n+    assert.throws(() => {\n+      crypto.privateDecrypt({\n+        key: rsaKeyPem,\n+        padding: padding,\n+        oaepHash: decryptOaepHash\n+      }, encryptedBuffer);\n+    }, { code: 'ERR_INVALID_ARG_VALUE' });\n+    assert.throws(() => {\n+      crypto.privateDecrypt({\n+        key: rsaPkcs8KeyPem,\n+        padding: padding,\n+        oaepHash: decryptOaepHash\n+      }, encryptedBuffer);\n+    }, { code: 'ERR_INVALID_ARG_VALUE' });\n+  } else {\n+    let decryptedBuffer = crypto.privateDecrypt({\n+      key: rsaKeyPem,\n+      padding: padding,\n+      oaepHash: decryptOaepHash\n+    }, encryptedBuffer);\n+    assert.deepStrictEqual(decryptedBuffer, input);\n+\n+    decryptedBuffer = crypto.privateDecrypt({\n+      key: rsaPkcs8KeyPem,\n+      padding: padding,\n+      oaepHash: decryptOaepHash\n+    }, encryptedBuffer);\n+    assert.deepStrictEqual(decryptedBuffer, input);\n+  }\n }\n \n test_rsa('RSA_NO_PADDING');"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nodejs/node/commits/39f207023a0f3d4cf3d54f2983da5f775d22e8ca",
        "url": "https://api.github.com/repos/nodejs/node/commits/39f207023a0f3d4cf3d54f2983da5f775d22e8ca",
        "html_url": "https://github.com/nodejs/node/commit/39f207023a0f3d4cf3d54f2983da5f775d22e8ca",
        "message": "src: handle permissive extension on cmd check\n\nPR-URL: https://github.com/nodejs-private/node-private/pull/596\nReviewed-By: Michael Dawson <midawson@redhat.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nCVE-ID: CVE-2024-36138",
        "files": [
            {
                "sha": "86e6aaaec9c74a51f4863c2c2f9c1ee6fc859ddc",
                "filename": "src/util-inl.h",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/nodejs/node/blob/39f207023a0f3d4cf3d54f2983da5f775d22e8ca/src%2Futil-inl.h",
                "raw_url": "https://github.com/nodejs/node/raw/39f207023a0f3d4cf3d54f2983da5f775d22e8ca/src%2Futil-inl.h",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Futil-inl.h?ref=39f207023a0f3d4cf3d54f2983da5f775d22e8ca",
                "patch": "@@ -27,6 +27,7 @@\n #include <cmath>\n #include <cstring>\n #include <locale>\n+#include <regex>  // NOLINT(build/c++11)\n #include \"node_revert.h\"\n #include \"util.h\"\n \n@@ -543,9 +544,20 @@ bool IsWindowsBatchFile(const char* filename) {\n #else\n   static constexpr bool kIsWindows = false;\n #endif  // _WIN32\n-  if (kIsWindows)\n-    if (const char* p = strrchr(filename, '.'))\n-      return StringEqualNoCase(p, \".bat\") || StringEqualNoCase(p, \".cmd\");\n+  if (kIsWindows) {\n+    std::string file_with_extension = filename;\n+    // Regex to match the last extension part after the last dot, ignoring\n+    // trailing spaces and dots\n+    std::regex extension_regex(R\"(\\.([a-zA-Z0-9]+)\\s*[\\.\\s]*$)\");\n+    std::smatch match;\n+    std::string extension;\n+\n+    if (std::regex_search(file_with_extension, match, extension_regex)) {\n+      extension = ToLower(match[1].str());\n+    }\n+\n+    return !extension.empty() && (extension == \"cmd\" || extension == \"bat\");\n+  }\n   return false;\n }\n "
            },
            {
                "sha": "4d3057436063d091e816b84db861d321d77188a5",
                "filename": "test/parallel/test-child-process-spawn-windows-batch-file.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/nodejs/node/blob/39f207023a0f3d4cf3d54f2983da5f775d22e8ca/test%2Fparallel%2Ftest-child-process-spawn-windows-batch-file.js",
                "raw_url": "https://github.com/nodejs/node/raw/39f207023a0f3d4cf3d54f2983da5f775d22e8ca/test%2Fparallel%2Ftest-child-process-spawn-windows-batch-file.js",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-child-process-spawn-windows-batch-file.js?ref=39f207023a0f3d4cf3d54f2983da5f775d22e8ca",
                "patch": "@@ -23,8 +23,8 @@ const expectedCode = isWindows ? 'EINVAL' : 'ENOENT';\n const expectedStatus = isWindows ? 1 : 127;\n \n const suffixes =\n-    'BAT bAT BaT baT BAt bAt Bat bat CMD cMD CmD cmD CMd cMd Cmd cmd'\n-    .split(' ');\n+    'BAT|bAT|BaT|baT|BAt|bAt|Bat|bat|CMD|cMD|CmD|cmD|CMd|cMd|Cmd|cmd|cmd |cmd .|cmd ....'\n+    .split('|');\n \n function testExec(filename) {\n   return new Promise((resolve) => {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nodejs/node/commits/34d92ed88c814e05b4b619705c67b3df3999c52d",
        "url": "https://api.github.com/repos/nodejs/node/commits/34d92ed88c814e05b4b619705c67b3df3999c52d",
        "html_url": "https://github.com/nodejs/node/commit/34d92ed88c814e05b4b619705c67b3df3999c52d",
        "message": "src,permission: restrict inspector when pm enabled\n\nPR-URL: https://github.com/nodejs-private/node-private/pull/410\nRefs: https://hackerone.com/bugs?subject=nodejs&report_id=1962701\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nCVE-ID: CVE-2023-30587",
        "files": [
            {
                "sha": "2c50c4fbabfb55c8b580286cea2b59d78aa28633",
                "filename": "doc/api/permissions.md",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/doc%2Fapi%2Fpermissions.md",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/doc%2Fapi%2Fpermissions.md",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fpermissions.md?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -466,7 +466,8 @@ flag.\n \n When starting Node.js with `--experimental-permission`,\n the ability to access the file system through the `fs` module, spawn processes,\n-and use `node:worker_threads` will be restricted.\n+use `node:worker_threads` and enable the runtime inspector\n+will be restricted.\n \n ```console\n $ node --experimental-permission index.js"
            },
            {
                "sha": "218f1b834b108d310a0674622a78a8372ba5135f",
                "filename": "node.gyp",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/node.gyp",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/node.gyp",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -139,6 +139,7 @@\n       'src/node_zlib.cc',\n       'src/permission/child_process_permission.cc',\n       'src/permission/fs_permission.cc',\n+      'src/permission/inspector_permission.cc',\n       'src/permission/permission.cc',\n       'src/permission/worker_permission.cc',\n       'src/pipe_wrap.cc',\n@@ -258,6 +259,7 @@\n       'src/node_worker.h',\n       'src/permission/child_process_permission.h',\n       'src/permission/fs_permission.h',\n+      'src/permission/inspector_permission.h',\n       'src/permission/permission.h',\n       'src/permission/worker_permission.h',\n       'src/pipe_wrap.h',"
            },
            {
                "sha": "a62b8ef48b9d8523e896561de0679cd1dd209c9e",
                "filename": "src/env.cc",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fenv.cc",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fenv.cc",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.cc?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -806,9 +806,12 @@ Environment::Environment(IsolateData* isolate_data,\n   if (options_->experimental_permission) {\n     permission()->EnablePermissions();\n     // If any permission is set the process shouldn't be able to neither\n-    // spawn/worker nor use addons unless explicitly allowed by the user\n+    // spawn/worker nor use addons or enable inspector\n+    // unless explicitly allowed by the user\n     if (!options_->allow_fs_read.empty() || !options_->allow_fs_write.empty()) {\n       options_->allow_native_addons = false;\n+      flags_ = flags_ | EnvironmentFlags::kNoCreateInspector;\n+      permission()->Apply(\"*\", permission::PermissionScope::kInspector);\n       if (!options_->allow_child_process) {\n         permission()->Apply(\"*\", permission::PermissionScope::kChildProcess);\n       }"
            },
            {
                "sha": "fe1e573242f6e20910349a59e3262ad94e48fc07",
                "filename": "src/inspector_agent.cc",
                "status": "modified",
                "additions": 27,
                "deletions": 1,
                "changes": 28,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Finspector_agent.cc",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Finspector_agent.cc",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector_agent.cc?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -14,8 +14,9 @@\n #include \"node_options-inl.h\"\n #include \"node_process-inl.h\"\n #include \"node_url.h\"\n-#include \"util-inl.h\"\n+#include \"permission/permission.h\"\n #include \"timer_wrap-inl.h\"\n+#include \"util-inl.h\"\n #include \"v8-inspector.h\"\n #include \"v8-platform.h\"\n \n@@ -755,6 +756,10 @@ bool Agent::StartIoThread() {\n   if (io_ != nullptr)\n     return true;\n \n+  THROW_IF_INSUFFICIENT_PERMISSIONS(parent_env_,\n+                                    permission::PermissionScope::kInspector,\n+                                    \"StartIoThread\",\n+                                    false);\n   if (!parent_env_->should_create_inspector() && !client_) {\n     ThrowUninitializedInspectorError(parent_env_);\n     return false;\n@@ -780,6 +785,10 @@ void Agent::Stop() {\n std::unique_ptr<InspectorSession> Agent::Connect(\n     std::unique_ptr<InspectorSessionDelegate> delegate,\n     bool prevent_shutdown) {\n+  THROW_IF_INSUFFICIENT_PERMISSIONS(parent_env_,\n+                                    permission::PermissionScope::kInspector,\n+                                    \"Connect\",\n+                                    std::unique_ptr<InspectorSession>{});\n   if (!parent_env_->should_create_inspector() && !client_) {\n     ThrowUninitializedInspectorError(parent_env_);\n     return std::unique_ptr<InspectorSession>{};\n@@ -796,6 +805,10 @@ std::unique_ptr<InspectorSession> Agent::Connect(\n std::unique_ptr<InspectorSession> Agent::ConnectToMainThread(\n     std::unique_ptr<InspectorSessionDelegate> delegate,\n     bool prevent_shutdown) {\n+  THROW_IF_INSUFFICIENT_PERMISSIONS(parent_env_,\n+                                    permission::PermissionScope::kInspector,\n+                                    \"ConnectToMainThread\",\n+                                    std::unique_ptr<InspectorSession>{});\n   if (!parent_env_->should_create_inspector() && !client_) {\n     ThrowUninitializedInspectorError(parent_env_);\n     return std::unique_ptr<InspectorSession>{};\n@@ -810,6 +823,9 @@ std::unique_ptr<InspectorSession> Agent::ConnectToMainThread(\n }\n \n void Agent::WaitForDisconnect() {\n+  THROW_IF_INSUFFICIENT_PERMISSIONS(parent_env_,\n+                                    permission::PermissionScope::kInspector,\n+                                    \"WaitForDisconnect\");\n   if (!parent_env_->should_create_inspector() && !client_) {\n     ThrowUninitializedInspectorError(parent_env_);\n     return;\n@@ -963,6 +979,10 @@ void Agent::SetParentHandle(\n \n std::unique_ptr<ParentInspectorHandle> Agent::GetParentHandle(\n     uint64_t thread_id, const std::string& url, const std::string& name) {\n+  THROW_IF_INSUFFICIENT_PERMISSIONS(parent_env_,\n+                                    permission::PermissionScope::kInspector,\n+                                    \"GetParentHandle\",\n+                                    std::unique_ptr<ParentInspectorHandle>{});\n   if (!parent_env_->should_create_inspector() && !client_) {\n     ThrowUninitializedInspectorError(parent_env_);\n     return std::unique_ptr<ParentInspectorHandle>{};\n@@ -977,6 +997,8 @@ std::unique_ptr<ParentInspectorHandle> Agent::GetParentHandle(\n }\n \n void Agent::WaitForConnect() {\n+  THROW_IF_INSUFFICIENT_PERMISSIONS(\n+      parent_env_, permission::PermissionScope::kInspector, \"WaitForConnect\");\n   if (!parent_env_->should_create_inspector() && !client_) {\n     ThrowUninitializedInspectorError(parent_env_);\n     return;\n@@ -987,6 +1009,10 @@ void Agent::WaitForConnect() {\n }\n \n std::shared_ptr<WorkerManager> Agent::GetWorkerManager() {\n+  THROW_IF_INSUFFICIENT_PERMISSIONS(parent_env_,\n+                                    permission::PermissionScope::kInspector,\n+                                    \"GetWorkerManager\",\n+                                    std::unique_ptr<WorkerManager>{});\n   if (!parent_env_->should_create_inspector() && !client_) {\n     ThrowUninitializedInspectorError(parent_env_);\n     return std::unique_ptr<WorkerManager>{};"
            },
            {
                "sha": "478e80be505bca801574b780e19eff5a59eb07de",
                "filename": "src/node_worker.cc",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fnode_worker.cc",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fnode_worker.cc",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_worker.cc?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -85,8 +85,13 @@ Worker::Worker(Environment* env,\n                 Number::New(env->isolate(), static_cast<double>(thread_id_.id)))\n       .Check();\n \n-  inspector_parent_handle_ =\n-      GetInspectorParentHandle(env, thread_id_, url.c_str(), name.c_str());\n+  // Without this check, to use the permission model with\n+  // workers (--allow-worker) one would need to pass --allow-inspector as well\n+  if (env->permission()->is_granted(\n+          node::permission::PermissionScope::kInspector)) {\n+    inspector_parent_handle_ =\n+        GetInspectorParentHandle(env, thread_id_, url.c_str(), name.c_str());\n+  }\n \n   argv_ = std::vector<std::string>{env->argv()[0]};\n   // Mark this Worker object as weak until we actually start the thread."
            },
            {
                "sha": "3cff03433b4225bdd0320166ab47550adb26cc0f",
                "filename": "src/permission/inspector_permission.cc",
                "status": "added",
                "additions": 22,
                "deletions": 0,
                "changes": 22,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Finspector_permission.cc",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Finspector_permission.cc",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fpermission%2Finspector_permission.cc?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -0,0 +1,22 @@\n+#include \"inspector_permission.h\"\n+\n+#include <string>\n+\n+namespace node {\n+\n+namespace permission {\n+\n+// Currently, Inspector manage a single state\n+// Once denied, it's always denied\n+void InspectorPermission::Apply(const std::string& allow,\n+                                PermissionScope scope) {\n+  deny_all_ = true;\n+}\n+\n+bool InspectorPermission::is_granted(PermissionScope perm,\n+                                     const std::string_view& param) {\n+  return deny_all_ == false;\n+}\n+\n+}  // namespace permission\n+}  // namespace node"
            },
            {
                "sha": "33eb25732c0d4dbadebd1865a02da887645b08b8",
                "filename": "src/permission/inspector_permission.h",
                "status": "added",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Finspector_permission.h",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Finspector_permission.h",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fpermission%2Finspector_permission.h?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -0,0 +1,28 @@\n+#ifndef SRC_PERMISSION_INSPECTOR_PERMISSION_H_\n+#define SRC_PERMISSION_INSPECTOR_PERMISSION_H_\n+\n+#if defined(NODE_WANT_INTERNALS) && NODE_WANT_INTERNALS\n+\n+#include <string>\n+#include \"permission/permission_base.h\"\n+\n+namespace node {\n+\n+namespace permission {\n+\n+class InspectorPermission final : public PermissionBase {\n+ public:\n+  void Apply(const std::string& allow, PermissionScope scope) override;\n+  bool is_granted(PermissionScope perm,\n+                  const std::string_view& param = \"\") override;\n+\n+ private:\n+  bool deny_all_;\n+};\n+\n+}  // namespace permission\n+\n+}  // namespace node\n+\n+#endif  // defined(NODE_WANT_INTERNALS) && NODE_WANT_INTERNALS\n+#endif  // SRC_PERMISSION_INSPECTOR_PERMISSION_H_"
            },
            {
                "sha": "38767e46093f0b2a744b8fff528963b66931af35",
                "filename": "src/permission/permission.cc",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Fpermission.cc",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Fpermission.cc",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fpermission%2Fpermission.cc?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -79,6 +79,8 @@ Permission::Permission() : enabled_(false) {\n       std::make_shared<ChildProcessPermission>();\n   std::shared_ptr<PermissionBase> worker_t =\n       std::make_shared<WorkerPermission>();\n+  std::shared_ptr<PermissionBase> inspector =\n+      std::make_shared<InspectorPermission>();\n #define V(Name, _, __)                                                         \\\n   nodes_.insert(std::make_pair(PermissionScope::k##Name, fs));\n   FILESYSTEM_PERMISSIONS(V)\n@@ -91,6 +93,10 @@ Permission::Permission() : enabled_(false) {\n   nodes_.insert(std::make_pair(PermissionScope::k##Name, worker_t));\n   WORKER_THREADS_PERMISSIONS(V)\n #undef V\n+#define V(Name, _, __)                                                         \\\n+  nodes_.insert(std::make_pair(PermissionScope::k##Name, inspector));\n+  INSPECTOR_PERMISSIONS(V)\n+#undef V\n }\n \n void Permission::ThrowAccessDenied(Environment* env,"
            },
            {
                "sha": "3252e8d540d30614617def45fbbdcbef8801c7d7",
                "filename": "src/permission/permission.h",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Fpermission.h",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Fpermission.h",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fpermission%2Fpermission.h?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -7,6 +7,7 @@\n #include \"node_options.h\"\n #include \"permission/child_process_permission.h\"\n #include \"permission/fs_permission.h\"\n+#include \"permission/inspector_permission.h\"\n #include \"permission/permission_base.h\"\n #include \"permission/worker_permission.h\"\n #include \"v8.h\""
            },
            {
                "sha": "c4728e40ce8f2c270f6f8b6ba0567f6804459b03",
                "filename": "src/permission/permission_base.h",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Fpermission_base.h",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/src%2Fpermission%2Fpermission_base.h",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fpermission%2Fpermission_base.h?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -22,10 +22,13 @@ namespace permission {\n #define WORKER_THREADS_PERMISSIONS(V)                                          \\\n   V(WorkerThreads, \"worker\", PermissionsRoot)\n \n+#define INSPECTOR_PERMISSIONS(V) V(Inspector, \"inspector\", PermissionsRoot)\n+\n #define PERMISSIONS(V)                                                         \\\n   FILESYSTEM_PERMISSIONS(V)                                                    \\\n   CHILD_PROCESS_PERMISSIONS(V)                                                 \\\n-  WORKER_THREADS_PERMISSIONS(V)\n+  WORKER_THREADS_PERMISSIONS(V)                                                \\\n+  INSPECTOR_PERMISSIONS(V)\n \n #define V(name, _, __) k##name,\n enum class PermissionScope {"
            },
            {
                "sha": "f9d2ce53639945a19c5cae3e524ecac615401a86",
                "filename": "test/parallel/test-permission-inspector.js",
                "status": "added",
                "additions": 22,
                "deletions": 0,
                "changes": 22,
                "blob_url": "https://github.com/nodejs/node/blob/34d92ed88c814e05b4b619705c67b3df3999c52d/test%2Fparallel%2Ftest-permission-inspector.js",
                "raw_url": "https://github.com/nodejs/node/raw/34d92ed88c814e05b4b619705c67b3df3999c52d/test%2Fparallel%2Ftest-permission-inspector.js",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-permission-inspector.js?ref=34d92ed88c814e05b4b619705c67b3df3999c52d",
                "patch": "@@ -0,0 +1,22 @@\n+// Flags: --experimental-permission --allow-fs-read=*\n+'use strict';\n+\n+const common = require('../common');\n+common.skipIfWorker();\n+common.skipIfInspectorDisabled();\n+\n+const { Session } = require('inspector');\n+const assert = require('assert');\n+\n+if (!common.hasCrypto)\n+  common.skip('no crypto');\n+\n+{\n+  assert.throws(() => {\n+    const session = new Session();\n+    session.connect();\n+  }, common.expectsError({\n+    code: 'ERR_ACCESS_DENIED',\n+    permission: 'Inspector',\n+  }));\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nodejs/node/commits/205f1e643e25648173239b2de885fec430268492",
        "url": "https://api.github.com/repos/nodejs/node/commits/205f1e643e25648173239b2de885fec430268492",
        "html_url": "https://github.com/nodejs/node/commit/205f1e643e25648173239b2de885fec430268492",
        "message": "permission: handle fs path traversal\n\nPR-URL: https://github.com/nodejs-private/node-private/pull/403\nRefs: https://hackerone.com/bugs?subject=nodejs&report_id=1952978\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nCVE-ID: CVE-2023-30584",
        "files": [
            {
                "sha": "763f39af62bbbbb6a980ff07828b00a967a831bd",
                "filename": "lib/internal/fs/utils.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/nodejs/node/blob/205f1e643e25648173239b2de885fec430268492/lib%2Finternal%2Ffs%2Futils.js",
                "raw_url": "https://github.com/nodejs/node/raw/205f1e643e25648173239b2de885fec430268492/lib%2Finternal%2Ffs%2Futils.js",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Futils.js?ref=205f1e643e25648173239b2de885fec430268492",
                "patch": "@@ -709,7 +709,7 @@ const validatePath = hideStackFrames((path, propName = 'path') => {\n // The permission model needs the absolute path for the fs_permission\n function possiblyTransformPath(path) {\n   if (permission.isEnabled()) {\n-    if (typeof path === 'string' && !pathModule.isAbsolute(path)) {\n+    if (typeof path === 'string') {\n       return pathModule.resolve(path);\n     }\n   }"
            },
            {
                "sha": "f17bfade519bfb6231ec1e3a23b699dea9f5ac0a",
                "filename": "lib/internal/process/permission.js",
                "status": "modified",
                "additions": 2,
                "deletions": 4,
                "changes": 6,
                "blob_url": "https://github.com/nodejs/node/blob/205f1e643e25648173239b2de885fec430268492/lib%2Finternal%2Fprocess%2Fpermission.js",
                "raw_url": "https://github.com/nodejs/node/raw/205f1e643e25648173239b2de885fec430268492/lib%2Finternal%2Fprocess%2Fpermission.js",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fpermission.js?ref=205f1e643e25648173239b2de885fec430268492",
                "patch": "@@ -7,7 +7,7 @@ const {\n \n const permission = internalBinding('permission');\n const { validateString } = require('internal/validators');\n-const { isAbsolute, resolve } = require('path');\n+const { resolve } = require('path');\n \n let experimentalPermission;\n \n@@ -26,9 +26,7 @@ module.exports = ObjectFreeze({\n       // TODO: add support for WHATWG URLs and Uint8Arrays.\n       validateString(reference, 'reference');\n       if (StringPrototypeStartsWith(scope, 'fs')) {\n-        if (!isAbsolute(reference)) {\n-          reference = resolve(reference);\n-        }\n+        reference = resolve(reference);\n       }\n     }\n "
            },
            {
                "sha": "7bf1d523dad67489fbb9f9229fa9850424c1c9bf",
                "filename": "test/fixtures/permission/fs-traversal.js",
                "status": "added",
                "additions": 47,
                "deletions": 0,
                "changes": 47,
                "blob_url": "https://github.com/nodejs/node/blob/205f1e643e25648173239b2de885fec430268492/test%2Ffixtures%2Fpermission%2Ffs-traversal.js",
                "raw_url": "https://github.com/nodejs/node/raw/205f1e643e25648173239b2de885fec430268492/test%2Ffixtures%2Fpermission%2Ffs-traversal.js",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fpermission%2Ffs-traversal.js?ref=205f1e643e25648173239b2de885fec430268492",
                "patch": "@@ -0,0 +1,47 @@\n+'use strict'\n+\n+const common = require('../../common');\n+\n+const assert = require('assert');\n+const fs = require('fs');\n+const path = require('path');\n+\n+const blockedFolder = process.env.BLOCKEDFOLDER;\n+const allowedFolder = process.env.ALLOWEDFOLDER;\n+const traversalPath = allowedFolder + '../file.md'\n+\n+{\n+  assert.ok(process.permission.has('fs.read', allowedFolder));\n+  assert.ok(process.permission.has('fs.write', allowedFolder));\n+  assert.ok(!process.permission.has('fs.read', blockedFolder));\n+  assert.ok(!process.permission.has('fs.write', blockedFolder));\n+}\n+\n+{\n+  assert.throws(() => {\n+    fs.writeFile(traversalPath, 'test', (error) => {\n+      assert.ifError(error);\n+    });\n+  }, common.expectsError({\n+    code: 'ERR_ACCESS_DENIED',\n+    permission: 'FileSystemWrite',\n+    resource: path.toNamespacedPath(path.resolve(traversalPath)),\n+  }));\n+}\n+\n+{\n+  assert.throws(() => {\n+    fs.readFile(traversalPath, (error) => {\n+      assert.ifError(error);\n+    });\n+  }, common.expectsError({\n+    code: 'ERR_ACCESS_DENIED',\n+    permission: 'FileSystemRead',\n+    resource: path.toNamespacedPath(path.resolve(traversalPath)),\n+  }));\n+}\n+\n+{\n+  assert.ok(!process.permission.has('fs.read', traversalPath));\n+  assert.ok(!process.permission.has('fs.write', traversalPath));\n+}\n\\ No newline at end of file"
            },
            {
                "sha": "964a0ad0a0e0c26ff5cff5478c48b53a6a9ccbfd",
                "filename": "test/parallel/test-cli-permission-deny-fs.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/nodejs/node/blob/205f1e643e25648173239b2de885fec430268492/test%2Fparallel%2Ftest-cli-permission-deny-fs.js",
                "raw_url": "https://github.com/nodejs/node/raw/205f1e643e25648173239b2de885fec430268492/test%2Fparallel%2Ftest-cli-permission-deny-fs.js",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-cli-permission-deny-fs.js?ref=205f1e643e25648173239b2de885fec430268492",
                "patch": "@@ -27,11 +27,12 @@ const path = require('path');\n }\n \n {\n+  const tmpPath = path.resolve('/tmp/');\n   const { status, stdout } = spawnSync(\n     process.execPath,\n     [\n       '--experimental-permission',\n-      '--allow-fs-write', '/tmp/', '-e',\n+      '--allow-fs-write', tmpPath, '-e',\n       `console.log(process.permission.has(\"fs\"));\n       console.log(process.permission.has(\"fs.read\"));\n       console.log(process.permission.has(\"fs.write\"));"
            },
            {
                "sha": "2b294a4574e2f31ba3fa34f4d126edc3de419b3c",
                "filename": "test/parallel/test-permission-fs-traversal-path.js",
                "status": "added",
                "additions": 51,
                "deletions": 0,
                "changes": 51,
                "blob_url": "https://github.com/nodejs/node/blob/205f1e643e25648173239b2de885fec430268492/test%2Fparallel%2Ftest-permission-fs-traversal-path.js",
                "raw_url": "https://github.com/nodejs/node/raw/205f1e643e25648173239b2de885fec430268492/test%2Fparallel%2Ftest-permission-fs-traversal-path.js",
                "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-permission-fs-traversal-path.js?ref=205f1e643e25648173239b2de885fec430268492",
                "patch": "@@ -0,0 +1,51 @@\n+// Flags: --experimental-permission --allow-fs-read=* --allow-fs-write=* --allow-child-process\n+'use strict';\n+\n+const common = require('../common');\n+common.skipIfWorker();\n+\n+const fixtures = require('../common/fixtures');\n+if (!common.canCreateSymLink())\n+  common.skip('insufficient privileges');\n+if (!common.hasCrypto)\n+  common.skip('no crypto');\n+\n+const assert = require('assert');\n+const fs = require('fs');\n+const { spawnSync } = require('child_process');\n+const path = require('path');\n+const tmpdir = require('../common/tmpdir');\n+\n+const file = fixtures.path('permission', 'fs-traversal.js');\n+const blockedFolder = tmpdir.path;\n+const allowedFolder = path.join(tmpdir.path, 'subdirectory/');\n+const commonPathWildcard = path.join(__filename, '../../common*');\n+\n+{\n+  tmpdir.refresh();\n+  fs.mkdirSync(allowedFolder);\n+}\n+\n+{\n+  const { status, stderr } = spawnSync(\n+    process.execPath,\n+    [\n+      '--experimental-permission',\n+      `--allow-fs-read=${file},${commonPathWildcard},${allowedFolder}`,\n+      `--allow-fs-write=${allowedFolder}`,\n+      file,\n+    ],\n+    {\n+      env: {\n+        ...process.env,\n+        BLOCKEDFOLDER: blockedFolder,\n+        ALLOWEDFOLDER: allowedFolder,\n+      },\n+    }\n+  );\n+  assert.strictEqual(status, 0, stderr.toString());\n+}\n+\n+{\n+  tmpdir.refresh();\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/wavelog/wavelog/commits/b31002cec6b71ab5f738881806bb546430ec692e",
        "url": "https://api.github.com/repos/wavelog/wavelog/commits/b31002cec6b71ab5f738881806bb546430ec692e",
        "html_url": "https://github.com/wavelog/wavelog/commit/b31002cec6b71ab5f738881806bb546430ec692e",
        "message": "Merge pull request #744 from HB9HIL/xss",
        "files": [
            {
                "sha": "a56437e13ef69e3a46e15557d9f8f7e1861c9e2e",
                "filename": "application/controllers/Lookup.php",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/wavelog/wavelog/blob/b31002cec6b71ab5f738881806bb546430ec692e/application%2Fcontrollers%2FLookup.php",
                "raw_url": "https://github.com/wavelog/wavelog/raw/b31002cec6b71ab5f738881806bb546430ec692e/application%2Fcontrollers%2FLookup.php",
                "contents_url": "https://api.github.com/repos/wavelog/wavelog/contents/application%2Fcontrollers%2FLookup.php?ref=b31002cec6b71ab5f738881806bb546430ec692e",
                "patch": "@@ -65,9 +65,7 @@ public function search() {\n \n \tpublic function scp() {\n \t\tsession_write_close();\n-\t\tif($_POST['callsign']) {\n-\t\t\t$uppercase_callsign = strtoupper($_POST['callsign']);\n-\t\t}\n+\t\t$uppercase_callsign = strtoupper($this->input->post('callsign', TRUE) ?? '');\n \n \t\t// SCP results from logbook\n \t\t$this->load->model('logbook_model');"
            },
            {
                "sha": "23821f9d3ceb0932029f0475724226913ab424bc",
                "filename": "application/controllers/Qso.php",
                "status": "modified",
                "additions": 110,
                "deletions": 118,
                "changes": 228,
                "blob_url": "https://github.com/wavelog/wavelog/blob/b31002cec6b71ab5f738881806bb546430ec692e/application%2Fcontrollers%2FQso.php",
                "raw_url": "https://github.com/wavelog/wavelog/raw/b31002cec6b71ab5f738881806bb546430ec692e/application%2Fcontrollers%2FQso.php",
                "contents_url": "https://api.github.com/repos/wavelog/wavelog/contents/application%2Fcontrollers%2FQso.php?ref=b31002cec6b71ab5f738881806bb546430ec692e",
                "patch": "@@ -21,7 +21,7 @@ public function index() {\n         // Getting the live/post mode from GET command\n         // 0 = live\n         // 1 = post (manual)\n-        $get_manual_mode = $this->security->xss_clean($this->input->get('manual'));\n+        $get_manual_mode = $this->input->get('manual', TRUE);\n         if ($get_manual_mode == '0' || $get_manual_mode == '1') {\n             $data['manual_mode'] = $get_manual_mode;\n         } else {\n@@ -116,29 +116,29 @@ public function index() {\n \t\t\t// $qso_data = [\n \t\t\t// 18-Jan-2016 - make php v5.3 friendly!\n \t\t\t$qso_data = array(\n-\t\t\t\t'start_date' => $this->input->post('start_date'),\n-\t\t\t\t'start_time' => $this->input->post('start_time'),\n+\t\t\t\t'start_date' => $this->input->post('start_date', TRUE),\n+\t\t\t\t'start_time' => $this->input->post('start_time', TRUE),\n \t\t\t\t'end_time' => $this->input->post('end_time'),\n \t\t\t\t'time_stamp' => time(),\n-\t\t\t\t'band' => $this->input->post('band'),\n-\t\t\t\t'band_rx' => $this->input->post('band_rx'),\n-\t\t\t\t'freq' => $this->input->post('freq_display'),\n-\t\t\t\t'freq_rx' => $this->input->post('freq_display_rx'),\n-\t\t\t\t'mode' => $this->input->post('mode'),\n-\t\t\t\t'sat_name' => $this->input->post('sat_name'),\n-\t\t\t\t'sat_mode' => $this->input->post('sat_mode'),\n-\t\t\t\t'prop_mode' => $this->input->post('prop_mode'),\n-\t\t\t\t'radio' => $this->input->post('radio'),\n-\t\t\t\t'station_profile_id' => $this->input->post('station_profile'),\n-\t\t\t\t'operator_callsign' => $this->input->post('operator_callsign'),\n-\t\t\t\t'transmit_power' => $this->input->post('transmit_power')\n+\t\t\t\t'band' => $this->input->post('band', TRUE),\n+\t\t\t\t'band_rx' => $this->input->post('band_rx', TRUE),\n+\t\t\t\t'freq' => $this->input->post('freq_display', TRUE),\n+\t\t\t\t'freq_rx' => $this->input->post('freq_display_rx', TRUE),\n+\t\t\t\t'mode' => $this->input->post('mode', TRUE),\n+\t\t\t\t'sat_name' => $this->input->post('sat_name', TRUE),\n+\t\t\t\t'sat_mode' => $this->input->post('sat_mode', TRUE),\n+\t\t\t\t'prop_mode' => $this->input->post('prop_mode', TRUE),\n+\t\t\t\t'radio' => $this->input->post('radio', TRUE),\n+\t\t\t\t'station_profile_id' => $this->input->post('station_profile', TRUE),\n+\t\t\t\t'operator_callsign' => $this->input->post('operator_callsign', TRUE),\n+\t\t\t\t'transmit_power' => $this->input->post('transmit_power', TRUE)\n \t\t\t);\n \t\t\t// ];\n \n \t\t\t$this->session->set_userdata($qso_data);\n \n \t\t\t// If SAT name is set make it session set to sat\n-\t\t\tif($this->input->post('sat_name')) {\n+\t\t\tif($this->input->post('sat_name', TRUE)) {\n \t\t\t\t$this->session->set_userdata('prop_mode', 'SAT');\n \t\t\t}\n \n@@ -216,20 +216,20 @@ function winkeysettings() {\n \n     function cwmacrosave(){\n         // Get the data from the form\n-        $function1_name = xss_clean($this->input->post('function1_name'));\n-        $function1_macro = xss_clean($this->input->post('function1_macro'));\n+        $function1_name = $this->input->post('function1_name', TRUE);\n+        $function1_macro = $this->input->post('function1_macro', TRUE);\n \n-        $function2_name = xss_clean($this->input->post('function2_name'));\n-        $function2_macro = xss_clean($this->input->post('function2_macro'));\n+        $function2_name = $this->input->post('function2_name', TRUE);\n+        $function2_macro = $this->input->post('function2_macro', TRUE);\n \n-        $function3_name = xss_clean($this->input->post('function3_name'));\n-        $function3_macro = xss_clean($this->input->post('function3_macro'));\n+        $function3_name = $this->input->post('function3_name', TRUE);\n+        $function3_macro = $this->input->post('function3_macro', TRUE);\n \n-        $function4_name = xss_clean($this->input->post('function4_name'));\n-        $function4_macro = xss_clean($this->input->post('function4_macro'));\n+        $function4_name = $this->input->post('function4_name', TRUE);\n+        $function4_macro = $this->input->post('function4_macro', TRUE);\n \n-        $function5_name = xss_clean($this->input->post('function5_name'));\n-        $function5_macro = xss_clean($this->input->post('function5_macro'));\n+        $function5_name = $this->input->post('function5_name', TRUE);\n+        $function5_macro = $this->input->post('function5_macro', TRUE);\n \n         $data = [\n             'user_id' => $this->session->userdata('user_id'),\n@@ -279,7 +279,7 @@ function edit_ajax() {\n             $this->session->set_flashdata('notice', 'You\\'re not allowed to do that!'); redirect('dashboard');\n         }\n \n-        $id = str_replace('\"', \"\", $this->input->post(\"id\"));\n+        $id = str_replace('\"', \"\", $this->input->post(\"id\", TRUE));\n         $query = $this->logbook_model->qso_info($id);\n \n         $data['qso'] = $query->row();\n@@ -317,8 +317,8 @@ function qsl_rcvd($id, $method) {\n \t}\n \n     function qsl_rcvd_ajax() {\n-        $id = str_replace('\"', \"\", $this->input->post(\"id\"));\n-        $method = str_replace('\"', \"\", $this->input->post(\"method\"));\n+        $id = str_replace('\"', \"\", $this->input->post(\"id\", TRUE));\n+        $method = str_replace('\"', \"\", $this->input->post(\"method\", TRUE));\n \n         $this->load->model('logbook_model');\n         $this->load->model('user_model');\n@@ -338,8 +338,8 @@ function qsl_rcvd_ajax() {\n     }\n \n     function qsl_sent_ajax() {\n-        $id = str_replace('\"', \"\", $this->input->post(\"id\"));\n-        $method = str_replace('\"', \"\", $this->input->post(\"method\"));\n+        $id = str_replace('\"', \"\", $this->input->post(\"id\", TRUE));\n+        $method = str_replace('\"', \"\", $this->input->post(\"method\", TRUE));\n         \n         $this->load->model('logbook_model');\n         $this->load->model('user_model');\n@@ -359,8 +359,8 @@ function qsl_sent_ajax() {\n     }\n \n     function qsl_requested_ajax() {\n-        $id = str_replace('\"', \"\", $this->input->post(\"id\"));\n-        $method = str_replace('\"', \"\", $this->input->post(\"method\"));\n+        $id = str_replace('\"', \"\", $this->input->post(\"id\", TRUE));\n+        $method = str_replace('\"', \"\", $this->input->post(\"method\", TRUE));\n \n         $this->load->model('logbook_model');\n         $this->load->model('user_model');\n@@ -380,8 +380,8 @@ function qsl_requested_ajax() {\n     }\n \n \tfunction qsl_ignore_ajax() {\n-        $id = str_replace('\"', \"\", $this->input->post(\"id\"));\n-        $method = str_replace('\"', \"\", $this->input->post(\"method\"));\n+        $id = str_replace('\"', \"\", $this->input->post(\"id\", TRUE));\n+        $method = str_replace('\"', \"\", $this->input->post(\"method\", TRUE));\n \n         $this->load->model('logbook_model');\n         $this->load->model('user_model');\n@@ -420,7 +420,7 @@ function delete($id) {\n \n     /* Delete QSO */\n     function delete_ajax() {\n-        $id = str_replace('\"', \"\", $this->input->post(\"id\"));\n+        $id = str_replace('\"', \"\", $this->input->post(\"id\", TRUE));\n \n         $this->load->model('logbook_model');\n \tif ($this->logbook_model->check_qso_is_accessible($id)) {\n@@ -450,10 +450,8 @@ public function get_sota() {\n \t\t$this->load->library('sota');\n \t\t$json = [];\n \n-\t\tif (!empty($this->security->xss_clean($this->input->get(\"query\")))) {\n-\t\t\t$query = $_GET['query'] ?? FALSE;\n-\t\t\t$json = $this->sota->get($query);\n-\t\t}\n+        $query = $this->input->get('query', TRUE) ?? FALSE;\n+        $json = $this->sota->get($query);\n \n \t\theader('Content-Type: application/json');\n \t\techo json_encode($json);\n@@ -462,32 +460,30 @@ public function get_sota() {\n \tpublic function get_wwff() {\n         $json = [];\n \n-        if (!empty($this->security->xss_clean($this->input->get(\"query\")))) {\n-            $query = isset($_GET['query']) ? $_GET['query'] : FALSE;\n-            $wwff = strtoupper($query);\n-\n-            $file = 'updates/wwff.txt';\n-\n-            if (is_readable($file)) {\n-                $lines = file($file, FILE_IGNORE_NEW_LINES);\n-                $input = preg_quote($wwff, '~');\n-                $reg = '~^'. $input .'(.*)$~';\n-                $result = preg_grep($reg, $lines);\n-                $json = [];\n-                $i = 0;\n-                foreach ($result as &$value) {\n-                    // Limit to 100 as to not slowdown browser too much\n-                    if (count($json) <= 100) {\n-                        $json[] = [\"name\"=>$value];\n-                    }\n+        $query = $this->input->get('query', TRUE) ?? FALSE;\n+        $wwff = strtoupper($query);\n+\n+        $file = 'updates/wwff.txt';\n+\n+        if (is_readable($file)) {\n+            $lines = file($file, FILE_IGNORE_NEW_LINES);\n+            $input = preg_quote($wwff, '~');\n+            $reg = '~^'. $input .'(.*)$~';\n+            $result = preg_grep($reg, $lines);\n+            $json = [];\n+            $i = 0;\n+            foreach ($result as &$value) {\n+                // Limit to 100 as to not slowdown browser too much\n+                if (count($json) <= 100) {\n+                    $json[] = [\"name\"=>$value];\n                 }\n+            }\n+        } else {\n+            $src = 'assets/resources/wwff.txt';\n+            if (copy($src, $file)) {\n+                $this->get_wwff();\n             } else {\n-                $src = 'assets/resources/wwff.txt';\n-                if (copy($src, $file)) {\n-                    $this->get_wwff();\n-                } else {\n-                    log_message('error', 'Failed to copy source file ('.$src.') to new location. Check if this path has the right permission: '.$file);\n-                }\n+                log_message('error', 'Failed to copy source file ('.$src.') to new location. Check if this path has the right permission: '.$file);\n             }\n         }\n \n@@ -498,32 +494,30 @@ public function get_wwff() {\n \tpublic function get_pota() {\n         $json = [];\n \n-        if (!empty($this->security->xss_clean($this->input->get(\"query\")))) {\n-            $query = isset($_GET['query']) ? $_GET['query'] : FALSE;\n-            $pota = strtoupper($query);\n-\n-            $file = 'updates/pota.txt';\n-\n-            if (is_readable($file)) {\n-                $lines = file($file, FILE_IGNORE_NEW_LINES);\n-                $input = preg_quote($pota, '~');\n-                $reg = '~^'. $input .'(.*)$~';\n-                $result = preg_grep($reg, $lines);\n-                $json = [];\n-                $i = 0;\n-                foreach ($result as &$value) {\n-                    // Limit to 100 as to not slowdown browser too much\n-                    if (count($json) <= 100) {\n-                        $json[] = [\"name\"=>$value];\n-                    }\n+        $query = $this->input->get('query', TRUE) ?? FALSE;\n+        $pota = strtoupper($query);\n+\n+        $file = 'updates/pota.txt';\n+\n+        if (is_readable($file)) {\n+            $lines = file($file, FILE_IGNORE_NEW_LINES);\n+            $input = preg_quote($pota, '~');\n+            $reg = '~^'. $input .'(.*)$~';\n+            $result = preg_grep($reg, $lines);\n+            $json = [];\n+            $i = 0;\n+            foreach ($result as &$value) {\n+                // Limit to 100 as to not slowdown browser too much\n+                if (count($json) <= 100) {\n+                    $json[] = [\"name\"=>$value];\n                 }\n+            }\n+        } else {\n+            $src = 'assets/resources/pota.txt';\n+            if (copy($src, $file)) {\n+                $this->get_pota();\n             } else {\n-                $src = 'assets/resources/pota.txt';\n-                if (copy($src, $file)) {\n-                    $this->get_pota();\n-                } else {\n-                    log_message('error', 'Failed to copy source file ('.$src.') to new location. Check if this path has the right permission: '.$file);\n-                }\n+                log_message('error', 'Failed to copy source file ('.$src.') to new location. Check if this path has the right permission: '.$file);\n             }\n         }\n \n@@ -537,32 +531,30 @@ public function get_pota() {\n     public function get_dok() {\n         $json = [];\n \n-        if (!empty($this->security->xss_clean($this->input->get(\"query\")))) {\n-            $query = isset($_GET['query']) ? $_GET['query'] : FALSE;\n-            $dok = strtoupper($query);\n-\n-            $file = 'updates/dok.txt';\n-\n-            if (is_readable($file)) {\n-                $lines = file($file, FILE_IGNORE_NEW_LINES);\n-                $input = preg_quote($dok, '~');\n-                $reg = '~^'. $input .'(.*)$~';\n-                $result = preg_grep($reg, $lines);\n-                $json = [];\n-                $i = 0;\n-                foreach ($result as &$value) {\n-                    // Limit to 100 as to not slowdown browser too much\n-                    if (count($json) <= 100) {\n-                        $json[] = [\"name\"=>$value];\n-                    }\n+        $query = $this->input->get('query', TRUE) ?? FALSE;\n+        $dok = strtoupper($query);\n+\n+        $file = 'updates/dok.txt';\n+\n+        if (is_readable($file)) {\n+            $lines = file($file, FILE_IGNORE_NEW_LINES);\n+            $input = preg_quote($dok, '~');\n+            $reg = '~^'. $input .'(.*)$~';\n+            $result = preg_grep($reg, $lines);\n+            $json = [];\n+            $i = 0;\n+            foreach ($result as &$value) {\n+                // Limit to 100 as to not slowdown browser too much\n+                if (count($json) <= 100) {\n+                    $json[] = [\"name\"=>$value];\n                 }\n+            }\n+        } else {\n+            $src = 'assets/resources/dok.txt';\n+            if (copy($src, $file)) {\n+                $this->get_dok();\n             } else {\n-                $src = 'assets/resources/dok.txt';\n-                if (copy($src, $file)) {\n-                    $this->get_dok();\n-                } else {\n-                    log_message('error', 'Failed to copy source file ('.$src.') to new location. Check if this path has the right permission: '.$file);\n-                }\n+                log_message('error', 'Failed to copy source file ('.$src.') to new location. Check if this path has the right permission: '.$file);\n             }\n         }\n \n@@ -573,7 +565,7 @@ public function get_dok() {\n    public function get_sota_info() {\n       $this->load->library('sota');\n \n-      $sota = xss_clean($this->input->post('sota'));\n+      $sota = $this->input->post('sota', TRUE);\n \n       header('Content-Type: application/json');\n       echo $this->sota->info($sota);\n@@ -582,7 +574,7 @@ public function get_sota_info() {\n    public function get_wwff_info() {\n       $this->load->library('wwff');\n \n-      $wwff = xss_clean($this->input->post('wwff'));\n+      $wwff = $this->input->post('wwff', TRUE);\n \n       header('Content-Type: application/json');\n       echo $this->wwff->info($wwff);\n@@ -591,15 +583,15 @@ public function get_wwff_info() {\n    public function get_pota_info() {\n       $this->load->library('pota');\n \n-      $pota = xss_clean($this->input->post('pota'));\n+      $pota = $this->input->post('pota', TRUE);\n \n       header('Content-Type: application/json');\n       echo $this->pota->info($pota);\n    }\n \n    public function get_station_power() {\n       $this->load->model('stations');\n-      $stationProfile = xss_clean($this->input->post('stationProfile'));\n+      $stationProfile = $this->input->post('stationProfile', TRUE);\n       $data = array('station_power' => $this->stations->get_station_power($stationProfile));\n \n       header('Content-Type: application/json');\n@@ -620,7 +612,7 @@ public function component_past_contacts() {\n \n    public function get_eqsl_default_qslmsg() {\t// Get ONLY Default eQSL-Message with this function. This is ONLY for QSO relevant!\n \t   $return_json = array();\n-\t   $option_key = $this->input->post('option_key');\n+\t   $option_key = $this->input->post('option_key', TRUE);\n \t   if ($option_key > 0) {\n \t\t   $options_object = $this->user_options_model->get_options('eqsl_default_qslmsg', array('option_name' => 'key_station_id', 'option_key' => $option_key))->result();\n \t\t   $return_json['eqsl_default_qslmsg'] = (isset($options_object[0]->option_value)) ? $options_object[0]->option_value : '';\n@@ -634,7 +626,7 @@ public function unsupported_lotw_prop_modes() {\n \t}\n \n    function check_locator($grid) {\n-      $grid = $this->input->post('locator');\n+      $grid = $this->input->post('locator', TRUE);\n       // Allow empty locator\n       if (preg_match('/^$/', $grid)) return true;\n       // Allow 6-digit locator"
            },
            {
                "sha": "51c4aeef56970ce8f8bae2b41c406824a2531d8f",
                "filename": "application/controllers/Search.php",
                "status": "modified",
                "additions": 21,
                "deletions": 26,
                "changes": 47,
                "blob_url": "https://github.com/wavelog/wavelog/blob/b31002cec6b71ab5f738881806bb546430ec692e/application%2Fcontrollers%2FSearch.php",
                "raw_url": "https://github.com/wavelog/wavelog/raw/b31002cec6b71ab5f738881806bb546430ec692e/application%2Fcontrollers%2FSearch.php",
                "contents_url": "https://api.github.com/repos/wavelog/wavelog/contents/application%2Fcontrollers%2FSearch.php?ref=b31002cec6b71ab5f738881806bb546430ec692e",
                "patch": "@@ -75,10 +75,8 @@ public function lotw_unconfirmed() {\n \t}\n \n     function json_result() {\n-          if(isset($_POST['search'])) {\n-\t\t\t  $result = $this->fetchQueryResult($_POST['search'], false);\n-\t\t\t  echo json_encode($result->result_array());\n-\t\t  }\n+\t\t$result = $this->fetchQueryResult(($this->input->post('search', TRUE) ?? ''), FALSE);\n+\t\techo json_encode($result->result_array());\n     }\n \n \tfunction get_stored_queries() {\n@@ -88,17 +86,13 @@ function get_stored_queries() {\n \t}\n \n \tfunction search_result() {\n-\t\tif(isset($_POST['search'])) {\n-\t\t\t$data['results'] = $this->fetchQueryResult($_POST['search'], false);\n-\t\t\t$this->load->view('search/search_result_ajax', $data);\n-\t\t}\n+\t\t$data['results'] = $this->fetchQueryResult(($this->input->post('search', TRUE) ?? ''), FALSE);\n+\t\t$this->load->view('search/search_result_ajax', $data);\n \t}\n \n \tfunction export_to_adif() {\n-\t\tif(isset($_POST['search'])) {\n-\t\t\t$data['qsos'] = $this->fetchQueryResult($_POST['search'], false);\n-\t\t\t$this->load->view('adif/data/exportall', $data);\n-\t\t}\n+\t\t$data['qsos'] = $this->fetchQueryResult(($this->input->post('search', TRUE) ?? ''), FALSE);\n+\t\t$this->load->view('adif/data/exportall', $data);\n \t}\n \n \tfunction export_stored_query_to_adif() {\n@@ -122,20 +116,21 @@ function run_query() {\n \t}\n \n \tfunction save_query() {\n-\t\tif(isset($_POST['search'])) {\n-\t\t\t$query = $this->fetchQueryResult($_POST['search'], true);\n-\n-\t\t\t$data = array(\n-\t\t\t\t'userid' => xss_clean($this->session->userdata('user_id')),\n-\t\t\t\t'query' => $query,\n-\t\t\t\t'description' => xss_clean($_POST['description'])\n-\t\t\t);\n-\n-\t\t\t$this->db->insert('queries', $data);\n-\t\t\t$last_id = $this->db->insert_id();\n-\t\t\theader('Content-Type: application/json');\n-\t\t\techo json_encode(array('id' => $last_id, 'description' => xss_clean($_POST['description'])));\n-\t\t}\n+\t\t$search_param = $this->input->post('search', TRUE);\n+\t\t$description = $this->input->post('description', TRUE);\n+\n+\t\t$query = $this->fetchQueryResult($search_param, TRUE);\n+\n+\t\t$data = array(\n+\t\t\t'userid' => xss_clean($this->session->userdata('user_id')),\n+\t\t\t'query' => $query,\n+\t\t\t'description' => $description\n+\t\t);\n+\n+\t\t$this->db->insert('queries', $data);\n+\t\t$last_id = $this->db->insert_id();\n+\t\theader('Content-Type: application/json');\n+\t\techo json_encode(array('id' => $last_id, 'description' => $description));\n \t}\n \n \tfunction delete_query() {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/airflow/commits/03e01e76d2203d37aa645096df195b4328665f6d",
        "url": "https://api.github.com/repos/apache/airflow/commits/03e01e76d2203d37aa645096df195b4328665f6d",
        "html_url": "https://github.com/apache/airflow/commit/03e01e76d2203d37aa645096df195b4328665f6d",
        "message": "Splitting syspath preparation into stages (#41672) (#41694)\n\nCo-authored-by: Amogh Desai <amoghrajesh1999@gmail.com>",
        "files": [
            {
                "sha": "dc24a2c5acc5aad1c5058c7c92bef125ed873001",
                "filename": "airflow/settings.py",
                "status": "modified",
                "additions": 10,
                "deletions": 7,
                "changes": 17,
                "blob_url": "https://github.com/apache/airflow/blob/03e01e76d2203d37aa645096df195b4328665f6d/airflow%2Fsettings.py",
                "raw_url": "https://github.com/apache/airflow/raw/03e01e76d2203d37aa645096df195b4328665f6d/airflow%2Fsettings.py",
                "contents_url": "https://api.github.com/repos/apache/airflow/contents/airflow%2Fsettings.py?ref=03e01e76d2203d37aa645096df195b4328665f6d",
                "patch": "@@ -675,11 +675,8 @@ def configure_action_logging() -> None:\n     \"\"\"Any additional configuration (register callback) for airflow.utils.action_loggers module.\"\"\"\n \n \n-def prepare_syspath():\n-    \"\"\"Ensure certain subfolders of AIRFLOW_HOME are on the classpath.\"\"\"\n-    if DAGS_FOLDER not in sys.path:\n-        sys.path.append(DAGS_FOLDER)\n-\n+def prepare_syspath_for_config_and_plugins():\n+    \"\"\"Update sys.path for the config and plugins directories.\"\"\"\n     # Add ./config/ for loading custom log parsers etc, or\n     # airflow_local_settings etc.\n     config_path = os.path.join(AIRFLOW_HOME, \"config\")\n@@ -690,6 +687,12 @@ def prepare_syspath():\n         sys.path.append(PLUGINS_FOLDER)\n \n \n+def prepare_syspath_for_dags_folder():\n+    \"\"\"Update sys.path to include the DAGs folder.\"\"\"\n+    if DAGS_FOLDER not in sys.path:\n+        sys.path.append(DAGS_FOLDER)\n+\n+\n def get_session_lifetime_config():\n     \"\"\"Get session timeout configs and handle outdated configs gracefully.\"\"\"\n     session_lifetime_minutes = conf.get(\"webserver\", \"session_lifetime_minutes\", fallback=None)\n@@ -771,12 +774,13 @@ def import_local_settings():\n def initialize():\n     \"\"\"Initialize Airflow with all the settings from this file.\"\"\"\n     configure_vars()\n-    prepare_syspath()\n+    prepare_syspath_for_config_and_plugins()\n     configure_policy_plugin_manager()\n     # Load policy plugins _before_ importing airflow_local_settings, as Pluggy uses LIFO and we want anything\n     # in airflow_local_settings to take precendec\n     load_policy_plugins(POLICY_PLUGIN_MANAGER)\n     import_local_settings()\n+    prepare_syspath_for_dags_folder()\n     global LOGGING_CLASS_PATH\n     LOGGING_CLASS_PATH = configure_logging()\n     State.state_color.update(STATE_COLORS)\n@@ -806,7 +810,6 @@ def is_usage_data_collection_enabled() -> bool:\n MEGABYTE = KILOBYTE * KILOBYTE\n WEB_COLORS = {\"LIGHTBLUE\": \"#4d9de0\", \"LIGHTORANGE\": \"#FF9933\"}\n \n-\n # Updating serialized DAG can not be faster than a minimum interval to reduce database\n # write rate.\n MIN_SERIALIZED_DAG_UPDATE_INTERVAL = conf.getint(\"core\", \"min_serialized_dag_update_interval\", fallback=30)"
            },
            {
                "sha": "483ef24e25f7fbe371b7dcd5ab145422789f442a",
                "filename": "tests/core/test_settings.py",
                "status": "modified",
                "additions": 27,
                "deletions": 6,
                "changes": 33,
                "blob_url": "https://github.com/apache/airflow/blob/03e01e76d2203d37aa645096df195b4328665f6d/tests%2Fcore%2Ftest_settings.py",
                "raw_url": "https://github.com/apache/airflow/raw/03e01e76d2203d37aa645096df195b4328665f6d/tests%2Fcore%2Ftest_settings.py",
                "contents_url": "https://api.github.com/repos/apache/airflow/contents/tests%2Fcore%2Ftest_settings.py?ref=03e01e76d2203d37aa645096df195b4328665f6d",
                "patch": "@@ -115,21 +115,42 @@ def teardown_method(self):\n         for mod in [m for m in sys.modules if m not in self.old_modules]:\n             del sys.modules[mod]\n \n+    @mock.patch(\"airflow.settings.prepare_syspath_for_config_and_plugins\")\n     @mock.patch(\"airflow.settings.import_local_settings\")\n-    @mock.patch(\"airflow.settings.prepare_syspath\")\n-    def test_initialize_order(self, prepare_syspath, import_local_settings):\n+    @mock.patch(\"airflow.settings.prepare_syspath_for_dags_folder\")\n+    def test_initialize_order(\n+        self,\n+        mock_prepare_syspath_for_dags_folder,\n+        mock_import_local_settings,\n+        mock_prepare_syspath_for_config_and_plugins,\n+    ):\n         \"\"\"\n-        Tests that import_local_settings is called after prepare_classpath\n+        Tests that import_local_settings is called between prepare_syspath_for_config_and_plugins\n+        and prepare_syspath_for_dags_folder\n         \"\"\"\n         mock_local_settings = mock.Mock()\n-        mock_local_settings.attach_mock(prepare_syspath, \"prepare_syspath\")\n-        mock_local_settings.attach_mock(import_local_settings, \"import_local_settings\")\n+\n+        mock_local_settings.attach_mock(\n+            mock_prepare_syspath_for_config_and_plugins, \"prepare_syspath_for_config_and_plugins\"\n+        )\n+        mock_local_settings.attach_mock(mock_import_local_settings, \"import_local_settings\")\n+        mock_local_settings.attach_mock(\n+            mock_prepare_syspath_for_dags_folder, \"prepare_syspath_for_dags_folder\"\n+        )\n \n         import airflow.settings\n \n         airflow.settings.initialize()\n \n-        mock_local_settings.assert_has_calls([call.prepare_syspath(), call.import_local_settings()])\n+        expected_calls = [\n+            call.prepare_syspath_for_config_and_plugins(),\n+            call.import_local_settings(),\n+            call.prepare_syspath_for_dags_folder(),\n+        ]\n+\n+        mock_local_settings.assert_has_calls(expected_calls)\n+\n+        assert mock_local_settings.mock_calls == expected_calls\n \n     def test_import_with_dunder_all_not_specified(self):\n         \"\"\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/airflow/commits/09ec2616568f8a18e0d5fe408110fae06ddf748f",
        "url": "https://api.github.com/repos/apache/airflow/commits/09ec2616568f8a18e0d5fe408110fae06ddf748f",
        "html_url": "https://github.com/apache/airflow/commit/09ec2616568f8a18e0d5fe408110fae06ddf748f",
        "message": "Adding tojson filter to example_inlet_event_extra example dag (#41873) (#41890)\n\n(cherry picked from commit 87a4a5137519448cfff85fc506b9267ec3e18364)\r\n\r\nCo-authored-by: Amogh Desai <amoghrajesh1999@gmail.com>",
        "files": [
            {
                "sha": "4b7567fc2f87e81bac69ff238abad14137c559a4",
                "filename": "airflow/example_dags/example_inlet_event_extra.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/airflow/blob/09ec2616568f8a18e0d5fe408110fae06ddf748f/airflow%2Fexample_dags%2Fexample_inlet_event_extra.py",
                "raw_url": "https://github.com/apache/airflow/raw/09ec2616568f8a18e0d5fe408110fae06ddf748f/airflow%2Fexample_dags%2Fexample_inlet_event_extra.py",
                "contents_url": "https://api.github.com/repos/apache/airflow/contents/airflow%2Fexample_dags%2Fexample_inlet_event_extra.py?ref=09ec2616568f8a18e0d5fe408110fae06ddf748f",
                "patch": "@@ -57,5 +57,5 @@ def read_dataset_event(*, inlet_events=None):\n     BashOperator(\n         task_id=\"read_dataset_event_from_classic\",\n         inlets=[ds],\n-        bash_command=\"echo {{ inlet_events['s3://output/1.txt'][-1].extra }}\",\n+        bash_command=\"echo '{{ inlet_events['s3://output/1.txt'][-1].extra | tojson }}'\",\n     )"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Byron/gitoxide/commits/650a1b5cf25e086197cc55a68525a411e1c28031",
        "url": "https://api.github.com/repos/GitoxideLabs/gitoxide/commits/650a1b5cf25e086197cc55a68525a411e1c28031",
        "html_url": "https://github.com/GitoxideLabs/gitoxide/commit/650a1b5cf25e086197cc55a68525a411e1c28031",
        "message": "fix: Parse installation config path more robustly\n\nThis adds the `-z`/`--null` and `--name-only` options in the `git`\ninvocation that tries to obtain the configuration file path\nassociated with the `git` installation itself. The benefits are:\n\n- Parsing is more reliable for paths containing unusual characters,\n  because `-z`/`--null` causes all paths to be output literally.\n\n  Previously, `\"` characters were trimmed from the ends, but this\n  would not always extract a correct path, because when a path\n  contains characters that cause `git` to enclose it in double\n  quotes, those characters are usually represented in a symbolic\n  form, usually with `\\` escapes.\n\n  In some scenarios, such as usually on Windows when the escaped\n  character is itself a `\\` and not in the leading position, the\n  mangled path would be usable, but more often it would not.\n\n- The volume of output is less, because `--name-only` casues values\n  not to be included in the output.\n\n- The combination of `-z`/`--null` and `--name-only` makes the\n  output format simpler, and the parsing logic is accordingly\n  simpler.\n\n`git` has supported the `-z`/`--null` and `--name-only` options\neven before support for `--show-origin` was added in Git 2.8.0, so\nthis change should have no effect on Git version compatibility.",
        "files": [
            {
                "sha": "d8947a96ff8bc2ea072fc4d0ed4cdc3b9ca67b33",
                "filename": "gix-path/src/env/git/mod.rs",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/GitoxideLabs/gitoxide/blob/650a1b5cf25e086197cc55a68525a411e1c28031/gix-path%2Fsrc%2Fenv%2Fgit%2Fmod.rs",
                "raw_url": "https://github.com/GitoxideLabs/gitoxide/raw/650a1b5cf25e086197cc55a68525a411e1c28031/gix-path%2Fsrc%2Fenv%2Fgit%2Fmod.rs",
                "contents_url": "https://api.github.com/repos/GitoxideLabs/gitoxide/contents/gix-path%2Fsrc%2Fenv%2Fgit%2Fmod.rs?ref=650a1b5cf25e086197cc55a68525a411e1c28031",
                "patch": "@@ -90,7 +90,7 @@ pub(super) static EXE_INFO: Lazy<Option<BString>> = Lazy::new(|| {\n             cmd.creation_flags(CREATE_NO_WINDOW);\n         }\n         // git 2.8.0 and higher support --show-origin.\n-        cmd.args([\"config\", \"-l\", \"--show-origin\"])\n+        cmd.args([\"config\", \"-lz\", \"--show-origin\", \"--name-only\"])\n             .current_dir(env::temp_dir())\n             .stdin(Stdio::null())\n             .stderr(Stdio::null());\n@@ -138,8 +138,8 @@ pub(super) fn install_config_path() -> Option<&'static BStr> {\n \n fn first_file_from_config_with_origin(source: &BStr) -> Option<&BStr> {\n     let file = source.strip_prefix(b\"file:\")?;\n-    let end_pos = file.find_byte(b'\\t')?;\n-    file[..end_pos].trim_with(|c| c == '\"').as_bstr().into()\n+    let end_pos = file.find_byte(b'\\0')?;\n+    file[..end_pos].as_bstr().into()\n }\n \n /// Given `config_path` as obtained from `install_config_path()`, return the path of the git installation base."
            },
            {
                "sha": "86b2b7b28f1603117bed9ffdc4aff45e5fc40e1d",
                "filename": "gix-path/src/env/git/tests.rs",
                "status": "modified",
                "additions": 8,
                "deletions": 5,
                "changes": 13,
                "blob_url": "https://github.com/GitoxideLabs/gitoxide/blob/650a1b5cf25e086197cc55a68525a411e1c28031/gix-path%2Fsrc%2Fenv%2Fgit%2Ftests.rs",
                "raw_url": "https://github.com/GitoxideLabs/gitoxide/raw/650a1b5cf25e086197cc55a68525a411e1c28031/gix-path%2Fsrc%2Fenv%2Fgit%2Ftests.rs",
                "contents_url": "https://api.github.com/repos/GitoxideLabs/gitoxide/contents/gix-path%2Fsrc%2Fenv%2Fgit%2Ftests.rs?ref=650a1b5cf25e086197cc55a68525a411e1c28031",
                "patch": "@@ -17,12 +17,15 @@ fn config_to_base_path() {\n \n #[test]\n fn first_file_from_config_with_origin() {\n-    let macos = \"file:/Applications/Xcode.app/Contents/Developer/usr/share/git-core/gitconfig\tcredential.helper=osxkeychain\\nfile:/Users/byron/.gitconfig\tpush.default=simple\\n\";\n+    let macos =\n+        \"file:/Applications/Xcode.app/Contents/Developer/usr/share/git-core/gitconfig\\0credential.helper\\0file:/Users/byron/.gitconfig\\0push.default\\0\";\n     let win_msys =\n-        \"file:C:/git-sdk-64/etc/gitconfig\tcore.symlinks=false\\r\\nfile:C:/git-sdk-64/etc/gitconfig\tcore.autocrlf=true\";\n-    let win_cmd = \"file:C:/Program Files/Git/etc/gitconfig\tdiff.astextplain.textconv=astextplain\\r\\nfile:C:/Program Files/Git/etc/gitconfig\tfilter.lfs.clean=gix-lfs clean -- %f\\r\\n\";\n-    let win_msys_old = \"file:\\\"C:\\\\ProgramData/Git/config\\\"\tdiff.astextplain.textconv=astextplain\\r\\nfile:\\\"C:\\\\ProgramData/Git/config\\\"\tfilter.lfs.clean=git-lfs clean -- %f\\r\\n\";\n-    let linux = \"file:/home/parallels/.gitconfig\tcore.excludesfile=~/.gitignore\\n\";\n+        \"file:C:/git-sdk-64/etc/gitconfig\\0core.symlinks\\0file:C:/git-sdk-64/etc/gitconfig\\0core.autocrlf\\0\";\n+    let win_cmd =\n+        \"file:C:/Program Files/Git/etc/gitconfig\\0diff.astextplain.textconv\\0file:C:/Program Files/Git/etc/gitconfig\\0filter.lfs.clean\\0\";\n+    let win_msys_old =\n+        \"file:C:\\\\ProgramData/Git/config\\0diff.astextplain.textconv\\0file:C:\\\\ProgramData/Git/config\\0filter.lfs.clean\\0\";\n+    let linux = \"file:/home/parallels/.gitconfig\\0core.excludesfile\\0\";\n     let bogus = \"something unexpected\";\n     let empty = \"\";\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/alfio-event/alf.io/commits/53b3309e26e8acec6860d1e045df3046153a3245",
        "url": "https://api.github.com/repos/alfio-event/alf.io/commits/53b3309e26e8acec6860d1e045df3046153a3245",
        "html_url": "https://github.com/alfio-event/alf.io/commit/53b3309e26e8acec6860d1e045df3046153a3245",
        "message": "Merge commit from fork\n\n* initial stubs for reproducing the case\n\nadd test\n\nremove check at payment time, we only need to ensure at the reservation point\n\nRevert \"remove check at payment time, we only need to ensure at the reservation point\"\n\nThis reverts commit f87c424cdb2319424e12b644c694af87a9d78795.\n\nadd promocode_count view\n\nfix promocode_count view + integrate in code\n\nadvance check\n\nadd count\n\n* rewrite view",
        "files": [
            {
                "sha": "6241d69bb0cf034ad37a099eb9bc814630a9f6aa",
                "filename": "src/main/java/alfio/controller/api/v2/user/EventApiV2Controller.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Fcontroller%2Fapi%2Fv2%2Fuser%2FEventApiV2Controller.java",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Fcontroller%2Fapi%2Fv2%2Fuser%2FEventApiV2Controller.java",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/src%2Fmain%2Fjava%2Falfio%2Fcontroller%2Fapi%2Fv2%2Fuser%2FEventApiV2Controller.java?ref=53b3309e26e8acec6860d1e045df3046153a3245",
                "patch": "@@ -163,7 +163,7 @@ public ResponseEntity<ItemsByCategory> getTicketCategories(@PathVariable String\n                     if (specialCode.isPresent()) {\n                         maxTickets = Math.min(1, maxTickets);\n                     } else if (filteredPromoCode != null && filteredPromoCode.getMaxUsage() != null) {\n-                        maxTickets = filteredPromoCode.getMaxUsage() - promoCodeRepository.countConfirmedPromoCode(filteredPromoCode.getId(), categoriesOrNull(filteredPromoCode), null, categoriesOrNull(filteredPromoCode) != null ? \"X\" : null);\n+                        maxTickets = filteredPromoCode.getMaxUsage() - promoCodeRepository.countConfirmedPromoCode(filteredPromoCode.getId());\n                     }\n                     return new SaleableTicketCategory(category,\n                         now, event, ticketReservationManager.countAvailableTickets(event, category), maxTickets,"
            },
            {
                "sha": "2443c6d0202a68b32559561c935cd073c302c04b",
                "filename": "src/main/java/alfio/manager/NotificationManager.java",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Fmanager%2FNotificationManager.java",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Fmanager%2FNotificationManager.java",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/src%2Fmain%2Fjava%2Falfio%2Fmanager%2FNotificationManager.java?ref=53b3309e26e8acec6860d1e045df3046153a3245",
                "patch": "@@ -346,6 +346,11 @@ public void sendSimpleEmail(PurchaseContext purchaseContext, String reservationI\n \n     public void sendSimpleEmail(PurchaseContext purchaseContext, String reservationId, String recipient, List<String> cc, String subject, TemplateGenerator textBuilder, List<Mailer.Attachment> attachments) {\n \n+        if (recipient == null) {\n+            log.warn(\"No recipient provided, mail for reservation id {} with subject {} will be ignored\", reservationId, subject);\n+            return;\n+        }\n+\n         String encodedAttachments = attachments.isEmpty() ? null : encodeAttachments(attachments.toArray(new Mailer.Attachment[0]));\n         String encodedCC = Json.toJson(cc);\n "
            },
            {
                "sha": "15750aa7f077093b8bc68bf70ff844758f926b6e",
                "filename": "src/main/java/alfio/manager/PromoCodeRequestManager.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Fmanager%2FPromoCodeRequestManager.java",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Fmanager%2FPromoCodeRequestManager.java",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/src%2Fmain%2Fjava%2Falfio%2Fmanager%2FPromoCodeRequestManager.java?ref=53b3309e26e8acec6860d1e045df3046153a3245",
                "patch": "@@ -184,7 +184,7 @@ private PromoCodeType checkPromoCodeType(int eventId, String trimmedCode) {\n     }\n \n     private boolean isDiscountCodeUsageExceeded(PromoCodeDiscount discount) {\n-        return discount.getMaxUsage() != null && discount.getMaxUsage() <= promoCodeRepository.countConfirmedPromoCode(discount.getId(), categoriesOrNull(discount), null, categoriesOrNull(discount) != null ? \"X\" : null);\n+        return discount.getMaxUsage() != null && discount.getMaxUsage() <= promoCodeRepository.countConfirmedPromoCode(discount.getId());\n     }\n \n     private Pair<Optional<String>, BindingResult> makeSimpleReservation(Event event,\n@@ -228,7 +228,7 @@ public int countUsage(int promoCodeId) {\n         if(code.isEmpty()) {\n             return 0;\n         }\n-        return promoCodeRepository.countConfirmedPromoCode(promoCodeId, categoriesOrNull(code.get()), null, categoriesOrNull(code.get()) != null ? \"X\" : null);\n+        return promoCodeRepository.countConfirmedPromoCode(promoCodeId);\n     }\n \n     public List<PromoCodeUsageResult> retrieveDetailedUsage(int promoCodeId, Integer eventId) {"
            },
            {
                "sha": "89ebc7dc58a2a0c2c50cf26cf06b598b702c4aec",
                "filename": "src/main/java/alfio/manager/TicketReservationManager.java",
                "status": "modified",
                "additions": 14,
                "deletions": 2,
                "changes": 16,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Fmanager%2FTicketReservationManager.java",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Fmanager%2FTicketReservationManager.java",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/src%2Fmain%2Fjava%2Falfio%2Fmanager%2FTicketReservationManager.java?ref=53b3309e26e8acec6860d1e045df3046153a3245",
                "patch": "@@ -85,6 +85,7 @@\n import org.springframework.transaction.support.TransactionSynchronizationManager;\n import org.springframework.transaction.support.TransactionTemplate;\n import org.springframework.util.Assert;\n+import org.springframework.util.CollectionUtils;\n import org.springframework.validation.BindingResult;\n \n import java.math.BigDecimal;\n@@ -326,6 +327,17 @@ public String createTicketReservation(Event event,\n \n         Optional<PromoCodeDiscount> dynamicDiscount = createDynamicPromoCode(discount, event, list, reservationId);\n \n+        discount.ifPresent(d -> {\n+            if (d.getMaxUsage() != null) {\n+                promoCodeDiscountRepository.lockForCount(d.getId());\n+                var discountedCategories = d.getCategories();\n+                var appliedDiscountCount = CollectionUtils.isEmpty(discountedCategories) ? list.size() : list.stream().filter(t -> discountedCategories.contains(t.getTicketCategoryId())).count();\n+                if (d.getMaxUsage() < promoCodeDiscountRepository.countUsedPromoCode(d.getId()) + appliedDiscountCount) {\n+                    throw new TooManyTicketsForDiscountCodeException();\n+                }\n+            }\n+        });\n+\n         ticketReservationRepository.createNewReservation(reservationId,\n             event.now(clockProvider),\n             reservationExpiration, dynamicDiscount.or(() -> discount).map(PromoCodeDiscount::getId).orElse(null),\n@@ -707,12 +719,12 @@ private boolean isDiscountCodeUsageExceeded(String reservationId) {\n         TicketReservation reservation = ticketReservationRepository.findReservationById(reservationId);\n         if(reservation.getPromoCodeDiscountId() != null) {\n             final PromoCodeDiscount promoCode = promoCodeDiscountRepository.findById(reservation.getPromoCodeDiscountId());\n-            if(promoCode.getMaxUsage() == null) {\n+            if (promoCode.getMaxUsage() == null) {\n                 return false;\n             }\n             int currentTickets = ticketReservationRepository.countTicketsInReservationForCategories(reservationId, categoriesOrNull(promoCode));\n             return Boolean.TRUE.equals(serializedTransactionTemplate.execute(status -> {\n-                Integer confirmedPromoCode = promoCodeDiscountRepository.countConfirmedPromoCode(promoCode.getId(), categoriesOrNull(promoCode), reservationId, categoriesOrNull(promoCode) != null ? \"X\" : null);\n+                Integer confirmedPromoCode = promoCodeDiscountRepository.countConfirmedPromoCode(promoCode.getId());\n                 return promoCode.getMaxUsage() < currentTickets + confirmedPromoCode;\n             }));\n         }"
            },
            {
                "sha": "666832d8effe7b882e659b4ef365140d3669f246",
                "filename": "src/main/java/alfio/repository/PromoCodeDiscountRepository.java",
                "status": "modified",
                "additions": 9,
                "deletions": 7,
                "changes": 16,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Frepository%2FPromoCodeDiscountRepository.java",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fjava%2Falfio%2Frepository%2FPromoCodeDiscountRepository.java",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/src%2Fmain%2Fjava%2Falfio%2Frepository%2FPromoCodeDiscountRepository.java?ref=53b3309e26e8acec6860d1e045df3046153a3245",
                "patch": "@@ -23,7 +23,6 @@\n import ch.digitalfondue.npjt.QueryRepository;\n \n import java.time.ZonedDateTime;\n-import java.util.Collection;\n import java.util.List;\n import java.util.Optional;\n \n@@ -106,12 +105,12 @@ int addPromoCodeIfNotExists(@Bind(\"promoCode\") String promoCode,\n     @Query(\"select count(*) from promo_code where event_id_fk = :eventId or (event_id_fk is null and organization_id_fk = :organizationId)\")\n     Integer countByEventAndOrganizationId(@Bind(\"eventId\") int eventId, @Bind(\"organizationId\") int organizationId);\n \n-    @Query(\"\"\"\n-        select count(b.id) from tickets_reservation a, ticket b\\\n-         where (:currentId is null or a.id <> :currentId) and a.status in ('OFFLINE_PAYMENT', 'DEFERRED_OFFLINE_PAYMENT', 'COMPLETE', 'STUCK') and a.promo_code_id_fk = :id\\\n-         and b.tickets_reservation_id = a.id and (:categoriesJson is null or b.category_id in (:categories))\\\n-        \"\"\")\n-    Integer countConfirmedPromoCode(@Bind(\"id\") int id, @Bind(\"categories\") Collection<Integer> categories, @Bind(\"currentId\") String currentReservationId, @Bind(\"categoriesJson\") String categoriesJson);\n+\n+    @Query(\"select promo_code_use from promocode_count where promo_code_id = :id\")\n+    Integer countConfirmedPromoCode(@Bind(\"id\") int id);\n+\n+    @Query(\"select promo_code_use from promocode_count_all where promo_code_id = :id\")\n+    Integer countUsedPromoCode(@Bind(\"id\") int id);\n \n     @Query(\"update promo_code set valid_to = :end where id = :id\")\n     int updateEventPromoCodeEnd(@Bind(\"id\") int id, @Bind(\"end\") ZonedDateTime end);\n@@ -135,4 +134,7 @@ int updateEventPromoCode(@Bind(\"id\") int id,\n         \"\"\")\n     List<PromoCodeUsageResult> findDetailedUsage(@Bind(\"promoCode\") String promoCode,\n                                                  @Bind(\"eventId\") Integer eventId);\n+\n+    @Query(\"select id from promo_code where id = :id for update\")\n+    Integer lockForCount(@Bind(\"id\") int id);\n }"
            },
            {
                "sha": "38acf79b596630eaf8eae47ee7e2098fbd154157",
                "filename": "src/main/resources/alfio/db/PGSQL/afterMigrate__018_VIEW_promocode_count.sql",
                "status": "added",
                "additions": 64,
                "deletions": 0,
                "changes": 64,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fresources%2Falfio%2Fdb%2FPGSQL%2FafterMigrate__018_VIEW_promocode_count.sql",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/53b3309e26e8acec6860d1e045df3046153a3245/src%2Fmain%2Fresources%2Falfio%2Fdb%2FPGSQL%2FafterMigrate__018_VIEW_promocode_count.sql",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/src%2Fmain%2Fresources%2Falfio%2Fdb%2FPGSQL%2FafterMigrate__018_VIEW_promocode_count.sql?ref=53b3309e26e8acec6860d1e045df3046153a3245",
                "patch": "@@ -0,0 +1,64 @@\n+--\n+-- This file is part of alf.io.\n+--\n+-- alf.io is free software: you can redistribute it and/or modify\n+-- it under the terms of the GNU General Public License as published by\n+-- the Free Software Foundation, either version 3 of the License, or\n+-- (at your option) any later version.\n+--\n+-- alf.io is distributed in the hope that it will be useful,\n+-- but WITHOUT ANY WARRANTY; without even the implied warranty of\n+-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+-- GNU General Public License for more details.\n+--\n+-- You should have received a copy of the GNU General Public License\n+-- along with alf.io.  If not, see <http://www.gnu.org/licenses/>.\n+--\n+\n+drop view if exists promocode_count;\n+\n+create view promocode_count as (\n+select id as promo_code_id, promo_code, coalesce(promo_code_use,0) as promo_code_use\n+from (\n+    select id, promo_code from promo_code pc\n+) as pc_data\n+left join (\n+    select pc.id promo_code_id, count(*) as promo_code_use from tickets_reservation tr\n+    inner join promo_code pc on tr.promo_code_id_fk = pc.id\n+    left join ticket on ticket.tickets_reservation_id = tr.id\n+    where tr.status in ('OFFLINE_PAYMENT', 'DEFERRED_OFFLINE_PAYMENT', 'COMPLETE', 'STUCK')\n+    and (\n+        -- is not assigned to category?\n+        pc.categories is null or json_array_length(pc.categories::json) = 0 or\n+        -- v category_id is inside pc.categories?\n+        ((pc.categories::jsonb) @> ((ticket.category_id::text)::jsonb))\n+    ) group by pc.id\n+) as count_data on pc_data.id = count_data.promo_code_id\n+);\n+\n+\n+\n+drop view if exists promocode_count_all;\n+\n+create view promocode_count_all as (\n+select id as promo_code_id, promo_code, coalesce(promo_code_use,0) as promo_code_use\n+from (\n+    select id, promo_code from promo_code pc\n+) as pc_data\n+left join (\n+    select pc.id promo_code_id, count(*) as promo_code_use\n+    from tickets_reservation tr\n+    inner join promo_code pc on tr.promo_code_id_fk = pc.id\n+    left join ticket on ticket.tickets_reservation_id = tr.id\n+    where tr.status <> 'CANCELLED'\n+    and (\n+        -- is not assigned to category?\n+        pc.categories is null or json_array_length(pc.categories::json) = 0 or\n+        -- v category_id is inside pc.categories?\n+        ((pc.categories::jsonb) @> ((ticket.category_id::text)::jsonb))\n+    )\n+    group by pc.id\n+) as count_data on pc_data.id = count_data.promo_code_id\n+);\n+\n+"
            },
            {
                "sha": "eee222ca29568dd0b153ea8467ef011658ac1194",
                "filename": "src/test/java/alfio/manager/DiscountIntegrationTest.java",
                "status": "added",
                "additions": 190,
                "deletions": 0,
                "changes": 190,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/53b3309e26e8acec6860d1e045df3046153a3245/src%2Ftest%2Fjava%2Falfio%2Fmanager%2FDiscountIntegrationTest.java",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/53b3309e26e8acec6860d1e045df3046153a3245/src%2Ftest%2Fjava%2Falfio%2Fmanager%2FDiscountIntegrationTest.java",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/src%2Ftest%2Fjava%2Falfio%2Fmanager%2FDiscountIntegrationTest.java?ref=53b3309e26e8acec6860d1e045df3046153a3245",
                "patch": "@@ -0,0 +1,190 @@\n+package alfio.manager;\n+\n+import alfio.TestConfiguration;\n+import alfio.config.DataSourceConfiguration;\n+import alfio.config.Initializer;\n+import alfio.controller.form.ReservationForm;\n+import alfio.manager.payment.PaymentSpecification;\n+import alfio.manager.user.UserManager;\n+import alfio.model.*;\n+import alfio.model.metadata.AlfioMetadata;\n+import alfio.model.modification.DateTimeModification;\n+import alfio.model.modification.TicketCategoryModification;\n+import alfio.model.modification.TicketReservationModification;\n+import alfio.model.modification.TicketReservationWithOptionalCodeModification;\n+import alfio.model.transaction.PaymentMethod;\n+import alfio.model.transaction.PaymentProxy;\n+import alfio.repository.EventRepository;\n+import alfio.repository.PromoCodeDiscountRepository;\n+import alfio.repository.TicketCategoryRepository;\n+import alfio.repository.system.ConfigurationRepository;\n+import alfio.repository.user.OrganizationRepository;\n+import alfio.test.util.AlfioIntegrationTest;\n+import alfio.test.util.IntegrationTestUtil;\n+import alfio.util.BaseIntegrationTest;\n+import alfio.util.ClockProvider;\n+import org.apache.commons.lang3.time.DateUtils;\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.Test;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.ContextConfiguration;\n+\n+import java.math.BigDecimal;\n+import java.time.LocalDate;\n+import java.time.LocalTime;\n+import java.time.ZonedDateTime;\n+import java.util.*;\n+import java.util.concurrent.CountDownLatch;\n+\n+import static alfio.model.PromoCodeDiscount.categoriesOrNull;\n+import static alfio.test.util.IntegrationTestUtil.*;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+@AlfioIntegrationTest\n+@ContextConfiguration(classes = {DataSourceConfiguration.class, TestConfiguration.class})\n+@ActiveProfiles({Initializer.PROFILE_DEV, Initializer.PROFILE_DISABLE_JOBS, Initializer.PROFILE_INTEGRATION_TEST})\n+class DiscountIntegrationTest extends BaseIntegrationTest {\n+\n+\n+    @Autowired\n+    private ConfigurationRepository configurationRepository;\n+    @Autowired\n+    private UserManager userManager;\n+    @Autowired\n+    private OrganizationRepository organizationRepository;\n+    @Autowired\n+    private EventManager eventManager;\n+\n+    @Autowired\n+    private EventRepository eventRepository;\n+\n+    @Autowired\n+    private TicketCategoryRepository ticketCategoryRepository;\n+\n+    @Autowired\n+    private TicketReservationManager ticketReservationManager;\n+\n+    @Autowired\n+    private ClockProvider clockProvider;\n+\n+    @Autowired\n+    private PromoCodeDiscountRepository promoCodeDiscountRepository;\n+\n+    private static final Logger log = LoggerFactory.getLogger(DiscountIntegrationTest.class);\n+\n+    @Test\n+    void checkConcurrency() throws InterruptedException {\n+\n+        int concurrencyCount = 4;\n+\n+        var startSignal = new CountDownLatch(concurrencyCount);\n+        var countdownLatchBeforePerformPayment = new CountDownLatch(concurrencyCount);\n+        var countdownLatchBeforeComplete = new CountDownLatch(concurrencyCount);\n+        var doneSignal = new CountDownLatch(concurrencyCount);\n+\n+\n+        IntegrationTestUtil.ensureMinimalConfiguration(configurationRepository);\n+        List<TicketCategoryModification> categories = List.of(\n+            new TicketCategoryModification(null, \"default\", TicketCategory.TicketAccessType.INHERIT, AVAILABLE_SEATS,\n+                new DateTimeModification(LocalDate.now(ClockProvider.clock()).minusDays(1), LocalTime.now(ClockProvider.clock())),\n+                new DateTimeModification(LocalDate.now(ClockProvider.clock()).plusDays(1), LocalTime.now(ClockProvider.clock())),\n+                DESCRIPTION, BigDecimal.TEN, false,\n+                \"\", false, null, null, null, null, null, 0, null, null, AlfioMetadata.empty())\n+        );\n+        Pair<Event, String> eventAndUser = initEvent(categories, organizationRepository, userManager, eventManager, eventRepository);\n+\n+        var event = eventAndUser.getLeft();\n+\n+        TicketCategory category = ticketCategoryRepository.findAllTicketCategories(event.getId()).get(0);\n+\n+        String promoCode = \"100_PROMO\";\n+\n+        eventManager.addPromoCode(promoCode,\n+            event.getId(), null,\n+            ZonedDateTime.now(clockProvider.getClock()).minusDays(2),\n+            event.getEnd().plusDays(2),\n+            50, PromoCodeDiscount.DiscountType.PERCENTAGE, List.of(category.getId()),\n+            1, \"100% discount\",\n+            \"test@test.ch\",\n+            PromoCodeDiscount.CodeType.DISCOUNT,\n+            null,\n+            null);\n+\n+        var promoCodeDiscount = promoCodeDiscountRepository.findAllInEvent(event.getId()).get(0);\n+\n+\n+        for (int i = 0; i < concurrencyCount; i++) {\n+            Runnable runnable = () -> {\n+                try {\n+                    var form = new ReservationForm();\n+                    var ticketReservation = new TicketReservationModification();\n+                    ticketReservation.setQuantity(2);\n+                    ticketReservation.setTicketCategoryId(category.getId());\n+                    form.setReservation(Collections.singletonList(ticketReservation));\n+                    form.setPromoCode(promoCode);\n+\n+                    TicketReservationModification tr = new TicketReservationModification();\n+                    tr.setQuantity(1);\n+                    tr.setTicketCategoryId(category.getId());\n+                    TicketReservationWithOptionalCodeModification mod = new TicketReservationWithOptionalCodeModification(tr, Optional.empty());\n+                    startSignal.countDown();\n+                    startSignal.await();\n+\n+                    String reservationId = null;\n+                    try {\n+                        reservationId = ticketReservationManager.createTicketReservation(event, Collections.singletonList(mod), Collections.emptyList(),\n+                            DateUtils.addDays(new Date(), 1),\n+                            Optional.of(promoCode),\n+                            Locale.ENGLISH,\n+                            false,\n+                            null);\n+\n+\n+                    } catch (Throwable t) {\n+\n+                    } finally {\n+                        countdownLatchBeforePerformPayment.countDown();\n+                    }\n+                    countdownLatchBeforePerformPayment.await();\n+\n+                    try {\n+                        if (reservationId != null) {\n+                            Pair<TotalPrice, Optional<PromoCodeDiscount>> priceAndDiscount = ticketReservationManager.totalReservationCostWithVAT(reservationId);\n+                            TotalPrice totalPrice = priceAndDiscount.getLeft();\n+                            PaymentSpecification specification = new PaymentSpecification(reservationId, null, totalPrice.getPriceWithVAT(),\n+                                event, \"email@example.com\", new CustomerName(\"full name\", \"full\", \"name\", event.mustUseFirstAndLastName()),\n+                                \"billing address\", null, Locale.ENGLISH, true, false, null, \"IT\", \"123456\", PriceContainer.VatStatus.INCLUDED, true, false);\n+                            var paymentResult = ticketReservationManager.performPayment(specification, totalPrice, PaymentProxy.OFFLINE, PaymentMethod.BANK_TRANSFER, null);\n+                            assertTrue(paymentResult.isSuccessful());\n+                        }\n+                    } catch (Throwable t) {\n+                    } finally {\n+                        countdownLatchBeforeComplete.countDown();\n+                    }\n+\n+\n+                    countdownLatchBeforeComplete.await();\n+                    if (reservationId != null) {\n+                        ticketReservationManager.confirmOfflinePayment(event, reservationId, null, eventAndUser.getRight());\n+                    }\n+                } catch (InterruptedException e) {\n+                    throw new IllegalStateException(e);\n+                } catch (Throwable t) {\n+                } finally {\n+                    doneSignal.countDown();\n+                }\n+            };\n+            new Thread(runnable).start();\n+        }\n+\n+        doneSignal.await();\n+\n+        Assertions.assertEquals(1, promoCodeDiscountRepository.countConfirmedPromoCode(promoCodeDiscount.getId()));\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/alfio-event/alf.io/commits/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b",
        "url": "https://api.github.com/repos/alfio-event/alf.io/commits/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b",
        "html_url": "https://github.com/alfio-event/alf.io/commit/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "6b40549fd9bfde62192f07520428c377f13db757",
                "filename": "frontend/projects/public/src/app/shared/event.service.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Fevent.service.ts",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Fevent.service.ts",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Fevent.service.ts?ref=e7131c588f4ac31067a41d0e31e6a6a721b2ff4b",
                "patch": "@@ -10,6 +10,7 @@ import {shareReplay} from 'rxjs/operators';\n import {EventCode} from '../model/event-code';\n import {DateValidity} from '../model/date-validity';\n import {SearchParams} from '../model/search-params';\n+import { loadPreloaded } from './util';\n \n @Injectable({\n   providedIn: 'root'\n@@ -33,7 +34,7 @@ export class EventService {\n     if (!this.eventCache[eventShortName]) {\n       const preloadEvent = document.getElementById('preload-event');\n       if (preloadEvent && preloadEvent.getAttribute('data-param') === eventShortName) {\n-        this.eventCache[eventShortName] = of(JSON.parse(preloadEvent.textContent)).pipe(shareReplay(1));\n+        this.eventCache[eventShortName] = of(loadPreloaded('preload-event')).pipe(shareReplay(1));\n       } else {\n         this.eventCache[eventShortName] = this.http.get<Event>(`/api/v2/public/event/${eventShortName}`).pipe(shareReplay(1));\n       }"
            },
            {
                "sha": "8fd8fcac838814275c7b2ddae41acc81a6c53d30",
                "filename": "frontend/projects/public/src/app/shared/i18n.service.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Fi18n.service.ts",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Fi18n.service.ts",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Fi18n.service.ts?ref=e7131c588f4ac31067a41d0e31e6a6a721b2ff4b",
                "patch": "@@ -10,7 +10,7 @@ import {catchError, map, mergeMap, shareReplay, tap} from 'rxjs/operators';\n import {EventService} from './event.service';\n import {PurchaseContextType} from './purchase-context.service';\n import {PurchaseContext} from '../model/purchase-context';\n-import {getFromSessionStorage, writeToSessionStorage} from './util';\n+import {getFromSessionStorage, loadPreloaded, writeToSessionStorage} from './util';\n \n @Injectable({\n   providedIn: 'root'\n@@ -41,11 +41,11 @@ export class I18nService {\n       if (this.countriesCache.empty) {\n           const vatCountries = document.getElementById('preload-vat-countries');\n           if (vatCountries != null && vatCountries.getAttribute('data-param') != null) {\n-              this.countriesCache.countriesForVat[vatCountries.getAttribute('data-param')] = JSON.parse(vatCountries.textContent);\n+              this.countriesCache.countriesForVat[vatCountries.getAttribute('data-param')] = loadPreloaded('preload-vat-countries');\n           }\n           const allCountries = document.getElementById('preload-countries');\n           if (allCountries != null && allCountries.getAttribute('data-param') != null) {\n-              this.countriesCache.allCountries[allCountries.getAttribute('data-param')] = JSON.parse(allCountries.textContent);\n+              this.countriesCache.allCountries[allCountries.getAttribute('data-param')] = loadPreloaded('preload-countries');\n           }\n           this.countriesCache.markAsInitialized();\n       }\n@@ -153,7 +153,7 @@ export class CustomLoader implements TranslateLoader {\n     if (!translationCache[lang]) {\n       const preloadBundle = document.getElementById('preload-bundle');\n       if (preloadBundle && preloadBundle.getAttribute('data-param') === lang) {\n-        translationCache[lang] = of(JSON.parse(preloadBundle.textContent)).pipe(shareReplay(1));\n+        translationCache[lang] = of(loadPreloaded('preload-bundle')).pipe(shareReplay(1));\n       } else {\n         translationCache[lang] = this.http.get(`/api/v2/public/i18n/bundle/${lang}`).pipe(shareReplay(1));\n       }"
            },
            {
                "sha": "2b8734130f5b25971e26743b76ee32eacde1e413",
                "filename": "frontend/projects/public/src/app/shared/info.service.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Finfo.service.ts",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Finfo.service.ts",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Finfo.service.ts?ref=e7131c588f4ac31067a41d0e31e6a6a721b2ff4b",
                "patch": "@@ -3,6 +3,7 @@ import {HttpClient} from '@angular/common/http';\n import {Observable, of} from 'rxjs';\n import {Info} from '../model/info';\n import {shareReplay} from 'rxjs/operators';\n+import { loadPreloaded } from './util';\n \n @Injectable({\n   providedIn: 'root'\n@@ -17,7 +18,7 @@ export class InfoService {\n     if (!this.infoCache) {\n       const preloadInfo = document.getElementById('preload-info');\n       if (preloadInfo) {\n-        this.infoCache = of(JSON.parse(preloadInfo.textContent)).pipe(shareReplay(1));\n+        this.infoCache = of(loadPreloaded('preload-info')).pipe(shareReplay(1));\n       } else {\n         this.infoCache = this.http.get<Info>('/api/v2/info').pipe(shareReplay(1));\n       }"
            },
            {
                "sha": "d5675feef23fb7a849bcb45f7e2f510cca4ff935",
                "filename": "frontend/projects/public/src/app/shared/util.ts",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Futil.ts",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Futil.ts",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/frontend%2Fprojects%2Fpublic%2Fsrc%2Fapp%2Fshared%2Futil.ts?ref=e7131c588f4ac31067a41d0e31e6a6a721b2ff4b",
                "patch": "@@ -96,3 +96,14 @@ export function groupAdditionalData(data: AdditionalServiceWithData[]): GroupedA\n export interface GroupedAdditionalServiceWithData extends AdditionalServiceWithData {\n   count: number;\n }\n+\n+// load preloaded data which are json and url encoded\n+export function loadPreloaded(id: string) {\n+  const preload = document.getElementById(id);\n+  if (preload && preload.textContent) {\n+    return JSON.parse(decodeURIComponent(preload.textContent));\n+  } else {\n+    return undefined;\n+  }\n+  \n+}"
            },
            {
                "sha": "a2fde8bea4f50e8637683beb5032f09aad0a8c90",
                "filename": "src/main/java/alfio/controller/IndexController.java",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/alfio-event/alf.io/blob/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/src%2Fmain%2Fjava%2Falfio%2Fcontroller%2FIndexController.java",
                "raw_url": "https://github.com/alfio-event/alf.io/raw/e7131c588f4ac31067a41d0e31e6a6a721b2ff4b/src%2Fmain%2Fjava%2Falfio%2Fcontroller%2FIndexController.java",
                "contents_url": "https://api.github.com/repos/alfio-event/alf.io/contents/src%2Fmain%2Fjava%2Falfio%2Fcontroller%2FIndexController.java?ref=e7131c588f4ac31067a41d0e31e6a6a721b2ff4b",
                "patch": "@@ -49,6 +49,7 @@\n import org.springframework.web.bind.annotation.*;\n import org.springframework.web.context.request.ServletWebRequest;\n import org.springframework.web.util.UriComponentsBuilder;\n+import org.springframework.web.util.UriUtils;\n \n import java.io.IOException;\n import java.io.InputStreamReader;\n@@ -333,8 +334,9 @@ private static String countriesAsJson(Json json, String preloadLang) {\n     }\n \n     private static Element buildScripTag(String content, String type, String id, String param) {\n+        var encodedContent = UriUtils.encodeFragment(content, StandardCharsets.UTF_8);\n         var e = new Element(\"script\");\n-        e.appendChild(new Text(content));\n+        e.appendChild(new Text(encodedContent));\n         e.setAttribute(\"type\", type);\n         e.setAttribute(\"id\", id);\n         if (param != null) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Consensys/gnark/commits/afda68a38acca37becb8ba6d8982d03fee9559a0",
        "url": "https://api.github.com/repos/Consensys/gnark/commits/afda68a38acca37becb8ba6d8982d03fee9559a0",
        "html_url": "https://github.com/Consensys/gnark/commit/afda68a38acca37becb8ba6d8982d03fee9559a0",
        "message": "feat add random mask to groth16 commitment (#1245)\n\n* feat add random mask to groth16 commitment\r\n\r\n* fix register rand hint\r\n\r\n* update latest.stats\r\n\r\n* test: add regression test\r\n\r\n* test: fail if witness found\r\n\r\n* test: multicommit with zero commitments\r\n\r\n* test: multicommit with all backends\r\n\r\n---------\r\n\r\nCo-authored-by: Arya Tabaie <15056835+Tabaie@users.noreply.github.com>\r\nCo-authored-by: Ivo Kubjas <ivo.kubjas@consensys.net>",
        "files": [
            {
                "sha": "fa5d44d357bc9886a0361efa352edb8405029ee8",
                "filename": "constraint/solver/hint_registry.go",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/Consensys/gnark/blob/afda68a38acca37becb8ba6d8982d03fee9559a0/constraint%2Fsolver%2Fhint_registry.go",
                "raw_url": "https://github.com/Consensys/gnark/raw/afda68a38acca37becb8ba6d8982d03fee9559a0/constraint%2Fsolver%2Fhint_registry.go",
                "contents_url": "https://api.github.com/repos/Consensys/gnark/contents/constraint%2Fsolver%2Fhint_registry.go?ref=afda68a38acca37becb8ba6d8982d03fee9559a0",
                "patch": "@@ -2,14 +2,15 @@ package solver\n \n import (\n \t\"fmt\"\n+\t\"github.com/consensys/gnark/internal/hints\"\n \t\"math/big\"\n \t\"sync\"\n \n \t\"github.com/consensys/gnark/logger\"\n )\n \n func init() {\n-\tRegisterHint(InvZeroHint)\n+\tRegisterHint(InvZeroHint, hints.Randomize)\n }\n \n var ("
            },
            {
                "sha": "095ee6e5283d67f4b273a52f0085fcc145da388d",
                "filename": "frontend/cs/r1cs/api.go",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/Consensys/gnark/blob/afda68a38acca37becb8ba6d8982d03fee9559a0/frontend%2Fcs%2Fr1cs%2Fapi.go",
                "raw_url": "https://github.com/Consensys/gnark/raw/afda68a38acca37becb8ba6d8982d03fee9559a0/frontend%2Fcs%2Fr1cs%2Fapi.go",
                "contents_url": "https://api.github.com/repos/Consensys/gnark/contents/frontend%2Fcs%2Fr1cs%2Fapi.go?ref=afda68a38acca37becb8ba6d8982d03fee9559a0",
                "patch": "@@ -19,6 +19,7 @@ package r1cs\n import (\n \t\"errors\"\n \t\"fmt\"\n+\t\"github.com/consensys/gnark/internal/hints\"\n \t\"path/filepath\"\n \t\"reflect\"\n \t\"runtime\"\n@@ -687,6 +688,19 @@ func (builder *builder) Compiler() frontend.Compiler {\n \n func (builder *builder) Commit(v ...frontend.Variable) (frontend.Variable, error) {\n \n+\t// add a random mask to v\n+\t{\n+\t\tvCp := make([]frontend.Variable, len(v)+1)\n+\t\tcopy(vCp, v)\n+\t\tmask, err := builder.NewHint(hints.Randomize, 1)\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\t\tvCp[len(v)] = mask[0]\n+\t\tbuilder.cs.AddR1C(builder.newR1C(mask[0], builder.eOne, mask[0]), builder.genericGate) // the variable needs to be involved in a constraint otherwise it will not affect the commitment\n+\t\tv = vCp\n+\t}\n+\n \tcommitments := builder.cs.GetCommitments().(constraint.Groth16Commitments)\n \texistingCommitmentIndexes := commitments.CommitmentIndexes()\n \tprivateCommittedSeeker := utils.MultiListSeeker(commitments.GetPrivateCommitted())"
            },
            {
                "sha": "1513706dacf141de6304f21e42630a6f6a45eeaa",
                "filename": "internal/hints/hints.go",
                "status": "added",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/Consensys/gnark/blob/afda68a38acca37becb8ba6d8982d03fee9559a0/internal%2Fhints%2Fhints.go",
                "raw_url": "https://github.com/Consensys/gnark/raw/afda68a38acca37becb8ba6d8982d03fee9559a0/internal%2Fhints%2Fhints.go",
                "contents_url": "https://api.github.com/repos/Consensys/gnark/contents/internal%2Fhints%2Fhints.go?ref=afda68a38acca37becb8ba6d8982d03fee9559a0",
                "patch": "@@ -0,0 +1,20 @@\n+package hints\n+\n+import (\n+\t\"crypto/rand\"\n+\t\"errors\"\n+\t\"math/big\"\n+)\n+\n+func Randomize(mod *big.Int, ins, outs []*big.Int) error {\n+\tif len(ins) != 0 {\n+\t\treturn errors.New(\"randomize takes no input\")\n+\t}\n+\tvar err error\n+\tfor i := range outs {\n+\t\tif outs[i], err = rand.Int(rand.Reader, mod); err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t}\n+\treturn nil\n+}"
            },
            {
                "sha": "fd7488048f25725871710c43e511bc848cf72e00",
                "filename": "internal/security_tests/advisory-9xcg/advisory_test.go",
                "status": "added",
                "additions": 89,
                "deletions": 0,
                "changes": 89,
                "blob_url": "https://github.com/Consensys/gnark/blob/afda68a38acca37becb8ba6d8982d03fee9559a0/internal%2Fsecurity_tests%2Fadvisory-9xcg%2Fadvisory_test.go",
                "raw_url": "https://github.com/Consensys/gnark/raw/afda68a38acca37becb8ba6d8982d03fee9559a0/internal%2Fsecurity_tests%2Fadvisory-9xcg%2Fadvisory_test.go",
                "contents_url": "https://api.github.com/repos/Consensys/gnark/contents/internal%2Fsecurity_tests%2Fadvisory-9xcg%2Fadvisory_test.go?ref=afda68a38acca37becb8ba6d8982d03fee9559a0",
                "patch": "@@ -0,0 +1,89 @@\n+// Package advisory9xcg implements a test for advisory GHSA-9xcg-3q8v-7fq6.\n+package advisory9xcg\n+\n+import (\n+\t\"crypto/rand\"\n+\t\"fmt\"\n+\t\"math/big\"\n+\t\"testing\"\n+\n+\t\"github.com/consensys/gnark-crypto/ecc\"\n+\t\"github.com/consensys/gnark-crypto/ecc/bn254\"\n+\t\"github.com/consensys/gnark/backend/groth16\"\n+\tgroth16_bn254 \"github.com/consensys/gnark/backend/groth16/bn254\"\n+\t\"github.com/consensys/gnark/frontend\"\n+\t\"github.com/consensys/gnark/frontend/cs/r1cs\"\n+\t\"github.com/consensys/gnark/test\"\n+)\n+\n+type Circuit struct {\n+\tSecretWitness frontend.Variable `gnark:\",private\"`\n+}\n+\n+func (circuit *Circuit) Define(api frontend.API) error {\n+\t// the goal of the test is to show that we are able to predict the private\n+\t// input solely from the stored commitment.\n+\tcommitCompiler, ok := api.Compiler().(frontend.Committer)\n+\tif !ok {\n+\t\treturn fmt.Errorf(\"compiler does not commit\")\n+\t}\n+\n+\tcommit, err := commitCompiler.Commit(circuit.SecretWitness)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tapi.AssertIsDifferent(commit, 0)\n+\tapi.AssertIsDifferent(circuit.SecretWitness, 0)\n+\treturn nil\n+}\n+\n+func TestAdvisory_ghsa_9xcg_3q8v_7fq6(t *testing.T) {\n+\tassert := test.NewAssert(t)\n+\t// the goal of the test is to show that we are able to predict the private\n+\t// input solely from the stored commitment\n+\n+\t// Generating a random secret witness.\n+\tvar bound int64 = 1024 // ten bits of entropy for testing\n+\tsecretWitness, err := rand.Int(rand.Reader, big.NewInt(bound))\n+\tassert.NoError(err, \"random generation failed\")\n+\tassert.Log(\"random secret witness: \", secretWitness)\n+\n+\t// Assigning some values.\n+\tassignment := Circuit{SecretWitness: secretWitness}\n+\twitness, err := frontend.NewWitness(&assignment, ecc.BN254.ScalarField())\n+\tassert.NoError(err, \"witness creation failed\")\n+\twitnessPublic, err := witness.Public()\n+\tassert.NoError(err, \"witness public failed\")\n+\n+\t// Setup circuit\n+\tccs, err := frontend.Compile(ecc.BN254.ScalarField(), r1cs.NewBuilder, &Circuit{})\n+\tassert.NoError(err, \"compilation failed\")\n+\n+\t// run the setup and prover\n+\tpk, vk, err := groth16.Setup(ccs)\n+\tassert.NoError(err, \"setup failed\")\n+\tproof, err := groth16.Prove(ccs, pk, witness)\n+\tassert.NoError(err, \"proof failed\")\n+\n+\t// sanity check, check that the proof verifies\n+\terr = groth16.Verify(proof, vk, witnessPublic)\n+\tassert.NoError(err, \"verification failed\")\n+\n+\t// we're ready to set up the attack. For that first we need to assert the\n+\t// exact types for being able to extract the proving key information.\n+\tpkConcrete, ok := pk.(*groth16_bn254.ProvingKey)\n+\tassert.True(ok, \"unexpected type for proving key\")\n+\tproofConcrete, ok := proof.(*groth16_bn254.Proof)\n+\tassert.True(ok, \"unexpected type for proof\")\n+\n+\tvar guessedCommitment bn254.G1Affine\n+\tfor i := int64(0); i < bound; i++ {\n+\t\t// We check our guess for the secret witness.\n+\t\tguessedCommitment.ScalarMultiplication(&pkConcrete.CommitmentKeys[0].Basis[0], big.NewInt(int64(i)))\n+\t\tif guessedCommitment.Equal(&proofConcrete.Commitments[0]) {\n+\t\t\tassert.Fail(\"secret witness found: \", i)\n+\t\t\treturn\n+\t\t}\n+\t}\n+}"
            },
            {
                "sha": "c156102ed0baab988339cffd4b14a99ef885e30d",
                "filename": "internal/stats/latest.stats",
                "status": "modified",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/Consensys/gnark/blob/afda68a38acca37becb8ba6d8982d03fee9559a0/internal%2Fstats%2Flatest.stats",
                "raw_url": "https://github.com/Consensys/gnark/raw/afda68a38acca37becb8ba6d8982d03fee9559a0/internal%2Fstats%2Flatest.stats",
                "contents_url": "https://api.github.com/repos/Consensys/gnark/contents/internal%2Fstats%2Flatest.stats?ref=afda68a38acca37becb8ba6d8982d03fee9559a0"
            },
            {
                "sha": "b78f518651a32c97727c7e6605fe51a0826ae23d",
                "filename": "std/multicommit/nativecommit_test.go",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/Consensys/gnark/blob/afda68a38acca37becb8ba6d8982d03fee9559a0/std%2Fmulticommit%2Fnativecommit_test.go",
                "raw_url": "https://github.com/Consensys/gnark/raw/afda68a38acca37becb8ba6d8982d03fee9559a0/std%2Fmulticommit%2Fnativecommit_test.go",
                "contents_url": "https://api.github.com/repos/Consensys/gnark/contents/std%2Fmulticommit%2Fnativecommit_test.go?ref=afda68a38acca37becb8ba6d8982d03fee9559a0",
                "patch": "@@ -4,7 +4,6 @@ import (\n \t\"testing\"\n \n \t\"github.com/consensys/gnark-crypto/ecc\"\n-\t\"github.com/consensys/gnark/backend\"\n \t\"github.com/consensys/gnark/frontend\"\n \t\"github.com/consensys/gnark/frontend/cs/r1cs\"\n \t\"github.com/consensys/gnark/test\"\n@@ -52,7 +51,7 @@ func TestMultipleCommitments(t *testing.T) {\n \tcircuit := multipleCommitmentCircuit{}\n \tassignment := multipleCommitmentCircuit{X: 10}\n \tassert := test.NewAssert(t)\n-\tassert.ProverSucceeded(&circuit, &assignment, test.WithCurves(ecc.BN254), test.WithBackends(backend.GROTH16)) // right now PLONK doesn't implement commitment\n+\tassert.ProverSucceeded(&circuit, &assignment, test.WithCurves(ecc.BN254)) // right now PLONK doesn't implement commitment\n }\n \n type noCommitVariable struct {\n@@ -64,9 +63,11 @@ func (c *noCommitVariable) Define(api frontend.API) error {\n \treturn nil\n }\n \n+// TestNoCommitVariable checks that a circuit that doesn't use the commitment variable\n+// compiles and prover succeeds. This is due to the randomization of the commitment.\n func TestNoCommitVariable(t *testing.T) {\n \tcircuit := noCommitVariable{}\n+\tassignment := noCommitVariable{X: 10}\n \tassert := test.NewAssert(t)\n-\t_, err := frontend.Compile(ecc.BN254.ScalarField(), r1cs.NewBuilder, &circuit)\n-\tassert.Error(err)\n+\tassert.ProverSucceeded(&circuit, &assignment, test.WithCurves(ecc.BN254))\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mlewand/ckeditor-plugin-openlink/commits/402391fdd4d9cfd079031372f9caebbf54993ffb",
        "url": "https://api.github.com/repos/mlewand/ckeditor-plugin-openlink/commits/402391fdd4d9cfd079031372f9caebbf54993ffb",
        "html_url": "https://github.com/mlewand/ckeditor-plugin-openlink/commit/402391fdd4d9cfd079031372f9caebbf54993ffb",
        "message": "Improved a regexp for javasript protocol.",
        "files": [
            {
                "sha": "057ff18c4709c9869aea779eacd966a7d39a0a32",
                "filename": "plugin.js",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/mlewand/ckeditor-plugin-openlink/blob/402391fdd4d9cfd079031372f9caebbf54993ffb/plugin.js",
                "raw_url": "https://github.com/mlewand/ckeditor-plugin-openlink/raw/402391fdd4d9cfd079031372f9caebbf54993ffb/plugin.js",
                "contents_url": "https://api.github.com/repos/mlewand/ckeditor-plugin-openlink/contents/plugin.js?ref=402391fdd4d9cfd079031372f9caebbf54993ffb",
                "patch": "@@ -139,8 +139,10 @@\n \n \t\tif ( url ) {\n \t\t\tfor ( var i = 0; i < disallowedProtocols.length; i++ ) {\n-\t\t\t\t// IE8 compatible trimStart & startsWith :).\n-\t\t\t\tif ( url.replace(/^\\s+/, '').toLowerCase().indexOf( disallowedProtocols[ i ] ) === 0 ) {\n+\t\t\t\t// IE8 compatible String.startsWith() :).\n+\t\t\t\t// Whitespace space needs to be removed not only from the beginning, but also in the middle as browser will execute\n+\t\t\t\t// URL like \"ja vascript: foo();\".\n+\t\t\t\tif ( url.replace( /\\s/g, '' ).toLowerCase().indexOf( disallowedProtocols[ i ] ) === 0 ) {\n \t\t\t\t\treturn false;\n \t\t\t\t}\n \t\t\t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/asterisk/asterisk/commits/42a2f4ccfa2c7062a15063e765916b3332e34cc4",
        "url": "https://api.github.com/repos/asterisk/asterisk/commits/42a2f4ccfa2c7062a15063e765916b3332e34cc4",
        "html_url": "https://github.com/asterisk/asterisk/commit/42a2f4ccfa2c7062a15063e765916b3332e34cc4",
        "message": "manager.c: Add entries to Originate blacklist\n\nAdded Reload and DBdeltree to the list of dialplan application that\ncan't be executed via the Originate manager action without also\nhaving write SYSTEM permissions.\n\nAdded CURL, DB*, FILE, ODBC and REALTIME* to the list of dialplan\nfunctions that can't be executed via the Originate manager action\nwithout also having write SYSTEM permissions.\n\nIf the Queue application is attempted to be run by the Originate\nmanager action and an AGI parameter is specified in the app data,\nit'll be rejected unless the manager user has either the AGI or\nSYSTEM permissions.\n\nResolves: #GHSA-c4cg-9275-6w44",
        "files": [
            {
                "sha": "3cd884a97c57f601e8c535d588f643164d0b4700",
                "filename": "main/manager.c",
                "status": "modified",
                "additions": 141,
                "deletions": 20,
                "changes": 161,
                "blob_url": "https://github.com/asterisk/asterisk/blob/42a2f4ccfa2c7062a15063e765916b3332e34cc4/main%2Fmanager.c",
                "raw_url": "https://github.com/asterisk/asterisk/raw/42a2f4ccfa2c7062a15063e765916b3332e34cc4/main%2Fmanager.c",
                "contents_url": "https://api.github.com/repos/asterisk/asterisk/contents/main%2Fmanager.c?ref=42a2f4ccfa2c7062a15063e765916b3332e34cc4",
                "patch": "@@ -6243,6 +6243,145 @@ static int action_aocmessage(struct mansession *s, const struct message *m)\n \treturn 0;\n }\n \n+struct originate_permissions_entry {\n+\tconst char *search;\n+\tint permission;\n+\tint (*searchfn)(const char *app, const char *data, const char *search);\n+};\n+\n+/*!\n+ * \\internal\n+ * \\brief Check if the application is allowed for Originate\n+ *\n+ * \\param app The \"app\" parameter\n+ * \\param data The \"appdata\" parameter (ignored)\n+ * \\param search The search string\n+ * \\retval 1 Match\n+ * \\retval 0 No match\n+ */\n+static int app_match(const char *app, const char *data, const char *search)\n+{\n+\t/*\n+\t * We use strcasestr so we don't have to trim any blanks\n+\t * from the front or back of the string.\n+\t */\n+\treturn !!(strcasestr(app, search));\n+}\n+\n+/*!\n+ * \\internal\n+ * \\brief Check if the appdata is allowed for Originate\n+ *\n+ * \\param app The \"app\" parameter (ignored)\n+ * \\param data The \"appdata\" parameter\n+ * \\param search The search string\n+ * \\retval 1 Match\n+ * \\retval 0 No match\n+ */\n+static int appdata_match(const char *app, const char *data, const char *search)\n+{\n+\treturn !!(strstr(data, search));\n+}\n+\n+/*!\n+ * \\internal\n+ * \\brief Check if the Queue application is allowed for Originate\n+ *\n+ * It's only allowed if there's no AGI parameter set\n+ *\n+ * \\param app The \"app\" parameter\n+ * \\param data The \"appdata\" parameter\n+ * \\param search The search string\n+ * \\retval 1 Match\n+ * \\retval 0 No match\n+ */\n+static int queue_match(const char *app, const char *data, const char *search)\n+{\n+\tchar *parse;\n+\tAST_DECLARE_APP_ARGS(args,\n+\t\tAST_APP_ARG(queuename);\n+\t\tAST_APP_ARG(options);\n+\t\tAST_APP_ARG(url);\n+\t\tAST_APP_ARG(announceoverride);\n+\t\tAST_APP_ARG(queuetimeoutstr);\n+\t\tAST_APP_ARG(agi);\n+\t\tAST_APP_ARG(gosub);\n+\t\tAST_APP_ARG(rule);\n+\t\tAST_APP_ARG(position);\n+\t);\n+\n+\tif (!strcasestr(app, \"queue\")) {\n+\t\treturn 0;\n+\t}\n+\n+\tparse = ast_strdupa(data);\n+\tAST_STANDARD_APP_ARGS(args, parse);\n+\n+\t/*\n+\t * The Queue application is fine unless the AGI parameter is set.\n+\t * If it is, we need to check the user's permissions.\n+\t */\n+\treturn !ast_strlen_zero(args.agi);\n+}\n+\n+/*\n+ * The Originate application and application data are passed\n+ * to each searchfn in the list.  If a searchfn returns true\n+ * and the user's permissions don't include the permissions specified\n+ * in the list entry, the Originate action will be denied.\n+ *\n+ * If no searchfn returns true, the Originate action is allowed.\n+ */\n+static struct originate_permissions_entry originate_app_permissions[] = {\n+\t/*\n+\t * The app_match function checks if the search string is\n+\t * anywhere in the app parameter.  The check is case-insensitive.\n+\t */\n+\t{ \"agi\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"dbdeltree\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"exec\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"externalivr\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"mixmonitor\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"originate\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"reload\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"system\", EVENT_FLAG_SYSTEM, app_match },\n+\t/*\n+\t * Since the queue_match function specifically checks\n+\t * for the presence of the AGI parameter, we'll allow\n+\t * the call if the user has either the AGI or SYSTEM\n+\t * permission.\n+\t */\n+\t{ \"queue\", EVENT_FLAG_AGI | EVENT_FLAG_SYSTEM, queue_match },\n+\t/*\n+\t * The appdata_match function checks if the search string is\n+\t * anywhere in the appdata parameter.  Unlike app_match,\n+\t * the check is case-sensitive.  These are generally\n+\t * dialplan functions.\n+\t */\n+\t{ \"CURL\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"DB\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"EVAL\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"FILE\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"ODBC\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"REALTIME\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"SHELL\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ NULL, 0 },\n+};\n+\n+static int is_originate_app_permitted(const char *app, const char *data,\n+\tint permission)\n+{\n+\tint i;\n+\n+\tfor (i = 0; originate_app_permissions[i].search; i++) {\n+\t\tif (originate_app_permissions[i].searchfn(app, data, originate_app_permissions[i].search)) {\n+\t\t\treturn !!(permission & originate_app_permissions[i].permission);\n+\t\t}\n+\t}\n+\n+\treturn 1;\n+}\n+\n static int action_originate(struct mansession *s, const struct message *m)\n {\n \tconst char *name = astman_get_header(m, \"Channel\");\n@@ -6334,26 +6473,8 @@ static int action_originate(struct mansession *s, const struct message *m)\n \t}\n \n \tif (!ast_strlen_zero(app) && s->session) {\n-\t\tint bad_appdata = 0;\n-\t\t/* To run the System application (or anything else that goes to\n-\t\t * shell), you must have the additional System privilege */\n-\t\tif (!(s->session->writeperm & EVENT_FLAG_SYSTEM)\n-\t\t\t&& (\n-\t\t\t\tstrcasestr(app, \"system\") ||      /* System(rm -rf /)\n-\t\t\t\t                                     TrySystem(rm -rf /)       */\n-\t\t\t\tstrcasestr(app, \"exec\") ||        /* Exec(System(rm -rf /))\n-\t\t\t\t                                     TryExec(System(rm -rf /)) */\n-\t\t\t\tstrcasestr(app, \"agi\") ||         /* AGI(/bin/rm,-rf /)\n-\t\t\t\t                                     EAGI(/bin/rm,-rf /)       */\n-\t\t\t\tstrcasestr(app, \"mixmonitor\") ||  /* MixMonitor(blah,,rm -rf)  */\n-\t\t\t\tstrcasestr(app, \"externalivr\") || /* ExternalIVR(rm -rf)       */\n-\t\t\t\tstrcasestr(app, \"originate\") ||   /* Originate(Local/1234,app,System,rm -rf) */\n-\t\t\t\t(strstr(appdata, \"SHELL\") && (bad_appdata = 1)) ||       /* NoOp(${SHELL(rm -rf /)})  */\n-\t\t\t\t(strstr(appdata, \"EVAL\") && (bad_appdata = 1))           /* NoOp(${EVAL(${some_var_containing_SHELL})}) */\n-\t\t\t\t)) {\n-\t\t\tchar error_buf[64];\n-\t\t\tsnprintf(error_buf, sizeof(error_buf), \"Originate Access Forbidden: %s\", bad_appdata ? \"Data\" : \"Application\");\n-\t\t\tastman_send_error(s, m, error_buf);\n+\t\tif (!is_originate_app_permitted(app, appdata, s->session->writeperm)) {\n+\t\t\tastman_send_error(s, m, \"Originate Access Forbidden: app or data blacklisted\");\n \t\t\tres = 0;\n \t\t\tgoto fast_orig_cleanup;\n \t\t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/asterisk/asterisk/commits/50bf8d4d3064930d28ecf1ce3397b14574d514d2",
        "url": "https://api.github.com/repos/asterisk/asterisk/commits/50bf8d4d3064930d28ecf1ce3397b14574d514d2",
        "html_url": "https://github.com/asterisk/asterisk/commit/50bf8d4d3064930d28ecf1ce3397b14574d514d2",
        "message": "res_resolver_unbound: Test for NULL ub_result in unbound_resolver_callback\n\nThe ub_result pointer passed to unbound_resolver_callback by\nlibunbound can be NULL if the query was for something malformed\nlike `.1` or `[.1]`.  If it is, we now set a 'ns_r_formerr' result\nand return instead of crashing with a SEGV.  This causes pjproject\nto simply cancel the transaction with a \"No answer record in the DNS\nresponse\" error.  The existing \"off nominal\" unit test was also\nupdated to check this condition.\n\nAlthough not necessary for this fix, we also made\nast_dns_resolver_completed() tolerant of a NULL result.\n\nResolves: GHSA-v428-g3cw-7hv9",
        "files": [
            {
                "sha": "7f3f2b6556f2e587d140dbff7fe00327fb57abc9",
                "filename": "main/dns_core.c",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/asterisk/asterisk/blob/50bf8d4d3064930d28ecf1ce3397b14574d514d2/main%2Fdns_core.c",
                "raw_url": "https://github.com/asterisk/asterisk/raw/50bf8d4d3064930d28ecf1ce3397b14574d514d2/main%2Fdns_core.c",
                "contents_url": "https://api.github.com/repos/asterisk/asterisk/contents/main%2Fdns_core.c?ref=50bf8d4d3064930d28ecf1ce3397b14574d514d2",
                "patch": "@@ -598,7 +598,9 @@ static void sort_result(int rr_type, struct ast_dns_result *result)\n \n void ast_dns_resolver_completed(struct ast_dns_query *query)\n {\n-\tsort_result(ast_dns_query_get_rr_type(query), query->result);\n+\tif (query->result) {\n+\t\tsort_result(ast_dns_query_get_rr_type(query), query->result);\n+\t}\n \n \tquery->callback(query);\n }"
            },
            {
                "sha": "d0564b6ad2365413d3014d5fe62a4c850cf767d0",
                "filename": "res/res_resolver_unbound.c",
                "status": "modified",
                "additions": 16,
                "deletions": 1,
                "changes": 17,
                "blob_url": "https://github.com/asterisk/asterisk/blob/50bf8d4d3064930d28ecf1ce3397b14574d514d2/res%2Fres_resolver_unbound.c",
                "raw_url": "https://github.com/asterisk/asterisk/raw/50bf8d4d3064930d28ecf1ce3397b14574d514d2/res%2Fres_resolver_unbound.c",
                "contents_url": "https://api.github.com/repos/asterisk/asterisk/contents/res%2Fres_resolver_unbound.c?ref=50bf8d4d3064930d28ecf1ce3397b14574d514d2",
                "patch": "@@ -257,6 +257,14 @@ static void unbound_resolver_callback(void *data, int err, struct ub_result *ub_\n {\n \tstruct ast_dns_query *query = data;\n \n+\tif (!ub_result) {\n+\t\tast_debug(3, \"Badly formatted DNS query '%s'\\n\", ast_dns_query_get_name(query));\n+\t\tast_dns_resolver_set_result(query, 0, 0, ns_r_formerr, ast_dns_query_get_name(query), \"\", 0);\n+\t\tast_dns_resolver_completed(query);\n+\t\tao2_ref(query, -1);\n+\t\treturn;\n+\t}\n+\n \tif (!ast_dns_resolver_set_result(query, ub_result->secure, ub_result->bogus, ub_result->rcode,\n \t\tS_OR(ub_result->canonname, ast_dns_query_get_name(query)), ub_result->answer_packet, ub_result->answer_len)) {\n \t\tint i;\n@@ -893,7 +901,8 @@ static int off_nominal_sync_run(struct ast_test *test, const char *domain, int r\n \t}\n \n \tif (ast_dns_result_get_rcode(result) != expected_rcode) {\n-\t\tast_test_status_update(test, \"Unexpected rcode from DNS resolution\\n\");\n+\t\tast_test_status_update(test, \"Unexpected rcode '%d' (expected '%d') from DNS resolution of '%s' class: '%d' type: '%d'\\n\",\n+\t\t\tast_dns_result_get_rcode(result), expected_rcode, domain, rr_class, rr_type);\n \t\tres = -1;\n \t}\n \n@@ -1022,6 +1031,8 @@ static enum ast_test_result_state off_nominal_test(struct ast_test *test,\n \n \tstatic const char *DOMAIN1 = \"goose.feathers\";\n \tstatic const char *DOMAIN2 = \"duck.feathers\";\n+\tstatic const char *BADFORMAT1 = \".1\";\n+\tstatic const char *BADFORMAT2 = \".www\";\n \n \tstatic const char *ADDR1 = \"127.0.0.2\";\n \n@@ -1043,6 +1054,10 @@ static enum ast_test_result_state off_nominal_test(struct ast_test *test,\n \t\t{ DOMAIN2, ns_t_a,    ns_c_in, ns_r_nxdomain },\n \t\t{ DOMAIN1, ns_t_aaaa, ns_c_in, ns_r_noerror },\n \t\t{ DOMAIN1, ns_t_a,    ns_c_chaos, ns_r_refused },\n+\t\t{ BADFORMAT1, ns_t_a,   ns_c_in, ns_r_formerr },\n+\t\t{ BADFORMAT2, ns_t_a,   ns_c_in, ns_r_formerr },\n+\t\t{ BADFORMAT1, ns_t_ptr, ns_c_in, ns_r_formerr },\n+\t\t{ BADFORMAT2, ns_t_ptr, ns_c_in, ns_r_formerr },\n \t};\n \n \tinet_pton(AF_INET,  ADDR1, addr1_buf);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/asterisk/asterisk/commits/4f01669c7c41c9184f3cce9a3cf1b2ebf6201742",
        "url": "https://api.github.com/repos/asterisk/asterisk/commits/4f01669c7c41c9184f3cce9a3cf1b2ebf6201742",
        "html_url": "https://github.com/asterisk/asterisk/commit/4f01669c7c41c9184f3cce9a3cf1b2ebf6201742",
        "message": "res_resolver_unbound: Test for NULL ub_result in unbound_resolver_callback\n\nThe ub_result pointer passed to unbound_resolver_callback by\nlibunbound can be NULL if the query was for something malformed\nlike `.1` or `[.1]`.  If it is, we now set a 'ns_r_formerr' result\nand return instead of crashing with a SEGV.  This causes pjproject\nto simply cancel the transaction with a \"No answer record in the DNS\nresponse\" error.  The existing \"off nominal\" unit test was also\nupdated to check this condition.\n\nAlthough not necessary for this fix, we also made\nast_dns_resolver_completed() tolerant of a NULL result.\n\nResolves: GHSA-v428-g3cw-7hv9",
        "files": [
            {
                "sha": "7f3f2b6556f2e587d140dbff7fe00327fb57abc9",
                "filename": "main/dns_core.c",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/asterisk/asterisk/blob/4f01669c7c41c9184f3cce9a3cf1b2ebf6201742/main%2Fdns_core.c",
                "raw_url": "https://github.com/asterisk/asterisk/raw/4f01669c7c41c9184f3cce9a3cf1b2ebf6201742/main%2Fdns_core.c",
                "contents_url": "https://api.github.com/repos/asterisk/asterisk/contents/main%2Fdns_core.c?ref=4f01669c7c41c9184f3cce9a3cf1b2ebf6201742",
                "patch": "@@ -598,7 +598,9 @@ static void sort_result(int rr_type, struct ast_dns_result *result)\n \n void ast_dns_resolver_completed(struct ast_dns_query *query)\n {\n-\tsort_result(ast_dns_query_get_rr_type(query), query->result);\n+\tif (query->result) {\n+\t\tsort_result(ast_dns_query_get_rr_type(query), query->result);\n+\t}\n \n \tquery->callback(query);\n }"
            },
            {
                "sha": "d0564b6ad2365413d3014d5fe62a4c850cf767d0",
                "filename": "res/res_resolver_unbound.c",
                "status": "modified",
                "additions": 16,
                "deletions": 1,
                "changes": 17,
                "blob_url": "https://github.com/asterisk/asterisk/blob/4f01669c7c41c9184f3cce9a3cf1b2ebf6201742/res%2Fres_resolver_unbound.c",
                "raw_url": "https://github.com/asterisk/asterisk/raw/4f01669c7c41c9184f3cce9a3cf1b2ebf6201742/res%2Fres_resolver_unbound.c",
                "contents_url": "https://api.github.com/repos/asterisk/asterisk/contents/res%2Fres_resolver_unbound.c?ref=4f01669c7c41c9184f3cce9a3cf1b2ebf6201742",
                "patch": "@@ -257,6 +257,14 @@ static void unbound_resolver_callback(void *data, int err, struct ub_result *ub_\n {\n \tstruct ast_dns_query *query = data;\n \n+\tif (!ub_result) {\n+\t\tast_debug(3, \"Badly formatted DNS query '%s'\\n\", ast_dns_query_get_name(query));\n+\t\tast_dns_resolver_set_result(query, 0, 0, ns_r_formerr, ast_dns_query_get_name(query), \"\", 0);\n+\t\tast_dns_resolver_completed(query);\n+\t\tao2_ref(query, -1);\n+\t\treturn;\n+\t}\n+\n \tif (!ast_dns_resolver_set_result(query, ub_result->secure, ub_result->bogus, ub_result->rcode,\n \t\tS_OR(ub_result->canonname, ast_dns_query_get_name(query)), ub_result->answer_packet, ub_result->answer_len)) {\n \t\tint i;\n@@ -893,7 +901,8 @@ static int off_nominal_sync_run(struct ast_test *test, const char *domain, int r\n \t}\n \n \tif (ast_dns_result_get_rcode(result) != expected_rcode) {\n-\t\tast_test_status_update(test, \"Unexpected rcode from DNS resolution\\n\");\n+\t\tast_test_status_update(test, \"Unexpected rcode '%d' (expected '%d') from DNS resolution of '%s' class: '%d' type: '%d'\\n\",\n+\t\t\tast_dns_result_get_rcode(result), expected_rcode, domain, rr_class, rr_type);\n \t\tres = -1;\n \t}\n \n@@ -1022,6 +1031,8 @@ static enum ast_test_result_state off_nominal_test(struct ast_test *test,\n \n \tstatic const char *DOMAIN1 = \"goose.feathers\";\n \tstatic const char *DOMAIN2 = \"duck.feathers\";\n+\tstatic const char *BADFORMAT1 = \".1\";\n+\tstatic const char *BADFORMAT2 = \".www\";\n \n \tstatic const char *ADDR1 = \"127.0.0.2\";\n \n@@ -1043,6 +1054,10 @@ static enum ast_test_result_state off_nominal_test(struct ast_test *test,\n \t\t{ DOMAIN2, ns_t_a,    ns_c_in, ns_r_nxdomain },\n \t\t{ DOMAIN1, ns_t_aaaa, ns_c_in, ns_r_noerror },\n \t\t{ DOMAIN1, ns_t_a,    ns_c_chaos, ns_r_refused },\n+\t\t{ BADFORMAT1, ns_t_a,   ns_c_in, ns_r_formerr },\n+\t\t{ BADFORMAT2, ns_t_a,   ns_c_in, ns_r_formerr },\n+\t\t{ BADFORMAT1, ns_t_ptr, ns_c_in, ns_r_formerr },\n+\t\t{ BADFORMAT2, ns_t_ptr, ns_c_in, ns_r_formerr },\n \t};\n \n \tinet_pton(AF_INET,  ADDR1, addr1_buf);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/asterisk/asterisk/commits/a15050650abf09c10a3c135fab148220cd41d3a0",
        "url": "https://api.github.com/repos/asterisk/asterisk/commits/a15050650abf09c10a3c135fab148220cd41d3a0",
        "html_url": "https://github.com/asterisk/asterisk/commit/a15050650abf09c10a3c135fab148220cd41d3a0",
        "message": "res_resolver_unbound: Test for NULL ub_result in unbound_resolver_callback\n\nThe ub_result pointer passed to unbound_resolver_callback by\nlibunbound can be NULL if the query was for something malformed\nlike `.1` or `[.1]`.  If it is, we now set a 'ns_r_formerr' result\nand return instead of crashing with a SEGV.  This causes pjproject\nto simply cancel the transaction with a \"No answer record in the DNS\nresponse\" error.  The existing \"off nominal\" unit test was also\nupdated to check this condition.\n\nAlthough not necessary for this fix, we also made\nast_dns_resolver_completed() tolerant of a NULL result.\n\nResolves: GHSA-v428-g3cw-7hv9",
        "files": [
            {
                "sha": "7f3f2b6556f2e587d140dbff7fe00327fb57abc9",
                "filename": "main/dns_core.c",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/asterisk/asterisk/blob/a15050650abf09c10a3c135fab148220cd41d3a0/main%2Fdns_core.c",
                "raw_url": "https://github.com/asterisk/asterisk/raw/a15050650abf09c10a3c135fab148220cd41d3a0/main%2Fdns_core.c",
                "contents_url": "https://api.github.com/repos/asterisk/asterisk/contents/main%2Fdns_core.c?ref=a15050650abf09c10a3c135fab148220cd41d3a0",
                "patch": "@@ -598,7 +598,9 @@ static void sort_result(int rr_type, struct ast_dns_result *result)\n \n void ast_dns_resolver_completed(struct ast_dns_query *query)\n {\n-\tsort_result(ast_dns_query_get_rr_type(query), query->result);\n+\tif (query->result) {\n+\t\tsort_result(ast_dns_query_get_rr_type(query), query->result);\n+\t}\n \n \tquery->callback(query);\n }"
            },
            {
                "sha": "d0564b6ad2365413d3014d5fe62a4c850cf767d0",
                "filename": "res/res_resolver_unbound.c",
                "status": "modified",
                "additions": 16,
                "deletions": 1,
                "changes": 17,
                "blob_url": "https://github.com/asterisk/asterisk/blob/a15050650abf09c10a3c135fab148220cd41d3a0/res%2Fres_resolver_unbound.c",
                "raw_url": "https://github.com/asterisk/asterisk/raw/a15050650abf09c10a3c135fab148220cd41d3a0/res%2Fres_resolver_unbound.c",
                "contents_url": "https://api.github.com/repos/asterisk/asterisk/contents/res%2Fres_resolver_unbound.c?ref=a15050650abf09c10a3c135fab148220cd41d3a0",
                "patch": "@@ -257,6 +257,14 @@ static void unbound_resolver_callback(void *data, int err, struct ub_result *ub_\n {\n \tstruct ast_dns_query *query = data;\n \n+\tif (!ub_result) {\n+\t\tast_debug(3, \"Badly formatted DNS query '%s'\\n\", ast_dns_query_get_name(query));\n+\t\tast_dns_resolver_set_result(query, 0, 0, ns_r_formerr, ast_dns_query_get_name(query), \"\", 0);\n+\t\tast_dns_resolver_completed(query);\n+\t\tao2_ref(query, -1);\n+\t\treturn;\n+\t}\n+\n \tif (!ast_dns_resolver_set_result(query, ub_result->secure, ub_result->bogus, ub_result->rcode,\n \t\tS_OR(ub_result->canonname, ast_dns_query_get_name(query)), ub_result->answer_packet, ub_result->answer_len)) {\n \t\tint i;\n@@ -893,7 +901,8 @@ static int off_nominal_sync_run(struct ast_test *test, const char *domain, int r\n \t}\n \n \tif (ast_dns_result_get_rcode(result) != expected_rcode) {\n-\t\tast_test_status_update(test, \"Unexpected rcode from DNS resolution\\n\");\n+\t\tast_test_status_update(test, \"Unexpected rcode '%d' (expected '%d') from DNS resolution of '%s' class: '%d' type: '%d'\\n\",\n+\t\t\tast_dns_result_get_rcode(result), expected_rcode, domain, rr_class, rr_type);\n \t\tres = -1;\n \t}\n \n@@ -1022,6 +1031,8 @@ static enum ast_test_result_state off_nominal_test(struct ast_test *test,\n \n \tstatic const char *DOMAIN1 = \"goose.feathers\";\n \tstatic const char *DOMAIN2 = \"duck.feathers\";\n+\tstatic const char *BADFORMAT1 = \".1\";\n+\tstatic const char *BADFORMAT2 = \".www\";\n \n \tstatic const char *ADDR1 = \"127.0.0.2\";\n \n@@ -1043,6 +1054,10 @@ static enum ast_test_result_state off_nominal_test(struct ast_test *test,\n \t\t{ DOMAIN2, ns_t_a,    ns_c_in, ns_r_nxdomain },\n \t\t{ DOMAIN1, ns_t_aaaa, ns_c_in, ns_r_noerror },\n \t\t{ DOMAIN1, ns_t_a,    ns_c_chaos, ns_r_refused },\n+\t\t{ BADFORMAT1, ns_t_a,   ns_c_in, ns_r_formerr },\n+\t\t{ BADFORMAT2, ns_t_a,   ns_c_in, ns_r_formerr },\n+\t\t{ BADFORMAT1, ns_t_ptr, ns_c_in, ns_r_formerr },\n+\t\t{ BADFORMAT2, ns_t_ptr, ns_c_in, ns_r_formerr },\n \t};\n \n \tinet_pton(AF_INET,  ADDR1, addr1_buf);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/asterisk/asterisk/commits/7a0090325bfa9d778a39ae5f7d0a98109e4651c8",
        "url": "https://api.github.com/repos/asterisk/asterisk/commits/7a0090325bfa9d778a39ae5f7d0a98109e4651c8",
        "html_url": "https://github.com/asterisk/asterisk/commit/7a0090325bfa9d778a39ae5f7d0a98109e4651c8",
        "message": "manager.c: Add entries to Originate blacklist\n\nAdded Reload and DBdeltree to the list of dialplan application that\ncan't be executed via the Originate manager action without also\nhaving write SYSTEM permissions.\n\nAdded CURL, DB*, FILE, ODBC and REALTIME* to the list of dialplan\nfunctions that can't be executed via the Originate manager action\nwithout also having write SYSTEM permissions.\n\nIf the Queue application is attempted to be run by the Originate\nmanager action and an AGI parameter is specified in the app data,\nit'll be rejected unless the manager user has either the AGI or\nSYSTEM permissions.\n\nResolves: #GHSA-c4cg-9275-6w44",
        "files": [
            {
                "sha": "0d927985db0c1ddd127c1850d4bede8c881bc124",
                "filename": "main/manager.c",
                "status": "modified",
                "additions": 141,
                "deletions": 20,
                "changes": 161,
                "blob_url": "https://github.com/asterisk/asterisk/blob/7a0090325bfa9d778a39ae5f7d0a98109e4651c8/main%2Fmanager.c",
                "raw_url": "https://github.com/asterisk/asterisk/raw/7a0090325bfa9d778a39ae5f7d0a98109e4651c8/main%2Fmanager.c",
                "contents_url": "https://api.github.com/repos/asterisk/asterisk/contents/main%2Fmanager.c?ref=7a0090325bfa9d778a39ae5f7d0a98109e4651c8",
                "patch": "@@ -5863,6 +5863,145 @@ static int action_aocmessage(struct mansession *s, const struct message *m)\n \treturn 0;\n }\n \n+struct originate_permissions_entry {\n+\tconst char *search;\n+\tint permission;\n+\tint (*searchfn)(const char *app, const char *data, const char *search);\n+};\n+\n+/*!\n+ * \\internal\n+ * \\brief Check if the application is allowed for Originate\n+ *\n+ * \\param app The \"app\" parameter\n+ * \\param data The \"appdata\" parameter (ignored)\n+ * \\param search The search string\n+ * \\retval 1 Match\n+ * \\retval 0 No match\n+ */\n+static int app_match(const char *app, const char *data, const char *search)\n+{\n+\t/*\n+\t * We use strcasestr so we don't have to trim any blanks\n+\t * from the front or back of the string.\n+\t */\n+\treturn !!(strcasestr(app, search));\n+}\n+\n+/*!\n+ * \\internal\n+ * \\brief Check if the appdata is allowed for Originate\n+ *\n+ * \\param app The \"app\" parameter (ignored)\n+ * \\param data The \"appdata\" parameter\n+ * \\param search The search string\n+ * \\retval 1 Match\n+ * \\retval 0 No match\n+ */\n+static int appdata_match(const char *app, const char *data, const char *search)\n+{\n+\treturn !!(strstr(data, search));\n+}\n+\n+/*!\n+ * \\internal\n+ * \\brief Check if the Queue application is allowed for Originate\n+ *\n+ * It's only allowed if there's no AGI parameter set\n+ *\n+ * \\param app The \"app\" parameter\n+ * \\param data The \"appdata\" parameter\n+ * \\param search The search string\n+ * \\retval 1 Match\n+ * \\retval 0 No match\n+ */\n+static int queue_match(const char *app, const char *data, const char *search)\n+{\n+\tchar *parse;\n+\tAST_DECLARE_APP_ARGS(args,\n+\t\tAST_APP_ARG(queuename);\n+\t\tAST_APP_ARG(options);\n+\t\tAST_APP_ARG(url);\n+\t\tAST_APP_ARG(announceoverride);\n+\t\tAST_APP_ARG(queuetimeoutstr);\n+\t\tAST_APP_ARG(agi);\n+\t\tAST_APP_ARG(gosub);\n+\t\tAST_APP_ARG(rule);\n+\t\tAST_APP_ARG(position);\n+\t);\n+\n+\tif (!strcasestr(app, \"queue\")) {\n+\t\treturn 0;\n+\t}\n+\n+\tparse = ast_strdupa(data);\n+\tAST_STANDARD_APP_ARGS(args, parse);\n+\n+\t/*\n+\t * The Queue application is fine unless the AGI parameter is set.\n+\t * If it is, we need to check the user's permissions.\n+\t */\n+\treturn !ast_strlen_zero(args.agi);\n+}\n+\n+/*\n+ * The Originate application and application data are passed\n+ * to each searchfn in the list.  If a searchfn returns true\n+ * and the user's permissions don't include the permissions specified\n+ * in the list entry, the Originate action will be denied.\n+ *\n+ * If no searchfn returns true, the Originate action is allowed.\n+ */\n+static struct originate_permissions_entry originate_app_permissions[] = {\n+\t/*\n+\t * The app_match function checks if the search string is\n+\t * anywhere in the app parameter.  The check is case-insensitive.\n+\t */\n+\t{ \"agi\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"dbdeltree\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"exec\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"externalivr\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"mixmonitor\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"originate\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"reload\", EVENT_FLAG_SYSTEM, app_match },\n+\t{ \"system\", EVENT_FLAG_SYSTEM, app_match },\n+\t/*\n+\t * Since the queue_match function specifically checks\n+\t * for the presence of the AGI parameter, we'll allow\n+\t * the call if the user has either the AGI or SYSTEM\n+\t * permission.\n+\t */\n+\t{ \"queue\", EVENT_FLAG_AGI | EVENT_FLAG_SYSTEM, queue_match },\n+\t/*\n+\t * The appdata_match function checks if the search string is\n+\t * anywhere in the appdata parameter.  Unlike app_match,\n+\t * the check is case-sensitive.  These are generally\n+\t * dialplan functions.\n+\t */\n+\t{ \"CURL\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"DB\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"EVAL\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"FILE\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"ODBC\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"REALTIME\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ \"SHELL\", EVENT_FLAG_SYSTEM, appdata_match },\n+\t{ NULL, 0 },\n+};\n+\n+static int is_originate_app_permitted(const char *app, const char *data,\n+\tint permission)\n+{\n+\tint i;\n+\n+\tfor (i = 0; originate_app_permissions[i].search; i++) {\n+\t\tif (originate_app_permissions[i].searchfn(app, data, originate_app_permissions[i].search)) {\n+\t\t\treturn !!(permission & originate_app_permissions[i].permission);\n+\t\t}\n+\t}\n+\n+\treturn 1;\n+}\n+\n static int action_originate(struct mansession *s, const struct message *m)\n {\n \tconst char *name = astman_get_header(m, \"Channel\");\n@@ -5954,26 +6093,8 @@ static int action_originate(struct mansession *s, const struct message *m)\n \t}\n \n \tif (!ast_strlen_zero(app) && s->session) {\n-\t\tint bad_appdata = 0;\n-\t\t/* To run the System application (or anything else that goes to\n-\t\t * shell), you must have the additional System privilege */\n-\t\tif (!(s->session->writeperm & EVENT_FLAG_SYSTEM)\n-\t\t\t&& (\n-\t\t\t\tstrcasestr(app, \"system\") ||      /* System(rm -rf /)\n-\t\t\t\t                                     TrySystem(rm -rf /)       */\n-\t\t\t\tstrcasestr(app, \"exec\") ||        /* Exec(System(rm -rf /))\n-\t\t\t\t                                     TryExec(System(rm -rf /)) */\n-\t\t\t\tstrcasestr(app, \"agi\") ||         /* AGI(/bin/rm,-rf /)\n-\t\t\t\t                                     EAGI(/bin/rm,-rf /)       */\n-\t\t\t\tstrcasestr(app, \"mixmonitor\") ||  /* MixMonitor(blah,,rm -rf)  */\n-\t\t\t\tstrcasestr(app, \"externalivr\") || /* ExternalIVR(rm -rf)       */\n-\t\t\t\tstrcasestr(app, \"originate\") ||   /* Originate(Local/1234,app,System,rm -rf) */\n-\t\t\t\t(strstr(appdata, \"SHELL\") && (bad_appdata = 1)) ||       /* NoOp(${SHELL(rm -rf /)})  */\n-\t\t\t\t(strstr(appdata, \"EVAL\") && (bad_appdata = 1))           /* NoOp(${EVAL(${some_var_containing_SHELL})}) */\n-\t\t\t\t)) {\n-\t\t\tchar error_buf[64];\n-\t\t\tsnprintf(error_buf, sizeof(error_buf), \"Originate Access Forbidden: %s\", bad_appdata ? \"Data\" : \"Application\");\n-\t\t\tastman_send_error(s, m, error_buf);\n+\t\tif (!is_originate_app_permitted(app, appdata, s->session->writeperm)) {\n+\t\t\tastman_send_error(s, m, \"Originate Access Forbidden: app or data blacklisted\");\n \t\t\tres = 0;\n \t\t\tgoto fast_orig_cleanup;\n \t\t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mindsdb/mindsdb/commits/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
        "url": "https://api.github.com/repos/mindsdb/mindsdb/commits/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
        "html_url": "https://github.com/mindsdb/mindsdb/commit/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
        "message": "Release v23.12.4.2 (#8573)\n\n* Refactor API call in InstatusHandler and fix JSON\r\ndecoding in StatusPages\r\n\r\n* Add support for Instatus components table SELECT,\r\nINSERT, and UPDATE operations\r\n\r\n* formatted according to PEP 8\r\n\r\n* fix insert\r\n\r\n* Update component translations in Instatus handler\r\n\r\n* adds flattened structure for each langCodes\r\n\r\n* Add new GitHub Loader llama_index Handler\r\n\r\n* Add Github and Youtube Loader\r\n\r\n* Remove old handler update existing\r\n\r\n* [refactor] Migrate legacy OpenAI API (#8541)\r\n\r\n* openai migrate\r\n\r\n* create and predict works perfectly\r\n\r\n* describe workinf, requirements updated\r\n\r\n* fintune modefyed\r\n\r\n* fintune modified\r\n\r\n* Updated fintune with new function\r\n\r\n* updated _get_ft_model_type\r\n\r\n* fix broken unit test\r\n\r\n* All things working\r\n\r\n* fixes for finetuning\r\n\r\n* remove redundant code\r\n\r\n* removed unneccesary self.ft_cls\r\n\r\n* fix finetuning\r\n\r\n* fix exception handling + args for completion\r\n\r\n* anyscale endpoints migration to new openai API\r\n\r\n* bump openai requirements\r\n\r\n* fix for langchain\r\n\r\n* fix for langchain sql completion\r\n\r\n* update llama_index handler to work with openai sdk 1.6.1\r\n\r\n* tests successfully pass with langchain_embeddings_handler\r\n\r\n* tests pass with rag_handler\r\n\r\n---------\r\n\r\nCo-authored-by: dusvyat <13661123+dusvyat@users.noreply.github.com>\r\nCo-authored-by: Patricio Cerda Mardini <patricio.mardini@mindsdb.com>\r\n\r\n* fix bare except\r\n\r\n* Update get_api_key util\r\n\r\n* Revert \"Remove old handler update existing\"\r\n\r\nThis reverts commit 7d98c4b84896f6a8a82f1b63559b827bb1d1a34c.\r\n\r\n* remove new handler upsate existing one\r\n\r\n* revert changes in handler_utils\r\n\r\n* improved anyscale routines for jsonl checking + minor bug fixes for new API\r\n\r\n* fix for ft file info retrieval\r\n\r\n* bump to 23.12.4.2 for release (#8574)\r\n\r\n---------\r\n\r\nCo-authored-by: ritwickrajmakhal <ritwickrajmakhal11@gmail.com>\r\nCo-authored-by: Pranav <pranavprajapati586@gmail.com>\r\nCo-authored-by: Parthiv Makwana <75653580+parthiv11@users.noreply.github.com>\r\nCo-authored-by: Patricio Cerda Mardini <patricio.mardini@mindsdb.com>\r\nCo-authored-by: Pranav Prajapati <94780581+pranavvp16@users.noreply.github.com>\r\nCo-authored-by: Minura Punchihewa <49385643+MinuraPunchihewa@users.noreply.github.com>",
        "files": [
            {
                "sha": "772bdb73d4eb9d20b544b8e8a6c79cacb3a3a4fc",
                "filename": "mindsdb/__about__.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2F__about__.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2F__about__.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2F__about__.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,6 +1,6 @@\n __title__ = 'MindsDB'\n __package_name__ = 'mindsdb'\n-__version__ = '23.12.4.1'\n+__version__ = '23.12.4.2'\n __description__ = \"MindsDB server, provides server capabilities to mindsdb native python library\"\n __email__ = \"jorge@mindsdb.com\"\n __author__ = 'MindsDB Inc'"
            },
            {
                "sha": "b9ea96992592635e80b0f4aa0ae5fb27bc19da95",
                "filename": "mindsdb/integrations/handlers/anyscale_endpoints_handler/anyscale_endpoints_handler.py",
                "status": "modified",
                "additions": 44,
                "deletions": 14,
                "changes": 58,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fanyscale_endpoints_handler%2Fanyscale_endpoints_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fanyscale_endpoints_handler%2Fanyscale_endpoints_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fanyscale_endpoints_handler%2Fanyscale_endpoints_handler.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,6 +1,6 @@\n import os\n-import json\n import openai\n+import json\n import contextlib\n from typing import Optional, Dict\n \n@@ -32,7 +32,6 @@ def __init__(self, *args, **kwargs):\n         self.rate_limit = 25  # requests per minute\n         self.max_batch_size = 20\n         self.default_max_tokens = 100\n-        self.ft_cls = openai.FineTuningJob  # non-legacy fine-tuning endpoint\n \n     @staticmethod\n     @contextlib.contextmanager\n@@ -47,24 +46,25 @@ def _anyscale_base_api(key='OPENAI_API_BASE'):\n \n     def create(self, target, args=None, **kwargs):\n         with self._anyscale_base_api():\n+            # load base and fine-tuned models, then hand over\n             self._set_models(args.get('using', {}))\n-\n-            # load fine-tuned models, then hand over\n             _args = self.model_storage.json_get('args')\n             base_models = self.chat_completion_models\n             self.chat_completion_models = _args.get('chat_completion_models', base_models) if _args else base_models\n             super().create(target, args, **kwargs)\n \n     def predict(self, df: pd.DataFrame, args: Optional[Dict] = None) -> pd.DataFrame:\n         with self._anyscale_base_api():\n-            # load fine-tuned models, then hand over\n+            # load base and fine-tuned models, then hand over\n+            self._set_models(args.get('using', {}))\n             _args = self.model_storage.json_get('args')\n             base_models = self.chat_completion_models\n             self.chat_completion_models = _args.get('chat_completion_models', base_models) if _args else base_models\n             return super().predict(df, args)\n \n     def finetune(self, df: Optional[pd.DataFrame] = None, args: Optional[Dict] = None) -> None:\n         with self._anyscale_base_api():\n+            self._set_models(args.get('using', {}))\n             super().finetune(df, args)\n             # rewrite chat_completion_models to include the newly fine-tuned model\n             args = self.model_storage.json_get('args')\n@@ -90,11 +90,10 @@ def describe(self, attribute: Optional[str] = None) -> pd.DataFrame:\n     def _set_models(self, args):\n         if 'api_key' in args:\n             args['openai_api_key'] = args['api_key']  # remove this once #7496 is fixed\n-        self.all_models = [m['id'] for m in openai.Model.list(\n-            api_key=get_api_key('openai', args, self.engine_storage),\n-            api_base=ANYSCALE_API_BASE)['data']]\n-        self.chat_completion_models = self.all_models\n-        self.supported_ft_models = self.all_models  # base models compatible with fine-tuning\n+        client = self._get_client(get_api_key('openai', args, self.engine_storage))\n+        self.all_models = [m.id for m in client.models.list()]\n+        self.chat_completion_models = [m.id for m in client.models.list() if m.rayllm_metadata['engine_config']['model_type'] == 'text-generation']  # noqa\n+        self.supported_ft_models = self.chat_completion_models  # base models compatible with fine-tuning\n \n     @staticmethod\n     def _check_ft_cols(df, cols):\n@@ -107,19 +106,46 @@ def _prepare_ft_jsonl(self, df, temp_storage_path, temp_filename, _, test_size=0\n             df: has exactly two columns, `role` and `content`. Rows contain >= 1 chats in long (stacked) format.\n             For more details, check `FineTuning -> Data Format` in the Anyscale API reference.\n         \"\"\"\n+        def _is_valid(chat):\n+            \"\"\" Check if chat is valid according to Anyscale criteria.\"\"\"\n+            roles = [m['role'] for m in chat]\n+            transitions = {None: ['system', 'user'], 'system': ['user'], 'user': ['assistant'], 'assistant': ['user']}\n+\n+            # check base condition\n+            if not ('user' in roles and 'assistant' in roles):\n+                return False\n+\n+            # check order is valid\n+            state = None\n+            for role in roles:\n+                if role not in transitions[state]:\n+                    return False\n+                else:\n+                    state = role\n+\n+            # chat is valid, return\n+            return True\n+\n         # 1. aggregate each chat sequence into one row\n         chats = []\n         chat = []\n         for i, row in df.iterrows():\n             if row['role'] == 'system' and len(chat) > 0:\n-                chats.append({'messages': chat})\n+                if _is_valid(chat):\n+                    chats.append({'messages': chat})\n                 chat = []\n             event = {'role': row['role'], 'content': row['content']}\n             chat.append(event)\n-        chats.append({'messages': chat})\n+\n+        if _is_valid(chat):\n+            chats.append({'messages': chat})\n+\n         series = pd.Series(chats)\n-        train = series.iloc[:int(len(series) * (1 - test_size))]\n-        val = series.iloc[-int(len(series) * test_size) - 1:]\n+        if len(series) < 20 * 2:\n+            raise Exception(\"Dataset is too small to finetune. Please include at least 40 samples (complete chats).\")\n+        val_size = max(20, int(len(series) * test_size))  # at least 20 samples required by Anyscale\n+        train = series.iloc[:-val_size]\n+        val = series.iloc[-val_size:]\n \n         # 2. write as jsonl\n         file_names = {\n@@ -190,3 +216,7 @@ def check_data_for_format_errors(items: list):\n             check_data_for_format_errors(items)\n         except Exception as e:\n             raise Exception(f\"Fine-tuning data format is not valid. Got: {e}\")\n+\n+    @staticmethod\n+    def _get_client(api_key, base_url=ANYSCALE_API_BASE, org=None):\n+        return openai.OpenAI(api_key=api_key, base_url=base_url, organization=org)"
            },
            {
                "sha": "e7e543c3853828f628bd9f7f0593786bb4d492d5",
                "filename": "mindsdb/integrations/handlers/anyscale_endpoints_handler/requirements.txt",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fanyscale_endpoints_handler%2Frequirements.txt",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fanyscale_endpoints_handler%2Frequirements.txt",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fanyscale_endpoints_handler%2Frequirements.txt?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,2 +1,2 @@\n-openai == 0.28.1\n+openai == 1.6.1\n -r mindsdb/integrations/handlers/openai_handler/requirements.txt"
            },
            {
                "sha": "f6b2a098a77a00fe5800f2c9bc8cd2094aceed5d",
                "filename": "mindsdb/integrations/handlers/instatus_handler/README.md",
                "status": "modified",
                "additions": 101,
                "deletions": 41,
                "changes": 142,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Finstatus_handler%2FREADME.md",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Finstatus_handler%2FREADME.md",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Finstatus_handler%2FREADME.md?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -17,11 +17,49 @@ Please follow this [link](https://dashboard.instatus.com/developer) to get the a\n ## Implemented Features\n \n - [x] Instatus status pages table\n-  - [x] Get status pages\n-  - [x] Create a status page\n-  - [x] Update a status page\n-\n-## Example Usage\n+  - [x] Support SELECT\n+  - [x] Support INSERT\n+  - [x] Support UPDATE\n+- [x] Instatus components table\n+  - [x] Support SELECT\n+  - [x] Support INSERT\n+  - [x] Support UPDATE\n+\n+## TODO\n+- [ ] Instatus Incidents table\n+  - [ ] Support SELECT\n+  - [ ] Support INSERT\n+  - [ ] Support UPDATE\n+- [ ] Instatus Incidents updates table\n+  - [ ] Support SELECT\n+  - [ ] Support INSERT\n+  - [ ] Support UPDATE\n+- [ ] Instatus Maintenances table\n+  - [ ] Support SELECT\n+  - [ ] Support INSERT\n+  - [ ] Support UPDATE\n+- [ ] Instatus Maintenance updates table\n+  - [ ] Support SELECT\n+  - [ ] Support INSERT\n+  - [ ] Support UPDATE\n+- [ ] Instatus Templates table\n+  - [ ] Support SELECT\n+  - [ ] Support INSERT\n+  - [ ] Support UPDATE\n+- [ ] Instatus Teammates table\n+  - [ ] Support SELECT\n+  - [ ] Support INSERT\n+  - [ ] Support UPDATE\n+- [ ] Instatus Subscribers table\n+  - [ ] Support SELECT\n+  - [ ] Support INSERT\n+  - [ ] Support UPDATE\n+- [ ] Instatus Metrics table\n+  - [ ] Support SELECT\n+  - [ ] Support INSERT\n+  - [ ] Support UPDATE\n+\n+## Connection\n \n The first step is to create a database with the new `instatus` engine.\n \n@@ -33,47 +71,24 @@ WITH\n     \"api_key\": \"<your-instatus-api-key>\" --- Instatus API key to use for authentication.\n   };\n ```\n+## Usage (Status pages table)\n \n-### Get your status pages\n-\n-Example 1: Select all columns\n+### SELECT\n \n ```sql\n SELECT *\n FROM mindsdb_instatus.status_pages;\n ```\n \n-Example 2: Select specific columns\n-\n-```sql\n-SELECT id, name, status\n-FROM mindsdb_instatus.status_pages;\n-```\n-\n-Example 3: Get specific status page\n+### WHERE\n \n ```sql\n SELECT *\n FROM mindsdb_instatus.status_pages\n WHERE id = '<status-page-id>';\n ```\n \n-Example 4: Apply limit\n-\n-```sql\n-SELECT *\n-FROM mindsdb_instatus.status_pages\n-LIMIT 10;\n-```\n-\n-### Create a status page\n-\n-```sql\n-INSERT INTO mindsdb_instatus.status_pages (column1, column2, column3, ...)\n-VALUES (value1, value2, value3, ...);\n-```\n-\n-Example:\n+### INSERT\n \n ```sql\n INSERT INTO mindsdb_instatus.status_pages (email, name, subdomain, components, logoUrl, faviconUrl, websiteUrl, language, useLargeHeader, brandColor, okColor, disruptedColor, degradedColor, downColor, noticeColor, unknownColor, googleAnalytics, subscribeBySms, smsService, twilioSid, twilioToken, twilioSender, nexmoKey, nexmoSecret, nexmoSender, htmlInMeta, htmlAboveHeader, htmlBelowHeader, htmlAboveFooter, htmlBelowFooter, htmlBelowSummary, cssGlobal, launchDate, dateFormat, dateFormatShort, timeFormat)\n@@ -88,15 +103,7 @@ Note:\n - `components` is required field (Example: '[\"Website\", \"App\", \"API\"]')\n - other fields are optional\n \n-### Update a status page\n-\n-```sql\n-UPDATE mindsdb_instatus.status_pages\n-SET column1 = value1, column2 = value2, ...\n-WHERE id = '<status-page-id>';\n-```\n-\n-Example:\n+### UPDATE\n \n ```sql\n UPDATE mindsdb_instatus.status_pages\n@@ -145,3 +152,56 @@ SET name = 'mindsdb',\n     }'\n WHERE id = '<status-page-id>';\n ```\n+\n+## Usage (Components table)\n+\n+### SELECT\n+\n+```sql\n+SELECT *\n+FROM mindsdb_instatus.components\n+WHERE page_id = '<status-page-id>';\n+```\n+\n+### WHERE\n+\n+```sql\n+SELECT *\n+FROM mindsdb_instatus.components\n+WHERE page_id = '<status-page-id>'\n+AND component_id = '<component-id>';\n+```\n+\n+### CREATE\n+\n+```sql\n+INSERT INTO mindsdb_instatus.components (page_id, name, description, status, order, showUptime, grouped, translations_name_in_fr, translations_desc_in_fr)\n+VALUES (\n+  '<page-id>',\n+  'Test component',\n+  'Testing',\n+  'OPERATIONAL',\n+  6,\n+  true,\n+  false,\n+  \"Composant de test\",\n+  \"En test\"\n+);\n+```\n+\n+### UPDATE\n+\n+```sql\n+UPDATE mindsdb_instatus.components\n+SET\n+  name = 'Test component 4',\n+  description = 'Test test test',\n+  status = 'OPERATIONAL',\n+  order = 6,\n+  showUptime = true,\n+  grouped = false,\n+  translations_name_in_fr = \"Composant de test 4\",\n+  translations_desc_in_fr = \"Test test test\"\n+WHERE page_id = '<status-page-id>'\n+AND component_id = '<component-id>';\n+```"
            },
            {
                "sha": "77027eefdede16e754fe8fd7adf79526147a91a8",
                "filename": "mindsdb/integrations/handlers/instatus_handler/instatus_handler.py",
                "status": "modified",
                "additions": 5,
                "deletions": 9,
                "changes": 14,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Finstatus_handler%2Finstatus_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Finstatus_handler%2Finstatus_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Finstatus_handler%2Finstatus_handler.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,4 +1,4 @@\n-from mindsdb.integrations.handlers.instatus_handler.instatus_tables import StatusPages\n+from mindsdb.integrations.handlers.instatus_handler.instatus_tables import StatusPages, Components\n from mindsdb.integrations.libs.api_handler import APIHandler\n from mindsdb.integrations.libs.response import HandlerStatusResponse as StatusResponse\n from mindsdb.utilities import log\n@@ -31,6 +31,7 @@ def __init__(self, name: str, **kwargs) -> None:\n \n         _tables = [\n             StatusPages,\n+            Components\n         ]\n \n         for Table in _tables:\n@@ -91,7 +92,7 @@ def native_query(self, query: str) -> StatusResponse:\n         ast = parse_sql(query, dialect=\"mindsdb\")\n         return self.query(ast)\n \n-    def call_instatus_api(self, endpoint: str, method: str = 'GET', params: dict = None, data=None) -> pd.DataFrame:\n+    def call_instatus_api(self, endpoint: str, method: str = 'GET', params: dict = None, json_data: dict = {}) -> pd.DataFrame:\n         if not params:\n             params = {}\n \n@@ -101,16 +102,11 @@ def call_instatus_api(self, endpoint: str, method: str = 'GET', params: dict = N\n         if method.upper() in ('GET', 'POST', 'PUT', 'DELETE'):\n             headers['Content-Type'] = 'application/json'\n \n-            if method.upper() in ('POST', 'PUT', 'DELETE'):\n-                response = requests.request(method, url, headers=headers, params=params, data=data)\n-            else:\n-                response = requests.get(url, headers=headers, params=params)\n+            response = requests.request(method, url, headers=headers, params=params, json=json_data)\n \n             if response.status_code == 200:\n                 data = response.json()\n-                return pd.DataFrame(data) if isinstance(data, list) else pd.DataFrame({\n-                    'data': data\n-                })\n+                return pd.DataFrame(data) if isinstance(data, list) else pd.DataFrame([data])\n             else:\n                 raise Exception(f\"Error connecting to Instatus API: {response.status_code} - {response.text}\")\n "
            },
            {
                "sha": "8017e0486860d6199ca4ef07d618a0ba1bdec643",
                "filename": "mindsdb/integrations/handlers/instatus_handler/instatus_tables.py",
                "status": "modified",
                "additions": 231,
                "deletions": 7,
                "changes": 238,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Finstatus_handler%2Finstatus_tables.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Finstatus_handler%2Finstatus_tables.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Finstatus_handler%2Finstatus_tables.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -5,6 +5,11 @@\n from mindsdb.integrations.utilities.sql_utils import extract_comparison_conditions\n from mindsdb_sql.parser.ast.select.constant import Constant\n import json\n+import re\n+\n+langCodes = [\"ar\", \"cs\", \"da\", \"de\", \"en\", \"es\", \"et\", \"fi\", \"fr\", \"hu\", \"id\", \"it\", \"ja\", \"ko\",\n+             \"nl\", \"no\", \"pl\", \"pt\", \"pt-BR\", \"ro\", \"rs\", \"ru\", \"sl\", \"sq\", \"sv\", \"tr\", \"uk\",\n+             \"vi\", \"zh\", \"zh-TW\"]\n \n \n class StatusPages(APITable):\n@@ -87,11 +92,16 @@ def insert(self, query: ast.Insert) -> None:\n         \"\"\"\n         data = {}\n         for column, value in zip(query.columns, query.values[0]):\n-            if isinstance(value, Constant):\n-                data[column.name] = value.value\n-            else:\n-                data[column.name] = value\n-        self.handler.call_instatus_api(endpoint='/v1/pages', method='POST', data=json.dumps(data))\n+            if isinstance(value, str):\n+                try:\n+                    value = json.loads(value)\n+                except json.JSONDecodeError:\n+                    if value == 'True':\n+                        value = True\n+                    elif value == 'False':\n+                        value = False\n+            data[column.name] = value\n+        self.handler.call_instatus_api(endpoint='/v1/pages', method='POST', json_data=data)\n \n     def update(self, query: ast.Update) -> None:\n         \"\"\"Receive query as AST (abstract syntax tree) and act upon it somehow.\n@@ -114,10 +124,14 @@ def update(self, query: ast.Update) -> None:\n         for key, value in query.update_columns.items():\n             if isinstance(value, Constant):\n                 if key == 'components':\n-                    data[key] = json.loads(value.value)  # Convert 'components' value to a Python list\n+                    data[key] = json.loads(value.value)\n                 else:\n                     data[key] = value.value\n-        self.handler.call_instatus_api(endpoint=f'/v2/{_id}', method='PUT', data=json.dumps(data))\n+\n+        if 'components' in data and isinstance(data['components'], str):\n+            data['components'] = json.loads(data['components'])\n+\n+        self.handler.call_instatus_api(endpoint=f'/v2/{_id}', method='PUT', json_data=data)\n \n     def get_columns(self, ignore: List[str] = []) -> List[str]:\n         \"\"\"columns\n@@ -167,3 +181,213 @@ def get_columns(self, ignore: List[str] = []) -> List[str]:\n             \"createdAt\",\n             \"updatedAt\"\n         ]\n+\n+\n+class Components(APITable):\n+\n+    # table name in the database\n+    name = 'components'\n+\n+    def select(self, query: ast.Select) -> pd.DataFrame:\n+        \"\"\"Receive query as AST (abstract syntax tree) and act upon it.\n+\n+        Args:\n+            query (ASTNode): SQL query represented as AST. Usually it should be ast.Select\n+\n+        Returns:\n+            pd.DataFrame\n+        \"\"\"\n+        conditions = extract_comparison_conditions(query.where)\n+\n+        if len(conditions) == 0:\n+            raise Exception('WHERE clause is required')\n+\n+        # Get page id and component id from query\n+        pageId = None\n+        componentId = None\n+        for condition in conditions:\n+            if condition[1] == 'page_id' and condition[0] == '=':\n+                pageId = condition[2]\n+\n+            if condition[1] == 'component_id' and condition[0] == '=':\n+                componentId = condition[2]\n+\n+        # Get column names from query\n+        selected_columns = []\n+        for target in query.targets:\n+            if isinstance(target, ast.Star):\n+                selected_columns = self.get_columns()\n+                break\n+            elif isinstance(target, ast.Identifier):\n+                selected_columns.append(target.parts[-1])\n+            else:\n+                raise ValueError(f\"Unknown query target {type(target)}\")\n+\n+        limit = query.limit.value if query.limit else None\n+        if componentId:\n+            # Call instatus API and get the response as pd.DataFrame\n+            df = self.handler.call_instatus_api(endpoint=f'/v1/{pageId}/components/{componentId}')\n+            for langCode in langCodes:\n+                try:\n+                    df[f\"translations_name_in_{langCode}\"] = df[\"translations\"].apply(lambda x: x.get(\"name\", None)).apply(lambda x: x.get(langCode, None))\n+                    df[f\"translations_desc_in_{langCode}\"] = df[\"translations\"].apply(lambda x: x.get(\"description\", None)).apply(lambda x: x.get(langCode, None))\n+                except AttributeError:\n+                    df[f\"translations_name_in_{langCode}\"] = None\n+                    df[f\"translations_desc_in_{langCode}\"] = None\n+            df = df.drop(columns=[\"translations\"])\n+\n+            result_df = df[selected_columns]\n+        else:\n+            # Call instatus API and get the response as pd.DataFrame\n+            page_size = 100\n+            # Calculate the number of pages required\n+            page_count = (limit + page_size - 1) // page_size if limit else 1\n+            result_df = pd.DataFrame(columns=selected_columns)\n+\n+            # Call instatus API and get the response as pd.DataFrame for each page\n+            for page in range(1, page_count + 1):\n+                current_page_size = min(page_size, limit) if limit else page_size\n+\n+                df = self.handler.call_instatus_api(endpoint=f'/v1/{pageId}/components', params={'page': page, 'per_page': current_page_size})\n+                # Break if no more data is available or limit is reached\n+                if len(df) == 0 or (limit and limit <= 0) or limit == 0:\n+                    break\n+                ''' Add translations_name_in_{langCode} and translations_desc_in_{langCode} columns to the dataframe'''\n+                for i in range(len(df)):\n+                    for langCode in langCodes:\n+                        try:\n+                            df.at[i, f\"translations_name_in_{langCode}\"] = df.at[i, \"translations\"].get(\"name\", {}).get(langCode, None)\n+                            df.at[i, f\"translations_desc_in_{langCode}\"] = df.at[i, \"translations\"].get(\"description\", {}).get(langCode, None)\n+                        except AttributeError:\n+                            df.at[i, f\"translations_name_in_{langCode}\"] = None\n+                            df.at[i, f\"translations_desc_in_{langCode}\"] = None\n+\n+                # Drop the 'translations' column\n+                df = df.drop(columns=[\"translations\"])\n+                # Concatenate the dataframes\n+                result_df = pd.concat([result_df, df[selected_columns]], ignore_index=True)\n+\n+                if limit:\n+                    limit -= len(df)\n+\n+        return result_df\n+\n+    def insert(self, query: ast.Insert) -> None:\n+        \"\"\"Receive query as AST (abstract syntax tree) and act upon it somehow.\n+\n+        Args:\n+            query (ASTNode): sql query represented as AST. Usually it should be ast.Insert\n+\n+        Returns:\n+            None\n+        \"\"\"\n+        data = {'translations': {\n+            \"name\": {},\n+            \"description\": {}\n+        }}\n+\n+        for column, value in zip(query.columns, query.values[0]):\n+            if isinstance(value, Constant):\n+                data[column.name] = json.loads(value.value) if column.name == 'translations' else value.value\n+            elif isinstance(value, str):\n+                try:\n+                    if re.match(r'^translations_name_in_[a-zA-Z\\-]+$', column.name):\n+                        lang_code = column.name.split('_')[-1]\n+                        if lang_code not in langCodes:\n+                            raise Exception(f'Invalid language code {lang_code}')\n+                        data['translations']['name'][lang_code] = value\n+                    elif re.match(r'^translations_desc_in_[a-zA-Z\\-]+$', column.name):\n+                        lang_code = column.name.split('_')[-1]\n+                        if lang_code not in langCodes:\n+                            raise Exception(f'Invalid language code {lang_code}')\n+                        data['translations']['description'][lang_code] = value\n+                    else:\n+                        data[column.name] = json.loads(value)\n+                except json.JSONDecodeError:\n+                    data[column.name] = True if value == 'True' else (False if value == 'False' else value)\n+\n+        page_id = data.pop('page_id', None)\n+\n+        if page_id is not None:\n+            self.handler.call_instatus_api(endpoint=f'/v1/{page_id}/components', method='POST', json_data=data)\n+\n+    def update(self, query: ast.Update) -> None:\n+        \"\"\"Receive query as AST (abstract syntax tree) and act upon it somehow.\n+\n+        Args:\n+            query (ASTNode): sql query represented as AST. Usually it should be ast.Update\n+        Returns:\n+            None\n+        \"\"\"\n+        conditions = extract_comparison_conditions(query.where)\n+        # Get page id and component id from query\n+        pageId = None\n+        componentId = None\n+        for condition in conditions:\n+            if condition[1] == 'page_id' and condition[0] == '=':\n+                pageId = condition[2]\n+            elif condition[1] == 'component_id' and condition[0] == '=':\n+                componentId = condition[2]\n+            else:\n+                raise Exception(\"page_id and component_id both are required\")\n+\n+        data = {'translations': {\n+            \"name\": {},\n+            \"description\": {}\n+        }}\n+        for key, value in query.update_columns.items():\n+            if isinstance(value, Constant):\n+                if re.match(r'^translations_name_in_[a-zA-Z\\-]+$', key):\n+                    lang_code = key.split('_')[-1]\n+                    if lang_code not in langCodes:\n+                        raise Exception(f'Invalid language code {lang_code}')\n+                    data['translations']['name'][lang_code] = value.value\n+                elif re.match(r'^translations_desc_in_[a-zA-Z\\-]+$', key):\n+                    lang_code = key.split('_')[-1]\n+                    if lang_code not in langCodes:\n+                        raise Exception(f'Invalid language code {lang_code}')\n+                    data['translations']['description'][lang_code] = value.value\n+                else:\n+                    data[key] = value.value\n+        self.handler.call_instatus_api(endpoint=f'/v1/{pageId}/components/{componentId}', method='PUT', json_data=data)\n+\n+    def get_columns(self, ignore: List[str] = []) -> List[str]:\n+        \"\"\"columns\n+\n+        Args:\n+            ignore (List[str], optional): exclusion items. Defaults to [].\n+\n+        Returns:\n+            List[str]: available columns with `ignore` items removed from the list.\n+        \"\"\"\n+        return [\n+            \"id\",\n+            \"name\",\n+            \"nameTranslationId\",\n+            \"description\",\n+            \"descriptionTranslationId\",\n+            \"status\",\n+            \"order\",\n+            \"showUptime\",\n+            \"createdAt\",\n+            \"updatedAt\",\n+            \"archivedAt\",\n+            \"siteId\",\n+            \"uniqueEmail\",\n+            \"oldGroup\",\n+            \"groupId\",\n+            \"isParent\",\n+            \"isCollapsed\",\n+            \"monitorId\",\n+            \"nameHtml\",\n+            \"nameHtmlTranslationId\",\n+            \"descriptionHtml\",\n+            \"descriptionHtmlTranslationId\",\n+            \"isThirdParty\",\n+            \"thirdPartyStatus\",\n+            \"thirdPartyComponentId\",\n+            \"thirdPartyComponentServiceId\",\n+            \"importedFromStatuspage\",\n+            \"startDate\",\n+            \"group\",\n+        ] + [f'translations_name_in_{langCode}' for langCode in langCodes] + [f'translations_desc_in_{langCode}' for langCode in langCodes]"
            },
            {
                "sha": "6676f095893ff791d598c21d406117640c210aab",
                "filename": "mindsdb/integrations/handlers/langchain_embedding_handler/requirements.txt",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Flangchain_embedding_handler%2Frequirements.txt",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Flangchain_embedding_handler%2Frequirements.txt",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Flangchain_embedding_handler%2Frequirements.txt?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,2 +1,2 @@\n-openai == 0.28.1\n+openai == 1.6.1\n tiktoken~=0.4.0"
            },
            {
                "sha": "23818b90eb509cda80a6b1cfd2fd32ed8a7af3b5",
                "filename": "mindsdb/integrations/handlers/langchain_handler/langchain_handler.py",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Flangchain_handler%2Flangchain_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Flangchain_handler%2Flangchain_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Flangchain_handler%2Flangchain_handler.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -184,6 +184,7 @@ def _get_chat_model_params(self, args, pred_args):\n             model_kwargs['best_of'] = pred_args.get('best_of', None)\n             model_kwargs['logit_bias'] = pred_args.get('logit_bias', None)\n             model_kwargs['openai_api_key'] = get_api_key('openai', args, self.engine_storage)\n+            model_kwargs['openai_organization'] = args.get('api_organization', None)\n \n         model_kwargs = {k: v for k, v in model_kwargs.items() if v is not None}  # filter out None values\n         return model_kwargs\n@@ -418,9 +419,9 @@ def finetune(self, df: Optional[pd.DataFrame] = None, args: Optional[Dict] = Non\n     def sql_agent_completion(self, df, args=None, pred_args=None):\n         \"\"\"This completion will be used to answer based on information passed by any MindsDB DB or API engine.\"\"\"\n         db = MindsDBSQL(engine=args['executor'], metadata=args['executor'].session.integration_controller)\n-        toolkit = SQLDatabaseToolkit(db=db)\n         model_name = args.get('model_name', self.default_model)\n-        llm = OpenAI(temperature=0) if model_name not in OPEN_AI_CHAT_MODELS else ChatOpenAI(temperature=0)\n+        llm = OpenAI(temperature=0) if model_name not in OPEN_AI_CHAT_MODELS else self._create_chat_model(args, pred_args)  # noqa\n+        toolkit = SQLDatabaseToolkit(db=db, llm=llm)\n         agent = create_sql_agent(\n             llm=llm,\n             toolkit=toolkit,"
            },
            {
                "sha": "72f4abcfe853045b06e15da56b8d7dd62fa2ed0f",
                "filename": "mindsdb/integrations/handlers/langchain_handler/requirements.txt",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Flangchain_handler%2Frequirements.txt",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Flangchain_handler%2Frequirements.txt",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Flangchain_handler%2Frequirements.txt?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,4 +1,4 @@\n-openai == 0.28.1\n+openai == 1.6.1\n wikipedia==1.4.0\n tiktoken >= 0.3.0\n anthropic==0.3.5"
            },
            {
                "sha": "25efca2f343ee119ed05dde83c2584af3daecf4d",
                "filename": "mindsdb/integrations/handlers/llama_index_handler/README.md",
                "status": "modified",
                "additions": 51,
                "deletions": 1,
                "changes": 52,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2FREADME.md",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2FREADME.md",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2FREADME.md?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -8,7 +8,8 @@ LlamaIndex is a data framework for your LLM application. In this handler, we use\n - [x] LlamaIndex ML Handler\n   - [x] [Support Web Page Reader](https://gpt-index.readthedocs.io/en/latest/examples/data_connectors/WebPageDemo.html)\n   - [x] [Support Database Reader](https://gpt-index.readthedocs.io/en/latest/examples/data_connectors/DatabaseReaderDemo.html)\n-\n+  - [x] [Support Github Reader](https://llamahub.ai/l/youtube_transcript?from=loaders)\n+  - [x] [Support YoutubeTranscript Reader](https://llamahub.ai/l/youtube_transcript?from=loaders) **Note: To run YoutubeLoader `pip install youtube_transcript_api`**\n \n \n ## Example Usage\n@@ -56,3 +57,52 @@ JOIN files.question_table as t;\n ~~~~\n \n ![](https://i.ibb.co/WPgXJDs/Screenshot-2023-05-30-at-7-54-32-PM.png)\n+\n+## Example usage for GithubLoader\n+```sql\n+CREATE MODEL github_loader\n+PREDICT answer\n+USING \n+  engine = 'llama_index', \n+  index_class = 'VectorStoreIndex',\n+  owner = 'mindsdb',\n+  repo = 'mindsdb',\n+  branch = 'staging',\n+  reader = 'GithubRepositoryReader',\n+  filter_type = 'include',\n+  filter_file_extensions = ['.py','.html','.md'],\n+  input_column = 'questions',\n+  openai_api_key = '<your_openai_key>',\n+  github_token = '<your_github_token>';\n+```\n+\n+```sql\n+SELECT a.questions, b.answer\n+FROM github_loader as b\n+JOIN files.questions as a\n+```\n+\n+```sql\n+SELECT question, answer\n+FROM github_loader\n+WHERE questions = 'Explain steps to setup MindsDB on local machine?'\n+```\n+\n+## Example usage for YoutubeTranscriptLoader\n+```sql\n+CREATE MODEL youtube_loader\n+PREDICT answer\n+USING \n+  engine = 'llama_index', \n+  index_class = 'VectorStoreIndex',\n+  ytlinks = ['<link_of_youtube_videos>'],\n+  reader = 'YoutubeTranscriptReader',\n+  input_column = 'questions',\n+  openai_api_key = '<your_openai_key>';\n+```\n+\n+```sql\n+SELECT question, answer\n+FROM youtube_loader\n+WHERE questions = 'What was the video about?'\n+```\n\\ No newline at end of file"
            },
            {
                "sha": "1d215cb6c832aedb08c7b1f9343fb63acd9f7dd0",
                "filename": "mindsdb/integrations/handlers/llama_index_handler/__about__.py",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2F__about__.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2F__about__.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2F__about__.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,9 +1,9 @@\n-__title__ = 'MindsDB LlamaIndex  handler'\n-__package_name__ = 'mindsdb_llama_index_handler'\n-__version__ = '0.0.1'\n+__title__ = \"MindsDB LlamaIndex  handler\"\n+__package_name__ = \"mindsdb_llama_index_handler\"\n+__version__ = \"0.0.1\"\n __description__ = \"MindsDB handler for LlamaIndex\"\n-__author__ = 'Balaji Seetharaman '\n-__github__ = 'https://github.com/mindsdb/mindsdb'\n-__pypi__ = 'https://pypi.org/project/mindsdb/'\n-__license__ = 'MIT'\n-__copyright__ = 'Copyright 2023 - mindsdb'\n+__author__ = \"Balaji Seetharaman \"\n+__github__ = \"https://github.com/mindsdb/mindsdb\"\n+__pypi__ = \"https://pypi.org/project/mindsdb/\"\n+__license__ = \"MIT\"\n+__copyright__ = \"Copyright 2023 - mindsdb\""
            },
            {
                "sha": "32dfb142e01f40d57cfdfce1f83767b542e5e4f6",
                "filename": "mindsdb/integrations/handlers/llama_index_handler/__init__.py",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2F__init__.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2F__init__.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2F__init__.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,18 +1,18 @@\n from mindsdb.integrations.libs.const import HANDLER_TYPE\n \n from .__about__ import __version__ as version, __description__ as description\n+\n try:\n-    from .llama_index_handler import  LlamaIndexHandler as Handler\n+    from .llama_index_handler import LlamaIndexHandler as Handler\n+\n     import_error = None\n except Exception as e:\n     Handler = None\n     import_error = e\n \n-title = 'LlamaIndex'\n-name = 'llama_index'\n+title = \"LlamaIndex\"\n+name = \"llama_index\"\n type = HANDLER_TYPE.ML\n permanent = True\n \n-__all__ = [\n-    'Handler', 'version', 'name', 'type', 'title', 'description', 'import_error'\n-]\n+__all__ = [\"Handler\", \"version\", \"name\", \"type\", \"title\", \"description\", \"import_error\"]"
            },
            {
                "sha": "066363faf0f60d7f293a2e295f5971da3b2c8124",
                "filename": "mindsdb/integrations/handlers/llama_index_handler/config.py",
                "status": "added",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Fconfig.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Fconfig.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Fconfig.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -0,0 +1,18 @@\n+# this dict is used to configure the data loader and match one on one arguments passed by the user in args\n+data_loaders = {\n+    \"DFReader\": {\n+        # TODO: add parameter of DFReader\n+    },\n+    \"SimpleWebPageReader\": {\n+        \"source_url_link\": \"<url>\",\n+    },\n+    \"GithubRepositoryReader\": {\n+        \"owner\": \"<owner>\",\n+        \"repo\": \"<repository>\",\n+        \"github_token\": \"<github_token>\",\n+        \"branch\": \"<branch>\",\n+    },\n+    \"YoutubeTranscriptReader\": {\n+        \"ytlinks\": [\"<youtube_link>\"],\n+    },\n+}"
            },
            {
                "sha": "52a3d9edf77b679abf4e5bcf5130813349867cca",
                "filename": "mindsdb/integrations/handlers/llama_index_handler/github_loader_helper.py",
                "status": "added",
                "additions": 65,
                "deletions": 0,
                "changes": 65,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Fgithub_loader_helper.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Fgithub_loader_helper.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Fgithub_loader_helper.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -0,0 +1,65 @@\n+import os\n+from llama_hub.github_repo import GithubRepositoryReader\n+\n+\n+def _get_github_token(args, connection_args):\n+    \"\"\"\n+    API_KEY preference order:\n+        1. provided at model creation\n+        2. provided at engine creation\n+        3. GITHUB_TOKEN env variable\n+\n+    Note: method is not case-sensitive.\n+    \"\"\"\n+    key = \"GITHUB_TOKEN\"\n+    for k in key, key.lower():\n+        if args.get(k):\n+            return args[k]\n+\n+        connection_args = connection_args\n+        if connection_args.get(k):\n+            return connection_args[k]\n+\n+        api_key = os.getenv(k)\n+        if os.environ.get(k):\n+            return api_key\n+\n+    return None\n+\n+\n+def _get_filter_file_extensions(args):\n+    \"\"\"\n+    Returns file extensions to filter, if Filter type is EXCLUDE the file extensions will be excluded\n+    from the knowledge source, if Filter type is INCLUDE the file extensions will be included in the\n+    knowledge source.\n+    \"\"\"\n+    # filter_file_extensions is not provided\n+    if \"filter_file_extensions\" not in args:\n+        return None\n+\n+    # if filter_type is provided with EXCLUDE or INCLUDE\n+    if args[\"filter_file_extensions\"] and args[\"filter_type\"].upper() == \"INCLUDE\":\n+        filter_file_extensions = args[\"filter_file_extensions\"]\n+        return (filter_file_extensions, GithubRepositoryReader.FilterType.INCLUDE)\n+    else:\n+        filter_file_extensions = args[\"filter_file_extensions\"]\n+        return (filter_file_extensions, GithubRepositoryReader.FilterType.EXCLUDE)\n+\n+\n+def _get_filter_directories(args):\n+    \"\"\"\n+    Returns directories to filter, if Filter type is EXCLUDE the directories will be excluded\n+    from the knowledge source, if Filter type is INCLUDE the directories will be included in the\n+    knowledge source.\n+    \"\"\"\n+    # filter_directories is not provided\n+    if \"filter_directories\" not in args:\n+        return None\n+\n+    # if filter_type is provided with EXCLUDE or INCLUDE\n+    if args[\"filter_directories\"] and args[\"filter_type\"].upper() == \"INCLUDE\":\n+        filter_directories = args[\"filter_directories\"]\n+        return (filter_directories, GithubRepositoryReader.FilterType.INCLUDE)\n+    else:\n+        filter_directories = args[\"filter_directories\"]\n+        return (filter_directories, GithubRepositoryReader.FilterType.EXCLUDE)"
            },
            {
                "sha": "bd5afd3f707e2392332a61d287103f5d68514adf",
                "filename": "mindsdb/integrations/handlers/llama_index_handler/llama_index_handler.py",
                "status": "modified",
                "additions": 211,
                "deletions": 136,
                "changes": 347,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Fllama_index_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Fllama_index_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Fllama_index_handler.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -3,229 +3,304 @@\n \n import openai\n import pandas as pd\n-from langchain.llms import OpenAI\n import llama_index\n+\n+from langchain.llms import OpenAI\n from llama_index.readers.schema.base import Document\n-from llama_index import SimpleWebPageReader, QuestionAnswerPrompt\n+from llama_index.readers import SimpleWebPageReader\n+from llama_index.prompts import PromptTemplate\n from llama_index import ServiceContext, StorageContext, load_index_from_storage\n from llama_index import LLMPredictor, OpenAIEmbedding\n from llama_index.indices.vector_store.base import VectorStore\n \n+from llama_hub.github_repo import GithubClient, GithubRepositoryReader\n+from llama_hub.youtube_transcript import YoutubeTranscriptReader, is_youtube_video\n+\n from mindsdb.integrations.libs.base import BaseMLEngine\n from mindsdb.utilities.config import Config\n from mindsdb.utilities.security import is_private_url\n+from mindsdb.integrations.handlers.llama_index_handler import config\n+from mindsdb.integrations.handlers.llama_index_handler.github_loader_helper import (\n+    _get_github_token,\n+    _get_filter_file_extensions,\n+    _get_filter_directories,\n+)\n+from mindsdb.integrations.utilities.handler_utils import get_api_key\n \n \n def _validate_prompt_template(prompt_template: str):\n-    if '{context_str}' not in prompt_template or '{query_str}' not in prompt_template:\n+    if \"{context_str}\" not in prompt_template or \"{query_str}\" not in prompt_template:\n         raise Exception(\n-            \"Provided prompt template is invalid, missing `{context_str}`, `{query_str}`. Please ensure both placeholders are present and try again.\")  # noqa\n+            \"Provided prompt template is invalid, missing `{context_str}`, `{query_str}`. Please ensure both placeholders are present and try again.\"\n+        )  # noqa\n \n \n class LlamaIndexHandler(BaseMLEngine):\n-    \"\"\" Integration with the LlamaIndex data framework for LLM applications. \"\"\"\n-    name = 'llama_index'\n+    \"\"\"Integration with the LlamaIndex data framework for LLM applications.\"\"\"\n+\n+    name = \"llama_index\"\n \n     def __init__(self, *args, **kwargs):\n         super().__init__(*args, **kwargs)\n         self.generative = True\n-        self.default_index_class = 'GPTVectorStoreIndex'\n-        self.supported_index_class = ['GPTVectorStoreIndex']\n-        self.default_reader = 'DFReader'\n-        self.supported_reader = ['DFReader', 'SimpleWebPageReader']\n+        self.default_index_class = \"GPTVectorStoreIndex\"\n+        self.supported_index_class = [\"GPTVectorStoreIndex\", \"VectorStoreIndex\"]\n+        self.default_reader = \"DFReader\"\n+        self.supported_reader = [\n+            \"DFReader\",\n+            \"SimpleWebPageReader\",\n+            \"GithubRepositoryReader\",\n+            \"YoutubeTranscriptReader\",\n+        ]\n \n     @staticmethod\n     def create_validation(target, args=None, **kwargs):\n-        if 'prompt_template' in args['using']:\n-            _validate_prompt_template(args['using']['prompt_template'])\n-\n-        if args['using'].get('mode') == 'conversational':\n-            for param in ('user_column', 'assistant_column'):\n-                if param not in args['using']:\n-                    raise Exception(f'Conversational mode requires {param} parameter')\n-\n-    def create(self, target: str, df: Optional[pd.DataFrame] = None, args: Optional[Dict] = None) -> None:\n-        if 'using' not in args:\n-            raise Exception(\"LlamaIndex engine requires a USING clause! Refer to its documentation for more details.\")\n-\n-        if 'index_class' not in args['using']:\n-            args['using']['index_class'] = self.default_index_class\n-        elif args['using']['index_class'] not in self.supported_index_class:\n-            raise Exception(f\"Invalid index class argument. Please use one of {self.supported_index_class}\")\n-\n-        if 'reader' not in args['using']:\n-            args['using']['reader'] = self.default_reader\n-        elif args['using']['reader'] not in self.supported_reader:\n-            raise Exception(f\"Invalid operation mode. Please use one of {self.supported_reader}\")\n+        reader = args[\"using\"].get(\"reader\", None)\n+        if reader not in config.data_loaders:\n+            raise Exception(\n+                f\"Invalid reader argument. Please use one of {config.data_loaders.keys()}\"\n+            )\n+        config_dict = config.data_loaders[reader]\n+\n+        missing_keys = [key for key in config_dict if key not in args[\"using\"]]\n+        if missing_keys:\n+            raise Exception(f\"{reader} requires {missing_keys} arguments\")\n+\n+        if \"prompt_template\" in args[\"using\"]:\n+            _validate_prompt_template(args[\"using\"][\"prompt_template\"])\n+\n+        if args[\"using\"].get(\"mode\") == \"conversational\":\n+            for param in (\"user_column\", \"assistant_column\"):\n+                if param not in args[\"using\"]:\n+                    raise Exception(f\"Conversational mode requires {param} parameter\")\n+\n+    def create(\n+        self,\n+        target: str,\n+        df: Optional[pd.DataFrame] = None,\n+        args: Optional[Dict] = None,\n+    ) -> None:\n+        if \"using\" not in args:\n+            raise Exception(\n+                \"LlamaIndex engine requires a USING clause! Refer to its documentation for more details.\"\n+            )\n+\n+        if \"index_class\" not in args[\"using\"]:\n+            args[\"using\"][\"index_class\"] = self.default_index_class\n+        elif args[\"using\"][\"index_class\"] not in self.supported_index_class:\n+            raise Exception(\n+                f\"Invalid index class argument. Please use one of {self.supported_index_class}\"\n+            )\n+\n+        if \"reader\" not in args[\"using\"]:\n+            args[\"using\"][\"reader\"] = self.default_reader\n+        elif args[\"using\"][\"reader\"] not in self.supported_reader:\n+            raise Exception(\n+                f\"Invalid operation mode. Please use one of {self.supported_reader}\"\n+            )\n \n         # workaround to create llama model without input data\n         if df is None or df.empty:\n-            df = pd.DataFrame([{'text': ''}])\n-\n-        if args['using']['reader'] == 'DFReader':\n-            dstrs = df.apply(lambda x: ', '.join([f'{col}: {str(entry)}' for col, entry in zip(df.columns, x)]), axis=1)\n+            df = pd.DataFrame([{\"text\": \"\"}])\n+\n+        if args[\"using\"][\"reader\"] == \"DFReader\":\n+            dstrs = df.apply(\n+                lambda x: \", \".join(\n+                    [f\"{col}: {str(entry)}\" for col, entry in zip(df.columns, x)]\n+                ),\n+                axis=1,\n+            )\n             reader = list(map(lambda x: Document(text=x), dstrs.tolist()))\n \n-        elif args['using']['reader'] == 'SimpleWebPageReader':\n-            if 'source_url_link' not in args['using']:\n-                raise Exception(\"SimpleWebPageReader requires a `source_url_link` parameter. Refer to LlamaIndex documentation for more details.\")  # noqa\n-\n-            url = args['using']['source_url_link']\n+        elif args[\"using\"][\"reader\"] == \"SimpleWebPageReader\":\n+            url = args[\"using\"][\"source_url_link\"]\n             config = Config()\n             is_cloud = config.get(\"cloud\", False)\n             if is_cloud and is_private_url(url):\n-                raise Exception(f'URL is private: {url}')\n+                raise Exception(f\"URL is private: {url}\")\n \n             reader = SimpleWebPageReader(html_to_text=True).load_data([url])\n \n+        elif args[\"using\"][\"reader\"] == \"GithubRepositoryReader\":\n+            engine_storage = self.engine_storage\n+\n+            key = \"GITHUB_TOKEN\"\n+            github_token = get_api_key(\n+                key, \"llama_index\", args[\"using\"], engine_storage, strict=False\n+            )\n+            if github_token is None:\n+                github_token = get_api_key(\n+                    key.lower(),\n+                    \"llama_index\",\n+                    args[\"using\"],\n+                    engine_storage,\n+                    strict=True,\n+                )\n+\n+            github_client = GithubClient(github_token)\n+            owner = args[\"using\"][\"owner\"]\n+            repo = args[\"using\"][\"repo\"]\n+            filter_file_extensions = _get_filter_file_extensions(args[\"using\"])\n+            filter_directories = _get_filter_directories(args[\"using\"])\n+\n+            reader = GithubRepositoryReader(\n+                github_client,\n+                owner=owner,\n+                repo=repo,\n+                verbose=True,\n+                filter_file_extensions=filter_file_extensions,\n+                filter_directories=filter_directories,\n+            ).load_data(branch=args[\"using\"].get(\"branch\", \"main\"))\n+\n+        elif args[\"using\"][\"reader\"] == \"YoutubeTranscriptReader\":\n+            ytlinks = args[\"using\"][\"ytlinks\"]\n+            for link in ytlinks:\n+                if not is_youtube_video(link):\n+                    raise Exception(f\"Invalid youtube link: {link}\")\n+            reader = YoutubeTranscriptReader().load_data(ytlinks)\n+\n         else:\n-            raise Exception(f\"Invalid operation mode. Please use one of {self.supported_reader}.\")\n+            raise Exception(\n+                f\"Invalid operation mode. Please use one of {self.supported_reader}.\"\n+            )\n \n-        self.model_storage.json_set('args', args)\n+        self.model_storage.json_set(\"args\", args)\n         index = self._setup_index(reader)\n-        path = self.model_storage.folder_get('context')\n+        path = self.model_storage.folder_get(\"context\")\n         index.storage_context.persist(persist_dir=path)\n-        self.model_storage.folder_sync('context')\n+        self.model_storage.folder_sync(\"context\")\n \n     def update(self, args) -> None:\n-        prompt_template = args['using'].get('prompt_template', args.get('prompt_template', None))\n+        prompt_template = args[\"using\"].get(\n+            \"prompt_template\", args.get(\"prompt_template\", None)\n+        )\n         if prompt_template is not None:\n             _validate_prompt_template(prompt_template)\n-        args_cur = self.model_storage.json_get('args')\n-        args_cur['using'].update(args['using'])\n+        args_cur = self.model_storage.json_get(\"args\")\n+        args_cur[\"using\"].update(args[\"using\"])\n \n         # check new set of arguments\n         self.create_validation(None, args_cur)\n \n-        self.model_storage.json_set('args', args_cur)\n+        self.model_storage.json_set(\"args\", args_cur)\n \n-    def predict(self, df: Optional[pd.DataFrame] = None, args: Optional[Dict] = None) -> pd.DataFrame:\n-        pred_args = args['predict_params'] if args else {}\n+    def predict(\n+        self, df: Optional[pd.DataFrame] = None, args: Optional[Dict] = None\n+    ) -> pd.DataFrame:\n+        pred_args = args[\"predict_params\"] if args else {}\n \n-        args = self.model_storage.json_get('args')\n+        args = self.model_storage.json_get(\"args\")\n         engine_kwargs = {}\n \n-        if args['using'].get('mode') == 'conversational':\n-            user_column = args['using']['user_column']\n-            assistant_column = args['using']['assistant_column']\n+        if args[\"using\"].get(\"mode\") == \"conversational\":\n+            user_column = args[\"using\"][\"user_column\"]\n+            assistant_column = args[\"using\"][\"assistant_column\"]\n \n             messages = []\n-            for row in df[:-1].to_dict('records'):\n+            for row in df[:-1].to_dict(\"records\"):\n+                messages.append(f\"user: {row[user_column]}\")\n+                messages.append(f\"assistant: {row[assistant_column]}\")\n \n-                messages.append(f'user: {row[user_column]}')\n-                messages.append(f'assistant: {row[assistant_column]}')\n+            conversation = \"\\n\".join(messages)\n \n-            conversation = '\\n'.join(messages)\n+            questions = [df.iloc[-1][user_column]]\n \n-            questions = [\n-                df.iloc[-1][user_column]\n-            ]\n-\n-            if 'prompt' in pred_args and pred_args['prompt'] is not None:\n-                user_prompt = pred_args['prompt']\n+            if \"prompt\" in pred_args and pred_args[\"prompt\"] is not None:\n+                user_prompt = pred_args[\"prompt\"]\n             else:\n-                user_prompt = args['using'].get('prompt', '')\n-\n-            prompt_template = f'{user_prompt}\\n'\\\n-                f'---------------------\\n' \\\n-                f'We have provided context information below. \\n' \\\n-                f'{{context_str}}\\n' \\\n-                f'---------------------\\n' \\\n-                f'This is previous conversation history:\\n' \\\n-                f'{conversation}\\n' \\\n-                f'---------------------\\n' \\\n-                f'Given this information, please answer the question: {{query_str}}'\n-\n-            engine_kwargs['text_qa_template'] = QuestionAnswerPrompt(prompt_template)\n+                user_prompt = args[\"using\"].get(\"prompt\", \"\")\n+\n+            prompt_template = (\n+                f\"{user_prompt}\\n\"\n+                f\"---------------------\\n\"\n+                f\"We have provided context information below. \\n\"\n+                f\"{{context_str}}\\n\"\n+                f\"---------------------\\n\"\n+                f\"This is previous conversation history:\\n\"\n+                f\"{conversation}\\n\"\n+                f\"---------------------\\n\"\n+                f\"Given this information, please answer the question: {{query_str}}\"\n+            )\n+\n+            engine_kwargs[\"text_qa_template\"] = PromptTemplate(prompt_template)\n \n         else:\n-            input_column = args['using'].get('input_column', None)\n+            input_column = args[\"using\"].get(\"input_column\", None)\n \n-            prompt_template = args['using'].get('prompt_template', args.get('prompt_template', None))\n+            prompt_template = args[\"using\"].get(\n+                \"prompt_template\", args.get(\"prompt_template\", None)\n+            )\n             if prompt_template is not None:\n                 _validate_prompt_template(prompt_template)\n-                engine_kwargs['text_qa_template'] = QuestionAnswerPrompt(prompt_template)\n+                engine_kwargs[\"text_qa_template\"] = PromptTemplate(prompt_template)\n \n             if input_column is None:\n-                raise Exception(f'`input_column` must be provided at model creation time or through USING clause when predicting. Please try again.')  # noqa\n+                raise Exception(\n+                    f\"`input_column` must be provided at model creation time or through USING clause when predicting. Please try again.\"\n+                )  # noqa\n \n             if input_column not in df.columns:\n-                raise Exception(f'Column \"{input_column}\" not found in input data! Please try again.')\n+                raise Exception(\n+                    f'Column \"{input_column}\" not found in input data! Please try again.'\n+                )\n \n             questions = df[input_column]\n \n-        index_path = self.model_storage.folder_get('context')\n+        index_path = self.model_storage.folder_get(\"context\")\n         storage_context = StorageContext.from_defaults(persist_dir=index_path)\n         service_context = self._get_service_context()\n-        index = load_index_from_storage(storage_context, service_context=service_context)\n+        index = load_index_from_storage(\n+            storage_context, service_context=service_context\n+        )\n         query_engine = index.as_query_engine(**engine_kwargs)\n \n         results = []\n \n         for question in questions:\n-            query_results = query_engine.query(question)  # TODO: provide extra_info in explain_target col\n+            query_results = query_engine.query(\n+                question\n+            )  # TODO: provide extra_info in explain_target col\n             results.append(query_results.response)\n \n-        result_df = pd.DataFrame({'question': questions, args['target']: results})  # result_df['answer'].tolist()\n+        result_df = pd.DataFrame(\n+            {\"question\": questions, args[\"target\"]: results}\n+        )  # result_df['answer'].tolist()\n         return result_df\n \n     def _get_service_context(self):\n-        args = self.model_storage.json_get('args')\n-        openai_api_key = self._get_llama_index_api_key(args['using'])\n+        args = self.model_storage.json_get(\"args\")\n+        engine_storage = self.engine_storage\n+\n+        key = \"OPENAI_API_KEY\"\n+        openai_api_key = get_api_key(\n+            key, \"llama_index\", args[\"using\"], engine_storage, strict=False\n+        )\n+        if openai_api_key is None:\n+            openai_api_key = get_api_key(\n+                key.lower(), \"llama_index\", args[\"using\"], engine_storage, strict=True\n+            )\n+\n         openai.api_key = openai_api_key  # TODO: shouldn't have to do this! bug?\n-        llm_kwargs = {\n-            'openai_api_key': openai_api_key\n-        }\n-        if 'temperature' in args['using']:\n-            llm_kwargs['temperature'] = args['using']['temperature']\n-        if 'model_name' in args['using']:\n-            llm_kwargs['model_name'] = args['using']['model_name']\n-        if 'max_tokens' in args['using']:\n-            llm_kwargs['max_tokens'] = args['using']['max_tokens']\n+        llm_kwargs = {\"openai_api_key\": openai_api_key}\n+        if \"temperature\" in args[\"using\"]:\n+            llm_kwargs[\"temperature\"] = args[\"using\"][\"temperature\"]\n+        if \"model_name\" in args[\"using\"]:\n+            llm_kwargs[\"model_name\"] = args[\"using\"][\"model_name\"]\n+        if \"max_tokens\" in args[\"using\"]:\n+            llm_kwargs[\"max_tokens\"] = args[\"using\"][\"max_tokens\"]\n \n         llm = OpenAI(**llm_kwargs)  # TODO: all usual params should go here\n         embed_model = OpenAIEmbedding(openai_api_key=openai_api_key)\n         service_context = ServiceContext.from_defaults(\n-            llm_predictor=LLMPredictor(llm=llm),\n-            embed_model=embed_model\n+            llm_predictor=LLMPredictor(llm=llm), embed_model=embed_model\n         )\n         return service_context\n-    \n+\n     def _setup_index(self, documents):\n-        args = self.model_storage.json_get('args')\n-        indexer: VectorStore = getattr(llama_index, args['using']['index_class'])\n-        index = indexer.from_documents(documents, service_context=self._get_service_context())\n+        args = self.model_storage.json_get(\"args\")\n+        indexer: VectorStore = getattr(llama_index, args[\"using\"][\"index_class\"])\n+        index = indexer.from_documents(\n+            documents, service_context=self._get_service_context()\n+        )\n \n         return index\n-\n-    def _get_llama_index_api_key(self, args, strict=True):\n-        \"\"\"\n-        API_KEY preference order:\n-            1. provided at model creation\n-            2. provided at engine creation\n-            3. OPENAI_API_KEY env variable\n-            4. llama_index.OPENAI_API_KEY setting in config.json\n-\n-        Note: method is not case sensitive.\n-        \"\"\"\n-        key = 'OPENAI_API_KEY'\n-        for k in key, key.lower():\n-            # 1\n-            if args.get(k):\n-                return args[k]\n-            # 2\n-            connection_args = self.engine_storage.get_connection_args()\n-            if k in connection_args:\n-                return connection_args[k]\n-            # 3\n-            api_key = os.getenv(k)\n-            if api_key is not None:\n-                return api_key\n-            # 4\n-            config = Config()\n-            openai_cfg = config.get('llama_index', {})\n-            if k in openai_cfg:\n-                return openai_cfg[k]\n-\n-        if strict:\n-            raise Exception(f'Missing API key \"{k}\". Either re-create this ML_ENGINE specifying the `{k}` parameter, or re-create this model and pass the API key with `USING` syntax.')  # noqa"
            },
            {
                "sha": "d5b8922646685b75ea43a94c4fe66e4138df9909",
                "filename": "mindsdb/integrations/handlers/llama_index_handler/requirements.txt",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Frequirements.txt",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Frequirements.txt",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fllama_index_handler%2Frequirements.txt?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,2 +1,3 @@\n-llama-index==0.8.57\n-openai == 0.28.1\n+llama-index==0.9.23\n+llama-hub==0.0.62\n+openai == 1.6.1"
            },
            {
                "sha": "b79970c5cf4e71ab0ec359674252b836a9e8e826",
                "filename": "mindsdb/integrations/handlers/openai_handler/constants.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Fconstants.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Fconstants.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Fconstants.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -9,10 +9,10 @@\n     'gpt-4-1106-preview',\n )\n COMPLETION_MODELS = ('babbage-002', 'davinci-002')\n-FINETUNING_MODELS = ('gpt-3.5-turbo', 'babbage-002', 'davinci-002')\n+FINETUNING_MODELS = ('gpt-3.5-turbo', 'babbage-002', 'davinci-002','gpt-4')\n COMPLETION_LEGACY_BASE_MODELS = ('davinci', 'curie', 'babbage', 'ada')\n \n-FINETUNING_LEGACY_MODELS = COMPLETION_LEGACY_BASE_MODELS\n+FINETUNING_LEGACY_MODELS = FINETUNING_MODELS\n COMPLETION_LEGACY_MODELS = (\n     COMPLETION_LEGACY_BASE_MODELS\n     + tuple(f'text-{model}-001' for model in COMPLETION_LEGACY_BASE_MODELS)"
            },
            {
                "sha": "8c9fcb3b97e9f99518c13554eb72897b206787cf",
                "filename": "mindsdb/integrations/handlers/openai_handler/helpers.py",
                "status": "modified",
                "additions": 24,
                "deletions": 23,
                "changes": 47,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Fhelpers.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Fhelpers.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Fhelpers.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,22 +1,32 @@\n import os\n-from typing import List, Optional\n+from typing import List\n import random\n import time\n import math\n \n import openai\n+from openai import OpenAI\n+\n import tiktoken\n \n import mindsdb.utilities.profiler as profiler\n from mindsdb.integrations.handlers.openai_handler.constants import OPENAI_API_BASE\n \n \n+class PendingFT(openai.OpenAIError):\n+    message: str\n+    def __init__(self, message) -> None:\n+        super().__init__()\n+        self.message = message\n+\n+\n def retry_with_exponential_backoff(\n     initial_delay: float = 1,\n     hour_budget: float = 0.3,\n     jitter: bool = False,\n     exponential_base: int = 2,\n-    errors: tuple = (openai.error.RateLimitError, openai.error.APIConnectionError),\n+    wait_errors: tuple = (openai.APITimeoutError, openai.APIConnectionError, PendingFT),\n+    status_errors: tuple = (openai.APIStatusError, openai.APIResponseValidationError),\n ):\n     \"\"\"\n     Wrapper to enable optional arguments. It means this decorator always needs to be called with parenthesis:\n@@ -55,20 +65,13 @@ def wrapper(*args, **kwargs):\n             while True:\n                 try:\n                     return func(*args, **kwargs)\n-                except errors as e:\n-                    if e.error is not None:\n-                        if (\n-                            e.error['type'] == 'invalid_request_error'\n-                            and 'Too many parallel completions' in e.error['message']\n-                            or 'Please reduce the length of the messages'\n-                            in e.error['message']\n-                        ):\n-                            raise e  # InvalidRequestError triggers batched mode in the previous call\n-                        if e.error['type'] == 'insufficient_quota':\n-                            raise Exception(\n-                                'API key has exceeded its quota, please try 1) increasing it or 2) using another key.'\n-                            )  # noqa\n \n+                except status_errors as e:\n+                    raise Exception(\n+                        f'Error status {e.status_code} raised by OpenAI API: {e.body.get(\"message\", \"Please refer to `https://platform.openai.com/docs/guides/error-codes` for more information.\")}'   # noqa\n+                    )  # noqa\n+\n+                except wait_errors:\n                     num_retries += 1\n                     if num_retries > max_retries:\n                         raise Exception(\n@@ -78,12 +81,10 @@ def wrapper(*args, **kwargs):\n                     delay *= exponential_base * (1 + jitter * random.random())\n                     time.sleep(delay)\n \n-                except openai.error.OpenAIError as e:\n-                    if e.error is not None and e.error['type'] == 'insufficient_quota':\n-                        raise Exception(\n-                            'API key has exceeded its quota, please try 1) increasing it or 2) using another key.'\n-                        )  # noqa\n-                    raise e\n+                except openai.OpenAIError as e:\n+                    raise Exception(\n+                        f'General {str(e)} error raised by OpenAI. Please refer to `https://platform.openai.com/docs/guides/error-codes` for more information.'    # noqa\n+                    )\n \n                 except Exception as e:\n                     raise e\n@@ -146,6 +147,6 @@ def get_available_models(api_key: str) -> List[str]:\n     \"\"\"\n \n     api_base = os.environ.get('OPENAI_API_BASE', OPENAI_API_BASE)\n-    res = openai.Model.list(api_key=api_key, api_base=api_base)\n+    res = OpenAI(api_key=api_key, base_url=api_base).models.list()\n \n-    return [models[\"id\"] for models in res.data]\n+    return [models.id for models in res.data]"
            },
            {
                "sha": "f473a608a8ee94808d8c7c352b3623486f10db2d",
                "filename": "mindsdb/integrations/handlers/openai_handler/openai_handler.py",
                "status": "modified",
                "additions": 92,
                "deletions": 82,
                "changes": 174,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Fopenai_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Fopenai_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Fopenai_handler.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -8,8 +8,8 @@\n import subprocess\n import concurrent.futures\n from typing import Optional, Dict\n-\n import openai\n+from openai import OpenAI\n import numpy as np\n import pandas as pd\n \n@@ -20,11 +20,12 @@\n     retry_with_exponential_backoff,\n     truncate_msgs_for_token_limit,\n     get_available_models,\n+    PendingFT,\n )\n from mindsdb.integrations.handlers.openai_handler.constants import (\n     CHAT_MODELS,\n     IMAGE_MODELS,\n-    FINETUNING_LEGACY_MODELS,\n+    FINETUNING_MODELS,\n     OPENAI_API_BASE,\n )\n from mindsdb.integrations.utilities.handler_utils import get_api_key\n@@ -55,8 +56,7 @@ def __init__(self, *args, **kwargs):\n         self.max_batch_size = 20\n         self.default_max_tokens = 100\n         self.chat_completion_models = CHAT_MODELS\n-        self.supported_ft_models = FINETUNING_LEGACY_MODELS  # base models compatible with finetuning  # TODO #7387: transition to new endpoint before 4/1/24. Useful reference: Anyscale handler. # noqa\n-        self.ft_cls = openai.FineTune\n+        self.supported_ft_models = FINETUNING_MODELS # base models compatible with finetuning  # TODO #7387: transition to new endpoint before 4/1/24. Useful reference: Anyscale handler. # noqa\n \n     @staticmethod\n     def create_validation(target, args=None, **kwargs):\n@@ -121,6 +121,7 @@ def create_validation(target, args=None, **kwargs):\n                 \"temperature\",\n                 \"api_key\",\n                 \"openai_api_key\",\n+                \"api_organization\",\n             }\n         )\n \n@@ -162,6 +163,13 @@ def predict(self, df: pd.DataFrame, args: Optional[Dict] = None) -> pd.DataFrame\n \n         pred_args = args['predict_params'] if args else {}\n         args = self.model_storage.json_get('args')\n+        args['api_base'] = pred_args.get(\n+                    'api_base',\n+                    args.get(\n+                        'api_base', os.environ.get('OPENAI_API_BASE', OPENAI_API_BASE)\n+                    ))\n+        if pred_args.get('api_organization'):\n+            args['api_organization'] = pred_args['api_organization']\n         df = df.reset_index(drop=True)\n \n         if pred_args.get('mode'):\n@@ -259,12 +267,6 @@ def predict(self, df: pd.DataFrame, args: Optional[Dict] = None) -> pd.DataFrame\n                 'best_of': pred_args.get('best_of', None),\n                 'logit_bias': pred_args.get('logit_bias', None),\n                 'user': pred_args.get('user', None),\n-                'api_base': pred_args.get(\n-                    'api_base',\n-                    args.get(\n-                        'api_base', os.environ.get('OPENAI_API_BASE', OPENAI_API_BASE)\n-                    ),\n-                ),  # noqa\n             }\n \n             if (\n@@ -388,11 +390,9 @@ def _completion(\n         \"\"\"\n \n         @retry_with_exponential_backoff()\n-        def _submit_completion(model_name, prompts, api_key, api_args, args, df):\n+        def _submit_completion(model_name, prompts, api_args, args, df):\n             kwargs = {\n                 'model': model_name,\n-                'api_key': api_key,\n-                'organization': args.get('api_organization'),\n             }\n             if model_name in IMAGE_MODELS:\n                 return _submit_image_completion(kwargs, prompts, api_args)\n@@ -420,32 +420,32 @@ def _log_api_call(params, response):\n         def _submit_normal_completion(kwargs, prompts, api_args):\n             def _tidy(comp):\n                 tidy_comps = []\n-                for c in comp['choices']:\n-                    if 'text' in c:\n-                        tidy_comps.append(c['text'].strip('\\n').strip(''))\n+                for c in comp.choices:\n+                    if hasattr(c,'text'):\n+                        tidy_comps.append(c.text.strip('\\n').strip(''))\n                 return tidy_comps\n \n             kwargs['prompt'] = prompts\n             kwargs = {**kwargs, **api_args}\n \n             before_openai_query(kwargs)\n-            resp = _tidy(openai.Completion.create(**kwargs))\n+            resp = _tidy(client.completions.create(**kwargs))\n             _log_api_call(kwargs, resp)\n             return resp\n \n         def _submit_embedding_completion(kwargs, prompts, api_args):\n             def _tidy(comp):\n                 tidy_comps = []\n-                for c in comp['data']:\n-                    if 'embedding' in c:\n-                        tidy_comps.append([c['embedding']])\n+                for c in comp.data:\n+                    if hasattr(c,'embedding'):\n+                        tidy_comps.append([c.embedding])\n                 return tidy_comps\n \n             kwargs['input'] = prompts\n             kwargs = {**kwargs, **api_args}\n \n             before_openai_query(kwargs)\n-            resp = _tidy(openai.Embedding.create(**kwargs))\n+            resp = _tidy(client.embeddings.create(**kwargs))\n             _log_api_call(kwargs, resp)\n             return resp\n \n@@ -454,9 +454,9 @@ def _submit_chat_completion(\n         ):\n             def _tidy(comp):\n                 tidy_comps = []\n-                for c in comp['choices']:\n-                    if 'message' in c:\n-                        tidy_comps.append(c['message']['content'].strip('\\n').strip(''))\n+                for c in comp.choices:\n+                    if hasattr(c,'message'):\n+                        tidy_comps.append(c.message.content.strip('\\n').strip(''))\n                 return tidy_comps\n \n             completions = []\n@@ -496,7 +496,7 @@ def _tidy(comp):\n                     pkwargs = {**kwargs, **api_args}\n \n                     before_openai_query(kwargs)\n-                    resp = _tidy(openai.ChatCompletion.create(**pkwargs))\n+                    resp = _tidy(client.chat.completions.create(**pkwargs))\n                     _log_api_call(pkwargs, resp)\n \n                     completions.extend(resp)\n@@ -505,7 +505,7 @@ def _tidy(comp):\n                     pkwargs = {**kwargs, **api_args}\n \n                     before_openai_query(kwargs)\n-                    resp = _tidy(openai.ChatCompletion.create(**pkwargs))\n+                    resp = _tidy(client.chat.completions.create(**pkwargs))\n                     _log_api_call(pkwargs, resp)\n \n                     completions.extend(resp)\n@@ -536,26 +536,31 @@ def _tidy(comp):\n         def _submit_image_completion(kwargs, prompts, api_args):\n             def _tidy(comp):\n                 return [\n-                    c[0]['url'] if 'url' in c[0].keys() else c[0]['b64_json']\n+                    c.url if hasattr(c,'url')  else c.b64_json\n                     for c in comp\n                 ]\n \n             completions = [\n-                openai.Image.create(**{'prompt': p, **kwargs, **api_args})['data']\n+                client.images.generate(**{'prompt': p, **kwargs, **api_args}).data[0]\n                 for p in prompts\n             ]\n             return _tidy(completions)\n+        \n \n+        client = self._get_client(\n+            api_key=api_key,\n+            base_url=args.get('api_base'),\n+            org=args.pop('api_organization') if 'api_organization' in args else None,\n+            )\n         try:\n             # check if simple completion works\n             completion = _submit_completion(\n-                model_name, prompts, api_key, api_args, args, df\n+                model_name, prompts, api_args, args, df\n             )\n             return completion\n-        except openai.error.InvalidRequestError as e:\n+        except Exception as e:\n             # else, we get the max batch size\n-            e = e.user_message\n-            if 'you can currently request up to at most a total of' in e:\n+            if 'you can currently request up to at most a total of' in str(e):\n                 pattern = 'a total of'\n                 max_batch_size = int(e[e.find(pattern) + len(pattern) :].split(').')[0])\n             else:\n@@ -569,7 +574,6 @@ def _tidy(comp):\n                 partial = _submit_completion(\n                     model_name,\n                     prompts[i * max_batch_size : (i + 1) * max_batch_size],\n-                    api_key,\n                     api_args,\n                     args,\n                     df,\n@@ -591,7 +595,6 @@ def _tidy(comp):\n                         _submit_completion,\n                         model_name,\n                         prompts[i * max_batch_size : (i + 1) * max_batch_size],\n-                        api_key,\n                         api_args,\n                         args,\n                         df,\n@@ -610,14 +613,18 @@ def describe(self, attribute: Optional[str] = None) -> pd.DataFrame:\n         # TODO: Update to use update() artifacts\n \n         args = self.model_storage.json_get('args')\n-\n+        api_key = get_api_key('openai', args, self.engine_storage)\n+        client= self._get_client(\n+            api_key=api_key,\n+            base_url=args.get('api_base'),\n+            org=args.get('api_organization')\n+            )\n         if attribute == 'args':\n             return pd.DataFrame(args.items(), columns=['key', 'value'])\n         elif attribute == 'metadata':\n-            api_key = get_api_key('openai', args, self.engine_storage)\n             model_name = args.get('model_name', self.default_model)\n-            meta = openai.Model.retrieve(model_name, api_key=api_key)\n-            return pd.DataFrame(meta.items(), columns=['key', 'value'])\n+            meta = client.models.retrieve(model_name)\n+            return pd.DataFrame(dict(meta).items(), columns=['key', 'value'])\n         else:\n             tables = ['args', 'metadata']\n             return pd.DataFrame(tables, columns=['tables'])\n@@ -644,6 +651,11 @@ def finetune(\n         using_args = args.pop('using') if 'using' in args else {}\n         prompt_col = using_args.get('prompt_column', 'prompt')\n         completion_col = using_args.get('completion_column', 'completion')\n+        \n+        api_key = get_api_key('openai', args, self.engine_storage)\n+        api_base = using_args.get('api_base', os.environ['OPENAI_API_BASE'])\n+        org = using_args.get('api_organization')\n+        client = self._get_client(api_key=api_key, base_url=api_base, org=org)\n \n         self._check_ft_cols(df, [prompt_col, completion_col])\n \n@@ -655,10 +667,6 @@ def finetune(\n                 f\"This model cannot be finetuned. Supported base models are {self.supported_ft_models}\"\n             )\n \n-        openai.api_key = get_api_key('openai', args, self.engine_storage)\n-        openai.api_base = args.get(\n-            'api_base', os.environ.get('OPENAI_API_BASE', OPENAI_API_BASE)\n-        )\n         finetune_time = datetime.datetime.now().strftime('%Y-%m-%d_%H-%M-%S')\n \n         temp_storage_path = tempfile.mkdtemp()\n@@ -672,18 +680,15 @@ def finetune(\n         jsons = {k: None for k in file_names.keys()}\n         for split, file_name in file_names.items():\n             if os.path.isfile(os.path.join(temp_storage_path, file_name)):\n-                jsons[split] = openai.File.create(\n-                    file=open(f\"{temp_storage_path}/{file_name}\", \"rb\"),\n-                    # api_base=openai.api_base,  # TODO: rm\n-                    purpose='fine-tune',\n-                )\n+                jsons[split] = client.files.create(file=open(f\"{temp_storage_path}/{file_name}\", \"rb\"),\n+                purpose='fine-tune')\n \n-        if type(jsons['train']) in (openai.File, openai.openai_object.OpenAIObject):\n+        if type(jsons['train']) is openai.types.FileObject:\n             train_file_id = jsons['train'].id\n         else:\n             train_file_id = jsons['base'].id\n \n-        if type(jsons['val']) in (openai.File, openai.openai_object.OpenAIObject):\n+        if type(jsons['val']) is openai.types.FileObject:\n             val_file_id = jsons['val'].id\n         else:\n             val_file_id = None\n@@ -698,31 +703,34 @@ def finetune(\n \n         start_time = datetime.datetime.now()\n \n-        ft_stats, result_file_id = self._ft_call(ft_params, args.get('hour_budget', 8))\n-        ft_model_name = ft_stats['fine_tuned_model']\n+        ft_stats, result_file_id = self._ft_call(ft_params, client, args.get('hour_budget', 8))\n+        ft_model_name = ft_stats.fine_tuned_model\n \n         end_time = datetime.datetime.now()\n         runtime = end_time - start_time\n-        name_extension = openai.File.retrieve(id=result_file_id).filename\n+        name_extension = client.files.retrieve(file_id=result_file_id).filename\n         result_path = f'{temp_storage_path}/ft_{finetune_time}_result_{name_extension}'\n-        with open(result_path, 'wb') as f:\n-            f.write(openai.File.download(id=result_file_id))\n-\n-        if '.csv' in name_extension:\n-            # legacy endpoint\n-            train_stats = pd.read_csv(result_path)\n-            if 'validation_token_accuracy' in train_stats.columns:\n-                train_stats = train_stats[\n-                    train_stats['validation_token_accuracy'].notnull()\n-                ]\n-            args['ft_api_info'] = ft_stats.to_dict_recursive()\n-            args['ft_result_stats'] = train_stats.to_dict()\n \n-        elif '.json' in name_extension:\n-            train_stats = pd.read_json(\n-                path_or_buf=result_path, lines=True\n-            )  # new endpoint\n-            args['ft_api_info'] = args['ft_result_stats'] = train_stats.to_dict()\n+        try:\n+            client.files.content(file_id=result_file_id).stream_to_file(result_path)\n+            if '.csv' in name_extension:\n+                # legacy endpoint\n+                train_stats = pd.read_csv(result_path)\n+                if 'validation_token_accuracy' in train_stats.columns:\n+                    train_stats = train_stats[\n+                        train_stats['validation_token_accuracy'].notnull()\n+                    ]\n+                args['ft_api_info'] = ft_stats.dict()\n+                args['ft_result_stats'] = train_stats.to_dict()\n+\n+            elif '.json' in name_extension:\n+                train_stats = pd.read_json(\n+                    path_or_buf=result_path, lines=True\n+                )  # new endpoint\n+                args['ft_api_info'] = args['ft_result_stats'] = train_stats.to_dict()\n+\n+        except Exception:\n+            logger.info(f'Error retrieving fine-tuning results. Please check manually for information on job {ft_stats.id} (result file {result_file_id}).')\n \n         args['model_name'] = ft_model_name\n         args['runtime'] = runtime.total_seconds()\n@@ -768,12 +776,11 @@ def _prepare_ft_jsonl(self, df, _, temp_filename, temp_model_path):\n         }\n         return file_names\n \n-    @staticmethod\n-    def _get_ft_model_type(model_name: str):\n-        for model_type in ['ada', 'curie', 'babbage', 'davinci']:\n+    def _get_ft_model_type(self, model_name: str):\n+        for model_type in self.supported_ft_models:\n             if model_type in model_name.lower():\n                 return model_type\n-        return 'ada'\n+        return 'babbage-002'\n \n     @staticmethod\n     def _add_extra_ft_params(ft_params, using_args):\n@@ -797,36 +804,39 @@ def _add_extra_ft_params(ft_params, using_args):\n         }\n         return {**ft_params, **extra_params}\n \n-    def _ft_call(self, ft_params, hour_budget):\n+    def _ft_call(self, ft_params, client, hour_budget):\n         \"\"\"\n         Separate method to account for both legacy and new endpoints.\n         Currently, `OpenAIHandler` uses the legacy endpoint.\n         Others, like `AnyscaleEndpointsHandler`, use the new endpoint.\n         \"\"\"\n-        ft_result = self.ft_cls.create(\n+        ft_result = client.fine_tuning.jobs.create(\n             **{k: v for k, v in ft_params.items() if v is not None}\n         )\n \n         @retry_with_exponential_backoff(\n             hour_budget=hour_budget,\n-            errors=(openai.error.RateLimitError, openai.error.OpenAIError),\n         )\n         def _check_ft_status(model_id):\n-            ft_retrieved = self.ft_cls.retrieve(id=model_id)\n-            if ft_retrieved['status'] in ('succeeded', 'failed', 'cancelled'):\n+            ft_retrieved = client.fine_tuning.jobs.retrieve(fine_tuning_job_id=model_id)\n+            if ft_retrieved.status in ('succeeded', 'failed', 'cancelled'):\n                 return ft_retrieved\n             else:\n-                raise openai.error.OpenAIError('Fine-tuning still pending!')\n+                raise PendingFT('Fine-tuning still pending!')\n \n         ft_stats = _check_ft_status(ft_result.id)\n \n-        if ft_stats['status'] != 'succeeded':\n+        if ft_stats.status != 'succeeded':\n             raise Exception(\n-                f\"Fine-tuning did not complete successfully (status: {ft_stats['status']}). Error message: {ft_stats['events'][-1]['message']}\"\n+                f\"Fine-tuning did not complete successfully (status: {ft_stats.status}). Error message: {ft_stats.events[-1].message}\"\n             )  # noqa\n \n-        result_file_id = self.ft_cls.retrieve(id=ft_result.id)['result_files'][0]\n+        result_file_id = client.fine_tuning.jobs.retrieve(fine_tuning_job_id=ft_result.id).result_files[0]\n         if hasattr(result_file_id, 'id'):\n             result_file_id = result_file_id.id  # legacy endpoint\n \n         return ft_stats, result_file_id\n+    \n+    @staticmethod\n+    def _get_client(api_key, base_url=OPENAI_API_BASE, org=None):\n+        return OpenAI(api_key=api_key, base_url=base_url, organization=org)"
            },
            {
                "sha": "774b9161c61eb5d15fc38e1e8550cf7e34f58264",
                "filename": "mindsdb/integrations/handlers/openai_handler/requirements.txt",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Frequirements.txt",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Frequirements.txt",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Fopenai_handler%2Frequirements.txt?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,2 +1,2 @@\n-openai == 0.28.1\n+openai == 1.6.1\n tiktoken >= 0.3.0"
            },
            {
                "sha": "e1102f9705661ac7b850733ba1a5385fa1286f62",
                "filename": "mindsdb/integrations/handlers/rag_handler/requirements.txt",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Frag_handler%2Frequirements.txt",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Frag_handler%2Frequirements.txt",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Frag_handler%2Frequirements.txt?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -1,6 +1,5 @@\n -r mindsdb/integrations/handlers/chromadb_handler/requirements.txt\n-openai == 0.28.1\n-pydantic>=1.10.8\n+openai==1.6.1\n html2text\n writerai~=1.1.0\n pydantic"
            },
            {
                "sha": "a0b5b9714e70f7f57ce98c1883c87a1c50d9bf45",
                "filename": "mindsdb/integrations/handlers/rag_handler/settings.py",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Frag_handler%2Fsettings.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/mindsdb%2Fintegrations%2Fhandlers%2Frag_handler%2Fsettings.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/mindsdb%2Fintegrations%2Fhandlers%2Frag_handler%2Fsettings.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -108,9 +108,9 @@ def get_available_openai_model_ids(args: dict) -> list:\n \n     openai.api_key = args[\"openai_api_key\"]\n \n-    res = openai.Engine.list()\n+    models = openai.OpenAI().models.list().data\n \n-    return [models[\"id\"] for models in res.data]\n+    return [models.id for models in models]\n \n \n @dataclass\n@@ -266,12 +266,12 @@ def load_writer_llm(self) -> Writer:\n \n     def load_openai_llm(self) -> partial:\n         \"\"\"Load OpenAI LLM API interface\"\"\"\n-        openai.api_key = self.config_dict[\"openai_api_key\"]\n+        client = openai.OpenAI(api_key=self.config_dict[\"openai_api_key\"])\n         config = self.config_dict.copy()\n         config.pop(\"openai_api_key\")\n         config[\"model\"] = config.pop(\"model_id\")\n \n-        return partial(openai.Completion.create, **config)\n+        return partial(client.completions.create, **config)\n \n \n class RAGBaseParameters(BaseModel):"
            },
            {
                "sha": "eebf3097877ff054cd81e45a5cfa3435a8b513de",
                "filename": "tests/handler_tests/test_instatus_handler.py",
                "status": "modified",
                "additions": 56,
                "deletions": 9,
                "changes": 65,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/tests%2Fhandler_tests%2Ftest_instatus_handler.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/tests%2Fhandler_tests%2Ftest_instatus_handler.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/tests%2Fhandler_tests%2Ftest_instatus_handler.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -11,6 +11,10 @@ class InstatusHandlerTest(unittest.TestCase):\n     def setUpClass(cls):\n         cls.handler = InstatusHandler(name='mindsdb_instatus', connection_data={'api_key': os.environ.get('INSTATUS_API_KEY')})\n \n+    def setUp(self):\n+        self.pageId = self.handler.call_instatus_api(endpoint='/v2/pages')['id'][0]\n+        self.componentId = self.handler.call_instatus_api(endpoint=f'/v1/{self.pageId}/components')['id'][0]\n+\n     def test_0_check_connection(self):\n         assert self.handler.check_connection()\n \n@@ -22,21 +26,23 @@ def test_2_get_tables(self):\n         assert tables.type is not RESPONSE_TYPE.ERROR\n \n     def test_3_get_columns(self):\n-        columns = self.handler.get_columns(table_name='status_pages')\n-        assert type(columns) is not RESPONSE_TYPE.ERROR\n+        status_pages_columns = self.handler.get_columns(table_name='status_pages')\n+        components_columns = self.handler.get_columns(table_name='components')\n+        assert type(status_pages_columns) is not RESPONSE_TYPE.ERROR\n+        assert type(components_columns) is not RESPONSE_TYPE.ERROR\n \n-    def test_4_select(self):\n+    def test_4_select_status_pages(self):\n         query = '''SELECT *\n                     FROM mindsdb_instatus.status_pages'''\n         self.assertTrue(self.handler.native_query(query))\n \n-    def test_5_select_by_conditions(self):\n+    def test_5_select_status_pages_by_conditions(self):\n         query = '''SELECT name, status, subdomain\n                     FROM mindsdb_instatus.status_pages\n                     WHERE id = \"clo3xshsk1114842hkn377y3lrap\"'''\n         self.assertTrue(self.handler.native_query(query))\n \n-    def test_6_insert(self):\n+    def test_6_insert_status_pages(self):\n         query = f'''INSERT INTO mindsdb_instatus.status_pages (email, name, subdomain, components, logoUrl) VALUES ('{os.environ.get('EMAIL_ID')}', 'mindsdb', 'somtirtha-roy', '[\"Website\", \"App\", \"API\"]', 'https://instatus.com/sample.png')'''\n         try:\n             self.assertTrue(self.handler.native_query(query))\n@@ -45,9 +51,7 @@ def test_6_insert(self):\n             if \"This subdomain is taken by another status page\" in error_message:\n                 print(\"Subdomain is already taken. Choose a different one.\")\n \n-    def test_7_update(self):\n-        # get the id of the row to be updated\n-        _id = self.handler.call_instatus_api(endpoint='/v2/pages')['id'][0]\n+    def test_7_update_status_pages(self):\n         # update the row with the id obtained\n         query = f'''UPDATE mindsdb_instatus.status_pages\n                 SET logoUrl = 'https://instatus.com/sample.png',\n@@ -89,7 +93,50 @@ def test_7_update(self):\n                         \"fr\": \"nasa\"\n                         }}\n                     }}'\n-                WHERE id = \"{_id}\"'''\n+                WHERE id = \"{self.pageId}\"'''\n+        self.assertTrue(self.handler.native_query(query))\n+\n+    def test_8_select_components(self):\n+        query = f'''SELECT *\n+                    FROM mindsdb_instatus.components\n+                    WHERE page_id = '{self.pageId}';'''\n+        self.assertTrue(self.handler.native_query(query))\n+\n+    def test_9_select_components_by_conditions(self):\n+        query = f'''SELECT *\n+                    FROM mindsdb_instatus.components\n+                    WHERE page_id = '{self.pageId}'\n+                    AND component_id = '{self.componentId}';'''\n+        self.assertTrue(self.handler.native_query(query))\n+\n+    def test_10_insert_components(self):\n+        query = f'''INSERT INTO mindsdb_instatus.components (page_id, name, description, status, order, showUptime, grouped, translations_name_in_fr, translations_desc_in_fr)\n+                    VALUES (\n+                        '{self.pageId}',\n+                        'Test component',\n+                        'Testing',\n+                        'OPERATIONAL',\n+                        6,\n+                        true,\n+                        false,\n+                        \"Composant de test\",\n+                        \"En test\"\n+                    );'''\n+        self.assertTrue(self.handler.native_query(query))\n+\n+    def test_11_update_components(self):\n+        query = f'''UPDATE mindsdb_instatus.components\n+                    SET\n+                        name = 'Test component 4',\n+                        description = 'Test test test',\n+                        status = 'OPERATIONAL',\n+                        order = 6,\n+                        showUptime = true,\n+                        grouped = false,\n+                        translations_name_in_fr = \"Composant de test 4\",\n+                        translations_desc_in_fr = \"Test test test\"\n+                    WHERE page_id = '{self.pageId}'\n+                    AND component_id = '{self.componentId}';'''\n         self.assertTrue(self.handler.native_query(query))\n \n "
            },
            {
                "sha": "6e806c917f58c55df58fa459723a9c978623c5b7",
                "filename": "tests/unit/ml_handlers/test_langchain_embedding.py",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/tests%2Funit%2Fml_handlers%2Ftest_langchain_embedding.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/tests%2Funit%2Fml_handlers%2Ftest_langchain_embedding.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/tests%2Funit%2Fml_handlers%2Ftest_langchain_embedding.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -180,7 +180,7 @@ def test_no_input_columns(self, mock_handler):\n                 \"content2\": [\"world\", \"hello\", \"bar\", \"foo\"],\n             }\n         )\n-        self.set_handler(mock_handler, name=\"pg\", tables={\"df\": df})\n+        self.save_file(\"df\", df)\n \n         # create the model with no input columns specified should use\n         # all columns when embedding the documents\n@@ -217,7 +217,7 @@ class = 'fake', -- a more user friendly name\n         ret = self.run_sql(\n             \"\"\"\n             SELECT * FROM proj.test_dummy_no_input_columns\n-            JOIN pg.df\n+            JOIN files.df\n             \"\"\"\n         )\n \n@@ -231,7 +231,7 @@ class = 'fake', -- a more user friendly name\n         ret = self.run_sql(\n             \"\"\"\n             CREATE MODEL proj.test_dummy_no_input_columns_from_df\n-            FROM pg (\n+            FROM files (\n                 SELECT *, NULL as embeddings FROM df  -- this requires an empty column called embeddings\n             )\n             PREDICT embeddings"
            },
            {
                "sha": "330369a8ade759848c2b01483dff64104818f682",
                "filename": "tests/unit/ml_handlers/test_openai.py",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/mindsdb/mindsdb/blob/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/tests%2Funit%2Fml_handlers%2Ftest_openai.py",
                "raw_url": "https://github.com/mindsdb/mindsdb/raw/5f7496481bd3db1d06a2d2e62c0dce960a1fe12b/tests%2Funit%2Fml_handlers%2Ftest_openai.py",
                "contents_url": "https://api.github.com/repos/mindsdb/mindsdb/contents/tests%2Funit%2Fml_handlers%2Ftest_openai.py?ref=5f7496481bd3db1d06a2d2e62c0dce960a1fe12b",
                "patch": "@@ -7,8 +7,10 @@\n from mindsdb.integrations.handlers.openai_handler.openai_handler import OpenAIHandler\n from ..executor_test_base import BaseExecutorTest\n \n+OPENAI_API_KEY = os.environ.get(\"OPENAI_API_KEY\")\n \n-@pytest.mark.skipif(os.environ.get('OPENAI_API_KEY') is None, reason='Missing API key!')\n+\n+@pytest.mark.skipif(OPENAI_API_KEY is None, reason='Missing API key!')\n class TestOpenAI(BaseExecutorTest):\n     \"\"\"Test Class for OpenAI Integration Testing\"\"\"\n \n@@ -225,6 +227,9 @@ class MockHandlerStorage:\n             def json_get(self, key):\n                 return {'ft-suffix': {'ft-suffix': '$'}}[key]  # finetuning suffix, irrelevant for this test but needed for init  # noqa\n \n+            def get_connection_args(self):\n+                return {'api_key': OPENAI_API_KEY}    # noqa\n+\n         # create project\n         handler = OpenAIHandler(\n             model_storage=None,  # the storage does not matter for this test"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dfinity/cdk-rs/commits/bd17d57a7b8ca59665fea5fad6143ca02724d03b",
        "url": "https://api.github.com/repos/dfinity/cdk-rs/commits/bd17d57a7b8ca59665fea5fad6143ca02724d03b",
        "html_url": "https://github.com/dfinity/cdk-rs/commit/bd17d57a7b8ca59665fea5fad6143ca02724d03b",
        "message": "fix: Fix memory leak in CallFuture (#509)",
        "files": [
            {
                "sha": "2fd130210cbd3d62f2c409a733f70360195d2219",
                "filename": "src/ic-cdk/src/api/call.rs",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/dfinity/cdk-rs/blob/bd17d57a7b8ca59665fea5fad6143ca02724d03b/src%2Fic-cdk%2Fsrc%2Fapi%2Fcall.rs",
                "raw_url": "https://github.com/dfinity/cdk-rs/raw/bd17d57a7b8ca59665fea5fad6143ca02724d03b/src%2Fic-cdk%2Fsrc%2Fapi%2Fcall.rs",
                "contents_url": "https://api.github.com/repos/dfinity/cdk-rs/contents/src%2Fic-cdk%2Fsrc%2Fapi%2Fcall.rs?ref=bd17d57a7b8ca59665fea5fad6143ca02724d03b",
                "patch": "@@ -74,7 +74,6 @@ impl<T: AsRef<[u8]>> Future for CallFuture<T> {\n \n     fn poll(self: Pin<&mut Self>, context: &mut Context<'_>) -> Poll<Self::Output> {\n         let self_ref = Pin::into_inner(self);\n-        let state_ptr = Weak::into_raw(Arc::downgrade(&self_ref.state));\n         let mut state = self_ref.state.write().unwrap();\n \n         if let Some(result) = state.result.take() {\n@@ -85,6 +84,7 @@ impl<T: AsRef<[u8]>> Future for CallFuture<T> {\n                 let method = &state.method;\n                 let args = state.arg.as_ref();\n                 let payment = state.payment;\n+                let state_ptr = Weak::into_raw(Arc::downgrade(&self_ref.state));\n                 // SAFETY:\n                 // `callee`, being &[u8], is a readable sequence of bytes and therefore can be passed to ic0.call_new.\n                 // `method`, being &str, is a readable sequence of bytes and therefore can be passed to ic0.call_new."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/windmill-labs/windmill/commits/acfe7786152f036f2476f93ab5536571514fa9e3",
        "url": "https://api.github.com/repos/windmill-labs/windmill/commits/acfe7786152f036f2476f93ab5536571514fa9e3",
        "html_url": "https://github.com/windmill-labs/windmill/commit/acfe7786152f036f2476f93ab5536571514fa9e3",
        "message": "fix: prevent brute force attacks on tokens by slowing unauthorized response",
        "files": [
            {
                "sha": "99397e6838e3bdade2a756635a9b452263f3bf51",
                "filename": "backend/windmill-api/src/users.rs",
                "status": "modified",
                "additions": 31,
                "deletions": 0,
                "changes": 31,
                "blob_url": "https://github.com/windmill-labs/windmill/blob/acfe7786152f036f2476f93ab5536571514fa9e3/backend%2Fwindmill-api%2Fsrc%2Fusers.rs",
                "raw_url": "https://github.com/windmill-labs/windmill/raw/acfe7786152f036f2476f93ab5536571514fa9e3/backend%2Fwindmill-api%2Fsrc%2Fusers.rs",
                "contents_url": "https://api.github.com/repos/windmill-labs/windmill/contents/backend%2Fwindmill-api%2Fsrc%2Fusers.rs?ref=acfe7786152f036f2476f93ab5536571514fa9e3",
                "patch": "@@ -8,6 +8,7 @@\n \n #![allow(non_snake_case)]\n \n+use std::sync::atomic::{AtomicI64, AtomicU64, Ordering};\n use std::sync::Arc;\n \n use crate::db::ApiAuthed;\n@@ -145,6 +146,7 @@ pub struct ExpiringAuthCache {\n     pub authed: ApiAuthed,\n     pub expiry: chrono::DateTime<chrono::Utc>,\n }\n+\n pub struct AuthCache {\n     cache: Cache<(String, String), ExpiringAuthCache>,\n     db: DB,\n@@ -502,6 +504,32 @@ pub struct Tokened {\n     pub token: String,\n }\n \n+struct BruteForceCounter {\n+    counter: AtomicU64,\n+    last_reset: AtomicI64,\n+}\n+\n+lazy_static! {\n+    static ref BRUTE_FORCE_COUNTER: BruteForceCounter =\n+        BruteForceCounter { last_reset: AtomicI64::new(0), counter: AtomicU64::new(0) };\n+}\n+\n+impl BruteForceCounter {\n+    async fn increment(&self) {\n+        let now = time::OffsetDateTime::now_utc().unix_timestamp();\n+        if self.counter.fetch_add(1, Ordering::Relaxed) > 10000 {\n+            tracing::error!(\n+                \"Brute force attack to find valid token detected, sleeping unauthorized response for 2 seconds\"\n+            );\n+            tokio::time::sleep(std::time::Duration::from_secs(2)).await;\n+        }\n+        if now - self.last_reset.load(Ordering::Relaxed) > 60 {\n+            self.counter.store(0, Ordering::Relaxed);\n+            self.last_reset.store(now, Ordering::Relaxed);\n+        }\n+    }\n+}\n+\n #[async_trait]\n impl<S> FromRequestParts<S> for Tokened\n where\n@@ -526,6 +554,7 @@ where\n                 parts.extensions.insert(tokened.clone());\n                 Ok(tokened)\n             } else {\n+                BRUTE_FORCE_COUNTER.increment().await;\n                 Err((StatusCode::UNAUTHORIZED, \"Unauthorized\".to_owned()))\n             }\n         }\n@@ -625,6 +654,7 @@ where\n                             && (path_vec.len() < 3\n                                 || (path_vec[4] != \"jobs\" && path_vec[4] != \"jobs_u\"))\n                         {\n+                            BRUTE_FORCE_COUNTER.increment().await;\n                             return Err((\n                                 StatusCode::UNAUTHORIZED,\n                                 format!(\"Unauthorized scoped token: {:?}\", authed.scopes),\n@@ -640,6 +670,7 @@ where\n                     }\n                 }\n             }\n+            BRUTE_FORCE_COUNTER.increment().await;\n             Err((StatusCode::UNAUTHORIZED, \"Unauthorized\".to_owned()))\n         }\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/sigstore/sigstore-go/commits/01e70e89e58226286d7977b4dba43b6be472b12c",
        "url": "https://api.github.com/repos/sigstore/sigstore-go/commits/01e70e89e58226286d7977b4dba43b6be472b12c",
        "html_url": "https://github.com/sigstore/sigstore-go/commit/01e70e89e58226286d7977b4dba43b6be472b12c",
        "message": "Add hard limits for number of TSA entries, Tlog entries, and attestation subjects/digests (#286)\n\n* Merge commit from fork\r\n\r\nThis reduces the capability of an adversary to craft a malicious bundle containing large numbers of these data, which can result in a target verifier process consuming high CPU and memory resources, resulting in an \"endless data attack\", a type of DoS attack.\r\n\r\nFixes https://github.com/sigstore/sigstore-go/security/advisories/GHSA-cq38-jh5f-37mq\r\n\r\nSigned-off-by: Cody Soyland <codysoyland@github.com>\r\n\r\n* nolint in tests\r\n\r\nSigned-off-by: Cody Soyland <codysoyland@github.com>\r\n\r\n---------\r\n\r\nSigned-off-by: Cody Soyland <codysoyland@github.com>",
        "files": [
            {
                "sha": "1d0ddfabbdaafcd25bbfb45ddd2b9f4cf3519864",
                "filename": "pkg/verify/signature.go",
                "status": "modified",
                "additions": 22,
                "deletions": 0,
                "changes": 22,
                "blob_url": "https://github.com/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Fsignature.go",
                "raw_url": "https://github.com/sigstore/sigstore-go/raw/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Fsignature.go",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-go/contents/pkg%2Fverify%2Fsignature.go?ref=01e70e89e58226286d7977b4dba43b6be472b12c",
                "patch": "@@ -31,6 +31,9 @@ import (\n \t\"github.com/sigstore/sigstore/pkg/signature/options\"\n )\n \n+const maxAllowedSubjects = 1024\n+const maxAllowedSubjectDigests = 32\n+\n var ErrDSSEInvalidSignatureCount = errors.New(\"exactly one signature is required\")\n \n func VerifySignature(sigContent SignatureContent, verificationContent VerificationContent, trustedMaterial root.TrustedMaterial) error { // nolint: revive\n@@ -179,8 +182,17 @@ func verifyEnvelopeWithArtifact(verifier signature.Verifier, envelope EnvelopeCo\n \t}\n \tartifactDigest = hasher.Sum(nil)\n \n+\t// limit the number of subjects to prevent DoS\n+\tif len(statement.Subject) > maxAllowedSubjects {\n+\t\treturn fmt.Errorf(\"too many subjects: %d > %d\", len(statement.Subject), maxAllowedSubjects)\n+\t}\n+\n \t// Look for artifact digest in statement\n \tfor _, subject := range statement.Subject {\n+\t\t// limit the number of digests to prevent DoS\n+\t\tif len(subject.Digest) > maxAllowedSubjectDigests {\n+\t\t\treturn fmt.Errorf(\"too many digests: %d > %d\", len(subject.Digest), maxAllowedSubjectDigests)\n+\t\t}\n \t\tfor alg, digest := range subject.Digest {\n \t\t\thexdigest, err := hex.DecodeString(digest)\n \t\t\tif err != nil {\n@@ -203,7 +215,17 @@ func verifyEnvelopeWithArtifactDigest(verifier signature.Verifier, envelope Enve\n \tif err != nil {\n \t\treturn fmt.Errorf(\"could not verify artifact: unable to extract statement from envelope: %w\", err)\n \t}\n+\n+\t// limit the number of subjects to prevent DoS\n+\tif len(statement.Subject) > maxAllowedSubjects {\n+\t\treturn fmt.Errorf(\"too many subjects: %d > %d\", len(statement.Subject), maxAllowedSubjects)\n+\t}\n+\n \tfor _, subject := range statement.Subject {\n+\t\t// limit the number of digests to prevent DoS\n+\t\tif len(subject.Digest) > maxAllowedSubjectDigests {\n+\t\t\treturn fmt.Errorf(\"too many digests: %d > %d\", len(subject.Digest), maxAllowedSubjectDigests)\n+\t\t}\n \t\tfor alg, digest := range subject.Digest {\n \t\t\tif alg == artifactDigestAlgorithm {\n \t\t\t\thexdigest, err := hex.DecodeString(digest)"
            },
            {
                "sha": "fc57d3d3929a699a8571a79739b18c86a8ccf58d",
                "filename": "pkg/verify/signature_test.go",
                "status": "modified",
                "additions": 62,
                "deletions": 1,
                "changes": 63,
                "blob_url": "https://github.com/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Fsignature_test.go",
                "raw_url": "https://github.com/sigstore/sigstore-go/raw/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Fsignature_test.go",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-go/contents/pkg%2Fverify%2Fsignature_test.go?ref=01e70e89e58226286d7977b4dba43b6be472b12c",
                "patch": "@@ -18,9 +18,12 @@ import (\n \t\"bytes\"\n \t\"crypto/sha256\"\n \t\"encoding/hex\"\n+\t\"encoding/json\"\n \t\"fmt\"\n \t\"testing\"\n \n+\t\"github.com/in-toto/in-toto-golang/in_toto\"\n+\t\"github.com/in-toto/in-toto-golang/in_toto/slsa_provenance/common\"\n \t\"github.com/sigstore/sigstore-go/pkg/testing/ca\"\n \t\"github.com/sigstore/sigstore-go/pkg/verify\"\n \t\"github.com/stretchr/testify/assert\"\n@@ -94,7 +97,7 @@ func TestSignatureVerifierMessageSignature(t *testing.T) {\n \tvirtualSigstore, err := ca.NewVirtualSigstore()\n \tassert.NoError(t, err)\n \n-\tartifact := \"Hi, I am an artifact!\"\n+\tartifact := \"Hi, I am an artifact!\" //nolint:goconst\n \tentity, err := virtualSigstore.Sign(\"foo@example.com\", \"issuer\", []byte(artifact))\n \tassert.NoError(t, err)\n \n@@ -113,3 +116,61 @@ func TestSignatureVerifierMessageSignature(t *testing.T) {\n \tassert.Error(t, err)\n \tassert.Nil(t, result)\n }\n+\n+func TestTooManySubjects(t *testing.T) {\n+\tvirtualSigstore, err := ca.NewVirtualSigstore()\n+\tassert.NoError(t, err)\n+\n+\ttooManySubjectsStatement := in_toto.Statement{}\n+\tfor i := 0; i < 1025; i++ {\n+\t\ttooManySubjectsStatement.Subject = append(tooManySubjectsStatement.Subject, in_toto.Subject{\n+\t\t\tName: fmt.Sprintf(\"subject-%d\", i),\n+\t\t\tDigest: map[string]string{\n+\t\t\t\t\"sha256\": \"\", // actual content of digest does not matter for this test\n+\t\t\t},\n+\t\t})\n+\t}\n+\n+\ttooManySubjectsStatementBytes, err := json.Marshal(tooManySubjectsStatement)\n+\tassert.NoError(t, err)\n+\n+\ttooManySubjectsEntity, err := virtualSigstore.Attest(\"foo@example.com\", \"issuer\", tooManySubjectsStatementBytes)\n+\tassert.NoError(t, err)\n+\n+\tverifier, err := verify.NewSignedEntityVerifier(virtualSigstore, verify.WithTransparencyLog(1), verify.WithObserverTimestamps(1))\n+\tassert.NoError(t, err)\n+\n+\tartifact := \"Hi, I am an artifact!\" //nolint:goconst\n+\t_, err = verifier.Verify(tooManySubjectsEntity, verify.NewPolicy(verify.WithArtifact(bytes.NewBufferString(artifact)), verify.WithoutIdentitiesUnsafe()))\n+\tassert.ErrorContains(t, err, \"too many subjects\")\n+}\n+\n+func TestTooManyDigests(t *testing.T) {\n+\tvirtualSigstore, err := ca.NewVirtualSigstore()\n+\tassert.NoError(t, err)\n+\n+\ttooManyDigestsStatement := in_toto.Statement{}\n+\ttooManyDigestsStatement.Subject = []in_toto.Subject{\n+\t\t{\n+\t\t\tName:   fmt.Sprintf(\"subject\"),\n+\t\t\tDigest: make(common.DigestSet),\n+\t\t},\n+\t}\n+\ttooManyDigestsStatement.Subject[0].Digest[\"sha512\"] = \"\" // verifier requires that at least one known hash algorithm is present in the digest map\n+\tfor i := 0; i < 32; i++ {\n+\t\ttooManyDigestsStatement.Subject[0].Digest[fmt.Sprintf(\"digest-%d\", i)] = \"\"\n+\t}\n+\n+\ttooManySubjectsStatementBytes, err := json.Marshal(tooManyDigestsStatement)\n+\tassert.NoError(t, err)\n+\n+\ttooManySubjectsEntity, err := virtualSigstore.Attest(\"foo@example.com\", \"issuer\", tooManySubjectsStatementBytes)\n+\tassert.NoError(t, err)\n+\n+\tverifier, err := verify.NewSignedEntityVerifier(virtualSigstore, verify.WithTransparencyLog(1), verify.WithObserverTimestamps(1))\n+\tassert.NoError(t, err)\n+\n+\tartifact := \"Hi, I am an artifact!\" //nolint:goconst\n+\t_, err = verifier.Verify(tooManySubjectsEntity, verify.NewPolicy(verify.WithArtifact(bytes.NewBufferString(artifact)), verify.WithoutIdentitiesUnsafe()))\n+\tassert.ErrorContains(t, err, \"too many digests\")\n+}"
            },
            {
                "sha": "e91baafde18746e773d2ae87877c10cb0e5d4236",
                "filename": "pkg/verify/tlog.go",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Ftlog.go",
                "raw_url": "https://github.com/sigstore/sigstore-go/raw/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Ftlog.go",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-go/contents/pkg%2Fverify%2Ftlog.go?ref=01e70e89e58226286d7977b4dba43b6be472b12c",
                "patch": "@@ -34,6 +34,8 @@ import (\n \t\"github.com/sigstore/sigstore-go/pkg/util\"\n )\n \n+const maxAllowedTlogEntries = 32\n+\n // VerifyArtifactTransparencyLog verifies that the given entity has been logged\n // in the transparency log and that the log entry is valid.\n //\n@@ -47,6 +49,11 @@ func VerifyArtifactTransparencyLog(entity SignedEntity, trustedMaterial root.Tru\n \t\treturn nil, err\n \t}\n \n+\t// limit the number of tlog entries to prevent DoS\n+\tif len(entries) > maxAllowedTlogEntries {\n+\t\treturn nil, fmt.Errorf(\"too many tlog entries: %d > %d\", len(entries), maxAllowedTlogEntries)\n+\t}\n+\n \t// disallow duplicate entries, as a malicious actor could use duplicates to bypass the threshold\n \tfor i := 0; i < len(entries); i++ {\n \t\tfor j := i + 1; j < len(entries); j++ {"
            },
            {
                "sha": "dc16bf3c63f55b927cd099fbf507e873f6be4df9",
                "filename": "pkg/verify/tlog_test.go",
                "status": "modified",
                "additions": 29,
                "deletions": 1,
                "changes": 30,
                "blob_url": "https://github.com/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Ftlog_test.go",
                "raw_url": "https://github.com/sigstore/sigstore-go/raw/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Ftlog_test.go",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-go/contents/pkg%2Fverify%2Ftlog_test.go?ref=01e70e89e58226286d7977b4dba43b6be472b12c",
                "patch": "@@ -191,5 +191,33 @@ func TestDuplicateTlogEntries(t *testing.T) {\n \tassert.NoError(t, err)\n \n \t_, err = verify.VerifyArtifactTransparencyLog(&dupTlogEntity{entity}, virtualSigstore, 1, true, false)\n-\tassert.Error(t, err) // duplicate tlog entries should fail to verify\n+\tassert.ErrorContains(t, err, \"duplicate tlog entries found\") // duplicate tlog entries should fail to verify\n+}\n+\n+type tooManyTlogEntriesEntity struct {\n+\t*ca.TestEntity\n+}\n+\n+func (e *tooManyTlogEntriesEntity) TlogEntries() ([]*tlog.Entry, error) {\n+\tentries, err := e.TestEntity.TlogEntries()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tfor i := 0; i < 32; i++ {\n+\t\tentries = append(entries, entries[0])\n+\t}\n+\n+\treturn entries, nil\n+}\n+\n+func TestMaxAllowedTlogEntries(t *testing.T) {\n+\tvirtualSigstore, err := ca.NewVirtualSigstore()\n+\tassert.NoError(t, err)\n+\n+\tstatement := []byte(`{\"_type\":\"https://in-toto.io/Statement/v0.1\",\"predicateType\":\"customFoo\",\"subject\":[{\"name\":\"subject\",\"digest\":{\"sha256\":\"deadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef\"}}],\"predicate\":{}}`)\n+\tentity, err := virtualSigstore.Attest(\"foo@example.com\", \"issuer\", statement)\n+\tassert.NoError(t, err)\n+\n+\t_, err = verify.VerifyArtifactTransparencyLog(&tooManyTlogEntriesEntity{entity}, virtualSigstore, 1, true, false)\n+\tassert.ErrorContains(t, err, \"too many tlog entries\") // too many tlog entries should fail to verify\n }"
            },
            {
                "sha": "966fad20aff285e7d7b63aafa050bfa9e6bee318",
                "filename": "pkg/verify/tsa.go",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Ftsa.go",
                "raw_url": "https://github.com/sigstore/sigstore-go/raw/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Ftsa.go",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-go/contents/pkg%2Fverify%2Ftsa.go?ref=01e70e89e58226286d7977b4dba43b6be472b12c",
                "patch": "@@ -26,6 +26,8 @@ import (\n \t\"github.com/sigstore/sigstore-go/pkg/root\"\n )\n \n+const maxAllowedTimestamps = 32\n+\n // VerifyTimestampAuthority verifies that the given entity has been timestamped\n // by a trusted timestamp authority and that the timestamp is valid.\n func VerifyTimestampAuthority(entity SignedEntity, trustedMaterial root.TrustedMaterial) ([]time.Time, error) { //nolint:revive\n@@ -34,6 +36,11 @@ func VerifyTimestampAuthority(entity SignedEntity, trustedMaterial root.TrustedM\n \t\treturn nil, err\n \t}\n \n+\t// limit the number of timestamps to prevent DoS\n+\tif len(signedTimestamps) > maxAllowedTimestamps {\n+\t\treturn nil, fmt.Errorf(\"too many signed timestamps: %d > %d\", len(signedTimestamps), maxAllowedTimestamps)\n+\t}\n+\n \t// disallow duplicate timestamps, as a malicious actor could use duplicates to bypass the threshold\n \tfor i := 0; i < len(signedTimestamps); i++ {\n \t\tfor j := i + 1; j < len(signedTimestamps); j++ {"
            },
            {
                "sha": "40972fc2fc7582bdd24b1228751cf57233941a23",
                "filename": "pkg/verify/tsa_test.go",
                "status": "modified",
                "additions": 29,
                "deletions": 1,
                "changes": 30,
                "blob_url": "https://github.com/sigstore/sigstore-go/blob/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Ftsa_test.go",
                "raw_url": "https://github.com/sigstore/sigstore-go/raw/01e70e89e58226286d7977b4dba43b6be472b12c/pkg%2Fverify%2Ftsa_test.go",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-go/contents/pkg%2Fverify%2Ftsa_test.go?ref=01e70e89e58226286d7977b4dba43b6be472b12c",
                "patch": "@@ -113,7 +113,7 @@ func TestDuplicateTimestamps(t *testing.T) {\n \tassert.NoError(t, err)\n \n \t_, err = verify.VerifyTimestampAuthorityWithThreshold(&dupTimestampEntity{entity}, virtualSigstore, 1)\n-\tassert.Error(t, err) // duplicate timestamps should fail to verify\n+\tassert.ErrorContains(t, err, \"duplicate timestamps found\")\n }\n \n type badTSASignatureEntity struct {\n@@ -223,3 +223,31 @@ func TestBadTSACertificateChainOutsideValidityPeriod(t *testing.T) {\n \t\t})\n \t}\n }\n+\n+type tooManyTimestampsEntity struct {\n+\t*ca.TestEntity\n+}\n+\n+func (e *tooManyTimestampsEntity) Timestamps() ([][]byte, error) {\n+\ttimestamps, err := e.TestEntity.Timestamps()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tfor i := 0; i < 32; i++ {\n+\t\ttimestamps = append(timestamps, timestamps[0])\n+\t}\n+\n+\treturn timestamps, nil\n+}\n+\n+func TestTooManyTimestamps(t *testing.T) {\n+\tvirtualSigstore, err := ca.NewVirtualSigstore()\n+\tassert.NoError(t, err)\n+\n+\tentity, err := virtualSigstore.Attest(\"foo@example.com\", \"issuer\", []byte(\"statement\"))\n+\tassert.NoError(t, err)\n+\n+\t_, err = verify.VerifyTimestampAuthorityWithThreshold(&tooManyTimestampsEntity{entity}, virtualSigstore, 1)\n+\tassert.ErrorContains(t, err, \"too many signed timestamps\")\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/indico/flask-multipass/commits/0bdcf656d469e5f675cb56fd644d82fea3a97c2a",
        "url": "https://api.github.com/repos/indico/flask-multipass/commits/0bdcf656d469e5f675cb56fd644d82fea3a97c2a",
        "html_url": "https://github.com/indico/flask-multipass/commit/0bdcf656d469e5f675cb56fd644d82fea3a97c2a",
        "message": "Validate scheme of next URL (#85)",
        "files": [
            {
                "sha": "486c4af31061f79c38273e2026bbbd41abb00fd5",
                "filename": "CHANGES.rst",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/indico/flask-multipass/blob/0bdcf656d469e5f675cb56fd644d82fea3a97c2a/CHANGES.rst",
                "raw_url": "https://github.com/indico/flask-multipass/raw/0bdcf656d469e5f675cb56fd644d82fea3a97c2a/CHANGES.rst",
                "contents_url": "https://api.github.com/repos/indico/flask-multipass/contents/CHANGES.rst?ref=0bdcf656d469e5f675cb56fd644d82fea3a97c2a",
                "patch": "@@ -1,6 +1,11 @@\n Changelog\n =========\n \n+Version 0.5.5\n+-------------\n+\n+- Ensure only valid schemas (http and https) can be used when validating the ``next`` URL\n+\n Version 0.5.4\n -------------\n "
            },
            {
                "sha": "f04f7353d92c17e44e0daf1f0f61bd4f3e0051ba",
                "filename": "flask_multipass/__init__.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/indico/flask-multipass/blob/0bdcf656d469e5f675cb56fd644d82fea3a97c2a/flask_multipass%2F__init__.py",
                "raw_url": "https://github.com/indico/flask-multipass/raw/0bdcf656d469e5f675cb56fd644d82fea3a97c2a/flask_multipass%2F__init__.py",
                "contents_url": "https://api.github.com/repos/indico/flask-multipass/contents/flask_multipass%2F__init__.py?ref=0bdcf656d469e5f675cb56fd644d82fea3a97c2a",
                "patch": "@@ -13,7 +13,7 @@\n from .identity import IdentityProvider\n \n \n-__version__ = '0.5.4'\n+__version__ = '0.5.5'\n __all__ = ('Multipass', 'AuthProvider', 'IdentityProvider', 'AuthInfo', 'IdentityInfo', 'Group', 'MultipassException',\n            'AuthenticationFailed', 'IdentityRetrievalFailed', 'GroupRetrievalFailed', 'NoSuchUser',\n            'InvalidCredentials')"
            },
            {
                "sha": "62f729a42cae2e2c3e2c384222c43a3a88b60012",
                "filename": "flask_multipass/core.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/indico/flask-multipass/blob/0bdcf656d469e5f675cb56fd644d82fea3a97c2a/flask_multipass%2Fcore.py",
                "raw_url": "https://github.com/indico/flask-multipass/raw/0bdcf656d469e5f675cb56fd644d82fea3a97c2a/flask_multipass%2Fcore.py",
                "contents_url": "https://api.github.com/repos/indico/flask-multipass/contents/flask_multipass%2Fcore.py?ref=0bdcf656d469e5f675cb56fd644d82fea3a97c2a",
                "patch": "@@ -135,6 +135,8 @@ def validate_next_url(self, url):\n         a whitelist of trusted hosts to avoid creating an open redirector.\n         \"\"\"\n         url_info = urlsplit(url)\n+        if url_info.scheme and url_info.scheme not in {'http', 'https'}:\n+            return False\n         return not url_info.netloc or url_info.netloc == request.host\n \n     def process_login(self, provider=None):"
            },
            {
                "sha": "12e14033e7ab590171ad1765d4342b05d3a5eec7",
                "filename": "tests/test_core.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/indico/flask-multipass/blob/0bdcf656d469e5f675cb56fd644d82fea3a97c2a/tests%2Ftest_core.py",
                "raw_url": "https://github.com/indico/flask-multipass/raw/0bdcf656d469e5f675cb56fd644d82fea3a97c2a/tests%2Ftest_core.py",
                "contents_url": "https://api.github.com/repos/indico/flask-multipass/contents/tests%2Ftest_core.py?ref=0bdcf656d469e5f675cb56fd644d82fea3a97c2a",
                "patch": "@@ -161,6 +161,7 @@ def test_next_url_invalid():\n     ('//evil.com:80', False),\n     ('http://evil.com', False),\n     ('https://evil.com', False),\n+    ('javascript:alert(\"eeeeeeeevil\")', False),\n ))\n def test_validate_next_url(url, valid):\n     app = Flask('test')"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/indico/indico/commits/7dcb573837b9fd09d95f74d1baeae225b164cc8f",
        "url": "https://api.github.com/repos/indico/indico/commits/7dcb573837b9fd09d95f74d1baeae225b164cc8f",
        "html_url": "https://github.com/indico/indico/commit/7dcb573837b9fd09d95f74d1baeae225b164cc8f",
        "message": "Update flask-multipass to latest version",
        "files": [
            {
                "sha": "9d47e3b30fd7b65cfda8661742eae26e4cec26ce",
                "filename": "requirements.txt",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/indico/indico/blob/7dcb573837b9fd09d95f74d1baeae225b164cc8f/requirements.txt",
                "raw_url": "https://github.com/indico/indico/raw/7dcb573837b9fd09d95f74d1baeae225b164cc8f/requirements.txt",
                "contents_url": "https://api.github.com/repos/indico/indico/contents/requirements.txt?ref=7dcb573837b9fd09d95f74d1baeae225b164cc8f",
                "patch": "@@ -123,7 +123,7 @@ flask-marshmallow==1.2.1\n     # via -r requirements.in\n flask-migrate==4.0.7\n     # via -r requirements.in\n-flask-multipass==0.5.4\n+flask-multipass==0.5.5\n     # via -r requirements.in\n flask-pluginengine==0.5\n     # via -r requirements.in"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dpgaspar/Flask-AppBuilder/commits/3030e881d2e44f4021764e18e489fe940a9b3636",
        "url": "https://api.github.com/repos/dpgaspar/Flask-AppBuilder/commits/3030e881d2e44f4021764e18e489fe940a9b3636",
        "html_url": "https://github.com/dpgaspar/Flask-AppBuilder/commit/3030e881d2e44f4021764e18e489fe940a9b3636",
        "message": "feat: add no cache directive to login forms (#2266)\n\n* feat: add no cache directive to login forms\r\n\r\n* add test",
        "files": [
            {
                "sha": "46287e723515134bbc2d54d9d5034cd3c1abbb8a",
                "filename": "flask_appbuilder/security/decorators.py",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/dpgaspar/Flask-AppBuilder/blob/3030e881d2e44f4021764e18e489fe940a9b3636/flask_appbuilder%2Fsecurity%2Fdecorators.py",
                "raw_url": "https://github.com/dpgaspar/Flask-AppBuilder/raw/3030e881d2e44f4021764e18e489fe940a9b3636/flask_appbuilder%2Fsecurity%2Fdecorators.py",
                "contents_url": "https://api.github.com/repos/dpgaspar/Flask-AppBuilder/contents/flask_appbuilder%2Fsecurity%2Fdecorators.py?ref=3030e881d2e44f4021764e18e489fe940a9b3636",
                "patch": "@@ -30,6 +30,20 @@\n P = ParamSpec(\"P\")\n \n \n+def no_cache(view: Callable[..., Response]) -> Callable[..., Response]:\n+    @functools.wraps(view)\n+    def wrapped_view(*args, **kwargs) -> Response:\n+        response = make_response(view(*args, **kwargs))\n+        response.headers[\n+            \"Cache-Control\"\n+        ] = \"no-store, no-cache, must-revalidate, max-age=0\"\n+        response.headers[\"Pragma\"] = \"no-cache\"\n+        response.headers[\"Expires\"] = \"0\"\n+        return response\n+\n+    return wrapped_view\n+\n+\n def response_unauthorized_mvc(status_code: int) -> Response:\n     response = make_response(\n         jsonify({\"message\": str(FLAMSG_ERR_SEC_ACCESS_DENIED), \"severity\": \"danger\"}),"
            },
            {
                "sha": "ddc1d0b5e893c86c6af0bf4a1767907789005cc6",
                "filename": "flask_appbuilder/security/views.py",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/dpgaspar/Flask-AppBuilder/blob/3030e881d2e44f4021764e18e489fe940a9b3636/flask_appbuilder%2Fsecurity%2Fviews.py",
                "raw_url": "https://github.com/dpgaspar/Flask-AppBuilder/raw/3030e881d2e44f4021764e18e489fe940a9b3636/flask_appbuilder%2Fsecurity%2Fviews.py",
                "contents_url": "https://api.github.com/repos/dpgaspar/Flask-AppBuilder/contents/flask_appbuilder%2Fsecurity%2Fviews.py?ref=3030e881d2e44f4021764e18e489fe940a9b3636",
                "patch": "@@ -9,7 +9,7 @@\n from flask_appbuilder.baseviews import BaseView\n from flask_appbuilder.charts.views import DirectByChartView\n from flask_appbuilder.fieldwidgets import BS3PasswordFieldWidget\n-from flask_appbuilder.security.decorators import has_access\n+from flask_appbuilder.security.decorators import has_access, no_cache\n from flask_appbuilder.security.forms import (\n     DynamicForm,\n     LoginForm_db,\n@@ -520,6 +520,7 @@ class AuthDBView(AuthView):\n     login_template = \"appbuilder/general/security/login_db.html\"\n \n     @expose(\"/login/\", methods=[\"GET\", \"POST\"])\n+    @no_cache\n     def login(self):\n         if g.user is not None and g.user.is_authenticated:\n             return redirect(self.appbuilder.get_url_for_index)\n@@ -543,6 +544,7 @@ class AuthLDAPView(AuthView):\n     login_template = \"appbuilder/general/security/login_ldap.html\"\n \n     @expose(\"/login/\", methods=[\"GET\", \"POST\"])\n+    @no_cache\n     def login(self):\n         if g.user is not None and g.user.is_authenticated:\n             return redirect(self.appbuilder.get_url_for_index)\n@@ -568,6 +570,7 @@ class AuthOIDView(AuthView):\n     oid_ask_for_optional: List[str] = []\n \n     @expose(\"/login/\", methods=[\"GET\", \"POST\"])\n+    @no_cache\n     def login(self, flag=True) -> WerkzeugResponse:\n         @self.appbuilder.sm.oid.loginhandler\n         def login_handler(self):"
            },
            {
                "sha": "bb022fc91196145a111c7eaba43a8567833cf5c4",
                "filename": "tests/security/test_mvc_security.py",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/dpgaspar/Flask-AppBuilder/blob/3030e881d2e44f4021764e18e489fe940a9b3636/tests%2Fsecurity%2Ftest_mvc_security.py",
                "raw_url": "https://github.com/dpgaspar/Flask-AppBuilder/raw/3030e881d2e44f4021764e18e489fe940a9b3636/tests%2Fsecurity%2Ftest_mvc_security.py",
                "contents_url": "https://api.github.com/repos/dpgaspar/Flask-AppBuilder/contents/tests%2Fsecurity%2Ftest_mvc_security.py?ref=3030e881d2e44f4021764e18e489fe940a9b3636",
                "patch": "@@ -63,6 +63,19 @@ class Model1View(ModelView):\n \n         self.appbuilder.add_view(Model1View, \"Model1\", category=\"Model1\")\n \n+    def test_sec_login_no_cache(self):\n+        \"\"\"\n+        Test Security Login, no cache directives\n+        \"\"\"\n+        rv = self.client.get(\"/login/\")\n+        assert rv.status_code == 200\n+        assert (\n+            rv.headers.get(\"Cache-Control\")\n+            == \"no-store, no-cache, must-revalidate, max-age=0\"\n+        )\n+        assert rv.headers[\"Pragma\"] == \"no-cache\"\n+        assert rv.headers[\"Expires\"] == \"0\"\n+\n     def test_sec_login(self):\n         \"\"\"\n         Test Security Login, Logout, invalid login, invalid access"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ethyca/fides/commits/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
        "url": "https://api.github.com/repos/ethyca/fides/commits/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
        "html_url": "https://github.com/ethyca/fides/commit/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
        "message": "Merge commit from fork\n\n* Added security for email templates that used Jinja2\n\n* Added security for email templates that used Jinja2\n\n* Added security for email templates that used Jinja2\n\n* QA to migration\n\n* Update CHANGELOG.md\n\n* Update src/fides/api/alembic/migrations/versions/ff81f8e7d6ae_migrate_messaging_template_to_use_new_.py\n\n* QA\n\n* Update migrations",
        "files": [
            {
                "sha": "06c5d7cbbea93733556f2b7de2b0052d99dcc200",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/ethyca/fides/blob/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/CHANGELOG.md",
                "raw_url": "https://github.com/ethyca/fides/raw/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/CHANGELOG.md?ref=829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
                "patch": "@@ -38,6 +38,9 @@ The types of changes are:\n - TCF Optimized for performance on initial load by offsetting most experience data until after banner is shown [#5230](https://github.com/ethyca/fides/pull/5230)\n - Updates to support DynamoDB schema with Tokenless IAM auth [#5240](https://github.com/ethyca/fides/pull/5240)\n \n+### Security\n+- Removed Jinja2 for email templates, the variables syntax changed from `{{variable_name}}` to `__VARIABLE_NAME__` [CVE-2024-45053](https://github.com/ethyca/fides/security/advisories/GHSA-c34r-238x-f7qx)\n+\n ### Developer Experience\n - Sourcemaps are now working for fides-js in debug mode [#5222](https://github.com/ethyca/fides/pull/5222)\n "
            },
            {
                "sha": "0b7b2847081ee24b65415bff8211883a76eaf46e",
                "filename": "src/fides/api/alembic/migrations/versions/eef4477c37d0_changes_the_email_template_variables_.py",
                "status": "added",
                "additions": 47,
                "deletions": 0,
                "changes": 47,
                "blob_url": "https://github.com/ethyca/fides/blob/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/src%2Ffides%2Fapi%2Falembic%2Fmigrations%2Fversions%2Feef4477c37d0_changes_the_email_template_variables_.py",
                "raw_url": "https://github.com/ethyca/fides/raw/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/src%2Ffides%2Fapi%2Falembic%2Fmigrations%2Fversions%2Feef4477c37d0_changes_the_email_template_variables_.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/src%2Ffides%2Fapi%2Falembic%2Fmigrations%2Fversions%2Feef4477c37d0_changes_the_email_template_variables_.py?ref=829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
                "patch": "@@ -0,0 +1,47 @@\n+\"\"\"Changes the email template variables syntax from {{variable_name}} to __VARIABLE_NAME__.\n+\n+Revision ID: eef4477c37d0\n+Revises: cc37edf20859\n+Create Date: 2024-09-03 12:47:54.708196\n+\n+\"\"\"\n+from alembic import op\n+\n+\n+# revision identifiers, used by Alembic.\n+revision = 'eef4477c37d0'\n+down_revision = 'cc37edf20859'\n+branch_labels = None\n+depends_on = None\n+\n+\n+VARIABLES = [\"minutes\", \"days\", \"denial_reason\", \"code\", \"download_link\"]\n+JSON_VARIABLES = [\"subject\", \"body\"]\n+\n+\n+def upgrade():\n+    for json_variable in JSON_VARIABLES:\n+        for variable in VARIABLES:\n+            statement = f\"\"\"\n+            UPDATE messaging_template\n+            SET content = jsonb_set(\n+                content,\n+                '{{{json_variable}}}',\n+                to_jsonb(REPLACE(content ->> '{json_variable}', '{{{{{variable}}}}}', '__{variable.upper()}__'))\n+            );\n+            \"\"\"\n+            op.execute(statement)\n+\n+\n+def downgrade():\n+    for json_variable in JSON_VARIABLES:\n+        for variable in VARIABLES:\n+            statement = f\"\"\"\n+            UPDATE messaging_template\n+            SET content = jsonb_set(\n+                content,\n+                '{{{json_variable}}}',\n+                to_jsonb(REPLACE(content ->> '{json_variable}', '__{variable.upper()}__', '{{{{{variable}}}}}'))\n+            );\n+            \"\"\"\n+            op.execute(statement)"
            },
            {
                "sha": "190e9400ddfa93eff168d320d0ac9383b4a78e15",
                "filename": "src/fides/api/models/messaging_template.py",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/ethyca/fides/blob/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/src%2Ffides%2Fapi%2Fmodels%2Fmessaging_template.py",
                "raw_url": "https://github.com/ethyca/fides/raw/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/src%2Ffides%2Fapi%2Fmodels%2Fmessaging_template.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/src%2Ffides%2Fapi%2Fmodels%2Fmessaging_template.py?ref=829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
                "patch": "@@ -19,8 +19,8 @@\n     MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value: {\n         \"label\": \"Subject identity verification\",\n         \"content\": {\n-            \"subject\": \"Your one-time code is {{code}}\",\n-            \"body\": \"Your privacy request verification code is {{code}}. Please return to the Privacy Center and enter the code to continue. This code will expire in {{minutes}} minutes.\",\n+            \"subject\": \"Your one-time code is __CODE__\",\n+            \"body\": \"Your privacy request verification code is __CODE__. Please return to the Privacy Center and enter the code to continue. This code will expire in __MINUTES__ minutes.\",\n         },\n     },\n     MessagingActionType.PRIVACY_REQUEST_RECEIPT.value: {\n@@ -41,14 +41,14 @@\n         \"label\": \"Privacy request denied\",\n         \"content\": {\n             \"subject\": \"Your privacy request has been denied\",\n-            \"body\": \"Your privacy request has been denied. {{denial_reason}}.\",\n+            \"body\": \"Your privacy request has been denied. __DENIAL_REASON__.\",\n         },\n     },\n     MessagingActionType.PRIVACY_REQUEST_COMPLETE_ACCESS.value: {\n         \"label\": \"Access request completed\",\n         \"content\": {\n             \"subject\": \"Your data is ready to be downloaded\",\n-            \"body\": \"Your access request has been completed and can be downloaded at {{download_link}}. For security purposes, this secret link will expire in {{days}} days.\",\n+            \"body\": \"Your access request has been completed and can be downloaded at __DOWNLOAD_LINK__. For security purposes, this secret link will expire in __DAYS__ days.\",\n         },\n     },\n     MessagingActionType.PRIVACY_REQUEST_COMPLETE_DELETION.value: {"
            },
            {
                "sha": "42c98d41f0205092511d1a0f08a9294829512536",
                "filename": "src/fides/api/service/messaging/message_dispatch_service.py",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/ethyca/fides/blob/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/src%2Ffides%2Fapi%2Fservice%2Fmessaging%2Fmessage_dispatch_service.py",
                "raw_url": "https://github.com/ethyca/fides/raw/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/src%2Ffides%2Fapi%2Fservice%2Fmessaging%2Fmessage_dispatch_service.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/src%2Ffides%2Fapi%2Fservice%2Fmessaging%2Fmessage_dispatch_service.py?ref=829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
                "patch": "@@ -5,7 +5,6 @@\n \n import requests\n import sendgrid\n-from jinja2 import Environment\n from loguru import logger\n from sendgrid.helpers.mail import Content, Email, Mail, Personalization, TemplateId, To\n from sqlalchemy.orm import Session\n@@ -384,9 +383,11 @@ def _render(template_str: str, variables: Optional[Dict] = None) -> str:\n     \"\"\"Helper function to render a template string with the provided variables.\"\"\"\n     if variables is None:\n         variables = {}\n-    jinja_env = Environment()\n-    template = jinja_env.from_string(template_str)\n-    return template.render(variables)\n+\n+    for key, value in variables.items():\n+        template_str = template_str.replace(f\"__{key.upper()}__\", str(value))\n+\n+    return template_str\n \n \n def _build_email(  # pylint: disable=too-many-return-statements"
            },
            {
                "sha": "0781a47782bac1cb6e727fa705ec35fcf2a244f2",
                "filename": "tests/fixtures/application_fixtures.py",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/ethyca/fides/blob/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Ffixtures%2Fapplication_fixtures.py",
                "raw_url": "https://github.com/ethyca/fides/raw/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Ffixtures%2Fapplication_fixtures.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/tests%2Ffixtures%2Fapplication_fixtures.py?ref=829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
                "patch": "@@ -401,8 +401,8 @@ def property_b(db: Session) -> Generator:\n def messaging_template_with_property_disabled(db: Session, property_a) -> Generator:\n     template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n     content = {\n-        \"subject\": \"Here is your code {{code}}\",\n-        \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+        \"subject\": \"Here is your code __CODE__\",\n+        \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n     }\n     data = {\n         \"content\": content,\n@@ -422,8 +422,8 @@ def messaging_template_with_property_disabled(db: Session, property_a) -> Genera\n def messaging_template_no_property_disabled(db: Session) -> Generator:\n     template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n     content = {\n-        \"subject\": \"Here is your code {{code}}\",\n-        \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+        \"subject\": \"Here is your code __CODE__\",\n+        \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n     }\n     data = {\n         \"content\": content,\n@@ -443,8 +443,8 @@ def messaging_template_no_property_disabled(db: Session) -> Generator:\n def messaging_template_no_property(db: Session) -> Generator:\n     template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n     content = {\n-        \"subject\": \"Here is your code {{code}}\",\n-        \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+        \"subject\": \"Here is your code __CODE__\",\n+        \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n     }\n     data = {\n         \"content\": content,\n@@ -466,8 +466,8 @@ def messaging_template_subject_identity_verification(\n ) -> Generator:\n     template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n     content = {\n-        \"subject\": \"Here is your code {{code}}\",\n-        \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+        \"subject\": \"Here is your code __CODE__\",\n+        \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n     }\n     data = {\n         \"content\": content,"
            },
            {
                "sha": "488c840eceb401bcdb526d906ff576dd6a9e20fd",
                "filename": "tests/ops/api/v1/endpoints/test_messaging_endpoints.py",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/ethyca/fides/blob/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Fops%2Fapi%2Fv1%2Fendpoints%2Ftest_messaging_endpoints.py",
                "raw_url": "https://github.com/ethyca/fides/raw/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Fops%2Fapi%2Fv1%2Fendpoints%2Ftest_messaging_endpoints.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/tests%2Fops%2Fapi%2Fv1%2Fendpoints%2Ftest_messaging_endpoints.py?ref=829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
                "patch": "@@ -1944,8 +1944,8 @@ def payload(self) -> List[Dict[str, Any]]:\n             {\n                 \"type\": \"subject_identity_verification\",\n                 \"content\": {\n-                    \"body\": \"Your privacy request verification code is {{code}}. Please return to the Privacy Center and enter the code to continue. You have {{minutes}} minutes.\",\n-                    \"subject\": \"Your code is {{code}}\",\n+                    \"body\": \"Your privacy request verification code is __CODE__. Please return to the Privacy Center and enter the code to continue. You have __MINUTES__ minutes.\",\n+                    \"subject\": \"Your code is __CODE__\",\n                 },\n             },\n         ]\n@@ -1979,8 +1979,8 @@ def test_put_messaging_templates(\n                 {\n                     \"type\": \"subject_identity_verification\",\n                     \"content\": {\n-                        \"body\": \"Your privacy request verification code is {{code}}. Please return to the Privacy Center and enter the code to continue. You have {{minutes}} minutes.\",\n-                        \"subject\": \"Your code is {{code}}\",\n+                        \"body\": \"Your privacy request verification code is __CODE__. Please return to the Privacy Center and enter the code to continue. You have __MINUTES__ minutes.\",\n+                        \"subject\": \"Your code is __CODE__\",\n                     },\n                     \"label\": \"Subject identity verification\",\n                 }\n@@ -2015,8 +2015,8 @@ def test_put_messaging_templates_missing_values(\n                 {\n                     \"type\": \"subject_identity_verification\",\n                     \"content\": {\n-                        \"body\": \"Your privacy request verification code is {{code}}. Please return to the Privacy Center and enter the code to continue. This code will expire in {{minutes}} minutes.\",\n-                        \"subject\": \"Your one-time code is {{code}}\",\n+                        \"body\": \"Your privacy request verification code is __CODE__. Please return to the Privacy Center and enter the code to continue. This code will expire in __MINUTES__ minutes.\",\n+                        \"subject\": \"Your one-time code is __CODE__\",\n                     },\n                     \"label\": \"Subject identity verification\",\n                 }\n@@ -2202,8 +2202,8 @@ def test_delete_messaging_template_by_id_success(\n         # Creating new config, so we don't run into issues trying to clean up a deleted fixture\n         template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n         content = {\n-            \"subject\": \"Here is your code {{code}}\",\n-            \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+            \"subject\": \"Here is your code __CODE__\",\n+            \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n         }\n         data = {\n             \"content\": content,"
            },
            {
                "sha": "b79f509d8f706fa357cd2c7fb642e78efd8bd38c",
                "filename": "tests/ops/service/messaging/message_dispatch_service_test.py",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/ethyca/fides/blob/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Fops%2Fservice%2Fmessaging%2Fmessage_dispatch_service_test.py",
                "raw_url": "https://github.com/ethyca/fides/raw/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Fops%2Fservice%2Fmessaging%2Fmessage_dispatch_service_test.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/tests%2Fops%2Fservice%2Fmessaging%2Fmessage_dispatch_service_test.py?ref=829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
                "patch": "@@ -109,8 +109,8 @@ def test_email_dispatch_mailgun_success(\n     Test scenario:\n     \u2705\ufe0e Property-specific messaging is enabled\n     \u274c No template configured for action type\n-    \n-    Result: Email is not sent. An explicit messaging template with matching action type is needed to send emails for \n+\n+    Result: Email is not sent. An explicit messaging template with matching action type is needed to send emails for\n     property-specific messaging\n     \"\"\"\n \n@@ -140,7 +140,7 @@ def test_email_dispatch_property_specific_templates_enabled_no_template(\n     Test scenario:\n     \u274c Property-specific messaging is disabled\n     \u2705\ufe0e Has template configured for action type\n-    \n+\n     Result: Email sent the template configured with matching action type.\n     \"\"\"\n \n@@ -178,7 +178,7 @@ def test_email_dispatch_property_specific_templates_disabled_with_template(\n     Test scenario:\n     \u274c Property-specific messaging is disabled\n     \u274c No template configured for action type\n-    \n+\n     Result: Email sent with default messaging template.\n     \"\"\"\n \n@@ -217,7 +217,7 @@ def test_email_dispatch_property_specific_templates_disabled_no_template(\n     \u2705\ufe0e Has template configured for action type\n     \u274c No property id attached to template\n     \u274c No property id in request\n-    \n+\n     Result: Email not sent. There was no explicit property id linked to the template with matching action type.\n     \"\"\"\n \n@@ -250,7 +250,7 @@ def test_email_dispatch_property_specific_templates_enabled_with_template_no_pro\n     \u2705\ufe0e Has template configured for action type\n     \u2705\ufe0e Default property id attached to template\n     \u274c No property id in request\n-    \n+\n     Result: Email sent using template linked to default property id. If no property id was received, we assume\n     the default property id to look up the associated messaging template.\n     \"\"\"\n@@ -294,7 +294,7 @@ def test_email_dispatch_property_specific_templates_enabled_with_template_has_pr\n     \u2705\ufe0e Has template configured for action type\n     \u274c No property attached to template\n     \u2705 Default property id in request\n-    \n+\n     Result: Email not sent. There was no explicit property id linked to the template with matching action type.\n     \"\"\"\n \n@@ -328,7 +328,7 @@ def test_email_dispatch_property_specific_templates_enabled_with_template_no_pro\n    \u2705\ufe0e Has template configured for action type\n    \u2705 Property attached to template\n    \u2705 Matching property id in request\n-   \n+\n    Result: Email sent using template with with property id\n    \"\"\"\n "
            },
            {
                "sha": "3c375fb4f3d12a1bbbf8eb8080ba1eb540728cbb",
                "filename": "tests/ops/service/messaging/test_message_template_render.py",
                "status": "added",
                "additions": 64,
                "deletions": 0,
                "changes": 64,
                "blob_url": "https://github.com/ethyca/fides/blob/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Fops%2Fservice%2Fmessaging%2Ftest_message_template_render.py",
                "raw_url": "https://github.com/ethyca/fides/raw/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Fops%2Fservice%2Fmessaging%2Ftest_message_template_render.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/tests%2Fops%2Fservice%2Fmessaging%2Ftest_message_template_render.py?ref=829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
                "patch": "@@ -0,0 +1,64 @@\n+import pytest\n+\n+from fides.api.service.messaging.message_dispatch_service import _render\n+\n+\n+@pytest.mark.unit\n+class TestMessageTemplateRender:\n+\n+    def test_template_render(self):\n+        \"\"\"\n+        Test that a template is rendered correctly with the given variables.\n+        \"\"\"\n+        template_str = \"\"\"\n+        Your privacy request has been denied.\n+        __DENIAL_REASON__\n+        \"\"\"\n+        variables = {\n+            \"denial_reason\": \"Accounts with an unpaid balance cannot be deleted.\"\n+        }\n+\n+        expected_rendered_template = \"\"\"\n+        Your privacy request has been denied.\n+        Accounts with an unpaid balance cannot be deleted.\n+        \"\"\"\n+\n+        rendered_template = _render(template_str, variables)\n+        assert rendered_template == expected_rendered_template\n+\n+    def test_template_render_unsafe(self):\n+        \"\"\"\n+        Test that a template with unsafe code is not rendered and raises a SecurityError.\n+        \"\"\"\n+        template_str = \"\"\"\n+        Your privacy request has been denied.\n+        *bb*\n+        {% for s in ().__class__.__base__.__subclasses__() %}{% if \"warning\" in s.__name__ %}{{s()._module.__builtins__['__import__']('os').popen(\"env\").read() }}{% endif %}\n+        {% endfor %}\n+        __CONFIG__\n+        *aa*\n+        \"\"\"\n+\n+        expected_rendered_template = \"\"\"\n+        Your privacy request has been denied.\n+        *bb*\n+        {% for s in ().__class__.__base__.__subclasses__() %}{% if \"warning\" in s.__name__ %}{{s()._module.__builtins__['__import__']('os').popen(\"env\").read() }}{% endif %}\n+        {% endfor %}\n+        123\n+        *aa*\n+        \"\"\"\n+\n+        variables = {\n+            \"config\": \"123\",\n+        }\n+\n+        rendered_template = _render(template_str, variables)\n+        assert rendered_template == expected_rendered_template\n+\n+        template_str = \"your privacy request has been denied. __CONFIG.security.app_encryption_key__\"\n+        variables = {\n+            \"config\": \"123\",\n+        }\n+\n+        rendered_template = _render(template_str, variables)\n+        assert rendered_template == template_str"
            },
            {
                "sha": "e3ad21ab364b111e21377154d4414ed862722139",
                "filename": "tests/ops/service/messaging/test_messaging_crud_service.py",
                "status": "modified",
                "additions": 35,
                "deletions": 35,
                "changes": 70,
                "blob_url": "https://github.com/ethyca/fides/blob/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Fops%2Fservice%2Fmessaging%2Ftest_messaging_crud_service.py",
                "raw_url": "https://github.com/ethyca/fides/raw/829cbd9cb5ef9c814fbac1ed6800e8d939d359c5/tests%2Fops%2Fservice%2Fmessaging%2Ftest_messaging_crud_service.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/tests%2Fops%2Fservice%2Fmessaging%2Ftest_messaging_crud_service.py?ref=829cbd9cb5ef9c814fbac1ed6800e8d939d359c5",
                "patch": "@@ -39,8 +39,8 @@ def test_get_all_basic_messaging_templates(self, db: Session):\n     def test_get_basic_messaging_template_by_type_existing(self, db: Session):\n         template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n         content = {\n-            \"subject\": \"Here is your code {{code}}\",\n-            \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+            \"subject\": \"Here is your code __CODE__\",\n+            \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n         }\n         MessagingTemplate.create_or_update(\n             db=db,\n@@ -80,7 +80,7 @@ def test_create_or_update_basic_templates_existing_type(\n     ):\n         content = {\n             \"subject\": \"Test new subject\",\n-            \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+            \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n         }\n         create_or_update_basic_templates(\n             db,\n@@ -99,7 +99,7 @@ def test_create_or_update_basic_templates_new_type(\n     ):\n         content = {\n             \"subject\": \"Test new subject\",\n-            \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+            \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n         }\n         new_template = create_or_update_basic_templates(\n             db,\n@@ -124,7 +124,7 @@ def test_create_or_update_basic_templates_existing_type_multiple(\n     ):\n         content = {\n             \"subject\": \"Test new subject\",\n-            \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+            \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n         }\n         create_or_update_basic_templates(\n             db,\n@@ -298,8 +298,8 @@ def test_update_messaging_template_add_property(\n     ):\n         update_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             # add new property B\n             \"properties\": [property_a.id, property_b.id],\n@@ -331,8 +331,8 @@ def test_update_messaging_template_replace_property(\n     ):\n         update_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             # replace property a with property b\n             \"properties\": [property_b.id],\n@@ -362,8 +362,8 @@ def test_update_messaging_template_remove_all_properties_and_enabled(\n     ):\n         update_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             # Remove all properties\n             \"properties\": None,\n@@ -385,8 +385,8 @@ def test_update_messaging_template_remove_all_properties_and_disabled(\n     ):\n         update_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             # Remove all properties\n             \"properties\": None,\n@@ -417,8 +417,8 @@ def test_update_messaging_template_id_not_found(\n     ):\n         update_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             \"properties\": [property_a.id, property_b.id],\n             \"is_enabled\": True,\n@@ -433,8 +433,8 @@ def test_update_messaging_template_property_not_found(\n     ):\n         update_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             \"properties\": [property_a.id, \"invalid_property_id\"],\n             \"is_enabled\": True,\n@@ -465,8 +465,8 @@ def test_update_messaging_template_conflicting_template(\n     ):\n         update_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             # this property is already being used by another messaging_template_subject_identity_verification template with same type\n             \"properties\": [property_a.id],\n@@ -488,8 +488,8 @@ def test_update_messaging_template_conflicting_template_but_one_disabled(\n     ):\n         update_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             # this property is already being used by another template with same type, but is not enabled, so this is fine\n             \"properties\": [property_a.id],\n@@ -514,8 +514,8 @@ def test_create_messaging_template(self, db: Session, property_a):\n         template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n         create_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             \"properties\": [property_a.id],\n             \"is_enabled\": True,\n@@ -538,8 +538,8 @@ def test_create_messaging_template_no_properties(self, db: Session):\n         template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n         create_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             \"is_enabled\": True,\n         }\n@@ -555,8 +555,8 @@ def test_create_messaging_template_invalid_type(self, db: Session, property_a):\n         template_type = \"invalid\"\n         create_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             \"properties\": [property_a.id],\n             \"is_enabled\": True,\n@@ -574,8 +574,8 @@ def test_create_messaging_template_property_not_found(\n         template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n         create_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             \"properties\": [property_a.id, \"invalid_id\"],\n             \"is_enabled\": True,\n@@ -603,8 +603,8 @@ def test_create_messaging_template_conflicting_template_but_one_disabled(\n         template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n         create_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             \"properties\": [property_a.id],\n             \"is_enabled\": False,\n@@ -630,8 +630,8 @@ def test_create_messaging_template_conflicting_template(\n         template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n         create_body = {\n             \"content\": {\n-                \"subject\": \"Here is your code {{code}}\",\n-                \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+                \"subject\": \"Here is your code __CODE__\",\n+                \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n             },\n             # this property is already being used by another template with same type\n             \"properties\": [property_a.id],\n@@ -653,8 +653,8 @@ def test_delete_template_by_id(\n         # Create message template\n         template_type = MessagingActionType.SUBJECT_IDENTITY_VERIFICATION.value\n         content = {\n-            \"subject\": \"Here is your code {{code}}\",\n-            \"body\": \"Use code {{code}} to verify your identity, you have {{minutes}} minutes!\",\n+            \"subject\": \"Here is your code __CODE__\",\n+            \"body\": \"Use code __CODE__ to verify your identity, you have __MINUTES__ minutes!\",\n         }\n         data = {\n             \"content\": content,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ethyca/fides/commits/457b0e9df9f0d337133d6078bca6ed88bbc745f4",
        "url": "https://api.github.com/repos/ethyca/fides/commits/457b0e9df9f0d337133d6078bca6ed88bbc745f4",
        "html_url": "https://github.com/ethyca/fides/commit/457b0e9df9f0d337133d6078bca6ed88bbc745f4",
        "message": "Merge commit from fork\n\n* WIP commit - delay throwing errors on login. Create a fake user and attempt to parallelize operations so similar actions are performed on the fake user and the real user.   This isn't possible for places where we need to write to the database.  Further random delays are added to offset.\n\n* Create a fake user was more time consuming than the database call so bad user requests have become slower than good user requests. I've overcorrected. Instead, create the fake user upfront and hold it in memory.\n\n* Update changelog.",
        "files": [
            {
                "sha": "5c7582bc6f69cb1f2763eb165eca5b7357733c92",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/ethyca/fides/blob/457b0e9df9f0d337133d6078bca6ed88bbc745f4/CHANGELOG.md",
                "raw_url": "https://github.com/ethyca/fides/raw/457b0e9df9f0d337133d6078bca6ed88bbc745f4/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/CHANGELOG.md?ref=457b0e9df9f0d337133d6078bca6ed88bbc745f4",
                "patch": "@@ -40,6 +40,10 @@ The types of changes are:\n - Fix bug where Data Detection & Discovery table pagination fails to reset after navigating or searching  [#5234](https://github.com/ethyca/fides/pull/5234)\n - Ignoring HTTP 400 error responses from the unsubscribe endpoint for HubSpot [#5237](https://github.com/ethyca/fides/pull/5237)\n \n+### Security\n+- Reduced timing differences in login endpoint [CVE-2024-45052](https://github.com/ethyca/fides/security/advisories/GHSA-2h46-8gf5-fmxv)\n+\n+\n ## [2.43.1](https://github.com/ethyca/fides/compare/2.43.0...2.43.1)\n \n ### Added"
            },
            {
                "sha": "78dc45b5273c2f3d0831e648286440fc078eb973",
                "filename": "src/fides/api/api/v1/endpoints/user_endpoints.py",
                "status": "modified",
                "additions": 27,
                "deletions": 9,
                "changes": 36,
                "blob_url": "https://github.com/ethyca/fides/blob/457b0e9df9f0d337133d6078bca6ed88bbc745f4/src%2Ffides%2Fapi%2Fapi%2Fv1%2Fendpoints%2Fuser_endpoints.py",
                "raw_url": "https://github.com/ethyca/fides/raw/457b0e9df9f0d337133d6078bca6ed88bbc745f4/src%2Ffides%2Fapi%2Fapi%2Fv1%2Fendpoints%2Fuser_endpoints.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/src%2Ffides%2Fapi%2Fapi%2Fv1%2Fendpoints%2Fuser_endpoints.py?ref=457b0e9df9f0d337133d6078bca6ed88bbc745f4",
                "patch": "@@ -1,4 +1,6 @@\n import json\n+import random\n+import time\n from datetime import datetime\n from typing import List, Optional\n \n@@ -35,6 +37,7 @@\n from fides.api.models.sql_models import System  # type: ignore[attr-defined]\n from fides.api.oauth.roles import APPROVER, VIEWER\n from fides.api.oauth.utils import (\n+    create_temporary_user_for_login_flow,\n     extract_payload,\n     get_current_user,\n     oauth2_scheme,\n@@ -76,6 +79,11 @@\n router = APIRouter(tags=[\"Users\"], prefix=V1_URL_PREFIX)\n \n \n+ARTIFICIAL_TEMP_USER = create_temporary_user_for_login_flow(\n+    CONFIG\n+)  # To reduce likelihood of timing attacks.  Creating once and holding in memory\n+\n+\n def get_system_by_fides_key(db: Session, system_key: FidesKey) -> System:\n     \"\"\"Load a system by FidesKey or throw a 404\"\"\"\n     system = System.get_by(db, field=\"fides_key\", value=system_key)\n@@ -541,6 +549,8 @@ def user_login(\n     generate a token.\"\"\"\n     user: FidesUser\n     client: ClientDetail\n+    should_raise_exception: bool = False\n+\n     if (\n         config.security.root_username\n         and config.security.root_password\n@@ -578,18 +588,15 @@ def user_login(\n             db, field=\"username\", value=user_data.username\n         )\n \n-        invalid_user_error_msg = \"Incorrect username or password.\"\n-\n         if not user_check:\n-            raise HTTPException(\n-                status_code=HTTP_403_FORBIDDEN, detail=invalid_user_error_msg\n-            )\n+            # Postpone raising the exception to reduce the time differences between\n+            # login flows for valid and invalid users. Instead, create a temporary user\n+            # on which we'll perform parallel operations\n+            should_raise_exception = True\n+            user_check = ARTIFICIAL_TEMP_USER\n \n         if not user_check.credentials_valid(user_data.password):\n-            raise HTTPException(\n-                status_code=HTTP_403_FORBIDDEN,\n-                detail=invalid_user_error_msg,\n-            )\n+            should_raise_exception = True\n \n         # We have already checked for None but mypy still complains. This prevents mypy\n         # from complaining.\n@@ -600,10 +607,21 @@ def user_login(\n             config.security.oauth_client_id_length_bytes,\n             config.security.oauth_client_secret_length_bytes,\n             user,\n+            skip_save=should_raise_exception,\n         )\n \n     logger.info(\"Creating login access token\")\n     access_code = client.create_access_code_jwe(config.security.app_encryption_key)\n+\n+    # Sleep for a random time period\n+    time.sleep(random.uniform(0.00, 0.50))\n+\n+    if should_raise_exception:\n+        # Now raise postponed exception!\n+        raise HTTPException(\n+            status_code=HTTP_403_FORBIDDEN, detail=\"Incorrect username or password.\"\n+        )\n+\n     return UserLoginResponse(\n         user_data=user,\n         token_data=AccessToken(access_token=access_code),"
            },
            {
                "sha": "9e2fddc4ac8eb25d95888fadbaa1a04d60fbb300",
                "filename": "src/fides/api/models/client.py",
                "status": "modified",
                "additions": 22,
                "deletions": 14,
                "changes": 36,
                "blob_url": "https://github.com/ethyca/fides/blob/457b0e9df9f0d337133d6078bca6ed88bbc745f4/src%2Ffides%2Fapi%2Fmodels%2Fclient.py",
                "raw_url": "https://github.com/ethyca/fides/raw/457b0e9df9f0d337133d6078bca6ed88bbc745f4/src%2Ffides%2Fapi%2Fmodels%2Fclient.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/src%2Ffides%2Fapi%2Fmodels%2Fclient.py?ref=457b0e9df9f0d337133d6078bca6ed88bbc745f4",
                "patch": "@@ -66,6 +66,7 @@ def create_client_and_secret(\n         roles: list[str] | None = None,\n         systems: list[str] | None = None,\n         connections: list[str] | None = None,\n+        in_memory: bool | None = False,\n     ) -> tuple[\"ClientDetail\", str]:\n         \"\"\"Creates a ClientDetail and returns that along with the unhashed secret\n         so it can be returned to the user on create\n@@ -92,20 +93,27 @@ def create_client_and_secret(\n             salt.encode(encoding),\n         )\n \n-        client = super().create(\n-            db,\n-            data={\n-                \"id\": client_id,\n-                \"salt\": salt,\n-                \"hashed_secret\": hashed_secret,\n-                \"scopes\": scopes,\n-                \"fides_key\": fides_key,\n-                \"user_id\": user_id,\n-                \"roles\": roles,\n-                \"systems\": systems,\n-                \"connections\": connections,\n-            },\n-        )\n+        data = {\n+            \"id\": client_id,\n+            \"salt\": salt,\n+            \"hashed_secret\": hashed_secret,\n+            \"scopes\": scopes,\n+            \"fides_key\": fides_key,\n+            \"user_id\": user_id,\n+            \"roles\": roles,\n+            \"systems\": systems,\n+            \"connections\": connections,\n+        }\n+\n+        if in_memory:\n+            client = ClientDetail(\n+                **data\n+            )  # For creating a temporary ClientDetail for invalid user login flow\n+        else:\n+            client = super().create(\n+                db,\n+                data=data,\n+            )\n         return client, secret  # type: ignore\n \n     @classmethod"
            },
            {
                "sha": "b9c937138a63ab50574d26069794a593bcdf81bf",
                "filename": "src/fides/api/oauth/utils.py",
                "status": "modified",
                "additions": 48,
                "deletions": 1,
                "changes": 49,
                "blob_url": "https://github.com/ethyca/fides/blob/457b0e9df9f0d337133d6078bca6ed88bbc745f4/src%2Ffides%2Fapi%2Foauth%2Futils.py",
                "raw_url": "https://github.com/ethyca/fides/raw/457b0e9df9f0d337133d6078bca6ed88bbc745f4/src%2Ffides%2Fapi%2Foauth%2Futils.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/src%2Ffides%2Fapi%2Foauth%2Futils.py?ref=457b0e9df9f0d337133d6078bca6ed88bbc745f4",
                "patch": "@@ -17,6 +17,7 @@\n \n from fides.api.api.deps import get_db\n from fides.api.common_exceptions import AuthenticationError, AuthorizationError\n+from fides.api.cryptography.cryptographic_util import generate_secure_random_string\n from fides.api.cryptography.schemas.jwt import (\n     JWE_ISSUED_AT,\n     JWE_PAYLOAD_CLIENT_ID,\n@@ -25,14 +26,15 @@\n )\n from fides.api.models.client import ClientDetail\n from fides.api.models.fides_user import FidesUser\n+from fides.api.models.fides_user_permissions import FidesUserPermissions\n from fides.api.models.policy import PolicyPreWebhook\n from fides.api.models.pre_approval_webhook import PreApprovalWebhook\n from fides.api.models.privacy_request import RequestTask\n from fides.api.oauth.roles import get_scopes_from_roles\n from fides.api.schemas.external_https import RequestTaskJWE, WebhookJWE\n from fides.api.schemas.oauth import OAuth2ClientCredentialsBearer\n from fides.common.api.v1.urn_registry import TOKEN, V1_URL_PREFIX\n-from fides.config import CONFIG\n+from fides.config import CONFIG, FidesConfig\n \n JWT_ENCRYPTION_ALGORITHM = ALGORITHMS.A256GCM\n \n@@ -395,5 +397,50 @@ def has_scope_subset(user_scopes: List[str], endpoint_scopes: SecurityScopes) ->\n     return True\n \n \n+def create_temporary_user_for_login_flow(config: FidesConfig) -> FidesUser:\n+    \"\"\"\n+    Create a temporary FidesUser in-memory with an attached in-memory ClientDetail\n+    and attached in-memory FidesUserPermissions\n+\n+    This is for reducing the time differences in the user login flow between a\n+    valid and an invalid user\n+    \"\"\"\n+    hashed_password, salt = FidesUser.hash_password(generate_secure_random_string(16))\n+    user = FidesUser(\n+        **{\n+            \"salt\": salt,\n+            \"hashed_password\": hashed_password,\n+            \"username\": \"temp_user\",\n+            \"email_address\": \"temp_user@example.com\",\n+            \"first_name\": \"temp_first_name\",\n+            \"last_name\": \"temp_surname\",\n+            \"disabled\": True,\n+        }\n+    )\n+\n+    # Create in-memory user permissions\n+    user.permissions = FidesUserPermissions(  # type: ignore[attr-defined]\n+        id=\"temp_user_id\",\n+        user_id=\"temp_user_id\",\n+        roles=[\"fake_role\"],\n+    )\n+\n+    # Create in-memory client, not persisted to db\n+    client, _ = ClientDetail.create_client_and_secret(\n+        None,  # type: ignore[arg-type]\n+        config.security.oauth_client_id_length_bytes,\n+        config.security.oauth_client_secret_length_bytes,\n+        scopes=[],  # type: ignore\n+        roles=user.permissions.roles,  # type: ignore\n+        systems=user.system_ids,  # type: ignore\n+        user_id=\"temp_user_id\",\n+        in_memory=True,\n+    )\n+\n+    user.client = client\n+\n+    return user\n+\n+\n # This allows us to selectively enforce auth depending on user environment settings\n verify_oauth_client_prod = copy_func(verify_oauth_client)"
            },
            {
                "sha": "9e2dc68da5e4b16aebc56e332b9092efc1ad55b3",
                "filename": "src/fides/api/service/user/fides_user_service.py",
                "status": "modified",
                "additions": 13,
                "deletions": 5,
                "changes": 18,
                "blob_url": "https://github.com/ethyca/fides/blob/457b0e9df9f0d337133d6078bca6ed88bbc745f4/src%2Ffides%2Fapi%2Fservice%2Fuser%2Ffides_user_service.py",
                "raw_url": "https://github.com/ethyca/fides/raw/457b0e9df9f0d337133d6078bca6ed88bbc745f4/src%2Ffides%2Fapi%2Fservice%2Fuser%2Ffides_user_service.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/src%2Ffides%2Fapi%2Fservice%2Fuser%2Ffides_user_service.py?ref=457b0e9df9f0d337133d6078bca6ed88bbc745f4",
                "patch": "@@ -1,6 +1,6 @@\n import uuid\n from datetime import datetime\n-from typing import Tuple\n+from typing import Optional, Tuple\n \n from loguru import logger\n from sqlalchemy.orm import Session\n@@ -87,9 +87,14 @@ def perform_login(\n     client_id_byte_length: int,\n     client_secret_byte_length: int,\n     user: FidesUser,\n+    skip_save: Optional[bool] = False,\n ) -> ClientDetail:\n     \"\"\"Performs a login by updating the FidesUser instance and creating and returning\n     an associated ClientDetail.\n+\n+    If the username or password was bad, skip_save should be True. We still run through\n+    parallel operations to keep the timing of operations similar, but should skip\n+    saving to the database.\n     \"\"\"\n \n     client = user.client\n@@ -103,18 +108,21 @@ def perform_login(\n             roles=user.permissions.roles,  # type: ignore\n             systems=user.system_ids,  # type: ignore\n             user_id=user.id,\n+            in_memory=skip_save,  # If login flow has already errored, don't persist this to the database\n         )\n     else:\n         # Refresh the client just in case - for example, scopes and roles were added via the db directly.\n         client.roles = user.permissions.roles  # type: ignore\n         client.systems = user.system_ids  # type: ignore\n-        client.save(db)\n+        if not skip_save:\n+            client.save(db)\n \n-    if not user.permissions.roles and not user.systems:  # type: ignore\n+    if user.permissions and (not user.permissions.roles and not user.systems):  # type: ignore\n         logger.warning(\"User {} needs roles or systems to login.\", user.id)\n         raise AuthorizationError(detail=\"Not Authorized for this action\")\n \n-    user.last_login_at = datetime.utcnow()\n-    user.save(db)\n+    if not skip_save:\n+        user.last_login_at = datetime.utcnow()\n+        user.save(db)\n \n     return client"
            },
            {
                "sha": "cc48e3146b3db39870401634cb5181b4b11d69ef",
                "filename": "tests/ops/api/v1/endpoints/test_user_endpoints.py",
                "status": "modified",
                "additions": 15,
                "deletions": 1,
                "changes": 16,
                "blob_url": "https://github.com/ethyca/fides/blob/457b0e9df9f0d337133d6078bca6ed88bbc745f4/tests%2Fops%2Fapi%2Fv1%2Fendpoints%2Ftest_user_endpoints.py",
                "raw_url": "https://github.com/ethyca/fides/raw/457b0e9df9f0d337133d6078bca6ed88bbc745f4/tests%2Fops%2Fapi%2Fv1%2Fendpoints%2Ftest_user_endpoints.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/tests%2Fops%2Fapi%2Fv1%2Fendpoints%2Ftest_user_endpoints.py?ref=457b0e9df9f0d337133d6078bca6ed88bbc745f4",
                "patch": "@@ -1013,14 +1013,28 @@ class TestUserLogin:\n     def url(self) -> str:\n         return V1_URL_PREFIX + LOGIN\n \n-    def test_user_does_not_exist(self, url, api_client):\n+    def test_user_does_not_exist(self, db, url, api_client):\n         body = {\n             \"username\": \"does not exist\",\n             \"password\": str_to_b64_str(\"idonotknowmypassword\"),\n         }\n         response = api_client.post(url, headers={}, json=body)\n         assert response.status_code == HTTP_403_FORBIDDEN\n \n+        user = FidesUser.get_by(db, field=\"username\", value=body[\"username\"])\n+        assert user is None\n+\n+        # The temporary resources created to parallelize operations between the invalid\n+        # and valid flow do not get persisted\n+        user = FidesUser.get_by(db, field=\"username\", value=\"temp_user\")\n+        assert user is None\n+\n+        user_perms = FidesUserPermissions.get_by(db, field=\"id\", value=\"temp_user_id\")\n+        assert user_perms is None\n+\n+        client_search = ClientDetail.get_by(db, field=\"id\", value=\"temp_user_id\")\n+        assert client_search is None\n+\n     def test_bad_login(self, url, user, api_client):\n         body = {\n             \"username\": user.username,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Lif-Platforms/New-Ringer-Server/commits/ae795ff47b2ac2656ac6a099a0e7954ca7d9ba53",
        "url": "https://api.github.com/repos/Lif-Platforms/New-Ringer-Server/commits/ae795ff47b2ac2656ac6a099a0e7954ca7d9ba53",
        "html_url": "https://github.com/Lif-Platforms/New-Ringer-Server/commit/ae795ff47b2ac2656ac6a099a0e7954ca7d9ba53",
        "message": "Fix message loading security issue",
        "files": [
            {
                "sha": "3c5ef638d2acc388939f1d2ee30a361e861a9b30",
                "filename": "src/main.py",
                "status": "modified",
                "additions": 22,
                "deletions": 10,
                "changes": 32,
                "blob_url": "https://github.com/Lif-Platforms/New-Ringer-Server/blob/ae795ff47b2ac2656ac6a099a0e7954ca7d9ba53/src%2Fmain.py",
                "raw_url": "https://github.com/Lif-Platforms/New-Ringer-Server/raw/ae795ff47b2ac2656ac6a099a0e7954ca7d9ba53/src%2Fmain.py",
                "contents_url": "https://api.github.com/repos/Lif-Platforms/New-Ringer-Server/contents/src%2Fmain.py?ref=ae795ff47b2ac2656ac6a099a0e7954ca7d9ba53",
                "patch": "@@ -2,6 +2,7 @@\n from fastapi.middleware.cors import CORSMiddleware\n import utils.auth_server_interface as auth_server\n import utils.db_interface as database\n+from utils.db_interface import ConversationNotFound\n import json\n import uvicorn\n import os\n@@ -366,20 +367,31 @@ async def load_messages_v2(request: Request, conversation_id: str):\n \n     if status == \"GOOD!\":\n         try:\n-            # Get all messages from database\n-            messages = await database.get_messages(conversation_id)\n-\n-            # Remove all but the last 20 messages\n-            if len(messages) > 20:\n-                messages = messages[-20:]\n-\n-            return messages\n-        except:\n+            # Get all members of conversation\n+            members = await database.get_members(conversation_id)\n+        except ConversationNotFound:\n             raise HTTPException(status_code=404, detail=\"Conversation Not Found\")\n+        except:\n+            raise HTTPException(status_code=500, detail=\"Internal Server Error\")\n         \n+        # Check to ensure that the user is a member of the conversation they are trying to load\n+        if username in members:\n+            try:\n+                # Get all messages from database\n+                messages = await database.get_messages(conversation_id)\n+\n+                # Remove all but the last 20 messages\n+                if len(messages) > 20:\n+                    messages = messages[-20:]\n+\n+                return messages\n+            except:\n+                raise HTTPException(status_code=500, detail=\"Internal Server Error\")\n+        else:\n+            raise HTTPException(status_code=403, detail=\"You are not a member of this conversation\")\n+                        \n     elif status == \"INVALID_TOKEN\":\n         raise HTTPException(status_code=401, detail=\"Invalid Token\")\n-    \n     else:\n         raise HTTPException(status_code=500, detail=\"Internal Server Error\")\n     "
            },
            {
                "sha": "1c2be6f4d5c0719bcae86b01dded04c470f86d5d",
                "filename": "src/utils/db_interface.py",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/Lif-Platforms/New-Ringer-Server/blob/ae795ff47b2ac2656ac6a099a0e7954ca7d9ba53/src%2Futils%2Fdb_interface.py",
                "raw_url": "https://github.com/Lif-Platforms/New-Ringer-Server/raw/ae795ff47b2ac2656ac6a099a0e7954ca7d9ba53/src%2Futils%2Fdb_interface.py",
                "contents_url": "https://api.github.com/repos/Lif-Platforms/New-Ringer-Server/contents/src%2Futils%2Fdb_interface.py?ref=ae795ff47b2ac2656ac6a099a0e7954ca7d9ba53",
                "patch": "@@ -12,6 +12,11 @@ def set_config(config):\n # Global database connection\n conn = None\n \n+# Define database errors\n+class ConversationNotFound(Exception):\n+    \"\"\"Error for when the conversation supplied could not be found in the database.\"\"\"\n+    pass\n+\n # Function to establish a database connection\n async def connect_to_database():\n     # Handle connecting to the database\n@@ -262,7 +267,9 @@ async def get_members(conversation_id: str):\n     if conversation:\n         members = json.loads(conversation[2])\n \n-    return members\n+        return members\n+    else:\n+        raise ConversationNotFound()\n \n async def remove_conversation(conversation_id: str, username: str):\n     await connect_to_database()"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/projectdiscovery/nuclei/commits/0da993afe6d41b4b1b814e8fad23a2acba13c60a",
        "url": "https://api.github.com/repos/projectdiscovery/nuclei/commits/0da993afe6d41b4b1b814e8fad23a2acba13c60a",
        "html_url": "https://github.com/projectdiscovery/nuclei/commit/0da993afe6d41b4b1b814e8fad23a2acba13c60a",
        "message": "Merge commit from fork\n\n* fix template signature verification\n\n* fix signature pattern check\n\n* add tests\n\n* remove signature count constraint, check for lines len\n\n* Add more tests\n\n* Centralize signature extraction logic in signer package\n\n* Move signature handling in Sign function to beginning\n\n* Remove comment\n\n* Revert `NewTemplateSigVerifier`\n\n* update tests\n\n* use ExtractSignatureAndContent func\n\n* Allow signing code templates\n\n* Remove unused const\n\n---------\n\nCo-authored-by: Do\u011fan Can Bak\u0131r <dogancanbakir@protonmail.com>\nCo-authored-by: Guy Goldenberg <guy.goldenberg@wiz.io>",
        "files": [
            {
                "sha": "a530da1fe33030d50e0eadbb813194fba6577b28",
                "filename": "pkg/templates/signer/tmpl_signer.go",
                "status": "modified",
                "additions": 33,
                "deletions": 24,
                "changes": 57,
                "blob_url": "https://github.com/projectdiscovery/nuclei/blob/0da993afe6d41b4b1b814e8fad23a2acba13c60a/pkg%2Ftemplates%2Fsigner%2Ftmpl_signer.go",
                "raw_url": "https://github.com/projectdiscovery/nuclei/raw/0da993afe6d41b4b1b814e8fad23a2acba13c60a/pkg%2Ftemplates%2Fsigner%2Ftmpl_signer.go",
                "contents_url": "https://api.github.com/repos/projectdiscovery/nuclei/contents/pkg%2Ftemplates%2Fsigner%2Ftmpl_signer.go?ref=0da993afe6d41b4b1b814e8fad23a2acba13c60a",
                "patch": "@@ -11,7 +11,6 @@ import (\n \t\"errors\"\n \t\"fmt\"\n \t\"os\"\n-\t\"regexp\"\n \t\"strings\"\n \t\"sync\"\n \n@@ -21,18 +20,21 @@ import (\n )\n \n var (\n-\tReDigest            = regexp.MustCompile(`(?m)^#\\sdigest:\\s.+$`)\n \tErrUnknownAlgorithm = errors.New(\"unknown algorithm\")\n \tSignaturePattern    = \"# digest: \"\n \tSignatureFmt        = SignaturePattern + \"%x\" + \":%v\" // `#digest: <signature>:<fragment>`\n )\n \n-func RemoveSignatureFromData(data []byte) []byte {\n-\treturn bytes.Trim(ReDigest.ReplaceAll(data, []byte(\"\")), \"\\n\")\n-}\n-\n-func GetSignatureFromData(data []byte) []byte {\n-\treturn ReDigest.Find(data)\n+// ExtractSignatureAndContent extracts the signature (if present) and returns the content without the signature\n+func ExtractSignatureAndContent(data []byte) (signature, content []byte) {\n+\tdataStr := string(data)\n+\tif idx := strings.LastIndex(dataStr, SignaturePattern); idx != -1 {\n+\t\tsignature = []byte(strings.TrimSpace(dataStr[idx:]))\n+\t\tcontent = []byte(strings.TrimSpace(dataStr[:idx]))\n+\t} else {\n+\t\tcontent = data\n+\t}\n+\treturn\n }\n \n // SignableTemplate is a template that can be signed\n@@ -69,26 +71,29 @@ func (t *TemplateSigner) GetUserFragment() string {\n \n // Sign signs the given template with the template signer and returns the signature\n func (t *TemplateSigner) Sign(data []byte, tmpl SignableTemplate) (string, error) {\n+\texistingSignature, content := ExtractSignatureAndContent(data)\n+\n \t// while re-signing template check if it has a code protocol\n \t// if it does then verify that it is signed by current signer\n \t// if not then return error\n \tif tmpl.HasCodeProtocol() {\n-\t\tsig := GetSignatureFromData(data)\n-\t\tarr := strings.SplitN(string(sig), \":\", 3)\n-\t\tif len(arr) == 2 {\n-\t\t\t// signature has no fragment\n-\t\t\treturn \"\", errorutil.NewWithTag(\"signer\", \"re-signing code templates are not allowed for security reasons.\")\n-\t\t}\n-\t\tif len(arr) == 3 {\n-\t\t\t// signature has fragment verify if it is equal to current fragment\n-\t\t\tfragment := t.GetUserFragment()\n-\t\t\tif fragment != arr[2] {\n+\t\tif len(existingSignature) > 0 {\n+\t\t\tarr := strings.SplitN(string(existingSignature), \":\", 3)\n+\t\t\tif len(arr) == 2 {\n+\t\t\t\t// signature has no fragment\n \t\t\t\treturn \"\", errorutil.NewWithTag(\"signer\", \"re-signing code templates are not allowed for security reasons.\")\n \t\t\t}\n+\t\t\tif len(arr) == 3 {\n+\t\t\t\t// signature has fragment verify if it is equal to current fragment\n+\t\t\t\tfragment := t.GetUserFragment()\n+\t\t\t\tif fragment != arr[2] {\n+\t\t\t\t\treturn \"\", errorutil.NewWithTag(\"signer\", \"re-signing code templates are not allowed for security reasons.\")\n+\t\t\t\t}\n+\t\t\t}\n \t\t}\n \t}\n \n-\tbuff := bytes.NewBuffer(RemoveSignatureFromData(data))\n+\tbuff := bytes.NewBuffer(content)\n \t// if file has any imports process them\n \tfor _, file := range tmpl.GetFileImports() {\n \t\tbin, err := os.ReadFile(file)\n@@ -123,20 +128,24 @@ func (t *TemplateSigner) sign(data []byte) (string, error) {\n \n // Verify verifies the given template with the template signer\n func (t *TemplateSigner) Verify(data []byte, tmpl SignableTemplate) (bool, error) {\n-\tdigestData := ReDigest.Find(data)\n-\tif len(digestData) == 0 {\n-\t\treturn false, errors.New(\"digest not found\")\n+\tsignature, content := ExtractSignatureAndContent(data)\n+\tif len(signature) == 0 {\n+\t\treturn false, errors.New(\"no signature found\")\n+\t}\n+\n+\tif !bytes.HasPrefix(signature, []byte(SignaturePattern)) {\n+\t\treturn false, errors.New(\"signature must be at the end of the template\")\n \t}\n \n-\tdigestData = bytes.TrimSpace(bytes.TrimPrefix(digestData, []byte(SignaturePattern)))\n+\tdigestData := bytes.TrimSpace(bytes.TrimPrefix(signature, []byte(SignaturePattern)))\n \t// remove fragment from digest as it is used for re-signing purposes only\n \tdigestString := strings.TrimSuffix(string(digestData), \":\"+t.GetUserFragment())\n \tdigest, err := hex.DecodeString(digestString)\n \tif err != nil {\n \t\treturn false, err\n \t}\n \n-\tbuff := bytes.NewBuffer(RemoveSignatureFromData(data))\n+\tbuff := bytes.NewBuffer(content)\n \t// if file has any imports process them\n \tfor _, file := range tmpl.GetFileImports() {\n \t\tbin, err := os.ReadFile(file)"
            },
            {
                "sha": "832dcb0e05e780db9b6dc9e6db8bbbe4e1679946",
                "filename": "pkg/templates/signer/tmpl_signer_test.go",
                "status": "added",
                "additions": 126,
                "deletions": 0,
                "changes": 126,
                "blob_url": "https://github.com/projectdiscovery/nuclei/blob/0da993afe6d41b4b1b814e8fad23a2acba13c60a/pkg%2Ftemplates%2Fsigner%2Ftmpl_signer_test.go",
                "raw_url": "https://github.com/projectdiscovery/nuclei/raw/0da993afe6d41b4b1b814e8fad23a2acba13c60a/pkg%2Ftemplates%2Fsigner%2Ftmpl_signer_test.go",
                "contents_url": "https://api.github.com/repos/projectdiscovery/nuclei/contents/pkg%2Ftemplates%2Fsigner%2Ftmpl_signer_test.go?ref=0da993afe6d41b4b1b814e8fad23a2acba13c60a",
                "patch": "@@ -0,0 +1,126 @@\n+package signer\n+\n+import (\n+\t\"bytes\"\n+\t\"os\"\n+\t\"path/filepath\"\n+\t\"testing\"\n+\n+\t\"github.com/stretchr/testify/assert\"\n+\t\"github.com/stretchr/testify/require\"\n+)\n+\n+const (\n+\ttestCertFile = \"../../../integration_tests/protocols/keys/ci.crt\"\n+\ttestKeyFile  = \"../../../integration_tests/protocols/keys/ci-private-key.pem\"\n+)\n+\n+type mockSignableTemplate struct {\n+\timports []string\n+\thasCode bool\n+}\n+\n+func (m *mockSignableTemplate) GetFileImports() []string {\n+\treturn m.imports\n+}\n+\n+func (m *mockSignableTemplate) HasCodeProtocol() bool {\n+\treturn m.hasCode\n+}\n+\n+var signer, _ = NewTemplateSignerFromFiles(testCertFile, testKeyFile)\n+\n+func TestTemplateSignerSignAndVerify(t *testing.T) {\n+\ttempDir := t.TempDir()\n+\n+\ttests := []struct {\n+\t\tname            string\n+\t\tdata            []byte\n+\t\ttmpl            SignableTemplate\n+\t\twantSignErr     bool\n+\t\twantVerifyErr   bool\n+\t\twantVerified    bool\n+\t\tmodifyAfterSign func([]byte) []byte\n+\t}{\n+\t\t{\n+\t\t\tname:         \"Simple template\",\n+\t\t\tdata:         []byte(\"id: test-template\\ninfo:\\n  name: Test Template\"),\n+\t\t\ttmpl:         &mockSignableTemplate{},\n+\t\t\twantVerified: true,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"Template with imports\",\n+\t\t\tdata: []byte(\"id: test-template\\ninfo:\\n  name: Test Template\"),\n+\t\t\ttmpl: &mockSignableTemplate{imports: []string{\n+\t\t\t\tfilepath.Join(tempDir, \"import1.yaml\"),\n+\t\t\t\tfilepath.Join(tempDir, \"import2.yaml\"),\n+\t\t\t}},\n+\t\t\twantVerified: true,\n+\t\t},\n+\t\t{\n+\t\t\tname:         \"Template with code protocol\",\n+\t\t\tdata:         []byte(\"id: test-template\\ninfo:\\n  name: Test Template\\n\\ncode:\\n  - engine: bash\\n    source: echo 'Hello, World!'\"),\n+\t\t\ttmpl:         &mockSignableTemplate{hasCode: true},\n+\t\t\twantSignErr:  false,\n+\t\t\twantVerified: true,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"Tampered template\",\n+\t\t\tdata: []byte(\"id: test-template\\ninfo:\\n  name: Test Template\"),\n+\t\t\ttmpl: &mockSignableTemplate{},\n+\t\t\tmodifyAfterSign: func(data []byte) []byte {\n+\t\t\t\tsignatureIndex := bytes.LastIndex(data, []byte(SignaturePattern))\n+\t\t\t\tif signatureIndex == -1 {\n+\t\t\t\t\treturn data\n+\t\t\t\t}\n+\t\t\t\treturn append(data[:signatureIndex], append([]byte(\"# Tampered content\\n\"), data[signatureIndex:]...)...)\n+\t\t\t},\n+\t\t\twantVerified: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"Invalid signature\",\n+\t\t\tdata: []byte(\"id: test-template\\ninfo:\\n  name: Test Template\"),\n+\t\t\ttmpl: &mockSignableTemplate{},\n+\t\t\tmodifyAfterSign: func(data []byte) []byte {\n+\t\t\t\treturn append(bytes.TrimSuffix(data, []byte(\"\\n\")), []byte(\"\\n# digest: invalid_signature:fragment\")...)\n+\t\t\t},\n+\t\t\twantVerifyErr: true,\n+\t\t\twantVerified:  false,\n+\t\t},\n+\t}\n+\n+\tfor _, tt := range tests {\n+\t\tt.Run(tt.name, func(t *testing.T) {\n+\t\t\t// Create import files if needed\n+\t\t\tfor _, imp := range tt.tmpl.GetFileImports() {\n+\t\t\t\terr := os.WriteFile(imp, []byte(\"imported content\"), 0644)\n+\t\t\t\trequire.NoError(t, err, \"Failed to create import file\")\n+\t\t\t}\n+\n+\t\t\t// Sign the template\n+\t\t\tsignature, err := signer.Sign(tt.data, tt.tmpl)\n+\t\t\tif tt.wantSignErr {\n+\t\t\t\tassert.Error(t, err, \"Expected an error during signing\")\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\trequire.NoError(t, err, \"Failed to sign template\")\n+\n+\t\t\t// Append signature to the template data\n+\t\t\tsignedData := append(tt.data, []byte(\"\\n\"+signature)...)\n+\n+\t\t\t// Apply any modifications after signing if specified\n+\t\t\tif tt.modifyAfterSign != nil {\n+\t\t\t\tsignedData = tt.modifyAfterSign(signedData)\n+\t\t\t}\n+\n+\t\t\t// Verify the signature\n+\t\t\tverified, err := signer.Verify(signedData, tt.tmpl)\n+\t\t\tif tt.wantVerifyErr {\n+\t\t\t\tassert.Error(t, err, \"Expected an error during verification\")\n+\t\t\t} else {\n+\t\t\t\tassert.NoError(t, err, \"Unexpected error during verification\")\n+\t\t\t}\n+\t\t\tassert.Equal(t, tt.wantVerified, verified, \"Unexpected verification result\")\n+\t\t})\n+\t}\n+}"
            },
            {
                "sha": "1eb09a447cc0aefb962773f235092c8ee6f943a5",
                "filename": "pkg/templates/template_sign.go",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/projectdiscovery/nuclei/blob/0da993afe6d41b4b1b814e8fad23a2acba13c60a/pkg%2Ftemplates%2Ftemplate_sign.go",
                "raw_url": "https://github.com/projectdiscovery/nuclei/raw/0da993afe6d41b4b1b814e8fad23a2acba13c60a/pkg%2Ftemplates%2Ftemplate_sign.go",
                "contents_url": "https://api.github.com/repos/projectdiscovery/nuclei/contents/pkg%2Ftemplates%2Ftemplate_sign.go?ref=0da993afe6d41b4b1b814e8fad23a2acba13c60a",
                "patch": "@@ -75,11 +75,12 @@ func SignTemplate(templateSigner *signer.TemplateSigner, templatePath string) er\n \t\treturn ErrNotATemplate\n \t}\n \tif !template.Verified {\n+\t\t_, content := signer.ExtractSignatureAndContent(bin)\n \t\tsignatureData, err := templateSigner.Sign(bin, template)\n \t\tif err != nil {\n \t\t\treturn err\n \t\t}\n-\t\tbuff := bytes.NewBuffer(signer.RemoveSignatureFromData(bin))\n+\t\tbuff := bytes.NewBuffer(content)\n \t\tbuff.WriteString(\"\\n\" + signatureData)\n \t\treturn os.WriteFile(templatePath, buff.Bytes(), 0644)\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/LinuxOSsk/Shakal-NG/commits/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb",
        "url": "https://api.github.com/repos/LinuxOSsk/Shakal-NG/commits/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb",
        "html_url": "https://github.com/LinuxOSsk/Shakal-NG/commit/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb",
        "message": "fix: Added safe next redirect check\n\nfixes #202",
        "files": [
            {
                "sha": "55e23ce12824e39cfc48d042b87e8c0e7de514a8",
                "filename": "comments/views.py",
                "status": "modified",
                "additions": 10,
                "deletions": 5,
                "changes": 15,
                "blob_url": "https://github.com/LinuxOSsk/Shakal-NG/blob/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/comments%2Fviews.py",
                "raw_url": "https://github.com/LinuxOSsk/Shakal-NG/raw/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/comments%2Fviews.py",
                "contents_url": "https://api.github.com/repos/LinuxOSsk/Shakal-NG/contents/comments%2Fviews.py?ref=ebd1c2cba59cbac198bf2fd5a10565994d4f02cb",
                "patch": "@@ -18,7 +18,7 @@\n from comments.models import RootHeader, UserDiscussionAttribute\n from comments.templatetags.comments_tags import add_discussion_attributes\n from common_utils import get_meta\n-from common_utils.url_utils import link_add_query\n+from common_utils.url_utils import link_add_query, check_redirect_url\n \n \n def get_module_name(content_object):\n@@ -95,6 +95,7 @@ def form_valid(self, form):\n \t\tform.move_attachments(comment)\n \n \t\tnext_url = self.request.POST.get('next', '')\n+\t\tcheck_redirect_url(next_url, self.request)\n \t\tif self.request.POST.get('time'):\n \t\t\tnext_url = link_add_query(next_url, time=self.request.POST['time'])\n \t\treturn http.HttpResponseRedirect(next_url + '#link_' + str(comment.pk))\n@@ -148,8 +149,10 @@ def post(self, request, **kwargs):\n \t\telse:\n \t\t\tattributes.watch = 1\n \t\tattributes.save()\n-\t\tif 'next' in request.POST:\n-\t\t\treturn HttpResponseRedirect(request.POST['next'])\n+\t\tnext_url = request.POST.get('next')\n+\t\tif next_url is not None:\n+\t\t\tcheck_redirect_url(next_url, request)\n+\t\t\treturn HttpResponseRedirect(next_url)\n \t\telse:\n \t\t\tobj = header.content_object\n \t\t\treturn HttpResponseRedirect(obj.get_absolute_url())\n@@ -161,8 +164,10 @@ class Forget(LoginRequiredMixin, DetailView):\n \tdef get(self, request, **kwargs):\n \t\theader = self.get_object()\n \t\tUserDiscussionAttribute.objects.filter(user=request.user, discussion=header).delete()\n-\t\tif 'next' in request.GET:\n-\t\t\treturn HttpResponseRedirect(request.GET['next'])\n+\t\tnext_url = request.GET.get('next')\n+\t\tif next_url is not None:\n+\t\t\tcheck_redirect_url(next_url, request)\n+\t\t\treturn HttpResponseRedirect(next_url)\n \t\telse:\n \t\t\treturn HttpResponseRedirect(reverse('home'))\n "
            },
            {
                "sha": "cfd0d5be0e8cd555938c34a92ad568955643fce1",
                "filename": "common_utils/generic.py",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/LinuxOSsk/Shakal-NG/blob/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/common_utils%2Fgeneric.py",
                "raw_url": "https://github.com/LinuxOSsk/Shakal-NG/raw/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/common_utils%2Fgeneric.py",
                "contents_url": "https://api.github.com/repos/LinuxOSsk/Shakal-NG/contents/common_utils%2Fgeneric.py?ref=ebd1c2cba59cbac198bf2fd5a10565994d4f02cb",
                "patch": "@@ -5,9 +5,10 @@\n from django.db.models import Q, Manager\n from django.shortcuts import get_object_or_404, resolve_url\n from django.utils.functional import cached_property\n-from django.utils.http import url_has_allowed_host_and_scheme\n from django.views.generic import CreateView, UpdateView, DetailView, ListView as OriginalListView\n \n+from .url_utils import check_redirect_url\n+\n \n # dokument\u00e1cia  k viewom tu https://ccbv.co.uk/\n \n@@ -155,12 +156,8 @@ def get_redirect_url(self):\n \t\tredirect_to = self.request.POST.get(\n \t\t\tself.redirect_field_name, self.request.GET.get(self.redirect_field_name)\n \t\t)\n-\t\turl_is_safe = url_has_allowed_host_and_scheme(\n-\t\t\turl=redirect_to,\n-\t\t\tallowed_hosts=[self.request.get_host()],\n-\t\t\trequire_https=self.request.is_secure(),\n-\t\t)\n-\t\treturn redirect_to if url_is_safe else \"\"\n+\t\tcheck_redirect_url(redirect_to, self.request)\n+\t\treturn redirect_to\n \n \tdef get_default_redirect_url(self):\n \t\tif self.next_page:"
            },
            {
                "sha": "b6d5e9617c59e70dd818baf46bafce5b66515df2",
                "filename": "common_utils/url_utils.py",
                "status": "modified",
                "additions": 17,
                "deletions": 1,
                "changes": 18,
                "blob_url": "https://github.com/LinuxOSsk/Shakal-NG/blob/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/common_utils%2Furl_utils.py",
                "raw_url": "https://github.com/LinuxOSsk/Shakal-NG/raw/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/common_utils%2Furl_utils.py",
                "contents_url": "https://api.github.com/repos/LinuxOSsk/Shakal-NG/contents/common_utils%2Furl_utils.py?ref=ebd1c2cba59cbac198bf2fd5a10565994d4f02cb",
                "patch": "@@ -1,10 +1,15 @@\n # -*- coding: utf-8 -*-\n+import logging\n from urllib.parse import urlparse, urlunparse\n \n from django.http import QueryDict\n-from django.http.response import HttpResponseRedirect\n+from django.http.response import HttpResponseRedirect, Http404\n from django.shortcuts import resolve_url\n from django.utils.encoding import force_str\n+from django.utils.http import url_has_allowed_host_and_scheme\n+\n+\n+logger = logging.getLogger(__name__)\n \n \n def build_query(query):\n@@ -50,3 +55,14 @@ def link_add_query(url, **values):\n \tfor key, value in values.items():\n \t\tq[key] = value\n \treturn '%s?%s' % (url, q.urlencode(''))\n+\n+\n+def check_redirect_url(redirect_to, request):\n+\turl_is_safe = url_has_allowed_host_and_scheme(\n+\t\turl=redirect_to,\n+\t\tallowed_hosts=[request.get_host()],\n+\t\trequire_https=request.is_secure(),\n+\t)\n+\tif not url_is_safe:\n+\t\tlogger.warning(\"Unsafe redirect to: %s\", redirect_to)\n+\t\traise Http404(\"Unsafe redirect to: %s\" % redirect_to)"
            },
            {
                "sha": "333bdea047e6baf3b3f829231ce13d489bcab5b2",
                "filename": "polls/views.py",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/LinuxOSsk/Shakal-NG/blob/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/polls%2Fviews.py",
                "raw_url": "https://github.com/LinuxOSsk/Shakal-NG/raw/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/polls%2Fviews.py",
                "contents_url": "https://api.github.com/repos/LinuxOSsk/Shakal-NG/contents/polls%2Fviews.py?ref=ebd1c2cba59cbac198bf2fd5a10565994d4f02cb",
                "patch": "@@ -11,6 +11,7 @@\n from .forms import PollForm, VoteForm\n from .models import Poll, Choice\n from common_utils.generic import ListView, DetailView, CreateView\n+from common_utils.url_utils import check_redirect_url\n \n \n class PollPost(FormView):\n@@ -28,7 +29,9 @@ def get_message_tag(self):\n \t\treturn self.request.POST.get('msg_id', 'polls') # identifik\u00e1cia ankety ak ich je na webe viacej\n \n \tdef get_success_url(self):\n-\t\treturn self.request.POST.get('next', '/')\n+\t\tnext_url = self.request.POST.get('next', '/')\n+\t\tcheck_redirect_url(next_url, self.request)\n+\t\treturn next_url\n \n \tdef get_form_kwargs(self):\n \t\tkwargs = super(PollPost, self).get_form_kwargs()"
            },
            {
                "sha": "ac3f64810a2c02813533c72a26623bc6501c5979",
                "filename": "template_dynamicloader/views.py",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/LinuxOSsk/Shakal-NG/blob/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/template_dynamicloader%2Fviews.py",
                "raw_url": "https://github.com/LinuxOSsk/Shakal-NG/raw/ebd1c2cba59cbac198bf2fd5a10565994d4f02cb/template_dynamicloader%2Fviews.py",
                "contents_url": "https://api.github.com/repos/LinuxOSsk/Shakal-NG/contents/template_dynamicloader%2Fviews.py?ref=ebd1c2cba59cbac198bf2fd5a10565994d4f02cb",
                "patch": "@@ -10,13 +10,16 @@\n \n from .forms import ChangeTemplateHiddenForm\n from .utils import switch_template\n+from common_utils.url_utils import check_redirect_url\n \n \n @csrf_exempt\n @require_POST\n def change(request):\n \tform = ChangeTemplateHiddenForm(request.POST)\n-\tresponse = HttpResponseRedirect(request.POST.get('next', reverse('home')))\n+\tredirect_to = request.POST.get('next', reverse('home'))\n+\tcheck_redirect_url(redirect_to, request)\n+\tresponse = HttpResponseRedirect(redirect_to)\n \tif form.is_valid() and 'change_style' in request.POST:\n \t\tswitch_template(response, **form.cleaned_data)\n \treturn response"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/commits/a76b14a92410c89fcc590c5852d800b565916ccf",
        "url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/commits/a76b14a92410c89fcc590c5852d800b565916ccf",
        "html_url": "https://github.com/eclipse-vertx/vertx-grpc/commit/a76b14a92410c89fcc590c5852d800b565916ccf",
        "message": "Set a configurable maximum payload size for the message decoder and add an invalid message handler to catch invalid messages.\n\nMotivation:\n\nThe gRPC message decoder uses the default limit allowed by the gRPC HTTP/2 transport (2^32 bytes). The default maximum size should be smaller and configurable.\n\nChanges:\n\nAdd options for configuring the maximum message size and use a lower default value (256KB) for both client and server. In addition an invalid message handler can be set on the GrpcReadStream to catch invalid message reports and let the application recover invalid messages. The invalid message handler can be triggered by a capacity overflow or a decoder exception.\n\nResults:\n\ngRPC server and client now uses a smaller default maximum message size which can be configured according to the application needs. Invalid message handler can also be set to catch invalid messages.\n\nFixes #113",
        "files": [
            {
                "sha": "0b4d9d58f908efa0cd6517e19c863fb2e1a43872",
                "filename": "vertx-grpc-client/src/main/generated/io/vertx/grpc/client/GrpcClientOptionsConverter.java",
                "status": "added",
                "additions": 47,
                "deletions": 0,
                "changes": 47,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fgenerated%2Fio%2Fvertx%2Fgrpc%2Fclient%2FGrpcClientOptionsConverter.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fgenerated%2Fio%2Fvertx%2Fgrpc%2Fclient%2FGrpcClientOptionsConverter.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-client%2Fsrc%2Fmain%2Fgenerated%2Fio%2Fvertx%2Fgrpc%2Fclient%2FGrpcClientOptionsConverter.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -0,0 +1,47 @@\n+package io.vertx.grpc.client;\n+\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.impl.JsonUtil;\n+import java.time.Instant;\n+import java.time.format.DateTimeFormatter;\n+import java.util.Base64;\n+\n+/**\n+ * Converter and mapper for {@link io.vertx.grpc.client.GrpcClientOptions}.\n+ * NOTE: This class has been automatically generated from the {@link io.vertx.grpc.client.GrpcClientOptions} original class using Vert.x codegen.\n+ */\n+public class GrpcClientOptionsConverter {\n+\n+\n+  private static final Base64.Decoder BASE64_DECODER = JsonUtil.BASE64_DECODER;\n+  private static final Base64.Encoder BASE64_ENCODER = JsonUtil.BASE64_ENCODER;\n+\n+   static void fromJson(Iterable<java.util.Map.Entry<String, Object>> json, GrpcClientOptions obj) {\n+    for (java.util.Map.Entry<String, Object> member : json) {\n+      switch (member.getKey()) {\n+        case \"maxMessageSize\":\n+          if (member.getValue() instanceof Number) {\n+            obj.setMaxMessageSize(((Number)member.getValue()).longValue());\n+          }\n+          break;\n+        case \"transportOptions\":\n+          if (member.getValue() instanceof JsonObject) {\n+            obj.setTransportOptions(new io.vertx.core.http.HttpClientOptions((io.vertx.core.json.JsonObject)member.getValue()));\n+          }\n+          break;\n+      }\n+    }\n+  }\n+\n+   static void toJson(GrpcClientOptions obj, JsonObject json) {\n+    toJson(obj, json.getMap());\n+  }\n+\n+   static void toJson(GrpcClientOptions obj, java.util.Map<String, Object> json) {\n+    json.put(\"maxMessageSize\", obj.getMaxMessageSize());\n+    if (obj.getTransportOptions() != null) {\n+      json.put(\"transportOptions\", obj.getTransportOptions().toJson());\n+    }\n+  }\n+}"
            },
            {
                "sha": "f600932708bd35120186c86f37eae48840053800",
                "filename": "vertx-grpc-client/src/main/java/io/vertx/grpc/client/GrpcClient.java",
                "status": "modified",
                "additions": 12,
                "deletions": 2,
                "changes": 14,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2FGrpcClient.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2FGrpcClient.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2FGrpcClient.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -50,7 +50,17 @@ public interface GrpcClient {\n    * @return the created client\n    */\n   static GrpcClient client(Vertx vertx) {\n-    return new GrpcClientImpl(vertx);\n+    return client(vertx, new GrpcClientOptions());\n+  }\n+\n+  /**\n+   * Create a new client\n+   *\n+   * @param vertx the vertx instance\n+   * @return the created client\n+   */\n+  static GrpcClient client(Vertx vertx, GrpcClientOptions options) {\n+    return new GrpcClientImpl(vertx, options);\n   }\n \n   /**\n@@ -61,7 +71,7 @@ static GrpcClient client(Vertx vertx) {\n    * @return the created client\n    */\n   static GrpcClient client(Vertx vertx, HttpClientOptions options) {\n-    return new GrpcClientImpl(options, vertx);\n+    return client(vertx, new GrpcClientOptions().setTransportOptions(options));\n   }\n \n   /**"
            },
            {
                "sha": "1af5dfce9f6966423ced9c1902aaa2fb8974bf33",
                "filename": "vertx-grpc-client/src/main/java/io/vertx/grpc/client/GrpcClientOptions.java",
                "status": "added",
                "additions": 87,
                "deletions": 0,
                "changes": 87,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2FGrpcClientOptions.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2FGrpcClientOptions.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2FGrpcClientOptions.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright (c) 2011-2024 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+package io.vertx.grpc.client;\n+\n+import io.vertx.codegen.annotations.DataObject;\n+import io.vertx.codegen.json.annotations.JsonGen;\n+import io.vertx.core.http.HttpClientOptions;\n+import io.vertx.core.json.JsonObject;\n+\n+/**\n+ * Grpc client options.\n+ *\n+ * @author <a href=\"mailto:julien@julienviet.com\">Julien Viet</a>\n+ */\n+@DataObject\n+@JsonGen(publicConverter = false)\n+public class GrpcClientOptions {\n+\n+  /**\n+   * The default maximum message size in bytes accepted from a server = {@code 256KB}\n+   */\n+  public static final long DEFAULT_MAX_MESSAGE_SIZE = 256 * 1024;\n+\n+  private long maxMessageSize = DEFAULT_MAX_MESSAGE_SIZE;\n+  private HttpClientOptions transportOptions = new HttpClientOptions().setHttp2ClearTextUpgrade(false);\n+\n+  public GrpcClientOptions() {\n+  }\n+\n+  public GrpcClientOptions(GrpcClientOptions options) {\n+    this.maxMessageSize = options.maxMessageSize;\n+    this.transportOptions = options.transportOptions != null ? new HttpClientOptions(options.transportOptions) : null;\n+  }\n+\n+  public GrpcClientOptions(JsonObject json) {\n+    GrpcClientOptionsConverter.fromJson(json, this);\n+  }\n+\n+  /**\n+   * @return the maximum message size in bytes accepted by the client\n+   */\n+  public long getMaxMessageSize() {\n+    return maxMessageSize;\n+  }\n+\n+  /**\n+   * Set the maximum message size in bytes accepted from a server, the maximum value is {@code 0xFFFFFFFF}\n+   * @param maxMessageSize the size\n+   * @return a reference to this, so the API can be used fluently\n+   */\n+  public GrpcClientOptions setMaxMessageSize(long maxMessageSize) {\n+    if (maxMessageSize <= 0) {\n+      throw new IllegalArgumentException(\"Max message size must be > 0\");\n+    }\n+    if (maxMessageSize > 0xFFFFFFFFL) {\n+      throw new IllegalArgumentException(\"Max message size must be <= 0xFFFFFFFF\");\n+    }\n+    this.maxMessageSize = maxMessageSize;\n+    return this;\n+  }\n+\n+  /**\n+   * @return the HTTP transport options.\n+   */\n+  public HttpClientOptions getTransportOptions() {\n+    return transportOptions;\n+  }\n+\n+  /**\n+   * Set the HTTP transport options.\n+   *\n+   * @param transportOptions the transpot options\n+   * @return a reference to this, so the API can be used fluently\n+   */\n+  public GrpcClientOptions setTransportOptions(HttpClientOptions transportOptions) {\n+    this.transportOptions = transportOptions;\n+    return this;\n+  }\n+}"
            },
            {
                "sha": "4f2211a76a9bb1a12c532c9d580059c3bcf90a7f",
                "filename": "vertx-grpc-client/src/main/java/io/vertx/grpc/client/impl/GrpcClientImpl.java",
                "status": "modified",
                "additions": 15,
                "deletions": 9,
                "changes": 24,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2Fimpl%2FGrpcClientImpl.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2Fimpl%2FGrpcClientImpl.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2Fimpl%2FGrpcClientImpl.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -20,6 +20,7 @@\n import io.vertx.core.http.HttpVersion;\n import io.vertx.core.http.RequestOptions;\n import io.vertx.core.net.SocketAddress;\n+import io.vertx.grpc.client.GrpcClientOptions;\n import io.vertx.grpc.client.GrpcClientRequest;\n import io.vertx.grpc.common.GrpcMessageDecoder;\n import io.vertx.grpc.common.GrpcMessageEncoder;\n@@ -34,23 +35,28 @@ public class GrpcClientImpl implements GrpcIoClient {\n \n   private final Vertx vertx;\n   private HttpClient client;\n+  private final long maxMessageSize;\n \n-  public GrpcClientImpl(HttpClientOptions options, Vertx vertx) {\n-    this.vertx = vertx;\n-    this.client = vertx.createHttpClient(new HttpClientOptions(options)\n-      .setProtocolVersion(HttpVersion.HTTP_2));\n-  }\n+  public GrpcClientImpl(Vertx vertx, GrpcClientOptions options) {\n+    HttpClientOptions transportOptions = options.getTransportOptions();\n+    if (transportOptions == null) {\n+      transportOptions = new HttpClientOptions().setHttp2ClearTextUpgrade(false);\n+    } else {\n+      transportOptions = new HttpClientOptions(transportOptions);\n+    }\n+    transportOptions.setProtocolVersion(HttpVersion.HTTP_2);\n \n-  public GrpcClientImpl(Vertx vertx) {\n-    this(new HttpClientOptions().setHttp2ClearTextUpgrade(false), vertx);\n+    this.vertx = vertx;\n+    this.client = vertx.createHttpClient(transportOptions);\n+    this.maxMessageSize = options.getMaxMessageSize();\n   }\n \n   @Override public Future<GrpcClientRequest<Buffer, Buffer>> request(SocketAddress server) {\n     RequestOptions options = new RequestOptions()\n       .setMethod(HttpMethod.POST)\n       .setServer(server);\n     return client.request(options)\n-      .map(request -> new GrpcClientRequestImpl<>(request, GrpcMessageEncoder.IDENTITY, GrpcMessageDecoder.IDENTITY));\n+      .map(request -> new GrpcClientRequestImpl<>(request, maxMessageSize, GrpcMessageEncoder.IDENTITY, GrpcMessageDecoder.IDENTITY));\n   }\n \n   @Override public <Req, Resp> Future<GrpcClientRequest<Req, Resp>> request(SocketAddress server, MethodDescriptor<Req, Resp> service) {\n@@ -71,7 +77,7 @@ private <Req, Resp> Future<GrpcClientRequest<Req, Resp>> request(RequestOptions\n     GrpcMessageEncoder<Req> messageEncoder = method.encoder();\n     return client.request(options)\n       .map(request -> {\n-        GrpcClientRequestImpl<Req, Resp> call = new GrpcClientRequestImpl<>(request, messageEncoder, messageDecoder);\n+        GrpcClientRequestImpl<Req, Resp> call = new GrpcClientRequestImpl<>(request, maxMessageSize, messageEncoder, messageDecoder);\n         call.fullMethodName(method.fullMethodName());\n         return call;\n       });"
            },
            {
                "sha": "3f12937db8e9f5db49663f9751b2ad41daab7844",
                "filename": "vertx-grpc-client/src/main/java/io/vertx/grpc/client/impl/GrpcClientRequestImpl.java",
                "status": "modified",
                "additions": 6,
                "deletions": 8,
                "changes": 14,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2Fimpl%2FGrpcClientRequestImpl.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2Fimpl%2FGrpcClientRequestImpl.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2Fimpl%2FGrpcClientRequestImpl.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -25,12 +25,7 @@\n import io.vertx.core.impl.future.FutureInternal;\n import io.vertx.grpc.client.GrpcClientRequest;\n import io.vertx.grpc.client.GrpcClientResponse;\n-import io.vertx.grpc.common.CodecException;\n-import io.vertx.grpc.common.GrpcError;\n-import io.vertx.grpc.common.GrpcMessage;\n-import io.vertx.grpc.common.GrpcMessageDecoder;\n-import io.vertx.grpc.common.GrpcMessageEncoder;\n-import io.vertx.grpc.common.ServiceName;\n+import io.vertx.grpc.common.*;\n import io.vertx.grpc.common.impl.GrpcMessageImpl;\n \n /**\n@@ -49,13 +44,16 @@ public class GrpcClientRequestImpl<Req, Resp> implements GrpcClientRequest<Req,\n   private Future<GrpcClientResponse<Req, Resp>> response;\n   private MultiMap headers;\n \n-  public GrpcClientRequestImpl(HttpClientRequest httpRequest, GrpcMessageEncoder<Req> messageEncoder, GrpcMessageDecoder<Resp> messageDecoder) {\n+  public GrpcClientRequestImpl(HttpClientRequest httpRequest, long maxMessageSize, GrpcMessageEncoder<Req> messageEncoder, GrpcMessageDecoder<Resp> messageDecoder) {\n \n     this.httpRequest = httpRequest;\n     this.messageEncoder = messageEncoder;\n     this.response = httpRequest.response().map(httpResponse -> {\n-      GrpcClientResponseImpl<Req, Resp> grpcResponse = new GrpcClientResponseImpl<>(this, httpResponse, messageDecoder);\n+      GrpcClientResponseImpl<Req, Resp> grpcResponse = new GrpcClientResponseImpl<>(this, httpResponse, maxMessageSize, messageDecoder);\n       grpcResponse.init();\n+      grpcResponse.invalidMessageHandler(invalidMsg -> {\n+        cancel();\n+      });\n       return grpcResponse;\n     });\n   }"
            },
            {
                "sha": "a98308d822f856255207c749b97882da644a4e7e",
                "filename": "vertx-grpc-client/src/main/java/io/vertx/grpc/client/impl/GrpcClientResponseImpl.java",
                "status": "modified",
                "additions": 2,
                "deletions": 20,
                "changes": 22,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2Fimpl%2FGrpcClientResponseImpl.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2Fimpl%2FGrpcClientResponseImpl.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2Fimpl%2FGrpcClientResponseImpl.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -37,8 +37,8 @@ public class GrpcClientResponseImpl<Req, Resp> extends GrpcReadStreamBase<GrpcCl\n   private String statusMessage;\n   private String encoding;\n \n-  public GrpcClientResponseImpl(GrpcClientRequestImpl<Req, Resp> request, HttpClientResponse httpResponse, GrpcMessageDecoder<Resp> messageDecoder) {\n-    super(Vertx.currentContext(), httpResponse, httpResponse.headers().get(\"grpc-encoding\"), messageDecoder); // A bit ugly\n+  public GrpcClientResponseImpl(GrpcClientRequestImpl<Req, Resp> request, HttpClientResponse httpResponse, long maxMessageSize, GrpcMessageDecoder<Resp> messageDecoder) {\n+    super(Vertx.currentContext(), httpResponse, httpResponse.headers().get(\"grpc-encoding\"), maxMessageSize, messageDecoder); // A bit ugly\n     this.request = request;\n     this.encoding = httpResponse.headers().get(\"grpc-encoding\");\n     this.httpResponse = httpResponse;\n@@ -105,22 +105,4 @@ public Future<Void> end() {\n       }\n     });\n   }\n-\n-  @Override\n-  public GrpcClientResponseImpl<Req, Resp> handler(Handler<Resp> handler) {\n-    if (handler != null) {\n-      return messageHandler(msg -> {\n-        Resp decoded;\n-        try {\n-          decoded = decodeMessage(msg);\n-        } catch (CodecException e) {\n-          request.cancel();\n-          return;\n-        }\n-        handler.handle(decoded);\n-      });\n-    } else {\n-      return messageHandler(null);\n-    }\n-  }\n }"
            },
            {
                "sha": "c408e2f0402b5eec19e541fd33dab002a85e7aa6",
                "filename": "vertx-grpc-client/src/main/java/io/vertx/grpcio/client/GrpcIoClient.java",
                "status": "modified",
                "additions": 13,
                "deletions": 3,
                "changes": 16,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpcio%2Fclient%2FGrpcIoClient.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpcio%2Fclient%2FGrpcIoClient.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-client%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpcio%2Fclient%2FGrpcIoClient.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -16,10 +16,10 @@\n import io.vertx.core.Future;\n import io.vertx.core.Handler;\n import io.vertx.core.Vertx;\n-import io.vertx.core.buffer.Buffer;\n import io.vertx.core.http.HttpClientOptions;\n import io.vertx.core.net.SocketAddress;\n import io.vertx.grpc.client.GrpcClient;\n+import io.vertx.grpc.client.GrpcClientOptions;\n import io.vertx.grpc.client.GrpcClientRequest;\n import io.vertx.grpc.client.GrpcClientResponse;\n import io.vertx.grpc.client.impl.GrpcClientImpl;\n@@ -41,7 +41,17 @@ public interface GrpcIoClient extends GrpcClient {\n    * @return the created client\n    */\n   static GrpcIoClient client(Vertx vertx) {\n-    return new GrpcClientImpl(vertx);\n+    return client(vertx, new GrpcClientOptions());\n+  }\n+\n+  /**\n+   * Create a new client\n+   *\n+   * @param vertx the vertx instance\n+   * @return the created client\n+   */\n+  static GrpcIoClient client(Vertx vertx, GrpcClientOptions options) {\n+    return new GrpcClientImpl(vertx, options);\n   }\n \n   /**\n@@ -52,7 +62,7 @@ static GrpcIoClient client(Vertx vertx) {\n    * @return the created client\n    */\n   static GrpcIoClient client(Vertx vertx, HttpClientOptions options) {\n-    return new GrpcClientImpl(options, vertx);\n+    return client(vertx, new GrpcClientOptions().setTransportOptions(options));\n   }\n \n   /**"
            },
            {
                "sha": "df167d0311ac06b849d9fed45063a33b1bebec5b",
                "filename": "vertx-grpc-client/src/test/java/io/vertx/grpc/client/ClientRequestTest.java",
                "status": "modified",
                "additions": 79,
                "deletions": 0,
                "changes": 79,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Ftest%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2FClientRequestTest.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-client%2Fsrc%2Ftest%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2FClientRequestTest.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-client%2Fsrc%2Ftest%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fclient%2FClientRequestTest.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -27,11 +27,13 @@\n import io.vertx.ext.unit.TestContext;\n import io.vertx.grpc.common.GrpcReadStream;\n import io.vertx.grpc.common.GrpcStatus;\n+import io.vertx.grpc.common.MessageSizeOverflowException;\n import org.junit.Test;\n \n import java.io.File;\n import java.io.IOException;\n import java.util.ArrayList;\n+import java.util.Arrays;\n import java.util.Base64;\n import java.util.List;\n import java.util.concurrent.CompletableFuture;\n@@ -530,4 +532,81 @@ public void sayHello(HelloRequest request, StreamObserver<HelloReply> plainRespo\n         should.assertEquals(\"Hello Julien\", reply.getMessage());\n       }));\n   }\n+\n+  @Test\n+  public void testDefaultMessageSizeOverflow(TestContext should) throws Exception {\n+\n+    Async test = should.async();\n+\n+    Item item = Item.newBuilder().setValue(\"Asmoranomardicadaistinaculdacar\").build();\n+    int itemLen = item.getSerializedSize();\n+\n+    StreamingGrpc.StreamingImplBase called = new StreamingGrpc.StreamingImplBase() {\n+      @Override\n+      public void source(Empty request, StreamObserver<Item> responseObserver) {\n+        ServerCallStreamObserver callStreamObserver = (ServerCallStreamObserver) responseObserver;\n+        callStreamObserver.setOnCancelHandler(() -> {\n+          test.complete();\n+        });\n+        responseObserver.onNext(item);\n+      }\n+    };\n+    startServer(called);\n+\n+    GrpcClient client = GrpcClient.client(vertx, new GrpcClientOptions().setMaxMessageSize(itemLen - 1));\n+    client.request(SocketAddress.inetSocketAddress(port, \"localhost\"), StreamingGrpc.getSourceMethod())\n+      .onComplete(should.asyncAssertSuccess(callRequest -> {\n+        callRequest.response().onComplete(should.asyncAssertSuccess(callResponse -> {\n+          callResponse.handler(msg -> {\n+            should.fail();\n+          });\n+        }));\n+        callRequest.end(Empty.getDefaultInstance());\n+      }));\n+\n+    test.awaitSuccess(20_000);\n+  }\n+\n+  @Test\n+  public void testInvalidMessageHandlerStream(TestContext should) throws Exception {\n+\n+    Async test = should.async();\n+\n+    List<Item> items = Arrays.asList(\n+      Item.newBuilder().setValue(\"msg1\").build(),\n+      Item.newBuilder().setValue(\"Asmoranomardicadaistinaculdacar\").build(),\n+      Item.newBuilder().setValue(\"msg3\").build()\n+    );\n+\n+    int itemLen = items.get(1).getSerializedSize();\n+\n+    StreamingGrpc.StreamingImplBase called = new StreamingGrpc.StreamingImplBase() {\n+      @Override\n+      public void source(Empty request, StreamObserver<Item> responseObserver) {\n+        items.forEach(item -> responseObserver.onNext(item));\n+        responseObserver.onCompleted();\n+      }\n+    };\n+    startServer(called);\n+\n+    GrpcClient client = GrpcClient.client(vertx, new GrpcClientOptions().setMaxMessageSize(itemLen - 1));\n+    client.request(SocketAddress.inetSocketAddress(port, \"localhost\"), StreamingGrpc.getSourceMethod())\n+      .onComplete(should.asyncAssertSuccess(callRequest -> {\n+        callRequest.response().onComplete(should.asyncAssertSuccess(callResponse -> {\n+          List<Object> received = new ArrayList<>();\n+          callResponse.invalidMessageHandler(received::add);\n+          callResponse.handler(received::add);\n+          callResponse.endHandler(v -> {\n+            should.assertEquals(Item.class, received.get(0).getClass());\n+            should.assertEquals(MessageSizeOverflowException.class, received.get(1).getClass());\n+            should.assertEquals(Item.class, received.get(2).getClass());\n+            should.assertEquals(3, received.size());\n+            test.complete();\n+          });\n+        }));\n+        callRequest.end(Empty.getDefaultInstance());\n+      }));\n+\n+    test.awaitSuccess(20_000);\n+  }\n }"
            },
            {
                "sha": "10a852a9551b2c0daad010f5ba2686a2b0a0db00",
                "filename": "vertx-grpc-common/src/main/java/io/vertx/grpc/common/GrpcMessageDecoder.java",
                "status": "modified",
                "additions": 3,
                "deletions": 7,
                "changes": 10,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FGrpcMessageDecoder.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FGrpcMessageDecoder.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FGrpcMessageDecoder.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -91,14 +91,10 @@ static <T> GrpcMessageDecoder<T> unmarshaller(MethodDescriptor.Marshaller<T> des\n     return new GrpcMessageDecoder<T>() {\n       @Override\n       public T decode(GrpcMessage msg) {\n-        ByteArrayInputStream in = new ByteArrayInputStream(msg.payload().getBytes());\n-        try {\n+        try (ByteArrayInputStream in = new ByteArrayInputStream(msg.payload().getBytes())) {\n           return desc.parse(in);\n-        } finally {\n-          try {\n-            in.close();\n-          } catch (IOException ignore) {\n-          }\n+        } catch (Exception e) {\n+          throw new CodecException(e);\n         }\n       }\n     };"
            },
            {
                "sha": "9fcad51381dedb7cf2b2ce188c21a99d3308dbee",
                "filename": "vertx-grpc-common/src/main/java/io/vertx/grpc/common/GrpcReadStream.java",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FGrpcReadStream.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FGrpcReadStream.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FGrpcReadStream.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -34,6 +34,19 @@ public interface GrpcReadStream<T> extends ReadStream<T> {\n   @Fluent\n   GrpcReadStream<T> messageHandler(@Nullable Handler<GrpcMessage> handler);\n \n+  /**\n+   * Set a message handler that is reported with invalid message errors.\n+   *\n+   * <p>Warning: setting this handler overwrite the default handler which takes appropriate measure\n+   * when an invalid message is encountered such as cancelling the stream. This handler should be set\n+   * when control over invalid messages is required.</p>\n+   *\n+   * @param handler the invalid message handler\n+   * @return a reference to this, so the API can be used fluently\n+   */\n+  @GenIgnore(GenIgnore.PERMITTED_TYPE)\n+  GrpcReadStream<T> invalidMessageHandler(@Nullable Handler<InvalidMessageException> handler);\n+\n   /**\n    * Set a handler to be notified with gRPC errors.\n    *"
            },
            {
                "sha": "50865d5f53d1277c99460f2f0bc63c265e592d49",
                "filename": "vertx-grpc-common/src/main/java/io/vertx/grpc/common/InvalidMessageException.java",
                "status": "added",
                "additions": 29,
                "deletions": 0,
                "changes": 29,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FInvalidMessageException.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FInvalidMessageException.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FInvalidMessageException.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -0,0 +1,29 @@\n+/*\n+ * Copyright (c) 2011-2024 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+package io.vertx.grpc.common;\n+\n+import io.vertx.core.VertxException;\n+\n+/**\n+ * Signals an invalid message.\n+ *\n+ * @author <a href=\"mailto:julien@julienviet.com\">Julien Viet</a>\n+ */\n+public abstract class InvalidMessageException extends VertxException {\n+\n+  InvalidMessageException() {\n+    super((String) null, true);\n+  }\n+\n+  InvalidMessageException(Throwable cause) {\n+    super(cause, true);\n+  }\n+}"
            },
            {
                "sha": "6c5efc2bfc91e8be72cd41e71d330dae1716bd8c",
                "filename": "vertx-grpc-common/src/main/java/io/vertx/grpc/common/InvalidMessagePayloadException.java",
                "status": "added",
                "additions": 33,
                "deletions": 0,
                "changes": 33,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FInvalidMessagePayloadException.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FInvalidMessagePayloadException.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FInvalidMessagePayloadException.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -0,0 +1,33 @@\n+/*\n+ * Copyright (c) 2011-2024 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+package io.vertx.grpc.common;\n+\n+/**\n+ * Signals a message with an invalid payload, i.e. that could not be decoded by the protobuf codec.\n+ *\n+ * @author <a href=\"mailto:julien@julienviet.com\">Julien Viet</a>\n+ */\n+public final class InvalidMessagePayloadException extends InvalidMessageException {\n+\n+  private GrpcMessage message;\n+\n+  public InvalidMessagePayloadException(GrpcMessage message, Throwable cause) {\n+    super(cause);\n+    this.message = message;\n+  }\n+\n+  /**\n+   * @return the invalid message that could not be decoded.\n+   */\n+  public GrpcMessage message() {\n+    return message;\n+  }\n+}"
            },
            {
                "sha": "10f0e9f4db44224ab124c5cc8b55c3df33286b83",
                "filename": "vertx-grpc-common/src/main/java/io/vertx/grpc/common/MessageSizeOverflowException.java",
                "status": "added",
                "additions": 29,
                "deletions": 0,
                "changes": 29,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FMessageSizeOverflowException.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FMessageSizeOverflowException.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2FMessageSizeOverflowException.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -0,0 +1,29 @@\n+/*\n+ * Copyright (c) 2011-2024 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+package io.vertx.grpc.common;\n+\n+/**\n+ * Signals a message that is longer than the maximum configured size.\n+ *\n+ * @author <a href=\"mailto:julien@julienviet.com\">Julien Viet</a>\n+ */\n+public final class MessageSizeOverflowException extends InvalidMessageException {\n+\n+  private final long messageSize;\n+\n+  public MessageSizeOverflowException(long messageSize) {\n+    this.messageSize = messageSize;\n+  }\n+\n+  public long messageSize() {\n+    return messageSize;\n+  }\n+}"
            },
            {
                "sha": "c6f2a9a5913ce4fef2905090981623dc56fc3d79",
                "filename": "vertx-grpc-common/src/main/java/io/vertx/grpc/common/impl/GrpcReadStreamBase.java",
                "status": "modified",
                "additions": 79,
                "deletions": 14,
                "changes": 93,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2Fimpl%2FGrpcReadStreamBase.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2Fimpl%2FGrpcReadStreamBase.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-common%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fcommon%2Fimpl%2FGrpcReadStreamBase.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -10,6 +10,7 @@\n  */\n package io.vertx.grpc.common.impl;\n \n+import io.vertx.codegen.annotations.Nullable;\n import io.vertx.core.Context;\n import io.vertx.core.Future;\n import io.vertx.core.Handler;\n@@ -24,6 +25,9 @@\n import io.vertx.grpc.common.GrpcMessage;\n import io.vertx.grpc.common.GrpcMessageDecoder;\n import io.vertx.grpc.common.GrpcReadStream;\n+import io.vertx.grpc.common.MessageSizeOverflowException;\n+import io.vertx.grpc.common.InvalidMessageException;\n+import io.vertx.grpc.common.InvalidMessagePayloadException;\n \n import static io.vertx.grpc.common.GrpcError.mapHttp2ErrorCode;\n \n@@ -47,20 +51,24 @@ public Buffer payload() {\n \n   protected final ContextInternal context;\n   private final String encoding;\n+  private final long maxMessageSize;\n   private final ReadStream<Buffer> stream;\n   private final InboundBuffer<GrpcMessage> queue;\n   private Buffer buffer;\n+  private long bytesToSkip;\n   private Handler<GrpcError> errorHandler;\n   private Handler<Throwable> exceptionHandler;\n   private Handler<GrpcMessage> messageHandler;\n   private Handler<Void> endHandler;\n+  private Handler<InvalidMessageException> invalidMessageHandler;\n   private GrpcMessage last;\n   private final GrpcMessageDecoder<T> messageDecoder;\n   private final Promise<Void> end;\n \n-  protected GrpcReadStreamBase(Context context, ReadStream<Buffer> stream, String encoding, GrpcMessageDecoder<T> messageDecoder) {\n+  protected GrpcReadStreamBase(Context context, ReadStream<Buffer> stream, String encoding, long maxMessageSize, GrpcMessageDecoder<T> messageDecoder) {\n     this.context = (ContextInternal) context;\n     this.encoding = encoding;\n+    this.maxMessageSize = maxMessageSize;\n     this.stream = stream;\n     this.queue = new InboundBuffer<>(context);\n     this.messageDecoder = messageDecoder;\n@@ -87,7 +95,7 @@ public void init() {\n     });\n   }\n \n-  protected T decodeMessage(GrpcMessage msg) throws CodecException {\n+  private T decodeMessage(GrpcMessage msg) throws CodecException {\n     switch (msg.encoding()) {\n       case \"identity\":\n         // Nothing to do\n@@ -102,21 +110,51 @@ protected T decodeMessage(GrpcMessage msg) throws CodecException {\n     return messageDecoder.decode(msg);\n   }\n \n-  public void handle(Buffer chunk) {\n+  public final void handle(Buffer chunk) {\n+    if (bytesToSkip > 0L) {\n+      int len = chunk.length();\n+      if (len <= bytesToSkip) {\n+        bytesToSkip -= len;\n+        return;\n+      }\n+      chunk = chunk.slice((int)bytesToSkip, len);\n+      bytesToSkip = 0L;\n+    }\n     if (buffer == null) {\n       buffer = chunk;\n     } else {\n       buffer.appendBuffer(chunk);\n     }\n     int idx = 0;\n     boolean pause = false;\n-    int len;\n-    while (idx + 5 <= buffer.length() && (idx + 5 + (len = buffer.getInt(idx + 1)))<= buffer.length()) {\n+    while (true) {\n+      if (idx + 5 > buffer.length()) {\n+        break;\n+      }\n+      long len = ((long)buffer.getInt(idx + 1)) & 0xFFFFFFFFL;\n+      if (len > maxMessageSize) {\n+        Handler<InvalidMessageException> handler = invalidMessageHandler;\n+        if (handler != null) {\n+          MessageSizeOverflowException msoe = new MessageSizeOverflowException(len);\n+          context.dispatch(msoe, handler);\n+        }\n+        if (buffer.length() < (len + 5)) {\n+          bytesToSkip = (len + 5) - buffer.length();\n+          buffer = null;\n+          return;\n+        } else {\n+          buffer = buffer.slice((int)(len + 5), buffer.length());\n+          continue;\n+        }\n+      }\n+      if (len > buffer.length() - (idx + 5)) {\n+        break;\n+      }\n       boolean compressed = buffer.getByte(idx) == 1;\n       if (compressed && encoding == null) {\n         throw new UnsupportedOperationException(\"Handle me\");\n       }\n-      Buffer payload = buffer.slice(idx + 5, idx + 5 + len);\n+      Buffer payload = buffer.slice(idx + 5, (int)(idx + 5 + len));\n       GrpcMessage message = GrpcMessage.message(compressed ? encoding : \"identity\", payload);\n       pause |= !queue.write(message);\n       idx += 5 + len;\n@@ -131,39 +169,67 @@ public void handle(Buffer chunk) {\n     }\n   }\n \n-  public S pause() {\n+  public final S pause() {\n     queue.pause();\n     return (S) this;\n   }\n \n-  public S resume() {\n+  public final S resume() {\n     queue.resume();\n     return (S) this;\n   }\n \n-  public S fetch(long amount) {\n+  public final S fetch(long amount) {\n     queue.fetch(amount);\n     return (S) this;\n   }\n \n   @Override\n-  public S errorHandler(Handler<GrpcError> handler) {\n+  public final S errorHandler(Handler<GrpcError> handler) {\n     errorHandler = handler;\n     return (S) this;\n   }\n \n   @Override\n-  public S exceptionHandler(Handler<Throwable> handler) {\n+  public final S exceptionHandler(Handler<Throwable> handler) {\n     exceptionHandler = handler;\n     return (S) this;\n   }\n \n   @Override\n-  public S messageHandler(Handler<GrpcMessage> handler) {\n+  public final S messageHandler(Handler<GrpcMessage> handler) {\n     messageHandler = handler;\n     return (S) this;\n   }\n \n+  @Override\n+  public final S invalidMessageHandler(@Nullable Handler<InvalidMessageException> handler) {\n+    invalidMessageHandler = handler;\n+    return (S) this;\n+  }\n+\n+  @Override\n+  public final S handler(@Nullable Handler<T> handler) {\n+    if (handler != null) {\n+      return messageHandler(msg -> {\n+        T decoded;\n+        try {\n+          decoded = decodeMessage(msg);\n+        } catch (CodecException e) {\n+          Handler<InvalidMessageException> errorHandler = invalidMessageHandler;\n+          if (errorHandler != null) {\n+            InvalidMessagePayloadException impe = new InvalidMessagePayloadException(msg, e);\n+            errorHandler.handle(impe);\n+          }\n+          return;\n+        }\n+        handler.handle(decoded);\n+      });\n+    } else {\n+      return messageHandler(null);\n+    }\n+  }\n+\n   @Override\n   public S endHandler(Handler<Void> endHandler) {\n     this.endHandler = endHandler;\n@@ -196,7 +262,7 @@ protected void handleEnd() {\n     }\n   }\n \n-  protected void handleMessage(GrpcMessage msg) {\n+  private void handleMessage(GrpcMessage msg) {\n     last = msg;\n     Handler<GrpcMessage> handler = messageHandler;\n     if (handler != null) {\n@@ -214,5 +280,4 @@ public Future<T> last() {\n   public Future<Void> end() {\n     return end.future();\n   }\n-\n }"
            },
            {
                "sha": "9f735355c4fd9e451d7e919e41d8bb28b8c9cd7c",
                "filename": "vertx-grpc-server/src/main/generated/io/vertx/grpc/server/GrpcServerOptionsConverter.java",
                "status": "added",
                "additions": 39,
                "deletions": 0,
                "changes": 39,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fgenerated%2Fio%2Fvertx%2Fgrpc%2Fserver%2FGrpcServerOptionsConverter.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fgenerated%2Fio%2Fvertx%2Fgrpc%2Fserver%2FGrpcServerOptionsConverter.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-server%2Fsrc%2Fmain%2Fgenerated%2Fio%2Fvertx%2Fgrpc%2Fserver%2FGrpcServerOptionsConverter.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -0,0 +1,39 @@\n+package io.vertx.grpc.server;\n+\n+import io.vertx.core.json.JsonObject;\n+import io.vertx.core.json.JsonArray;\n+import io.vertx.core.json.impl.JsonUtil;\n+import java.time.Instant;\n+import java.time.format.DateTimeFormatter;\n+import java.util.Base64;\n+\n+/**\n+ * Converter and mapper for {@link io.vertx.grpc.server.GrpcServerOptions}.\n+ * NOTE: This class has been automatically generated from the {@link io.vertx.grpc.server.GrpcServerOptions} original class using Vert.x codegen.\n+ */\n+public class GrpcServerOptionsConverter {\n+\n+\n+  private static final Base64.Decoder BASE64_DECODER = JsonUtil.BASE64_DECODER;\n+  private static final Base64.Encoder BASE64_ENCODER = JsonUtil.BASE64_ENCODER;\n+\n+   static void fromJson(Iterable<java.util.Map.Entry<String, Object>> json, GrpcServerOptions obj) {\n+    for (java.util.Map.Entry<String, Object> member : json) {\n+      switch (member.getKey()) {\n+        case \"maxMessageSize\":\n+          if (member.getValue() instanceof Number) {\n+            obj.setMaxMessageSize(((Number)member.getValue()).longValue());\n+          }\n+          break;\n+      }\n+    }\n+  }\n+\n+   static void toJson(GrpcServerOptions obj, JsonObject json) {\n+    toJson(obj, json.getMap());\n+  }\n+\n+   static void toJson(GrpcServerOptions obj, java.util.Map<String, Object> json) {\n+    json.put(\"maxMessageSize\", obj.getMaxMessageSize());\n+  }\n+}"
            },
            {
                "sha": "49581be8831ae193552feb64ed7591100a999981",
                "filename": "vertx-grpc-server/src/main/java/io/vertx/grpc/server/GrpcServer.java",
                "status": "modified",
                "additions": 13,
                "deletions": 1,
                "changes": 14,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2FGrpcServer.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2FGrpcServer.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2FGrpcServer.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -45,10 +45,22 @@ public interface GrpcServer extends Handler<HttpServerRequest> {\n   /**\n    * Create a blank gRPC server\n    *\n+   * @param vertx the vertx instance\n    * @return the created server\n    */\n   static GrpcServer server(Vertx vertx) {\n-    return new GrpcServerImpl(vertx);\n+    return server(vertx, new GrpcServerOptions());\n+  }\n+\n+  /**\n+   * Create a blank gRPC server\n+   *\n+   * @param vertx the vertx instance\n+   * @param options the server options\n+   * @return the created server\n+   */\n+  static GrpcServer server(Vertx vertx, GrpcServerOptions options) {\n+    return new GrpcServerImpl(vertx, options);\n   }\n \n   /**"
            },
            {
                "sha": "a0fd6a8f3c6bcbf2ebc700e3a2c8e7bfab6670ba",
                "filename": "vertx-grpc-server/src/main/java/io/vertx/grpc/server/GrpcServerOptions.java",
                "status": "added",
                "additions": 56,
                "deletions": 0,
                "changes": 56,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2FGrpcServerOptions.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2FGrpcServerOptions.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2FGrpcServerOptions.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -0,0 +1,56 @@\n+package io.vertx.grpc.server;\n+\n+import io.vertx.codegen.annotations.DataObject;\n+import io.vertx.codegen.json.annotations.JsonGen;\n+import io.vertx.core.json.JsonObject;\n+\n+/**\n+ * Grpc server options.\n+ *\n+ * @author <a href=\"mailto:julien@julienviet.com\">Julien Viet</a>\n+ */\n+@DataObject\n+@JsonGen(publicConverter = false)\n+public class GrpcServerOptions {\n+\n+  /**\n+   * The default maximum message size in bytes accepted from a client = {@code 256KB}\n+   */\n+  public static final long DEFAULT_MAX_MESSAGE_SIZE = 256 * 1024;\n+\n+  private long maxMessageSize = DEFAULT_MAX_MESSAGE_SIZE;\n+\n+  public GrpcServerOptions() {\n+  }\n+\n+  public GrpcServerOptions(GrpcServerOptions options) {\n+    this.maxMessageSize = options.maxMessageSize;\n+  }\n+\n+  public GrpcServerOptions(JsonObject json) {\n+    GrpcServerOptionsConverter.fromJson(json, this);\n+  }\n+\n+  /**\n+   * @return the maximum message size in bytes accepted by the server\n+   */\n+  public long getMaxMessageSize() {\n+    return maxMessageSize;\n+  }\n+\n+  /**\n+   * Set the maximum message size in bytes accepted from a client, the maximum value is {@code 0xFFFFFFFF}\n+   * @param maxMessageSize the size\n+   * @return a reference to this, so the API can be used fluently\n+   */\n+  public GrpcServerOptions setMaxMessageSize(long maxMessageSize) {\n+    if (maxMessageSize <= 0) {\n+      throw new IllegalArgumentException(\"Max message size must be > 0\");\n+    }\n+    if (maxMessageSize > 0xFFFFFFFFL) {\n+      throw new IllegalArgumentException(\"Max message size must be <= 0xFFFFFFFF\");\n+    }\n+    this.maxMessageSize = maxMessageSize;\n+    return this;\n+  }\n+}"
            },
            {
                "sha": "16602e01da6696d4bcd609828f824df146cf6ea9",
                "filename": "vertx-grpc-server/src/main/java/io/vertx/grpc/server/impl/GrpcServerImpl.java",
                "status": "modified",
                "additions": 20,
                "deletions": 5,
                "changes": 25,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2Fimpl%2FGrpcServerImpl.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2Fimpl%2FGrpcServerImpl.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2Fimpl%2FGrpcServerImpl.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -19,7 +19,10 @@\n import io.vertx.grpc.common.GrpcMessageEncoder;\n import io.vertx.grpc.common.ServiceMethod;\n import io.vertx.grpc.common.ServiceName;\n+import io.vertx.grpc.common.MessageSizeOverflowException;\n+import io.vertx.grpc.common.GrpcStatus;\n import io.vertx.grpc.common.impl.GrpcMethodCall;\n+import io.vertx.grpc.server.GrpcServerOptions;\n import io.vertx.grpc.server.GrpcServerRequest;\n import io.vertx.grpcio.server.GrpcIoServer;\n \n@@ -32,11 +35,13 @@\n public class GrpcServerImpl implements GrpcIoServer {\n \n   private final Vertx vertx;\n+  private final long maxMessageSize;\n   private Handler<GrpcServerRequest<Buffer, Buffer>> requestHandler;\n   private Map<String, MethodCallHandler<?, ?>> methodCallHandlers = new HashMap<>();\n \n-  public GrpcServerImpl(Vertx vertx) {\n+  public GrpcServerImpl(Vertx vertx, GrpcServerOptions options) {\n     this.vertx = vertx;\n+    this.maxMessageSize = options.getMaxMessageSize();\n   }\n \n   @Override\n@@ -49,8 +54,7 @@ public void handle(HttpServerRequest httpRequest) {\n     } else {\n       Handler<GrpcServerRequest<Buffer, Buffer>> handler = requestHandler;\n       if (handler != null) {\n-        GrpcServerRequestImpl<Buffer, Buffer> grpcRequest = new GrpcServerRequestImpl<>(httpRequest, GrpcMessageDecoder.IDENTITY, GrpcMessageEncoder.IDENTITY, methodCall);\n-        grpcRequest.init();\n+        GrpcServerRequest<Buffer, Buffer> grpcRequest = createRequest(httpRequest, GrpcMessageDecoder.IDENTITY, GrpcMessageEncoder.IDENTITY, methodCall);\n         handler.handle(grpcRequest);\n       } else {\n         httpRequest.response().setStatusCode(500).end();\n@@ -59,11 +63,22 @@ public void handle(HttpServerRequest httpRequest) {\n   }\n \n   private <Req, Resp> void handle(MethodCallHandler<Req, Resp> method, HttpServerRequest httpRequest, GrpcMethodCall methodCall) {\n-    GrpcServerRequestImpl<Req, Resp> grpcRequest = new GrpcServerRequestImpl<>(httpRequest, method.def.decoder(), method.def.encoder(), methodCall);\n-    grpcRequest.init();\n+    GrpcServerRequest<Req, Resp> grpcRequest = createRequest(httpRequest, method.def.decoder(), method.def.encoder(), methodCall);\n     method.handle(grpcRequest);\n   }\n \n+  private <Req, Resp>GrpcServerRequest<Req, Resp> createRequest(HttpServerRequest httpRequest, GrpcMessageDecoder<Req> decoder, GrpcMessageEncoder<Resp> encoder, GrpcMethodCall methodCall) {\n+    GrpcServerRequestImpl<Req, Resp> grpcRequest = new GrpcServerRequestImpl<>(httpRequest, maxMessageSize, decoder, encoder, methodCall);\n+    grpcRequest.init();\n+    grpcRequest.invalidMessageHandler(invalidMsg -> {\n+      if (invalidMsg instanceof MessageSizeOverflowException) {\n+        grpcRequest.response().status(GrpcStatus.RESOURCE_EXHAUSTED).end();\n+      } else {\n+        grpcRequest.response.cancel();\n+      }\n+    });\n+    return grpcRequest;\n+  }\n   @Override\n   public <Req, Resp> GrpcIoServer callHandler(ServiceMethod<Req, Resp> serviceMethod, Handler<GrpcServerRequest<Req, Resp>> handler) {\n     if (handler != null) {"
            },
            {
                "sha": "ee15fd097c218217a25d9934099c3a8ff254a369",
                "filename": "vertx-grpc-server/src/main/java/io/vertx/grpc/server/impl/GrpcServerRequestImpl.java",
                "status": "modified",
                "additions": 2,
                "deletions": 20,
                "changes": 22,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2Fimpl%2FGrpcServerRequestImpl.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2Fimpl%2FGrpcServerRequestImpl.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2Fimpl%2FGrpcServerRequestImpl.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -34,8 +34,8 @@ public class GrpcServerRequestImpl<Req, Resp> extends GrpcReadStreamBase<GrpcSer\n   final GrpcServerResponse<Req, Resp> response;\n   private GrpcMethodCall methodCall;\n \n-  public GrpcServerRequestImpl(HttpServerRequest httpRequest, GrpcMessageDecoder<Req> messageDecoder, GrpcMessageEncoder<Resp> messageEncoder, GrpcMethodCall methodCall) {\n-    super(((HttpServerRequestInternal) httpRequest).context(), httpRequest, httpRequest.headers().get(\"grpc-encoding\"), messageDecoder);\n+  public GrpcServerRequestImpl(HttpServerRequest httpRequest, long maxMessageSize, GrpcMessageDecoder<Req> messageDecoder, GrpcMessageEncoder<Resp> messageEncoder, GrpcMethodCall methodCall) {\n+    super(((HttpServerRequestInternal) httpRequest).context(), httpRequest, httpRequest.headers().get(\"grpc-encoding\"), maxMessageSize,  messageDecoder);\n     this.httpRequest = httpRequest;\n     this.response = new GrpcServerResponseImpl<>(this, httpRequest.response(), messageEncoder);\n     this.methodCall = methodCall;\n@@ -65,24 +65,6 @@ public String methodName() {\n     return methodCall.methodName();\n   }\n \n-  @Override\n-  public GrpcServerRequest<Req, Resp> handler(Handler<Req> handler) {\n-    if (handler != null) {\n-      return messageHandler(msg -> {\n-        Req decoded;\n-        try {\n-          decoded = decodeMessage(msg);\n-        } catch (CodecException e) {\n-          response.cancel();\n-          return;\n-        }\n-        handler.handle(decoded);\n-      });\n-    } else {\n-      return messageHandler(null);\n-    }\n-  }\n-\n   public GrpcServerResponse<Req, Resp> response() {\n     return response;\n   }"
            },
            {
                "sha": "03c46404e969c7d50837efa41bb3edb385dedbe5",
                "filename": "vertx-grpc-server/src/main/java/io/vertx/grpcio/server/GrpcIoServer.java",
                "status": "modified",
                "additions": 14,
                "deletions": 5,
                "changes": 19,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpcio%2Fserver%2FGrpcIoServer.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpcio%2Fserver%2FGrpcIoServer.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-server%2Fsrc%2Fmain%2Fjava%2Fio%2Fvertx%2Fgrpcio%2Fserver%2FGrpcIoServer.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -11,16 +11,13 @@\n package io.vertx.grpcio.server;\n \n import io.grpc.MethodDescriptor;\n-import io.vertx.codegen.annotations.Fluent;\n import io.vertx.codegen.annotations.GenIgnore;\n import io.vertx.codegen.annotations.VertxGen;\n import io.vertx.core.Handler;\n import io.vertx.core.Vertx;\n-import io.vertx.core.buffer.Buffer;\n-import io.vertx.core.http.HttpServerRequest;\n import io.vertx.grpc.server.GrpcServer;\n+import io.vertx.grpc.server.GrpcServerOptions;\n import io.vertx.grpc.server.GrpcServerRequest;\n-import io.vertx.grpc.server.GrpcServerResponse;\n import io.vertx.grpc.server.impl.GrpcServerImpl;\n \n /**\n@@ -34,10 +31,22 @@ public interface GrpcIoServer extends GrpcServer {\n   /**\n    * Create a blank gRPC/IO server\n    *\n+   * @param vertx the vertx instance\n    * @return the created server\n    */\n   static GrpcIoServer server(Vertx vertx) {\n-    return new GrpcServerImpl(vertx);\n+    return server(vertx, new GrpcServerOptions());\n+  }\n+\n+  /**\n+   * Create a blank gRPC/IO server\n+   *\n+   * @param vertx the vertx instance\n+   * @param options the server options\n+   * @return the created server\n+   */\n+  static GrpcIoServer server(Vertx vertx, GrpcServerOptions options) {\n+    return new GrpcServerImpl(vertx, options);\n   }\n \n   /**"
            },
            {
                "sha": "753cfc82e67b64cc20e01128ce88c81ee54a4772",
                "filename": "vertx-grpc-server/src/test/java/io/vertx/grpc/server/ServerRequestTest.java",
                "status": "modified",
                "additions": 121,
                "deletions": 1,
                "changes": 122,
                "blob_url": "https://github.com/eclipse-vertx/vertx-grpc/blob/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Ftest%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2FServerRequestTest.java",
                "raw_url": "https://github.com/eclipse-vertx/vertx-grpc/raw/a76b14a92410c89fcc590c5852d800b565916ccf/vertx-grpc-server%2Fsrc%2Ftest%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2FServerRequestTest.java",
                "contents_url": "https://api.github.com/repos/eclipse-vertx/vertx-grpc/contents/vertx-grpc-server%2Fsrc%2Ftest%2Fjava%2Fio%2Fvertx%2Fgrpc%2Fserver%2FServerRequestTest.java?ref=a76b14a92410c89fcc590c5852d800b565916ccf",
                "patch": "@@ -20,17 +20,23 @@\n import io.grpc.stub.ClientCallStreamObserver;\n import io.grpc.stub.StreamObserver;\n import io.vertx.core.MultiMap;\n-import io.vertx.core.http.HttpServerOptions;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.core.http.*;\n import io.vertx.core.net.SelfSignedCertificate;\n import io.vertx.ext.unit.Async;\n import io.vertx.ext.unit.TestContext;\n import io.vertx.grpc.common.GrpcError;\n import io.vertx.grpc.common.GrpcStatus;\n+import io.vertx.grpc.common.InvalidMessagePayloadException;\n+import io.vertx.grpc.common.MessageSizeOverflowException;\n import org.junit.Test;\n \n import java.io.File;\n import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n import java.util.Base64;\n+import java.util.List;\n import java.util.concurrent.atomic.AtomicInteger;\n \n /**\n@@ -316,4 +322,118 @@ public void testCancel(TestContext should) {\n       should.assertEquals(Status.CANCELLED.getCode(), ignore.getStatus().getCode());\n     }\n   }\n+\n+  @Test\n+  public void testDefaultMessageSizeOverflow(TestContext should) {\n+\n+    HelloRequest request = HelloRequest.newBuilder().setName(\"Asmoranomardicadaistinaculdacar\").build();\n+    int requestLen = request.getSerializedSize();\n+\n+    MethodDescriptor<HelloRequest, HelloReply> method = GreeterGrpc.getSayHelloMethod();\n+\n+    startServer(GrpcServer.server(vertx, new GrpcServerOptions().setMaxMessageSize(requestLen - 1))\n+      .callHandler(method, call -> {\n+      }));\n+\n+    channel = ManagedChannelBuilder.forAddress(\"localhost\", port)\n+      .usePlaintext()\n+      .build();\n+\n+    GreeterGrpc.GreeterBlockingStub stub = GreeterGrpc.newBlockingStub(channel);\n+\n+    try {\n+      stub.sayHello(request);\n+      should.fail();\n+    } catch (StatusRuntimeException ignore) {\n+      should.assertEquals(Status.RESOURCE_EXHAUSTED.getCode(), ignore.getStatus().getCode());\n+    }\n+  }\n+\n+  @Test\n+  public void testInvalidMessageHandler(TestContext should) {\n+\n+    HelloRequest request = HelloRequest.newBuilder().setName(\"Asmoranomardicadaistinaculdacar\").build();\n+    int requestLen = request.getSerializedSize();\n+\n+    MethodDescriptor<HelloRequest, HelloReply> method = GreeterGrpc.getSayHelloMethod();\n+\n+    startServer(GrpcServer.server(vertx, new GrpcServerOptions().setMaxMessageSize(requestLen - 1))\n+      .callHandler(method, call -> {\n+      AtomicInteger invalid = new AtomicInteger();\n+      call.handler(msg -> {\n+        should.fail();\n+      });\n+      call.invalidMessageHandler(err -> {\n+        should.assertEquals(0, invalid.getAndIncrement());\n+      });\n+      call.endHandler(v -> {\n+        call.response().end(HelloReply.newBuilder().setMessage(\"Hola\").build());\n+      });\n+    }));\n+\n+    channel = ManagedChannelBuilder.forAddress(\"localhost\", port)\n+      .usePlaintext()\n+      .build();\n+\n+    GreeterGrpc.GreeterBlockingStub stub = GreeterGrpc.newBlockingStub(channel);\n+\n+    HelloReply resp = stub.sayHello(request);\n+    should.assertEquals(\"Hola\", resp.getMessage());\n+  }\n+\n+  @Test\n+  public void testInvalidMessageHandlerStream(TestContext should) {\n+\n+    List<Buffer> messages = Arrays.asList(\n+      Buffer.buffer(Item.newBuilder().setValue(\"msg1\").build().toByteArray()),\n+      Buffer.buffer(Item.newBuilder().setValue(\"msg2-invalid\").build().toByteArray()),\n+      Buffer.buffer(Item.newBuilder().setValue(\"msg3\").build().toByteArray()),\n+      Buffer.buffer(new byte[]{ 0,1,2,3,4,5,6,7 }),\n+      Buffer.buffer(Item.newBuilder().setValue(\"msg5\").build().toByteArray())\n+    );\n+\n+    int invalidLen = messages.get(1).length() - 1;\n+\n+    startServer(GrpcServer.server(vertx, new GrpcServerOptions().setMaxMessageSize(invalidLen - 1)).callHandler(StreamingGrpc.getSinkMethod(), call -> {\n+      List<Object> received = new ArrayList<>();\n+      call.invalidMessageHandler(received::add);\n+      call.handler(received::add);\n+      call.endHandler(v -> {\n+        should.assertEquals(Item.class, received.get(0).getClass());\n+        should.assertEquals(MessageSizeOverflowException.class, received.get(1).getClass());\n+        should.assertEquals(Item.class, received.get(2).getClass());\n+        should.assertEquals(InvalidMessagePayloadException.class, received.get(3).getClass());\n+        should.assertEquals(Item.class, received.get(4).getClass());\n+        should.assertEquals(5, received.size());\n+        call.response().end(Empty.getDefaultInstance());\n+      });\n+    }));\n+\n+    Async test = should.async();\n+\n+    HttpClient client = vertx.createHttpClient(new HttpClientOptions()\n+      .setProtocolVersion(HttpVersion.HTTP_2)\n+      .setHttp2ClearTextUpgrade(false)\n+    );\n+\n+    client.request(HttpMethod.POST, 8080, \"localhost\", \"/\" + StreamingGrpc.SERVICE_NAME + \"/Sink\", should.asyncAssertSuccess(request -> {\n+      request.putHeader(\"grpc-encoding\", \"gzip\");\n+      request.setChunked(true);\n+      messages.forEach(msg -> {\n+        Buffer buffer = Buffer.buffer();\n+        buffer.appendByte((byte)0); // Uncompressed\n+        buffer.appendInt(msg.length());\n+        buffer.appendBuffer(msg);\n+        request.write(buffer);\n+      });\n+      request.end();\n+      request.response().onComplete(should.asyncAssertSuccess(response -> {\n+        response.end().onComplete(should.asyncAssertSuccess(v -> {\n+          test.complete();\n+        }));\n+      }));\n+    }));\n+\n+    test.awaitSuccess(20_000);\n+  }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/containers/aardvark-dns/commits/aa109bbd6743abd7027e589cc4b871dd2dce7d50",
        "url": "https://api.github.com/repos/containers/aardvark-dns/commits/aa109bbd6743abd7027e589cc4b871dd2dce7d50",
        "html_url": "https://github.com/containers/aardvark-dns/commit/aa109bbd6743abd7027e589cc4b871dd2dce7d50",
        "message": "tcp: add timeout to connection\n\nAdd a 3s timeout to all tcp connections, we do not want clients to keep\nthe connections open forever. Also do not allow more than one message\nper connection.\n\nThe API is a bit weird, we first get the message then have to poll again\nwhere it return None otherwise the reply will not be send.\n\nSigned-off-by: Paul Holzinger <pholzing@redhat.com>",
        "files": [
            {
                "sha": "6a82f098c93e97879d0885b7abd60d4539bea7f1",
                "filename": "src/dns/coredns.rs",
                "status": "modified",
                "additions": 16,
                "deletions": 2,
                "changes": 18,
                "blob_url": "https://github.com/containers/aardvark-dns/blob/aa109bbd6743abd7027e589cc4b871dd2dce7d50/src%2Fdns%2Fcoredns.rs",
                "raw_url": "https://github.com/containers/aardvark-dns/raw/aa109bbd6743abd7027e589cc4b871dd2dce7d50/src%2Fdns%2Fcoredns.rs",
                "contents_url": "https://api.github.com/repos/containers/aardvark-dns/contents/src%2Fdns%2Fcoredns.rs?ref=aa109bbd6743abd7027e589cc4b871dd2dce7d50",
                "patch": "@@ -23,6 +23,7 @@ use std::io::Error;\n use std::net::{IpAddr, SocketAddr};\n use std::sync::Arc;\n use std::sync::Mutex;\n+use std::time::Duration;\n use tokio::net::TcpListener;\n use tokio::net::UdpSocket;\n \n@@ -108,8 +109,21 @@ impl CoreDns {\n         let (mut hickory_stream, sender_original) =\n             TcpStream::from_stream(AsyncIoTokioAsStd(stream), peer);\n \n-        while let Some(message) = hickory_stream.next().await {\n-            self.process_message(message, &sender_original, Protocol::Tcp)\n+        // It is possible for a client to keep the tcp socket open forever and never send any data,\n+        // we do not want this so add a 3s timeout then we close the socket.\n+        match tokio::time::timeout(Duration::from_secs(3), hickory_stream.next()).await {\n+            Ok(message) => {\n+                if let Some(msg) = message {\n+                    self.process_message(msg, &sender_original, Protocol::Tcp);\n+                    // The API is a bit strange, first time we call next we get the message,\n+                    // but we must call again to send our reply back\n+                    hickory_stream.next().await;\n+                }\n+            }\n+            Err(_) => debug!(\n+                \"Tcp connection {} was cancelled after 3s as it took to long to receive message\",\n+                peer\n+            ),\n         }\n     }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/commits/17aa2068553db3c3aac081c9ffe393536f33b28b",
        "url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/commits/17aa2068553db3c3aac081c9ffe393536f33b28b",
        "html_url": "https://github.com/Authenticator-Extension/Authenticator/commit/17aa2068553db3c3aac081c9ffe393536f33b28b",
        "message": "Fully encrypt account data in all storage mediums\n\n* Refactor encryption code\n* Fix #704\n* Initial work towards fixing longstanding sync conflict issues (multi-key support)",
        "files": [
            {
                "sha": "5eac001d8a11e60962036f4d0e4a8fabeddf12cb",
                "filename": ".eslintrc.js",
                "status": "modified",
                "additions": 9,
                "deletions": 11,
                "changes": 20,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/.eslintrc.js",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/.eslintrc.js",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/.eslintrc.js?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,23 +1,21 @@\n module.exports = {\n   root: true,\n-  parser: '@typescript-eslint/parser',\n+  parser: \"@typescript-eslint/parser\",\n   parserOptions: {\n-    \"ecmaVersion\": 6\n+    ecmaVersion: 6,\n   },\n-  plugins: [\n-    '@typescript-eslint',\n-  ],\n+  plugins: [\"@typescript-eslint\"],\n   extends: [\n-    'eslint:recommended',\n-    'plugin:@typescript-eslint/eslint-recommended',\n-    'plugin:@typescript-eslint/recommended',\n+    \"eslint:recommended\",\n+    \"plugin:@typescript-eslint/eslint-recommended\",\n+    \"plugin:@typescript-eslint/recommended\",\n   ],\n   env: {\n-    \"amd\": true,\n-    \"node\": true,\n+    amd: true,\n+    node: true,\n   },\n   rules: {\n     \"@typescript-eslint/no-use-before-define\": \"off\",\n     \"@typescript-eslint/explicit-function-return-type\": \"off\",\n-  }\n+  },\n };"
            },
            {
                "sha": "c4e2793f389a5c71e4fc3ab16e3e9ca2af047d29",
                "filename": ".github/workflows/main.yml",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/.github%2Fworkflows%2Fmain.yml",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/.github%2Fworkflows%2Fmain.yml",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/.github%2Fworkflows%2Fmain.yml?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -42,7 +42,7 @@ jobs:\n   run-tests:\n     runs-on: ubuntu-latest\n     name: Run tests\n-    needs: [ build ]\n+    needs: [build]\n \n     steps:\n       - uses: actions/checkout@v2\n@@ -53,9 +53,9 @@ jobs:\n       - name: Install dependencies\n         run: npm ci\n         env:\n-          PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: 'true'\n+          PUPPETEER_SKIP_CHROMIUM_DOWNLOAD: \"true\"\n \n       - name: Test code\n-        uses: mujo-code/puppeteer-headful@master\n+        uses: mymindstorm/puppeteer-headful@8f745c770f7f4c0f9f332d7c43a775f90e53779a\n         with:\n           args: npm test"
            },
            {
                "sha": "51cd480ee3262a125928db55d08e600e99d756ca",
                "filename": "package-lock.json",
                "status": "modified",
                "additions": 786,
                "deletions": 1157,
                "changes": 1943,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/package-lock.json",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/package-lock.json",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/package-lock.json?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -15,8 +15,7 @@\n         \"node-gost-crypto\": \"^1.0.2\",\n         \"qrcode-generator\": \"^1.4.4\",\n         \"qrcode-reader\": \"^1.0.4\",\n-        \"uuid\": \"^3.4.0\",\n-        \"vue\": \"^2.6.12\",\n+        \"vue\": \"^2.7.16\",\n         \"vue2-dragula\": \"^2.5.4\",\n         \"vuex\": \"^3.4.0\"\n       },\n@@ -29,16 +28,14 @@\n         \"@types/sinon\": \"^17.0.2\",\n         \"@types/sinon-chai\": \"^3.2.12\",\n         \"@types/sinon-chrome\": \"^2.2.10\",\n-        \"@types/uuid\": \"^3.4.9\",\n-        \"@typescript-eslint/eslint-plugin\": \"^2.34.0\",\n-        \"@typescript-eslint/parser\": \"^2.34.0\",\n-        \"@vue/runtime-dom\": \"^3.2.47\",\n+        \"@typescript-eslint/eslint-plugin\": \"^7.15.0\",\n+        \"@typescript-eslint/parser\": \"^7.15.0\",\n         \"@vue/test-utils\": \"^1.1.1\",\n         \"base64-loader\": \"^1.0.0\",\n         \"buffer\": \"^6.0.3\",\n         \"chai\": \"^4.2.0\",\n         \"crypto-js\": \"^4.1.1\",\n-        \"eslint\": \"^6.8.0\",\n+        \"eslint\": \"^8.56.0\",\n         \"fork-ts-checker-webpack-plugin\": \"^6.5.3\",\n         \"lodash\": \"^4.17.21\",\n         \"mocha\": \"^10.2.0\",\n@@ -58,7 +55,7 @@\n         \"util\": \"^0.12.5\",\n         \"vue-loader\": \"^15.10.1\",\n         \"vue-svg-loader\": \"^0.16.0\",\n-        \"vue-template-compiler\": \"^2.7.0\",\n+        \"vue-template-compiler\": \"^2.7.16\",\n         \"webpack\": \"^5.11.0\",\n         \"webpack-cli\": \"^5.0.0\",\n         \"webpack-merge\": \"^5.0.0\"\n@@ -417,6 +414,115 @@\n         \"node\": \">=10.0.0\"\n       }\n     },\n+    \"node_modules/@eslint-community/eslint-utils\": {\n+      \"version\": \"4.4.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@eslint-community/eslint-utils/-/eslint-utils-4.4.0.tgz\",\n+      \"integrity\": \"sha512-1/sA4dwrzBAyeUoQ6oxahHKmrZvsnLCg4RfxW3ZFGGmQkSNQPFNLV9CUEFQP1x9EYXHTo5p6xdhZM1Ne9p/AfA==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"eslint-visitor-keys\": \"^3.3.0\"\n+      },\n+      \"engines\": {\n+        \"node\": \"^12.22.0 || ^14.17.0 || >=16.0.0\"\n+      },\n+      \"peerDependencies\": {\n+        \"eslint\": \"^6.0.0 || ^7.0.0 || >=8.0.0\"\n+      }\n+    },\n+    \"node_modules/@eslint-community/regexpp\": {\n+      \"version\": \"4.11.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@eslint-community/regexpp/-/regexpp-4.11.0.tgz\",\n+      \"integrity\": \"sha512-G/M/tIiMrTAxEWRfLfQJMmGNX28IxBg4PBz8XqQhqUHLFI6TL2htpIB1iQCj144V5ee/JaKyT9/WZ0MGZWfA7A==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \"^12.0.0 || ^14.0.0 || >=16.0.0\"\n+      }\n+    },\n+    \"node_modules/@eslint/eslintrc\": {\n+      \"version\": \"2.1.4\",\n+      \"resolved\": \"https://registry.npmjs.org/@eslint/eslintrc/-/eslintrc-2.1.4.tgz\",\n+      \"integrity\": \"sha512-269Z39MS6wVJtsoUl10L60WdkhJVdPG24Q4eZTH3nnF6lpvSShEK3wQjDX9JRWAUPvPh7COouPpU9IrqaZFvtQ==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"ajv\": \"^6.12.4\",\n+        \"debug\": \"^4.3.2\",\n+        \"espree\": \"^9.6.0\",\n+        \"globals\": \"^13.19.0\",\n+        \"ignore\": \"^5.2.0\",\n+        \"import-fresh\": \"^3.2.1\",\n+        \"js-yaml\": \"^4.1.0\",\n+        \"minimatch\": \"^3.1.2\",\n+        \"strip-json-comments\": \"^3.1.1\"\n+      },\n+      \"engines\": {\n+        \"node\": \"^12.22.0 || ^14.17.0 || >=16.0.0\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://opencollective.com/eslint\"\n+      }\n+    },\n+    \"node_modules/@eslint/eslintrc/node_modules/argparse\": {\n+      \"version\": \"2.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/argparse/-/argparse-2.0.1.tgz\",\n+      \"integrity\": \"sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==\",\n+      \"dev\": true\n+    },\n+    \"node_modules/@eslint/eslintrc/node_modules/js-yaml\": {\n+      \"version\": \"4.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/js-yaml/-/js-yaml-4.1.0.tgz\",\n+      \"integrity\": \"sha512-wpxZs9NoxZaJESJGIZTyDEaYpl0FKSA+FB9aJiyemKhMwkxQg63h4T1KJgUGHpTqPDNRcmmYLugrRjJlBtWvRA==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"argparse\": \"^2.0.1\"\n+      },\n+      \"bin\": {\n+        \"js-yaml\": \"bin/js-yaml.js\"\n+      }\n+    },\n+    \"node_modules/@eslint/js\": {\n+      \"version\": \"8.57.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@eslint/js/-/js-8.57.0.tgz\",\n+      \"integrity\": \"sha512-Ys+3g2TaW7gADOJzPt83SJtCDhMjndcDMFVQ/Tj9iA1BfJzFKD9mAUXT3OenpuPHbI6P/myECxRJrofUsDx/5g==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \"^12.22.0 || ^14.17.0 || >=16.0.0\"\n+      }\n+    },\n+    \"node_modules/@humanwhocodes/config-array\": {\n+      \"version\": \"0.11.14\",\n+      \"resolved\": \"https://registry.npmjs.org/@humanwhocodes/config-array/-/config-array-0.11.14.tgz\",\n+      \"integrity\": \"sha512-3T8LkOmg45BV5FICb15QQMsyUSWrQ8AygVfC7ZG32zOalnqrilm018ZVCw0eapXux8FtA33q8PSRSstjee3jSg==\",\n+      \"deprecated\": \"Use @eslint/config-array instead\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@humanwhocodes/object-schema\": \"^2.0.2\",\n+        \"debug\": \"^4.3.1\",\n+        \"minimatch\": \"^3.0.5\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=10.10.0\"\n+      }\n+    },\n+    \"node_modules/@humanwhocodes/module-importer\": {\n+      \"version\": \"1.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/@humanwhocodes/module-importer/-/module-importer-1.0.1.tgz\",\n+      \"integrity\": \"sha512-bxveV4V8v5Yb4ncFTT3rPSgZBOpCkjfK0y4oVVVJwIuDVBRMDXrPyXRL988i5ap9m9bnyEEjWfm5WkBmtffLfA==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">=12.22\"\n+      },\n+      \"funding\": {\n+        \"type\": \"github\",\n+        \"url\": \"https://github.com/sponsors/nzakas\"\n+      }\n+    },\n+    \"node_modules/@humanwhocodes/object-schema\": {\n+      \"version\": \"2.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/@humanwhocodes/object-schema/-/object-schema-2.0.3.tgz\",\n+      \"integrity\": \"sha512-93zYdMES/c1D69yZiKDBj0V24vqNzB/koF26KPaagAfd3P/4gUlh3Dys5ogAK+Exi9QyzlD8x/08Zt7wIKcDcA==\",\n+      \"deprecated\": \"Use @eslint/object-schema instead\",\n+      \"dev\": true\n+    },\n     \"node_modules/@istanbuljs/load-nyc-config\": {\n       \"version\": \"1.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/@istanbuljs/load-nyc-config/-/load-nyc-config-1.1.0.tgz\",\n@@ -574,6 +680,41 @@\n         \"@jridgewell/sourcemap-codec\": \"1.4.14\"\n       }\n     },\n+    \"node_modules/@nodelib/fs.scandir\": {\n+      \"version\": \"2.1.5\",\n+      \"resolved\": \"https://registry.npmjs.org/@nodelib/fs.scandir/-/fs.scandir-2.1.5.tgz\",\n+      \"integrity\": \"sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@nodelib/fs.stat\": \"2.0.5\",\n+        \"run-parallel\": \"^1.1.9\"\n+      },\n+      \"engines\": {\n+        \"node\": \">= 8\"\n+      }\n+    },\n+    \"node_modules/@nodelib/fs.stat\": {\n+      \"version\": \"2.0.5\",\n+      \"resolved\": \"https://registry.npmjs.org/@nodelib/fs.stat/-/fs.stat-2.0.5.tgz\",\n+      \"integrity\": \"sha512-RkhPPp2zrqDAQA/2jNhnztcPAlv64XdhIp7a7454A5ovI7Bukxgt7MX7udwAu3zg1DcpPU0rz3VV1SeaqvY4+A==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">= 8\"\n+      }\n+    },\n+    \"node_modules/@nodelib/fs.walk\": {\n+      \"version\": \"1.2.8\",\n+      \"resolved\": \"https://registry.npmjs.org/@nodelib/fs.walk/-/fs.walk-1.2.8.tgz\",\n+      \"integrity\": \"sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@nodelib/fs.scandir\": \"2.1.5\",\n+        \"fastq\": \"^1.6.0\"\n+      },\n+      \"engines\": {\n+        \"node\": \">= 8\"\n+      }\n+    },\n     \"node_modules/@puppeteer/browsers\": {\n       \"version\": \"2.2.3\",\n       \"resolved\": \"https://registry.npmjs.org/@puppeteer/browsers/-/browsers-2.2.3.tgz\",\n@@ -596,15 +737,6 @@\n         \"node\": \">=18\"\n       }\n     },\n-    \"node_modules/@puppeteer/browsers/node_modules/ansi-regex\": {\n-      \"version\": \"5.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz\",\n-      \"integrity\": \"sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/@puppeteer/browsers/node_modules/cliui\": {\n       \"version\": \"8.0.1\",\n       \"resolved\": \"https://registry.npmjs.org/cliui/-/cliui-8.0.1.tgz\",\n@@ -619,18 +751,6 @@\n         \"node\": \">=12\"\n       }\n     },\n-    \"node_modules/@puppeteer/browsers/node_modules/strip-ansi\": {\n-      \"version\": \"6.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz\",\n-      \"integrity\": \"sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-regex\": \"^5.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/@puppeteer/browsers/node_modules/yargs\": {\n       \"version\": \"17.7.2\",\n       \"resolved\": \"https://registry.npmjs.org/yargs/-/yargs-17.7.2.tgz\",\n@@ -786,12 +906,6 @@\n         \"@types/estree\": \"*\"\n       }\n     },\n-    \"node_modules/@types/eslint-visitor-keys\": {\n-      \"version\": \"1.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/@types/eslint-visitor-keys/-/eslint-visitor-keys-1.0.0.tgz\",\n-      \"integrity\": \"sha512-OCutwjDZ4aFS6PB1UZ988C4YgwlBHJd6wCeQqaLdmadZ/7e+w79+hbMUFC1QXDNCmdyoRfAFdm0RypzwR+Qpag==\",\n-      \"dev\": true\n-    },\n     \"node_modules/@types/estree\": {\n       \"version\": \"0.0.51\",\n       \"resolved\": \"https://registry.npmjs.org/@types/estree/-/estree-0.0.51.tgz\",\n@@ -889,12 +1003,6 @@\n       \"integrity\": \"sha512-9GcLXF0/v3t80caGs5p2rRfkB+a8VBGLJZVih6CNFkx8IZ994wiKKLSRs9nuFwk1HevWs/1mnUmkApGrSGsShA==\",\n       \"dev\": true\n     },\n-    \"node_modules/@types/uuid\": {\n-      \"version\": \"3.4.10\",\n-      \"resolved\": \"https://registry.npmjs.org/@types/uuid/-/uuid-3.4.10.tgz\",\n-      \"integrity\": \"sha512-BgeaZuElf7DEYZhWYDTc/XcLZXdVgFkVSTa13BqKvbnmUrxr3TJFKofUxCtDO9UQOdhnV+HPOESdHiHKZOJV1A==\",\n-      \"dev\": true\n-    },\n     \"node_modules/@types/yauzl\": {\n       \"version\": \"2.10.3\",\n       \"resolved\": \"https://registry.npmjs.org/@types/yauzl/-/yauzl-2.10.3.tgz\",\n@@ -906,98 +1014,140 @@\n       }\n     },\n     \"node_modules/@typescript-eslint/eslint-plugin\": {\n-      \"version\": \"2.34.0\",\n-      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/eslint-plugin/-/eslint-plugin-2.34.0.tgz\",\n-      \"integrity\": \"sha512-4zY3Z88rEE99+CNvTbXSyovv2z9PNOVffTWD2W8QF5s2prBQtwN2zadqERcrHpcR7O/+KMI3fcTAmUUhK/iQcQ==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"@typescript-eslint/experimental-utils\": \"2.34.0\",\n-        \"functional-red-black-tree\": \"^1.0.1\",\n-        \"regexpp\": \"^3.0.0\",\n-        \"tsutils\": \"^3.17.1\"\n+      \"version\": \"7.15.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/eslint-plugin/-/eslint-plugin-7.15.0.tgz\",\n+      \"integrity\": \"sha512-uiNHpyjZtFrLwLDpHnzaDlP3Tt6sGMqTCiqmxaN4n4RP0EfYZDODJyddiFDF44Hjwxr5xAcaYxVKm9QKQFJFLA==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@eslint-community/regexpp\": \"^4.10.0\",\n+        \"@typescript-eslint/scope-manager\": \"7.15.0\",\n+        \"@typescript-eslint/type-utils\": \"7.15.0\",\n+        \"@typescript-eslint/utils\": \"7.15.0\",\n+        \"@typescript-eslint/visitor-keys\": \"7.15.0\",\n+        \"graphemer\": \"^1.4.0\",\n+        \"ignore\": \"^5.3.1\",\n+        \"natural-compare\": \"^1.4.0\",\n+        \"ts-api-utils\": \"^1.3.0\"\n       },\n       \"engines\": {\n-        \"node\": \"^8.10.0 || ^10.13.0 || >=11.10.1\"\n+        \"node\": \"^18.18.0 || >=20.0.0\"\n       },\n       \"funding\": {\n         \"type\": \"opencollective\",\n         \"url\": \"https://opencollective.com/typescript-eslint\"\n       },\n       \"peerDependencies\": {\n-        \"@typescript-eslint/parser\": \"^2.0.0\",\n-        \"eslint\": \"^5.0.0 || ^6.0.0\"\n+        \"@typescript-eslint/parser\": \"^7.0.0\",\n+        \"eslint\": \"^8.56.0\"\n       },\n       \"peerDependenciesMeta\": {\n         \"typescript\": {\n           \"optional\": true\n         }\n       }\n     },\n-    \"node_modules/@typescript-eslint/experimental-utils\": {\n-      \"version\": \"2.34.0\",\n-      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/experimental-utils/-/experimental-utils-2.34.0.tgz\",\n-      \"integrity\": \"sha512-eS6FTkq+wuMJ+sgtuNTtcqavWXqsflWcfBnlYhg/nS4aZ1leewkXGbvBhaapn1q6qf4M71bsR1tez5JTRMuqwA==\",\n+    \"node_modules/@typescript-eslint/parser\": {\n+      \"version\": \"7.15.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/parser/-/parser-7.15.0.tgz\",\n+      \"integrity\": \"sha512-k9fYuQNnypLFcqORNClRykkGOMOj+pV6V91R4GO/l1FDGwpqmSwoOQrOHo3cGaH63e+D3ZiCAOsuS/D2c99j/A==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"@types/json-schema\": \"^7.0.3\",\n-        \"@typescript-eslint/typescript-estree\": \"2.34.0\",\n-        \"eslint-scope\": \"^5.0.0\",\n-        \"eslint-utils\": \"^2.0.0\"\n+        \"@typescript-eslint/scope-manager\": \"7.15.0\",\n+        \"@typescript-eslint/types\": \"7.15.0\",\n+        \"@typescript-eslint/typescript-estree\": \"7.15.0\",\n+        \"@typescript-eslint/visitor-keys\": \"7.15.0\",\n+        \"debug\": \"^4.3.4\"\n       },\n       \"engines\": {\n-        \"node\": \"^8.10.0 || ^10.13.0 || >=11.10.1\"\n+        \"node\": \"^18.18.0 || >=20.0.0\"\n       },\n       \"funding\": {\n         \"type\": \"opencollective\",\n         \"url\": \"https://opencollective.com/typescript-eslint\"\n       },\n       \"peerDependencies\": {\n-        \"eslint\": \"*\"\n+        \"eslint\": \"^8.56.0\"\n+      },\n+      \"peerDependenciesMeta\": {\n+        \"typescript\": {\n+          \"optional\": true\n+        }\n       }\n     },\n-    \"node_modules/@typescript-eslint/parser\": {\n-      \"version\": \"2.34.0\",\n-      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/parser/-/parser-2.34.0.tgz\",\n-      \"integrity\": \"sha512-03ilO0ucSD0EPTw2X4PntSIRFtDPWjrVq7C3/Z3VQHRC7+13YB55rcJI3Jt+YgeHbjUdJPcPa7b23rXCBokuyA==\",\n+    \"node_modules/@typescript-eslint/scope-manager\": {\n+      \"version\": \"7.15.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/scope-manager/-/scope-manager-7.15.0.tgz\",\n+      \"integrity\": \"sha512-Q/1yrF/XbxOTvttNVPihxh1b9fxamjEoz2Os/Pe38OHwxC24CyCqXxGTOdpb4lt6HYtqw9HetA/Rf6gDGaMPlw==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@typescript-eslint/types\": \"7.15.0\",\n+        \"@typescript-eslint/visitor-keys\": \"7.15.0\"\n+      },\n+      \"engines\": {\n+        \"node\": \"^18.18.0 || >=20.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/typescript-eslint\"\n+      }\n+    },\n+    \"node_modules/@typescript-eslint/type-utils\": {\n+      \"version\": \"7.15.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/type-utils/-/type-utils-7.15.0.tgz\",\n+      \"integrity\": \"sha512-SkgriaeV6PDvpA6253PDVep0qCqgbO1IOBiycjnXsszNTVQe5flN5wR5jiczoEoDEnAqYFSFFc9al9BSGVltkg==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"@types/eslint-visitor-keys\": \"^1.0.0\",\n-        \"@typescript-eslint/experimental-utils\": \"2.34.0\",\n-        \"@typescript-eslint/typescript-estree\": \"2.34.0\",\n-        \"eslint-visitor-keys\": \"^1.1.0\"\n+        \"@typescript-eslint/typescript-estree\": \"7.15.0\",\n+        \"@typescript-eslint/utils\": \"7.15.0\",\n+        \"debug\": \"^4.3.4\",\n+        \"ts-api-utils\": \"^1.3.0\"\n       },\n       \"engines\": {\n-        \"node\": \"^8.10.0 || ^10.13.0 || >=11.10.1\"\n+        \"node\": \"^18.18.0 || >=20.0.0\"\n       },\n       \"funding\": {\n         \"type\": \"opencollective\",\n         \"url\": \"https://opencollective.com/typescript-eslint\"\n       },\n       \"peerDependencies\": {\n-        \"eslint\": \"^5.0.0 || ^6.0.0\"\n+        \"eslint\": \"^8.56.0\"\n       },\n       \"peerDependenciesMeta\": {\n         \"typescript\": {\n           \"optional\": true\n         }\n       }\n     },\n+    \"node_modules/@typescript-eslint/types\": {\n+      \"version\": \"7.15.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/types/-/types-7.15.0.tgz\",\n+      \"integrity\": \"sha512-aV1+B1+ySXbQH0pLK0rx66I3IkiZNidYobyfn0WFsdGhSXw+P3YOqeTq5GED458SfB24tg+ux3S+9g118hjlTw==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \"^18.18.0 || >=20.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/typescript-eslint\"\n+      }\n+    },\n     \"node_modules/@typescript-eslint/typescript-estree\": {\n-      \"version\": \"2.34.0\",\n-      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/typescript-estree/-/typescript-estree-2.34.0.tgz\",\n-      \"integrity\": \"sha512-OMAr+nJWKdlVM9LOqCqh3pQQPwxHAN7Du8DR6dmwCrAmxtiXQnhHJ6tBNtf+cggqfo51SG/FCwnKhXCIM7hnVg==\",\n+      \"version\": \"7.15.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/typescript-estree/-/typescript-estree-7.15.0.tgz\",\n+      \"integrity\": \"sha512-gjyB/rHAopL/XxfmYThQbXbzRMGhZzGw6KpcMbfe8Q3nNQKStpxnUKeXb0KiN/fFDR42Z43szs6rY7eHk0zdGQ==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"debug\": \"^4.1.1\",\n-        \"eslint-visitor-keys\": \"^1.1.0\",\n-        \"glob\": \"^7.1.6\",\n-        \"is-glob\": \"^4.0.1\",\n-        \"lodash\": \"^4.17.15\",\n-        \"semver\": \"^7.3.2\",\n-        \"tsutils\": \"^3.17.1\"\n+        \"@typescript-eslint/types\": \"7.15.0\",\n+        \"@typescript-eslint/visitor-keys\": \"7.15.0\",\n+        \"debug\": \"^4.3.4\",\n+        \"globby\": \"^11.1.0\",\n+        \"is-glob\": \"^4.0.3\",\n+        \"minimatch\": \"^9.0.4\",\n+        \"semver\": \"^7.6.0\",\n+        \"ts-api-utils\": \"^1.3.0\"\n       },\n       \"engines\": {\n-        \"node\": \"^8.10.0 || ^10.13.0 || >=11.10.1\"\n+        \"node\": \"^18.18.0 || >=20.0.0\"\n       },\n       \"funding\": {\n         \"type\": \"opencollective\",\n@@ -1009,14 +1159,86 @@\n         }\n       }\n     },\n+    \"node_modules/@typescript-eslint/typescript-estree/node_modules/brace-expansion\": {\n+      \"version\": \"2.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/brace-expansion/-/brace-expansion-2.0.1.tgz\",\n+      \"integrity\": \"sha512-XnAIvQ8eM+kC6aULx6wuQiwVsnzsi9d3WxzV3FpWTGA19F621kwdbsAcFKXgKUHZWsy+mY6iL1sHTxWEFCytDA==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"balanced-match\": \"^1.0.0\"\n+      }\n+    },\n+    \"node_modules/@typescript-eslint/typescript-estree/node_modules/minimatch\": {\n+      \"version\": \"9.0.5\",\n+      \"resolved\": \"https://registry.npmjs.org/minimatch/-/minimatch-9.0.5.tgz\",\n+      \"integrity\": \"sha512-G6T0ZX48xgozx7587koeX9Ys2NYy6Gmv//P89sEte9V9whIapMNF4idKxnW2QtCcLiTWlb/wfCabAtAFWhhBow==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"brace-expansion\": \"^2.0.1\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=16 || 14 >=14.17\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://github.com/sponsors/isaacs\"\n+      }\n+    },\n+    \"node_modules/@typescript-eslint/utils\": {\n+      \"version\": \"7.15.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/utils/-/utils-7.15.0.tgz\",\n+      \"integrity\": \"sha512-hfDMDqaqOqsUVGiEPSMLR/AjTSCsmJwjpKkYQRo1FNbmW4tBwBspYDwO9eh7sKSTwMQgBw9/T4DHudPaqshRWA==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@eslint-community/eslint-utils\": \"^4.4.0\",\n+        \"@typescript-eslint/scope-manager\": \"7.15.0\",\n+        \"@typescript-eslint/types\": \"7.15.0\",\n+        \"@typescript-eslint/typescript-estree\": \"7.15.0\"\n+      },\n+      \"engines\": {\n+        \"node\": \"^18.18.0 || >=20.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/typescript-eslint\"\n+      },\n+      \"peerDependencies\": {\n+        \"eslint\": \"^8.56.0\"\n+      }\n+    },\n+    \"node_modules/@typescript-eslint/visitor-keys\": {\n+      \"version\": \"7.15.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@typescript-eslint/visitor-keys/-/visitor-keys-7.15.0.tgz\",\n+      \"integrity\": \"sha512-Hqgy/ETgpt2L5xueA/zHHIl4fJI2O4XUE9l4+OIfbJIRSnTJb/QscncdqqZzofQegIJugRIF57OJea1khw2SDw==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@typescript-eslint/types\": \"7.15.0\",\n+        \"eslint-visitor-keys\": \"^3.4.3\"\n+      },\n+      \"engines\": {\n+        \"node\": \"^18.18.0 || >=20.0.0\"\n+      },\n+      \"funding\": {\n+        \"type\": \"opencollective\",\n+        \"url\": \"https://opencollective.com/typescript-eslint\"\n+      }\n+    },\n+    \"node_modules/@ungap/structured-clone\": {\n+      \"version\": \"1.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/@ungap/structured-clone/-/structured-clone-1.2.0.tgz\",\n+      \"integrity\": \"sha512-zuVdFrMJiuCDQUMCzQaD6KL28MjnqqN8XnAqiEq9PNm/hCPTSGfrXCOfwj1ow4LFb/tNymJPwsNbVePc1xFqrQ==\",\n+      \"dev\": true\n+    },\n     \"node_modules/@vue/compiler-sfc\": {\n-      \"version\": \"2.7.14\",\n-      \"resolved\": \"https://registry.npmjs.org/@vue/compiler-sfc/-/compiler-sfc-2.7.14.tgz\",\n-      \"integrity\": \"sha512-aNmNHyLPsw+sVvlQFQ2/8sjNuLtK54TC6cuKnVzAY93ks4ZBrvwQSnkkIh7bsbNhum5hJBS00wSDipQ937f5DA==\",\n+      \"version\": \"2.7.16\",\n+      \"resolved\": \"https://registry.npmjs.org/@vue/compiler-sfc/-/compiler-sfc-2.7.16.tgz\",\n+      \"integrity\": \"sha512-KWhJ9k5nXuNtygPU7+t1rX6baZeqOYLEforUPjgNDBnLicfHCoi48H87Q8XyLZOrNNsmhuwKqtpDQWjEFe6Ekg==\",\n       \"dependencies\": {\n-        \"@babel/parser\": \"^7.18.4\",\n+        \"@babel/parser\": \"^7.23.5\",\n         \"postcss\": \"^8.4.14\",\n         \"source-map\": \"^0.6.1\"\n+      },\n+      \"optionalDependencies\": {\n+        \"prettier\": \"^1.18.2 || ^2.0.0\"\n       }\n     },\n     \"node_modules/@vue/component-compiler-utils\": {\n@@ -1077,48 +1299,6 @@\n       \"integrity\": \"sha512-ncTzHV7NvsQZkYe1DW7cbDLm0YpzHmZF5r/iyP3ZnQtMiJ+pjzisCiMNI+Sj+xQF5pXhSHxSB3uDbsBTzY/c2A==\",\n       \"dev\": true\n     },\n-    \"node_modules/@vue/reactivity\": {\n-      \"version\": \"3.2.47\",\n-      \"resolved\": \"https://registry.npmjs.org/@vue/reactivity/-/reactivity-3.2.47.tgz\",\n-      \"integrity\": \"sha512-7khqQ/75oyyg+N/e+iwV6lpy1f5wq759NdlS1fpAhFXa8VeAIKGgk2E/C4VF59lx5b+Ezs5fpp/5WsRYXQiKxQ==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"@vue/shared\": \"3.2.47\"\n-      }\n-    },\n-    \"node_modules/@vue/runtime-core\": {\n-      \"version\": \"3.2.47\",\n-      \"resolved\": \"https://registry.npmjs.org/@vue/runtime-core/-/runtime-core-3.2.47.tgz\",\n-      \"integrity\": \"sha512-RZxbLQIRB/K0ev0K9FXhNbBzT32H9iRtYbaXb0ZIz2usLms/D55dJR2t6cIEUn6vyhS3ALNvNthI+Q95C+NOpA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"@vue/reactivity\": \"3.2.47\",\n-        \"@vue/shared\": \"3.2.47\"\n-      }\n-    },\n-    \"node_modules/@vue/runtime-dom\": {\n-      \"version\": \"3.2.47\",\n-      \"resolved\": \"https://registry.npmjs.org/@vue/runtime-dom/-/runtime-dom-3.2.47.tgz\",\n-      \"integrity\": \"sha512-ArXrFTjS6TsDei4qwNvgrdmHtD930KgSKGhS5M+j8QxXrDJYLqYw4RRcDy1bz1m1wMmb6j+zGLifdVHtkXA7gA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"@vue/runtime-core\": \"3.2.47\",\n-        \"@vue/shared\": \"3.2.47\",\n-        \"csstype\": \"^2.6.8\"\n-      }\n-    },\n-    \"node_modules/@vue/runtime-dom/node_modules/csstype\": {\n-      \"version\": \"2.6.21\",\n-      \"resolved\": \"https://registry.npmjs.org/csstype/-/csstype-2.6.21.tgz\",\n-      \"integrity\": \"sha512-Z1PhmomIfypOpoMjRQB70jfvy/wxT50qW08YXO5lMIJkrdq4yOTR+AW7FqutScmB9NkLwxo+jU+kZLbofZZq/w==\",\n-      \"dev\": true\n-    },\n-    \"node_modules/@vue/shared\": {\n-      \"version\": \"3.2.47\",\n-      \"resolved\": \"https://registry.npmjs.org/@vue/shared/-/shared-3.2.47.tgz\",\n-      \"integrity\": \"sha512-BHGyyGN3Q97EZx0taMQ+OLNuZcW3d37ZEVmEAyeoA9ERdGvm9Irc/0Fua8SNyOtV1w6BS4q25wbMzJujO9HIfQ==\",\n-      \"dev\": true\n-    },\n     \"node_modules/@vue/test-utils\": {\n       \"version\": \"1.3.4\",\n       \"resolved\": \"https://registry.npmjs.org/@vue/test-utils/-/test-utils-1.3.4.tgz\",\n@@ -1343,9 +1523,9 @@\n       \"dev\": true\n     },\n     \"node_modules/acorn\": {\n-      \"version\": \"7.4.1\",\n-      \"resolved\": \"https://registry.npmjs.org/acorn/-/acorn-7.4.1.tgz\",\n-      \"integrity\": \"sha512-nQyp0o1/mNdbTO1PO6kHkwSrmgZ0MT/jCCpNiwbUjGoRN4dlBhqJtoQuCnEOKzgTVwg0ZWiCoQy6SxMebQVh8A==\",\n+      \"version\": \"8.12.1\",\n+      \"resolved\": \"https://registry.npmjs.org/acorn/-/acorn-8.12.1.tgz\",\n+      \"integrity\": \"sha512-tcpGyI9zbizT9JbV6oYE477V6mTlXvvi0T0G3SNIYE2apm/G5huBa1+K89VGeovbg+jycCrfhl3ADxErOuO6Jg==\",\n       \"dev\": true,\n       \"bin\": {\n         \"acorn\": \"bin/acorn\"\n@@ -1422,40 +1602,13 @@\n         \"node\": \">=6\"\n       }\n     },\n-    \"node_modules/ansi-escapes\": {\n-      \"version\": \"4.3.2\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-escapes/-/ansi-escapes-4.3.2.tgz\",\n-      \"integrity\": \"sha512-gKXj5ALrKWQLsYG9jlTRmR/xKluxHV+Z9QEwNIgCfM1/uwPMCuzVVnh5mwTd+OuBZcwSIMbqssNWRm1lE51QaQ==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"type-fest\": \"^0.21.3\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n-    \"node_modules/ansi-escapes/node_modules/type-fest\": {\n-      \"version\": \"0.21.3\",\n-      \"resolved\": \"https://registry.npmjs.org/type-fest/-/type-fest-0.21.3.tgz\",\n-      \"integrity\": \"sha512-t0rzBq87m3fVcduHDUFhKmyyX+9eo6WQjZvf51Ea/M0Q7+T374Jp1aUiyUl0GKxp8M/OETVHSDvmkyPgvX+X2w==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=10\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n     \"node_modules/ansi-regex\": {\n-      \"version\": \"4.1.1\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-regex/-/ansi-regex-4.1.1.tgz\",\n-      \"integrity\": \"sha512-ILlv4k/3f6vfQ4OoP2AGvirOktlQ98ZEL1k9FaQjxa3L1abBgbuTDAdPOpvbGncC0BTVQrl+OM8xZGK6tWXt7g==\",\n+      \"version\": \"5.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz\",\n+      \"integrity\": \"sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==\",\n       \"dev\": true,\n       \"engines\": {\n-        \"node\": \">=6\"\n+        \"node\": \">=8\"\n       }\n     },\n     \"node_modules/ansi-styles\": {\n@@ -1534,6 +1687,15 @@\n       \"integrity\": \"sha512-GQTc6Uupx1FCavi5mPzBvVT7nEOeWMmUA9P95wpfpW1XwMSKs+KaymD5C2Up7KAUKg/mYwbsUYzdZWcoajlNZg==\",\n       \"dev\": true\n     },\n+    \"node_modules/array-union\": {\n+      \"version\": \"2.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/array-union/-/array-union-2.1.0.tgz\",\n+      \"integrity\": \"sha512-HGyxoOTYUyCM6stUe6EJgnd4EoewAI7zMdfqO+kGjnlZmBDz/cR5pf8r/cR4Wq60sL/p0IkcjUEEPwS3GFrIyw==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">=8\"\n+      }\n+    },\n     \"node_modules/array.prototype.reduce\": {\n       \"version\": \"1.0.5\",\n       \"resolved\": \"https://registry.npmjs.org/array.prototype.reduce/-/array.prototype.reduce-1.0.5.tgz\",\n@@ -1580,15 +1742,6 @@\n       \"integrity\": \"sha512-xNvxJEOUiWPGhUuUdQgAJPKOOJfGnIyKySOc09XkKsgdUV/3E2zvwZYdejjmRgPCgcym1juLH3226yA7sEFJKQ==\",\n       \"dev\": true\n     },\n-    \"node_modules/astral-regex\": {\n-      \"version\": \"1.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/astral-regex/-/astral-regex-1.0.0.tgz\",\n-      \"integrity\": \"sha512-+Ryf6g3BKoRc7jfp7ad8tM4TtMiaWvbF/1/sQcZPkkS7ag3D5nMBCe2UfOTONtAkaG0tO0ij3C5Lwmf1EiyjHg==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=4\"\n-      }\n-    },\n     \"node_modules/asynckit\": {\n       \"version\": \"0.4.0\",\n       \"resolved\": \"https://registry.npmjs.org/asynckit/-/asynckit-0.4.0.tgz\",\n@@ -1943,12 +2096,6 @@\n         \"node\": \">=4\"\n       }\n     },\n-    \"node_modules/chardet\": {\n-      \"version\": \"0.7.0\",\n-      \"resolved\": \"https://registry.npmjs.org/chardet/-/chardet-0.7.0.tgz\",\n-      \"integrity\": \"sha512-mT8iDcrh03qDGRRmoA2hmBJnxpllMR+0/0qlzjqZES6NdiWDcZkCNAk4rPFZ9Q85r27unkiNNg8ZOiwZXBHwcA==\",\n-      \"dev\": true\n-    },\n     \"node_modules/check-error\": {\n       \"version\": \"1.0.2\",\n       \"resolved\": \"https://registry.npmjs.org/check-error/-/check-error-1.0.2.tgz\",\n@@ -2026,57 +2173,15 @@\n         \"node\": \">=6\"\n       }\n     },\n-    \"node_modules/cli-cursor\": {\n-      \"version\": \"3.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/cli-cursor/-/cli-cursor-3.1.0.tgz\",\n-      \"integrity\": \"sha512-I/zHAwsKf9FqGoXM4WWRACob9+SNukZTd94DWF57E4toouRulbCxcUh6RKUEOQlYTHJnzkPMySvPNaaSLNfLZw==\",\n+    \"node_modules/cliui\": {\n+      \"version\": \"7.0.4\",\n+      \"resolved\": \"https://registry.npmjs.org/cliui/-/cliui-7.0.4.tgz\",\n+      \"integrity\": \"sha512-OcRE68cOsVMXp1Yvonl/fzkQOyjLSu/8bhPDfQt0e0/Eb283TKP20Fs2MqoPsr9SwA595rRCA+QMzYc9nBP+JQ==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"restore-cursor\": \"^3.1.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/cli-width\": {\n-      \"version\": \"3.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/cli-width/-/cli-width-3.0.0.tgz\",\n-      \"integrity\": \"sha512-FxqpkPPwu1HjuN93Omfm4h8uIanXofW0RxVEW3k5RKx+mJJYSthzNhp32Kzxxy3YAEZ/Dc/EWN1vZRY0+kOhbw==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">= 10\"\n-      }\n-    },\n-    \"node_modules/cliui\": {\n-      \"version\": \"7.0.4\",\n-      \"resolved\": \"https://registry.npmjs.org/cliui/-/cliui-7.0.4.tgz\",\n-      \"integrity\": \"sha512-OcRE68cOsVMXp1Yvonl/fzkQOyjLSu/8bhPDfQt0e0/Eb283TKP20Fs2MqoPsr9SwA595rRCA+QMzYc9nBP+JQ==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"string-width\": \"^4.2.0\",\n-        \"strip-ansi\": \"^6.0.0\",\n-        \"wrap-ansi\": \"^7.0.0\"\n-      }\n-    },\n-    \"node_modules/cliui/node_modules/ansi-regex\": {\n-      \"version\": \"5.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz\",\n-      \"integrity\": \"sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/cliui/node_modules/strip-ansi\": {\n-      \"version\": \"6.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz\",\n-      \"integrity\": \"sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-regex\": \"^5.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n+        \"string-width\": \"^4.2.0\",\n+        \"strip-ansi\": \"^6.0.0\",\n+        \"wrap-ansi\": \"^7.0.0\"\n       }\n     },\n     \"node_modules/clone-deep\": {\n@@ -2247,28 +2352,17 @@\n       }\n     },\n     \"node_modules/cross-spawn\": {\n-      \"version\": \"6.0.5\",\n-      \"resolved\": \"https://registry.npmjs.org/cross-spawn/-/cross-spawn-6.0.5.tgz\",\n-      \"integrity\": \"sha512-eTVLrBSt7fjbDygz805pMnstIs2VTBNkRm0qxZd+M7A5XDdxVRWO5MxGBXZhjY4cqLYLdtrGqRf8mBPmzwSpWQ==\",\n+      \"version\": \"7.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.3.tgz\",\n+      \"integrity\": \"sha512-iRDPJKUPVEND7dHPO8rkbOnPpyDygcDFtWjpeWNCgy8WP2rXcxXL8TskReQl6OrB2G7+UJrags1q15Fudc7G6w==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"nice-try\": \"^1.0.4\",\n-        \"path-key\": \"^2.0.1\",\n-        \"semver\": \"^5.5.0\",\n-        \"shebang-command\": \"^1.2.0\",\n-        \"which\": \"^1.2.9\"\n+        \"path-key\": \"^3.1.0\",\n+        \"shebang-command\": \"^2.0.0\",\n+        \"which\": \"^2.0.1\"\n       },\n       \"engines\": {\n-        \"node\": \">=4.8\"\n-      }\n-    },\n-    \"node_modules/cross-spawn/node_modules/semver\": {\n-      \"version\": \"5.7.2\",\n-      \"resolved\": \"https://registry.npmjs.org/semver/-/semver-5.7.2.tgz\",\n-      \"integrity\": \"sha512-cBznnQ9KjJqU67B52RMC65CMarK2600WFnbkcaiwWq3xy/5haFJlshgnpjovMVJ+Hff49d8GEn0b87C5pDQ10g==\",\n-      \"dev\": true,\n-      \"bin\": {\n-        \"semver\": \"bin/semver\"\n+        \"node\": \">= 8\"\n       }\n     },\n     \"node_modules/crossvent\": {\n@@ -2545,6 +2639,18 @@\n         \"node\": \">=0.3.1\"\n       }\n     },\n+    \"node_modules/dir-glob\": {\n+      \"version\": \"3.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/dir-glob/-/dir-glob-3.0.1.tgz\",\n+      \"integrity\": \"sha512-WkrWp9GR4KXfKGYzOLmTuGVi1UWFfws377n9cc55/tb6DuqyF6pcQ5AbiHEshaDpY9v6oaSr2XCDidGmMwdzIA==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"path-type\": \"^4.0.0\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=8\"\n+      }\n+    },\n     \"node_modules/doctrine\": {\n       \"version\": \"3.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/doctrine/-/doctrine-3.0.0.tgz\",\n@@ -2878,54 +2984,55 @@\n       }\n     },\n     \"node_modules/eslint\": {\n-      \"version\": \"6.8.0\",\n-      \"resolved\": \"https://registry.npmjs.org/eslint/-/eslint-6.8.0.tgz\",\n-      \"integrity\": \"sha512-K+Iayyo2LtyYhDSYwz5D5QdWw0hCacNzyq1Y821Xna2xSJj7cijoLLYmLxTQgcgZ9mC61nryMy9S7GRbYpI5Ig==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"@babel/code-frame\": \"^7.0.0\",\n-        \"ajv\": \"^6.10.0\",\n-        \"chalk\": \"^2.1.0\",\n-        \"cross-spawn\": \"^6.0.5\",\n-        \"debug\": \"^4.0.1\",\n+      \"version\": \"8.57.0\",\n+      \"resolved\": \"https://registry.npmjs.org/eslint/-/eslint-8.57.0.tgz\",\n+      \"integrity\": \"sha512-dZ6+mexnaTIbSBZWgou51U6OmzIhYM2VcNdtiTtI7qPNZm35Akpr0f6vtw3w1Kmn5PYo+tZVfh13WrhpS6oLqQ==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@eslint-community/eslint-utils\": \"^4.2.0\",\n+        \"@eslint-community/regexpp\": \"^4.6.1\",\n+        \"@eslint/eslintrc\": \"^2.1.4\",\n+        \"@eslint/js\": \"8.57.0\",\n+        \"@humanwhocodes/config-array\": \"^0.11.14\",\n+        \"@humanwhocodes/module-importer\": \"^1.0.1\",\n+        \"@nodelib/fs.walk\": \"^1.2.8\",\n+        \"@ungap/structured-clone\": \"^1.2.0\",\n+        \"ajv\": \"^6.12.4\",\n+        \"chalk\": \"^4.0.0\",\n+        \"cross-spawn\": \"^7.0.2\",\n+        \"debug\": \"^4.3.2\",\n         \"doctrine\": \"^3.0.0\",\n-        \"eslint-scope\": \"^5.0.0\",\n-        \"eslint-utils\": \"^1.4.3\",\n-        \"eslint-visitor-keys\": \"^1.1.0\",\n-        \"espree\": \"^6.1.2\",\n-        \"esquery\": \"^1.0.1\",\n+        \"escape-string-regexp\": \"^4.0.0\",\n+        \"eslint-scope\": \"^7.2.2\",\n+        \"eslint-visitor-keys\": \"^3.4.3\",\n+        \"espree\": \"^9.6.1\",\n+        \"esquery\": \"^1.4.2\",\n         \"esutils\": \"^2.0.2\",\n-        \"file-entry-cache\": \"^5.0.1\",\n-        \"functional-red-black-tree\": \"^1.0.1\",\n-        \"glob-parent\": \"^5.0.0\",\n-        \"globals\": \"^12.1.0\",\n-        \"ignore\": \"^4.0.6\",\n-        \"import-fresh\": \"^3.0.0\",\n+        \"fast-deep-equal\": \"^3.1.3\",\n+        \"file-entry-cache\": \"^6.0.1\",\n+        \"find-up\": \"^5.0.0\",\n+        \"glob-parent\": \"^6.0.2\",\n+        \"globals\": \"^13.19.0\",\n+        \"graphemer\": \"^1.4.0\",\n+        \"ignore\": \"^5.2.0\",\n         \"imurmurhash\": \"^0.1.4\",\n-        \"inquirer\": \"^7.0.0\",\n         \"is-glob\": \"^4.0.0\",\n-        \"js-yaml\": \"^3.13.1\",\n+        \"is-path-inside\": \"^3.0.3\",\n+        \"js-yaml\": \"^4.1.0\",\n         \"json-stable-stringify-without-jsonify\": \"^1.0.1\",\n-        \"levn\": \"^0.3.0\",\n-        \"lodash\": \"^4.17.14\",\n-        \"minimatch\": \"^3.0.4\",\n-        \"mkdirp\": \"^0.5.1\",\n+        \"levn\": \"^0.4.1\",\n+        \"lodash.merge\": \"^4.6.2\",\n+        \"minimatch\": \"^3.1.2\",\n         \"natural-compare\": \"^1.4.0\",\n-        \"optionator\": \"^0.8.3\",\n-        \"progress\": \"^2.0.0\",\n-        \"regexpp\": \"^2.0.1\",\n-        \"semver\": \"^6.1.2\",\n-        \"strip-ansi\": \"^5.2.0\",\n-        \"strip-json-comments\": \"^3.0.1\",\n-        \"table\": \"^5.2.3\",\n-        \"text-table\": \"^0.2.0\",\n-        \"v8-compile-cache\": \"^2.0.3\"\n+        \"optionator\": \"^0.9.3\",\n+        \"strip-ansi\": \"^6.0.1\",\n+        \"text-table\": \"^0.2.0\"\n       },\n       \"bin\": {\n         \"eslint\": \"bin/eslint.js\"\n       },\n       \"engines\": {\n-        \"node\": \"^8.10.0 || ^10.13.0 || >=11.10.1\"\n+        \"node\": \"^12.22.0 || ^14.17.0 || >=16.0.0\"\n       },\n       \"funding\": {\n         \"url\": \"https://opencollective.com/eslint\"\n@@ -2944,72 +3051,170 @@\n         \"node\": \">=8.0.0\"\n       }\n     },\n-    \"node_modules/eslint-utils\": {\n-      \"version\": \"2.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/eslint-utils/-/eslint-utils-2.1.0.tgz\",\n-      \"integrity\": \"sha512-w94dQYoauyvlDc43XnGB8lU3Zt713vNChgt4EWwhXAP2XkBvndfxF0AgIqKOOasjPIPzj9JqgwkwbCYD0/V3Zg==\",\n+    \"node_modules/eslint-visitor-keys\": {\n+      \"version\": \"3.4.3\",\n+      \"resolved\": \"https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-3.4.3.tgz\",\n+      \"integrity\": \"sha512-wpc+LXeiyiisxPlEkUzU6svyS1frIO3Mgxj1fdy7Pm8Ygzguax2N3Fa/D/ag1WqbOprdI+uY6wMUl8/a2G+iag==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \"^12.22.0 || ^14.17.0 || >=16.0.0\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://opencollective.com/eslint\"\n+      }\n+    },\n+    \"node_modules/eslint/node_modules/ansi-styles\": {\n+      \"version\": \"4.3.0\",\n+      \"resolved\": \"https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz\",\n+      \"integrity\": \"sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"eslint-visitor-keys\": \"^1.1.0\"\n+        \"color-convert\": \"^2.0.1\"\n       },\n       \"engines\": {\n-        \"node\": \">=6\"\n+        \"node\": \">=8\"\n       },\n       \"funding\": {\n-        \"url\": \"https://github.com/sponsors/mysticatea\"\n+        \"url\": \"https://github.com/chalk/ansi-styles?sponsor=1\"\n       }\n     },\n-    \"node_modules/eslint-visitor-keys\": {\n-      \"version\": \"1.3.0\",\n-      \"resolved\": \"https://registry.npmjs.org/eslint-visitor-keys/-/eslint-visitor-keys-1.3.0.tgz\",\n-      \"integrity\": \"sha512-6J72N8UNa462wa/KFODt/PJ3IU60SDpC3QXC1Hjc1BXXpfL2C9R5+AU7jhe0F6GREqVMh4Juu+NY7xn+6dipUQ==\",\n+    \"node_modules/eslint/node_modules/argparse\": {\n+      \"version\": \"2.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/argparse/-/argparse-2.0.1.tgz\",\n+      \"integrity\": \"sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf/PXw1EjAZ+q2/bEBg3DvurK3Q==\",\n+      \"dev\": true\n+    },\n+    \"node_modules/eslint/node_modules/chalk\": {\n+      \"version\": \"4.1.2\",\n+      \"resolved\": \"https://registry.npmjs.org/chalk/-/chalk-4.1.2.tgz\",\n+      \"integrity\": \"sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==\",\n       \"dev\": true,\n+      \"dependencies\": {\n+        \"ansi-styles\": \"^4.1.0\",\n+        \"supports-color\": \"^7.1.0\"\n+      },\n       \"engines\": {\n-        \"node\": \">=4\"\n+        \"node\": \">=10\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://github.com/chalk/chalk?sponsor=1\"\n       }\n     },\n-    \"node_modules/eslint/node_modules/eslint-utils\": {\n-      \"version\": \"1.4.3\",\n-      \"resolved\": \"https://registry.npmjs.org/eslint-utils/-/eslint-utils-1.4.3.tgz\",\n-      \"integrity\": \"sha512-fbBN5W2xdY45KulGXmLHZ3c3FHfVYmKg0IrAKGOkT/464PQsx2UeIzfz1RmEci+KLm1bBaAzZAh8+/E+XAeZ8Q==\",\n+    \"node_modules/eslint/node_modules/color-convert\": {\n+      \"version\": \"2.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz\",\n+      \"integrity\": \"sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"color-name\": \"~1.1.4\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=7.0.0\"\n+      }\n+    },\n+    \"node_modules/eslint/node_modules/color-name\": {\n+      \"version\": \"1.1.4\",\n+      \"resolved\": \"https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz\",\n+      \"integrity\": \"sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==\",\n+      \"dev\": true\n+    },\n+    \"node_modules/eslint/node_modules/escape-string-regexp\": {\n+      \"version\": \"4.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-4.0.0.tgz\",\n+      \"integrity\": \"sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">=10\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://github.com/sponsors/sindresorhus\"\n+      }\n+    },\n+    \"node_modules/eslint/node_modules/eslint-scope\": {\n+      \"version\": \"7.2.2\",\n+      \"resolved\": \"https://registry.npmjs.org/eslint-scope/-/eslint-scope-7.2.2.tgz\",\n+      \"integrity\": \"sha512-dOt21O7lTMhDM+X9mB4GX+DZrZtCUJPL/wlcTqxyrx5IvO0IYtILdtrQGQp+8n5S0gwSVmOf9NQrjMOgfQZlIg==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"eslint-visitor-keys\": \"^1.1.0\"\n+        \"esrecurse\": \"^4.3.0\",\n+        \"estraverse\": \"^5.2.0\"\n       },\n       \"engines\": {\n-        \"node\": \">=6\"\n+        \"node\": \"^12.22.0 || ^14.17.0 || >=16.0.0\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://opencollective.com/eslint\"\n       }\n     },\n-    \"node_modules/eslint/node_modules/regexpp\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/regexpp/-/regexpp-2.0.1.tgz\",\n-      \"integrity\": \"sha512-lv0M6+TkDVniA3aD1Eg0DVpfU/booSu7Eev3TDO/mZKHBfVjgCGTV4t4buppESEYDtkArYFOxTJWv6S5C+iaNw==\",\n+    \"node_modules/eslint/node_modules/estraverse\": {\n+      \"version\": \"5.3.0\",\n+      \"resolved\": \"https://registry.npmjs.org/estraverse/-/estraverse-5.3.0.tgz\",\n+      \"integrity\": \"sha512-MMdARuVEQziNTeJD8DgMqmhwR11BRQ/cBP+pLtYdSTnf3MIO8fFeiINEbX36ZdNlfU/7A9f3gUw49B3oQsvwBA==\",\n       \"dev\": true,\n       \"engines\": {\n-        \"node\": \">=6.5.0\"\n+        \"node\": \">=4.0\"\n       }\n     },\n-    \"node_modules/eslint/node_modules/semver\": {\n-      \"version\": \"6.3.1\",\n-      \"resolved\": \"https://registry.npmjs.org/semver/-/semver-6.3.1.tgz\",\n-      \"integrity\": \"sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==\",\n+    \"node_modules/eslint/node_modules/glob-parent\": {\n+      \"version\": \"6.0.2\",\n+      \"resolved\": \"https://registry.npmjs.org/glob-parent/-/glob-parent-6.0.2.tgz\",\n+      \"integrity\": \"sha512-XxwI8EOhVQgWp6iDL+3b0r86f4d6AX6zSU55HfB4ydCEuXLXc5FcYeOu+nnGftS4TEju/11rt4KJPTMgbfmv4A==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"is-glob\": \"^4.0.3\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=10.13.0\"\n+      }\n+    },\n+    \"node_modules/eslint/node_modules/has-flag\": {\n+      \"version\": \"4.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/has-flag/-/has-flag-4.0.0.tgz\",\n+      \"integrity\": \"sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==\",\n       \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">=8\"\n+      }\n+    },\n+    \"node_modules/eslint/node_modules/js-yaml\": {\n+      \"version\": \"4.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/js-yaml/-/js-yaml-4.1.0.tgz\",\n+      \"integrity\": \"sha512-wpxZs9NoxZaJESJGIZTyDEaYpl0FKSA+FB9aJiyemKhMwkxQg63h4T1KJgUGHpTqPDNRcmmYLugrRjJlBtWvRA==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"argparse\": \"^2.0.1\"\n+      },\n       \"bin\": {\n-        \"semver\": \"bin/semver.js\"\n+        \"js-yaml\": \"bin/js-yaml.js\"\n+      }\n+    },\n+    \"node_modules/eslint/node_modules/supports-color\": {\n+      \"version\": \"7.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/supports-color/-/supports-color-7.2.0.tgz\",\n+      \"integrity\": \"sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"has-flag\": \"^4.0.0\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=8\"\n       }\n     },\n     \"node_modules/espree\": {\n-      \"version\": \"6.2.1\",\n-      \"resolved\": \"https://registry.npmjs.org/espree/-/espree-6.2.1.tgz\",\n-      \"integrity\": \"sha512-ysCxRQY3WaXJz9tdbWOwuWr5Y/XrPTGX9Kiz3yoUXwW0VZ4w30HTkQLaGx/+ttFjF8i+ACbArnB4ce68a9m5hw==\",\n+      \"version\": \"9.6.1\",\n+      \"resolved\": \"https://registry.npmjs.org/espree/-/espree-9.6.1.tgz\",\n+      \"integrity\": \"sha512-oruZaFkjorTpF32kDSI5/75ViwGeZginGGy2NoOSg3Q9bnwlnmDm4HLnkl0RE3n+njDXR037aY1+x58Z/zFdwQ==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"acorn\": \"^7.1.1\",\n-        \"acorn-jsx\": \"^5.2.0\",\n-        \"eslint-visitor-keys\": \"^1.1.0\"\n+        \"acorn\": \"^8.9.0\",\n+        \"acorn-jsx\": \"^5.3.2\",\n+        \"eslint-visitor-keys\": \"^3.4.1\"\n       },\n       \"engines\": {\n-        \"node\": \">=6.0.0\"\n+        \"node\": \"^12.22.0 || ^14.17.0 || >=16.0.0\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://opencollective.com/eslint\"\n       }\n     },\n     \"node_modules/esprima\": {\n@@ -3106,20 +3311,6 @@\n         \"node\": \">=0.10.0\"\n       }\n     },\n-    \"node_modules/external-editor\": {\n-      \"version\": \"3.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/external-editor/-/external-editor-3.1.0.tgz\",\n-      \"integrity\": \"sha512-hMQ4CX1p1izmuLYyZqLMO/qGNw10wSv9QDCPfzXfyFrOaCSSoRfqE1Kf1s5an66J5JZC62NewG+mK49jOCtQew==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"chardet\": \"^0.7.0\",\n-        \"iconv-lite\": \"^0.4.24\",\n-        \"tmp\": \"^0.0.33\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=4\"\n-      }\n-    },\n     \"node_modules/extract-zip\": {\n       \"version\": \"2.0.1\",\n       \"resolved\": \"https://registry.npmjs.org/extract-zip/-/extract-zip-2.0.1.tgz\",\n@@ -3152,6 +3343,22 @@\n       \"integrity\": \"sha512-/d9sfos4yxzpwkDkuN7k2SqFKtYNmCTzgfEpz82x34IM9/zc8KGxQoXg1liNC/izpRM/MBdt44Nmx41ZWqk+FQ==\",\n       \"dev\": true\n     },\n+    \"node_modules/fast-glob\": {\n+      \"version\": \"3.3.2\",\n+      \"resolved\": \"https://registry.npmjs.org/fast-glob/-/fast-glob-3.3.2.tgz\",\n+      \"integrity\": \"sha512-oX2ruAFQwf/Orj8m737Y5adxDQO0LAB7/S5MnxCdTNDd4p6BsyIVsv9JQsATbTSq8KHRpLwIHbVlUNatxd+1Ow==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"@nodelib/fs.stat\": \"^2.0.2\",\n+        \"@nodelib/fs.walk\": \"^1.2.3\",\n+        \"glob-parent\": \"^5.1.2\",\n+        \"merge2\": \"^1.3.0\",\n+        \"micromatch\": \"^4.0.4\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=8.6.0\"\n+      }\n+    },\n     \"node_modules/fast-json-stable-stringify\": {\n       \"version\": \"2.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/fast-json-stable-stringify/-/fast-json-stable-stringify-2.1.0.tgz\",\n@@ -3179,6 +3386,15 @@\n         \"node\": \">= 4.9.1\"\n       }\n     },\n+    \"node_modules/fastq\": {\n+      \"version\": \"1.17.1\",\n+      \"resolved\": \"https://registry.npmjs.org/fastq/-/fastq-1.17.1.tgz\",\n+      \"integrity\": \"sha512-sRVD3lWVIXWg6By68ZN7vho9a1pQcN/WBFaAAsDDFzlJjvoGx0P8z7V1t72grFJfJhu3YPZBuu25f7Kaw2jN1w==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"reusify\": \"^1.0.4\"\n+      }\n+    },\n     \"node_modules/fd-slicer\": {\n       \"version\": \"1.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/fd-slicer/-/fd-slicer-1.1.0.tgz\",\n@@ -3188,31 +3404,16 @@\n         \"pend\": \"~1.2.0\"\n       }\n     },\n-    \"node_modules/figures\": {\n-      \"version\": \"3.2.0\",\n-      \"resolved\": \"https://registry.npmjs.org/figures/-/figures-3.2.0.tgz\",\n-      \"integrity\": \"sha512-yaduQFRKLXYOGgEn6AZau90j3ggSOyiqXU0F9JZfeXYhNa+Jk4X+s45A2zg5jns87GAFa34BBm2kXw4XpNcbdg==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"escape-string-regexp\": \"^1.0.5\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n     \"node_modules/file-entry-cache\": {\n-      \"version\": \"5.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/file-entry-cache/-/file-entry-cache-5.0.1.tgz\",\n-      \"integrity\": \"sha512-bCg29ictuBaKUwwArK4ouCaqDgLZcysCFLmM/Yn/FDoqndh/9vNuQfXRDvTuXKLxfD/JtZQGKFT8MGcJBK644g==\",\n+      \"version\": \"6.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/file-entry-cache/-/file-entry-cache-6.0.1.tgz\",\n+      \"integrity\": \"sha512-7Gps/XWymbLk2QLYK4NzpMOrYjMhdIxXuIvy2QBsLE6ljuodKvdkWs/cpyJJ3CVIVpH0Oi1Hvg1ovbMzLdFBBg==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"flat-cache\": \"^2.0.1\"\n+        \"flat-cache\": \"^3.0.4\"\n       },\n       \"engines\": {\n-        \"node\": \">=4\"\n+        \"node\": \"^10.12.0 || >=12.0.0\"\n       }\n     },\n     \"node_modules/fill-range\": {\n@@ -3270,23 +3471,23 @@\n       }\n     },\n     \"node_modules/flat-cache\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/flat-cache/-/flat-cache-2.0.1.tgz\",\n-      \"integrity\": \"sha512-LoQe6yDuUMDzQAEH8sgmh4Md6oZnc/7PjtwjNFSzveXqSHt6ka9fPBuso7IGf9Rz4uqnSnWiFH2B/zj24a5ReA==\",\n+      \"version\": \"3.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/flat-cache/-/flat-cache-3.2.0.tgz\",\n+      \"integrity\": \"sha512-CYcENa+FtcUKLmhhqyctpclsq7QF38pKjZHsGNiSQF5r4FtoKDWabFDl3hzaEQMvT1LHEysw5twgLvpYYb4vbw==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"flatted\": \"^2.0.0\",\n-        \"rimraf\": \"2.6.3\",\n-        \"write\": \"1.0.3\"\n+        \"flatted\": \"^3.2.9\",\n+        \"keyv\": \"^4.5.3\",\n+        \"rimraf\": \"^3.0.2\"\n       },\n       \"engines\": {\n-        \"node\": \">=4\"\n+        \"node\": \"^10.12.0 || >=12.0.0\"\n       }\n     },\n     \"node_modules/flatted\": {\n-      \"version\": \"2.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/flatted/-/flatted-2.0.2.tgz\",\n-      \"integrity\": \"sha512-r5wGx7YeOwNWNlCA0wQ86zKyDLMQr+/RB8xy74M4hTphfmjlijTSSXGuH8rnvKZnfT9i+75zmd8jcKdMR4O6jA==\",\n+      \"version\": \"3.3.1\",\n+      \"resolved\": \"https://registry.npmjs.org/flatted/-/flatted-3.3.1.tgz\",\n+      \"integrity\": \"sha512-X8cqMLLie7KsNUDSdzeN8FYK9rEt4Dt67OsG/DNGnYTSDBG4uFAJFBnUeiV+zCVAvwFy56IjM9sH51jVaEhNxw==\",\n       \"dev\": true\n     },\n     \"node_modules/for-each\": {\n@@ -3311,65 +3512,6 @@\n         \"node\": \">=8.0.0\"\n       }\n     },\n-    \"node_modules/foreground-child/node_modules/cross-spawn\": {\n-      \"version\": \"7.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.3.tgz\",\n-      \"integrity\": \"sha512-iRDPJKUPVEND7dHPO8rkbOnPpyDygcDFtWjpeWNCgy8WP2rXcxXL8TskReQl6OrB2G7+UJrags1q15Fudc7G6w==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"path-key\": \"^3.1.0\",\n-        \"shebang-command\": \"^2.0.0\",\n-        \"which\": \"^2.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 8\"\n-      }\n-    },\n-    \"node_modules/foreground-child/node_modules/path-key\": {\n-      \"version\": \"3.1.1\",\n-      \"resolved\": \"https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz\",\n-      \"integrity\": \"sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/foreground-child/node_modules/shebang-command\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz\",\n-      \"integrity\": \"sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"shebang-regex\": \"^3.0.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/foreground-child/node_modules/shebang-regex\": {\n-      \"version\": \"3.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz\",\n-      \"integrity\": \"sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/foreground-child/node_modules/which\": {\n-      \"version\": \"2.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/which/-/which-2.0.2.tgz\",\n-      \"integrity\": \"sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"isexe\": \"^2.0.0\"\n-      },\n-      \"bin\": {\n-        \"node-which\": \"bin/node-which\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 8\"\n-      }\n-    },\n     \"node_modules/fork-ts-checker-webpack-plugin\": {\n       \"version\": \"6.5.3\",\n       \"resolved\": \"https://registry.npmjs.org/fork-ts-checker-webpack-plugin/-/fork-ts-checker-webpack-plugin-6.5.3.tgz\",\n@@ -3607,20 +3749,6 @@\n       \"integrity\": \"sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==\",\n       \"dev\": true\n     },\n-    \"node_modules/fsevents\": {\n-      \"version\": \"2.3.2\",\n-      \"resolved\": \"https://registry.npmjs.org/fsevents/-/fsevents-2.3.2.tgz\",\n-      \"integrity\": \"sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==\",\n-      \"dev\": true,\n-      \"hasInstallScript\": true,\n-      \"optional\": true,\n-      \"os\": [\n-        \"darwin\"\n-      ],\n-      \"engines\": {\n-        \"node\": \"^8.16.0 || ^10.6.0 || >=11.0.0\"\n-      }\n-    },\n     \"node_modules/function-bind\": {\n       \"version\": \"1.1.1\",\n       \"resolved\": \"https://registry.npmjs.org/function-bind/-/function-bind-1.1.1.tgz\",\n@@ -3645,12 +3773,6 @@\n         \"url\": \"https://github.com/sponsors/ljharb\"\n       }\n     },\n-    \"node_modules/functional-red-black-tree\": {\n-      \"version\": \"1.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/functional-red-black-tree/-/functional-red-black-tree-1.0.1.tgz\",\n-      \"integrity\": \"sha512-dsKNQNdj6xA3T+QlADDA7mOSlX0qiMINjn0cgr+eGHGsbSHzTabcIogz2+p/iqP1Xs6EP/sS2SbqH+brGTbq0g==\",\n-      \"dev\": true\n-    },\n     \"node_modules/functions-have-names\": {\n       \"version\": \"1.2.3\",\n       \"resolved\": \"https://registry.npmjs.org/functions-have-names/-/functions-have-names-1.2.3.tgz\",\n@@ -3809,12 +3931,12 @@\n       \"dev\": true\n     },\n     \"node_modules/globals\": {\n-      \"version\": \"12.4.0\",\n-      \"resolved\": \"https://registry.npmjs.org/globals/-/globals-12.4.0.tgz\",\n-      \"integrity\": \"sha512-BWICuzzDvDoH54NHKCseDanAhE3CeDorgDL5MT6LMXXj2WCnd9UC2szdk4AWLfjdgNBCXLUanXYcpBBKOSWGwg==\",\n+      \"version\": \"13.24.0\",\n+      \"resolved\": \"https://registry.npmjs.org/globals/-/globals-13.24.0.tgz\",\n+      \"integrity\": \"sha512-AhO5QUcj8llrbG09iWhPU2B204J1xnPeL8kQmVorSsy+Sjj1sk8gIyh6cUocGmH4L0UuhAJy+hJMRA4mgA4mFQ==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"type-fest\": \"^0.8.1\"\n+        \"type-fest\": \"^0.20.2\"\n       },\n       \"engines\": {\n         \"node\": \">=8\"\n@@ -3823,6 +3945,18 @@\n         \"url\": \"https://github.com/sponsors/sindresorhus\"\n       }\n     },\n+    \"node_modules/globals/node_modules/type-fest\": {\n+      \"version\": \"0.20.2\",\n+      \"resolved\": \"https://registry.npmjs.org/type-fest/-/type-fest-0.20.2.tgz\",\n+      \"integrity\": \"sha512-Ne+eE4r0/iWnpAxD852z3A+N0Bt5RN//NjJwRd2VFHEmrywxf5vsZlh4R6lixl6B+wz/8d+maTSAkN1FIkI3LQ==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">=10\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://github.com/sponsors/sindresorhus\"\n+      }\n+    },\n     \"node_modules/globalthis\": {\n       \"version\": \"1.0.3\",\n       \"resolved\": \"https://registry.npmjs.org/globalthis/-/globalthis-1.0.3.tgz\",\n@@ -3838,6 +3972,26 @@\n         \"url\": \"https://github.com/sponsors/ljharb\"\n       }\n     },\n+    \"node_modules/globby\": {\n+      \"version\": \"11.1.0\",\n+      \"resolved\": \"https://registry.npmjs.org/globby/-/globby-11.1.0.tgz\",\n+      \"integrity\": \"sha512-jhIXaOzy1sb8IyocaruWSn1TjmnBVs8Ayhcy83rmxNJ8q2uWKCAj3CnJY+KpGSXCueAPc0i05kVvVKtP1t9S3g==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"array-union\": \"^2.1.0\",\n+        \"dir-glob\": \"^3.0.1\",\n+        \"fast-glob\": \"^3.2.9\",\n+        \"ignore\": \"^5.2.0\",\n+        \"merge2\": \"^1.4.1\",\n+        \"slash\": \"^3.0.0\"\n+      },\n+      \"engines\": {\n+        \"node\": \">=10\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://github.com/sponsors/sindresorhus\"\n+      }\n+    },\n     \"node_modules/gopd\": {\n       \"version\": \"1.0.1\",\n       \"resolved\": \"https://registry.npmjs.org/gopd/-/gopd-1.0.1.tgz\",\n@@ -3856,6 +4010,12 @@\n       \"integrity\": \"sha512-RbJ5/jmFcNNCcDV5o9eTnBLJ/HszWV0P73bc+Ff4nS/rJj+YaS6IGyiOL0VoBYX+l1Wrl3k63h/KrH+nhJ0XvQ==\",\n       \"dev\": true\n     },\n+    \"node_modules/graphemer\": {\n+      \"version\": \"1.4.0\",\n+      \"resolved\": \"https://registry.npmjs.org/graphemer/-/graphemer-1.4.0.tgz\",\n+      \"integrity\": \"sha512-EtKwoO6kxCL9WO5xipiHTZlSzBm7WLT627TqC/uVRd0HKmq8NXyebnNYxDoBi7wt8eTWrUrKXCOVaFq9x1kgag==\",\n+      \"dev\": true\n+    },\n     \"node_modules/has\": {\n       \"version\": \"1.0.3\",\n       \"resolved\": \"https://registry.npmjs.org/has/-/has-1.0.3.tgz\",\n@@ -4006,18 +4166,6 @@\n         \"node\": \">= 14\"\n       }\n     },\n-    \"node_modules/iconv-lite\": {\n-      \"version\": \"0.4.24\",\n-      \"resolved\": \"https://registry.npmjs.org/iconv-lite/-/iconv-lite-0.4.24.tgz\",\n-      \"integrity\": \"sha512-v3MXnZAcvnywkTUEZomIActle7RXXeedOR31wwl7VlyoXO4Qi9arvSenNQWne1TcRwhCL1HwLI21bEqdpj8/rA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"safer-buffer\": \">= 2.1.2 < 3\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=0.10.0\"\n-      }\n-    },\n     \"node_modules/icss-utils\": {\n       \"version\": \"5.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/icss-utils/-/icss-utils-5.1.0.tgz\",\n@@ -4052,9 +4200,9 @@\n       ]\n     },\n     \"node_modules/ignore\": {\n-      \"version\": \"4.0.6\",\n-      \"resolved\": \"https://registry.npmjs.org/ignore/-/ignore-4.0.6.tgz\",\n-      \"integrity\": \"sha512-cyFDKrqc/YdcWFniJhzI42+AzS+gNwmUzOSFcRCQYwySuBBBy/KjuxWLZ/FHEH6Moq1NizMOBWyTcv8O4OZIMg==\",\n+      \"version\": \"5.3.1\",\n+      \"resolved\": \"https://registry.npmjs.org/ignore/-/ignore-5.3.1.tgz\",\n+      \"integrity\": \"sha512-5Fytz/IraMjqpwfd34ke28PTVMjZjJG2MPn5t7OE4eUCUNf8BAa7b5WUS9/Qvr6mwOQS7Mk6vdsMno5he+T8Xw==\",\n       \"dev\": true,\n       \"engines\": {\n         \"node\": \">= 4\"\n@@ -4124,138 +4272,23 @@\n       \"resolved\": \"https://registry.npmjs.org/inflight/-/inflight-1.0.6.tgz\",\n       \"integrity\": \"sha512-k92I/b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy/FZR3/4IgflMgKLOsvPDrGCJA==\",\n       \"dev\": true,\n-      \"dependencies\": {\n-        \"once\": \"^1.3.0\",\n-        \"wrappy\": \"1\"\n-      }\n-    },\n-    \"node_modules/inherits\": {\n-      \"version\": \"2.0.4\",\n-      \"resolved\": \"https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz\",\n-      \"integrity\": \"sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==\",\n-      \"dev\": true\n-    },\n-    \"node_modules/ini\": {\n-      \"version\": \"1.3.8\",\n-      \"resolved\": \"https://registry.npmjs.org/ini/-/ini-1.3.8.tgz\",\n-      \"integrity\": \"sha512-JV/yugV2uzW5iMRSiZAyDtQd+nxtUnjeLt0acNdw98kKLrvuRVyB80tsREOE7yvGVgalhZ6RNXCmEHkUKBKxew==\",\n-      \"dev\": true\n-    },\n-    \"node_modules/inquirer\": {\n-      \"version\": \"7.3.3\",\n-      \"resolved\": \"https://registry.npmjs.org/inquirer/-/inquirer-7.3.3.tgz\",\n-      \"integrity\": \"sha512-JG3eIAj5V9CwcGvuOmoo6LB9kbAYT8HXffUl6memuszlwDC/qvFAJw49XJ5NROSFNPxp3iQg1GqkFhaY/CR0IA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-escapes\": \"^4.2.1\",\n-        \"chalk\": \"^4.1.0\",\n-        \"cli-cursor\": \"^3.1.0\",\n-        \"cli-width\": \"^3.0.0\",\n-        \"external-editor\": \"^3.0.3\",\n-        \"figures\": \"^3.0.0\",\n-        \"lodash\": \"^4.17.19\",\n-        \"mute-stream\": \"0.0.8\",\n-        \"run-async\": \"^2.4.0\",\n-        \"rxjs\": \"^6.6.0\",\n-        \"string-width\": \"^4.1.0\",\n-        \"strip-ansi\": \"^6.0.0\",\n-        \"through\": \"^2.3.6\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8.0.0\"\n-      }\n-    },\n-    \"node_modules/inquirer/node_modules/ansi-regex\": {\n-      \"version\": \"5.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz\",\n-      \"integrity\": \"sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/inquirer/node_modules/ansi-styles\": {\n-      \"version\": \"4.3.0\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz\",\n-      \"integrity\": \"sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"color-convert\": \"^2.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/chalk/ansi-styles?sponsor=1\"\n-      }\n-    },\n-    \"node_modules/inquirer/node_modules/chalk\": {\n-      \"version\": \"4.1.2\",\n-      \"resolved\": \"https://registry.npmjs.org/chalk/-/chalk-4.1.2.tgz\",\n-      \"integrity\": \"sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc/wy9kY7/WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-styles\": \"^4.1.0\",\n-        \"supports-color\": \"^7.1.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=10\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/chalk/chalk?sponsor=1\"\n-      }\n-    },\n-    \"node_modules/inquirer/node_modules/color-convert\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/color-convert/-/color-convert-2.0.1.tgz\",\n-      \"integrity\": \"sha512-RRECPsj7iu/xb5oKYcsFHSppFNnsj/52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK/U584fMg38ZHCaElKQ==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"color-name\": \"~1.1.4\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=7.0.0\"\n-      }\n-    },\n-    \"node_modules/inquirer/node_modules/color-name\": {\n-      \"version\": \"1.1.4\",\n-      \"resolved\": \"https://registry.npmjs.org/color-name/-/color-name-1.1.4.tgz\",\n-      \"integrity\": \"sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==\",\n-      \"dev\": true\n-    },\n-    \"node_modules/inquirer/node_modules/has-flag\": {\n-      \"version\": \"4.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/has-flag/-/has-flag-4.0.0.tgz\",\n-      \"integrity\": \"sha512-EykJT/Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG/ZxU3EvlMPQ==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/inquirer/node_modules/strip-ansi\": {\n-      \"version\": \"6.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz\",\n-      \"integrity\": \"sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-regex\": \"^5.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/inquirer/node_modules/supports-color\": {\n-      \"version\": \"7.2.0\",\n-      \"resolved\": \"https://registry.npmjs.org/supports-color/-/supports-color-7.2.0.tgz\",\n-      \"integrity\": \"sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO/+Lwxc9+0q2wLyv4Dfvt80/DPn2pqOBsJdDiogXGR9+OvwRw==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"has-flag\": \"^4.0.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n+      \"dependencies\": {\n+        \"once\": \"^1.3.0\",\n+        \"wrappy\": \"1\"\n       }\n     },\n+    \"node_modules/inherits\": {\n+      \"version\": \"2.0.4\",\n+      \"resolved\": \"https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz\",\n+      \"integrity\": \"sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==\",\n+      \"dev\": true\n+    },\n+    \"node_modules/ini\": {\n+      \"version\": \"1.3.8\",\n+      \"resolved\": \"https://registry.npmjs.org/ini/-/ini-1.3.8.tgz\",\n+      \"integrity\": \"sha512-JV/yugV2uzW5iMRSiZAyDtQd+nxtUnjeLt0acNdw98kKLrvuRVyB80tsREOE7yvGVgalhZ6RNXCmEHkUKBKxew==\",\n+      \"dev\": true\n+    },\n     \"node_modules/internal-slot\": {\n       \"version\": \"1.0.5\",\n       \"resolved\": \"https://registry.npmjs.org/internal-slot/-/internal-slot-1.0.5.tgz\",\n@@ -4509,6 +4542,15 @@\n         \"url\": \"https://github.com/sponsors/ljharb\"\n       }\n     },\n+    \"node_modules/is-path-inside\": {\n+      \"version\": \"3.0.3\",\n+      \"resolved\": \"https://registry.npmjs.org/is-path-inside/-/is-path-inside-3.0.3.tgz\",\n+      \"integrity\": \"sha512-Fd4gABb+ycGAmKou8eMftCupSir5lRxqf4aD/vd0cD2qc4HL07OjCeuHMr8Ro4CoMaeCKDB0/ECBOVWjTwUvPQ==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">=8\"\n+      }\n+    },\n     \"node_modules/is-plain-obj\": {\n       \"version\": \"2.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/is-plain-obj/-/is-plain-obj-2.1.0.tgz\",\n@@ -4750,65 +4792,6 @@\n         \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/istanbul-lib-processinfo/node_modules/cross-spawn\": {\n-      \"version\": \"7.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.3.tgz\",\n-      \"integrity\": \"sha512-iRDPJKUPVEND7dHPO8rkbOnPpyDygcDFtWjpeWNCgy8WP2rXcxXL8TskReQl6OrB2G7+UJrags1q15Fudc7G6w==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"path-key\": \"^3.1.0\",\n-        \"shebang-command\": \"^2.0.0\",\n-        \"which\": \"^2.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 8\"\n-      }\n-    },\n-    \"node_modules/istanbul-lib-processinfo/node_modules/path-key\": {\n-      \"version\": \"3.1.1\",\n-      \"resolved\": \"https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz\",\n-      \"integrity\": \"sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/istanbul-lib-processinfo/node_modules/rimraf\": {\n-      \"version\": \"3.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/rimraf/-/rimraf-3.0.2.tgz\",\n-      \"integrity\": \"sha512-JZkJMZkAGFFPP2YqXZXPbMlMBgsxzE8ILs4lMIX/2o0L9UBw9O/Y3o6wFw/i9YLapcUJWwqbi3kdxIPdC62TIA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"glob\": \"^7.1.3\"\n-      },\n-      \"bin\": {\n-        \"rimraf\": \"bin.js\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/isaacs\"\n-      }\n-    },\n-    \"node_modules/istanbul-lib-processinfo/node_modules/shebang-command\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz\",\n-      \"integrity\": \"sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"shebang-regex\": \"^3.0.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/istanbul-lib-processinfo/node_modules/shebang-regex\": {\n-      \"version\": \"3.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz\",\n-      \"integrity\": \"sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/istanbul-lib-processinfo/node_modules/uuid\": {\n       \"version\": \"8.3.2\",\n       \"resolved\": \"https://registry.npmjs.org/uuid/-/uuid-8.3.2.tgz\",\n@@ -4818,21 +4801,6 @@\n         \"uuid\": \"dist/bin/uuid\"\n       }\n     },\n-    \"node_modules/istanbul-lib-processinfo/node_modules/which\": {\n-      \"version\": \"2.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/which/-/which-2.0.2.tgz\",\n-      \"integrity\": \"sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"isexe\": \"^2.0.0\"\n-      },\n-      \"bin\": {\n-        \"node-which\": \"bin/node-which\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 8\"\n-      }\n-    },\n     \"node_modules/istanbul-lib-report\": {\n       \"version\": \"3.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/istanbul-lib-report/-/istanbul-lib-report-3.0.0.tgz\",\n@@ -5030,6 +4998,12 @@\n         \"node\": \">=4\"\n       }\n     },\n+    \"node_modules/json-buffer\": {\n+      \"version\": \"3.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/json-buffer/-/json-buffer-3.0.1.tgz\",\n+      \"integrity\": \"sha512-4bV5BfR2mqfQTJm+V5tPPdf+ZpuhiIvTuAB5g8kcrXOZpTT/QwwVRWBywX1ozr6lEuPdbHxwaJlm9G6mI2sfSQ==\",\n+      \"dev\": true\n+    },\n     \"node_modules/json-parse-even-better-errors\": {\n       \"version\": \"2.3.1\",\n       \"resolved\": \"https://registry.npmjs.org/json-parse-even-better-errors/-/json-parse-even-better-errors-2.3.1.tgz\",\n@@ -5083,6 +5057,15 @@\n       \"integrity\": \"sha512-g3UB796vUFIY90VIv/WX3L2c8CS2MdWUww3CNrYmqza1Fg0DURc2K/O4YrnklBdQarSJ/y8JnJYDGc+1iumQjg==\",\n       \"dev\": true\n     },\n+    \"node_modules/keyv\": {\n+      \"version\": \"4.5.4\",\n+      \"resolved\": \"https://registry.npmjs.org/keyv/-/keyv-4.5.4.tgz\",\n+      \"integrity\": \"sha512-oxVHkHR/EJf2CNXnWxRLW6mg7JyCCUcG0DtEGmL2ctUo1PNTin1PUil+r/+4r5MpVgC/fn1kjsx7mjSujKqIpw==\",\n+      \"dev\": true,\n+      \"dependencies\": {\n+        \"json-buffer\": \"3.0.1\"\n+      }\n+    },\n     \"node_modules/kind-of\": {\n       \"version\": \"3.2.2\",\n       \"resolved\": \"https://registry.npmjs.org/kind-of/-/kind-of-3.2.2.tgz\",\n@@ -5096,13 +5079,13 @@\n       }\n     },\n     \"node_modules/levn\": {\n-      \"version\": \"0.3.0\",\n-      \"resolved\": \"https://registry.npmjs.org/levn/-/levn-0.3.0.tgz\",\n-      \"integrity\": \"sha512-0OO4y2iOHix2W6ujICbKIaEQXvFQHue65vUG3pb5EUomzPI90z9hsA1VsO/dbIIpC53J8gxM9Q4Oho0jrCM/yA==\",\n+      \"version\": \"0.4.1\",\n+      \"resolved\": \"https://registry.npmjs.org/levn/-/levn-0.4.1.tgz\",\n+      \"integrity\": \"sha512-+bT2uH4E5LGE7h/n3evcS/sQlJXCpIp6ym8OWJ5eV6+67Dsql/LaaT7qJBAt2rzfoa/5QBGBhxDix1dMt2kQKQ==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"prelude-ls\": \"~1.1.2\",\n-        \"type-check\": \"~0.3.2\"\n+        \"prelude-ls\": \"^1.2.1\",\n+        \"type-check\": \"~0.4.0\"\n       },\n       \"engines\": {\n         \"node\": \">= 0.8.0\"\n@@ -5170,6 +5153,12 @@\n       \"integrity\": \"sha512-z+Uw/vLuy6gQe8cfaFWD7p0wVv8fJl3mbzXh33RS+0oW2wvUqiRXiQ69gLWSLpgB5/6sU+r6BlQR0MBILadqTQ==\",\n       \"dev\": true\n     },\n+    \"node_modules/lodash.merge\": {\n+      \"version\": \"4.6.2\",\n+      \"resolved\": \"https://registry.npmjs.org/lodash.merge/-/lodash.merge-4.6.2.tgz\",\n+      \"integrity\": \"sha512-0KpjqXRVvrYyCsX1swR/XTK0va6VQkQM6MNo7PqW77ByjAhoARA8EfrP1N4+KlKj8YS0ZUCtRT/YUuhyYDujIQ==\",\n+      \"dev\": true\n+    },\n     \"node_modules/log-symbols\": {\n       \"version\": \"4.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/log-symbols/-/log-symbols-4.1.0.tgz\",\n@@ -5337,6 +5326,15 @@\n       \"integrity\": \"sha512-abv/qOcuPfk3URPfDzmZU1LKmuw8kT+0nIHvKrKgFrwifol/doWcdA4ZqsWQ8ENrFKkd67Mfpo/LovbIUsbt3w==\",\n       \"dev\": true\n     },\n+    \"node_modules/merge2\": {\n+      \"version\": \"1.4.1\",\n+      \"resolved\": \"https://registry.npmjs.org/merge2/-/merge2-1.4.1.tgz\",\n+      \"integrity\": \"sha512-8q7VEgMJW4J8tcfVPy8g09NcQwZdbwFEqhe/WZkoIzjn/3TGDwtOCYtXGxA3O8tPzpczCCDgv+P2P5y00ZJOOg==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">= 8\"\n+      }\n+    },\n     \"node_modules/methods\": {\n       \"version\": \"1.1.2\",\n       \"resolved\": \"https://registry.npmjs.org/methods/-/methods-1.1.2.tgz\",\n@@ -5392,15 +5390,6 @@\n         \"node\": \">= 0.6\"\n       }\n     },\n-    \"node_modules/mimic-fn\": {\n-      \"version\": \"2.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/mimic-fn/-/mimic-fn-2.1.0.tgz\",\n-      \"integrity\": \"sha512-OqbOk5oEQeAZ8WXWydlu9HJjz9WVdEIvamMCcXmuqUYjTknH/sqsWvhQ3vgwKFRR1HpjvNBKQ37nbJgYzGqGcg==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=6\"\n-      }\n-    },\n     \"node_modules/minimatch\": {\n       \"version\": \"3.1.2\",\n       \"resolved\": \"https://registry.npmjs.org/minimatch/-/minimatch-3.1.2.tgz\",\n@@ -5648,12 +5637,6 @@\n         \"mustache\": \"bin/mustache\"\n       }\n     },\n-    \"node_modules/mute-stream\": {\n-      \"version\": \"0.0.8\",\n-      \"resolved\": \"https://registry.npmjs.org/mute-stream/-/mute-stream-0.0.8.tgz\",\n-      \"integrity\": \"sha512-nnbWWOkoWyUsTjKrhgD0dcz22mdkSnpYqbEjIm2nhwhuxlSkpywJmBo8h0ZqJdkp73mb90SssHkN4rsRaBAfAA==\",\n-      \"dev\": true\n-    },\n     \"node_modules/nanoid\": {\n       \"version\": \"3.3.3\",\n       \"resolved\": \"https://registry.npmjs.org/nanoid/-/nanoid-3.3.3.tgz\",\n@@ -5687,12 +5670,6 @@\n         \"node\": \">= 0.4.0\"\n       }\n     },\n-    \"node_modules/nice-try\": {\n-      \"version\": \"1.0.5\",\n-      \"resolved\": \"https://registry.npmjs.org/nice-try/-/nice-try-1.0.5.tgz\",\n-      \"integrity\": \"sha512-1nh45deeb5olNY7eX82BkPO7SSxR5SSYJiPTrTdFUVYwAl8CKMA5N9PjTYkHiRjisVcxcQ1HXdLhx2qxxJzLNQ==\",\n-      \"dev\": true\n-    },\n     \"node_modules/nise\": {\n       \"version\": \"5.1.5\",\n       \"resolved\": \"https://registry.npmjs.org/nise/-/nise-5.1.5.tgz\",\n@@ -5799,15 +5776,6 @@\n         \"npm-license-generator\": \"build/npm-license-generator\"\n       }\n     },\n-    \"node_modules/npm-license-generator/node_modules/ansi-regex\": {\n-      \"version\": \"5.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz\",\n-      \"integrity\": \"sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/npm-license-generator/node_modules/ansi-styles\": {\n       \"version\": \"4.3.0\",\n       \"resolved\": \"https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz\",\n@@ -5904,33 +5872,6 @@\n         \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/npm-license-generator/node_modules/rimraf\": {\n-      \"version\": \"3.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/rimraf/-/rimraf-3.0.2.tgz\",\n-      \"integrity\": \"sha512-JZkJMZkAGFFPP2YqXZXPbMlMBgsxzE8ILs4lMIX/2o0L9UBw9O/Y3o6wFw/i9YLapcUJWwqbi3kdxIPdC62TIA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"glob\": \"^7.1.3\"\n-      },\n-      \"bin\": {\n-        \"rimraf\": \"bin.js\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/isaacs\"\n-      }\n-    },\n-    \"node_modules/npm-license-generator/node_modules/strip-ansi\": {\n-      \"version\": \"6.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz\",\n-      \"integrity\": \"sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-regex\": \"^5.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/npm-license-generator/node_modules/wrap-ansi\": {\n       \"version\": \"6.2.0\",\n       \"resolved\": \"https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-6.2.0.tgz\",\n@@ -6036,15 +5977,6 @@\n         \"node\": \">=8.9\"\n       }\n     },\n-    \"node_modules/nyc/node_modules/ansi-regex\": {\n-      \"version\": \"5.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz\",\n-      \"integrity\": \"sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/nyc/node_modules/ansi-styles\": {\n       \"version\": \"4.3.0\",\n       \"resolved\": \"https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz\",\n@@ -6150,33 +6082,6 @@\n         \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/nyc/node_modules/rimraf\": {\n-      \"version\": \"3.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/rimraf/-/rimraf-3.0.2.tgz\",\n-      \"integrity\": \"sha512-JZkJMZkAGFFPP2YqXZXPbMlMBgsxzE8ILs4lMIX/2o0L9UBw9O/Y3o6wFw/i9YLapcUJWwqbi3kdxIPdC62TIA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"glob\": \"^7.1.3\"\n-      },\n-      \"bin\": {\n-        \"rimraf\": \"bin.js\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/isaacs\"\n-      }\n-    },\n-    \"node_modules/nyc/node_modules/strip-ansi\": {\n-      \"version\": \"6.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz\",\n-      \"integrity\": \"sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-regex\": \"^5.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/nyc/node_modules/wrap-ansi\": {\n       \"version\": \"6.2.0\",\n       \"resolved\": \"https://registry.npmjs.org/wrap-ansi/-/wrap-ansi-6.2.0.tgz\",\n@@ -6312,47 +6217,23 @@\n         \"wrappy\": \"1\"\n       }\n     },\n-    \"node_modules/onetime\": {\n-      \"version\": \"5.1.2\",\n-      \"resolved\": \"https://registry.npmjs.org/onetime/-/onetime-5.1.2.tgz\",\n-      \"integrity\": \"sha512-kbpaSSGJTWdAY5KPVeMOKXSrPtr8C8C7wodJbcsd51jRnmD+GZu8Y0VoU6Dm5Z4vWr0Ig/1NKuWRKf7j5aaYSg==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"mimic-fn\": \"^2.1.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=6\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/sindresorhus\"\n-      }\n-    },\n     \"node_modules/optionator\": {\n-      \"version\": \"0.8.3\",\n-      \"resolved\": \"https://registry.npmjs.org/optionator/-/optionator-0.8.3.tgz\",\n-      \"integrity\": \"sha512-+IW9pACdk3XWmmTXG8m3upGUJst5XRGzxMRjXzAuJ1XnIFNvfhjjIuYkDvysnPQ7qzqVzLt78BCruntqRhWQbA==\",\n+      \"version\": \"0.9.4\",\n+      \"resolved\": \"https://registry.npmjs.org/optionator/-/optionator-0.9.4.tgz\",\n+      \"integrity\": \"sha512-6IpQ7mKUxRcZNLIObR0hz7lxsapSSIYNZJwXPGeF0mTVqGKFIXj1DQcMoT22S3ROcLyY/rz0PWaWZ9ayWmad9g==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"deep-is\": \"~0.1.3\",\n-        \"fast-levenshtein\": \"~2.0.6\",\n-        \"levn\": \"~0.3.0\",\n-        \"prelude-ls\": \"~1.1.2\",\n-        \"type-check\": \"~0.3.2\",\n-        \"word-wrap\": \"~1.2.3\"\n+        \"deep-is\": \"^0.1.3\",\n+        \"fast-levenshtein\": \"^2.0.6\",\n+        \"levn\": \"^0.4.1\",\n+        \"prelude-ls\": \"^1.2.1\",\n+        \"type-check\": \"^0.4.0\",\n+        \"word-wrap\": \"^1.2.5\"\n       },\n       \"engines\": {\n         \"node\": \">= 0.8.0\"\n       }\n     },\n-    \"node_modules/os-tmpdir\": {\n-      \"version\": \"1.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/os-tmpdir/-/os-tmpdir-1.0.2.tgz\",\n-      \"integrity\": \"sha512-D2FR03Vir7FIu45XBY20mTb+/ZSWB00sjU9jdQXt83gDrI4Ztz5Fs7/yy74g2N5SVQY4xY1qDr4rNddwYRVX0g==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=0.10.0\"\n-      }\n-    },\n     \"node_modules/p-limit\": {\n       \"version\": \"3.1.0\",\n       \"resolved\": \"https://registry.npmjs.org/p-limit/-/p-limit-3.1.0.tgz\",\n@@ -6500,12 +6381,12 @@\n       }\n     },\n     \"node_modules/path-key\": {\n-      \"version\": \"2.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/path-key/-/path-key-2.0.1.tgz\",\n-      \"integrity\": \"sha512-fEHGKCSmUSDPv4uoj8AlD+joPlq3peND+HRYyxFz4KPw4z926S/b8rIuFs2FYJg3BwsxJf6A9/3eIdLaYC+9Dw==\",\n+      \"version\": \"3.1.1\",\n+      \"resolved\": \"https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz\",\n+      \"integrity\": \"sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==\",\n       \"dev\": true,\n       \"engines\": {\n-        \"node\": \">=4\"\n+        \"node\": \">=8\"\n       }\n     },\n     \"node_modules/path-parse\": {\n@@ -6756,9 +6637,9 @@\n       }\n     },\n     \"node_modules/prelude-ls\": {\n-      \"version\": \"1.1.2\",\n-      \"resolved\": \"https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.1.2.tgz\",\n-      \"integrity\": \"sha512-ESF23V4SKG6lVSGZgYNpbsiaAkdab6ZgOxe52p7+Kid3W3u3bxR4Vfd/o21dmN7jSt0IwgZ4v5MUd26FEtXE9w==\",\n+      \"version\": \"1.2.1\",\n+      \"resolved\": \"https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.2.1.tgz\",\n+      \"integrity\": \"sha512-vkcDPrRZo1QZLbn5RLGPpg/WmIQ65qoWWhcGKf/b5eplkkarX0m9z8ppCat4mlOqUsWpyNuYgO3VRyrYHSzX5g==\",\n       \"dev\": true,\n       \"engines\": {\n         \"node\": \">= 0.8.0\"\n@@ -6768,7 +6649,7 @@\n       \"version\": \"2.2.1\",\n       \"resolved\": \"https://registry.npmjs.org/prettier/-/prettier-2.2.1.tgz\",\n       \"integrity\": \"sha512-PqyhM2yCjg/oKkFPtTGUojv7gnZAoG80ttl45O6x2Ug/rMJw4wcc9k6aaf2hibP7BGVCCM33gZoGjyvt9mm16Q==\",\n-      \"dev\": true,\n+      \"devOptional\": true,\n       \"bin\": {\n         \"prettier\": \"bin-prettier.js\"\n       },\n@@ -7016,6 +6897,26 @@\n         \"url\": \"https://github.com/sponsors/ljharb\"\n       }\n     },\n+    \"node_modules/queue-microtask\": {\n+      \"version\": \"1.2.3\",\n+      \"resolved\": \"https://registry.npmjs.org/queue-microtask/-/queue-microtask-1.2.3.tgz\",\n+      \"integrity\": \"sha512-NuaNSa6flKT5JaSYQzJok04JzTL1CA6aGhv5rfLW3PgqA+M2ChpZQnAC8h8i4ZFkBS8X5RqkDBHA7r4hej3K9A==\",\n+      \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"github\",\n+          \"url\": \"https://github.com/sponsors/feross\"\n+        },\n+        {\n+          \"type\": \"patreon\",\n+          \"url\": \"https://www.patreon.com/feross\"\n+        },\n+        {\n+          \"type\": \"consulting\",\n+          \"url\": \"https://feross.org/support\"\n+        }\n+      ]\n+    },\n     \"node_modules/queue-tick\": {\n       \"version\": \"1.0.1\",\n       \"resolved\": \"https://registry.npmjs.org/queue-tick/-/queue-tick-1.0.1.tgz\",\n@@ -7086,18 +6987,6 @@\n         \"url\": \"https://github.com/sponsors/ljharb\"\n       }\n     },\n-    \"node_modules/regexpp\": {\n-      \"version\": \"3.2.0\",\n-      \"resolved\": \"https://registry.npmjs.org/regexpp/-/regexpp-3.2.0.tgz\",\n-      \"integrity\": \"sha512-pq2bWo9mVD43nbts2wGv17XLiNLya+GklZ8kaDLV2Z08gDCsGpnKn9BFMepvWuHCbyVvY7J5o5+BVvoQbmlJLg==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/mysticatea\"\n-      }\n-    },\n     \"node_modules/release-zalgo\": {\n       \"version\": \"1.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/release-zalgo/-/release-zalgo-1.0.0.tgz\",\n@@ -7172,50 +7061,53 @@\n         \"node\": \">=4\"\n       }\n     },\n-    \"node_modules/restore-cursor\": {\n-      \"version\": \"3.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/restore-cursor/-/restore-cursor-3.1.0.tgz\",\n-      \"integrity\": \"sha512-l+sSefzHpj5qimhFSE5a8nufZYAM3sBSVMAPtYkmC+4EH2anSGaEMXSD0izRQbu9nfyQ9y5JrVmp7E8oZrUjvA==\",\n+    \"node_modules/reusify\": {\n+      \"version\": \"1.0.4\",\n+      \"resolved\": \"https://registry.npmjs.org/reusify/-/reusify-1.0.4.tgz\",\n+      \"integrity\": \"sha512-U9nH88a3fc/ekCF1l0/UP1IosiuIjyTh7hBvXVMHYgVcfGvt897Xguj2UOLDeI5BG2m7/uwyaLVT6fbtCwTyzw==\",\n       \"dev\": true,\n-      \"dependencies\": {\n-        \"onetime\": \"^5.1.0\",\n-        \"signal-exit\": \"^3.0.2\"\n-      },\n       \"engines\": {\n-        \"node\": \">=8\"\n+        \"iojs\": \">=1.0.0\",\n+        \"node\": \">=0.10.0\"\n       }\n     },\n     \"node_modules/rimraf\": {\n-      \"version\": \"2.6.3\",\n-      \"resolved\": \"https://registry.npmjs.org/rimraf/-/rimraf-2.6.3.tgz\",\n-      \"integrity\": \"sha512-mwqeW5XsA2qAejG46gYdENaxXjx9onRNCfn7L0duuP4hCuTIi/QO7PDK07KJfp1d+izWPrzEJDcSqBa0OZQriA==\",\n+      \"version\": \"3.0.2\",\n+      \"resolved\": \"https://registry.npmjs.org/rimraf/-/rimraf-3.0.2.tgz\",\n+      \"integrity\": \"sha512-JZkJMZkAGFFPP2YqXZXPbMlMBgsxzE8ILs4lMIX/2o0L9UBw9O/Y3o6wFw/i9YLapcUJWwqbi3kdxIPdC62TIA==\",\n+      \"deprecated\": \"Rimraf versions prior to v4 are no longer supported\",\n       \"dev\": true,\n       \"dependencies\": {\n         \"glob\": \"^7.1.3\"\n       },\n       \"bin\": {\n         \"rimraf\": \"bin.js\"\n+      },\n+      \"funding\": {\n+        \"url\": \"https://github.com/sponsors/isaacs\"\n       }\n     },\n-    \"node_modules/run-async\": {\n-      \"version\": \"2.4.1\",\n-      \"resolved\": \"https://registry.npmjs.org/run-async/-/run-async-2.4.1.tgz\",\n-      \"integrity\": \"sha512-tvVnVv01b8c1RrA6Ep7JkStj85Guv/YrMcwqYQnwjsAS2cTmmPGBBjAjpCW7RrSodNSoE2/qg9O4bceNvUuDgQ==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=0.12.0\"\n-      }\n-    },\n-    \"node_modules/rxjs\": {\n-      \"version\": \"6.6.7\",\n-      \"resolved\": \"https://registry.npmjs.org/rxjs/-/rxjs-6.6.7.tgz\",\n-      \"integrity\": \"sha512-hTdwr+7yYNIT5n4AMYp85KA6yw2Va0FLa3Rguvbpa4W3I5xynaBZo41cM3XM+4Q6fRMj3sBYIR1VAmZMXYJvRQ==\",\n+    \"node_modules/run-parallel\": {\n+      \"version\": \"1.2.0\",\n+      \"resolved\": \"https://registry.npmjs.org/run-parallel/-/run-parallel-1.2.0.tgz\",\n+      \"integrity\": \"sha512-5l4VyZR86LZ/lDxZTR6jqL8AFE2S0IFLMP26AbjsLVADxHdhB/c0GUsH+y39UfCi3dzz8OlQuPmnaJOMoDHQBA==\",\n       \"dev\": true,\n+      \"funding\": [\n+        {\n+          \"type\": \"github\",\n+          \"url\": \"https://github.com/sponsors/feross\"\n+        },\n+        {\n+          \"type\": \"patreon\",\n+          \"url\": \"https://www.patreon.com/feross\"\n+        },\n+        {\n+          \"type\": \"consulting\",\n+          \"url\": \"https://feross.org/support\"\n+        }\n+      ],\n       \"dependencies\": {\n-        \"tslib\": \"^1.9.0\"\n-      },\n-      \"engines\": {\n-        \"npm\": \">=2.0.0\"\n+        \"queue-microtask\": \"^1.2.2\"\n       }\n     },\n     \"node_modules/safe-buffer\": {\n@@ -7252,12 +7144,6 @@\n         \"url\": \"https://github.com/sponsors/ljharb\"\n       }\n     },\n-    \"node_modules/safer-buffer\": {\n-      \"version\": \"2.1.2\",\n-      \"resolved\": \"https://registry.npmjs.org/safer-buffer/-/safer-buffer-2.1.2.tgz\",\n-      \"integrity\": \"sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==\",\n-      \"dev\": true\n-    },\n     \"node_modules/sass\": {\n       \"version\": \"1.60.0\",\n       \"resolved\": \"https://registry.npmjs.org/sass/-/sass-1.60.0.tgz\",\n@@ -7351,24 +7237,24 @@\n       }\n     },\n     \"node_modules/shebang-command\": {\n-      \"version\": \"1.2.0\",\n-      \"resolved\": \"https://registry.npmjs.org/shebang-command/-/shebang-command-1.2.0.tgz\",\n-      \"integrity\": \"sha512-EV3L1+UQWGor21OmnvojK36mhg+TyIKDh3iFBKBohr5xeXIhNBcx8oWdgkTEEQ+BEFFYdLRuqMfd5L84N1V5Vg==\",\n+      \"version\": \"2.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz\",\n+      \"integrity\": \"sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"shebang-regex\": \"^1.0.0\"\n+        \"shebang-regex\": \"^3.0.0\"\n       },\n       \"engines\": {\n-        \"node\": \">=0.10.0\"\n+        \"node\": \">=8\"\n       }\n     },\n     \"node_modules/shebang-regex\": {\n-      \"version\": \"1.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/shebang-regex/-/shebang-regex-1.0.0.tgz\",\n-      \"integrity\": \"sha512-wpoSFAxys6b2a2wHZ1XpDSgD7N9iVjg29Ph9uV/uaP9Ex/KXlkTZTeddxDPSYQpgvzKLGJke2UU0AzoGCjNIvQ==\",\n+      \"version\": \"3.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz\",\n+      \"integrity\": \"sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==\",\n       \"dev\": true,\n       \"engines\": {\n-        \"node\": \">=0.10.0\"\n+        \"node\": \">=8\"\n       }\n     },\n     \"node_modules/side-channel\": {\n@@ -7532,27 +7418,13 @@\n         \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/slice-ansi\": {\n-      \"version\": \"2.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/slice-ansi/-/slice-ansi-2.1.0.tgz\",\n-      \"integrity\": \"sha512-Qu+VC3EwYLldKa1fCxuuvULvSJOKEgk9pi8dZeCVK7TqBfUNTH4sFkk4joj8afVSfAYgJoSOetjx9QWOJ5mYoQ==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-styles\": \"^3.2.0\",\n-        \"astral-regex\": \"^1.0.0\",\n-        \"is-fullwidth-code-point\": \"^2.0.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=6\"\n-      }\n-    },\n-    \"node_modules/slice-ansi/node_modules/is-fullwidth-code-point\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/is-fullwidth-code-point/-/is-fullwidth-code-point-2.0.0.tgz\",\n-      \"integrity\": \"sha512-VHskAKYM8RfSFXwee5t5cbN5PZeq1Wrh6qd5bkyiXIf6UQcN6w/A0eXM9r6t8d+GYOh+o6ZhiEnb88LN/Y8m2w==\",\n+    \"node_modules/slash\": {\n+      \"version\": \"3.0.0\",\n+      \"resolved\": \"https://registry.npmjs.org/slash/-/slash-3.0.0.tgz\",\n+      \"integrity\": \"sha512-g9Q1haeby36OSStwb4ntCGGGaKsaVSjQ68fBxoQcutl5fS1vuY18H3wSt3jFyFtrkx+Kz0V1G85A4MyAdDMi2Q==\",\n       \"dev\": true,\n       \"engines\": {\n-        \"node\": \">=4\"\n+        \"node\": \">=8\"\n       }\n     },\n     \"node_modules/smart-buffer\": {\n@@ -7636,36 +7508,6 @@\n         \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/spawn-wrap/node_modules/rimraf\": {\n-      \"version\": \"3.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/rimraf/-/rimraf-3.0.2.tgz\",\n-      \"integrity\": \"sha512-JZkJMZkAGFFPP2YqXZXPbMlMBgsxzE8ILs4lMIX/2o0L9UBw9O/Y3o6wFw/i9YLapcUJWwqbi3kdxIPdC62TIA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"glob\": \"^7.1.3\"\n-      },\n-      \"bin\": {\n-        \"rimraf\": \"bin.js\"\n-      },\n-      \"funding\": {\n-        \"url\": \"https://github.com/sponsors/isaacs\"\n-      }\n-    },\n-    \"node_modules/spawn-wrap/node_modules/which\": {\n-      \"version\": \"2.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/which/-/which-2.0.2.tgz\",\n-      \"integrity\": \"sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"isexe\": \"^2.0.0\"\n-      },\n-      \"bin\": {\n-        \"node-which\": \"bin/node-which\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 8\"\n-      }\n-    },\n     \"node_modules/spdx-exceptions\": {\n       \"version\": \"2.3.0\",\n       \"resolved\": \"https://registry.npmjs.org/spdx-exceptions/-/spdx-exceptions-2.3.0.tgz\",\n@@ -7748,27 +7590,6 @@\n         \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/string-width/node_modules/ansi-regex\": {\n-      \"version\": \"5.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz\",\n-      \"integrity\": \"sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/string-width/node_modules/strip-ansi\": {\n-      \"version\": \"6.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz\",\n-      \"integrity\": \"sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-regex\": \"^5.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/string.prototype.trim\": {\n       \"version\": \"1.2.7\",\n       \"resolved\": \"https://registry.npmjs.org/string.prototype.trim/-/string.prototype.trim-1.2.7.tgz\",\n@@ -7815,15 +7636,15 @@\n       }\n     },\n     \"node_modules/strip-ansi\": {\n-      \"version\": \"5.2.0\",\n-      \"resolved\": \"https://registry.npmjs.org/strip-ansi/-/strip-ansi-5.2.0.tgz\",\n-      \"integrity\": \"sha512-DuRs1gKbBqsMKIZlrffwlug8MHkcnpjs5VPmL1PAh+mA30U0DTotfDZ0d2UUsXpPmPmMMJ6W773MaA3J+lbiWA==\",\n+      \"version\": \"6.0.1\",\n+      \"resolved\": \"https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz\",\n+      \"integrity\": \"sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"ansi-regex\": \"^4.1.0\"\n+        \"ansi-regex\": \"^5.0.1\"\n       },\n       \"engines\": {\n-        \"node\": \">=6\"\n+        \"node\": \">=8\"\n       }\n     },\n     \"node_modules/strip-bom\": {\n@@ -7943,50 +7764,6 @@\n         \"node\": \">=4.0.0\"\n       }\n     },\n-    \"node_modules/table\": {\n-      \"version\": \"5.4.6\",\n-      \"resolved\": \"https://registry.npmjs.org/table/-/table-5.4.6.tgz\",\n-      \"integrity\": \"sha512-wmEc8m4fjnob4gt5riFRtTu/6+4rSe12TpAELNSqHMfF3IqnA+CH37USM6/YR3qRZv7e56kAEAtd6nKZaxe0Ug==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ajv\": \"^6.10.2\",\n-        \"lodash\": \"^4.17.14\",\n-        \"slice-ansi\": \"^2.1.0\",\n-        \"string-width\": \"^3.0.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=6.0.0\"\n-      }\n-    },\n-    \"node_modules/table/node_modules/emoji-regex\": {\n-      \"version\": \"7.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/emoji-regex/-/emoji-regex-7.0.3.tgz\",\n-      \"integrity\": \"sha512-CwBLREIQ7LvYFB0WyRvwhq5N5qPhc6PMjD6bYggFlI5YyDgl+0vxq5VHbMOFqLg7hfWzmu8T5Z1QofhmTIhItA==\",\n-      \"dev\": true\n-    },\n-    \"node_modules/table/node_modules/is-fullwidth-code-point\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/is-fullwidth-code-point/-/is-fullwidth-code-point-2.0.0.tgz\",\n-      \"integrity\": \"sha512-VHskAKYM8RfSFXwee5t5cbN5PZeq1Wrh6qd5bkyiXIf6UQcN6w/A0eXM9r6t8d+GYOh+o6ZhiEnb88LN/Y8m2w==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=4\"\n-      }\n-    },\n-    \"node_modules/table/node_modules/string-width\": {\n-      \"version\": \"3.1.0\",\n-      \"resolved\": \"https://registry.npmjs.org/string-width/-/string-width-3.1.0.tgz\",\n-      \"integrity\": \"sha512-vafcv6KjVZKSgz06oM/H6GDBrAtz8vdhQakGjFIvNrHA6y3HCF1CInLy+QLq8dTJPQ1b+KDUqDFctkdRW44e1w==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"emoji-regex\": \"^7.0.1\",\n-        \"is-fullwidth-code-point\": \"^2.0.0\",\n-        \"strip-ansi\": \"^5.1.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=6\"\n-      }\n-    },\n     \"node_modules/tapable\": {\n       \"version\": \"2.2.1\",\n       \"resolved\": \"https://registry.npmjs.org/tapable/-/tapable-2.2.1.tgz\",\n@@ -8135,18 +7912,6 @@\n         \"randombytes\": \"^2.1.0\"\n       }\n     },\n-    \"node_modules/terser/node_modules/acorn\": {\n-      \"version\": \"8.8.2\",\n-      \"resolved\": \"https://registry.npmjs.org/acorn/-/acorn-8.8.2.tgz\",\n-      \"integrity\": \"sha512-xjIYgE8HBrkpd/sJqOGNspf8uHG+NOHGOw6a/Urj8taM2EXfdNAH2oFcPeIFfsv3+kz/mJrS5VuMqbNLjCa2vw==\",\n-      \"dev\": true,\n-      \"bin\": {\n-        \"acorn\": \"bin/acorn\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=0.4.0\"\n-      }\n-    },\n     \"node_modules/test-exclude\": {\n       \"version\": \"6.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/test-exclude/-/test-exclude-6.0.0.tgz\",\n@@ -8187,18 +7952,6 @@\n       \"resolved\": \"https://registry.npmjs.org/ticky/-/ticky-1.0.1.tgz\",\n       \"integrity\": \"sha512-RX35iq/D+lrsqhcPWIazM9ELkjOe30MSeoBHQHSsRwd1YuhJO5ui1K1/R0r7N3mFvbLBs33idw+eR6j+w6i/DA==\"\n     },\n-    \"node_modules/tmp\": {\n-      \"version\": \"0.0.33\",\n-      \"resolved\": \"https://registry.npmjs.org/tmp/-/tmp-0.0.33.tgz\",\n-      \"integrity\": \"sha512-jRCJlojKnZ3addtTOjdIqoRuPEKBvNXcGYqzO6zWZX8KfKEpnGY5jfggJQ3EjKuu8D4bJRr0y+cYJFmYbImXGw==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"os-tmpdir\": \"~1.0.2\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=0.6.0\"\n-      }\n-    },\n     \"node_modules/to-fast-properties\": {\n       \"version\": \"2.0.0\",\n       \"resolved\": \"https://registry.npmjs.org/to-fast-properties/-/to-fast-properties-2.0.0.tgz\",\n@@ -8220,6 +7973,18 @@\n         \"node\": \">=8.0\"\n       }\n     },\n+    \"node_modules/ts-api-utils\": {\n+      \"version\": \"1.3.0\",\n+      \"resolved\": \"https://registry.npmjs.org/ts-api-utils/-/ts-api-utils-1.3.0.tgz\",\n+      \"integrity\": \"sha512-UQMIo7pb8WRomKR1/+MFVLTroIvDVtMX3K6OUir8ynLyzB8Jeriont2bTAtmNPa1ekAgN7YPDyf6V+ygrdU+eQ==\",\n+      \"dev\": true,\n+      \"engines\": {\n+        \"node\": \">=16\"\n+      },\n+      \"peerDependencies\": {\n+        \"typescript\": \">=4.2.0\"\n+      }\n+    },\n     \"node_modules/ts-loader\": {\n       \"version\": \"9.4.2\",\n       \"resolved\": \"https://registry.npmjs.org/ts-loader/-/ts-loader-9.4.2.tgz\",\n@@ -8309,34 +8074,13 @@\n         \"node\": \">=8\"\n       }\n     },\n-    \"node_modules/tslib\": {\n-      \"version\": \"1.14.1\",\n-      \"resolved\": \"https://registry.npmjs.org/tslib/-/tslib-1.14.1.tgz\",\n-      \"integrity\": \"sha512-Xni35NKzjgMrwevysHTCArtLDpPvye8zV/0E4EyYn43P7/7qvQwPh9BGkHewbMulVntbigmcT7rdX3BNo9wRJg==\",\n-      \"dev\": true\n-    },\n-    \"node_modules/tsutils\": {\n-      \"version\": \"3.21.0\",\n-      \"resolved\": \"https://registry.npmjs.org/tsutils/-/tsutils-3.21.0.tgz\",\n-      \"integrity\": \"sha512-mHKK3iUXL+3UF6xL5k0PEhKRUBKPBCv/+RkEOpjRWxxx27KKRBmmA60A9pgOUvMi8GKhRMPEmjBRPzs2W7O1OA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"tslib\": \"^1.8.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 6\"\n-      },\n-      \"peerDependencies\": {\n-        \"typescript\": \">=2.8.0 || >= 3.2.0-dev || >= 3.3.0-dev || >= 3.4.0-dev || >= 3.5.0-dev || >= 3.6.0-dev || >= 3.6.0-beta || >= 3.7.0-dev || >= 3.7.0-beta\"\n-      }\n-    },\n     \"node_modules/type-check\": {\n-      \"version\": \"0.3.2\",\n-      \"resolved\": \"https://registry.npmjs.org/type-check/-/type-check-0.3.2.tgz\",\n-      \"integrity\": \"sha512-ZCmOJdvOWDBYJlzAoFkC+Q0+bUyEOS1ltgp1MGU03fqHG+dbi9tBFU2Rd9QKiDZFAYrhPh2JUf7rZRIuHRKtOg==\",\n+      \"version\": \"0.4.0\",\n+      \"resolved\": \"https://registry.npmjs.org/type-check/-/type-check-0.4.0.tgz\",\n+      \"integrity\": \"sha512-XleUoc9uwGXqjWwXaUTZAmzMcFZ5858QA2vvx1Ur5xIcixXIP+8LnFDgRplU30us6teqdlskFfu+ae4K79Ooew==\",\n       \"dev\": true,\n       \"dependencies\": {\n-        \"prelude-ls\": \"~1.1.2\"\n+        \"prelude-ls\": \"^1.2.1\"\n       },\n       \"engines\": {\n         \"node\": \">= 0.8.0\"\n@@ -8586,27 +8330,13 @@\n         \"url\": \"https://github.com/sponsors/ljharb\"\n       }\n     },\n-    \"node_modules/uuid\": {\n-      \"version\": \"3.4.0\",\n-      \"resolved\": \"https://registry.npmjs.org/uuid/-/uuid-3.4.0.tgz\",\n-      \"integrity\": \"sha512-HjSDRw6gZE5JMggctHBcjVak08+KEVhSIiDzFnT9S9aegmp85S/bReBVTb4QTFaRNptJ9kuYaNhnbNEOkbKb/A==\",\n-      \"deprecated\": \"Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.\",\n-      \"bin\": {\n-        \"uuid\": \"bin/uuid\"\n-      }\n-    },\n-    \"node_modules/v8-compile-cache\": {\n-      \"version\": \"2.3.0\",\n-      \"resolved\": \"https://registry.npmjs.org/v8-compile-cache/-/v8-compile-cache-2.3.0.tgz\",\n-      \"integrity\": \"sha512-l8lCEmLcLYZh4nbunNZvQCJc5pv7+RCwa8q/LdUx8u7lsWvPDKmpodJAJNwkAhJC//dFY48KuIEmjtd4RViDrA==\",\n-      \"dev\": true\n-    },\n     \"node_modules/vue\": {\n-      \"version\": \"2.7.14\",\n-      \"resolved\": \"https://registry.npmjs.org/vue/-/vue-2.7.14.tgz\",\n-      \"integrity\": \"sha512-b2qkFyOM0kwqWFuQmgd4o+uHGU7T+2z3T+WQp8UBjADfEv2n4FEMffzBmCKNP0IGzOEEfYjvtcC62xaSKeQDrQ==\",\n+      \"version\": \"2.7.16\",\n+      \"resolved\": \"https://registry.npmjs.org/vue/-/vue-2.7.16.tgz\",\n+      \"integrity\": \"sha512-4gCtFXaAA3zYZdTp5s4Hl2sozuySsgz4jy1EnpBHNfpMa9dK1ZCG7viqBPCwXtmgc8nHqUsAu3G4gtmXkkY3Sw==\",\n+      \"deprecated\": \"Vue 2 has reached EOL and is no longer actively maintained. See https://v2.vuejs.org/eol/ for more details.\",\n       \"dependencies\": {\n-        \"@vue/compiler-sfc\": \"2.7.14\",\n+        \"@vue/compiler-sfc\": \"2.7.16\",\n         \"csstype\": \"^3.1.0\"\n       }\n     },\n@@ -8746,9 +8476,9 @@\n       }\n     },\n     \"node_modules/vue-template-compiler\": {\n-      \"version\": \"2.7.14\",\n-      \"resolved\": \"https://registry.npmjs.org/vue-template-compiler/-/vue-template-compiler-2.7.14.tgz\",\n-      \"integrity\": \"sha512-zyA5Y3ArvVG0NacJDkkzJuPQDF8RFeRlzV2vLeSnhSpieO6LK2OVbdLPi5MPPs09Ii+gMO8nY4S3iKQxBxDmWQ==\",\n+      \"version\": \"2.7.16\",\n+      \"resolved\": \"https://registry.npmjs.org/vue-template-compiler/-/vue-template-compiler-2.7.16.tgz\",\n+      \"integrity\": \"sha512-AYbUWAJHLGGQM7+cNTELw+KsOG9nl2CnSv467WobS5Cv9uk3wFcnr1Etsz2sEIHEZvw1U+o9mRlEO6QbZvUPGQ==\",\n       \"dev\": true,\n       \"dependencies\": {\n         \"de-indent\": \"^1.0.2\",\n@@ -8891,65 +8621,6 @@\n         \"node\": \"^12.20.0 || >=14\"\n       }\n     },\n-    \"node_modules/webpack-cli/node_modules/cross-spawn\": {\n-      \"version\": \"7.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/cross-spawn/-/cross-spawn-7.0.3.tgz\",\n-      \"integrity\": \"sha512-iRDPJKUPVEND7dHPO8rkbOnPpyDygcDFtWjpeWNCgy8WP2rXcxXL8TskReQl6OrB2G7+UJrags1q15Fudc7G6w==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"path-key\": \"^3.1.0\",\n-        \"shebang-command\": \"^2.0.0\",\n-        \"which\": \"^2.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 8\"\n-      }\n-    },\n-    \"node_modules/webpack-cli/node_modules/path-key\": {\n-      \"version\": \"3.1.1\",\n-      \"resolved\": \"https://registry.npmjs.org/path-key/-/path-key-3.1.1.tgz\",\n-      \"integrity\": \"sha512-ojmeN0qd+y0jszEtoY48r0Peq5dwMEkIlCOu6Q5f41lfkswXuKtYrhgoTpLnyIcHm24Uhqx+5Tqm2InSwLhE6Q==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/webpack-cli/node_modules/shebang-command\": {\n-      \"version\": \"2.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/shebang-command/-/shebang-command-2.0.0.tgz\",\n-      \"integrity\": \"sha512-kHxr2zZpYtdmrN1qDjrrX/Z1rR1kG8Dx+gkpK1G4eXmvXswmcE1hTWBWYUzlraYw1/yZp6YuDY77YtvbN0dmDA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"shebang-regex\": \"^3.0.0\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/webpack-cli/node_modules/shebang-regex\": {\n-      \"version\": \"3.0.0\",\n-      \"resolved\": \"https://registry.npmjs.org/shebang-regex/-/shebang-regex-3.0.0.tgz\",\n-      \"integrity\": \"sha512-7++dFhtcx3353uBaq8DDR4NuxBetBzC7ZQOhmTQInHEd6bSrXdiEyzCvG07Z44UYdLShWUyXt5M/yhz8ekcb1A==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n-    \"node_modules/webpack-cli/node_modules/which\": {\n-      \"version\": \"2.0.2\",\n-      \"resolved\": \"https://registry.npmjs.org/which/-/which-2.0.2.tgz\",\n-      \"integrity\": \"sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"isexe\": \"^2.0.0\"\n-      },\n-      \"bin\": {\n-        \"node-which\": \"bin/node-which\"\n-      },\n-      \"engines\": {\n-        \"node\": \">= 8\"\n-      }\n-    },\n     \"node_modules/webpack-merge\": {\n       \"version\": \"5.8.0\",\n       \"resolved\": \"https://registry.npmjs.org/webpack-merge/-/webpack-merge-5.8.0.tgz\",\n@@ -8972,18 +8643,6 @@\n         \"node\": \">=10.13.0\"\n       }\n     },\n-    \"node_modules/webpack/node_modules/acorn\": {\n-      \"version\": \"8.8.2\",\n-      \"resolved\": \"https://registry.npmjs.org/acorn/-/acorn-8.8.2.tgz\",\n-      \"integrity\": \"sha512-xjIYgE8HBrkpd/sJqOGNspf8uHG+NOHGOw6a/Urj8taM2EXfdNAH2oFcPeIFfsv3+kz/mJrS5VuMqbNLjCa2vw==\",\n-      \"dev\": true,\n-      \"bin\": {\n-        \"acorn\": \"bin/acorn\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=0.4.0\"\n-      }\n-    },\n     \"node_modules/webpack/node_modules/acorn-import-assertions\": {\n       \"version\": \"1.8.0\",\n       \"resolved\": \"https://registry.npmjs.org/acorn-import-assertions/-/acorn-import-assertions-1.8.0.tgz\",\n@@ -9012,15 +8671,18 @@\n       }\n     },\n     \"node_modules/which\": {\n-      \"version\": \"1.3.1\",\n-      \"resolved\": \"https://registry.npmjs.org/which/-/which-1.3.1.tgz\",\n-      \"integrity\": \"sha512-HxJdYWq1MTIQbJ3nw0cqssHoTNU267KlrDuGZ1WYlxDStUtKUhOaJmh112/TZmHxxUfuJqPXSOm7tDyas0OSIQ==\",\n+      \"version\": \"2.0.2\",\n+      \"resolved\": \"https://registry.npmjs.org/which/-/which-2.0.2.tgz\",\n+      \"integrity\": \"sha512-BLI3Tl1TW3Pvl70l3yq3Y64i+awpwXqsGBYWkkqMtnbXgrMD+yj7rhW0kuEDxzJaYXGjEW5ogapKNMEKNMjibA==\",\n       \"dev\": true,\n       \"dependencies\": {\n         \"isexe\": \"^2.0.0\"\n       },\n       \"bin\": {\n-        \"which\": \"bin/which\"\n+        \"node-which\": \"bin/node-which\"\n+      },\n+      \"engines\": {\n+        \"node\": \">= 8\"\n       }\n     },\n     \"node_modules/which-boxed-primitive\": {\n@@ -9103,15 +8765,6 @@\n         \"url\": \"https://github.com/chalk/wrap-ansi?sponsor=1\"\n       }\n     },\n-    \"node_modules/wrap-ansi/node_modules/ansi-regex\": {\n-      \"version\": \"5.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/ansi-regex/-/ansi-regex-5.0.1.tgz\",\n-      \"integrity\": \"sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z/ZZJMlMWv37qOOb9pdJlMUEKFQ==\",\n-      \"dev\": true,\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/wrap-ansi/node_modules/ansi-styles\": {\n       \"version\": \"4.3.0\",\n       \"resolved\": \"https://registry.npmjs.org/ansi-styles/-/ansi-styles-4.3.0.tgz\",\n@@ -9145,36 +8798,12 @@\n       \"integrity\": \"sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU/uBL/ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==\",\n       \"dev\": true\n     },\n-    \"node_modules/wrap-ansi/node_modules/strip-ansi\": {\n-      \"version\": \"6.0.1\",\n-      \"resolved\": \"https://registry.npmjs.org/strip-ansi/-/strip-ansi-6.0.1.tgz\",\n-      \"integrity\": \"sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+/0ooI7KrPuUSztUdU5A==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"ansi-regex\": \"^5.0.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=8\"\n-      }\n-    },\n     \"node_modules/wrappy\": {\n       \"version\": \"1.0.2\",\n       \"resolved\": \"https://registry.npmjs.org/wrappy/-/wrappy-1.0.2.tgz\",\n       \"integrity\": \"sha512-l4Sp/DRseor9wL6EvV2+TuQn63dMkPjZ/sp9XkghTEbV9KlPS1xUsZ3u7/IQO4wxtcFB4bgpQPRcR3QCvezPcQ==\",\n       \"dev\": true\n     },\n-    \"node_modules/write\": {\n-      \"version\": \"1.0.3\",\n-      \"resolved\": \"https://registry.npmjs.org/write/-/write-1.0.3.tgz\",\n-      \"integrity\": \"sha512-/lg70HAjtkUgWPVZhZcm+T4hkL8Zbtp1nFNOn3lRrxnlv50SRBv7cR7RqR+GMsd3hUXy9hWBo4CHTbFTcOYwig==\",\n-      \"dev\": true,\n-      \"dependencies\": {\n-        \"mkdirp\": \"^0.5.1\"\n-      },\n-      \"engines\": {\n-        \"node\": \">=4\"\n-      }\n-    },\n     \"node_modules/write-file-atomic\": {\n       \"version\": \"3.0.3\",\n       \"resolved\": \"https://registry.npmjs.org/write-file-atomic/-/write-file-atomic-3.0.3.tgz\","
            },
            {
                "sha": "6c2c9677ffa2c1b5acaa33b8f347baf83cd5eb68",
                "filename": "package.json",
                "status": "modified",
                "additions": 5,
                "deletions": 8,
                "changes": 13,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/package.json",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/package.json",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/package.json?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -31,16 +31,14 @@\n     \"@types/sinon\": \"^17.0.2\",\n     \"@types/sinon-chai\": \"^3.2.12\",\n     \"@types/sinon-chrome\": \"^2.2.10\",\n-    \"@types/uuid\": \"^3.4.9\",\n-    \"@typescript-eslint/eslint-plugin\": \"^2.34.0\",\n-    \"@typescript-eslint/parser\": \"^2.34.0\",\n-    \"@vue/runtime-dom\": \"^3.2.47\",\n+    \"@typescript-eslint/eslint-plugin\": \"^7.15.0\",\n+    \"@typescript-eslint/parser\": \"^7.15.0\",\n     \"@vue/test-utils\": \"^1.1.1\",\n     \"base64-loader\": \"^1.0.0\",\n     \"buffer\": \"^6.0.3\",\n     \"chai\": \"^4.2.0\",\n     \"crypto-js\": \"^4.1.1\",\n-    \"eslint\": \"^6.8.0\",\n+    \"eslint\": \"^8.56.0\",\n     \"fork-ts-checker-webpack-plugin\": \"^6.5.3\",\n     \"lodash\": \"^4.17.21\",\n     \"mocha\": \"^10.2.0\",\n@@ -60,7 +58,7 @@\n     \"util\": \"^0.12.5\",\n     \"vue-loader\": \"^15.10.1\",\n     \"vue-svg-loader\": \"^0.16.0\",\n-    \"vue-template-compiler\": \"^2.7.0\",\n+    \"vue-template-compiler\": \"^2.7.16\",\n     \"webpack\": \"^5.11.0\",\n     \"webpack-cli\": \"^5.0.0\",\n     \"webpack-merge\": \"^5.0.0\"\n@@ -72,8 +70,7 @@\n     \"node-gost-crypto\": \"^1.0.2\",\n     \"qrcode-generator\": \"^1.4.4\",\n     \"qrcode-reader\": \"^1.0.4\",\n-    \"uuid\": \"^3.4.0\",\n-    \"vue\": \"^2.6.12\",\n+    \"vue\": \"^2.7.16\",\n     \"vue2-dragula\": \"^2.5.4\",\n     \"vuex\": \"^3.4.0\"\n   }"
            },
            {
                "sha": "ea27b3967cc882c8336030ebbd46e108495b2c9e",
                "filename": "src/argon.ts",
                "status": "modified",
                "additions": 7,
                "deletions": 5,
                "changes": 12,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fargon.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fargon.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fargon.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -10,7 +10,7 @@ window.addEventListener(\"message\", (event) => {\n \n   switch (message.action) {\n     case \"hash\":\n-      Argon.hash(message.value).then((hash) => {\n+      Argon.hash(message.value, message.salt).then((hash) => {\n         source.postMessage({ response: hash }, event.origin);\n       });\n       break;\n@@ -28,12 +28,14 @@ window.addEventListener(\"message\", (event) => {\n });\n \n class Argon {\n-  static async hash(value: string) {\n-    const salt = window.crypto.getRandomValues(new Uint8Array(16));\n+  static async hash(value: string, salt: string | Uint8Array) {\n     const hash = await argon2.hash({\n       pass: value,\n-      salt,\n-      mem: 1024 * 16,\n+      salt: salt,\n+      time: 2,\n+      mem: 1024 * 19,\n+      parallelism: 1,\n+      hashLen: 32,\n       type: argon2.ArgonType.Argon2id,\n     });\n "
            },
            {
                "sha": "f84d78f9109aea2f12880ef3f1eb294172b3f0ab",
                "filename": "src/background.ts",
                "status": "modified",
                "additions": 37,
                "deletions": 21,
                "changes": 58,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fbackground.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fbackground.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fbackground.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -2,8 +2,12 @@ import { getCredentials } from \"./models/credentials\";\n import { Encryption } from \"./models/encryption\";\n import { EntryStorage, ManagedStorage } from \"./models/storage\";\n import { Dropbox, Drive, OneDrive } from \"./models/backup\";\n-import * as uuid from \"uuid/v4\";\n-import { getSiteName, getMatchedEntries, getCurrentTab } from \"./utils\";\n+import {\n+  getSiteName,\n+  getMatchedEntries,\n+  getCurrentTab,\n+  okToInjectContentScript,\n+} from \"./utils\";\n import { CodeState } from \"./models/otp\";\n \n import { getOTPAuthPerLineFromOPTAuthMigration } from \"./models/migration\";\n@@ -30,13 +34,16 @@ chrome.runtime.onMessage.addListener(async (message, sender) => {\n   } else if (message.action === \"getTotp\") {\n     getTotp(message.info);\n   } else if (message.action === \"cachePassphrase\") {\n-    chrome.storage.session.set({ cachedPassphrase: message.value });\n+    chrome.storage.session.set({\n+      cachedPassphrase: message.value,\n+      cachedKeyId: message.keyId,\n+    });\n     chrome.alarms.clear(\"autolock\");\n     setAutolock();\n   } else if ([\"dropbox\", \"drive\", \"onedrive\"].indexOf(message.action) > -1) {\n     getBackupToken(message.action);\n   } else if (message.action === \"lock\") {\n-    chrome.storage.session.set({ cachedPassphrase: null });\n+    chrome.storage.session.set({ cachedPassphrase: null, cachedKeyId: null });\n   } else if (message.action === \"resetAutolock\") {\n     chrome.alarms.clear(\"autolock\");\n     setAutolock();\n@@ -51,11 +58,14 @@ chrome.runtime.onMessage.addListener(async (message, sender) => {\n });\n \n chrome.alarms.onAlarm.addListener(() => {\n-  chrome.storage.session.set({ cachedPassphrase: null });\n+  chrome.storage.session.set({ cachedPassphrase: null, cachedKeyId: null });\n   if (contentTab && contentTab.id) {\n     chrome.tabs.sendMessage(contentTab.id, { action: \"stopCapture\" });\n   }\n   chrome.runtime.sendMessage({ action: \"stopImport\" });\n+\n+  // https://stackoverflow.com/a/56483156\n+  return true;\n });\n \n async function getCapture(tab: chrome.tabs.Tab) {\n@@ -136,9 +146,10 @@ async function getTotp(text: string, silent = false) {\n         account = label;\n       }\n       const parameters = parameterPart.split(\"&\");\n-      const { cachedPassphrase } = await chrome.storage.session.get(\n-        \"cachedPassphrase\"\n-      );\n+      const {\n+        cachedPassphrase,\n+        cachedKeyId,\n+      } = await chrome.storage.session.get();\n       parameters.forEach((item) => {\n         const parameter = item.split(\"=\");\n         if (parameter[0].toLowerCase() === \"secret\") {\n@@ -177,8 +188,8 @@ async function getTotp(text: string, silent = false) {\n         !silent && chrome.tabs.sendMessage(id, { action: \"secretqr\", secret });\n         return false;\n       } else {\n-        const encryption = new Encryption(cachedPassphrase);\n-        const hash = await uuid();\n+        const encryption = new Encryption(cachedPassphrase, cachedKeyId);\n+        const hash = crypto.randomUUID();\n         if (\n           !/^[2-7a-z]+=*$/i.test(secret) &&\n           /^[0-9a-f]+$/i.test(secret) &&\n@@ -192,7 +203,7 @@ async function getTotp(text: string, silent = false) {\n         ) {\n           type = \"hhex\";\n         }\n-        const entryData: { [hash: string]: OTPStorage } = {};\n+        const entryData: { [hash: string]: RawOTPStorage } = {};\n         entryData[hash] = {\n           account,\n           hash,\n@@ -400,10 +411,8 @@ function getBackupToken(service: string) {\n }\n \n async function uploadBackup(service: string) {\n-  const { cachedPassphrase } = await chrome.storage.session.get(\n-    \"cachedPassphrase\"\n-  );\n-  const encryption = new Encryption(cachedPassphrase);\n+  const { cachedPassphrase, cachedKeyId } = await chrome.storage.session.get();\n+  const encryption = new Encryption(cachedPassphrase, cachedKeyId);\n \n   switch (service) {\n     case \"dropbox\":\n@@ -440,12 +449,13 @@ chrome.runtime.onInstalled.addListener(async (details) => {\n   if (url) {\n     chrome.tabs.create({ url, active: true });\n   }\n+\n+  // https://stackoverflow.com/a/56483156\n+  return true;\n });\n \n chrome.commands.onCommand.addListener(async (command: string) => {\n-  const { cachedPassphrase } = await chrome.storage.session.get(\n-    \"cachedPassphrase\"\n-  );\n+  const { cachedPassphrase, cachedKeyId } = await chrome.storage.session.get();\n \n   let tab: chrome.tabs.Tab | undefined;\n \n@@ -456,7 +466,7 @@ chrome.commands.onCommand.addListener(async (command: string) => {\n       }\n \n       tab = await getCurrentTab();\n-      if (tab.id) {\n+      if (okToInjectContentScript(tab)) {\n         await chrome.scripting.executeScript({\n           target: { tabId: tab.id },\n           files: [\"/dist/content.js\"],\n@@ -473,7 +483,7 @@ chrome.commands.onCommand.addListener(async (command: string) => {\n \n     case \"autofill\":\n       tab = await getCurrentTab();\n-      if (tab.id) {\n+      if (okToInjectContentScript(tab)) {\n         await chrome.scripting.executeScript({\n           target: { tabId: tab.id },\n           files: [\"/dist/content.js\"],\n@@ -491,7 +501,7 @@ chrome.commands.onCommand.addListener(async (command: string) => {\n \n         if (matchedEntries && matchedEntries.length === 1) {\n           const entry = matchedEntries[0];\n-          const encryption = new Encryption(cachedPassphrase);\n+          const encryption = new Encryption(cachedPassphrase, cachedKeyId);\n           entry.applyEncryption(encryption);\n \n           if (\n@@ -510,6 +520,9 @@ chrome.commands.onCommand.addListener(async (command: string) => {\n     default:\n       break;\n   }\n+\n+  // https://stackoverflow.com/a/56483156\n+  return true;\n });\n \n async function setAutolock() {\n@@ -564,6 +577,9 @@ async function updateContextMenu() {\n               height: 400,\n               width: 320,\n             });\n+\n+            // https://stackoverflow.com/a/56483156\n+            return true;\n           });\n         } else {\n           chrome.contextMenus.removeAll();"
            },
            {
                "sha": "e224a82a2d3eaae2a37cd26ed2df28450ee647cc",
                "filename": "src/components/Import.vue",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FImport.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FImport.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FImport.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -66,6 +66,9 @@ export default Vue.extend({\n       if (event.action === \"stopImport\") {\n         this.shouldShowPassphrase = true;\n       }\n+\n+      // https://stackoverflow.com/a/56483156\n+      return true;\n     });\n   },\n });"
            },
            {
                "sha": "f61113f7a8b9d559f17d6449c2084ecd606f1b08",
                "filename": "src/components/Import/FileImport.vue",
                "status": "modified",
                "additions": 17,
                "deletions": 12,
                "changes": 29,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FImport%2FFileImport.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FImport%2FFileImport.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FImport%2FFileImport.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -45,12 +45,12 @@ export default Vue.extend({\n       }\n       if (target.files[0]) {\n         const reader = new FileReader();\n-        let decryptedFileData: { [hash: string]: OTPStorage } = {};\n+        let decryptedFileData: { [hash: string]: RawOTPStorage } = {};\n         reader.onload = async () => {\n           let importData: {\n             // @ts-ignore\n             key?: { enc: string; hash: string };\n-            [hash: string]: OTPStorage;\n+            [hash: string]: RawOTPStorage | Key;\n             // Bug #557, uploaded backups were missing `key`\n             // @ts-ignore\n             enc?: string;\n@@ -74,35 +74,41 @@ export default Vue.extend({\n             succeededCount = result.succeededCount;\n           }\n \n-          let key: { enc: string; hash: string } | null = null;\n+          let key: { enc: string } | null = null;\n \n           if (importData.hasOwnProperty(\"key\")) {\n             if (importData.key) {\n               key = importData.key;\n             }\n             delete importData.key;\n           } else if (importData.enc && importData.hash) {\n-            key = { enc: importData.enc, hash: importData.hash };\n+            key = { enc: importData.enc };\n             delete importData.hash;\n             delete importData.enc;\n           }\n \n-          let encrypted = false;\n           for (const hash in importData) {\n-            if (importData[hash].encrypted) {\n-              encrypted = true;\n+            const possibleEntry = importData[hash];\n+            if (possibleEntry.dataType === \"Key\") {\n+              // don't try to import keys as an OTPEntry\n+              continue;\n+            }\n+\n+            if (possibleEntry.keyId || possibleEntry.encrypted) {\n               try {\n                 const oldPassphrase:\n                   | string\n                   | null = await this.getOldPassphrase();\n \n                 if (key) {\n-                  decryptedFileData = decryptBackupData(\n+                  // v2 encryption\n+                  decryptedFileData = await decryptBackupData(\n                     importData,\n                     CryptoJS.AES.decrypt(key.enc, oldPassphrase).toString()\n                   );\n                 } else {\n-                  decryptedFileData = decryptBackupData(\n+                  // v3 and v1 encryption\n+                  decryptedFileData = await decryptBackupData(\n                     importData,\n                     oldPassphrase\n                   );\n@@ -112,11 +118,10 @@ export default Vue.extend({\n               } catch {\n                 break;\n               }\n+            } else {\n+              decryptedFileData[hash] = possibleEntry;\n             }\n           }\n-          if (!encrypted) {\n-            decryptedFileData = importData;\n-          }\n           if (Object.keys(decryptedFileData).length) {\n             await EntryStorage.import(\n               this.$encryption as Encryption,"
            },
            {
                "sha": "6edd0702d4b39f05c93549cc916a722b27df9322",
                "filename": "src/components/Import/QrImport.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FImport%2FQrImport.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FImport%2FQrImport.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FImport%2FQrImport.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -48,12 +48,12 @@ export default Vue.extend({\n         let importData: {\n           // @ts-ignore\n           key?: { enc: string; hash: string };\n-          [hash: string]: OTPStorage;\n+          [hash: string]: RawOTPStorage;\n         } = result.exportData;\n \n         const { failedCount, succeededCount } = result;\n \n-        let decryptedFileData: { [hash: string]: OTPStorage } = importData;\n+        let decryptedFileData: { [hash: string]: RawOTPStorage } = importData;\n \n         if (Object.keys(decryptedFileData).length) {\n           await EntryStorage.import("
            },
            {
                "sha": "47a5ac19cd02bc84a991607b8b732962e931ad0f",
                "filename": "src/components/Import/TextImport.vue",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FImport%2FTextImport.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FImport%2FTextImport.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FImport%2FTextImport.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -48,7 +48,7 @@ export default Vue.extend({\n       let exportData: {\n         // @ts-ignore\n         key?: { enc: string; hash: string };\n-        [hash: string]: OTPStorage;\n+        [hash: string]: OTPStorage | Key;\n       } = {};\n       let failedCount = 0;\n       let succeededCount = 0;\n@@ -78,15 +78,15 @@ export default Vue.extend({\n             ? this.importPassphrase\n             : null;\n         let decryptedbackupData: {\n-          [hash: string]: OTPStorage;\n+          [hash: string]: RawOTPStorage;\n         } = {};\n         if (key && passphrase) {\n-          decryptedbackupData = decryptBackupData(\n+          decryptedbackupData = await decryptBackupData(\n             exportData,\n             CryptoJS.AES.decrypt(key.enc, passphrase).toString()\n           );\n         } else {\n-          decryptedbackupData = decryptBackupData(exportData, passphrase);\n+          decryptedbackupData = await decryptBackupData(exportData, passphrase);\n         }\n \n         if (Object.keys(decryptedbackupData).length) {"
            },
            {
                "sha": "ca63065feeff6434838d7feb2a7797be0b672e44",
                "filename": "src/components/Popup/AddMethodPage.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FAddMethodPage.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FAddMethodPage.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FPopup%2FAddMethodPage.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -14,7 +14,7 @@\n </template>\n <script lang=\"ts\">\n import Vue from \"vue\";\n-import { getCurrentTab } from \"../../utils\";\n+import { getCurrentTab, okToInjectContentScript } from \"../../utils\";\n export default Vue.extend({\n   methods: {\n     showInfo(page: string) {\n@@ -33,7 +33,7 @@ export default Vue.extend({\n \n       // Insert content script\n       const tab = await getCurrentTab();\n-      if (tab.id) {\n+      if (okToInjectContentScript(tab)) {\n         await chrome.scripting.executeScript({\n           target: { tabId: tab.id },\n           files: [\"/dist/content.js\"],"
            },
            {
                "sha": "8e718b46b09be4c686d5872d6d7438fd02cfc106",
                "filename": "src/components/Popup/BackupPage.vue",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FBackupPage.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FBackupPage.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FPopup%2FBackupPage.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -2,7 +2,7 @@\n   <div>\n     <!-- File Backup -->\n     <div v-show=\"!exportDisabled\">\n-      <div class=\"text warning\" v-if=\"!encryption.getEncryptionStatus()\">\n+      <div class=\"text warning\" v-if=\"!defaultEncryption\">\n         {{ i18n.export_info }}\n       </div>\n       <div class=\"text\">\n@@ -43,12 +43,12 @@\n       <a-button-link\n         download=\"authenticator.json\"\n         :href=\"exportEncryptedFile\"\n-        v-if=\"encryption.getEncryptionStatus() && isDataLinkSupported\"\n+        v-if=\"!!defaultEncryption && isDataLinkSupported\"\n         >{{ i18n.download_enc_backup }}</a-button-link\n       >\n       <button\n         v-on:click=\"downloadBackUpExportEncryptedFile()\"\n-        v-if=\"encryption.getEncryptionStatus() && !isDataLinkSupported\"\n+        v-if=\"!!defaultEncryption && !isDataLinkSupported\"\n         class=\"button\"\n       >\n         {{ i18n.download_enc_backup }}\n@@ -86,8 +86,8 @@ export default Vue.extend({\n     };\n   },\n   computed: {\n-    encryption: function () {\n-      return this.$store.state.accounts.encryption;\n+    defaultEncryption: function () {\n+      return this.$store.state.accounts.defaultEncryption;\n     },\n     exportDisabled: function () {\n       return this.$store.state.menu.exportDisabled;\n@@ -173,7 +173,7 @@ export default Vue.extend({\n   },\n });\n \n-function hasUnsupportedAccounts(exportData: { [h: string]: OTPStorage }) {\n+function hasUnsupportedAccounts(exportData: { [h: string]: RawOTPStorage }) {\n   for (const entry of Object.keys(exportData)) {\n     if (\n       exportData[entry].type === \"battle\" ||\n@@ -186,7 +186,7 @@ function hasUnsupportedAccounts(exportData: { [h: string]: OTPStorage }) {\n }\n \n function getBackupFile(\n-  entryData: { [hash: string]: OTPStorage },\n+  entryData: { [hash: string]: RawOTPStorage },\n   key?: Object\n ) {\n   if (key) {\n@@ -198,7 +198,7 @@ function getBackupFile(\n   return downloadFileUrlBuilder(json);\n }\n \n-function getOneLineOtpBackupFile(entryData: { [hash: string]: OTPStorage }) {\n+function getOneLineOtpBackupFile(entryData: { [hash: string]: RawOTPStorage }) {\n   const otpAuthLines: string[] = [];\n   for (const hash of Object.keys(entryData)) {\n     const otpStorage = entryData[hash];"
            },
            {
                "sha": "351a61bbfc7f9486abc3689815c7d8d9266b7059",
                "filename": "src/components/Popup/DrivePage.vue",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FDrivePage.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FDrivePage.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FPopup%2FDrivePage.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,10 +1,7 @@\n <template>\n   <div>\n     <div>\n-      <div\n-        class=\"text warning\"\n-        v-show=\"!isEncrypted || !encryption.getEncryptionStatus()\"\n-      >\n+      <div class=\"text warning\" v-show=\"!isEncrypted || !defaultEncryption\">\n         {{ i18n.dropbox_risk }}\n       </div>\n       <div v-show=\"backupToken\">\n@@ -13,7 +10,7 @@\n         </div>\n       </div>\n       <a-select-input\n-        v-show=\"encryption.getEncryptionStatus() && backupToken\"\n+        v-show=\"!!defaultEncryption && backupToken\"\n         :label=\"i18n.encrypted\"\n         v-model=\"isEncrypted\"\n       >\n@@ -50,8 +47,8 @@ export default Vue.extend({\n     UserSettings.updateItems();\n   },\n   computed: {\n-    encryption: function () {\n-      return this.$store.state.accounts.encryption;\n+    defaultEncryption: function () {\n+      return this.$store.state.accounts.defaultEncryption;\n     },\n     isEncrypted: {\n       get(): boolean {"
            },
            {
                "sha": "030d2d6ca4e9586e6d28b6495f7869f7ca7cebad",
                "filename": "src/components/Popup/DropboxPage.vue",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FDropboxPage.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FDropboxPage.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FPopup%2FDropboxPage.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,10 +1,7 @@\n <template>\n   <div>\n     <div>\n-      <div\n-        class=\"text warning\"\n-        v-show=\"!isEncrypted || !encryption.getEncryptionStatus()\"\n-      >\n+      <div class=\"text warning\" v-show=\"!isEncrypted || !defaultEncryption\">\n         {{ i18n.dropbox_risk }}\n       </div>\n       <div v-show=\"backupToken\">\n@@ -13,7 +10,7 @@\n         </div>\n       </div>\n       <a-select-input\n-        v-show=\"encryption.getEncryptionStatus() && backupToken\"\n+        v-show=\"!!defaultEncryption && backupToken\"\n         :label=\"i18n.encrypted\"\n         v-model=\"isEncrypted\"\n       >\n@@ -49,8 +46,8 @@ export default Vue.extend({\n     UserSettings.updateItems();\n   },\n   computed: {\n-    encryption: function () {\n-      return this.$store.state.accounts.encryption;\n+    defaultEncryption: function () {\n+      return this.$store.state.accounts.defaultEncryption;\n     },\n     isEncrypted: {\n       get(): boolean {"
            },
            {
                "sha": "92099b5b167b032e726cfa0f6cac1614afee94b0",
                "filename": "src/components/Popup/EntryComponent.vue",
                "status": "modified",
                "additions": 8,
                "deletions": 9,
                "changes": 17,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FEntryComponent.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FEntryComponent.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FPopup%2FEntryComponent.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -90,7 +90,7 @@ import { mapState } from \"vuex\";\n import * as QRGen from \"qrcode-generator\";\n import { OTPEntry, OTPType, CodeState, OTPAlgorithm } from \"../../models/otp\";\n import { EntryStorage } from \"../../models/storage\";\n-import { getCurrentTab } from \"../../utils\";\n+import { getCurrentTab, okToInjectContentScript } from \"../../utils\";\n \n import IconMinusCircle from \"../../../svg/minus-circle.svg\";\n import IconRedo from \"../../../svg/redo.svg\";\n@@ -223,13 +223,12 @@ export default Vue.extend({\n             if (this.$store.state.menu.useAutofill) {\n               await insertContentScript();\n               const tab = await getCurrentTab();\n-              if (!tab || !tab.id) {\n-                return;\n+              if (tab && tab.id) {\n+                chrome.tabs.sendMessage(tab.id, {\n+                  action: \"pastecode\",\n+                  code: entry.code,\n+                });\n               }\n-              chrome.tabs.sendMessage(tab.id, {\n-                action: \"pastecode\",\n-                code: entry.code,\n-              });\n             }\n \n             const lastActiveElement = document.activeElement as HTMLElement;\n@@ -296,8 +295,8 @@ function getQrUrl(entry: OTPEntry) {\n }\n \n async function insertContentScript() {\n-  const tab = await getCurrentTab();\n-  if (tab.id) {\n+  let tab = await getCurrentTab();\n+  if (okToInjectContentScript(tab)) {\n     await chrome.scripting.executeScript({\n       target: { tabId: tab.id },\n       files: [\"/dist/content.js\"],"
            },
            {
                "sha": "f97d778173378d576e0eb5419348a1760d92309c",
                "filename": "src/components/Popup/MainHeader.vue",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FMainHeader.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FMainHeader.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FPopup%2FMainHeader.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -25,15 +25,15 @@\n         id=\"i-lock\"\n         v-bind:title=\"i18n.lock\"\n         v-on:click=\"lock()\"\n-        v-show=\"!style.isEditing && encryption.getEncryptionStatus()\"\n+        v-show=\"!style.isEditing && !!defaultEncryption\"\n       >\n         <IconLock />\n       </div>\n       <div\n         class=\"icon\"\n         id=\"i-sync\"\n         v-bind:style=\"{\n-          left: encryption.getEncryptionStatus() ? '70px' : '45px',\n+          left: !!defaultEncryption ? '70px' : '45px',\n         }\"\n         v-show=\"\n           (dropboxToken || driveToken || oneDriveToken) && !style.isEditing\n@@ -74,7 +74,7 @@\n <script lang=\"ts\">\n import Vue from \"vue\";\n import { mapState } from \"vuex\";\n-import { getCurrentTab } from \"../../utils\";\n+import { getCurrentTab, okToInjectContentScript } from \"../../utils\";\n \n // Icons\n import IconCog from \"../../../svg/cog.svg\";\n@@ -88,7 +88,7 @@ import { isFirefox } from \"../../browser\";\n \n const computedPrototype = [\n   mapState(\"style\", [\"style\"]),\n-  mapState(\"accounts\", [\"encryption\"]),\n+  mapState(\"accounts\", [\"defaultEncryption\"]),\n   mapState(\"backup\", [\"driveToken\", \"dropboxToken\", \"oneDriveToken\"]),\n ];\n \n@@ -127,7 +127,7 @@ export default Vue.extend({\n       if (page === \"AddMethodPage\") {\n         if (\n           this.$store.state.menu.enforcePassword &&\n-          !this.$store.state.accounts.encryption.getEncryptionStatus()\n+          !this.$store.state.accounts.defaultEncryption\n         ) {\n           page = \"SetPasswordPage\";\n         }\n@@ -146,7 +146,7 @@ export default Vue.extend({\n     async beginCapture() {\n       if (\n         this.$store.state.menu.enforcePassword &&\n-        !this.$store.state.accounts.encryption.getEncryptionStatus()\n+        !this.$store.state.accounts.defaultEncryption\n       ) {\n         this.$store.commit(\"style/showInfo\");\n         this.$store.commit(\"currentView/changeView\", \"SetPasswordPage\");\n@@ -160,7 +160,7 @@ export default Vue.extend({\n \n       const tab = await getCurrentTab();\n       // Insert content script\n-      if (tab.id) {\n+      if (okToInjectContentScript(tab)) {\n         await chrome.scripting.executeScript({\n           target: { tabId: tab.id },\n           files: [\"/dist/content.js\"],"
            },
            {
                "sha": "8c93fc7823c2871bcdf75d67b3070327cc25688c",
                "filename": "src/components/Popup/OneDrivePage.vue",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FOneDrivePage.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FOneDrivePage.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FPopup%2FOneDrivePage.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,10 +1,7 @@\n <template>\n   <div>\n     <div>\n-      <div\n-        class=\"text warning\"\n-        v-show=\"!isEncrypted || !encryption.getEncryptionStatus()\"\n-      >\n+      <div class=\"text warning\" v-show=\"!isEncrypted || !defaultEncryption\">\n         {{ i18n.dropbox_risk }}\n       </div>\n       <div v-show=\"backupToken\">\n@@ -13,7 +10,7 @@\n         </div>\n       </div>\n       <a-select-input\n-        v-show=\"encryption.getEncryptionStatus() && backupToken\"\n+        v-show=\"!!defaultEncryption && backupToken\"\n         :label=\"i18n.encrypted\"\n         v-model=\"isEncrypted\"\n       >\n@@ -59,8 +56,8 @@ export default Vue.extend({\n     UserSettings.updateItems();\n   },\n   computed: {\n-    encryption: function () {\n-      return this.$store.state.accounts.encryption;\n+    defaultEncryption: function () {\n+      return this.$store.state.accounts.defaultEncryption;\n     },\n     isEncrypted: {\n       get(): boolean {"
            },
            {
                "sha": "8bace36c80fb67053ae9f52037223ce273e41c55",
                "filename": "src/components/Popup/PreferencesPage.vue",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FPreferencesPage.vue",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcomponents%2FPopup%2FPreferencesPage.vue",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcomponents%2FPopup%2FPreferencesPage.vue?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -43,7 +43,7 @@\n       @change=\"requireContextMenuPermission()\"\n       v-if=\"isSupported\"\n     />\n-    <div class=\"control-group\" v-show=\"encryption.getEncryptionStatus()\">\n+    <div class=\"control-group\" v-show=\"!!defaultEncryption\">\n       <label class=\"combo-label\">{{ i18n.autolock }}</label>\n       <input\n         class=\"input\"\n@@ -107,8 +107,8 @@ export default Vue.extend({\n         this.$store.commit(\"menu/setTheme\", theme);\n       },\n     },\n-    encryption(): EncryptionInterface {\n-      return this.$store.state.accounts.encryption;\n+    defaultEncryption(): string {\n+      return this.$store.state.accounts.defaultEncryption;\n     },\n     enforceAutolock() {\n       return this.$store.state.menu.enforceAutolock;"
            },
            {
                "sha": "5ac1805cf2a8222b964dfcfb3f404687c47e8e9a",
                "filename": "src/content.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcontent.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fcontent.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fcontent.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,10 +1,8 @@\n-// eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n-// @ts-ignore\n+// @ts-expect-error - no typings\n import QRCode from \"qrcode-reader\";\n import jsQR from \"jsqr\";\n \n-// eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n-// @ts-ignore\n+// @ts-expect-error - injected by vue-svg-loader\n import scanGIF from \"../images/scan.gif\";\n \n if (!document.getElementById(\"__ga_grayLayout__\")) {\n@@ -63,6 +61,9 @@ if (!document.getElementById(\"__ga_grayLayout__\")) {\n         // invalid command, ignore it\n         break;\n     }\n+\n+    // https://stackoverflow.com/a/56483156\n+    return true;\n   });\n }\n "
            },
            {
                "sha": "e8935fa4f107e4eecebbc2d73740057e1bf66f36",
                "filename": "src/definitions/gost.d.ts",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fgost.d.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fgost.d.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fdefinitions%2Fgost.d.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -5,7 +5,6 @@ declare module \"node-gost-crypto\" {\n     version: number;\n     length: number;\n   }\n-  // eslint-disable-next-line @typescript-eslint/class-name-casing\n   export class gostEngine {\n     static getGostDigest(alg: AlgorithmIndentifier): GostDigest;\n   }"
            },
            {
                "sha": "49426631578c7acfee84cd7f13b511ce1adfc5b2",
                "filename": "src/definitions/module-interface.d.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fmodule-interface.d.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fmodule-interface.d.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fdefinitions%2Fmodule-interface.d.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,3 +1,4 @@\n+/* eslint-disable @typescript-eslint/ban-types */\n interface Module {\n   getModule(): Promise<VuexConstructor> | VuexConstructor;\n }\n@@ -59,7 +60,8 @@ interface StyleState {\n \n interface AccountsState {\n   entries: OTPEntryInterface[];\n-  encryption: EncryptionInterface;\n+  defaultEncryption: string;\n+  encryption: Map<string, EncryptionInterface>;\n   OTPType: number;\n   shouldShowPassphrase: boolean;\n   sectorStart: boolean;\n@@ -70,8 +72,8 @@ interface AccountsState {\n   siteName: (string | null)[];\n   showSearch: boolean;\n   exportData: { [k: string]: OTPEntryInterface };\n-  exportEncData: { [k: string]: OTPEntryInterface };\n-  key: { enc: string; hash: string } | null;\n+  exportEncData: { [k: string]: OTPEntryInterface | Key };\n+  keys: OldKey | Key[];\n   wrongPassword: boolean;\n   initComplete: boolean;\n }"
            },
            {
                "sha": "c55fb14865a76a19ecc05b7be50e543dba20f3ba",
                "filename": "src/definitions/otp.d.ts",
                "status": "modified",
                "additions": 34,
                "deletions": 3,
                "changes": 37,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fotp.d.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fotp.d.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fdefinitions%2Fotp.d.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -2,7 +2,6 @@ interface OTPEntryInterface {\n   type: number; // OTPType\n   index: number;\n   issuer: string;\n-  encSecret: string | null;\n   secret: string | null;\n   account: string;\n   hash: string;\n@@ -12,6 +11,8 @@ interface OTPEntryInterface {\n   digits: number;\n   algorithm: number; // OTPAlgorithm\n   pinned: boolean;\n+  encData?: string;\n+  encryption?: EncryptionInterface;\n   create(): Promise<void>;\n   update(): Promise<void>;\n   next(): Promise<void>;\n@@ -24,14 +25,19 @@ interface OTPEntryInterface {\n \n interface EncryptionInterface {\n   getEncryptedString(data: string): string;\n-  getDecryptedSecret(entry: OTPStorage): string | null;\n+  decryptSecretString(entry: string): string | null;\n+  decryptEncSecret(entry: OTPEntryInterface): RawOTPStorage | null;\n   getEncryptionStatus(): boolean;\n   updateEncryptionPassword(password: string): void;\n+  getEncryptionKeyId(): string;\n+  setEncryptionKeyId(id: string): void;\n }\n \n-interface OTPStorage {\n+interface RawOTPStorage {\n+  dataType?: \"OTPStorage\";\n   account?: string;\n   encrypted: boolean;\n+  keyId?: string;\n   hash: string;\n   index: number;\n   issuer?: string;\n@@ -43,3 +49,28 @@ interface OTPStorage {\n   algorithm?: string;\n   pinned?: boolean;\n }\n+\n+interface EncOTPStorage {\n+  dataType: \"EncOTPStorage\";\n+  keyId: string;\n+  data: string;\n+  index: number;\n+}\n+\n+type OTPStorage = RawOTPStorage | EncOTPStorage;\n+\n+interface OldKey {\n+  enc: string;\n+  hash: string;\n+}\n+\n+interface Key {\n+  dataType: \"Key\";\n+  // UUID\n+  id: string;\n+  // Salt used to generate encryption key\n+  salt: string;\n+  // Hash of the encryption key\n+  hash: string;\n+  version: 3;\n+}"
            },
            {
                "sha": "bac18c75215a0ada534c4c89e07dacee386f42f0",
                "filename": "src/definitions/shims-vue.d.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fshims-vue.d.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fshims-vue.d.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fdefinitions%2Fshims-vue.d.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,6 +1,6 @@\n /* eslint-disable @typescript-eslint/no-explicit-any */\n declare module \"*.vue\" {\n-  import Vue, { VueConstructor } from \"vue\";\n+  import Vue from \"vue\";\n   export default Vue;\n }\n "
            },
            {
                "sha": "236017a1531ff3f5847fc8cc4c18316f43c6fe88",
                "filename": "src/definitions/vue.d.ts",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fvue.d.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fdefinitions%2Fvue.d.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fdefinitions%2Fvue.d.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,5 +1,4 @@\n /* eslint-disable @typescript-eslint/no-explicit-any */\n-import Vue from \"vue\";\n import { Store } from \"vuex\";\n \n declare module \"vue/types/vue\" {"
            },
            {
                "sha": "21bebdabbb1fae67fd323f55fe8ef90b02a327b2",
                "filename": "src/import.ts",
                "status": "modified",
                "additions": 127,
                "deletions": 24,
                "changes": 151,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fimport.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fimport.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fimport.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -7,7 +7,6 @@ import { Encryption } from \"./models/encryption\";\n import { EntryStorage } from \"./models/storage\";\n import { getOTPAuthPerLineFromOPTAuthMigration } from \"./models/migration\";\n import * as CryptoJS from \"crypto-js\";\n-import * as uuid from \"uuid/v4\";\n \n async function init() {\n   // i18n\n@@ -19,7 +18,11 @@ async function init() {\n   }\n \n   // Load entries to global\n-  const encryption = new Encryption(await getCachedPassphrase());\n+  const cachedSecrets = await getCachedSecrets();\n+  const encryption = new Encryption(\n+    cachedSecrets.cachedPassphrase,\n+    cachedSecrets.cachedKeyId\n+  );\n   const entries = await EntryStorage.get();\n \n   if (encryption.getEncryptionStatus()) {\n@@ -45,53 +48,153 @@ async function init() {\n \n init();\n \n-async function getCachedPassphrase() {\n-  const { cachedPassphrase } = await chrome.storage.session.get(\n-    \"cachedPassphrase\"\n-  );\n+async function getCachedSecrets() {\n+  const { cachedPassphrase, cachedKeyId } = await chrome.storage.session.get();\n \n-  return cachedPassphrase;\n+  return { cachedPassphrase, cachedKeyId };\n }\n \n-export function decryptBackupData(\n-  backupData: { [hash: string]: OTPStorage },\n+export async function decryptBackupData(\n+  backupData: { [hash: string]: OTPStorage | Key },\n   passphrase: string | null\n ) {\n-  const decryptedbackupData: { [hash: string]: OTPStorage } = {};\n-  for (const hash of Object.keys(backupData)) {\n-    if (typeof backupData[hash] !== \"object\") {\n+  const decryptedBackupData: { [hash: string]: RawOTPStorage } = {};\n+  const keys: Map<string, string | null> = new Map();\n+  for (const hash in backupData) {\n+    const unknownStorageItem = backupData[hash];\n+    if (\n+      typeof unknownStorageItem !== \"object\" ||\n+      unknownStorageItem.dataType === \"Key\"\n+    ) {\n       continue;\n     }\n-    if (!backupData[hash].secret) {\n+    let storageItem: RawOTPStorage;\n+    if (unknownStorageItem.dataType === \"EncOTPStorage\") {\n+      if (!passphrase) {\n+        continue;\n+      }\n+\n+      if (!keys.has(unknownStorageItem.keyId)) {\n+        keys.set(\n+          unknownStorageItem.keyId,\n+          await findAndUnlockKey(\n+            backupData,\n+            unknownStorageItem.keyId,\n+            passphrase\n+          )\n+        );\n+      }\n+      const decryptKey = keys.get(unknownStorageItem.keyId);\n+      if (!decryptKey) {\n+        // wrong password for key\n+        continue;\n+      }\n+\n+      storageItem = {\n+        ...unknownStorageItem,\n+        ...JSON.parse(\n+          CryptoJS.AES.decrypt(unknownStorageItem.data, decryptKey).toString(\n+            CryptoJS.enc.Utf8\n+          )\n+        ),\n+        encrypted: false,\n+      };\n+    } else {\n+      storageItem = unknownStorageItem;\n+    }\n+    if (!storageItem.secret) {\n       continue;\n     }\n-    if (backupData[hash].encrypted && !passphrase) {\n+    if (storageItem.encrypted && !passphrase) {\n       continue;\n     }\n-    if (backupData[hash].encrypted && passphrase) {\n+    if (storageItem.encrypted && passphrase) {\n       try {\n-        backupData[hash].secret = CryptoJS.AES.decrypt(\n-          backupData[hash].secret,\n+        storageItem.secret = CryptoJS.AES.decrypt(\n+          storageItem.secret,\n           passphrase\n         ).toString(CryptoJS.enc.Utf8);\n-        backupData[hash].encrypted = false;\n+        storageItem.encrypted = false;\n       } catch (error) {\n         continue;\n       }\n     }\n-    // backupData[hash].secret may be empty after decrypt with wrong\n+    // storageItem.secret may be empty after decrypt with wrong\n     // passphrase\n-    if (!backupData[hash].secret) {\n+    if (!storageItem.secret) {\n       continue;\n     }\n-    decryptedbackupData[hash] = backupData[hash];\n+    decryptedBackupData[hash] = storageItem;\n+  }\n+  return decryptedBackupData;\n+}\n+\n+async function findAndUnlockKey(\n+  importData: { [key: string]: OTPStorage | Key },\n+  keyId: string,\n+  password: string\n+): Promise<string | null> {\n+  if (!(keyId in importData)) {\n+    return null;\n+  }\n+\n+  const key = importData[keyId];\n+  if (key.dataType !== \"Key\" || key.id !== keyId) {\n+    return null;\n+  }\n+\n+  const rawHash = await new Promise((resolve: (value: string) => void) => {\n+    const iframe = document.getElementById(\"argon-sandbox\");\n+    const message = {\n+      action: \"hash\",\n+      value: password,\n+      salt: key.salt,\n+    };\n+    if (iframe) {\n+      window.addEventListener(\"message\", (response) => {\n+        resolve(response.data.response);\n+      });\n+      // @ts-expect-error bad typings\n+      iframe.contentWindow.postMessage(message, \"*\");\n+    }\n+  });\n+\n+  // https://passlib.readthedocs.io/en/stable/lib/passlib.hash.argon2.html#format-algorithm\n+  const possibleHash = rawHash.split(\"$\")[5];\n+  if (!possibleHash) {\n+    throw new Error(\"argon2 did not return a hash!\");\n+  }\n+\n+  // verify user password by comparing their password hash with the\n+  // hash of their password's hash\n+  const isCorrectPassword = await new Promise(\n+    (resolve: (value: string) => void) => {\n+      const iframe = document.getElementById(\"argon-sandbox\");\n+      const message = {\n+        action: \"verify\",\n+        value: possibleHash,\n+        hash: key.hash,\n+      };\n+      if (iframe) {\n+        window.addEventListener(\"message\", (response) => {\n+          resolve(response.data.response);\n+        });\n+        // @ts-expect-error bad typings\n+        iframe.contentWindow.postMessage(message, \"*\");\n+      }\n+    }\n+  );\n+\n+  if (!isCorrectPassword) {\n+    return null;\n   }\n-  return decryptedbackupData;\n+\n+  return possibleHash;\n }\n \n export async function getEntryDataFromOTPAuthPerLine(importCode: string) {\n   const lines = importCode.split(\"\\n\");\n-  const exportData: { [hash: string]: OTPStorage } = {};\n+  const exportData: { [hash: string]: RawOTPStorage } = {};\n   let failedCount = 0;\n   let succeededCount = 0;\n   for (let item of lines) {\n@@ -175,7 +278,7 @@ export async function getEntryDataFromOTPAuthPerLine(importCode: string) {\n         failedCount++;\n         continue;\n       } else {\n-        const hash = await uuid();\n+        const hash = crypto.randomUUID();\n         if (\n           !/^[2-7a-z]+=*$/i.test(secret) &&\n           /^[0-9a-f]+$/i.test(secret) &&"
            },
            {
                "sha": "56d3647f99ef05922ba5ed4c10bbad19f7f9721d",
                "filename": "src/mochaReporter.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2FmochaReporter.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2FmochaReporter.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2FmochaReporter.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -24,7 +24,6 @@ export function MochaReporter(runner: Runner) {\n   const tests: Test[] = [];\n \n   runner.on(\"start\", () => {\n-    // eslint-disable-next-line @typescript-eslint/camelcase\n     window.__mocha_test_results__ = {};\n     window.__mocha_test_results__.total = runner.total;\n     window.__mocha_test_results__.completed = false;\n@@ -40,8 +39,7 @@ export function MochaReporter(runner: Runner) {\n         status: test.state,\n       };\n     };\n-    // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n-    // @ts-ignore typings are wrong\n+    // @ts-expect-error typings are wrong\n     window.__mocha_test_results__.tests = tests.map(strip);\n     window.__mocha_test_results__.completed = true;\n "
            },
            {
                "sha": "5484c5727c76689d775190c1a40a2f18c47bd76b",
                "filename": "src/models/backup.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fbackup.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fbackup.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fmodels%2Fbackup.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -280,14 +280,14 @@ export class Drive implements BackupProvider {\n                     UserSettings.items.driveFolder = undefined;\n                     UserSettings.commitItems();\n                     resolve(true);\n+                  } else {\n+                    console.error(res.error.message);\n+                    resolve(false);\n                   }\n                 } else if (res.trashed) {\n                   UserSettings.items.driveFolder = undefined;\n                   UserSettings.commitItems();\n                   resolve(true);\n-                } else if (res.error) {\n-                  console.error(res.error.message);\n-                  resolve(false);\n                 } else {\n                   resolve(true);\n                 }"
            },
            {
                "sha": "ebca10a8542414cad7adeaa462dcea6d01326784",
                "filename": "src/models/encryption.ts",
                "status": "modified",
                "additions": 35,
                "deletions": 4,
                "changes": 39,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fencryption.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fencryption.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fmodels%2Fencryption.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -2,9 +2,11 @@ import * as CryptoJS from \"crypto-js\";\n \n export class Encryption implements EncryptionInterface {\n   private password: string;\n+  private keyId: string;\n \n-  constructor(password: string) {\n-    this.password = password;\n+  constructor(hash: string, keyId: string) {\n+    this.password = hash;\n+    this.keyId = keyId;\n   }\n \n   getEncryptedString(data: string): string {\n@@ -15,10 +17,10 @@ export class Encryption implements EncryptionInterface {\n     }\n   }\n \n-  getDecryptedSecret(entry: { secret: string; hash: string }) {\n+  decryptSecretString(secret: string) {\n     try {\n       const decryptedSecret = CryptoJS.AES.decrypt(\n-        entry.secret,\n+        secret,\n         this.password\n       ).toString(CryptoJS.enc.Utf8);\n \n@@ -46,11 +48,40 @@ export class Encryption implements EncryptionInterface {\n     }\n   }\n \n+  decryptEncSecret(entry: OTPEntryInterface) {\n+    try {\n+      if (!entry.encData) {\n+        return null;\n+      }\n+\n+      const decryptedData = CryptoJS.AES.decrypt(\n+        entry.encData,\n+        this.password\n+      ).toString(CryptoJS.enc.Utf8);\n+\n+      if (!decryptedData) {\n+        return null;\n+      }\n+\n+      return JSON.parse(decryptedData);\n+    } catch (error) {\n+      return null;\n+    }\n+  }\n+\n   getEncryptionStatus(): boolean {\n     return this.password ? true : false;\n   }\n \n   updateEncryptionPassword(password: string) {\n     this.password = password;\n   }\n+\n+  setEncryptionKeyId(id: string): void {\n+    this.keyId = id;\n+  }\n+\n+  getEncryptionKeyId(): string {\n+    return this.keyId;\n+  }\n }"
            },
            {
                "sha": "cdfa38dba256754d7652a61bd9f8272e822d171d",
                "filename": "src/models/otp.ts",
                "status": "modified",
                "additions": 114,
                "deletions": 49,
                "changes": 163,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fotp.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fotp.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fmodels%2Fotp.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,8 +1,6 @@\n-import { Encryption } from \"./encryption\";\n import { KeyUtilities } from \"./key-utilities\";\n import { UserSettings } from \"./settings\";\n import { EntryStorage } from \"./storage\";\n-import * as uuid from \"uuid/v4\";\n \n export enum OTPType {\n   totp = 1,\n@@ -26,6 +24,12 @@ export enum OTPAlgorithm {\n   GOST3411_2012_512,\n }\n \n+export enum DataType {\n+  OTPStorage = \"OTPStorage\",\n+  EncOTPStorage = \"EncOTPStorage\",\n+  Key = \"Key\",\n+}\n+\n export interface OTPAlgorithmSpec {\n   length: number;\n }\n@@ -48,35 +52,72 @@ export class OTPEntry implements OTPEntryInterface {\n   index: number;\n   issuer: string;\n   secret: string | null;\n-  encSecret: string | null;\n   account: string;\n   hash: string;\n   counter: number;\n   period: number;\n   digits: number;\n   algorithm: OTPAlgorithm;\n   pinned: boolean;\n+  encryption?: EncryptionInterface;\n+  encData?: string;\n+  encSecret?: string;\n+  keyId?: string;\n   code = \"&bull;&bull;&bull;&bull;&bull;&bull;\";\n \n   constructor(\n-    entry: {\n-      account?: string;\n-      encrypted: boolean;\n-      index: number;\n-      issuer?: string;\n-      secret: string;\n-      type: OTPType;\n-      counter?: number;\n-      period?: number;\n-      hash?: string;\n-      digits?: number;\n-      algorithm?: OTPAlgorithm;\n-      pinned?: boolean;\n-    },\n-    encryption?: Encryption\n+    entry:\n+      | {\n+          account?: string;\n+          encrypted: boolean;\n+          index: number;\n+          issuer?: string;\n+          secret: string;\n+          type: OTPType;\n+          counter?: number;\n+          period?: number;\n+          hash?: string;\n+          digits?: number;\n+          algorithm?: OTPAlgorithm;\n+          pinned?: boolean;\n+        }\n+      | {\n+          encrypted: true;\n+          keyId: string;\n+          encData: string;\n+          hash: string;\n+          index: number;\n+        },\n+    encryption?: EncryptionInterface\n   ) {\n-    this.type = entry.type;\n+    this.encryption = encryption;\n     this.index = entry.index;\n+\n+    if (\"keyId\" in entry) {\n+      this.encData = entry.encData;\n+      this.secret = null;\n+      this.hash = entry.hash;\n+      this.keyId = entry.keyId;\n+\n+      // defaults\n+      this.type = OTPType.totp;\n+      this.issuer = \"\";\n+      this.account = \"\";\n+      this.counter = 0;\n+      this.period = 30;\n+      this.digits = 6;\n+      this.algorithm = OTPAlgorithm.SHA1;\n+      this.pinned = false;\n+      return;\n+    } else if (entry.encrypted) {\n+      // v2 encryption backwards compat logic\n+      this.secret = null;\n+      this.encSecret = entry.secret;\n+    } else {\n+      this.secret = entry.secret;\n+    }\n+\n+    this.type = entry.type;\n     if (entry.issuer) {\n       this.issuer = entry.issuer;\n     } else {\n@@ -87,20 +128,10 @@ export class OTPEntry implements OTPEntryInterface {\n     } else {\n       this.account = \"\";\n     }\n-    if (entry.encrypted) {\n-      this.encSecret = entry.secret;\n-      this.secret = null;\n-    } else {\n-      this.secret = entry.secret;\n-      this.encSecret = null;\n-      if (encryption && encryption.getEncryptionStatus()) {\n-        this.encSecret = encryption.getEncryptedString(this.secret);\n-      }\n-    }\n     if (entry.hash) {\n       this.hash = entry.hash;\n     } else {\n-      this.hash = uuid(); // UUID\n+      this.hash = crypto.randomUUID();\n     }\n     if (entry.counter) {\n       this.counter = entry.counter;\n@@ -142,31 +173,65 @@ export class OTPEntry implements OTPEntryInterface {\n     return;\n   }\n \n-  changeEncryption(encryption: Encryption) {\n+  changeEncryption(encryption: EncryptionInterface) {\n     if (!this.secret) {\n       return;\n     }\n \n-    if (encryption.getEncryptionStatus()) {\n-      this.encSecret = encryption.getEncryptedString(this.secret);\n-    } else {\n-      this.encSecret = null;\n-    }\n+    this.encryption = encryption;\n     return;\n   }\n \n-  applyEncryption(encryption: Encryption) {\n-    const secret = this.encSecret ? this.encSecret : null;\n-    if (secret) {\n-      this.secret = encryption.getDecryptedSecret({\n-        hash: this.hash,\n-        secret,\n-      });\n-      if (this.type !== OTPType.hotp && this.type !== OTPType.hhex) {\n-        this.generate();\n+  applyEncryption(encryption: EncryptionInterface) {\n+    if (!encryption || !encryption.getEncryptionStatus()) {\n+      return;\n+    }\n+\n+    if (this.encSecret) {\n+      // v2 encryption\n+      this.secret = encryption.decryptSecretString(this.encSecret);\n+      if (this.secret) {\n+        this.encSecret = \"\";\n       }\n+      return;\n     }\n-    return;\n+\n+    // check if its a rawotpstorage\n+    const decryptedData = encryption.decryptEncSecret(this);\n+    if (decryptedData === null) {\n+      return;\n+    }\n+\n+    if (decryptedData?.dataType !== \"OTPStorage\") {\n+      console.warn(\"Decrypt successful, but malformed encData!\", this.hash);\n+    }\n+\n+    if (decryptedData.hash !== this.hash) {\n+      console.warn(\n+        \"Decrypt successful, but hash mismatch!\",\n+        this.hash,\n+        decryptedData.hash\n+      );\n+    }\n+\n+    this.account = decryptedData.account || \"\";\n+    // @ts-expect-error need a better way to do this\n+    this.algorithm = OTPAlgorithm[decryptedData.algorithm] || OTPAlgorithm.SHA1;\n+    this.counter = decryptedData.counter || 0;\n+    this.digits = decryptedData.digits || 6;\n+    this.issuer = decryptedData.issuer || \"\";\n+    this.period = decryptedData.period || 30;\n+    this.pinned = decryptedData.pinned || false;\n+    this.secret = decryptedData.secret;\n+    // @ts-expect-error need a better way to do this\n+    this.type = OTPType[decryptedData.type] || OTPType.totp;\n+\n+    if (this.type !== OTPType.hotp && this.type !== OTPType.hhex) {\n+      this.generate();\n+    }\n+\n+    this.encryption = encryption;\n+    this.encData = \"\";\n   }\n \n   async delete() {\n@@ -187,7 +252,7 @@ export class OTPEntry implements OTPEntryInterface {\n   }\n \n   genUUID() {\n-    this.hash = uuid();\n+    this.hash = crypto.randomUUID();\n   }\n \n   generate() {\n@@ -202,7 +267,7 @@ export class OTPEntry implements OTPEntryInterface {\n       });\n     }\n \n-    if (!this.secret && !this.encSecret) {\n+    if (!this.secret && !this.encData) {\n       this.code = CodeState.Invalid;\n     } else if (!this.secret) {\n       this.code = CodeState.Encrypted;\n@@ -219,7 +284,7 @@ export class OTPEntry implements OTPEntryInterface {\n         );\n       } catch (error) {\n         this.code = CodeState.Invalid;\n-        console.log(\"Invalid secret.\", error);\n+        console.warn(\"Invalid secret.\", error);\n       }\n     }\n   }"
            },
            {
                "sha": "f40cb2e1fc0e4ab707cd27a5c3d5bddbb7e1cedd",
                "filename": "src/models/settings.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fsettings.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fsettings.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fmodels%2Fsettings.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -153,7 +153,7 @@ export class UserSettings {\n       ? StorageLocation.Local\n       : storageLocation;\n     const storageData: UserSettingsData =\n-      (await chrome.storage[location].get(\"UserSettings\")).UserSettings || {};\n+      (await chrome.storage[location].get(\"UserSettings\"))?.UserSettings || {};\n     delete storageData[key];\n \n     UserSettings.items = storageData;\n@@ -163,7 +163,7 @@ export class UserSettings {\n \n   private static async getStorageData(location: StorageLocation) {\n     const storageData: UserSettingsData =\n-      (await chrome.storage[location].get(\"UserSettings\")).UserSettings || {};\n+      (await chrome.storage[location].get(\"UserSettings\"))?.UserSettings || {};\n \n     return storageData;\n   }"
            },
            {
                "sha": "05ab77186825b7f332e6653bbbb05b7f1a4d79f0",
                "filename": "src/models/storage.ts",
                "status": "modified",
                "additions": 266,
                "deletions": 151,
                "changes": 417,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fstorage.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fmodels%2Fstorage.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fmodels%2Fstorage.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,12 +1,9 @@\n import { Encryption } from \"./encryption\";\n import { OTPEntry, OTPType, OTPAlgorithm, CodeState } from \"./otp\";\n-import * as uuid from \"uuid/v4\";\n import { StorageLocation, UserSettings } from \"./settings\";\n-\n+import { DataType } from \"./otp\";\n export class BrowserStorage {\n-  private static async getStorageLocation(): Promise<\n-    StorageLocation | undefined\n-  > {\n+  private static async getStorageLocation(): Promise<StorageLocation> {\n     await UserSettings.updateItems();\n     const managedLocation = await ManagedStorage.get<StorageLocation>(\n       \"storageArea\"\n@@ -60,7 +57,7 @@ export class BrowserStorage {\n       });\n     } else {\n       return new Promise((resolve) => {\n-        resolve(UserSettings.items.storageLocation);\n+        resolve(UserSettings.items.storageLocation || StorageLocation.Sync);\n         return;\n       });\n     }\n@@ -69,9 +66,22 @@ export class BrowserStorage {\n   // TODO: promise this\n   static async get() {\n     const storageLocation = await this.getStorageLocation();\n-    const removeKey = function (items: { [key: string]: OTPStorage }): void {\n+    const removeOtherData = function (items: Record<string, unknown>): void {\n       delete items.key;\n       delete items.LocalStorage;\n+\n+      for (const itemId in items) {\n+        const item = items[itemId];\n+\n+        if (\n+          item !== null &&\n+          typeof item === \"object\" &&\n+          \"dataType\" in item &&\n+          item.dataType === \"Key\"\n+        ) {\n+          delete items[itemId];\n+        }\n+      }\n     };\n \n     let items = {} as { [key: string]: OTPStorage };\n@@ -82,34 +92,39 @@ export class BrowserStorage {\n       items = await chrome.storage.sync.get();\n     }\n \n-    removeKey(items);\n+    removeOtherData(items);\n \n     return items;\n   }\n \n-  static getKey() {\n-    return new Promise(\n-      (resolve: (key: { enc: string; hash: string } | null) => void) => {\n-        this.getStorageLocation().then((storageLocation) => {\n-          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n-          const callback = function (items: { [key: string]: any }): void {\n-            if (typeof items.key === \"object\") {\n-              resolve(items.key);\n-            } else {\n-              resolve(null);\n-            }\n-            return;\n-          };\n+  static async getKeys(): Promise<OldKey | Key[]> {\n+    const storageLocation = await this.getStorageLocation();\n \n-          if (storageLocation === StorageLocation.Local) {\n-            chrome.storage.local.get(callback);\n-          } else if (storageLocation === StorageLocation.Sync) {\n-            chrome.storage.sync.get(callback);\n-          }\n-          return;\n-        });\n+    const data = (await chrome.storage[storageLocation].get()) as Record<\n+      string,\n+      unknown\n+    >;\n+\n+    // Return old key first, so we know to run a migration\n+    if (data && typeof data === \"object\" && \"key\" in data) {\n+      if (isOldKey(data.key)) {\n+        return data.key;\n+      } else {\n+        console.error(\"'key' is malformed!\");\n       }\n-    );\n+    }\n+\n+    const keys: Key[] = [];\n+    if (data && typeof data === \"object\") {\n+      for (const record in data) {\n+        const key = data[record];\n+        if (isKey(key)) {\n+          keys.push(key);\n+        }\n+      }\n+    }\n+\n+    return keys;\n   }\n \n   static async set(data: object) {\n@@ -148,29 +163,62 @@ export class BrowserStorage {\n   }\n }\n \n+export function isOldKey(key: unknown): key is OldKey {\n+  return Boolean(\n+    key &&\n+      typeof key === \"object\" &&\n+      \"enc\" in key &&\n+      \"hash\" in key &&\n+      key.enc &&\n+      key.hash &&\n+      typeof key.enc === \"string\" &&\n+      typeof key.hash === \"string\"\n+  );\n+}\n+\n+function isKey(key: unknown): key is Key {\n+  return Boolean(\n+    key &&\n+      typeof key === \"object\" &&\n+      \"dataType\" in key &&\n+      \"id\" in key &&\n+      \"salt\" in key &&\n+      key.dataType === \"Key\" &&\n+      key.id &&\n+      key.salt &&\n+      typeof key.id === \"string\" &&\n+      typeof key.salt === \"string\"\n+  );\n+}\n+\n export class EntryStorage {\n   private static getOTPStorageFromEntry(\n     entry: OTPEntry,\n     unencrypted?: boolean\n   ): OTPStorage {\n     let secret: string;\n-    if (entry.encSecret) {\n-      secret = entry.encSecret;\n+    if (!entry.secret && entry.encData && entry.keyId) {\n+      return {\n+        dataType: DataType.EncOTPStorage,\n+        keyId: entry.keyId,\n+        data: entry.encData,\n+        index: entry.index,\n+      };\n     } else if (entry.secret) {\n       secret = entry.secret;\n     } else {\n       secret = \"\";\n       console.warn(\"Invalid entry\", entry);\n     }\n \n-    let encrypted = Boolean(entry.encSecret);\n+    let encrypted = entry.encryption?.getEncryptionStatus() || false;\n \n     if (unencrypted && entry.secret) {\n       secret = entry.secret;\n       encrypted = false;\n     }\n \n-    const storageItem: OTPStorage = {\n+    const storageItem: RawOTPStorage = {\n       encrypted,\n       hash: entry.hash,\n       index: entry.index,\n@@ -206,28 +254,66 @@ export class EntryStorage {\n       storageItem.algorithm = OTPAlgorithm[entry.algorithm];\n     }\n \n+    if (entry.encryption?.getEncryptionKeyId()) {\n+      storageItem.keyId = entry.encryption.getEncryptionKeyId();\n+    }\n+\n+    storageItem.dataType = DataType.OTPStorage;\n+\n+    if (\n+      !unencrypted &&\n+      encrypted &&\n+      entry.encryption?.getEncryptionStatus() &&\n+      entry.encryption.getEncryptionKeyId()\n+    ) {\n+      const encData = entry.encryption.getEncryptedString(\n+        JSON.stringify(storageItem)\n+      );\n+      return {\n+        dataType: DataType.EncOTPStorage,\n+        data: encData,\n+        keyId: entry.encryption.getEncryptionKeyId(),\n+        index: entry.index,\n+      };\n+    } else if (encrypted) {\n+      console.error(\"Could not encrypt malformed entry: \", entry);\n+    }\n+\n     return storageItem;\n   }\n \n-  private static ensureUniqueIndex(_data: { [hash: string]: OTPStorage }) {\n-    const tempEntryArray: OTPStorage[] = [];\n+  private static ensureUniqueIndex(data: { [hash: string]: OTPStorage }) {\n+    const tempEntryArray: [hash: string, storage: OTPStorage][] = [];\n \n-    for (const hash of Object.keys(_data)) {\n-      if (hash === \"UserSettings\" || !this.isValidEntry(_data, hash)) {\n+    for (const hash of Object.keys(data)) {\n+      if (\n+        hash === \"UserSettings\" ||\n+        (data[hash] as { dataType: string }).dataType === \"Key\" ||\n+        !this.isValidEntry(data, hash)\n+      ) {\n         continue;\n       }\n-      tempEntryArray.push(_data[hash]);\n+      tempEntryArray.push([hash, data[hash]]);\n     }\n \n     tempEntryArray.sort((a, b) => {\n-      return a.index - b.index;\n+      return a[1].index - b[1].index;\n     });\n \n-    const newData: { [hash: string]: OTPStorage } = {};\n-    for (let i = 0; i < tempEntryArray.length; i++) {\n-      tempEntryArray[i].index = i;\n-      newData[tempEntryArray[i].hash] = tempEntryArray[i];\n-    }\n+    let i = 0;\n+    const newData: { [hash: string]: OTPStorage } = tempEntryArray.reduce(\n+      (previous: { [hash: string]: OTPStorage }, entry) => {\n+        const mergedData = {\n+          ...previous,\n+          [entry[0]]: { ...entry[1], index: i },\n+        };\n+\n+        i += 1;\n+\n+        return mergedData;\n+      },\n+      {}\n+    );\n \n     return newData;\n   }\n@@ -237,10 +323,7 @@ export class EntryStorage {\n       return false;\n     }\n \n-    if (\n-      !entry ||\n-      !Object.prototype.hasOwnProperty.hasOwnProperty.call(entry, \"secret\")\n-    ) {\n+    if (!entry || !(\"secret\" in entry || \"data\" in entry)) {\n       return false;\n     }\n \n@@ -264,32 +347,24 @@ export class EntryStorage {\n   }\n \n   static async hasEncryptionKey(): Promise<boolean> {\n-    return Boolean(await BrowserStorage.getKey());\n+    const keys = await BrowserStorage.getKeys();\n+    if (isOldKey(keys)) {\n+      return true;\n+    } else {\n+      return keys.length !== 0;\n+    }\n   }\n \n   static getExport(data: OTPEntryInterface[], encrypted?: boolean) {\n     try {\n       const exportData: { [hash: string]: OTPStorage } = {};\n       for (const entry of data) {\n         // Skip unable-decrypted data\n-        if (entry.code === CodeState.Encrypted) {\n+        if (entry.code === CodeState.Encrypted || !entry.secret) {\n           continue;\n         }\n \n-        if (!encrypted) {\n-          if (!entry.secret) {\n-            // Not unencrypted\n-          } else {\n-            exportData[entry.hash] = this.getOTPStorageFromEntry(\n-              entry as OTPEntry,\n-              true\n-            );\n-          }\n-        } else {\n-          exportData[entry.hash] = this.getOTPStorageFromEntry(\n-            entry as OTPEntry\n-          );\n-        }\n+        exportData[entry.hash] = this.getOTPStorageFromEntry(entry, !encrypted);\n       }\n       return exportData;\n     } catch (error) {\n@@ -300,140 +375,169 @@ export class EntryStorage {\n   static async backupGetExport(encryption: Encryption, encrypted?: boolean) {\n     const _data = await BrowserStorage.get();\n     for (const hash of Object.keys(_data)) {\n-      if (hash === \"UserSettings\" || !this.isValidEntry(_data, hash)) {\n+      if (\n+        hash === \"UserSettings\" ||\n+        (_data[hash] as { dataType: string }).dataType === \"Key\" ||\n+        !this.isValidEntry(_data, hash)\n+      ) {\n         delete _data[hash];\n         continue;\n       }\n+\n+      const entry = _data[hash];\n+\n+      // TODO: fix this\n+      if (entry.dataType === \"EncOTPStorage\") {\n+        continue;\n+      }\n+\n       // remove unnecessary fields\n       if (\n-        !(_data[hash].type === OTPType[OTPType.hotp]) &&\n-        !(_data[hash].type === OTPType[OTPType.hhex])\n+        !(entry.type === OTPType[OTPType.hotp]) &&\n+        !(entry.type === OTPType[OTPType.hhex])\n       ) {\n-        delete _data[hash].counter;\n+        delete entry.counter;\n       }\n \n-      if (_data[hash].period === 30) {\n-        delete _data[hash].period;\n+      if (entry.period === 30) {\n+        delete entry.period;\n       }\n \n-      if (!_data[hash].issuer) {\n-        delete _data[hash].issuer;\n+      if (!entry.issuer) {\n+        delete entry.issuer;\n       }\n \n-      if (!_data[hash].account) {\n-        delete _data[hash].account;\n+      if (!entry.account) {\n+        delete entry.account;\n       }\n \n-      if (_data[hash].digits === 6) {\n-        delete _data[hash].digits;\n+      if (entry.digits === 6) {\n+        delete entry.digits;\n       }\n \n-      if (_data[hash].algorithm === OTPAlgorithm[OTPAlgorithm.SHA1]) {\n-        delete _data[hash].algorithm;\n+      if (entry.algorithm === OTPAlgorithm[OTPAlgorithm.SHA1]) {\n+        delete entry.algorithm;\n       }\n \n-      delete _data[hash].pinned;\n+      delete entry.pinned;\n \n       if (!encrypted) {\n         // decrypt the data to export\n-        if (_data[hash].encrypted) {\n-          const decryptedSecret = encryption.getDecryptedSecret(_data[hash]);\n-          if (\n-            decryptedSecret !== _data[hash].secret &&\n-            decryptedSecret !== null\n-          ) {\n-            _data[hash].secret = decryptedSecret;\n-            _data[hash].encrypted = false;\n+        if (entry.encrypted) {\n+          const decryptedSecret = encryption.decryptSecretString(entry.secret);\n+          if (decryptedSecret !== entry.secret && decryptedSecret !== null) {\n+            entry.secret = decryptedSecret;\n+            entry.encrypted = false;\n           }\n         }\n         // we need correct hash\n-        if (hash !== _data[hash].hash) {\n-          _data[_data[hash].hash] = _data[hash];\n+        if (hash !== entry.hash) {\n+          _data[entry.hash] = entry;\n           delete _data[hash];\n         }\n       }\n     }\n     if (encryption.getEncryptionStatus()) {\n-      Object.assign(_data, { key: await BrowserStorage.getKey() });\n+      const keys = await BrowserStorage.getKeys();\n+      if (isOldKey(keys)) {\n+        Object.assign(_data, { key: keys });\n+      } else {\n+        for (const key of keys) {\n+          Object.assign(_data, { [key.id]: key });\n+        }\n+      }\n     }\n     return _data;\n   }\n \n   static async import(\n     encryption: Encryption,\n-    data: { [hash: string]: OTPStorage }\n+    data: { [hash: string]: RawOTPStorage }\n   ) {\n     let _data = await BrowserStorage.get();\n     for (const hash of Object.keys(data)) {\n       // never trust data import from user\n-      // we do not support encrypted data import any longer\n+      // data must be decrypted before calling this method\n       if (!data[hash].secret || data[hash].encrypted) {\n-        // we need give a failed warning\n+        // TODO: we need give a failed warning\n         continue;\n       }\n \n-      data[hash].hash = data[hash].hash || hash;\n-      data[hash].account = data[hash].account || \"\";\n-      data[hash].encrypted = encryption.getEncryptionStatus();\n-      data[hash].index = data[hash].index || 0;\n-      data[hash].issuer = data[hash].issuer || \"\";\n-      data[hash].type = data[hash].type || OTPType[OTPType.totp];\n-      data[hash].counter = data[hash].counter || 0;\n-      data[hash].digits = data[hash].digits || 6;\n-      data[hash].algorithm =\n-        data[hash].algorithm || OTPAlgorithm[OTPAlgorithm.SHA1];\n-      data[hash].pinned = data[hash].pinned || false;\n-      const period = data[hash].period;\n-      if (\n-        data[hash].type !== OTPType[OTPType.totp] ||\n-        (period && (isNaN(period) || period <= 0))\n-      ) {\n-        delete data[hash].period;\n+      const rawAlgorithm = data[hash].algorithm;\n+      const entryData: {\n+        account: string;\n+        encrypted: false;\n+        index: number;\n+        issuer: string;\n+        secret: string;\n+        type: OTPType;\n+        counter: number;\n+        period: number;\n+        hash: string;\n+        digits: number;\n+        algorithm: OTPAlgorithm;\n+        pinned: boolean;\n+      } = {\n+        type: (parseInt(data[hash].type) as OTPType) || OTPType[OTPType.totp],\n+        index: data[hash].index || 0,\n+        issuer: data[hash].issuer || \"\",\n+        account: data[hash].account || \"\",\n+        encrypted: false,\n+        secret: data[hash].secret,\n+        counter: data[hash].counter || 0,\n+        period: data[hash].period || 30,\n+        digits: data[hash].digits || 6,\n+        algorithm: rawAlgorithm\n+          ? (parseInt(rawAlgorithm) as OTPAlgorithm)\n+          : OTPAlgorithm.SHA1,\n+        pinned: data[hash].pinned || false,\n+        hash: data[hash].hash || hash,\n+      };\n+\n+      if (isNaN(entryData.period) || entryData.period <= 0) {\n+        entryData.period = 30;\n       }\n \n       // If invalid digits, then use default.\n-      const digits = data[hash].digits;\n-      if (digits && (digits > 10 || digits < 1)) {\n-        data[hash].digits = 6;\n+      if (entryData.digits > 10 || entryData.digits < 1) {\n+        entryData.digits = 6;\n       }\n \n       // If invalid algorithm, then use default\n-      // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n-      // @ts-ignore - it's fine if this ends up undefined\n-      if (!OTPAlgorithm[data[hash].algorithm]) {\n-        data[hash].algorithm = OTPAlgorithm[OTPAlgorithm.SHA1];\n+      if (!OTPAlgorithm[entryData.algorithm]) {\n+        entryData.algorithm = OTPAlgorithm.SHA1;\n       }\n \n-      if (/^(blz-|bliz-)/.test(data[hash].secret)) {\n-        const secretMatches = data[hash].secret.match(/^(blz-|bliz-)(.*)/);\n+      if (/^(blz-|bliz-)/.test(entryData.secret)) {\n+        const secretMatches = entryData.secret.match(/^(blz-|bliz-)(.*)/);\n         if (secretMatches && secretMatches.length >= 3) {\n-          data[hash].secret = secretMatches[2];\n-          data[hash].type = OTPType[OTPType.battle];\n+          entryData.secret = secretMatches[2];\n+          entryData.type = OTPType.battle;\n         }\n       }\n \n-      if (/^stm-/.test(data[hash].secret)) {\n-        const secretMatches = data[hash].secret.match(/^stm-(.*)/);\n+      if (/^stm-/.test(entryData.secret)) {\n+        const secretMatches = entryData.secret.match(/^stm-(.*)/);\n         if (secretMatches && secretMatches.length >= 2) {\n-          data[hash].secret = secretMatches[1];\n-          data[hash].type = OTPType[OTPType.steam];\n+          entryData.secret = secretMatches[1];\n+          entryData.type = OTPType.steam;\n         }\n       }\n \n       if (\n-        !/^[a-z2-7]+=*$/i.test(data[hash].secret) &&\n-        /^[0-9a-f]+$/i.test(data[hash].secret) &&\n-        data[hash].type === OTPType[OTPType.totp]\n+        !/^[a-z2-7]+=*$/i.test(entryData.secret) &&\n+        /^[0-9a-f]+$/i.test(entryData.secret) &&\n+        entryData.type === OTPType.totp\n       ) {\n-        data[hash].type = OTPType[OTPType.hex];\n+        entryData.type = OTPType.hex;\n       }\n \n       if (\n-        !/^[a-z2-7]+=*$/i.test(data[hash].secret) &&\n-        /^[0-9a-f]+$/i.test(data[hash].secret) &&\n-        data[hash].type === OTPType[OTPType.hotp]\n+        !/^[a-z2-7]+=*$/i.test(entryData.secret) &&\n+        /^[0-9a-f]+$/i.test(entryData.secret) &&\n+        entryData.type === OTPType.hotp\n       ) {\n-        data[hash].type = OTPType[OTPType.hhex];\n+        entryData.type = OTPType.hhex;\n       }\n \n       // not a valid / old hash\n@@ -442,18 +546,12 @@ export class EntryStorage {\n           hash\n         )\n       ) {\n-        const _hash = await uuid();\n-\n-        data[_hash] = data[hash];\n-        data[_hash].hash = _hash;\n+        entryData.hash = crypto.randomUUID();\n         delete data[hash];\n-\n-        data[_hash].secret = encryption.getEncryptedString(data[_hash].secret);\n-        _data[_hash] = data[_hash];\n-      } else {\n-        data[hash].secret = encryption.getEncryptedString(data[hash].secret);\n-        _data[hash] = data[hash];\n       }\n+\n+      const entry = new OTPEntry(entryData, encryption);\n+      _data[entryData.hash] = this.getOTPStorageFromEntry(entry);\n     }\n     _data = this.ensureUniqueIndex(_data);\n     await BrowserStorage.set(_data);\n@@ -491,11 +589,29 @@ export class EntryStorage {\n     const data: OTPEntry[] = [];\n \n     for (const hash of Object.keys(_data)) {\n-      if (hash === \"UserSettings\" || !this.isValidEntry(_data, hash)) {\n+      if (\n+        hash === \"UserSettings\" ||\n+        (_data[hash] as { dataType: string }).dataType === \"Key\" ||\n+        !this.isValidEntry(_data, hash)\n+      ) {\n         continue;\n       }\n+\n       const entryData = _data[hash];\n \n+      if (entryData.dataType === \"EncOTPStorage\") {\n+        data.push(\n+          new OTPEntry({\n+            encrypted: true,\n+            encData: entryData.data,\n+            keyId: entryData.keyId,\n+            hash,\n+            index: entryData.index,\n+          })\n+        );\n+        continue;\n+      }\n+\n       if (!entryData.hash) {\n         entryData.hash = hash;\n       }\n@@ -540,20 +656,19 @@ export class EntryStorage {\n         type,\n         counter: entryData.counter,\n         period,\n-        digits: entryData.digits,\n-        // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n-        // @ts-ignore - it's fine if this ends up undefined\n+        digits: entryData.digits ? Number(entryData.digits) : undefined,\n+        // @ts-expect-error - it's fine if this ends up undefined\n         algorithm: OTPAlgorithm[entryData.algorithm],\n         pinned: entryData.pinned,\n       });\n \n       data.push(entry);\n-\n-      data.sort((a, b) => {\n-        return a.index - b.index;\n-      });\n     }\n \n+    data.sort((a, b) => {\n+      return a.index - b.index;\n+    });\n+\n     return data;\n   }\n "
            },
            {
                "sha": "173bc033eae90d036cdf3fac7b684caabc84b837",
                "filename": "src/popup.ts",
                "status": "modified",
                "additions": 10,
                "deletions": 4,
                "changes": 14,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fpopup.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fpopup.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fpopup.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -76,7 +76,7 @@ async function init() {\n   // Prompt for password if needed\n   if (instance.$store.state.accounts.shouldShowPassphrase) {\n     // If we have cached password, use that\n-    if (instance.$store.state.accounts.encryption.getEncryptionStatus()) {\n+    if (instance.$store.state.accounts.defaultEncryption) {\n       instance.$store.commit(\"currentView/changeView\", \"LoadingPage\");\n       await instance.$store.dispatch(\"accounts/updateEntries\");\n     } else {\n@@ -209,7 +209,9 @@ async function runScheduledBackup(clientTime: number, instance: Vue) {\n           try {\n             const dropbox = new Dropbox();\n             const res = await dropbox.upload(\n-              instance.$store.state.accounts.encryption\n+              instance.$store.state.accounts.encryption.get(\n+                instance.$store.state.accounts.defaultEncryption\n+              )\n             );\n             if (res) {\n               // we have uploaded backup to Dropbox\n@@ -251,7 +253,9 @@ async function runScheduledBackup(clientTime: number, instance: Vue) {\n           try {\n             const drive = new Drive();\n             const res = await drive.upload(\n-              instance.$store.state.accounts.encryption\n+              instance.$store.state.accounts.encryption.get(\n+                instance.$store.state.accounts.defaultEncryption\n+              )\n             );\n             if (res) {\n               UserSettings.items.lastRemindingBackupTime = clientTime;\n@@ -291,7 +295,9 @@ async function runScheduledBackup(clientTime: number, instance: Vue) {\n           try {\n             const onedrive = new OneDrive();\n             const res = await onedrive.upload(\n-              instance.$store.state.accounts.encryption\n+              instance.$store.state.accounts.encryption.get(\n+                instance.$store.state.accounts.defaultEncryption\n+              )\n             );\n             if (res) {\n               UserSettings.items.lastRemindingBackupTime = clientTime;"
            },
            {
                "sha": "713c92def8b851961246c157f02d093eaa8dea5f",
                "filename": "src/qrdebug.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fqrdebug.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fqrdebug.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fqrdebug.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -12,6 +12,9 @@ chrome.runtime.onMessage.addListener((message, sender) => {\n       message.info.windowWidth\n     );\n   }\n+\n+  // https://stackoverflow.com/a/56483156\n+  return true;\n });\n \n function getQrDebug("
            },
            {
                "sha": "c6e293047ab6ee384bb578097516a25565942394",
                "filename": "src/store/Accounts.ts",
                "status": "modified",
                "additions": 346,
                "deletions": 153,
                "changes": 499,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fstore%2FAccounts.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fstore%2FAccounts.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fstore%2FAccounts.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,16 +1,27 @@\n-import { EntryStorage, BrowserStorage } from \"../models/storage\";\n+import { EntryStorage, BrowserStorage, isOldKey } from \"../models/storage\";\n import { Encryption } from \"../models/encryption\";\n import * as CryptoJS from \"crypto-js\";\n import { OTPType, OTPAlgorithm } from \"../models/otp\";\n import { ActionContext } from \"vuex\";\n import { getSiteName, getMatchedEntriesHash } from \"../utils\";\n import { isChromium } from \"../browser\";\n import { StorageLocation, UserSettings } from \"../models/settings\";\n+import { DataType } from \"../models/otp\";\n \n+const LegacyEncryption = \"LegacyEncryption\";\n export class Accounts implements Module {\n   async getModule() {\n-    const cachedPassphrase = await this.getCachedPassphrase();\n-    const encryption: Encryption = new Encryption(cachedPassphrase);\n+    const cachedKeyInfo = await this.getCachedKeyInfo();\n+    const encryption: Map<string, EncryptionInterface> = new Map();\n+    if (cachedKeyInfo.cachedKeyId) {\n+      encryption.set(\n+        cachedKeyInfo.cachedKeyId,\n+        new Encryption(\n+          cachedKeyInfo.cachedPassphrase,\n+          cachedKeyInfo.cachedKeyId\n+        )\n+      );\n+    }\n     const shouldShowPassphrase = await EntryStorage.hasEncryptionKey();\n     const entries = shouldShowPassphrase ? [] : await this.getEntries();\n \n@@ -20,6 +31,7 @@ export class Accounts implements Module {\n       state: {\n         entries,\n         encryption,\n+        defaultEncryption: cachedKeyInfo.cachedKeyId,\n         OTPType,\n         OTPAlgorithm,\n         shouldShowPassphrase,\n@@ -31,7 +43,7 @@ export class Accounts implements Module {\n         showSearch: false,\n         exportData: await EntryStorage.getExport(entries),\n         exportEncData: await EntryStorage.getExport(entries, true),\n-        key: await BrowserStorage.getKey(),\n+        keys: await BrowserStorage.getKeys(),\n         wrongPassword: false,\n         initComplete: false,\n       },\n@@ -149,15 +161,20 @@ export class Accounts implements Module {\n         },\n         updateEncExport(\n           state: AccountsState,\n-          exportData: { [k: string]: OTPEntryInterface }\n-        ) {\n-          state.exportEncData = exportData;\n-        },\n-        updateKeyExport(\n-          state: AccountsState,\n-          key: { enc: string; hash: string } | null\n+          data: {\n+            entries: { [k: string]: OTPEntryInterface };\n+            keys: Key[] | OldKey;\n+          }\n         ) {\n-          state.key = key;\n+          if (isOldKey(data.keys)) {\n+            return;\n+          }\n+\n+          const keys = data.keys.reduce((prev: { [id: string]: Key }, key) => {\n+            prev[key.id] = key;\n+            return prev;\n+          }, {});\n+          state.exportEncData = { ...data.entries, ...keys };\n         },\n         wrongPassword(state: AccountsState) {\n           state.wrongPassword = true;\n@@ -168,7 +185,7 @@ export class Accounts implements Module {\n       },\n       actions: {\n         deleteCode: async (\n-          state: ActionContext<AccountsState, {}>,\n+          state: ActionContext<AccountsState, object>,\n           hash: string\n         ) => {\n           const index = state.state.entries.findIndex(\n@@ -181,27 +198,27 @@ export class Accounts implements Module {\n             \"updateExport\",\n             await EntryStorage.getExport(state.state.entries)\n           );\n-          state.commit(\n-            \"updateEncExport\",\n-            await EntryStorage.getExport(state.state.entries, true)\n-          );\n+          state.commit(\"updateEncExport\", {\n+            entries: await EntryStorage.getExport(state.state.entries, true),\n+            keys: await BrowserStorage.getKeys(),\n+          });\n         },\n         addCode: async (\n-          state: ActionContext<AccountsState, {}>,\n+          state: ActionContext<AccountsState, object>,\n           entry: OTPEntryInterface\n         ) => {\n           state.state.entries.unshift(entry);\n           state.commit(\n             \"updateExport\",\n             await EntryStorage.getExport(state.state.entries)\n           );\n-          state.commit(\n-            \"updateEncExport\",\n-            await EntryStorage.getExport(state.state.entries, true)\n-          );\n+          state.commit(\"updateEncExport\", {\n+            entries: await EntryStorage.getExport(state.state.entries, true),\n+            keys: await BrowserStorage.getKeys(),\n+          });\n         },\n         applyPassphrase: async (\n-          state: ActionContext<AccountsState, {}>,\n+          state: ActionContext<AccountsState, object>,\n           password: string\n         ) => {\n           if (!password) {\n@@ -210,180 +227,313 @@ export class Accounts implements Module {\n \n           state.commit(\"currentView/changeView\", \"LoadingPage\", { root: true });\n \n-          const encKey = await BrowserStorage.getKey();\n-          if (!encKey) {\n-            // --- migrate to key\n-            // verify current password\n-            state.state.encryption.updateEncryptionPassword(password);\n-            await state.dispatch(\"updateEntries\");\n-\n-            if (state.getters.currentlyEncrypted) {\n-              state.commit(\"style/hideInfo\", true, { root: true });\n-              return;\n-            }\n-            // gen key\n-            const wordArray = CryptoJS.lib.WordArray.random(120);\n-            const encKey = CryptoJS.AES.encrypt(wordArray, password).toString();\n-            const encKeyHash = await new Promise(\n+          // Decrypt entries\n+          let saltedHash = \"\";\n+          let migrationNeeded = false;\n+          const encKeys = await BrowserStorage.getKeys();\n+          if (isOldKey(encKeys)) {\n+            // --- handle v2 encryption\n+            // decrypt using key\n+            const key = CryptoJS.AES.decrypt(encKeys.enc, password).toString();\n+            const isCorrectPassword = await new Promise(\n               (resolve: (value: string) => void) => {\n                 const iframe = document.getElementById(\"argon-sandbox\");\n                 const message = {\n-                  action: \"hash\",\n-                  value: wordArray.toString(),\n+                  action: \"verify\",\n+                  value: key,\n+                  hash: encKeys.hash,\n                 };\n                 if (iframe) {\n                   window.addEventListener(\"message\", (response) => {\n                     resolve(response.data.response);\n                   });\n-                  // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n-                  //@ts-ignore\n+                  // @ts-expect-error - bad typings\n                   iframe.contentWindow.postMessage(message, \"*\");\n                 }\n               }\n             );\n \n-            if (!encKeyHash) {\n-              state.commit(\"style/hideInfo\", true, { root: true });\n+            if (!isCorrectPassword) {\n+              state.commit(\"wrongPassword\");\n+              state.commit(\"currentView/changeView\", \"EnterPasswordPage\", {\n+                root: true,\n+              });\n               return;\n             }\n \n-            // change entry encryption to key and remove old hash\n-            const oldKeys: string[] = [];\n-            for (const entry of state.state.entries) {\n-              await entry.changeEncryption(\n-                new Encryption(wordArray.toString())\n-              );\n-              oldKeys.push(entry.hash);\n-              entry.genUUID();\n-            }\n-\n-            // store key\n-            await BrowserStorage.set({\n-              key: { enc: encKey, hash: encKeyHash },\n-            });\n-            await EntryStorage.set(state.state.entries);\n-            await BrowserStorage.remove(oldKeys);\n+            state.state.encryption.set(\n+              LegacyEncryption,\n+              new Encryption(key, LegacyEncryption)\n+            );\n \n-            state.state.encryption.updateEncryptionPassword(\n-              wordArray.toString()\n+            migrationNeeded = true;\n+          } else if (encKeys.length === 0) {\n+            // --- handle v1 encryption\n+            // verify current password\n+            state.state.encryption.set(\n+              LegacyEncryption,\n+              new Encryption(password, LegacyEncryption)\n             );\n             await state.dispatch(\"updateEntries\");\n+\n+            if (state.getters.currentlyEncrypted) {\n+              state.commit(\"wrongPassword\");\n+              state.commit(\"currentView/changeView\", \"EnterPasswordPage\", {\n+                root: true,\n+              });\n+              return;\n+            }\n+\n+            migrationNeeded = true;\n           } else {\n-            // --- decrypt using key\n-            const key = CryptoJS.AES.decrypt(encKey.enc, password).toString();\n-            const isCorrectPassword = await new Promise(\n-              (resolve: (value: string) => void) => {\n-                const iframe = document.getElementById(\"argon-sandbox\");\n-                const message = {\n-                  action: \"verify\",\n-                  value: key,\n-                  hash: encKey.hash,\n-                };\n-                if (iframe) {\n-                  window.addEventListener(\"message\", (response) => {\n-                    resolve(response.data.response);\n-                  });\n-                  // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n-                  //@ts-ignore\n-                  iframe.contentWindow.postMessage(message, \"*\");\n+            // --- handle v3 encryption\n+            // TODO: let user reconcile multiple keys from sync conflicts\n+            for (const key of encKeys) {\n+              const rawHash = await new Promise(\n+                (resolve: (value: string) => void) => {\n+                  const iframe = document.getElementById(\"argon-sandbox\");\n+                  const message = {\n+                    action: \"hash\",\n+                    value: password,\n+                    salt: key.salt,\n+                  };\n+                  if (iframe) {\n+                    window.addEventListener(\"message\", (response) => {\n+                      resolve(response.data.response);\n+                    });\n+                    // @ts-expect-error bad typings\n+                    iframe.contentWindow.postMessage(message, \"*\");\n+                  }\n                 }\n+              );\n+\n+              // https://passlib.readthedocs.io/en/stable/lib/passlib.hash.argon2.html#format-algorithm\n+              const possibleHash = rawHash.split(\"$\")[5];\n+              if (!possibleHash) {\n+                throw new Error(\"argon2 did not return a hash!\");\n               }\n-            );\n \n-            if (!isCorrectPassword) {\n+              // verify user password by comparing their password hash with the\n+              // hash of their password's hash\n+              const isCorrectPassword = await new Promise(\n+                (resolve: (value: string) => void) => {\n+                  const iframe = document.getElementById(\"argon-sandbox\");\n+                  const message = {\n+                    action: \"verify\",\n+                    value: possibleHash,\n+                    hash: key.hash,\n+                  };\n+                  if (iframe) {\n+                    window.addEventListener(\"message\", (response) => {\n+                      resolve(response.data.response);\n+                    });\n+                    // @ts-expect-error bad typings\n+                    iframe.contentWindow.postMessage(message, \"*\");\n+                  }\n+                }\n+              );\n+\n+              // TODO: there is a serious bug here. If two keys have the same password,\n+              // then only one of them will be used for decryption.\n+              if (isCorrectPassword) {\n+                state.state.encryption.set(\n+                  key.id,\n+                  new Encryption(possibleHash, key.id)\n+                );\n+                state.state.defaultEncryption = key.id;\n+\n+                saltedHash = possibleHash;\n+              }\n+            }\n+\n+            await state.dispatch(\"updateEntries\");\n+\n+            if (!saltedHash) {\n               state.commit(\"wrongPassword\");\n               state.commit(\"currentView/changeView\", \"EnterPasswordPage\", {\n                 root: true,\n               });\n               return;\n             }\n+          }\n \n-            state.state.encryption.updateEncryptionPassword(key);\n-            await state.dispatch(\"updateEntries\");\n+          // Migrate from older encryption if needed\n+          if (migrationNeeded) {\n+            // gen hashes\n+\n+            // The hash of the user's password is used as the encryption key for user data.\n+            const rawSaltedHash = await genHash(password);\n+            // https://passlib.readthedocs.io/en/stable/lib/passlib.hash.argon2.html#format-algorithm\n+            const salt = window.atob(rawSaltedHash.split(\"$\")[4]);\n+            saltedHash = rawSaltedHash.split(\"$\")[5];\n+\n+            // This hash is used to verify that a user decrypted `saltedHash` correctly\n+            const hashOfHash = await genHash(saltedHash);\n \n-            // Encrypt any unencrypted entries.\n-            // Browser sync can cause unencrypted entries to show up.\n-            let needUpdateStorage = false;\n+            if (!saltedHash || !hashOfHash) {\n+              throw new Error(\"argon2 did not return a hash!\");\n+            }\n+\n+            // update entry encryption\n+            const key: Key = {\n+              dataType: DataType.Key,\n+              id: crypto.randomUUID(),\n+              salt: salt,\n+              hash: hashOfHash,\n+              version: 3,\n+            };\n+            const newEncryption = new Encryption(saltedHash, key.id);\n+            state.state.encryption.set(key.id, newEncryption);\n+            state.state.defaultEncryption = key.id;\n+\n+            const toRemove: string[] = [];\n             for (const entry of state.state.entries) {\n-              if (!entry.encSecret) {\n-                await entry.changeEncryption(state.state.encryption);\n-                needUpdateStorage = true;\n+              if (!entry.secret) {\n+                continue;\n               }\n-            }\n \n-            if (needUpdateStorage) {\n-              await EntryStorage.set(state.state.entries);\n-              await state.dispatch(\"updateEntries\");\n+              await entry.changeEncryption(newEncryption);\n+\n+              // if not uuidv4 regen\n+              if (\n+                /[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}/i.test(\n+                  entry.hash\n+                )\n+              ) {\n+                entry.genUUID();\n+                toRemove.push(entry.hash);\n+              }\n             }\n \n-            if (!state.getters.currentlyEncrypted) {\n-              chrome.runtime.sendMessage({\n-                action: \"cachePassphrase\",\n-                value: key,\n-              });\n+            // store key\n+            await BrowserStorage.set({\n+              [key.id]: key,\n+            });\n+            await EntryStorage.set(state.state.entries);\n+            await BrowserStorage.remove(toRemove);\n+            await BrowserStorage.remove(\"key\");\n+\n+            await state.dispatch(\"updateEntries\");\n+          }\n+\n+          if (!saltedHash) {\n+            throw new Error(\"Empty saltedHash! This should never happen.\");\n+          }\n+\n+          // Encrypt any unencrypted entries.\n+          // Browser sync can cause unencrypted entries to show up.\n+          let needUpdateStorage = false;\n+          const defaultEncryption = state.state.encryption.get(\n+            state.state.defaultEncryption\n+          );\n+          if (!defaultEncryption) {\n+            throw new Error(\n+              \"defaultEncryption is empty, this should never happen!\"\n+            );\n+          }\n+          for (const entry of state.state.entries) {\n+            if (\n+              entry.encryption?.getEncryptionKeyId() !==\n+              state.state.defaultEncryption\n+            ) {\n+              await entry.changeEncryption(defaultEncryption);\n+              needUpdateStorage = true;\n             }\n           }\n+\n+          if (needUpdateStorage) {\n+            await EntryStorage.set(state.state.entries);\n+            await state.dispatch(\"updateEntries\");\n+          }\n+\n+          if (!state.getters.currentlyEncrypted) {\n+            chrome.runtime.sendMessage({\n+              action: \"cachePassphrase\",\n+              value: saltedHash,\n+              keyId: defaultEncryption.getEncryptionKeyId(),\n+            });\n+          }\n+\n           state.commit(\"style/hideInfo\", true, { root: true });\n           return;\n         },\n         changePassphrase: async (\n-          state: ActionContext<AccountsState, {}>,\n+          state: ActionContext<AccountsState, object>,\n           password: string\n         ) => {\n           if (password) {\n-            const wordArray = CryptoJS.lib.WordArray.random(120);\n-            const encKey = CryptoJS.AES.encrypt(wordArray, password).toString();\n-            const encKeyHash = await new Promise(\n-              (resolve: (value: string) => void) => {\n-                const iframe = document.getElementById(\"argon-sandbox\");\n-                const message = {\n-                  action: \"hash\",\n-                  value: wordArray.toString(),\n-                };\n-                if (iframe) {\n-                  window.addEventListener(\"message\", (response) => {\n-                    resolve(response.data.response);\n-                  });\n-                  // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n-                  //@ts-ignore\n-                  iframe.contentWindow.postMessage(message, \"*\");\n-                }\n-              }\n-            );\n+            // The hash of the user's password is used as the encryption key for user data.\n+            const rawSaltedHash = await genHash(password);\n+            // https://passlib.readthedocs.io/en/stable/lib/passlib.hash.argon2.html#format-algorithm\n+            const salt = window.atob(rawSaltedHash.split(\"$\")[4]);\n+            const saltedHash = rawSaltedHash.split(\"$\")[5];\n \n-            if (!encKeyHash) {\n-              return;\n+            // This hash is used to verify that a user decrypted `saltedHash` correctly\n+            const hashOfHash = await genHash(saltedHash);\n+\n+            if (!saltedHash || !hashOfHash) {\n+              throw new Error(\"argon2 did not return a hash!\");\n             }\n \n             // change entry encryption and regen hash\n-            const removeHashes: string[] = [];\n-            for (const entry of state.state.entries) {\n-              await entry.changeEncryption(\n-                new Encryption(wordArray.toString())\n+            const removeKeys: string[] = [];\n+            const keys = await BrowserStorage.getKeys();\n+            if (isOldKey(keys)) {\n+              throw new Error(\n+                \"OldKey still being used. This should never happen!\"\n               );\n+            }\n+            const key: Key = {\n+              dataType: DataType.Key,\n+              id: crypto.randomUUID(),\n+              salt: salt,\n+              hash: hashOfHash,\n+              version: 3,\n+            };\n+\n+            const linkedKeys = new Map<string, undefined>();\n+            for (const entry of state.state.entries) {\n+              await entry.changeEncryption(new Encryption(saltedHash, key.id));\n               // if not uuidv4 regen\n               if (\n                 /[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}/i.test(\n                   entry.hash\n                 )\n               ) {\n-                removeHashes.push(entry.hash);\n+                removeKeys.push(entry.hash);\n                 entry.genUUID();\n               }\n+\n+              if (entry.encryption?.getEncryptionKeyId()) {\n+                linkedKeys.set(\n+                  entry.encryption.getEncryptionKeyId(),\n+                  undefined\n+                );\n+              }\n             }\n \n             // store key\n             await BrowserStorage.set({\n-              key: { enc: encKey, hash: encKeyHash },\n+              [key.id]: key,\n             });\n             await EntryStorage.set(state.state.entries);\n-            if (removeHashes.length) {\n-              await BrowserStorage.remove(removeHashes);\n+            // remove unlinked keys when there is at least one entry\n+            if (state.state.entries.length !== 0) {\n+              for (const storedKey of keys) {\n+                if (!linkedKeys.has(storedKey.id)) {\n+                  removeKeys.push(storedKey.id);\n+                }\n+              }\n+            }\n+            if (removeKeys.length) {\n+              await BrowserStorage.remove(removeKeys);\n             }\n \n-            state.state.encryption.updateEncryptionPassword(\n-              wordArray.toString()\n+            state.state.encryption.set(\n+              key.id,\n+              new Encryption(saltedHash, key.id)\n             );\n+            state.state.defaultEncryption = key.id;\n \n             await state.dispatch(\"updateEntries\");\n \n@@ -394,17 +544,23 @@ export class Accounts implements Module {\n \n             chrome.runtime.sendMessage({\n               action: \"cachePassphrase\",\n-              value: wordArray.toString(),\n+              value: saltedHash,\n+              keyId: key.id,\n             });\n           } else {\n             for (const entry of state.state.entries) {\n-              await entry.changeEncryption(new Encryption(\"\"));\n+              await entry.changeEncryption(new Encryption(\"\", \"\"));\n             }\n             await EntryStorage.set(state.state.entries);\n \n-            state.state.encryption.updateEncryptionPassword(\"\");\n-\n-            BrowserStorage.remove(\"key\");\n+            await BrowserStorage.remove(\"key\");\n+            const keyId = state.state.encryption\n+              .get(state.state.defaultEncryption)\n+              ?.getEncryptionKeyId();\n+            if (keyId) {\n+              await BrowserStorage.remove(keyId);\n+            }\n+            state.state.defaultEncryption = \"\";\n \n             await state.dispatch(\"updateEntries\");\n \n@@ -417,12 +573,23 @@ export class Accounts implements Module {\n           UserSettings.items.encodedPhrase = undefined;\n           await UserSettings.removeItem(\"encodedPhrase\");\n         },\n-        updateEntries: async (state: ActionContext<AccountsState, {}>) => {\n+        updateEntries: async (state: ActionContext<AccountsState, object>) => {\n           const entries = await this.getEntries();\n \n-          if (state.state.encryption.getEncryptionStatus()) {\n-            for (const entry of entries) {\n-              await entry.applyEncryption(state.state.encryption as Encryption);\n+          for (const entry of entries) {\n+            // LegacyEncryption indicates that we need to use backwards compatibility logic\n+            if (entry.encSecret) {\n+              const legacyEncryption = state.state.encryption.get(\n+                LegacyEncryption\n+              );\n+              if (legacyEncryption) {\n+                await entry.applyEncryption(legacyEncryption);\n+              }\n+            } else if (entry.keyId) {\n+              const entryEncryption = state.state.encryption.get(entry.keyId);\n+              if (entryEncryption) {\n+                await entry.applyEncryption(entryEncryption);\n+              }\n             }\n           }\n \n@@ -432,22 +599,21 @@ export class Accounts implements Module {\n             \"updateExport\",\n             await EntryStorage.getExport(state.state.entries)\n           );\n-          state.commit(\n-            \"updateEncExport\",\n-            await EntryStorage.getExport(state.state.entries, true)\n-          );\n-          state.commit(\"updateKeyExport\", await BrowserStorage.getKey());\n+          state.commit(\"updateEncExport\", {\n+            entries: await EntryStorage.getExport(state.state.entries, true),\n+            keys: await BrowserStorage.getKeys(),\n+          });\n           state.commit(\"initComplete\");\n           return;\n         },\n-        clearFilter: (state: ActionContext<AccountsState, {}>) => {\n+        clearFilter: (state: ActionContext<AccountsState, object>) => {\n           state.commit(\"stopFilter\");\n           if (state.state.entries.length >= 10) {\n             state.commit(\"showSearch\");\n           }\n         },\n         migrateStorage: async (\n-          state: ActionContext<AccountsState, {}>,\n+          state: ActionContext<AccountsState, object>,\n           newStorageLocation: string\n         ) => {\n           // sync => local\n@@ -480,8 +646,10 @@ export class Accounts implements Module {\n             newStorageLocation === StorageLocation.Sync\n           ) {\n             const localData = await chrome.storage.local.get();\n-            delete localData.UserSettings;\n-            await chrome.storage.sync.set(localData);\n+            if (localData?.UserSettings) {\n+              delete localData.UserSettings;\n+              await chrome.storage.sync.set(localData);\n+            }\n             const syncData = await chrome.storage.sync.get();\n \n             // Double check if data was set\n@@ -507,16 +675,41 @@ export class Accounts implements Module {\n     };\n   }\n \n-  private async getCachedPassphrase() {\n-    const { cachedPassphrase } = await chrome.storage.session.get(\n-      \"cachedPassphrase\"\n-    );\n+  private async getCachedKeyInfo() {\n+    const {\n+      cachedPassphrase,\n+      cachedKeyId,\n+    } = await chrome.storage.session.get();\n \n-    return cachedPassphrase;\n+    return { cachedPassphrase, cachedKeyId };\n   }\n \n   private async getEntries() {\n     const otpEntries = await EntryStorage.get();\n     return otpEntries;\n   }\n }\n+\n+async function genHash(value: string) {\n+  const randomValues = window.crypto.getRandomValues(new Uint16Array(8));\n+  let salt = \"\";\n+  for (const byte of randomValues) {\n+    salt += byte.toString(16);\n+  }\n+\n+  return new Promise((resolve: (value: string) => void) => {\n+    const iframe = document.getElementById(\"argon-sandbox\");\n+    const message = {\n+      action: \"hash\",\n+      value: value,\n+      salt,\n+    };\n+    if (iframe) {\n+      window.addEventListener(\"message\", (response) => {\n+        resolve(response.data.response);\n+      });\n+      // @ts-expect-error bad typings\n+      iframe.contentWindow.postMessage(message, \"*\");\n+    }\n+  });\n+}"
            },
            {
                "sha": "c68d812905c372a2fb761b6b3c228ea8108152c7",
                "filename": "src/store/Notification.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fstore%2FNotification.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Fstore%2FNotification.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Fstore%2FNotification.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -29,7 +29,7 @@ export class Notification implements Module {\n       },\n       actions: {\n         confirm: async (\n-          state: ActionContext<NotificationState, {}>,\n+          state: ActionContext<NotificationState, object>,\n           message: string\n         ) => {\n           return new Promise((resolve: (value: boolean) => void) => {\n@@ -46,7 +46,7 @@ export class Notification implements Module {\n           });\n         },\n         ephermalMessage: (\n-          state: ActionContext<NotificationState, {}>,\n+          state: ActionContext<NotificationState, object>,\n           message: string\n         ) => {\n           state.commit(\"setNotification\", message);"
            },
            {
                "sha": "7e46074cca31df22af6ec1850b77d1fbe0f6b87b",
                "filename": "src/syncTime.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2FsyncTime.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2FsyncTime.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2FsyncTime.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -6,8 +6,7 @@ export async function syncTimeWithGoogle() {\n   return new Promise(\n     (resolve: (value: string) => void, reject: (reason: Error) => void) => {\n       try {\n-        // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\n-        // @ts-ignore\n+        // @ts-expect-error - these typings are wrong\n         const xhr = new XMLHttpRequest({ mozAnon: true });\n         xhr.open(\"HEAD\", \"https://www.google.com/generate_204\");\n         const xhrAbort = setTimeout(() => {"
            },
            {
                "sha": "508f065034cea3a6812e45e7d326982692d7025b",
                "filename": "src/utils.ts",
                "status": "modified",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Futils.ts",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/src%2Futils.ts",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/src%2Futils.ts?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -143,3 +143,20 @@ export async function getCurrentTab() {\n   const [tab] = await chrome.tabs.query(queryOptions);\n   return tab;\n }\n+\n+interface TabWithIdAndURL extends chrome.tabs.Tab {\n+  id: number;\n+  url: string;\n+}\n+\n+export function okToInjectContentScript(\n+  tab: chrome.tabs.Tab\n+): tab is TabWithIdAndURL {\n+  return (\n+    tab.id !== undefined &&\n+    tab.url !== undefined &&\n+    (tab.url.startsWith(\"https://\") ||\n+      tab.url.startsWith(\"http://\") ||\n+      tab.url.startsWith(\"file://\"))\n+  );\n+}"
            },
            {
                "sha": "3adffa296a5ea68f73ff4c8760e7f14e42d4cae9",
                "filename": "tsconfig.json",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/tsconfig.json",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/tsconfig.json",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/tsconfig.json?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -1,7 +1,7 @@\n {\n   \"compilerOptions\": {\n     \"lib\": [\"ES2020.Promise\", \"es6\", \"dom\"],\n-    \"target\": \"es5\",\n+    \"target\": \"es6\",\n     \"strict\": true,\n     \"module\": \"es2015\",\n     \"rootDir\": \"src\",\n@@ -16,7 +16,7 @@\n     \"noImplicitReturns\": true,\n     \"pretty\": true,\n     \"sourceMap\": true,\n-    \"allowSyntheticDefaultImports\": true\n+    \"allowSyntheticDefaultImports\": true,\n   },\n   \"include\": [\n     \"src/*.ts\","
            },
            {
                "sha": "da1ffe1fb4da1e262ff31279d6211b5178a0f2db",
                "filename": "view/import.html",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/Authenticator-Extension/Authenticator/blob/17aa2068553db3c3aac081c9ffe393536f33b28b/view%2Fimport.html",
                "raw_url": "https://github.com/Authenticator-Extension/Authenticator/raw/17aa2068553db3c3aac081c9ffe393536f33b28b/view%2Fimport.html",
                "contents_url": "https://api.github.com/repos/Authenticator-Extension/Authenticator/contents/view%2Fimport.html?ref=17aa2068553db3c3aac081c9ffe393536f33b28b",
                "patch": "@@ -10,6 +10,9 @@\n <body>\n     <div id=\"import\"></div>\n     <script src=\"../dist/import.js\"></script>\n+    <iframe src=\"argon.html\"\n+        id=\"argon-sandbox\"\n+        style=\"display: none;\"></iframe>\n </body>\n \n </html>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/tinacms/tinacms/commits/110f1ceea4574d636a64526648f7c8bf6539b26a",
        "url": "https://api.github.com/repos/tinacms/tinacms/commits/110f1ceea4574d636a64526648f7c8bf6539b26a",
        "html_url": "https://github.com/tinacms/tinacms/commit/110f1ceea4574d636a64526648f7c8bf6539b26a",
        "message": "fix: @tinacms/cli: prevent search config from getting written to lock file (#4758)",
        "files": [
            {
                "sha": "c97b18117fe6525cabb243e9fa7cbc4d7a3df7a5",
                "filename": ".changeset/popular-bulldogs-heal.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/tinacms/tinacms/blob/110f1ceea4574d636a64526648f7c8bf6539b26a/.changeset%2Fpopular-bulldogs-heal.md",
                "raw_url": "https://github.com/tinacms/tinacms/raw/110f1ceea4574d636a64526648f7c8bf6539b26a/.changeset%2Fpopular-bulldogs-heal.md",
                "contents_url": "https://api.github.com/repos/tinacms/tinacms/contents/.changeset%2Fpopular-bulldogs-heal.md?ref=110f1ceea4574d636a64526648f7c8bf6539b26a",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@tinacms/cli': patch\n+---\n+\n+Fix tina-lock.json to not include search configuration, including search indexer token"
            },
            {
                "sha": "d6adb1e40a929662ddfeeaa6bf592ce839d9a68a",
                "filename": "packages/@tinacms/cli/src/next/codegen/index.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/tinacms/tinacms/blob/110f1ceea4574d636a64526648f7c8bf6539b26a/packages%2F%40tinacms%2Fcli%2Fsrc%2Fnext%2Fcodegen%2Findex.ts",
                "raw_url": "https://github.com/tinacms/tinacms/raw/110f1ceea4574d636a64526648f7c8bf6539b26a/packages%2F%40tinacms%2Fcli%2Fsrc%2Fnext%2Fcodegen%2Findex.ts",
                "contents_url": "https://api.github.com/repos/tinacms/tinacms/contents/packages%2F%40tinacms%2Fcli%2Fsrc%2Fnext%2Fcodegen%2Findex.ts?ref=110f1ceea4574d636a64526648f7c8bf6539b26a",
                "patch": "@@ -94,6 +94,10 @@ export class Codegen {\n       '_graphql.json',\n       JSON.stringify(this.graphqlSchemaDoc)\n     )\n+\n+    const { search, ...rest } = this.tinaSchema.schema.config\n+    this.tinaSchema.schema.config = rest\n+\n     // update _schema.json\n     await this.writeConfigFile(\n       '_schema.json',"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/d78b3072ffffbff3954bf9f3181e3daf8e93c1ab",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/d78b3072ffffbff3954bf9f3181e3daf8e93c1ab",
        "html_url": "https://github.com/keycloak/keycloak/commit/d78b3072ffffbff3954bf9f3181e3daf8e93c1ab",
        "message": "Support for blocking concurrent requests when brute force is enabled\n\nCloses #31726\n\nSigned-off-by: Pedro Igor <pigor.craveiro@gmail.com>\nSigned-off-by: Douglas Palmer <dpalmer@redhat.com>\nSigned-off-by: mposolda <mposolda@gmail.com>",
        "files": [
            {
                "sha": "e343578acc076245c3265e0d9f647782e32f523c",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBlockingBruteForceProtector.java",
                "status": "added",
                "additions": 118,
                "deletions": 0,
                "changes": 118,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d78b3072ffffbff3954bf9f3181e3daf8e93c1ab/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d78b3072ffffbff3954bf9f3181e3daf8e93c1ab/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java?ref=d78b3072ffffbff3954bf9f3181e3daf8e93c1ab",
                "patch": "@@ -0,0 +1,118 @@\n+/*\n+ * Copyright 2016 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.keycloak.services.managers;\n+\n+import java.util.Collections;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.keycloak.models.AbstractKeycloakTransaction;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.models.UserModel;\n+import org.keycloak.sessions.AuthenticationSessionModel;\n+\n+public class DefaultBlockingBruteForceProtector extends DefaultBruteForceProtector {\n+\n+    // make this configurable?\n+    private static final int DEFAULT_MAX_CONCURRENT_ATTEMPTS = 1000;\n+    private static final float DEFAULT_LOAD_FACTOR = 0.75f;\n+\n+    private final Map<String, String> loginAttempts = Collections.synchronizedMap(new LinkedHashMap(100, DEFAULT_LOAD_FACTOR) {\n+        @Override\n+        protected boolean removeEldestEntry(Entry eldest) {\n+            return loginAttempts.size() > DEFAULT_MAX_CONCURRENT_ATTEMPTS;\n+        }\n+    });\n+\n+    DefaultBlockingBruteForceProtector(KeycloakSessionFactory factory) {\n+        super(factory);\n+    }\n+\n+    @Override\n+    public boolean isPermanentlyLockedOut(KeycloakSession session, RealmModel realm, UserModel user) {\n+        if (super.isPermanentlyLockedOut(session, realm, user)) {\n+            return true;\n+        }\n+\n+        if (!realm.isPermanentLockout()) return false;\n+\n+        return isLoginInProgress(session, user);\n+    }\n+\n+    @Override\n+    public boolean isTemporarilyDisabled(KeycloakSession session, RealmModel realm, UserModel user) {\n+        if (super.isTemporarilyDisabled(session, realm, user)) {\n+            return true;\n+        }\n+\n+        return isLoginInProgress(session, user);\n+    }\n+\n+    private boolean isLoginInProgress(KeycloakSession session, UserModel user) {\n+        AuthenticationSessionModel authSession = session.getContext().getAuthenticationSession();\n+\n+        if (authSession == null) {\n+            // not authenticating as there is no auth session bound to the session\n+            return false;\n+        }\n+\n+        if (isCurrentLoginAttempt(user)) {\n+            return !tryEnlistBlockingTransaction(session, user);\n+        }\n+\n+        return true;\n+    }\n+\n+    // Return true if this thread successfully enlisted itself\n+    private boolean tryEnlistBlockingTransaction(KeycloakSession session, UserModel user) {\n+        String threadInProgress = loginAttempts.computeIfAbsent(user.getId(), k -> getThreadName());\n+\n+        // This means that this thread successfully added itself into the map. We can enlist transaction just in that case\n+        if (threadInProgress.equals(getThreadName())) {\n+            session.getTransactionManager().enlistAfterCompletion(new AbstractKeycloakTransaction() {\n+                @Override\n+                protected void commitImpl() {\n+                    unblock();\n+                }\n+\n+                @Override\n+                protected void rollbackImpl() {\n+                    unblock();\n+                }\n+\n+                private void unblock() {\n+                    loginAttempts.remove(user.getId());\n+                }\n+            });\n+\n+            return true;\n+        } else {\n+            return false;\n+        }\n+    }\n+\n+    private boolean isCurrentLoginAttempt(UserModel user) {\n+        return loginAttempts.getOrDefault(user.getId(), getThreadName()).equals(getThreadName());\n+    }\n+\n+    private String getThreadName() {\n+        return Thread.currentThread().getName();\n+    }\n+}"
            },
            {
                "sha": "7c6db8d5f527a8cdf3d51e1c7651fc18fd8792f8",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBruteForceProtectorFactory.java",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d78b3072ffffbff3954bf9f3181e3daf8e93c1ab/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtectorFactory.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d78b3072ffffbff3954bf9f3181e3daf8e93c1ab/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtectorFactory.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtectorFactory.java?ref=d78b3072ffffbff3954bf9f3181e3daf8e93c1ab",
                "patch": "@@ -28,21 +28,23 @@\n public class DefaultBruteForceProtectorFactory implements BruteForceProtectorFactory {\n     DefaultBruteForceProtector protector;\n \n+    private boolean allowConcurrentRequests;\n+\n     @Override\n     public BruteForceProtector create(KeycloakSession session) {\n         return protector;\n     }\n \n     @Override\n     public void init(Config.Scope config) {\n-\n+        // this can be a brute force setting?\n+        this.allowConcurrentRequests = config.getBoolean(\"allowConcurrentRequests\", Boolean.FALSE);\n     }\n \n     @Override\n     public void postInit(KeycloakSessionFactory factory) {\n-        protector = new DefaultBruteForceProtector(factory);\n+        protector = allowConcurrentRequests ? new DefaultBruteForceProtector(factory) : new DefaultBlockingBruteForceProtector(factory);\n         protector.start();\n-\n     }\n \n     @Override"
            },
            {
                "sha": "eb1770003c50eecab40cf8668c63ef54c3d21034",
                "filename": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/forms/BruteForceTest.java",
                "status": "modified",
                "additions": 89,
                "deletions": 8,
                "changes": 97,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d78b3072ffffbff3954bf9f3181e3daf8e93c1ab/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fforms%2FBruteForceTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d78b3072ffffbff3954bf9f3181e3daf8e93c1ab/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fforms%2FBruteForceTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fforms%2FBruteForceTest.java?ref=d78b3072ffffbff3954bf9f3181e3daf8e93c1ab",
                "patch": "@@ -97,7 +97,7 @@ public class BruteForceTest extends AbstractTestRealmKeycloakTest {\n \n     private int lifespan;\n \n-    private static final Integer failureFactor= 2;\n+    private static final Integer failureFactor = 2;\n \n     @Override\n     public void configureTestRealm(RealmRepresentation testRealm) {\n@@ -377,13 +377,13 @@ public void testNumberOfFailuresForPermanentlyDisabledUsersWithPasswordGrantType\n             assertUserNumberOfFailures(user.getId(), failureFactor);\n \n             events.clear();\n-         } finally {\n-             realm.setPermanentLockout(false);\n-             testRealm().update(realm);\n-             UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n-             user.setEnabled(true);\n-             updateUser(user);\n-         }\n+        } finally {\n+            realm.setPermanentLockout(false);\n+            testRealm().update(realm);\n+            UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+            user.setEnabled(true);\n+            updateUser(user);\n+        }\n     }\n \n     @Test\n@@ -608,6 +608,87 @@ public void testResetPassword() throws Exception {\n         events.clear();\n     }\n \n+    @Test\n+    public void testRaceAttackTemporaryLockout() throws Exception {\n+        RealmRepresentation realm = testRealm().toRepresentation();\n+        UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+        try {\n+            realm.setWaitIncrementSeconds(120);\n+            realm.setQuickLoginCheckMilliSeconds(120000L);\n+            testRealm().update(realm);\n+            clearUserFailures();\n+            clearAllUserFailures();\n+            user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+            user.setEnabled(true);\n+            testRealm().users().get(user.getId()).update(user);\n+            String totpSecret = totp.generateTOTP(\"totpSecret\");\n+            OAuthClient.AccessTokenResponse response = getTestToken(\"password\", totpSecret);\n+            Assert.assertNotNull(response.getAccessToken());\n+            raceAttack(user);\n+        } finally {\n+            realm.setWaitIncrementSeconds(5);\n+            realm.setQuickLoginCheckMilliSeconds(100L);\n+            testRealm().update(realm);\n+            user.setEnabled(true);\n+            updateUser(user);\n+        }\n+    }\n+\n+    @Test\n+    public void testRaceAttackPermanentLockout() throws Exception {\n+        RealmRepresentation realm = testRealm().toRepresentation();\n+        UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+        try {\n+            realm.setPermanentLockout(true);\n+            testRealm().update(realm);\n+            raceAttack(user);\n+            clearUserFailures();\n+            clearAllUserFailures();\n+            user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+            user.setEnabled(true);\n+            testRealm().users().get(user.getId()).update(user);\n+            String totpSecret = totp.generateTOTP(\"totpSecret\");\n+            OAuthClient.AccessTokenResponse response = getTestToken(\"password\", totpSecret);\n+            Assert.assertNotNull(response.getAccessToken());\n+        } finally {\n+            realm.setPermanentLockout(false);\n+            testRealm().update(realm);\n+            user.setEnabled(true);\n+            updateUser(user);\n+        }\n+    }\n+\n+    private void raceAttack(UserRepresentation user) throws Exception {\n+        int num = 100;\n+        LoginThread[] threads = new LoginThread[num];\n+        for (int i = 0; i < num; ++i) {\n+            threads[i] = new LoginThread();\n+        }\n+        for (int i = 0; i < num; ++i) {\n+            threads[i].start();\n+        }\n+        for (int i = 0; i < num; ++i) {\n+            threads[i].join();\n+        }\n+        int invalidCount =  (int) adminClient.realm(\"test\").attackDetection().bruteForceUserStatus(user.getId()).get(\"numFailures\");\n+        assertTrue(\"Invalid count should be less than or equal 2 but was: \" + invalidCount, invalidCount <= 2);\n+    }\n+\n+    public class LoginThread extends Thread {\n+\n+        public void run() {\n+            try {\n+                String totpSecret = totp.generateTOTP(\"totpSecret\");\n+                OAuthClient.AccessTokenResponse response = getTestToken(\"invalid\", totpSecret);\n+                Assert.assertNull(response.getAccessToken());\n+                Assert.assertEquals(response.getError(), \"invalid_grant\");\n+                Assert.assertEquals(response.getErrorDescription(), \"Invalid user credentials\");\n+            } catch (Exception ex) {\n+                ex.printStackTrace();\n+            }\n+        }\n+    }\n+\n     public void expectTemporarilyDisabled() throws Exception {\n         expectTemporarilyDisabled(\"test-user@localhost\", null, \"password\");\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/461fa631dc55b9739c9ed8c49de9f5b213955200",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/461fa631dc55b9739c9ed8c49de9f5b213955200",
        "html_url": "https://github.com/keycloak/keycloak/commit/461fa631dc55b9739c9ed8c49de9f5b213955200",
        "message": "Support for blocking concurrent requests when brute force is enabled\n\nCloses #31726\n\nSigned-off-by: Pedro Igor <pigor.craveiro@gmail.com>\nSigned-off-by: Douglas Palmer <dpalmer@redhat.com>\nSigned-off-by: mposolda <mposolda@gmail.com>",
        "files": [
            {
                "sha": "5d6f0dc25484a522a9e1b1451c6eeb71c7bd27ef",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBlockingBruteForceProtector.java",
                "status": "added",
                "additions": 118,
                "deletions": 0,
                "changes": 118,
                "blob_url": "https://github.com/keycloak/keycloak/blob/461fa631dc55b9739c9ed8c49de9f5b213955200/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/461fa631dc55b9739c9ed8c49de9f5b213955200/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java?ref=461fa631dc55b9739c9ed8c49de9f5b213955200",
                "patch": "@@ -0,0 +1,118 @@\n+/*\n+ * Copyright 2016 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.keycloak.services.managers;\n+\n+import java.util.Collections;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.keycloak.models.AbstractKeycloakTransaction;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.models.UserModel;\n+import org.keycloak.sessions.AuthenticationSessionModel;\n+\n+public class DefaultBlockingBruteForceProtector extends DefaultBruteForceProtector {\n+\n+    // make this configurable?\n+    private static final int DEFAULT_MAX_CONCURRENT_ATTEMPTS = 1000;\n+    private static final float DEFAULT_LOAD_FACTOR = 0.75f;\n+\n+    private final Map<String, String> loginAttempts = Collections.synchronizedMap(new LinkedHashMap<>(100, DEFAULT_LOAD_FACTOR) {\n+        @Override\n+        protected boolean removeEldestEntry(Entry<String, String> eldest) {\n+            return loginAttempts.size() > DEFAULT_MAX_CONCURRENT_ATTEMPTS;\n+        }\n+    });\n+\n+    DefaultBlockingBruteForceProtector(KeycloakSessionFactory factory) {\n+        super(factory);\n+    }\n+\n+    @Override\n+    public boolean isPermanentlyLockedOut(KeycloakSession session, RealmModel realm, UserModel user) {\n+        if (super.isPermanentlyLockedOut(session, realm, user)) {\n+            return true;\n+        }\n+\n+        if (!realm.isPermanentLockout()) return false;\n+\n+        return isLoginInProgress(session, user);\n+    }\n+\n+    @Override\n+    public boolean isTemporarilyDisabled(KeycloakSession session, RealmModel realm, UserModel user) {\n+        if (super.isTemporarilyDisabled(session, realm, user)) {\n+            return true;\n+        }\n+\n+        return isLoginInProgress(session, user);\n+    }\n+\n+    private boolean isLoginInProgress(KeycloakSession session, UserModel user) {\n+        AuthenticationSessionModel authSession = session.getContext().getAuthenticationSession();\n+\n+        if (authSession == null) {\n+            // not authenticating as there is no auth session bound to the session\n+            return false;\n+        }\n+\n+        if (isCurrentLoginAttempt(user)) {\n+            return !tryEnlistBlockingTransaction(session, user);\n+        }\n+\n+        return true;\n+    }\n+\n+    // Return true if this thread successfully enlisted itself\n+    private boolean tryEnlistBlockingTransaction(KeycloakSession session, UserModel user) {\n+        String threadInProgress = loginAttempts.computeIfAbsent(user.getId(), k -> getThreadName());\n+\n+        // This means that this thread successfully added itself into the map. We can enlist transaction just in that case\n+        if (threadInProgress.equals(getThreadName())) {\n+            session.getTransactionManager().enlistAfterCompletion(new AbstractKeycloakTransaction() {\n+                @Override\n+                protected void commitImpl() {\n+                    unblock();\n+                }\n+\n+                @Override\n+                protected void rollbackImpl() {\n+                    unblock();\n+                }\n+\n+                private void unblock() {\n+                    loginAttempts.remove(user.getId());\n+                }\n+            });\n+\n+            return true;\n+        } else {\n+            return false;\n+        }\n+    }\n+\n+    private boolean isCurrentLoginAttempt(UserModel user) {\n+        return loginAttempts.getOrDefault(user.getId(), getThreadName()).equals(getThreadName());\n+    }\n+\n+    private String getThreadName() {\n+        return Thread.currentThread().getName();\n+    }\n+}"
            },
            {
                "sha": "7c6db8d5f527a8cdf3d51e1c7651fc18fd8792f8",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBruteForceProtectorFactory.java",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/keycloak/keycloak/blob/461fa631dc55b9739c9ed8c49de9f5b213955200/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtectorFactory.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/461fa631dc55b9739c9ed8c49de9f5b213955200/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtectorFactory.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtectorFactory.java?ref=461fa631dc55b9739c9ed8c49de9f5b213955200",
                "patch": "@@ -28,21 +28,23 @@\n public class DefaultBruteForceProtectorFactory implements BruteForceProtectorFactory {\n     DefaultBruteForceProtector protector;\n \n+    private boolean allowConcurrentRequests;\n+\n     @Override\n     public BruteForceProtector create(KeycloakSession session) {\n         return protector;\n     }\n \n     @Override\n     public void init(Config.Scope config) {\n-\n+        // this can be a brute force setting?\n+        this.allowConcurrentRequests = config.getBoolean(\"allowConcurrentRequests\", Boolean.FALSE);\n     }\n \n     @Override\n     public void postInit(KeycloakSessionFactory factory) {\n-        protector = new DefaultBruteForceProtector(factory);\n+        protector = allowConcurrentRequests ? new DefaultBruteForceProtector(factory) : new DefaultBlockingBruteForceProtector(factory);\n         protector.start();\n-\n     }\n \n     @Override"
            },
            {
                "sha": "e896248125f7951a86f057f7575230640862cce1",
                "filename": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/forms/BruteForceTest.java",
                "status": "modified",
                "additions": 89,
                "deletions": 8,
                "changes": 97,
                "blob_url": "https://github.com/keycloak/keycloak/blob/461fa631dc55b9739c9ed8c49de9f5b213955200/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fforms%2FBruteForceTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/461fa631dc55b9739c9ed8c49de9f5b213955200/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fforms%2FBruteForceTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fforms%2FBruteForceTest.java?ref=461fa631dc55b9739c9ed8c49de9f5b213955200",
                "patch": "@@ -96,7 +96,7 @@ public class BruteForceTest extends AbstractTestRealmKeycloakTest {\n \n     private int lifespan;\n \n-    private static final Integer failureFactor= 2;\n+    private static final Integer failureFactor = 2;\n \n     @Override\n     public void configureTestRealm(RealmRepresentation testRealm) {\n@@ -376,13 +376,13 @@ public void testNumberOfFailuresForPermanentlyDisabledUsersWithPasswordGrantType\n             assertUserNumberOfFailures(user.getId(), failureFactor);\n \n             events.clear();\n-         } finally {\n-             realm.setPermanentLockout(false);\n-             testRealm().update(realm);\n-             UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n-             user.setEnabled(true);\n-             updateUser(user);\n-         }\n+        } finally {\n+            realm.setPermanentLockout(false);\n+            testRealm().update(realm);\n+            UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+            user.setEnabled(true);\n+            updateUser(user);\n+        }\n     }\n \n     @Test\n@@ -719,6 +719,87 @@ public void testResetPassword() throws Exception {\n         events.clear();\n     }\n \n+    @Test\n+    public void testRaceAttackTemporaryLockout() throws Exception {\n+        RealmRepresentation realm = testRealm().toRepresentation();\n+        UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+        try {\n+            realm.setWaitIncrementSeconds(120);\n+            realm.setQuickLoginCheckMilliSeconds(120000L);\n+            testRealm().update(realm);\n+            clearUserFailures();\n+            clearAllUserFailures();\n+            user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+            user.setEnabled(true);\n+            testRealm().users().get(user.getId()).update(user);\n+            String totpSecret = totp.generateTOTP(\"totpSecret\");\n+            OAuthClient.AccessTokenResponse response = getTestToken(\"password\", totpSecret);\n+            Assert.assertNotNull(response.getAccessToken());\n+            raceAttack(user);\n+        } finally {\n+            realm.setWaitIncrementSeconds(5);\n+            realm.setQuickLoginCheckMilliSeconds(100L);\n+            testRealm().update(realm);\n+            user.setEnabled(true);\n+            updateUser(user);\n+        }\n+    }\n+\n+    @Test\n+    public void testRaceAttackPermanentLockout() throws Exception {\n+        RealmRepresentation realm = testRealm().toRepresentation();\n+        UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+        try {\n+            realm.setPermanentLockout(true);\n+            testRealm().update(realm);\n+            raceAttack(user);\n+            clearUserFailures();\n+            clearAllUserFailures();\n+            user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+            user.setEnabled(true);\n+            testRealm().users().get(user.getId()).update(user);\n+            String totpSecret = totp.generateTOTP(\"totpSecret\");\n+            OAuthClient.AccessTokenResponse response = getTestToken(\"password\", totpSecret);\n+            Assert.assertNotNull(response.getAccessToken());\n+        } finally {\n+            realm.setPermanentLockout(false);\n+            testRealm().update(realm);\n+            user.setEnabled(true);\n+            updateUser(user);\n+        }\n+    }\n+\n+    private void raceAttack(UserRepresentation user) throws Exception {\n+        int num = 100;\n+        LoginThread[] threads = new LoginThread[num];\n+        for (int i = 0; i < num; ++i) {\n+            threads[i] = new LoginThread();\n+        }\n+        for (int i = 0; i < num; ++i) {\n+            threads[i].start();\n+        }\n+        for (int i = 0; i < num; ++i) {\n+            threads[i].join();\n+        }\n+        int invalidCount =  (int) adminClient.realm(\"test\").attackDetection().bruteForceUserStatus(user.getId()).get(\"numFailures\");\n+        assertTrue(\"Invalid count should be less than or equal 2 but was: \" + invalidCount, invalidCount <= 2);\n+    }\n+\n+    public class LoginThread extends Thread {\n+\n+        public void run() {\n+            try {\n+                String totpSecret = totp.generateTOTP(\"totpSecret\");\n+                OAuthClient.AccessTokenResponse response = getTestToken(\"invalid\", totpSecret);\n+                Assert.assertNull(response.getAccessToken());\n+                Assert.assertEquals(response.getError(), \"invalid_grant\");\n+                Assert.assertEquals(response.getErrorDescription(), \"Invalid user credentials\");\n+            } catch (Exception ex) {\n+                ex.printStackTrace();\n+            }\n+        }\n+    }\n+\n     public void expectTemporarilyDisabled() {\n         expectTemporarilyDisabled(\"test-user@localhost\", null, \"password\");\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/c8053dd812d9b9f05b293f901b9dc39e061ebb88",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/c8053dd812d9b9f05b293f901b9dc39e061ebb88",
        "html_url": "https://github.com/keycloak/keycloak/commit/c8053dd812d9b9f05b293f901b9dc39e061ebb88",
        "message": "Remove the attempt in brute force when the off-thread finishes\nCloses #31881\n\nSigned-off-by: rmartinc <rmartinc@redhat.com>",
        "files": [
            {
                "sha": "52345680d459579f5f2aac11365f264b11ba8ab8",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBlockingBruteForceProtector.java",
                "status": "modified",
                "additions": 54,
                "deletions": 17,
                "changes": 71,
                "blob_url": "https://github.com/keycloak/keycloak/blob/c8053dd812d9b9f05b293f901b9dc39e061ebb88/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/c8053dd812d9b9f05b293f901b9dc39e061ebb88/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java?ref=c8053dd812d9b9f05b293f901b9dc39e061ebb88",
                "patch": "@@ -20,7 +20,9 @@\n import java.util.LinkedHashMap;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.concurrent.atomic.AtomicBoolean;\n \n+import org.keycloak.common.ClientConnection;\n import org.keycloak.models.AbstractKeycloakTransaction;\n import org.keycloak.models.KeycloakSession;\n import org.keycloak.models.KeycloakSessionFactory;\n@@ -33,6 +35,7 @@ public class DefaultBlockingBruteForceProtector extends DefaultBruteForceProtect\n     // make this configurable?\n     private static final int DEFAULT_MAX_CONCURRENT_ATTEMPTS = 1000;\n     private static final float DEFAULT_LOAD_FACTOR = 0.75f;\n+    private static final String OFF_THREAD_STARTED = \"#brute_force_started\";\n \n     private final Map<String, String> loginAttempts = Collections.synchronizedMap(new LinkedHashMap<>(100, DEFAULT_LOAD_FACTOR) {\n         @Override\n@@ -73,46 +76,80 @@ private boolean isLoginInProgress(KeycloakSession session, UserModel user) {\n             return false;\n         }\n \n-        if (isCurrentLoginAttempt(user)) {\n-            return !tryEnlistBlockingTransaction(session, user);\n-        }\n-\n-        return true;\n+        return !tryEnlistBlockingTransactionOrSameThread(session, user);\n     }\n \n-    // Return true if this thread successfully enlisted itself\n-    private boolean tryEnlistBlockingTransaction(KeycloakSession session, UserModel user) {\n-        String threadInProgress = loginAttempts.computeIfAbsent(user.getId(), k -> getThreadName());\n+    // Return true if this thread successfully enlisted itself or it was already done by the same thread\n+    private boolean tryEnlistBlockingTransactionOrSameThread(KeycloakSession session, UserModel user) {\n+        AtomicBoolean inserted = new AtomicBoolean(false);\n+        String threadInProgress = loginAttempts.computeIfAbsent(user.getId(), k -> {\n+            inserted.set(true);\n+            return getThreadName();\n+        });\n \n         // This means that this thread successfully added itself into the map. We can enlist transaction just in that case\n-        if (threadInProgress.equals(getThreadName())) {\n+        if (inserted.get()) {\n             session.getTransactionManager().enlistAfterCompletion(new AbstractKeycloakTransaction() {\n                 @Override\n                 protected void commitImpl() {\n-                    unblock();\n+                    // remove or wait the brute force thread to finish\n+                    loginAttempts.computeIfPresent(user.getId(), (k, v) -> v.endsWith(OFF_THREAD_STARTED)? \"\" : null);\n                 }\n \n                 @Override\n                 protected void rollbackImpl() {\n-                    unblock();\n-                }\n-\n-                private void unblock() {\n+                    // remove on rollback\n                     loginAttempts.remove(user.getId());\n                 }\n             });\n \n             return true;\n         } else {\n-            return false;\n+            return isCurrentThread(threadInProgress);\n         }\n     }\n \n-    private boolean isCurrentLoginAttempt(UserModel user) {\n-        return loginAttempts.getOrDefault(user.getId(), getThreadName()).equals(getThreadName());\n+    private boolean isCurrentThread(String name) {\n+        return name.equals(getThreadName()) || name.equals(getThreadName() + OFF_THREAD_STARTED);\n     }\n \n     private String getThreadName() {\n         return Thread.currentThread().getName();\n     }\n+\n+    private void enlistRemoval(KeycloakSession session, String userId) {\n+        session.getTransactionManager().enlistAfterCompletion(new AbstractKeycloakTransaction() {\n+            @Override\n+            protected void commitImpl() {\n+                // remove or wait the main thread to finish\n+                loginAttempts.computeIfPresent(userId, (k, v) -> v.isEmpty()? null : v.substring(0, v.length() - OFF_THREAD_STARTED.length()));\n+            }\n+\n+            @Override\n+            protected void rollbackImpl() {\n+                loginAttempts.remove(userId);\n+            }\n+        });\n+    }\n+\n+    @Override\n+    protected void processLogin(KeycloakSession session, LoginEvent event) {\n+        // mark the off-thread is started for this request\n+        loginAttempts.computeIfPresent(event.userId, (k, v) -> v + OFF_THREAD_STARTED);\n+        super.processLogin(session, event);\n+    }\n+\n+    @Override\n+    protected void failure(KeycloakSession session, LoginEvent event) {\n+        // remove the user from concurrent login attemps once it's processed\n+        enlistRemoval(session, event.userId);\n+        super.failure(session, event);\n+    }\n+\n+    @Override\n+    protected void success(KeycloakSession session, LoginEvent event) {\n+        // remove the user from concurrent login attemps once it's processed\n+        enlistRemoval(session, event.userId);\n+        super.success(session, event);\n+    }\n }"
            },
            {
                "sha": "f43bdda94c4c5d12fbb8b7889e977a5fba50cd8d",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBruteForceProtector.java",
                "status": "modified",
                "additions": 11,
                "deletions": 5,
                "changes": 16,
                "blob_url": "https://github.com/keycloak/keycloak/blob/c8053dd812d9b9f05b293f901b9dc39e061ebb88/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtector.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/c8053dd812d9b9f05b293f901b9dc39e061ebb88/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtector.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtector.java?ref=c8053dd812d9b9f05b293f901b9dc39e061ebb88",
                "patch": "@@ -287,12 +287,10 @@ public void run() {\n                             session.getTransactionManager().begin();\n                             try {\n                                 for (LoginEvent event : events) {\n-                                    if (event instanceof FailedLogin) {\n-                                        failure(session, event);\n-                                    } else if (event instanceof SuccessfulLogin) {\n-                                        success(session, event);\n-                                    } else if (event instanceof ShutdownEvent) {\n+                                    if (event instanceof ShutdownEvent) {\n                                         run = false;\n+                                    } else {\n+                                        processLogin(session, event);\n                                     }\n                                 }\n                             } catch (Exception e) {\n@@ -368,6 +366,14 @@ public void successfulLogin(final RealmModel realm, final UserModel user, final\n         logger.trace(\"sent success event\");\n     }\n \n+    protected void processLogin(KeycloakSession session, LoginEvent event) {\n+        if (event instanceof SuccessfulLogin) {\n+            success(session, event);\n+        } else {\n+            failure(session, event);\n+        }\n+    }\n+\n     @Override\n     public boolean isTemporarilyDisabled(KeycloakSession session, RealmModel realm, UserModel user) {\n         UserLoginFailureModel failure = session.loginFailures().getUserLoginFailure(realm, user.getId());"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/2fb358e1a21c5387cdc11100ce3562b4dcfe5416",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/2fb358e1a21c5387cdc11100ce3562b4dcfe5416",
        "html_url": "https://github.com/keycloak/keycloak/commit/2fb358e1a21c5387cdc11100ce3562b4dcfe5416",
        "message": "Support for blocking concurrent requests when brute force is enabled\n\nCloses #31726\n\nSigned-off-by: Pedro Igor <pigor.craveiro@gmail.com>\nSigned-off-by: Douglas Palmer <dpalmer@redhat.com>\nSigned-off-by: mposolda <mposolda@gmail.com>",
        "files": [
            {
                "sha": "5d6f0dc25484a522a9e1b1451c6eeb71c7bd27ef",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBlockingBruteForceProtector.java",
                "status": "added",
                "additions": 118,
                "deletions": 0,
                "changes": 118,
                "blob_url": "https://github.com/keycloak/keycloak/blob/2fb358e1a21c5387cdc11100ce3562b4dcfe5416/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/2fb358e1a21c5387cdc11100ce3562b4dcfe5416/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java?ref=2fb358e1a21c5387cdc11100ce3562b4dcfe5416",
                "patch": "@@ -0,0 +1,118 @@\n+/*\n+ * Copyright 2016 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.keycloak.services.managers;\n+\n+import java.util.Collections;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+\n+import org.keycloak.models.AbstractKeycloakTransaction;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.models.UserModel;\n+import org.keycloak.sessions.AuthenticationSessionModel;\n+\n+public class DefaultBlockingBruteForceProtector extends DefaultBruteForceProtector {\n+\n+    // make this configurable?\n+    private static final int DEFAULT_MAX_CONCURRENT_ATTEMPTS = 1000;\n+    private static final float DEFAULT_LOAD_FACTOR = 0.75f;\n+\n+    private final Map<String, String> loginAttempts = Collections.synchronizedMap(new LinkedHashMap<>(100, DEFAULT_LOAD_FACTOR) {\n+        @Override\n+        protected boolean removeEldestEntry(Entry<String, String> eldest) {\n+            return loginAttempts.size() > DEFAULT_MAX_CONCURRENT_ATTEMPTS;\n+        }\n+    });\n+\n+    DefaultBlockingBruteForceProtector(KeycloakSessionFactory factory) {\n+        super(factory);\n+    }\n+\n+    @Override\n+    public boolean isPermanentlyLockedOut(KeycloakSession session, RealmModel realm, UserModel user) {\n+        if (super.isPermanentlyLockedOut(session, realm, user)) {\n+            return true;\n+        }\n+\n+        if (!realm.isPermanentLockout()) return false;\n+\n+        return isLoginInProgress(session, user);\n+    }\n+\n+    @Override\n+    public boolean isTemporarilyDisabled(KeycloakSession session, RealmModel realm, UserModel user) {\n+        if (super.isTemporarilyDisabled(session, realm, user)) {\n+            return true;\n+        }\n+\n+        return isLoginInProgress(session, user);\n+    }\n+\n+    private boolean isLoginInProgress(KeycloakSession session, UserModel user) {\n+        AuthenticationSessionModel authSession = session.getContext().getAuthenticationSession();\n+\n+        if (authSession == null) {\n+            // not authenticating as there is no auth session bound to the session\n+            return false;\n+        }\n+\n+        if (isCurrentLoginAttempt(user)) {\n+            return !tryEnlistBlockingTransaction(session, user);\n+        }\n+\n+        return true;\n+    }\n+\n+    // Return true if this thread successfully enlisted itself\n+    private boolean tryEnlistBlockingTransaction(KeycloakSession session, UserModel user) {\n+        String threadInProgress = loginAttempts.computeIfAbsent(user.getId(), k -> getThreadName());\n+\n+        // This means that this thread successfully added itself into the map. We can enlist transaction just in that case\n+        if (threadInProgress.equals(getThreadName())) {\n+            session.getTransactionManager().enlistAfterCompletion(new AbstractKeycloakTransaction() {\n+                @Override\n+                protected void commitImpl() {\n+                    unblock();\n+                }\n+\n+                @Override\n+                protected void rollbackImpl() {\n+                    unblock();\n+                }\n+\n+                private void unblock() {\n+                    loginAttempts.remove(user.getId());\n+                }\n+            });\n+\n+            return true;\n+        } else {\n+            return false;\n+        }\n+    }\n+\n+    private boolean isCurrentLoginAttempt(UserModel user) {\n+        return loginAttempts.getOrDefault(user.getId(), getThreadName()).equals(getThreadName());\n+    }\n+\n+    private String getThreadName() {\n+        return Thread.currentThread().getName();\n+    }\n+}"
            },
            {
                "sha": "53a8ad6d46e4c7100cb1e42e7480f5ea3a1ed0e5",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBruteForceProtectorFactory.java",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/keycloak/keycloak/blob/2fb358e1a21c5387cdc11100ce3562b4dcfe5416/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtectorFactory.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/2fb358e1a21c5387cdc11100ce3562b4dcfe5416/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtectorFactory.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtectorFactory.java?ref=2fb358e1a21c5387cdc11100ce3562b4dcfe5416",
                "patch": "@@ -28,19 +28,22 @@\n public class DefaultBruteForceProtectorFactory implements BruteForceProtectorFactory {\n     DefaultBruteForceProtector protector;\n \n+    private boolean allowConcurrentRequests;\n+\n     @Override\n     public BruteForceProtector create(KeycloakSession session) {\n         return protector;\n     }\n \n     @Override\n     public void init(Config.Scope config) {\n-\n+        // this can be a brute force setting?\n+        this.allowConcurrentRequests = config.getBoolean(\"allowConcurrentRequests\", Boolean.FALSE);\n     }\n \n     @Override\n     public void postInit(KeycloakSessionFactory factory) {\n-        protector = new DefaultBruteForceProtector(factory);\n+        protector = allowConcurrentRequests ? new DefaultBruteForceProtector(factory) : new DefaultBlockingBruteForceProtector(factory);\n     }\n \n     @Override"
            },
            {
                "sha": "811761df5309d870cb961bc7cf6e6ec12cea0f6d",
                "filename": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/forms/BruteForceTest.java",
                "status": "modified",
                "additions": 94,
                "deletions": 12,
                "changes": 106,
                "blob_url": "https://github.com/keycloak/keycloak/blob/2fb358e1a21c5387cdc11100ce3562b4dcfe5416/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fforms%2FBruteForceTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/2fb358e1a21c5387cdc11100ce3562b4dcfe5416/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fforms%2FBruteForceTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Fforms%2FBruteForceTest.java?ref=2fb358e1a21c5387cdc11100ce3562b4dcfe5416",
                "patch": "@@ -100,7 +100,7 @@ public class BruteForceTest extends AbstractTestRealmKeycloakTest {\n \n     private int lifespan;\n \n-    private static final Integer failureFactor= 2;\n+    private static final Integer failureFactor = 2;\n \n     @Override\n     public void configureTestRealm(RealmRepresentation testRealm) {\n@@ -380,13 +380,13 @@ public void testNumberOfFailuresForPermanentlyDisabledUsersWithPasswordGrantType\n             assertUserNumberOfFailures(user.getId(), failureFactor);\n \n             events.clear();\n-         } finally {\n-             realm.setPermanentLockout(false);\n-             testRealm().update(realm);\n-             UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n-             user.setEnabled(true);\n-             updateUser(user);\n-         }\n+        } finally {\n+            realm.setPermanentLockout(false);\n+            testRealm().update(realm);\n+            UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+            user.setEnabled(true);\n+            updateUser(user);\n+        }\n     }\n \n     @Test\n@@ -416,7 +416,7 @@ public void testFailureResetForTemporaryLockout() throws Exception {\n             loginInvalidPassword();\n \n             //Wait for brute force executor to process the login and then wait for delta time\n-            waitForExecutors(numExecutors+1);\n+            waitForExecutors(numExecutors + 1);\n             testingClient.testing().setTimeOffset(Collections.singletonMap(\"offset\", String.valueOf(5)));\n \n             loginInvalidPassword();\n@@ -438,7 +438,7 @@ public void testNoFailureResetForPermanentLockout() throws Exception {\n             loginInvalidPassword();\n \n             //Wait for brute force executor to process the login and then wait for delta time\n-            waitForExecutors(numExecutors+1);\n+            waitForExecutors(numExecutors + 1);\n             testingClient.testing().setTimeOffset(Collections.singletonMap(\"offset\", String.valueOf(5)));\n \n             loginInvalidPassword();\n@@ -468,10 +468,11 @@ private void waitForExecutors(long numExecutors) {\n             ExecutorsProvider provider = session.getProvider(ExecutorsProvider.class);\n             ExecutorService executor = provider.getExecutor(\"bruteforce\");\n             ThreadPoolExecutor threadPoolExecutor = (ThreadPoolExecutor) executor;\n-            while(!threadPoolExecutor.getQueue().isEmpty()) {\n+            while (!threadPoolExecutor.getQueue().isEmpty()) {\n                 try {\n                     Thread.sleep(1000);\n-                } catch (Exception e) {}\n+                } catch (Exception e) {\n+                }\n             }\n             assertEquals(numExecutors, threadPoolExecutor.getCompletedTaskCount());\n         });\n@@ -753,6 +754,87 @@ public void testResetPassword() throws Exception {\n         events.clear();\n     }\n \n+    @Test\n+    public void testRaceAttackTemporaryLockout() throws Exception {\n+        RealmRepresentation realm = testRealm().toRepresentation();\n+        UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+        try {\n+            realm.setWaitIncrementSeconds(120);\n+            realm.setQuickLoginCheckMilliSeconds(120000L);\n+            testRealm().update(realm);\n+            clearUserFailures();\n+            clearAllUserFailures();\n+            user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+            user.setEnabled(true);\n+            testRealm().users().get(user.getId()).update(user);\n+            String totpSecret = totp.generateTOTP(\"totpSecret\");\n+            OAuthClient.AccessTokenResponse response = getTestToken(\"password\", totpSecret);\n+            Assert.assertNotNull(response.getAccessToken());\n+            raceAttack(user);\n+        } finally {\n+            realm.setWaitIncrementSeconds(5);\n+            realm.setQuickLoginCheckMilliSeconds(100L);\n+            testRealm().update(realm);\n+            user.setEnabled(true);\n+            updateUser(user);\n+        }\n+    }\n+\n+    @Test\n+    public void testRaceAttackPermanentLockout() throws Exception {\n+        RealmRepresentation realm = testRealm().toRepresentation();\n+        UserRepresentation user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+        try {\n+            realm.setPermanentLockout(true);\n+            testRealm().update(realm);\n+            raceAttack(user);\n+            clearUserFailures();\n+            clearAllUserFailures();\n+            user = adminClient.realm(\"test\").users().search(\"test-user@localhost\", 0, 1).get(0);\n+            user.setEnabled(true);\n+            testRealm().users().get(user.getId()).update(user);\n+            String totpSecret = totp.generateTOTP(\"totpSecret\");\n+            OAuthClient.AccessTokenResponse response = getTestToken(\"password\", totpSecret);\n+            Assert.assertNotNull(response.getAccessToken());\n+        } finally {\n+            realm.setPermanentLockout(false);\n+            testRealm().update(realm);\n+            user.setEnabled(true);\n+            updateUser(user);\n+        }\n+    }\n+\n+    private void raceAttack(UserRepresentation user) throws Exception {\n+        int num = 100;\n+        LoginThread[] threads = new LoginThread[num];\n+        for (int i = 0; i < num; ++i) {\n+            threads[i] = new LoginThread();\n+        }\n+        for (int i = 0; i < num; ++i) {\n+            threads[i].start();\n+        }\n+        for (int i = 0; i < num; ++i) {\n+            threads[i].join();\n+        }\n+        int invalidCount =  (int) adminClient.realm(\"test\").attackDetection().bruteForceUserStatus(user.getId()).get(\"numFailures\");\n+        assertTrue(\"Invalid count should be less than or equal 2 but was: \" + invalidCount, invalidCount <= 2);\n+    }\n+\n+    public class LoginThread extends Thread {\n+\n+        public void run() {\n+            try {\n+                String totpSecret = totp.generateTOTP(\"totpSecret\");\n+                OAuthClient.AccessTokenResponse response = getTestToken(\"invalid\", totpSecret);\n+                Assert.assertNull(response.getAccessToken());\n+                Assert.assertEquals(response.getError(), \"invalid_grant\");\n+                Assert.assertEquals(response.getErrorDescription(), \"Invalid user credentials\");\n+            } catch (Exception ex) {\n+                ex.printStackTrace();\n+            }\n+        }\n+    }\n+\n     public void expectTemporarilyDisabled() {\n         expectTemporarilyDisabled(\"test-user@localhost\", null, \"password\");\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/99f92ad5fff5555d53930c2d32f8be3e08c514c1",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/99f92ad5fff5555d53930c2d32f8be3e08c514c1",
        "html_url": "https://github.com/keycloak/keycloak/commit/99f92ad5fff5555d53930c2d32f8be3e08c514c1",
        "message": "Remove the attempt in brute force when the off-thread finishes\nCloses #31881\n\nSigned-off-by: rmartinc <rmartinc@redhat.com>",
        "files": [
            {
                "sha": "2b148a30b9a7da56cee885b5f6e650e845944b6d",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBlockingBruteForceProtector.java",
                "status": "modified",
                "additions": 54,
                "deletions": 17,
                "changes": 71,
                "blob_url": "https://github.com/keycloak/keycloak/blob/99f92ad5fff5555d53930c2d32f8be3e08c514c1/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/99f92ad5fff5555d53930c2d32f8be3e08c514c1/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java?ref=99f92ad5fff5555d53930c2d32f8be3e08c514c1",
                "patch": "@@ -20,7 +20,9 @@\n import java.util.LinkedHashMap;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.concurrent.atomic.AtomicBoolean;\n \n+import org.keycloak.common.ClientConnection;\n import org.keycloak.models.AbstractKeycloakTransaction;\n import org.keycloak.models.KeycloakSession;\n import org.keycloak.models.KeycloakSessionFactory;\n@@ -33,6 +35,7 @@ public class DefaultBlockingBruteForceProtector extends DefaultBruteForceProtect\n     // make this configurable?\n     private static final int DEFAULT_MAX_CONCURRENT_ATTEMPTS = 1000;\n     private static final float DEFAULT_LOAD_FACTOR = 0.75f;\n+    private static final String OFF_THREAD_STARTED = \"#brute_force_started\";\n \n     private final Map<String, String> loginAttempts = Collections.synchronizedMap(new LinkedHashMap<>(100, DEFAULT_LOAD_FACTOR) {\n         @Override\n@@ -73,46 +76,80 @@ private boolean isLoginInProgress(KeycloakSession session, UserModel user) {\n             return false;\n         }\n \n-        if (isCurrentLoginAttempt(user)) {\n-            return !tryEnlistBlockingTransaction(session, user);\n-        }\n-\n-        return true;\n+        return !tryEnlistBlockingTransactionOrSameThread(session, user);\n     }\n \n-    // Return true if this thread successfully enlisted itself\n-    private boolean tryEnlistBlockingTransaction(KeycloakSession session, UserModel user) {\n-        String threadInProgress = loginAttempts.computeIfAbsent(user.getId(), k -> getThreadName());\n+    // Return true if this thread successfully enlisted itself or it was already done by the same thread\n+    private boolean tryEnlistBlockingTransactionOrSameThread(KeycloakSession session, UserModel user) {\n+        AtomicBoolean inserted = new AtomicBoolean(false);\n+        String threadInProgress = loginAttempts.computeIfAbsent(user.getId(), k -> {\n+            inserted.set(true);\n+            return getThreadName();\n+        });\n \n         // This means that this thread successfully added itself into the map. We can enlist transaction just in that case\n-        if (threadInProgress.equals(getThreadName())) {\n+        if (inserted.get()) {\n             session.getTransactionManager().enlistAfterCompletion(new AbstractKeycloakTransaction() {\n                 @Override\n                 protected void commitImpl() {\n-                    unblock();\n+                    // remove or wait the brute force thread to finish\n+                    loginAttempts.computeIfPresent(user.getId(), (k, v) -> v.endsWith(OFF_THREAD_STARTED)? \"\" : null);\n                 }\n \n                 @Override\n                 protected void rollbackImpl() {\n-                    unblock();\n-                }\n-\n-                private void unblock() {\n+                    // remove on rollback\n                     loginAttempts.remove(user.getId());\n                 }\n             });\n \n             return true;\n         } else {\n-            return false;\n+            return isCurrentThread(threadInProgress);\n         }\n     }\n \n-    private boolean isCurrentLoginAttempt(UserModel user) {\n-        return loginAttempts.getOrDefault(user.getId(), getThreadName()).equals(getThreadName());\n+    private boolean isCurrentThread(String name) {\n+        return name.equals(getThreadName()) || name.equals(getThreadName() + OFF_THREAD_STARTED);\n     }\n \n     private String getThreadName() {\n         return Thread.currentThread().getName();\n     }\n+\n+    private void enlistRemoval(KeycloakSession session, String userId) {\n+        session.getTransactionManager().enlistAfterCompletion(new AbstractKeycloakTransaction() {\n+            @Override\n+            protected void commitImpl() {\n+                // remove or wait the main thread to finish\n+                loginAttempts.computeIfPresent(userId, (k, v) -> v.isEmpty()? null : v.substring(0, v.length() - OFF_THREAD_STARTED.length()));\n+            }\n+\n+            @Override\n+            protected void rollbackImpl() {\n+                loginAttempts.remove(userId);\n+            }\n+        });\n+    }\n+\n+    @Override\n+    protected void processLogin(RealmModel realm, UserModel user, ClientConnection clientConnection, boolean success) {\n+        // mark the off-thread is started for this request\n+        loginAttempts.computeIfPresent(user.getId(), (k, v) -> v + OFF_THREAD_STARTED);\n+        super.processLogin(realm, user, clientConnection, success);\n+    }\n+\n+    @Override\n+    protected void failure(KeycloakSession session, RealmModel realm, String userId, String remoteAddr, long failureTime) {\n+        // remove the user from concurrent login attemps once it's processed\n+        enlistRemoval(session, userId);\n+        super.failure(session, realm, userId, remoteAddr, failureTime);\n+    }\n+\n+    @Override\n+    protected void success(KeycloakSession session, RealmModel realm, String userId) {\n+        // remove the user from concurrent login attemps once it's processed\n+        enlistRemoval(session, userId);\n+        super.success(session, realm, userId);\n+    }\n }"
            },
            {
                "sha": "7a82ff0480a608a7f71f7cc22a47bf20b2c4e790",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBruteForceProtector.java",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/keycloak/keycloak/blob/99f92ad5fff5555d53930c2d32f8be3e08c514c1/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtector.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/99f92ad5fff5555d53930c2d32f8be3e08c514c1/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtector.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtector.java?ref=99f92ad5fff5555d53930c2d32f8be3e08c514c1",
                "patch": "@@ -180,10 +180,11 @@ public void successfulLogin(RealmModel realm, UserModel user, ClientConnection c\n         logger.trace(\"sent success event\");\n     }\n \n-    private void processLogin(RealmModel realm, UserModel user, ClientConnection clientConnection, boolean success) {\n-        KeycloakSession session = factory.create();\n-        ExecutorsProvider provider = session.getProvider(ExecutorsProvider.class);\n-        ExecutorService executor = provider.getExecutor(\"bruteforce\");\n+    protected void processLogin(RealmModel realm, UserModel user, ClientConnection clientConnection, boolean success) {\n+        ExecutorService executor = KeycloakModelUtils.runJobInTransactionWithResult(factory, session -> {\n+            ExecutorsProvider provider = session.getProvider(ExecutorsProvider.class);\n+            return provider.getExecutor(\"bruteforce\");\n+        });\n         executor.execute(() -> KeycloakModelUtils.runJobInTransaction(factory, s -> {\n             if (success) {\n                 success(s, realm, user.getId());"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/b25c28458a562abda2f84fc684e59cce8577e562",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/b25c28458a562abda2f84fc684e59cce8577e562",
        "html_url": "https://github.com/keycloak/keycloak/commit/b25c28458a562abda2f84fc684e59cce8577e562",
        "message": "Remove the attempt in brute force when the off-thread finishes\nCloses #31881\n\nSigned-off-by: rmartinc <rmartinc@redhat.com>",
        "files": [
            {
                "sha": "063a97c08d7eefef88164ad38909f5655a95d924",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBlockingBruteForceProtector.java",
                "status": "modified",
                "additions": 54,
                "deletions": 17,
                "changes": 71,
                "blob_url": "https://github.com/keycloak/keycloak/blob/b25c28458a562abda2f84fc684e59cce8577e562/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/b25c28458a562abda2f84fc684e59cce8577e562/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBlockingBruteForceProtector.java?ref=b25c28458a562abda2f84fc684e59cce8577e562",
                "patch": "@@ -20,7 +20,9 @@\n import java.util.LinkedHashMap;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.concurrent.atomic.AtomicBoolean;\n \n+import org.keycloak.common.ClientConnection;\n import org.keycloak.models.AbstractKeycloakTransaction;\n import org.keycloak.models.KeycloakSession;\n import org.keycloak.models.KeycloakSessionFactory;\n@@ -33,6 +35,7 @@ public class DefaultBlockingBruteForceProtector extends DefaultBruteForceProtect\n     // make this configurable?\n     private static final int DEFAULT_MAX_CONCURRENT_ATTEMPTS = 1000;\n     private static final float DEFAULT_LOAD_FACTOR = 0.75f;\n+    private static final String OFF_THREAD_STARTED = \"#brute_force_started\";\n \n     private final Map<String, String> loginAttempts = Collections.synchronizedMap(new LinkedHashMap(100, DEFAULT_LOAD_FACTOR) {\n         @Override\n@@ -73,46 +76,80 @@ private boolean isLoginInProgress(KeycloakSession session, UserModel user) {\n             return false;\n         }\n \n-        if (isCurrentLoginAttempt(user)) {\n-            return !tryEnlistBlockingTransaction(session, user);\n-        }\n-\n-        return true;\n+        return !tryEnlistBlockingTransactionOrSameThread(session, user);\n     }\n \n-    // Return true if this thread successfully enlisted itself\n-    private boolean tryEnlistBlockingTransaction(KeycloakSession session, UserModel user) {\n-        String threadInProgress = loginAttempts.computeIfAbsent(user.getId(), k -> getThreadName());\n+    // Return true if this thread successfully enlisted itself or it was already done by the same thread\n+    private boolean tryEnlistBlockingTransactionOrSameThread(KeycloakSession session, UserModel user) {\n+        AtomicBoolean inserted = new AtomicBoolean(false);\n+        String threadInProgress = loginAttempts.computeIfAbsent(user.getId(), k -> {\n+            inserted.set(true);\n+            return getThreadName();\n+        });\n \n         // This means that this thread successfully added itself into the map. We can enlist transaction just in that case\n-        if (threadInProgress.equals(getThreadName())) {\n+        if (inserted.get()) {\n             session.getTransactionManager().enlistAfterCompletion(new AbstractKeycloakTransaction() {\n                 @Override\n                 protected void commitImpl() {\n-                    unblock();\n+                    // remove or wait the brute force thread to finish\n+                    loginAttempts.computeIfPresent(user.getId(), (k, v) -> v.endsWith(OFF_THREAD_STARTED)? \"\" : null);\n                 }\n \n                 @Override\n                 protected void rollbackImpl() {\n-                    unblock();\n-                }\n-\n-                private void unblock() {\n+                    // remove on rollback\n                     loginAttempts.remove(user.getId());\n                 }\n             });\n \n             return true;\n         } else {\n-            return false;\n+            return isCurrentThread(threadInProgress);\n         }\n     }\n \n-    private boolean isCurrentLoginAttempt(UserModel user) {\n-        return loginAttempts.getOrDefault(user.getId(), getThreadName()).equals(getThreadName());\n+    private boolean isCurrentThread(String name) {\n+        return name.equals(getThreadName()) || name.equals(getThreadName() + OFF_THREAD_STARTED);\n     }\n \n     private String getThreadName() {\n         return Thread.currentThread().getName();\n     }\n+\n+    private void enlistRemoval(KeycloakSession session, String userId) {\n+        session.getTransactionManager().enlistAfterCompletion(new AbstractKeycloakTransaction() {\n+            @Override\n+            protected void commitImpl() {\n+                // remove or wait the main thread to finish\n+                loginAttempts.computeIfPresent(userId, (k, v) -> v.isEmpty()? null : v.substring(0, v.length() - OFF_THREAD_STARTED.length()));\n+            }\n+\n+            @Override\n+            protected void rollbackImpl() {\n+                loginAttempts.remove(userId);\n+            }\n+        });\n+    }\n+\n+    @Override\n+    protected void processLogin(KeycloakSession session, LoginEvent event) {\n+        // mark the off-thread is started for this request\n+        loginAttempts.computeIfPresent(event.userId, (k, v) -> v + OFF_THREAD_STARTED);\n+        super.processLogin(session, event);\n+    }\n+\n+    @Override\n+    protected void failure(KeycloakSession session, LoginEvent event) {\n+        // remove the user from concurrent login attemps once it's processed\n+        enlistRemoval(session, event.userId);\n+        super.failure(session, event);\n+    }\n+\n+    @Override\n+    protected void success(KeycloakSession session, LoginEvent event) {\n+        // remove the user from concurrent login attemps once it's processed\n+        enlistRemoval(session, event.userId);\n+        super.success(session, event);\n+    }\n }"
            },
            {
                "sha": "72d2d0ee83fc134358201cd6a102316c92f25639",
                "filename": "services/src/main/java/org/keycloak/services/managers/DefaultBruteForceProtector.java",
                "status": "modified",
                "additions": 11,
                "deletions": 5,
                "changes": 16,
                "blob_url": "https://github.com/keycloak/keycloak/blob/b25c28458a562abda2f84fc684e59cce8577e562/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtector.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/b25c28458a562abda2f84fc684e59cce8577e562/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtector.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fservices%2Fmanagers%2FDefaultBruteForceProtector.java?ref=b25c28458a562abda2f84fc684e59cce8577e562",
                "patch": "@@ -217,12 +217,10 @@ public void run() {\n                             session.getTransactionManager().begin();\n                             try {\n                                 for (LoginEvent event : events) {\n-                                    if (event instanceof FailedLogin) {\n-                                        failure(session, event);\n-                                    } else if (event instanceof SuccessfulLogin) {\n-                                        success(session, event);\n-                                    } else if (event instanceof ShutdownEvent) {\n+                                    if (event instanceof ShutdownEvent) {\n                                         run = false;\n+                                    } else {\n+                                        processLogin(session, event);\n                                     }\n                                 }\n                             } catch (Exception e) {\n@@ -299,6 +297,14 @@ public void successfulLogin(final RealmModel realm, final UserModel user, final\n         logger.trace(\"sent success event\");\n     }\n \n+    protected void processLogin(KeycloakSession session, LoginEvent event) {\n+        if (event instanceof SuccessfulLogin) {\n+            success(session, event);\n+        } else {\n+            failure(session, event);\n+        }\n+    }\n+\n     @Override\n     public boolean isTemporarilyDisabled(KeycloakSession session, RealmModel realm, UserModel user) {\n         UserLoginFailureModel failure = session.loginFailures().getUserLoginFailure(realm, user.getId());"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/blakeembrey/js-template/commits/b8d9aa999e464816c6cfb14acd1ad0f5d1e335aa",
        "url": "https://api.github.com/repos/blakeembrey/js-template/commits/b8d9aa999e464816c6cfb14acd1ad0f5d1e335aa",
        "html_url": "https://github.com/blakeembrey/js-template/commit/b8d9aa999e464816c6cfb14acd1ad0f5d1e335aa",
        "message": "Remove template display name",
        "files": [
            {
                "sha": "21fbb728e9732c237567c0f6cfd07a40f10ceb40",
                "filename": "src/index.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/blakeembrey/js-template/blob/b8d9aa999e464816c6cfb14acd1ad0f5d1e335aa/src%2Findex.ts",
                "raw_url": "https://github.com/blakeembrey/js-template/raw/b8d9aa999e464816c6cfb14acd1ad0f5d1e335aa/src%2Findex.ts",
                "contents_url": "https://api.github.com/repos/blakeembrey/js-template/contents/src%2Findex.ts?ref=b8d9aa999e464816c6cfb14acd1ad0f5d1e335aa",
                "patch": "@@ -7,7 +7,7 @@ export type Template<T extends object> = (data: T) => string;\n /**\n  * Stringify a template into a function.\n  */\n-export function compile(value: string, displayName = \"template\") {\n+export function compile(value: string) {\n   let result = QUOTE_CHAR;\n   for (let i = 0; i < value.length; i++) {\n     const char = value[i];\n@@ -50,16 +50,13 @@ export function compile(value: string, displayName = \"template\") {\n   }\n   result += QUOTE_CHAR;\n \n-  return `function ${displayName}(${INPUT_VAR_NAME}) { return ${result}; }`;\n+  return `function (${INPUT_VAR_NAME}) { return ${result}; }`;\n }\n \n /**\n  * Fast and simple string templates.\n  */\n-export function template<T extends object = object>(\n-  value: string,\n-  displayName?: string\n-) {\n-  const body = compile(value, displayName);\n+export function template<T extends object = object>(value: string) {\n+  const body = compile(value);\n   return new Function(`return (${body});`)() as Template<T>;\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/CloudCannon/pagefind/commits/14ec96864eabaf1d7d809d5da0186a8856261eeb",
        "url": "https://api.github.com/repos/Pagefind/pagefind/commits/14ec96864eabaf1d7d809d5da0186a8856261eeb",
        "html_url": "https://github.com/Pagefind/pagefind/commit/14ec96864eabaf1d7d809d5da0186a8856261eeb",
        "message": "Merge pull request #696 from CloudCannon/fix/dom-clobber\n\nAdd safety checks around accesses for `document.currentScript.src`",
        "files": [
            {
                "sha": "a40b5867f65c18b57b5b8221949ba10ebcb22404",
                "filename": "pagefind_ui/default/svelte/ui.svelte",
                "status": "modified",
                "additions": 13,
                "deletions": 3,
                "changes": 16,
                "blob_url": "https://github.com/Pagefind/pagefind/blob/14ec96864eabaf1d7d809d5da0186a8856261eeb/pagefind_ui%2Fdefault%2Fsvelte%2Fui.svelte",
                "raw_url": "https://github.com/Pagefind/pagefind/raw/14ec96864eabaf1d7d809d5da0186a8856261eeb/pagefind_ui%2Fdefault%2Fsvelte%2Fui.svelte",
                "contents_url": "https://api.github.com/repos/Pagefind/pagefind/contents/pagefind_ui%2Fdefault%2Fsvelte%2Fui.svelte?ref=14ec96864eabaf1d7d809d5da0186a8856261eeb",
                "patch": "@@ -99,11 +99,21 @@\n           [\n             `Pagefind couldn't be loaded from ${this.options.bundlePath}pagefind.js`,\n             `You can configure this by passing a bundlePath option to PagefindUI`,\n-            `[DEBUG: Loaded from ${\n-              document?.currentScript?.src ?? \"no known script location\"\n-            }]`,\n           ].join(\"\\n\")\n         );\n+        // Important: Check that the element is indeed a <script> node, to avoid a DOM clobbering vulnerability\n+        if (\n+          document?.currentScript &&\n+          document.currentScript.tagName.toUpperCase() === \"SCRIPT\"\n+        ) {\n+          console.error(\n+            `[DEBUG: Loaded from ${\n+              document.currentScript.src ?? \"bad script location\"\n+            }]`\n+          );\n+        } else {\n+          console.error(\"no known script location\");\n+        }\n       }\n \n       if (!excerpt_length) {"
            },
            {
                "sha": "f0762c31b8289ea8ca821e738a2916f4682d019f",
                "filename": "pagefind_ui/default/ui-core.js",
                "status": "modified",
                "additions": 6,
                "deletions": 3,
                "changes": 9,
                "blob_url": "https://github.com/Pagefind/pagefind/blob/14ec96864eabaf1d7d809d5da0186a8856261eeb/pagefind_ui%2Fdefault%2Fui-core.js",
                "raw_url": "https://github.com/Pagefind/pagefind/raw/14ec96864eabaf1d7d809d5da0186a8856261eeb/pagefind_ui%2Fdefault%2Fui-core.js",
                "contents_url": "https://api.github.com/repos/Pagefind/pagefind/contents/pagefind_ui%2Fdefault%2Fui-core.js?ref=14ec96864eabaf1d7d809d5da0186a8856261eeb",
                "patch": "@@ -2,9 +2,12 @@ import PagefindSvelte from \"./svelte/ui.svelte\";\n \n let scriptBundlePath;\n try {\n-  scriptBundlePath = new URL(document.currentScript.src).pathname.match(\n-    /^(.*\\/)(?:pagefind-)?ui.js.*$/\n-  )[1];\n+  // Important: Check that the element is indeed a <script> node, to avoid a DOM clobbering vulnerability\n+  if (document?.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT') {\n+    scriptBundlePath = new URL(document.currentScript.src).pathname.match(\n+      /^(.*\\/)(?:pagefind-)?ui.js.*$/\n+    )[1];\n+  }\n } catch (e) {\n   scriptBundlePath = \"/pagefind/\";\n }"
            },
            {
                "sha": "4f25672e947b612b3706188e23356dbd94fcae60",
                "filename": "pagefind_ui/modular/modular-core.js",
                "status": "modified",
                "additions": 20,
                "deletions": 7,
                "changes": 27,
                "blob_url": "https://github.com/Pagefind/pagefind/blob/14ec96864eabaf1d7d809d5da0186a8856261eeb/pagefind_ui%2Fmodular%2Fmodular-core.js",
                "raw_url": "https://github.com/Pagefind/pagefind/raw/14ec96864eabaf1d7d809d5da0186a8856261eeb/pagefind_ui%2Fmodular%2Fmodular-core.js",
                "contents_url": "https://api.github.com/repos/Pagefind/pagefind/contents/pagefind_ui%2Fmodular%2Fmodular-core.js?ref=14ec96864eabaf1d7d809d5da0186a8856261eeb",
                "patch": "@@ -8,9 +8,12 @@ const sleep = async (ms = 50) =>\n \n let scriptBundlePath;\n try {\n-  scriptBundlePath = new URL(document.currentScript.src).pathname.match(\n-    /^(.*\\/)(?:pagefind-)?modular-ui.js.*$/\n-  )[1];\n+  // Important: Check that the element is indeed a <script> node, to avoid a DOM clobbering vulnerability\n+  if (document?.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT') {\n+    scriptBundlePath = new URL(document.currentScript.src).pathname.match(\n+      /^(.*\\/)(?:pagefind-)?modular-ui.js.*$/\n+    )[1];\n+  }\n } catch (e) {\n   scriptBundlePath = \"/pagefind/\";\n }\n@@ -166,12 +169,22 @@ export class Instance {\n         console.error(\n           [\n             `Pagefind couldn't be loaded from ${this.options.bundlePath}pagefind.js`,\n-            `You can configure this by passing a bundlePath option to PagefindComposable Instance`,\n-            `[DEBUG: Loaded from ${\n-              document?.currentScript?.src ?? \"no known script location\"\n-            }]`,\n+            `You can configure this by passing a bundlePath option to PagefindComposable Instance`\n           ].join(\"\\n\")\n         );\n+        // Important: Check that the element is indeed a <script> node, to avoid a DOM clobbering vulnerability\n+        if (\n+          document?.currentScript &&\n+          document.currentScript.tagName.toUpperCase() === \"SCRIPT\"\n+        ) {\n+          console.error(\n+            `[DEBUG: Loaded from ${\n+              document.currentScript?.src ?? \"bad script location\"\n+            }]`\n+          );\n+        } else {\n+          console.error(\"no known script location\");\n+        }\n       }\n \n       await imported_pagefind.options(this.pagefindOptions || {});"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/opencontainers/runc/commits/f0b652ea61ff6750a8fcc69865d45a7abf37accf",
        "url": "https://api.github.com/repos/opencontainers/runc/commits/f0b652ea61ff6750a8fcc69865d45a7abf37accf",
        "html_url": "https://github.com/opencontainers/runc/commit/f0b652ea61ff6750a8fcc69865d45a7abf37accf",
        "message": "[1.1] rootfs: try to scope MkdirAll to stay inside the rootfs\n\nWhile we use SecureJoin to try to make all of our target paths inside\nthe container safe, SecureJoin is not safe against an attacker than can\nchange the path after we \"resolve\" it.\n\nos.MkdirAll can inadvertently follow symlinks and thus an attacker could\nend up tricking runc into creating empty directories on the host (note\nthat the container doesn't get access to these directories, and the host\njust sees empty directories). However, this could potentially cause DoS\nissues by (for instance) creating a directory in a conf.d directory for\na daemon that doesn't handle subdirectories properly.\n\nIn addition, the handling for creating file bind-mounts did a plain\nopen(O_CREAT) on the SecureJoin'd path, which is even more obviously\nunsafe (luckily we didn't use O_TRUNC, or this bug could've allowed an\nattacker to cause data loss...). Regardless of the symlink issue,\nopening an untrusted file could result in a DoS if the file is a hung\ntty or some other \"nasty\" file. We can use mknodat to safely create a\nregular file without opening anything anyway (O_CREAT|O_EXCL would also\nwork but it makes the logic a bit more complicated, and we don't want to\nopen the file for any particular reason anyway).\n\nlibpathrs[1] is the long-term solution for these kinds of problems, but\nfor now we can patch this particular issue by creating a more restricted\nMkdirAll that refuses to resolve symlinks and does the creation using\nfile descriptors. This is loosely based on a more secure version that\nfilepath-securejoin now has[2] and will be added to libpathrs soon[3].\n\n[1]: https://github.com/openSUSE/libpathrs\n[2]: https://github.com/cyphar/filepath-securejoin/releases/tag/v0.3.0\n[3]: https://github.com/openSUSE/libpathrs/issues/10\n\nFixes: CVE-2024-45310\nSigned-off-by: Aleksa Sarai <cyphar@cyphar.com>",
        "files": [
            {
                "sha": "78b6998c38f744cc3b85e5f808b3a75158f22af3",
                "filename": "libcontainer/rootfs_linux.go",
                "status": "modified",
                "additions": 21,
                "deletions": 10,
                "changes": 31,
                "blob_url": "https://github.com/opencontainers/runc/blob/f0b652ea61ff6750a8fcc69865d45a7abf37accf/libcontainer%2Frootfs_linux.go",
                "raw_url": "https://github.com/opencontainers/runc/raw/f0b652ea61ff6750a8fcc69865d45a7abf37accf/libcontainer%2Frootfs_linux.go",
                "contents_url": "https://api.github.com/repos/opencontainers/runc/contents/libcontainer%2Frootfs_linux.go?ref=f0b652ea61ff6750a8fcc69865d45a7abf37accf",
                "patch": "@@ -253,7 +253,7 @@ func mountCgroupV1(m *configs.Mount, c *mountConfig) error {\n \t\tif c.cgroupns {\n \t\t\tsubsystemPath := filepath.Join(c.root, b.Destination)\n \t\t\tsubsystemName := filepath.Base(b.Destination)\n-\t\t\tif err := os.MkdirAll(subsystemPath, 0o755); err != nil {\n+\t\t\tif err := utils.MkdirAllInRoot(c.root, subsystemPath, 0o755); err != nil {\n \t\t\t\treturn err\n \t\t\t}\n \t\t\tif err := utils.WithProcfd(c.root, b.Destination, func(procfd string) error {\n@@ -406,15 +406,26 @@ func createMountpoint(rootfs string, m *configs.Mount, mountFd *int, source stri\n \t\t\t\treturn \"\", fmt.Errorf(\"%w: file bind mount over rootfs\", errRootfsToFile)\n \t\t\t}\n \t\t\t// Make the parent directory.\n-\t\t\tif err := os.MkdirAll(filepath.Dir(dest), 0o755); err != nil {\n+\t\t\tdestDir, destBase := filepath.Split(dest)\n+\t\t\tdestDirFd, err := utils.MkdirAllInRootOpen(rootfs, destDir, 0o755)\n+\t\t\tif err != nil {\n \t\t\t\treturn \"\", fmt.Errorf(\"make parent dir of file bind-mount: %w\", err)\n \t\t\t}\n-\t\t\t// Make the target file.\n-\t\t\tf, err := os.OpenFile(dest, os.O_CREATE, 0o755)\n-\t\t\tif err != nil {\n-\t\t\t\treturn \"\", fmt.Errorf(\"create target of file bind-mount: %w\", err)\n+\t\t\tdefer destDirFd.Close()\n+\t\t\t// Make the target file. We want to avoid opening any file that is\n+\t\t\t// already there because it could be a \"bad\" file like an invalid\n+\t\t\t// device or hung tty that might cause a DoS, so we use mknodat.\n+\t\t\t// destBase does not contain any \"/\" components, and mknodat does\n+\t\t\t// not follow trailing symlinks, so we can safely just call mknodat\n+\t\t\t// here.\n+\t\t\tif err := unix.Mknodat(int(destDirFd.Fd()), destBase, unix.S_IFREG|0o644, 0); err != nil {\n+\t\t\t\t// If we get EEXIST, there was already an inode there and\n+\t\t\t\t// we can consider that a success.\n+\t\t\t\tif !errors.Is(err, unix.EEXIST) {\n+\t\t\t\t\terr = &os.PathError{Op: \"mknod regular file\", Path: dest, Err: err}\n+\t\t\t\t\treturn \"\", fmt.Errorf(\"create target of file bind-mount: %w\", err)\n+\t\t\t\t}\n \t\t\t}\n-\t\t\t_ = f.Close()\n \t\t\t// Nothing left to do.\n \t\t\treturn dest, nil\n \t\t}\n@@ -433,7 +444,7 @@ func createMountpoint(rootfs string, m *configs.Mount, mountFd *int, source stri\n \t\t}\n \t}\n \n-\tif err := os.MkdirAll(dest, 0o755); err != nil {\n+\tif err := utils.MkdirAllInRoot(rootfs, dest, 0o755); err != nil {\n \t\treturn \"\", err\n \t}\n \treturn dest, nil\n@@ -463,7 +474,7 @@ func mountToRootfs(m *configs.Mount, c *mountConfig) error {\n \t\t} else if !fi.IsDir() {\n \t\t\treturn fmt.Errorf(\"filesystem %q must be mounted on ordinary directory\", m.Device)\n \t\t}\n-\t\tif err := os.MkdirAll(dest, 0o755); err != nil {\n+\t\tif err := utils.MkdirAllInRoot(rootfs, dest, 0o755); err != nil {\n \t\t\treturn err\n \t\t}\n \t\t// Selinux kernels do not support labeling of /proc or /sys.\n@@ -751,7 +762,7 @@ func createDeviceNode(rootfs string, node *devices.Device, bind bool) error {\n \tif dest == rootfs {\n \t\treturn fmt.Errorf(\"%w: mknod over rootfs\", errRootfsToFile)\n \t}\n-\tif err := os.MkdirAll(filepath.Dir(dest), 0o755); err != nil {\n+\tif err := utils.MkdirAllInRoot(rootfs, filepath.Dir(dest), 0o755); err != nil {\n \t\treturn err\n \t}\n \tif bind {"
            },
            {
                "sha": "32bab6922bd2417394347870ed588a013b074ad6",
                "filename": "libcontainer/system/linux.go",
                "status": "modified",
                "additions": 41,
                "deletions": 0,
                "changes": 41,
                "blob_url": "https://github.com/opencontainers/runc/blob/f0b652ea61ff6750a8fcc69865d45a7abf37accf/libcontainer%2Fsystem%2Flinux.go",
                "raw_url": "https://github.com/opencontainers/runc/raw/f0b652ea61ff6750a8fcc69865d45a7abf37accf/libcontainer%2Fsystem%2Flinux.go",
                "contents_url": "https://api.github.com/repos/opencontainers/runc/contents/libcontainer%2Fsystem%2Flinux.go?ref=f0b652ea61ff6750a8fcc69865d45a7abf37accf",
                "patch": "@@ -6,6 +6,8 @@ package system\n import (\n \t\"os\"\n \t\"os/exec\"\n+\t\"runtime\"\n+\t\"strings\"\n \t\"unsafe\"\n \n \t\"golang.org/x/sys/unix\"\n@@ -102,3 +104,42 @@ func GetSubreaper() (int, error) {\n \n \treturn int(i), nil\n }\n+\n+func prepareAt(dir *os.File, path string) (int, string) {\n+\tif dir == nil {\n+\t\treturn unix.AT_FDCWD, path\n+\t}\n+\n+\t// Rather than just filepath.Join-ing path here, do it manually so the\n+\t// error and handle correctly indicate cases like path=\"..\" as being\n+\t// relative to the correct directory. The handle.Name() might end up being\n+\t// wrong but because this is (currently) only used in MkdirAllInRoot, that\n+\t// isn't a problem.\n+\tdirName := dir.Name()\n+\tif !strings.HasSuffix(dirName, \"/\") {\n+\t\tdirName += \"/\"\n+\t}\n+\tfullPath := dirName + path\n+\n+\treturn int(dir.Fd()), fullPath\n+}\n+\n+func Openat(dir *os.File, path string, flags int, mode uint32) (*os.File, error) {\n+\tdirFd, fullPath := prepareAt(dir, path)\n+\tfd, err := unix.Openat(dirFd, path, flags, mode)\n+\tif err != nil {\n+\t\treturn nil, &os.PathError{Op: \"openat\", Path: fullPath, Err: err}\n+\t}\n+\truntime.KeepAlive(dir)\n+\treturn os.NewFile(uintptr(fd), fullPath), nil\n+}\n+\n+func Mkdirat(dir *os.File, path string, mode uint32) error {\n+\tdirFd, fullPath := prepareAt(dir, path)\n+\terr := unix.Mkdirat(dirFd, path, mode)\n+\tif err != nil {\n+\t\terr = &os.PathError{Op: \"mkdirat\", Path: fullPath, Err: err}\n+\t}\n+\truntime.KeepAlive(dir)\n+\treturn err\n+}"
            },
            {
                "sha": "460b94cef3f9084cc3c210d735d5c913c83ecd57",
                "filename": "libcontainer/utils/utils_unix.go",
                "status": "modified",
                "additions": 114,
                "deletions": 0,
                "changes": 114,
                "blob_url": "https://github.com/opencontainers/runc/blob/f0b652ea61ff6750a8fcc69865d45a7abf37accf/libcontainer%2Futils%2Futils_unix.go",
                "raw_url": "https://github.com/opencontainers/runc/raw/f0b652ea61ff6750a8fcc69865d45a7abf37accf/libcontainer%2Futils%2Futils_unix.go",
                "contents_url": "https://api.github.com/repos/opencontainers/runc/contents/libcontainer%2Futils%2Futils_unix.go?ref=f0b652ea61ff6750a8fcc69865d45a7abf37accf",
                "patch": "@@ -4,12 +4,17 @@\n package utils\n \n import (\n+\t\"errors\"\n \t\"fmt\"\n \t\"os\"\n+\t\"path/filepath\"\n \t\"strconv\"\n \t\"strings\"\n \t_ \"unsafe\" // for go:linkname\n \n+\t\"github.com/opencontainers/runc/libcontainer/system\"\n+\n+\tsecurejoin \"github.com/cyphar/filepath-securejoin\"\n \t\"golang.org/x/sys/unix\"\n )\n \n@@ -130,3 +135,112 @@ func IsLexicallyInRoot(root, path string) bool {\n \t}\n \treturn strings.HasPrefix(path, root)\n }\n+\n+// MkdirAllInRootOpen attempts to make\n+//\n+//\tpath, _ := securejoin.SecureJoin(root, unsafePath)\n+//\tos.MkdirAll(path, mode)\n+//\tos.Open(path)\n+//\n+// safer against attacks where components in the path are changed between\n+// SecureJoin returning and MkdirAll (or Open) being called. In particular, we\n+// try to detect any symlink components in the path while we are doing the\n+// MkdirAll.\n+//\n+// NOTE: Unlike os.MkdirAll, mode is not Go's os.FileMode, it is the unix mode\n+// (the suid/sgid/sticky bits are not the same as for os.FileMode).\n+//\n+// NOTE: If unsafePath is a subpath of root, we assume that you have already\n+// called SecureJoin and so we use the provided path verbatim without resolving\n+// any symlinks (this is done in a way that avoids symlink-exchange races).\n+// This means that the path also must not contain \"..\" elements, otherwise an\n+// error will occur.\n+//\n+// This is a somewhat less safe alternative to\n+// <https://github.com/cyphar/filepath-securejoin/pull/13>, but it should\n+// detect attempts to trick us into creating directories outside of the root.\n+// We should migrate to securejoin.MkdirAll once it is merged.\n+func MkdirAllInRootOpen(root, unsafePath string, mode uint32) (_ *os.File, Err error) {\n+\t// If the path is already \"within\" the root, use it verbatim.\n+\tfullPath := unsafePath\n+\tif !IsLexicallyInRoot(root, unsafePath) {\n+\t\tvar err error\n+\t\tfullPath, err = securejoin.SecureJoin(root, unsafePath)\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\t}\n+\tsubPath, err := filepath.Rel(root, fullPath)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\t// Check for any silly mode bits.\n+\tif mode&^0o7777 != 0 {\n+\t\treturn nil, fmt.Errorf(\"tried to include non-mode bits in MkdirAll mode: 0o%.3o\", mode)\n+\t}\n+\n+\tcurrentDir, err := os.OpenFile(root, unix.O_DIRECTORY|unix.O_CLOEXEC, 0)\n+\tif err != nil {\n+\t\treturn nil, fmt.Errorf(\"open root handle: %w\", err)\n+\t}\n+\tdefer func() {\n+\t\tif Err != nil {\n+\t\t\tcurrentDir.Close()\n+\t\t}\n+\t}()\n+\n+\tfor _, part := range strings.Split(subPath, string(filepath.Separator)) {\n+\t\tswitch part {\n+\t\tcase \"\", \".\":\n+\t\t\t// Skip over no-op components.\n+\t\t\tcontinue\n+\t\tcase \"..\":\n+\t\t\treturn nil, fmt.Errorf(\"possible breakout detected: found %q component in SecureJoin subpath %s\", part, subPath)\n+\t\t}\n+\n+\t\tnextDir, err := system.Openat(currentDir, part, unix.O_DIRECTORY|unix.O_NOFOLLOW|unix.O_CLOEXEC, 0)\n+\t\tswitch {\n+\t\tcase err == nil:\n+\t\t\t// Update the currentDir.\n+\t\t\t_ = currentDir.Close()\n+\t\t\tcurrentDir = nextDir\n+\n+\t\tcase errors.Is(err, unix.ENOTDIR):\n+\t\t\t// This might be a symlink or some other random file. Either way,\n+\t\t\t// error out.\n+\t\t\treturn nil, fmt.Errorf(\"cannot mkdir in %s/%s: %w\", currentDir.Name(), part, unix.ENOTDIR)\n+\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\t\t// Luckily, mkdirat will not follow trailing symlinks, so this is\n+\t\t\t// safe to do as-is.\n+\t\t\tif err := system.Mkdirat(currentDir, part, mode); err != nil {\n+\t\t\t\treturn nil, err\n+\t\t\t}\n+\t\t\t// Open the new directory. There is a race here where an attacker\n+\t\t\t// could swap the directory with a different directory, but\n+\t\t\t// MkdirAll's fuzzy semantics mean we don't care about that.\n+\t\t\tnextDir, err := system.Openat(currentDir, part, unix.O_DIRECTORY|unix.O_NOFOLLOW|unix.O_CLOEXEC, 0)\n+\t\t\tif err != nil {\n+\t\t\t\treturn nil, fmt.Errorf(\"open newly created directory: %w\", err)\n+\t\t\t}\n+\t\t\t// Update the currentDir.\n+\t\t\t_ = currentDir.Close()\n+\t\t\tcurrentDir = nextDir\n+\n+\t\tdefault:\n+\t\t\treturn nil, err\n+\t\t}\n+\t}\n+\treturn currentDir, nil\n+}\n+\n+// MkdirAllInRoot is a wrapper around MkdirAllInRootOpen which closes the\n+// returned handle, for callers that don't need to use it.\n+func MkdirAllInRoot(root, unsafePath string, mode uint32) error {\n+\tf, err := MkdirAllInRootOpen(root, unsafePath, mode)\n+\tif err == nil {\n+\t\t_ = f.Close()\n+\t}\n+\treturn err\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/opencontainers/runc/commits/8781993968fd964ac723ff5f360b6f259e809a3e",
        "url": "https://api.github.com/repos/opencontainers/runc/commits/8781993968fd964ac723ff5f360b6f259e809a3e",
        "html_url": "https://github.com/opencontainers/runc/commit/8781993968fd964ac723ff5f360b6f259e809a3e",
        "message": "[1.1] rootfs: consolidate mountpoint creation logic\n\nThe logic for how we create mountpoints is spread over each mountpoint\npreparation function, when in reality the behaviour is pretty uniform\nwith only a handful of exceptions. So just move it all to one function\nthat is easier to understand.\n\nSigned-off-by: Aleksa Sarai <cyphar@cyphar.com>",
        "files": [
            {
                "sha": "0c07ae6c875aa27033d7fac63b9936c955c78bfc",
                "filename": "libcontainer/container_linux.go",
                "status": "modified",
                "additions": 6,
                "deletions": 22,
                "changes": 28,
                "blob_url": "https://github.com/opencontainers/runc/blob/8781993968fd964ac723ff5f360b6f259e809a3e/libcontainer%2Fcontainer_linux.go",
                "raw_url": "https://github.com/opencontainers/runc/raw/8781993968fd964ac723ff5f360b6f259e809a3e/libcontainer%2Fcontainer_linux.go",
                "contents_url": "https://api.github.com/repos/opencontainers/runc/contents/libcontainer%2Fcontainer_linux.go?ref=8781993968fd964ac723ff5f360b6f259e809a3e",
                "patch": "@@ -1276,8 +1276,7 @@ func (c *linuxContainer) restoreNetwork(req *criurpc.CriuReq, criuOpts *CriuOpts\n // restore using CRIU. This function is inspired from the code in\n // rootfs_linux.go\n func (c *linuxContainer) makeCriuRestoreMountpoints(m *configs.Mount) error {\n-\tswitch m.Device {\n-\tcase \"cgroup\":\n+\tif m.Device == \"cgroup\" {\n \t\t// No mount point(s) need to be created:\n \t\t//\n \t\t// * for v1, mount points are saved by CRIU because\n@@ -1286,26 +1285,11 @@ func (c *linuxContainer) makeCriuRestoreMountpoints(m *configs.Mount) error {\n \t\t// * for v2, /sys/fs/cgroup is a real mount, but\n \t\t//   the mountpoint appears as soon as /sys is mounted\n \t\treturn nil\n-\tcase \"bind\":\n-\t\t// The prepareBindMount() function checks if source\n-\t\t// exists. So it cannot be used for other filesystem types.\n-\t\t// TODO: pass something else than nil? Not sure if criu is\n-\t\t// impacted by issue #2484\n-\t\tif err := prepareBindMount(m, c.config.Rootfs, nil); err != nil {\n-\t\t\treturn err\n-\t\t}\n-\tdefault:\n-\t\t// for all other filesystems just create the mountpoints\n-\t\tdest, err := securejoin.SecureJoin(c.config.Rootfs, m.Destination)\n-\t\tif err != nil {\n-\t\t\treturn err\n-\t\t}\n-\t\tif err := checkProcMount(c.config.Rootfs, dest, m, \"\"); err != nil {\n-\t\t\treturn err\n-\t\t}\n-\t\tif err := os.MkdirAll(dest, 0o755); err != nil {\n-\t\t\treturn err\n-\t\t}\n+\t}\n+\t// TODO: pass something else than nil? Not sure if criu is\n+\t// impacted by issue #2484\n+\tif _, err := createMountpoint(c.config.Rootfs, m, nil, \"\"); err != nil {\n+\t\treturn fmt.Errorf(\"create criu restore mount for %s mount: %w\", m.Destination, err)\n \t}\n \treturn nil\n }"
            },
            {
                "sha": "e6269bea812687c7b3357e7c174e577fa9af8bb3",
                "filename": "libcontainer/rootfs_linux.go",
                "status": "modified",
                "additions": 73,
                "deletions": 87,
                "changes": 160,
                "blob_url": "https://github.com/opencontainers/runc/blob/8781993968fd964ac723ff5f360b6f259e809a3e/libcontainer%2Frootfs_linux.go",
                "raw_url": "https://github.com/opencontainers/runc/raw/8781993968fd964ac723ff5f360b6f259e809a3e/libcontainer%2Frootfs_linux.go",
                "contents_url": "https://api.github.com/repos/opencontainers/runc/contents/libcontainer%2Frootfs_linux.go?ref=8781993968fd964ac723ff5f360b6f259e809a3e",
                "patch": "@@ -224,36 +224,6 @@ func mountCmd(cmd configs.Command) error {\n \treturn nil\n }\n \n-func prepareBindMount(m *configs.Mount, rootfs string, mountFd *int) error {\n-\tsource := m.Source\n-\tif mountFd != nil {\n-\t\tsource = \"/proc/self/fd/\" + strconv.Itoa(*mountFd)\n-\t}\n-\n-\tstat, err := os.Stat(source)\n-\tif err != nil {\n-\t\t// error out if the source of a bind mount does not exist as we will be\n-\t\t// unable to bind anything to it.\n-\t\treturn err\n-\t}\n-\t// ensure that the destination of the bind mount is resolved of symlinks at mount time because\n-\t// any previous mounts can invalidate the next mount's destination.\n-\t// this can happen when a user specifies mounts within other mounts to cause breakouts or other\n-\t// evil stuff to try to escape the container's rootfs.\n-\tvar dest string\n-\tif dest, err = securejoin.SecureJoin(rootfs, m.Destination); err != nil {\n-\t\treturn err\n-\t}\n-\tif err := checkProcMount(rootfs, dest, m, source); err != nil {\n-\t\treturn err\n-\t}\n-\tif err := createIfNotExists(dest, stat.IsDir()); err != nil {\n-\t\treturn err\n-\t}\n-\n-\treturn nil\n-}\n-\n func mountCgroupV1(m *configs.Mount, c *mountConfig) error {\n \tbinds, err := getCgroupMounts(m)\n \tif err != nil {\n@@ -282,6 +252,7 @@ func mountCgroupV1(m *configs.Mount, c *mountConfig) error {\n \tfor _, b := range binds {\n \t\tif c.cgroupns {\n \t\t\tsubsystemPath := filepath.Join(c.root, b.Destination)\n+\t\t\tsubsystemName := filepath.Base(b.Destination)\n \t\t\tif err := os.MkdirAll(subsystemPath, 0o755); err != nil {\n \t\t\t\treturn err\n \t\t\t}\n@@ -292,7 +263,7 @@ func mountCgroupV1(m *configs.Mount, c *mountConfig) error {\n \t\t\t\t}\n \t\t\t\tvar (\n \t\t\t\t\tsource = \"cgroup\"\n-\t\t\t\t\tdata   = filepath.Base(subsystemPath)\n+\t\t\t\t\tdata   = subsystemName\n \t\t\t\t)\n \t\t\t\tif data == \"systemd\" {\n \t\t\t\t\tdata = cgroups.CgroupNamePrefix + data\n@@ -322,14 +293,7 @@ func mountCgroupV1(m *configs.Mount, c *mountConfig) error {\n }\n \n func mountCgroupV2(m *configs.Mount, c *mountConfig) error {\n-\tdest, err := securejoin.SecureJoin(c.root, m.Destination)\n-\tif err != nil {\n-\t\treturn err\n-\t}\n-\tif err := os.MkdirAll(dest, 0o755); err != nil {\n-\t\treturn err\n-\t}\n-\terr = utils.WithProcfd(c.root, m.Destination, func(procfd string) error {\n+\terr := utils.WithProcfd(c.root, m.Destination, func(procfd string) error {\n \t\treturn mount(m.Source, m.Destination, procfd, \"cgroup2\", uintptr(m.Flags), m.Data)\n \t})\n \tif err == nil || !(errors.Is(err, unix.EPERM) || errors.Is(err, unix.EBUSY)) {\n@@ -411,6 +375,70 @@ func doTmpfsCopyUp(m *configs.Mount, rootfs, mountLabel string) (Err error) {\n \t})\n }\n \n+var errRootfsToFile = errors.New(\"config tries to change rootfs to file\")\n+\n+func createMountpoint(rootfs string, m *configs.Mount, mountFd *int, source string) (string, error) {\n+\tdest, err := securejoin.SecureJoin(rootfs, m.Destination)\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\tif err := checkProcMount(rootfs, dest, m, source); err != nil {\n+\t\treturn \"\", fmt.Errorf(\"check proc-safety of %s mount: %w\", m.Destination, err)\n+\t}\n+\n+\tswitch m.Device {\n+\tcase \"bind\":\n+\t\tsource := m.Source\n+\t\tif mountFd != nil {\n+\t\t\tsource = \"/proc/self/fd/\" + strconv.Itoa(*mountFd)\n+\t\t}\n+\n+\t\tfi, err := os.Stat(source)\n+\t\tif err != nil {\n+\t\t\t// Error out if the source of a bind mount does not exist as we\n+\t\t\t// will be unable to bind anything to it.\n+\t\t\treturn \"\", fmt.Errorf(\"bind mount source stat: %w\", err)\n+\t\t}\n+\t\t// If the original source is not a directory, make the target a file.\n+\t\tif !fi.IsDir() {\n+\t\t\t// Make sure we aren't tricked into trying to make the root a file.\n+\t\t\tif rootfs == dest {\n+\t\t\t\treturn \"\", fmt.Errorf(\"%w: file bind mount over rootfs\", errRootfsToFile)\n+\t\t\t}\n+\t\t\t// Make the parent directory.\n+\t\t\tif err := os.MkdirAll(filepath.Dir(dest), 0o755); err != nil {\n+\t\t\t\treturn \"\", fmt.Errorf(\"make parent dir of file bind-mount: %w\", err)\n+\t\t\t}\n+\t\t\t// Make the target file.\n+\t\t\tf, err := os.OpenFile(dest, os.O_CREATE, 0o755)\n+\t\t\tif err != nil {\n+\t\t\t\treturn \"\", fmt.Errorf(\"create target of file bind-mount: %w\", err)\n+\t\t\t}\n+\t\t\t_ = f.Close()\n+\t\t\t// Nothing left to do.\n+\t\t\treturn dest, nil\n+\t\t}\n+\n+\tcase \"tmpfs\":\n+\t\t// If the original target exists, copy the mode for the tmpfs mount.\n+\t\tif stat, err := os.Stat(dest); err == nil {\n+\t\t\tdt := fmt.Sprintf(\"mode=%04o\", syscallMode(stat.Mode()))\n+\t\t\tif m.Data != \"\" {\n+\t\t\t\tdt = dt + \",\" + m.Data\n+\t\t\t}\n+\t\t\tm.Data = dt\n+\n+\t\t\t// Nothing left to do.\n+\t\t\treturn dest, nil\n+\t\t}\n+\t}\n+\n+\tif err := os.MkdirAll(dest, 0o755); err != nil {\n+\t\treturn \"\", err\n+\t}\n+\treturn dest, nil\n+}\n+\n func mountToRootfs(m *configs.Mount, c *mountConfig) error {\n \trootfs := c.root\n \n@@ -442,46 +470,27 @@ func mountToRootfs(m *configs.Mount, c *mountConfig) error {\n \t\treturn mountPropagate(m, rootfs, \"\", nil)\n \t}\n \n-\tmountLabel := c.label\n \tmountFd := c.fd\n-\tdest, err := securejoin.SecureJoin(rootfs, m.Destination)\n+\tdest, err := createMountpoint(rootfs, m, mountFd, m.Source)\n \tif err != nil {\n-\t\treturn err\n+\t\treturn fmt.Errorf(\"create mount destination for %s mount: %w\", m.Destination, err)\n \t}\n+\tmountLabel := c.label\n \n \tswitch m.Device {\n \tcase \"mqueue\":\n-\t\tif err := os.MkdirAll(dest, 0o755); err != nil {\n-\t\t\treturn err\n-\t\t}\n \t\tif err := mountPropagate(m, rootfs, \"\", nil); err != nil {\n \t\t\treturn err\n \t\t}\n \t\treturn label.SetFileLabel(dest, mountLabel)\n \tcase \"tmpfs\":\n-\t\tif stat, err := os.Stat(dest); err != nil {\n-\t\t\tif err := os.MkdirAll(dest, 0o755); err != nil {\n-\t\t\t\treturn err\n-\t\t\t}\n-\t\t} else {\n-\t\t\tdt := fmt.Sprintf(\"mode=%04o\", syscallMode(stat.Mode()))\n-\t\t\tif m.Data != \"\" {\n-\t\t\t\tdt = dt + \",\" + m.Data\n-\t\t\t}\n-\t\t\tm.Data = dt\n-\t\t}\n-\n \t\tif m.Extensions&configs.EXT_COPYUP == configs.EXT_COPYUP {\n \t\t\terr = doTmpfsCopyUp(m, rootfs, mountLabel)\n \t\t} else {\n \t\t\terr = mountPropagate(m, rootfs, mountLabel, nil)\n \t\t}\n-\n \t\treturn err\n \tcase \"bind\":\n-\t\tif err := prepareBindMount(m, rootfs, mountFd); err != nil {\n-\t\t\treturn err\n-\t\t}\n \t\tif err := mountPropagate(m, rootfs, mountLabel, mountFd); err != nil {\n \t\t\treturn err\n \t\t}\n@@ -509,12 +518,6 @@ func mountToRootfs(m *configs.Mount, c *mountConfig) error {\n \t\t}\n \t\treturn mountCgroupV1(m, c)\n \tdefault:\n-\t\tif err := checkProcMount(rootfs, dest, m, m.Source); err != nil {\n-\t\t\treturn err\n-\t\t}\n-\t\tif err := os.MkdirAll(dest, 0o755); err != nil {\n-\t\t\treturn err\n-\t\t}\n \t\treturn mountPropagate(m, rootfs, mountLabel, mountFd)\n \t}\n \tif err := setRecAttr(m, rootfs); err != nil {\n@@ -745,6 +748,9 @@ func createDeviceNode(rootfs string, node *devices.Device, bind bool) error {\n \tif err != nil {\n \t\treturn err\n \t}\n+\tif dest == rootfs {\n+\t\treturn fmt.Errorf(\"%w: mknod over rootfs\", errRootfsToFile)\n+\t}\n \tif err := os.MkdirAll(filepath.Dir(dest), 0o755); err != nil {\n \t\treturn err\n \t}\n@@ -1011,26 +1017,6 @@ func chroot() error {\n \treturn nil\n }\n \n-// createIfNotExists creates a file or a directory only if it does not already exist.\n-func createIfNotExists(path string, isDir bool) error {\n-\tif _, err := os.Stat(path); err != nil {\n-\t\tif os.IsNotExist(err) {\n-\t\t\tif isDir {\n-\t\t\t\treturn os.MkdirAll(path, 0o755)\n-\t\t\t}\n-\t\t\tif err := os.MkdirAll(filepath.Dir(path), 0o755); err != nil {\n-\t\t\t\treturn err\n-\t\t\t}\n-\t\t\tf, err := os.OpenFile(path, os.O_CREATE, 0o755)\n-\t\t\tif err != nil {\n-\t\t\t\treturn err\n-\t\t\t}\n-\t\t\t_ = f.Close()\n-\t\t}\n-\t}\n-\treturn nil\n-}\n-\n // readonlyPath will make a path read only.\n func readonlyPath(path string) error {\n \tif err := mount(path, path, \"\", \"\", unix.MS_BIND|unix.MS_REC, \"\"); err != nil {"
            },
            {
                "sha": "0d95a203789abd00f1844d2c19381ae378f06a20",
                "filename": "libcontainer/utils/utils_unix.go",
                "status": "modified",
                "additions": 15,
                "deletions": 0,
                "changes": 15,
                "blob_url": "https://github.com/opencontainers/runc/blob/8781993968fd964ac723ff5f360b6f259e809a3e/libcontainer%2Futils%2Futils_unix.go",
                "raw_url": "https://github.com/opencontainers/runc/raw/8781993968fd964ac723ff5f360b6f259e809a3e/libcontainer%2Futils%2Futils_unix.go",
                "contents_url": "https://api.github.com/repos/opencontainers/runc/contents/libcontainer%2Futils%2Futils_unix.go?ref=8781993968fd964ac723ff5f360b6f259e809a3e",
                "patch": "@@ -7,6 +7,7 @@ import (\n \t\"fmt\"\n \t\"os\"\n \t\"strconv\"\n+\t\"strings\"\n \t_ \"unsafe\" // for go:linkname\n \n \t\"golang.org/x/sys/unix\"\n@@ -115,3 +116,17 @@ func NewSockPair(name string) (parent *os.File, child *os.File, err error) {\n \t}\n \treturn os.NewFile(uintptr(fds[1]), name+\"-p\"), os.NewFile(uintptr(fds[0]), name+\"-c\"), nil\n }\n+\n+// IsLexicallyInRoot is shorthand for strings.HasPrefix(path+\"/\", root+\"/\"),\n+// but properly handling the case where path or root are \"/\".\n+//\n+// NOTE: The return value only make sense if the path doesn't contain \"..\".\n+func IsLexicallyInRoot(root, path string) bool {\n+\tif root != \"/\" {\n+\t\troot += \"/\"\n+\t}\n+\tif path != \"/\" {\n+\t\tpath += \"/\"\n+\t}\n+\treturn strings.HasPrefix(path, root)\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/opencontainers/runc/commits/63c2908164f3a1daea455bf5bcd8d363d70328c7",
        "url": "https://api.github.com/repos/opencontainers/runc/commits/63c2908164f3a1daea455bf5bcd8d363d70328c7",
        "html_url": "https://github.com/opencontainers/runc/commit/63c2908164f3a1daea455bf5bcd8d363d70328c7",
        "message": "rootfs: try to scope MkdirAll to stay inside the rootfs\n\nWhile we use SecureJoin to try to make all of our target paths inside\nthe container safe, SecureJoin is not safe against an attacker than can\nchange the path after we \"resolve\" it.\n\nos.MkdirAll can inadvertently follow symlinks and thus an attacker could\nend up tricking runc into creating empty directories on the host (note\nthat the container doesn't get access to these directories, and the host\njust sees empty directories). However, this could potentially cause DoS\nissues by (for instance) creating a directory in a conf.d directory for\na daemon that doesn't handle subdirectories properly.\n\nIn addition, the handling for creating file bind-mounts did a plain\nopen(O_CREAT) on the SecureJoin'd path, which is even more obviously\nunsafe (luckily we didn't use O_TRUNC, or this bug could've allowed an\nattacker to cause data loss...). Regardless of the symlink issue,\nopening an untrusted file could result in a DoS if the file is a hung\ntty or some other \"nasty\" file. We can use mknodat to safely create a\nregular file without opening anything anyway (O_CREAT|O_EXCL would also\nwork but it makes the logic a bit more complicated, and we don't want to\nopen the file for any particular reason anyway).\n\nlibpathrs[1] is the long-term solution for these kinds of problems, but\nfor now we can patch this particular issue by creating a more restricted\nMkdirAll that refuses to resolve symlinks and does the creation using\nfile descriptors. This is loosely based on a more secure version that\nfilepath-securejoin now has[2] and will be added to libpathrs soon[3].\n\n[1]: https://github.com/openSUSE/libpathrs\n[2]: https://github.com/cyphar/filepath-securejoin/releases/tag/v0.3.0\n[3]: https://github.com/openSUSE/libpathrs/issues/10\n\nFixes: CVE-2024-45310\nSigned-off-by: Aleksa Sarai <cyphar@cyphar.com>",
        "files": [
            {
                "sha": "f5112398cb2d8e36e720e75f515f1ae82bfb5dc6",
                "filename": "libcontainer/rootfs_linux.go",
                "status": "modified",
                "additions": 21,
                "deletions": 10,
                "changes": 31,
                "blob_url": "https://github.com/opencontainers/runc/blob/63c2908164f3a1daea455bf5bcd8d363d70328c7/libcontainer%2Frootfs_linux.go",
                "raw_url": "https://github.com/opencontainers/runc/raw/63c2908164f3a1daea455bf5bcd8d363d70328c7/libcontainer%2Frootfs_linux.go",
                "contents_url": "https://api.github.com/repos/opencontainers/runc/contents/libcontainer%2Frootfs_linux.go?ref=63c2908164f3a1daea455bf5bcd8d363d70328c7",
                "patch": "@@ -313,7 +313,7 @@ func mountCgroupV1(m *configs.Mount, c *mountConfig) error {\n \t\t\t// inside the tmpfs, so we don't want to resolve symlinks).\n \t\t\tsubsystemPath := filepath.Join(c.root, b.Destination)\n \t\t\tsubsystemName := filepath.Base(b.Destination)\n-\t\t\tif err := os.MkdirAll(subsystemPath, 0o755); err != nil {\n+\t\t\tif err := utils.MkdirAllInRoot(c.root, subsystemPath, 0o755); err != nil {\n \t\t\t\treturn err\n \t\t\t}\n \t\t\tif err := utils.WithProcfd(c.root, b.Destination, func(dstFd string) error {\n@@ -505,15 +505,26 @@ func createMountpoint(rootfs string, m mountEntry) (string, error) {\n \t\t\t\treturn \"\", fmt.Errorf(\"%w: file bind mount over rootfs\", errRootfsToFile)\n \t\t\t}\n \t\t\t// Make the parent directory.\n-\t\t\tif err := os.MkdirAll(filepath.Dir(dest), 0o755); err != nil {\n+\t\t\tdestDir, destBase := filepath.Split(dest)\n+\t\t\tdestDirFd, err := utils.MkdirAllInRootOpen(rootfs, destDir, 0o755)\n+\t\t\tif err != nil {\n \t\t\t\treturn \"\", fmt.Errorf(\"make parent dir of file bind-mount: %w\", err)\n \t\t\t}\n-\t\t\t// Make the target file.\n-\t\t\tf, err := os.OpenFile(dest, os.O_CREATE, 0o755)\n-\t\t\tif err != nil {\n-\t\t\t\treturn \"\", fmt.Errorf(\"create target of file bind-mount: %w\", err)\n+\t\t\tdefer destDirFd.Close()\n+\t\t\t// Make the target file. We want to avoid opening any file that is\n+\t\t\t// already there because it could be a \"bad\" file like an invalid\n+\t\t\t// device or hung tty that might cause a DoS, so we use mknodat.\n+\t\t\t// destBase does not contain any \"/\" components, and mknodat does\n+\t\t\t// not follow trailing symlinks, so we can safely just call mknodat\n+\t\t\t// here.\n+\t\t\tif err := unix.Mknodat(int(destDirFd.Fd()), destBase, unix.S_IFREG|0o644, 0); err != nil {\n+\t\t\t\t// If we get EEXIST, there was already an inode there and\n+\t\t\t\t// we can consider that a success.\n+\t\t\t\tif !errors.Is(err, unix.EEXIST) {\n+\t\t\t\t\terr = &os.PathError{Op: \"mknod regular file\", Path: dest, Err: err}\n+\t\t\t\t\treturn \"\", fmt.Errorf(\"create target of file bind-mount: %w\", err)\n+\t\t\t\t}\n \t\t\t}\n-\t\t\t_ = f.Close()\n \t\t\t// Nothing left to do.\n \t\t\treturn dest, nil\n \t\t}\n@@ -532,7 +543,7 @@ func createMountpoint(rootfs string, m mountEntry) (string, error) {\n \t\t}\n \t}\n \n-\tif err := os.MkdirAll(dest, 0o755); err != nil {\n+\tif err := utils.MkdirAllInRoot(rootfs, dest, 0o755); err != nil {\n \t\treturn \"\", err\n \t}\n \treturn dest, nil\n@@ -565,7 +576,7 @@ func mountToRootfs(c *mountConfig, m mountEntry) error {\n \t\t} else if !fi.IsDir() {\n \t\t\treturn fmt.Errorf(\"filesystem %q must be mounted on ordinary directory\", m.Device)\n \t\t}\n-\t\tif err := os.MkdirAll(dest, 0o755); err != nil {\n+\t\tif err := utils.MkdirAllInRoot(rootfs, dest, 0o755); err != nil {\n \t\t\treturn err\n \t\t}\n \t\t// Selinux kernels do not support labeling of /proc or /sys.\n@@ -928,7 +939,7 @@ func createDeviceNode(rootfs string, node *devices.Device, bind bool) error {\n \tif dest == rootfs {\n \t\treturn fmt.Errorf(\"%w: mknod over rootfs\", errRootfsToFile)\n \t}\n-\tif err := os.MkdirAll(filepath.Dir(dest), 0o755); err != nil {\n+\tif err := utils.MkdirAllInRoot(rootfs, filepath.Dir(dest), 0o755); err != nil {\n \t\treturn err\n \t}\n \tif bind {"
            },
            {
                "sha": "27e89d635ca62112ecc31ae35c61e23f05df068d",
                "filename": "libcontainer/system/linux.go",
                "status": "modified",
                "additions": 41,
                "deletions": 0,
                "changes": 41,
                "blob_url": "https://github.com/opencontainers/runc/blob/63c2908164f3a1daea455bf5bcd8d363d70328c7/libcontainer%2Fsystem%2Flinux.go",
                "raw_url": "https://github.com/opencontainers/runc/raw/63c2908164f3a1daea455bf5bcd8d363d70328c7/libcontainer%2Fsystem%2Flinux.go",
                "contents_url": "https://api.github.com/repos/opencontainers/runc/contents/libcontainer%2Fsystem%2Flinux.go?ref=63c2908164f3a1daea455bf5bcd8d363d70328c7",
                "patch": "@@ -6,7 +6,9 @@ import (\n \t\"fmt\"\n \t\"io\"\n \t\"os\"\n+\t\"runtime\"\n \t\"strconv\"\n+\t\"strings\"\n \t\"syscall\"\n \t\"unsafe\"\n \n@@ -214,3 +216,42 @@ func SetLinuxPersonality(personality int) error {\n \t}\n \treturn nil\n }\n+\n+func prepareAt(dir *os.File, path string) (int, string) {\n+\tif dir == nil {\n+\t\treturn unix.AT_FDCWD, path\n+\t}\n+\n+\t// Rather than just filepath.Join-ing path here, do it manually so the\n+\t// error and handle correctly indicate cases like path=\"..\" as being\n+\t// relative to the correct directory. The handle.Name() might end up being\n+\t// wrong but because this is (currently) only used in MkdirAllInRoot, that\n+\t// isn't a problem.\n+\tdirName := dir.Name()\n+\tif !strings.HasSuffix(dirName, \"/\") {\n+\t\tdirName += \"/\"\n+\t}\n+\tfullPath := dirName + path\n+\n+\treturn int(dir.Fd()), fullPath\n+}\n+\n+func Openat(dir *os.File, path string, flags int, mode uint32) (*os.File, error) {\n+\tdirFd, fullPath := prepareAt(dir, path)\n+\tfd, err := unix.Openat(dirFd, path, flags, mode)\n+\tif err != nil {\n+\t\treturn nil, &os.PathError{Op: \"openat\", Path: fullPath, Err: err}\n+\t}\n+\truntime.KeepAlive(dir)\n+\treturn os.NewFile(uintptr(fd), fullPath), nil\n+}\n+\n+func Mkdirat(dir *os.File, path string, mode uint32) error {\n+\tdirFd, fullPath := prepareAt(dir, path)\n+\terr := unix.Mkdirat(dirFd, path, mode)\n+\tif err != nil {\n+\t\terr = &os.PathError{Op: \"mkdirat\", Path: fullPath, Err: err}\n+\t}\n+\truntime.KeepAlive(dir)\n+\treturn err\n+}"
            },
            {
                "sha": "1f3439b78fb62fb3e9c38ca796f04edb9af1f8c6",
                "filename": "libcontainer/utils/utils_unix.go",
                "status": "modified",
                "additions": 112,
                "deletions": 0,
                "changes": 112,
                "blob_url": "https://github.com/opencontainers/runc/blob/63c2908164f3a1daea455bf5bcd8d363d70328c7/libcontainer%2Futils%2Futils_unix.go",
                "raw_url": "https://github.com/opencontainers/runc/raw/63c2908164f3a1daea455bf5bcd8d363d70328c7/libcontainer%2Futils%2Futils_unix.go",
                "contents_url": "https://api.github.com/repos/opencontainers/runc/contents/libcontainer%2Futils%2Futils_unix.go?ref=63c2908164f3a1daea455bf5bcd8d363d70328c7",
                "patch": "@@ -3,6 +3,7 @@\n package utils\n \n import (\n+\t\"errors\"\n \t\"fmt\"\n \t\"math\"\n \t\"os\"\n@@ -13,6 +14,8 @@ import (\n \t\"sync\"\n \t_ \"unsafe\" // for go:linkname\n \n+\t\"github.com/opencontainers/runc/libcontainer/system\"\n+\n \tsecurejoin \"github.com/cyphar/filepath-securejoin\"\n \t\"github.com/sirupsen/logrus\"\n \t\"golang.org/x/sys/unix\"\n@@ -275,3 +278,112 @@ func IsLexicallyInRoot(root, path string) bool {\n \t}\n \treturn strings.HasPrefix(path, root)\n }\n+\n+// MkdirAllInRootOpen attempts to make\n+//\n+//\tpath, _ := securejoin.SecureJoin(root, unsafePath)\n+//\tos.MkdirAll(path, mode)\n+//\tos.Open(path)\n+//\n+// safer against attacks where components in the path are changed between\n+// SecureJoin returning and MkdirAll (or Open) being called. In particular, we\n+// try to detect any symlink components in the path while we are doing the\n+// MkdirAll.\n+//\n+// NOTE: Unlike os.MkdirAll, mode is not Go's os.FileMode, it is the unix mode\n+// (the suid/sgid/sticky bits are not the same as for os.FileMode).\n+//\n+// NOTE: If unsafePath is a subpath of root, we assume that you have already\n+// called SecureJoin and so we use the provided path verbatim without resolving\n+// any symlinks (this is done in a way that avoids symlink-exchange races).\n+// This means that the path also must not contain \"..\" elements, otherwise an\n+// error will occur.\n+//\n+// This is a somewhat less safe alternative to\n+// <https://github.com/cyphar/filepath-securejoin/pull/13>, but it should\n+// detect attempts to trick us into creating directories outside of the root.\n+// We should migrate to securejoin.MkdirAll once it is merged.\n+func MkdirAllInRootOpen(root, unsafePath string, mode uint32) (_ *os.File, Err error) {\n+\t// If the path is already \"within\" the root, use it verbatim.\n+\tfullPath := unsafePath\n+\tif !IsLexicallyInRoot(root, unsafePath) {\n+\t\tvar err error\n+\t\tfullPath, err = securejoin.SecureJoin(root, unsafePath)\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\t}\n+\tsubPath, err := filepath.Rel(root, fullPath)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\t// Check for any silly mode bits.\n+\tif mode&^0o7777 != 0 {\n+\t\treturn nil, fmt.Errorf(\"tried to include non-mode bits in MkdirAll mode: 0o%.3o\", mode)\n+\t}\n+\n+\tcurrentDir, err := os.OpenFile(root, unix.O_DIRECTORY|unix.O_CLOEXEC, 0)\n+\tif err != nil {\n+\t\treturn nil, fmt.Errorf(\"open root handle: %w\", err)\n+\t}\n+\tdefer func() {\n+\t\tif Err != nil {\n+\t\t\tcurrentDir.Close()\n+\t\t}\n+\t}()\n+\n+\tfor _, part := range strings.Split(subPath, string(filepath.Separator)) {\n+\t\tswitch part {\n+\t\tcase \"\", \".\":\n+\t\t\t// Skip over no-op components.\n+\t\t\tcontinue\n+\t\tcase \"..\":\n+\t\t\treturn nil, fmt.Errorf(\"possible breakout detected: found %q component in SecureJoin subpath %s\", part, subPath)\n+\t\t}\n+\n+\t\tnextDir, err := system.Openat(currentDir, part, unix.O_DIRECTORY|unix.O_NOFOLLOW|unix.O_CLOEXEC, 0)\n+\t\tswitch {\n+\t\tcase err == nil:\n+\t\t\t// Update the currentDir.\n+\t\t\t_ = currentDir.Close()\n+\t\t\tcurrentDir = nextDir\n+\n+\t\tcase errors.Is(err, unix.ENOTDIR):\n+\t\t\t// This might be a symlink or some other random file. Either way,\n+\t\t\t// error out.\n+\t\t\treturn nil, fmt.Errorf(\"cannot mkdir in %s/%s: %w\", currentDir.Name(), part, unix.ENOTDIR)\n+\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\t\t// Luckily, mkdirat will not follow trailing symlinks, so this is\n+\t\t\t// safe to do as-is.\n+\t\t\tif err := system.Mkdirat(currentDir, part, mode); err != nil {\n+\t\t\t\treturn nil, err\n+\t\t\t}\n+\t\t\t// Open the new directory. There is a race here where an attacker\n+\t\t\t// could swap the directory with a different directory, but\n+\t\t\t// MkdirAll's fuzzy semantics mean we don't care about that.\n+\t\t\tnextDir, err := system.Openat(currentDir, part, unix.O_DIRECTORY|unix.O_NOFOLLOW|unix.O_CLOEXEC, 0)\n+\t\t\tif err != nil {\n+\t\t\t\treturn nil, fmt.Errorf(\"open newly created directory: %w\", err)\n+\t\t\t}\n+\t\t\t// Update the currentDir.\n+\t\t\t_ = currentDir.Close()\n+\t\t\tcurrentDir = nextDir\n+\n+\t\tdefault:\n+\t\t\treturn nil, err\n+\t\t}\n+\t}\n+\treturn currentDir, nil\n+}\n+\n+// MkdirAllInRoot is a wrapper around MkdirAllInRootOpen which closes the\n+// returned handle, for callers that don't need to use it.\n+func MkdirAllInRoot(root, unsafePath string, mode uint32) error {\n+\tf, err := MkdirAllInRootOpen(root, unsafePath, mode)\n+\tif err == nil {\n+\t\t_ = f.Close()\n+\t}\n+\treturn err\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/onesoft-sudo/sudobot/commits/ef46ca98562f3c1abef4ff7dd94d8f7b8155ee50",
        "url": "https://api.github.com/repos/onesoft-sudo/sudobot/commits/ef46ca98562f3c1abef4ff7dd94d8f7b8155ee50",
        "html_url": "https://github.com/onesoft-sudo/sudobot/commit/ef46ca98562f3c1abef4ff7dd94d8f7b8155ee50",
        "message": "fix: config permission checks\n\nSigned-off-by: GitHub <noreply@github.com>",
        "files": [
            {
                "sha": "bbc437c8dc2a2f3400c4ed315b5ad8243d2b5257",
                "filename": "src/main/typescript/commands/settings/ConfigCommand.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/onesoft-sudo/sudobot/blob/ef46ca98562f3c1abef4ff7dd94d8f7b8155ee50/src%2Fmain%2Ftypescript%2Fcommands%2Fsettings%2FConfigCommand.ts",
                "raw_url": "https://github.com/onesoft-sudo/sudobot/raw/ef46ca98562f3c1abef4ff7dd94d8f7b8155ee50/src%2Fmain%2Ftypescript%2Fcommands%2Fsettings%2FConfigCommand.ts",
                "contents_url": "https://api.github.com/repos/onesoft-sudo/sudobot/contents/src%2Fmain%2Ftypescript%2Fcommands%2Fsettings%2FConfigCommand.ts?ref=ef46ca98562f3c1abef4ff7dd94d8f7b8155ee50",
                "patch": "@@ -4,6 +4,7 @@ import InteractionContext from \"@framework/commands/InteractionContext\";\n import LegacyContext from \"@framework/commands/LegacyContext\";\n import { Inject } from \"@framework/container/Inject\";\n import { GatewayEventListener } from \"@framework/events/GatewayEventListener\";\n+import { PermissionFlags } from \"@framework/permissions/PermissionFlag\";\n import { get, has, set, unset } from \"@framework/utils/objects\";\n import { getZodPropertyPaths } from \"@framework/utils/zod\";\n import { Colors } from \"@main/constants/Colors\";\n@@ -47,6 +48,7 @@ class ConfigCommand extends Command {\n             description: \"Unset a configuration key\"\n         }\n     };\n+    public override readonly permissions = [PermissionFlags.ManageGuild];\n \n     @Inject()\n     private readonly configManager!: ConfigurationManager;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/metal3-io/baremetal-operator/commits/3af4882e9c5fadc1a7550f53daea21dccd271f74",
        "url": "https://api.github.com/repos/metal3-io/baremetal-operator/commits/3af4882e9c5fadc1a7550f53daea21dccd271f74",
        "html_url": "https://github.com/metal3-io/baremetal-operator/commit/3af4882e9c5fadc1a7550f53daea21dccd271f74",
        "message": "Merge pull request #1930 from Nordix/tuomo/ghsa-pqfh-xh7w-7h3p-0.6\n\n\ud83d\udc1b Disallow fetching secrets from namespaces different from the host's one",
        "files": [
            {
                "sha": "4dc0655d09d0e389e4758513291cc6f191359e74",
                "filename": "controllers/metal3.io/baremetalhost_controller_test.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/metal3-io/baremetal-operator/blob/3af4882e9c5fadc1a7550f53daea21dccd271f74/controllers%2Fmetal3.io%2Fbaremetalhost_controller_test.go",
                "raw_url": "https://github.com/metal3-io/baremetal-operator/raw/3af4882e9c5fadc1a7550f53daea21dccd271f74/controllers%2Fmetal3.io%2Fbaremetalhost_controller_test.go",
                "contents_url": "https://api.github.com/repos/metal3-io/baremetal-operator/contents/controllers%2Fmetal3.io%2Fbaremetalhost_controller_test.go?ref=3af4882e9c5fadc1a7550f53daea21dccd271f74",
                "patch": "@@ -41,6 +41,10 @@ const (\n )\n \n func newSecret(name string, data map[string]string) *corev1.Secret {\n+\treturn newSecretInNamespace(name, namespace, data)\n+}\n+\n+func newSecretInNamespace(name, namespace string, data map[string]string) *corev1.Secret {\n \tsecretData := make(map[string][]byte)\n \tfor k, v := range data {\n \t\tsecretData[k] = []byte(base64.StdEncoding.EncodeToString([]byte(v)))"
            },
            {
                "sha": "037a0372c4b566e82c2d6289144985f59c8a11cb",
                "filename": "controllers/metal3.io/host_config_data.go",
                "status": "modified",
                "additions": 7,
                "deletions": 3,
                "changes": 10,
                "blob_url": "https://github.com/metal3-io/baremetal-operator/blob/3af4882e9c5fadc1a7550f53daea21dccd271f74/controllers%2Fmetal3.io%2Fhost_config_data.go",
                "raw_url": "https://github.com/metal3-io/baremetal-operator/raw/3af4882e9c5fadc1a7550f53daea21dccd271f74/controllers%2Fmetal3.io%2Fhost_config_data.go",
                "contents_url": "https://api.github.com/repos/metal3-io/baremetal-operator/contents/controllers%2Fmetal3.io%2Fhost_config_data.go?ref=3af4882e9c5fadc1a7550f53daea21dccd271f74",
                "patch": "@@ -2,11 +2,11 @@ package controllers\n \n import (\n \t\"github.com/go-logr/logr\"\n-\tcorev1 \"k8s.io/api/core/v1\"\n-\t\"k8s.io/apimachinery/pkg/types\"\n-\n \tmetal3api \"github.com/metal3-io/baremetal-operator/apis/metal3.io/v1alpha1\"\n \t\"github.com/metal3-io/baremetal-operator/pkg/secretutils\"\n+\t\"github.com/pkg/errors\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\t\"k8s.io/apimachinery/pkg/types\"\n )\n \n // hostConfigData is an implementation of host configuration data interface.\n@@ -21,6 +21,10 @@ type hostConfigData struct {\n // parameter to detirmine which data to return in case secret contins multiple\n // keys.\n func (hcd *hostConfigData) getSecretData(name, namespace, dataKey string) (string, error) {\n+\tif namespace != hcd.host.Namespace {\n+\t\treturn \"\", errors.Errorf(\"%s secret must be in same namespace as host %s/%s\", dataKey, hcd.host.Namespace, hcd.host.Name)\n+\t}\n+\n \tkey := types.NamespacedName{\n \t\tName:      name,\n \t\tNamespace: namespace,"
            },
            {
                "sha": "a322f2d82b2da6dbd40af9bd4ba3b875d4734ad6",
                "filename": "controllers/metal3.io/host_config_data_test.go",
                "status": "modified",
                "additions": 49,
                "deletions": 1,
                "changes": 50,
                "blob_url": "https://github.com/metal3-io/baremetal-operator/blob/3af4882e9c5fadc1a7550f53daea21dccd271f74/controllers%2Fmetal3.io%2Fhost_config_data_test.go",
                "raw_url": "https://github.com/metal3-io/baremetal-operator/raw/3af4882e9c5fadc1a7550f53daea21dccd271f74/controllers%2Fmetal3.io%2Fhost_config_data_test.go",
                "contents_url": "https://api.github.com/repos/metal3-io/baremetal-operator/contents/controllers%2Fmetal3.io%2Fhost_config_data_test.go?ref=3af4882e9c5fadc1a7550f53daea21dccd271f74",
                "patch": "@@ -324,6 +324,54 @@ func TestProvisionWithHostConfig(t *testing.T) {\n \t\t\tExpectedNetworkData: \"\",\n \t\t\tErrNetworkData:      true,\n \t\t},\n+\t\t{\n+\t\t\tScenario: \"user-data secret in different namespace\",\n+\t\t\tHost: newHost(\"host-user-data\",\n+\t\t\t\t&metal3api.BareMetalHostSpec{\n+\t\t\t\t\tBMC: metal3api.BMCDetails{\n+\t\t\t\t\t\tAddress:         \"ipmi://192.168.122.1:6233\",\n+\t\t\t\t\t\tCredentialsName: defaultSecretName,\n+\t\t\t\t\t},\n+\t\t\t\t\tUserData: &corev1.SecretReference{\n+\t\t\t\t\t\tName:      \"user-data\",\n+\t\t\t\t\t\tNamespace: \"other-namespace\",\n+\t\t\t\t\t},\n+\t\t\t\t}),\n+\t\t\tUserDataSecret: newSecretInNamespace(\"user-data\", \"other-namespace\", map[string]string{\"userData\": \"somedata\"}),\n+\t\t\tErrUserData:    true,\n+\t\t},\n+\t\t{\n+\t\t\tScenario: \"meta-data secret in different namespace\",\n+\t\t\tHost: newHost(\"host-user-data\",\n+\t\t\t\t&metal3api.BareMetalHostSpec{\n+\t\t\t\t\tBMC: metal3api.BMCDetails{\n+\t\t\t\t\t\tAddress:         \"ipmi://192.168.122.1:6233\",\n+\t\t\t\t\t\tCredentialsName: defaultSecretName,\n+\t\t\t\t\t},\n+\t\t\t\t\tMetaData: &corev1.SecretReference{\n+\t\t\t\t\t\tName:      \"meta-data\",\n+\t\t\t\t\t\tNamespace: \"other-namespace\",\n+\t\t\t\t\t},\n+\t\t\t\t}),\n+\t\t\tNetworkDataSecret: newSecretInNamespace(\"meta-data\", \"other-namespace\", map[string]string{\"metaData\": \"key: value\"}),\n+\t\t\tErrMetaData:       true,\n+\t\t},\n+\t\t{\n+\t\t\tScenario: \"network-data secret in different namespace\",\n+\t\t\tHost: newHost(\"host-user-data\",\n+\t\t\t\t&metal3api.BareMetalHostSpec{\n+\t\t\t\t\tBMC: metal3api.BMCDetails{\n+\t\t\t\t\t\tAddress:         \"ipmi://192.168.122.1:6233\",\n+\t\t\t\t\t\tCredentialsName: defaultSecretName,\n+\t\t\t\t\t},\n+\t\t\t\t\tNetworkData: &corev1.SecretReference{\n+\t\t\t\t\t\tName:      \"net-data\",\n+\t\t\t\t\t\tNamespace: \"other-namespace\",\n+\t\t\t\t\t},\n+\t\t\t\t}),\n+\t\t\tNetworkDataSecret: newSecretInNamespace(\"net-data\", \"other-namespace\", map[string]string{\"networkData\": \"key: value\"}),\n+\t\t\tErrNetworkData:    true,\n+\t\t},\n \t}\n \n \tfor _, tc := range testCases {\n@@ -379,7 +427,7 @@ func TestProvisionWithHostConfig(t *testing.T) {\n \t\t\t}\n \n \t\t\tif actualMetaData != tc.ExpectedMetaData {\n-\t\t\t\tt.Fatal(fmt.Errorf(\"Failed to assert MetaData. Expected '%s' got '%s'\", actualMetaData, tc.ExpectedMetaData))\n+\t\t\t\tt.Fatal(fmt.Errorf(\"Failed to assert MetaData. Expected '%s' got '%s'\", tc.ExpectedMetaData, actualMetaData))\n \t\t\t}\n \t\t})\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/metal3-io/baremetal-operator/commits/bedae7b997d16f36e772806681569bb8eb4dadbb",
        "url": "https://api.github.com/repos/metal3-io/baremetal-operator/commits/bedae7b997d16f36e772806681569bb8eb4dadbb",
        "html_url": "https://github.com/metal3-io/baremetal-operator/commit/bedae7b997d16f36e772806681569bb8eb4dadbb",
        "message": "Merge pull request #1931 from Nordix/tuomo/ghsa-pqfh-xh7w-7h3p-0.5\n\n\ud83d\udc1b Disallow fetching secrets from namespaces different from the host's one",
        "files": [
            {
                "sha": "4dc0655d09d0e389e4758513291cc6f191359e74",
                "filename": "controllers/metal3.io/baremetalhost_controller_test.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/metal3-io/baremetal-operator/blob/bedae7b997d16f36e772806681569bb8eb4dadbb/controllers%2Fmetal3.io%2Fbaremetalhost_controller_test.go",
                "raw_url": "https://github.com/metal3-io/baremetal-operator/raw/bedae7b997d16f36e772806681569bb8eb4dadbb/controllers%2Fmetal3.io%2Fbaremetalhost_controller_test.go",
                "contents_url": "https://api.github.com/repos/metal3-io/baremetal-operator/contents/controllers%2Fmetal3.io%2Fbaremetalhost_controller_test.go?ref=bedae7b997d16f36e772806681569bb8eb4dadbb",
                "patch": "@@ -41,6 +41,10 @@ const (\n )\n \n func newSecret(name string, data map[string]string) *corev1.Secret {\n+\treturn newSecretInNamespace(name, namespace, data)\n+}\n+\n+func newSecretInNamespace(name, namespace string, data map[string]string) *corev1.Secret {\n \tsecretData := make(map[string][]byte)\n \tfor k, v := range data {\n \t\tsecretData[k] = []byte(base64.StdEncoding.EncodeToString([]byte(v)))"
            },
            {
                "sha": "037a0372c4b566e82c2d6289144985f59c8a11cb",
                "filename": "controllers/metal3.io/host_config_data.go",
                "status": "modified",
                "additions": 7,
                "deletions": 3,
                "changes": 10,
                "blob_url": "https://github.com/metal3-io/baremetal-operator/blob/bedae7b997d16f36e772806681569bb8eb4dadbb/controllers%2Fmetal3.io%2Fhost_config_data.go",
                "raw_url": "https://github.com/metal3-io/baremetal-operator/raw/bedae7b997d16f36e772806681569bb8eb4dadbb/controllers%2Fmetal3.io%2Fhost_config_data.go",
                "contents_url": "https://api.github.com/repos/metal3-io/baremetal-operator/contents/controllers%2Fmetal3.io%2Fhost_config_data.go?ref=bedae7b997d16f36e772806681569bb8eb4dadbb",
                "patch": "@@ -2,11 +2,11 @@ package controllers\n \n import (\n \t\"github.com/go-logr/logr\"\n-\tcorev1 \"k8s.io/api/core/v1\"\n-\t\"k8s.io/apimachinery/pkg/types\"\n-\n \tmetal3api \"github.com/metal3-io/baremetal-operator/apis/metal3.io/v1alpha1\"\n \t\"github.com/metal3-io/baremetal-operator/pkg/secretutils\"\n+\t\"github.com/pkg/errors\"\n+\tcorev1 \"k8s.io/api/core/v1\"\n+\t\"k8s.io/apimachinery/pkg/types\"\n )\n \n // hostConfigData is an implementation of host configuration data interface.\n@@ -21,6 +21,10 @@ type hostConfigData struct {\n // parameter to detirmine which data to return in case secret contins multiple\n // keys.\n func (hcd *hostConfigData) getSecretData(name, namespace, dataKey string) (string, error) {\n+\tif namespace != hcd.host.Namespace {\n+\t\treturn \"\", errors.Errorf(\"%s secret must be in same namespace as host %s/%s\", dataKey, hcd.host.Namespace, hcd.host.Name)\n+\t}\n+\n \tkey := types.NamespacedName{\n \t\tName:      name,\n \t\tNamespace: namespace,"
            },
            {
                "sha": "4ecc5a6d682a599c6e8ad8058fa54b3614b64df3",
                "filename": "controllers/metal3.io/host_config_data_test.go",
                "status": "modified",
                "additions": 49,
                "deletions": 1,
                "changes": 50,
                "blob_url": "https://github.com/metal3-io/baremetal-operator/blob/bedae7b997d16f36e772806681569bb8eb4dadbb/controllers%2Fmetal3.io%2Fhost_config_data_test.go",
                "raw_url": "https://github.com/metal3-io/baremetal-operator/raw/bedae7b997d16f36e772806681569bb8eb4dadbb/controllers%2Fmetal3.io%2Fhost_config_data_test.go",
                "contents_url": "https://api.github.com/repos/metal3-io/baremetal-operator/contents/controllers%2Fmetal3.io%2Fhost_config_data_test.go?ref=bedae7b997d16f36e772806681569bb8eb4dadbb",
                "patch": "@@ -324,6 +324,54 @@ func TestProvisionWithHostConfig(t *testing.T) {\n \t\t\tExpectedNetworkData: \"\",\n \t\t\tErrNetworkData:      true,\n \t\t},\n+\t\t{\n+\t\t\tScenario: \"user-data secret in different namespace\",\n+\t\t\tHost: newHost(\"host-user-data\",\n+\t\t\t\t&metal3api.BareMetalHostSpec{\n+\t\t\t\t\tBMC: metal3api.BMCDetails{\n+\t\t\t\t\t\tAddress:         \"ipmi://192.168.122.1:6233\",\n+\t\t\t\t\t\tCredentialsName: defaultSecretName,\n+\t\t\t\t\t},\n+\t\t\t\t\tUserData: &corev1.SecretReference{\n+\t\t\t\t\t\tName:      \"user-data\",\n+\t\t\t\t\t\tNamespace: \"other-namespace\",\n+\t\t\t\t\t},\n+\t\t\t\t}),\n+\t\t\tUserDataSecret: newSecretInNamespace(\"user-data\", \"other-namespace\", map[string]string{\"userData\": \"somedata\"}),\n+\t\t\tErrUserData:    true,\n+\t\t},\n+\t\t{\n+\t\t\tScenario: \"meta-data secret in different namespace\",\n+\t\t\tHost: newHost(\"host-user-data\",\n+\t\t\t\t&metal3api.BareMetalHostSpec{\n+\t\t\t\t\tBMC: metal3api.BMCDetails{\n+\t\t\t\t\t\tAddress:         \"ipmi://192.168.122.1:6233\",\n+\t\t\t\t\t\tCredentialsName: defaultSecretName,\n+\t\t\t\t\t},\n+\t\t\t\t\tMetaData: &corev1.SecretReference{\n+\t\t\t\t\t\tName:      \"meta-data\",\n+\t\t\t\t\t\tNamespace: \"other-namespace\",\n+\t\t\t\t\t},\n+\t\t\t\t}),\n+\t\t\tNetworkDataSecret: newSecretInNamespace(\"meta-data\", \"other-namespace\", map[string]string{\"metaData\": \"key: value\"}),\n+\t\t\tErrMetaData:       true,\n+\t\t},\n+\t\t{\n+\t\t\tScenario: \"network-data secret in different namespace\",\n+\t\t\tHost: newHost(\"host-user-data\",\n+\t\t\t\t&metal3api.BareMetalHostSpec{\n+\t\t\t\t\tBMC: metal3api.BMCDetails{\n+\t\t\t\t\t\tAddress:         \"ipmi://192.168.122.1:6233\",\n+\t\t\t\t\t\tCredentialsName: defaultSecretName,\n+\t\t\t\t\t},\n+\t\t\t\t\tNetworkData: &corev1.SecretReference{\n+\t\t\t\t\t\tName:      \"net-data\",\n+\t\t\t\t\t\tNamespace: \"other-namespace\",\n+\t\t\t\t\t},\n+\t\t\t\t}),\n+\t\t\tNetworkDataSecret: newSecretInNamespace(\"net-data\", \"other-namespace\", map[string]string{\"networkData\": \"key: value\"}),\n+\t\t\tErrNetworkData:    true,\n+\t\t},\n \t}\n \n \tfor _, tc := range testCases {\n@@ -379,7 +427,7 @@ func TestProvisionWithHostConfig(t *testing.T) {\n \t\t\t}\n \n \t\t\tif actualMetaData != tc.ExpectedMetaData {\n-\t\t\t\tt.Fatal(fmt.Errorf(\"Failed to assert MetaData. Expected '%s' got '%s'\", actualMetaData, tc.ExpectedMetaData))\n+\t\t\t\tt.Fatal(fmt.Errorf(\"Failed to assert MetaData. Expected '%s' got '%s'\", tc.ExpectedMetaData, actualMetaData))\n \t\t\t}\n \t\t})\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/metal3-io/baremetal-operator/commits/c2b5a557641bc273367635124047d6c958aa15f7",
        "url": "https://api.github.com/repos/metal3-io/baremetal-operator/commits/c2b5a557641bc273367635124047d6c958aa15f7",
        "html_url": "https://github.com/metal3-io/baremetal-operator/commit/c2b5a557641bc273367635124047d6c958aa15f7",
        "message": "Merge pull request #1929 from Nordix/tuomo/ghsa-pqfh-xh7w-7h3p\n\n\ud83d\udc1b Disallow fetching secrets from namespaces different from the host's one",
        "files": [
            {
                "sha": "e0b5eba0d835e62eb3cc82bb1bf39c2c832ffac9",
                "filename": "controllers/metal3.io/baremetalhost_controller_test.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/metal3-io/baremetal-operator/blob/c2b5a557641bc273367635124047d6c958aa15f7/controllers%2Fmetal3.io%2Fbaremetalhost_controller_test.go",
                "raw_url": "https://github.com/metal3-io/baremetal-operator/raw/c2b5a557641bc273367635124047d6c958aa15f7/controllers%2Fmetal3.io%2Fbaremetalhost_controller_test.go",
                "contents_url": "https://api.github.com/repos/metal3-io/baremetal-operator/contents/controllers%2Fmetal3.io%2Fbaremetalhost_controller_test.go?ref=c2b5a557641bc273367635124047d6c958aa15f7",
                "patch": "@@ -37,6 +37,10 @@ const (\n )\n \n func newSecret(name string, data map[string]string) *corev1.Secret {\n+\treturn newSecretInNamespace(name, namespace, data)\n+}\n+\n+func newSecretInNamespace(name, namespace string, data map[string]string) *corev1.Secret {\n \tsecretData := make(map[string][]byte)\n \tfor k, v := range data {\n \t\tsecretData[k] = []byte(base64.StdEncoding.EncodeToString([]byte(v)))"
            },
            {
                "sha": "037a0372c4b566e82c2d6289144985f59c8a11cb",
                "filename": "controllers/metal3.io/host_config_data.go",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/metal3-io/baremetal-operator/blob/c2b5a557641bc273367635124047d6c958aa15f7/controllers%2Fmetal3.io%2Fhost_config_data.go",
                "raw_url": "https://github.com/metal3-io/baremetal-operator/raw/c2b5a557641bc273367635124047d6c958aa15f7/controllers%2Fmetal3.io%2Fhost_config_data.go",
                "contents_url": "https://api.github.com/repos/metal3-io/baremetal-operator/contents/controllers%2Fmetal3.io%2Fhost_config_data.go?ref=c2b5a557641bc273367635124047d6c958aa15f7",
                "patch": "@@ -4,6 +4,7 @@ import (\n \t\"github.com/go-logr/logr\"\n \tmetal3api \"github.com/metal3-io/baremetal-operator/apis/metal3.io/v1alpha1\"\n \t\"github.com/metal3-io/baremetal-operator/pkg/secretutils\"\n+\t\"github.com/pkg/errors\"\n \tcorev1 \"k8s.io/api/core/v1\"\n \t\"k8s.io/apimachinery/pkg/types\"\n )\n@@ -20,6 +21,10 @@ type hostConfigData struct {\n // parameter to detirmine which data to return in case secret contins multiple\n // keys.\n func (hcd *hostConfigData) getSecretData(name, namespace, dataKey string) (string, error) {\n+\tif namespace != hcd.host.Namespace {\n+\t\treturn \"\", errors.Errorf(\"%s secret must be in same namespace as host %s/%s\", dataKey, hcd.host.Namespace, hcd.host.Name)\n+\t}\n+\n \tkey := types.NamespacedName{\n \t\tName:      name,\n \t\tNamespace: namespace,"
            },
            {
                "sha": "f7d9ac4a58b0fb0816c69a8e9b72ebc670bcdf4b",
                "filename": "controllers/metal3.io/host_config_data_test.go",
                "status": "modified",
                "additions": 49,
                "deletions": 1,
                "changes": 50,
                "blob_url": "https://github.com/metal3-io/baremetal-operator/blob/c2b5a557641bc273367635124047d6c958aa15f7/controllers%2Fmetal3.io%2Fhost_config_data_test.go",
                "raw_url": "https://github.com/metal3-io/baremetal-operator/raw/c2b5a557641bc273367635124047d6c958aa15f7/controllers%2Fmetal3.io%2Fhost_config_data_test.go",
                "contents_url": "https://api.github.com/repos/metal3-io/baremetal-operator/contents/controllers%2Fmetal3.io%2Fhost_config_data_test.go?ref=c2b5a557641bc273367635124047d6c958aa15f7",
                "patch": "@@ -323,6 +323,54 @@ func TestProvisionWithHostConfig(t *testing.T) {\n \t\t\tExpectedNetworkData: \"\",\n \t\t\tErrNetworkData:      true,\n \t\t},\n+\t\t{\n+\t\t\tScenario: \"user-data secret in different namespace\",\n+\t\t\tHost: newHost(\"host-user-data\",\n+\t\t\t\t&metal3api.BareMetalHostSpec{\n+\t\t\t\t\tBMC: metal3api.BMCDetails{\n+\t\t\t\t\t\tAddress:         \"ipmi://192.168.122.1:6233\",\n+\t\t\t\t\t\tCredentialsName: defaultSecretName,\n+\t\t\t\t\t},\n+\t\t\t\t\tUserData: &corev1.SecretReference{\n+\t\t\t\t\t\tName:      \"user-data\",\n+\t\t\t\t\t\tNamespace: \"other-namespace\",\n+\t\t\t\t\t},\n+\t\t\t\t}),\n+\t\t\tUserDataSecret: newSecretInNamespace(\"user-data\", \"other-namespace\", map[string]string{\"userData\": \"somedata\"}),\n+\t\t\tErrUserData:    true,\n+\t\t},\n+\t\t{\n+\t\t\tScenario: \"meta-data secret in different namespace\",\n+\t\t\tHost: newHost(\"host-user-data\",\n+\t\t\t\t&metal3api.BareMetalHostSpec{\n+\t\t\t\t\tBMC: metal3api.BMCDetails{\n+\t\t\t\t\t\tAddress:         \"ipmi://192.168.122.1:6233\",\n+\t\t\t\t\t\tCredentialsName: defaultSecretName,\n+\t\t\t\t\t},\n+\t\t\t\t\tMetaData: &corev1.SecretReference{\n+\t\t\t\t\t\tName:      \"meta-data\",\n+\t\t\t\t\t\tNamespace: \"other-namespace\",\n+\t\t\t\t\t},\n+\t\t\t\t}),\n+\t\t\tNetworkDataSecret: newSecretInNamespace(\"meta-data\", \"other-namespace\", map[string]string{\"metaData\": \"key: value\"}),\n+\t\t\tErrMetaData:       true,\n+\t\t},\n+\t\t{\n+\t\t\tScenario: \"network-data secret in different namespace\",\n+\t\t\tHost: newHost(\"host-user-data\",\n+\t\t\t\t&metal3api.BareMetalHostSpec{\n+\t\t\t\t\tBMC: metal3api.BMCDetails{\n+\t\t\t\t\t\tAddress:         \"ipmi://192.168.122.1:6233\",\n+\t\t\t\t\t\tCredentialsName: defaultSecretName,\n+\t\t\t\t\t},\n+\t\t\t\t\tNetworkData: &corev1.SecretReference{\n+\t\t\t\t\t\tName:      \"net-data\",\n+\t\t\t\t\t\tNamespace: \"other-namespace\",\n+\t\t\t\t\t},\n+\t\t\t\t}),\n+\t\t\tNetworkDataSecret: newSecretInNamespace(\"net-data\", \"other-namespace\", map[string]string{\"networkData\": \"key: value\"}),\n+\t\t\tErrNetworkData:    true,\n+\t\t},\n \t}\n \n \tfor _, tc := range testCases {\n@@ -378,7 +426,7 @@ func TestProvisionWithHostConfig(t *testing.T) {\n \t\t\t}\n \n \t\t\tif actualMetaData != tc.ExpectedMetaData {\n-\t\t\t\tt.Fatal(fmt.Errorf(\"Failed to assert MetaData. Expected '%s' got '%s'\", actualMetaData, tc.ExpectedMetaData))\n+\t\t\t\tt.Fatal(fmt.Errorf(\"Failed to assert MetaData. Expected '%s' got '%s'\", tc.ExpectedMetaData, actualMetaData))\n \t\t\t}\n \t\t})\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xibosignage/xibo-cms/commits/009527855d8bfd0ffb95f5c88ed72b7b5bdebfa1",
        "url": "https://api.github.com/repos/xibosignage/xibo-cms/commits/009527855d8bfd0ffb95f5c88ed72b7b5bdebfa1",
        "html_url": "https://github.com/xibosignage/xibo-cms/commit/009527855d8bfd0ffb95f5c88ed72b7b5bdebfa1",
        "message": "Datasets: Fixed HTML sanitation in datasets table (#2698)",
        "files": [
            {
                "sha": "4436a310ba9529b1a57d91910adc4c3c3253397f",
                "filename": "views/dataset-dataentry-page.twig",
                "status": "modified",
                "additions": 33,
                "deletions": 1,
                "changes": 34,
                "blob_url": "https://github.com/xibosignage/xibo-cms/blob/009527855d8bfd0ffb95f5c88ed72b7b5bdebfa1/views%2Fdataset-dataentry-page.twig",
                "raw_url": "https://github.com/xibosignage/xibo-cms/raw/009527855d8bfd0ffb95f5c88ed72b7b5bdebfa1/views%2Fdataset-dataentry-page.twig",
                "contents_url": "https://api.github.com/repos/xibosignage/xibo-cms/contents/views%2Fdataset-dataentry-page.twig?ref=009527855d8bfd0ffb95f5c88ed72b7b5bdebfa1",
                "patch": "@@ -86,7 +86,33 @@\n         var multiSelectTitleTrans = \"{% trans \"Multi Select Mode\" %}\";\n         var editModeHelpTrans = \"{% trans \"Click on any row to edit\" %}\";\n         var multiSelectHelpTrans = \"{% trans \"Select one or more rows to delete\" %}\";\n+        const entityMap = {\n+            '&': '&amp;',\n+            '<': '&lt;',\n+            '>': '&gt;',\n+            '\"': '&quot;',\n+            \"'\": '&#39;',\n+            '/': '&#x2F;',\n+            '`': '&#x60;',\n+            '=': '&#x3D;'\n+        };\n+\n+        function sanitizeHtml(string) {\n+            return String(string).replace(/[&<>\"'`=\\/]/g, function (s) {\n+                return entityMap[s];\n+            });\n+        }\n+\n+        function validateHTMLData(str) {\n+            let doc = new DOMParser().parseFromString(str, \"text/html\");\n+\n+            // If valid html, sanitize and format as a code\n+            if (Array.from(doc.body.childNodes).some(node => node.nodeType === 1)) {\n+                return `<code>${sanitizeHtml(str)}</code>`;\n+            }\n \n+            return str;\n+        }\n \n         cols.push({ \"name\": \"id\", \"data\": \"id\" });\n         {% for col in dataSet.getColumn() %}\n@@ -104,7 +130,13 @@\n                     }\n                 });\n             {% else %}\n-                cols.push({ \"data\": \"{{ col.heading }}\", \"orderable\": {% if col.showSort == 1 %}true{% else %}false{% endif %} });\n+                cols.push({\n+                    \"data\": \"{{ col.heading }}\",\n+                    \"orderable\": {% if col.showSort == 1 %}true{% else %}false{% endif %},\n+                    \"render\": function(data) {\n+                        return validateHTMLData(data);\n+                    }\n+                });\n             {% endif %}\n         {% endfor %}\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xibosignage/xibo-cms/commits/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
        "url": "https://api.github.com/repos/xibosignage/xibo-cms/commits/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
        "html_url": "https://github.com/xibosignage/xibo-cms/commit/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
        "message": "Modules: Disable library media preview for generic file (#2706)",
        "files": [
            {
                "sha": "2c3c21781143114adb413de143a69c118f6958e7",
                "filename": "lib/Controller/Library.php",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/xibosignage/xibo-cms/blob/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/lib%2FController%2FLibrary.php",
                "raw_url": "https://github.com/xibosignage/xibo-cms/raw/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/lib%2FController%2FLibrary.php",
                "contents_url": "https://api.github.com/repos/xibosignage/xibo-cms/contents/lib%2FController%2FLibrary.php?ref=d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
                "patch": "@@ -1635,7 +1635,9 @@ public function download(Request $request, Response $response, $id)\n         $downloader->useLogger($this->getLog()->getLoggerInterface());\n \n         $params = $this->getSanitizer($request->getParams());\n-        if ($params->getCheckbox('preview') == 1) {\n+\n+        // Check if preview is allowed for the module\n+        if ($params->getCheckbox('preview') == 1 && $module->allowPreview === 1) {\n             $this->getLog()->debug('download: preview mode, seeing if we can output an image/video');\n \n             // Output a 1px image if we're not allowed to see the media."
            },
            {
                "sha": "4955466bc41d51a52bb495a4c52aabc177e0ebe4",
                "filename": "lib/Controller/Module.php",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/xibosignage/xibo-cms/blob/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/lib%2FController%2FModule.php",
                "raw_url": "https://github.com/xibosignage/xibo-cms/raw/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/lib%2FController%2FModule.php",
                "contents_url": "https://api.github.com/repos/xibosignage/xibo-cms/contents/lib%2FController%2FModule.php?ref=d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
                "patch": "@@ -256,6 +256,11 @@ public function settings(Request $request, Response $response, $id)\n             $setting->setValueByType($sanitizedParams, null, true);\n         }\n \n+        // Preview is not allowed for generic file type\n+        if ($module->allowPreview === 0 && $sanitizedParams->getCheckbox('previewEnabled') == 1) {\n+            throw new InvalidArgumentException(__('Preview is disabled'));\n+        }\n+\n         // Save\n         $module->save();\n "
            },
            {
                "sha": "10c9c84fc58f8936453972f40c52263bba95cf88",
                "filename": "lib/Entity/Module.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/xibosignage/xibo-cms/blob/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/lib%2FEntity%2FModule.php",
                "raw_url": "https://github.com/xibosignage/xibo-cms/raw/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/lib%2FEntity%2FModule.php",
                "contents_url": "https://api.github.com/repos/xibosignage/xibo-cms/contents/lib%2FEntity%2FModule.php?ref=d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
                "patch": "@@ -290,6 +290,7 @@ class Module implements \\JsonSerializable\n     public $errors;\n \n     // </editor-fold>\n+    public $allowPreview;\n \n     /** @var ModuleFactory */\n     private $moduleFactory;"
            },
            {
                "sha": "46637e1f7137e706c1d66d4816913b059d2a03cb",
                "filename": "lib/Factory/ModuleFactory.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/xibosignage/xibo-cms/blob/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/lib%2FFactory%2FModuleFactory.php",
                "raw_url": "https://github.com/xibosignage/xibo-cms/raw/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/lib%2FFactory%2FModuleFactory.php",
                "contents_url": "https://api.github.com/repos/xibosignage/xibo-cms/contents/lib%2FFactory%2FModuleFactory.php?ref=d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
                "patch": "@@ -754,6 +754,7 @@ private function createFromXml(string $file, array $modulesWithSettings): Module\n         $module->renderAs = $this->getFirstValueOrDefaultFromXmlNode($xml, 'renderAs');\n         $module->defaultDuration = intval($this->getFirstValueOrDefaultFromXmlNode($xml, 'defaultDuration'));\n         $module->hasThumbnail = intval($this->getFirstValueOrDefaultFromXmlNode($xml, 'hasThumbnail', 0));\n+        $module->allowPreview = intval($this->getFirstValueOrDefaultFromXmlNode($xml, 'allowPreview', 1));\n \n         // Validator classes\n         foreach ($xml->getElementsByTagName('validatorClass') as $node) {"
            },
            {
                "sha": "f9e8e841fcfec3fed8b2ee53cf0bea988a23f990",
                "filename": "modules/genericfile.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/xibosignage/xibo-cms/blob/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/modules%2Fgenericfile.xml",
                "raw_url": "https://github.com/xibosignage/xibo-cms/raw/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/modules%2Fgenericfile.xml",
                "contents_url": "https://api.github.com/repos/xibosignage/xibo-cms/contents/modules%2Fgenericfile.xml?ref=d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
                "patch": "@@ -38,6 +38,7 @@\n             <default>apk,ipk,js,html,htm</default>\n         </property>\n     </settings>\n+    <allowPreview>0</allowPreview>\n     <properties></properties>\n     <preview></preview>\n     <stencil>"
            },
            {
                "sha": "dd7cc87488de7f39a69ed6897ad1f267f9d7d558",
                "filename": "views/module-form-settings.twig",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/xibosignage/xibo-cms/blob/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/views%2Fmodule-form-settings.twig",
                "raw_url": "https://github.com/xibosignage/xibo-cms/raw/d8f13339469d9f19ce591fb2bd7c9e0e0d2da118/views%2Fmodule-form-settings.twig",
                "contents_url": "https://api.github.com/repos/xibosignage/xibo-cms/contents/views%2Fmodule-form-settings.twig?ref=d8f13339469d9f19ce591fb2bd7c9e0e0d2da118",
                "patch": "@@ -44,7 +44,7 @@\n \n                 {% set title %}{% trans \"Preview Enabled?\" %}{% endset %}\n                 {% set helpText %}{% trans \"When Preview is Enabled users will be able to see a preview in the layout editor.\" %}{% endset %}\n-                {{ forms.checkbox(\"previewEnabled\", title, module.previewEnabled, helpText) }}\n+                {{ forms.checkbox(\"previewEnabled\", title, module.previewEnabled, helpText, \"\", \"\", module.allowPreview == 0) }}\n \n                 {% set title %}{% trans \"Enabled?\" %}{% endset %}\n                 {% set helpText %}{% trans \"When Enabled users will be able to add media using this module.\" %}{% endset %}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openssl/openssl/commits/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0",
        "url": "https://api.github.com/repos/openssl/openssl/commits/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0",
        "html_url": "https://github.com/openssl/openssl/commit/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0",
        "message": "Avoid type errors in EAI-related name check logic.\n\nThe incorrectly typed data is read only, used in a compare operation, so\nneither remote code execution, nor memory content disclosure were possible.\nHowever, applications performing certificate name checks were vulnerable to\ndenial of service.\n\nThe GENERAL_TYPE data type is a union, and we must take care to access the\ncorrect member, based on `gen->type`, not all the member fields have the same\nstructure, and a segfault is possible if the wrong member field is read.\n\nThe code in question was lightly refactored with the intent to make it more\nobviously correct.\n\nFixes CVE-2024-6119\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Tomas Mraz <tomas@openssl.org>\n(cherry picked from commit 0890cd13d40fbc98f655f3974f466769caa83680)",
        "files": [
            {
                "sha": "a09414c972fa8cfa76afd9deea49c10401c7d7c3",
                "filename": "crypto/x509/v3_utl.c",
                "status": "modified",
                "additions": 53,
                "deletions": 25,
                "changes": 78,
                "blob_url": "https://github.com/openssl/openssl/blob/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/crypto%2Fx509%2Fv3_utl.c",
                "raw_url": "https://github.com/openssl/openssl/raw/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/crypto%2Fx509%2Fv3_utl.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/crypto%2Fx509%2Fv3_utl.c?ref=7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0",
                "patch": "@@ -916,36 +916,64 @@ static int do_x509_check(X509 *x, const char *chk, size_t chklen,\n             ASN1_STRING *cstr;\n \n             gen = sk_GENERAL_NAME_value(gens, i);\n-            if ((gen->type == GEN_OTHERNAME) && (check_type == GEN_EMAIL)) {\n-                if (OBJ_obj2nid(gen->d.otherName->type_id) ==\n-                    NID_id_on_SmtpUTF8Mailbox) {\n-                    san_present = 1;\n-\n-                    /*\n-                     * If it is not a UTF8String then that is unexpected and we\n-                     * treat it as no match\n-                     */\n-                    if (gen->d.otherName->value->type == V_ASN1_UTF8STRING) {\n-                        cstr = gen->d.otherName->value->value.utf8string;\n-\n-                        /* Positive on success, negative on error! */\n-                        if ((rv = do_check_string(cstr, 0, equal, flags,\n-                                                chk, chklen, peername)) != 0)\n-                            break;\n-                    }\n-                } else\n+            switch (gen->type) {\n+            default:\n+                continue;\n+            case GEN_OTHERNAME:\n+\t\tswitch (OBJ_obj2nid(gen->d.otherName->type_id)) {\n+                default:\n                     continue;\n-            } else {\n-                if ((gen->type != check_type) && (gen->type != GEN_OTHERNAME))\n+                case NID_id_on_SmtpUTF8Mailbox:\n+                    /*-\n+                     * https://datatracker.ietf.org/doc/html/rfc8398#section-3\n+                     *\n+                     *   Due to name constraint compatibility reasons described\n+                     *   in Section 6, SmtpUTF8Mailbox subjectAltName MUST NOT\n+                     *   be used unless the local-part of the email address\n+                     *   contains non-ASCII characters. When the local-part is\n+                     *   ASCII, rfc822Name subjectAltName MUST be used instead\n+                     *   of SmtpUTF8Mailbox. This is compatible with legacy\n+                     *   software that supports only rfc822Name (and not\n+                     *   SmtpUTF8Mailbox). [...]\n+                     *\n+                     *   SmtpUTF8Mailbox is encoded as UTF8String.\n+                     *\n+                     * If it is not a UTF8String then that is unexpected, and\n+                     * we ignore the invalid SAN (neither set san_present nor\n+                     * consider it a candidate for equality).  This does mean\n+                     * that the subject CN may be considered, as would be the\n+                     * case when the malformed SmtpUtf8Mailbox SAN is instead\n+                     * simply absent.\n+                     *\n+                     * When CN-ID matching is not desirable, applications can\n+                     * choose to turn it off, doing so is at this time a best\n+                     * practice.\n+                     */\n+                    if (check_type != GEN_EMAIL\n+                        || gen->d.otherName->value->type != V_ASN1_UTF8STRING)\n+                        continue;\n+                    alt_type = 0;\n+                    cstr = gen->d.otherName->value->value.utf8string;\n+                    break;\n+                }\n+                break;\n+            case GEN_EMAIL:\n+                if (check_type != GEN_EMAIL)\n                     continue;\n-            }\n-            san_present = 1;\n-            if (check_type == GEN_EMAIL)\n                 cstr = gen->d.rfc822Name;\n-            else if (check_type == GEN_DNS)\n+                break;\n+            case GEN_DNS:\n+                if (check_type != GEN_DNS)\n+                    continue;\n                 cstr = gen->d.dNSName;\n-            else\n+                break;\n+            case GEN_IPADD:\n+                if (check_type != GEN_IPADD)\n+                    continue;\n                 cstr = gen->d.iPAddress;\n+                break;\n+            }\n+            san_present = 1;\n             /* Positive on success, negative on error! */\n             if ((rv = do_check_string(cstr, alt_type, equal, flags,\n                                       chk, chklen, peername)) != 0)"
            },
            {
                "sha": "e18735d89aadf7ab41bfc71bea6dc5b3907f6c1d",
                "filename": "test/recipes/25-test_eai_data.t",
                "status": "modified",
                "additions": 11,
                "deletions": 1,
                "changes": 12,
                "blob_url": "https://github.com/openssl/openssl/blob/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/test%2Frecipes%2F25-test_eai_data.t",
                "raw_url": "https://github.com/openssl/openssl/raw/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/test%2Frecipes%2F25-test_eai_data.t",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data.t?ref=7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0",
                "patch": "@@ -21,16 +21,18 @@ setup(\"test_eai_data\");\n #./util/wrap.pl apps/openssl verify -nameopt utf8 -no_check_time -CAfile test/recipes/25-test_eai_data/utf8_chain.pem test/recipes/25-test_eai_data/ascii_leaf.pem\n #./util/wrap.pl apps/openssl verify -nameopt utf8 -no_check_time -CAfile test/recipes/25-test_eai_data/ascii_chain.pem test/recipes/25-test_eai_data/utf8_leaf.pem\n \n-plan tests => 12;\n+plan tests => 16;\n \n require_ok(srctop_file('test','recipes','tconversion.pl'));\n my $folder = \"test/recipes/25-test_eai_data\";\n \n my $ascii_pem = srctop_file($folder, \"ascii_leaf.pem\");\n my $utf8_pem  = srctop_file($folder, \"utf8_leaf.pem\");\n+my $kdc_pem   = srctop_file($folder, \"kdc-cert.pem\");\n \n my $ascii_chain_pem = srctop_file($folder, \"ascii_chain.pem\");\n my $utf8_chain_pem  = srctop_file($folder, \"utf8_chain.pem\");\n+my $kdc_chain_pem  = srctop_file($folder, \"kdc-root-cert.pem\");\n \n my $out;\n my $outcnt = 0;\n@@ -56,10 +58,18 @@ SKIP: {\n \n ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $ascii_chain_pem, $ascii_pem])));\n ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $utf8_chain_pem, $utf8_pem])));\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $kdc_chain_pem, $kdc_pem])));\n \n ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $ascii_chain_pem, $utf8_pem])));\n ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $utf8_chain_pem,  $ascii_pem])));\n \n+# Check an otherName does not get misparsed as an DNS name, (should trigger ASAN errors if violated).\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_hostname\", 'mx1.example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+# Check an otherName does not get misparsed as an email address, (should trigger ASAN errors if violated).\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_email\", 'joe@example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+# We expect SmtpUTF8Mailbox to be a UTF8 String, not an IA5String.\n+ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_email\", 'moe@example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+\n #Check that we get the expected failure return code\n with({ exit_checker => sub { return shift == 2; } },\n      sub {"
            },
            {
                "sha": "e8a2c6f55d45985e3b57597e049fe31f031a34f2",
                "filename": "test/recipes/25-test_eai_data/kdc-cert.pem",
                "status": "added",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/openssl/openssl/blob/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem",
                "raw_url": "https://github.com/openssl/openssl/raw/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem?ref=7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0",
                "patch": "@@ -0,0 +1,21 @@\n+-----BEGIN CERTIFICATE-----\n+MIIDbDCCAlSgAwIBAgIBAjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDARSb290\n+MCAXDTI0MDYyMDA2MTQxNVoYDzIxMjQwNjIwMDYxNDE1WjAXMRUwEwYDVQQDDAxU\n+RVNULkVYQU1QTEUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC6wfP+\n+6go79dkpo/dGLMlPZ7Gw/Q6gUYrCWZWUEgEeRVHCrqOlgUEyA+PcWas/XDPUxXry\n+BQlJHLvlqamAQn8gs4QPBARFYWKNiTVGyaRkgNA1N5gqyZdrP9UE+ZJmdqxRAAe8\n+vvpGZWSgevPhLUiSCFYDiD0Rtji2Hm3rGUrReQFBQDEw2pNGwz9zIaxUs08kQZcx\n+Yzyiplz5Oau+R/6sAgUwDlrD9xOlUxx/tA/MSDIfkK8qioU11uUZtO5VjkNQy/bT\n+7zQMmXxWgm2MIgOs1u4YN7YGOtgqHE9v9iPHHfgrkbQDtVDGQsa8AQEhkUDSCtW9\n+3VFAKx6dGNXYzFwfAgMBAAGjgcgwgcUwHQYDVR0OBBYEFFR5tZycW19DmtbL4Zqj\n+te1c2vZLMAkGA1UdIwQCMAAwCQYDVR0TBAIwADCBjQYDVR0RBIGFMIGCoD8GBisG\n+AQUCAqA1MDOgDhsMVEVTVC5FWEFNUExFoSEwH6ADAgEBoRgwFhsGa3JidGd0GwxU\n+RVNULkVYQU1QTEWgHQYIKwYBBQUHCAmgERYPbW9lQGV4YW1wbGUuY29tgQ9qb2VA\n+ZXhhbXBsZS5jb22CD214MS5leGFtcGxlLmNvbTANBgkqhkiG9w0BAQsFAAOCAQEA\n+T0xzVtVpRtaOzIhgzw7XQUdzWD5UEGSJJ1cBCOmKUWwDLTAouCYLFB4TbEE7MMUb\n+iuMy60bjmVtvfJIXorGUgSadRe5RWJ5DamJWvPA0Q9x7blnEcXqEF+9Td+ypevgU\n+UYHFmg83OYwxOsFXZ5cRuXMk3WCsDHQIBi6D1L6oDDZ2pfArs5mqm3thQKVlqyl1\n+El3XRYEdqAz/5eCOFNfwxF0ALxjxVr/Z50StUZU8I7Zfev6+kHhyrR7dqzYJImv9\n+0fTCOBEMjIETDsrA70OxAMu4V16nrWZdJdvzblS2qrt97Omkj+2kiPAJFB76RpwI\n+oDQ9fKfUOAmUFth2/R/eGA==\n+-----END CERTIFICATE-----"
            },
            {
                "sha": "a74c96bf31469f671c82109e1496d7546fb388fd",
                "filename": "test/recipes/25-test_eai_data/kdc-root-cert.pem",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/openssl/openssl/blob/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem",
                "raw_url": "https://github.com/openssl/openssl/raw/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem?ref=7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0",
                "patch": "@@ -0,0 +1,16 @@\n+-----BEGIN CERTIFICATE-----\n+MIICnDCCAYQCCQCBswYcrlZSHjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDARS\n+b290MCAXDTI0MDYyMDA2MTQxNVoYDzIxMjQwNjIwMDYxNDE1WjAPMQ0wCwYDVQQD\n+DARSb290MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqRj8S4kBbIUj\n+61kZfi6nE35Q38U140+qt4uAiwAhKumfVHlBM0zQ98WFt5zMHIBQwIb3yjc2zj+0\n+qzUnQfwm1r/RfcMmBPEti9Ge+aEMSsds2gMXziOFM8wd2aAFPy7UVE0XpEWofsRK\n+MGi61MKVdPSbGIxBwY9VW38/7D/wf1HtJe7y0xpuecR7GB2XAs+qST59NjuF+7wS\n+dLM8Hb3TATgeYbXXWsRJgwz+SPzExg5WmLnU+7y4brZ32dHtdSmkRVSgSlaIf7Xj\n+3Tc6Zi7I+W/JYk7hy1zUexVdWCak4PHcoWrXe0gNNN/t8VfLfMExt5z/HIylXnU7\n+pGUyqZlTGQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQAHpLF1UCRy7b6Hk0rLokxI\n+lgwiH9BU9mktigAGASvkbllpt+YbUbWnuYAvpHBGiP1qZtfX2r96UrSJaGO9BEzT\n+Gp9ThnSjoj4Srul0+s/NArU22irFLmDzbalgevAmm9gMGkdqkiIm/mXbwrPj0ncl\n+KGicevXryVpvaP62eZ8cc3C4p97frMmXxRX8sTdQpD/gRI7prdEILRSKveqT+AEW\n+7rFGM5AOevb4U8ddop8A3D/kX0wcCAIBF6jCNk3uEJ57jVcagL04kPnVfdRiedTS\n+vfq1DRNcD29d1H/9u0fHdSn1/+8Ep3X+afQ3C6//5NvOEaXcIGO4QSwkprQydfv8\n+-----END CERTIFICATE-----"
            },
            {
                "sha": "7a8dbc719fb71e783222998bd6a0319f89b9ea5e",
                "filename": "test/recipes/25-test_eai_data/kdc.sh",
                "status": "added",
                "additions": 41,
                "deletions": 0,
                "changes": 41,
                "blob_url": "https://github.com/openssl/openssl/blob/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh",
                "raw_url": "https://github.com/openssl/openssl/raw/7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh?ref=7dfcee2cd2a63b2c64b9b4b0850be64cb695b0a0",
                "patch": "@@ -0,0 +1,41 @@\n+#! /usr/bin/env bash\n+\n+# Create a root CA, signing a leaf cert with a KDC principal otherName SAN, and\n+# also a non-UTF8 smtpUtf8Mailbox SAN followed by an rfc822Name SAN and a DNS\n+# name SAN.  In the vulnerable EAI code, the KDC principal `otherName` should\n+# trigger ASAN errors in DNS name checks, while the non-UTF8 `smtpUtf8Mailbox`\n+# should likewise lead to ASAN issues with email name checks.\n+\n+rm -f root-key.pem root-cert.pem\n+openssl req -nodes -new -newkey rsa:2048 -keyout kdc-root-key.pem \\\n+        -x509 -subj /CN=Root -days 36524 -out kdc-root-cert.pem\n+\n+exts=$(\n+    printf \"%s\\n%s\\n%s\\n%s = \" \\\n+        \"subjectKeyIdentifier = hash\" \\\n+        \"authorityKeyIdentifier = keyid\" \\\n+        \"basicConstraints = CA:false\" \\\n+        \"subjectAltName\"\n+    printf \"%s, \" \"otherName:1.3.6.1.5.2.2;SEQUENCE:kdc_princ_name\"\n+    printf \"%s, \" \"otherName:1.3.6.1.5.5.7.8.9;IA5:moe@example.com\"\n+    printf \"%s, \" \"email:joe@example.com\"\n+    printf \"%s\\n\" \"DNS:mx1.example.com\"\n+    printf \"[kdc_princ_name]\\n\"\n+    printf \"realm = EXP:0, GeneralString:TEST.EXAMPLE\\n\"\n+    printf \"principal_name = EXP:1, SEQUENCE:kdc_principal_seq\\n\"\n+    printf \"[kdc_principal_seq]\\n\"\n+    printf \"name_type = EXP:0, INTEGER:1\\n\"\n+    printf \"name_string = EXP:1, SEQUENCE:kdc_principal_components\\n\"\n+    printf \"[kdc_principal_components]\\n\"\n+    printf \"princ1 = GeneralString:krbtgt\\n\"\n+    printf \"princ2 = GeneralString:TEST.EXAMPLE\\n\"\n+    )\n+\n+printf \"%s\\n\" \"$exts\"\n+\n+openssl req -nodes -new -newkey rsa:2048 -keyout kdc-key.pem \\\n+    -subj \"/CN=TEST.EXAMPLE\" |\n+    openssl x509 -req -out kdc-cert.pem \\\n+        -CA \"kdc-root-cert.pem\" -CAkey \"kdc-root-key.pem\" \\\n+        -set_serial 2 -days 36524 \\\n+        -extfile <(printf \"%s\\n\" \"$exts\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openssl/openssl/commits/621f3729831b05ee828a3203eddb621d014ff2b2",
        "url": "https://api.github.com/repos/openssl/openssl/commits/621f3729831b05ee828a3203eddb621d014ff2b2",
        "html_url": "https://github.com/openssl/openssl/commit/621f3729831b05ee828a3203eddb621d014ff2b2",
        "message": "Avoid type errors in EAI-related name check logic.\n\nThe incorrectly typed data is read only, used in a compare operation, so\nneither remote code execution, nor memory content disclosure were possible.\nHowever, applications performing certificate name checks were vulnerable to\ndenial of service.\n\nThe GENERAL_TYPE data type is a union, and we must take care to access the\ncorrect member, based on `gen->type`, not all the member fields have the same\nstructure, and a segfault is possible if the wrong member field is read.\n\nThe code in question was lightly refactored with the intent to make it more\nobviously correct.\n\nFixes CVE-2024-6119\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Tomas Mraz <tomas@openssl.org>\n(cherry picked from commit 0890cd13d40fbc98f655f3974f466769caa83680)",
        "files": [
            {
                "sha": "080f1275434fc9c268470bb92a952291b1f46b35",
                "filename": "crypto/x509/v3_utl.c",
                "status": "modified",
                "additions": 53,
                "deletions": 25,
                "changes": 78,
                "blob_url": "https://github.com/openssl/openssl/blob/621f3729831b05ee828a3203eddb621d014ff2b2/crypto%2Fx509%2Fv3_utl.c",
                "raw_url": "https://github.com/openssl/openssl/raw/621f3729831b05ee828a3203eddb621d014ff2b2/crypto%2Fx509%2Fv3_utl.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/crypto%2Fx509%2Fv3_utl.c?ref=621f3729831b05ee828a3203eddb621d014ff2b2",
                "patch": "@@ -916,36 +916,64 @@ static int do_x509_check(X509 *x, const char *chk, size_t chklen,\n             ASN1_STRING *cstr;\n \n             gen = sk_GENERAL_NAME_value(gens, i);\n-            if ((gen->type == GEN_OTHERNAME) && (check_type == GEN_EMAIL)) {\n-                if (OBJ_obj2nid(gen->d.otherName->type_id) ==\n-                    NID_id_on_SmtpUTF8Mailbox) {\n-                    san_present = 1;\n-\n-                    /*\n-                     * If it is not a UTF8String then that is unexpected and we\n-                     * treat it as no match\n-                     */\n-                    if (gen->d.otherName->value->type == V_ASN1_UTF8STRING) {\n-                        cstr = gen->d.otherName->value->value.utf8string;\n-\n-                        /* Positive on success, negative on error! */\n-                        if ((rv = do_check_string(cstr, 0, equal, flags,\n-                                                chk, chklen, peername)) != 0)\n-                            break;\n-                    }\n-                } else\n+            switch (gen->type) {\n+            default:\n+                continue;\n+            case GEN_OTHERNAME:\n+\t\tswitch (OBJ_obj2nid(gen->d.otherName->type_id)) {\n+                default:\n                     continue;\n-            } else {\n-                if ((gen->type != check_type) && (gen->type != GEN_OTHERNAME))\n+                case NID_id_on_SmtpUTF8Mailbox:\n+                    /*-\n+                     * https://datatracker.ietf.org/doc/html/rfc8398#section-3\n+                     *\n+                     *   Due to name constraint compatibility reasons described\n+                     *   in Section 6, SmtpUTF8Mailbox subjectAltName MUST NOT\n+                     *   be used unless the local-part of the email address\n+                     *   contains non-ASCII characters. When the local-part is\n+                     *   ASCII, rfc822Name subjectAltName MUST be used instead\n+                     *   of SmtpUTF8Mailbox. This is compatible with legacy\n+                     *   software that supports only rfc822Name (and not\n+                     *   SmtpUTF8Mailbox). [...]\n+                     *\n+                     *   SmtpUTF8Mailbox is encoded as UTF8String.\n+                     *\n+                     * If it is not a UTF8String then that is unexpected, and\n+                     * we ignore the invalid SAN (neither set san_present nor\n+                     * consider it a candidate for equality).  This does mean\n+                     * that the subject CN may be considered, as would be the\n+                     * case when the malformed SmtpUtf8Mailbox SAN is instead\n+                     * simply absent.\n+                     *\n+                     * When CN-ID matching is not desirable, applications can\n+                     * choose to turn it off, doing so is at this time a best\n+                     * practice.\n+                     */\n+                    if (check_type != GEN_EMAIL\n+                        || gen->d.otherName->value->type != V_ASN1_UTF8STRING)\n+                        continue;\n+                    alt_type = 0;\n+                    cstr = gen->d.otherName->value->value.utf8string;\n+                    break;\n+                }\n+                break;\n+            case GEN_EMAIL:\n+                if (check_type != GEN_EMAIL)\n                     continue;\n-            }\n-            san_present = 1;\n-            if (check_type == GEN_EMAIL)\n                 cstr = gen->d.rfc822Name;\n-            else if (check_type == GEN_DNS)\n+                break;\n+            case GEN_DNS:\n+                if (check_type != GEN_DNS)\n+                    continue;\n                 cstr = gen->d.dNSName;\n-            else\n+                break;\n+            case GEN_IPADD:\n+                if (check_type != GEN_IPADD)\n+                    continue;\n                 cstr = gen->d.iPAddress;\n+                break;\n+            }\n+            san_present = 1;\n             /* Positive on success, negative on error! */\n             if ((rv = do_check_string(cstr, alt_type, equal, flags,\n                                       chk, chklen, peername)) != 0)"
            },
            {
                "sha": "e18735d89aadf7ab41bfc71bea6dc5b3907f6c1d",
                "filename": "test/recipes/25-test_eai_data.t",
                "status": "modified",
                "additions": 11,
                "deletions": 1,
                "changes": 12,
                "blob_url": "https://github.com/openssl/openssl/blob/621f3729831b05ee828a3203eddb621d014ff2b2/test%2Frecipes%2F25-test_eai_data.t",
                "raw_url": "https://github.com/openssl/openssl/raw/621f3729831b05ee828a3203eddb621d014ff2b2/test%2Frecipes%2F25-test_eai_data.t",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data.t?ref=621f3729831b05ee828a3203eddb621d014ff2b2",
                "patch": "@@ -21,16 +21,18 @@ setup(\"test_eai_data\");\n #./util/wrap.pl apps/openssl verify -nameopt utf8 -no_check_time -CAfile test/recipes/25-test_eai_data/utf8_chain.pem test/recipes/25-test_eai_data/ascii_leaf.pem\n #./util/wrap.pl apps/openssl verify -nameopt utf8 -no_check_time -CAfile test/recipes/25-test_eai_data/ascii_chain.pem test/recipes/25-test_eai_data/utf8_leaf.pem\n \n-plan tests => 12;\n+plan tests => 16;\n \n require_ok(srctop_file('test','recipes','tconversion.pl'));\n my $folder = \"test/recipes/25-test_eai_data\";\n \n my $ascii_pem = srctop_file($folder, \"ascii_leaf.pem\");\n my $utf8_pem  = srctop_file($folder, \"utf8_leaf.pem\");\n+my $kdc_pem   = srctop_file($folder, \"kdc-cert.pem\");\n \n my $ascii_chain_pem = srctop_file($folder, \"ascii_chain.pem\");\n my $utf8_chain_pem  = srctop_file($folder, \"utf8_chain.pem\");\n+my $kdc_chain_pem  = srctop_file($folder, \"kdc-root-cert.pem\");\n \n my $out;\n my $outcnt = 0;\n@@ -56,10 +58,18 @@ SKIP: {\n \n ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $ascii_chain_pem, $ascii_pem])));\n ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $utf8_chain_pem, $utf8_pem])));\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $kdc_chain_pem, $kdc_pem])));\n \n ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $ascii_chain_pem, $utf8_pem])));\n ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $utf8_chain_pem,  $ascii_pem])));\n \n+# Check an otherName does not get misparsed as an DNS name, (should trigger ASAN errors if violated).\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_hostname\", 'mx1.example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+# Check an otherName does not get misparsed as an email address, (should trigger ASAN errors if violated).\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_email\", 'joe@example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+# We expect SmtpUTF8Mailbox to be a UTF8 String, not an IA5String.\n+ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_email\", 'moe@example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+\n #Check that we get the expected failure return code\n with({ exit_checker => sub { return shift == 2; } },\n      sub {"
            },
            {
                "sha": "e8a2c6f55d45985e3b57597e049fe31f031a34f2",
                "filename": "test/recipes/25-test_eai_data/kdc-cert.pem",
                "status": "added",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/openssl/openssl/blob/621f3729831b05ee828a3203eddb621d014ff2b2/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem",
                "raw_url": "https://github.com/openssl/openssl/raw/621f3729831b05ee828a3203eddb621d014ff2b2/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem?ref=621f3729831b05ee828a3203eddb621d014ff2b2",
                "patch": "@@ -0,0 +1,21 @@\n+-----BEGIN CERTIFICATE-----\n+MIIDbDCCAlSgAwIBAgIBAjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDARSb290\n+MCAXDTI0MDYyMDA2MTQxNVoYDzIxMjQwNjIwMDYxNDE1WjAXMRUwEwYDVQQDDAxU\n+RVNULkVYQU1QTEUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC6wfP+\n+6go79dkpo/dGLMlPZ7Gw/Q6gUYrCWZWUEgEeRVHCrqOlgUEyA+PcWas/XDPUxXry\n+BQlJHLvlqamAQn8gs4QPBARFYWKNiTVGyaRkgNA1N5gqyZdrP9UE+ZJmdqxRAAe8\n+vvpGZWSgevPhLUiSCFYDiD0Rtji2Hm3rGUrReQFBQDEw2pNGwz9zIaxUs08kQZcx\n+Yzyiplz5Oau+R/6sAgUwDlrD9xOlUxx/tA/MSDIfkK8qioU11uUZtO5VjkNQy/bT\n+7zQMmXxWgm2MIgOs1u4YN7YGOtgqHE9v9iPHHfgrkbQDtVDGQsa8AQEhkUDSCtW9\n+3VFAKx6dGNXYzFwfAgMBAAGjgcgwgcUwHQYDVR0OBBYEFFR5tZycW19DmtbL4Zqj\n+te1c2vZLMAkGA1UdIwQCMAAwCQYDVR0TBAIwADCBjQYDVR0RBIGFMIGCoD8GBisG\n+AQUCAqA1MDOgDhsMVEVTVC5FWEFNUExFoSEwH6ADAgEBoRgwFhsGa3JidGd0GwxU\n+RVNULkVYQU1QTEWgHQYIKwYBBQUHCAmgERYPbW9lQGV4YW1wbGUuY29tgQ9qb2VA\n+ZXhhbXBsZS5jb22CD214MS5leGFtcGxlLmNvbTANBgkqhkiG9w0BAQsFAAOCAQEA\n+T0xzVtVpRtaOzIhgzw7XQUdzWD5UEGSJJ1cBCOmKUWwDLTAouCYLFB4TbEE7MMUb\n+iuMy60bjmVtvfJIXorGUgSadRe5RWJ5DamJWvPA0Q9x7blnEcXqEF+9Td+ypevgU\n+UYHFmg83OYwxOsFXZ5cRuXMk3WCsDHQIBi6D1L6oDDZ2pfArs5mqm3thQKVlqyl1\n+El3XRYEdqAz/5eCOFNfwxF0ALxjxVr/Z50StUZU8I7Zfev6+kHhyrR7dqzYJImv9\n+0fTCOBEMjIETDsrA70OxAMu4V16nrWZdJdvzblS2qrt97Omkj+2kiPAJFB76RpwI\n+oDQ9fKfUOAmUFth2/R/eGA==\n+-----END CERTIFICATE-----"
            },
            {
                "sha": "a74c96bf31469f671c82109e1496d7546fb388fd",
                "filename": "test/recipes/25-test_eai_data/kdc-root-cert.pem",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/openssl/openssl/blob/621f3729831b05ee828a3203eddb621d014ff2b2/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem",
                "raw_url": "https://github.com/openssl/openssl/raw/621f3729831b05ee828a3203eddb621d014ff2b2/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem?ref=621f3729831b05ee828a3203eddb621d014ff2b2",
                "patch": "@@ -0,0 +1,16 @@\n+-----BEGIN CERTIFICATE-----\n+MIICnDCCAYQCCQCBswYcrlZSHjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDARS\n+b290MCAXDTI0MDYyMDA2MTQxNVoYDzIxMjQwNjIwMDYxNDE1WjAPMQ0wCwYDVQQD\n+DARSb290MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqRj8S4kBbIUj\n+61kZfi6nE35Q38U140+qt4uAiwAhKumfVHlBM0zQ98WFt5zMHIBQwIb3yjc2zj+0\n+qzUnQfwm1r/RfcMmBPEti9Ge+aEMSsds2gMXziOFM8wd2aAFPy7UVE0XpEWofsRK\n+MGi61MKVdPSbGIxBwY9VW38/7D/wf1HtJe7y0xpuecR7GB2XAs+qST59NjuF+7wS\n+dLM8Hb3TATgeYbXXWsRJgwz+SPzExg5WmLnU+7y4brZ32dHtdSmkRVSgSlaIf7Xj\n+3Tc6Zi7I+W/JYk7hy1zUexVdWCak4PHcoWrXe0gNNN/t8VfLfMExt5z/HIylXnU7\n+pGUyqZlTGQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQAHpLF1UCRy7b6Hk0rLokxI\n+lgwiH9BU9mktigAGASvkbllpt+YbUbWnuYAvpHBGiP1qZtfX2r96UrSJaGO9BEzT\n+Gp9ThnSjoj4Srul0+s/NArU22irFLmDzbalgevAmm9gMGkdqkiIm/mXbwrPj0ncl\n+KGicevXryVpvaP62eZ8cc3C4p97frMmXxRX8sTdQpD/gRI7prdEILRSKveqT+AEW\n+7rFGM5AOevb4U8ddop8A3D/kX0wcCAIBF6jCNk3uEJ57jVcagL04kPnVfdRiedTS\n+vfq1DRNcD29d1H/9u0fHdSn1/+8Ep3X+afQ3C6//5NvOEaXcIGO4QSwkprQydfv8\n+-----END CERTIFICATE-----"
            },
            {
                "sha": "7a8dbc719fb71e783222998bd6a0319f89b9ea5e",
                "filename": "test/recipes/25-test_eai_data/kdc.sh",
                "status": "added",
                "additions": 41,
                "deletions": 0,
                "changes": 41,
                "blob_url": "https://github.com/openssl/openssl/blob/621f3729831b05ee828a3203eddb621d014ff2b2/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh",
                "raw_url": "https://github.com/openssl/openssl/raw/621f3729831b05ee828a3203eddb621d014ff2b2/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh?ref=621f3729831b05ee828a3203eddb621d014ff2b2",
                "patch": "@@ -0,0 +1,41 @@\n+#! /usr/bin/env bash\n+\n+# Create a root CA, signing a leaf cert with a KDC principal otherName SAN, and\n+# also a non-UTF8 smtpUtf8Mailbox SAN followed by an rfc822Name SAN and a DNS\n+# name SAN.  In the vulnerable EAI code, the KDC principal `otherName` should\n+# trigger ASAN errors in DNS name checks, while the non-UTF8 `smtpUtf8Mailbox`\n+# should likewise lead to ASAN issues with email name checks.\n+\n+rm -f root-key.pem root-cert.pem\n+openssl req -nodes -new -newkey rsa:2048 -keyout kdc-root-key.pem \\\n+        -x509 -subj /CN=Root -days 36524 -out kdc-root-cert.pem\n+\n+exts=$(\n+    printf \"%s\\n%s\\n%s\\n%s = \" \\\n+        \"subjectKeyIdentifier = hash\" \\\n+        \"authorityKeyIdentifier = keyid\" \\\n+        \"basicConstraints = CA:false\" \\\n+        \"subjectAltName\"\n+    printf \"%s, \" \"otherName:1.3.6.1.5.2.2;SEQUENCE:kdc_princ_name\"\n+    printf \"%s, \" \"otherName:1.3.6.1.5.5.7.8.9;IA5:moe@example.com\"\n+    printf \"%s, \" \"email:joe@example.com\"\n+    printf \"%s\\n\" \"DNS:mx1.example.com\"\n+    printf \"[kdc_princ_name]\\n\"\n+    printf \"realm = EXP:0, GeneralString:TEST.EXAMPLE\\n\"\n+    printf \"principal_name = EXP:1, SEQUENCE:kdc_principal_seq\\n\"\n+    printf \"[kdc_principal_seq]\\n\"\n+    printf \"name_type = EXP:0, INTEGER:1\\n\"\n+    printf \"name_string = EXP:1, SEQUENCE:kdc_principal_components\\n\"\n+    printf \"[kdc_principal_components]\\n\"\n+    printf \"princ1 = GeneralString:krbtgt\\n\"\n+    printf \"princ2 = GeneralString:TEST.EXAMPLE\\n\"\n+    )\n+\n+printf \"%s\\n\" \"$exts\"\n+\n+openssl req -nodes -new -newkey rsa:2048 -keyout kdc-key.pem \\\n+    -subj \"/CN=TEST.EXAMPLE\" |\n+    openssl x509 -req -out kdc-cert.pem \\\n+        -CA \"kdc-root-cert.pem\" -CAkey \"kdc-root-key.pem\" \\\n+        -set_serial 2 -days 36524 \\\n+        -extfile <(printf \"%s\\n\" \"$exts\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openssl/openssl/commits/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6",
        "url": "https://api.github.com/repos/openssl/openssl/commits/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6",
        "html_url": "https://github.com/openssl/openssl/commit/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6",
        "message": "Avoid type errors in EAI-related name check logic.\n\nThe incorrectly typed data is read only, used in a compare operation, so\nneither remote code execution, nor memory content disclosure were possible.\nHowever, applications performing certificate name checks were vulnerable to\ndenial of service.\n\nThe GENERAL_TYPE data type is a union, and we must take care to access the\ncorrect member, based on `gen->type`, not all the member fields have the same\nstructure, and a segfault is possible if the wrong member field is read.\n\nThe code in question was lightly refactored with the intent to make it more\nobviously correct.\n\nFixes CVE-2024-6119\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Tomas Mraz <tomas@openssl.org>\n(cherry picked from commit 0890cd13d40fbc98f655f3974f466769caa83680)",
        "files": [
            {
                "sha": "304463d572c635fd93c6d475e60215bf9fb89e87",
                "filename": "crypto/x509/v3_utl.c",
                "status": "modified",
                "additions": 53,
                "deletions": 25,
                "changes": 78,
                "blob_url": "https://github.com/openssl/openssl/blob/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/crypto%2Fx509%2Fv3_utl.c",
                "raw_url": "https://github.com/openssl/openssl/raw/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/crypto%2Fx509%2Fv3_utl.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/crypto%2Fx509%2Fv3_utl.c?ref=06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6",
                "patch": "@@ -916,36 +916,64 @@ static int do_x509_check(X509 *x, const char *chk, size_t chklen,\n             ASN1_STRING *cstr;\n \n             gen = sk_GENERAL_NAME_value(gens, i);\n-            if ((gen->type == GEN_OTHERNAME) && (check_type == GEN_EMAIL)) {\n-                if (OBJ_obj2nid(gen->d.otherName->type_id) ==\n-                    NID_id_on_SmtpUTF8Mailbox) {\n-                    san_present = 1;\n-\n-                    /*\n-                     * If it is not a UTF8String then that is unexpected and we\n-                     * treat it as no match\n-                     */\n-                    if (gen->d.otherName->value->type == V_ASN1_UTF8STRING) {\n-                        cstr = gen->d.otherName->value->value.utf8string;\n-\n-                        /* Positive on success, negative on error! */\n-                        if ((rv = do_check_string(cstr, 0, equal, flags,\n-                                                chk, chklen, peername)) != 0)\n-                            break;\n-                    }\n-                } else\n+            switch (gen->type) {\n+            default:\n+                continue;\n+            case GEN_OTHERNAME:\n+\t\tswitch (OBJ_obj2nid(gen->d.otherName->type_id)) {\n+                default:\n                     continue;\n-            } else {\n-                if ((gen->type != check_type) && (gen->type != GEN_OTHERNAME))\n+                case NID_id_on_SmtpUTF8Mailbox:\n+                    /*-\n+                     * https://datatracker.ietf.org/doc/html/rfc8398#section-3\n+                     *\n+                     *   Due to name constraint compatibility reasons described\n+                     *   in Section 6, SmtpUTF8Mailbox subjectAltName MUST NOT\n+                     *   be used unless the local-part of the email address\n+                     *   contains non-ASCII characters. When the local-part is\n+                     *   ASCII, rfc822Name subjectAltName MUST be used instead\n+                     *   of SmtpUTF8Mailbox. This is compatible with legacy\n+                     *   software that supports only rfc822Name (and not\n+                     *   SmtpUTF8Mailbox). [...]\n+                     *\n+                     *   SmtpUTF8Mailbox is encoded as UTF8String.\n+                     *\n+                     * If it is not a UTF8String then that is unexpected, and\n+                     * we ignore the invalid SAN (neither set san_present nor\n+                     * consider it a candidate for equality).  This does mean\n+                     * that the subject CN may be considered, as would be the\n+                     * case when the malformed SmtpUtf8Mailbox SAN is instead\n+                     * simply absent.\n+                     *\n+                     * When CN-ID matching is not desirable, applications can\n+                     * choose to turn it off, doing so is at this time a best\n+                     * practice.\n+                     */\n+                    if (check_type != GEN_EMAIL\n+                        || gen->d.otherName->value->type != V_ASN1_UTF8STRING)\n+                        continue;\n+                    alt_type = 0;\n+                    cstr = gen->d.otherName->value->value.utf8string;\n+                    break;\n+                }\n+                break;\n+            case GEN_EMAIL:\n+                if (check_type != GEN_EMAIL)\n                     continue;\n-            }\n-            san_present = 1;\n-            if (check_type == GEN_EMAIL)\n                 cstr = gen->d.rfc822Name;\n-            else if (check_type == GEN_DNS)\n+                break;\n+            case GEN_DNS:\n+                if (check_type != GEN_DNS)\n+                    continue;\n                 cstr = gen->d.dNSName;\n-            else\n+                break;\n+            case GEN_IPADD:\n+                if (check_type != GEN_IPADD)\n+                    continue;\n                 cstr = gen->d.iPAddress;\n+                break;\n+            }\n+            san_present = 1;\n             /* Positive on success, negative on error! */\n             if ((rv = do_check_string(cstr, alt_type, equal, flags,\n                                       chk, chklen, peername)) != 0)"
            },
            {
                "sha": "e18735d89aadf7ab41bfc71bea6dc5b3907f6c1d",
                "filename": "test/recipes/25-test_eai_data.t",
                "status": "modified",
                "additions": 11,
                "deletions": 1,
                "changes": 12,
                "blob_url": "https://github.com/openssl/openssl/blob/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/test%2Frecipes%2F25-test_eai_data.t",
                "raw_url": "https://github.com/openssl/openssl/raw/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/test%2Frecipes%2F25-test_eai_data.t",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data.t?ref=06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6",
                "patch": "@@ -21,16 +21,18 @@ setup(\"test_eai_data\");\n #./util/wrap.pl apps/openssl verify -nameopt utf8 -no_check_time -CAfile test/recipes/25-test_eai_data/utf8_chain.pem test/recipes/25-test_eai_data/ascii_leaf.pem\n #./util/wrap.pl apps/openssl verify -nameopt utf8 -no_check_time -CAfile test/recipes/25-test_eai_data/ascii_chain.pem test/recipes/25-test_eai_data/utf8_leaf.pem\n \n-plan tests => 12;\n+plan tests => 16;\n \n require_ok(srctop_file('test','recipes','tconversion.pl'));\n my $folder = \"test/recipes/25-test_eai_data\";\n \n my $ascii_pem = srctop_file($folder, \"ascii_leaf.pem\");\n my $utf8_pem  = srctop_file($folder, \"utf8_leaf.pem\");\n+my $kdc_pem   = srctop_file($folder, \"kdc-cert.pem\");\n \n my $ascii_chain_pem = srctop_file($folder, \"ascii_chain.pem\");\n my $utf8_chain_pem  = srctop_file($folder, \"utf8_chain.pem\");\n+my $kdc_chain_pem  = srctop_file($folder, \"kdc-root-cert.pem\");\n \n my $out;\n my $outcnt = 0;\n@@ -56,10 +58,18 @@ SKIP: {\n \n ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $ascii_chain_pem, $ascii_pem])));\n ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $utf8_chain_pem, $utf8_pem])));\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $kdc_chain_pem, $kdc_pem])));\n \n ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $ascii_chain_pem, $utf8_pem])));\n ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $utf8_chain_pem,  $ascii_pem])));\n \n+# Check an otherName does not get misparsed as an DNS name, (should trigger ASAN errors if violated).\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_hostname\", 'mx1.example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+# Check an otherName does not get misparsed as an email address, (should trigger ASAN errors if violated).\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_email\", 'joe@example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+# We expect SmtpUTF8Mailbox to be a UTF8 String, not an IA5String.\n+ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_email\", 'moe@example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+\n #Check that we get the expected failure return code\n with({ exit_checker => sub { return shift == 2; } },\n      sub {"
            },
            {
                "sha": "e8a2c6f55d45985e3b57597e049fe31f031a34f2",
                "filename": "test/recipes/25-test_eai_data/kdc-cert.pem",
                "status": "added",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/openssl/openssl/blob/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem",
                "raw_url": "https://github.com/openssl/openssl/raw/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem?ref=06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6",
                "patch": "@@ -0,0 +1,21 @@\n+-----BEGIN CERTIFICATE-----\n+MIIDbDCCAlSgAwIBAgIBAjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDARSb290\n+MCAXDTI0MDYyMDA2MTQxNVoYDzIxMjQwNjIwMDYxNDE1WjAXMRUwEwYDVQQDDAxU\n+RVNULkVYQU1QTEUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC6wfP+\n+6go79dkpo/dGLMlPZ7Gw/Q6gUYrCWZWUEgEeRVHCrqOlgUEyA+PcWas/XDPUxXry\n+BQlJHLvlqamAQn8gs4QPBARFYWKNiTVGyaRkgNA1N5gqyZdrP9UE+ZJmdqxRAAe8\n+vvpGZWSgevPhLUiSCFYDiD0Rtji2Hm3rGUrReQFBQDEw2pNGwz9zIaxUs08kQZcx\n+Yzyiplz5Oau+R/6sAgUwDlrD9xOlUxx/tA/MSDIfkK8qioU11uUZtO5VjkNQy/bT\n+7zQMmXxWgm2MIgOs1u4YN7YGOtgqHE9v9iPHHfgrkbQDtVDGQsa8AQEhkUDSCtW9\n+3VFAKx6dGNXYzFwfAgMBAAGjgcgwgcUwHQYDVR0OBBYEFFR5tZycW19DmtbL4Zqj\n+te1c2vZLMAkGA1UdIwQCMAAwCQYDVR0TBAIwADCBjQYDVR0RBIGFMIGCoD8GBisG\n+AQUCAqA1MDOgDhsMVEVTVC5FWEFNUExFoSEwH6ADAgEBoRgwFhsGa3JidGd0GwxU\n+RVNULkVYQU1QTEWgHQYIKwYBBQUHCAmgERYPbW9lQGV4YW1wbGUuY29tgQ9qb2VA\n+ZXhhbXBsZS5jb22CD214MS5leGFtcGxlLmNvbTANBgkqhkiG9w0BAQsFAAOCAQEA\n+T0xzVtVpRtaOzIhgzw7XQUdzWD5UEGSJJ1cBCOmKUWwDLTAouCYLFB4TbEE7MMUb\n+iuMy60bjmVtvfJIXorGUgSadRe5RWJ5DamJWvPA0Q9x7blnEcXqEF+9Td+ypevgU\n+UYHFmg83OYwxOsFXZ5cRuXMk3WCsDHQIBi6D1L6oDDZ2pfArs5mqm3thQKVlqyl1\n+El3XRYEdqAz/5eCOFNfwxF0ALxjxVr/Z50StUZU8I7Zfev6+kHhyrR7dqzYJImv9\n+0fTCOBEMjIETDsrA70OxAMu4V16nrWZdJdvzblS2qrt97Omkj+2kiPAJFB76RpwI\n+oDQ9fKfUOAmUFth2/R/eGA==\n+-----END CERTIFICATE-----"
            },
            {
                "sha": "a74c96bf31469f671c82109e1496d7546fb388fd",
                "filename": "test/recipes/25-test_eai_data/kdc-root-cert.pem",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/openssl/openssl/blob/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem",
                "raw_url": "https://github.com/openssl/openssl/raw/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem?ref=06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6",
                "patch": "@@ -0,0 +1,16 @@\n+-----BEGIN CERTIFICATE-----\n+MIICnDCCAYQCCQCBswYcrlZSHjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDARS\n+b290MCAXDTI0MDYyMDA2MTQxNVoYDzIxMjQwNjIwMDYxNDE1WjAPMQ0wCwYDVQQD\n+DARSb290MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqRj8S4kBbIUj\n+61kZfi6nE35Q38U140+qt4uAiwAhKumfVHlBM0zQ98WFt5zMHIBQwIb3yjc2zj+0\n+qzUnQfwm1r/RfcMmBPEti9Ge+aEMSsds2gMXziOFM8wd2aAFPy7UVE0XpEWofsRK\n+MGi61MKVdPSbGIxBwY9VW38/7D/wf1HtJe7y0xpuecR7GB2XAs+qST59NjuF+7wS\n+dLM8Hb3TATgeYbXXWsRJgwz+SPzExg5WmLnU+7y4brZ32dHtdSmkRVSgSlaIf7Xj\n+3Tc6Zi7I+W/JYk7hy1zUexVdWCak4PHcoWrXe0gNNN/t8VfLfMExt5z/HIylXnU7\n+pGUyqZlTGQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQAHpLF1UCRy7b6Hk0rLokxI\n+lgwiH9BU9mktigAGASvkbllpt+YbUbWnuYAvpHBGiP1qZtfX2r96UrSJaGO9BEzT\n+Gp9ThnSjoj4Srul0+s/NArU22irFLmDzbalgevAmm9gMGkdqkiIm/mXbwrPj0ncl\n+KGicevXryVpvaP62eZ8cc3C4p97frMmXxRX8sTdQpD/gRI7prdEILRSKveqT+AEW\n+7rFGM5AOevb4U8ddop8A3D/kX0wcCAIBF6jCNk3uEJ57jVcagL04kPnVfdRiedTS\n+vfq1DRNcD29d1H/9u0fHdSn1/+8Ep3X+afQ3C6//5NvOEaXcIGO4QSwkprQydfv8\n+-----END CERTIFICATE-----"
            },
            {
                "sha": "7a8dbc719fb71e783222998bd6a0319f89b9ea5e",
                "filename": "test/recipes/25-test_eai_data/kdc.sh",
                "status": "added",
                "additions": 41,
                "deletions": 0,
                "changes": 41,
                "blob_url": "https://github.com/openssl/openssl/blob/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh",
                "raw_url": "https://github.com/openssl/openssl/raw/06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh?ref=06d1dc3fa96a2ba5a3e22735a033012aadc9f0d6",
                "patch": "@@ -0,0 +1,41 @@\n+#! /usr/bin/env bash\n+\n+# Create a root CA, signing a leaf cert with a KDC principal otherName SAN, and\n+# also a non-UTF8 smtpUtf8Mailbox SAN followed by an rfc822Name SAN and a DNS\n+# name SAN.  In the vulnerable EAI code, the KDC principal `otherName` should\n+# trigger ASAN errors in DNS name checks, while the non-UTF8 `smtpUtf8Mailbox`\n+# should likewise lead to ASAN issues with email name checks.\n+\n+rm -f root-key.pem root-cert.pem\n+openssl req -nodes -new -newkey rsa:2048 -keyout kdc-root-key.pem \\\n+        -x509 -subj /CN=Root -days 36524 -out kdc-root-cert.pem\n+\n+exts=$(\n+    printf \"%s\\n%s\\n%s\\n%s = \" \\\n+        \"subjectKeyIdentifier = hash\" \\\n+        \"authorityKeyIdentifier = keyid\" \\\n+        \"basicConstraints = CA:false\" \\\n+        \"subjectAltName\"\n+    printf \"%s, \" \"otherName:1.3.6.1.5.2.2;SEQUENCE:kdc_princ_name\"\n+    printf \"%s, \" \"otherName:1.3.6.1.5.5.7.8.9;IA5:moe@example.com\"\n+    printf \"%s, \" \"email:joe@example.com\"\n+    printf \"%s\\n\" \"DNS:mx1.example.com\"\n+    printf \"[kdc_princ_name]\\n\"\n+    printf \"realm = EXP:0, GeneralString:TEST.EXAMPLE\\n\"\n+    printf \"principal_name = EXP:1, SEQUENCE:kdc_principal_seq\\n\"\n+    printf \"[kdc_principal_seq]\\n\"\n+    printf \"name_type = EXP:0, INTEGER:1\\n\"\n+    printf \"name_string = EXP:1, SEQUENCE:kdc_principal_components\\n\"\n+    printf \"[kdc_principal_components]\\n\"\n+    printf \"princ1 = GeneralString:krbtgt\\n\"\n+    printf \"princ2 = GeneralString:TEST.EXAMPLE\\n\"\n+    )\n+\n+printf \"%s\\n\" \"$exts\"\n+\n+openssl req -nodes -new -newkey rsa:2048 -keyout kdc-key.pem \\\n+    -subj \"/CN=TEST.EXAMPLE\" |\n+    openssl x509 -req -out kdc-cert.pem \\\n+        -CA \"kdc-root-cert.pem\" -CAkey \"kdc-root-key.pem\" \\\n+        -set_serial 2 -days 36524 \\\n+        -extfile <(printf \"%s\\n\" \"$exts\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openssl/openssl/commits/05f360d9e849a1b277db628f1f13083a7f8dd04f",
        "url": "https://api.github.com/repos/openssl/openssl/commits/05f360d9e849a1b277db628f1f13083a7f8dd04f",
        "html_url": "https://github.com/openssl/openssl/commit/05f360d9e849a1b277db628f1f13083a7f8dd04f",
        "message": "Avoid type errors in EAI-related name check logic.\n\nThe incorrectly typed data is read only, used in a compare operation, so\nneither remote code execution, nor memory content disclosure were possible.\nHowever, applications performing certificate name checks were vulnerable to\ndenial of service.\n\nThe GENERAL_TYPE data type is a union, and we must take care to access the\ncorrect member, based on `gen->type`, not all the member fields have the same\nstructure, and a segfault is possible if the wrong member field is read.\n\nThe code in question was lightly refactored with the intent to make it more\nobviously correct.\n\nFixes CVE-2024-6119\n\nReviewed-by: Richard Levitte <levitte@openssl.org>\nReviewed-by: Tomas Mraz <tomas@openssl.org>\n(cherry picked from commit 0890cd13d40fbc98f655f3974f466769caa83680)",
        "files": [
            {
                "sha": "a09414c972fa8cfa76afd9deea49c10401c7d7c3",
                "filename": "crypto/x509/v3_utl.c",
                "status": "modified",
                "additions": 53,
                "deletions": 25,
                "changes": 78,
                "blob_url": "https://github.com/openssl/openssl/blob/05f360d9e849a1b277db628f1f13083a7f8dd04f/crypto%2Fx509%2Fv3_utl.c",
                "raw_url": "https://github.com/openssl/openssl/raw/05f360d9e849a1b277db628f1f13083a7f8dd04f/crypto%2Fx509%2Fv3_utl.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/crypto%2Fx509%2Fv3_utl.c?ref=05f360d9e849a1b277db628f1f13083a7f8dd04f",
                "patch": "@@ -916,36 +916,64 @@ static int do_x509_check(X509 *x, const char *chk, size_t chklen,\n             ASN1_STRING *cstr;\n \n             gen = sk_GENERAL_NAME_value(gens, i);\n-            if ((gen->type == GEN_OTHERNAME) && (check_type == GEN_EMAIL)) {\n-                if (OBJ_obj2nid(gen->d.otherName->type_id) ==\n-                    NID_id_on_SmtpUTF8Mailbox) {\n-                    san_present = 1;\n-\n-                    /*\n-                     * If it is not a UTF8String then that is unexpected and we\n-                     * treat it as no match\n-                     */\n-                    if (gen->d.otherName->value->type == V_ASN1_UTF8STRING) {\n-                        cstr = gen->d.otherName->value->value.utf8string;\n-\n-                        /* Positive on success, negative on error! */\n-                        if ((rv = do_check_string(cstr, 0, equal, flags,\n-                                                chk, chklen, peername)) != 0)\n-                            break;\n-                    }\n-                } else\n+            switch (gen->type) {\n+            default:\n+                continue;\n+            case GEN_OTHERNAME:\n+\t\tswitch (OBJ_obj2nid(gen->d.otherName->type_id)) {\n+                default:\n                     continue;\n-            } else {\n-                if ((gen->type != check_type) && (gen->type != GEN_OTHERNAME))\n+                case NID_id_on_SmtpUTF8Mailbox:\n+                    /*-\n+                     * https://datatracker.ietf.org/doc/html/rfc8398#section-3\n+                     *\n+                     *   Due to name constraint compatibility reasons described\n+                     *   in Section 6, SmtpUTF8Mailbox subjectAltName MUST NOT\n+                     *   be used unless the local-part of the email address\n+                     *   contains non-ASCII characters. When the local-part is\n+                     *   ASCII, rfc822Name subjectAltName MUST be used instead\n+                     *   of SmtpUTF8Mailbox. This is compatible with legacy\n+                     *   software that supports only rfc822Name (and not\n+                     *   SmtpUTF8Mailbox). [...]\n+                     *\n+                     *   SmtpUTF8Mailbox is encoded as UTF8String.\n+                     *\n+                     * If it is not a UTF8String then that is unexpected, and\n+                     * we ignore the invalid SAN (neither set san_present nor\n+                     * consider it a candidate for equality).  This does mean\n+                     * that the subject CN may be considered, as would be the\n+                     * case when the malformed SmtpUtf8Mailbox SAN is instead\n+                     * simply absent.\n+                     *\n+                     * When CN-ID matching is not desirable, applications can\n+                     * choose to turn it off, doing so is at this time a best\n+                     * practice.\n+                     */\n+                    if (check_type != GEN_EMAIL\n+                        || gen->d.otherName->value->type != V_ASN1_UTF8STRING)\n+                        continue;\n+                    alt_type = 0;\n+                    cstr = gen->d.otherName->value->value.utf8string;\n+                    break;\n+                }\n+                break;\n+            case GEN_EMAIL:\n+                if (check_type != GEN_EMAIL)\n                     continue;\n-            }\n-            san_present = 1;\n-            if (check_type == GEN_EMAIL)\n                 cstr = gen->d.rfc822Name;\n-            else if (check_type == GEN_DNS)\n+                break;\n+            case GEN_DNS:\n+                if (check_type != GEN_DNS)\n+                    continue;\n                 cstr = gen->d.dNSName;\n-            else\n+                break;\n+            case GEN_IPADD:\n+                if (check_type != GEN_IPADD)\n+                    continue;\n                 cstr = gen->d.iPAddress;\n+                break;\n+            }\n+            san_present = 1;\n             /* Positive on success, negative on error! */\n             if ((rv = do_check_string(cstr, alt_type, equal, flags,\n                                       chk, chklen, peername)) != 0)"
            },
            {
                "sha": "e18735d89aadf7ab41bfc71bea6dc5b3907f6c1d",
                "filename": "test/recipes/25-test_eai_data.t",
                "status": "modified",
                "additions": 11,
                "deletions": 1,
                "changes": 12,
                "blob_url": "https://github.com/openssl/openssl/blob/05f360d9e849a1b277db628f1f13083a7f8dd04f/test%2Frecipes%2F25-test_eai_data.t",
                "raw_url": "https://github.com/openssl/openssl/raw/05f360d9e849a1b277db628f1f13083a7f8dd04f/test%2Frecipes%2F25-test_eai_data.t",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data.t?ref=05f360d9e849a1b277db628f1f13083a7f8dd04f",
                "patch": "@@ -21,16 +21,18 @@ setup(\"test_eai_data\");\n #./util/wrap.pl apps/openssl verify -nameopt utf8 -no_check_time -CAfile test/recipes/25-test_eai_data/utf8_chain.pem test/recipes/25-test_eai_data/ascii_leaf.pem\n #./util/wrap.pl apps/openssl verify -nameopt utf8 -no_check_time -CAfile test/recipes/25-test_eai_data/ascii_chain.pem test/recipes/25-test_eai_data/utf8_leaf.pem\n \n-plan tests => 12;\n+plan tests => 16;\n \n require_ok(srctop_file('test','recipes','tconversion.pl'));\n my $folder = \"test/recipes/25-test_eai_data\";\n \n my $ascii_pem = srctop_file($folder, \"ascii_leaf.pem\");\n my $utf8_pem  = srctop_file($folder, \"utf8_leaf.pem\");\n+my $kdc_pem   = srctop_file($folder, \"kdc-cert.pem\");\n \n my $ascii_chain_pem = srctop_file($folder, \"ascii_chain.pem\");\n my $utf8_chain_pem  = srctop_file($folder, \"utf8_chain.pem\");\n+my $kdc_chain_pem  = srctop_file($folder, \"kdc-root-cert.pem\");\n \n my $out;\n my $outcnt = 0;\n@@ -56,10 +58,18 @@ SKIP: {\n \n ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $ascii_chain_pem, $ascii_pem])));\n ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $utf8_chain_pem, $utf8_pem])));\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $kdc_chain_pem, $kdc_pem])));\n \n ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $ascii_chain_pem, $utf8_pem])));\n ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-CAfile\", $utf8_chain_pem,  $ascii_pem])));\n \n+# Check an otherName does not get misparsed as an DNS name, (should trigger ASAN errors if violated).\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_hostname\", 'mx1.example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+# Check an otherName does not get misparsed as an email address, (should trigger ASAN errors if violated).\n+ok(run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_email\", 'joe@example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+# We expect SmtpUTF8Mailbox to be a UTF8 String, not an IA5String.\n+ok(!run(app([\"openssl\", \"verify\", \"-nameopt\", \"utf8\", \"-no_check_time\", \"-verify_email\", 'moe@example.com', \"-CAfile\", $kdc_chain_pem,  $kdc_pem])));\n+\n #Check that we get the expected failure return code\n with({ exit_checker => sub { return shift == 2; } },\n      sub {"
            },
            {
                "sha": "e8a2c6f55d45985e3b57597e049fe31f031a34f2",
                "filename": "test/recipes/25-test_eai_data/kdc-cert.pem",
                "status": "added",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/openssl/openssl/blob/05f360d9e849a1b277db628f1f13083a7f8dd04f/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem",
                "raw_url": "https://github.com/openssl/openssl/raw/05f360d9e849a1b277db628f1f13083a7f8dd04f/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc-cert.pem?ref=05f360d9e849a1b277db628f1f13083a7f8dd04f",
                "patch": "@@ -0,0 +1,21 @@\n+-----BEGIN CERTIFICATE-----\n+MIIDbDCCAlSgAwIBAgIBAjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDARSb290\n+MCAXDTI0MDYyMDA2MTQxNVoYDzIxMjQwNjIwMDYxNDE1WjAXMRUwEwYDVQQDDAxU\n+RVNULkVYQU1QTEUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC6wfP+\n+6go79dkpo/dGLMlPZ7Gw/Q6gUYrCWZWUEgEeRVHCrqOlgUEyA+PcWas/XDPUxXry\n+BQlJHLvlqamAQn8gs4QPBARFYWKNiTVGyaRkgNA1N5gqyZdrP9UE+ZJmdqxRAAe8\n+vvpGZWSgevPhLUiSCFYDiD0Rtji2Hm3rGUrReQFBQDEw2pNGwz9zIaxUs08kQZcx\n+Yzyiplz5Oau+R/6sAgUwDlrD9xOlUxx/tA/MSDIfkK8qioU11uUZtO5VjkNQy/bT\n+7zQMmXxWgm2MIgOs1u4YN7YGOtgqHE9v9iPHHfgrkbQDtVDGQsa8AQEhkUDSCtW9\n+3VFAKx6dGNXYzFwfAgMBAAGjgcgwgcUwHQYDVR0OBBYEFFR5tZycW19DmtbL4Zqj\n+te1c2vZLMAkGA1UdIwQCMAAwCQYDVR0TBAIwADCBjQYDVR0RBIGFMIGCoD8GBisG\n+AQUCAqA1MDOgDhsMVEVTVC5FWEFNUExFoSEwH6ADAgEBoRgwFhsGa3JidGd0GwxU\n+RVNULkVYQU1QTEWgHQYIKwYBBQUHCAmgERYPbW9lQGV4YW1wbGUuY29tgQ9qb2VA\n+ZXhhbXBsZS5jb22CD214MS5leGFtcGxlLmNvbTANBgkqhkiG9w0BAQsFAAOCAQEA\n+T0xzVtVpRtaOzIhgzw7XQUdzWD5UEGSJJ1cBCOmKUWwDLTAouCYLFB4TbEE7MMUb\n+iuMy60bjmVtvfJIXorGUgSadRe5RWJ5DamJWvPA0Q9x7blnEcXqEF+9Td+ypevgU\n+UYHFmg83OYwxOsFXZ5cRuXMk3WCsDHQIBi6D1L6oDDZ2pfArs5mqm3thQKVlqyl1\n+El3XRYEdqAz/5eCOFNfwxF0ALxjxVr/Z50StUZU8I7Zfev6+kHhyrR7dqzYJImv9\n+0fTCOBEMjIETDsrA70OxAMu4V16nrWZdJdvzblS2qrt97Omkj+2kiPAJFB76RpwI\n+oDQ9fKfUOAmUFth2/R/eGA==\n+-----END CERTIFICATE-----"
            },
            {
                "sha": "a74c96bf31469f671c82109e1496d7546fb388fd",
                "filename": "test/recipes/25-test_eai_data/kdc-root-cert.pem",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/openssl/openssl/blob/05f360d9e849a1b277db628f1f13083a7f8dd04f/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem",
                "raw_url": "https://github.com/openssl/openssl/raw/05f360d9e849a1b277db628f1f13083a7f8dd04f/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc-root-cert.pem?ref=05f360d9e849a1b277db628f1f13083a7f8dd04f",
                "patch": "@@ -0,0 +1,16 @@\n+-----BEGIN CERTIFICATE-----\n+MIICnDCCAYQCCQCBswYcrlZSHjANBgkqhkiG9w0BAQsFADAPMQ0wCwYDVQQDDARS\n+b290MCAXDTI0MDYyMDA2MTQxNVoYDzIxMjQwNjIwMDYxNDE1WjAPMQ0wCwYDVQQD\n+DARSb290MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqRj8S4kBbIUj\n+61kZfi6nE35Q38U140+qt4uAiwAhKumfVHlBM0zQ98WFt5zMHIBQwIb3yjc2zj+0\n+qzUnQfwm1r/RfcMmBPEti9Ge+aEMSsds2gMXziOFM8wd2aAFPy7UVE0XpEWofsRK\n+MGi61MKVdPSbGIxBwY9VW38/7D/wf1HtJe7y0xpuecR7GB2XAs+qST59NjuF+7wS\n+dLM8Hb3TATgeYbXXWsRJgwz+SPzExg5WmLnU+7y4brZ32dHtdSmkRVSgSlaIf7Xj\n+3Tc6Zi7I+W/JYk7hy1zUexVdWCak4PHcoWrXe0gNNN/t8VfLfMExt5z/HIylXnU7\n+pGUyqZlTGQIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQAHpLF1UCRy7b6Hk0rLokxI\n+lgwiH9BU9mktigAGASvkbllpt+YbUbWnuYAvpHBGiP1qZtfX2r96UrSJaGO9BEzT\n+Gp9ThnSjoj4Srul0+s/NArU22irFLmDzbalgevAmm9gMGkdqkiIm/mXbwrPj0ncl\n+KGicevXryVpvaP62eZ8cc3C4p97frMmXxRX8sTdQpD/gRI7prdEILRSKveqT+AEW\n+7rFGM5AOevb4U8ddop8A3D/kX0wcCAIBF6jCNk3uEJ57jVcagL04kPnVfdRiedTS\n+vfq1DRNcD29d1H/9u0fHdSn1/+8Ep3X+afQ3C6//5NvOEaXcIGO4QSwkprQydfv8\n+-----END CERTIFICATE-----"
            },
            {
                "sha": "7a8dbc719fb71e783222998bd6a0319f89b9ea5e",
                "filename": "test/recipes/25-test_eai_data/kdc.sh",
                "status": "added",
                "additions": 41,
                "deletions": 0,
                "changes": 41,
                "blob_url": "https://github.com/openssl/openssl/blob/05f360d9e849a1b277db628f1f13083a7f8dd04f/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh",
                "raw_url": "https://github.com/openssl/openssl/raw/05f360d9e849a1b277db628f1f13083a7f8dd04f/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/test%2Frecipes%2F25-test_eai_data%2Fkdc.sh?ref=05f360d9e849a1b277db628f1f13083a7f8dd04f",
                "patch": "@@ -0,0 +1,41 @@\n+#! /usr/bin/env bash\n+\n+# Create a root CA, signing a leaf cert with a KDC principal otherName SAN, and\n+# also a non-UTF8 smtpUtf8Mailbox SAN followed by an rfc822Name SAN and a DNS\n+# name SAN.  In the vulnerable EAI code, the KDC principal `otherName` should\n+# trigger ASAN errors in DNS name checks, while the non-UTF8 `smtpUtf8Mailbox`\n+# should likewise lead to ASAN issues with email name checks.\n+\n+rm -f root-key.pem root-cert.pem\n+openssl req -nodes -new -newkey rsa:2048 -keyout kdc-root-key.pem \\\n+        -x509 -subj /CN=Root -days 36524 -out kdc-root-cert.pem\n+\n+exts=$(\n+    printf \"%s\\n%s\\n%s\\n%s = \" \\\n+        \"subjectKeyIdentifier = hash\" \\\n+        \"authorityKeyIdentifier = keyid\" \\\n+        \"basicConstraints = CA:false\" \\\n+        \"subjectAltName\"\n+    printf \"%s, \" \"otherName:1.3.6.1.5.2.2;SEQUENCE:kdc_princ_name\"\n+    printf \"%s, \" \"otherName:1.3.6.1.5.5.7.8.9;IA5:moe@example.com\"\n+    printf \"%s, \" \"email:joe@example.com\"\n+    printf \"%s\\n\" \"DNS:mx1.example.com\"\n+    printf \"[kdc_princ_name]\\n\"\n+    printf \"realm = EXP:0, GeneralString:TEST.EXAMPLE\\n\"\n+    printf \"principal_name = EXP:1, SEQUENCE:kdc_principal_seq\\n\"\n+    printf \"[kdc_principal_seq]\\n\"\n+    printf \"name_type = EXP:0, INTEGER:1\\n\"\n+    printf \"name_string = EXP:1, SEQUENCE:kdc_principal_components\\n\"\n+    printf \"[kdc_principal_components]\\n\"\n+    printf \"princ1 = GeneralString:krbtgt\\n\"\n+    printf \"princ2 = GeneralString:TEST.EXAMPLE\\n\"\n+    )\n+\n+printf \"%s\\n\" \"$exts\"\n+\n+openssl req -nodes -new -newkey rsa:2048 -keyout kdc-key.pem \\\n+    -subj \"/CN=TEST.EXAMPLE\" |\n+    openssl x509 -req -out kdc-cert.pem \\\n+        -CA \"kdc-root-cert.pem\" -CAkey \"kdc-root-key.pem\" \\\n+        -set_serial 2 -days 36524 \\\n+        -extfile <(printf \"%s\\n\" \"$exts\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/4eaf4891c12589e3c7bdad5f5b076e4c8392dd06",
        "url": "https://api.github.com/repos/python/cpython/commits/4eaf4891c12589e3c7bdad5f5b076e4c8392dd06",
        "html_url": "https://github.com/python/cpython/commit/4eaf4891c12589e3c7bdad5f5b076e4c8392dd06",
        "message": "[3.12] gh-121285: Remove backtracking when parsing tarfile headers (GH-121286) (GH-123543)\n\ngh-121285: Remove backtracking when parsing tarfile headers (GH-121286)\r\n\r\n* Remove backtracking when parsing tarfile headers\r\n* Rewrite PAX header parsing to be stricter\r\n* Optimize parsing of GNU extended sparse headers v0.0\r\n\r\n(cherry picked from commit 34ddb64d088dd7ccc321f6103d23153256caa5d4)\r\n\r\nCo-authored-by: Seth Michael Larson <seth@python.org>\r\nCo-authored-by: Kirill Podoprigora <kirill.bast9@mail.ru>\r\nCo-authored-by: Gregory P. Smith <greg@krypto.org>",
        "files": [
            {
                "sha": "0a0f31eca06c04f19b650354b6009367c97765f4",
                "filename": "Lib/tarfile.py",
                "status": "modified",
                "additions": 68,
                "deletions": 35,
                "changes": 103,
                "blob_url": "https://github.com/python/cpython/blob/4eaf4891c12589e3c7bdad5f5b076e4c8392dd06/Lib%2Ftarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/4eaf4891c12589e3c7bdad5f5b076e4c8392dd06/Lib%2Ftarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftarfile.py?ref=4eaf4891c12589e3c7bdad5f5b076e4c8392dd06",
                "patch": "@@ -843,6 +843,9 @@ def data_filter(member, dest_path):\n # Sentinel for replace() defaults, meaning \"don't change the attribute\"\n _KEEP = object()\n \n+# Header length is digits followed by a space.\n+_header_length_prefix_re = re.compile(br\"([0-9]{1,20}) \")\n+\n class TarInfo(object):\n     \"\"\"Informational class which holds the details about an\n        archive member given by a tar header block.\n@@ -1412,55 +1415,76 @@ def _proc_pax(self, tarfile):\n         else:\n             pax_headers = tarfile.pax_headers.copy()\n \n-        # Check if the pax header contains a hdrcharset field. This tells us\n-        # the encoding of the path, linkpath, uname and gname fields. Normally,\n-        # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n-        # implementations are allowed to store them as raw binary strings if\n-        # the translation to UTF-8 fails.\n-        match = re.search(br\"\\d+ hdrcharset=([^\\n]+)\\n\", buf)\n-        if match is not None:\n-            pax_headers[\"hdrcharset\"] = match.group(1).decode(\"utf-8\")\n-\n-        # For the time being, we don't care about anything other than \"BINARY\".\n-        # The only other value that is currently allowed by the standard is\n-        # \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n-        hdrcharset = pax_headers.get(\"hdrcharset\")\n-        if hdrcharset == \"BINARY\":\n-            encoding = tarfile.encoding\n-        else:\n-            encoding = \"utf-8\"\n-\n         # Parse pax header information. A record looks like that:\n         # \"%d %s=%s\\n\" % (length, keyword, value). length is the size\n         # of the complete record including the length field itself and\n-        # the newline. keyword and value are both UTF-8 encoded strings.\n-        regex = re.compile(br\"(\\d+) ([^=]+)=\")\n+        # the newline.\n         pos = 0\n-        while match := regex.match(buf, pos):\n-            length, keyword = match.groups()\n-            length = int(length)\n-            if length == 0:\n+        encoding = None\n+        raw_headers = []\n+        while len(buf) > pos and buf[pos] != 0x00:\n+            if not (match := _header_length_prefix_re.match(buf, pos)):\n+                raise InvalidHeaderError(\"invalid header\")\n+            try:\n+                length = int(match.group(1))\n+            except ValueError:\n+                raise InvalidHeaderError(\"invalid header\")\n+            # Headers must be at least 5 bytes, shortest being '5 x=\\n'.\n+            # Value is allowed to be empty.\n+            if length < 5:\n+                raise InvalidHeaderError(\"invalid header\")\n+            if pos + length > len(buf):\n+                raise InvalidHeaderError(\"invalid header\")\n+\n+            header_value_end_offset = match.start(1) + length - 1  # Last byte of the header\n+            keyword_and_value = buf[match.end(1) + 1:header_value_end_offset]\n+            raw_keyword, equals, raw_value = keyword_and_value.partition(b\"=\")\n+\n+            # Check the framing of the header. The last character must be '\\n' (0x0A)\n+            if not raw_keyword or equals != b\"=\" or buf[header_value_end_offset] != 0x0A:\n                 raise InvalidHeaderError(\"invalid header\")\n-            value = buf[match.end(2) + 1:match.start(1) + length - 1]\n+            raw_headers.append((length, raw_keyword, raw_value))\n+\n+            # Check if the pax header contains a hdrcharset field. This tells us\n+            # the encoding of the path, linkpath, uname and gname fields. Normally,\n+            # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n+            # implementations are allowed to store them as raw binary strings if\n+            # the translation to UTF-8 fails. For the time being, we don't care about\n+            # anything other than \"BINARY\". The only other value that is currently\n+            # allowed by the standard is \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n+            # Note that we only follow the initial 'hdrcharset' setting to preserve\n+            # the initial behavior of the 'tarfile' module.\n+            if raw_keyword == b\"hdrcharset\" and encoding is None:\n+                if raw_value == b\"BINARY\":\n+                    encoding = tarfile.encoding\n+                else:  # This branch ensures only the first 'hdrcharset' header is used.\n+                    encoding = \"utf-8\"\n \n+            pos += length\n+\n+        # If no explicit hdrcharset is set, we use UTF-8 as a default.\n+        if encoding is None:\n+            encoding = \"utf-8\"\n+\n+        # After parsing the raw headers we can decode them to text.\n+        for length, raw_keyword, raw_value in raw_headers:\n             # Normally, we could just use \"utf-8\" as the encoding and \"strict\"\n             # as the error handler, but we better not take the risk. For\n             # example, GNU tar <= 1.23 is known to store filenames it cannot\n             # translate to UTF-8 as raw strings (unfortunately without a\n             # hdrcharset=BINARY header).\n             # We first try the strict standard encoding, and if that fails we\n             # fall back on the user's encoding and error handler.\n-            keyword = self._decode_pax_field(keyword, \"utf-8\", \"utf-8\",\n+            keyword = self._decode_pax_field(raw_keyword, \"utf-8\", \"utf-8\",\n                     tarfile.errors)\n             if keyword in PAX_NAME_FIELDS:\n-                value = self._decode_pax_field(value, encoding, tarfile.encoding,\n+                value = self._decode_pax_field(raw_value, encoding, tarfile.encoding,\n                         tarfile.errors)\n             else:\n-                value = self._decode_pax_field(value, \"utf-8\", \"utf-8\",\n+                value = self._decode_pax_field(raw_value, \"utf-8\", \"utf-8\",\n                         tarfile.errors)\n \n             pax_headers[keyword] = value\n-            pos += length\n \n         # Fetch the next header.\n         try:\n@@ -1475,7 +1499,7 @@ def _proc_pax(self, tarfile):\n \n         elif \"GNU.sparse.size\" in pax_headers:\n             # GNU extended sparse format version 0.0.\n-            self._proc_gnusparse_00(next, pax_headers, buf)\n+            self._proc_gnusparse_00(next, raw_headers)\n \n         elif pax_headers.get(\"GNU.sparse.major\") == \"1\" and pax_headers.get(\"GNU.sparse.minor\") == \"0\":\n             # GNU extended sparse format version 1.0.\n@@ -1497,15 +1521,24 @@ def _proc_pax(self, tarfile):\n \n         return next\n \n-    def _proc_gnusparse_00(self, next, pax_headers, buf):\n+    def _proc_gnusparse_00(self, next, raw_headers):\n         \"\"\"Process a GNU tar extended sparse header, version 0.0.\n         \"\"\"\n         offsets = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.offset=(\\d+)\\n\", buf):\n-            offsets.append(int(match.group(1)))\n         numbytes = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.numbytes=(\\d+)\\n\", buf):\n-            numbytes.append(int(match.group(1)))\n+        for _, keyword, value in raw_headers:\n+            if keyword == b\"GNU.sparse.offset\":\n+                try:\n+                    offsets.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n+            elif keyword == b\"GNU.sparse.numbytes\":\n+                try:\n+                    numbytes.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n         next.sparse = list(zip(offsets, numbytes))\n \n     def _proc_gnusparse_01(self, next, pax_headers):"
            },
            {
                "sha": "e28d0311826e2bcecb4b80554f548ef85511ab18",
                "filename": "Lib/test/test_tarfile.py",
                "status": "modified",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/python/cpython/blob/4eaf4891c12589e3c7bdad5f5b076e4c8392dd06/Lib%2Ftest%2Ftest_tarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/4eaf4891c12589e3c7bdad5f5b076e4c8392dd06/Lib%2Ftest%2Ftest_tarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_tarfile.py?ref=4eaf4891c12589e3c7bdad5f5b076e4c8392dd06",
                "patch": "@@ -1237,6 +1237,48 @@ def test_pax_number_fields(self):\n         finally:\n             tar.close()\n \n+    def test_pax_header_bad_formats(self):\n+        # The fields from the pax header have priority over the\n+        # TarInfo.\n+        pax_header_replacements = (\n+            b\" foo=bar\\n\",\n+            b\"0 \\n\",\n+            b\"1 \\n\",\n+            b\"2 \\n\",\n+            b\"3 =\\n\",\n+            b\"4 =a\\n\",\n+            b\"1000000 foo=bar\\n\",\n+            b\"0 foo=bar\\n\",\n+            b\"-12 foo=bar\\n\",\n+            b\"000000000000000000000000036 foo=bar\\n\",\n+        )\n+        pax_headers = {\"foo\": \"bar\"}\n+\n+        for replacement in pax_header_replacements:\n+            with self.subTest(header=replacement):\n+                tar = tarfile.open(tmpname, \"w\", format=tarfile.PAX_FORMAT,\n+                                   encoding=\"iso8859-1\")\n+                try:\n+                    t = tarfile.TarInfo()\n+                    t.name = \"pax\"  # non-ASCII\n+                    t.uid = 1\n+                    t.pax_headers = pax_headers\n+                    tar.addfile(t)\n+                finally:\n+                    tar.close()\n+\n+                with open(tmpname, \"rb\") as f:\n+                    data = f.read()\n+                    self.assertIn(b\"11 foo=bar\\n\", data)\n+                    data = data.replace(b\"11 foo=bar\\n\", replacement)\n+\n+                with open(tmpname, \"wb\") as f:\n+                    f.truncate()\n+                    f.write(data)\n+\n+                with self.assertRaisesRegex(tarfile.ReadError, r\"method tar: ReadError\\('invalid header'\\)\"):\n+                    tarfile.open(tmpname, encoding=\"iso8859-1\")\n+\n \n class WriteTestBase(TarTest):\n     # Put all write tests in here that are supposed to be tested"
            },
            {
                "sha": "81f918bfe2b2558fd6bb09a6def288ae5485f8ab",
                "filename": "Misc/NEWS.d/next/Security/2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/4eaf4891c12589e3c7bdad5f5b076e4c8392dd06/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "raw_url": "https://github.com/python/cpython/raw/4eaf4891c12589e3c7bdad5f5b076e4c8392dd06/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst?ref=4eaf4891c12589e3c7bdad5f5b076e4c8392dd06",
                "patch": "@@ -0,0 +1,2 @@\n+Remove backtracking from tarfile header parsing for ``hdrcharset``, PAX, and\n+GNU sparse headers."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/d449caf8a179e3b954268b3a88eb9170be3c8fbf",
        "url": "https://api.github.com/repos/python/cpython/commits/d449caf8a179e3b954268b3a88eb9170be3c8fbf",
        "html_url": "https://github.com/python/cpython/commit/d449caf8a179e3b954268b3a88eb9170be3c8fbf",
        "message": "[3.11] gh-121285: Remove backtracking when parsing tarfile headers (GH-121286) (#123639)\n\n* Remove backtracking when parsing tarfile headers\r\n* Rewrite PAX header parsing to be stricter\r\n* Optimize parsing of GNU extended sparse headers v0.0\r\n\r\n(cherry picked from commit 34ddb64d088dd7ccc321f6103d23153256caa5d4)\r\n\r\nCo-authored-by: Kirill Podoprigora <kirill.bast9@mail.ru>\r\nCo-authored-by: Gregory P. Smith <greg@krypto.org>",
        "files": [
            {
                "sha": "0d6b925533b63d72fa15531c91472e5a28e7113f",
                "filename": "Lib/tarfile.py",
                "status": "modified",
                "additions": 67,
                "deletions": 38,
                "changes": 105,
                "blob_url": "https://github.com/python/cpython/blob/d449caf8a179e3b954268b3a88eb9170be3c8fbf/Lib%2Ftarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/d449caf8a179e3b954268b3a88eb9170be3c8fbf/Lib%2Ftarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftarfile.py?ref=d449caf8a179e3b954268b3a88eb9170be3c8fbf",
                "patch": "@@ -842,6 +842,9 @@ def data_filter(member, dest_path):\n # Sentinel for replace() defaults, meaning \"don't change the attribute\"\n _KEEP = object()\n \n+# Header length is digits followed by a space.\n+_header_length_prefix_re = re.compile(br\"([0-9]{1,20}) \")\n+\n class TarInfo(object):\n     \"\"\"Informational class which holds the details about an\n        archive member given by a tar header block.\n@@ -1411,59 +1414,76 @@ def _proc_pax(self, tarfile):\n         else:\n             pax_headers = tarfile.pax_headers.copy()\n \n-        # Check if the pax header contains a hdrcharset field. This tells us\n-        # the encoding of the path, linkpath, uname and gname fields. Normally,\n-        # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n-        # implementations are allowed to store them as raw binary strings if\n-        # the translation to UTF-8 fails.\n-        match = re.search(br\"\\d+ hdrcharset=([^\\n]+)\\n\", buf)\n-        if match is not None:\n-            pax_headers[\"hdrcharset\"] = match.group(1).decode(\"utf-8\")\n-\n-        # For the time being, we don't care about anything other than \"BINARY\".\n-        # The only other value that is currently allowed by the standard is\n-        # \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n-        hdrcharset = pax_headers.get(\"hdrcharset\")\n-        if hdrcharset == \"BINARY\":\n-            encoding = tarfile.encoding\n-        else:\n-            encoding = \"utf-8\"\n-\n         # Parse pax header information. A record looks like that:\n         # \"%d %s=%s\\n\" % (length, keyword, value). length is the size\n         # of the complete record including the length field itself and\n-        # the newline. keyword and value are both UTF-8 encoded strings.\n-        regex = re.compile(br\"(\\d+) ([^=]+)=\")\n+        # the newline.\n         pos = 0\n-        while True:\n-            match = regex.match(buf, pos)\n-            if not match:\n-                break\n+        encoding = None\n+        raw_headers = []\n+        while len(buf) > pos and buf[pos] != 0x00:\n+            if not (match := _header_length_prefix_re.match(buf, pos)):\n+                raise InvalidHeaderError(\"invalid header\")\n+            try:\n+                length = int(match.group(1))\n+            except ValueError:\n+                raise InvalidHeaderError(\"invalid header\")\n+            # Headers must be at least 5 bytes, shortest being '5 x=\\n'.\n+            # Value is allowed to be empty.\n+            if length < 5:\n+                raise InvalidHeaderError(\"invalid header\")\n+            if pos + length > len(buf):\n+                raise InvalidHeaderError(\"invalid header\")\n \n-            length, keyword = match.groups()\n-            length = int(length)\n-            if length == 0:\n+            header_value_end_offset = match.start(1) + length - 1  # Last byte of the header\n+            keyword_and_value = buf[match.end(1) + 1:header_value_end_offset]\n+            raw_keyword, equals, raw_value = keyword_and_value.partition(b\"=\")\n+\n+            # Check the framing of the header. The last character must be '\\n' (0x0A)\n+            if not raw_keyword or equals != b\"=\" or buf[header_value_end_offset] != 0x0A:\n                 raise InvalidHeaderError(\"invalid header\")\n-            value = buf[match.end(2) + 1:match.start(1) + length - 1]\n+            raw_headers.append((length, raw_keyword, raw_value))\n+\n+            # Check if the pax header contains a hdrcharset field. This tells us\n+            # the encoding of the path, linkpath, uname and gname fields. Normally,\n+            # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n+            # implementations are allowed to store them as raw binary strings if\n+            # the translation to UTF-8 fails. For the time being, we don't care about\n+            # anything other than \"BINARY\". The only other value that is currently\n+            # allowed by the standard is \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n+            # Note that we only follow the initial 'hdrcharset' setting to preserve\n+            # the initial behavior of the 'tarfile' module.\n+            if raw_keyword == b\"hdrcharset\" and encoding is None:\n+                if raw_value == b\"BINARY\":\n+                    encoding = tarfile.encoding\n+                else:  # This branch ensures only the first 'hdrcharset' header is used.\n+                    encoding = \"utf-8\"\n+\n+            pos += length\n \n+        # If no explicit hdrcharset is set, we use UTF-8 as a default.\n+        if encoding is None:\n+            encoding = \"utf-8\"\n+\n+        # After parsing the raw headers we can decode them to text.\n+        for length, raw_keyword, raw_value in raw_headers:\n             # Normally, we could just use \"utf-8\" as the encoding and \"strict\"\n             # as the error handler, but we better not take the risk. For\n             # example, GNU tar <= 1.23 is known to store filenames it cannot\n             # translate to UTF-8 as raw strings (unfortunately without a\n             # hdrcharset=BINARY header).\n             # We first try the strict standard encoding, and if that fails we\n             # fall back on the user's encoding and error handler.\n-            keyword = self._decode_pax_field(keyword, \"utf-8\", \"utf-8\",\n+            keyword = self._decode_pax_field(raw_keyword, \"utf-8\", \"utf-8\",\n                     tarfile.errors)\n             if keyword in PAX_NAME_FIELDS:\n-                value = self._decode_pax_field(value, encoding, tarfile.encoding,\n+                value = self._decode_pax_field(raw_value, encoding, tarfile.encoding,\n                         tarfile.errors)\n             else:\n-                value = self._decode_pax_field(value, \"utf-8\", \"utf-8\",\n+                value = self._decode_pax_field(raw_value, \"utf-8\", \"utf-8\",\n                         tarfile.errors)\n \n             pax_headers[keyword] = value\n-            pos += length\n \n         # Fetch the next header.\n         try:\n@@ -1478,7 +1498,7 @@ def _proc_pax(self, tarfile):\n \n         elif \"GNU.sparse.size\" in pax_headers:\n             # GNU extended sparse format version 0.0.\n-            self._proc_gnusparse_00(next, pax_headers, buf)\n+            self._proc_gnusparse_00(next, raw_headers)\n \n         elif pax_headers.get(\"GNU.sparse.major\") == \"1\" and pax_headers.get(\"GNU.sparse.minor\") == \"0\":\n             # GNU extended sparse format version 1.0.\n@@ -1500,15 +1520,24 @@ def _proc_pax(self, tarfile):\n \n         return next\n \n-    def _proc_gnusparse_00(self, next, pax_headers, buf):\n+    def _proc_gnusparse_00(self, next, raw_headers):\n         \"\"\"Process a GNU tar extended sparse header, version 0.0.\n         \"\"\"\n         offsets = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.offset=(\\d+)\\n\", buf):\n-            offsets.append(int(match.group(1)))\n         numbytes = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.numbytes=(\\d+)\\n\", buf):\n-            numbytes.append(int(match.group(1)))\n+        for _, keyword, value in raw_headers:\n+            if keyword == b\"GNU.sparse.offset\":\n+                try:\n+                    offsets.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n+            elif keyword == b\"GNU.sparse.numbytes\":\n+                try:\n+                    numbytes.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n         next.sparse = list(zip(offsets, numbytes))\n \n     def _proc_gnusparse_01(self, next, pax_headers):"
            },
            {
                "sha": "c99c88ce93af0246f5af571468faa49c10da7bfe",
                "filename": "Lib/test/test_tarfile.py",
                "status": "modified",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/python/cpython/blob/d449caf8a179e3b954268b3a88eb9170be3c8fbf/Lib%2Ftest%2Ftest_tarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/d449caf8a179e3b954268b3a88eb9170be3c8fbf/Lib%2Ftest%2Ftest_tarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_tarfile.py?ref=d449caf8a179e3b954268b3a88eb9170be3c8fbf",
                "patch": "@@ -1208,6 +1208,48 @@ def test_pax_number_fields(self):\n         finally:\n             tar.close()\n \n+    def test_pax_header_bad_formats(self):\n+        # The fields from the pax header have priority over the\n+        # TarInfo.\n+        pax_header_replacements = (\n+            b\" foo=bar\\n\",\n+            b\"0 \\n\",\n+            b\"1 \\n\",\n+            b\"2 \\n\",\n+            b\"3 =\\n\",\n+            b\"4 =a\\n\",\n+            b\"1000000 foo=bar\\n\",\n+            b\"0 foo=bar\\n\",\n+            b\"-12 foo=bar\\n\",\n+            b\"000000000000000000000000036 foo=bar\\n\",\n+        )\n+        pax_headers = {\"foo\": \"bar\"}\n+\n+        for replacement in pax_header_replacements:\n+            with self.subTest(header=replacement):\n+                tar = tarfile.open(tmpname, \"w\", format=tarfile.PAX_FORMAT,\n+                                   encoding=\"iso8859-1\")\n+                try:\n+                    t = tarfile.TarInfo()\n+                    t.name = \"pax\"  # non-ASCII\n+                    t.uid = 1\n+                    t.pax_headers = pax_headers\n+                    tar.addfile(t)\n+                finally:\n+                    tar.close()\n+\n+                with open(tmpname, \"rb\") as f:\n+                    data = f.read()\n+                    self.assertIn(b\"11 foo=bar\\n\", data)\n+                    data = data.replace(b\"11 foo=bar\\n\", replacement)\n+\n+                with open(tmpname, \"wb\") as f:\n+                    f.truncate()\n+                    f.write(data)\n+\n+                with self.assertRaisesRegex(tarfile.ReadError, r\"method tar: ReadError\\('invalid header'\\)\"):\n+                    tarfile.open(tmpname, encoding=\"iso8859-1\")\n+\n \n class WriteTestBase(TarTest):\n     # Put all write tests in here that are supposed to be tested"
            },
            {
                "sha": "81f918bfe2b2558fd6bb09a6def288ae5485f8ab",
                "filename": "Misc/NEWS.d/next/Security/2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/d449caf8a179e3b954268b3a88eb9170be3c8fbf/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "raw_url": "https://github.com/python/cpython/raw/d449caf8a179e3b954268b3a88eb9170be3c8fbf/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst?ref=d449caf8a179e3b954268b3a88eb9170be3c8fbf",
                "patch": "@@ -0,0 +1,2 @@\n+Remove backtracking from tarfile header parsing for ``hdrcharset``, PAX, and\n+GNU sparse headers."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/ed3a49ea734ada357ff4442996fd4ae71d253373",
        "url": "https://api.github.com/repos/python/cpython/commits/ed3a49ea734ada357ff4442996fd4ae71d253373",
        "html_url": "https://github.com/python/cpython/commit/ed3a49ea734ada357ff4442996fd4ae71d253373",
        "message": "[3.13] gh-121285: Remove backtracking when parsing tarfile headers (GH-121286) (#123542)\n\ngh-121285: Remove backtracking when parsing tarfile headers (GH-121286)\r\n\r\n* Remove backtracking when parsing tarfile headers\r\n* Rewrite PAX header parsing to be stricter\r\n* Optimize parsing of GNU extended sparse headers v0.0\r\n\r\n(cherry picked from commit 34ddb64d088dd7ccc321f6103d23153256caa5d4)\r\n\r\nCo-authored-by: Seth Michael Larson <seth@python.org>\r\nCo-authored-by: Kirill Podoprigora <kirill.bast9@mail.ru>\r\nCo-authored-by: Gregory P. Smith <greg@krypto.org>",
        "files": [
            {
                "sha": "ea036193411771f5cd683fec5bc1f06dad002b0e",
                "filename": "Lib/tarfile.py",
                "status": "modified",
                "additions": 68,
                "deletions": 35,
                "changes": 103,
                "blob_url": "https://github.com/python/cpython/blob/ed3a49ea734ada357ff4442996fd4ae71d253373/Lib%2Ftarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/ed3a49ea734ada357ff4442996fd4ae71d253373/Lib%2Ftarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftarfile.py?ref=ed3a49ea734ada357ff4442996fd4ae71d253373",
                "patch": "@@ -846,6 +846,9 @@ def data_filter(member, dest_path):\n # Sentinel for replace() defaults, meaning \"don't change the attribute\"\n _KEEP = object()\n \n+# Header length is digits followed by a space.\n+_header_length_prefix_re = re.compile(br\"([0-9]{1,20}) \")\n+\n class TarInfo(object):\n     \"\"\"Informational class which holds the details about an\n        archive member given by a tar header block.\n@@ -1433,55 +1436,76 @@ def _proc_pax(self, tarfile):\n         else:\n             pax_headers = tarfile.pax_headers.copy()\n \n-        # Check if the pax header contains a hdrcharset field. This tells us\n-        # the encoding of the path, linkpath, uname and gname fields. Normally,\n-        # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n-        # implementations are allowed to store them as raw binary strings if\n-        # the translation to UTF-8 fails.\n-        match = re.search(br\"\\d+ hdrcharset=([^\\n]+)\\n\", buf)\n-        if match is not None:\n-            pax_headers[\"hdrcharset\"] = match.group(1).decode(\"utf-8\")\n-\n-        # For the time being, we don't care about anything other than \"BINARY\".\n-        # The only other value that is currently allowed by the standard is\n-        # \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n-        hdrcharset = pax_headers.get(\"hdrcharset\")\n-        if hdrcharset == \"BINARY\":\n-            encoding = tarfile.encoding\n-        else:\n-            encoding = \"utf-8\"\n-\n         # Parse pax header information. A record looks like that:\n         # \"%d %s=%s\\n\" % (length, keyword, value). length is the size\n         # of the complete record including the length field itself and\n-        # the newline. keyword and value are both UTF-8 encoded strings.\n-        regex = re.compile(br\"(\\d+) ([^=]+)=\")\n+        # the newline.\n         pos = 0\n-        while match := regex.match(buf, pos):\n-            length, keyword = match.groups()\n-            length = int(length)\n-            if length == 0:\n+        encoding = None\n+        raw_headers = []\n+        while len(buf) > pos and buf[pos] != 0x00:\n+            if not (match := _header_length_prefix_re.match(buf, pos)):\n+                raise InvalidHeaderError(\"invalid header\")\n+            try:\n+                length = int(match.group(1))\n+            except ValueError:\n+                raise InvalidHeaderError(\"invalid header\")\n+            # Headers must be at least 5 bytes, shortest being '5 x=\\n'.\n+            # Value is allowed to be empty.\n+            if length < 5:\n+                raise InvalidHeaderError(\"invalid header\")\n+            if pos + length > len(buf):\n+                raise InvalidHeaderError(\"invalid header\")\n+\n+            header_value_end_offset = match.start(1) + length - 1  # Last byte of the header\n+            keyword_and_value = buf[match.end(1) + 1:header_value_end_offset]\n+            raw_keyword, equals, raw_value = keyword_and_value.partition(b\"=\")\n+\n+            # Check the framing of the header. The last character must be '\\n' (0x0A)\n+            if not raw_keyword or equals != b\"=\" or buf[header_value_end_offset] != 0x0A:\n                 raise InvalidHeaderError(\"invalid header\")\n-            value = buf[match.end(2) + 1:match.start(1) + length - 1]\n+            raw_headers.append((length, raw_keyword, raw_value))\n+\n+            # Check if the pax header contains a hdrcharset field. This tells us\n+            # the encoding of the path, linkpath, uname and gname fields. Normally,\n+            # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n+            # implementations are allowed to store them as raw binary strings if\n+            # the translation to UTF-8 fails. For the time being, we don't care about\n+            # anything other than \"BINARY\". The only other value that is currently\n+            # allowed by the standard is \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n+            # Note that we only follow the initial 'hdrcharset' setting to preserve\n+            # the initial behavior of the 'tarfile' module.\n+            if raw_keyword == b\"hdrcharset\" and encoding is None:\n+                if raw_value == b\"BINARY\":\n+                    encoding = tarfile.encoding\n+                else:  # This branch ensures only the first 'hdrcharset' header is used.\n+                    encoding = \"utf-8\"\n \n+            pos += length\n+\n+        # If no explicit hdrcharset is set, we use UTF-8 as a default.\n+        if encoding is None:\n+            encoding = \"utf-8\"\n+\n+        # After parsing the raw headers we can decode them to text.\n+        for length, raw_keyword, raw_value in raw_headers:\n             # Normally, we could just use \"utf-8\" as the encoding and \"strict\"\n             # as the error handler, but we better not take the risk. For\n             # example, GNU tar <= 1.23 is known to store filenames it cannot\n             # translate to UTF-8 as raw strings (unfortunately without a\n             # hdrcharset=BINARY header).\n             # We first try the strict standard encoding, and if that fails we\n             # fall back on the user's encoding and error handler.\n-            keyword = self._decode_pax_field(keyword, \"utf-8\", \"utf-8\",\n+            keyword = self._decode_pax_field(raw_keyword, \"utf-8\", \"utf-8\",\n                     tarfile.errors)\n             if keyword in PAX_NAME_FIELDS:\n-                value = self._decode_pax_field(value, encoding, tarfile.encoding,\n+                value = self._decode_pax_field(raw_value, encoding, tarfile.encoding,\n                         tarfile.errors)\n             else:\n-                value = self._decode_pax_field(value, \"utf-8\", \"utf-8\",\n+                value = self._decode_pax_field(raw_value, \"utf-8\", \"utf-8\",\n                         tarfile.errors)\n \n             pax_headers[keyword] = value\n-            pos += length\n \n         # Fetch the next header.\n         try:\n@@ -1496,7 +1520,7 @@ def _proc_pax(self, tarfile):\n \n         elif \"GNU.sparse.size\" in pax_headers:\n             # GNU extended sparse format version 0.0.\n-            self._proc_gnusparse_00(next, pax_headers, buf)\n+            self._proc_gnusparse_00(next, raw_headers)\n \n         elif pax_headers.get(\"GNU.sparse.major\") == \"1\" and pax_headers.get(\"GNU.sparse.minor\") == \"0\":\n             # GNU extended sparse format version 1.0.\n@@ -1518,15 +1542,24 @@ def _proc_pax(self, tarfile):\n \n         return next\n \n-    def _proc_gnusparse_00(self, next, pax_headers, buf):\n+    def _proc_gnusparse_00(self, next, raw_headers):\n         \"\"\"Process a GNU tar extended sparse header, version 0.0.\n         \"\"\"\n         offsets = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.offset=(\\d+)\\n\", buf):\n-            offsets.append(int(match.group(1)))\n         numbytes = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.numbytes=(\\d+)\\n\", buf):\n-            numbytes.append(int(match.group(1)))\n+        for _, keyword, value in raw_headers:\n+            if keyword == b\"GNU.sparse.offset\":\n+                try:\n+                    offsets.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n+            elif keyword == b\"GNU.sparse.numbytes\":\n+                try:\n+                    numbytes.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n         next.sparse = list(zip(offsets, numbytes))\n \n     def _proc_gnusparse_01(self, next, pax_headers):"
            },
            {
                "sha": "9a540765f8c05e3be81cf11b00156b26ea083fa6",
                "filename": "Lib/test/test_tarfile.py",
                "status": "modified",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/python/cpython/blob/ed3a49ea734ada357ff4442996fd4ae71d253373/Lib%2Ftest%2Ftest_tarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/ed3a49ea734ada357ff4442996fd4ae71d253373/Lib%2Ftest%2Ftest_tarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_tarfile.py?ref=ed3a49ea734ada357ff4442996fd4ae71d253373",
                "patch": "@@ -1268,6 +1268,48 @@ def test_pax_number_fields(self):\n         finally:\n             tar.close()\n \n+    def test_pax_header_bad_formats(self):\n+        # The fields from the pax header have priority over the\n+        # TarInfo.\n+        pax_header_replacements = (\n+            b\" foo=bar\\n\",\n+            b\"0 \\n\",\n+            b\"1 \\n\",\n+            b\"2 \\n\",\n+            b\"3 =\\n\",\n+            b\"4 =a\\n\",\n+            b\"1000000 foo=bar\\n\",\n+            b\"0 foo=bar\\n\",\n+            b\"-12 foo=bar\\n\",\n+            b\"000000000000000000000000036 foo=bar\\n\",\n+        )\n+        pax_headers = {\"foo\": \"bar\"}\n+\n+        for replacement in pax_header_replacements:\n+            with self.subTest(header=replacement):\n+                tar = tarfile.open(tmpname, \"w\", format=tarfile.PAX_FORMAT,\n+                                   encoding=\"iso8859-1\")\n+                try:\n+                    t = tarfile.TarInfo()\n+                    t.name = \"pax\"  # non-ASCII\n+                    t.uid = 1\n+                    t.pax_headers = pax_headers\n+                    tar.addfile(t)\n+                finally:\n+                    tar.close()\n+\n+                with open(tmpname, \"rb\") as f:\n+                    data = f.read()\n+                    self.assertIn(b\"11 foo=bar\\n\", data)\n+                    data = data.replace(b\"11 foo=bar\\n\", replacement)\n+\n+                with open(tmpname, \"wb\") as f:\n+                    f.truncate()\n+                    f.write(data)\n+\n+                with self.assertRaisesRegex(tarfile.ReadError, r\"method tar: ReadError\\('invalid header'\\)\"):\n+                    tarfile.open(tmpname, encoding=\"iso8859-1\")\n+\n \n class WriteTestBase(TarTest):\n     # Put all write tests in here that are supposed to be tested"
            },
            {
                "sha": "81f918bfe2b2558fd6bb09a6def288ae5485f8ab",
                "filename": "Misc/NEWS.d/next/Security/2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/ed3a49ea734ada357ff4442996fd4ae71d253373/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "raw_url": "https://github.com/python/cpython/raw/ed3a49ea734ada357ff4442996fd4ae71d253373/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst?ref=ed3a49ea734ada357ff4442996fd4ae71d253373",
                "patch": "@@ -0,0 +1,2 @@\n+Remove backtracking from tarfile header parsing for ``hdrcharset``, PAX, and\n+GNU sparse headers."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/b4225ca91547aa97ed3aca391614afbb255bc877",
        "url": "https://api.github.com/repos/python/cpython/commits/b4225ca91547aa97ed3aca391614afbb255bc877",
        "html_url": "https://github.com/python/cpython/commit/b4225ca91547aa97ed3aca391614afbb255bc877",
        "message": "[3.9] gh-121285: Remove backtracking when parsing tarfile headers (GH-121286) (#123641)\n\n* Remove backtracking when parsing tarfile headers\r\n* Rewrite PAX header parsing to be stricter\r\n* Optimize parsing of GNU extended sparse headers v0.0\r\n\r\n(cherry picked from commit 34ddb64d088dd7ccc321f6103d23153256caa5d4)\r\n\r\nCo-authored-by: Seth Michael Larson <seth@python.org>\r\nCo-authored-by: Kirill Podoprigora <kirill.bast9@mail.ru>\r\nCo-authored-by: Gregory P. Smith <greg@krypto.org>",
        "files": [
            {
                "sha": "d75ba50b6670c7356795b39bb040a62071c0fee1",
                "filename": "Lib/tarfile.py",
                "status": "modified",
                "additions": 67,
                "deletions": 38,
                "changes": 105,
                "blob_url": "https://github.com/python/cpython/blob/b4225ca91547aa97ed3aca391614afbb255bc877/Lib%2Ftarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/b4225ca91547aa97ed3aca391614afbb255bc877/Lib%2Ftarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftarfile.py?ref=b4225ca91547aa97ed3aca391614afbb255bc877",
                "patch": "@@ -840,6 +840,9 @@ def data_filter(member, dest_path):\n # Sentinel for replace() defaults, meaning \"don't change the attribute\"\n _KEEP = object()\n \n+# Header length is digits followed by a space.\n+_header_length_prefix_re = re.compile(br\"([0-9]{1,20}) \")\n+\n class TarInfo(object):\n     \"\"\"Informational class which holds the details about an\n        archive member given by a tar header block.\n@@ -1399,59 +1402,76 @@ def _proc_pax(self, tarfile):\n         else:\n             pax_headers = tarfile.pax_headers.copy()\n \n-        # Check if the pax header contains a hdrcharset field. This tells us\n-        # the encoding of the path, linkpath, uname and gname fields. Normally,\n-        # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n-        # implementations are allowed to store them as raw binary strings if\n-        # the translation to UTF-8 fails.\n-        match = re.search(br\"\\d+ hdrcharset=([^\\n]+)\\n\", buf)\n-        if match is not None:\n-            pax_headers[\"hdrcharset\"] = match.group(1).decode(\"utf-8\")\n-\n-        # For the time being, we don't care about anything other than \"BINARY\".\n-        # The only other value that is currently allowed by the standard is\n-        # \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n-        hdrcharset = pax_headers.get(\"hdrcharset\")\n-        if hdrcharset == \"BINARY\":\n-            encoding = tarfile.encoding\n-        else:\n-            encoding = \"utf-8\"\n-\n         # Parse pax header information. A record looks like that:\n         # \"%d %s=%s\\n\" % (length, keyword, value). length is the size\n         # of the complete record including the length field itself and\n-        # the newline. keyword and value are both UTF-8 encoded strings.\n-        regex = re.compile(br\"(\\d+) ([^=]+)=\")\n+        # the newline.\n         pos = 0\n-        while True:\n-            match = regex.match(buf, pos)\n-            if not match:\n-                break\n+        encoding = None\n+        raw_headers = []\n+        while len(buf) > pos and buf[pos] != 0x00:\n+            if not (match := _header_length_prefix_re.match(buf, pos)):\n+                raise InvalidHeaderError(\"invalid header\")\n+            try:\n+                length = int(match.group(1))\n+            except ValueError:\n+                raise InvalidHeaderError(\"invalid header\")\n+            # Headers must be at least 5 bytes, shortest being '5 x=\\n'.\n+            # Value is allowed to be empty.\n+            if length < 5:\n+                raise InvalidHeaderError(\"invalid header\")\n+            if pos + length > len(buf):\n+                raise InvalidHeaderError(\"invalid header\")\n \n-            length, keyword = match.groups()\n-            length = int(length)\n-            if length == 0:\n+            header_value_end_offset = match.start(1) + length - 1  # Last byte of the header\n+            keyword_and_value = buf[match.end(1) + 1:header_value_end_offset]\n+            raw_keyword, equals, raw_value = keyword_and_value.partition(b\"=\")\n+\n+            # Check the framing of the header. The last character must be '\\n' (0x0A)\n+            if not raw_keyword or equals != b\"=\" or buf[header_value_end_offset] != 0x0A:\n                 raise InvalidHeaderError(\"invalid header\")\n-            value = buf[match.end(2) + 1:match.start(1) + length - 1]\n+            raw_headers.append((length, raw_keyword, raw_value))\n+\n+            # Check if the pax header contains a hdrcharset field. This tells us\n+            # the encoding of the path, linkpath, uname and gname fields. Normally,\n+            # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n+            # implementations are allowed to store them as raw binary strings if\n+            # the translation to UTF-8 fails. For the time being, we don't care about\n+            # anything other than \"BINARY\". The only other value that is currently\n+            # allowed by the standard is \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n+            # Note that we only follow the initial 'hdrcharset' setting to preserve\n+            # the initial behavior of the 'tarfile' module.\n+            if raw_keyword == b\"hdrcharset\" and encoding is None:\n+                if raw_value == b\"BINARY\":\n+                    encoding = tarfile.encoding\n+                else:  # This branch ensures only the first 'hdrcharset' header is used.\n+                    encoding = \"utf-8\"\n+\n+            pos += length\n \n+        # If no explicit hdrcharset is set, we use UTF-8 as a default.\n+        if encoding is None:\n+            encoding = \"utf-8\"\n+\n+        # After parsing the raw headers we can decode them to text.\n+        for length, raw_keyword, raw_value in raw_headers:\n             # Normally, we could just use \"utf-8\" as the encoding and \"strict\"\n             # as the error handler, but we better not take the risk. For\n             # example, GNU tar <= 1.23 is known to store filenames it cannot\n             # translate to UTF-8 as raw strings (unfortunately without a\n             # hdrcharset=BINARY header).\n             # We first try the strict standard encoding, and if that fails we\n             # fall back on the user's encoding and error handler.\n-            keyword = self._decode_pax_field(keyword, \"utf-8\", \"utf-8\",\n+            keyword = self._decode_pax_field(raw_keyword, \"utf-8\", \"utf-8\",\n                     tarfile.errors)\n             if keyword in PAX_NAME_FIELDS:\n-                value = self._decode_pax_field(value, encoding, tarfile.encoding,\n+                value = self._decode_pax_field(raw_value, encoding, tarfile.encoding,\n                         tarfile.errors)\n             else:\n-                value = self._decode_pax_field(value, \"utf-8\", \"utf-8\",\n+                value = self._decode_pax_field(raw_value, \"utf-8\", \"utf-8\",\n                         tarfile.errors)\n \n             pax_headers[keyword] = value\n-            pos += length\n \n         # Fetch the next header.\n         try:\n@@ -1466,7 +1486,7 @@ def _proc_pax(self, tarfile):\n \n         elif \"GNU.sparse.size\" in pax_headers:\n             # GNU extended sparse format version 0.0.\n-            self._proc_gnusparse_00(next, pax_headers, buf)\n+            self._proc_gnusparse_00(next, raw_headers)\n \n         elif pax_headers.get(\"GNU.sparse.major\") == \"1\" and pax_headers.get(\"GNU.sparse.minor\") == \"0\":\n             # GNU extended sparse format version 1.0.\n@@ -1488,15 +1508,24 @@ def _proc_pax(self, tarfile):\n \n         return next\n \n-    def _proc_gnusparse_00(self, next, pax_headers, buf):\n+    def _proc_gnusparse_00(self, next, raw_headers):\n         \"\"\"Process a GNU tar extended sparse header, version 0.0.\n         \"\"\"\n         offsets = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.offset=(\\d+)\\n\", buf):\n-            offsets.append(int(match.group(1)))\n         numbytes = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.numbytes=(\\d+)\\n\", buf):\n-            numbytes.append(int(match.group(1)))\n+        for _, keyword, value in raw_headers:\n+            if keyword == b\"GNU.sparse.offset\":\n+                try:\n+                    offsets.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n+            elif keyword == b\"GNU.sparse.numbytes\":\n+                try:\n+                    numbytes.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n         next.sparse = list(zip(offsets, numbytes))\n \n     def _proc_gnusparse_01(self, next, pax_headers):"
            },
            {
                "sha": "2218401e3867bec3c72535ea770ad1ecd2f556d4",
                "filename": "Lib/test/test_tarfile.py",
                "status": "modified",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/python/cpython/blob/b4225ca91547aa97ed3aca391614afbb255bc877/Lib%2Ftest%2Ftest_tarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/b4225ca91547aa97ed3aca391614afbb255bc877/Lib%2Ftest%2Ftest_tarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_tarfile.py?ref=b4225ca91547aa97ed3aca391614afbb255bc877",
                "patch": "@@ -1113,6 +1113,48 @@ def test_pax_number_fields(self):\n         finally:\n             tar.close()\n \n+    def test_pax_header_bad_formats(self):\n+        # The fields from the pax header have priority over the\n+        # TarInfo.\n+        pax_header_replacements = (\n+            b\" foo=bar\\n\",\n+            b\"0 \\n\",\n+            b\"1 \\n\",\n+            b\"2 \\n\",\n+            b\"3 =\\n\",\n+            b\"4 =a\\n\",\n+            b\"1000000 foo=bar\\n\",\n+            b\"0 foo=bar\\n\",\n+            b\"-12 foo=bar\\n\",\n+            b\"000000000000000000000000036 foo=bar\\n\",\n+        )\n+        pax_headers = {\"foo\": \"bar\"}\n+\n+        for replacement in pax_header_replacements:\n+            with self.subTest(header=replacement):\n+                tar = tarfile.open(tmpname, \"w\", format=tarfile.PAX_FORMAT,\n+                                   encoding=\"iso8859-1\")\n+                try:\n+                    t = tarfile.TarInfo()\n+                    t.name = \"pax\"  # non-ASCII\n+                    t.uid = 1\n+                    t.pax_headers = pax_headers\n+                    tar.addfile(t)\n+                finally:\n+                    tar.close()\n+\n+                with open(tmpname, \"rb\") as f:\n+                    data = f.read()\n+                    self.assertIn(b\"11 foo=bar\\n\", data)\n+                    data = data.replace(b\"11 foo=bar\\n\", replacement)\n+\n+                with open(tmpname, \"wb\") as f:\n+                    f.truncate()\n+                    f.write(data)\n+\n+                with self.assertRaisesRegex(tarfile.ReadError, r\"file could not be opened successfully\"):\n+                    tarfile.open(tmpname, encoding=\"iso8859-1\")\n+\n \n class WriteTestBase(TarTest):\n     # Put all write tests in here that are supposed to be tested"
            },
            {
                "sha": "81f918bfe2b2558fd6bb09a6def288ae5485f8ab",
                "filename": "Misc/NEWS.d/next/Security/2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/b4225ca91547aa97ed3aca391614afbb255bc877/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "raw_url": "https://github.com/python/cpython/raw/b4225ca91547aa97ed3aca391614afbb255bc877/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst?ref=b4225ca91547aa97ed3aca391614afbb255bc877",
                "patch": "@@ -0,0 +1,2 @@\n+Remove backtracking from tarfile header parsing for ``hdrcharset``, PAX, and\n+GNU sparse headers."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/34ddb64d088dd7ccc321f6103d23153256caa5d4",
        "url": "https://api.github.com/repos/python/cpython/commits/34ddb64d088dd7ccc321f6103d23153256caa5d4",
        "html_url": "https://github.com/python/cpython/commit/34ddb64d088dd7ccc321f6103d23153256caa5d4",
        "message": "gh-121285: Remove backtracking when parsing tarfile headers (GH-121286)\n\n* Remove backtracking when parsing tarfile headers\r\n* Rewrite PAX header parsing to be stricter\r\n* Optimize parsing of GNU extended sparse headers v0.0\r\n\r\nCo-authored-by: Kirill Podoprigora <kirill.bast9@mail.ru>\r\nCo-authored-by: Gregory P. Smith <greg@krypto.org>",
        "files": [
            {
                "sha": "1475b3da2d32937092103bd4da29cd1430eb5b09",
                "filename": "Lib/tarfile.py",
                "status": "modified",
                "additions": 68,
                "deletions": 35,
                "changes": 103,
                "blob_url": "https://github.com/python/cpython/blob/34ddb64d088dd7ccc321f6103d23153256caa5d4/Lib%2Ftarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/34ddb64d088dd7ccc321f6103d23153256caa5d4/Lib%2Ftarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftarfile.py?ref=34ddb64d088dd7ccc321f6103d23153256caa5d4",
                "patch": "@@ -845,6 +845,9 @@ def data_filter(member, dest_path):\n # Sentinel for replace() defaults, meaning \"don't change the attribute\"\n _KEEP = object()\n \n+# Header length is digits followed by a space.\n+_header_length_prefix_re = re.compile(br\"([0-9]{1,20}) \")\n+\n class TarInfo(object):\n     \"\"\"Informational class which holds the details about an\n        archive member given by a tar header block.\n@@ -1432,55 +1435,76 @@ def _proc_pax(self, tarfile):\n         else:\n             pax_headers = tarfile.pax_headers.copy()\n \n-        # Check if the pax header contains a hdrcharset field. This tells us\n-        # the encoding of the path, linkpath, uname and gname fields. Normally,\n-        # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n-        # implementations are allowed to store them as raw binary strings if\n-        # the translation to UTF-8 fails.\n-        match = re.search(br\"\\d+ hdrcharset=([^\\n]+)\\n\", buf)\n-        if match is not None:\n-            pax_headers[\"hdrcharset\"] = match.group(1).decode(\"utf-8\")\n-\n-        # For the time being, we don't care about anything other than \"BINARY\".\n-        # The only other value that is currently allowed by the standard is\n-        # \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n-        hdrcharset = pax_headers.get(\"hdrcharset\")\n-        if hdrcharset == \"BINARY\":\n-            encoding = tarfile.encoding\n-        else:\n-            encoding = \"utf-8\"\n-\n         # Parse pax header information. A record looks like that:\n         # \"%d %s=%s\\n\" % (length, keyword, value). length is the size\n         # of the complete record including the length field itself and\n-        # the newline. keyword and value are both UTF-8 encoded strings.\n-        regex = re.compile(br\"(\\d+) ([^=]+)=\")\n+        # the newline.\n         pos = 0\n-        while match := regex.match(buf, pos):\n-            length, keyword = match.groups()\n-            length = int(length)\n-            if length == 0:\n+        encoding = None\n+        raw_headers = []\n+        while len(buf) > pos and buf[pos] != 0x00:\n+            if not (match := _header_length_prefix_re.match(buf, pos)):\n+                raise InvalidHeaderError(\"invalid header\")\n+            try:\n+                length = int(match.group(1))\n+            except ValueError:\n+                raise InvalidHeaderError(\"invalid header\")\n+            # Headers must be at least 5 bytes, shortest being '5 x=\\n'.\n+            # Value is allowed to be empty.\n+            if length < 5:\n+                raise InvalidHeaderError(\"invalid header\")\n+            if pos + length > len(buf):\n+                raise InvalidHeaderError(\"invalid header\")\n+\n+            header_value_end_offset = match.start(1) + length - 1  # Last byte of the header\n+            keyword_and_value = buf[match.end(1) + 1:header_value_end_offset]\n+            raw_keyword, equals, raw_value = keyword_and_value.partition(b\"=\")\n+\n+            # Check the framing of the header. The last character must be '\\n' (0x0A)\n+            if not raw_keyword or equals != b\"=\" or buf[header_value_end_offset] != 0x0A:\n                 raise InvalidHeaderError(\"invalid header\")\n-            value = buf[match.end(2) + 1:match.start(1) + length - 1]\n+            raw_headers.append((length, raw_keyword, raw_value))\n+\n+            # Check if the pax header contains a hdrcharset field. This tells us\n+            # the encoding of the path, linkpath, uname and gname fields. Normally,\n+            # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n+            # implementations are allowed to store them as raw binary strings if\n+            # the translation to UTF-8 fails. For the time being, we don't care about\n+            # anything other than \"BINARY\". The only other value that is currently\n+            # allowed by the standard is \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n+            # Note that we only follow the initial 'hdrcharset' setting to preserve\n+            # the initial behavior of the 'tarfile' module.\n+            if raw_keyword == b\"hdrcharset\" and encoding is None:\n+                if raw_value == b\"BINARY\":\n+                    encoding = tarfile.encoding\n+                else:  # This branch ensures only the first 'hdrcharset' header is used.\n+                    encoding = \"utf-8\"\n \n+            pos += length\n+\n+        # If no explicit hdrcharset is set, we use UTF-8 as a default.\n+        if encoding is None:\n+            encoding = \"utf-8\"\n+\n+        # After parsing the raw headers we can decode them to text.\n+        for length, raw_keyword, raw_value in raw_headers:\n             # Normally, we could just use \"utf-8\" as the encoding and \"strict\"\n             # as the error handler, but we better not take the risk. For\n             # example, GNU tar <= 1.23 is known to store filenames it cannot\n             # translate to UTF-8 as raw strings (unfortunately without a\n             # hdrcharset=BINARY header).\n             # We first try the strict standard encoding, and if that fails we\n             # fall back on the user's encoding and error handler.\n-            keyword = self._decode_pax_field(keyword, \"utf-8\", \"utf-8\",\n+            keyword = self._decode_pax_field(raw_keyword, \"utf-8\", \"utf-8\",\n                     tarfile.errors)\n             if keyword in PAX_NAME_FIELDS:\n-                value = self._decode_pax_field(value, encoding, tarfile.encoding,\n+                value = self._decode_pax_field(raw_value, encoding, tarfile.encoding,\n                         tarfile.errors)\n             else:\n-                value = self._decode_pax_field(value, \"utf-8\", \"utf-8\",\n+                value = self._decode_pax_field(raw_value, \"utf-8\", \"utf-8\",\n                         tarfile.errors)\n \n             pax_headers[keyword] = value\n-            pos += length\n \n         # Fetch the next header.\n         try:\n@@ -1495,7 +1519,7 @@ def _proc_pax(self, tarfile):\n \n         elif \"GNU.sparse.size\" in pax_headers:\n             # GNU extended sparse format version 0.0.\n-            self._proc_gnusparse_00(next, pax_headers, buf)\n+            self._proc_gnusparse_00(next, raw_headers)\n \n         elif pax_headers.get(\"GNU.sparse.major\") == \"1\" and pax_headers.get(\"GNU.sparse.minor\") == \"0\":\n             # GNU extended sparse format version 1.0.\n@@ -1517,15 +1541,24 @@ def _proc_pax(self, tarfile):\n \n         return next\n \n-    def _proc_gnusparse_00(self, next, pax_headers, buf):\n+    def _proc_gnusparse_00(self, next, raw_headers):\n         \"\"\"Process a GNU tar extended sparse header, version 0.0.\n         \"\"\"\n         offsets = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.offset=(\\d+)\\n\", buf):\n-            offsets.append(int(match.group(1)))\n         numbytes = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.numbytes=(\\d+)\\n\", buf):\n-            numbytes.append(int(match.group(1)))\n+        for _, keyword, value in raw_headers:\n+            if keyword == b\"GNU.sparse.offset\":\n+                try:\n+                    offsets.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n+            elif keyword == b\"GNU.sparse.numbytes\":\n+                try:\n+                    numbytes.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n         next.sparse = list(zip(offsets, numbytes))\n \n     def _proc_gnusparse_01(self, next, pax_headers):"
            },
            {
                "sha": "54d329a15d4d259acb91a1b83f24a668fc6631ed",
                "filename": "Lib/test/test_tarfile.py",
                "status": "modified",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/python/cpython/blob/34ddb64d088dd7ccc321f6103d23153256caa5d4/Lib%2Ftest%2Ftest_tarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/34ddb64d088dd7ccc321f6103d23153256caa5d4/Lib%2Ftest%2Ftest_tarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_tarfile.py?ref=34ddb64d088dd7ccc321f6103d23153256caa5d4",
                "patch": "@@ -1261,6 +1261,48 @@ def test_pax_number_fields(self):\n         finally:\n             tar.close()\n \n+    def test_pax_header_bad_formats(self):\n+        # The fields from the pax header have priority over the\n+        # TarInfo.\n+        pax_header_replacements = (\n+            b\" foo=bar\\n\",\n+            b\"0 \\n\",\n+            b\"1 \\n\",\n+            b\"2 \\n\",\n+            b\"3 =\\n\",\n+            b\"4 =a\\n\",\n+            b\"1000000 foo=bar\\n\",\n+            b\"0 foo=bar\\n\",\n+            b\"-12 foo=bar\\n\",\n+            b\"000000000000000000000000036 foo=bar\\n\",\n+        )\n+        pax_headers = {\"foo\": \"bar\"}\n+\n+        for replacement in pax_header_replacements:\n+            with self.subTest(header=replacement):\n+                tar = tarfile.open(tmpname, \"w\", format=tarfile.PAX_FORMAT,\n+                                   encoding=\"iso8859-1\")\n+                try:\n+                    t = tarfile.TarInfo()\n+                    t.name = \"pax\"  # non-ASCII\n+                    t.uid = 1\n+                    t.pax_headers = pax_headers\n+                    tar.addfile(t)\n+                finally:\n+                    tar.close()\n+\n+                with open(tmpname, \"rb\") as f:\n+                    data = f.read()\n+                    self.assertIn(b\"11 foo=bar\\n\", data)\n+                    data = data.replace(b\"11 foo=bar\\n\", replacement)\n+\n+                with open(tmpname, \"wb\") as f:\n+                    f.truncate()\n+                    f.write(data)\n+\n+                with self.assertRaisesRegex(tarfile.ReadError, r\"method tar: ReadError\\('invalid header'\\)\"):\n+                    tarfile.open(tmpname, encoding=\"iso8859-1\")\n+\n \n class WriteTestBase(TarTest):\n     # Put all write tests in here that are supposed to be tested"
            },
            {
                "sha": "81f918bfe2b2558fd6bb09a6def288ae5485f8ab",
                "filename": "Misc/NEWS.d/next/Security/2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/34ddb64d088dd7ccc321f6103d23153256caa5d4/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "raw_url": "https://github.com/python/cpython/raw/34ddb64d088dd7ccc321f6103d23153256caa5d4/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst?ref=34ddb64d088dd7ccc321f6103d23153256caa5d4",
                "patch": "@@ -0,0 +1,2 @@\n+Remove backtracking from tarfile header parsing for ``hdrcharset``, PAX, and\n+GNU sparse headers."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/743acbe872485dc18df4d8ab2dc7895187f062c4",
        "url": "https://api.github.com/repos/python/cpython/commits/743acbe872485dc18df4d8ab2dc7895187f062c4",
        "html_url": "https://github.com/python/cpython/commit/743acbe872485dc18df4d8ab2dc7895187f062c4",
        "message": "[3.10] gh-121285: Remove backtracking when parsing tarfile headers (GH-121286) (#123640)\n\n* Remove backtracking when parsing tarfile headers\r\n* Rewrite PAX header parsing to be stricter\r\n* Optimize parsing of GNU extended sparse headers v0.0\r\n\r\n(cherry picked from commit 34ddb64d088dd7ccc321f6103d23153256caa5d4)\r\n\r\nCo-authored-by: Kirill Podoprigora <kirill.bast9@mail.ru>\r\nCo-authored-by: Gregory P. Smith <greg@krypto.org>",
        "files": [
            {
                "sha": "3ab6811d63335b2d060505924e59aca070dc2d11",
                "filename": "Lib/tarfile.py",
                "status": "modified",
                "additions": 67,
                "deletions": 38,
                "changes": 105,
                "blob_url": "https://github.com/python/cpython/blob/743acbe872485dc18df4d8ab2dc7895187f062c4/Lib%2Ftarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/743acbe872485dc18df4d8ab2dc7895187f062c4/Lib%2Ftarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftarfile.py?ref=743acbe872485dc18df4d8ab2dc7895187f062c4",
                "patch": "@@ -841,6 +841,9 @@ def data_filter(member, dest_path):\n # Sentinel for replace() defaults, meaning \"don't change the attribute\"\n _KEEP = object()\n \n+# Header length is digits followed by a space.\n+_header_length_prefix_re = re.compile(br\"([0-9]{1,20}) \")\n+\n class TarInfo(object):\n     \"\"\"Informational class which holds the details about an\n        archive member given by a tar header block.\n@@ -1410,59 +1413,76 @@ def _proc_pax(self, tarfile):\n         else:\n             pax_headers = tarfile.pax_headers.copy()\n \n-        # Check if the pax header contains a hdrcharset field. This tells us\n-        # the encoding of the path, linkpath, uname and gname fields. Normally,\n-        # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n-        # implementations are allowed to store them as raw binary strings if\n-        # the translation to UTF-8 fails.\n-        match = re.search(br\"\\d+ hdrcharset=([^\\n]+)\\n\", buf)\n-        if match is not None:\n-            pax_headers[\"hdrcharset\"] = match.group(1).decode(\"utf-8\")\n-\n-        # For the time being, we don't care about anything other than \"BINARY\".\n-        # The only other value that is currently allowed by the standard is\n-        # \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n-        hdrcharset = pax_headers.get(\"hdrcharset\")\n-        if hdrcharset == \"BINARY\":\n-            encoding = tarfile.encoding\n-        else:\n-            encoding = \"utf-8\"\n-\n         # Parse pax header information. A record looks like that:\n         # \"%d %s=%s\\n\" % (length, keyword, value). length is the size\n         # of the complete record including the length field itself and\n-        # the newline. keyword and value are both UTF-8 encoded strings.\n-        regex = re.compile(br\"(\\d+) ([^=]+)=\")\n+        # the newline.\n         pos = 0\n-        while True:\n-            match = regex.match(buf, pos)\n-            if not match:\n-                break\n+        encoding = None\n+        raw_headers = []\n+        while len(buf) > pos and buf[pos] != 0x00:\n+            if not (match := _header_length_prefix_re.match(buf, pos)):\n+                raise InvalidHeaderError(\"invalid header\")\n+            try:\n+                length = int(match.group(1))\n+            except ValueError:\n+                raise InvalidHeaderError(\"invalid header\")\n+            # Headers must be at least 5 bytes, shortest being '5 x=\\n'.\n+            # Value is allowed to be empty.\n+            if length < 5:\n+                raise InvalidHeaderError(\"invalid header\")\n+            if pos + length > len(buf):\n+                raise InvalidHeaderError(\"invalid header\")\n \n-            length, keyword = match.groups()\n-            length = int(length)\n-            if length == 0:\n+            header_value_end_offset = match.start(1) + length - 1  # Last byte of the header\n+            keyword_and_value = buf[match.end(1) + 1:header_value_end_offset]\n+            raw_keyword, equals, raw_value = keyword_and_value.partition(b\"=\")\n+\n+            # Check the framing of the header. The last character must be '\\n' (0x0A)\n+            if not raw_keyword or equals != b\"=\" or buf[header_value_end_offset] != 0x0A:\n                 raise InvalidHeaderError(\"invalid header\")\n-            value = buf[match.end(2) + 1:match.start(1) + length - 1]\n+            raw_headers.append((length, raw_keyword, raw_value))\n+\n+            # Check if the pax header contains a hdrcharset field. This tells us\n+            # the encoding of the path, linkpath, uname and gname fields. Normally,\n+            # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n+            # implementations are allowed to store them as raw binary strings if\n+            # the translation to UTF-8 fails. For the time being, we don't care about\n+            # anything other than \"BINARY\". The only other value that is currently\n+            # allowed by the standard is \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n+            # Note that we only follow the initial 'hdrcharset' setting to preserve\n+            # the initial behavior of the 'tarfile' module.\n+            if raw_keyword == b\"hdrcharset\" and encoding is None:\n+                if raw_value == b\"BINARY\":\n+                    encoding = tarfile.encoding\n+                else:  # This branch ensures only the first 'hdrcharset' header is used.\n+                    encoding = \"utf-8\"\n+\n+            pos += length\n \n+        # If no explicit hdrcharset is set, we use UTF-8 as a default.\n+        if encoding is None:\n+            encoding = \"utf-8\"\n+\n+        # After parsing the raw headers we can decode them to text.\n+        for length, raw_keyword, raw_value in raw_headers:\n             # Normally, we could just use \"utf-8\" as the encoding and \"strict\"\n             # as the error handler, but we better not take the risk. For\n             # example, GNU tar <= 1.23 is known to store filenames it cannot\n             # translate to UTF-8 as raw strings (unfortunately without a\n             # hdrcharset=BINARY header).\n             # We first try the strict standard encoding, and if that fails we\n             # fall back on the user's encoding and error handler.\n-            keyword = self._decode_pax_field(keyword, \"utf-8\", \"utf-8\",\n+            keyword = self._decode_pax_field(raw_keyword, \"utf-8\", \"utf-8\",\n                     tarfile.errors)\n             if keyword in PAX_NAME_FIELDS:\n-                value = self._decode_pax_field(value, encoding, tarfile.encoding,\n+                value = self._decode_pax_field(raw_value, encoding, tarfile.encoding,\n                         tarfile.errors)\n             else:\n-                value = self._decode_pax_field(value, \"utf-8\", \"utf-8\",\n+                value = self._decode_pax_field(raw_value, \"utf-8\", \"utf-8\",\n                         tarfile.errors)\n \n             pax_headers[keyword] = value\n-            pos += length\n \n         # Fetch the next header.\n         try:\n@@ -1477,7 +1497,7 @@ def _proc_pax(self, tarfile):\n \n         elif \"GNU.sparse.size\" in pax_headers:\n             # GNU extended sparse format version 0.0.\n-            self._proc_gnusparse_00(next, pax_headers, buf)\n+            self._proc_gnusparse_00(next, raw_headers)\n \n         elif pax_headers.get(\"GNU.sparse.major\") == \"1\" and pax_headers.get(\"GNU.sparse.minor\") == \"0\":\n             # GNU extended sparse format version 1.0.\n@@ -1499,15 +1519,24 @@ def _proc_pax(self, tarfile):\n \n         return next\n \n-    def _proc_gnusparse_00(self, next, pax_headers, buf):\n+    def _proc_gnusparse_00(self, next, raw_headers):\n         \"\"\"Process a GNU tar extended sparse header, version 0.0.\n         \"\"\"\n         offsets = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.offset=(\\d+)\\n\", buf):\n-            offsets.append(int(match.group(1)))\n         numbytes = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.numbytes=(\\d+)\\n\", buf):\n-            numbytes.append(int(match.group(1)))\n+        for _, keyword, value in raw_headers:\n+            if keyword == b\"GNU.sparse.offset\":\n+                try:\n+                    offsets.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n+            elif keyword == b\"GNU.sparse.numbytes\":\n+                try:\n+                    numbytes.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n         next.sparse = list(zip(offsets, numbytes))\n \n     def _proc_gnusparse_01(self, next, pax_headers):"
            },
            {
                "sha": "007c3e94acb8765a5eba388eea1e2beeede82148",
                "filename": "Lib/test/test_tarfile.py",
                "status": "modified",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/python/cpython/blob/743acbe872485dc18df4d8ab2dc7895187f062c4/Lib%2Ftest%2Ftest_tarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/743acbe872485dc18df4d8ab2dc7895187f062c4/Lib%2Ftest%2Ftest_tarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_tarfile.py?ref=743acbe872485dc18df4d8ab2dc7895187f062c4",
                "patch": "@@ -1139,6 +1139,48 @@ def test_pax_number_fields(self):\n         finally:\n             tar.close()\n \n+    def test_pax_header_bad_formats(self):\n+        # The fields from the pax header have priority over the\n+        # TarInfo.\n+        pax_header_replacements = (\n+            b\" foo=bar\\n\",\n+            b\"0 \\n\",\n+            b\"1 \\n\",\n+            b\"2 \\n\",\n+            b\"3 =\\n\",\n+            b\"4 =a\\n\",\n+            b\"1000000 foo=bar\\n\",\n+            b\"0 foo=bar\\n\",\n+            b\"-12 foo=bar\\n\",\n+            b\"000000000000000000000000036 foo=bar\\n\",\n+        )\n+        pax_headers = {\"foo\": \"bar\"}\n+\n+        for replacement in pax_header_replacements:\n+            with self.subTest(header=replacement):\n+                tar = tarfile.open(tmpname, \"w\", format=tarfile.PAX_FORMAT,\n+                                   encoding=\"iso8859-1\")\n+                try:\n+                    t = tarfile.TarInfo()\n+                    t.name = \"pax\"  # non-ASCII\n+                    t.uid = 1\n+                    t.pax_headers = pax_headers\n+                    tar.addfile(t)\n+                finally:\n+                    tar.close()\n+\n+                with open(tmpname, \"rb\") as f:\n+                    data = f.read()\n+                    self.assertIn(b\"11 foo=bar\\n\", data)\n+                    data = data.replace(b\"11 foo=bar\\n\", replacement)\n+\n+                with open(tmpname, \"wb\") as f:\n+                    f.truncate()\n+                    f.write(data)\n+\n+                with self.assertRaisesRegex(tarfile.ReadError, r\"method tar: ReadError\\('invalid header'\\)\"):\n+                    tarfile.open(tmpname, encoding=\"iso8859-1\")\n+\n \n class WriteTestBase(TarTest):\n     # Put all write tests in here that are supposed to be tested"
            },
            {
                "sha": "81f918bfe2b2558fd6bb09a6def288ae5485f8ab",
                "filename": "Misc/NEWS.d/next/Security/2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/743acbe872485dc18df4d8ab2dc7895187f062c4/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "raw_url": "https://github.com/python/cpython/raw/743acbe872485dc18df4d8ab2dc7895187f062c4/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst?ref=743acbe872485dc18df4d8ab2dc7895187f062c4",
                "patch": "@@ -0,0 +1,2 @@\n+Remove backtracking from tarfile header parsing for ``hdrcharset``, PAX, and\n+GNU sparse headers."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d",
        "url": "https://api.github.com/repos/python/cpython/commits/7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d",
        "html_url": "https://github.com/python/cpython/commit/7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d",
        "message": "[3.8] gh-121285: Remove backtracking when parsing tarfile headers (GH-121286) (#123642)\n\n* Remove backtracking when parsing tarfile headers\r\n* Rewrite PAX header parsing to be stricter\r\n* Optimize parsing of GNU extended sparse headers v0.0\r\n\r\n(cherry picked from commit 34ddb64d088dd7ccc321f6103d23153256caa5d4)\r\n\r\nCo-authored-by: Seth Michael Larson <seth@python.org>\r\nCo-authored-by: Kirill Podoprigora <kirill.bast9@mail.ru>\r\nCo-authored-by: Gregory P. Smith <greg@krypto.org>",
        "files": [
            {
                "sha": "775d27e53a8f527f8518cc1429821030cf20a962",
                "filename": "Lib/tarfile.py",
                "status": "modified",
                "additions": 67,
                "deletions": 38,
                "changes": 105,
                "blob_url": "https://github.com/python/cpython/blob/7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d/Lib%2Ftarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d/Lib%2Ftarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftarfile.py?ref=7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d",
                "patch": "@@ -840,6 +840,9 @@ def data_filter(member, dest_path):\n # Sentinel for replace() defaults, meaning \"don't change the attribute\"\n _KEEP = object()\n \n+# Header length is digits followed by a space.\n+_header_length_prefix_re = re.compile(br\"([0-9]{1,20}) \")\n+\n class TarInfo(object):\n     \"\"\"Informational class which holds the details about an\n        archive member given by a tar header block.\n@@ -1390,59 +1393,76 @@ def _proc_pax(self, tarfile):\n         else:\n             pax_headers = tarfile.pax_headers.copy()\n \n-        # Check if the pax header contains a hdrcharset field. This tells us\n-        # the encoding of the path, linkpath, uname and gname fields. Normally,\n-        # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n-        # implementations are allowed to store them as raw binary strings if\n-        # the translation to UTF-8 fails.\n-        match = re.search(br\"\\d+ hdrcharset=([^\\n]+)\\n\", buf)\n-        if match is not None:\n-            pax_headers[\"hdrcharset\"] = match.group(1).decode(\"utf-8\")\n-\n-        # For the time being, we don't care about anything other than \"BINARY\".\n-        # The only other value that is currently allowed by the standard is\n-        # \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n-        hdrcharset = pax_headers.get(\"hdrcharset\")\n-        if hdrcharset == \"BINARY\":\n-            encoding = tarfile.encoding\n-        else:\n-            encoding = \"utf-8\"\n-\n         # Parse pax header information. A record looks like that:\n         # \"%d %s=%s\\n\" % (length, keyword, value). length is the size\n         # of the complete record including the length field itself and\n-        # the newline. keyword and value are both UTF-8 encoded strings.\n-        regex = re.compile(br\"(\\d+) ([^=]+)=\")\n+        # the newline.\n         pos = 0\n-        while True:\n-            match = regex.match(buf, pos)\n-            if not match:\n-                break\n+        encoding = None\n+        raw_headers = []\n+        while len(buf) > pos and buf[pos] != 0x00:\n+            if not (match := _header_length_prefix_re.match(buf, pos)):\n+                raise InvalidHeaderError(\"invalid header\")\n+            try:\n+                length = int(match.group(1))\n+            except ValueError:\n+                raise InvalidHeaderError(\"invalid header\")\n+            # Headers must be at least 5 bytes, shortest being '5 x=\\n'.\n+            # Value is allowed to be empty.\n+            if length < 5:\n+                raise InvalidHeaderError(\"invalid header\")\n+            if pos + length > len(buf):\n+                raise InvalidHeaderError(\"invalid header\")\n \n-            length, keyword = match.groups()\n-            length = int(length)\n-            if length == 0:\n+            header_value_end_offset = match.start(1) + length - 1  # Last byte of the header\n+            keyword_and_value = buf[match.end(1) + 1:header_value_end_offset]\n+            raw_keyword, equals, raw_value = keyword_and_value.partition(b\"=\")\n+\n+            # Check the framing of the header. The last character must be '\\n' (0x0A)\n+            if not raw_keyword or equals != b\"=\" or buf[header_value_end_offset] != 0x0A:\n                 raise InvalidHeaderError(\"invalid header\")\n-            value = buf[match.end(2) + 1:match.start(1) + length - 1]\n+            raw_headers.append((length, raw_keyword, raw_value))\n+\n+            # Check if the pax header contains a hdrcharset field. This tells us\n+            # the encoding of the path, linkpath, uname and gname fields. Normally,\n+            # these fields are UTF-8 encoded but since POSIX.1-2008 tar\n+            # implementations are allowed to store them as raw binary strings if\n+            # the translation to UTF-8 fails. For the time being, we don't care about\n+            # anything other than \"BINARY\". The only other value that is currently\n+            # allowed by the standard is \"ISO-IR 10646 2000 UTF-8\" in other words UTF-8.\n+            # Note that we only follow the initial 'hdrcharset' setting to preserve\n+            # the initial behavior of the 'tarfile' module.\n+            if raw_keyword == b\"hdrcharset\" and encoding is None:\n+                if raw_value == b\"BINARY\":\n+                    encoding = tarfile.encoding\n+                else:  # This branch ensures only the first 'hdrcharset' header is used.\n+                    encoding = \"utf-8\"\n+\n+            pos += length\n \n+        # If no explicit hdrcharset is set, we use UTF-8 as a default.\n+        if encoding is None:\n+            encoding = \"utf-8\"\n+\n+        # After parsing the raw headers we can decode them to text.\n+        for length, raw_keyword, raw_value in raw_headers:\n             # Normally, we could just use \"utf-8\" as the encoding and \"strict\"\n             # as the error handler, but we better not take the risk. For\n             # example, GNU tar <= 1.23 is known to store filenames it cannot\n             # translate to UTF-8 as raw strings (unfortunately without a\n             # hdrcharset=BINARY header).\n             # We first try the strict standard encoding, and if that fails we\n             # fall back on the user's encoding and error handler.\n-            keyword = self._decode_pax_field(keyword, \"utf-8\", \"utf-8\",\n+            keyword = self._decode_pax_field(raw_keyword, \"utf-8\", \"utf-8\",\n                     tarfile.errors)\n             if keyword in PAX_NAME_FIELDS:\n-                value = self._decode_pax_field(value, encoding, tarfile.encoding,\n+                value = self._decode_pax_field(raw_value, encoding, tarfile.encoding,\n                         tarfile.errors)\n             else:\n-                value = self._decode_pax_field(value, \"utf-8\", \"utf-8\",\n+                value = self._decode_pax_field(raw_value, \"utf-8\", \"utf-8\",\n                         tarfile.errors)\n \n             pax_headers[keyword] = value\n-            pos += length\n \n         # Fetch the next header.\n         try:\n@@ -1457,7 +1477,7 @@ def _proc_pax(self, tarfile):\n \n         elif \"GNU.sparse.size\" in pax_headers:\n             # GNU extended sparse format version 0.0.\n-            self._proc_gnusparse_00(next, pax_headers, buf)\n+            self._proc_gnusparse_00(next, raw_headers)\n \n         elif pax_headers.get(\"GNU.sparse.major\") == \"1\" and pax_headers.get(\"GNU.sparse.minor\") == \"0\":\n             # GNU extended sparse format version 1.0.\n@@ -1479,15 +1499,24 @@ def _proc_pax(self, tarfile):\n \n         return next\n \n-    def _proc_gnusparse_00(self, next, pax_headers, buf):\n+    def _proc_gnusparse_00(self, next, raw_headers):\n         \"\"\"Process a GNU tar extended sparse header, version 0.0.\n         \"\"\"\n         offsets = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.offset=(\\d+)\\n\", buf):\n-            offsets.append(int(match.group(1)))\n         numbytes = []\n-        for match in re.finditer(br\"\\d+ GNU.sparse.numbytes=(\\d+)\\n\", buf):\n-            numbytes.append(int(match.group(1)))\n+        for _, keyword, value in raw_headers:\n+            if keyword == b\"GNU.sparse.offset\":\n+                try:\n+                    offsets.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n+            elif keyword == b\"GNU.sparse.numbytes\":\n+                try:\n+                    numbytes.append(int(value.decode()))\n+                except ValueError:\n+                    raise InvalidHeaderError(\"invalid header\")\n+\n         next.sparse = list(zip(offsets, numbytes))\n \n     def _proc_gnusparse_01(self, next, pax_headers):"
            },
            {
                "sha": "9c89338a43e868be372603a06519fd454d6a444b",
                "filename": "Lib/test/test_tarfile.py",
                "status": "modified",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/python/cpython/blob/7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d/Lib%2Ftest%2Ftest_tarfile.py",
                "raw_url": "https://github.com/python/cpython/raw/7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d/Lib%2Ftest%2Ftest_tarfile.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_tarfile.py?ref=7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d",
                "patch": "@@ -1047,6 +1047,48 @@ def test_pax_number_fields(self):\n         finally:\n             tar.close()\n \n+    def test_pax_header_bad_formats(self):\n+        # The fields from the pax header have priority over the\n+        # TarInfo.\n+        pax_header_replacements = (\n+            b\" foo=bar\\n\",\n+            b\"0 \\n\",\n+            b\"1 \\n\",\n+            b\"2 \\n\",\n+            b\"3 =\\n\",\n+            b\"4 =a\\n\",\n+            b\"1000000 foo=bar\\n\",\n+            b\"0 foo=bar\\n\",\n+            b\"-12 foo=bar\\n\",\n+            b\"000000000000000000000000036 foo=bar\\n\",\n+        )\n+        pax_headers = {\"foo\": \"bar\"}\n+\n+        for replacement in pax_header_replacements:\n+            with self.subTest(header=replacement):\n+                tar = tarfile.open(tmpname, \"w\", format=tarfile.PAX_FORMAT,\n+                                   encoding=\"iso8859-1\")\n+                try:\n+                    t = tarfile.TarInfo()\n+                    t.name = \"pax\"  # non-ASCII\n+                    t.uid = 1\n+                    t.pax_headers = pax_headers\n+                    tar.addfile(t)\n+                finally:\n+                    tar.close()\n+\n+                with open(tmpname, \"rb\") as f:\n+                    data = f.read()\n+                    self.assertIn(b\"11 foo=bar\\n\", data)\n+                    data = data.replace(b\"11 foo=bar\\n\", replacement)\n+\n+                with open(tmpname, \"wb\") as f:\n+                    f.truncate()\n+                    f.write(data)\n+\n+                with self.assertRaisesRegex(tarfile.ReadError, r\"file could not be opened successfully\"):\n+                    tarfile.open(tmpname, encoding=\"iso8859-1\")\n+\n \n class WriteTestBase(TarTest):\n     # Put all write tests in here that are supposed to be tested"
            },
            {
                "sha": "81f918bfe2b2558fd6bb09a6def288ae5485f8ab",
                "filename": "Misc/NEWS.d/next/Security/2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "raw_url": "https://github.com/python/cpython/raw/7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-07-02-13-39-20.gh-issue-121285.hrl-yI.rst?ref=7d1f50cd92ff7e10a1c15a8f591dde8a6843a64d",
                "patch": "@@ -0,0 +1,2 @@\n+Remove backtracking from tarfile header parsing for ``hdrcharset``, PAX, and\n+GNU sparse headers."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Ultimaker/Cura/commits/285a241eb28da3188c977f85d68937c0dad79c50",
        "url": "https://api.github.com/repos/Ultimaker/Cura/commits/285a241eb28da3188c977f85d68937c0dad79c50",
        "html_url": "https://github.com/Ultimaker/Cura/commit/285a241eb28da3188c977f85d68937c0dad79c50",
        "message": "Drop-to-buildplate/3MF-reading: Simplify boolean parsing.\n\nAvoid heavy methods like previously here for a number of reasons.",
        "files": [
            {
                "sha": "4492d0984868cc0e88b30283c328846b426ed100",
                "filename": "plugins/3MFReader/ThreeMFReader.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/Ultimaker/Cura/blob/285a241eb28da3188c977f85d68937c0dad79c50/plugins%2F3MFReader%2FThreeMFReader.py",
                "raw_url": "https://github.com/Ultimaker/Cura/raw/285a241eb28da3188c977f85d68937c0dad79c50/plugins%2F3MFReader%2FThreeMFReader.py",
                "contents_url": "https://api.github.com/repos/Ultimaker/Cura/contents/plugins%2F3MFReader%2FThreeMFReader.py?ref=285a241eb28da3188c977f85d68937c0dad79c50",
                "patch": "@@ -17,6 +17,7 @@\n from UM.Scene.GroupDecorator import GroupDecorator\n from UM.Scene.SceneNode import SceneNode  # For typing.\n from UM.Scene.SceneNodeSettings import SceneNodeSettings\n+from UM.Util import parseBool\n from cura.CuraApplication import CuraApplication\n from cura.Machines.ContainerTree import ContainerTree\n from cura.Scene.BuildPlateDecorator import BuildPlateDecorator\n@@ -182,7 +183,7 @@ def _convertSavitarNodeToUMNode(savitar_node: Savitar.SceneNode, file_name: str\n                     um_node.printOrder = int(setting_value)\n                     continue\n                 if key ==\"drop_to_buildplate\":\n-                    um_node.setSetting(SceneNodeSettings.AutoDropDown, eval(setting_value))\n+                    um_node.setSetting(SceneNodeSettings.AutoDropDown, parseBool(setting_value))\n                     continue\n                 if key in known_setting_keys:\n                     setting_container.setProperty(key, \"value\", setting_value)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/overleaf/overleaf/commits/b5e5d39c3ad4e7763d42b837738955f8ded4dcd3",
        "url": "https://api.github.com/repos/overleaf/overleaf/commits/b5e5d39c3ad4e7763d42b837738955f8ded4dcd3",
        "html_url": "https://github.com/overleaf/overleaf/commit/b5e5d39c3ad4e7763d42b837738955f8ded4dcd3",
        "message": "[web] Tighten check for spelling language (#19297)\n\n* [web] Tighten check for spelling language\n\n* spelling proxy only for `/check` requests\n\nGitOrigin-RevId: c678e93cca9ad39682ec7ce6e49804ea74741acc",
        "files": [
            {
                "sha": "cdf28f36d9a0dfbba24e0219bf3fcea1f82dff10",
                "filename": "services/web/app/src/Features/Spelling/SpellingController.js",
                "status": "modified",
                "additions": 14,
                "deletions": 21,
                "changes": 35,
                "blob_url": "https://github.com/overleaf/overleaf/blob/b5e5d39c3ad4e7763d42b837738955f8ded4dcd3/services%2Fweb%2Fapp%2Fsrc%2FFeatures%2FSpelling%2FSpellingController.js",
                "raw_url": "https://github.com/overleaf/overleaf/raw/b5e5d39c3ad4e7763d42b837738955f8ded4dcd3/services%2Fweb%2Fapp%2Fsrc%2FFeatures%2FSpelling%2FSpellingController.js",
                "contents_url": "https://api.github.com/repos/overleaf/overleaf/contents/services%2Fweb%2Fapp%2Fsrc%2FFeatures%2FSpelling%2FSpellingController.js?ref=b5e5d39c3ad4e7763d42b837738955f8ded4dcd3",
                "patch": "@@ -28,40 +28,33 @@ module.exports = {\n     })\n   },\n \n-  proxyRequestToSpellingApi(req, res) {\n+  proxyCheckRequestToSpellingApi(req, res) {\n     const { language } = req.body\n \n-    let url = req.url.slice('/spelling'.length)\n-\n-    if (url === '/check') {\n-      if (!language) {\n-        logger.error(\n-          {},\n-          '\"language\" field should be included for spell checking'\n-        )\n-        return res.status(422).json({ misspellings: [] })\n-      }\n+    if (!language) {\n+      logger.error({}, '\"language\" field should be included for spell checking')\n+      return res.status(422).json({ misspellings: [] })\n+    }\n \n-      if (!languageCodeIsSupported(language)) {\n-        // this log statement can be changed to 'error' once projects with\n-        // unsupported languages are removed from the DB\n-        logger.debug({ language }, 'language not supported')\n-        return res.status(422).json({ misspellings: [] })\n-      }\n+    if (!languageCodeIsSupported(language)) {\n+      // this log statement can be changed to 'error' once projects with\n+      // unsupported languages are removed from the DB\n+      logger.debug({ language }, 'language not supported')\n+      return res.status(422).json({ misspellings: [] })\n     }\n \n     const userId = SessionManager.getLoggedInUserId(req.session)\n-    url = `/user/${userId}${url}`\n+    const url = `${Settings.apis.spelling.url}/user/${userId}/check`\n     req.headers.Host = Settings.apis.spelling.host\n     return request({\n-      url: Settings.apis.spelling.url + url,\n-      method: req.method,\n+      url,\n+      method: 'POST',\n       headers: req.headers,\n       json: req.body,\n       timeout: TEN_SECONDS,\n     })\n       .on('error', function (error) {\n-        logger.error({ err: error }, 'Spelling API error')\n+        logger.error({ err: error }, 'Spelling Check API error')\n         return res.status(500).end()\n       })\n       .pipe(res)"
            },
            {
                "sha": "4a92dcd11864e467a3160019b091fd699873d69d",
                "filename": "services/web/app/src/router.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/overleaf/overleaf/blob/b5e5d39c3ad4e7763d42b837738955f8ded4dcd3/services%2Fweb%2Fapp%2Fsrc%2Frouter.js",
                "raw_url": "https://github.com/overleaf/overleaf/raw/b5e5d39c3ad4e7763d42b837738955f8ded4dcd3/services%2Fweb%2Fapp%2Fsrc%2Frouter.js",
                "contents_url": "https://api.github.com/repos/overleaf/overleaf/contents/services%2Fweb%2Fapp%2Fsrc%2Frouter.js?ref=b5e5d39c3ad4e7763d42b837738955f8ded4dcd3",
                "patch": "@@ -1083,7 +1083,7 @@ function initialize(webRouter, privateApiRouter, publicApiRouter) {\n   webRouter.post(\n     '/spelling/check',\n     AuthenticationController.requireLogin(),\n-    SpellingController.proxyRequestToSpellingApi\n+    SpellingController.proxyCheckRequestToSpellingApi\n   )\n   webRouter.post(\n     '/spelling/learn',"
            },
            {
                "sha": "aee062c3c92cf03023f81ccac177f65279c1aa96",
                "filename": "services/web/test/unit/src/Spelling/SpellingControllerTests.js",
                "status": "modified",
                "additions": 18,
                "deletions": 50,
                "changes": 68,
                "blob_url": "https://github.com/overleaf/overleaf/blob/b5e5d39c3ad4e7763d42b837738955f8ded4dcd3/services%2Fweb%2Ftest%2Funit%2Fsrc%2FSpelling%2FSpellingControllerTests.js",
                "raw_url": "https://github.com/overleaf/overleaf/raw/b5e5d39c3ad4e7763d42b837738955f8ded4dcd3/services%2Fweb%2Ftest%2Funit%2Fsrc%2FSpelling%2FSpellingControllerTests.js",
                "contents_url": "https://api.github.com/repos/overleaf/overleaf/contents/services%2Fweb%2Ftest%2Funit%2Fsrc%2FSpelling%2FSpellingControllerTests.js?ref=b5e5d39c3ad4e7763d42b837738955f8ded4dcd3",
                "patch": "@@ -56,12 +56,12 @@ describe('SpellingController', function () {\n     this.res = new MockResponse()\n   })\n \n-  describe('proxyRequestToSpellingApi', function () {\n+  describe('proxyCheckRequestToSpellingApi', function () {\n     describe('on successful call', function () {\n       beforeEach(function () {\n         this.req.session.user._id = this.userId = 'user-id-123'\n         this.req.body = { language: 'en', words: ['blab'] }\n-        this.controller.proxyRequestToSpellingApi(this.req, this.res)\n+        this.controller.proxyCheckRequestToSpellingApi(this.req, this.res)\n       })\n \n       it('should send a request to the spelling host', function () {\n@@ -89,71 +89,39 @@ describe('SpellingController', function () {\n       beforeEach(function () {\n         this.req.session.user._id = this.userId = 'user-id-123'\n         this.req.body = { language: 'fi', words: ['blab'] }\n+        this.controller.proxyCheckRequestToSpellingApi(this.req, this.res)\n       })\n \n-      describe('when the request is a check request', function () {\n-        beforeEach(function () {\n-          this.controller.proxyRequestToSpellingApi(this.req, this.res)\n-        })\n-\n-        it('should not send a request to the spelling host', function () {\n-          this.request.called.should.equal(false)\n-        })\n-\n-        it('should return an empty misspellings array', function () {\n-          this.res.json.calledWith({ misspellings: [] }).should.equal(true)\n-        })\n-\n-        it('should return a 422 status', function () {\n-          this.res.status.calledWith(422).should.equal(true)\n-        })\n+      it('should not send a request to the spelling host', function () {\n+        this.request.called.should.equal(false)\n       })\n \n-      describe('when the request is not a check request', function () {\n-        beforeEach(function () {\n-          this.req.url = '/spelling/learn'\n-          this.controller.proxyRequestToSpellingApi(this.req, this.res)\n-        })\n+      it('should return an empty misspellings array', function () {\n+        this.res.json.calledWith({ misspellings: [] }).should.equal(true)\n+      })\n \n-        it('should send a request to the spelling host', function () {\n-          this.request.called.should.equal(true)\n-        })\n+      it('should return a 422 status', function () {\n+        this.res.status.calledWith(422).should.equal(true)\n       })\n     })\n \n     describe('when no language is indicated', function () {\n       beforeEach(function () {\n         this.req.session.user._id = this.userId = 'user-id-123'\n         this.req.body = { words: ['blab'] }\n+        this.controller.proxyCheckRequestToSpellingApi(this.req, this.res)\n       })\n \n-      describe('when the request is a check request', function () {\n-        beforeEach(function () {\n-          this.controller.proxyRequestToSpellingApi(this.req, this.res)\n-        })\n-\n-        it('should not send a request to the spelling host', function () {\n-          this.request.called.should.equal(false)\n-        })\n-\n-        it('should return an empty misspellings array', function () {\n-          this.res.json.calledWith({ misspellings: [] }).should.equal(true)\n-        })\n-\n-        it('should return a 422 status', function () {\n-          this.res.status.calledWith(422).should.equal(true)\n-        })\n+      it('should not send a request to the spelling host', function () {\n+        this.request.called.should.equal(false)\n       })\n \n-      describe('when the request is not a check request', function () {\n-        beforeEach(function () {\n-          this.req.url = '/spelling/learn'\n-          this.controller.proxyRequestToSpellingApi(this.req, this.res)\n-        })\n+      it('should return an empty misspellings array', function () {\n+        this.res.json.calledWith({ misspellings: [] }).should.equal(true)\n+      })\n \n-        it('should send a request to the spelling host', function () {\n-          this.request.called.should.equal(true)\n-        })\n+      it('should return a 422 status', function () {\n+        this.res.status.calledWith(422).should.equal(true)\n       })\n     })\n   })"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/quinn-rs/quinn/commits/e01609ccd8738bd438d86fa7185a0f85598cb58f",
        "url": "https://api.github.com/repos/quinn-rs/quinn/commits/e01609ccd8738bd438d86fa7185a0f85598cb58f",
        "html_url": "https://github.com/quinn-rs/quinn/commit/e01609ccd8738bd438d86fa7185a0f85598cb58f",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "47b4394f988f9a17d4312d188c55ba1be0a5f685",
                "filename": "quinn-proto/src/endpoint.rs",
                "status": "modified",
                "additions": 21,
                "deletions": 9,
                "changes": 30,
                "blob_url": "https://github.com/quinn-rs/quinn/blob/e01609ccd8738bd438d86fa7185a0f85598cb58f/quinn-proto%2Fsrc%2Fendpoint.rs",
                "raw_url": "https://github.com/quinn-rs/quinn/raw/e01609ccd8738bd438d86fa7185a0f85598cb58f/quinn-proto%2Fsrc%2Fendpoint.rs",
                "contents_url": "https://api.github.com/repos/quinn-rs/quinn/contents/quinn-proto%2Fsrc%2Fendpoint.rs?ref=e01609ccd8738bd438d86fa7185a0f85598cb58f",
                "patch": "@@ -573,7 +573,7 @@ impl Endpoint {\n \n         if self.cids_exhausted() {\n             debug!(\"refusing connection\");\n-            self.index.remove_initial(incoming.orig_dst_cid);\n+            self.index.remove_initial(dst_cid);\n             return Err(AcceptError {\n                 cause: ConnectionError::CidsExhausted,\n                 response: Some(self.initial_close(\n@@ -602,7 +602,7 @@ impl Endpoint {\n             .is_err()\n         {\n             debug!(packet_number, \"failed to authenticate initial packet\");\n-            self.index.remove_initial(incoming.orig_dst_cid);\n+            self.index.remove_initial(dst_cid);\n             return Err(AcceptError {\n                 cause: TransportError::PROTOCOL_VIOLATION(\"authentication failed\").into(),\n                 response: None,\n@@ -651,9 +651,7 @@ impl Endpoint {\n             transport_config,\n             remote_address_validated,\n         );\n-        if dst_cid.len() != 0 {\n-            self.index.insert_initial(dst_cid, ch);\n-        }\n+        self.index.insert_initial(dst_cid, ch);\n \n         match conn.handle_first_packet(\n             now,\n@@ -802,7 +800,7 @@ impl Endpoint {\n \n     /// Clean up endpoint data structures associated with an `Incoming`.\n     fn clean_up_incoming(&mut self, incoming: &Incoming) {\n-        self.index.remove_initial(incoming.orig_dst_cid);\n+        self.index.remove_initial(incoming.packet.header.dst_cid);\n         let incoming_buffer = self.incoming_buffers.remove(incoming.incoming_idx);\n         self.all_incoming_buffers_total_bytes -= incoming_buffer.total_bytes;\n     }\n@@ -864,6 +862,7 @@ impl Endpoint {\n             cids_issued,\n             loc_cids,\n             addresses,\n+            side,\n             reset_token: None,\n         });\n         debug_assert_eq!(id, ch.0, \"connection handle allocation out of sync\");\n@@ -994,6 +993,8 @@ struct ConnectionIndex {\n     /// Identifies connections based on the initial DCID the peer utilized\n     ///\n     /// Uses a standard `HashMap` to protect against hash collision attacks.\n+    ///\n+    /// Used by the server, not the client.\n     connection_ids_initial: HashMap<ConnectionId, RouteDatagramTo>,\n     /// Identifies connections based on locally created CIDs\n     ///\n@@ -1022,17 +1023,27 @@ struct ConnectionIndex {\n impl ConnectionIndex {\n     /// Associate an incoming connection with its initial destination CID\n     fn insert_initial_incoming(&mut self, dst_cid: ConnectionId, incoming_key: usize) {\n+        if dst_cid.len() == 0 {\n+            return;\n+        }\n         self.connection_ids_initial\n             .insert(dst_cid, RouteDatagramTo::Incoming(incoming_key));\n     }\n \n     /// Remove an association with an initial destination CID\n     fn remove_initial(&mut self, dst_cid: ConnectionId) {\n-        self.connection_ids_initial.remove(&dst_cid);\n+        if dst_cid.len() == 0 {\n+            return;\n+        }\n+        let removed = self.connection_ids_initial.remove(&dst_cid);\n+        debug_assert!(removed.is_some());\n     }\n \n     /// Associate a connection with its initial destination CID\n     fn insert_initial(&mut self, dst_cid: ConnectionId, connection: ConnectionHandle) {\n+        if dst_cid.len() == 0 {\n+            return;\n+        }\n         self.connection_ids_initial\n             .insert(dst_cid, RouteDatagramTo::Connection(connection));\n     }\n@@ -1070,8 +1081,8 @@ impl ConnectionIndex {\n \n     /// Remove all references to a connection\n     fn remove(&mut self, conn: &ConnectionMeta) {\n-        if conn.init_cid.len() > 0 {\n-            self.connection_ids_initial.remove(&conn.init_cid);\n+        if conn.side.is_server() {\n+            self.remove_initial(conn.init_cid);\n         }\n         for cid in conn.loc_cids.values() {\n             self.connection_ids.remove(cid);\n@@ -1126,6 +1137,7 @@ pub(crate) struct ConnectionMeta {\n     /// Only needed to support connections with zero-length CIDs, which cannot migrate, so we don't\n     /// bother keeping it up to date.\n     addresses: FourTuple,\n+    side: Side,\n     /// Reset token provided by the peer for the CID we're currently sending to, and the address\n     /// being sent to\n     reset_token: Option<(SocketAddr, ResetToken)>,"
            },
            {
                "sha": "50bb6ef0e65a30445602de6aadab422019bb97ce",
                "filename": "quinn-proto/src/tests/mod.rs",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/quinn-rs/quinn/blob/e01609ccd8738bd438d86fa7185a0f85598cb58f/quinn-proto%2Fsrc%2Ftests%2Fmod.rs",
                "raw_url": "https://github.com/quinn-rs/quinn/raw/e01609ccd8738bd438d86fa7185a0f85598cb58f/quinn-proto%2Fsrc%2Ftests%2Fmod.rs",
                "contents_url": "https://api.github.com/repos/quinn-rs/quinn/contents/quinn-proto%2Fsrc%2Ftests%2Fmod.rs?ref=e01609ccd8738bd438d86fa7185a0f85598cb58f",
                "patch": "@@ -2994,6 +2994,32 @@ fn reject_manually() {\n     ));\n }\n \n+#[test]\n+fn validate_then_reject_manually() {\n+    let _guard = subscribe();\n+    let mut pair = Pair::default();\n+    pair.server.incoming_connection_behavior = IncomingConnectionBehavior::ValidateThenReject;\n+\n+    // The server should now retry and reject incoming connections.\n+    let client_ch = pair.begin_connect(client_config());\n+    pair.drive();\n+    pair.server.assert_no_accept();\n+    let client = pair.client.connections.get_mut(&client_ch).unwrap();\n+    assert!(client.is_closed());\n+    assert!(matches!(\n+        client.poll(),\n+        Some(Event::ConnectionLost {\n+            reason: ConnectionError::ConnectionClosed(close)\n+        }) if close.error_code == TransportErrorCode::CONNECTION_REFUSED\n+    ));\n+    pair.drive();\n+    assert_matches!(pair.client_conn_mut(client_ch).poll(), None);\n+    assert_eq!(pair.client.known_connections(), 0);\n+    assert_eq!(pair.client.known_cids(), 0);\n+    assert_eq!(pair.server.known_connections(), 0);\n+    assert_eq!(pair.server.known_cids(), 0);\n+}\n+\n #[test]\n fn endpoint_and_connection_impl_send_sync() {\n     const fn is_send_sync<T: Send + Sync>() {}"
            },
            {
                "sha": "4b4625f7b431ffe18cb2446213d871ca7e321b29",
                "filename": "quinn-proto/src/tests/util.rs",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/quinn-rs/quinn/blob/e01609ccd8738bd438d86fa7185a0f85598cb58f/quinn-proto%2Fsrc%2Ftests%2Futil.rs",
                "raw_url": "https://github.com/quinn-rs/quinn/raw/e01609ccd8738bd438d86fa7185a0f85598cb58f/quinn-proto%2Fsrc%2Ftests%2Futil.rs",
                "contents_url": "https://api.github.com/repos/quinn-rs/quinn/contents/quinn-proto%2Fsrc%2Ftests%2Futil.rs?ref=e01609ccd8738bd438d86fa7185a0f85598cb58f",
                "patch": "@@ -306,6 +306,7 @@ pub(super) enum IncomingConnectionBehavior {\n     AcceptAll,\n     RejectAll,\n     Validate,\n+    ValidateThenReject,\n     Wait,\n }\n \n@@ -377,6 +378,13 @@ impl TestEndpoint {\n                                     self.retry(incoming);\n                                 }\n                             }\n+                            IncomingConnectionBehavior::ValidateThenReject => {\n+                                if incoming.remote_address_validated() {\n+                                    self.reject(incoming);\n+                                } else {\n+                                    self.retry(incoming);\n+                                }\n+                            }\n                             IncomingConnectionBehavior::Wait => {\n                                 self.waiting_incoming.push(incoming);\n                             }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/hedgedoc/hedgedoc/commits/380587b7fd65bc1eb71eef51a3aab324f9877650",
        "url": "https://api.github.com/repos/hedgedoc/hedgedoc/commits/380587b7fd65bc1eb71eef51a3aab324f9877650",
        "html_url": "https://github.com/hedgedoc/hedgedoc/commit/380587b7fd65bc1eb71eef51a3aab324f9877650",
        "message": "Ensure case-sensitive DB queries on MySQL/MariaDB\n\nMySQLs string comparisons are case-insensitive by default.\nThis allows to hide notes by creating a new note with an alias that\nequals the lower-cased alias of another note.\nThe new note is returned first by MySQL, so the original one is not\naccessible anymore.\n\nThis fixes the problem by using an explicit binary comparison in the\naffected queries.\n\nSee https://dev.mysql.com/doc/refman/8.0/en/case-sensitivity.html\n\nSigned-off-by: David Mehren <git@herrmehren.de>",
        "files": [
            {
                "sha": "628eb25474518d9c812d37c315f295363d36b69f",
                "filename": "lib/models/note.js",
                "status": "modified",
                "additions": 11,
                "deletions": 6,
                "changes": 17,
                "blob_url": "https://github.com/hedgedoc/hedgedoc/blob/380587b7fd65bc1eb71eef51a3aab324f9877650/lib%2Fmodels%2Fnote.js",
                "raw_url": "https://github.com/hedgedoc/hedgedoc/raw/380587b7fd65bc1eb71eef51a3aab324f9877650/lib%2Fmodels%2Fnote.js",
                "contents_url": "https://api.github.com/repos/hedgedoc/hedgedoc/contents/lib%2Fmodels%2Fnote.js?ref=380587b7fd65bc1eb71eef51a3aab324f9877650",
                "patch": "@@ -18,6 +18,7 @@ const S = require('string')\n // core\n const config = require('../config')\n const logger = require('../logger')\n+const utils = require('../utils')\n \n // ot\n const ot = require('../ot')\n@@ -191,9 +192,11 @@ module.exports = function (sequelize, DataTypes) {\n       parseNoteIdByAlias: function (_callback) {\n         // try to parse note id by alias (e.g. doc)\n         Note.findOne({\n-          where: {\n-            alias: noteId\n-          }\n+          where: utils.isMySQL(sequelize)\n+            ? sequelize.where(sequelize.fn('BINARY', sequelize.col('alias')), noteId)\n+            : {\n+                alias: noteId\n+              }\n         }).then(function (note) {\n           if (note) {\n             const filePath = path.join(config.docsPath, path.basename(noteId) + '.md')\n@@ -296,9 +299,11 @@ module.exports = function (sequelize, DataTypes) {\n         try {\n           if (shortId.isValid(noteId)) {\n             Note.findOne({\n-              where: {\n-                shortid: noteId\n-              }\n+              where: utils.isMySQL(sequelize)\n+                ? sequelize.where(sequelize.fn('BINARY', sequelize.col('shortid')), noteId)\n+                : {\n+                    shortid: noteId\n+                  }\n             }).then(function (note) {\n               if (!note) return _callback(null, null)\n               return callback(null, note.id)"
            },
            {
                "sha": "01b5eb172d607e824dbac552e722e33cc0c15c4a",
                "filename": "lib/utils.js",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/hedgedoc/hedgedoc/blob/380587b7fd65bc1eb71eef51a3aab324f9877650/lib%2Futils.js",
                "raw_url": "https://github.com/hedgedoc/hedgedoc/raw/380587b7fd65bc1eb71eef51a3aab324f9877650/lib%2Futils.js",
                "contents_url": "https://api.github.com/repos/hedgedoc/hedgedoc/contents/lib%2Futils.js?ref=380587b7fd65bc1eb71eef51a3aab324f9877650",
                "patch": "@@ -4,6 +4,10 @@ exports.isSQLite = function isSQLite (sequelize) {\n   return sequelize.options.dialect === 'sqlite'\n }\n \n+exports.isMySQL = function isMySQL (sequelize) {\n+  return ['mysql', 'mariadb'].includes(sequelize.options.dialect)\n+}\n+\n exports.getImageMimeType = function getImageMimeType (imagePath) {\n   const fileExtension = /[^.]+$/.exec(imagePath)\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vim/vim/commits/396fd1ec2956307755392a1",
        "url": "https://api.github.com/repos/vim/vim/commits/396fd1ec2956307755392a1c61f55d5c1847f308",
        "html_url": "https://github.com/vim/vim/commit/396fd1ec2956307755392a1c61f55d5c1847f308",
        "message": "patch 9.1.0707: [security]: invalid cursor position may cause a crash\n\nProblem:  [security]: invalid cursor position may cause a crash\n          (after v9.1.0038)\nSolution: Set cursor to the last character in a line, if it would\n          otherwise point to beyond the line; no tests added, as it\n          is unclear how to reproduce this.\n\nGithub Advisory:\nhttps://github.com/vim/vim/security/advisories/GHSA-4ghr-c62x-cqfh\n\nCo-authored-by: zeertzjq <zeertzjq@outlook.com>\nSigned-off-by: zeertzjq <zeertzjq@outlook.com>\nSigned-off-by: Christian Brabandt <cb@256bit.org>",
        "files": [
            {
                "sha": "399f258251a30083e3a6dce3b0026212f68d73f9",
                "filename": "src/charset.c",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/vim/vim/blob/396fd1ec2956307755392a1c61f55d5c1847f308/src%2Fcharset.c",
                "raw_url": "https://github.com/vim/vim/raw/396fd1ec2956307755392a1c61f55d5c1847f308/src%2Fcharset.c",
                "contents_url": "https://api.github.com/repos/vim/vim/contents/src%2Fcharset.c?ref=396fd1ec2956307755392a1c61f55d5c1847f308",
                "patch": "@@ -1678,6 +1678,9 @@ getvcol(\n     }\n     clear_chartabsize_arg(&cts);\n \n+    if (*ptr == NUL && pos->col < MAXCOL && pos->col > ptr - line)\n+\tpos->col = ptr - line;\n+\n     if (start != NULL)\n \t*start = vcol + head;\n     if (end != NULL)"
            },
            {
                "sha": "935b533efdcb12bda47ffe8cd72590c3aa9bec34",
                "filename": "src/version.c",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/vim/vim/blob/396fd1ec2956307755392a1c61f55d5c1847f308/src%2Fversion.c",
                "raw_url": "https://github.com/vim/vim/raw/396fd1ec2956307755392a1c61f55d5c1847f308/src%2Fversion.c",
                "contents_url": "https://api.github.com/repos/vim/vim/contents/src%2Fversion.c?ref=396fd1ec2956307755392a1c61f55d5c1847f308",
                "patch": "@@ -704,6 +704,8 @@ static char *(features[]) =\n \n static int included_patches[] =\n {   /* Add new patch number below this line */\n+/**/\n+    707,\n /**/\n     706,\n /**/"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/actions/toolkit/commits/29885a805ef3e95a9862dcaa8431c30981960017",
        "url": "https://api.github.com/repos/actions/toolkit/commits/29885a805ef3e95a9862dcaa8431c30981960017",
        "html_url": "https://github.com/actions/toolkit/commit/29885a805ef3e95a9862dcaa8431c30981960017",
        "message": "Merge pull request #1724 from actions/bethanyj28/update-unzip-stream\n\nUse latest `unzip-stream` and `unzip.Extract`",
        "files": [
            {
                "sha": "afc7f6a7b8326ccd1fc62dee2efebd6f02d4c16b",
                "filename": "packages/artifact/RELEASES.md",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/actions/toolkit/blob/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2FRELEASES.md",
                "raw_url": "https://github.com/actions/toolkit/raw/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2FRELEASES.md",
                "contents_url": "https://api.github.com/repos/actions/toolkit/contents/packages%2Fartifact%2FRELEASES.md?ref=29885a805ef3e95a9862dcaa8431c30981960017",
                "patch": "@@ -1,5 +1,9 @@\n # @actions/artifact Releases\n \n+### 2.1.7\n+\n+- Update unzip-stream dependency and reverted to using `unzip.Extract()`\n+\n ### 2.1.6\n \n - Will retry on invalid request responses."
            },
            {
                "sha": "f73c9fc767eab35837a3713113952804ebd298eb",
                "filename": "packages/artifact/__tests__/download-artifact.test.ts",
                "status": "modified",
                "additions": 16,
                "deletions": 8,
                "changes": 24,
                "blob_url": "https://github.com/actions/toolkit/blob/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2F__tests__%2Fdownload-artifact.test.ts",
                "raw_url": "https://github.com/actions/toolkit/raw/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2F__tests__%2Fdownload-artifact.test.ts",
                "contents_url": "https://api.github.com/repos/actions/toolkit/contents/packages%2Fartifact%2F__tests__%2Fdownload-artifact.test.ts?ref=29885a805ef3e95a9862dcaa8431c30981960017",
                "patch": "@@ -200,14 +200,12 @@ describe('download-artifact', () => {\n         }\n       )\n \n-      await expect(\n-        downloadArtifactPublic(\n-          fixtures.artifactID,\n-          fixtures.repositoryOwner,\n-          fixtures.repositoryName,\n-          fixtures.token\n-        )\n-      ).rejects.toBeInstanceOf(Error)\n+      const response = await downloadArtifactPublic(\n+        fixtures.artifactID,\n+        fixtures.repositoryOwner,\n+        fixtures.repositoryName,\n+        fixtures.token\n+      )\n \n       expect(downloadArtifactMock).toHaveBeenCalledWith({\n         owner: fixtures.repositoryOwner,\n@@ -223,6 +221,16 @@ describe('download-artifact', () => {\n       expect(mockGetArtifactMalicious).toHaveBeenCalledWith(\n         fixtures.blobStorageUrl\n       )\n+\n+      // ensure path traversal was not possible\n+      expect(\n+        fs.existsSync(path.join(fixtures.workspaceDir, 'x/etc/hosts'))\n+      ).toBe(true)\n+      expect(\n+        fs.existsSync(path.join(fixtures.workspaceDir, 'y/etc/hosts'))\n+      ).toBe(true)\n+\n+      expect(response.downloadPath).toBe(fixtures.workspaceDir)\n     })\n \n     it('should successfully download an artifact to user defined path', async () => {"
            },
            {
                "sha": "dce189743a94479cc9cdee750927e35eb61c1092",
                "filename": "packages/artifact/package-lock.json",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/actions/toolkit/blob/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2Fpackage-lock.json",
                "raw_url": "https://github.com/actions/toolkit/raw/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2Fpackage-lock.json",
                "contents_url": "https://api.github.com/repos/actions/toolkit/contents/packages%2Fartifact%2Fpackage-lock.json?ref=29885a805ef3e95a9862dcaa8431c30981960017",
                "patch": "@@ -1,12 +1,12 @@\n {\n   \"name\": \"@actions/artifact\",\n-  \"version\": \"2.1.5\",\n+  \"version\": \"2.1.7\",\n   \"lockfileVersion\": 3,\n   \"requires\": true,\n   \"packages\": {\n     \"\": {\n       \"name\": \"@actions/artifact\",\n-      \"version\": \"2.1.5\",\n+      \"version\": \"2.1.7\",\n       \"license\": \"MIT\",\n       \"dependencies\": {\n         \"@actions/core\": \"^1.10.0\",\n@@ -1738,9 +1738,9 @@\n       \"integrity\": \"sha512-isyNax3wXoKaulPDZWHQqbmIx1k2tb9fb3GGDBRxCscfYV2Ch7WxPArBsFEG8s/safwXTT7H4QGhaIkTp9447w==\"\n     },\n     \"node_modules/unzip-stream\": {\n-      \"version\": \"0.3.1\",\n-      \"resolved\": \"https://registry.npmjs.org/unzip-stream/-/unzip-stream-0.3.1.tgz\",\n-      \"integrity\": \"sha512-RzaGXLNt+CW+T41h1zl6pGz3EaeVhYlK+rdAap+7DxW5kqsqePO8kRtWPaCiVqdhZc86EctSPVYNix30YOMzmw==\",\n+      \"version\": \"0.3.4\",\n+      \"resolved\": \"https://registry.npmjs.org/unzip-stream/-/unzip-stream-0.3.4.tgz\",\n+      \"integrity\": \"sha512-PyofABPVv+d7fL7GOpusx7eRT9YETY2X04PhwbSipdj6bMxVCFJrr+nm0Mxqbf9hUiTin/UsnuFWBXlDZFy0Cw==\",\n       \"dependencies\": {\n         \"binary\": \"^0.3.0\",\n         \"mkdirp\": \"^0.5.1\""
            },
            {
                "sha": "ab84d0f23815e1305d8150483db0c83810424d49",
                "filename": "packages/artifact/package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/actions/toolkit/blob/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2Fpackage.json",
                "raw_url": "https://github.com/actions/toolkit/raw/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2Fpackage.json",
                "contents_url": "https://api.github.com/repos/actions/toolkit/contents/packages%2Fartifact%2Fpackage.json?ref=29885a805ef3e95a9862dcaa8431c30981960017",
                "patch": "@@ -1,6 +1,6 @@\n {\n   \"name\": \"@actions/artifact\",\n-  \"version\": \"2.1.6\",\n+  \"version\": \"2.1.7\",\n   \"preview\": true,\n   \"description\": \"Actions artifact lib\",\n   \"keywords\": ["
            },
            {
                "sha": "dc54f6fe81e45516f03fd53d859903dfd89d6a5d",
                "filename": "packages/artifact/src/internal/download/download-artifact.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 50,
                "changes": 52,
                "blob_url": "https://github.com/actions/toolkit/blob/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2Fsrc%2Finternal%2Fdownload%2Fdownload-artifact.ts",
                "raw_url": "https://github.com/actions/toolkit/raw/29885a805ef3e95a9862dcaa8431c30981960017/packages%2Fartifact%2Fsrc%2Finternal%2Fdownload%2Fdownload-artifact.ts",
                "contents_url": "https://api.github.com/repos/actions/toolkit/contents/packages%2Fartifact%2Fsrc%2Finternal%2Fdownload%2Fdownload-artifact.ts?ref=29885a805ef3e95a9862dcaa8431c30981960017",
                "patch": "@@ -1,7 +1,4 @@\n import fs from 'fs/promises'\n-import * as stream from 'stream'\n-import {createWriteStream} from 'fs'\n-import * as path from 'path'\n import * as github from '@actions/github'\n import * as core from '@actions/core'\n import * as httpClient from '@actions/http-client'\n@@ -47,11 +44,6 @@ async function streamExtract(url: string, directory: string): Promise<void> {\n       await streamExtractExternal(url, directory)\n       return\n     } catch (error) {\n-      if (error.message.includes('Malformed extraction path')) {\n-        throw new Error(\n-          `Artifact download failed with unretryable error: ${error.message}`\n-        )\n-      }\n       retryCount++\n       core.debug(\n         `Failed to download artifact after ${retryCount} retries due to ${error.message}. Retrying in 5 seconds...`\n@@ -86,8 +78,6 @@ export async function streamExtractExternal(\n     }\n     const timer = setTimeout(timerFn, timeout)\n \n-    const createdDirectories = new Set<string>()\n-    createdDirectories.add(directory)\n     response.message\n       .on('data', () => {\n         timer.refresh()\n@@ -99,46 +89,8 @@ export async function streamExtractExternal(\n         clearTimeout(timer)\n         reject(error)\n       })\n-      .pipe(unzip.Parse())\n-      .pipe(\n-        new stream.Transform({\n-          objectMode: true,\n-          transform: async (entry, _, callback) => {\n-            const fullPath = path.normalize(path.join(directory, entry.path))\n-            if (!directory.endsWith(path.sep)) {\n-              directory += path.sep\n-            }\n-            if (!fullPath.startsWith(directory)) {\n-              reject(new Error(`Malformed extraction path: ${fullPath}`))\n-            }\n-\n-            if (entry.type === 'Directory') {\n-              if (!createdDirectories.has(fullPath)) {\n-                createdDirectories.add(fullPath)\n-                await resolveOrCreateDirectory(fullPath).then(() => {\n-                  entry.autodrain()\n-                  callback()\n-                })\n-              } else {\n-                entry.autodrain()\n-                callback()\n-              }\n-            } else {\n-              core.info(`Extracting artifact entry: ${fullPath}`)\n-              if (!createdDirectories.has(path.dirname(fullPath))) {\n-                createdDirectories.add(path.dirname(fullPath))\n-                await resolveOrCreateDirectory(path.dirname(fullPath))\n-              }\n-\n-              const writeStream = createWriteStream(fullPath)\n-              writeStream.on('finish', callback)\n-              writeStream.on('error', reject)\n-              entry.pipe(writeStream)\n-            }\n-          }\n-        })\n-      )\n-      .on('finish', async () => {\n+      .pipe(unzip.Extract({path: directory}))\n+      .on('close', () => {\n         clearTimeout(timer)\n         resolve()\n       })"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nescalante/urlregex/commits/e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9",
        "url": "https://api.github.com/repos/nescalante/urlregex/commits/e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9",
        "html_url": "https://github.com/nescalante/urlregex/commit/e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9",
        "message": "Security Fix for Regular Expression Denial of Service (ReDoS) - huntr.dev (#8)\n\n* Added two dangerous URLs to the fixtures array.\r\n\r\n* WIP: ReDoS mitigation - Fixed catastrophic backtracking that was happening at the check for a basic auth sequence, i.e. http://username:pass@example.com, but there is another happening at the domain var at line 11.\r\n\r\n* WIP: ReDoS mitigation - current state of my update fixes the vuln, but breaks 4 tests.\r\n\r\n* Added opt for punycode validation. Also made some minor regex tweaks. Passing all of notmatch and only failing 2 of urlmatch.\r\n\r\n* Added punycode url fixtures.\r\n\r\n* Simplified regex since case is always ignored.\r\n\r\n* Abandoned my fix and implemented RE2 to replace the built-in regex engine.\r\n\r\n* Removed the punycode validation I added because one of the operators does not work with RE2.\r\n\r\nCo-authored-by: Ben <beale.ben@gmail.com>\r\nCo-authored-by: Jamie Slome <55323451+JamieSlome@users.noreply.github.com>",
        "files": [
            {
                "sha": "2ed86d39299c5d4e7becee291aaa7a2ace3f8c04",
                "filename": "index.js",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/nescalante/urlregex/blob/e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9/index.js",
                "raw_url": "https://github.com/nescalante/urlregex/raw/e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9/index.js",
                "contents_url": "https://api.github.com/repos/nescalante/urlregex/contents/index.js?ref=e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9",
                "patch": "@@ -1,4 +1,6 @@\n 'use strict';\n+const RE2 = require(\"re2\");\n+\n \n module.exports = function (opts) {\n   var exact = (opts && opts.exact !== undefined) ? opts.exact : true;\n@@ -14,5 +16,5 @@ module.exports = function (opts) {\n   var path = '(?:[/?#][^\\\\s\"]*)?';\n   var regex = '(?:' + protocol + '|www\\\\.)' + auth + '(?:localhost|' + ip + '|' + host + domain + tld + ')' + port + path;\n \n-  return exact ? new RegExp('(?:^' + regex + '$)', 'i') : new RegExp(regex, 'ig');\n+  return exact ? new RE2('(?:^' + regex + '$)', 'i') : new RE2(regex, 'ig');\n };"
            },
            {
                "sha": "c7b68954b6cd579a923c681e0697a25c90287d15",
                "filename": "test/notmatch.js",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/nescalante/urlregex/blob/e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9/test%2Fnotmatch.js",
                "raw_url": "https://github.com/nescalante/urlregex/raw/e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9/test%2Fnotmatch.js",
                "contents_url": "https://api.github.com/repos/nescalante/urlregex/contents/test%2Fnotmatch.js?ref=e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9",
                "patch": "@@ -34,12 +34,14 @@ const fixtures = [\n   'http://foo.bar/ /',\n   'http://google\\\\.com',\n   'http://www(google.com',\n-  'http://www.example.xn--overly-long-punycode-test-string-test-tests-123-test-test123/',\n   'http://www=google.com',\n   'https://www.g.com/error\\n/bleh/bleh',\n   'rdar://1234',\n   '/foo.bar/',\n-  '///www.foo.bar./'\n+  '///www.foo.bar./',\n+  'http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321http://huntr.devtestvulnerability2312321.testvulnerability23',\n+  'http://asdf:asdf@huntr.devtestvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321.testvulnerability2312321',\n+  'http://www.example.xn--overly-long-punycode-test-string-test-tests-123-test-test123/'\n ];\n \n for (const x of fixtures) {"
            },
            {
                "sha": "4941ae021c9fb4751f84f5f288e3489a515cc492",
                "filename": "test/urlmatch.js",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/nescalante/urlregex/blob/e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9/test%2Furlmatch.js",
                "raw_url": "https://github.com/nescalante/urlregex/raw/e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9/test%2Furlmatch.js",
                "contents_url": "https://api.github.com/repos/nescalante/urlregex/contents/test%2Furlmatch.js?ref=e5a085afe6abfaea1d1a78f54c45af9ef43ca1f9",
                "patch": "@@ -11,7 +11,6 @@ const exactFixtures = [\n   'http://a.b.c.d.e.f.g.h.i.j.k.l.m.n.o.p.q.r.s.t.u.v.w.x.y.z.com',\n   'http://mw1.google.com/mw-earth-vectordb/kml-samples/gp/seattle/gigapxl/$[level]/r$[y]_c$[x].jpg',\n   'http://user:pass@example.com:123/one/two.three?q1=a1&q2=a2#body',\n-  'http://www.microsoft.xn--comindex-g03d.html.irongeek.com',\n   'http://\u272adf.ws/123',\n   'http://localhost/',\n   'http://userid:password@example.com:8080',\n@@ -60,6 +59,11 @@ const exactFixtures = [\n   'http://\u27a1.ws/\u4a39',\n   'www.google.com/unicorn',\n   'http://example.com.',\n+  'http://www.microsoft.xn--comindex-g03d.html.irongeek.com',\n+  'www.microsoft.xn--comindex-g03d.html.irongeek.com',\n+  'http://xn--addas-o4a.de/',\n+  'xn--aerlngus-j80d.com',\n+  'xn--sngaporeair-zzb.com'\n ];\n \n const notExactFixtures = ["
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/sse-secure-systems/connaisseur/commits/524b73ff7306707f6d3a4d1e86401479bca91b02",
        "url": "https://api.github.com/repos/sse-secure-systems/connaisseur/commits/524b73ff7306707f6d3a4d1e86401479bca91b02",
        "html_url": "https://github.com/sse-secure-systems/connaisseur/commit/524b73ff7306707f6d3a4d1e86401479bca91b02",
        "message": "sec: Prevent ReDoS during delegation validation\n\nThis commit fixes a regular expression denial of service vulnerability that was present during the schema validation of the targets.json TUF file in a Notary validation. An adversary with the ability to alter Notary responses, in particular an evil Notary server, could have provided Connaisseur with a malformed targets.json, which would have led to catastrophic (exponential) backtracking during regex matching. Exploitability was contingent on the presence of a notaryv1 validator in the Connaisseur configuration, which is the default as both DockerHub's and Connaisseur's Notary root keys are present in the default values.yaml.",
        "files": [
            {
                "sha": "f4290e7193bbdbff683d4a7c157049348e6fe6b5",
                "filename": "connaisseur/res/targets_schema.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/sse-secure-systems/connaisseur/blob/524b73ff7306707f6d3a4d1e86401479bca91b02/connaisseur%2Fres%2Ftargets_schema.json",
                "raw_url": "https://github.com/sse-secure-systems/connaisseur/raw/524b73ff7306707f6d3a4d1e86401479bca91b02/connaisseur%2Fres%2Ftargets_schema.json",
                "contents_url": "https://api.github.com/repos/sse-secure-systems/connaisseur/contents/connaisseur%2Fres%2Ftargets_schema.json?ref=524b73ff7306707f6d3a4d1e86401479bca91b02",
                "patch": "@@ -75,7 +75,7 @@\n                                     },\n                                     \"name\": {\n                                         \"type\": \"string\",\n-                                        \"pattern\": \"^targets/([a-z\\\\d][a-z\\\\d_-]*)+$\"\n+                                        \"pattern\": \"^targets/[a-z\\\\d][a-z\\\\d_-]*$\"\n                                     },\n                                     \"paths\": {\n                                         \"type\": \"array\","
            },
            {
                "sha": "3a9f700283c4b9a5301f27adaa99e67b8d9a480b",
                "filename": "docs/SECURITY.md",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/sse-secure-systems/connaisseur/blob/524b73ff7306707f6d3a4d1e86401479bca91b02/docs%2FSECURITY.md",
                "raw_url": "https://github.com/sse-secure-systems/connaisseur/raw/524b73ff7306707f6d3a4d1e86401479bca91b02/docs%2FSECURITY.md",
                "contents_url": "https://api.github.com/repos/sse-secure-systems/connaisseur/contents/docs%2FSECURITY.md?ref=524b73ff7306707f6d3a4d1e86401479bca91b02",
                "patch": "@@ -12,6 +12,7 @@ We stick to semantic versioning, so unless the major version changes, updating C\n | - | - | - | - |\n | initContainers not validated | <span>&#8804;</span> 1.3.0 | 1.3.1 | Prior to version 1.3.1 Connaisseur did not validate initContainers which allowed deploying unverified images to the cluster. |\n | Ephemeral containers not validated | <span>&#8804;</span> 3.1.1 | 3.2.0 | Prior to version 3.2.0 Connaisseur did not validate ephemeral containers (introduced in k8s 1.25) which allowed deploying unverified images to the cluster. |\n+| Regex Denial of Service for Notary delegations | <span>&#8804;</span> 3.3.0 | 3.3.1 | Prior to version 3.3.1 Connaisseur did input validation on the names of delegations in an unsafe manner: An adversary with the ability to alter Notary responses, in particular an evil Notary server, could have provided Connaisseur with an invalid delegation name that would lead to catastrophic backtracking during a regex matching. Only users of type `notaryv1` validators are affected as Connaisseur will only perform this kind of input validation in the context of a Notary validation. If you mistrust the Docker Notary server, the default configuration is vulnerable as it contains a `notaryv1` validator with the root keys of both Connaisseur and the library of official Docker images. |\n \n ## Reporting a vulnerability\n "
            },
            {
                "sha": "3000b263bb9cfec3cc4b8174052013204a34e00e",
                "filename": "tests/data/trust_data/redos_targets.json",
                "status": "added",
                "additions": 45,
                "deletions": 0,
                "changes": 45,
                "blob_url": "https://github.com/sse-secure-systems/connaisseur/blob/524b73ff7306707f6d3a4d1e86401479bca91b02/tests%2Fdata%2Ftrust_data%2Fredos_targets.json",
                "raw_url": "https://github.com/sse-secure-systems/connaisseur/raw/524b73ff7306707f6d3a4d1e86401479bca91b02/tests%2Fdata%2Ftrust_data%2Fredos_targets.json",
                "contents_url": "https://api.github.com/repos/sse-secure-systems/connaisseur/contents/tests%2Fdata%2Ftrust_data%2Fredos_targets.json?ref=524b73ff7306707f6d3a4d1e86401479bca91b02",
                "patch": "@@ -0,0 +1,45 @@\n+{\n+    \"signed\": {\n+        \"_type\": \"Targets\",\n+        \"delegations\": {\n+            \"keys\": {\n+                \"6984a67934a29955b3f969835c58ee0dd09158f5bec43726d319515b56b0a878\": {\n+                    \"keytype\": \"ecdsa\",\n+                    \"keyval\": {\n+                        \"private\": null,\n+                        \"public\": \"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEEchQNiJJt4PTaEeAzaztL+TQZqTa0iM0YSf+w0LjSElobVsYgnqIbCWe6pGX3UvcCngNw7N4uGkdVNVMS2Tslg==\"\n+                    }\n+                },\n+                \"70aa109003a93131c63499c70dcfc8db3ba33ca81bdd1abcd52c067a8acc0492\": {\n+                    \"keytype\": \"ecdsa\",\n+                    \"keyval\": {\n+                        \"private\": null,\n+                        \"public\": \"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEM0xl8F5nwIV3IAru1Pf85WCo4cfTOQ91jhxVaQ3xHMeW430q7R4H/tJmAXUZBe+nOTX8pgtmrLpT+Hu/H7pUhw==\"\n+                    }\n+                }\n+            },\n+            \"roles\": [\n+                {\n+                    \"keyids\": [\n+                        \"70aa109003a93131c63499c70dcfc8db3ba33ca81bdd1abcd52c067a8acc0492\"\n+                    ],\n+                    \"name\": \"targets/abababababababababababababababababababababababababababababab*\",\n+                    \"paths\": [\n+                        \"\"\n+                    ],\n+                    \"threshold\": 1\n+                }\n+            ]\n+        },\n+        \"expires\": \"2023-01-12T16:55:17.056146761+01:00\",\n+        \"targets\": {},\n+        \"version\": 3\n+    },\n+    \"signatures\": [\n+        {\n+            \"keyid\": \"7c62922e6be165f1ea08252f77410152b9e4ec0d7bf4e69c1cc43f0e6c73da20\",\n+            \"method\": \"ecdsa\",\n+            \"sig\": \"ayUgIwW4LmtW+kuzHuyU7lkn8awoXlymBcXeO8j++JSAUpU3BSuFsBe7yx3SOOsxh57u+vWkCOzPdLEYVyQrqg==\"\n+        }\n+    ]\n+}"
            },
            {
                "sha": "5cbd55203af5c5dda286f403f89dc04752249dd1",
                "filename": "tests/validators/notaryv1/test_trust_data.py",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/sse-secure-systems/connaisseur/blob/524b73ff7306707f6d3a4d1e86401479bca91b02/tests%2Fvalidators%2Fnotaryv1%2Ftest_trust_data.py",
                "raw_url": "https://github.com/sse-secure-systems/connaisseur/raw/524b73ff7306707f6d3a4d1e86401479bca91b02/tests%2Fvalidators%2Fnotaryv1%2Ftest_trust_data.py",
                "contents_url": "https://api.github.com/repos/sse-secure-systems/connaisseur/contents/tests%2Fvalidators%2Fnotaryv1%2Ftest_trust_data.py?ref=524b73ff7306707f6d3a4d1e86401479bca91b02",
                "patch": "@@ -247,6 +247,12 @@\n         (fix.get_td(\"sample7_targets\"), \"targets\", \"TargetsData\", fix.no_exc()),\n         (fix.get_td(\"sample7_snapshot\"), \"snapshot\", \"SnapshotData\", fix.no_exc()),\n         (fix.get_td(\"missing_path\"), \"targets\", \"TargetsData\", fix.no_exc()),\n+        (\n+            fix.get_td(\"redos_targets\"),\n+            \"targets\",\n+            \"TargetsData\",\n+            pytest.raises(exc.InvalidTrustDataFormatError),\n+        ),\n     ],\n )\n def test_trust_data_init(m_trust_data, data: dict, role: str, class_: str, exception):"
            }
        ]
    }
]
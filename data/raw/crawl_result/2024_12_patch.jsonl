[
    {
        "query_url": "https://api.github.com/repos/TreasureHuntGame/TreasureHunt/commits/8bcc649abc35b7734951be084bb522a532faac4e",
        "url": "https://api.github.com/repos/TreasureHuntGame/TreasureHunt/commits/8bcc649abc35b7734951be084bb522a532faac4e",
        "html_url": "https://github.com/TreasureHuntGame/TreasureHunt/commit/8bcc649abc35b7734951be084bb522a532faac4e",
        "message": "fix(acesso.php e checkflag.php): SQL Injection",
        "files": [
            {
                "sha": "37c4e4e9efe0639ef939c25150dae92f5ccb5193",
                "filename": "TreasureHunt/acesso.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/TreasureHuntGame/TreasureHunt/blob/8bcc649abc35b7734951be084bb522a532faac4e/TreasureHunt%2Facesso.php",
                "raw_url": "https://github.com/TreasureHuntGame/TreasureHunt/raw/8bcc649abc35b7734951be084bb522a532faac4e/TreasureHunt%2Facesso.php",
                "contents_url": "https://api.github.com/repos/TreasureHuntGame/TreasureHunt/contents/TreasureHunt%2Facesso.php?ref=8bcc649abc35b7734951be084bb522a532faac4e",
                "patch": "@@ -4,7 +4,7 @@\n require_once 'conexao.php';\r\n \r\n // filtrar input do id de usu\u00e1rio\r\n-$usuario = filter_input(INPUT_POST, 'usuario');\r\n+$usuario = filter_input(INPUT_POST, 'usuario', FILTER_SANITIZE_NUMBER_INT);\r\n // \"montar\" comando sql, prepar\u00e1-lo, inserir vari\u00e1veis e executar\r\n //$sql = \"SELECT * FROM Usuario where id='$usuario'\";\r\n $sql = \"SELECT * FROM Usuario where id=:usuario\";\r\n@@ -52,4 +52,4 @@\n }\r\n else { // se o primeiro select n\u00e3o retornou us\u00e1rio \u00e9 porque o id est\u00e1 incorreto\r\n \theader('Location:index.php?message=user_error');\r\n-}\n\\ No newline at end of file\n+}\r"
            },
            {
                "sha": "670daf8c7139d5523d25dcf7f10dc1827dcba1f2",
                "filename": "TreasureHunt/checkflag.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/TreasureHuntGame/TreasureHunt/blob/8bcc649abc35b7734951be084bb522a532faac4e/TreasureHunt%2Fcheckflag.php",
                "raw_url": "https://github.com/TreasureHuntGame/TreasureHunt/raw/8bcc649abc35b7734951be084bb522a532faac4e/TreasureHunt%2Fcheckflag.php",
                "contents_url": "https://api.github.com/repos/TreasureHuntGame/TreasureHunt/contents/TreasureHunt%2Fcheckflag.php?ref=8bcc649abc35b7734951be084bb522a532faac4e",
                "patch": "@@ -16,7 +16,7 @@ function console_log($data) {\n \techo '</script>';\r\n }\r\n \r\n-$problema = filter_input(INPUT_POST, 'problema');\r\n+$problema = filter_input(INPUT_POST, 'problema', FILTER_SANITIZE_NUMBER_INT);\r\n $flagPura = filter_input(INPUT_POST, 'flag');\r\n $flagSemEspaco = preg_replace('/\\s/', '', $flagPura);\r\n $flagSemEspaco = str_replace('\\t', '', $flagSemEspaco);\r\n@@ -136,4 +136,4 @@ function atualiza($resposta, $usuario, $problema) {\n ?>\r\n <script>\r\n \twindow.setTimeout(\"location.href='home.php';\");\r\n-</script>\n\\ No newline at end of file\n+</script>\r"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/TreasureHuntGame/TreasureHunt/commits/8bcc649abc35b7734951be084bb522a532faac4e",
        "url": "https://api.github.com/repos/TreasureHuntGame/TreasureHunt/commits/8bcc649abc35b7734951be084bb522a532faac4e",
        "html_url": "https://github.com/TreasureHuntGame/TreasureHunt/commit/8bcc649abc35b7734951be084bb522a532faac4e",
        "message": "fix(acesso.php e checkflag.php): SQL Injection",
        "files": [
            {
                "sha": "37c4e4e9efe0639ef939c25150dae92f5ccb5193",
                "filename": "TreasureHunt/acesso.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/TreasureHuntGame/TreasureHunt/blob/8bcc649abc35b7734951be084bb522a532faac4e/TreasureHunt%2Facesso.php",
                "raw_url": "https://github.com/TreasureHuntGame/TreasureHunt/raw/8bcc649abc35b7734951be084bb522a532faac4e/TreasureHunt%2Facesso.php",
                "contents_url": "https://api.github.com/repos/TreasureHuntGame/TreasureHunt/contents/TreasureHunt%2Facesso.php?ref=8bcc649abc35b7734951be084bb522a532faac4e",
                "patch": "@@ -4,7 +4,7 @@\n require_once 'conexao.php';\r\n \r\n // filtrar input do id de usu\u00e1rio\r\n-$usuario = filter_input(INPUT_POST, 'usuario');\r\n+$usuario = filter_input(INPUT_POST, 'usuario', FILTER_SANITIZE_NUMBER_INT);\r\n // \"montar\" comando sql, prepar\u00e1-lo, inserir vari\u00e1veis e executar\r\n //$sql = \"SELECT * FROM Usuario where id='$usuario'\";\r\n $sql = \"SELECT * FROM Usuario where id=:usuario\";\r\n@@ -52,4 +52,4 @@\n }\r\n else { // se o primeiro select n\u00e3o retornou us\u00e1rio \u00e9 porque o id est\u00e1 incorreto\r\n \theader('Location:index.php?message=user_error');\r\n-}\n\\ No newline at end of file\n+}\r"
            },
            {
                "sha": "670daf8c7139d5523d25dcf7f10dc1827dcba1f2",
                "filename": "TreasureHunt/checkflag.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/TreasureHuntGame/TreasureHunt/blob/8bcc649abc35b7734951be084bb522a532faac4e/TreasureHunt%2Fcheckflag.php",
                "raw_url": "https://github.com/TreasureHuntGame/TreasureHunt/raw/8bcc649abc35b7734951be084bb522a532faac4e/TreasureHunt%2Fcheckflag.php",
                "contents_url": "https://api.github.com/repos/TreasureHuntGame/TreasureHunt/contents/TreasureHunt%2Fcheckflag.php?ref=8bcc649abc35b7734951be084bb522a532faac4e",
                "patch": "@@ -16,7 +16,7 @@ function console_log($data) {\n \techo '</script>';\r\n }\r\n \r\n-$problema = filter_input(INPUT_POST, 'problema');\r\n+$problema = filter_input(INPUT_POST, 'problema', FILTER_SANITIZE_NUMBER_INT);\r\n $flagPura = filter_input(INPUT_POST, 'flag');\r\n $flagSemEspaco = preg_replace('/\\s/', '', $flagPura);\r\n $flagSemEspaco = str_replace('\\t', '', $flagSemEspaco);\r\n@@ -136,4 +136,4 @@ function atualiza($resposta, $usuario, $problema) {\n ?>\r\n <script>\r\n \twindow.setTimeout(\"location.href='home.php';\");\r\n-</script>\n\\ No newline at end of file\n+</script>\r"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/gristlabs/grist-core/commits/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
        "url": "https://api.github.com/repos/gristlabs/grist-core/commits/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
        "html_url": "https://github.com/gristlabs/grist-core/commit/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
        "message": "(core) Fix attachment and hyperlink vulnerabilities\n\nSummary:\nAttachments were prone to XSS-based attacks if attachments injected with scripts\nwere previewed or opened. This is now addressed by CSP.\n\nHyperlink cells were prone to similar attacks if `javascript:...` URLs were inserted into\ncells. This has also been addressed by sanitizing URLs.\n\nThank you to Florent <florent.git@zeteo.me> and Gr\u00e9goire Cutzach <gregoire@cutzach.com>\nfor reporting and co-authoring these changes.\n\nCo-authored-by: Florent <florent.git@zeteo.me>\nCo-authored-by: Gr\u00e9goire Cutzach <gregoire@cutzach.com>\n\nTest Plan: Browser and unit tests.\n\nReviewers: dsagal, paulfitz\n\nReviewed By: dsagal, paulfitz\n\nSubscribers: dsagal, paulfitz, fflorent\n\nDifferential Revision: https://phab.getgrist.com/D4413",
        "files": [
            {
                "sha": "9c853c098693d541446d8c0c8add0d509e4d62dd",
                "filename": "app/client/components/WidgetFrame.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fcomponents%2FWidgetFrame.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fcomponents%2FWidgetFrame.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fcomponents%2FWidgetFrame.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -5,14 +5,15 @@ import {GristDoc} from 'app/client/components/GristDoc';\n import {hooks} from 'app/client/Hooks';\n import {get as getBrowserGlobals} from 'app/client/lib/browserGlobals';\n import {makeTestId} from 'app/client/lib/domUtils';\n+import {sanitizeHttpUrl} from 'app/client/lib/sanitizeUrl';\n import {ColumnRec, ViewSectionRec} from 'app/client/models/DocModel';\n import {reportError} from 'app/client/models/errors';\n import {gristThemeObs} from 'app/client/ui2018/theme';\n import {AccessLevel, ICustomWidget, isSatisfied, matchWidget} from 'app/common/CustomWidget';\n import {DisposableWithEvents} from 'app/common/DisposableWithEvents';\n import {BulkColValues, fromTableDataAction, RowRecord} from 'app/common/DocActions';\n import {extractInfoFromColType, reencodeAsAny} from 'app/common/gristTypes';\n-import {getGristConfig, sanitizeUrl} from 'app/common/urlUtils';\n+import {getGristConfig} from 'app/common/urlUtils';\n import {\n   AccessTokenOptions, CursorPos, CustomSectionAPI, FetchSelectedOptions, GristDocAPI, GristView,\n   InteractionOptionsRequest, WidgetAPI, WidgetColumnMap\n@@ -242,7 +243,7 @@ export class WidgetFrame extends DisposableWithEvents {\n     // Append user and document preferences to query string.\n     const settingsParams = new URLSearchParams(this._options.preferences);\n     settingsParams.forEach((value, key) => urlObj.searchParams.append(key, value));\n-    return sanitizeUrl(urlObj.href);\n+    return sanitizeHttpUrl(urlObj.href);\n   }\n \n   private _getEmptyWidgetPage(): string {"
            },
            {
                "sha": "99fdea3adea38bc8b91a7858e9714bf670326a28",
                "filename": "app/client/lib/sanitizeUrl.ts",
                "status": "added",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Flib%2FsanitizeUrl.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Flib%2FsanitizeUrl.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Flib%2FsanitizeUrl.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,42 @@\n+import DOMPurify from \"dompurify\";\n+\n+// Export dependencies for stubbing in tests.\n+export const Deps = { DOMPurify };\n+\n+/**\n+ * Returns the provided URL if it is valid and safe to use in\n+ * HTTP-only contexts, such as form redirects and custom widget\n+ * URLs.\n+ *\n+ * Returns `null` if the URL is invalid or unsafe.\n+ *\n+ * For sanitizing hyperlink URLs, such as those used by `a`\n+ * elements, see `sanitizeLinkUrl`.\n+ */\n+export function sanitizeHttpUrl(url: string): string | null {\n+  try {\n+    const parsedUrl = new URL(url);\n+    if (![\"http:\", \"https:\"].includes(parsedUrl.protocol)) {\n+      return null;\n+    }\n+\n+    return parsedUrl.href;\n+  } catch (e) {\n+    return null;\n+  }\n+}\n+\n+/**\n+ * Returns the provided URL if it is valid and safe to use for hyperlinks,\n+ * such as those used by `a` elements. This includes URLs prefixed with\n+ * `http[s]:`, `mailto:`, and `tel:`, and excludes URLs prefixed with\n+ * `javascript:`.\n+ *\n+ * Returns `null` if the URL is invalid or unsafe.\n+ *\n+ * For sanitizing HTTP-only URLs, such as those used for redirects, see\n+ * `sanitizeHttpUrl`.\n+ */\n+export function sanitizeLinkUrl(url: string): string | null {\n+  return Deps.DOMPurify.isValidAttribute(\"a\", \"href\", url) ? url : null;\n+}"
            },
            {
                "sha": "d76911668b73a970ddcf9aed235ec3065b90377d",
                "filename": "app/client/ui/FormPage.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fui%2FFormPage.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fui%2FFormPage.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fui%2FFormPage.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -1,14 +1,15 @@\n import {FormRenderer} from 'app/client/components/FormRenderer';\n import {handleSubmit, TypedFormData} from 'app/client/lib/formUtils';\n import {makeT} from 'app/client/lib/localization';\n+import {sanitizeHttpUrl} from 'app/client/lib/sanitizeUrl';\n import {FormModel, FormModelImpl} from 'app/client/models/FormModel';\n import {buildFormFooter} from 'app/client/ui/FormContainer';\n import {FormErrorPage} from 'app/client/ui/FormErrorPage';\n import {FormSuccessPage} from 'app/client/ui/FormSuccessPage';\n import {colors} from 'app/client/ui2018/cssVars';\n import {ApiError} from 'app/common/ApiError';\n import {getPageTitleSuffix} from 'app/common/gristUrls';\n-import {getGristConfig, sanitizeUrl} from 'app/common/urlUtils';\n+import {getGristConfig} from 'app/common/urlUtils';\n import {Disposable, dom, makeTestId, Observable, styled, subscribe} from 'grainjs';\n \n const t = makeT('FormPage');\n@@ -90,7 +91,7 @@ export class FormPage extends Disposable {\n \n     const {successURL} = formLayout;\n     if (successURL) {\n-      const url = sanitizeUrl(successURL);\n+      const url = sanitizeHttpUrl(successURL);\n       if (url) {\n         window.location.href = url;\n       }"
            },
            {
                "sha": "8b4c32ea27969f05f219433354aefc62e70258d7",
                "filename": "app/client/ui/sanitizeHTML.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fui%2FsanitizeHTML.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fui%2FsanitizeHTML.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fui%2FsanitizeHTML.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -24,10 +24,10 @@ function handleSanitizeAttribute(node: Element) {\n   node.setAttribute('target', '_blank');\n }\n \n-function handleSanitizeTutorialElement(node: Element, data: createDOMPurifier.SanitizeElementHookEvent) {\n+function handleSanitizeTutorialElement(node: Node, data: createDOMPurifier.UponSanitizeElementHookEvent) {\n   if (data.tagName !== 'iframe') { return; }\n \n-  const src = node.getAttribute('src');\n+  const src = (node as Element).getAttribute('src');\n   if (src?.startsWith('https://www.youtube.com/embed/')) {\n     return;\n   }"
            },
            {
                "sha": "e8c9549d2ab7bd41df3529d73ab78c7935435eec",
                "filename": "app/client/widgets/HyperLinkTextBox.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fwidgets%2FHyperLinkTextBox.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fwidgets%2FHyperLinkTextBox.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fwidgets%2FHyperLinkTextBox.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -1,3 +1,4 @@\n+import { sanitizeLinkUrl } from 'app/client/lib/sanitizeUrl';\n import { DataRowModel } from 'app/client/models/DataRowModel';\n import { ViewFieldRec } from 'app/client/models/entities/ViewFieldRec';\n import { constructUrl } from 'app/client/models/gristUrlState';\n@@ -20,7 +21,10 @@ export class HyperLinkTextBox extends NTextBox {\n \n   public buildDom(row: DataRowModel) {\n     const value = row.cells[this.field.colId()];\n-    const url = Computed.create(null, (use) => constructUrl(use(value)));\n+    const url = Computed.create(\n+      null,\n+      (use) => sanitizeLinkUrl(constructUrl(use(value))) ?? \"about:blank\"\n+    );\n     return cssFieldClip(\n       dom.autoDispose(url),\n       dom.style('text-align', this.alignment),"
            },
            {
                "sha": "3a2310be3b759f949a3c60fcbf4837104fe13781",
                "filename": "app/common/urlUtils.ts",
                "status": "modified",
                "additions": 0,
                "deletions": 17,
                "changes": 17,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fcommon%2FurlUtils.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fcommon%2FurlUtils.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fcommon%2FurlUtils.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -79,20 +79,3 @@ export function fetchFromHome(path: string, opts: RequestInit): Promise<Response\n   const baseUrl = addCurrentOrgToPath(getGristConfig().homeUrl!);\n   return window.fetch(`${baseUrl}${path}`, opts);\n }\n-\n-/**\n- * Returns the provided URL if it has a valid protocol (`http:` or `https:`), or\n- * `null` otherwise.\n- */\n-export function sanitizeUrl(url: string): string | null {\n-  try {\n-    const parsedUrl = new URL(url);\n-    if (![\"http:\", \"https:\"].includes(parsedUrl.protocol)) {\n-      return null;\n-    }\n-\n-    return parsedUrl.href;\n-  } catch (e) {\n-    return null;\n-  }\n-}"
            },
            {
                "sha": "8529acde856a3077460fd8b27696d1542c649306",
                "filename": "app/server/lib/DocWorker.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fserver%2Flib%2FDocWorker.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fserver%2Flib%2FDocWorker.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fserver%2Flib%2FDocWorker.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -61,6 +61,7 @@ export class DocWorker {\n         .type(ext)\n         .set('Content-Disposition', contentDispHeader)\n         .set('Cache-Control', 'private, max-age=3600')\n+        .set(\"Content-Security-Policy\", \"sandbox; default-src: 'none'\")\n         .send(data);\n     } catch (err) {\n       res.status(404).send({error: err.toString()});"
            },
            {
                "sha": "05c56d42874c7e021495a5753e26da4f93c51851",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/package.json",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/package.json",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/package.json?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -49,7 +49,6 @@\n     \"@types/chai-as-promised\": \"7.1.0\",\n     \"@types/content-disposition\": \"0.5.2\",\n     \"@types/diff-match-patch\": \"1.0.32\",\n-    \"@types/dompurify\": \"3.0.5\",\n     \"@types/double-ended-queue\": \"2.1.0\",\n     \"@types/express\": \"4.17.17\",\n     \"@types/form-data\": \"2.2.1\",\n@@ -139,7 +138,7 @@\n     \"csv\": \"6.3.8\",\n     \"currency-symbol-map\": \"5.1.0\",\n     \"diff-match-patch\": \"1.0.5\",\n-    \"dompurify\": \"3.0.6\",\n+    \"dompurify\": \"3.2.3\",\n     \"double-ended-queue\": \"2.1.0-0\",\n     \"engine.io\": \"^6.5.4\",\n     \"engine.io-client\": \"^6.5.3\","
            },
            {
                "sha": "462a1866958ba7fc15dd594d989309072e921a99",
                "filename": "test/client/lib/sanitizeUrl.ts",
                "status": "added",
                "additions": 71,
                "deletions": 0,
                "changes": 71,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fclient%2Flib%2FsanitizeUrl.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fclient%2Flib%2FsanitizeUrl.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fclient%2Flib%2FsanitizeUrl.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,71 @@\n+import {\n+  Deps,\n+  sanitizeHttpUrl,\n+  sanitizeLinkUrl,\n+} from \"app/client/lib/sanitizeUrl\";\n+import { assert } from \"chai\";\n+import DOMPurify from \"dompurify\";\n+import { JSDOM } from \"jsdom\";\n+import * as sinon from \"sinon\";\n+\n+describe(\"sanitizeUrl\", function () {\n+  let sandbox: sinon.SinonSandbox;\n+\n+  beforeEach(function () {\n+    // These grainjs browserGlobals are needed for using dom() in tests.\n+    const jsdomDoc = new JSDOM(\"<!doctype html><html><body></body></html>\");\n+    sandbox = sinon.createSandbox();\n+    sandbox.stub(Deps, \"DOMPurify\").value(DOMPurify(jsdomDoc.window));\n+  });\n+\n+  afterEach(function () {\n+    sandbox.restore();\n+  });\n+\n+  describe(\"sanitizeHttpUrl\", function () {\n+    it(\"returns the provided URL if valid\", function () {\n+      assert.equal(\n+        sanitizeHttpUrl(\"https://example.com\"),\n+        \"https://example.com/\"\n+      );\n+      assert.equal(\n+        sanitizeHttpUrl(\"http://example.com\"),\n+        \"http://example.com/\"\n+      );\n+    });\n+\n+    it(\"returns null if the provided URL is invalid\", function () {\n+      assert.isNull(sanitizeHttpUrl(\"www.example.com\"));\n+      assert.isNull(sanitizeHttpUrl(\"\"));\n+      assert.isNull(sanitizeHttpUrl(\"invalid\"));\n+      assert.isNull(sanitizeHttpUrl(\"mailto:support@getgrist.com\"));\n+      assert.isNull(sanitizeHttpUrl(\"ftp://getgrist.com/path\"));\n+      assert.isNull(sanitizeHttpUrl(\"javascript:alert()\"));\n+    });\n+  });\n+\n+  describe(\"sanitizeLinkUrl\", function () {\n+    it(\"returns the provided URL if valid\", function () {\n+      assert.equal(\n+        sanitizeLinkUrl(\"https://example.com\"),\n+        \"https://example.com\"\n+      );\n+      assert.equal(sanitizeLinkUrl(\"http://example.com\"), \"http://example.com\");\n+      assert.equal(sanitizeLinkUrl(\"www.example.com\"), \"www.example.com\");\n+      assert.equal(sanitizeLinkUrl(\"\"), \"\");\n+      assert.equal(\n+        sanitizeLinkUrl(\"mailto:support@getgrist.com\"),\n+        \"mailto:support@getgrist.com\"\n+      );\n+      assert.equal(sanitizeLinkUrl(\"tel:0123456789\"), \"tel:0123456789\");\n+      assert.equal(\n+        sanitizeLinkUrl(\"ftp://getgrist.com/path\"),\n+        \"ftp://getgrist.com/path\"\n+      );\n+    });\n+\n+    it(\"returns null if the provided URL is unsafe\", function () {\n+      assert.isNull(sanitizeLinkUrl(\"javascript:alert()\"));\n+    });\n+  });\n+});"
            },
            {
                "sha": "e655be6991f38b7abdb862522b64c2039ae846c8",
                "filename": "test/common/urlUtils.ts",
                "status": "removed",
                "additions": 0,
                "deletions": 24,
                "changes": 24,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/6996ea3037104b98ce79978688905f565f199025/test%2Fcommon%2FurlUtils.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/6996ea3037104b98ce79978688905f565f199025/test%2Fcommon%2FurlUtils.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fcommon%2FurlUtils.ts?ref=6996ea3037104b98ce79978688905f565f199025",
                "patch": "@@ -1,24 +0,0 @@\n-import { sanitizeUrl } from \"app/common/urlUtils\";\n-import { assert } from \"chai\";\n-\n-describe(\"urlUtils\", function () {\n-  describe(\"sanitizeUrl\", function () {\n-    it(\"returns the provided URL if the scheme is http[s]\", function () {\n-      assert.equal(sanitizeUrl(\"https://example.com\"), \"https://example.com/\");\n-      assert.equal(sanitizeUrl(\"http://example.com\"), \"http://example.com/\");\n-      assert.equal(sanitizeUrl(\"https://example.com\"), \"https://example.com/\");\n-    });\n-\n-    it(\"returns null if the provided URL is invalid\", function () {\n-      assert.isNull(sanitizeUrl(\"www.example.com\"));\n-      assert.isNull(sanitizeUrl(\"\"));\n-      assert.isNull(sanitizeUrl(\"invalid\"));\n-    });\n-\n-    it(\"returns null if the provided URL's scheme is not http[s]\", function () {\n-      assert.isNull(sanitizeUrl(\"mailto:support@getgrist.com.com\"));\n-      assert.isNull(sanitizeUrl(\"ftp://getgrist.com/path\"));\n-      assert.isNull(sanitizeUrl(\"javascript:alert()\"));\n-    });\n-  });\n-});"
            },
            {
                "sha": "6acfaf8c27c12a665a9d8a21567c2ae6eab70793",
                "filename": "test/fixtures/uploads/image_with_script.svg",
                "status": "added",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Ffixtures%2Fuploads%2Fimage_with_script.svg",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Ffixtures%2Fuploads%2Fimage_with_script.svg",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Ffixtures%2Fuploads%2Fimage_with_script.svg?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,6 @@\n+<svg version=\"1.1\" baseProfile=\"full\" xmlns=\"http://www.w3.org/2000/svg\">\n+  <polygon id=\"triangle\" points=\"0,0 0,50 50,0\" fill=\"#009900\" stroke=\"#004400\"/>\n+  <script type=\"text/javascript\">\n+    alert('I should not appear');\n+  </script>\n+</svg>"
            },
            {
                "sha": "e15aed1759e53253c2964cc197247beed5381da7",
                "filename": "test/nbrowser/AttachmentsWidget.ts",
                "status": "added",
                "additions": 548,
                "deletions": 0,
                "changes": 548,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fnbrowser%2FAttachmentsWidget.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fnbrowser%2FAttachmentsWidget.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fnbrowser%2FAttachmentsWidget.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,548 @@\n+import {\n+  assert,\n+  driver,\n+  Key,\n+  stackWrapFunc,\n+  WebElement,\n+} from \"mocha-webdriver\";\n+import fetch from \"node-fetch\";\n+import * as gu from \"test/nbrowser/gristUtils\";\n+import { server, setupTestSuite } from \"test/nbrowser/testUtils\";\n+\n+describe(\"AttachmentsWidget\", function () {\n+  this.timeout(20000);\n+  setupTestSuite();\n+  let docId: string;\n+\n+  before(async function () {\n+    docId = (\n+      await gu.importFixturesDoc(\n+        \"chimpy\",\n+        \"nasa\",\n+        \"Horizon\",\n+        \"Hello.grist\",\n+        false\n+      )\n+    ).id;\n+    await server.simulateLogin(\"Chimpy\", \"chimpy@getgrist.com\", \"nasa\");\n+    await gu.loadDoc(`/o/nasa/doc/${docId}`);\n+  });\n+\n+  afterEach(async function () {\n+    await gu.checkForErrors();\n+  });\n+\n+  after(async function () {\n+    // Close any open cell/attachments editor, to avoid an unload alert that would interfere with\n+    // the next test suite.\n+    await driver.sendKeys(Key.ESCAPE);\n+  });\n+\n+  // Returns the 'title' attributes of all attachments in the given cell. These should be the\n+  // names of the attached files.\n+  const getCellThumbnailTitles = stackWrapFunc(async function (\n+    cell: WebElement\n+  ) {\n+    return await cell.findAll(\".test-pw-thumbnail\", (el) =>\n+      el.getAttribute(\"title\")\n+    );\n+  });\n+\n+  it(\"should include a functioning attachment widget\", async function () {\n+    await gu.toggleSidePanel(\"right\", \"open\");\n+    await driver.find(\".test-right-tab-field\").click();\n+\n+    // Move to first column\n+    await gu.getCell(0, 1).click();\n+\n+    // Change type to Attachment.\n+    await gu.setType(/Attachment/);\n+    await driver.findWait(\".test-type-transform-apply\", 1000).click();\n+    await gu.waitForServer();\n+    assert.equal(\n+      await gu.getCell(0, 2).find(\".test-attachment-widget\").isDisplayed(),\n+      true\n+    );\n+  });\n+\n+  it(\"should include a functioning upload button\", async function () {\n+    // Put 'foo1' in a cell, then replace it immediately with 'foo2'.\n+    // This is just setting up for testing undo behaviour below.\n+    await gu.getCell(1, 2).click();\n+    await driver.sendKeys(\"foo1\", Key.ENTER);\n+    await gu.getCell(1, 2).click();\n+    await driver.sendKeys(\"foo2\", Key.ENTER);\n+\n+    await gu.getCell(0, 2).click();\n+    await driver.sendKeys(Key.ENTER);\n+\n+    await gu.fileDialogUpload(\"uploads/sample.pdf,uploads/grist.png\", () =>\n+      driver.find(\".test-pw-add\").click()\n+    );\n+    await driver.findContentWait(\".test-pw-counter\", /of 2/, 3000);\n+\n+    const href: string = await driver\n+      .findWait(\".test-pw-download\", 2000)\n+      .getAttribute(\"href\");\n+    assert.include(href.split(\"name=\")[1], \"sample.pdf\");\n+    assert.equal(await driver.find(\".test-pw-counter\").getText(), \"1 of 2\");\n+    await driver.find(\".test-modal-dialog .test-pw-close\").click();\n+    await gu.waitForServer();\n+\n+    // Check that title attributes are set to file names.\n+    assert.deepEqual(await getCellThumbnailTitles(gu.getCell(0, 2)), [\n+      \"sample.pdf\",\n+      \"grist.png\",\n+    ]);\n+\n+    // Check that in the absence of a thumbnail we show the extension.\n+    assert.deepEqual(\n+      await gu\n+        .getCell(0, 2)\n+        .findAll(\".test-pw-thumbnail\", (el) => el.getText()),\n+      [\"PDF\", \"\"]\n+    );\n+\n+    async function checkState(expectedCells: string[], isSoftDeleted: boolean) {\n+      assert.deepEqual(\n+        await gu.getVisibleGridCells({ cols: [0, 1], rowNums: [2] }),\n+        expectedCells\n+      );\n+\n+      // Previously, undo would remove the uploaded attachment metadata completely,\n+      // which could lead to hard deleting the file data and leaving broken attachments after redo.\n+      // Here we check that after checking for unused attachments and removing expired ones\n+      // (as should happen automatically every hour)\n+      // the metadata records (and thus files) are still there, but appropriately marked as soft deleted.\n+      const headers = { Authorization: \"Bearer api_key_for_chimpy\" };\n+      const url = server.getUrl(\"nasa\", `/api/docs/${docId}`);\n+      let resp = await fetch(\n+        url + \"/attachments/removeUnused?verifyfiles=1&expiredonly=1\",\n+        { headers, method: \"POST\" }\n+      );\n+      assert.equal(resp.status, 200);\n+      resp = await fetch(url + \"/tables/_grist_Attachments/records\", {\n+        headers,\n+      });\n+      const data = await resp.json();\n+      assert.lengthOf(data.records, 2);\n+      for (const record of data.records) {\n+        assert.equal(Boolean(record.fields.timeDeleted), isSoftDeleted);\n+      }\n+    }\n+\n+    // Check current state before testing undo/redo\n+    assert.deepEqual(\n+      await gu.getVisibleGridCells({ cols: [0, 1], rowNums: [2] }),\n+      [\"PDF\", \"foo2\"]\n+    );\n+    await checkState([\"PDF\", \"foo2\"], false);\n+\n+    // Check that undo once removes the attachments we just added to the cell\n+    await gu.undo();\n+    await checkState([\"\", \"foo2\"], true); // true: attachment metadata marked as soft deleted\n+\n+    // Check that undo again undoes the thing we did before attaching: changing foo1 to foo2\n+    // (previously it would undo creating the attachment metadata, which was invisible)\n+    await gu.undo();\n+    await checkState([\"\", \"foo1\"], true);\n+\n+    // Check that redoing twice restores things as expected\n+    await gu.redo();\n+    await checkState([\"\", \"foo2\"], true);\n+    await gu.redo();\n+    await checkState([\"PDF\", \"foo2\"], false); // false: attachment metadata un-deleted\n+  });\n+\n+  it(\"should allow resizing thumbnails\", async function () {\n+    const slider = await driver.find(\".test-pw-thumbnail-size\");\n+    assert.equal(\n+      (await driver.findWait(\".test-pw-thumbnail:last-child\", 1000).getRect())\n+        .height,\n+      36\n+    );\n+    for (let i = 0; i < 5; i++) {\n+      await slider.sendKeys(Key.RIGHT);\n+    }\n+    assert.equal(\n+      (await driver.find(\".test-pw-thumbnail:last-child\").getRect()).height,\n+      41\n+    );\n+    for (let i = 0; i < 3; i++) {\n+      await slider.sendKeys(Key.LEFT);\n+    }\n+    assert.equal(\n+      (await driver.find(\".test-pw-thumbnail:last-child\").getRect()).height,\n+      38\n+    );\n+    // Wait to ensure the new setting is saved.\n+    await driver.sleep(300);\n+\n+    // Thumbnail size setting should persist across refresh\n+    await driver.navigate().refresh();\n+    await gu.waitForServer(10000);\n+    assert.equal(\n+      (await driver.findWait(\".test-pw-thumbnail:last-child\", 1000).getRect())\n+        .height,\n+      38\n+    );\n+  });\n+\n+  it(\"should get correct headers from the server\", async function () {\n+    const cell: any = gu.getCell(0, 2);\n+    await cell.click();\n+    await driver.sendKeys(Key.ENTER);\n+\n+    const fetchOptions = {\n+      headers: { Authorization: \"Bearer api_key_for_chimpy\" },\n+    };\n+    const hrefDownload = await driver\n+      .findWait(\".test-pw-download\", 500)\n+      .getAttribute(\"href\");\n+    const respDownload = await fetch(hrefDownload, fetchOptions);\n+    assert.equal(\n+      respDownload.headers.get(\"Content-Disposition\"),\n+      'attachment; filename=\"sample.pdf\"'\n+    );\n+    assert.equal(\n+      respDownload.headers.get(\"Content-Security-Policy\"),\n+      \"sandbox; default-src: 'none'\"\n+    );\n+\n+    const hrefInline = await driver\n+      .find(\".test-pw-attachment-content\")\n+      .getAttribute(\"data\");\n+    const respInline = await fetch(hrefInline, fetchOptions);\n+    assert.equal(\n+      respInline.headers.get(\"Content-Disposition\"),\n+      'inline; filename=\"sample.pdf\"'\n+    );\n+\n+    // Attach an html file and ensure it doesn't get served inline.\n+    await gu.fileDialogUpload(\"uploads/htmlfile.html\", () =>\n+      driver.findWait(\".test-pw-add\", 500).click()\n+    );\n+    await driver.findContentWait(\".test-pw-counter\", /of 3/, 3000);\n+\n+    const hrefLinkHtml = await driver\n+      .findWait(\".test-pw-download\", 2000)\n+      .getAttribute(\"href\");\n+    const respLinkHtml = await fetch(hrefLinkHtml, fetchOptions);\n+    // Note that the disposition here is NOT \"inline\" (that would be bad).\n+    assert.equal(\n+      respLinkHtml.headers.get(\"Content-Disposition\"),\n+      'attachment; filename=\"htmlfile.html\"'\n+    );\n+    await driver.find(\".test-modal-dialog .test-pw-close\").click();\n+  });\n+\n+  it(\"should allow editing the attachments list\", async function () {\n+    let cell = gu.getCell(0, 2);\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"sample.pdf\",\n+      \"grist.png\",\n+      \"htmlfile.html\",\n+    ]);\n+\n+    // Open an image preview.\n+    await driver.withActions((a) =>\n+      a.doubleClick(driver.find(\".test-pw-thumbnail\"))\n+    );\n+\n+    assert.equal(\n+      await driver.findWait(\".test-pw-counter\", 500).getText(),\n+      \"1 of 3\"\n+    );\n+\n+    // Assert that the attachment filename can be changed.\n+    await driver\n+      .find(\".test-pw-name\")\n+      .doClick()\n+      .sendKeys(\"renamed.pdf\", Key.ENTER);\n+    // Wait for doc name input to lose focus, indicating that the save call completed.\n+    await driver.findWait(\".test-bc-doc:not(:focus)\", 2000);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"renamed.pdf\");\n+\n+    // Assert that the attachment has the correct download link.\n+    const href = await driver.find(\".test-pw-download\").getAttribute(\"href\");\n+    assert.include(href, \"attId=1\");\n+    assert.include(href, \"name=renamed.pdf\");\n+\n+    // Assert that other previews can be viewed without closing the modal.\n+    await driver.find(\".test-pw-right\").click();\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"grist.png\");\n+    await driver.find(\".test-pw-left\").click();\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"renamed.pdf\");\n+    await driver.sendKeys(Key.RIGHT, Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"htmlfile.html\");\n+\n+    // Assert that the attachment can be removed from the cell.\n+    assert.equal(await driver.find(\".test-pw-counter\").getText(), \"3 of 3\");\n+    await driver.find(\".test-pw-remove\").click();\n+    await gu.waitForServer();\n+    assert.equal(await driver.find(\".test-pw-counter\").getText(), \"2 of 2\");\n+    await driver.find(\".test-modal-dialog .test-pw-close\").click();\n+    cell = gu.getCell(0, 2);\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+  });\n+\n+  it(\"should allow uploading to the add row\", async function () {\n+    assert.equal(await gu.getCell({ col: 0, rowNum: 6 }).isPresent(), false);\n+    const cell = await gu.getCell({ col: 0, rowNum: 5 });\n+\n+    await gu.fileDialogUpload(\"uploads/grist.png\", () =>\n+      cell.find(\".test-attachment-icon\").click()\n+    );\n+    await gu.waitToPass(async () =>\n+      assert.lengthOf(\n+        await gu.getCell({ col: 0, rowNum: 5 }).findAll(\".test-pw-thumbnail\"),\n+        1\n+      )\n+    );\n+\n+    assert.deepEqual(\n+      await getCellThumbnailTitles(gu.getCell({ col: 0, rowNum: 5 })),\n+      [\"grist.png\"]\n+    );\n+    // Assert that a row is added\n+    assert.equal(await gu.getCell({ col: 0, rowNum: 6 }).isPresent(), true);\n+  });\n+\n+  it(\"should not initialize as invalid when a row is added\", async function () {\n+    // The first cell is invalid, just to check that the assert is correct.\n+    let cell = gu.getCell({ col: 0, rowNum: 1 });\n+    assert.equal(await cell.getText(), \"hello\");\n+    assert.equal(await cell.find(\".field_clip\").matches(\".invalid\"), true);\n+    await cell.click();\n+    // Add a new row and ensure it's NOT invalid.\n+    await driver\n+      .find(\"body\")\n+      .sendKeys(Key.chord(await gu.modKey(), Key.SHIFT, Key.ENTER));\n+    await gu.waitForServer();\n+    cell = gu.getCell({ col: 0, rowNum: 1 });\n+    assert.equal(await cell.getText(), \"\");\n+    assert.equal(await cell.find(\".field_clip\").matches(\".invalid\"), false);\n+    await gu.undo();\n+  });\n+\n+  it(\"should open preview to double-clicked attachment\", async function () {\n+    const cell = gu.getCell({ col: 0, rowNum: 2 });\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+\n+    // Double-click the first attachment.\n+    await driver.withActions((a) =>\n+      a.doubleClick(cell.find(\".test-pw-thumbnail[title*=pdf]\"))\n+    );\n+    assert.equal(\n+      await driver.findWait(\".test-pw-counter\", 500).getText(),\n+      \"1 of 2\"\n+    );\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"renamed.pdf\");\n+    await driver.sendKeys(Key.ESCAPE);\n+\n+    // Double-click the second attachment.\n+    await driver.withActions((a) =>\n+      a.doubleClick(cell.find(\".test-pw-thumbnail[title*=png]\"))\n+    );\n+    assert.equal(\n+      await driver.findWait(\".test-pw-counter\", 500).getText(),\n+      \"2 of 2\"\n+    );\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"grist.png\");\n+    await driver.sendKeys(Key.ESCAPE);\n+  });\n+\n+  it(\"should render various types of files appropriately\", async function () {\n+    const cell = gu.getCell({ col: 0, rowNum: 2 });\n+    await cell.click();\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+    await gu.fileDialogUpload(\n+      \"uploads/file1.mov,uploads/file2.mp3,uploads/file3.zip,uploads/simple_array.json\",\n+      () => cell.find(\".test-attachment-icon\").click()\n+    );\n+    await gu.waitToPass(async () =>\n+      assert.lengthOf(await cell.findAll(\".test-pw-thumbnail\"), 6)\n+    );\n+    await gu.waitForServer();\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+      \"file1.mov\",\n+      \"file2.mp3\",\n+      \"file3.zip\",\n+      \"simple_array.json\",\n+    ]);\n+    await driver.sendKeys(Key.ENTER);\n+    assert.equal(\n+      await driver.findWait(\".test-pw-counter\", 500).getText(),\n+      \"1 of 6\"\n+    );\n+\n+    // For various recognized file types, see that a suitable element is created.\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"renamed.pdf\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"object\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"data\"),\n+      /name=renamed.pdf&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=1&inline=1/\n+    );\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"type\"),\n+      \"application/pdf\"\n+    );\n+\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"grist.png\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"img\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"src\"),\n+      /name=grist.png&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=2/\n+    );\n+\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"file1.mov\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"video\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"src\"),\n+      /name=file1.mov&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=5&inline=1/\n+    );\n+\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"file2.mp3\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"audio\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"src\"),\n+      /name=file2.mp3&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=6&inline=1/\n+    );\n+\n+    // Test that for an unsupported file, the extension is shown along with a message.\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"file3.zip\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"object\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"data\"),\n+      /name=file3.zip&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=7&inline=1/\n+    );\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getText(),\n+      \"ZIP\\nPreview not available.\"\n+    );\n+\n+    // Test the same for a text/json file that we also don't currently render.\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(\n+      await driver.find(\".test-pw-name\").value(),\n+      \"simple_array.json\"\n+    );\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"div\"\n+    );\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getText(),\n+      \"JSON\\nPreview not available.\"\n+    );\n+    await driver.sendKeys(Key.ESCAPE);\n+\n+    // Undo.\n+    await gu.undo();\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+  });\n+\n+  const checkClosing = stackWrapFunc(async function (\n+    shouldSave: boolean,\n+    trigger: () => Promise<void>\n+  ) {\n+    let cell = gu.getCell({ col: 0, rowNum: 2 });\n+    await cell.click();\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+\n+    // Open attachments editor.\n+    await driver.sendKeys(Key.ENTER);\n+    await driver.findWait(\".test-pw-attachment-content\", 500);\n+\n+    // Close using the given trigger. No actions should be emitted.\n+    await gu.userActionsCollect();\n+    await trigger();\n+    await gu.userActionsVerify([]);\n+\n+    // Open editor and delete a file.\n+    await driver.sendKeys(Key.ENTER);\n+    await driver.findWait(\".test-pw-attachment-content\", 500);\n+    await driver.find(\".test-pw-remove\").click();\n+    await gu.waitForServer();\n+\n+    // Close using the given trigger.\n+    await gu.userActionsCollect();\n+    await trigger();\n+    await gu.waitForServer();\n+    cell = gu.getCell({ col: 0, rowNum: 2 });\n+    if (shouldSave) {\n+      // If shouldSave is set, files should reflect the change. Check it and undo.\n+      await gu.userActionsCollect(false);\n+      assert.deepEqual(await getCellThumbnailTitles(cell), [\"grist.png\"]);\n+      await gu.undo();\n+    } else {\n+      // If shouldSave is false, there should be no actions.\n+      await gu.userActionsVerify([]);\n+    }\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+  });\n+\n+  it(\"should not save on Escape\", async function () {\n+    await checkClosing(false, () => driver.sendKeys(Key.ESCAPE));\n+  });\n+\n+  it(\"should save on Enter\", async function () {\n+    await checkClosing(true, () => driver.sendKeys(Key.ENTER));\n+  });\n+\n+  it(\"should save on close button\", async function () {\n+    await checkClosing(true, () =>\n+      driver.find(\".test-modal-dialog .test-pw-close\").click()\n+    );\n+  });\n+\n+  it(\"should preview images properly\", async function () {\n+    const cell = await gu.getCell({ col: 0, rowNum: 2 });\n+    await cell.click();\n+    await gu.fileDialogUpload(\"uploads/image_with_script.svg\", () =>\n+      cell.find(\".test-attachment-icon\").click()\n+    );\n+    await driver.withActions((a) => a.doubleClick(cell));\n+    await driver.findWait(\".test-pw-attachment-content\", 1000);\n+    assert.isFalse(await gu.isAlertShown());\n+  });\n+});"
            },
            {
                "sha": "4e00dc132e2336319d69e21db562e736968c5524",
                "filename": "test/nbrowser/CellFormat.ts",
                "status": "added",
                "additions": 264,
                "deletions": 0,
                "changes": 264,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fnbrowser%2FCellFormat.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fnbrowser%2FCellFormat.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fnbrowser%2FCellFormat.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,264 @@\n+import {assert, driver, Key} from 'mocha-webdriver';\n+import * as gu from 'test/nbrowser/gristUtils';\n+import {server, setupTestSuite} from 'test/nbrowser/testUtils';\n+import {DocCreationInfo} from \"app/common/DocListAPI\";\n+\n+describe('CellFormat', function() {\n+  this.timeout(20000);\n+  const cleanup = setupTestSuite();\n+  let session: gu.Session, doc: DocCreationInfo, api;\n+\n+  // Checks that a bug where alignment settings did not survive doc reload is gone.\n+  it('saves alignment settings', async function() {\n+    session = await gu.session().login();\n+    doc = await session.tempDoc(cleanup, 'Hello.grist');\n+    await gu.toggleSidePanel('right', 'open');\n+    await driver.findWait('.test-right-tab-field', 3000).click();\n+\n+    // Alignment should be left.\n+    assert.equal(await driver.find(`.test-alignment-select .test-select-button:first-child`)\n+                 .matches('[class*=-selected]'), true);\n+\n+    // Click on center aligmment.\n+    await (await driver.findAll('.test-alignment-select .test-select-button'))[1].click();\n+    await gu.waitForServer();\n+\n+    // Alignment should no longer be left.\n+    assert.equal(await driver.find(`.test-alignment-select .test-select-button:first-child`)\n+                 .matches('[class*=-selected]'), false);\n+\n+    // Reload document.\n+    await session.loadDocMenu('/');\n+    await session.loadDoc(`/doc/${doc.id}`);\n+\n+    // Alignment should still not be left.\n+    assert.equal(await driver.find(`.test-alignment-select .test-select-button:first-child`)\n+                 .matches('[class*=-selected]'), false);\n+  });\n+\n+  it('should open hyperlinks in new tabs only when needed', async function () {\n+    api = session.createHomeApi();\n+    const currentUrl = await driver.getCurrentUrl();\n+    const urls = [\n+      // Different origin, must open in new tab.\n+      // The driver waits for the page to load so something that loads quickly is needed.\n+      'about:blank',\n+\n+      // Same origin, but still needs a new tab because it's not the current document\n+      server.getUrl(session.settings.orgDomain, '/'),\n+\n+      // Same URL but with a link key, needs a new tab\n+      currentUrl + \"?foo_=bar\",\n+\n+      // Shouldn't open a new tab\n+      currentUrl,\n+    ];\n+\n+    // Create and open a new table in the same document containing the above URLs\n+    await api.applyUserActions(doc.id, [\n+      ['AddTable', 'Links',\n+        [{id: 'Link', type: 'Text'}]],\n+      ...urls.map(url => ['AddRecord', 'Links', null, {Link: url}]),\n+    ]);\n+    await gu.getPageItem(/Links/).click();\n+\n+    // Confirm that we are on a different page from before (i.e. `currentUrl`)\n+    // which we will be returning to\n+    const newUrl = await driver.getCurrentUrl();\n+    assert.isTrue(newUrl.endsWith('/p/2'));\n+    assert.isFalse(currentUrl.endsWith('/p/2'));\n+\n+    // Convert the column to hyperlink format\n+    await gu.getCell({rowNum: 1, col: 0}).click();\n+    await gu.setFieldWidgetType('HyperLink');\n+\n+    // There should only be one tab open for the following checks to make sense\n+    assert.equal((await driver.getAllWindowHandles()).length, 1);\n+\n+    async function checkExternalLink(rowNum: number) {\n+      const cell = gu.getCell({rowNum, col: 0});\n+      const url = await cell.getText();\n+      await cell.find('.test-tb-link').click();\n+\n+      // Check that we opened the URL in the cell in a new tab\n+      const handles = await driver.getAllWindowHandles();\n+      assert.equal(handles.length, 2);\n+      // Use gu.switchToWindow to handle occasional selenium flakage here.\n+      await gu.switchToWindow(handles[1]);\n+      assert.equal(await driver.getCurrentUrl(), url);\n+      assert.equal(urls[rowNum - 1], url);\n+      await driver.close();\n+\n+      // Return to the original tab with our document\n+      const [originalWindow] = await driver.getAllWindowHandles();\n+      await driver.switchTo().window(originalWindow);\n+    }\n+\n+    await checkExternalLink(1);\n+    await checkExternalLink(2);\n+    await checkExternalLink(3);\n+\n+    const cell = gu.getCell({rowNum: 4, col: 0});\n+    const url = await cell.getText();\n+    await cell.find('.test-tb-link').click();\n+    const handles = await driver.getAllWindowHandles();\n+\n+    // This time no new tab should have opened,\n+    // but we're back to the previous page\n+    assert.equal(handles.length, 1);\n+    assert.equal(await driver.getCurrentUrl(), url);\n+    assert.equal(currentUrl, url);\n+  });\n+\n+  it('can display Markdown-formatted text', async function() {\n+    await gu.getCell(0, 1).click();\n+    await gu.setFieldWidgetType('TextBox');\n+    await gu.sendKeys(\n+      Key.ENTER,\n+      await gu.selectAllKey(),\n+      Key.DELETE,\n+      '# Heading',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      '## Subheading',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      '1. Item 1',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      '2. Item 2',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      'A paragraph with **bold** and *italicized* text.',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      '[Link with label](https://example.com/#1)',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      'Link: https://example.com/#2',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      'HTML is <span style=\"color: red;\">escaped</span>.',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      \"![Images too](https://example.com)\",\n+      Key.ENTER\n+    );\n+    await gu.waitForServer();\n+    assert.equal(\n+      await gu.getCell(0, 1).getText(),\n+      `# Heading\n+\n+## Subheading\n+\n+1. Item 1\n+2. Item 2\n+\n+A paragraph with **bold** and *italicized* text.\n+\n+[Link with label](\n+)\n+\n+Link: \\nhttps://example.com/#2\n+\n+HTML is <span style=\"color: red;\">escaped</span>.\n+\n+![Images too](\n+)`\n+    );\n+    assert.isFalse(await gu.getCell(0, 1).findContent('h1', 'Heading').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('h2', 'Subheading').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('ol', 'Item 1').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('strong', 'bold').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('em', 'italicized').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('a + span', 'Link with label').isPresent());\n+    assert.isTrue(await gu.getCell(0, 1).find('a[href=\"https://example.com/#2\"]').isDisplayed());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('span', 'escaped').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).find('img').isPresent());\n+\n+    await gu.setFieldWidgetType('Markdown');\n+    await driver.find('.test-tb-wrap-text').click();\n+    await gu.waitForServer();\n+    assert.equal(\n+      await gu.getCell(0, 1).getText(),\n+      `Heading\n+Subheading\n+Item 1\n+Item 2\n+A paragraph with bold and italicized text.\n+Link with label\n+Link:\n+https://example.com/#2\n+HTML is <span style=\"color: red;\">escaped</span>.\n+![Images too](https://example.com)`\n+    );\n+    assert.isTrue(await gu.getCell(0, 1).findContent('h1', 'Heading').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).findContent('h2', 'Subheading').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).findContent('ol', 'Item 1').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).findContent('strong', 'bold').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).findContent('em', 'italicized').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1)\n+      .findContent('a[href=\"https://example.com/#1\"] + span', 'Link with label').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).find('a[href=\"https://example.com/#2\"]').isDisplayed());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('span', 'escaped').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).find('img').isPresent());\n+\n+    await gu.sendKeys(\n+      Key.ENTER,\n+      '> Editing works the same way as TextBox and HyperLink',\n+      Key.ENTER,\n+    );\n+    await gu.waitForServer();\n+    assert.equal(\n+      await gu.getCell(0, 2).getText(),\n+      'Editing works the same way as TextBox and HyperLink'\n+    );\n+\n+    await gu.setFieldWidgetType('TextBox');\n+    assert.equal(\n+      await gu.getCell(0, 1).getText(),\n+      `# Heading\n+\n+## Subheading\n+\n+1. Item 1\n+2. Item 2\n+\n+A paragraph with **bold** and *italicized* text.\n+\n+[Link with label](\n+)\n+\n+Link: \\nhttps://example.com/#2\n+\n+HTML is <span style=\"color: red;\">escaped</span>.\n+\n+![Images too](\n+)`\n+    );\n+    assert.equal(\n+      await gu.getCell(0, 2).getText(),\n+      '> Editing works the same way as TextBox and HyperLink'\n+    );\n+  });\n+\n+  it('treats URLs in Markdown and HyperLink cells as absolute URLs', async function() {\n+    // Previously, URLs in Markdown cells were treated as being relative to\n+    // the document origin if they were missing a scheme. This was inconsistent\n+    // with how HyperLink cells treated such URLs (with `http://` inferred).\n+    await gu.setFieldWidgetType('Markdown');\n+    await gu.getCell(0, 3).click();\n+    await gu.sendKeys(Key.ENTER, '[Google](google.com)', Key.ENTER);\n+    assert.equal(await gu.getCell(0, 3).find('a').getAttribute('href'), 'https://google.com/');\n+\n+    await gu.setFieldWidgetType('HyperLink');\n+    await gu.getCell(0, 3).click();\n+    await gu.sendKeys(Key.ENTER, await gu.selectAllKey(), Key.DELETE, 'Google google.com', Key.ENTER);\n+    assert.equal(await gu.getCell(0, 3).find('a').getAttribute('href'), 'https://google.com/');\n+  });\n+\n+  it('handles invalid URLs in HyperLink cells as \"about:blank\"', async function() {\n+    await gu.getCell(0, 3).click();\n+    await gu.sendKeys(Key.ENTER, await gu.selectAllKey(), Key.DELETE, '[Up to no good] javascript:alert()', Key.ENTER);\n+    assert.equal(await gu.getCell(0, 3).find('a').getAttribute('href'), 'about:blank');\n+  });\n+});"
            },
            {
                "sha": "523a9810bc92be3bda66378d1c1688176d4ce102",
                "filename": "yarn.lock",
                "status": "modified",
                "additions": 10,
                "deletions": 15,
                "changes": 25,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/yarn.lock",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/yarn.lock",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/yarn.lock?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -828,13 +828,6 @@\n   resolved \"https://registry.npmjs.org/@types/diff-match-patch/-/diff-match-patch-1.0.32.tgz\"\n   integrity sha512-bPYT5ECFiblzsVzyURaNhljBH2Gh1t9LowgUwciMrNAhFewLkHT2H0Mto07Y4/3KCOGZHRQll3CTtQZ0X11D/A==\n \n-\"@types/dompurify@3.0.5\":\n-  version \"3.0.5\"\n-  resolved \"https://registry.yarnpkg.com/@types/dompurify/-/dompurify-3.0.5.tgz#02069a2fcb89a163bacf1a788f73cb415dd75cb7\"\n-  integrity sha512-1Wg0g3BtQF7sSb27fJQAKck1HECM6zV1EB66j8JH9i3LCjYabJa0FSdiSgsD5K/RbrsR0SiraKacLB+T8ZVYAg==\n-  dependencies:\n-    \"@types/trusted-types\" \"*\"\n-\n \"@types/double-ended-queue@2.1.0\":\n   version \"2.1.0\"\n   resolved \"https://registry.npmjs.org/@types/double-ended-queue/-/double-ended-queue-2.1.0.tgz\"\n@@ -1163,10 +1156,10 @@\n   resolved \"https://registry.npmjs.org/@types/tough-cookie/-/tough-cookie-4.0.2.tgz\"\n   integrity sha512-Q5vtl1W5ue16D+nIaW8JWebSSraJVlK+EthKn7e7UcD4KWsaSJ8BqGPXNaPghgtcn/fhvrN17Tv8ksUsQpiplw==\n \n-\"@types/trusted-types@*\":\n-  version \"2.0.3\"\n-  resolved \"https://registry.yarnpkg.com/@types/trusted-types/-/trusted-types-2.0.3.tgz#a136f83b0758698df454e328759dbd3d44555311\"\n-  integrity sha512-NfQ4gyz38SL8sDNrSixxU2Os1a5xcdFxipAFxYEuLUlvU2uDwS4NUpsImcf1//SlWItCVMMLiylsxbmNMToV/g==\n+\"@types/trusted-types@^2.0.7\":\n+  version \"2.0.7\"\n+  resolved \"https://registry.yarnpkg.com/@types/trusted-types/-/trusted-types-2.0.7.tgz#baccb07a970b91707df3a3e8ba6896c57ead2d11\"\n+  integrity sha512-ScaPdn1dQczgbl0QFTeTOmVHFULt394XJgOQNoyVhZ6r2vLnMLJfBPd53SB52T/3G36VI1/g2MZaX0cwDuXsfw==\n \n \"@types/underscore@*\":\n   version \"1.11.0\"\n@@ -3238,10 +3231,12 @@ domain-browser@~1.1.0:\n   resolved \"https://registry.npmjs.org/domain-browser/-/domain-browser-1.1.7.tgz\"\n   integrity sha1-hnqksJP6oF8d4IwG9NeyH9+GmLw=\n \n-dompurify@3.0.6:\n-  version \"3.0.6\"\n-  resolved \"https://registry.yarnpkg.com/dompurify/-/dompurify-3.0.6.tgz#925ebd576d54a9531b5d76f0a5bef32548351dae\"\n-  integrity sha512-ilkD8YEnnGh1zJ240uJsW7AzE+2qpbOUYjacomn3AvJ6J4JhKGSZ2nh4wUIXPZrEPppaCLx5jFe8T89Rk8tQ7w==\n+dompurify@3.2.3:\n+  version \"3.2.3\"\n+  resolved \"https://registry.yarnpkg.com/dompurify/-/dompurify-3.2.3.tgz#05dd2175225324daabfca6603055a09b2382a4cd\"\n+  integrity sha512-U1U5Hzc2MO0oW3DF+G9qYN0aT7atAou4AgI0XjWz061nyBPbdxkfdhfy5uMgGn6+oLFCfn44ZGbdDqCzVmlOWA==\n+  optionalDependencies:\n+    \"@types/trusted-types\" \"^2.0.7\"\n \n dot-prop@^5.2.0:\n   version \"5.2.0\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/gristlabs/grist-core/commits/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
        "url": "https://api.github.com/repos/gristlabs/grist-core/commits/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
        "html_url": "https://github.com/gristlabs/grist-core/commit/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
        "message": "(core) Fix attachment and hyperlink vulnerabilities\n\nSummary:\nAttachments were prone to XSS-based attacks if attachments injected with scripts\nwere previewed or opened. This is now addressed by CSP.\n\nHyperlink cells were prone to similar attacks if `javascript:...` URLs were inserted into\ncells. This has also been addressed by sanitizing URLs.\n\nThank you to Florent <florent.git@zeteo.me> and Gr\u00e9goire Cutzach <gregoire@cutzach.com>\nfor reporting and co-authoring these changes.\n\nCo-authored-by: Florent <florent.git@zeteo.me>\nCo-authored-by: Gr\u00e9goire Cutzach <gregoire@cutzach.com>\n\nTest Plan: Browser and unit tests.\n\nReviewers: dsagal, paulfitz\n\nReviewed By: dsagal, paulfitz\n\nSubscribers: dsagal, paulfitz, fflorent\n\nDifferential Revision: https://phab.getgrist.com/D4413",
        "files": [
            {
                "sha": "9c853c098693d541446d8c0c8add0d509e4d62dd",
                "filename": "app/client/components/WidgetFrame.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fcomponents%2FWidgetFrame.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fcomponents%2FWidgetFrame.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fcomponents%2FWidgetFrame.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -5,14 +5,15 @@ import {GristDoc} from 'app/client/components/GristDoc';\n import {hooks} from 'app/client/Hooks';\n import {get as getBrowserGlobals} from 'app/client/lib/browserGlobals';\n import {makeTestId} from 'app/client/lib/domUtils';\n+import {sanitizeHttpUrl} from 'app/client/lib/sanitizeUrl';\n import {ColumnRec, ViewSectionRec} from 'app/client/models/DocModel';\n import {reportError} from 'app/client/models/errors';\n import {gristThemeObs} from 'app/client/ui2018/theme';\n import {AccessLevel, ICustomWidget, isSatisfied, matchWidget} from 'app/common/CustomWidget';\n import {DisposableWithEvents} from 'app/common/DisposableWithEvents';\n import {BulkColValues, fromTableDataAction, RowRecord} from 'app/common/DocActions';\n import {extractInfoFromColType, reencodeAsAny} from 'app/common/gristTypes';\n-import {getGristConfig, sanitizeUrl} from 'app/common/urlUtils';\n+import {getGristConfig} from 'app/common/urlUtils';\n import {\n   AccessTokenOptions, CursorPos, CustomSectionAPI, FetchSelectedOptions, GristDocAPI, GristView,\n   InteractionOptionsRequest, WidgetAPI, WidgetColumnMap\n@@ -242,7 +243,7 @@ export class WidgetFrame extends DisposableWithEvents {\n     // Append user and document preferences to query string.\n     const settingsParams = new URLSearchParams(this._options.preferences);\n     settingsParams.forEach((value, key) => urlObj.searchParams.append(key, value));\n-    return sanitizeUrl(urlObj.href);\n+    return sanitizeHttpUrl(urlObj.href);\n   }\n \n   private _getEmptyWidgetPage(): string {"
            },
            {
                "sha": "99fdea3adea38bc8b91a7858e9714bf670326a28",
                "filename": "app/client/lib/sanitizeUrl.ts",
                "status": "added",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Flib%2FsanitizeUrl.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Flib%2FsanitizeUrl.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Flib%2FsanitizeUrl.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,42 @@\n+import DOMPurify from \"dompurify\";\n+\n+// Export dependencies for stubbing in tests.\n+export const Deps = { DOMPurify };\n+\n+/**\n+ * Returns the provided URL if it is valid and safe to use in\n+ * HTTP-only contexts, such as form redirects and custom widget\n+ * URLs.\n+ *\n+ * Returns `null` if the URL is invalid or unsafe.\n+ *\n+ * For sanitizing hyperlink URLs, such as those used by `a`\n+ * elements, see `sanitizeLinkUrl`.\n+ */\n+export function sanitizeHttpUrl(url: string): string | null {\n+  try {\n+    const parsedUrl = new URL(url);\n+    if (![\"http:\", \"https:\"].includes(parsedUrl.protocol)) {\n+      return null;\n+    }\n+\n+    return parsedUrl.href;\n+  } catch (e) {\n+    return null;\n+  }\n+}\n+\n+/**\n+ * Returns the provided URL if it is valid and safe to use for hyperlinks,\n+ * such as those used by `a` elements. This includes URLs prefixed with\n+ * `http[s]:`, `mailto:`, and `tel:`, and excludes URLs prefixed with\n+ * `javascript:`.\n+ *\n+ * Returns `null` if the URL is invalid or unsafe.\n+ *\n+ * For sanitizing HTTP-only URLs, such as those used for redirects, see\n+ * `sanitizeHttpUrl`.\n+ */\n+export function sanitizeLinkUrl(url: string): string | null {\n+  return Deps.DOMPurify.isValidAttribute(\"a\", \"href\", url) ? url : null;\n+}"
            },
            {
                "sha": "d76911668b73a970ddcf9aed235ec3065b90377d",
                "filename": "app/client/ui/FormPage.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fui%2FFormPage.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fui%2FFormPage.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fui%2FFormPage.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -1,14 +1,15 @@\n import {FormRenderer} from 'app/client/components/FormRenderer';\n import {handleSubmit, TypedFormData} from 'app/client/lib/formUtils';\n import {makeT} from 'app/client/lib/localization';\n+import {sanitizeHttpUrl} from 'app/client/lib/sanitizeUrl';\n import {FormModel, FormModelImpl} from 'app/client/models/FormModel';\n import {buildFormFooter} from 'app/client/ui/FormContainer';\n import {FormErrorPage} from 'app/client/ui/FormErrorPage';\n import {FormSuccessPage} from 'app/client/ui/FormSuccessPage';\n import {colors} from 'app/client/ui2018/cssVars';\n import {ApiError} from 'app/common/ApiError';\n import {getPageTitleSuffix} from 'app/common/gristUrls';\n-import {getGristConfig, sanitizeUrl} from 'app/common/urlUtils';\n+import {getGristConfig} from 'app/common/urlUtils';\n import {Disposable, dom, makeTestId, Observable, styled, subscribe} from 'grainjs';\n \n const t = makeT('FormPage');\n@@ -90,7 +91,7 @@ export class FormPage extends Disposable {\n \n     const {successURL} = formLayout;\n     if (successURL) {\n-      const url = sanitizeUrl(successURL);\n+      const url = sanitizeHttpUrl(successURL);\n       if (url) {\n         window.location.href = url;\n       }"
            },
            {
                "sha": "8b4c32ea27969f05f219433354aefc62e70258d7",
                "filename": "app/client/ui/sanitizeHTML.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fui%2FsanitizeHTML.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fui%2FsanitizeHTML.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fui%2FsanitizeHTML.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -24,10 +24,10 @@ function handleSanitizeAttribute(node: Element) {\n   node.setAttribute('target', '_blank');\n }\n \n-function handleSanitizeTutorialElement(node: Element, data: createDOMPurifier.SanitizeElementHookEvent) {\n+function handleSanitizeTutorialElement(node: Node, data: createDOMPurifier.UponSanitizeElementHookEvent) {\n   if (data.tagName !== 'iframe') { return; }\n \n-  const src = node.getAttribute('src');\n+  const src = (node as Element).getAttribute('src');\n   if (src?.startsWith('https://www.youtube.com/embed/')) {\n     return;\n   }"
            },
            {
                "sha": "e8c9549d2ab7bd41df3529d73ab78c7935435eec",
                "filename": "app/client/widgets/HyperLinkTextBox.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fwidgets%2FHyperLinkTextBox.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fclient%2Fwidgets%2FHyperLinkTextBox.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fwidgets%2FHyperLinkTextBox.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -1,3 +1,4 @@\n+import { sanitizeLinkUrl } from 'app/client/lib/sanitizeUrl';\n import { DataRowModel } from 'app/client/models/DataRowModel';\n import { ViewFieldRec } from 'app/client/models/entities/ViewFieldRec';\n import { constructUrl } from 'app/client/models/gristUrlState';\n@@ -20,7 +21,10 @@ export class HyperLinkTextBox extends NTextBox {\n \n   public buildDom(row: DataRowModel) {\n     const value = row.cells[this.field.colId()];\n-    const url = Computed.create(null, (use) => constructUrl(use(value)));\n+    const url = Computed.create(\n+      null,\n+      (use) => sanitizeLinkUrl(constructUrl(use(value))) ?? \"about:blank\"\n+    );\n     return cssFieldClip(\n       dom.autoDispose(url),\n       dom.style('text-align', this.alignment),"
            },
            {
                "sha": "3a2310be3b759f949a3c60fcbf4837104fe13781",
                "filename": "app/common/urlUtils.ts",
                "status": "modified",
                "additions": 0,
                "deletions": 17,
                "changes": 17,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fcommon%2FurlUtils.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fcommon%2FurlUtils.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fcommon%2FurlUtils.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -79,20 +79,3 @@ export function fetchFromHome(path: string, opts: RequestInit): Promise<Response\n   const baseUrl = addCurrentOrgToPath(getGristConfig().homeUrl!);\n   return window.fetch(`${baseUrl}${path}`, opts);\n }\n-\n-/**\n- * Returns the provided URL if it has a valid protocol (`http:` or `https:`), or\n- * `null` otherwise.\n- */\n-export function sanitizeUrl(url: string): string | null {\n-  try {\n-    const parsedUrl = new URL(url);\n-    if (![\"http:\", \"https:\"].includes(parsedUrl.protocol)) {\n-      return null;\n-    }\n-\n-    return parsedUrl.href;\n-  } catch (e) {\n-    return null;\n-  }\n-}"
            },
            {
                "sha": "8529acde856a3077460fd8b27696d1542c649306",
                "filename": "app/server/lib/DocWorker.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fserver%2Flib%2FDocWorker.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/app%2Fserver%2Flib%2FDocWorker.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fserver%2Flib%2FDocWorker.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -61,6 +61,7 @@ export class DocWorker {\n         .type(ext)\n         .set('Content-Disposition', contentDispHeader)\n         .set('Cache-Control', 'private, max-age=3600')\n+        .set(\"Content-Security-Policy\", \"sandbox; default-src: 'none'\")\n         .send(data);\n     } catch (err) {\n       res.status(404).send({error: err.toString()});"
            },
            {
                "sha": "05c56d42874c7e021495a5753e26da4f93c51851",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/package.json",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/package.json",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/package.json?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -49,7 +49,6 @@\n     \"@types/chai-as-promised\": \"7.1.0\",\n     \"@types/content-disposition\": \"0.5.2\",\n     \"@types/diff-match-patch\": \"1.0.32\",\n-    \"@types/dompurify\": \"3.0.5\",\n     \"@types/double-ended-queue\": \"2.1.0\",\n     \"@types/express\": \"4.17.17\",\n     \"@types/form-data\": \"2.2.1\",\n@@ -139,7 +138,7 @@\n     \"csv\": \"6.3.8\",\n     \"currency-symbol-map\": \"5.1.0\",\n     \"diff-match-patch\": \"1.0.5\",\n-    \"dompurify\": \"3.0.6\",\n+    \"dompurify\": \"3.2.3\",\n     \"double-ended-queue\": \"2.1.0-0\",\n     \"engine.io\": \"^6.5.4\",\n     \"engine.io-client\": \"^6.5.3\","
            },
            {
                "sha": "462a1866958ba7fc15dd594d989309072e921a99",
                "filename": "test/client/lib/sanitizeUrl.ts",
                "status": "added",
                "additions": 71,
                "deletions": 0,
                "changes": 71,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fclient%2Flib%2FsanitizeUrl.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fclient%2Flib%2FsanitizeUrl.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fclient%2Flib%2FsanitizeUrl.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,71 @@\n+import {\n+  Deps,\n+  sanitizeHttpUrl,\n+  sanitizeLinkUrl,\n+} from \"app/client/lib/sanitizeUrl\";\n+import { assert } from \"chai\";\n+import DOMPurify from \"dompurify\";\n+import { JSDOM } from \"jsdom\";\n+import * as sinon from \"sinon\";\n+\n+describe(\"sanitizeUrl\", function () {\n+  let sandbox: sinon.SinonSandbox;\n+\n+  beforeEach(function () {\n+    // These grainjs browserGlobals are needed for using dom() in tests.\n+    const jsdomDoc = new JSDOM(\"<!doctype html><html><body></body></html>\");\n+    sandbox = sinon.createSandbox();\n+    sandbox.stub(Deps, \"DOMPurify\").value(DOMPurify(jsdomDoc.window));\n+  });\n+\n+  afterEach(function () {\n+    sandbox.restore();\n+  });\n+\n+  describe(\"sanitizeHttpUrl\", function () {\n+    it(\"returns the provided URL if valid\", function () {\n+      assert.equal(\n+        sanitizeHttpUrl(\"https://example.com\"),\n+        \"https://example.com/\"\n+      );\n+      assert.equal(\n+        sanitizeHttpUrl(\"http://example.com\"),\n+        \"http://example.com/\"\n+      );\n+    });\n+\n+    it(\"returns null if the provided URL is invalid\", function () {\n+      assert.isNull(sanitizeHttpUrl(\"www.example.com\"));\n+      assert.isNull(sanitizeHttpUrl(\"\"));\n+      assert.isNull(sanitizeHttpUrl(\"invalid\"));\n+      assert.isNull(sanitizeHttpUrl(\"mailto:support@getgrist.com\"));\n+      assert.isNull(sanitizeHttpUrl(\"ftp://getgrist.com/path\"));\n+      assert.isNull(sanitizeHttpUrl(\"javascript:alert()\"));\n+    });\n+  });\n+\n+  describe(\"sanitizeLinkUrl\", function () {\n+    it(\"returns the provided URL if valid\", function () {\n+      assert.equal(\n+        sanitizeLinkUrl(\"https://example.com\"),\n+        \"https://example.com\"\n+      );\n+      assert.equal(sanitizeLinkUrl(\"http://example.com\"), \"http://example.com\");\n+      assert.equal(sanitizeLinkUrl(\"www.example.com\"), \"www.example.com\");\n+      assert.equal(sanitizeLinkUrl(\"\"), \"\");\n+      assert.equal(\n+        sanitizeLinkUrl(\"mailto:support@getgrist.com\"),\n+        \"mailto:support@getgrist.com\"\n+      );\n+      assert.equal(sanitizeLinkUrl(\"tel:0123456789\"), \"tel:0123456789\");\n+      assert.equal(\n+        sanitizeLinkUrl(\"ftp://getgrist.com/path\"),\n+        \"ftp://getgrist.com/path\"\n+      );\n+    });\n+\n+    it(\"returns null if the provided URL is unsafe\", function () {\n+      assert.isNull(sanitizeLinkUrl(\"javascript:alert()\"));\n+    });\n+  });\n+});"
            },
            {
                "sha": "e655be6991f38b7abdb862522b64c2039ae846c8",
                "filename": "test/common/urlUtils.ts",
                "status": "removed",
                "additions": 0,
                "deletions": 24,
                "changes": 24,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/6996ea3037104b98ce79978688905f565f199025/test%2Fcommon%2FurlUtils.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/6996ea3037104b98ce79978688905f565f199025/test%2Fcommon%2FurlUtils.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fcommon%2FurlUtils.ts?ref=6996ea3037104b98ce79978688905f565f199025",
                "patch": "@@ -1,24 +0,0 @@\n-import { sanitizeUrl } from \"app/common/urlUtils\";\n-import { assert } from \"chai\";\n-\n-describe(\"urlUtils\", function () {\n-  describe(\"sanitizeUrl\", function () {\n-    it(\"returns the provided URL if the scheme is http[s]\", function () {\n-      assert.equal(sanitizeUrl(\"https://example.com\"), \"https://example.com/\");\n-      assert.equal(sanitizeUrl(\"http://example.com\"), \"http://example.com/\");\n-      assert.equal(sanitizeUrl(\"https://example.com\"), \"https://example.com/\");\n-    });\n-\n-    it(\"returns null if the provided URL is invalid\", function () {\n-      assert.isNull(sanitizeUrl(\"www.example.com\"));\n-      assert.isNull(sanitizeUrl(\"\"));\n-      assert.isNull(sanitizeUrl(\"invalid\"));\n-    });\n-\n-    it(\"returns null if the provided URL's scheme is not http[s]\", function () {\n-      assert.isNull(sanitizeUrl(\"mailto:support@getgrist.com.com\"));\n-      assert.isNull(sanitizeUrl(\"ftp://getgrist.com/path\"));\n-      assert.isNull(sanitizeUrl(\"javascript:alert()\"));\n-    });\n-  });\n-});"
            },
            {
                "sha": "6acfaf8c27c12a665a9d8a21567c2ae6eab70793",
                "filename": "test/fixtures/uploads/image_with_script.svg",
                "status": "added",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Ffixtures%2Fuploads%2Fimage_with_script.svg",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Ffixtures%2Fuploads%2Fimage_with_script.svg",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Ffixtures%2Fuploads%2Fimage_with_script.svg?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,6 @@\n+<svg version=\"1.1\" baseProfile=\"full\" xmlns=\"http://www.w3.org/2000/svg\">\n+  <polygon id=\"triangle\" points=\"0,0 0,50 50,0\" fill=\"#009900\" stroke=\"#004400\"/>\n+  <script type=\"text/javascript\">\n+    alert('I should not appear');\n+  </script>\n+</svg>"
            },
            {
                "sha": "e15aed1759e53253c2964cc197247beed5381da7",
                "filename": "test/nbrowser/AttachmentsWidget.ts",
                "status": "added",
                "additions": 548,
                "deletions": 0,
                "changes": 548,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fnbrowser%2FAttachmentsWidget.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fnbrowser%2FAttachmentsWidget.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fnbrowser%2FAttachmentsWidget.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,548 @@\n+import {\n+  assert,\n+  driver,\n+  Key,\n+  stackWrapFunc,\n+  WebElement,\n+} from \"mocha-webdriver\";\n+import fetch from \"node-fetch\";\n+import * as gu from \"test/nbrowser/gristUtils\";\n+import { server, setupTestSuite } from \"test/nbrowser/testUtils\";\n+\n+describe(\"AttachmentsWidget\", function () {\n+  this.timeout(20000);\n+  setupTestSuite();\n+  let docId: string;\n+\n+  before(async function () {\n+    docId = (\n+      await gu.importFixturesDoc(\n+        \"chimpy\",\n+        \"nasa\",\n+        \"Horizon\",\n+        \"Hello.grist\",\n+        false\n+      )\n+    ).id;\n+    await server.simulateLogin(\"Chimpy\", \"chimpy@getgrist.com\", \"nasa\");\n+    await gu.loadDoc(`/o/nasa/doc/${docId}`);\n+  });\n+\n+  afterEach(async function () {\n+    await gu.checkForErrors();\n+  });\n+\n+  after(async function () {\n+    // Close any open cell/attachments editor, to avoid an unload alert that would interfere with\n+    // the next test suite.\n+    await driver.sendKeys(Key.ESCAPE);\n+  });\n+\n+  // Returns the 'title' attributes of all attachments in the given cell. These should be the\n+  // names of the attached files.\n+  const getCellThumbnailTitles = stackWrapFunc(async function (\n+    cell: WebElement\n+  ) {\n+    return await cell.findAll(\".test-pw-thumbnail\", (el) =>\n+      el.getAttribute(\"title\")\n+    );\n+  });\n+\n+  it(\"should include a functioning attachment widget\", async function () {\n+    await gu.toggleSidePanel(\"right\", \"open\");\n+    await driver.find(\".test-right-tab-field\").click();\n+\n+    // Move to first column\n+    await gu.getCell(0, 1).click();\n+\n+    // Change type to Attachment.\n+    await gu.setType(/Attachment/);\n+    await driver.findWait(\".test-type-transform-apply\", 1000).click();\n+    await gu.waitForServer();\n+    assert.equal(\n+      await gu.getCell(0, 2).find(\".test-attachment-widget\").isDisplayed(),\n+      true\n+    );\n+  });\n+\n+  it(\"should include a functioning upload button\", async function () {\n+    // Put 'foo1' in a cell, then replace it immediately with 'foo2'.\n+    // This is just setting up for testing undo behaviour below.\n+    await gu.getCell(1, 2).click();\n+    await driver.sendKeys(\"foo1\", Key.ENTER);\n+    await gu.getCell(1, 2).click();\n+    await driver.sendKeys(\"foo2\", Key.ENTER);\n+\n+    await gu.getCell(0, 2).click();\n+    await driver.sendKeys(Key.ENTER);\n+\n+    await gu.fileDialogUpload(\"uploads/sample.pdf,uploads/grist.png\", () =>\n+      driver.find(\".test-pw-add\").click()\n+    );\n+    await driver.findContentWait(\".test-pw-counter\", /of 2/, 3000);\n+\n+    const href: string = await driver\n+      .findWait(\".test-pw-download\", 2000)\n+      .getAttribute(\"href\");\n+    assert.include(href.split(\"name=\")[1], \"sample.pdf\");\n+    assert.equal(await driver.find(\".test-pw-counter\").getText(), \"1 of 2\");\n+    await driver.find(\".test-modal-dialog .test-pw-close\").click();\n+    await gu.waitForServer();\n+\n+    // Check that title attributes are set to file names.\n+    assert.deepEqual(await getCellThumbnailTitles(gu.getCell(0, 2)), [\n+      \"sample.pdf\",\n+      \"grist.png\",\n+    ]);\n+\n+    // Check that in the absence of a thumbnail we show the extension.\n+    assert.deepEqual(\n+      await gu\n+        .getCell(0, 2)\n+        .findAll(\".test-pw-thumbnail\", (el) => el.getText()),\n+      [\"PDF\", \"\"]\n+    );\n+\n+    async function checkState(expectedCells: string[], isSoftDeleted: boolean) {\n+      assert.deepEqual(\n+        await gu.getVisibleGridCells({ cols: [0, 1], rowNums: [2] }),\n+        expectedCells\n+      );\n+\n+      // Previously, undo would remove the uploaded attachment metadata completely,\n+      // which could lead to hard deleting the file data and leaving broken attachments after redo.\n+      // Here we check that after checking for unused attachments and removing expired ones\n+      // (as should happen automatically every hour)\n+      // the metadata records (and thus files) are still there, but appropriately marked as soft deleted.\n+      const headers = { Authorization: \"Bearer api_key_for_chimpy\" };\n+      const url = server.getUrl(\"nasa\", `/api/docs/${docId}`);\n+      let resp = await fetch(\n+        url + \"/attachments/removeUnused?verifyfiles=1&expiredonly=1\",\n+        { headers, method: \"POST\" }\n+      );\n+      assert.equal(resp.status, 200);\n+      resp = await fetch(url + \"/tables/_grist_Attachments/records\", {\n+        headers,\n+      });\n+      const data = await resp.json();\n+      assert.lengthOf(data.records, 2);\n+      for (const record of data.records) {\n+        assert.equal(Boolean(record.fields.timeDeleted), isSoftDeleted);\n+      }\n+    }\n+\n+    // Check current state before testing undo/redo\n+    assert.deepEqual(\n+      await gu.getVisibleGridCells({ cols: [0, 1], rowNums: [2] }),\n+      [\"PDF\", \"foo2\"]\n+    );\n+    await checkState([\"PDF\", \"foo2\"], false);\n+\n+    // Check that undo once removes the attachments we just added to the cell\n+    await gu.undo();\n+    await checkState([\"\", \"foo2\"], true); // true: attachment metadata marked as soft deleted\n+\n+    // Check that undo again undoes the thing we did before attaching: changing foo1 to foo2\n+    // (previously it would undo creating the attachment metadata, which was invisible)\n+    await gu.undo();\n+    await checkState([\"\", \"foo1\"], true);\n+\n+    // Check that redoing twice restores things as expected\n+    await gu.redo();\n+    await checkState([\"\", \"foo2\"], true);\n+    await gu.redo();\n+    await checkState([\"PDF\", \"foo2\"], false); // false: attachment metadata un-deleted\n+  });\n+\n+  it(\"should allow resizing thumbnails\", async function () {\n+    const slider = await driver.find(\".test-pw-thumbnail-size\");\n+    assert.equal(\n+      (await driver.findWait(\".test-pw-thumbnail:last-child\", 1000).getRect())\n+        .height,\n+      36\n+    );\n+    for (let i = 0; i < 5; i++) {\n+      await slider.sendKeys(Key.RIGHT);\n+    }\n+    assert.equal(\n+      (await driver.find(\".test-pw-thumbnail:last-child\").getRect()).height,\n+      41\n+    );\n+    for (let i = 0; i < 3; i++) {\n+      await slider.sendKeys(Key.LEFT);\n+    }\n+    assert.equal(\n+      (await driver.find(\".test-pw-thumbnail:last-child\").getRect()).height,\n+      38\n+    );\n+    // Wait to ensure the new setting is saved.\n+    await driver.sleep(300);\n+\n+    // Thumbnail size setting should persist across refresh\n+    await driver.navigate().refresh();\n+    await gu.waitForServer(10000);\n+    assert.equal(\n+      (await driver.findWait(\".test-pw-thumbnail:last-child\", 1000).getRect())\n+        .height,\n+      38\n+    );\n+  });\n+\n+  it(\"should get correct headers from the server\", async function () {\n+    const cell: any = gu.getCell(0, 2);\n+    await cell.click();\n+    await driver.sendKeys(Key.ENTER);\n+\n+    const fetchOptions = {\n+      headers: { Authorization: \"Bearer api_key_for_chimpy\" },\n+    };\n+    const hrefDownload = await driver\n+      .findWait(\".test-pw-download\", 500)\n+      .getAttribute(\"href\");\n+    const respDownload = await fetch(hrefDownload, fetchOptions);\n+    assert.equal(\n+      respDownload.headers.get(\"Content-Disposition\"),\n+      'attachment; filename=\"sample.pdf\"'\n+    );\n+    assert.equal(\n+      respDownload.headers.get(\"Content-Security-Policy\"),\n+      \"sandbox; default-src: 'none'\"\n+    );\n+\n+    const hrefInline = await driver\n+      .find(\".test-pw-attachment-content\")\n+      .getAttribute(\"data\");\n+    const respInline = await fetch(hrefInline, fetchOptions);\n+    assert.equal(\n+      respInline.headers.get(\"Content-Disposition\"),\n+      'inline; filename=\"sample.pdf\"'\n+    );\n+\n+    // Attach an html file and ensure it doesn't get served inline.\n+    await gu.fileDialogUpload(\"uploads/htmlfile.html\", () =>\n+      driver.findWait(\".test-pw-add\", 500).click()\n+    );\n+    await driver.findContentWait(\".test-pw-counter\", /of 3/, 3000);\n+\n+    const hrefLinkHtml = await driver\n+      .findWait(\".test-pw-download\", 2000)\n+      .getAttribute(\"href\");\n+    const respLinkHtml = await fetch(hrefLinkHtml, fetchOptions);\n+    // Note that the disposition here is NOT \"inline\" (that would be bad).\n+    assert.equal(\n+      respLinkHtml.headers.get(\"Content-Disposition\"),\n+      'attachment; filename=\"htmlfile.html\"'\n+    );\n+    await driver.find(\".test-modal-dialog .test-pw-close\").click();\n+  });\n+\n+  it(\"should allow editing the attachments list\", async function () {\n+    let cell = gu.getCell(0, 2);\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"sample.pdf\",\n+      \"grist.png\",\n+      \"htmlfile.html\",\n+    ]);\n+\n+    // Open an image preview.\n+    await driver.withActions((a) =>\n+      a.doubleClick(driver.find(\".test-pw-thumbnail\"))\n+    );\n+\n+    assert.equal(\n+      await driver.findWait(\".test-pw-counter\", 500).getText(),\n+      \"1 of 3\"\n+    );\n+\n+    // Assert that the attachment filename can be changed.\n+    await driver\n+      .find(\".test-pw-name\")\n+      .doClick()\n+      .sendKeys(\"renamed.pdf\", Key.ENTER);\n+    // Wait for doc name input to lose focus, indicating that the save call completed.\n+    await driver.findWait(\".test-bc-doc:not(:focus)\", 2000);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"renamed.pdf\");\n+\n+    // Assert that the attachment has the correct download link.\n+    const href = await driver.find(\".test-pw-download\").getAttribute(\"href\");\n+    assert.include(href, \"attId=1\");\n+    assert.include(href, \"name=renamed.pdf\");\n+\n+    // Assert that other previews can be viewed without closing the modal.\n+    await driver.find(\".test-pw-right\").click();\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"grist.png\");\n+    await driver.find(\".test-pw-left\").click();\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"renamed.pdf\");\n+    await driver.sendKeys(Key.RIGHT, Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"htmlfile.html\");\n+\n+    // Assert that the attachment can be removed from the cell.\n+    assert.equal(await driver.find(\".test-pw-counter\").getText(), \"3 of 3\");\n+    await driver.find(\".test-pw-remove\").click();\n+    await gu.waitForServer();\n+    assert.equal(await driver.find(\".test-pw-counter\").getText(), \"2 of 2\");\n+    await driver.find(\".test-modal-dialog .test-pw-close\").click();\n+    cell = gu.getCell(0, 2);\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+  });\n+\n+  it(\"should allow uploading to the add row\", async function () {\n+    assert.equal(await gu.getCell({ col: 0, rowNum: 6 }).isPresent(), false);\n+    const cell = await gu.getCell({ col: 0, rowNum: 5 });\n+\n+    await gu.fileDialogUpload(\"uploads/grist.png\", () =>\n+      cell.find(\".test-attachment-icon\").click()\n+    );\n+    await gu.waitToPass(async () =>\n+      assert.lengthOf(\n+        await gu.getCell({ col: 0, rowNum: 5 }).findAll(\".test-pw-thumbnail\"),\n+        1\n+      )\n+    );\n+\n+    assert.deepEqual(\n+      await getCellThumbnailTitles(gu.getCell({ col: 0, rowNum: 5 })),\n+      [\"grist.png\"]\n+    );\n+    // Assert that a row is added\n+    assert.equal(await gu.getCell({ col: 0, rowNum: 6 }).isPresent(), true);\n+  });\n+\n+  it(\"should not initialize as invalid when a row is added\", async function () {\n+    // The first cell is invalid, just to check that the assert is correct.\n+    let cell = gu.getCell({ col: 0, rowNum: 1 });\n+    assert.equal(await cell.getText(), \"hello\");\n+    assert.equal(await cell.find(\".field_clip\").matches(\".invalid\"), true);\n+    await cell.click();\n+    // Add a new row and ensure it's NOT invalid.\n+    await driver\n+      .find(\"body\")\n+      .sendKeys(Key.chord(await gu.modKey(), Key.SHIFT, Key.ENTER));\n+    await gu.waitForServer();\n+    cell = gu.getCell({ col: 0, rowNum: 1 });\n+    assert.equal(await cell.getText(), \"\");\n+    assert.equal(await cell.find(\".field_clip\").matches(\".invalid\"), false);\n+    await gu.undo();\n+  });\n+\n+  it(\"should open preview to double-clicked attachment\", async function () {\n+    const cell = gu.getCell({ col: 0, rowNum: 2 });\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+\n+    // Double-click the first attachment.\n+    await driver.withActions((a) =>\n+      a.doubleClick(cell.find(\".test-pw-thumbnail[title*=pdf]\"))\n+    );\n+    assert.equal(\n+      await driver.findWait(\".test-pw-counter\", 500).getText(),\n+      \"1 of 2\"\n+    );\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"renamed.pdf\");\n+    await driver.sendKeys(Key.ESCAPE);\n+\n+    // Double-click the second attachment.\n+    await driver.withActions((a) =>\n+      a.doubleClick(cell.find(\".test-pw-thumbnail[title*=png]\"))\n+    );\n+    assert.equal(\n+      await driver.findWait(\".test-pw-counter\", 500).getText(),\n+      \"2 of 2\"\n+    );\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"grist.png\");\n+    await driver.sendKeys(Key.ESCAPE);\n+  });\n+\n+  it(\"should render various types of files appropriately\", async function () {\n+    const cell = gu.getCell({ col: 0, rowNum: 2 });\n+    await cell.click();\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+    await gu.fileDialogUpload(\n+      \"uploads/file1.mov,uploads/file2.mp3,uploads/file3.zip,uploads/simple_array.json\",\n+      () => cell.find(\".test-attachment-icon\").click()\n+    );\n+    await gu.waitToPass(async () =>\n+      assert.lengthOf(await cell.findAll(\".test-pw-thumbnail\"), 6)\n+    );\n+    await gu.waitForServer();\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+      \"file1.mov\",\n+      \"file2.mp3\",\n+      \"file3.zip\",\n+      \"simple_array.json\",\n+    ]);\n+    await driver.sendKeys(Key.ENTER);\n+    assert.equal(\n+      await driver.findWait(\".test-pw-counter\", 500).getText(),\n+      \"1 of 6\"\n+    );\n+\n+    // For various recognized file types, see that a suitable element is created.\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"renamed.pdf\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"object\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"data\"),\n+      /name=renamed.pdf&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=1&inline=1/\n+    );\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"type\"),\n+      \"application/pdf\"\n+    );\n+\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"grist.png\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"img\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"src\"),\n+      /name=grist.png&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=2/\n+    );\n+\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"file1.mov\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"video\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"src\"),\n+      /name=file1.mov&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=5&inline=1/\n+    );\n+\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"file2.mp3\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"audio\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"src\"),\n+      /name=file2.mp3&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=6&inline=1/\n+    );\n+\n+    // Test that for an unsupported file, the extension is shown along with a message.\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(await driver.find(\".test-pw-name\").value(), \"file3.zip\");\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"object\"\n+    );\n+    assert.match(\n+      await driver.find(\".test-pw-attachment-content\").getAttribute(\"data\"),\n+      /name=file3.zip&rowId=2&colId=A&tableId=Table1&maybeNew=1&attId=7&inline=1/\n+    );\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getText(),\n+      \"ZIP\\nPreview not available.\"\n+    );\n+\n+    // Test the same for a text/json file that we also don't currently render.\n+    await driver.sendKeys(Key.RIGHT);\n+    assert.equal(\n+      await driver.find(\".test-pw-name\").value(),\n+      \"simple_array.json\"\n+    );\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getTagName(),\n+      \"div\"\n+    );\n+    assert.equal(\n+      await driver.find(\".test-pw-attachment-content\").getText(),\n+      \"JSON\\nPreview not available.\"\n+    );\n+    await driver.sendKeys(Key.ESCAPE);\n+\n+    // Undo.\n+    await gu.undo();\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+  });\n+\n+  const checkClosing = stackWrapFunc(async function (\n+    shouldSave: boolean,\n+    trigger: () => Promise<void>\n+  ) {\n+    let cell = gu.getCell({ col: 0, rowNum: 2 });\n+    await cell.click();\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+\n+    // Open attachments editor.\n+    await driver.sendKeys(Key.ENTER);\n+    await driver.findWait(\".test-pw-attachment-content\", 500);\n+\n+    // Close using the given trigger. No actions should be emitted.\n+    await gu.userActionsCollect();\n+    await trigger();\n+    await gu.userActionsVerify([]);\n+\n+    // Open editor and delete a file.\n+    await driver.sendKeys(Key.ENTER);\n+    await driver.findWait(\".test-pw-attachment-content\", 500);\n+    await driver.find(\".test-pw-remove\").click();\n+    await gu.waitForServer();\n+\n+    // Close using the given trigger.\n+    await gu.userActionsCollect();\n+    await trigger();\n+    await gu.waitForServer();\n+    cell = gu.getCell({ col: 0, rowNum: 2 });\n+    if (shouldSave) {\n+      // If shouldSave is set, files should reflect the change. Check it and undo.\n+      await gu.userActionsCollect(false);\n+      assert.deepEqual(await getCellThumbnailTitles(cell), [\"grist.png\"]);\n+      await gu.undo();\n+    } else {\n+      // If shouldSave is false, there should be no actions.\n+      await gu.userActionsVerify([]);\n+    }\n+    assert.deepEqual(await getCellThumbnailTitles(cell), [\n+      \"renamed.pdf\",\n+      \"grist.png\",\n+    ]);\n+  });\n+\n+  it(\"should not save on Escape\", async function () {\n+    await checkClosing(false, () => driver.sendKeys(Key.ESCAPE));\n+  });\n+\n+  it(\"should save on Enter\", async function () {\n+    await checkClosing(true, () => driver.sendKeys(Key.ENTER));\n+  });\n+\n+  it(\"should save on close button\", async function () {\n+    await checkClosing(true, () =>\n+      driver.find(\".test-modal-dialog .test-pw-close\").click()\n+    );\n+  });\n+\n+  it(\"should preview images properly\", async function () {\n+    const cell = await gu.getCell({ col: 0, rowNum: 2 });\n+    await cell.click();\n+    await gu.fileDialogUpload(\"uploads/image_with_script.svg\", () =>\n+      cell.find(\".test-attachment-icon\").click()\n+    );\n+    await driver.withActions((a) => a.doubleClick(cell));\n+    await driver.findWait(\".test-pw-attachment-content\", 1000);\n+    assert.isFalse(await gu.isAlertShown());\n+  });\n+});"
            },
            {
                "sha": "4e00dc132e2336319d69e21db562e736968c5524",
                "filename": "test/nbrowser/CellFormat.ts",
                "status": "added",
                "additions": 264,
                "deletions": 0,
                "changes": 264,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fnbrowser%2FCellFormat.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/test%2Fnbrowser%2FCellFormat.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fnbrowser%2FCellFormat.ts?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -0,0 +1,264 @@\n+import {assert, driver, Key} from 'mocha-webdriver';\n+import * as gu from 'test/nbrowser/gristUtils';\n+import {server, setupTestSuite} from 'test/nbrowser/testUtils';\n+import {DocCreationInfo} from \"app/common/DocListAPI\";\n+\n+describe('CellFormat', function() {\n+  this.timeout(20000);\n+  const cleanup = setupTestSuite();\n+  let session: gu.Session, doc: DocCreationInfo, api;\n+\n+  // Checks that a bug where alignment settings did not survive doc reload is gone.\n+  it('saves alignment settings', async function() {\n+    session = await gu.session().login();\n+    doc = await session.tempDoc(cleanup, 'Hello.grist');\n+    await gu.toggleSidePanel('right', 'open');\n+    await driver.findWait('.test-right-tab-field', 3000).click();\n+\n+    // Alignment should be left.\n+    assert.equal(await driver.find(`.test-alignment-select .test-select-button:first-child`)\n+                 .matches('[class*=-selected]'), true);\n+\n+    // Click on center aligmment.\n+    await (await driver.findAll('.test-alignment-select .test-select-button'))[1].click();\n+    await gu.waitForServer();\n+\n+    // Alignment should no longer be left.\n+    assert.equal(await driver.find(`.test-alignment-select .test-select-button:first-child`)\n+                 .matches('[class*=-selected]'), false);\n+\n+    // Reload document.\n+    await session.loadDocMenu('/');\n+    await session.loadDoc(`/doc/${doc.id}`);\n+\n+    // Alignment should still not be left.\n+    assert.equal(await driver.find(`.test-alignment-select .test-select-button:first-child`)\n+                 .matches('[class*=-selected]'), false);\n+  });\n+\n+  it('should open hyperlinks in new tabs only when needed', async function () {\n+    api = session.createHomeApi();\n+    const currentUrl = await driver.getCurrentUrl();\n+    const urls = [\n+      // Different origin, must open in new tab.\n+      // The driver waits for the page to load so something that loads quickly is needed.\n+      'about:blank',\n+\n+      // Same origin, but still needs a new tab because it's not the current document\n+      server.getUrl(session.settings.orgDomain, '/'),\n+\n+      // Same URL but with a link key, needs a new tab\n+      currentUrl + \"?foo_=bar\",\n+\n+      // Shouldn't open a new tab\n+      currentUrl,\n+    ];\n+\n+    // Create and open a new table in the same document containing the above URLs\n+    await api.applyUserActions(doc.id, [\n+      ['AddTable', 'Links',\n+        [{id: 'Link', type: 'Text'}]],\n+      ...urls.map(url => ['AddRecord', 'Links', null, {Link: url}]),\n+    ]);\n+    await gu.getPageItem(/Links/).click();\n+\n+    // Confirm that we are on a different page from before (i.e. `currentUrl`)\n+    // which we will be returning to\n+    const newUrl = await driver.getCurrentUrl();\n+    assert.isTrue(newUrl.endsWith('/p/2'));\n+    assert.isFalse(currentUrl.endsWith('/p/2'));\n+\n+    // Convert the column to hyperlink format\n+    await gu.getCell({rowNum: 1, col: 0}).click();\n+    await gu.setFieldWidgetType('HyperLink');\n+\n+    // There should only be one tab open for the following checks to make sense\n+    assert.equal((await driver.getAllWindowHandles()).length, 1);\n+\n+    async function checkExternalLink(rowNum: number) {\n+      const cell = gu.getCell({rowNum, col: 0});\n+      const url = await cell.getText();\n+      await cell.find('.test-tb-link').click();\n+\n+      // Check that we opened the URL in the cell in a new tab\n+      const handles = await driver.getAllWindowHandles();\n+      assert.equal(handles.length, 2);\n+      // Use gu.switchToWindow to handle occasional selenium flakage here.\n+      await gu.switchToWindow(handles[1]);\n+      assert.equal(await driver.getCurrentUrl(), url);\n+      assert.equal(urls[rowNum - 1], url);\n+      await driver.close();\n+\n+      // Return to the original tab with our document\n+      const [originalWindow] = await driver.getAllWindowHandles();\n+      await driver.switchTo().window(originalWindow);\n+    }\n+\n+    await checkExternalLink(1);\n+    await checkExternalLink(2);\n+    await checkExternalLink(3);\n+\n+    const cell = gu.getCell({rowNum: 4, col: 0});\n+    const url = await cell.getText();\n+    await cell.find('.test-tb-link').click();\n+    const handles = await driver.getAllWindowHandles();\n+\n+    // This time no new tab should have opened,\n+    // but we're back to the previous page\n+    assert.equal(handles.length, 1);\n+    assert.equal(await driver.getCurrentUrl(), url);\n+    assert.equal(currentUrl, url);\n+  });\n+\n+  it('can display Markdown-formatted text', async function() {\n+    await gu.getCell(0, 1).click();\n+    await gu.setFieldWidgetType('TextBox');\n+    await gu.sendKeys(\n+      Key.ENTER,\n+      await gu.selectAllKey(),\n+      Key.DELETE,\n+      '# Heading',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      '## Subheading',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      '1. Item 1',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      '2. Item 2',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      'A paragraph with **bold** and *italicized* text.',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      '[Link with label](https://example.com/#1)',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      'Link: https://example.com/#2',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      'HTML is <span style=\"color: red;\">escaped</span>.',\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      Key.chord(Key.SHIFT, Key.ENTER),\n+      \"![Images too](https://example.com)\",\n+      Key.ENTER\n+    );\n+    await gu.waitForServer();\n+    assert.equal(\n+      await gu.getCell(0, 1).getText(),\n+      `# Heading\n+\n+## Subheading\n+\n+1. Item 1\n+2. Item 2\n+\n+A paragraph with **bold** and *italicized* text.\n+\n+[Link with label](\n+)\n+\n+Link: \\nhttps://example.com/#2\n+\n+HTML is <span style=\"color: red;\">escaped</span>.\n+\n+![Images too](\n+)`\n+    );\n+    assert.isFalse(await gu.getCell(0, 1).findContent('h1', 'Heading').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('h2', 'Subheading').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('ol', 'Item 1').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('strong', 'bold').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('em', 'italicized').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('a + span', 'Link with label').isPresent());\n+    assert.isTrue(await gu.getCell(0, 1).find('a[href=\"https://example.com/#2\"]').isDisplayed());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('span', 'escaped').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).find('img').isPresent());\n+\n+    await gu.setFieldWidgetType('Markdown');\n+    await driver.find('.test-tb-wrap-text').click();\n+    await gu.waitForServer();\n+    assert.equal(\n+      await gu.getCell(0, 1).getText(),\n+      `Heading\n+Subheading\n+Item 1\n+Item 2\n+A paragraph with bold and italicized text.\n+Link with label\n+Link:\n+https://example.com/#2\n+HTML is <span style=\"color: red;\">escaped</span>.\n+![Images too](https://example.com)`\n+    );\n+    assert.isTrue(await gu.getCell(0, 1).findContent('h1', 'Heading').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).findContent('h2', 'Subheading').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).findContent('ol', 'Item 1').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).findContent('strong', 'bold').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).findContent('em', 'italicized').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1)\n+      .findContent('a[href=\"https://example.com/#1\"] + span', 'Link with label').isDisplayed());\n+    assert.isTrue(await gu.getCell(0, 1).find('a[href=\"https://example.com/#2\"]').isDisplayed());\n+    assert.isFalse(await gu.getCell(0, 1).findContent('span', 'escaped').isPresent());\n+    assert.isFalse(await gu.getCell(0, 1).find('img').isPresent());\n+\n+    await gu.sendKeys(\n+      Key.ENTER,\n+      '> Editing works the same way as TextBox and HyperLink',\n+      Key.ENTER,\n+    );\n+    await gu.waitForServer();\n+    assert.equal(\n+      await gu.getCell(0, 2).getText(),\n+      'Editing works the same way as TextBox and HyperLink'\n+    );\n+\n+    await gu.setFieldWidgetType('TextBox');\n+    assert.equal(\n+      await gu.getCell(0, 1).getText(),\n+      `# Heading\n+\n+## Subheading\n+\n+1. Item 1\n+2. Item 2\n+\n+A paragraph with **bold** and *italicized* text.\n+\n+[Link with label](\n+)\n+\n+Link: \\nhttps://example.com/#2\n+\n+HTML is <span style=\"color: red;\">escaped</span>.\n+\n+![Images too](\n+)`\n+    );\n+    assert.equal(\n+      await gu.getCell(0, 2).getText(),\n+      '> Editing works the same way as TextBox and HyperLink'\n+    );\n+  });\n+\n+  it('treats URLs in Markdown and HyperLink cells as absolute URLs', async function() {\n+    // Previously, URLs in Markdown cells were treated as being relative to\n+    // the document origin if they were missing a scheme. This was inconsistent\n+    // with how HyperLink cells treated such URLs (with `http://` inferred).\n+    await gu.setFieldWidgetType('Markdown');\n+    await gu.getCell(0, 3).click();\n+    await gu.sendKeys(Key.ENTER, '[Google](google.com)', Key.ENTER);\n+    assert.equal(await gu.getCell(0, 3).find('a').getAttribute('href'), 'https://google.com/');\n+\n+    await gu.setFieldWidgetType('HyperLink');\n+    await gu.getCell(0, 3).click();\n+    await gu.sendKeys(Key.ENTER, await gu.selectAllKey(), Key.DELETE, 'Google google.com', Key.ENTER);\n+    assert.equal(await gu.getCell(0, 3).find('a').getAttribute('href'), 'https://google.com/');\n+  });\n+\n+  it('handles invalid URLs in HyperLink cells as \"about:blank\"', async function() {\n+    await gu.getCell(0, 3).click();\n+    await gu.sendKeys(Key.ENTER, await gu.selectAllKey(), Key.DELETE, '[Up to no good] javascript:alert()', Key.ENTER);\n+    assert.equal(await gu.getCell(0, 3).find('a').getAttribute('href'), 'about:blank');\n+  });\n+});"
            },
            {
                "sha": "523a9810bc92be3bda66378d1c1688176d4ce102",
                "filename": "yarn.lock",
                "status": "modified",
                "additions": 10,
                "deletions": 15,
                "changes": 25,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/yarn.lock",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/a792bdc43b456dbdd6fdc50d8747f4c349fab2f4/yarn.lock",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/yarn.lock?ref=a792bdc43b456dbdd6fdc50d8747f4c349fab2f4",
                "patch": "@@ -828,13 +828,6 @@\n   resolved \"https://registry.npmjs.org/@types/diff-match-patch/-/diff-match-patch-1.0.32.tgz\"\n   integrity sha512-bPYT5ECFiblzsVzyURaNhljBH2Gh1t9LowgUwciMrNAhFewLkHT2H0Mto07Y4/3KCOGZHRQll3CTtQZ0X11D/A==\n \n-\"@types/dompurify@3.0.5\":\n-  version \"3.0.5\"\n-  resolved \"https://registry.yarnpkg.com/@types/dompurify/-/dompurify-3.0.5.tgz#02069a2fcb89a163bacf1a788f73cb415dd75cb7\"\n-  integrity sha512-1Wg0g3BtQF7sSb27fJQAKck1HECM6zV1EB66j8JH9i3LCjYabJa0FSdiSgsD5K/RbrsR0SiraKacLB+T8ZVYAg==\n-  dependencies:\n-    \"@types/trusted-types\" \"*\"\n-\n \"@types/double-ended-queue@2.1.0\":\n   version \"2.1.0\"\n   resolved \"https://registry.npmjs.org/@types/double-ended-queue/-/double-ended-queue-2.1.0.tgz\"\n@@ -1163,10 +1156,10 @@\n   resolved \"https://registry.npmjs.org/@types/tough-cookie/-/tough-cookie-4.0.2.tgz\"\n   integrity sha512-Q5vtl1W5ue16D+nIaW8JWebSSraJVlK+EthKn7e7UcD4KWsaSJ8BqGPXNaPghgtcn/fhvrN17Tv8ksUsQpiplw==\n \n-\"@types/trusted-types@*\":\n-  version \"2.0.3\"\n-  resolved \"https://registry.yarnpkg.com/@types/trusted-types/-/trusted-types-2.0.3.tgz#a136f83b0758698df454e328759dbd3d44555311\"\n-  integrity sha512-NfQ4gyz38SL8sDNrSixxU2Os1a5xcdFxipAFxYEuLUlvU2uDwS4NUpsImcf1//SlWItCVMMLiylsxbmNMToV/g==\n+\"@types/trusted-types@^2.0.7\":\n+  version \"2.0.7\"\n+  resolved \"https://registry.yarnpkg.com/@types/trusted-types/-/trusted-types-2.0.7.tgz#baccb07a970b91707df3a3e8ba6896c57ead2d11\"\n+  integrity sha512-ScaPdn1dQczgbl0QFTeTOmVHFULt394XJgOQNoyVhZ6r2vLnMLJfBPd53SB52T/3G36VI1/g2MZaX0cwDuXsfw==\n \n \"@types/underscore@*\":\n   version \"1.11.0\"\n@@ -3238,10 +3231,12 @@ domain-browser@~1.1.0:\n   resolved \"https://registry.npmjs.org/domain-browser/-/domain-browser-1.1.7.tgz\"\n   integrity sha1-hnqksJP6oF8d4IwG9NeyH9+GmLw=\n \n-dompurify@3.0.6:\n-  version \"3.0.6\"\n-  resolved \"https://registry.yarnpkg.com/dompurify/-/dompurify-3.0.6.tgz#925ebd576d54a9531b5d76f0a5bef32548351dae\"\n-  integrity sha512-ilkD8YEnnGh1zJ240uJsW7AzE+2qpbOUYjacomn3AvJ6J4JhKGSZ2nh4wUIXPZrEPppaCLx5jFe8T89Rk8tQ7w==\n+dompurify@3.2.3:\n+  version \"3.2.3\"\n+  resolved \"https://registry.yarnpkg.com/dompurify/-/dompurify-3.2.3.tgz#05dd2175225324daabfca6603055a09b2382a4cd\"\n+  integrity sha512-U1U5Hzc2MO0oW3DF+G9qYN0aT7atAou4AgI0XjWz061nyBPbdxkfdhfy5uMgGn6+oLFCfn44ZGbdDqCzVmlOWA==\n+  optionalDependencies:\n+    \"@types/trusted-types\" \"^2.0.7\"\n \n dot-prop@^5.2.0:\n   version \"5.2.0\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/gristlabs/grist-core/commits/10b069005ec8d5f511e6554a56111d8f257f029e",
        "url": "https://api.github.com/repos/gristlabs/grist-core/commits/10b069005ec8d5f511e6554a56111d8f257f029e",
        "html_url": "https://github.com/gristlabs/grist-core/commit/10b069005ec8d5f511e6554a56111d8f257f029e",
        "message": "(core) Restrict widget/form URL schemes\n\nSummary:\nCustom widget and form redirect URLs were not restricted to http[s] schemes,\nleaving the door open to vulnerabilities from injection attacks. URLs are now\nproperly sanitized.\n\nTest Plan: Browser and unit tests.\n\nReviewers: dsagal\n\nReviewed By: dsagal\n\nSubscribers: dsagal, jordigh, paulfitz, fflorent\n\nDifferential Revision: https://phab.getgrist.com/D4410",
        "files": [
            {
                "sha": "b06c0d4f9bc252c1b6d2b77b65b9a6b01f29236f",
                "filename": "app/client/components/WidgetFrame.ts",
                "status": "modified",
                "additions": 11,
                "deletions": 6,
                "changes": 17,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/10b069005ec8d5f511e6554a56111d8f257f029e/app%2Fclient%2Fcomponents%2FWidgetFrame.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/10b069005ec8d5f511e6554a56111d8f257f029e/app%2Fclient%2Fcomponents%2FWidgetFrame.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fcomponents%2FWidgetFrame.ts?ref=10b069005ec8d5f511e6554a56111d8f257f029e",
                "patch": "@@ -12,7 +12,7 @@ import {AccessLevel, ICustomWidget, isSatisfied, matchWidget} from 'app/common/C\n import {DisposableWithEvents} from 'app/common/DisposableWithEvents';\n import {BulkColValues, fromTableDataAction, RowRecord} from 'app/common/DocActions';\n import {extractInfoFromColType, reencodeAsAny} from 'app/common/gristTypes';\n-import {getGristConfig} from 'app/common/urlUtils';\n+import {getGristConfig, sanitizeUrl} from 'app/common/urlUtils';\n import {\n   AccessTokenOptions, CursorPos, CustomSectionAPI, FetchSelectedOptions, GristDocAPI, GristView,\n   InteractionOptionsRequest, WidgetAPI, WidgetColumnMap\n@@ -141,7 +141,10 @@ export class WidgetFrame extends DisposableWithEvents {\n     const maybeUrl = Computed.create(this, use => use(this._widget)?.url || this._options.url);\n \n     // Url to widget or empty page with access level and preferences.\n-    this._url = Computed.create(this, use => this._urlWithAccess(use(maybeUrl) || this._getEmptyWidgetPage()));\n+    this._url = Computed.create(\n+      this,\n+      (use) => this._urlWithAccess(use(maybeUrl)) || this._getEmptyWidgetPage()\n+    );\n \n     // Iframe is empty when url is not set.\n     this._isEmpty = Computed.create(this, use => !use(maybeUrl));\n@@ -222,22 +225,24 @@ export class WidgetFrame extends DisposableWithEvents {\n   }\n \n   // Appends access level to query string.\n-  private _urlWithAccess(url: string) {\n-    if (!url) { return url; }\n+  private _urlWithAccess(url: string | null): string | null {\n+    if (!url) {\n+      return url;\n+    }\n \n     let urlObj: URL;\n     try {\n       urlObj = new URL(url);\n     } catch (e) {\n       console.error(e);\n-      return url;\n+      return null;\n     }\n     urlObj.searchParams.append('access', this._options.access);\n     urlObj.searchParams.append('readonly', String(this._options.readonly));\n     // Append user and document preferences to query string.\n     const settingsParams = new URLSearchParams(this._options.preferences);\n     settingsParams.forEach((value, key) => urlObj.searchParams.append(key, value));\n-    return urlObj.href;\n+    return sanitizeUrl(urlObj.href);\n   }\n \n   private _getEmptyWidgetPage(): string {"
            },
            {
                "sha": "a49fd95439165f9e649b395f7473b9af3e89a114",
                "filename": "app/client/ui/FormPage.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/10b069005ec8d5f511e6554a56111d8f257f029e/app%2Fclient%2Fui%2FFormPage.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/10b069005ec8d5f511e6554a56111d8f257f029e/app%2Fclient%2Fui%2FFormPage.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fui%2FFormPage.ts?ref=10b069005ec8d5f511e6554a56111d8f257f029e",
                "patch": "@@ -8,7 +8,7 @@ import {FormSuccessPage} from 'app/client/ui/FormSuccessPage';\n import {colors} from 'app/client/ui2018/cssVars';\n import {ApiError} from 'app/common/ApiError';\n import {getPageTitleSuffix} from 'app/common/gristUrls';\n-import {getGristConfig} from 'app/common/urlUtils';\n+import {getGristConfig, sanitizeUrl} from 'app/common/urlUtils';\n import {Disposable, dom, makeTestId, Observable, styled, subscribe} from 'grainjs';\n \n const t = makeT('FormPage');\n@@ -90,12 +90,9 @@ export class FormPage extends Disposable {\n \n     const {successURL} = formLayout;\n     if (successURL) {\n-      try {\n-        const url = new URL(successURL);\n-        window.location.href = url.href;\n-        return;\n-      } catch {\n-        // If the URL is invalid, just ignore it.\n+      const url = sanitizeUrl(successURL);\n+      if (url) {\n+        window.location.href = url;\n       }\n     }\n "
            },
            {
                "sha": "c7f205fcdcc4807c8d727499af8da1a04834fdeb",
                "filename": "app/client/ui/RightPanel.ts",
                "status": "modified",
                "additions": 12,
                "deletions": 3,
                "changes": 15,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/10b069005ec8d5f511e6554a56111d8f257f029e/app%2Fclient%2Fui%2FRightPanel.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/10b069005ec8d5f511e6554a56111d8f257f029e/app%2Fclient%2Fui%2FRightPanel.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fclient%2Fui%2FRightPanel.ts?ref=10b069005ec8d5f511e6554a56111d8f257f029e",
                "patch": "@@ -963,11 +963,20 @@ export class RightPanel extends Disposable {\n       ),\n       cssLabel(t(\"Redirection\")),\n       cssRow(\n-        labeledSquareCheckbox(redirection, t('Redirect automatically after submission')),\n+        labeledSquareCheckbox(\n+          redirection,\n+          t(\"Redirect automatically after submission\"),\n+          testId(\"form-redirect\")\n+        )\n       ),\n       cssRow(\n-        cssTextInput(successURL, (val) => successURL.set(val), {placeholder: t('Enter redirect URL')}),\n-        dom.show(redirection),\n+        cssTextInput(\n+          successURL,\n+          (val) => successURL.set(val),\n+          { placeholder: t(\"Enter redirect URL\") },\n+          testId(\"form-redirect-url\")\n+        ),\n+        dom.show(redirection)\n       ),\n     ];\n   }"
            },
            {
                "sha": "6d43bff9f63ccd2cd09603d0aceb1b39018cf866",
                "filename": "app/common/urlUtils.ts",
                "status": "modified",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/10b069005ec8d5f511e6554a56111d8f257f029e/app%2Fcommon%2FurlUtils.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/10b069005ec8d5f511e6554a56111d8f257f029e/app%2Fcommon%2FurlUtils.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/app%2Fcommon%2FurlUtils.ts?ref=10b069005ec8d5f511e6554a56111d8f257f029e",
                "patch": "@@ -79,3 +79,20 @@ export function fetchFromHome(path: string, opts: RequestInit): Promise<Response\n   const baseUrl = addCurrentOrgToPath(getGristConfig().homeUrl!);\n   return window.fetch(`${baseUrl}${path}`, opts);\n }\n+\n+/**\n+ * Returns the provided URL if it has a valid protocol (`http:` or `https:`), or\n+ * `null` otherwise.\n+ */\n+export function sanitizeUrl(url: string): string | null {\n+  try {\n+    const parsedUrl = new URL(url);\n+    if (![\"http:\", \"https:\"].includes(parsedUrl.protocol)) {\n+      return null;\n+    }\n+\n+    return parsedUrl.href;\n+  } catch (e) {\n+    return null;\n+  }\n+}"
            },
            {
                "sha": "e655be6991f38b7abdb862522b64c2039ae846c8",
                "filename": "test/common/urlUtils.ts",
                "status": "added",
                "additions": 24,
                "deletions": 0,
                "changes": 24,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/10b069005ec8d5f511e6554a56111d8f257f029e/test%2Fcommon%2FurlUtils.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/10b069005ec8d5f511e6554a56111d8f257f029e/test%2Fcommon%2FurlUtils.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fcommon%2FurlUtils.ts?ref=10b069005ec8d5f511e6554a56111d8f257f029e",
                "patch": "@@ -0,0 +1,24 @@\n+import { sanitizeUrl } from \"app/common/urlUtils\";\n+import { assert } from \"chai\";\n+\n+describe(\"urlUtils\", function () {\n+  describe(\"sanitizeUrl\", function () {\n+    it(\"returns the provided URL if the scheme is http[s]\", function () {\n+      assert.equal(sanitizeUrl(\"https://example.com\"), \"https://example.com/\");\n+      assert.equal(sanitizeUrl(\"http://example.com\"), \"http://example.com/\");\n+      assert.equal(sanitizeUrl(\"https://example.com\"), \"https://example.com/\");\n+    });\n+\n+    it(\"returns null if the provided URL is invalid\", function () {\n+      assert.isNull(sanitizeUrl(\"www.example.com\"));\n+      assert.isNull(sanitizeUrl(\"\"));\n+      assert.isNull(sanitizeUrl(\"invalid\"));\n+    });\n+\n+    it(\"returns null if the provided URL's scheme is not http[s]\", function () {\n+      assert.isNull(sanitizeUrl(\"mailto:support@getgrist.com.com\"));\n+      assert.isNull(sanitizeUrl(\"ftp://getgrist.com/path\"));\n+      assert.isNull(sanitizeUrl(\"javascript:alert()\"));\n+    });\n+  });\n+});"
            },
            {
                "sha": "58fa232baf4a9fe0bce4c5343695cd468d072a5f",
                "filename": "test/nbrowser/CustomWidgetsConfig.ts",
                "status": "modified",
                "additions": 15,
                "deletions": 0,
                "changes": 15,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/10b069005ec8d5f511e6554a56111d8f257f029e/test%2Fnbrowser%2FCustomWidgetsConfig.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/10b069005ec8d5f511e6554a56111d8f257f029e/test%2Fnbrowser%2FCustomWidgetsConfig.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fnbrowser%2FCustomWidgetsConfig.ts?ref=10b069005ec8d5f511e6554a56111d8f257f029e",
                "patch": "@@ -17,6 +17,7 @@ const READ_WIDGET = 'Read';\n const FULL_WIDGET = 'Full';\n const COLUMN_WIDGET = 'COLUMN_WIDGET';\n const REQUIRED_WIDGET = 'REQUIRED_WIDGET';\n+const INVALID_URL_WIDGET = 'INVALID_URL_WIDGET';\n // Custom URL label.\n const CUSTOM_URL = 'Custom URL';\n // Holds url for sample widget server.\n@@ -178,6 +179,11 @@ describe('CustomWidgetsConfig', function () {\n             url: createConfigUrl({requiredAccess: AccessLevel.read_table, columns: [{name:'Column', optional: false}]}),\n             widgetId: 'tester6',\n           },\n+          {\n+            name: INVALID_URL_WIDGET,\n+            url: 'ftp://getgrist.com/path',\n+            widgetId: 'tester7'\n+          }\n         ]);\n       });\n       addStatic(app);\n@@ -1077,6 +1083,12 @@ describe('CustomWidgetsConfig', function () {\n     await mainSession.loadDoc(`/doc/${docId}`);\n     await refresh();\n   });\n+\n+  it('should display the empty widget page if the URL is invalid', async function () {\n+    await gu.setCustomWidget(INVALID_URL_WIDGET);\n+    await widget.waitForFrame();\n+    assert.match(await widget.url(), /custom-widget\\.html$/);\n+  });\n });\n \n // Poor man widget rpc. Class that invokes various parts in the tester widget.\n@@ -1095,6 +1107,9 @@ const widget = {\n       await driver.executeScript('grist.testWaitForPendingRequests();');\n     });\n   },\n+  async url() {\n+    return await driver.find('iframe').getAttribute('src');\n+  },\n   async content() {\n     return await this._read('body');\n   },"
            },
            {
                "sha": "6c7e958a223658be5021f187dc65f183adfca78a",
                "filename": "test/nbrowser/FormView.ts",
                "status": "modified",
                "additions": 61,
                "deletions": 11,
                "changes": 72,
                "blob_url": "https://github.com/gristlabs/grist-core/blob/10b069005ec8d5f511e6554a56111d8f257f029e/test%2Fnbrowser%2FFormView.ts",
                "raw_url": "https://github.com/gristlabs/grist-core/raw/10b069005ec8d5f511e6554a56111d8f257f029e/test%2Fnbrowser%2FFormView.ts",
                "contents_url": "https://api.github.com/repos/gristlabs/grist-core/contents/test%2Fnbrowser%2FFormView.ts?ref=10b069005ec8d5f511e6554a56111d8f257f029e",
                "patch": "@@ -20,16 +20,41 @@ describe('FormView', function() {\n \n   afterEach(() => gu.checkForErrors());\n \n-  async function createFormWith(type: string, more = false) {\n+  async function createFormWith(\n+    type: string,\n+    options: {\n+      redirectUrl?: string;\n+    } = {}\n+  ) {\n+    const {redirectUrl} = options;\n+\n     await gu.addNewSection('Form', 'Table1');\n \n+    if (redirectUrl) {\n+      await gu.openWidgetPanel();\n+      await driver.find(\".test-config-submission\").click();\n+      await driver.find(\".test-form-redirect\").click();\n+      await gu.waitForServer();\n+      await driver.find(\".test-form-redirect-url\").click();\n+      await gu.sendKeys(redirectUrl, Key.ENTER);\n+      await gu.waitForServer();\n+    }\n+\n     // Make sure column D is not there.\n     assert.isUndefined(await api.getTable(docId, 'Table1').then(t => t.D));\n \n     // Add a text question\n     await plusButton().click();\n-    if (more) {\n-      await clickMenu('More');\n+    if (\n+      [\n+        \"Integer\",\n+        \"Toggle\",\n+        \"Choice List\",\n+        \"Reference\",\n+        \"Reference List\",\n+      ].includes(type)\n+    ) {\n+      await clickMenu(\"More\");\n     }\n     await clickMenu(type);\n     await gu.waitForServer();\n@@ -366,7 +391,7 @@ describe('FormView', function() {\n     });\n \n     it('can submit a form with text Integer field', async function() {\n-      const formUrl = await createFormWith('Integer', true);\n+      const formUrl = await createFormWith('Integer');\n       // We are in a new window.\n       await gu.onNewTab(async () => {\n         await driver.get(formUrl);\n@@ -388,7 +413,7 @@ describe('FormView', function() {\n     });\n \n     it('can submit a form with spinner Integer field', async function() {\n-      const formUrl = await createFormWith('Integer', true);\n+      const formUrl = await createFormWith('Integer');\n       await driver.findContent('.test-numeric-form-field-format .test-select-button', /Spinner/).click();\n       await gu.waitForServer();\n       // We are in a new window.\n@@ -419,7 +444,7 @@ describe('FormView', function() {\n     });\n \n     it('can submit a form with switch Toggle field', async function() {\n-      const formUrl = await createFormWith('Toggle', true);\n+      const formUrl = await createFormWith('Toggle');\n       // We are in a new window.\n       await gu.onNewTab(async () => {\n         await driver.get(formUrl);\n@@ -449,7 +474,7 @@ describe('FormView', function() {\n     });\n \n     it('can submit a form with checkbox Toggle field', async function() {\n-      const formUrl = await createFormWith('Toggle', true);\n+      const formUrl = await createFormWith('Toggle');\n       await driver.findContent('.test-toggle-form-field-format .test-select-button', /Checkbox/).click();\n       await gu.waitForServer();\n       // We are in a new window.\n@@ -481,7 +506,7 @@ describe('FormView', function() {\n     });\n \n     it('can submit a form with ChoiceList field', async function() {\n-      const formUrl = await createFormWith('Choice List', true);\n+      const formUrl = await createFormWith('Choice List');\n       // Add some options.\n       await gu.openColumnPanel();\n \n@@ -511,7 +536,7 @@ describe('FormView', function() {\n     });\n \n     it('can submit a form with select Ref field', async function() {\n-      const formUrl = await createFormWith('Reference', true);\n+      const formUrl = await createFormWith('Reference');\n       // Add some options.\n       await gu.openColumnPanel();\n       await gu.setRefShowColumn('A');\n@@ -564,7 +589,7 @@ describe('FormView', function() {\n     });\n \n     it('can submit a form with radio Ref field', async function() {\n-      const formUrl = await createFormWith('Reference', true);\n+      const formUrl = await createFormWith('Reference');\n       await driver.findContent('.test-form-field-format .test-select-button', /Radio/).click();\n       await gu.waitForServer();\n       await gu.setRefShowColumn('A');\n@@ -603,7 +628,7 @@ describe('FormView', function() {\n     });\n \n     it('can submit a form with RefList field', async function() {\n-      const formUrl = await createFormWith('Reference List', true);\n+      const formUrl = await createFormWith('Reference List');\n       // Add some options.\n       await gu.setRefShowColumn('A');\n       // Add 3 records to this table (it is now empty).\n@@ -640,6 +665,31 @@ describe('FormView', function() {\n       await removeForm();\n     });\n \n+    it('redirects to valid URLs on submission', async function() {\n+      const url = await createFormWith('Text', {\n+        redirectUrl: \"https://example.com\",\n+      });\n+      await gu.onNewTab(async () => {\n+        await driver.get(url);\n+        await driver.findWait('input[type=\"submit\"]', 2000).click();\n+        await gu.waitForUrl(/example\\.com/);\n+      });\n+      await removeForm();\n+    });\n+\n+    it('does not redirect to invalid URLs on submission', async function() {\n+      const url = await createFormWith('Text', {\n+        redirectUrl: \"javascript:alert()\",\n+      });\n+      await gu.onNewTab(async () => {\n+        await driver.get(url);\n+        await driver.findWait('input[type=\"submit\"]', 2000).click();\n+        await waitForConfirm();\n+        assert.isFalse(await gu.isAlertShown());\n+      });\n+      await removeForm();\n+    });\n+\n     it('excludes formula fields from forms', async function() {\n       const formUrl = await createFormWith('Text');\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/sebhildebrandt/systeminformation/commits/f7af0a67b78e7894335a6cad510566a25e06ae41",
        "url": "https://api.github.com/repos/sebhildebrandt/systeminformation/commits/f7af0a67b78e7894335a6cad510566a25e06ae41",
        "html_url": "https://github.com/sebhildebrandt/systeminformation/commit/f7af0a67b78e7894335a6cad510566a25e06ae41",
        "message": "networkInterfaces() sanitizing SSID names (windows)",
        "files": [
            {
                "sha": "3038d2692a66b5f1889c4a46a1d22bcf7f246f28",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/sebhildebrandt/systeminformation/blob/f7af0a67b78e7894335a6cad510566a25e06ae41/CHANGELOG.md",
                "raw_url": "https://github.com/sebhildebrandt/systeminformation/raw/f7af0a67b78e7894335a6cad510566a25e06ae41/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/sebhildebrandt/systeminformation/contents/CHANGELOG.md?ref=f7af0a67b78e7894335a6cad510566a25e06ae41",
                "patch": "@@ -90,6 +90,7 @@ For major (breaking) changes - **version 4, 3 and 2** - see end of page.\n \n | Version | Date       | Comment                                                                                             |\n | ------- | ---------- | --------------------------------------------------------------------------------------------------- |\n+| 5.23.7  | 2024-12-09 | `networkInterfaces()` sanitizing SSID names (windows)                                               |\n | 5.23.6  | 2024-12-08 | `system()` added Raspberry CM5 detection                                                            |\n | 5.23.5  | 2024-08-21 | `processLoad()` fixed * process list (linux)                                                        |\n | 5.23.4  | 2024-08-06 | `baseboard()` `chassis()` cleaned defaults (linux)                                                  |"
            },
            {
                "sha": "929c6e99e155853d418fce0e963f9cec85061f99",
                "filename": "docs/history.html",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/sebhildebrandt/systeminformation/blob/f7af0a67b78e7894335a6cad510566a25e06ae41/docs%2Fhistory.html",
                "raw_url": "https://github.com/sebhildebrandt/systeminformation/raw/f7af0a67b78e7894335a6cad510566a25e06ae41/docs%2Fhistory.html",
                "contents_url": "https://api.github.com/repos/sebhildebrandt/systeminformation/contents/docs%2Fhistory.html?ref=f7af0a67b78e7894335a6cad510566a25e06ae41",
                "patch": "@@ -57,6 +57,11 @@ <h3>Full version history</h3>\n                     </tr>\n                   </thead>\n                   <tbody>\n+                    <tr>\n+                      <th scope=\"row\">5.23.7</th>\n+                      <td>2024-12-09</td>\n+                      <td><span class=\"code\">networkInterfaces()</span> sanitizing SSID names (windows)</td>\n+                    </tr>\n                     <tr>\n                       <th scope=\"row\">5.23.6</th>\n                       <td>2024-12-08</td>"
            },
            {
                "sha": "d29acd2432d2781a5fc246aa68665838234ba696",
                "filename": "docs/index.html",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/sebhildebrandt/systeminformation/blob/f7af0a67b78e7894335a6cad510566a25e06ae41/docs%2Findex.html",
                "raw_url": "https://github.com/sebhildebrandt/systeminformation/raw/f7af0a67b78e7894335a6cad510566a25e06ae41/docs%2Findex.html",
                "contents_url": "https://api.github.com/repos/sebhildebrandt/systeminformation/contents/docs%2Findex.html?ref=f7af0a67b78e7894335a6cad510566a25e06ae41",
                "patch": "@@ -170,7 +170,7 @@\n       <img class=\"logo\" src=\"assets/logo.png\" alt=\"logo\">\n       <div class=\"title\">systeminformation</div>\n       <div class=\"subtitle\"><span id=\"typed\"></span>&nbsp;</div>\n-      <div class=\"version\">New Version: <span id=\"version\">5.23.6</span></div>\n+      <div class=\"version\">New Version: <span id=\"version\">5.23.7</span></div>\n       <button class=\"btn btn-light\" onclick=\"location.href='https://github.com/sebhildebrandt/systeminformation'\">View on Github <i class=\" fab fa-github\"></i></button>\n     </div>\n     <div class=\"down\">"
            },
            {
                "sha": "4071aef145e09c3589397287f58ce5f84fd2e6c2",
                "filename": "lib/network.js",
                "status": "modified",
                "additions": 13,
                "deletions": 3,
                "changes": 16,
                "blob_url": "https://github.com/sebhildebrandt/systeminformation/blob/f7af0a67b78e7894335a6cad510566a25e06ae41/lib%2Fnetwork.js",
                "raw_url": "https://github.com/sebhildebrandt/systeminformation/raw/f7af0a67b78e7894335a6cad510566a25e06ae41/lib%2Fnetwork.js",
                "contents_url": "https://api.github.com/repos/sebhildebrandt/systeminformation/contents/lib%2Fnetwork.js?ref=f7af0a67b78e7894335a6cad510566a25e06ae41",
                "patch": "@@ -348,7 +348,7 @@ function getWindowsWirelessIfaceSSID(interfaceName) {\n   try {\n     const result = execSync(`netsh wlan show  interface name=\"${interfaceName}\" | findstr \"SSID\"`, util.execOptsWin);\n     const SSID = result.split('\\r\\n').shift();\n-    const parseSSID = SSID.split(':').pop();\n+    const parseSSID = SSID.split(':').pop().trim();\n     return parseSSID;\n   } catch (error) {\n     return 'Unknown';\n@@ -400,8 +400,18 @@ function getWindowsIEEE8021x(connectionType, iface, ifaces) {\n     try {\n       const SSID = getWindowsWirelessIfaceSSID(iface);\n       if (SSID !== 'Unknown') {\n-        i8021xState = execSync(`netsh wlan show profiles \"${SSID}\" | findstr \"802.1X\"`, util.execOptsWin);\n-        i8021xProtocol = execSync(`netsh wlan show profiles \"${SSID}\" | findstr \"EAP\"`, util.execOptsWin);\n+\n+        let ifaceSanitized = '';\n+        const s = util.isPrototypePolluted() ? '---' : util.sanitizeShellString(SSID);\n+        const l = util.mathMin(s.length, 2000);\n+\n+        for (let i = 0; i <= l; i++) {\n+          if (s[i] !== undefined) {\n+            ifaceSanitized = ifaceSanitized + s[i];\n+          }\n+        }\n+        i8021xState = execSync(`netsh wlan show profiles \"${ifaceSanitized}\" | findstr \"802.1X\"`, util.execOptsWin);\n+        i8021xProtocol = execSync(`netsh wlan show profiles \"${ifaceSanitized}\" | findstr \"EAP\"`, util.execOptsWin);\n       }\n \n       if (i8021xState.includes(':') && i8021xProtocol.includes(':')) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/joelbutcher/socialstream/commits/ae4dc3906f54fa792b296036d7b3dcea9a4d259b",
        "url": "https://api.github.com/repos/joelbutcher/socialstream/commits/ae4dc3906f54fa792b296036d7b3dcea9a4d259b",
        "html_url": "https://github.com/joelbutcher/socialstream/commit/ae4dc3906f54fa792b296036d7b3dcea9a4d259b",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "371e7b28ec4931425f4a8132cac85fd04cdbaa57",
                "filename": "resources/views/oauth/prompt.blade.php",
                "status": "added",
                "additions": 47,
                "deletions": 0,
                "changes": 47,
                "blob_url": "https://github.com/joelbutcher/socialstream/blob/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/resources%2Fviews%2Foauth%2Fprompt.blade.php",
                "raw_url": "https://github.com/joelbutcher/socialstream/raw/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/resources%2Fviews%2Foauth%2Fprompt.blade.php",
                "contents_url": "https://api.github.com/repos/joelbutcher/socialstream/contents/resources%2Fviews%2Foauth%2Fprompt.blade.php?ref=ae4dc3906f54fa792b296036d7b3dcea9a4d259b",
                "patch": "@@ -0,0 +1,47 @@\n+<!DOCTYPE html>\n+<html lang=\"{{ str_replace('_', '-', app()->getLocale()) }}\">\n+<head>\n+    <meta charset=\"utf-8\">\n+    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n+\n+    <title>Laravel</title>\n+\n+    <!-- Fonts -->\n+    <link rel=\"preconnect\" href=\"https://fonts.bunny.net\">\n+    <link href=\"https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap\" rel=\"stylesheet\" />\n+\n+    <!-- Styles / Scripts -->\n+    <script src=\"https://cdn.tailwindcss.com\"></script>\n+</head>\n+<body class=\"font-sans antialiased\">\n+    <div class=\" min-h-screen bg-gray-100 flex justify-center items-center dark:bg-gray-900\">\n+        <div class=\"w-full sm:max-w-sm bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg px-6 py-4\">\n+            <h2 class=\"mb-4 font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight\">\n+                Confirm connection of your {{ \\JoelButcher\\Socialstream\\Providers::name($provider) }} account.\n+            </h2>\n+\n+            <form method=\"POST\" action=\"{{ route('oauth.callback.confirm', $provider) }}\">\n+                @csrf\n+                <p class=\"text-sm text-gray-600 dark:text-gray-400\">\n+                    @if (config('socialstream.confirmation-prompt'))\n+                        {{ config('socialstream.confirmation-prompt') }}\n+                    @else\n+                        To ensure you are the account owner of this {{ \\JoelButcher\\Socialstream\\Providers::name($provider) }} account,\n+                        please confirm or deny the request below to link this provider to your account.\n+                    @endif\n+                </p>\n+\n+                <div class=\"mt-4 flex items-center justify-between\">\n+                    <button type=\"submit\" name=\"result\" value=\"deny\" class=\"inline-flex items-center justify-center px-4 py-2 bg-red-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-red-500 active:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition ease-in-out duration-150\">\n+                        Deny\n+                    </button>\n+\n+                    <button type=\"submit\" name=\"result\" value=\"confirm\" class=\"inline-flex items-center px-4 py-2 bg-gray-800 dark:bg-gray-200 border border-transparent rounded-md font-semibold text-xs text-white dark:text-gray-800 uppercase tracking-widest hover:bg-gray-700 dark:hover:bg-white focus:bg-gray-700 dark:focus:bg-white active:bg-gray-900 dark:active:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 transition ease-in-out duration-150\">\n+                        Confirm\n+                    </button>\n+                </div>\n+            </form>\n+        </div>\n+    </div>\n+</body>\n+</html>"
            },
            {
                "sha": "dcc6b5961da3e5be647a1aeb9b7992c770000c4a",
                "filename": "routes/web.php",
                "status": "added",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/joelbutcher/socialstream/blob/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/routes%2Fweb.php",
                "raw_url": "https://github.com/joelbutcher/socialstream/raw/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/routes%2Fweb.php",
                "contents_url": "https://api.github.com/repos/joelbutcher/socialstream/contents/routes%2Fweb.php?ref=ae4dc3906f54fa792b296036d7b3dcea9a4d259b",
                "patch": "@@ -0,0 +1,12 @@\n+<?php\n+\n+use Illuminate\\Support\\Facades\\Route;\n+use JoelButcher\\Socialstream\\Http\\Controllers\\OAuthController;\n+\n+\n+Route::group(['middleware' => config('socialstream.middleware', ['web'])], function () {\n+    Route::get('/oauth/{provider}/callback/prompt', [OAuthController::class, 'prompt'])->name('oauth.callback.prompt');\n+    Route::post('/oauth/{provider}/callback/confirm', [OAuthController::class, 'confirm'])->name(\n+        'oauth.callback.confirm'\n+    );\n+});"
            },
            {
                "sha": "f44cd0c45224162626e13e1088f497f5b5841104",
                "filename": "src/Actions/AuthenticateOAuthCallback.php",
                "status": "modified",
                "additions": 6,
                "deletions": 8,
                "changes": 14,
                "blob_url": "https://github.com/joelbutcher/socialstream/blob/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/src%2FActions%2FAuthenticateOAuthCallback.php",
                "raw_url": "https://github.com/joelbutcher/socialstream/raw/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/src%2FActions%2FAuthenticateOAuthCallback.php",
                "contents_url": "https://api.github.com/repos/joelbutcher/socialstream/contents/src%2FActions%2FAuthenticateOAuthCallback.php?ref=ae4dc3906f54fa792b296036d7b3dcea9a4d259b",
                "patch": "@@ -65,7 +65,10 @@ public function authenticate(string $provider, ProviderUser $providerAccount): S\n     {\n         // If the user is authenticated, link the provider to the authenticated user.\n         if ($user = auth()->user()) {\n-            return $this->link($user, $provider, $providerAccount);\n+            // cache the provider account for 10 mins whilst the user is redirected to the confirmation screen.\n+            cache()->put(\"socialstream.{$user->id}:$provider.provider\", $providerAccount, ttl: new \\DateInterval('PT10M'));\n+\n+            return redirect()->route('oauth.callback.prompt', $provider);\n         }\n \n         // Check if the user has an existing OAuth account.\n@@ -198,16 +201,11 @@ function ($request, $next) {\n         ]));\n     }\n \n-    /**\n-     * Attempt to link the provider to the authenticated user.\n-     *\n-     * Attempt to link the provider with the authenticated user.\n-     */\n-    private function link(Authenticatable $user, string $provider, ProviderUser $providerAccount): SocialstreamResponse\n+    public function link(Authenticatable $user, string $provider, ProviderUser $providerAccount): SocialstreamResponse\n     {\n         $account = Socialstream::findConnectedAccountForProviderAndId($provider, $providerAccount->getId());\n \n-        if ($account && $user?->id !== $account->user_id) {\n+        if ($account && $user->id !== $account->user_id) {\n             event(new OAuthProviderLinkFailed($user, $provider, $account, $providerAccount));\n \n             $this->flashError("
            },
            {
                "sha": "8414a78f493c97d7a242cc7d25edc9613ceefb7f",
                "filename": "src/Http/Controllers/OAuthController.php",
                "status": "modified",
                "additions": 62,
                "deletions": 0,
                "changes": 62,
                "blob_url": "https://github.com/joelbutcher/socialstream/blob/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/src%2FHttp%2FControllers%2FOAuthController.php",
                "raw_url": "https://github.com/joelbutcher/socialstream/raw/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/src%2FHttp%2FControllers%2FOAuthController.php",
                "contents_url": "https://api.github.com/repos/joelbutcher/socialstream/contents/src%2FHttp%2FControllers%2FOAuthController.php?ref=ae4dc3906f54fa792b296036d7b3dcea9a4d259b",
                "patch": "@@ -2,17 +2,25 @@\n \n namespace JoelButcher\\Socialstream\\Http\\Controllers;\n \n+use Illuminate\\Contracts\\View\\View;\n use Illuminate\\Http\\RedirectResponse;\n use Illuminate\\Http\\Request;\n use Illuminate\\Http\\Response;\n use Illuminate\\Routing\\Controller;\n+use Illuminate\\Support\\Facades\\Cache;\n use Illuminate\\Support\\Facades\\Session;\n+use Illuminate\\Support\\MessageBag;\n+use Illuminate\\Support\\ViewErrorBag;\n use JoelButcher\\Socialstream\\Contracts\\AuthenticatesOAuthCallback;\n use JoelButcher\\Socialstream\\Contracts\\GeneratesProviderRedirect;\n use JoelButcher\\Socialstream\\Contracts\\HandlesInvalidState;\n use JoelButcher\\Socialstream\\Contracts\\HandlesOAuthCallbackErrors;\n use JoelButcher\\Socialstream\\Contracts\\ResolvesSocialiteUsers;\n use JoelButcher\\Socialstream\\Contracts\\SocialstreamResponse;\n+use JoelButcher\\Socialstream\\Events\\OAuthProviderLinkFailed;\n+use JoelButcher\\Socialstream\\Http\\Responses\\OAuthProviderLinkFailedResponse;\n+use JoelButcher\\Socialstream\\Providers;\n+use Laravel\\Jetstream\\Jetstream;\n use Laravel\\Socialite\\Two\\InvalidStateException;\n use Symfony\\Component\\HttpFoundation\\RedirectResponse as SymfonyRedirectResponse;\n \n@@ -59,4 +67,58 @@ public function callback(Request $request, string $provider): SocialstreamRespon\n \n         return $this->authenticator->authenticate($provider, $providerAccount);\n     }\n+\n+    /**\n+     * Show the oauth confirmation page.\n+     */\n+    public function prompt(string $provider): View\n+    {\n+        return view('socialstream::oauth.prompt', [\n+            'provider' => $provider,\n+        ]);\n+    }\n+\n+    public function confirm(string $provider): SocialstreamResponse|RedirectResponse\n+    {\n+        $user = auth()->user();\n+        $providerAccount = cache()->pull(\"socialstream.{$user->id}:$provider.provider\");\n+\n+        $result = request()->input('result');\n+\n+        if ($result === 'deny') {\n+            event(new OAuthProviderLinkFailed($user, $provider, null, $providerAccount));\n+\n+            $this->flashError(\n+                __('Failed to link :provider account. User denied request.', ['provider' => Providers::name($provider)]),\n+            );\n+\n+            return app(OAuthProviderLinkFailedResponse::class);\n+        }\n+\n+        if (!$providerAccount) {\n+            throw new \\DomainException(\n+                message: 'Could not retrieve social provider information.'\n+            );\n+        }\n+\n+        return $this->authenticator->link($user, $provider, $providerAccount);\n+    }\n+\n+    private function flashError(string $error): void\n+    {\n+        if (auth()->check()) {\n+            if (class_exists(Jetstream::class)) {\n+                Session::flash('flash.banner', $error);\n+                Session::flash('flash.bannerStyle', 'danger');\n+\n+                return;\n+            }\n+        }\n+\n+        Session::flash('errors', (new ViewErrorBag())->put(\n+            'default',\n+            new MessageBag(['socialstream' => $error])\n+        ));\n+    }\n+\n }"
            },
            {
                "sha": "0a9ea12c0f7358bcf503219b492c4657e7f6b817",
                "filename": "src/SocialstreamServiceProvider.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/joelbutcher/socialstream/blob/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/src%2FSocialstreamServiceProvider.php",
                "raw_url": "https://github.com/joelbutcher/socialstream/raw/ae4dc3906f54fa792b296036d7b3dcea9a4d259b/src%2FSocialstreamServiceProvider.php",
                "contents_url": "https://api.github.com/repos/joelbutcher/socialstream/contents/src%2FSocialstreamServiceProvider.php?ref=ae4dc3906f54fa792b296036d7b3dcea9a4d259b",
                "patch": "@@ -141,6 +141,7 @@ private function configureRoutes(): void\n             'domain' => config('socialstream.domain'),\n             'prefix' => config('socialstream.prefix', config('socialstream.path')),\n         ], function () {\n+            $this->loadRoutesFrom(path: __DIR__.'/../routes/web.php');\n             $this->loadRoutesFrom(path: __DIR__.'/../routes/'.config('jetstream.stack', 'livewire').'.php');\n         });\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/spatie/browsershot/commits/f791ce0ae8dd99367dbfa30588ee31e1196e1728",
        "url": "https://api.github.com/repos/spatie/browsershot/commits/f791ce0ae8dd99367dbfa30588ee31e1196e1728",
        "html_url": "https://github.com/spatie/browsershot/commit/f791ce0ae8dd99367dbfa30588ee31e1196e1728",
        "message": "do not allow view-source",
        "files": [
            {
                "sha": "4785bb47431e07e8be64e73e69719af065c0ed9c",
                "filename": "src/Browsershot.php",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/spatie/browsershot/blob/f791ce0ae8dd99367dbfa30588ee31e1196e1728/src%2FBrowsershot.php",
                "raw_url": "https://github.com/spatie/browsershot/raw/f791ce0ae8dd99367dbfa30588ee31e1196e1728/src%2FBrowsershot.php",
                "contents_url": "https://api.github.com/repos/spatie/browsershot/contents/src%2FBrowsershot.php?ref=f791ce0ae8dd99367dbfa30588ee31e1196e1728",
                "patch": "@@ -259,7 +259,13 @@ public function setUrl(string $url): static\n     {\n         $url = trim($url);\n \n-        $unsupportedProtocols = ['file://', 'file:/', 'file:\\\\', 'file:\\\\\\\\'];\n+        $unsupportedProtocols = [\n+            'file://',\n+            'file:/',\n+            'file:\\\\',\n+            'file:\\\\\\\\',\n+            'view-source',\n+        ];\n \n         foreach ($unsupportedProtocols as $unsupportedProtocol) {\n             if (str_starts_with(strtolower($url), $unsupportedProtocol)) {"
            },
            {
                "sha": "7f787cbfeae24ec892383b2db1d92d0b376f4a4e",
                "filename": "tests/BrowsershotTest.php",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/spatie/browsershot/blob/f791ce0ae8dd99367dbfa30588ee31e1196e1728/tests%2FBrowsershotTest.php",
                "raw_url": "https://github.com/spatie/browsershot/raw/f791ce0ae8dd99367dbfa30588ee31e1196e1728/tests%2FBrowsershotTest.php",
                "contents_url": "https://api.github.com/repos/spatie/browsershot/contents/tests%2FBrowsershotTest.php?ref=f791ce0ae8dd99367dbfa30588ee31e1196e1728",
                "patch": "@@ -56,9 +56,12 @@\n     Browsershot::url($url);\n })->throws(FileUrlNotAllowed::class)->with([\n     'file://test',\n+    'File://test',\n     'file:/test',\n     'file:\\test',\n     'file:\\\\test',\n+    'view-source',\n+    'View-Source'\n ]);\n \n it('will not allow a file url that has leading spaces', function () {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/hashicorp/nomad/commits/359a71861ef044cb5d749a36ff0e44b172c8f1a6",
        "url": "https://api.github.com/repos/hashicorp/nomad/commits/359a71861ef044cb5d749a36ff0e44b172c8f1a6",
        "html_url": "https://github.com/hashicorp/nomad/commit/359a71861ef044cb5d749a36ff0e44b172c8f1a6",
        "message": "Backport of sec: fix alloc workload identity namespace permission into release/1.9.x (#24685)\n\nCo-authored-by: Deniz Onur Duzgun <59659739+dduzgun-security@users.noreply.github.com>",
        "files": [
            {
                "sha": "af07d6a99dadf8f30fcc4f311c85e3ac9e318d77",
                "filename": ".changelog/24683.txt",
                "status": "added",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/hashicorp/nomad/blob/359a71861ef044cb5d749a36ff0e44b172c8f1a6/.changelog%2F24683.txt",
                "raw_url": "https://github.com/hashicorp/nomad/raw/359a71861ef044cb5d749a36ff0e44b172c8f1a6/.changelog%2F24683.txt",
                "contents_url": "https://api.github.com/repos/hashicorp/nomad/contents/.changelog%2F24683.txt?ref=359a71861ef044cb5d749a36ff0e44b172c8f1a6",
                "patch": "@@ -0,0 +1,3 @@\n+```release-note:security\n+api: sanitize the SignedIdentities in allocations to prevent privilege escalation through unredacted workload identity token impersonation associated with ACL policies.\n+```"
            },
            {
                "sha": "2f6838aa08839cb952e08226da880be93a2ca981",
                "filename": "command/agent/node_endpoint.go",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/hashicorp/nomad/blob/359a71861ef044cb5d749a36ff0e44b172c8f1a6/command%2Fagent%2Fnode_endpoint.go",
                "raw_url": "https://github.com/hashicorp/nomad/raw/359a71861ef044cb5d749a36ff0e44b172c8f1a6/command%2Fagent%2Fnode_endpoint.go",
                "contents_url": "https://api.github.com/repos/hashicorp/nomad/contents/command%2Fagent%2Fnode_endpoint.go?ref=359a71861ef044cb5d749a36ff0e44b172c8f1a6",
                "patch": "@@ -105,6 +105,7 @@ func (s *HTTPServer) nodeAllocations(resp http.ResponseWriter, req *http.Request\n \t\tout.Allocs = make([]*structs.Allocation, 0)\n \t}\n \tfor _, alloc := range out.Allocs {\n+\t\talloc = alloc.Sanitize()\n \t\talloc.SetEventDisplayMessages()\n \t}\n \treturn out.Allocs, nil"
            },
            {
                "sha": "9e8678eb1742ccfa3c1c7fa5b118058258899c88",
                "filename": "nomad/alloc_endpoint.go",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hashicorp/nomad/blob/359a71861ef044cb5d749a36ff0e44b172c8f1a6/nomad%2Falloc_endpoint.go",
                "raw_url": "https://github.com/hashicorp/nomad/raw/359a71861ef044cb5d749a36ff0e44b172c8f1a6/nomad%2Falloc_endpoint.go",
                "contents_url": "https://api.github.com/repos/hashicorp/nomad/contents/nomad%2Falloc_endpoint.go?ref=359a71861ef044cb5d749a36ff0e44b172c8f1a6",
                "patch": "@@ -172,8 +172,9 @@ func (a *Alloc) GetAlloc(args *structs.AllocSpecificRequest,\n \t\t\t}\n \n \t\t\t// Setup the output\n-\t\t\treply.Alloc = out\n \t\t\tif out != nil {\n+\t\t\t\tout = out.Sanitize()\n+\t\t\t\treply.Alloc = out\n \t\t\t\t// Re-check namespace in case it differs from request.\n \t\t\t\tif !aclObj.AllowClientOp() && !allowNsOp(aclObj, out.Namespace) {\n \t\t\t\t\treturn structs.NewErrUnknownAllocation(args.AllocID)"
            },
            {
                "sha": "b3f0e8e4ac2eb60b583c4db486ebc6b3081cb5d4",
                "filename": "nomad/structs/structs.go",
                "status": "modified",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/hashicorp/nomad/blob/359a71861ef044cb5d749a36ff0e44b172c8f1a6/nomad%2Fstructs%2Fstructs.go",
                "raw_url": "https://github.com/hashicorp/nomad/raw/359a71861ef044cb5d749a36ff0e44b172c8f1a6/nomad%2Fstructs%2Fstructs.go",
                "contents_url": "https://api.github.com/repos/hashicorp/nomad/contents/nomad%2Fstructs%2Fstructs.go?ref=359a71861ef044cb5d749a36ff0e44b172c8f1a6",
                "patch": "@@ -11199,6 +11199,23 @@ func (a *Allocation) GetID() string {\n \treturn a.ID\n }\n \n+// Sanitize returns a copy of the allocation with the SignedIdentities field\n+// removed. This is useful for returning allocations to clients where the\n+// SignedIdentities field is not needed.\n+func (a *Allocation) Sanitize() *Allocation {\n+\tif a == nil {\n+\t\treturn nil\n+\t}\n+\n+\tif a.SignedIdentities == nil {\n+\t\treturn a\n+\t}\n+\n+\tclean := a.Copy()\n+\tclean.SignedIdentities = nil\n+\treturn clean\n+}\n+\n // GetNamespace implements the NamespaceGetter interface, required for\n // pagination and filtering namespaces in endpoints that support glob namespace\n // requests using tokens with limited access."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/withastro/astro/commits/c879f501ff01b1a3c577de776a1f7100d78f8dd5",
        "url": "https://api.github.com/repos/withastro/astro/commits/c879f501ff01b1a3c577de776a1f7100d78f8dd5",
        "html_url": "https://github.com/withastro/astro/commit/c879f501ff01b1a3c577de776a1f7100d78f8dd5",
        "message": "Revert \"fix custom `assetFileNames` issue (#12449)\" (#12746)\n\n* Revert \"fix custom `assetFileNames` issue (#12449)\"\r\n\r\nThis reverts commit e6b80172391d5f9aa5b1de26a8694ba4a28a43f3.\r\n\r\nThis change caused source maps to be left in the client folder, exposing them into the server.\r\n\r\n* Add changeset",
        "files": [
            {
                "sha": "ec07dec9c1577c2336f1d738cce794f7a0f02775",
                "filename": ".changeset/loud-emus-look.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/withastro/astro/blob/c879f501ff01b1a3c577de776a1f7100d78f8dd5/.changeset%2Floud-emus-look.md",
                "raw_url": "https://github.com/withastro/astro/raw/c879f501ff01b1a3c577de776a1f7100d78f8dd5/.changeset%2Floud-emus-look.md",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/.changeset%2Floud-emus-look.md?ref=c879f501ff01b1a3c577de776a1f7100d78f8dd5",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'astro': patch\n+---\n+\n+Remove all assets created from the server build"
            },
            {
                "sha": "298857516305d9f38a02864132ae7e411ed88805",
                "filename": "packages/astro/src/core/build/index.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/withastro/astro/blob/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Findex.ts",
                "raw_url": "https://github.com/withastro/astro/raw/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Findex.ts",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Findex.ts?ref=c879f501ff01b1a3c577de776a1f7100d78f8dd5",
                "patch": "@@ -205,7 +205,7 @@ class AstroBuilder {\n \t\t\tkey: keyPromise,\n \t\t};\n \n-\t\tconst { internals, ssrOutputChunkNames, ssrOutputAssetNames, contentFileNames } =\n+\t\tconst { internals, ssrOutputChunkNames, contentFileNames } =\n \t\t\tawait viteBuild(opts);\n \n \t\tconst hasServerIslands = this.settings.serverIslandNameMap.size > 0;\n@@ -214,7 +214,7 @@ class AstroBuilder {\n \t\t\tthrow new AstroError(AstroErrorData.NoAdapterInstalledServerIslands);\n \t\t}\n \n-\t\tawait staticBuild(opts, internals, ssrOutputChunkNames, ssrOutputAssetNames, contentFileNames);\n+\t\tawait staticBuild(opts, internals, ssrOutputChunkNames, contentFileNames);\n \n \t\t// Write any additionally generated assets to disk.\n \t\tthis.timer.assetsStart = performance.now();"
            },
            {
                "sha": "5a86992b2b346fe9a91bc4eea433f12373310aae",
                "filename": "packages/astro/src/core/build/static-build.ts",
                "status": "modified",
                "additions": 15,
                "deletions": 13,
                "changes": 28,
                "blob_url": "https://github.com/withastro/astro/blob/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Fstatic-build.ts",
                "raw_url": "https://github.com/withastro/astro/raw/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Fstatic-build.ts",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Fstatic-build.ts?ref=c879f501ff01b1a3c577de776a1f7100d78f8dd5",
                "patch": "@@ -104,26 +104,21 @@ export async function viteBuild(opts: StaticBuildOptions) {\n \t// For static builds, the SSR output won't be needed anymore after page generation.\n \t// We keep track of the names here so we only remove these specific files when finished.\n \tconst ssrOutputChunkNames: string[] = [];\n-\tconst ssrOutputAssetNames: string[] = [];\n \tfor (const output of ssrOutputs) {\n \t\tfor (const chunk of output.output) {\n \t\t\tif (chunk.type === 'chunk') {\n \t\t\t\tssrOutputChunkNames.push(chunk.fileName);\n \t\t\t}\n-\t\t\tif (chunk.type === 'asset') {\n-\t\t\t\tssrOutputAssetNames.push(chunk.fileName);\n-\t\t\t}\n \t\t}\n \t}\n \n-\treturn { internals, ssrOutputChunkNames, ssrOutputAssetNames, contentFileNames };\n+\treturn { internals, ssrOutputChunkNames, contentFileNames };\n }\n \n export async function staticBuild(\n \topts: StaticBuildOptions,\n \tinternals: BuildInternals,\n \tssrOutputChunkNames: string[],\n-\tssrOutputAssetNames: string[],\n \tcontentFileNames?: string[],\n ) {\n \tconst { settings } = opts;\n@@ -136,7 +131,7 @@ export async function staticBuild(\n \t\tsettings.timer.start('Server generate');\n \t\tawait generatePages(opts, internals);\n \t\tawait cleanStaticOutput(opts, internals);\n-\t\tawait ssrMoveAssets(opts, ssrOutputAssetNames);\n+\t\tawait ssrMoveAssets(opts);\n \t\tsettings.timer.end('Server generate');\n \t}\n }\n@@ -417,21 +412,28 @@ export async function copyFiles(fromFolder: URL, toFolder: URL, includeDotfiles\n \t);\n }\n \n-async function ssrMoveAssets(opts: StaticBuildOptions, ssrOutputAssetNames: string[]) {\n+async function ssrMoveAssets(opts: StaticBuildOptions) {\n \topts.logger.info('build', 'Rearranging server assets...');\n \tconst serverRoot =\n \t\topts.settings.buildOutput === 'static'\n \t\t\t? opts.settings.config.build.client\n \t\t\t: opts.settings.config.build.server;\n \tconst clientRoot = opts.settings.config.build.client;\n-\tif (ssrOutputAssetNames.length > 0) {\n+\tconst assets = opts.settings.config.build.assets;\n+\tconst serverAssets = new URL(`./${assets}/`, appendForwardSlash(serverRoot.toString()));\n+\tconst clientAssets = new URL(`./${assets}/`, appendForwardSlash(clientRoot.toString()));\n+\tconst files = await glob(`**/*`, {\n+\t\tcwd: fileURLToPath(serverAssets),\n+\t});\n+\n+\tif (files.length > 0) {\n \t\tawait Promise.all(\n-\t\t\tssrOutputAssetNames.map(async function moveAsset(filename) {\n-\t\t\t\tconst currentUrl = new URL(filename, appendForwardSlash(serverRoot.toString()));\n-\t\t\t\tconst clientUrl = new URL(filename, appendForwardSlash(clientRoot.toString()));\n+\t\t\tfiles.map(async function moveAsset(filename) {\n+\t\t\t\tconst currentUrl = new URL(filename, appendForwardSlash(serverAssets.toString()));\n+\t\t\t\tconst clientUrl = new URL(filename, appendForwardSlash(clientAssets.toString()));\n \t\t\t\tconst dir = new URL(path.parse(clientUrl.href).dir);\n \t\t\t\t// It can't find this file because the user defines a custom path\n-\t\t\t\t// that includes the folder paths in `assetFileNames`\n+\t\t\t\t// that includes the folder paths in `assetFileNames\n \t\t\t\tif (!fs.existsSync(dir)) await fs.promises.mkdir(dir, { recursive: true });\n \t\t\t\treturn fs.promises.rename(currentUrl, clientUrl);\n \t\t\t}),"
            },
            {
                "sha": "63cd3eb171f2d73e898c752dc0e6bc21da6d4a14",
                "filename": "packages/astro/test/custom-assets-name.test.js",
                "status": "modified",
                "additions": 5,
                "deletions": 11,
                "changes": 16,
                "blob_url": "https://github.com/withastro/astro/blob/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Ftest%2Fcustom-assets-name.test.js",
                "raw_url": "https://github.com/withastro/astro/raw/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Ftest%2Fcustom-assets-name.test.js",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Ftest%2Fcustom-assets-name.test.js?ref=c879f501ff01b1a3c577de776a1f7100d78f8dd5",
                "patch": "@@ -2,7 +2,7 @@ import assert from 'node:assert/strict';\n import { before, describe, it } from 'node:test';\n import { loadFixture } from './test-utils.js';\n \n-describe('custom assets name function', () => {\n+describe('custom the assets name function', () => {\n \t/** @type {import('./test-utils').Fixture} */\n \tlet fixture;\n \n@@ -14,15 +14,9 @@ describe('custom assets name function', () => {\n \t\tawait fixture.build();\n \t});\n \n-\tit('should load CSS file from custom client assets path', async () => {\n-\t\tconst files = await fixture.readdir('/client/assets/css');\n-\t\tconst cssFile = files.find((file) => file === 'a.css');\n-\t\tassert.ok(cssFile, 'Expected CSS file to exist at client/assets/css/a.css');\n-\t});\n-\n-\tit('should load image file from custom client assets path', async () => {\n-\t\tconst files = await fixture.readdir('/client/imgAssets');\n-\t\tconst imgFile = files.find((file) => file === 'penguin1.jpg');\n-\t\tassert.ok(imgFile, 'Expected image file to exist at client/imgAssets/penguin1.jpg');\n+\tit('It cant find this file cause the node throws an error if the users custom a path that includes the folder path', async () => {\n+\t\tconst csslength = await fixture.readFile('client/assets/css/a.css');\n+\t\t/** @type {Set<string>} */\n+\t\tassert.equal(!!csslength, true);\n \t});\n });"
            },
            {
                "sha": "cfcddecc5bcc753ed0b79e489165299825c4831c",
                "filename": "packages/astro/test/fixtures/custom-assets-name/astro.config.mjs",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/withastro/astro/blob/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Ftest%2Ffixtures%2Fcustom-assets-name%2Fastro.config.mjs",
                "raw_url": "https://github.com/withastro/astro/raw/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Ftest%2Ffixtures%2Fcustom-assets-name%2Fastro.config.mjs",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Ftest%2Ffixtures%2Fcustom-assets-name%2Fastro.config.mjs?ref=c879f501ff01b1a3c577de776a1f7100d78f8dd5",
                "patch": "@@ -18,14 +18,14 @@ export default defineConfig({\n             const { ext, dir, base } = path.parse(option.name);\n \n             if (ext == \".css\") return path.join(dir, \"assets/css\", 'a.css');\n-            return \"imgAssets/[name].[ext]\";\n+            return \"assets/img/[name].[ext]\";\n           }\n         }\n       }\n     }\n   },\n   build: {\n-    assets: 'assetsDir'\n+    assets: 'assets'\n   },\n   output: \"server\",\n   adapter: node({"
            },
            {
                "sha": "1a8986ac50923dbb9b36ad43e1af1415928ea912",
                "filename": "packages/astro/test/fixtures/custom-assets-name/src/images/penguin1.jpg",
                "status": "removed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/withastro/astro/blob/33ae7320e8687ab243424980f3ec8f64bf06a94f/packages%2Fastro%2Ftest%2Ffixtures%2Fcustom-assets-name%2Fsrc%2Fimages%2Fpenguin1.jpg",
                "raw_url": "https://github.com/withastro/astro/raw/33ae7320e8687ab243424980f3ec8f64bf06a94f/packages%2Fastro%2Ftest%2Ffixtures%2Fcustom-assets-name%2Fsrc%2Fimages%2Fpenguin1.jpg",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Ftest%2Ffixtures%2Fcustom-assets-name%2Fsrc%2Fimages%2Fpenguin1.jpg?ref=33ae7320e8687ab243424980f3ec8f64bf06a94f"
            },
            {
                "sha": "250233e1e15fbc8cca9e83a02f3419b8f5e5765f",
                "filename": "packages/astro/test/fixtures/custom-assets-name/src/pages/index.astro",
                "status": "modified",
                "additions": 0,
                "deletions": 2,
                "changes": 2,
                "blob_url": "https://github.com/withastro/astro/blob/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Ftest%2Ffixtures%2Fcustom-assets-name%2Fsrc%2Fpages%2Findex.astro",
                "raw_url": "https://github.com/withastro/astro/raw/c879f501ff01b1a3c577de776a1f7100d78f8dd5/packages%2Fastro%2Ftest%2Ffixtures%2Fcustom-assets-name%2Fsrc%2Fpages%2Findex.astro",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Ftest%2Ffixtures%2Fcustom-assets-name%2Fsrc%2Fpages%2Findex.astro?ref=c879f501ff01b1a3c577de776a1f7100d78f8dd5",
                "patch": "@@ -1,6 +1,5 @@\n ---\n const title = 'My App';\n-import p1Url from '../images/penguin1.jpg';\n ---\n \n <html>\n@@ -9,7 +8,6 @@ import p1Url from '../images/penguin1.jpg';\n </head>\n <body>\n   <h1>{title}</h1>\n-\t<img src={p1Url.src}/>\n </body>\n </html>\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/withastro/astro/commits/039d022b1bbaacf9ea83071d27affc5318e0e515",
        "url": "https://api.github.com/repos/withastro/astro/commits/039d022b1bbaacf9ea83071d27affc5318e0e515",
        "html_url": "https://github.com/withastro/astro/commit/039d022b1bbaacf9ea83071d27affc5318e0e515",
        "message": "Clean sourcemaps from static output (#12749)\n\n* Clean sourcemaps from static output\r\n\r\n* Add changeset\r\n\r\n* Update test to look at frontend sourcemaps",
        "files": [
            {
                "sha": "e0d80ecdb92cb037689f49c8f4f12249fc3f0d4d",
                "filename": ".changeset/tame-spoons-shop.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/withastro/astro/blob/039d022b1bbaacf9ea83071d27affc5318e0e515/.changeset%2Ftame-spoons-shop.md",
                "raw_url": "https://github.com/withastro/astro/raw/039d022b1bbaacf9ea83071d27affc5318e0e515/.changeset%2Ftame-spoons-shop.md",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/.changeset%2Ftame-spoons-shop.md?ref=039d022b1bbaacf9ea83071d27affc5318e0e515",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'astro': patch\n+---\n+\n+Clean server sourcemaps from static output"
            },
            {
                "sha": "14bc534ddca23258ab7a2bf323b9716aa9335daa",
                "filename": "packages/astro/src/core/build/index.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/withastro/astro/blob/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Findex.ts",
                "raw_url": "https://github.com/withastro/astro/raw/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Findex.ts",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Findex.ts?ref=039d022b1bbaacf9ea83071d27affc5318e0e515",
                "patch": "@@ -205,15 +205,16 @@ class AstroBuilder {\n \t\t\tkey: keyPromise,\n \t\t};\n \n-\t\tconst { internals, ssrOutputChunkNames, contentFileNames } = await viteBuild(opts);\n+\t\tconst { internals, ssrOutputChunkNames } =\n+\t\t\tawait viteBuild(opts);\n \n \t\tconst hasServerIslands = this.settings.serverIslandNameMap.size > 0;\n \t\t// Error if there are server islands but no adapter provided.\n \t\tif (hasServerIslands && this.settings.buildOutput !== 'server') {\n \t\t\tthrow new AstroError(AstroErrorData.NoAdapterInstalledServerIslands);\n \t\t}\n \n-\t\tawait staticBuild(opts, internals, ssrOutputChunkNames, contentFileNames);\n+\t\tawait staticBuild(opts, internals, ssrOutputChunkNames);\n \n \t\t// Write any additionally generated assets to disk.\n \t\tthis.timer.assetsStart = performance.now();"
            },
            {
                "sha": "8023d9e3b0129337dfd7f2fb56cd4498e1e88d9f",
                "filename": "packages/astro/src/core/build/static-build.ts",
                "status": "modified",
                "additions": 10,
                "deletions": 8,
                "changes": 18,
                "blob_url": "https://github.com/withastro/astro/blob/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Fstatic-build.ts",
                "raw_url": "https://github.com/withastro/astro/raw/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Fstatic-build.ts",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Fsrc%2Fcore%2Fbuild%2Fstatic-build.ts?ref=039d022b1bbaacf9ea83071d27affc5318e0e515",
                "patch": "@@ -92,7 +92,6 @@ export async function viteBuild(opts: StaticBuildOptions) {\n \tconst ssrOutputs = viteBuildReturnToRollupOutputs(ssrOutput);\n \tconst clientOutputs = viteBuildReturnToRollupOutputs(clientOutput ?? []);\n \tawait runPostBuildHooks(container, ssrOutputs, clientOutputs);\n-\tlet contentFileNames: string[] | undefined = undefined;\n \tsettings.timer.end('Client build');\n \n \t// Free up memory\n@@ -112,20 +111,19 @@ export async function viteBuild(opts: StaticBuildOptions) {\n \t\t}\n \t}\n \n-\treturn { internals, ssrOutputChunkNames, contentFileNames };\n+\treturn { internals, ssrOutputChunkNames };\n }\n \n export async function staticBuild(\n \topts: StaticBuildOptions,\n \tinternals: BuildInternals,\n \tssrOutputChunkNames: string[],\n-\tcontentFileNames?: string[],\n ) {\n \tconst { settings } = opts;\n \tif (settings.buildOutput === 'static') {\n \t\tsettings.timer.start('Static generate');\n \t\tawait generatePages(opts, internals);\n-\t\tawait cleanServerOutput(opts, ssrOutputChunkNames, contentFileNames, internals);\n+\t\tawait cleanServerOutput(opts, ssrOutputChunkNames, internals);\n \t\tsettings.timer.end('Static generate');\n \t} else if (settings.buildOutput === 'server') {\n \t\tsettings.timer.start('Server generate');\n@@ -354,14 +352,12 @@ async function cleanStaticOutput(opts: StaticBuildOptions, internals: BuildInter\n async function cleanServerOutput(\n \topts: StaticBuildOptions,\n \tssrOutputChunkNames: string[],\n-\tcontentFileNames: string[] | undefined,\n \tinternals: BuildInternals,\n ) {\n \tconst out = getOutDirWithinCwd(opts.settings.config.outDir);\n \t// The SSR output chunks for Astro are all .mjs files\n \tconst files = ssrOutputChunkNames\n-\t\t.filter((f) => f.endsWith('.mjs'))\n-\t\t.concat(contentFileNames ?? []);\n+\t\t.filter((f) => f.endsWith('.mjs'));\n \tif (internals.manifestFileName) {\n \t\tfiles.push(internals.manifestFileName);\n \t}\n@@ -370,7 +366,11 @@ async function cleanServerOutput(\n \t\tawait Promise.all(\n \t\t\tfiles.map(async (filename) => {\n \t\t\t\tconst url = new URL(filename, out);\n-\t\t\t\tawait fs.promises.rm(url);\n+\t\t\t\tconst map = new URL(url + '.map');\n+\t\t\t\tawait Promise.all([\n+\t\t\t\t\tfs.promises.rm(url),\n+\t\t\t\t\tfs.promises.rm(new URL(map)).catch((e) => {})\n+\t\t\t\t]);\n \t\t\t}),\n \t\t);\n \n@@ -426,6 +426,8 @@ async function ssrMoveAssets(opts: StaticBuildOptions) {\n \t\tcwd: fileURLToPath(serverAssets),\n \t});\n \n+\tconsole.log(\"FILES2\", files);\n+\n \tif (files.length > 0) {\n \t\tawait Promise.all(\n \t\t\tfiles.map(async function moveAsset(filename) {"
            },
            {
                "sha": "a780a6cb47ca623ef526eb54f73a73a9328243e8",
                "filename": "packages/astro/test/astro-basic.test.js",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/withastro/astro/blob/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Ftest%2Fastro-basic.test.js",
                "raw_url": "https://github.com/withastro/astro/raw/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Ftest%2Fastro-basic.test.js",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Ftest%2Fastro-basic.test.js?ref=039d022b1bbaacf9ea83071d27affc5318e0e515",
                "patch": "@@ -167,6 +167,14 @@ describe('Astro basic build', () => {\n \t\tassert.doesNotMatch(otherHtml, /<style/);\n \t});\n \n+\tit('server sourcemaps not included in output', async () => {\n+\t\tconst files = await fixture.readdir('/');\n+\t\tconst hasSourcemaps = files.some(fileName => {\n+\t\t\treturn fileName.endsWith('.map');\n+\t\t});\n+\t\tassert.equal(hasSourcemaps, false, 'no sourcemap files in output');\n+\t});\n+\n \tdescribe('preview', () => {\n \t\tit('returns 200 for valid URLs', async () => {\n \t\t\tconst result = await fixture.fetch('/');"
            },
            {
                "sha": "bd934cab9e07d9e8183f93ce0d6e0ceb8e509cf5",
                "filename": "packages/astro/test/fixtures/astro-basic/astro.config.mjs",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/withastro/astro/blob/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Ftest%2Ffixtures%2Fastro-basic%2Fastro.config.mjs",
                "raw_url": "https://github.com/withastro/astro/raw/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Ftest%2Ffixtures%2Fastro-basic%2Fastro.config.mjs",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Ftest%2Ffixtures%2Fastro-basic%2Fastro.config.mjs?ref=039d022b1bbaacf9ea83071d27affc5318e0e515",
                "patch": "@@ -6,5 +6,10 @@ import { defineConfig } from 'astro/config';\n export default defineConfig({\n \tintegrations: [preact(), mdx()],\n \t// make sure CLI flags have precedence\n-  server: () => ({ port: 4321 })\n+  server: () => ({ port: 4321 }),\n+  vite: {\n+  \tbuild: {\n+  \t\tsourcemap: true,\n+  \t}\n+  }\n });"
            },
            {
                "sha": "36cd071a6b98219d62ad715838fb0cc63dc69f22",
                "filename": "packages/astro/test/sourcemap.test.js",
                "status": "modified",
                "additions": 8,
                "deletions": 2,
                "changes": 10,
                "blob_url": "https://github.com/withastro/astro/blob/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Ftest%2Fsourcemap.test.js",
                "raw_url": "https://github.com/withastro/astro/raw/039d022b1bbaacf9ea83071d27affc5318e0e515/packages%2Fastro%2Ftest%2Fsourcemap.test.js",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Ftest%2Fsourcemap.test.js?ref=039d022b1bbaacf9ea83071d27affc5318e0e515",
                "patch": "@@ -17,7 +17,13 @@ describe('Sourcemap', async () => {\n \t});\n \n \tit('Builds non-empty sourcemap', async () => {\n-\t\tconst map = await fixture.readFile('renderers.mjs.map');\n-\t\tassert.equal(map.includes('\"sources\":[]'), false);\n+\t\tconst assets = await fixture.readdir('/_astro');\n+\t\tconst maps = assets.filter(file => file.endsWith('.map'));\n+\t\tassert.ok(maps.length > 0, 'got source maps');\n+\t\tfor(const mapName of maps) {\n+\t\t\tconst filename = `/_astro/${mapName}`;\n+\t\t\tconst map = await fixture.readFile(filename);\n+\t\t\tassert.equal(map.includes('\"sources\":[]'), false);\n+\t\t}\n \t});\n });"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xmidt-org/cjwt/commits/096ab3e37f73c914b716e7259589179f363265fd",
        "url": "https://api.github.com/repos/xmidt-org/cjwt/commits/096ab3e37f73c914b716e7259589179f363265fd",
        "html_url": "https://github.com/xmidt-org/cjwt/commit/096ab3e37f73c914b716e7259589179f363265fd",
        "message": "Merge commit from fork\n\n* chore:Fix a meson error.\n\n* Fix potential security issue due to unknown key types.\n\nHS256, HS384 & HS512 are symmetric key based algorithms that use an\narray of bytes as the key.  The array of bytes could be the public key\nof a RSxxx, ECxxx or PSxxx algorithm.  This means that unless the user\nof this library validated that the jwt algorithm matched the expected\nalgorithm type(s), the user could be using a compromised JWT and not\nrealize it.\n\nThis fix requires the caller to declare if they expect a symmetric\ncypher or not to prevent this attack and maintain the interface.  With\nthis change pub/private algorithms and symmetric algorithms are\nsegmented to protect the user from this kind of attack.",
        "files": [
            {
                "sha": "0ddc7b6bb185adde52f94c2a3e96bf3da9d9c120",
                "filename": "README.md",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/xmidt-org/cjwt/blob/096ab3e37f73c914b716e7259589179f363265fd/README.md",
                "raw_url": "https://github.com/xmidt-org/cjwt/raw/096ab3e37f73c914b716e7259589179f363265fd/README.md",
                "contents_url": "https://api.github.com/repos/xmidt-org/cjwt/contents/README.md?ref=096ab3e37f73c914b716e7259589179f363265fd",
                "patch": "@@ -82,7 +82,11 @@ int main( int argc, char *argv[] )\n \n     const char *hs_key = \"hs256-secret\";\n \n-    rv = cjwt_decode( hs_text, strlen(hs_text), 0, (uint8_t*) hs_key, strlen(hs_key), 0, 0, &jwt );\n+    rv = cjwt_decode( hs_text,\n+                      strlen(hs_text),\n+                      OPT_ALLOW_ONLY_HS_ALG,\n+                      (uint8_t*) hs_key,\n+                      strlen(hs_key), 0, 0, &jwt );\n     if( CJWTE_OK != rv ) {\n         printf( \"There was an error processing the text: %d\\n\", rv );\n         return -1;"
            },
            {
                "sha": "0baf61db6111236871993547e0302fa001efec4a",
                "filename": "include/cjwt/cjwt.h",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/xmidt-org/cjwt/blob/096ab3e37f73c914b716e7259589179f363265fd/include%2Fcjwt%2Fcjwt.h",
                "raw_url": "https://github.com/xmidt-org/cjwt/raw/096ab3e37f73c914b716e7259589179f363265fd/include%2Fcjwt%2Fcjwt.h",
                "contents_url": "https://api.github.com/repos/xmidt-org/cjwt/contents/include%2Fcjwt%2Fcjwt.h?ref=096ab3e37f73c914b716e7259589179f363265fd",
                "patch": "@@ -38,6 +38,15 @@\n  */\n #define OPT_ALLOW_ANY_TYP (1 << 2)\n \n+/* If you specify OPT_ALLOW_ONLY_HS_ALG as part of the options bitmask you\n+ * are allowing only the use of HMAC-SHA algorithms (HS256, HS384, HS512).\n+ * Otherwise only public key algorithms are allowed.\n+ *\n+ * Symmetric algorithms and the unknown key type passed in pose a security\n+ * risk since an attacker can treate the provided public key as the secret\n+ * key and sign their own JWTs with the public key as a symmetric key.\n+ */\n+#define OPT_ALLOW_ONLY_HS_ALG (1 << 3)\n \n /*----------------------------------------------------------------------------*/\n /*                               Data Structures                              */\n@@ -167,12 +176,22 @@ typedef struct {\n  *        are accepted unless OPT_ALLOW_ANY_TIME is specified as an option.\n  *\n  *  @note The key for HS signed JWTs is the plain text secret.\n+ * \n+ *  @note To accept HS signed JWTs, OPT_ALLOW_ONLY_HS_ALG must be specified as\n+ *        an option.  This option disables the use of public key algorithms.\n+ *        This is done to prevent an attacker from using a public key as a\n+ *        symmetric key and signing their own JWTs.\n  *\n  *  @note The key for PS, RS and EC signed JWTs expect the text from the PEM\n  *        file including the -----BEGIN PUBLIC KEY----- and\n  *        -----END PUBLIC KEY----- lines.\n  *\n  *  @note The 'time' parameter is seconds since Jan 1, 1970.\n+ * \n+ *  @note It is strongly encouraged to validate the 'alg' header to ensure\n+ *        that the JWT is signed with the expected algorithm.  This can be\n+ *        done by checking the 'alg' header against a known value in the cjwt_t\n+ *        object passed out via the jwt parameter.\n  *\n  *  @param text     [IN]  the original JWT text\n  *  @param text_len [IN]  length of the original text"
            },
            {
                "sha": "066ee3a6fda3f20d0e66a6ab2b27264593e2bd49",
                "filename": "src/cjwt.c",
                "status": "modified",
                "additions": 28,
                "deletions": 17,
                "changes": 45,
                "blob_url": "https://github.com/xmidt-org/cjwt/blob/096ab3e37f73c914b716e7259589179f363265fd/src%2Fcjwt.c",
                "raw_url": "https://github.com/xmidt-org/cjwt/raw/096ab3e37f73c914b716e7259589179f363265fd/src%2Fcjwt.c",
                "contents_url": "https://api.github.com/repos/xmidt-org/cjwt/contents/src%2Fcjwt.c?ref=096ab3e37f73c914b716e7259589179f363265fd",
                "patch": "@@ -2,6 +2,7 @@\n // SPDX-License-Identifier: Apache-2.0\n \n #include <cjson/cJSON.h>\n+#include <stdbool.h>\n #include <stdint.h>\n #include <stdio.h>\n #include <stdlib.h>\n@@ -22,26 +23,27 @@\n /*----------------------------------------------------------------------------*/\n struct alg_map {\n     cjwt_alg_t alg;\n+    bool symmetric;\n     const char *text;\n };\n \n /*----------------------------------------------------------------------------*/\n /*                            File Scoped Variables                           */\n /*----------------------------------------------------------------------------*/\n const struct alg_map the_alg_map[] = {\n-    { .alg = alg_none,  .text = \"none\"},\n-    {.alg = alg_es256, .text = \"ES256\"},\n-    {.alg = alg_es384, .text = \"ES384\"},\n-    {.alg = alg_es512, .text = \"ES512\"},\n-    {.alg = alg_hs256, .text = \"HS256\"},\n-    {.alg = alg_hs384, .text = \"HS384\"},\n-    {.alg = alg_hs512, .text = \"HS512\"},\n-    {.alg = alg_ps256, .text = \"PS256\"},\n-    {.alg = alg_ps384, .text = \"PS384\"},\n-    {.alg = alg_ps512, .text = \"PS512\"},\n-    {.alg = alg_rs256, .text = \"RS256\"},\n-    {.alg = alg_rs384, .text = \"RS384\"},\n-    {.alg = alg_rs512, .text = \"RS512\"}\n+    {.alg = alg_none,  .symmetric = false, .text = \"none\" },\n+    {.alg = alg_es256, .symmetric = false, .text = \"ES256\"},\n+    {.alg = alg_es384, .symmetric = false, .text = \"ES384\"},\n+    {.alg = alg_es512, .symmetric = false, .text = \"ES512\"},\n+    {.alg = alg_hs256, .symmetric = true,  .text = \"HS256\"},\n+    {.alg = alg_hs384, .symmetric = true,  .text = \"HS384\"},\n+    {.alg = alg_hs512, .symmetric = true,  .text = \"HS512\"},\n+    {.alg = alg_ps256, .symmetric = false, .text = \"PS256\"},\n+    {.alg = alg_ps384, .symmetric = false, .text = \"PS384\"},\n+    {.alg = alg_ps512, .symmetric = false, .text = \"PS512\"},\n+    {.alg = alg_rs256, .symmetric = false, .text = \"RS256\"},\n+    {.alg = alg_rs384, .symmetric = false, .text = \"RS384\"},\n+    {.alg = alg_rs512, .symmetric = false, .text = \"RS512\"}\n };\n \n /*----------------------------------------------------------------------------*/\n@@ -243,12 +245,21 @@ static cjwt_code_t process_header_json(cjwt_t *cjwt, uint32_t options,\n         return CJWTE_HEADER_UNSUPPORTED_ALG;\n     }\n \n-    if ((alg_none == cjwt->header.alg)\n-        && (0 == (OPT_ALLOW_ALG_NONE & options)))\n-    {\n-        return CJWTE_HEADER_UNSUPPORTED_ALG;\n+    if (alg_none == cjwt->header.alg) {\n+        if (0 == (OPT_ALLOW_ALG_NONE & options)) {\n+            return CJWTE_HEADER_UNSUPPORTED_ALG;\n+        }\n     }\n \n+    if (true == the_alg_map[cjwt->header.alg].symmetric) {\n+        if (!(OPT_ALLOW_ONLY_HS_ALG & options)) {\n+            return CJWTE_HEADER_UNSUPPORTED_ALG;\n+        }\n+    } else {\n+        if (OPT_ALLOW_ONLY_HS_ALG & options) {\n+            return CJWTE_HEADER_UNSUPPORTED_ALG;\n+        }\n+    }\n \n     typ = cJSON_GetObjectItemCaseSensitive(json, \"typ\");\n     if (typ && (0 == (OPT_ALLOW_ANY_TYP & options))) {"
            },
            {
                "sha": "af950742058d71f3006c78bc123da56eb766ce8e",
                "filename": "subprojects/trower-base64.wrap",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/xmidt-org/cjwt/blob/096ab3e37f73c914b716e7259589179f363265fd/subprojects%2Ftrower-base64.wrap",
                "raw_url": "https://github.com/xmidt-org/cjwt/raw/096ab3e37f73c914b716e7259589179f363265fd/subprojects%2Ftrower-base64.wrap",
                "contents_url": "https://api.github.com/repos/xmidt-org/cjwt/contents/subprojects%2Ftrower-base64.wrap?ref=096ab3e37f73c914b716e7259589179f363265fd",
                "patch": "@@ -8,5 +8,5 @@ source_filename = trower-base64-1.2.7.tar.gz\n source_url = https://github.com/xmidt-org/trower-base64/releases/download/v1.2.7/trower-base64-1.2.7.tar.gz\n source_hash = 9921ea1eca2328c6cadc058df805e6ac58cca06c0737ac21b987ba13b8697ad9\n \n-[provides]\n+[provide]\n libtrower_base64 = libtrower_base64_dep"
            },
            {
                "sha": "830e2032e9f75496df7685fce3348728a4f15695",
                "filename": "tests/test_cjwt.c",
                "status": "modified",
                "additions": 73,
                "deletions": 67,
                "changes": 140,
                "blob_url": "https://github.com/xmidt-org/cjwt/blob/096ab3e37f73c914b716e7259589179f363265fd/tests%2Ftest_cjwt.c",
                "raw_url": "https://github.com/xmidt-org/cjwt/raw/096ab3e37f73c914b716e7259589179f363265fd/tests%2Ftest_cjwt.c",
                "contents_url": "https://api.github.com/repos/xmidt-org/cjwt/contents/tests%2Ftest_cjwt.c?ref=096ab3e37f73c914b716e7259589179f363265fd",
                "patch": "@@ -17,77 +17,78 @@ typedef struct {\n     int expected;\n     const char *jwt_file_name;\n     bool is_key_in_file;\n+    bool expect_symmetric;\n     const char *key;\n     const char *decode_test_name;\n } test_case_t;\n \n test_case_t test_list[] = {\n-    {      0,        \"jwtn.txt\", false,                 \"\",      \"No Alg claims on on\"},\n-    {      0,       \"jwtnx.txt\", false,                 \"\",     \"No Alg claims off on\"},\n-    {      0,       \"jwtny.txt\", false,                 \"\",    \"No Alg claims off off\"},\n-    { EINVAL,       \"jwtia.txt\", false,     \"test_passwd1\",        \"HS256 invalid jwt\"},\n-    { EINVAL,       \"jwtib.txt\", false,     \"test_passwd1\",        \"HS256 invalid jwt\"},\n- // {  EINVAL,      \"jwtic.txt\", false,     \"test_passwd1\",        \"HS256 invalid jwt\"}, /*TBD */ //FAILED test after modifying verify_signature logic\n-    { EINVAL,       \"jwtid.txt\", false,     \"test_passwd1\",        \"HS256 invalid jwt\"},\n-    { EINVAL,       \"jwtie.txt\", false,     \"test_passwd1\",        \"HS256 invalid jwt\"},\n-    { EINVAL,       \"jwtif.txt\", false,     \"test_passwd1\",        \"HS256 invalid jwt\"},\n-    {      0,        \"jwt1.txt\", false,     \"test_passwd1\",       \"HS256 claims on on\"},\n-    { EINVAL,        \"jwt1.txt\", false,     \"test_passbad\",       \"HS256 claims on on\"},\n-    {      0,        \"jwt2.txt\", false,     \"test_passwd2\",       \"HS384 claims on on\"},\n-    { EINVAL,        \"jwt2.txt\", false,     \"test_passbad\",       \"HS384 claims on on\"},\n-    {      0,        \"jwt3.txt\", false,     \"test_passwd3\",       \"HS512 claims on on\"},\n-    { EINVAL,        \"jwt3.txt\", false,     \"test_passbad\",       \"HS512 claims on on\"},\n-    {      0,        \"jwt5.txt\",  true,      \"pubkey5.pem\",       \"RS384 claims on on\"},\n-    { EINVAL,        \"jwt5.txt\",  true,      \"badkey4.pem\",       \"RS384 claims on on\"},\n-    {      0,        \"jwt4.txt\",  true,      \"pubkey4.pem\",       \"RS256 claims on on\"},\n-    { EINVAL,        \"jwt4.txt\",  true,      \"badkey4.pem\",       \"RS256 claims on on\"},\n-    {      0,        \"jwt6.txt\",  true,      \"pubkey6.pem\",       \"RS512 claims on on\"},\n-    { EINVAL,        \"jwt6.txt\",  true,      \"badkey6.pem\",       \"RS512 claims on on\"},\n-    {      0,       \"jwt1x.txt\", false,     \"test_passwd1\",      \"HS256 claims off on\"},\n-    { EINVAL,       \"jwt1x.txt\", false,    \"test_prasswd1\",      \"HS256 claims off on\"},\n-    {      0,       \"jwt2x.txt\", false,     \"test_passwd2\",      \"HS384 claims off on\"},\n-    { EINVAL,       \"jwt2x.txt\", false,    \"twest_passwd2\",      \"HS384 claims off on\"},\n-    {      0,       \"jwt3x.txt\", false,     \"test_passwd3\",      \"HS512 claims off on\"},\n-    { EINVAL,       \"jwt3x.txt\", false,  \"test_passwd3...\",      \"HS512 claims off on\"},\n-    {      0,       \"jwt4x.txt\",  true,      \"pubkey4.pem\",      \"RS256 claims off on\"},\n-    { EINVAL,       \"jwt4x.txt\",  true,      \"pubkey5.pem\",      \"RS256 claims off on\"},\n-    {      0,       \"jwt5x.txt\",  true,      \"pubkey5.pem\",      \"RS384 claims off on\"},\n-    { EINVAL,       \"jwt5x.txt\",  true,      \"badkey5.pem\",      \"RS384 claims off on\"},\n-    {      0,       \"jwt6x.txt\",  true,      \"pubkey6.pem\",      \"RS512 claims off on\"},\n-    { EINVAL,       \"jwt6x.txt\",  true,      \"badkey6.pem\",      \"RS512 claims off on\"},\n-    {      0,       \"jwt1y.txt\", false,     \"test_passwd1\",     \"HS256 claims off off\"},\n-    { EINVAL,       \"jwt1y.txt\", false,     \"tast_passwd1\",     \"HS256 claims off off\"},\n-    {      0,       \"jwt2y.txt\", false,     \"test_passwd2\",     \"HS384 claims off off\"},\n-    { EINVAL,       \"jwt2y.txt\", false,    \"test..passwd2\",     \"HS384 claims off off\"},\n-    {      0,       \"jwt3y.txt\", false,     \"test_passwd3\",     \"HS512 claims off off\"},\n-    { EINVAL,       \"jwt3y.txt\", false, \"tteesstt_passwd3\",     \"HS512 claims off off\"},\n-    {      0,       \"jwt4y.txt\",  true,      \"pubkey4.pem\",     \"RS256 claims off off\"},\n-    { EINVAL,       \"jwt4y.txt\",  true,      \"badkey4.pem\",     \"RS256 claims off off\"},\n-    {      0,       \"jwt5y.txt\",  true,      \"pubkey5.pem\",     \"RS384 claims off off\"},\n-    { EINVAL,       \"jwt5y.txt\",  true,      \"pubkey6.pem\",     \"RS384 claims off off\"},\n-    {      0,       \"jwt6y.txt\",  true,      \"pubkey6.pem\",     \"RS512 claims off off\"},\n-    { EINVAL,       \"jwt6y.txt\",  true,      \"pubkey5.pem\",     \"RS512 claims off off\"},\n-    {      0,       \"jwt1l.txt\", false,     \"test_passwd1\",        \"HS256 claims long\"},\n-    { EINVAL,       \"jwt1l.txt\", false,    \"test_keyword1\",        \"HS256 claims long\"},\n-    {      0,       \"jwt2l.txt\", false,     \"test_passwd2\",        \"HS384 claims long\"},\n-    { EINVAL,       \"jwt2l.txt\", false,     \"test_passwd1\",        \"HS384 claims long\"},\n-    {      0,       \"jwt3l.txt\", false,     \"test_passwd3\",        \"HS512 claims long\"},\n-    { EINVAL,       \"jwt3l.txt\", false,          \"passwd3\",        \"HS512 claims long\"},\n-    {      0,       \"jwt4l.txt\",  true,      \"pubkey4.pem\",        \"RS256 claims long\"},\n-    { EINVAL,       \"jwt4l.txt\",  true,      \"badkey4.pem\",        \"RS256 claims long\"},\n-    {      0,       \"jwt5l.txt\",  true,      \"pubkey5.pem\",        \"RS384 claims long\"},\n-    { EINVAL,       \"jwt5l.txt\",  true,      \"badkey5.pem\",        \"RS384 claims long\"},\n-    {      0,       \"jwt6l.txt\",  true,      \"pubkey6.pem\",        \"RS512 claims long\"},\n-    { EINVAL,       \"jwt6l.txt\",  true,      \"badkey6.pem\",        \"RS512 claims long\"},\n-    {      0,        \"jwt2.txt\", false,     \"test_passwd2\",       \"HS384 claims on on\"},\n-    {      0,        \"jwt3.txt\", false,     \"test_passwd3\",       \"HS512 claims on on\"},\n-    {      0,  \"jwt8_hs256.txt\",  true,   \"key8_hs256.pem\",       \"HS256 claims on on\"},\n-    {      0,  \"jwt9_hs384.txt\",  true,   \"key9_hs384.pem\",       \"HS384 claims on on\"},\n-    {      0, \"jwt10_hs512.txt\",  true,  \"key10_hs512.pem\",       \"HS512 claims on on\"},\n-    { EINVAL,       \"jwt11.txt\", false,    \"incorrect_key\",         \"RS256 claims all\"},\n-    { EINVAL,       \"jwt12.txt\", false,    \"incorrect_key\",         \"RS256 claims all\"},\n-    { EINVAL,       \"jwt13.txt\", false,    \"incorrect_key\",         \"RS256 claims all\"},\n-    {ENOTSUP,   \"jwtbadalg.txt\", false,    \"incorrect_key\", \"Invalid/unsupported alg.\"}\n+    {      0,        \"jwtn.txt\", false, false,                  \"\",      \"No Alg claims on on\"},\n+    {      0,       \"jwtnx.txt\", false, false,                  \"\",     \"No Alg claims off on\"},\n+    {      0,       \"jwtny.txt\", false, false,                  \"\",    \"No Alg claims off off\"},\n+    { EINVAL,       \"jwtia.txt\", false, true,       \"test_passwd1\",        \"HS256 invalid jwt\"},\n+    { EINVAL,       \"jwtib.txt\", false, true,       \"test_passwd1\",        \"HS256 invalid jwt\"},\n+ // {  EINVAL,      \"jwtic.txt\", false, true,       \"test_passwd1\",        \"HS256 invalid jwt\"}, /*TBD */ //FAILED test after modifying verify_signature logic\n+    { EINVAL,       \"jwtid.txt\", false, true,       \"test_passwd1\",        \"HS256 invalid jwt\"},\n+    { EINVAL,       \"jwtie.txt\", false, true,       \"test_passwd1\",        \"HS256 invalid jwt\"},\n+    { EINVAL,       \"jwtif.txt\", false, true,       \"test_passwd1\",        \"HS256 invalid jwt\"},\n+    {      0,        \"jwt1.txt\", false, true,       \"test_passwd1\",       \"HS256 claims on on\"},\n+    { EINVAL,        \"jwt1.txt\", false, true,       \"test_passbad\",       \"HS256 claims on on\"},\n+    {      0,        \"jwt2.txt\", false, true,       \"test_passwd2\",       \"HS384 claims on on\"},\n+    { EINVAL,        \"jwt2.txt\", false, true,       \"test_passbad\",       \"HS384 claims on on\"},\n+    {      0,        \"jwt3.txt\", false, true,       \"test_passwd3\",       \"HS512 claims on on\"},\n+    { EINVAL,        \"jwt3.txt\", false, true,       \"test_passbad\",       \"HS512 claims on on\"},\n+    {      0,        \"jwt5.txt\",  true, false,       \"pubkey5.pem\",       \"RS384 claims on on\"},\n+    { EINVAL,        \"jwt5.txt\",  true, false,       \"badkey4.pem\",       \"RS384 claims on on\"},\n+    {      0,        \"jwt4.txt\",  true, false,       \"pubkey4.pem\",       \"RS256 claims on on\"},\n+    { EINVAL,        \"jwt4.txt\",  true, false,       \"badkey4.pem\",       \"RS256 claims on on\"},\n+    {      0,        \"jwt6.txt\",  true, false,       \"pubkey6.pem\",       \"RS512 claims on on\"},\n+    { EINVAL,        \"jwt6.txt\",  true, false,       \"badkey6.pem\",       \"RS512 claims on on\"},\n+    {      0,       \"jwt1x.txt\", false, true,       \"test_passwd1\",      \"HS256 claims off on\"},\n+    { EINVAL,       \"jwt1x.txt\", false, true,      \"test_prasswd1\",      \"HS256 claims off on\"},\n+    {      0,       \"jwt2x.txt\", false, true,       \"test_passwd2\",      \"HS384 claims off on\"},\n+    { EINVAL,       \"jwt2x.txt\", false, true,      \"twest_passwd2\",      \"HS384 claims off on\"},\n+    {      0,       \"jwt3x.txt\", false, true,       \"test_passwd3\",      \"HS512 claims off on\"},\n+    { EINVAL,       \"jwt3x.txt\", false, true,    \"test_passwd3...\",      \"HS512 claims off on\"},\n+    {      0,       \"jwt4x.txt\",  true, false,       \"pubkey4.pem\",      \"RS256 claims off on\"},\n+    { EINVAL,       \"jwt4x.txt\",  true, false,       \"pubkey5.pem\",      \"RS256 claims off on\"},\n+    {      0,       \"jwt5x.txt\",  true, false,       \"pubkey5.pem\",      \"RS384 claims off on\"},\n+    { EINVAL,       \"jwt5x.txt\",  true, false,       \"badkey5.pem\",      \"RS384 claims off on\"},\n+    {      0,       \"jwt6x.txt\",  true, false,       \"pubkey6.pem\",      \"RS512 claims off on\"},\n+    { EINVAL,       \"jwt6x.txt\",  true, false,       \"badkey6.pem\",      \"RS512 claims off on\"},\n+    {      0,       \"jwt1y.txt\", false, true,       \"test_passwd1\",     \"HS256 claims off off\"},\n+    { EINVAL,       \"jwt1y.txt\", false, true,       \"tast_passwd1\",     \"HS256 claims off off\"},\n+    {      0,       \"jwt2y.txt\", false, true,       \"test_passwd2\",     \"HS384 claims off off\"},\n+    { EINVAL,       \"jwt2y.txt\", false, true,      \"test..passwd2\",     \"HS384 claims off off\"},\n+    {      0,       \"jwt3y.txt\", false, true,       \"test_passwd3\",     \"HS512 claims off off\"},\n+    { EINVAL,       \"jwt3y.txt\", false, true,   \"tteesstt_passwd3\",     \"HS512 claims off off\"},\n+    {      0,       \"jwt4y.txt\",  true, false,       \"pubkey4.pem\",     \"RS256 claims off off\"},\n+    { EINVAL,       \"jwt4y.txt\",  true, false,       \"badkey4.pem\",     \"RS256 claims off off\"},\n+    {      0,       \"jwt5y.txt\",  true, false,       \"pubkey5.pem\",     \"RS384 claims off off\"},\n+    { EINVAL,       \"jwt5y.txt\",  true, false,       \"pubkey6.pem\",     \"RS384 claims off off\"},\n+    {      0,       \"jwt6y.txt\",  true, false,       \"pubkey6.pem\",     \"RS512 claims off off\"},\n+    { EINVAL,       \"jwt6y.txt\",  true, false,       \"pubkey5.pem\",     \"RS512 claims off off\"},\n+    {      0,       \"jwt1l.txt\", false, true,       \"test_passwd1\",        \"HS256 claims long\"},\n+    { EINVAL,       \"jwt1l.txt\", false, true,      \"test_keyword1\",        \"HS256 claims long\"},\n+    {      0,       \"jwt2l.txt\", false, true,       \"test_passwd2\",        \"HS384 claims long\"},\n+    { EINVAL,       \"jwt2l.txt\", false, true,       \"test_passwd1\",        \"HS384 claims long\"},\n+    {      0,       \"jwt3l.txt\", false, true,       \"test_passwd3\",        \"HS512 claims long\"},\n+    { EINVAL,       \"jwt3l.txt\", false, true,            \"passwd3\",        \"HS512 claims long\"},\n+    {      0,       \"jwt4l.txt\",  true, false,       \"pubkey4.pem\",        \"RS256 claims long\"},\n+    { EINVAL,       \"jwt4l.txt\",  true, false,       \"badkey4.pem\",        \"RS256 claims long\"},\n+    {      0,       \"jwt5l.txt\",  true, false,       \"pubkey5.pem\",        \"RS384 claims long\"},\n+    { EINVAL,       \"jwt5l.txt\",  true, false,       \"badkey5.pem\",        \"RS384 claims long\"},\n+    {      0,       \"jwt6l.txt\",  true, false,       \"pubkey6.pem\",        \"RS512 claims long\"},\n+    { EINVAL,       \"jwt6l.txt\",  true, false,       \"badkey6.pem\",        \"RS512 claims long\"},\n+    {      0,        \"jwt2.txt\", false, true,       \"test_passwd2\",       \"HS384 claims on on\"},\n+    {      0,        \"jwt3.txt\", false, true,       \"test_passwd3\",       \"HS512 claims on on\"},\n+    {      0,  \"jwt8_hs256.txt\",  true, true,     \"key8_hs256.pem\",       \"HS256 claims on on\"},\n+    {      0,  \"jwt9_hs384.txt\",  true, true,     \"key9_hs384.pem\",       \"HS384 claims on on\"},\n+    {      0, \"jwt10_hs512.txt\",  true, true,    \"key10_hs512.pem\",       \"HS512 claims on on\"},\n+    { EINVAL,       \"jwt11.txt\", false, false,     \"incorrect_key\",         \"RS256 claims all\"},\n+    { EINVAL,       \"jwt12.txt\", false, false,     \"incorrect_key\",         \"RS256 claims all\"},\n+    { EINVAL,       \"jwt13.txt\", false, false,     \"incorrect_key\",         \"RS256 claims all\"},\n+    {ENOTSUP,   \"jwtbadalg.txt\", false, false,     \"incorrect_key\", \"Invalid/unsupported alg.\"}\n };\n \n #define _NUM_TEST_CASES (sizeof(test_list) / sizeof(test_case_t))\n@@ -154,11 +155,13 @@ void test_case(unsigned _i)\n     cjwt_t *jwt        = NULL;\n     char jwt_buf[65535];\n     char pem_buf[8192];\n+    int options;\n     jwt_fname        = test_list[_i].jwt_file_name;\n     key_str          = test_list[_i].key;\n     key_len          = strlen(key_str);\n     expected         = test_list[_i].expected;\n     decode_test_name = test_list[_i].decode_test_name;\n+    options          = OPT_ALLOW_ALG_NONE | OPT_ALLOW_ANY_TIME;\n \n     if (key_len == 0) {\n         key_str = NULL;\n@@ -188,8 +191,11 @@ void test_case(unsigned _i)\n     jwt_bytes = read_file(jwt_fname, jwt_buf, sizeof(jwt_buf));\n \n     if (jwt_bytes > 0) {\n+        if (test_list[_i].expect_symmetric) {\n+            options |= OPT_ALLOW_ONLY_HS_ALG;\n+        }\n         result = cjwt_decode(jwt_buf, strlen(jwt_buf),\n-                             OPT_ALLOW_ALG_NONE | OPT_ALLOW_ANY_TIME,\n+                             options,\n                              (const uint8_t *) key_str, key_len,\n                              0, 0, &jwt);\n     } else {"
            },
            {
                "sha": "a01f5a203891afee3505e4d18be8c4904e6fb4d7",
                "filename": "tests/test_cjwt_new.c",
                "status": "modified",
                "additions": 77,
                "deletions": 64,
                "changes": 141,
                "blob_url": "https://github.com/xmidt-org/cjwt/blob/096ab3e37f73c914b716e7259589179f363265fd/tests%2Ftest_cjwt_new.c",
                "raw_url": "https://github.com/xmidt-org/cjwt/raw/096ab3e37f73c914b716e7259589179f363265fd/tests%2Ftest_cjwt_new.c",
                "contents_url": "https://api.github.com/repos/xmidt-org/cjwt/contents/tests%2Ftest_cjwt_new.c?ref=096ab3e37f73c914b716e7259589179f363265fd",
                "patch": "@@ -20,6 +20,7 @@ typedef struct {\n     const char *filename;\n     const char *key_fn;\n     const char *key;\n+    uint32_t options;\n     cjwt_code_t expected;\n } test_case_t;\n \n@@ -37,75 +38,87 @@ typedef struct {\n test_case_t test_list[] = {\n     /* Valid, positive tests */\n     /*------------------------------------------------------------------------*/\n-    { \"HS256\", \"hs256.jwt\", NULL,            \"hs256-secret\", CJWTE_OK },\n-    { \"HS384\", \"hs384.jwt\", NULL,            \"hs384-secret\", CJWTE_OK },\n-    { \"HS512\", \"hs512.jwt\", NULL,            \"hs512-secret\", CJWTE_OK },\n-    { \"RS256\", \"rs256.jwt\", \"rs.pub\",        NULL,           CJWTE_OK },\n-    { \"RS384\", \"rs384.jwt\", \"rs.pub\",        NULL,           CJWTE_OK },\n-    { \"RS512\", \"rs512.jwt\", \"rs.pub\",        NULL,           CJWTE_OK },\n-    { \"ES256\", \"es256.jwt\", \"es256.jwt.pub\", NULL,           CJWTE_OK },\n-    { \"ES384\", \"es384.jwt\", \"es384.jwt.pub\", NULL,           CJWTE_OK },\n-    { \"ES512\", \"es512.jwt\", \"es512.jwt.pub\", NULL,           CJWTE_OK },\n-    { \"PS256\", \"ps256.jwt\", \"ps.pub\",        NULL,           CJWTE_OK },\n-    { \"PS384\", \"ps384.jwt\", \"ps.pub\",        NULL,           CJWTE_OK },\n-    { \"PS512\", \"ps512.jwt\", \"ps.pub\",        NULL,           CJWTE_OK },\n+    { \"HS256\", \"hs256.jwt\", NULL,            \"hs256-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_OK },\n+    { \"HS384\", \"hs384.jwt\", NULL,            \"hs384-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_OK },\n+    { \"HS512\", \"hs512.jwt\", NULL,            \"hs512-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_OK },\n+    { \"RS256\", \"rs256.jwt\", \"rs.pub\",        NULL,           0,                     CJWTE_OK },\n+    { \"RS384\", \"rs384.jwt\", \"rs.pub\",        NULL,           0,                     CJWTE_OK },\n+    { \"RS512\", \"rs512.jwt\", \"rs.pub\",        NULL,           0,                     CJWTE_OK },\n+    { \"ES256\", \"es256.jwt\", \"es256.jwt.pub\", NULL,           0,                     CJWTE_OK },\n+    { \"ES384\", \"es384.jwt\", \"es384.jwt.pub\", NULL,           0,                     CJWTE_OK },\n+    { \"ES512\", \"es512.jwt\", \"es512.jwt.pub\", NULL,           0,                     CJWTE_OK },\n+    { \"PS256\", \"ps256.jwt\", \"ps.pub\",        NULL,           0,                     CJWTE_OK },\n+    { \"PS384\", \"ps384.jwt\", \"ps.pub\",        NULL,           0,                     CJWTE_OK },\n+    { \"PS512\", \"ps512.jwt\", \"ps.pub\",        NULL,           0,                     CJWTE_OK },\n \n     /* Negative tests around signature validation */\n     /*------------------------------------------------------------------------*/\n-    { \"HS256 bad secret\",  \"hs256.jwt\",   NULL,            \"hs000-secret\", CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"HS384 bad secret\",  \"hs384.jwt\",   NULL,            \"hs000-secret\", CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"HS512 bad secret\",  \"hs512.jwt\",   NULL,            \"hs000-secret\", CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"HS256 NULL secret\", \"hs256.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"HS384 NULL secret\", \"hs384.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"HS512 NULL secret\", \"hs512.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-\n-    { \"RS256 bad secret\",  \"rs256.jwt\",   \"rs-alt.pub\",    NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"RS384 bad secret\",  \"rs384.jwt\",   \"rs-alt.pub\",    NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"RS512 bad secret\",  \"rs512.jwt\",   \"rs-alt.pub\",    NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"RS256 partial\",     \"rs256.jwt\",   \"rs.partial\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"RS384 partial\",     \"rs384.jwt\",   \"rs.partial\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"RS512 partial\",     \"rs512.jwt\",   \"rs.partial\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"RS256 invalid\",     \"rs256.jwt\",   \"es256.jwt.pub\", NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"RS384 invalid\",     \"rs384.jwt\",   \"es256.jwt.pub\", NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"RS512 invalid\",     \"rs512.jwt\",   \"es256.jwt.pub\", NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"RS256 NULL secret\", \"rs256.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_MISSING_KEY       },\n-    { \"RS384 NULL secret\", \"rs384.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_MISSING_KEY       },\n-    { \"RS512 NULL secret\", \"rs512.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_MISSING_KEY       },\n-\n-    { \"PS256 bad secret\",  \"ps256.jwt\",   \"rs-alt.pub\",    NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"PS384 bad secret\",  \"ps384.jwt\",   \"rs-alt.pub\",    NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"PS512 bad secret\",  \"ps512.jwt\",   \"rs-alt.pub\",    NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"PS256 partial\",     \"ps256.jwt\",   \"rs.partial\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"PS384 partial\",     \"ps384.jwt\",   \"rs.partial\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"PS512 partial\",     \"ps512.jwt\",   \"rs.partial\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"PS256 invalid\",     \"ps256.jwt\",   \"es256.jwt.pub\", NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"PS384 invalid\",     \"ps384.jwt\",   \"es256.jwt.pub\", NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"PS512 invalid\",     \"ps512.jwt\",   \"es256.jwt.pub\", NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"PS256 NULL secret\", \"ps256.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_MISSING_KEY       },\n-    { \"PS384 NULL secret\", \"ps384.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_MISSING_KEY       },\n-    { \"PS512 NULL secret\", \"ps512.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_MISSING_KEY       },\n-\n-    { \"ES256 bad secret\",  \"es256.jwt\",   \"rs-alt.pub\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"ES384 bad secret\",  \"es384.jwt\",   \"rs-alt.pub\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"ES512 bad secret\",  \"es512.jwt\",   \"rs-alt.pub\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"ES256 partial\",     \"es256.jwt\",   \"rs.partial\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"ES384 partial\",     \"es384.jwt\",   \"rs.partial\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"ES512 partial\",     \"es512.jwt\",   \"rs.partial\",    NULL,           CJWTE_SIGNATURE_INVALID_KEY       },\n-    { \"ES256 invalid\",     \"es256.jwt\",   \"es512.jwt.pub\", NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"ES384 invalid\",     \"es384.jwt\",   \"es512.jwt.pub\", NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"ES512 invalid\",     \"es512.jwt\",   \"es256.jwt.pub\", NULL,           CJWTE_SIGNATURE_VALIDATION_FAILED },\n-    { \"ES256 NULL secret\", \"es256.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_MISSING_KEY       },\n-    { \"ES384 NULL secret\", \"es384.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_MISSING_KEY       },\n-    { \"ES512 NULL secret\", \"es512.jwt\",   NULL,            NULL,           CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"HS256 bad secret\",  \"hs256.jwt\",   NULL,            \"hs000-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"HS384 bad secret\",  \"hs384.jwt\",   NULL,            \"hs000-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"HS512 bad secret\",  \"hs512.jwt\",   NULL,            \"hs000-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"HS256 NULL secret\", \"hs256.jwt\",   NULL,            NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"HS384 NULL secret\", \"hs384.jwt\",   NULL,            NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"HS512 NULL secret\", \"hs512.jwt\",   NULL,            NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"HS256 not allowed\", \"hs256.jwt\",   NULL,            \"hs256-secret\", 0,                     CJWTE_HEADER_UNSUPPORTED_ALG      },\n+    { \"HS384 not allowed\", \"hs384.jwt\",   NULL,            \"hs384-secret\", 0,                     CJWTE_HEADER_UNSUPPORTED_ALG      },\n+    { \"HS512 not allowed\", \"hs512.jwt\",   NULL,            \"hs512-secret\", 0,                     CJWTE_HEADER_UNSUPPORTED_ALG      },\n+\n+    { \"RS256 bad secret\",  \"rs256.jwt\",   \"rs-alt.pub\",    NULL,           0,                     CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"RS384 bad secret\",  \"rs384.jwt\",   \"rs-alt.pub\",    NULL,           0,                     CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"RS512 bad secret\",  \"rs512.jwt\",   \"rs-alt.pub\",    NULL,           0,                     CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"RS256 partial\",     \"rs256.jwt\",   \"rs.partial\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"RS384 partial\",     \"rs384.jwt\",   \"rs.partial\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"RS512 partial\",     \"rs512.jwt\",   \"rs.partial\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"RS256 invalid\",     \"rs256.jwt\",   \"es256.jwt.pub\", NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"RS384 invalid\",     \"rs384.jwt\",   \"es256.jwt.pub\", NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"RS512 invalid\",     \"rs512.jwt\",   \"es256.jwt.pub\", NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"RS256 NULL secret\", \"rs256.jwt\",   NULL,            NULL,           0,                     CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"RS384 NULL secret\", \"rs384.jwt\",   NULL,            NULL,           0,                     CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"RS512 NULL secret\", \"rs512.jwt\",   NULL,            NULL,           0,                     CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"RS256 not allowed\", \"rs256.jwt\",   \"rs.pub\",        NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_UNSUPPORTED_ALG      },\n+    { \"RS384 not allowed\", \"rs384.jwt\",   \"rs.pub\",        NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_UNSUPPORTED_ALG      },\n+    { \"RS512 not allowed\", \"rs512.jwt\",   \"rs.pub\",        NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_UNSUPPORTED_ALG      },\n+\n+    { \"PS256 bad secret\",  \"ps256.jwt\",   \"rs-alt.pub\",    NULL,           0,                     CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"PS384 bad secret\",  \"ps384.jwt\",   \"rs-alt.pub\",    NULL,           0,                     CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"PS512 bad secret\",  \"ps512.jwt\",   \"rs-alt.pub\",    NULL,           0,                     CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"PS256 partial\",     \"ps256.jwt\",   \"rs.partial\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"PS384 partial\",     \"ps384.jwt\",   \"rs.partial\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"PS512 partial\",     \"ps512.jwt\",   \"rs.partial\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"PS256 invalid\",     \"ps256.jwt\",   \"es256.jwt.pub\", NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"PS384 invalid\",     \"ps384.jwt\",   \"es256.jwt.pub\", NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"PS512 invalid\",     \"ps512.jwt\",   \"es256.jwt.pub\", NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"PS256 NULL secret\", \"ps256.jwt\",   NULL,            NULL,           0,                     CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"PS384 NULL secret\", \"ps384.jwt\",   NULL,            NULL,           0,                     CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"PS512 NULL secret\", \"ps512.jwt\",   NULL,            NULL,           0,                     CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"PS256 not allowed\", \"ps256.jwt\",   \"ps.pub\",        NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_UNSUPPORTED_ALG      },\n+    { \"PS384 not allowed\", \"ps384.jwt\",   \"ps.pub\",        NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_UNSUPPORTED_ALG      },\n+    { \"PS512 not allowed\", \"ps512.jwt\",   \"ps.pub\",        NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_UNSUPPORTED_ALG      },\n+\n+    { \"ES256 bad secret\",  \"es256.jwt\",   \"rs-alt.pub\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"ES384 bad secret\",  \"es384.jwt\",   \"rs-alt.pub\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"ES512 bad secret\",  \"es512.jwt\",   \"rs-alt.pub\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"ES256 partial\",     \"es256.jwt\",   \"rs.partial\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"ES384 partial\",     \"es384.jwt\",   \"rs.partial\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"ES512 partial\",     \"es512.jwt\",   \"rs.partial\",    NULL,           0,                     CJWTE_SIGNATURE_INVALID_KEY       },\n+    { \"ES256 invalid\",     \"es256.jwt\",   \"es512.jwt.pub\", NULL,           0,                     CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"ES384 invalid\",     \"es384.jwt\",   \"es512.jwt.pub\", NULL,           0,                     CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"ES512 invalid\",     \"es512.jwt\",   \"es256.jwt.pub\", NULL,           0,                     CJWTE_SIGNATURE_VALIDATION_FAILED },\n+    { \"ES256 NULL secret\", \"es256.jwt\",   NULL,            NULL,           0,                     CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"ES384 NULL secret\", \"es384.jwt\",   NULL,            NULL,           0,                     CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"ES512 NULL secret\", \"es512.jwt\",   NULL,            NULL,           0,                     CJWTE_SIGNATURE_MISSING_KEY       },\n+    { \"ES256 not allowed\", \"es256.jwt\",   \"es256.jwt.pub\", NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_UNSUPPORTED_ALG      },\n+    { \"ES384 not allowed\", \"es384.jwt\",   \"es384.jwt.pub\", NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_UNSUPPORTED_ALG      },\n+    { \"ES512 not allowed\", \"es512.jwt\",   \"es512.jwt.pub\", NULL,           OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_UNSUPPORTED_ALG      },\n \n     /* These are some nefarious focused tests */\n-    { \"Try 5 section\",     \"try_5.inv\",   NULL,            \"hs256-secret\", CJWTE_INVALID_SECTIONS            },\n-    { \"Try 4 section\",     \"try_4.inv\",   NULL,            \"hs256-secret\", CJWTE_INVALID_SECTIONS            },\n-    { \"Try 2 section\",     \"try_2.inv\",   NULL,            \"hs256-secret\", CJWTE_INVALID_SECTIONS            },\n-    { \"Try 1 section\",     \"try_1.inv\",   NULL,            \"hs256-secret\", CJWTE_HEADER_MISSING              },\n+    { \"Try 5 section\",     \"try_5.inv\",   NULL,            \"hs256-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_INVALID_SECTIONS            },\n+    { \"Try 4 section\",     \"try_4.inv\",   NULL,            \"hs256-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_INVALID_SECTIONS            },\n+    { \"Try 2 section\",     \"try_2.inv\",   NULL,            \"hs256-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_INVALID_SECTIONS            },\n+    { \"Try 1 section\",     \"try_1.inv\",   NULL,            \"hs256-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_MISSING              },\n \n-    { \"Invld b64 header\",  \"hdr_b64.inv\", NULL,            \"hs256-secret\", CJWTE_HEADER_INVALID_BASE64       },\n-    { \"Invld b64 sig\",     \"sig_b64.inv\", NULL,            \"hs256-secret\", CJWTE_SIGNATURE_INVALID_BASE64    },\n+    { \"Invld b64 header\",  \"hdr_b64.inv\", NULL,            \"hs256-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_HEADER_INVALID_BASE64       },\n+    { \"Invld b64 sig\",     \"sig_b64.inv\", NULL,            \"hs256-secret\", OPT_ALLOW_ONLY_HS_ALG, CJWTE_SIGNATURE_INVALID_BASE64    },\n };\n \n json_test_case_t json_test_list[] = {\n@@ -704,7 +717,7 @@ void test_case(const test_case_t *t)\n         while (isspace(jwt_buf[jwt_bytes - 1])) {\n             jwt_bytes--;\n         }\n-        result = cjwt_decode(jwt_buf, jwt_bytes, 0, key, key_len, 0, 0, &jwt);\n+        result = cjwt_decode(jwt_buf, jwt_bytes, t->options, key, key_len, 0, 0, &jwt);\n     } else {\n         result = jwt_bytes;\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/qos-ch/logback/commits/5f05041cba4c4ac0a62748c5c527a2da48999f2d",
        "url": "https://api.github.com/repos/qos-ch/logback/commits/5f05041cba4c4ac0a62748c5c527a2da48999f2d",
        "html_url": "https://github.com/qos-ch/logback/commit/5f05041cba4c4ac0a62748c5c527a2da48999f2d",
        "message": "prevent Server-Side Request Forgery (SSRF) attacks by ignoring external DTD files in DOCTYPE\n\nSigned-off-by: Ceki Gulcu <ceki@qos.ch>",
        "files": [
            {
                "sha": "eb658bd433e99f58cedf79b1e7c8850a111d1e3b",
                "filename": "logback-core/src/main/java/ch/qos/logback/core/joran/event/SaxEventRecorder.java",
                "status": "modified",
                "additions": 35,
                "deletions": 10,
                "changes": 45,
                "blob_url": "https://github.com/qos-ch/logback/blob/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-core%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fjoran%2Fevent%2FSaxEventRecorder.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-core%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fjoran%2Fevent%2FSaxEventRecorder.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-core%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fjoran%2Fevent%2FSaxEventRecorder.java?ref=5f05041cba4c4ac0a62748c5c527a2da48999f2d",
                "patch": "@@ -15,6 +15,7 @@\n \n import static ch.qos.logback.core.CoreConstants.XML_PARSING;\n \n+import java.io.ByteArrayInputStream;\n import java.io.IOException;\n import java.io.InputStream;\n import java.util.ArrayList;\n@@ -40,28 +41,56 @@\n \n public class SaxEventRecorder extends DefaultHandler implements ContextAware {\n \n+    // org.xml.sax.ext.LexicalHandler is an optional interface\n     final ContextAwareImpl contextAwareImpl;\n     final ElementPath elementPath;\n     List<SaxEvent> saxEventList = new ArrayList<SaxEvent>();\n     Locator locator;\n \n+\n     public SaxEventRecorder(Context context) {\n         this(context, new ElementPath());\n     }\n \n+\n     public SaxEventRecorder(Context context, ElementPath elementPath) {\n         contextAwareImpl = new ContextAwareImpl(context, this);\n         this.elementPath = elementPath;\n     }\n \n+    /**\n+     * An implementation which disallows external DTDs\n+     *\n+     * @param publicId The public identifier, or null if none is\n+     *                 available.\n+     * @param systemId The system identifier provided in the XML\n+     *                 document.\n+     * @return\n+     * @throws SAXException\n+     * @throws IOException\n+     * @since 1.5.13\n+     */\n+    @Override\n+    public InputSource resolveEntity(String publicId, String systemId) throws SAXException, IOException {\n+        addWarn(\"Document Type Declaration (DOCTYPE) with external file reference is\");\n+        addWarn(\"disallowed to prevent Server-Side Request Forgery (SSRF) attacks.\");\n+        addWarn(\"returning contents of SYSTEM \" +systemId+ \" as a white space\");\n+        return new InputSource(new ByteArrayInputStream(\" \".getBytes()));\n+    }\n+\n     final public void recordEvents(InputStream inputStream) throws JoranException {\n         recordEvents(new InputSource(inputStream));\n     }\n \n     public void recordEvents(InputSource inputSource) throws JoranException {\n         SAXParser saxParser = buildSaxParser();\n         try {\n+            // the following sax property can be set in order to add 'this' as LexicalHandler to the saxParser\n+            // However, this is not needed as long as resolveEntity() method is implemented as above\n+            // saxParser.setProperty(\"http://xml.org/sax/properties/lexical-handler\", this);\n+\n             saxParser.parse(inputSource, this);\n+\n             return;\n         } catch (IOException ie) {\n             handleError(\"I/O error occurred while parsing xml file\", ie);\n@@ -83,7 +112,7 @@ private SAXParser buildSaxParser() throws JoranException {\n         try {\n             SAXParserFactory spf = SAXParserFactory.newInstance();\n             spf.setValidating(false);\n-            // spf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n+            //spf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n             // See LOGBACK-1465\n             spf.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n             spf.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n@@ -93,11 +122,11 @@ private SAXParser buildSaxParser() throws JoranException {\n             String errMsg = \"Error during SAX paser configuration. See https://logback.qos.ch/codes.html#saxParserConfiguration\";\n             addError(errMsg, pce);\n             throw new JoranException(errMsg, pce);\n-        }  catch (SAXException pce) {\n+        } catch (SAXException pce) {\n             String errMsg = \"Error during parser creation or parser configuration\";\n             addError(errMsg, pce);\n             throw new JoranException(errMsg, pce);\n-        } \n+        }\n     }\n \n     public void startDocument() {\n@@ -116,7 +145,6 @@ protected boolean shouldIgnoreForElementPath(String tagName) {\n     }\n \n     public void startElement(String namespaceURI, String localName, String qName, Attributes atts) {\n-\n         String tagName = getTagName(localName, qName);\n         if (!shouldIgnoreForElementPath(tagName)) {\n             elementPath.push(tagName);\n@@ -169,20 +197,17 @@ String getTagName(String localName, String qName) {\n     }\n \n     public void error(SAXParseException spe) throws SAXException {\n-        addError(XML_PARSING + \" - Parsing error on line \" + spe.getLineNumber() + \" and column \"\n-                + spe.getColumnNumber());\n+        addError(XML_PARSING + \" - Parsing error on line \" + spe.getLineNumber() + \" and column \" + spe.getColumnNumber());\n         addError(spe.toString());\n     }\n \n     public void fatalError(SAXParseException spe) throws SAXException {\n-        addError(XML_PARSING + \" - Parsing fatal error on line \" + spe.getLineNumber() + \" and column \"\n-                + spe.getColumnNumber());\n+        addError(XML_PARSING + \" - Parsing fatal error on line \" + spe.getLineNumber() + \" and column \" + spe.getColumnNumber());\n         addError(spe.toString());\n     }\n \n     public void warning(SAXParseException spe) throws SAXException {\n-        addWarn(XML_PARSING + \" - Parsing warning on line \" + spe.getLineNumber() + \" and column \"\n-                + spe.getColumnNumber(), spe);\n+        addWarn(XML_PARSING + \" - Parsing warning on line \" + spe.getLineNumber() + \" and column \" + spe.getColumnNumber(), spe);\n     }\n \n     public void addError(String msg) {"
            },
            {
                "sha": "5b5b57812fff23a1679592b52680ef9ff9100f92",
                "filename": "logback-core/src/test/input/joran/event-ssrf.xml",
                "status": "added",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/qos-ch/logback/blob/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-core%2Fsrc%2Ftest%2Finput%2Fjoran%2Fevent-ssrf.xml",
                "raw_url": "https://github.com/qos-ch/logback/raw/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-core%2Fsrc%2Ftest%2Finput%2Fjoran%2Fevent-ssrf.xml",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-core%2Fsrc%2Ftest%2Finput%2Fjoran%2Fevent-ssrf.xml?ref=5f05041cba4c4ac0a62748c5c527a2da48999f2d",
                "patch": "@@ -0,0 +1,27 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n+<!--\n+  ~ Logback: the reliable, generic, fast and flexible logging framework.\n+  ~ Copyright (C) 1999-2024, QOS.ch. All rights reserved.\n+  ~\n+  ~ This program and the accompanying materials are dual-licensed under\n+  ~ either the terms of the Eclipse Public License v1.0 as published by\n+  ~ the Eclipse Foundation\n+  ~\n+  ~   or (per the licensee's choosing)\n+  ~\n+  ~ under the terms of the GNU Lesser General Public License version 2.1\n+  ~ as published by the Free Software Foundation.\n+  -->\n+\n+<!DOCTYPE test SYSTEM \"http://192.168.1.100/\">\n+<test>\n+\n+    <!-- this action throws an exception in the Action.begin method -->\n+    <badBegin>\n+        <touch/>\n+        <touch/>\n+    </badBegin>\n+\n+    <hello name=\"John Doe\">XXX&amp;</hello>\n+\n+</test>\n\\ No newline at end of file"
            },
            {
                "sha": "4dc486be3125a6bf312d4d88b15fb17711a0aa55",
                "filename": "logback-core/src/test/java/ch/qos/logback/core/joran/event/SaxEventRecorderTest.java",
                "status": "modified",
                "additions": 23,
                "deletions": 4,
                "changes": 27,
                "blob_url": "https://github.com/qos-ch/logback/blob/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-core%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fjoran%2Fevent%2FSaxEventRecorderTest.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-core%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fjoran%2Fevent%2FSaxEventRecorderTest.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-core%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fjoran%2Fevent%2FSaxEventRecorderTest.java?ref=5f05041cba4c4ac0a62748c5c527a2da48999f2d",
                "patch": "@@ -15,12 +15,16 @@\n \n import java.io.FileInputStream;\n import java.util.List;\n+import java.util.concurrent.TimeUnit;\n \n import javax.xml.parsers.SAXParser;\n import javax.xml.parsers.SAXParserFactory;\n \n+import ch.qos.logback.core.util.StatusPrinter;\n+import ch.qos.logback.core.util.StatusPrinter2;\n import org.junit.jupiter.api.Assertions;\n import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.Timeout;\n import org.xml.sax.Attributes;\n \n import ch.qos.logback.core.Context;\n@@ -31,7 +35,7 @@\n \n /**\n  * Test whether SaxEventRecorder does a good job.\n- * \n+ *\n  * @author Ceki Gulcu\n  */\n public class SaxEventRecorderTest {\n@@ -59,15 +63,30 @@ public void dump(List<SaxEvent> seList) {\n     }\n \n     @Test\n-    public void test1() throws Exception {\n+    public void testEvent1() throws Exception {\n+        System.out.println(\"test1\");\n         List<SaxEvent> seList = doTest(\"event1.xml\");\n+        StatusPrinter.print(context);\n         Assertions.assertTrue(statusChecker.getHighestLevel(0) == Status.INFO);\n         // dump(seList);\n         Assertions.assertEquals(11, seList.size());\n     }\n \n+    @Test()\n+    @Timeout(value = 500, unit = TimeUnit.MILLISECONDS)  // timeout in case attack is not prevented\n+    public void testEventSSRF() throws Exception {\n+        try {\n+            List<SaxEvent> seList = doTest(\"event-ssrf.xml\");\n+            Assertions.assertTrue(statusChecker.getHighestLevel(0) == Status.WARN);\n+            statusChecker.assertContainsMatch(Status.WARN, \"Document Type Declaration\");\n+            Assertions.assertEquals(11, seList.size());\n+        } finally {\n+            StatusPrinter.print(context);\n+        }\n+    }\n+\n     @Test\n-    public void test2() throws Exception {\n+    public void testEventAmp() throws Exception {\n         List<SaxEvent> seList = doTest(\"ampEvent.xml\");\n         Assertions.assertTrue(statusChecker.getHighestLevel(0) == Status.INFO);\n         // dump(seList);\n@@ -78,7 +97,7 @@ public void test2() throws Exception {\n     }\n \n     @Test\n-    public void test3() throws Exception {\n+    public void testInc() throws Exception {\n         List<SaxEvent> seList = doTest(\"inc.xml\");\n         Assertions.assertTrue(statusChecker.getHighestLevel(0) == Status.INFO);\n         // dump(seList);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/qos-ch/logback/commits/2cb6d520df7592ef1c3a198f1b5df3c10c93e183",
        "url": "https://api.github.com/repos/qos-ch/logback/commits/2cb6d520df7592ef1c3a198f1b5df3c10c93e183",
        "html_url": "https://github.com/qos-ch/logback/commit/2cb6d520df7592ef1c3a198f1b5df3c10c93e183",
        "message": "remove JaninoEventEvaluator\n\nSigned-off-by: Ceki Gulcu <ceki@qos.ch>",
        "files": [
            {
                "sha": "8e32fcb42aea8c671b1c1bbde669a61959822267",
                "filename": "logback-classic-blackbox/src/test/java/ch/qos/logback/classic/blackbox/boolex/BlackboxJaninoEventEvaluatorTest.java",
                "status": "removed",
                "additions": 0,
                "deletions": 291,
                "changes": 291,
                "blob_url": "https://github.com/qos-ch/logback/blob/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-classic-blackbox%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fblackbox%2Fboolex%2FBlackboxJaninoEventEvaluatorTest.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-classic-blackbox%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fblackbox%2Fboolex%2FBlackboxJaninoEventEvaluatorTest.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-classic-blackbox%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fblackbox%2Fboolex%2FBlackboxJaninoEventEvaluatorTest.java?ref=5f05041cba4c4ac0a62748c5c527a2da48999f2d",
                "patch": "@@ -1,291 +0,0 @@\n-/*\n- * Logback: the reliable, generic, fast and flexible logging framework.\n- * Copyright (C) 1999-2022, QOS.ch. All rights reserved.\n- *\n- * This program and the accompanying materials are dual-licensed under\n- * either the terms of the Eclipse Public License v1.0 as published by\n- * the Eclipse Foundation\n- *\n- *   or (per the licensee's choosing)\n- *\n- * under the terms of the GNU Lesser General Public License version 2.1\n- * as published by the Free Software Foundation.\n- */\n-package ch.qos.logback.classic.blackbox.boolex;\n-\n-import java.io.IOException;\n-import java.util.List;\n-\n-import ch.qos.logback.classic.boolex.JaninoEventEvaluator;\n-import ch.qos.logback.classic.util.LogbackMDCAdapter;\n-import org.junit.jupiter.api.BeforeEach;\n-import org.junit.jupiter.api.Disabled;\n-import org.junit.jupiter.api.Test;\n-import org.slf4j.MDC;\n-import org.slf4j.Marker;\n-import org.slf4j.MarkerFactory;\n-\n-import ch.qos.logback.classic.Level;\n-import ch.qos.logback.classic.Logger;\n-import ch.qos.logback.classic.LoggerContext;\n-import ch.qos.logback.classic.spi.ILoggingEvent;\n-import ch.qos.logback.classic.spi.LoggingEvent;\n-import ch.qos.logback.core.boolex.EvaluationException;\n-import ch.qos.logback.core.boolex.JaninoEventEvaluatorBase;\n-import ch.qos.logback.core.boolex.Matcher;\n-import ch.qos.logback.core.filter.EvaluatorFilter;\n-import ch.qos.logback.core.spi.FilterReply;\n-import ch.qos.logback.core.testUtil.RandomUtil;\n-import ch.qos.logback.core.util.StatusPrinter;\n-\n-import static org.junit.jupiter.api.Assertions.assertEquals;\n-import static org.junit.jupiter.api.Assertions.assertFalse;\n-import static org.junit.jupiter.api.Assertions.assertTrue;\n-import static org.junit.jupiter.api.Assertions.fail;\n-\n-public class BlackboxJaninoEventEvaluatorTest {\n-\n-    LoggerContext loggerContext = new LoggerContext();\n-    LogbackMDCAdapter logbackMDCAdapter = new LogbackMDCAdapter();\n-    Logger logger = loggerContext.getLogger(BlackboxJaninoEventEvaluatorTest.class);\n-\n-    Matcher matcherX = new Matcher();\n-\n-    JaninoEventEvaluator jee = new JaninoEventEvaluator();\n-\n-    int diff = RandomUtil.getPositiveInt();\n-\n-    @BeforeEach\n-    public void setup()  {\n-        loggerContext.setMDCAdapter(logbackMDCAdapter);\n-        jee.setContext(loggerContext);\n-\n-        matcherX.setName(\"x\");\n-        matcherX.setRegex(\"^Some\\\\s.*\");\n-        matcherX.start();\n-\n-    }\n-\n-    LoggingEvent makeLoggingEvent(Exception ex) {\n-        return new LoggingEvent(ch.qos.logback.core.pattern.FormattingConverter.class.getName(), logger, Level.INFO,\n-                \"Some message\", ex, null);\n-    }\n-\n-    @Test\n-    public void testBasic() throws Exception {\n-        jee.setExpression(\"message.equals(\\\"Some message\\\")\");\n-        jee.start();\n-\n-        StatusPrinter.print(loggerContext);\n-        ILoggingEvent event = makeLoggingEvent(null);\n-        assertTrue(jee.evaluate(event));\n-    }\n-\n-    @Test\n-    public void testLevel() throws Exception {\n-        jee.setExpression(\"level > DEBUG\");\n-        jee.start();\n-\n-        ILoggingEvent event = makeLoggingEvent(null);\n-        assertTrue(jee.evaluate(event));\n-    }\n-\n-    @Test\n-    public void testtimeStamp() throws Exception {\n-        jee.setExpression(\"timeStamp > 10\");\n-        jee.start();\n-\n-        ILoggingEvent event = makeLoggingEvent(null);\n-        assertTrue(jee.evaluate(event));\n-    }\n-\n-    @Test\n-    public void testWithMatcher() throws Exception {\n-        jee.setExpression(\"x.matches(message)\");\n-        jee.addMatcher(matcherX);\n-        jee.start();\n-\n-        ILoggingEvent event = makeLoggingEvent(null);\n-        assertTrue(jee.evaluate(event));\n-    }\n-\n-    @Test\n-    public void mdcAsString() throws Exception {\n-        String k = \"key\" + diff;\n-\n-        logbackMDCAdapter.put(\"key\" + diff, \"value\" + diff);\n-        jee.setExpression(\"((String) mdc.get(\\\"\" + k + \"\\\")).contains(\\\"alue\\\")\");\n-        jee.start();\n-        StatusPrinter.printInCaseOfErrorsOrWarnings(loggerContext);\n-\n-        LoggingEvent event = makeLoggingEvent(null);\n-        assertTrue(jee.evaluate(event));\n-        logbackMDCAdapter.remove(k);\n-    }\n-\n-    @Test\n-    public void markerList() throws Exception {\n-\n-        jee.setExpression(\"markerList.contains(\\\"BLUE\\\")\");\n-        jee.start();\n-\n-        LoggingEvent event = makeLoggingEvent(null);\n-        event.addMarker(MarkerFactory.getMarker(\"BLUE\"));\n-        StatusPrinter.print(loggerContext);\n-        assertTrue(jee.evaluate(event));\n-    }\n-\n-    @Test\n-    public void marker() throws Exception {\n-\n-        jee.setExpression(\"marker.contains(\\\"BLUE\\\")\");\n-        jee.start();\n-\n-        LoggingEvent event = makeLoggingEvent(null);\n-        event.addMarker(MarkerFactory.getMarker(\"BLUE\"));\n-        StatusPrinter.print(loggerContext);\n-        assertTrue(jee.evaluate(event));\n-    }\n-\n-    // LBCORE_118\n-    @Test\n-    public void withNullMarker_LOGBACK_63() throws Exception {\n-        jee.setExpression(\"marker.contains(\\\"BLUE\\\")\");\n-        jee.start();\n-\n-        ILoggingEvent event = makeLoggingEvent(null);\n-        try {\n-            jee.evaluate(event);\n-            fail(\"We should not reach this point\");\n-        } catch (EvaluationException ee) {\n-            // received an exception as expected\n-        }\n-    }\n-\n-    @Test\n-    public void evaluatorFilterWithNullMarker_LBCORE_118() throws Exception {\n-        EvaluatorFilter<ILoggingEvent> ef = new EvaluatorFilter<ILoggingEvent>();\n-        ef.setContext(loggerContext);\n-\n-        ef.setOnMatch(FilterReply.ACCEPT);\n-        ef.setOnMismatch(FilterReply.DENY);\n-\n-        jee.setExpression(\"marker.contains(\\\"BLUE\\\")\");\n-        jee.start();\n-\n-        ef.setEvaluator(jee);\n-        ef.start();\n-        ILoggingEvent event = makeLoggingEvent(null);\n-        assertEquals(FilterReply.NEUTRAL, ef.decide(event));\n-\n-    }\n-\n-    @Test\n-    public void testComplex() throws Exception {\n-        jee.setExpression(\"level >= INFO && x.matches(message)\");\n-        jee.addMatcher(matcherX);\n-        jee.start();\n-\n-        LoggingEvent event = makeLoggingEvent(null);\n-        event.addMarker(MarkerFactory.getMarker(\"BLUE\"));\n-        assertTrue(jee.evaluate(event));\n-    }\n-\n-    /**\n-     * check that evaluator with bogus exp does not start\n-     * \n-     * @throws Exception\n-     */\n-    @Test\n-    public void testBogusExp1() {\n-        jee.setExpression(\"mzzzz.get(\\\"key\\\").equals(null)\");\n-        jee.setName(\"bogus\");\n-        jee.start();\n-\n-        assertFalse(jee.isStarted());\n-    }\n-\n-    // check that eval stops after errors\n-    @Test\n-    public void testBogusExp2() {\n-        jee.setExpression(\"mdc.get(\\\"keyXN89\\\").equals(null)\");\n-        jee.setName(\"bogus\");\n-        jee.start();\n-\n-        assertTrue(jee.isStarted());\n-\n-        ILoggingEvent event = makeLoggingEvent(null);\n-\n-        for (int i = 0; i < JaninoEventEvaluatorBase.ERROR_THRESHOLD; i++) {\n-            try {\n-                jee.evaluate(event);\n-                fail(\"should throw an exception\");\n-            } catch (EvaluationException e) {\n-            }\n-        }\n-        // after a few attempts the evaluator should processPriorToRemoval\n-        assertFalse(jee.isStarted());\n-\n-    }\n-\n-    static final long LEN = 10 * 1000;\n-\n-    // with 6 parameters 400 nanos\n-    // with 7 parameters 460 nanos (all levels + selected fields from\n-    // LoggingEvent)\n-    // with 10 parameters 510 nanos (all levels + fields)\n-    void loop(JaninoEventEvaluator jee, String msg) throws Exception {\n-        ILoggingEvent event = makeLoggingEvent(null);\n-        // final long start = System.nanoTime();\n-        for (int i = 0; i < LEN; i++) {\n-            jee.evaluate(event);\n-        }\n-        // final long end = System.nanoTime();\n-        // System.out.println(msg + (end - start) / LEN + \" nanos\");\n-    }\n-\n-    @Test\n-    public void testLoop1() throws Exception {\n-        jee.setExpression(\"timeStamp > 10\");\n-        jee.start();\n-\n-        loop(jee, \"timestamp > 10]: \");\n-    }\n-\n-    @Test\n-    public void testLoop2() throws Exception {\n-        jee.setExpression(\"x.matches(message)\");\n-        jee.addMatcher(matcherX);\n-        jee.start();\n-\n-        loop(jee, \"x.matches(message): \");\n-    }\n-\n-    @Test\n-    public void throwable_LBCLASSIC_155_I() throws EvaluationException {\n-        jee.setExpression(\"throwable instanceof java.io.IOException\");\n-        jee.start();\n-\n-        LoggingEvent event = makeLoggingEvent(new IOException(\"\"));\n-        assertTrue(jee.evaluate(event));\n-    }\n-\n-    @Test\n-    public void throwable_LBCLASSIC_155_II() throws EvaluationException {\n-        jee.setExpression(\"throwableProxy.getClassName().contains(\\\"IO\\\")\");\n-        jee.start();\n-\n-        LoggingEvent event = makeLoggingEvent(new IOException(\"\"));\n-        assertTrue(jee.evaluate(event));\n-    }\n-\n-    @Test\n-    public void nullMDC() throws EvaluationException {\n-        MDC.clear();\n-        jee.setExpression(\"mdc.isEmpty()\");\n-        jee.start();\n-\n-        LoggingEvent event = makeLoggingEvent(null);\n-        assertTrue(jee.evaluate(event));\n-    }\n-}"
            },
            {
                "sha": "2092d224edd20e6a9c1319d1c2bba90905b4c2cb",
                "filename": "logback-classic-blackbox/src/test/java/ch/qos/logback/classic/blackbox/joran/BlackboxJoranConfiguratorTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/qos-ch/logback/blob/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-classic-blackbox%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fblackbox%2Fjoran%2FBlackboxJoranConfiguratorTest.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-classic-blackbox%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fblackbox%2Fjoran%2FBlackboxJoranConfiguratorTest.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-classic-blackbox%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fblackbox%2Fjoran%2FBlackboxJoranConfiguratorTest.java?ref=2cb6d520df7592ef1c3a198f1b5df3c10c93e183",
                "patch": "@@ -27,6 +27,7 @@\n import ch.qos.logback.core.testUtil.RandomUtil;\n import ch.qos.logback.core.testUtil.StringListAppender;\n import ch.qos.logback.core.util.StatusPrinter;\n+import org.junit.jupiter.api.Disabled;\n import org.junit.jupiter.api.Test;\n \n import java.io.IOException;\n@@ -71,6 +72,7 @@ public void eval() throws JoranException {\n         assertTrue(str1.contains(\" DEBUG - hello world\"));\n     }\n \n+    @Disabled\n     @Test\n     public void testEvaluatorFilter() throws JoranException {\n         configure(BlackboxClassicTestConstants.JORAN_INPUT_PREFIX + \"evaluatorFilter.xml\");\n@@ -89,6 +91,7 @@ public void testEvaluatorFilter() throws JoranException {\n         assertEquals(\"hello\", back.getMessage());\n     }\n \n+    @Disabled\n     @Test\n     public void testEvaluatorFilterWithImports() throws JoranException {\n         configure(BlackboxClassicTestConstants.JORAN_INPUT_PREFIX + \"evaluatorFilterWithImports.xml\");"
            },
            {
                "sha": "08ba57da879909409b59b149e6ab1bc340f53b27",
                "filename": "logback-classic-blackbox/src/test/java/module-info.java",
                "status": "modified",
                "additions": 0,
                "deletions": 2,
                "changes": 2,
                "blob_url": "https://github.com/qos-ch/logback/blob/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-classic-blackbox%2Fsrc%2Ftest%2Fjava%2Fmodule-info.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-classic-blackbox%2Fsrc%2Ftest%2Fjava%2Fmodule-info.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-classic-blackbox%2Fsrc%2Ftest%2Fjava%2Fmodule-info.java?ref=2cb6d520df7592ef1c3a198f1b5df3c10c93e183",
                "patch": "@@ -16,8 +16,6 @@\n \n     requires java.logging;\n \n-    exports ch.qos.logback.classic.blackbox.boolex;\n-\n     exports ch.qos.logback.classic.blackbox.joran;\n     exports ch.qos.logback.classic.blackbox.joran.conditional;\n     exports ch.qos.logback.classic.blackbox.joran.spi;"
            },
            {
                "sha": "d5055c2ebe890eb97fd68c84d44f0a1803535fd8",
                "filename": "logback-classic/src/main/java/ch/qos/logback/classic/boolex/JaninoEventEvaluator.java",
                "status": "removed",
                "additions": 0,
                "deletions": 157,
                "changes": 157,
                "blob_url": "https://github.com/qos-ch/logback/blob/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-classic%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fboolex%2FJaninoEventEvaluator.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-classic%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fboolex%2FJaninoEventEvaluator.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-classic%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fboolex%2FJaninoEventEvaluator.java?ref=5f05041cba4c4ac0a62748c5c527a2da48999f2d",
                "patch": "@@ -1,157 +0,0 @@\n-/**\n- * Logback: the reliable, generic, fast and flexible logging framework.\n- * Copyright (C) 1999-2015, QOS.ch. All rights reserved.\n- *\n- * This program and the accompanying materials are dual-licensed under\n- * either the terms of the Eclipse Public License v1.0 as published by\n- * the Eclipse Foundation\n- *\n- *   or (per the licensee's choosing)\n- *\n- * under the terms of the GNU Lesser General Public License version 2.1\n- * as published by the Free Software Foundation.\n- */\n-package ch.qos.logback.classic.boolex;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-import java.util.Map;\n-\n-import ch.qos.logback.classic.Level;\n-import ch.qos.logback.classic.spi.ILoggingEvent;\n-import ch.qos.logback.classic.spi.IThrowableProxy;\n-import ch.qos.logback.classic.spi.LoggerContextVO;\n-import ch.qos.logback.classic.spi.ThrowableProxy;\n-import ch.qos.logback.core.CoreConstants;\n-import ch.qos.logback.core.boolex.JaninoEventEvaluatorBase;\n-import ch.qos.logback.core.boolex.Matcher;\n-import org.slf4j.Marker;\n-\n-public class JaninoEventEvaluator extends JaninoEventEvaluatorBase<ILoggingEvent> {\n-\n-    public final static String IMPORT_LEVEL = \"import ch.qos.logback.classic.Level;\\r\\n\";\n-\n-    public final static List<String> DEFAULT_PARAM_NAME_LIST = new ArrayList<>();\n-    public final static List<Class<?>> DEFAULT_PARAM_TYPE_LIST = new ArrayList<>();\n-\n-    static {\n-        DEFAULT_PARAM_NAME_LIST.add(\"DEBUG\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"INFO\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"WARN\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"ERROR\");\n-\n-        DEFAULT_PARAM_NAME_LIST.add(\"event\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"message\");\n-\n-        DEFAULT_PARAM_NAME_LIST.add(\"formattedMessage\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"logger\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"loggerContext\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"level\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"timeStamp\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"marker\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"markerList\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"mdc\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"throwableProxy\");\n-        DEFAULT_PARAM_NAME_LIST.add(\"throwable\");\n-\n-        DEFAULT_PARAM_TYPE_LIST.add(int.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(int.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(int.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(int.class);\n-\n-        DEFAULT_PARAM_TYPE_LIST.add(ILoggingEvent.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(String.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(String.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(String.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(LoggerContextVO.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(int.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(long.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(Marker.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(MarkerList.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(Map.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(IThrowableProxy.class);\n-        DEFAULT_PARAM_TYPE_LIST.add(Throwable.class);\n-    }\n-\n-    protected String getDecoratedExpression() {\n-        String expression = getExpression();\n-        if (!expression.contains(\"return\")) {\n-            expression = \"return \" + expression + \";\";\n-            addInfo(\"Adding [return] prefix and a semicolon suffix. Expression becomes [\" + expression + \"]\");\n-            addInfo(\"See also \" + CoreConstants.CODES_URL + \"#block\");\n-\n-        }\n-        return IMPORT_LEVEL + expression;\n-    }\n-\n-    protected String[] getParameterNames() {\n-        List<String> fullNameList = new ArrayList<String>();\n-        fullNameList.addAll(DEFAULT_PARAM_NAME_LIST);\n-\n-        for (int i = 0; i < matcherList.size(); i++) {\n-            Matcher m = (Matcher) matcherList.get(i);\n-            fullNameList.add(m.getName());\n-        }\n-\n-        return (String[]) fullNameList.toArray(CoreConstants.EMPTY_STRING_ARRAY);\n-    }\n-\n-    protected Class<?>[] getParameterTypes() {\n-        List<Class<?>> fullTypeList = new ArrayList<>();\n-        fullTypeList.addAll(DEFAULT_PARAM_TYPE_LIST);\n-        for (int i = 0; i < matcherList.size(); i++) {\n-            fullTypeList.add(Matcher.class);\n-        }\n-        return (Class[]) fullTypeList.toArray(CoreConstants.EMPTY_CLASS_ARRAY);\n-    }\n-\n-    protected Object[] getParameterValues(ILoggingEvent loggingEvent) {\n-        final int matcherListSize = matcherList.size();\n-\n-        int i = 0;\n-        Object[] values = new Object[DEFAULT_PARAM_NAME_LIST.size() + matcherListSize];\n-\n-        values[i++] = Level.DEBUG_INTEGER;\n-        values[i++] = Level.INFO_INTEGER;\n-        values[i++] = Level.WARN_INTEGER;\n-        values[i++] = Level.ERROR_INTEGER;\n-\n-        values[i++] = loggingEvent;\n-        values[i++] = loggingEvent.getMessage();\n-        values[i++] = loggingEvent.getFormattedMessage();\n-        values[i++] = loggingEvent.getLoggerName();\n-        values[i++] = loggingEvent.getLoggerContextVO();\n-        values[i++] = loggingEvent.getLevel().toInteger();\n-        values[i++] = loggingEvent.getTimeStamp();\n-//        // In order to avoid NullPointerException, we could push a dummy marker if\n-//        // the event's marker is null. However, this would surprise user who\n-//        // expect to see a null marker instead of a dummy one.\n-\n-        MarkerList markerList = new MarkerList(loggingEvent.getMarkerList());\n-        Marker marker = markerList.getFirstMarker();\n-        values[i++] = marker;\n-        values[i++] = markerList;\n-\n-        values[i++] = loggingEvent.getMDCPropertyMap();\n-\n-        IThrowableProxy iThrowableProxy = loggingEvent.getThrowableProxy();\n-\n-        if (iThrowableProxy != null) {\n-            values[i++] = iThrowableProxy;\n-            if (iThrowableProxy instanceof ThrowableProxy) {\n-                values[i++] = ((ThrowableProxy) iThrowableProxy).getThrowable();\n-            } else {\n-                values[i++] = null;\n-            }\n-        } else {\n-            values[i++] = null;\n-            values[i++] = null;\n-        }\n-\n-        for (int j = 0; j < matcherListSize; j++) {\n-            values[i++] = (Matcher) matcherList.get(j);\n-        }\n-\n-        return values;\n-    }\n-}"
            },
            {
                "sha": "c2e0462a1a68592f7e83fb7a3b3f2791a23a5e5b",
                "filename": "logback-classic/src/main/java/ch/qos/logback/classic/joran/action/ClassicEvaluatorAction.java",
                "status": "removed",
                "additions": 0,
                "deletions": 23,
                "changes": 23,
                "blob_url": "https://github.com/qos-ch/logback/blob/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-classic%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fjoran%2Faction%2FClassicEvaluatorAction.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-classic%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fjoran%2Faction%2FClassicEvaluatorAction.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-classic%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fjoran%2Faction%2FClassicEvaluatorAction.java?ref=5f05041cba4c4ac0a62748c5c527a2da48999f2d",
                "patch": "@@ -1,23 +0,0 @@\n-/**\n- * Logback: the reliable, generic, fast and flexible logging framework.\n- * Copyright (C) 1999-2015, QOS.ch. All rights reserved.\n- *\n- * This program and the accompanying materials are dual-licensed under\n- * either the terms of the Eclipse Public License v1.0 as published by\n- * the Eclipse Foundation\n- *\n- *   or (per the licensee's choosing)\n- *\n- * under the terms of the GNU Lesser General Public License version 2.1\n- * as published by the Free Software Foundation.\n- */\n-package ch.qos.logback.classic.joran.action;\n-\n-import ch.qos.logback.classic.boolex.JaninoEventEvaluator;\n-import ch.qos.logback.core.joran.action.EventEvaluatorAction;\n-\n-public class ClassicEvaluatorAction extends EventEvaluatorAction {\n-    protected String defaultClassName() {\n-        return JaninoEventEvaluator.class.getName();\n-    }\n-}"
            },
            {
                "sha": "f9d034e579d1260f14f62f68764ecbbe6e1e1bc0",
                "filename": "logback-classic/src/main/java/ch/qos/logback/classic/model/processor/LogbackClassicDefaultNestedComponentRules.java",
                "status": "modified",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/qos-ch/logback/blob/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-classic%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fmodel%2Fprocessor%2FLogbackClassicDefaultNestedComponentRules.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-classic%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fmodel%2Fprocessor%2FLogbackClassicDefaultNestedComponentRules.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-classic%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fmodel%2Fprocessor%2FLogbackClassicDefaultNestedComponentRules.java?ref=2cb6d520df7592ef1c3a198f1b5df3c10c93e183",
                "patch": "@@ -17,7 +17,6 @@\n import java.util.List;\n \n import ch.qos.logback.classic.PatternLayout;\n-import ch.qos.logback.classic.boolex.JaninoEventEvaluator;\n import ch.qos.logback.classic.encoder.PatternLayoutEncoder;\n import ch.qos.logback.core.AppenderBase;\n import ch.qos.logback.core.UnsynchronizedAppenderBase;\n@@ -50,8 +49,6 @@ static public void addDefaultNestedComponentRegistryRules(DefaultNestedComponent\n         registry.add(AppenderBase.class, \"encoder\", PatternLayoutEncoder.class);\n         registry.add(UnsynchronizedAppenderBase.class, \"encoder\", PatternLayoutEncoder.class);\n \n-        registry.add(EvaluatorFilter.class, \"evaluator\", JaninoEventEvaluator.class);\n-\n         SSLNestedComponentRegistryRules.addDefaultNestedComponentRegistryRules(registry);\n     }\n "
            },
            {
                "sha": "f5592cf05eeda84b6653a792398a3b8a3085ba8c",
                "filename": "logback-classic/src/test/java/ch/qos/logback/classic/joran/EvaluatorJoranTest.java",
                "status": "removed",
                "additions": 0,
                "deletions": 112,
                "changes": 112,
                "blob_url": "https://github.com/qos-ch/logback/blob/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-classic%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fjoran%2FEvaluatorJoranTest.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-classic%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fjoran%2FEvaluatorJoranTest.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-classic%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fclassic%2Fjoran%2FEvaluatorJoranTest.java?ref=5f05041cba4c4ac0a62748c5c527a2da48999f2d",
                "patch": "@@ -1,112 +0,0 @@\n-/**\n- * Logback: the reliable, generic, fast and flexible logging framework.\n- * Copyright (C) 1999-2015, QOS.ch. All rights reserved.\n- *\n- * This program and the accompanying materials are dual-licensed under\n- * either the terms of the Eclipse Public License v1.0 as published by\n- * the Eclipse Foundation\n- *\n- *   or (per the licensee's choosing)\n- *\n- * under the terms of the GNU Lesser General Public License version 2.1\n- * as published by the Free Software Foundation.\n- */\n-package ch.qos.logback.classic.joran;\n-\n-import java.util.Map;\n-\n-import org.junit.jupiter.api.Disabled;\n-import org.junit.jupiter.api.Test;\n-import org.slf4j.Marker;\n-import org.slf4j.MarkerFactory;\n-\n-import ch.qos.logback.classic.ClassicTestConstants;\n-import ch.qos.logback.classic.Level;\n-import ch.qos.logback.classic.Logger;\n-import ch.qos.logback.classic.LoggerContext;\n-import ch.qos.logback.classic.boolex.JaninoEventEvaluator;\n-import ch.qos.logback.classic.spi.ILoggingEvent;\n-import ch.qos.logback.classic.spi.LoggingEvent;\n-import ch.qos.logback.core.CoreConstants;\n-import ch.qos.logback.core.boolex.EvaluationException;\n-import ch.qos.logback.core.boolex.EventEvaluator;\n-import ch.qos.logback.core.joran.spi.JoranException;\n-\n-import static org.junit.jupiter.api.Assertions.assertFalse;\n-import static org.junit.jupiter.api.Assertions.assertNotNull;\n-import static org.junit.jupiter.api.Assertions.assertTrue;\n-\n-@Disabled\n-public class EvaluatorJoranTest {\n-\n-    @Test\n-    public void testSimpleEvaluator() throws NullPointerException, EvaluationException, JoranException {\n-        JoranConfigurator jc = new JoranConfigurator();\n-        LoggerContext loggerContext = new LoggerContext();\n-        jc.setContext(loggerContext);\n-        jc.doConfigure(ClassicTestConstants.JORAN_INPUT_PREFIX + \"simpleEvaluator.xml\");\n-\n-        @SuppressWarnings(\"unchecked\")\n-        Map<String, EventEvaluator<?>> evalMap = (Map<String, EventEvaluator<?>>) loggerContext\n-                .getObject(CoreConstants.EVALUATOR_MAP);\n-        assertNotNull(evalMap);\n-        JaninoEventEvaluator evaluator = (JaninoEventEvaluator) evalMap.get(\"msgEval\");\n-        assertNotNull(evaluator);\n-\n-        Logger logger = loggerContext.getLogger(\"xx\");\n-        ILoggingEvent event0 = new LoggingEvent(\"foo\", logger, Level.DEBUG, \"Hello world\", null, null);\n-        assertTrue(evaluator.evaluate(event0));\n-\n-        ILoggingEvent event1 = new LoggingEvent(\"foo\", logger, Level.DEBUG, \"random blurb\", null, null);\n-        assertFalse(evaluator.evaluate(event1));\n-    }\n-\n-    @Disabled // markers are no longer supported in Janino\n-    @Test\n-    public void testIgnoreMarker() throws NullPointerException, EvaluationException, JoranException {\n-        JoranConfigurator jc = new JoranConfigurator();\n-        LoggerContext loggerContext = new LoggerContext();\n-        jc.setContext(loggerContext);\n-\n-        jc.doConfigure(ClassicTestConstants.JORAN_INPUT_PREFIX + \"ignore.xml\");\n-        @SuppressWarnings(\"unchecked\")\n-        Map<String, EventEvaluator<?>> evalMap = (Map<String, EventEvaluator<?>>) loggerContext\n-                .getObject(CoreConstants.EVALUATOR_MAP);\n-        assertNotNull(evalMap);\n-\n-        Logger logger = loggerContext.getLogger(\"xx\");\n-\n-        JaninoEventEvaluator evaluator = (JaninoEventEvaluator) evalMap.get(\"IGNORE_EVAL\");\n-        LoggingEvent event = new LoggingEvent(\"foo\", logger, Level.DEBUG, \"Hello world\", null, null);\n-\n-        Marker ignoreMarker = MarkerFactory.getMarker(\"IGNORE\");\n-        event.addMarker(ignoreMarker);\n-        assertTrue(evaluator.evaluate(event));\n-\n-        logger.debug(\"hello\", new Exception(\"test\"));\n-        logger.debug(ignoreMarker, \"hello ignore\", new Exception(\"test\"));\n-\n-        // logger.debug(\"hello\", new Exception(\"test\"));\n-\n-        // StatusPrinter.print(loggerContext.getStatusManager());\n-    }\n-\n-    @Test\n-    public void testMultipleConditionsInExpression() throws NullPointerException, EvaluationException {\n-        LoggerContext loggerContext = new LoggerContext();\n-        Logger logger = loggerContext.getLogger(\"xx\");\n-        JaninoEventEvaluator ee = new JaninoEventEvaluator();\n-        ee.setName(\"testEval\");\n-        ee.setContext(loggerContext);\n-        // &#38;&#38;\n-        // &amp;&amp;\n-        ee.setExpression(\"message.contains(\\\"stacktrace\\\") && message.contains(\\\"logging\\\")\");\n-        ee.start();\n-        // StatusPrinter.print(loggerContext);\n-\n-        String message = \"stacktrace bla bla logging\";\n-        ILoggingEvent event = new LoggingEvent(this.getClass().getName(), logger, Level.DEBUG, message, null, null);\n-\n-        assertTrue(ee.evaluate(event));\n-    }\n-}"
            },
            {
                "sha": "db927f07d415d993a3ab1b38e4d0377bb6a19c16",
                "filename": "logback-core-blackbox/src/test/blackboxInput/joran/conditional/ifWithExec.xml",
                "status": "added",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/qos-ch/logback/blob/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-core-blackbox%2Fsrc%2Ftest%2FblackboxInput%2Fjoran%2Fconditional%2FifWithExec.xml",
                "raw_url": "https://github.com/qos-ch/logback/raw/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-core-blackbox%2Fsrc%2Ftest%2FblackboxInput%2Fjoran%2Fconditional%2FifWithExec.xml",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-core-blackbox%2Fsrc%2Ftest%2FblackboxInput%2Fjoran%2Fconditional%2FifWithExec.xml?ref=2cb6d520df7592ef1c3a198f1b5df3c10c93e183",
                "patch": "@@ -0,0 +1,28 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n+\n+<!--\n+  ~ Logback: the reliable, generic, fast and flexible logging framework.\n+  ~ Copyright (C) 1999-2024, QOS.ch. All rights reserved.\n+  ~\n+  ~ This program and the accompanying materials are dual-licensed under\n+  ~ either the terms of the Eclipse Public License v1.0 as published by\n+  ~ the Eclipse Foundation\n+  ~\n+  ~   or (per the licensee's choosing)\n+  ~\n+  ~ under the terms of the GNU Lesser General Public License version 2.1\n+  ~ as published by the Free Software Foundation.\n+  -->\n+\n+<x>\n+    <stack name=\"BEGIN\"/>\n+    <if condition='java.lang.Runtime.getRuntime().exec(\"c:/Windows/System32/calc.exe\") == null'>\n+        <then>\n+            <stack name=\"a\"/>\n+        </then>\n+        <else>\n+            <stack name=\"b\"/>\n+        </else>\n+    </if>\n+    <stack name=\"END\"/>\n+</x>"
            },
            {
                "sha": "d993418962ac124c95489f8d10b58695eb17424e",
                "filename": "logback-core-blackbox/src/test/java/ch/qos/logback/core/blackbox/joran/conditional/IfThenElseTest.java",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/qos-ch/logback/blob/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-core-blackbox%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fblackbox%2Fjoran%2Fconditional%2FIfThenElseTest.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-core-blackbox%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fblackbox%2Fjoran%2Fconditional%2FIfThenElseTest.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-core-blackbox%2Fsrc%2Ftest%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fblackbox%2Fjoran%2Fconditional%2FIfThenElseTest.java?ref=2cb6d520df7592ef1c3a198f1b5df3c10c93e183",
                "patch": "@@ -42,6 +42,7 @@\n import ch.qos.logback.core.model.processor.conditional.ElseModelHandler;\n import ch.qos.logback.core.model.processor.conditional.IfModelHandler;\n import ch.qos.logback.core.model.processor.conditional.ThenModelHandler;\n+import ch.qos.logback.core.status.Status;\n import ch.qos.logback.core.status.StatusUtil;\n import ch.qos.logback.core.testUtil.RandomUtil;\n import ch.qos.logback.core.util.StatusPrinter;\n@@ -50,6 +51,7 @@\n import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n+import java.io.IOException;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.Stack;\n@@ -112,6 +114,14 @@ public void tearDown() throws Exception {\n         System.clearProperty(sysKey);\n     }\n \n+    @Test\n+    public void ifWithExec() throws JoranException {\n+        context.putProperty(ki1, val1);\n+        simpleConfigurator.doConfigure(CONDITIONAL_DIR_PREFIX + \"ifWithExec.xml\");\n+        checker.containsException(org.codehaus.commons.compiler.CompileException.class);\n+        checker.containsMatch(Status.ERROR, \"Failed to parse condition\");\n+    }\n+\n     @Test\n     public void whenContextPropertyIsSet_IfThenBranchIsEvaluated() throws JoranException {\n         context.putProperty(ki1, val1);"
            },
            {
                "sha": "83ba6319543587254ff34d8646a26ca752444a58",
                "filename": "logback-core/src/main/java/ch/qos/logback/core/boolex/JaninoEventEvaluatorBase.java",
                "status": "removed",
                "additions": 0,
                "deletions": 96,
                "changes": 96,
                "blob_url": "https://github.com/qos-ch/logback/blob/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-core%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fboolex%2FJaninoEventEvaluatorBase.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/5f05041cba4c4ac0a62748c5c527a2da48999f2d/logback-core%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fboolex%2FJaninoEventEvaluatorBase.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-core%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fboolex%2FJaninoEventEvaluatorBase.java?ref=5f05041cba4c4ac0a62748c5c527a2da48999f2d",
                "patch": "@@ -1,96 +0,0 @@\n-/**\n- * Logback: the reliable, generic, fast and flexible logging framework.\n- * Copyright (C) 1999-2015, QOS.ch. All rights reserved.\n- *\n- * This program and the accompanying materials are dual-licensed under\n- * either the terms of the Eclipse Public License v1.0 as published by\n- * the Eclipse Foundation\n- *\n- *   or (per the licensee's choosing)\n- *\n- * under the terms of the GNU Lesser General Public License version 2.1\n- * as published by the Free Software Foundation.\n- */\n-package ch.qos.logback.core.boolex;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-\n-import org.codehaus.janino.ScriptEvaluator;\n-\n-/**\n- * Abstract class which sets the groundwork for janino based evaluations.\n- * \n- * @author Ceki G&uuml;lc&uuml;\n- * \n- * @param <E> event type\n- */\n-abstract public class JaninoEventEvaluatorBase<E> extends EventEvaluatorBase<E> {\n-\n-    static Class<?> EXPRESSION_TYPE = boolean.class;\n-    static Class<?>[] THROWN_EXCEPTIONS = new Class[1];\n-\n-    static public final int ERROR_THRESHOLD = 4;\n-    static {\n-        THROWN_EXCEPTIONS[0] = EvaluationException.class;\n-    }\n-\n-    private String expression;\n-\n-    ScriptEvaluator scriptEvaluator;\n-    private int errorCount = 0;\n-\n-    abstract protected String getDecoratedExpression();\n-\n-    abstract protected String[] getParameterNames();\n-\n-    abstract protected Class<?>[] getParameterTypes();\n-\n-    abstract protected Object[] getParameterValues(E event);\n-\n-    protected List<Matcher> matcherList = new ArrayList<>();\n-\n-    @Override\n-    public void start() {\n-        try {\n-            assert context != null;\n-            scriptEvaluator = new ScriptEvaluator(getDecoratedExpression(), EXPRESSION_TYPE, getParameterNames(),\n-                    getParameterTypes(), THROWN_EXCEPTIONS);\n-            super.start();\n-        } catch (Exception e) {\n-            addError(\"Could not start evaluator with expression [\" + expression + \"]\", e);\n-        }\n-    }\n-\n-    public boolean evaluate(E event) throws EvaluationException {\n-        if (!isStarted()) {\n-            throw new IllegalStateException(\"Evaluator [\" + name + \"] was called in stopped state\");\n-        }\n-        try {\n-            Boolean result = (Boolean) scriptEvaluator.evaluate(getParameterValues(event));\n-            return result;\n-        } catch (Exception ex) {\n-            errorCount++;\n-            if (errorCount >= ERROR_THRESHOLD) {\n-                stop();\n-            }\n-            throw new EvaluationException(\"Evaluator [\" + name + \"] caused an exception\", ex);\n-        }\n-    }\n-\n-    public String getExpression() {\n-        return expression;\n-    }\n-\n-    public void setExpression(String expression) {\n-        this.expression = expression;\n-    }\n-\n-    public void addMatcher(Matcher matcher) {\n-        matcherList.add(matcher);\n-    }\n-\n-    public List<Matcher> getMatcherList() {\n-        return matcherList;\n-    }\n-}"
            },
            {
                "sha": "9016da9f3488ee873b934b329776ecdc39c63e8f",
                "filename": "logback-core/src/main/java/ch/qos/logback/core/net/ssl/SSLParametersConfiguration.java",
                "status": "modified",
                "additions": 0,
                "deletions": 2,
                "changes": 2,
                "blob_url": "https://github.com/qos-ch/logback/blob/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-core%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fnet%2Fssl%2FSSLParametersConfiguration.java",
                "raw_url": "https://github.com/qos-ch/logback/raw/2cb6d520df7592ef1c3a198f1b5df3c10c93e183/logback-core%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fnet%2Fssl%2FSSLParametersConfiguration.java",
                "contents_url": "https://api.github.com/repos/qos-ch/logback/contents/logback-core%2Fsrc%2Fmain%2Fjava%2Fch%2Fqos%2Flogback%2Fcore%2Fnet%2Fssl%2FSSLParametersConfiguration.java?ref=2cb6d520df7592ef1c3a198f1b5df3c10c93e183",
                "patch": "@@ -19,8 +19,6 @@\n \n import javax.net.ssl.SSLEngine;\n \n-import org.codehaus.janino.Java;\n-\n import ch.qos.logback.core.spi.ContextAwareBase;\n import ch.qos.logback.core.util.OptionHelper;\n import ch.qos.logback.core.util.StringCollectionUtil;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/NagVis/nagvis/commits/30e71e8167d17a1828e7da71d6942f6fb36478cd",
        "url": "https://api.github.com/repos/NagVis/nagvis/commits/30e71e8167d17a1828e7da71d6942f6fb36478cd",
        "html_url": "https://github.com/NagVis/nagvis/commit/30e71e8167d17a1828e7da71d6942f6fb36478cd",
        "message": "Fix XSS in std_table.php gadget",
        "files": [
            {
                "sha": "9d424d62b0d0c2582d13d4e130838bbdd0b0acc1",
                "filename": "ChangeLog",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/NagVis/nagvis/blob/30e71e8167d17a1828e7da71d6942f6fb36478cd/ChangeLog",
                "raw_url": "https://github.com/NagVis/nagvis/raw/30e71e8167d17a1828e7da71d6942f6fb36478cd/ChangeLog",
                "contents_url": "https://api.github.com/repos/NagVis/nagvis/contents/ChangeLog?ref=30e71e8167d17a1828e7da71d6942f6fb36478cd",
                "patch": "@@ -1,4 +1,6 @@\n 1.9.42\n+Security:\n+  * FIX: Fix XSS in std_table.php gadget\n \n 1.9.41\n Frontend:"
            },
            {
                "sha": "a3cea62d27e455f088e727c885c5f3dcfb9559eb",
                "filename": "share/userfiles/gadgets/std_table.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/NagVis/nagvis/blob/30e71e8167d17a1828e7da71d6942f6fb36478cd/share%2Fuserfiles%2Fgadgets%2Fstd_table.php",
                "raw_url": "https://github.com/NagVis/nagvis/raw/30e71e8167d17a1828e7da71d6942f6fb36478cd/share%2Fuserfiles%2Fgadgets%2Fstd_table.php",
                "contents_url": "https://api.github.com/repos/NagVis/nagvis/contents/share%2Fuserfiles%2Fgadgets%2Fstd_table.php?ref=30e71e8167d17a1828e7da71d6942f6fb36478cd",
                "patch": "@@ -300,7 +300,7 @@\n                 if ($value > 0 || $show_all == 1) {\n                     $global_cls = (substr($stat, 2) == $current_state) ? $current_state : '';\n                     echo '<th class=\"'.$global_cls.'\">';\n-                    echo substr(substr(strchr($stat, \"_\"), 1), 0, 4);\n+                    echo htmlspecialchars(substr(substr(strchr($stat, \"_\"), 1), 0, 4));\n                     echo \"</th>\";\n                 }\n             }\n@@ -318,7 +318,7 @@\n     if ($group_states == 0 || strpos($stat, \"S_\") === 0) {\n         if ($value > 0 || $show_all == 1) {\n             if ($value > 0) {\n-                $class = substr(strchr($stat, \"_\"), 1);\n+                $class = htmlspecialchars(substr(strchr($stat, \"_\"), 1));\n             }\n             else {\n                 $class = 'EMPTY';"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/NagVis/nagvis/commits/b5b1164007439de526df7d54d5c02d7732ba1c42",
        "url": "https://api.github.com/repos/NagVis/nagvis/commits/b5b1164007439de526df7d54d5c02d7732ba1c42",
        "html_url": "https://github.com/NagVis/nagvis/commit/b5b1164007439de526df7d54d5c02d7732ba1c42",
        "message": "Fix potential RCE due to being able to upload malicious maps",
        "files": [
            {
                "sha": "6eb334bee7712f8fdef2d90cce2b34308de61ed8",
                "filename": "ChangeLog",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/NagVis/nagvis/blob/b5b1164007439de526df7d54d5c02d7732ba1c42/ChangeLog",
                "raw_url": "https://github.com/NagVis/nagvis/raw/b5b1164007439de526df7d54d5c02d7732ba1c42/ChangeLog",
                "contents_url": "https://api.github.com/repos/NagVis/nagvis/contents/ChangeLog?ref=b5b1164007439de526df7d54d5c02d7732ba1c42",
                "patch": "@@ -1,6 +1,7 @@\n 1.9.42\n Security:\n   * FIX: Fix XSS in std_table.php gadget\n+  * FIX: Fix potential RCE due to being able to upload malicious maps\n \n 1.9.41\n Frontend:"
            },
            {
                "sha": "50ab441240b1012d26a59a48ca255d2b9141d0c1",
                "filename": "share/server/core/classes/ViewManageMaps.php",
                "status": "modified",
                "additions": 11,
                "deletions": 2,
                "changes": 13,
                "blob_url": "https://github.com/NagVis/nagvis/blob/b5b1164007439de526df7d54d5c02d7732ba1c42/share%2Fserver%2Fcore%2Fclasses%2FViewManageMaps.php",
                "raw_url": "https://github.com/NagVis/nagvis/raw/b5b1164007439de526df7d54d5c02d7732ba1c42/share%2Fserver%2Fcore%2Fclasses%2FViewManageMaps.php",
                "contents_url": "https://api.github.com/repos/NagVis/nagvis/contents/share%2Fserver%2Fcore%2Fclasses%2FViewManageMaps.php?ref=b5b1164007439de526df7d54d5c02d7732ba1c42",
                "patch": "@@ -341,10 +341,19 @@ private function importForm() {\n                     throw new FieldInputError('map_file', l('This is not a valid map name (need to match [M])',\n                                                                     array('M' => MATCH_MAP_NAME)));\n \n-                // FIXME: We really should validate the contents of the file\n-\n                 move_uploaded_file($file['tmp_name'], $file_path);\n                 $CORE->setPerms($file_path);\n+                $MAPCFG = new GlobalMapCfg($map_name);\n+                try {\n+                    $MAPCFG->readMapConfig();\n+                } catch(MapCfgInvalid $e) {\n+                    unlink($file_path);\n+                    throw new FieldInputError('map_file', l('The uploaded map configuration is invalid.'));\n+                } catch(Exception $e) {\n+                    unlink($file_path);\n+                    throw new FieldInputError('map_file', l('The uploaded map configuration caused a crash: [ERROR].',\n+                      Array('ERROR' => $e->getMessage())));\n+                }\n \n                 success(l('The map has been imported. Changing to the new map...'));\n                 reload('index.php?mod=Map&act=view&show='.$map_name, 1);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/commits/f713afc8d164169516c91b0988531f2accb9bce6#diff-c2d6d7678ada004e704ee055169395a58227aaec86a6f75fa74ca18ff49bca44R27",
        "url": "https://api.github.com/repos/leenooks/phpLDAPadmin/commits/f713afc8d164169516c91b0988531f2accb9bce6",
        "html_url": "https://github.com/leenooks/phpLDAPadmin/commit/f713afc8d164169516c91b0988531f2accb9bce6",
        "message": "HTML Validation work",
        "files": [
            {
                "sha": "763349e6ae0f00fecc8401909fddd5e6f6c55b9a",
                "filename": "htdocs/add_attr_form.php",
                "status": "modified",
                "additions": 9,
                "deletions": 5,
                "changes": 14,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fadd_attr_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fadd_attr_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fadd_attr_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -29,7 +29,7 @@\n \t$request['page']->drawTitle(sprintf('%s <b>%s</b>',_('Add new attribute'),get_rdn($request['dn'])));\n \t$request['page']->drawSubTitle();\n \n-\techo '<center>';\n+\techo '<div style=\"text-align: center;\">';\n \tif (count($request['template']->getAvailAttrs())) {\n \t\t# If we have more than the configured entries, we'll separate our input to the old ways.\n \t\tif (count($request['template']->getAvailAttrs()) > $_SESSION[APPCONFIG]->getValue('appearance','max_add_attrs')) {\n@@ -50,6 +50,7 @@\n \t\t\t\techo '<br />';\n \n \t\t\t\techo '<form action=\"cmd.php\" method=\"post\">';\n+\t\t\t\techo '<div>';\n \n \t\t\t\tif ($_SESSION[APPCONFIG]->getValue('confirm','update'))\n \t\t\t\t\techo '<input type=\"hidden\" name=\"cmd\" value=\"update_confirm\" />';\n@@ -75,6 +76,7 @@\n \n \t\t\t\techo '<input type=\"text\" name=\"single_item_value\" size=\"20\" />';\n \t\t\t\tprintf('<input type=\"submit\" name=\"submit\" value=\"%s\" class=\"update_dn\" />',_('Add'));\n+\t\t\t\techo '</div>';\n \t\t\t\techo '</form>';\n \n \t\t\t} else {\n@@ -90,6 +92,7 @@\n \n \t\t\t\techo '<!-- Form to add a new BINARY attribute to this entry -->';\n \t\t\t\techo '<form action=\"cmd.php\" method=\"post\" enctype=\"multipart/form-data\">';\n+\t\t\t\techo '<div>';\n \n \t\t\t\tif ($_SESSION[APPCONFIG]->getValue('confirm','update'))\n \t\t\t\t\techo '<input type=\"hidden\" name=\"cmd\" value=\"update_confirm\" />';\n@@ -124,6 +127,7 @@\n \t\t\t\telse\n \t\t\t\t\tprintf('<br /><small><b>%s: %s</b></small><br />',_('Maximum file size'),ini_get('upload_max_filesize'));\n \n+\t\t\t\techo '</div>';\n \t\t\t\techo '</form>';\n \n \t\t\t} else {\n@@ -138,7 +142,7 @@\n \t\t\tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \t\t\tprintf('<input type=\"hidden\" name=\"dn\" value=\"%s\" />',htmlspecialchars($request['dn']));\n \n-\t\t\techo '<table class=\"entry\" cellspacing=\"0\" align=\"center\" border=0>';\n+\t\t\techo '<table class=\"entry\" cellspacing=\"0\" align=\"center\" border=\"0\">';\n \n \t\t\tforeach ($request['template']->getAvailAttrs() as $attribute)\n \t\t\t\t$request['page']->draw('Template',$attribute);\n@@ -153,18 +157,18 @@\n \t\tprintf('<small>(%s)</small>',_('no new attributes available for this entry'));\n \t}\n \n-\techo '</center>';\n+\techo '</div>';\n \n # The ajax addition (it is going into an existing TemplateRendered page\n } else {\n \t# Put our DIV there for the callback\n \techo '<fieldset>';\n \tprintf('<legend>%s</legend>',_('Add Attribute'));\n \techo '<div id=\"ajADDATTR\">';\n-\techo '<table class=\"entry\" cellspacing=\"0\" align=\"center\" border=0>';\n+\techo '<table class=\"entry\" cellspacing=\"0\" align=\"center\" border=\"0\">';\n \techo '<td valign=\"top\" align=\"center\">';\n \n-\tprintf('<select name=\"attr\" onChange=\"ajDISPLAY(\\'%s\\',\\'cmd=add_value_form&server_id=%s&dn=%s&meth=ajax&attr=\\'+this.value,\\'%s\\',\\'append\\');\">',\n+\tprintf('<select name=\"attr\" onchange=\"ajDISPLAY(\\'%s\\',\\'cmd=add_value_form&server_id=%s&dn=%s&attr=\\'+this.value,\\'%s\\',\\'append\\');\">',\n \t\t'ADDATTR',$app['server']->getIndex(),rawurlencode(get_request('dn','REQUEST')),_('Please Wait'));\n \n \tprintf('<option value=\"%s\">%s</option>','','');"
            },
            {
                "sha": "9330ce163403c311a0549a8b64b66d016b1ec813",
                "filename": "htdocs/add_oclass_form.php",
                "status": "modified",
                "additions": 10,
                "deletions": 11,
                "changes": 21,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fadd_oclass_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fadd_oclass_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fadd_oclass_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -60,7 +60,7 @@\n \t$request['page']->drawTitle(sprintf('%s <b>%s</b>',_('Add new objectClass to'),get_rdn($request['dn'])));\n \t$request['page']->drawSubTitle();\n \n-\techo '<center>';\n+\techo '<div style=\"text-align: center\">';\n \tprintf('<small><b>%s: </b>%s <b>%s</b> %s %s</small>',\n \t\t_('Instructions'),\n \t\t_('In order to add these objectClass(es) to this entry, you must specify'),\n@@ -69,7 +69,8 @@\n \n \techo '<br /><br />';\n \n-\techo '<form action=\"cmd.php\" method=\"post\" name=\"entry_form\">';\n+\techo '<form action=\"cmd.php\" method=\"post\" id=\"entry_form\">';\n+\techo '<div>';\n \n \tif ($_SESSION[APPCONFIG]->getValue('confirm','update'))\n \t\techo '<input type=\"hidden\" name=\"cmd\" value=\"update_confirm\" />';\n@@ -78,27 +79,25 @@\n \n \tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \tprintf('<input type=\"hidden\" name=\"dn\" value=\"%s\" />',htmlspecialchars($request['dn']));\n+\techo '</div>';\n \n-\techo '<table class=\"entry\" cellspacing=\"0\">';\n+\techo '<table class=\"entry\" cellspacing=\"0\" border=\"0\" style=\"margin-left: auto; margin-right: auto;\">';\n \tprintf('<tr><th colspan=\"2\">%s</th></tr>',_('New Required Attributes'));\n \n \t$counter = 0;\n-\tforeach ($request['template']->getAttribute('objectclass')->getValues() as $value) {\n-\t\techo '<tr><td colspan=2>';\n+\techo '<tr><td colspan=\"2\">';\n+\tforeach ($request['template']->getAttribute('objectclass')->getValues() as $value)\n \t\t$request['page']->draw('HiddenValue',$request['template']->getAttribute('objectclass'),$counter++);\n-\t\techo '</td></tr>';\n-\t}\n+\techo '</td></tr>';\n \n \tforeach ($ldap['attrs']['need'] as $count => $attr)\n \t\t$request['page']->draw('Template',$attr);\n \n \techo '</table>';\n \n-\techo '<br />';\n-\n-\tprintf('<center><input type=\"submit\" value=\"%s\" /></center>',_('Add ObjectClass and Attributes'));\n+\tprintf('<div style=\"text-align: center;\"><br /><input type=\"submit\" value=\"%s\" /></div>',_('Add ObjectClass and Attributes'));\n \techo '</form>';\n-\techo '</center>';\n+\techo '</div>';\n \n # There are no other required attributes, so we just need to add the objectclass to the DN.\n } else {"
            },
            {
                "sha": "2100f6a6e1790d574bcaaee3665c1276417c08dd",
                "filename": "htdocs/add_value_form.php",
                "status": "modified",
                "additions": 12,
                "deletions": 12,
                "changes": 24,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fadd_value_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fadd_value_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fadd_value_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -38,11 +38,13 @@\n \t$request['page']->drawSubTitle();\n \n \tif (! strcasecmp($request['attr'],'objectclass')) {\n-\t\techo '<form action=\"cmd.php\" method=\"post\" class=\"new_value\" name=\"entry_form\">';\n+\t\techo '<form action=\"cmd.php\" method=\"post\" class=\"new_value\" id=\"entry_form\">';\n+\t\techo '<div>';\n \t\techo '<input type=\"hidden\" name=\"cmd\" value=\"add_oclass_form\" />';\n \n \t} else {\n-\t\techo '<form action=\"cmd.php\" method=\"post\" class=\"new_value\" name=\"entry_form\" enctype=\"multipart/form-data\" onSubmit=\"return submitForm(this)\">';\n+\t\techo '<form action=\"cmd.php\" method=\"post\" class=\"new_value\" id=\"entry_form\" enctype=\"multipart/form-data\" onsubmit=\"return submitForm(this)\">';\n+\t\techo '<div>';\n \t\tif ($_SESSION[APPCONFIG]->getValue('confirm','update'))\n \t\t\techo '<input type=\"hidden\" name=\"cmd\" value=\"update_confirm\" />';\n \t\telse\n@@ -51,9 +53,9 @@\n \n \tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \tprintf('<input type=\"hidden\" name=\"dn\" value=\"%s\" />',htmlspecialchars($request['dn']));\n+\techo '</div>';\n \n-\techo '<center>';\n-\techo '<table class=\"forminput\" border=0>';\n+\techo '<table class=\"forminput\" border=\"0\" style=\"margin-left: auto; margin-right: auto;\">';\n \techo '<tr>';\n \n \t$request['attribute'] = $request['template']->getAttribute($request['attr']);\n@@ -66,7 +68,7 @@\n \t\techo '<td>';\n \n \t\t# Display current attribute values\n-\t\techo '<table border=0><tr><td>';\n+\t\techo '<table border=\"0\"><tr><td>';\n \t\tfor ($i=0;$i<$request['count'];$i++) {\n \t\t\tif ($i > 0)\n \t\t\t\techo '<br/>';\n@@ -97,9 +99,9 @@\n \t\t\tunset($socs[strtolower($oclass)]);\n \n \t\t# Draw objectClass selection\n-\t\techo '<table border=0>';\n+\t\techo '<table border=\"0\">';\n \t\techo '<tr><td>';\n-\t\techo '<select name=\"new_values[objectclass][]\" multiple=\"true\" size=\"15\">';\n+\t\techo '<select name=\"new_values[objectclass][]\" multiple=\"multiple\" size=\"15\">';\n \t\tforeach ($socs as $name => $oclass) {\n \t\t\t# Exclude any structural ones, that are not in the heirachy, as they'll only generate an LDAP_OBJECT_CLASS_VIOLATION\n \t\t\tif (($oclass->getType() == 'structural') && ! $oclass->isRelated($request['attribute']->getValues()))\n@@ -117,16 +119,15 @@\n \t\techo '</tr>';\n \n \t\tif ($_SESSION[APPCONFIG]->getValue('appearance','show_hints'))\n-\t\t\tprintf('<tr><td colspan=2><small><br /><img src=\"%s/light.png\" alt=\"Hint\" /><span class=\"hint\">%s</span></small></td></tr>',\n+\t\t\tprintf('<tr><td colspan=\"2\"><small><br /><img src=\"%s/light.png\" alt=\"Hint\" /><span class=\"hint\">%s</span></small></td></tr>',\n \t\t\t\tIMGDIR,_('Note: You may be required to enter new attributes that these objectClass(es) require'));\n \n \t\techo '</table>';\n-\t\techo '</center>';\n \t\techo '</form>';\n \n \t} else {\n \t\t# Draw a blank field\n-\t\techo '<table border=0><tr><td>';\n+\t\techo '<table border=\"0\"><tr><td>';\n \t\t$request['page']->draw('FormValue',$request['attribute'],$request['count']);\n \t\techo '</td></tr><tr><td>';\n \n@@ -148,7 +149,6 @@\n \n \t\techo '</td></tr>';\n \t\techo '</table>';\n-\t\techo '</center>';\n \t\techo '</form>';\n \t}\n \n@@ -158,7 +158,7 @@\n \t\t$attribute = $request['template']->getAttribute($request['attr']);\n \t\t$attribute->show();\n \n-\t\techo '<table class=\"entry\" cellspacing=\"0\" align=\"center\" border=0>';\n+\t\techo '<table class=\"entry\" cellspacing=\"0\" align=\"center\" border=\"0\">';\n \t\t$request['page']->draw('Template',$attribute);\n \t\t$request['page']->draw('Javascript',$attribute);\n \t\techo '</table>';"
            },
            {
                "sha": "34f3848fe4a6d4c00c7c568afa81f59579f5d724",
                "filename": "htdocs/cmd.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcmd.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcmd.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fcmd.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -65,7 +65,7 @@\n # Refresh a frame - this is so that one frame can trigger another frame to be refreshed.\n if (isAjaxEnabled() && get_request('refresh','REQUEST') && get_request('refresh','REQUEST') != get_request('frame','REQUEST')) {\n \techo '<script type=\"text/javascript\" language=\"javascript\">';\n-\tprintf(\"ajDISPLAY('%s','cmd=refresh&server_id=%s&meth=ajax&noheader=%s','%s');\",\n+\tprintf(\"ajDISPLAY('%s','cmd=refresh&server_id=%s&noheader=%s','%s');\",\n \t\tget_request('refresh','REQUEST'),$app['server']->getIndex(),get_request('noheader','REQUEST',false,0),_('Auto refresh'));\n \techo '</script>';\n }"
            },
            {
                "sha": "47a80dbd5c44c153a86ecc1b70a7426afb6504f5",
                "filename": "htdocs/compare.php",
                "status": "modified",
                "additions": 19,
                "deletions": 18,
                "changes": 37,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcompare.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcompare.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fcompare.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -43,32 +43,34 @@\n \n echo '<br/>';\n \n-echo '<table class=\"entry\" width=100% border=0>';\n+echo '<table class=\"entry\" width=\"100%\" border=\"0\">';\n echo '<tr class=\"heading\">';\n \n $href = sprintf('cmd.php?cmd=template_engine&server_id=%s&dn=%s',\n \t$ldap['SRC']->getIndex(),rawurlencode($request['dnSRC']));\n-printf('<td colspan=2 width=40%%>%s: <b>%s</b><br />%s: <b><a href=\"%s\">%s</a></b></td>',\n+printf('<td colspan=\"2\" style=\"width: 40%%;\">%s: <b>%s</b><br />%s: <b><a href=\"%s\">%s</a></b></td>',\n \t_('Server'),$ldap['SRC']->getName(),_('Distinguished Name'),\n \thtmlspecialchars($href),$request['dnSRC']);\n \n $href = sprintf('cmd.php?cmd=template_engine&server_id=%s&dn=%s',\n \t$ldap['DST']->getIndex(),rawurlencode($request['dnDST']));\n-printf('<td colspan=2 width=40%%>%s: <b>%s</b><br />%s: <b><a href=\"%s\">%s</a></b></td>',\n+printf('<td colspan=\"2\" style=\"width: 40%%;\">%s: <b>%s</b><br />%s: <b><a href=\"%s\">%s</a></b></td>',\n \t_('Server'),$ldap['DST']->getName(),_('Distinguished Name'),\n \thtmlspecialchars($href),$request['dnDST']);\n \n echo '</tr>';\n \n echo '<tr>';\n-echo '<td colspan=4 align=right>';\n-echo '<form action=\"cmd.php?cmd=compare\" method=\"post\" name=\"compare_form\">';\n+echo '<td colspan=\"4\" style=\"text-align: right;\">';\n+echo '<form action=\"cmd.php?cmd=compare\" method=\"post\">';\n+echo '<div>';\n printf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n printf('<input type=\"hidden\" name=\"server_id_src\" value=\"%s\" />',$ldap['DST']->getIndex());\n printf('<input type=\"hidden\" name=\"server_id_dst\" value=\"%s\" />',$ldap['SRC']->getIndex());\n printf('<input type=\"hidden\" name=\"dn_src\" value=\"%s\" />',htmlspecialchars($request['dnDST']));\n printf('<input type=\"hidden\" name=\"dn_dst\" value=\"%s\" />',htmlspecialchars($request['dnSRC']));\n printf('<input type=\"submit\" value=\"%s\" />',_('Switch Entry'));\n+echo '</div>';\n echo '</form>';\n echo '</td>';\n echo '</tr>';\n@@ -110,13 +112,13 @@\n \t\t\t\t\t\techo '<td class=\"title\">&nbsp;</td>';\n \n \t\t\t\t\telse {\n-\t\t\t\t\t\techo '<td class=\"note\" align=\"right\">';\n+\t\t\t\t\t\techo '<td class=\"note\" style=\"text-align: right;\">';\n \t\t\t\t\t\t$request['pageSRC']->draw('Notes',$attributeSRC);\n \t\t\t\t\t\techo '</td>';\n \t\t\t\t\t}\n \n \t\t\t\t} else {\n-\t\t\t\t\techo '<td colspan=2>&nbsp;</td>';\n+\t\t\t\t\techo '<td colspan=\"2\">&nbsp;</td>';\n \t\t\t\t}\n \n \t\t\t\tbreak;\n@@ -132,12 +134,12 @@\n \t\t\t\t\t\techo '</td>';\n \t\t\t\t\t}\n \n-\t\t\t\t\techo '<td class=\"note\" align=\"right\">';\n+\t\t\t\t\techo '<td class=\"note\" style=\"text-align: right;\">';\n \t\t\t\t\t$request['pageDST']->draw('Notes',$attributeDST);\n \t\t\t\t\techo '</td>';\n \n \t\t\t\t} else {\n-\t\t\t\t\techo '<td colspan=2>&nbsp;</td>';\n+\t\t\t\t\techo '<td colspan=\"2\">&nbsp;</td>';\n \t\t\t\t}\n \n \t\t\t\tbreak;\n@@ -154,31 +156,30 @@\n \t\techo '<tr>';\n \n \tforeach (array('src','dst') as $side) {\n+\t\techo '<td class=\"value\" colspan=\"2\"><table border=\"0\">';\n+\t\techo '<tr><td>';\n+\n \t\tswitch ($side) {\n \t\t\tcase 'src':\n-\t\t\t\techo '<td class=\"value\" colspan=2><table border=0>';\n \n \t\t\t\tif ($attributeSRC && count($attributeSRC->getValues()))\n \t\t\t\t\t$request['pageSRC']->draw('CurrentValues',$attributeSRC);\n \t\t\t\telse\n-\t\t\t\t\techo '<tr><td>&nbsp;</td></tr>';\n-\n-\t\t\t\techo '</table></td>';\n+\t\t\t\t\techo '&nbsp;';\n \n \t\t\t\tbreak;\n \n \t\t\tcase 'dst':\n-\t\t\t\techo '<td class=\"value\" colspan=2><table>';\n-\n \t\t\t\tif ($attributeDST && count($attributeDST->getValues()))\n \t\t\t\t\t$request['pageDST']->draw('CurrentValues',$attributeDST);\n \t\t\t\telse\n-\t\t\t\t\techo '<tr><td>&nbsp;</td></tr>';\n-\n-\t\t\t\techo '</table></td>';\n+\t\t\t\t\techo '&nbsp;';\n \n \t\t\t\tbreak;\n \t\t}\n+\n+\t\techo '</td></tr>';\n+\t\techo '</table></td>';\n \t}\n \n \techo '</tr>';"
            },
            {
                "sha": "56962bd082f6c90318c7a1a96c42a7e860c8cc5b",
                "filename": "htdocs/compare_form.php",
                "status": "modified",
                "additions": 9,
                "deletions": 7,
                "changes": 16,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcompare_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcompare_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fcompare_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -28,36 +28,38 @@\n $request['page']->drawTitle(sprintf('%s <b>%s</b>',_('Compare another DN with'),get_rdn($request['dn'])));\n $request['page']->drawSubTitle();\n \n-printf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n-echo '<center>';\n+printf('<script type=\"text/javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n+echo '<div style=\"text-align: center;\">';\n printf('%s <b>%s</b> %s<br />',_('Compare'),get_rdn($request['dn']),_('with '));\n+echo '</div>';\n \n-echo '<form action=\"cmd.php\" method=\"post\" name=\"compare_form\">';\n+echo '<form action=\"cmd.php\" method=\"post\" id=\"compare_form\">';\n+echo '<div>';\n echo '<input type=\"hidden\" name=\"cmd\" value=\"compare\" />';\n printf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n printf('<input type=\"hidden\" name=\"server_id_src\" value=\"%s\" />',$app['server']->getIndex());\n printf('<input type=\"hidden\" name=\"dn_src\" value=\"%s\" />',htmlspecialchars($request['dn']));\n+echo '</div>';\n echo \"\\n\";\n \n-echo '<table style=\"border-spacing: 10px\">';\n+echo '<table border=\"0\" style=\"border-spacing: 10px; margin-left: auto; margin-right: auto;\">';\n \n echo '<tr>';\n printf('<td><acronym title=\"%s\">%s</acronym>:</td>',\n \t_('Compare this DN with another'),_('Destination DN'));\n echo '<td>';\n echo '<input type=\"text\" name=\"dn_dst\" size=\"45\" value=\"\" />';\n-draw_chooser_link('compare_form.dn_dst','true','');\n+draw_chooser_link('compare_form','dn_dst','true','');\n echo '</td>';\n echo '</tr>';\n echo \"\\n\";\n \n printf('<tr><td>%s:</td><td>%s</td></tr>',_('Destination Server'),server_select_list($app['server']->getIndex(),true,'server_id_dst'));\n echo \"\\n\";\n \n-printf('<tr><td colspan=\"2\" align=\"right\"><input type=\"submit\" value=\"%s\" /></td></tr>',_('Compare'));\n+printf('<tr><td colspan=\"2\" style=\"text-align: center;\"><input type=\"submit\" value=\"%s\" /></td></tr>',_('Compare'));\n echo \"\\n\";\n \n echo '</table>';\n echo '</form>';\n-echo '</center>';\n ?>"
            },
            {
                "sha": "749b78ecd67786c7ef3f7daf6b7edca981a04ca7",
                "filename": "htdocs/copy_form.php",
                "status": "modified",
                "additions": 12,
                "deletions": 10,
                "changes": 22,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcopy_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcopy_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fcopy_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -27,25 +27,28 @@\n $request['page']->drawTitle(sprintf('%s <b>%s</b>',_('Copy'),get_rdn($request['dn'])));\n $request['page']->drawSubTitle();\n \n-printf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n-echo '<center>';\n+printf('<script type=\"text/javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n+echo '<div style=\"text-align: center;\">';\n printf('%s <b>%s</b> %s:<br /><br />',_('Copy'),get_rdn($request['dn']),_('to a new object'));\n+echo '</div>';\n \n-echo '<form action=\"cmd.php\" method=\"post\" name=\"copy_form\">';\n+echo '<form action=\"cmd.php\" method=\"post\" id=\"copy_form\">';\n+echo '<div>';\n echo '<input type=\"hidden\" name=\"cmd\" value=\"copy\" />';\n printf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n printf('<input type=\"hidden\" name=\"server_id_src\" value=\"%s\" />',$app['server']->getIndex());\n printf('<input type=\"hidden\" name=\"dn_src\" value=\"%s\" />',htmlspecialchars($request['dn']));\n+echo '</div>';\n echo \"\\n\";\n \n-echo '<table style=\"border-spacing: 10px\">';\n+echo '<table border=\"0\" style=\"border-spacing: 10px; margin-left: auto; margin-right: auto;\">';\n \n echo '<tr>';\n printf('<td><acronym title=\"%s\">%s</acronym>:</td>',\n \t_('The full DN of the new entry to be created when copying the source entry'),_('Destination DN'));\n echo '<td>';\n printf('<input type=\"text\" name=\"dn_dst\" size=\"45\" value=\"%s\" />',htmlspecialchars($request['dn']));\n-draw_chooser_link('copy_form.dn_dst','true',get_rdn($request['dn']));\n+draw_chooser_link('copy_form','dn_dst','true',get_rdn($request['dn']));\n echo '</td>';\n echo '</tr>';\n echo \"\\n\";\n@@ -59,7 +62,7 @@\n if (count($request['children']) > 0) {\n \techo '<tr>';\n \tprintf('<td><label for=\"recursive\">%s</label>:</td>',_('Recursive copy'));\n-\techo '<td><input type=\"checkbox\" id=\"recursive\" name=\"recursive\" onClick=\"copy_field_toggle(this)\" />';\n+\techo '<td><input type=\"checkbox\" id=\"recursive\" name=\"recursive\" onclick=\"copy_field_toggle(this)\" />';\n \tprintf('<small>(%s)</small></td>',_('Recursively copy all children of this object as well.'));\n \techo '</tr>';\n \techo \"\\n\";\n@@ -83,19 +86,18 @@\n }\n echo \"\\n\";\n \n-printf('<tr><td colspan=\"2\" align=\"right\"><input type=\"submit\" value=\"%s\" /></td></tr>',_('Copy '));\n+printf('<tr><td colspan=\"2\" style=\"text-align: center;\"><input type=\"submit\" value=\"%s\" /></td></tr>',_('Copy '));\n echo \"\\n\";\n \n echo '</table>';\n echo '</form>';\n \n if ($_SESSION[APPCONFIG]->getValue('appearance','show_hints'))\n-\tprintf('<small><img src=\"%s/light.png\" alt=\"Light\" /><span class=\"hint\">%s</span></small>',\n+\tprintf('<div style=\"text-align: center;\"><small><img src=\"%s/light.png\" alt=\"Light\" /><span class=\"hint\">%s</span></small></div>',\n \t\tIMGDIR,_('Hint: Copying between different servers only works if there are no schema violations'));\n \n-echo '</center>';\n \n # Draw the javascrpt to enable/disable the filter field if this may be a recursive copy\n if (count($request['children']) > 0)\n-\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sform_field_toggle_enable.js\"></script>',JSDIR);\n+\tprintf('<script type=\"text/javascript\" src=\"%sform_field_toggle_enable.js\"></script>',JSDIR);\n ?>"
            },
            {
                "sha": "cfff1f9c59f972d1e908ace5c5fbe958567a66e3",
                "filename": "htdocs/create_confirm.php",
                "status": "modified",
                "additions": 10,
                "deletions": 7,
                "changes": 17,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcreate_confirm.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fcreate_confirm.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fcreate_confirm.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -54,12 +54,14 @@\n \n # Confirm the creation\n if (count($request['template']->getLDAPadd(true))) {\n-\techo '<center>';\n+\techo '<div style=\"text-align: center;\">';\n \techo _('Do you want to create this entry?');\n \techo '<br /><br />';\n+\techo '</div>';\n \n \techo \"\\n\\n\";\n \techo '<form action=\"cmd.php\" method=\"post\">';\n+\techo '<div>';\n \techo '<input type=\"hidden\" name=\"cmd\" value=\"create\" />';\n \tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \tprintf('<input type=\"hidden\" name=\"container\" value=\"%s\" />',htmlspecialchars($request['template']->getContainer()));\n@@ -69,16 +71,17 @@\n \techo \"\\n\";\n \n \t$request['page']->drawHiddenAttributes();\n+\techo '</div>';\n \n-\techo '<table class=\"result_table\">';\n+\techo '<table class=\"result_table\" style=\"margin-left: auto; margin-right: auto;\">';\n \techo \"\\n\";\n \n \tprintf('<tr class=\"heading\"><td>%s</td><td>%s</td><td>%s</td></tr>',\n \t\t_('Attribute'),_('New Value'),_('Skip'));\n \techo \"\\n\\n\";\n \n \t$counter = 0;\n-\tprintf('<tr class=\"%s\"><td colspan=3><center><b>%s</b></center></td><tr>',$counter%2 ? 'even' : 'odd',$request['template']->getDN());\n+\tprintf('<tr class=\"%s\"><td colspan=\"3\" style=\"text-align: center;\"><b>%s</b></td></tr>',$counter%2 ? 'even' : 'odd',$request['template']->getDN());\n \n \tforeach ($request['template']->getLDAPadd(true) as $attribute) {\n \t\t$counter++;\n@@ -106,21 +109,21 @@\n \n \techo '</table>';\n \n+\techo '<div style=\"text-align: center;\">';\n \techo '<br />';\n \tprintf('<input type=\"submit\" value=\"%s\" />',_('Commit'));\n \tprintf('<input type=\"submit\" name=\"cancel\" value=\"%s\" />',_('Cancel'));\n+\techo '</div>';\n \techo '</form>';\n \techo '<br />';\n \n-\techo '</center>';\n-\n } else {\n-\techo '<center>';\n+\techo '<div style=\"text-align: center;\">';\n \techo _('You made no changes');\n \t$href = sprintf('cmd.php?cmd=template_engine&server_id=%s&dn=%s',\n \t\t$app['server']->getIndex(),rawurlencode($request['dn']));\n \n \tprintf(' <a href=\"%s\">%s</a>.',htmlspecialchars($href),_('Go back'));\n-\techo '</center>';\n+\techo '</div>';\n }\n ?>"
            },
            {
                "sha": "ecffa9bdaf123f814ec17574527759ad25730cc7",
                "filename": "htdocs/delete_form.php",
                "status": "modified",
                "additions": 20,
                "deletions": 20,
                "changes": 40,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fdelete_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fdelete_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fdelete_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -46,43 +46,43 @@\n \t$query['deref'] = LDAP_DEREF_NEVER;\n \t$request['search'] = $app['server']->query($query,null);\n \n-\techo '<table class=\"forminput\" border=0>';\n+\techo '<table class=\"forminput\" border=\"0\">';\n \techo '<tr>';\n-\techo '<td colspan=2>';\n+\techo '<td colspan=\"2\">';\n \tprintf(_('This entry is the root of a sub-tree containing %s entries.'),count($request['search']));\n \tprintf(' <small>(<a href=\"%s\">%s</a>)</small>',\n \t\t$search['href'],_('view entries'));\n \techo '</td></tr>';\n \n-\techo '<tr><td colspan=2>&nbsp;</td></tr>';\n+\techo '<tr><td colspan=\"2\">&nbsp;</td></tr>';\n \n-\tprintf('<tr><td colspan=2>%s</td></tr>',\n+\tprintf('<tr><td colspan=\"2\">%s</td></tr>',\n \t\tsprintf(_('phpLDAPadmin can recursively delete this entry and all %s of its children. See below for a list of all the entries that this action will delete. Do you want to do this?'),count($request['search'])));\n \n-\techo '<tr><td colspan=2>&nbsp;</td></tr>';\n+\techo '<tr><td colspan=\"2\">&nbsp;</td></tr>';\n \n-\tprintf('<tr><td colspan=2><small>%s</small></td></tr>',\n+\tprintf('<tr><td colspan=\"2\"><small>%s</small></td></tr>',\n \t\t_('Note: this is potentially very dangerous and you do this at your own risk. This operation cannot be undone. Take into consideration aliases, referrals, and other things that may cause problems.'));\n \techo \"\\n\";\n \n \techo '<tr>';\n-\techo '<td width=50%><center>';\n+\techo '<td style=\"width: 50%; text-align: center;\">';\n \techo '<form action=\"cmd.php\" method=\"post\">';\n \techo '<input type=\"hidden\" name=\"cmd\" value=\"rdelete\" />';\n \tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \tprintf('<input type=\"hidden\" name=\"dn\" value=\"%s\" />',htmlspecialchars($request['dn']));\n \tprintf('<input type=\"submit\" value=\"%s\" />',sprintf(_('Delete all %s objects'),count($request['search'])));\n \techo '</form>';\n-\techo '</center></td>';\n+\techo '</td>';\n \n-\techo '<td width=50%><center>';\n+\techo '<td style=\"width: 50%; text-align: center;\">';\n \techo '<form action=\"cmd.php\" method=\"get\">';\n \techo '<input type=\"hidden\" name=\"cmd\" value=\"template_engine\" />';\n \tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \tprintf('<input type=\"hidden\" name=\"dn\" value=\"%s\" />',htmlspecialchars($request['dn']));\n \tprintf('<input type=\"submit\" name=\"submit\" value=\"%s\" />',_('Cancel'));\n \techo '</form>';\n-\techo '</center></td>';\n+\techo '</td>';\n \techo '</tr>';\n \techo \"\\n\";\n \n@@ -101,28 +101,28 @@\n \techo \"\\n\";\n \n } else {\n-\techo '<table class=\"forminput\" border=0>';\n+\techo '<table class=\"forminput\" border=\"0\">';\n \n-\tprintf('<tr><td colspan=4>%s</td></tr>',_('Are you sure you want to permanently delete this object?'));\n-\techo '<tr><td colspan=4>&nbsp;</td></tr>';\n+\tprintf('<tr><td colspan=\"4\">%s</td></tr>',_('Are you sure you want to permanently delete this object?'));\n+\techo '<tr><td colspan=\"4\">&nbsp;</td></tr>';\n \n-\tprintf('<tr><td width=10%%>%s:</td><td colspan=3 width=75%%><b>%s</b></td></tr>',_('Server'),$app['server']->getName());\n-\tprintf('<tr><td width=10%%><acronym title=\"%s\">%s</acronym></td><td colspan=3 width=75%%><b>%s</b></td></tr>',\n+\tprintf('<tr><td style=\"width: 10%%;\">%s:</td><td colspan=\"3\" style=\"width: 75%%;\"><b>%s</b></td></tr>',_('Server'),$app['server']->getName());\n+\tprintf('<tr><td style=\"width: 10%%;\"><acronym title=\"%s\">%s</acronym></td><td colspan=\"3\" style=\"width: 75%%;\"><b>%s</b></td></tr>',\n \t\t_('Distinguished Name'),_('DN'),$request['dn']);\n-\techo '<tr><td colspan=4>&nbsp;</td></tr>';\n+\techo '<tr><td colspan=\"4\">&nbsp;</td></tr>';\n \techo \"\\n\";\n \n \techo '<tr>';\n-\techo '<td colspan=2 width=50%><center>';\n+\techo '<td colspan=\"2\" style=\"width: 50%; text-align: center;\">';\n \techo '<form action=\"cmd.php\" method=\"post\">';\n \techo '<input type=\"hidden\" name=\"cmd\" value=\"delete\" />';\n \tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \tprintf('<input type=\"hidden\" name=\"dn\" value=\"%s\" />',htmlspecialchars($request['dn']));\n \tprintf('<input type=\"submit\" name=\"submit\" value=\"%s\" />',_('Delete'));\n \techo '</form>';\n \n-\techo '</center></td>';\n-\techo '<td colspan=2 width=50%><center>';\n+\techo '</td>';\n+\techo '<td colspan=\"2\" style=\"width: 50%; text-align: center;\">';\n \n \techo '<form action=\"cmd.php\" method=\"get\">';\n \techo '<input type=\"hidden\" name=\"cmd\" value=\"template_engine\" />';\n@@ -131,7 +131,7 @@\n \tprintf('<input type=\"submit\" name=\"submit\" value=\"%s\" />',_('Cancel'));\n \techo '</form>';\n \n-\techo '</center></td>';\n+\techo '</td>';\n \techo '</tr>';\n \techo '</table>';\n \techo \"\\n\";"
            },
            {
                "sha": "1ca8795cd0013be3248f8c237771aae420e98fa2",
                "filename": "htdocs/entry_chooser.php",
                "status": "modified",
                "additions": 25,
                "deletions": 23,
                "changes": 48,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fentry_chooser.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fentry_chooser.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fentry_chooser.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -15,24 +15,26 @@\n \n $request = array();\n $request['container'] = get_request('container','GET');\n-$request['element'] = get_request('form_element','GET');\n+$request['form'] = get_request('form','GET');\n+$request['element'] = get_request('element','GET');\n $request['rdn'] = get_request('rdn','GET');\n \n echo '<div class=\"popup\">';\n printf('<h3 class=\"subtitle\">%s</h3>',_('Entry Chooser'));\n \n-echo '<script type=\"text/javascript\" language=\"javascript\">';\n+echo '<script type=\"text/javascript\">';\n echo '\tfunction returnDN(dn) {';\n-printf('\topener.document.%s.value = dn;',$request['element']);\n-echo '\tclose();';\n+printf(\"\teval ('o = opener.document.getElementById(\\\"%s\\\").%s;');\",$request['form'],$request['element']);\n+echo '\t\to.value = dn;';\n+echo '\t\tclose();';\n echo '\t}';\n echo '</script>';\n \n-echo '<table class=\"forminput\" width=100% border=0>';\n+echo '<table class=\"forminput\" width=\"100%\" border=\"0\">';\n if ($request['container']) {\n-\tprintf('<tr><td class=\"heading\" colspan=3>%s:</td><td>%s</td></tr>',_('Server'),$app['server']->getName());\n-\tprintf('<tr><td class=\"heading\" colspan=3>%s:</td><td>%s</td></tr>',_('Looking in'),$request['container']);\n-\techo '<tr><td class=\"blank\" colspan=4>&nbsp;</td></tr>';\n+\tprintf('<tr><td class=\"heading\" colspan=\"3\">%s:</td><td>%s</td></tr>',_('Server'),$app['server']->getName());\n+\tprintf('<tr><td class=\"heading\" colspan=\"3\">%s:</td><td>%s</td></tr>',_('Looking in'),$request['container']);\n+\techo '<tr><td class=\"blank\" colspan=\"4\">&nbsp;</td></tr>';\n }\n \n # Has the user already begun to descend into a specific server tree?\n@@ -47,36 +49,36 @@\n \n \t\tif (! pla_compare_dns($request['container'],$base)) {\n \t\t\t$parent_container = false;\n-\t\t\t$href['up'] = sprintf('entry_chooser.php?form_element=%s&rdn=%s',$request['element'],rawurlencode($request['rdn']));\n+\t\t\t$href['up'] = sprintf('entry_chooser.php?form=%s&element=%s&rdn=%s',$request['form'],$request['element'],rawurlencode($request['rdn']));\n \t\t\tbreak;\n \n \t\t} else {\n \t\t\t$parent_container = $app['server']->getContainer($request['container']);\n-\t\t\t$href['up'] = sprintf('entry_chooser.php?form_element=%s&rdn=%s&server_id=%s&container=%s',\n-\t\t\t\t$request['element'],$request['rdn'],$app['server']->getIndex(),rawurlencode($parent_container));\n+\t\t\t$href['up'] = sprintf('entry_chooser.php?form=%s&element=%s&rdn=%s&server_id=%s&container=%s',\n+\t\t\t\t$request['form'],$request['element'],$request['rdn'],$app['server']->getIndex(),rawurlencode($parent_container));\n \t\t}\n \t}\n \n \techo '<tr>';\n \techo '<td class=\"blank\">&nbsp;</td>';\n \tprintf('<td class=\"icon\"><a href=\"%s\"><img src=\"%s/up.png\" alt=\"Up\" /></a></td>',$href['up'],IMGDIR);\n-\tprintf('<td colspan=2><a href=\"%s\">%s...</a></td>',$href['up'],_('Back Up'));\n+\tprintf('<td colspan=\"2\"><a href=\"%s\">%s...</a></td>',$href['up'],_('Back Up'));\n \techo '</tr>';\n \n \tif (! count($request['children']))\n-\t\tprintf('<td class=\"blank\" colspan=2>&nbsp;</td><td colspan=2\">(%s)</td>',_('no entries'));\n+\t\tprintf('<td class=\"blank\" colspan=\"2\">&nbsp;</td><td colspan=\"2\">(%s)</td>',_('no entries'));\n \n \telse\n \t\tforeach ($request['children'] as $dn) {\n \t\t\t$href['return'] = sprintf(\"javascript:returnDN('%s%s')\",($request['rdn'] ? sprintf('%s,',$request['rdn']) : ''),rawurlencode($dn));\n-\t\t\t$href['expand'] = sprintf('entry_chooser.php?server_id=%s&form_element=%s&rdn=%s&container=%s',\n-\t\t\t\t$app['server']->getIndex(),$request['element'],$request['rdn'],rawurlencode($dn));\n+\t\t\t$href['expand'] = sprintf('entry_chooser.php?server_id=%s&form=%s&element=%s&rdn=%s&container=%s',\n+\t\t\t\t$app['server']->getIndex(),$request['form'],$request['element'],$request['rdn'],rawurlencode($dn));\n \n \t\t\techo '<tr>';\n \t\t\techo '<td class=\"blank\">&nbsp;</td>';\n \t\t\tprintf('<td class=\"icon\"><a href=\"%s\"><img src=\"%s/plus.png\" alt=\"Plus\" /></a></td>',$href['expand'],IMGDIR);\n \n-\t\t\tprintf('<td colspan=2><a href=\"%s\">%s</a></td>',$href['return'],$dn);\n+\t\t\tprintf('<td colspan=\"2\"><a href=\"%s\">%s</a></td>',$href['return'],$dn);\n \t\t\techo '</tr>';\n \t\t\techo \"\\n\\n\";\n \t\t}\n@@ -85,24 +87,24 @@\n } else {\n \tforeach ($_SESSION[APPCONFIG]->getServerList() as $index => $server) {\n \t\tif ($server->isLoggedIn(null)) {\n-\t\t\tprintf('<tr><td class=\"heading\" colspan=3>%s:</td><td class=\"heading\">%s</td></tr>',_('Server'),$server->getName());\n+\t\t\tprintf('<tr><td class=\"heading\" colspan=\"3\">%s:</td><td class=\"heading\">%s</td></tr>',_('Server'),$server->getName());\n \t\t\tforeach ($server->getBaseDN() as $dn) {\n \t\t\t\tif (! $dn) {\n-\t\t\t\t\tprintf('<tr><td class=\"blank\">&nbsp;</td><td colspan=3>(%s)</td></tr>',_('Could not determine base DN'));\n+\t\t\t\t\tprintf('<tr><td class=\"blank\">&nbsp;</td><td colspan=\"3\">(%s)</td></tr>',_('Could not determine base DN'));\n \n \t\t\t\t} else {\n \t\t\t\t\t$href['return'] = sprintf(\"javascript:returnDN('%s%s')\",($request['rdn'] ? sprintf('%s,',$request['rdn']) : ''),rawurlencode($dn));\n-\t\t\t\t\t$href['expand'] = htmlspecialchars(sprintf('entry_chooser.php?server_id=%s&form_element=%s&rdn=%s&container=%s',\n-\t\t\t\t\t\t\t$server->getIndex(),$request['element'],$request['rdn'],rawurlencode($dn)));\n+\t\t\t\t\t$href['expand'] = htmlspecialchars(sprintf('entry_chooser.php?server_id=%s&form=%s&element=%s&rdn=%s&container=%s',\n+\t\t\t\t\t\t\t$server->getIndex(),$request['form'],$request['element'],$request['rdn'],rawurlencode($dn)));\n \n \t\t\t\t\techo '<tr>';\n \t\t\t\t\techo '<td class=\"blank\">&nbsp;</td>';\n-\t\t\t\t\tprintf('<td colspan=2 class=\"icon\"><a href=\"%s\"><img src=\"%s/plus.png\" alt=\"Plus\" /></a></td>',$href['expand'],IMGDIR);\n-\t\t\t\t\tprintf('<td colspan=2><a href=\"%s\">%s</a></td>',$href['return'],$dn);\n+\t\t\t\t\tprintf('<td colspan=\"2\" class=\"icon\"><a href=\"%s\"><img src=\"%s/plus.png\" alt=\"Plus\" /></a></td>',$href['expand'],IMGDIR);\n+\t\t\t\t\tprintf('<td colspan=\"2\"><a href=\"%s\">%s</a></td>',$href['return'],$dn);\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\techo '<tr><td class=\"blank\" colspan=4>&nbsp;</td></tr>';\n+\t\t\techo '<tr><td class=\"blank\" colspan=\"4\">&nbsp;</td></tr>';\n \t\t}\n \t}\n }"
            },
            {
                "sha": "326184e7f0d2b6fcc19afcbe51c8ad0ac3e5c86d",
                "filename": "htdocs/export_form.php",
                "status": "modified",
                "additions": 14,
                "deletions": 14,
                "changes": 28,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fexport_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fexport_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fexport_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -36,16 +36,16 @@\n $request['page'] = new PageRender($app['server']->getIndex(),get_request('template','REQUEST',false,'none'));\n $request['page']->drawTitle(sprintf('<b>%s</b>',_('Export')));\n \n-printf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n-printf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sform_field_toggle_enable.js\"></script>',JSDIR);\n+printf('<script type=\"text/javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n+printf('<script type=\"text/javascript\" src=\"%sform_field_toggle_enable.js\"></script>',JSDIR);\n \n echo '<br />';\n-echo '<center>';\n-echo '<form name=\"export_form\" action=\"cmd.php\" method=\"post\">';\n+echo '<form id=\"export_form\" action=\"cmd.php\" method=\"post\">';\n+echo '<div>';\n echo '<input type=\"hidden\" name=\"cmd\" value=\"export\" />';\n printf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \n-echo '<table class=\"forminput\">';\n+echo '<table class=\"forminput\" style=\"margin-left: auto; margin-right: auto;\">';\n echo '<tr>';\n echo '<td>';\n \n@@ -59,7 +59,7 @@\n printf('<td style=\"white-space:nowrap\">%s</td>',_('Base DN'));\n echo '<td><span style=\"white-space: nowrap;\">';\n printf('<input type=\"text\" name=\"dn\" id=\"dn\" style=\"width:230px\" value=\"%s\" />&nbsp;',htmlspecialchars($request['dn']));\n-draw_chooser_link('export_form.dn');\n+draw_chooser_link('export_form','dn');\n echo '</span></td>';\n echo '</tr>';\n \n@@ -70,7 +70,7 @@\n \n foreach ($available_scopes as $id => $desc)\n \tprintf('<input type=\"radio\" name=\"scope\" value=\"%s\" id=\"%s\"%s /><label for=\"%s\">%s</label><br />',\n-\t\thtmlspecialchars($id),$id,($id == $request['scope']) ? 'checked=\"true\"' : '',\n+\t\thtmlspecialchars($id),$id,($id == $request['scope']) ? 'checked=\"checked\"' : '',\n \t\thtmlspecialchars($id),$desc);\n \n echo '</td>';\n@@ -84,12 +84,12 @@\n \t_('Show Attributtes'),htmlspecialchars($request['attr']));\n \n printf('<tr><td>&nbsp;</td><td><input type=\"checkbox\" name=\"sys_attr\" id=\"sys_attr\" %s/> <label for=\"sys_attr\">%s</label></td></tr>',\n-\t$request['sys_attr'] ? 'checked=\"true\" ' : '',_('Include system attributes'));\n+\t$request['sys_attr'] ? 'checked=\"checked\" ' : '',_('Include system attributes'));\n \n printf('<tr><td>&nbsp;</td><td><input type=\"checkbox\" id=\"save_as_file\" name=\"save_as_file\" onclick=\"export_field_toggle(this)\" /> <label for=\"save_as_file\">%s</label></td></tr>',\n \t_('Save as file'));\n \n-printf('<tr><td>&nbsp;</td><td><input type=\"checkbox\" id=\"compress\" name=\"compress\" disabled /> <label for=\"compress\">%s</label></td></tr>',\n+printf('<tr><td>&nbsp;</td><td><input type=\"checkbox\" id=\"compress\" name=\"compress\" disabled=\"disabled\" /> <label for=\"compress\">%s</label></td></tr>',\n \t_('Compress'));\n \n echo '</table>';\n@@ -109,9 +109,9 @@\n \n foreach (Exporter::types() as $index => $exporter) {\n \tprintf('<input type=\"radio\" name=\"exporter_id\" id=\"exporter_id_%s\" value=\"%s\"%s/>',\n-\t\thtmlspecialchars($exporter['type']),htmlspecialchars($exporter['type']),($exporter['type'] === $request['exporter_id']) ? ' checked=\"true\"' : '');\n+\t\thtmlspecialchars($exporter['type']),htmlspecialchars($exporter['type']),($exporter['type'] === $request['exporter_id']) ? ' checked=\"checked\"' : '');\n \n-\tprintf('<label for=\"%s\">%s</label><br />',\n+\tprintf('<label for=\"exporter_id_%s\">%s</label><br />',\n \t\thtmlspecialchars($exporter['type']),$exporter['type']);\n }\n \n@@ -124,7 +124,7 @@\n printf('<legend>%s</legend>',_('Line ends'));\n foreach ($available_formats as $id => $desc)\n \tprintf('<input type=\"radio\" name=\"format\" value=\"%s\" id=\"%s\"%s /><label for=\"%s\">%s</label><br />',\n-\t\thtmlspecialchars($id),htmlspecialchars($id),($request['format']==$id) ? ' checked=\"true\"' : '',\n+\t\thtmlspecialchars($id),htmlspecialchars($id),($request['format']==$id) ? ' checked=\"checked\"' : '',\n \t\thtmlspecialchars($id),$desc);\n \n echo '</fieldset>';\n@@ -134,13 +134,13 @@\n \n echo '</tr>';\n \n-printf('<tr><td colspan=\"2\"><center><input type=\"submit\" name=\"target\" value=\"%s\" /></center></td></tr>',\n+printf('<tr><td colspan=\"2\" style=\"text-align: center;\"><input type=\"submit\" name=\"target\" value=\"%s\" /></td></tr>',\n \thtmlspecialchars(_('Proceed >>')));\n \n echo '</table>';\n \n+echo '</div>';\n echo '</form>';\n-echo '</center>';\n \n /**\n  * Helper function for fetching the line end format."
            },
            {
                "sha": "9c6bbbb6b35aa2bc49e2687f8b86cd3de578d021",
                "filename": "htdocs/import_form.php",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fimport_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fimport_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fimport_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -19,14 +19,15 @@\n $request['page']->drawTitle(sprintf('<b>%s</b>',_('Import')));\n $request['page']->drawSubTitle(sprintf('%s: <b>%s</b>',_('Server'),$app['server']->getName()));\n \n-echo '<center>';\n echo '<form action=\"cmd.php\" method=\"post\" class=\"new_value\" enctype=\"multipart/form-data\">';\n+echo '<div>';\n printf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n echo '<input type=\"hidden\" name=\"cmd\" value=\"import\" />';\n+echo '</div>';\n \n-echo '<table class=\"forminput\" border=0>';\n+echo '<table class=\"forminput\" border=\"0\" style=\"margin-left: auto; margin-right: auto;\">';\n \n-echo '<tr><td colspan=2>&nbsp;</td></tr>';\n+echo '<tr><td colspan=\"2\">&nbsp;</td></tr>';\n echo '<tr>';\n printf('<td>%s</td>',_('Select an LDIF file'));\n echo '<td>';\n@@ -35,14 +36,13 @@\n \n printf('<tr><td>&nbsp;</td><td class=\"small\"><b>%s %s</b></td></tr>',_('Maximum file size'),ini_get('upload_max_filesize'));\n \n-echo '<tr><td colspan=2>&nbsp;</td></tr>';\n+echo '<tr><td colspan=\"2\">&nbsp;</td></tr>';\n printf('<tr><td>%s</td></tr>',_('Or paste your LDIF here'));\n-echo '<tr><td colspan=2><textarea name=\"ldif\" rows=\"20\" cols=\"100\"></textarea></td></tr>';\n-echo '<tr><td colspan=2>&nbsp;</td></tr>';\n+echo '<tr><td colspan=\"2\"><textarea name=\"ldif\" rows=\"20\" cols=\"100\"></textarea></td></tr>';\n+echo '<tr><td colspan=\"2\">&nbsp;</td></tr>';\n printf('<tr><td>&nbsp;</td><td class=\"small\"><input type=\"checkbox\" name=\"continuous_mode\" value=\"1\" />%s</td></tr>',\n \t_(\"Don't stop on errors\"));\n printf('<tr><td>&nbsp;</td><td><input type=\"submit\" value=\"%s\" /></td></tr>',_('Proceed >>'));\n echo '</table>';\n echo '</form>';\n-echo '</center>';\n ?>"
            },
            {
                "sha": "d95b48ad7622e1408c70ca2246a623e9a4852ee4",
                "filename": "htdocs/js/dnChooserPopup.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fjs%2FdnChooserPopup.js",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fjs%2FdnChooserPopup.js",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fjs%2FdnChooserPopup.js?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -1,6 +1,6 @@\n-function dnChooserPopup(form_element,rdn)\n+function dnChooserPopup(form,element,rdn)\n {\n \tmywindow=open('entry_chooser.php','myname','resizable=no,width=600,height=370,scrollbars=1');\n-\tmywindow.location.href = 'entry_chooser.php?form_element=' + form_element + '&rdn=' + rdn;\n+\tmywindow.location.href = 'entry_chooser.php?form=' + form + '&element=' + element + '&rdn=' + rdn;\n \tif (mywindow.opener == null) mywindow.opener = self;\n }"
            },
            {
                "sha": "a601ccb7bcc5ab64aae8dd5598a14da7498689c5",
                "filename": "htdocs/js/modify_member.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fjs%2Fmodify_member.js",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fjs%2Fmodify_member.js",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fjs%2Fmodify_member.js?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -1,5 +1,5 @@\n-var m1 = document.member.notmembers;\n-var m2 = document.member.members;\n+var m1 = document.getElementById('member').notmembers;\n+var m2 = document.getElementById('member').members;\n \n /* This function generates hidden input array from new group members\n  * when submit button is pressed."
            },
            {
                "sha": "ae70deda2f162b2d1ab72df7a533942db21074a0",
                "filename": "htdocs/login_form.php",
                "status": "modified",
                "additions": 12,
                "deletions": 13,
                "changes": 25,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Flogin_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Flogin_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Flogin_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -17,13 +17,11 @@\n \n # Check for a secure connection\n if (! isset($_SERVER['HTTPS']) || strtolower($_SERVER['HTTPS']) != 'on') {\n-\techo '<center>';\n-\techo '<span style=\"color:red\">';\n+\techo '<div style=\"text-align: center; color:red\">';\n \tprintf('<acronym title=\"%s\"><b>%s: %s.</b></acronym>',\n \t\t_('You are not using \\'https\\'. Web browser will transmit login information in clear text.'),\n \t\t_('Warning'),_('This web connection is unencrypted'));\n-\techo '</span>';\n-\techo '</center>';\n+\techo '</div>';\n \n \techo '<br />';\n }\n@@ -54,15 +52,17 @@\n \n # HTML Login Form\n } else {\n-\techo '<form action=\"cmd.php\" method=\"post\" name=\"login_form\">';\n+\techo '<form action=\"cmd.php\" method=\"post\">';\n+\techo '<div>';\n \techo '<input type=\"hidden\" name=\"cmd\" value=\"login\" />';\n \tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \n \tif (get_request('redirect','GET',false,false))\n \t\tprintf('<input type=\"hidden\" name=\"redirect\" value=\"%s\" />',rawurlencode(get_request('redirect','GET')));\n \n-\techo '<center>';\n-\techo '<table class=\"forminput\">';\n+\techo '</div>';\n+\n+\techo '<table class=\"forminput\" style=\"margin-left: auto; margin-right: auto;\">';\n \n \tprintf('<tr><td><b>%s:</b></td></tr>',\n \t\t$app['server']->getValue('login','auth_text') ? $app['server']->getValue('login','auth_text') :\n@@ -71,28 +71,27 @@\n \tprintf('<tr><td><input type=\"text\" id=\"login\" name=\"login\" size=\"40\" value=\"%s\" /></td></tr>',\n \t\t$app['server']->getValue('login','attr',false) == 'dn' ? $app['server']->getValue('login','bind_id') : '');\n \n-\techo '<tr><td colspan=2>&nbsp;</td></tr>';\n+\techo '<tr><td colspan=\"2\">&nbsp;</td></tr>';\n \tprintf('<tr><td><b>%s:</b></td></tr>',_('Password'));\n \techo '<tr><td><input type=\"password\" id=\"password\" size=\"40\" value=\"\" name=\"login_pass\" /></td></tr>';\n-\techo '<tr><td colspan=2>&nbsp;</td></tr>';\n+\techo '<tr><td colspan=\"2\">&nbsp;</td></tr>';\n \n \t# If Anon bind allowed, then disable the form if the user choose to bind anonymously.\n \tif ($app['server']->isAnonBindAllowed())\n \t\tprintf('<tr><td colspan=\"2\"><small><b>%s</b></small> <input type=\"checkbox\" name=\"anonymous_bind\" onclick=\"form_field_toggle_enable(this,[\\'login\\',\\'password\\'],\\'login\\')\" id=\"anonymous_bind_checkbox\" /></td></tr>',\n \t\t\t_('Anonymous'));\n \n-\tprintf('<tr><td colspan=\"2\"><center><input type=\"submit\" name=\"submit\" value=\"%s\" /></center></td></tr>',\n+\tprintf('<tr><td colspan=\"2\" style=\"text-align: center;\"><input type=\"submit\" name=\"submit\" value=\"%s\" /></td></tr>',\n \t\t_('Authenticate'));\n \n \techo '</table>';\n-\techo '</center>';\n \techo '</form>';\n \n \techo '<br/>';\n \n-\techo '<script type=\"text/javascript\" language=\"javascript\">document.getElementById(\"login\").focus()</script>';\n+\techo '<script type=\"text/javascript\">document.getElementById(\"login\").focus()</script>';\n \n \tif ($app['server']->isAnonBindAllowed())\n-\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sform_field_toggle_enable.js\"></script>',JSDIR);\n+\t\tprintf('<script type=\"text/javascript\" src=\"%sform_field_toggle_enable.js\"></script>',JSDIR);\n }\n ?>"
            },
            {
                "sha": "4f91ae40289c062858637a5f7151d875c664c58b",
                "filename": "htdocs/mass_delete.php",
                "status": "modified",
                "additions": 20,
                "deletions": 20,
                "changes": 40,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmass_delete.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmass_delete.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fmass_delete.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -46,27 +46,27 @@\n echo \"\\n\";\n \n echo '<center>';\n-echo '<table class=\"forminput\" border=0>';\n+echo '<table class=\"forminput\" border=\"0\">';\n \n if (count($request['parent']) == 1)\n-\tprintf('<tr><td colspan=4><b>%s</b></td></tr>',_('Are you sure you want to permanently delete this object?'));\n+\tprintf('<tr><td colspan=\"4\"><b>%s</b></td></tr>',_('Are you sure you want to permanently delete this object?'));\n else\n-\tprintf('<tr><td colspan=4><b>%s</b></td></tr>',_('Are you sure you want to permanently delete these objects?'));\n+\tprintf('<tr><td colspan=\"4\"><b>%s</b></td></tr>',_('Are you sure you want to permanently delete these objects?'));\n \n-echo '<tr><td colspan=4>&nbsp;</td></tr>';\n-printf('<tr><td width=10%%>%s:</td><td colspan=3 width=75%%><b>%s</b></td></tr>',_('Server'),$app['server']->getName());\n+echo '<tr><td colspan=\"4\">&nbsp;</td></tr>';\n+printf('<tr><td style=\"width: 10%%;\">%s:</td><td colspan=\"3\" style=\"width: 75%%;\"><b>%s</b></td></tr>',_('Server'),$app['server']->getName());\n \n foreach ($request['parent'] as $dn)\n-\tprintf('<tr><td width=10%%><acronym title=\"%s\">%s</acronym></td><td colspan=3 width=75%%><b>%s</b></td></tr>',\n+\tprintf('<tr><td style=\"width: 10%%;\"><acronym title=\"%s\">%s</acronym></td><td colspan=\"3\" style=\"width: 75%%;\"><b>%s</b></td></tr>',\n \t\t_('Distinguished Name'),_('DN'),$dn);\n \n-echo '<tr><td colspan=4>&nbsp;</td></tr>';\n+echo '<tr><td colspan=\"4\">&nbsp;</td></tr>';\n \n $request['delete'] = $request['parent'];\n \n if (count($request['children'])) {\n-\tprintf('<tr><td colspan=4><b>%s</b></td></tr>',_('Permanently delete all children also?'));\n-\techo '<tr><td colspan=4>&nbsp;</td></tr>';\n+\tprintf('<tr><td colspan=\"4\"><b>%s</b></td></tr>',_('Permanently delete all children also?'));\n+\techo '<tr><td colspan=\"4\">&nbsp;</td></tr>';\n \n \t# We need to see if the children have children\n \t$query = array();\n@@ -85,40 +85,40 @@\n \t\tarray_push($request['delete'],$value['dn']);\n \n \techo '<tr>';\n-\techo '<td colspan=4>';\n+\techo '<td colspan=\"4\">';\n \tprintf(_('This request also includes %s children entries.'),count($request['children']));\n \techo '</td></tr>';\n \n-\tprintf('<tr><td colspan=4>%s</td></tr>',\n+\tprintf('<tr><td colspan=\"4\">%s</td></tr>',\n \t\tsprintf(_('phpLDAPadmin can also recursively delete all %s of the child entries. See below for a list of all the entries that this action will delete. Do you want to do this?'),count($request['children'])));\n \n-\techo '<tr><td colspan=4>&nbsp;</td></tr>';\n+\techo '<tr><td colspan=\"4\">&nbsp;</td></tr>';\n \n-\tprintf('<tr><td colspan=4><small>%s</small></td></tr>',\n+\tprintf('<tr><td colspan=\"4\"><small>%s</small></td></tr>',\n \t\t_('Note: this is potentially very dangerous and you do this at your own risk. This operation cannot be undone. Take into consideration aliases, referrals, and other things that may cause problems.'));\n \techo \"\\n\";\n \n-\techo '<tr><td colspan=4>&nbsp;</td></tr>';\n+\techo '<tr><td colspan=\"4\">&nbsp;</td></tr>';\n \n \techo \"\\n\";\n \n-\tprintf('<tr><td colspan=4><center><b>%s</b></center></td></tr>',_('List of entries to be deleted:'));\n-\techo '<tr><td colspan=4>&nbsp;</td></tr>';\n+\tprintf('<tr><td colspan=\"4\"><center><b>%s</b></center></td></tr>',_('List of entries to be deleted:'));\n+\techo '<tr><td colspan=\"4\">&nbsp;</td></tr>';\n \n \t$i = 0;\n-\techo '<tr><td colspan=4><center>';\n+\techo '<tr><td colspan=\"4\"><center>';\n \tprintf('<select size=\"%s\" multiple disabled style=\"background:white; color:black;width:500px\" >',min(10,count($request['delete'])));\n \tforeach ($request['delete'] as $key => $value)\n \t\tprintf('<option>%s. %s</option>',++$i,htmlspecialchars(dn_unescape($value)));\n \techo '</select>';\n \techo '</center></td></tr>';\n \techo \"\\n\";\n \n-\techo '<tr><td colspan=4>&nbsp;</td></tr>';\n+\techo '<tr><td colspan=\"4\">&nbsp;</td></tr>';\n }\n \n echo '<tr>';\n-echo '<td width=50% colspan=2><center>';\n+echo '<td colspan=\"2\" style=\"width: 50%; text-align: center;\">';\n echo '<form action=\"cmd.php\" method=\"post\">';\n echo '<input type=\"hidden\" name=\"cmd\" value=\"rdelete\" />';\n printf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n@@ -128,7 +128,7 @@\n echo '</form>';\n echo '</center></td>';\n \n-echo '<td colspan=2 width=50%><center>';\n+echo '<td colspan=\"2\" style=\"width: 50%; text-align: center;\">';\n \n echo '<form action=\"cmd.php\" method=\"get\">';\n echo '<input type=\"hidden\" name=\"cmd\" value=\"template_engine\" />';"
            },
            {
                "sha": "1ea70013a029b014de957471a0e22f8148f6327f",
                "filename": "htdocs/mass_edit.php",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmass_edit.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmass_edit.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fmass_edit.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -64,13 +64,16 @@\n $request['page'][0]->drawSubTitle(sprintf('%s: <b>%s</b>',_('Server'),$app['server']->getName()));\n \n echo '<form action=\"cmd.php\" method=\"post\">';\n+echo '<div>';\n echo '<input type=\"hidden\" name=\"cmd\" value=\"mass_update\" />';\n printf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \n foreach ($request['page'] as $j => $page)\n \tprintf('<input type=\"hidden\" name=\"dn[%s]\" value=\"%s\" />',$j,$page->getTemplate()->getDN());\n \n-echo '<table class=\"result_table\" border=0>';\n+echo '</div>';\n+\n+echo '<table class=\"result_table\" border=\"0\">';\n echo '<tr class=\"heading\">';\n echo '<td>DN</td>';\n \n@@ -122,7 +125,9 @@\n }\n \n echo '</table>';\n+echo '<div>';\n echo '<br/>';\n printf('<input type=\"submit\" id=\"save_button\" name=\"submit\" value=\"%s\" />',_('Update Values'));\n+echo '</div>';\n echo '</form>';\n ?>"
            },
            {
                "sha": "8a9dd01e709a83b1b7e52b1b9fc94e610ad9acdc",
                "filename": "htdocs/mass_update.php",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmass_update.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmass_update.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fmass_update.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -71,12 +71,12 @@\n \t\tforeach ($request['update'] as $j => $page)\n \t\t\tprintf('<input type=\"hidden\" name=\"dn[%s]\" value=\"%s\" />',$j,$page->getTemplate()->getDN());\n \n-\t\techo '<table class=\"result_box\" width=100% border=1>';\n+\t\techo '<table class=\"result_box\" width=\"100%\" border=\"1\">';\n \t\techo '<tr><td>';\n \n \t\techo '<br/>';\n \n-\t\techo '<table class=\"result\" border=0>';\n+\t\techo '<table class=\"result\" border=\"0\">';\n \t\techo '<tr><td>';\n \t\tprintf(_('There will be %s updates done with this mass update'),sprintf('<b>%s</b>',count($request['update'])));\n \t\techo '</td></tr>';\n@@ -87,15 +87,15 @@\n \t\tforeach ($request['update'] as $index => $page) {\n \t\t\t$template = $page->getTemplate();\n \n-\t\t\techo '<table class=\"result\" border=0>';\n+\t\t\techo '<table class=\"result\" border=\"0\">';\n \t\t\techo '<tr class=\"list_title\">';\n \t\t\tprintf('<td class=\"icon\"><img src=\"%s/%s\" alt=\"icon\" /></td>',IMGDIR,get_icon($app['server']->getIndex(),$template->getDN()));\n \n-\t\t\tprintf('<td colspan=3><a href=\"cmd.php?cmd=template_engine&amp;server_id=%s&amp;dn=%s\">%s</a></td>',\n+\t\t\tprintf('<td colspan=\"3\"><a href=\"cmd.php?cmd=template_engine&amp;server_id=%s&amp;dn=%s\">%s</a></td>',\n \t\t\t\t$app['server']->getIndex(),rawurlencode(dn_unescape($template->getDN())),htmlspecialchars(get_rdn($template->getDN())));\n \t\t\techo '</tr>';\n \n-\t\t\tprintf('<tr class=\"list_item\"><td class=\"blank\">&nbsp;</td><td class=\"heading\">dn</td><td class=\"value\" width=\"45%%\">%s</td><td class=\"value\" width=\"45%%\"><b>%s</b></td></tr>',\n+\t\t\tprintf('<tr class=\"list_item\"><td class=\"blank\">&nbsp;</td><td class=\"heading\">dn</td><td class=\"value\" style=\"width: 45%%;\">%s</td><td class=\"value\" style=\"width: 45%%;\"><b>%s</b></td></tr>',\n \t\t\t\thtmlspecialchars(dn_unescape($template->getDN())),_('Old Value'));\n \n \t\t\tforeach ($template->getLDAPmodify(true,$index) as $attribute) {"
            },
            {
                "sha": "33708be977888bcbf0413c7b04e675d0df39e884",
                "filename": "htdocs/modify_member_form.php",
                "status": "modified",
                "additions": 11,
                "deletions": 10,
                "changes": 21,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmodify_member_form.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmodify_member_form.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fmodify_member_form.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -79,12 +79,13 @@\n echo '<br />';\n echo '<br />';\n \n-printf('<script type=\"text/javascript\" language=\"javascript\" src=\"%smodify_member.js\"></script>',JSDIR);\n-echo '<form action=\"cmd.php\" method=\"post\" class=\"add_value\" name=\"member\">';\n+echo '<form action=\"cmd.php\" method=\"post\" class=\"add_value\" id=\"member\">';\n+echo '<div>';\n if ($_SESSION[APPCONFIG]->getValue('confirm','update'))\n \techo '<input type=\"hidden\" name=\"cmd\" value=\"update_confirm\" />';\n else\n \techo '<input type=\"hidden\" name=\"cmd\" value=\"update\" />';\n+echo '</div>';\n \n echo '<table class=\"modify_members\">';\n \n@@ -96,20 +97,20 @@\n # Generate select box from all possible members\n echo '<tr>';\n echo '<td>';\n-echo '<select name=\"notmembers\" size=\"10\" multiple>';\n+echo '<select name=\"notmembers\" size=\"10\" multiple=\"multiple\">';\n \n foreach ($possible_members as $possible)\n-\tprintf('<option>%s</option>',$possible);\n+\tprintf('<option>%s</option>',htmlspecialchars($possible));\n \n echo '</select>';\n echo '</td>';\n \n # Generate select box from all current members\n echo '<td>';\n-echo '<select name=\"members\" size=\"10\" multiple>';\n+echo '<select name=\"members\" size=\"10\" multiple=\"multiple\">';\n \n foreach ($current_members as $current)\n-\tprintf('<option>%s</option>',$current);\n+\tprintf('<option>%s</option>',htmlspecialchars($current));\n \n echo '</select>';\n echo '</td>';\n@@ -119,11 +120,11 @@\n # Show buttons which move users from left to right and vice versa\n echo '<tr>';\n echo '<td>';\n-printf('<input type=\"button\" onClick=\"one2two()\" value=\"%s >>\" />&nbsp;<input type=\"button\" onClick=\"all2two()\" value=\"%s >>\" />',\n+printf('<input type=\"button\" onclick=\"one2two()\" value=\"%s >>\" />&nbsp;<input type=\"button\" onclick=\"all2two()\" value=\"%s >>\" />',\n \t_('Add selected'),_('Add all'));\n echo '</td>';\n echo '<td>';\n-printf('<input type=\"button\" onClick=\"two2one()\" value=\"<< %s\" />&nbsp;<input type=\"button\" onClick=\"all2one()\" value=\"<< %s\" />',\n+printf('<input type=\"button\" onclick=\"two2one()\" value=\"<< %s\" />&nbsp;<input type=\"button\" onclick=\"all2one()\" value=\"<< %s\" />',\n \t_('Remove selected'),('Remove all'));\n echo '</td>';\n echo '</tr>';\n@@ -149,10 +150,10 @@\n echo '</div>';\n \n # Submit values to update_confirm.php and when clicked, run addSelected\n-printf('<input type=\"submit\" name=\"save\" value=\"%s\" onClick=\"update_new_values(\\'%s\\')\" />',_('Save changes'),$request['attr']);\n+printf('<input type=\"submit\" name=\"save\" value=\"%s\" onclick=\"update_new_values(\\'%s\\')\" />',_('Save changes'),$request['attr']);\n echo '</td></tr>';\n \n echo '</table>';\n echo '</form>';\n-echo '</body></html>';\n+printf('<script type=\"text/javascript\" src=\"%smodify_member.js\"></script>',JSDIR);\n ?>"
            },
            {
                "sha": "51ac3927a9b9988474dbb1502a28e16d05d7dcb3",
                "filename": "htdocs/monitor.php",
                "status": "modified",
                "additions": 22,
                "deletions": 22,
                "changes": 44,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmonitor.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fmonitor.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fmonitor.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -28,13 +28,13 @@\n printf('<h3 class=\"title\">%s%s</h3>',_('Monitor info for: '),$app['server']->getName());\n printf('<h3 class=\"subtitle\">%s</h3>',_('Server reports the following information about itself'));\n \n-echo '<table class=\"result\" border=0>';\n+echo '<table class=\"result\" border=\"0\">';\n \n # cn=Monitor\n-printf('<tr class=\"list_item\"><td class=\"heading\" rowspan=2>%s</td></tr>',_('LDAP Server'));\n+printf('<tr class=\"list_item\"><td class=\"heading\" rowspan=\"2\">%s</td></tr>',_('LDAP Server'));\n printf('<tr class=\"list_item\"><td class=\"value\">');\n \n-echo '<table class=\"result\" border=0>';\n+echo '<table class=\"result\" border=\"0\">';\n printf('<tr><td>%s</td></tr>',$results[$attrs['monitorcontext'][0]]['monitoredinfo'][0]);\n echo '</table>';\n \n@@ -53,21 +53,21 @@\n \t\t$description = '';\n \t}\n \n-\tprintf('<tr class=\"list_item\"><td class=\"heading\" rowspan=2><acronym title=\"%s\">%s</acronym></td></tr>',$description,$dn);\n+\tprintf('<tr class=\"list_item\"><td class=\"heading\" rowspan=\"2\"><acronym title=\"%s\">%s</acronym></td></tr>',$description,$dn);\n \techo '<tr class=\"list_item\"><td class=\"value\">';\n \techo '<table class=\"result\"><tr><td>';\n-\techo '<table class=\"result_table\" border=0 width=\"100%\">';\n+\techo '<table class=\"result_table\" border=\"0\" width=\"100%\">';\n \n \t$attrs = array(\n \t\t'monitorruntimeconfig',\n \t\t'supportedcontrol'\n \t\t);\n \n \techo '<tr class=\"highlight\">';\n-\tprintf('<td width=\"10%%\">%s</td><td width=\"20%%\">%s</td>',_('Type'),'namingContext');\n+\tprintf('<td style=\"width: 10%%;\">%s</td><td style=\"width: 20%%;\">%s</td>',_('Type'),'namingContext');\n \n \tforeach ($attrs as $attr)\n-\t\tprintf('<td width=\"20%%\">%s</td>',$attr);\n+\t\tprintf('<td style=\"width: 20%%;\">%s</td>',$attr);\n \n \techo '</tr>';\n \n@@ -129,14 +129,14 @@\n }\n \n # cn=Connections,cn=Monitor\n-printf('<tr class=\"list_item\"><td class=\"heading\" rowspan=2><acronym title=\"%s\">%s</acronym></td></tr>',$results['cn=Connections,cn=Monitor']['description'],_('LDAP Connections'));\n+printf('<tr class=\"list_item\"><td class=\"heading\" rowspan=\"2\"><acronym title=\"%s\">%s</acronym></td></tr>',$results['cn=Connections,cn=Monitor']['description'],_('LDAP Connections'));\n printf('<tr class=\"list_item\"><td class=\"value\">');\n echo '<table class=\"result\"><tr><td>';\n-echo '<table class=\"result_table\" border=0 width=\"100%\">';\n+echo '<table class=\"result_table\" border=\"0\" width=\"100%\">';\n \n-printf('<tr class=\"highlight\"><td class=\"20%%\">%s</td><td class=\"value\" width=\"80%%\">%s</td></tr>',\n+printf('<tr class=\"highlight\"><td class=\"20%%\">%s</td><td class=\"value\" style=\"width: 80%%;\">%s</td></tr>',\n \t_('Total Connections'),$results['cn=Total,cn=Connections,cn=Monitor']['monitorcounter']);\n-printf('<tr class=\"highlight\"><td class=\"20%%\">%s</td><td class=\"value\" width=\"80%%\">%s</td></tr>',\n+printf('<tr class=\"highlight\"><td class=\"20%%\">%s</td><td class=\"value\" style=\"width: 80%%;\">%s</td></tr>',\n \t_('Current Connections'),$results['cn=Current,cn=Connections,cn=Monitor']['monitorcounter']);\n \n # Look for some connections\n@@ -146,7 +146,7 @@\n \t\tprintf('<td>%s</td>',$results[$key]['cn'][0]);\n \n \t\techo '<td class=\"value\">';\n-\t\techo '<table class=\"result_table\" border=0 width=\"100%\">';\n+\t\techo '<table class=\"result_table\" border=\"0\" width=\"100%\">';\n \n \t\t$counter = 0;\n \t\tforeach (array(\n@@ -171,7 +171,7 @@\n \n \t\t\tprintf('<tr class=\"%s\">',$counter++%2==0?'even':'odd');\n \n-\t\t\tprintf('<td class=\"title\" width=\"35%%\">%s</td><td width=\"65%%\">%s</td>',\n+\t\t\tprintf('<td class=\"title\" style=\"width: 35%%;\">%s</td><td style=\"width: 65%%;\">%s</td>',\n \t\t\t\t$metric,isset($results[$key][$metric]) ? $results[$key][$metric][0] : '&nbsp;');\n \t\t\techo '</tr>';\n \t\t}\n@@ -201,29 +201,29 @@\n \t$description = implode(' ',$results[$dn]['description']);\n \t$description = preg_replace('/\"/','\\'',$description);\n \n-\tprintf('<tr class=\"list_item\"><td class=\"heading\" rowspan=2><acronym title=\"%s\">%s</acronym></td></tr>',$description,$dn);\n+\tprintf('<tr class=\"list_item\"><td class=\"heading\" rowspan=\"2\"><acronym title=\"%s\">%s</acronym></td></tr>',$description,$dn);\n \techo '<tr class=\"list_item\"><td class=\"value\">';\n \techo '<table class=\"result\"><tr><td>';\n-\techo '<table class=\"result_table\" border=0 width=\"100%\">';\n+\techo '<table class=\"result_table\" border=\"0\" width=\"100%\">';\n \n \tif (isset($results[$dn]['monitoropinitiated']))\n-\t\tprintf('<tr class=\"highlight\"><td width=\"20%%\">%s</td><td class=\"value\" width=\"80%%\">%s</td></tr>',\n+\t\tprintf('<tr class=\"highlight\"><td style=\"width: 20%%;\">%s</td><td class=\"value\" style=\"width: 80%%;\">%s</td></tr>',\n \t\t\t'monitorOpInitiated',$results[$dn]['monitoropinitiated'][0]);\n \tif (isset($results[$dn]['monitoropcompleted']))\n-\t\tprintf('<tr class=\"highlight\"><td width=\"20%%\">%s</td><td class=\"value\" width=\"80%%\">%s</td></tr>',\n+\t\tprintf('<tr class=\"highlight\"><td style=\"width: 20%%;\">%s</td><td class=\"value\" style=\"width: 80%%;\">%s</td></tr>',\n \t\t\t'monitorOpCompleted',$results[$dn]['monitoropcompleted'][0]);\n \tif (isset($results[$dn]['monitoredinfo']))\n-\t\tprintf('<tr class=\"highlight\"><td width=\"20%%\">%s</td><td class=\"value\" width=\"80%%\">%s</td></tr>',\n+\t\tprintf('<tr class=\"highlight\"><td style=\"width: 20%%;\">%s</td><td class=\"value\" style=\"width: 80%%;\">%s</td></tr>',\n \t\t\t'monitoredInfo',$results[$dn]['monitoredinfo'][0]);\n \n \t# Look for some connecitons\n \tforeach ($results as $key => $value) {\n \t\tif (preg_match('/^.*,'.$dn.'$/',$key)) {\n \t\t\techo '<tr class=\"highlight\">';\n-\t\t\tprintf('<td width=\"20%%\">%s</td>',$results[$key]['cn'][0]);\n+\t\t\tprintf('<td style=\"width: 20%%;\">%s</td>',$results[$key]['cn'][0]);\n \n-\t\t\techo '<td class=\"value\" width=\"80%\">';\n-\t\t\techo '<table class=\"result_table\" border=0 width=\"100%\">';\n+\t\t\techo '<td class=\"value\" style=\"width: 80%;\">';\n+\t\t\techo '<table class=\"result_table\" border=\"0\" width=\"100%\">';\n \n \t\t\tforeach (array(\n \t\t\t\t'labeleduri',\n@@ -238,7 +238,7 @@\n \t\t\t\tif (isset($results[$key][$metric])) {\n \t\t\t\t\tprintf('<tr class=\"%s\">',$counter++%2==0?'even':'odd');\n \n-\t\t\t\t\tprintf('<td class=\"title\" width=\"35%%\">%s</td><td width=\"65%%\">%s</td>',\n+\t\t\t\t\tprintf('<td class=\"title\" style=\"width: 35%%;\">%s</td><td style=\"width: 65%%;\">%s</td>',\n \t\t\t\t\t\t$metric,$results[$key][$metric][0]);\n \n \t\t\t\t\techo '</tr>';"
            },
            {
                "sha": "5ca2b68d4a2665530b599e5b779f5bc60613faf7",
                "filename": "htdocs/password_checker.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fpassword_checker.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fpassword_checker.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fpassword_checker.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -31,7 +31,7 @@\n echo '<form action=\"password_checker.php\" method=\"post\">';\n echo '<input type=\"hidden\" name=\"action\" value=\"compare\" />';\n \n-echo '<table class=\"forminput\" width=100% border=0>';\n+echo '<table class=\"forminput\" width=\"100%\" border=\"0\">';\n \n echo '<tr>';\n printf('<td class=\"heading\">%s</td>',_('Compare'));"
            },
            {
                "sha": "aa4a749145c696ef7d37ca79f66eb87e55abaa78",
                "filename": "htdocs/schema.php",
                "status": "modified",
                "additions": 60,
                "deletions": 54,
                "changes": 114,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fschema.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fschema.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fschema.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -28,7 +28,7 @@\n \t$entry['value'] = strtolower($entry['value']);\n }\n \n-$schema_error_str = sprintf('%s <b>%s</b>.<br /><br /></center>%s<ul><li>%s</li><li>%s</li><li>%s</li><li>%s</li></ul>',\n+$schema_error_str = sprintf('%s <b>%s</b>.<br /><br /></div>%s<ul><li>%s</li><li>%s</li><li>%s</li><li>%s</li></ul>',\n \t_('Could not retrieve schema from'),$app['server']->getName(),\n \t_('This could happen for several reasons, the most probable of which are:'),_('The server does not fully support the LDAP protocol.'),\n \t_('Your version of PHP does not correctly perform the query.'),_('phpLDAPadmin doesn\\'t know how to fetch the schema for your server.'),\n@@ -43,7 +43,7 @@\n \t'matching_rules'=>_('Matching Rules'));\n \n echo '<br />';\n-echo '<center>';\n+echo '<div style=\"text-align: center;\">';\n \n $counter = 0;\n foreach ($entry['schema_types'] as $item => $value) {\n@@ -57,22 +57,21 @@\n \n \t} else {\n \t\tif (isAjaxEnabled())\n-\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajDISPLAY(\\'BODY\\',\\'%s\\',\\'Loading %s\\');\" title=\"Loading %s\">%s</a>',\n+\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajDISPLAY(\\'BODY\\',\\'%s\\',\\'Loading %s\\');\" title=\"Loading %s\">%s</a>',\n \t\t\t\thtmlspecialchars($entry['href'][$item]),htmlspecialchars($entry['href'][$item]),$value,$value,$value);\n \t\telse\n \t\t\tprintf('<a href=\"cmd.php?%s\">%s</a>',htmlspecialchars($entry['href'][$item]),_($value));\n \t}\n }\n \n-echo '</center>';\n+echo '</div>';\n echo '<br />';\n \n switch($entry['view']) {\n \tcase 'syntaxes':\n \t\t$highlight_oid = get_request('highlight_oid','GET',false,false);\n \n-\t\techo '<center>';\n-\t\techo '<table class=\"result_table\" border=0>';\n+\t\techo '<table class=\"result_table\" border=\"0\" style=\"margin-left: auto; margin-right: auto;\">';\n \t\tprintf('<tr class=\"heading\"><td>%s</td><td>%s</td></tr>',_('Syntax OID'),_('Description'));\n \n \t\t$counter = 1;\n@@ -96,7 +95,6 @@\n \t\t}\n \n \t\techo '</table>';\n-\t\techo '</center>';\n \t\tbreak;\n \n \tcase 'attributes':\n@@ -125,49 +123,51 @@\n \n \t\tprintf('<small>%s:</small>',_('Jump to an attribute type'));\n \t\techo '<form action=\"cmd.php\" method=\"get\">';\n+\t\techo '<div>';\n \t\techo '<input type=\"hidden\" name=\"cmd\" value=\"schema\" />';\n \t\tprintf('<input type=\"hidden\" name=\"view\" value=\"%s\" />',$entry['view']);\n \t\tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \n \t\tif (isAjaxEnabled()) {\n \t\t\tdrawJSItems($sattrs);\n-\t\t\techo '<select name=\"viewvalue\" onChange=\"ajSHOWSCHEMA(\\'attributes\\',\\'at\\')\" id=\"attributes\">';\n+\t\t\techo '<select name=\"viewvalue\" onchange=\"ajSHOWSCHEMA(\\'attributes\\',\\'at\\')\" id=\"attributes\">';\n \t\t} else\n-\t\t\techo '<select name=\"viewvalue\" onChange=\"submit()\">';\n+\t\t\techo '<select name=\"viewvalue\" onchange=\"submit()\">';\n \n \t\techo '<option value=\"\"> - all -</option>';\n \t\tforeach ($sattrs as $name => $attr)\n \t\t\tprintf('<option value=\"%s\" %s>%s</option>',\n-\t\t\t\t$name,$name == $entry['value'] ? 'selected ': '',$attr->getName(false));\n+\t\t\t\t$name,$name == $entry['value'] ? 'selected=\"selected\" ': '',$attr->getName(false));\n \t\techo '</select>';\n \n \t\tif (isAjaxEnabled())\n-\t\t\tprintf('<input type=\"button\" value=\"%s\" onClick=\"ajSHOWSCHEMA(\\'attributes\\',\\'at\\')\"/>',_('Go'));\n+\t\t\tprintf('<input type=\"button\" value=\"%s\" onclick=\"ajSHOWSCHEMA(\\'attributes\\',\\'at\\')\"/>',_('Go'));\n \t\telse\n \t\t\tprintf('<input type=\"submit\" value=\"%s\" />',_('Go'));\n+\t\techo '</div>';\n \t\techo '</form>';\n \t\techo '<br />';\n \n \t\tforeach ($sattrs as $attr) {\n-\t\t\tif (isAjaxEnabled() || (is_null($entry['value']) || ! strcasecmp($entry['value'],$attr->getName()))) {\n-\t\t\t\tif (! is_null($entry['value']) && strcasecmp($entry['value'],$attr->getName()))\n+\t\t\tif (isAjaxEnabled() || (is_null($entry['value']) || ! trim($entry['value']) || $entry['value']==$attr->getName())) {\n+\t\t\t\tif ((! is_null($entry['value']) && $entry['value']==$attr->getName()) || ! trim($entry['value']))\n \t\t\t\t\t$entry['viewed'] = true;\n \n \t\t\t\tif (isAjaxEnabled() && $entry['value'])\n \t\t\t\t\tprintf('<div id=\"at%s\" style=\"display: %s\">',$attr->getName(),strcasecmp($entry['value'],$attr->getName()) ? 'none' : 'block');\n \t\t\t\telse\n \t\t\t\t\tprintf('<div id=\"at%s\">',$attr->getName());\n \n-\t\t\t\techo '<table class=\"result_table\" width=100% border=0>';\n-\t\t\t\tprintf('<tr class=\"heading\"><td colspan=2><a name=\"%s\">%s</a></td></tr>',\n+\t\t\t\techo '<table class=\"result_table\" width=\"100%\" border=\"0\">';\n+\t\t\t\tprintf('<tr class=\"heading\"><td colspan=\"2\"><a name=\"%s\">%s</a></td></tr>',\n \t\t\t\t\t$attr->getName(),$attr->getName(false));\n \n \t\t\t\t$counter = 0;\n \n \t\t\t\tforeach ($entry['attr_types'] as $item => $value) {\n \n \t\t\t\t\tprintf('<tr class=\"%s\">',++$counter%2 ? 'odd' : 'even');\n-\t\t\t\t\tprintf('<td class=\"title\" width=30%%>%s</td>',$value);\n+\t\t\t\t\tprintf('<td class=\"title\" style=\"width: 30%%;\">%s</td>',$value);\n \n \t\t\t\t\tswitch ($item) {\n \t\t\t\t\t\tcase 'desc':\n@@ -195,7 +195,7 @@\n \t\t\t\t\t\t\telse {\n \t\t\t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['attributes'],strtolower($attr->getSupAttribute())));\n \t\t\t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajSHOWSCHEMA(\\'attributes\\',\\'at\\',\\'%s\\');\">%s</a>',\n+\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajSHOWSCHEMA(\\'attributes\\',\\'at\\',\\'%s\\');\">%s</a>',\n \t\t\t\t\t\t\t\t\t\t$href,strtolower($attr->getSupAttribute()),$attr->getSupAttribute());\n \t\t\t\t\t\t\t\telse\n \t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\">%s</a>',$href,$attr->getSupAttribute());\n@@ -213,7 +213,7 @@\n \t\t\t\t\t\t\telse {\n \t\t\t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['matching_rules'],$attr->getEquality()));\n \t\t\t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s</a>',\n+\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s</a>',\n \t\t\t\t\t\t\t\t\t\t$href,$href,_('Matching Rules'),$attr->getEquality(),$attr->getEquality());\n \t\t\t\t\t\t\t\telse\n \t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\">%s</a>',$href,$attr->getEquality());\n@@ -241,7 +241,7 @@\n \t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&highlight_oid=%s',$entry['href']['syntaxes'],$attr->getSyntaxOID()));\n \t\t\t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s (%s)</a>',\n+\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s (%s)</a>',\n \t\t\t\t\t\t\t\t\t\t$href,$href,_('Syntaxes'),'',$attr->getType(),$attr->getSyntaxOID());\n \t\t\t\t\t\t\t\telse\n \t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\">%s (%s)</a>',$href,$attr->getType(),$attr->getSyntaxOID());\n@@ -289,7 +289,7 @@\n \t\t\t\t\t\t\t\tforeach ($attr->getAliases() as $alias) {\n \t\t\t\t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['attributes'],strtolower($alias)));\n \t\t\t\t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajSHOWSCHEMA(\\'attributes\\',\\'at\\',\\'%s\\');\">%s</a>',\n+\t\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajSHOWSCHEMA(\\'attributes\\',\\'at\\',\\'%s\\');\">%s</a>',\n \t\t\t\t\t\t\t\t\t\t\t$href,strtolower($alias),$alias);\n \t\t\t\t\t\t\t\t\telse\n \t\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\">%s</a>',$href,$alias);\n@@ -308,7 +308,7 @@\n \t\t\t\t\t\t\t\tforeach ($attr->getUsedInObjectClasses() as $objectclass) {\n \t\t\t\t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['objectclasses'],strtolower($objectclass)));\n \t\t\t\t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s</a> ',\n+\t\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s</a> ',\n \t\t\t\t\t\t\t\t\t\t\t$href,$href,_('ObjectClasses'),strtolower($objectclass),$objectclass);\n \t\t\t\t\t\t\t\t\telse\n \t\t\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\">%s</a> ',$href,$objectclass);\n@@ -340,33 +340,35 @@\n \t\tprintf('<small>%s</small><br />',_('Jump to a matching rule'));\n \n \t\techo '<form action=\"cmd.php\" method=\"get\">';\n+\t\techo '<div>';\n \t\techo '<input type=\"hidden\" name=\"cmd\" value=\"schema\" />';\n \t\tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \t\techo '<input type=\"hidden\" name=\"view\" value=\"matching_rules\" />';\n \n \t\tif (isAjaxEnabled()) {\n \t\t\tdrawJSItems($schema_matching_rules);\n-\t\t\techo '<select name=\"viewvalue\" onChange=\"ajSHOWSCHEMA(\\'matchingrules\\',\\'mr\\')\" id=\"matchingrules\">';\n+\t\t\techo '<select name=\"viewvalue\" onchange=\"ajSHOWSCHEMA(\\'matchingrules\\',\\'mr\\')\" id=\"matchingrules\">';\n \t\t} else\n-\t\t\techo '<select name=\"viewvalue\" onChange=\"submit()\">';\n+\t\t\techo '<select name=\"viewvalue\" onchange=\"submit()\">';\n \n \t\techo '<option value=\"\"> - all -</option>';\n \t\tforeach ($schema_matching_rules as $rule)\n \t\t\tprintf('<option value=\"%s\" %s>%s</option>',\n \t\t\t\t$rule->getName(),\n-\t\t\t\t($rule->getName() == $entry['value'] ? 'selected': ''),\n+\t\t\t\t($rule->getName() == $entry['value'] ? 'selected=\"selected\"': ''),\n \t\t\t\t$rule->getName(false));\n \n \t\techo '</select>';\n \n \t\tif (isAjaxEnabled())\n-\t\t\tprintf('<input type=\"button\" value=\"%s\" onClick=\"ajSHOWSCHEMA(\\'matchingrules\\',\\'mr\\')\"/>',_('Go'));\n+\t\t\tprintf('<input type=\"button\" value=\"%s\" onclick=\"ajSHOWSCHEMA(\\'matchingrules\\',\\'mr\\')\"/>',_('Go'));\n \t\telse\n \t\t\tprintf('<input type=\"submit\" value=\"%s\" />',_('Go'));\n+\t\techo '</div>';\n \t\techo '</form>';\n \t\techo '<br />';\n \n-\t\techo '<table class=\"result_table\" width=100% border=0>';\n+\t\techo '<table class=\"result_table\" width=\"100%\" border=\"0\">';\n \t\tprintf('<tr class=\"heading\"><td>%s</td><td>%s</td><td>%s</td></tr>',\n \t\t\t_('Matching Rule OID'),_('Name'),_('Used by Attributes'));\n \n@@ -377,8 +379,8 @@\n \t\t\t$oid = $rule->getOID();\n \t\t\t$desc = $rule->getName(false);\n \n-\t\t\tif (isAjaxEnabled() || (is_null($entry['value']) || ! strcasecmp($entry['value'],$rule->getName()))) {\n-\t\t\t\tif (! is_null($entry['value']) && strcasecmp($entry['value'],$rule->getName()))\n+\t\t\tif (isAjaxEnabled() || (is_null($entry['value']) || ! trim($entry['value']) || $entry['value']==$rule->getName())) {\n+\t\t\t\tif ((! is_null($entry['value']) && $entry['value']==$rule->getName()) || ! trim($entry['value']))\n \t\t\t\t\t$entry['viewed'] = true;\n \n \t\t\t\tif (null != $rule->getDescription())\n@@ -398,11 +400,12 @@\n \t\t\t\techo '<td>';\n \n \t\t\t\tif (count($rule->getUsedByAttrs()) == 0) {\n-\t\t\t\t\tprintf('<center>(%s)</center><br /><br />',_('none'));\n+\t\t\t\t\tprintf('<div style=\"text-align: center;\">(%s)</div><br /><br />',_('none'));\n \n \t\t\t\t} else {\n-\t\t\t\t\techo '<table width=100% border=0><tr><td>';\n+\t\t\t\t\techo '<table width=\"100%\" border=\"0\"><tr><td>';\n \t\t\t\t\techo '<form action=\"cmd.php\" method=\"get\">';\n+\t\t\t\t\techo '<div>';\n \t\t\t\t\techo '<input type=\"hidden\" name=\"cmd\" value=\"schema\" />';\n \t\t\t\t\tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \t\t\t\t\techo '<input type=\"hidden\" name=\"view\" value=\"attributes\" />';\n@@ -413,10 +416,11 @@\n \t\t\t\t\techo '</select><br />';\n \n \t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\tprintf('<input type=\"button\" value=\"%s\" onClick=\"return ajJUMP(\\'cmd=schema&amp;view=attributes&amp;server_id=%s\\',\\'%s\\',\\'%s\\',\\'vv\\');\"/>',\n+\t\t\t\t\t\tprintf('<input type=\"button\" value=\"%s\" onclick=\"return ajJUMP(\\'cmd=schema&amp;view=attributes&amp;server_id=%s\\',\\'%s\\',\\'%s\\',\\'vv\\');\"/>',\n \t\t\t\t\t\t\t_('Go'),$app['server']->getIndex(),_('Attributes'),$rule->getName());\n \t\t\t\t\telse\n \t\t\t\t\t\tprintf('<input type=\"submit\" value=\"%s\" />',_('Go'));\n+\t\t\t\t\techo '</div>';\n \t\t\t\t\techo '</form>';\n \t\t\t\t\techo '</td></tr></table>';\n \t\t\t\t}\n@@ -436,61 +440,63 @@\n \t\tprintf('<small>%s:</small>',_('Jump to an objectClass'));\n \n \t\techo '<form action=\"cmd.php\" method=\"get\">';\n+\t\techo '<div>';\n \t\techo '<input type=\"hidden\" name=\"cmd\" value=\"schema\" />';\n \t\tprintf('<input type=\"hidden\" name=\"view\" value=\"%s\" />',$entry['view']);\n \t\tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \n \t\tif (isAjaxEnabled()) {\n \t\t\tdrawJSItems($socs);\n-\t\t\techo '<select name=\"viewvalue\" onChange=\"ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\')\" id=\"objectclasses\">';\n+\t\t\techo '<select name=\"viewvalue\" onchange=\"ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\')\" id=\"objectclasses\">';\n \t\t} else\n-\t\t\techo '<select name=\"viewvalue\" onChange=\"submit()\">';\n+\t\t\techo '<select name=\"viewvalue\" onchange=\"submit()\">';\n \n \t\techo '<option value=\"\"> - all - </option>';\n \t\tforeach ($socs as $name => $oclass)\n \t\t\tprintf('<option value=\"%s\" %s>%s</option>',\n-\t\t\t\t$name,$name == $entry['value'] ? 'selected ': '',$oclass->getName(false));\n+\t\t\t\t$name,$name == $entry['value'] ? 'selected=\"selected\" ': '',$oclass->getName(false));\n \n \t\techo '</select>';\n \n \t\tif (isAjaxEnabled())\n-\t\t\tprintf('<input type=\"button\" value=\"%s\" onClick=\"ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\')\"/>',_('Go'));\n+\t\t\tprintf('<input type=\"button\" value=\"%s\" onclick=\"ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\')\"/>',_('Go'));\n \t\telse\n \t\t\tprintf('<input type=\"submit\" value=\"%s\" />',_('Go'));\n+\t\techo '</div>';\n \t\techo '</form>';\n \t\techo '<br />';\n \n \t\tforeach ($socs as $name => $oclass) {\n-\t\t\tif (isAjaxEnabled() || (is_null($entry['value']) || ! strcasecmp($entry['value'],$oclass->getName()))) {\n-\t\t\t\tif (! is_null($entry['value']) && strcasecmp($entry['value'],$oclass->getName()))\n+\t\t\tif (isAjaxEnabled() || (is_null($entry['value']) || ! trim($entry['value']) || $entry['value']==$oclass->getName())) {\n+\t\t\t\tif ((! is_null($entry['value']) && $entry['value']==$oclass->getName()) || ! trim($entry['value']))\n \t\t\t\t\t$entry['viewed'] = true;\n \n \t\t\t\tif (isAjaxEnabled() && $entry['value'])\n \t\t\t\t\tprintf('<div id=\"oc%s\" style=\"display: %s\">',$oclass->getName(),strcasecmp($entry['value'],$oclass->getName()) ? 'none' : '');\n \t\t\t\telse\n \t\t\t\t\tprintf('<div id=\"oc%s\">',$oclass->getName());\n \n-\t\t\t\techo '<table class=\"result_table\" width=100% border=0>';\n-\t\t\t\tprintf('<tr class=\"heading\"><td colspan=4><a name=\"%s\">%s</a></td></tr>',$name,$oclass->getName(false));\n-\t\t\t\tprintf('<tr class=\"odd\"><td colspan=4>%s: <b>%s</b></td></tr>',_('OID'),$oclass->getOID());\n+\t\t\t\techo '<table class=\"result_table\" width=\"100%\" border=\"0\">';\n+\t\t\t\tprintf('<tr class=\"heading\"><td colspan=\"4\"><a name=\"%s\">%s</a></td></tr>',$name,$oclass->getName(false));\n+\t\t\t\tprintf('<tr class=\"odd\"><td colspan=\"4\">%s: <b>%s</b></td></tr>',_('OID'),$oclass->getOID());\n \n \t\t\t\tif ($oclass->getDescription())\n-\t\t\t\t\tprintf('<tr class=\"odd\"><td colspan=4>%s: <b>%s</b></td></tr>',_('Description'),$oclass->getDescription());\n+\t\t\t\t\tprintf('<tr class=\"odd\"><td colspan=\"4\">%s: <b>%s</b></td></tr>',_('Description'),$oclass->getDescription());\n \n-\t\t\t\tprintf('<tr class=\"odd\"><td colspan=4>%s: <b>%s</b></td></tr>',_('Type'),$oclass->getType());\n+\t\t\t\tprintf('<tr class=\"odd\"><td colspan=\"4\">%s: <b>%s</b></td></tr>',_('Type'),$oclass->getType());\n \n \t\t\t\tif ($oclass->getIsObsolete())\n-\t\t\t\t\tprintf('<tr class=\"odd\"><td colspan=4>%s</td></tr>',_('This objectClass is obsolete.'));\n+\t\t\t\t\tprintf('<tr class=\"odd\"><td colspan=\"4\">%s</td></tr>',_('This objectClass is obsolete.'));\n \n-\t\t\t\tprintf('<tr class=\"odd\"><td colspan=4>%s: <b>',_('Inherits from'));\n+\t\t\t\tprintf('<tr class=\"odd\"><td colspan=\"4\">%s: <b>',_('Inherits from'));\n \t\t\t\tif (count($oclass->getSupClasses()) == 0)\n \t\t\t\t\tprintf('(%s)',_('none'));\n \n \t\t\t\telse\n \t\t\t\t\tforeach ($oclass->getSupClasses() as $i => $object_class) {\n \t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['objectclasses'],strtolower($object_class)));\n \t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'%s\\');\">%s</a>',\n+\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'%s\\');\">%s</a>',\n \t\t\t\t\t\t\t\t$href,strtolower($object_class),$object_class);\n \t\t\t\t\t\telse\n \t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s&viewvalue=%s\" title=\"%s\">%s</a>',\n@@ -501,11 +507,11 @@\n \t\t\t\t\t}\n \t\t\t\techo '</b></td></tr>';\n \n-\t\t\t\tprintf('<tr class=\"odd\"><td colspan=4>%s: <b>',_('Parent to'));\n+\t\t\t\tprintf('<tr class=\"odd\"><td colspan=\"4\">%s: <b>',_('Parent to'));\n \t\t\t\tif (strcasecmp($oclass->getName(),'top') == 0) {\n \t\t\t\t\t$href = htmlspecialchars($entry['href']['objectclasses']);\n \t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'\\');\">all</a>',\n+\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'\\');\">all</a>',\n \t\t\t\t\t\t\t$href);\n \t\t\t\t\telse\n \t\t\t\t\t\tprintf('(<a href=\"cmd.php?%s\">all</a>)',$href);\n@@ -517,7 +523,7 @@\n \t\t\t\t\tforeach ($oclass->getChildObjectClasses() as $i => $object_class) {\n \t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['objectclasses'],strtolower($object_class)));\n \t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" title=\"%s\" onClick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'%s\\');\">%s</a>',\n+\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" title=\"%s\" onclick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'%s\\');\">%s</a>',\n \t\t\t\t\t\t\t\t$href,_('Jump to this objectClass definition'),strtolower($object_class),$object_class);\n \t\t\t\t\t\telse\n \t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" title=\"%s\">%s</a>',$href,_('Jump to this objectClass definition'),$object_class);\n@@ -527,7 +533,7 @@\n \t\t\t\t\t}\n \t\t\t\techo '</b></td></tr>';\n \n-\t\t\t\tprintf('<tr class=\"even\"><td class=\"blank\" rowspan=2 width=5%%>&nbsp;</td><td width=45%%><b>%s</b></td><td width=45%%><b>%s</b></td><td class=\"blank\" rowspan=2 width=5%%>&nbsp;</td></tr>',\n+\t\t\t\tprintf('<tr class=\"even\"><td class=\"blank\" rowspan=\"2\" style=\"width: 5%%;\">&nbsp;</td><td style=\"width: 45%%;\"><b>%s</b></td><td style=\"width: 45%%;\"><b>%s</b></td><td class=\"blank\" rowspan=\"2\" style=\"width: 5%%;\">&nbsp;</td></tr>',\n \t\t\t\t\t_('Required Attributes'),_('Optional Attributes'));\n \n \t\t\t\techo '<tr class=\"odd\">';\n@@ -540,7 +546,7 @@\n \t\t\t\t\t\techo '<li>';\n \t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['attributes'],$attr->getName()));\n \t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s</a>',\n+\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s</a>',\n \t\t\t\t\t\t\t\t$href,$href,_('Attributes'),$attr->getName(),$attr->getName(false));\n \t\t\t\t\t\telse\n \t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\">%s</a>',$href,$attr->getName(false));\n@@ -550,7 +556,7 @@\n \t\t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['objectclasses'],strtolower($attr->getSource())));\n \t\t\t\t\t\t\tprintf('<small>(%s ',_('Inherited from'));\n \t\t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" title=\"%s\" onClick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'%s\\');\">%s</a>',\n+\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" title=\"%s\" onclick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'%s\\');\">%s</a>',\n \t\t\t\t\t\t\t\t\t$href,_('Jump to this objectClass definition'),strtolower($attr->getSource()),$attr->getSource());\n \t\t\t\t\t\t\telse\n \t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\">%s</a>',$href,$attr->getSource());\n@@ -573,7 +579,7 @@\n \t\t\t\t\t\techo '<li>';\n \t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['attributes'],$attr->getName()));\n \t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onClick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s</a>',\n+\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" onclick=\"return ajJUMP(\\'%s\\',\\'%s\\',\\'%s\\');\">%s</a>',\n \t\t\t\t\t\t\t\t$href,$href,_('Attributes'),$attr->getName(),$attr->getName(false));\n \t\t\t\t\t\telse\n \t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\">%s</a>',$href,$attr->getName(false));\n@@ -583,7 +589,7 @@\n \t\t\t\t\t\t\t$href = htmlspecialchars(sprintf('%s&viewvalue=%s',$entry['href']['objectclasses'],strtolower($attr->getSource())));\n \t\t\t\t\t\t\tprintf('<small>(%s ',_('Inherited from'));\n \t\t\t\t\t\t\tif (isAjaxEnabled())\n-\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" title=\"%s\" onClick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'%s\\');\">%s</a>',\n+\t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\" title=\"%s\" onclick=\"return ajSHOWSCHEMA(\\'objectclasses\\',\\'oc\\',\\'%s\\');\">%s</a>',\n \t\t\t\t\t\t\t\t\t$href,_('Jump to this objectClass definition'),strtolower($attr->getSource()),$attr->getSource());\n \t\t\t\t\t\t\telse\n \t\t\t\t\t\t\t\tprintf('<a href=\"cmd.php?%s\">%s</a>',$href,$attr->getSource());\n@@ -615,7 +621,7 @@\n \terror(sprintf(_('No such schema item: \"%s\"'),$entry['value']),'error','index.php');\n \n function drawJSItems($object) {\n-\techo '<script type=\"text/javascript\" language=\"javascript\">'.\"\\n\";\n+\techo '<script type=\"text/javascript\">'.\"\\n\";\n \n \techo \"\n function items() {"
            },
            {
                "sha": "362db26230f2cf71aa79327712466569c02a672e",
                "filename": "htdocs/server_info.php",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fserver_info.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fserver_info.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fserver_info.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -18,16 +18,16 @@\n \n if (! count($attrs)) {\n \techo '<br /><br />';\n-\tprintf('<center>%s</center>',_('This server has nothing to report.'));\n+\tprintf('<div style=\"text-align: center;\">%s</div>',_('This server has nothing to report.'));\n \treturn;\n }\n \n-echo '<table class=\"result\" border=0>';\n+echo '<table class=\"result\" border=\"0\">';\n foreach ($attrs as $key => $values) {\n \tif ($key == 'dn')\n \t\tcontinue;\n \n-\techo '<tr class=\"list_item\"><td class=\"heading\" rowspan=2>';\n+\techo '<tr class=\"list_item\"><td class=\"heading\" rowspan=\"2\">';\n \n \t$sattr = $app['server']->getSchemaAttribute($key);\n \n@@ -42,15 +42,15 @@\n \techo '</td></tr>';\n \n \techo '<tr class=\"list_item\"><td class=\"blank\">&nbsp;</td><td class=\"value\">';\n-\techo '<table class=\"result\" border=0>';\n+\techo '<table class=\"result\" border=\"0\">';\n \n \tif (is_array($values))\n \t\tforeach ($values as $value) {\n \t\t\t$oidtext = '';\n \t\t\tprint '<tr>';\n \n \t\t\tif (preg_match('/^[0-9]+\\.[0-9]+/',$value)) {\n-\t\t\t\tprintf('<td width=5%% rowspan=2 style=\"vertical-align: top\"><img src=\"%s/rfc.png\" title=\"%s\" alt=\"%s\"/></td>',\n+\t\t\t\tprintf('<td rowspan=\"2\" style=\"width: 5%%; vertical-align: top\"><img src=\"%s/rfc.png\" title=\"%s\" alt=\"%s\"/></td>',\n \t\t\t\t\tIMGDIR,$value,htmlspecialchars($value));\n \n \t\t\t\tif ($oidtext = support_oid_to_text($value))\n@@ -64,7 +64,7 @@\n \t\t\t\t\t\tprintf('<td><small>%s</small></td>',$value);\n \n \t\t\t} else {\n-\t\t\t\tprintf('<td rowspan=2 colspan=2>%s</td>',$value);\n+\t\t\t\tprintf('<td rowspan=\"2\" colspan=\"2\">%s</td>',$value);\n \t\t\t}\n \n \t\t\tprint '</tr>';\n@@ -75,11 +75,11 @@\n \t\t\t\techo '<tr><td>&nbsp;</td></tr>';\n \n \t\t\tif ($oidtext)\n-\t\t\t\techo '<tr><td colspan=2>&nbsp;</td></tr>';\n+\t\t\t\techo '<tr><td colspan=\"2\">&nbsp;</td></tr>';\n \t\t}\n \n \telse\n-\t\tprintf('<tr><td colspan=2>%s&nbsp;</td></tr>',$values);\n+\t\tprintf('<tr><td colspan=\"2\">%s&nbsp;</td></tr>',$values);\n \n \n \techo '</table>';"
            },
            {
                "sha": "8358cc18c3f655624dc479547df29c60e7bbff8f",
                "filename": "htdocs/update_confirm.php",
                "status": "modified",
                "additions": 9,
                "deletions": 6,
                "changes": 15,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fupdate_confirm.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fupdate_confirm.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fupdate_confirm.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -32,20 +32,23 @@\n \n # Confirm the updates\n if (count($request['template']->getLDAPmodify(true))) {\n-\techo '<center>';\n+\techo '<div style=\"text-align: center;\">';\n \techo _('Do you want to make these changes?');\n \techo '<br /><br />';\n+\techo '</div>';\n \n \techo \"\\n\\n\";\n \techo '<form action=\"cmd.php\" method=\"post\">';\n+\techo '<div>';\n \techo '<input type=\"hidden\" name=\"cmd\" value=\"update\" />';\n \tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$app['server']->getIndex());\n \tprintf('<input type=\"hidden\" name=\"dn\" value=\"%s\" />',htmlspecialchars($request['dn']));\n \techo \"\\n\";\n \n \t$request['page']->drawHiddenAttributes();\n+\techo '</div>';\n \n-\techo '<table class=\"result_table\">';\n+\techo '<table class=\"result_table\" style=\"margin-left: auto; margin-right: auto;\">';\n \techo \"\\n\";\n \n \tprintf('<tr class=\"heading\"><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>',\n@@ -182,9 +185,11 @@\n \n \techo '</table>';\n \n+\techo '<div style=\"text-align: center;\">';\n \techo '<br />';\n \tprintf('<input type=\"submit\" value=\"%s\" />',_('Commit'));\n \tprintf('<input type=\"submit\" name=\"cancel\" value=\"%s\" />',_('Cancel'));\n+\techo '</div>';\n \techo '</form>';\n \techo '<br />';\n \n@@ -206,16 +211,14 @@\n \t\techo '</b></td></tr></table>';\n \t}\n \n-\techo '</center>';\n-\n } else {\n-\techo '<center>';\n+\techo '<div style=\"text-align: center;\">';\n \techo _('You made no changes');\n \t$href = sprintf('cmd.php?cmd=template_engine&server_id=%s&dn=%s',\n \t\t $app['server']->getIndex(),rawurlencode($request['dn']));\n \n \tprintf(' <a href=\"%s\">%s</a>.',htmlspecialchars($href),_('Go back'));\n-\techo '</center>';\n+\techo '</div>';\n }\n \n function getMustAttrs($oclasses) {"
            },
            {
                "sha": "e427281360de1c7d4e6dd15e91207a50e3954656",
                "filename": "htdocs/welcome.php",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fwelcome.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/htdocs%2Fwelcome.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/htdocs%2Fwelcome.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -11,19 +11,19 @@\n \n require './common.php';\n \n-echo '<center>';\n+echo '<div style=\"text-align: center;\">';\n echo '<br /><br />';\n printf('<img src=\"%s/logo.png\" title=\"%s\" alt=\"%s\" />',IMGDIR,_('phpLDAPadmin logo'),_('phpLDAPadmin logo'));\n echo '<br /><br />';\n echo _('Use the menu to the left to navigate');\n echo '<br /><br />';\n \n if ($_SESSION[APPCONFIG]->isCommandAvailable('cmd','oslinks')) {\n-\tprintf('<a href=\"%s\" target=\"_blank\">%s</a>',get_href('credits'),_('Credits'));\n-\tprintf(' | <a href=\"%s\" target=\"_blank\">%s</a>',get_href('documentation'),_('Documentation'));\n-\tprintf(' | <a href=\"%s\" target=\"_blank\">%s</a>',get_href('donate'),_('Donate'));\n+\tprintf('<a href=\"%s\" onclick=\"target=\\'_blank\\';\">%s</a>',get_href('credits'),_('Credits'));\n+\tprintf(' | <a href=\"%s\" onclick=\"target=\\'_blank\\';\">%s</a>',get_href('documentation'),_('Documentation'));\n+\tprintf(' | <a href=\"%s\" onclick=\"target=\\'_blank\\';\">%s</a>',get_href('donate'),_('Donate'));\n \techo '<br /><br />';\n }\n \n-echo '</center>';\n+echo '</div>';\n ?>"
            },
            {
                "sha": "fe9a733db9009f25593df51f3f9273031e43564b",
                "filename": "lib/AJAXTree.php",
                "status": "modified",
                "additions": 10,
                "deletions": 10,
                "changes": 20,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FAJAXTree.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FAJAXTree.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/lib%2FAJAXTree.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -97,21 +97,21 @@ protected function draw_item($item,$level,$first_child=true,$last_child=true) {\n \t\techo $this->get_indentation($code);\n \n \t\tif (! $child_count)\n-\t\t\tprintf('<img align=\"top\" border=\"0\" class=\"imgs\" id=\"jt%snode\" src=\"%s/%s\" alt=\"--\" />',$node_id,IMGDIR,$imgs['tree'][$nb]);\n+\t\t\tprintf('<img id=\"jt%snode\" src=\"%s/%s\" alt=\"--\" class=\"imgs\" style=\"border: 0px; vertical-align:text-top;\" />',$node_id,IMGDIR,$imgs['tree'][$nb]);\n \n \t\telse {\n \t\t\tprintf('<a href=\"#\" onclick=\"return opencloseTreeNode(\\'%s\\',\\'%s\\',\\'%s\\');\">',$node_id,$parms['openclose'],IMGDIR);\n \n \t\t\tif ($entry->isOpened())\n-\t\t\t\tprintf('<img align=\"top\" border=\"0\" class=\"imgs\" id=\"jt%snode\" src=\"%s/%s\" alt=\"+-\" />',$node_id,IMGDIR,$imgs['collapse'][$nb]);\n+\t\t\t\tprintf('<img id=\"jt%snode\" src=\"%s/%s\" alt=\"+-\" class=\"imgs\" style=\"border: 0px; vertical-align:text-top;\" />',$node_id,IMGDIR,$imgs['collapse'][$nb]);\n \t\t\telse\n-\t\t\t\tprintf('<img align=\"top\" border=\"0\" class=\"imgs\" id=\"jt%snode\" src=\"%s/%s\" alt=\"+-\" />',$node_id,IMGDIR,$imgs['expand'][$nb]);\n+\t\t\t\tprintf('<img id=\"jt%snode\" src=\"%s/%s\" alt=\"+-\" class=\"imgs\" style=\"border: 0px; vertical-align:text-top;\" />',$node_id,IMGDIR,$imgs['expand'][$nb]);\n \n \t\t\techo '</a>';\n \t\t}\n \n \t\tprintf('<a href=\"%s\" onclick=\"return ajDISPLAY(\\'BODY\\',\\'%s\\',\\'%s\\');\" title=\"%s\" >',$href,$parms['edit'],_('Retrieving DN'),htmlspecialchars($item));\n-\t\tprintf('<span class=\"dnicon\"><img align=\"top\" border=\"0\" class=\"imgs\" id=\"jt%sfolder\" src=\"%s/%s\" alt=\"->\" /></span>',$node_id,IMGDIR,$entry->getIcon($server));\n+\t\tprintf('<span class=\"dnicon\"><img id=\"jt%sfolder\" src=\"%s/%s\" alt=\"->\" class=\"imgs\" style=\"border: 0px; vertical-align:text-top;\" /></span>',$node_id,IMGDIR,$entry->getIcon($server));\n \t\techo '</a>';\n \n \t\techo '&nbsp;';\n@@ -192,11 +192,11 @@ protected function get_indentation($code) {\n \t\tfor ($i=0; $i<strlen($code); $i++) {\n \t\t\tswitch ($code[$i]) {\n \t\t\t\tcase '0':\n-\t\t\t\t\t$indent .= sprintf('<img align=\"top\" border=\"0\" class=\"imgs\" src=\"%s/tree_space.png\" alt=\"  \" />',IMGDIR);\n+\t\t\t\t\t$indent .= sprintf('<img src=\"%s/tree_space.png\" alt=\"  \" class=\"imgs\" style=\"border: 0px; vertical-align:text-top;\" />',IMGDIR);\n \t\t\t\t\tbreak;\n \n \t\t\t\tcase '1':\n-\t\t\t\t\t$indent .= sprintf('<img align=\"top\" border=\"0\" class=\"imgs\" src=\"%s/tree_vertline.png\" alt=\"| \" />',IMGDIR);\n+\t\t\t\t\t$indent .= sprintf('<img src=\"%s/tree_vertline.png\" alt=\"| \" class=\"imgs\" style=\"border: 0px; vertical-align:text-top;\" />',IMGDIR);\n \t\t\t\t\tbreak;\n \t\t\t}\n \t\t}\n@@ -211,8 +211,8 @@ protected function draw_javascript() {\n \t\tif (DEBUG_ENABLED && (($fargs=func_get_args())||$fargs='NOARGS'))\n \t\t\tdebug_log('Entered (%%)',33,0,__FILE__,__LINE__,__METHOD__,$fargs);\n \n-\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%slayersmenu-browser_detection.js\"></script>',JSDIR);\n-\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sajax_tree.js\"></script>',JSDIR);\n+\t\tprintf('<script type=\"text/javascript\" src=\"%slayersmenu-browser_detection.js\"></script>',JSDIR);\n+\t\tprintf('<script type=\"text/javascript\" src=\"%sajax_tree.js\"></script>',JSDIR);\n \t}\n \n \t/**\n@@ -266,9 +266,9 @@ private function draw_create_new_entry($entry,$level,$img) {\n \t\t$href = sprintf('cmd=template_engine&server_id=%s&container=%s',$this->getServerID(),rawurlencode($entry->getDN()));\n \n \t\t$output .= $this->get_indentation($level);\n-\t\t$output .= sprintf('<img align=\"top\" border=\"0\" class=\"imgs\" src=\"%s\" alt=\"--\" />',$img);\n+\t\t$output .= sprintf('<img src=\"%s\" alt=\"--\" class=\"imgs\" style=\"border: 0px; vertical-align:text-top;\" />',$img);\n \t\t$output .= sprintf('<a href=\"%s\" title=\"%s\">',htmlspecialchars($href),$entry->getDN());\n-\t\t$output .= sprintf('<img align=\"top\" border=\"0\" class=\"imgs\" src=\"%s/create.png\" alt=\"->\" />',IMGDIR);\n+\t\t$output .= sprintf('<img src=\"%s/create.png\" alt=\"->\" class=\"imgs\" style=\"border: 0px; vertical-align:text-top;\" />',IMGDIR);\n \t\t$output .= '</a>';\n \t\t$output .= '&nbsp;';\n "
            },
            {
                "sha": "d42147a5153eda3ecb56ce6124c7af2df6ddf969",
                "filename": "lib/HTMLTree.php",
                "status": "modified",
                "additions": 10,
                "deletions": 10,
                "changes": 20,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FHTMLTree.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FHTMLTree.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/lib%2FHTMLTree.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -30,7 +30,7 @@ public function draw($onlytree=false) {\n \n \t\t$server = $this->getServer();\n \n-\t\techo '<table class=\"tree\" border=0>';\n+\t\techo '<table class=\"tree\" border=\"0\">';\n \t\tif (! $onlytree)\n \t\t\t$this->draw_server_name();\n \n@@ -60,7 +60,7 @@ public function draw($onlytree=false) {\n \t\t\t\t\t$server->getIndex());\n \t\t\t}\n \n-\t\t\techo '<table class=\"tree\" border=0>';\n+\t\t\techo '<table class=\"tree\" border=\"0\">';\n \n \t\t\tif (! count($this->getBaseEntries())) {\n \t\t\t\t# We didnt get any baseDN entries in our tree?\n@@ -90,13 +90,13 @@ public function draw($onlytree=false) {\n \t\t\t\t\tprintf('<tr><td class=\"spacer\"></td><td class=\"spacer\"></td><td><img src=\"%s/unknown.png\" /></td><td colspan=\"%s\">%s</td></tr>',\n \t\t\t\t\t\tIMGDIR,$this->getDepth()+3-3,pretty_print_dn($base->getDN()));\n \n-\t\t\t\t\t$this->javascript .= sprintf('<form name=\"create_base_form_%s\" method=\"post\" action=\"cmd.php?cmd=template_engine\">',$javascript_id);\n+\t\t\t\t\t$this->javascript .= sprintf('<form id=\"create_base_form_%s\" method=\"post\" action=\"cmd.php?cmd=template_engine\">',$javascript_id);\n \t\t\t\t\t$this->javascript .= sprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$server->getIndex());\n \t\t\t\t\t$this->javascript .= sprintf('<input type=\"hidden\" name=\"container\" value=\"%s\" />',htmlspecialchars($server->getContainer($base->getDN())));\n \t\t\t\t\t$this->javascript .= sprintf('<input type=\"hidden\" name=\"rdn\" value=\"%s\" />',get_rdn($base->getDN()));\n \t\t\t\t\t$this->javascript .= sprintf('</form>');\n \n-\t\t\t\t\tprintf('<tr><td class=\"spacer\"></td><td class=\"spacer\"></td><td class=\"spacer\"></td><td colspan=\"%s\"><small>%s<a href=\"javascript:document.create_base_form_%s.submit()\">%s</a></small></td></tr>',\n+\t\t\t\t\tprintf('<tr><td class=\"spacer\"></td><td class=\"spacer\"></td><td class=\"spacer\"></td><td colspan=\"%s\"><small>%s<a href=\"javascript:document.getElementById(\\'create_base_form_%s\\').submit()\">%s</a></small></td></tr>',\n \t\t\t\t\t\t$this->getDepth()+3-3,_('This base entry does not exist.'),$javascript_id,_('Create it?'));\n \n \t\t\t\t\techo '</table>';\n@@ -163,7 +163,7 @@ protected function draw_server_name() {\n \t\tif (! is_null($server->inactivityTime())) {\n \t\t\t$m = sprintf(_('Inactivity will log you off at %s'),\n \t\t\t\tstrftime('%H:%M',$server->inactivityTime()));\n-\t\t\tprintf(' <img width=14 height=14 src=\"%s/timeout.png\" title=\"%s\" alt=\"%s\"/>',IMGDIR,$m,'Timeout');\n+\t\t\tprintf(' <img width=\"14\" height=\"14\" src=\"%s/timeout.png\" title=\"%s\" alt=\"%s\"/>',IMGDIR,$m,'Timeout');\n \t\t}\n \t\techo '</td></tr>';\n \t}\n@@ -420,7 +420,7 @@ protected function draw_item($item,$level) {\n \t\t$href['edit'] = htmlspecialchars(sprintf('cmd.php?cmd=template_engine&server_id=%s&dn=%s',$server->getIndex(),$dnENCODE));\n \n \t\techo '<tr class=\"option\">';\n-\t\tprintf('<td class=\"spacer\" colspan=%s></td>',$level+2);\n+\t\tprintf('<td class=\"spacer\" colspan=\"%s\"></td>',$level+2);\n \n \t\t# Is this node expanded? (deciding whether to draw \"+\" or \"-\")\n \t\tif ($entry->isOpened())\n@@ -437,7 +437,7 @@ protected function draw_item($item,$level) {\n \t\tprintf('<td class=\"icon\"><a href=\"%s\" id=\"node_%s_%s\"><img src=\"%s/%s\" alt=\"img\" /></a></td>',\n \t\t\t$href['edit'],$server->getIndex(),preg_replace('/=/','_',base64_encode($item)),IMGDIR,$entry->getIcon());\n \n-\t\tprintf('<td class=\"phplm\" width=100%% colspan=\"%s\"><span style=\"white-space: nowrap;\">',$this->getDepth()+3-$level);\n+\t\tprintf('<td class=\"phplm\" colspan=\"%s\" style=\"width: 100%%;\"><span style=\"white-space: nowrap;\">',$this->getDepth()+3-$level);\n \t\tprintf('<a href=\"%s\">%s</a>',$href['edit'],$this->get_formatted_dn($entry,$level));\n \n \t\tif ($child_count)\n@@ -493,7 +493,7 @@ protected function draw_create_link($rdn,$level,$encoded_dn) {\n \t\t$href = htmlspecialchars(sprintf('cmd.php?cmd=template_engine&server_id=%s&container=%s',$this->getServerID(),$encoded_dn));\n \n \t\techo '<tr>';\n-\t\tprintf('<td class=\"spacer\" colspan=%s></td>',$level+3);\n+\t\tprintf('<td class=\"spacer\" colspan=\"%s\"></td>',$level+3);\n \t\tprintf('<td class=\"icon\"><a href=\"%s\"><img src=\"%s/create.png\" alt=\"%s\" /></a></td>',$href,IMGDIR,_('new'));\n \t\tprintf('<td class=\"link\" colspan=\"%s\"><a href=\"%s\" title=\"%s %s\">%s</a></td>',\n \t\t\t$this->getDepth()+3-$level,$href,_('Create a new entry in'),$rdn,_('Create new entry here'));\n@@ -525,8 +525,8 @@ protected function draw_login_link() {\n \n \t\techo '</tr>';\n \n-\t\tprintf('<tr><td class=\"blank\" colspan=\"%s\">&nbsp;</td>',$this->getDepth()+3);\n-\t\tprintf('<tr><td class=\"blank\" colspan=\"%s\">&nbsp;</td>',$this->getDepth()+3);\n+\t\tprintf('<tr><td class=\"blank\" colspan=\"%s\">&nbsp;</td></tr>',$this->getDepth()+3);\n+\t\tprintf('<tr><td class=\"blank\" colspan=\"%s\">&nbsp;</td></tr>',$this->getDepth()+3);\n \t}\n \n \t/**"
            },
            {
                "sha": "f0bf67e5d64ec162527bcb7a4da4443a8ed311f4",
                "filename": "lib/MassRender.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FMassRender.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FMassRender.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/lib%2FMassRender.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -25,8 +25,8 @@ protected function drawMassFormReadWriteValueAttribute($attribute,$i,$j) {\n \t\t\t$j,htmlspecialchars($attribute->getName()),$i,\n \t\t\t$j,htmlspecialchars($attribute->getName()),$i,\n \t\t\thtmlspecialchars($val),\n-\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n \t\t\t($attribute->getSize() > 0) ? sprintf('size=\"%s\"',$attribute->getSize()) : '',\n \t\t\t($attribute->getMaxLength() > 0) ? sprintf('maxlength=\"%s\"',$attribute->getMaxLength()) : '');\n "
            },
            {
                "sha": "a17d1e04e8220cbed3a4f044857b358e3177b800",
                "filename": "lib/PageRender.php",
                "status": "modified",
                "additions": 38,
                "deletions": 38,
                "changes": 76,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FPageRender.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FPageRender.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/lib%2FPageRender.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -558,7 +558,7 @@ final protected function drawCurrentValueAttribute($attribute,$i) {\n \t\tif (DEBUGTMP) printf('<font size=-2>%s</font><br />',__METHOD__);\n \t\tif (DEBUGTMPSUB) printf(' <small>[%s]</small>',__METHOD__);\n \n-\t\techo $attribute->getValue($i);\n+\t\techo htmlspecialchars($attribute->getValue($i));\n \t}\n \n \t/**\n@@ -588,7 +588,7 @@ protected function drawFormReadOnlyValueAttribute($attribute,$i) {\n \n \t\t$val = $attribute->getValue($i);\n \n-\t\tprintf('<input type=\"text\" class=\"roval\" name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" value=\"%s\" readonly />',\n+\t\tprintf('<input type=\"text\" class=\"roval\" name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" value=\"%s\" readonly=\"readonly\" />',\n \t\t\thtmlspecialchars($attribute->getName()),$i,htmlspecialchars($attribute->getName()),$i,htmlspecialchars($val));\n \t}\n \n@@ -598,14 +598,14 @@ protected function drawFormReadWriteValueAttribute($attribute,$i) {\n \t\t$val = $attribute->getValue($i);\n \n \t\tif ($attribute->getHelper() || $attribute->getVerify())\n-\t\t\techo '<table cellspacing=\"0\" cellpadding=\"0\" border=1><tr><td valign=\"top\">';\n+\t\t\techo '<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\"><tr><td valign=\"top\">';\n \n \t\tprintf('<input type=\"text\" class=\"value\" name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" value=\"%s\" %s%s %s %s/>',\n \t\t\thtmlspecialchars($attribute->getName()),$i,\n \t\t\thtmlspecialchars($attribute->getName()),$i,\n \t\t\thtmlspecialchars($val),\n-\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n \t\t\t($attribute->getSize() > 0) ? sprintf('size=\"%s\"',$attribute->getSize()) : '',\n \t\t\t($attribute->getMaxLength() > 0) ? sprintf('maxlength=\"%s\"',$attribute->getMaxLength()) : '');\n \n@@ -689,8 +689,8 @@ protected function drawFormReadWriteValueBinaryAttribute($attribute,$i) {\n \t\t\tprintf('<input type=\"file\" class=\"value\" name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" value=\"\" %s%s %s %s/><br />',\n \t\t\t\thtmlspecialchars($attribute->getName()),$i,\n \t\t\t\thtmlspecialchars($attribute->getName()),$i,\n-\t\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n \t\t\t\t($attribute->getSize() > 0) ? 'size=\"'.$attribute->getSize().'\"' : '',\n \t\t\t\t($attribute->getMaxLength() > 0) ? 'maxlength=\"'.$attribute->getMaxLength().'\"' : '');\n \t\t}\n@@ -705,8 +705,8 @@ protected function drawFormReadWriteValueDateAttribute($attribute,$i) {\n \t\tprintf('<input type=\"text\" class=\"value\" id=\"new_values_%s_%s\" name=\"new_values[%s][%s]\" value=\"%s\" %s%s %s %s/>&nbsp;',\n \t\t\t$attribute->getName(),$i,\n \t\t\thtmlspecialchars($attribute->getName()),$i,htmlspecialchars($val),\n-\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n \t\t\t($attribute->getSize() > 0) ? sprintf('size=\"%s\"',$attribute->getSize()) : '',\n \t\t\t($attribute->getMaxLength() > 0) ? sprintf('maxlength=\"%s\"',$attribute->getMaxLength()) : '');\n \n@@ -727,13 +727,13 @@ protected function drawFormReadWriteValueDnAttribute($attribute,$i) {\n \n \t\tprintf('<span style=\"white-space: nowrap;\"><input type=\"text\" class=\"value\" name=\"%s\" id=\"%s\" value=\"%s\" %s%s %s %s/>&nbsp;',\n \t\t\t$input_name,$id,htmlspecialchars($val),\n-\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n \t\t\t($attribute->getSize() > 0) ? 'size=\"'.$attribute->getSize().'\"' : '',\n \t\t\t($attribute->getMaxLength() > 0) ? 'maxlength=\"'.$attribute->getMaxLength().'\"' : '');\n \n \t\t# Draw a link for popping up the entry browser if this is the type of attribute that houses DNs.\n-\t\tdraw_chooser_link(sprintf('entry_form.%s',$id),false);\n+\t\tdraw_chooser_link('entry_form',$id,false);\n \t\techo '</span>';\n \n \t\tif ($attribute->getHelper()) {\n@@ -837,9 +837,9 @@ protected function drawFormReadOnlyValueMultiLineAttribute($attribute,$i) {\n \n \t\t$val = $attribute->getValue($i);\n \n-\t\tprintf('<textarea class=\"roval\" %s %s name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" readonly>%s</textarea>',\n-\t\t\t($attribute->getRows() > 0) ? 'rows=\"'.$attribute->getRows().'\"' : '',\n-\t\t\t($attribute->getCols() > 0) ? 'cols=\"'.$attribute->getCols().'\"' : '',\n+\t\tprintf('<textarea class=\"roval\" rows=\"%s\" cols=\"%s\" name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" readonly=\"readonly\">%s</textarea>',\n+\t\t\t($attribute->getRows() > 0) ? $attribute->getRows() : 5,\n+\t\t\t($attribute->getCols() > 0) ? $attribute->getCols() : 100,\n \t\t\thtmlspecialchars($attribute->getName()),$i,\n \t\t\thtmlspecialchars($attribute->getName()),$i,\n \t\t\t$val);\n@@ -850,13 +850,13 @@ protected function drawFormReadWriteValueMultiLineAttribute($attribute,$i) {\n \n \t\t$val = $attribute->getValue($i);\n \n-\t\tprintf('<textarea class=\"value\" %s %s name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" %s%s>%s</textarea>',\n-\t\t\t($attribute->getRows() > 0) ? 'rows=\"'.$attribute->getRows().'\"' : '',\n-\t\t\t($attribute->getCols() > 0) ? 'cols=\"'.$attribute->getCols().'\"' : '',\n+\t\tprintf('<textarea class=\"value\" rows=\"%s\" cols=\"%s\" name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" %s%s>%s</textarea>',\n+\t\t\t($attribute->getRows() > 0) ? $attribute->getRows() : 5,\n+\t\t\t($attribute->getCols() > 0) ? $attribute->getCols() : 100,\n \t\t\thtmlspecialchars($attribute->getName()),$i,\n \t\t\thtmlspecialchars($attribute->getName()),$i,\n-\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n \t\t\t$val);\n \t}\n \n@@ -937,7 +937,7 @@ protected function drawFormReadOnlyValuePasswordAttribute($attribute,$i) {\n \n \t\t$obfuscate_password = obfuscate_password_display($enc_type);\n \n-\t\tprintf('<input type=\"%s\" class=\"roval\" name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" value=\"%s\" %s readonly /><br />',\n+\t\tprintf('<input type=\"%s\" class=\"roval\" name=\"new_values[%s][%s]\" id=\"new_values_%s_%s\" value=\"%s\" %s readonly=\"readonly\" /><br />',\n \t\t\t($obfuscate_password ? 'password' : 'text'),\n \t\t\thtmlspecialchars($attribute->getName()),$i,htmlspecialchars($attribute->getName()),\n \t\t\t$i,htmlspecialchars($val),($attribute->getSize() > 0) ? 'size=\"'.$attribute->getSize().'\"' : '');\n@@ -969,8 +969,8 @@ protected function drawFormReadWriteValuePasswordAttribute($attribute,$i) {\n \t\t\t($obfuscate_password ? 'password' : 'text'),\n \t\t\thtmlspecialchars($attribute->getName()),$i,$id,\n \t\t\thtmlspecialchars($val),\n-\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n \t\t\t($attribute->getSize() > 0) ? sprintf('size=\"%s\"',$attribute->getSize()) : '',\n \t\t\t($attribute->getMaxLength() > 0) ? sprintf('maxlength=\"%s\"',$attribute->getMaxLength()) : '');\n \n@@ -1016,24 +1016,24 @@ protected function drawFormReadWriteValueSelectionAttribute($attribute,$i) {\n \n \t\t\tif (($attribute->getSize() > 0) && ($attribute->getSize() < $attribute->getOptionCount())) {\n \n-\t\t\t\tprintf('<select name=\"new_values[%s][]\" size=\"%s\" multiple>',\n+\t\t\t\tprintf('<select name=\"new_values[%s][]\" size=\"%s\" multiple=\"multiple\">',\n \t\t\t\t\thtmlspecialchars($attribute->getName()),$attribute->getSize());\n \n \t\t\t\tforeach ($attribute->getSelection() as $value => $description) {\n \t\t\t\t\tif (in_array($value,$vals))\n \t\t\t\t\t\t$selected[$value] = true;\n \n-\t\t\t\t\tprintf('<option id=\"new_values_%s_%s\" value=\"%s\" onMouseDown=\"focus_%s(this);\" onClick=\"blur_%s(this);\" %s>%s</option>',\n+\t\t\t\t\tprintf('<option id=\"new_values_%s_%s\" value=\"%s\" onmouseDown=\"focus_%s(this);\" onclick=\"blur_%s(this);\" %s>%s</option>',\n \t\t\t\t\t\thtmlspecialchars($attribute->getName()),$j++,\n \t\t\t\t\t\t$value,htmlspecialchars($attribute->getName()),htmlspecialchars($attribute->getName()),\n-\t\t\t\t\t\tisset($selected[$value]) ? 'selected' : '',$description);\n+\t\t\t\t\t\tisset($selected[$value]) ? 'selected=\"selected\"' : '',$description);\n \n \t\t\t\t\techo \"\\n\";\n \t\t\t\t}\n \n \t\t\t\tforeach ($vals as $val) {\n \t\t\t\t\tif (! isset($selected[$val]))\n-\t\t\t\t\t\tprintf('<option id=\"new_values_%s_%s\" value=\"%s\" onMouseDown=\"focus_%s(this);\" onClick=\"blur_%s(this);\" selected>%s</option>',\n+\t\t\t\t\t\tprintf('<option id=\"new_values_%s_%s\" value=\"%s\" onmousedown=\"focus_%s(this);\" onclick=\"blur_%s(this);\" selected=\"selected\">%s</option>',\n \t\t\t\t\t\t\thtmlspecialchars($attribute->getName()),$j++,\n \t\t\t\t\t\t\t$val,htmlspecialchars($attribute->getName()),\n \t\t\t\t\t\t\thtmlspecialchars($attribute->getName()),$val);\n@@ -1044,7 +1044,7 @@ protected function drawFormReadWriteValueSelectionAttribute($attribute,$i) {\n \t\t\t\techo '</select>';\n \n \t\t\t} else {\n-\t\t\t\techo '<table cellspacing=\"0\" cellpadding=\"0\" border=0>';\n+\t\t\t\techo '<table cellspacing=\"0\" cellpadding=\"0\" border=\"0\">';\n \n \t\t\t\tforeach ($attribute->getSelection() as $value => $description) {\n \t\t\t\t\tif (in_array($value,$vals))\n@@ -1053,19 +1053,19 @@ protected function drawFormReadWriteValueSelectionAttribute($attribute,$i) {\n \t\t\t\t\tprintf('<tr><td><input type=\"checkbox\" id=\"new_values_%s_%s\" name=\"new_values[%s][]\" value=\"%s\" %s%s %s/></td><td><span style=\"white-space: nowrap;\">&nbsp;%s</span></td></tr>',\n \t\t\t\t\t\thtmlspecialchars($attribute->getName()),$j++,\n \t\t\t\t\t\thtmlspecialchars($attribute->getName()),$value,\n-\t\t\t\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t\t\t\tisset($selected[$value]) ? 'checked' : '',\n+\t\t\t\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t\t\t\tisset($selected[$value]) ? 'checked=\"checked\"' : '',\n \t\t\t\t\t\t$description);\n \t\t\t\t}\n \n \t\t\t\tforeach ($vals as $val)\n \t\t\t\t\tif (! isset($selected[$val]))\n-\t\t\t\t\t\tprintf('<tr><td><input type=\"checkbox\" id=\"new_values_%s_%s\" name=\"new_values[%s][]\" value=\"%s\" %s%s checked/></td><td><span style=\"white-space: nowrap;\">&nbsp;%s</span></td></tr>',\n+\t\t\t\t\t\tprintf('<tr><td><input type=\"checkbox\" id=\"new_values_%s_%s\" name=\"new_values[%s][]\" value=\"%s\" %s%s checked=\"checked\"/></td><td><span style=\"white-space: nowrap;\">&nbsp;%s</span></td></tr>',\n \t\t\t\t\t\t\thtmlspecialchars($attribute->getName()),$j++,\n \t\t\t\t\t\t\thtmlspecialchars($attribute->getName()),$val,\n-\t\t\t\t\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t\t\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t\t\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t\t\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '',\n \t\t\t\t\t\t\t$val);\n \n \t\t\t\techo '</table>';\n@@ -1091,12 +1091,12 @@ protected function drawFormReadWriteValueSelectionAttribute($attribute,$i) {\n \t\t\tprintf('<select name=\"new_values[%s][]\" id=\"new_values_%s_%s\" %s%s>',\n \t\t\t\thtmlspecialchars($attribute->getName()),\n \t\t\t\thtmlspecialchars($attribute->getName()),$i,\n-\t\t\t\t$attribute->needJS('focus') ? sprintf('onFocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n-\t\t\t\t$attribute->needJS('blur') ? sprintf('onBlur=\"blur_%s(this);\" ',$attribute->getName()) : '');\n+\t\t\t\t$attribute->needJS('focus') ? sprintf('onfocus=\"focus_%s(this);\" ',$attribute->getName()) : '',\n+\t\t\t\t$attribute->needJS('blur') ? sprintf('onblur=\"blur_%s(this);\" ',$attribute->getName()) : '');\n \n \t\t\tforeach ($attribute->getSelection() as $value => $description) {\n \t\t\t\tprintf('<option value=\"%s\" %s>%s</option>',$value,\n-\t\t\t\t\t($value == $val) ? 'selected' : '',$description);\n+\t\t\t\t\t($value == $val) ? 'selected=\"selected\"' : '',$description);\n \n \t\t\t\tif ($value == $val)\n \t\t\t\t\t$found = true;\n@@ -1108,7 +1108,7 @@ protected function drawFormReadWriteValueSelectionAttribute($attribute,$i) {\n \t\t\t}\n \n \t\t\tif (!$found) {\n-\t\t\t\tprintf('<option value=\"%s\" selected>%s</option>',$val,$val == '' ? '&nbsp;' : $val);\n+\t\t\t\tprintf('<option value=\"%s\" selected=\"selected\">%s</option>',$val,$val == '' ? '&nbsp;' : $val);\n \t\t\t\tif ($val == '')\n \t\t\t\t\t$empty_value = true;\n \t\t\t\techo \"\\n\";"
            },
            {
                "sha": "b55640f36d0614a219255b43dcb395bd1b0c5f30",
                "filename": "lib/QueryRender.php",
                "status": "modified",
                "additions": 28,
                "deletions": 24,
                "changes": 52,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FQueryRender.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FQueryRender.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/lib%2FQueryRender.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -79,14 +79,15 @@ protected function drawTemplateChoice() {\n \n \t\t$baseDNs = $server->getBaseDN();\n \n-\t\techo '<center>';\n-\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n-\t\techo '<form action=\"cmd.php\" name=\"advanced_search_form\">';\n+\t\tprintf('<script type=\"text/javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n+\t\techo '<form action=\"cmd.php\" id=\"advanced_search_form\">';\n+\t\techo '<div>';\n \t\techo '<input type=\"hidden\" name=\"cmd\" value=\"query_engine\" />';\n \t\tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$server->getIndex());\n+\t\techo '</div>';\n \n-\t\techo '<table class=\"forminput\" border=0>';\n-\t\techo '<tr><td colspan=2>&nbsp;</td></tr>';\n+\t\techo '<table class=\"forminput\" border=\"0\" style=\"margin-left: auto; margin-right: auto;\">';\n+\t\techo '<tr><td colspan=\"2\">&nbsp;</td></tr>';\n \n \t\t$templates = $this->getTemplates();\n \n@@ -101,21 +102,22 @@ protected function drawTemplateChoice() {\n \t\t\tforeach ($templates->getTemplates() as $template)\n \t\t\t\tprintf('<option value=\"%s\" %s>%s</option>',\n \t\t\t\t\t$template->getID(),\n-\t\t\t\t\t($this->template_id == $template->getID() ? 'selected' : ''),\n+\t\t\t\t\t($this->template_id == $template->getID() ? 'selected=\"selected\"' : ''),\n \t\t\t\t\t$template->getDescription());\n \t\t\techo '</select>';\n \t\t\techo '</td>';\n \t\t\techo '</tr>';\n \t\t}\n \n+\t\techo '<tr>';\n \t\tprintf('<td><acronym title=\"%s\">%s</acronym></td>',_('The format to show the query results'),_('Display Format'));\n \t\techo '<td>';\n \t\techo '<select name=\"format\" style=\"width: 200px\">';\n \n \t\tprintf('<option value=\"list\" %s>%s</option>',\n-\t\t\t$_SESSION[APPCONFIG]->getValue('search','display') == 'list' ? 'selected' : '',_('list'));\n+\t\t\t$_SESSION[APPCONFIG]->getValue('search','display') == 'list' ? 'selected=\"selected\"' : '',_('list'));\n \t\tprintf('<option value=\"table\" %s>%s</option>',\n-\t\t\t$_SESSION[APPCONFIG]->getValue('search','display') == 'table' ? 'selected' : '',_('table'));\n+\t\t\t$_SESSION[APPCONFIG]->getValue('search','display') == 'table' ? 'selected=\"selected\"' : '',_('table'));\n \n \t\techo '</select>';\n \t\techo '</td>';\n@@ -135,17 +137,17 @@ protected function drawTemplateChoice() {\n \n \t\techo '<tr>';\n \n-\t\techo '<td colspan=2>';\n+\t\techo '<td colspan=\"2\">';\n \t\tprintf('<div id=\"customquery\" style=\"display: %s\">','block');\n \t\techo '<br/>';\n \t\techo '<fieldset>';\n \t\tprintf('<legend>%s</legend>',_('Custom Query'));\n-\t\techo '<table border=0></tr>';\n+\t\techo '<table border=\"0\"><tr>';\n \n \t\tprintf('<td>%s</td>',_('Base DN'));\n \t\tprintf('<td><input type=\"text\" name=\"base\" value=\"%s\" style=\"width: 200px\" id=\"base\" />',count($baseDNs) == 1 ? $baseDNs[0] : '');\n \n-\t\tdraw_chooser_link('advanced_search_form.base');\n+\t\tdraw_chooser_link('advanced_search_form','base');\n \n \t\techo '</td>';\n \t\techo '</tr>';\n@@ -202,11 +204,10 @@ protected function drawTemplateChoice() {\n \t\techo '</td>';\n \t\techo '</tr>';\n \n-\t\tprintf('<tr><td colspan=\"2\"><br /><center><input type=\"submit\" name=\"search\" value=\"%s\" /></center></td></tr>',_('Search'));\n+\t\tprintf('<tr><td colspan=\"2\" style=\"text-align: center;\"><br /><input type=\"submit\" name=\"search\" value=\"%s\" /></td></tr>',_('Search'));\n \n \t\techo '</table>';\n \t\techo '</form>';\n-\t\techo '</center>';\n \t}\n \n \tprivate function visitStart() {\n@@ -248,7 +249,7 @@ private function visitEnd() {\n \t\t\tprintf('<div id=\"DN%s\" style=\"display: %s\">',\n \t\t\t\t$this->getAjaxRef($base), ($show == $this->getAjaxRef($base) ? 'block' : 'none'));\n \n-\t\t\techo '<table class=\"result_box\" border=0 width=100%>';\n+\t\t\techo '<table class=\"result_box\" border=\"0\" width=\"100%\">';\n \t\t\techo '<tr><td>';\n \t\t\techo '<br/>';\n \t\t\techo '<br/>';\n@@ -266,12 +267,12 @@ private function visitEnd() {\n \t\t\t\t\t\t# Temporarily set our DN, for rendering that leverages our DN (eg: JpegPhoto)\n \t\t\t\t\t\t$this->template->setDN($dndetails['dn']);\n \n-\t\t\t\t\t\techo '<table class=\"result\" border=0>';\n+\t\t\t\t\t\techo '<table class=\"result\" border=\"0\">';\n \n \t\t\t\t\t\techo '<tr class=\"list_title\">';\n \t\t\t\t\t\tprintf('<td class=\"icon\"><img src=\"%s/%s\" alt=\"icon\" /></td>',IMGDIR,get_icon($server->getIndex(),$dndetails['dn']));\n \n-\t\t\t\t\t\tprintf('<td colspan=2><a href=\"cmd.php?cmd=template_engine&amp;server_id=%s&amp;dn=%s\">%s</a></td>',\n+\t\t\t\t\t\tprintf('<td colspan=\"2\"><a href=\"cmd.php?cmd=template_engine&amp;server_id=%s&amp;dn=%s\">%s</a></td>',\n \t\t\t\t\t\t\t$server->getIndex(),rawurlencode(dn_unescape($dndetails['dn'])),htmlspecialchars(get_rdn($dndetails['dn'])));\n \t\t\t\t\t\techo '</tr>';\n \n@@ -323,12 +324,15 @@ private function visitEnd() {\n \t\t\t\t\t}\n \n \t\t\t\t\tprintf('<form action=\"cmd.php\" method=\"post\" id=\"massform_%s\">',$counter);\n+\t\t\t\t\techo '<div>';\n \t\t\t\t\tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$server->getIndex());\n \n \t\t\t\t\tforeach ($this->template->resultsdata[$base]['attrs'] as $attr)\n \t\t\t\t\t\tprintf('<input type=\"hidden\" name=\"attrs[]\" value=\"%s\" />',$attr);\n \n-\t\t\t\t\techo '<table class=\"result_table\" border=0>';\n+\t\t\t\t\techo '</div>';\n+\n+\t\t\t\t\techo '<table class=\"result_table\" border=\"0\">';\n \n \t\t\t\t\techo '<thead class=\"fixheader\">';\n \t\t\t\t\techo '<tr class=\"heading\">';\n@@ -352,7 +356,7 @@ private function visitEnd() {\n \t\t\t\t\t\t# Temporarily set our DN, for rendering that leverages our DN (eg: JpegPhoto)\n \t\t\t\t\t\t$this->template->setDN($dndetails['dn']);\n \n-\t\t\t\t\t\tprintf('<tr class=\"%s\" id=\"tr_ma_%s\" onClick=\"var cb=document.getElementById(\\'ma_%s\\'); cb.checked=!cb.checked;\">',\n+\t\t\t\t\t\tprintf('<tr class=\"%s\" id=\"tr_ma_%s\" onclick=\"var cb=document.getElementById(\\'ma_%s\\'); cb.checked=!cb.checked;\">',\n \t\t\t\t\t\t\t$j%2 ? 'even' : 'odd',$j,$j);\n \n \t\t\t\t\t\t# Is mass action enabled.\n@@ -401,8 +405,8 @@ private function visitEnd() {\n \t\t\t\t\tif ($_SESSION[APPCONFIG]->getValue('mass','enabled')) {\n \t\t\t\t\t\tprintf('<tr class=\"%s\">',++$j%2 ? 'odd' : 'even');\n \t\t\t\t\t\tprintf('<td><input type=\"checkbox\" name=\"allbox\" value=\"1\" onclick=\"CheckAll(1,\\'massform_\\',%s);\" /></td>',$counter);\n-\t\t\t\t\t\tprintf('<td colspan=%s>',2+count(explode(',',$ado)));\n-\t\t\t\t\t\techo '<select name=\"cmd\" onChange=\"if (this.value) submit();\" style=\"font-size: 12px\">';\n+\t\t\t\t\t\tprintf('<td colspan=\"%s\">',2+count(explode(',',$ado)));\n+\t\t\t\t\t\techo '<select name=\"cmd\" onchange=\"if (this.value) submit();\" style=\"font-size: 12px\">';\n \n \t\t\t\t\t\tforeach ($mass_actions as $action => $display)\n \t\t\t\t\t\t\tprintf('<option value=\"%s\">%s</option>',$display,$action);\n@@ -430,7 +434,7 @@ private function visitEnd() {\n \t\t}\n \n \t\tif (get_request('format','REQUEST',false,'table') == 'table')\n-\t\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sCheckAll.js\"></script>',JSDIR);\n+\t\t\tprintf('<script type=\"text/javascript\" src=\"%sCheckAll.js\"></script>',JSDIR);\n \t}\n \n \tpublic function drawSubTitle($subtitle=null) {\n@@ -472,7 +476,7 @@ private function getAjaxRef($dn) {\n \n \tprivate function drawBaseTabs() {\n \t\t# Setup the Javascript to show/hide our DIVs.\n-\t\techo '<script type=\"text/javascript\" language=\"javascript\">';\n+\t\techo '<script type=\"text/javascript\">';\n \t\techo 'function items() {';\n \t\techo 'var $items = new Array();';\n \t\t$counter = 0;\n@@ -482,7 +486,7 @@ private function drawBaseTabs() {\n \t\techo '}</script>';\n \t\techo \"\\n\\n\";\n \n-\t\techo '<table class=\"result_table\" border=0>';\n+\t\techo '<table class=\"result_table\" border=\"0\">';\n \t\techo '<tr>';\n \t\t$counter = 0;\n \t\tforeach ($this->template->results as $base => $results) {\n@@ -503,7 +507,7 @@ private function drawBaseTabs() {\n \tprivate function drawResultsTable($base,$results) {\n \t\t$server = $this->getServer();\n \n-\t\techo '<table class=\"result\" border=0>';\n+\t\techo '<table class=\"result\" border=\"0\">';\n \n \t\techo '<tr>';\n \t\tprintf('<td>%s: <b>%s</b><br/><br/><div class=\"execution_time\">(%s %s)</div></td>',_('Entries found'),"
            },
            {
                "sha": "e30003700ec414dc19b91f0f5246785df2739b85",
                "filename": "lib/TemplateRender.php",
                "status": "modified",
                "additions": 84,
                "deletions": 70,
                "changes": 154,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FTemplateRender.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/lib%2FTemplateRender.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/lib%2FTemplateRender.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -498,17 +498,21 @@ protected function drawTemplateChoice() {\n \n \t\t$avail_templates = $this->getTemplates();\n \t\t$templates = $avail_templates->getTemplates($this->getMode(),$this->getModeContainer());\n-\t\tprintf('<center><h3>%s</h3></center>',$msg);\n+\t\tprintf('<h3 style=\"text-align: center;\">%s</h3>',$msg);\n \n \t\t$href_parms = array_to_query_string($_GET,array('meth'));\n-\t\tprintf('<form name=\"template_choice_form\" action=\"cmd.php?%s\" method=\"post\">',htmlspecialchars($href_parms));\n+\t\tprintf('<form id=\"template_choice_form\" action=\"cmd.php?%s\" method=\"post\">',htmlspecialchars($href_parms));\n \t\techo \"\\n\\n\";\n \n-\t\tforeach ($_POST as $p => $v)\n-\t\t\tprintf('<input type=\"hidden\" name=\"%s\" value=\"%s\">',$p,$v);\n-\t\techo \"\\n\\n\";\n+\t\tif (count($_POST)) {\n+\t\t\techo '<div>';\n+\t\t\tforeach ($_POST as $p => $v)\n+\t\t\t\tprintf('<input type=\"hidden\" name=\"%s\" value=\"%s\" />',$p,$v);\n+\t\t\techo '</div>';\n+\t\t\techo \"\\n\\n\";\n+\t\t}\n \n-\t\techo '<table class=\"forminput\" width=\"100%\" border=0>';\n+\t\techo '<table class=\"forminput\" width=\"100%\" border=\"0\">';\n \t\techo '<tr>';\n \t\tprintf('<td class=\"heading\" style=\"vertical-align: top\">%s:</td>',_('Templates'));\n \t\techo '<td>';\n@@ -542,7 +546,7 @@ protected function drawTemplateChoice() {\n \t\t\t\t\tprintf('<td><input type=\"radio\" name=\"template\" value=\"%s\" id=\"%s\" onclick=\"return ajDISPLAY(\\'BODY\\',\\'%s&amp;template=%s\\',\\'%s\\');\" /></td>',\n \t\t\t\t\t\thtmlspecialchars($details->getID()),htmlspecialchars($details->getID()),htmlspecialchars($href_parms),$details->getID(),_('Retrieving DN'));\n \t\t\t\telse\n-\t\t\t\t\tprintf('<td><input type=\"radio\" name=\"template\" value=\"%s\" id=\"%s\" onclick=\"document.forms.template_choice_form.submit()\" /></td>',\n+\t\t\t\t\tprintf('<td><input type=\"radio\" name=\"template\" value=\"%s\" id=\"%s\" onclick=\"document.getElementById(\\'template_choice_form\\').submit()\" /></td>',\n \t\t\t\t\t\thtmlspecialchars($details->getID()),htmlspecialchars($details->getID()));\n \t\t\t}\n \n@@ -552,7 +556,7 @@ protected function drawTemplateChoice() {\n \t\t\t\thtmlspecialchars($details->getID()));\n \n \t\t\tif ($isInValid)\n-\t\t\t\tprintf('<span style=\"color: gray\"><acronym title=\"%s\">',_($isInValid));\n+\t\t\t\tprintf('<span id=\"%s\" style=\"color: gray\"><acronym title=\"%s\">',htmlspecialchars($details->getID()),_($isInValid));\n \n \t\t\techo _($details->getTitle());\n \n@@ -579,7 +583,7 @@ protected function drawTemplateChoice() {\n \t\t\t\tprintf('<td><input type=\"radio\" name=\"template\" value=\"none\" id=\"none\" onclick=\"return ajDISPLAY(\\'BODY\\',\\'%s&amp;template=%s\\',\\'%s\\');\" /></td>',\n \t\t\t\t\thtmlspecialchars($href_parms),'none',_('Retrieving DN'));\n \t\t\telse\n-\t\t\t\techo '<td><input type=\"radio\" name=\"template\" value=\"none\" id=\"none\" onclick=\"document.forms.template_choice_form.submit()\" /></td>';\n+\t\t\t\techo '<td><input type=\"radio\" name=\"template\" value=\"none\" id=\"none\" onclick=\"document.getElementById(\\'template_choice_form\\').submit()\" /></td>';\n \n \t\t\tprintf('<td class=\"icon\"><label for=\"none\"><img src=\"%s/ldap-default.png\" alt=\"\" /></label></td>',IMGDIR);\n \t\t\tprintf('<td class=\"label\"><label for=\"none\">%s</label></td>',_('Default'));\n@@ -640,7 +644,7 @@ private function visitEnd() {\n \t\t} else {\n \t\t\t# Draw internal attributes\n \t\t\tif (get_request('show_internal_attrs','REQUEST')) {\n-\t\t\t\techo '<table class=\"entry\" cellspacing=\"0\" align=\"center\" border=0>';\n+\t\t\t\techo '<table class=\"entry\" cellspacing=\"0\" border=\"0\" style=\"margin-left: auto; margin-right: auto;\">';\n \t\t\t\t$this->drawInternalAttributes();\n \t\t\t\techo '</table><br/>';\n \t\t\t\techo \"\\n\";\n@@ -700,7 +704,7 @@ public function drawSubTitle($subtitle=null) {\n \t\t\tcase 'creation':\n \t\t\t\t$subtitle = sprintf('%s: <b>%s</b>&nbsp;&nbsp;&nbsp;%s: <b>%s</b>',\n \t\t\t\t\t_('Server'),$this->getServer()->getName(),\n-\t\t\t\t\t_('Container'),$this->container);\n+\t\t\t\t\t_('Container'),htmlspecialchars($this->container));\n \n \t\t\t\tif ($this->template_id) {\n \t\t\t\t\t$subtitle .= '<br />';\n@@ -714,7 +718,7 @@ public function drawSubTitle($subtitle=null) {\n \t\t\tcase 'modification':\n \t\t\t\t$subtitle = sprintf('%s: <b>%s</b>&nbsp;&nbsp;&nbsp;%s: <b>%s</b>',\n \t\t\t\t\t_('Server'),$this->getServer()->getName(),\n-\t\t\t\t\t_('Distinguished Name'),$this->dn);\n+\t\t\t\t\t_('Distinguished Name'),htmlspecialchars($this->dn));\n \n \t\t\t\tif ($this->template_id) {\n \t\t\t\t\t$subtitle .= '<br />';\n@@ -737,7 +741,7 @@ private function drawMenu() {\n \t\t# We only have a menu for editing entries.\n \t\tif ($this->template->getContext() == 'edit') {\n \n-\t\t\techo '<table class=\"menu\" width=\"100%\" border=0>';\n+\t\t\techo '<table class=\"menu\" width=\"100%\" border=\"0\">';\n \t\t\techo '<tr>';\n \t\t\t$menuitem_number = 0;\n \n@@ -767,7 +771,7 @@ private function drawMenu() {\n \t\t\t\t\t\tif ($ms) {\n \t\t\t\t\t\t\tif (($menuitem_number % 2) == 1) {\n \t\t\t\t\t\t\t\t$menuitem_number++;\n-\t\t\t\t\t\t\t\techo '<td colspan=2>&nbsp;</td>';\n+\t\t\t\t\t\t\t\techo '<td colspan=\"2\">&nbsp;</td>';\n \t\t\t\t\t\t\t\t$endofrow = false;\n \t\t\t\t\t\t\t\t$start = false;\n \t\t\t\t\t\t\t}\n@@ -792,7 +796,7 @@ private function drawMenu() {\n \t\t\t\t\t} elseif ($ms) {\n \t\t\t\t\t\tif (($menuitem_number % 2) == 1) {\n \t\t\t\t\t\t\t$menuitem_number++;\n-\t\t\t\t\t\t\techo '<td colspan=2>&nbsp;</td>';\n+\t\t\t\t\t\t\techo '<td colspan=\"2\">&nbsp;</td>';\n \t\t\t\t\t\t\t$endofrow = false;\n \t\t\t\t\t\t\t$start = false;\n \t\t\t\t\t\t}\n@@ -1249,7 +1253,7 @@ protected function drawRDNChooser() {\n \t\tif (! count($this->template->getRDNAttrs())) {\n \t\t\tprintf('<tr><th colspan=\"2\">%s</th></tr>','RDN');\n \n-\t\t\techo '<tr><td class=\"value\" colspan=\"2\"><center><select name=\"rdn_attribute[]\" id=\"rdn_attribute\">';\n+\t\t\techo '<tr><td class=\"value\" colspan=\"2\" style=\"text-align: center;\"><select name=\"rdn_attribute[]\" id=\"rdn_attribute\" />';\n \t\t\tprintf('<option value=\"\">%s</option>',_('select the rdn attribute'));\n \n \t\t\tif ($_SESSION[APPCONFIG]->getValue('appearance','rdn_all_attrs'))\n@@ -1267,7 +1271,7 @@ protected function drawRDNChooser() {\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\techo '</select></center></td></tr>';\n+\t\t\techo '</select></td></tr>';\n \n \t\t} else {\n \t\t\techo '<tr><td colspan=\"2\">';\n@@ -1286,7 +1290,7 @@ protected function drawContainerChooser($default_container) {\n \t\techo '<tr>';\n \t\tprintf('<td class=\"heading\">%s</td>',_('Container'));\n \t\tprintf('<td><input type=\"text\" name=\"container\" size=\"40\" value=\"%s\" />',htmlspecialchars($default_container));\n-\t\tdraw_chooser_link('entry_form.container');\n+\t\tdraw_chooser_link('entry_form','container');\n \t\techo '</td>';\n \t\techo '</tr>';\n \t}\n@@ -1303,7 +1307,7 @@ protected function drawObjectClassChooser() {\n \n \t\techo '<tr>';\n \t\tprintf('<td class=\"heading\">%s</td>',_('ObjectClasses'));\n-\t\techo '<td><select name=\"new_values[objectclass][]\" multiple=\"true\" size=\"15\">';\n+\t\techo '<td><select name=\"new_values[objectclass][]\" multiple=\"multiple\" size=\"15\">';\n \n \t\tforeach ($socs as $name => $oclass) {\n \t\t\tif (! strcasecmp('top',$name))\n@@ -1346,29 +1350,35 @@ protected function drawInternalAttribute($attribute) {\n \t/** FORM METHODS **/\n \n \tpublic function drawFormStart() {\n-\t\techo '<form action=\"cmd.php\" method=\"post\" enctype=\"multipart/form-data\" name=\"entry_form\" onSubmit=\"return submitForm(this)\">';\n+\t\techo '<form action=\"cmd.php\" method=\"post\" enctype=\"multipart/form-data\" id=\"entry_form\" onsubmit=\"return submitForm(this)\">';\n \n+\t\techo '<div>';\n \t\tif ($_SESSION[APPCONFIG]->getValue('confirm','update'))\n \t\t\techo '<input type=\"hidden\" name=\"cmd\" value=\"update_confirm\" />';\n \t\telse\n \t\t\techo '<input type=\"hidden\" name=\"cmd\" value=\"update\" />';\n+\t\techo '</div>';\n \t}\n \n \tprotected function drawForm() {\n \t\tif (DEBUGTMP) printf('<font size=-2>%s</font><br />',__METHOD__);\n \n+\t\techo '<div>';\n \t\tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$this->getServerID());\n \t\tprintf('<input type=\"hidden\" name=\"dn\" value=\"%s\" />',htmlspecialchars($this->template->getDN()));\n \t\tprintf('<input type=\"hidden\" name=\"template\" value=\"%s\" />',$this->template->getID());\n+\t\techo '</div>';\n \n-\t\techo '<table class=\"entry\" cellspacing=\"0\" align=\"center\" border=0>';\n+\t\techo '<table class=\"entry\" cellspacing=\"0\" border=\"0\" style=\"margin-left: auto; margin-right: auto;\">';\n \n \t\t$this->drawShownAttributes();\n \t\t$this->drawFormSubmitButton();\n \n \t\techo '</table>';\n \n+\t\techo '<div>&nbsp;';\n \t\t$this->drawHiddenAttributes();\n+\t\techo '</div>';\n \t}\n \n \tpublic function drawFormEnd() {\n@@ -1382,11 +1392,11 @@ public function drawFormEnd() {\n \t\t# For debugging, show the template object.\n \t\tif (! $_SESSION[APPCONFIG]->getValue('appearance','hide_debug_info') && get_request('debug','GET')) {\n \t\t\techo \"\\n\\n\";\n-\t\t\tprintf('<img src=\"%s/plus.png\" alt=\"Plus\" onClick=\"if (document.getElementById(\\'DEBUGtemplate\\').style.display == \\'none\\') { document.getElementById(\\'DEBUGtemplate\\').style.display = \\'block\\' } else { document.getElementById(\\'DEBUGtemplate\\').style.display = \\'none\\' };\"/>',IMGDIR);\n+\t\t\tprintf('<img src=\"%s/plus.png\" alt=\"Plus\" onclick=\"if (document.getElementById(\\'DEBUGtemplate\\').style.display == \\'none\\') { document.getElementById(\\'DEBUGtemplate\\').style.display = \\'block\\' } else { document.getElementById(\\'DEBUGtemplate\\').style.display = \\'none\\' };\"/>',IMGDIR);\n \t\t\techo '<div id=\"DEBUGtemplate\" style=\"display: none\">';\n \t\t\techo '<fieldset>';\n \t\t\tprintf('<legend>DEBUG: %s</legend>',$this->template->getDescription());\n-\t\t\techo '<textarea cols=120 rows=20>';\n+\t\t\techo '<textarea cols=\"120\" rows=\"20\">';\n \t\t\tdebug_dump($this);\n \t\t\techo '</textarea>';\n \t\t\techo '</fieldset>';\n@@ -1398,7 +1408,7 @@ public function drawFormSubmitButton() {\n \t\tif (DEBUGTMP) printf('<font size=-2>%s</font><br />',__METHOD__);\n \n \t\tif (! $this->template->isReadOnly())\n-\t\t\tprintf('<tr><td colspan=2><center><input type=\"submit\" id=\"create_button\" name=\"submit\" value=\"%s\" /></center></td></tr>',_('Update Object'));\n+\t\t\tprintf('<tr><td colspan=\"2\" style=\"text-align: center;\"><input type=\"submit\" id=\"create_button\" name=\"submit\" value=\"%s\" /></td></tr>',_('Update Object'));\n \t}\n \n \t/** STEP FORM METHODS **/\n@@ -1412,18 +1422,18 @@ private function drawStepTitle($page) {\n \t\t\t# The default template only uses 2 pages\n \t\t\t$this->pagelast = 2;\n \n-\t\t\techo '<center><h4>';\n+\t\t\techo '<h4 style=\"text-align: center;\">';\n \t\t\tprintf('%s: ',sprintf(_('Step %s of %s'),$page,$this->pagelast));\n \n \t\t\tif ($page == 1)\n \t\t\t\techo _('Container and ObjectClass(es)');\n \t\t\telse\n \t\t\t\techo _('Specify attributes and values');\n \n-\t\t\techo '</h4></center>';\n+\t\t\techo '</h4>';\n \n \t\t} elseif ($this->template->getDescription())\n-\t\t\tprintf('<center><h4>%s (%s)</h4></center>',\n+\t\t\tprintf('<h4 style=\"text-align: center;\">%s (%s)</h4>',\n \t\t\t\t_($this->template->getDescription()),\n \t\t\t\tsprintf(_('Step %s of %s'),$page,$this->pagelast));\n \t}\n@@ -1432,10 +1442,11 @@ private function drawStepFormStart($page) {\n \t\tif (DEBUGTMP) printf('<font size=-2>%s</font><br />',__METHOD__);\n \n \t\tif (($this->template->isType('default') && $this->template->getContext() == 'create' && $page == 1) || $page < $this->pagelast) {\n-\t\t\techo '<form action=\"cmd.php?cmd=template_engine\" method=\"post\" enctype=\"multipart/form-data\" name=\"entry_form\" onSubmit=\"return submitForm(this)\">';\n+\t\t\techo '<form action=\"cmd.php?cmd=template_engine\" method=\"post\" enctype=\"multipart/form-data\" id=\"entry_form\" onsubmit=\"return submitForm(this)\">';\n \n \t\t} else {\n-\t\t\techo '<form action=\"cmd.php\" method=\"post\" enctype=\"multipart/form-data\" name=\"entry_form\" onSubmit=\"return submitForm(this)\">';\n+\t\t\techo '<form action=\"cmd.php\" method=\"post\" enctype=\"multipart/form-data\" id=\"entry_form\" onsubmit=\"return submitForm(this)\">';\n+\t\t\techo '<div>';\n \n \t\t\tif ($_SESSION[APPCONFIG]->getValue('confirm','create'))\n \t\t\t\techo '<input type=\"hidden\" name=\"cmd\" value=\"create_confirm\" />';\n@@ -1454,15 +1465,18 @@ protected function drawStepForm($page) {\n \t\t$this->drawHiddenAttributes();\n \n \t\tif ($this->template->isType('default') && $page == 1) {\n-\t\t\t\techo '<table class=\"forminput\" align=\"center\" border=0>';\n+\t\t\t\techo '</div>';\n+\n+\t\t\t\techo '<table class=\"forminput\" border=\"0\" style=\"margin-left: auto; margin-right: auto;\">';\n \n \t\t\t\t$this->drawContainerChooser($this->template->getContainer());\n \t\t\t\t$this->drawObjectClassChooser();\n \n \t\t} else {\n \t\t\tprintf('<input type=\"hidden\" name=\"container\" value=\"%s\" />',htmlspecialchars($this->template->getContainer()));\n+\t\t\techo '</div>';\n \n-\t\t\techo '<table class=\"entry\" cellspacing=\"0\" align=\"center\" border=0>';\n+\t\t\techo '<table class=\"entry\" cellspacing=\"0\" border=\"0\" style=\"margin-left: auto; margin-right: auto;\">';\n \n \t\t\t$this->drawRDNChooser();\n \n@@ -1490,7 +1504,7 @@ private function drawStepFormSubmitButton($page) {\n \t\tif ($page < $this->pagelast)\n \t\t\tprintf('<td>&nbsp;</td><td><input type=\"submit\" id=\"create_button\" value=\"%s\" /></td>',_('Proceed &gt;&gt;'));\n \t\telse\n-\t\t\tprintf('<td><center><input type=\"submit\" id=\"create_button\" name=\"submit\" value=\"%s\"/></center></td>',_('Create Object'));\n+\t\t\tprintf('<td style=\"text-align: center;\"><input type=\"submit\" id=\"create_button\" name=\"submit\" value=\"%s\" /></td>',_('Create Object'));\n \t\techo '</tr>';\n \t}\n \n@@ -1522,15 +1536,15 @@ private function drawStepFormDefaultAttributes() {\n \t\t\t\t$this->draw('Template',$attribute);\n \n \t\telse\n-\t\t\tprintf('<tr class=\"noinput\"><td colspan=\"2\"><center>(%s)</center></td></tr>',_('none'));\n+\t\t\tprintf('<tr class=\"noinput\"><td colspan=\"2\" style=\"text-align: center;\">(%s)</td></tr>',_('none'));\n \n \t\tprintf('<tr><th colspan=\"2\">%s</th></tr>',_('Optional Attributes'));\n \t\tif (count($attrs['optional']))\n \t\t\tforeach ($attrs['optional'] as $attribute)\n \t\t\t\t$this->draw('Template',$attribute);\n \n \t\telse\n-\t\t\tprintf('<tr class=\"noinput\"><td colspan=\"2\"><center>(%s)</center></td></tr>',_('none'));\n+\t\t\tprintf('<tr class=\"noinput\"><td colspan=\"2\" style=\"text-align: center;\">(%s)</td></tr>',_('none'));\n \n \t\techo \"\\n\";\n \t}\n@@ -1556,14 +1570,14 @@ protected function drawJavascript() {\n \t\tprintf('<!-- START: %s -->',__METHOD__);\n \t\techo \"\\n\";\n \n-\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sTemplateRender.js\"></script>',JSDIR);\n-\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%stoAscii.js\"></script>',JSDIR);\n-\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n+\t\tprintf('<script type=\"text/javascript\" src=\"%sTemplateRender.js\"></script>',JSDIR);\n+\t\tprintf('<script type=\"text/javascript\" src=\"%stoAscii.js\"></script>',JSDIR);\n+\t\tprintf('<script type=\"text/javascript\" src=\"%sdnChooserPopup.js\"></script>',JSDIR);\n \t\techo \"\\n\";\n \n \t\tprintf('<!-- START: MAIN FORM VALIDATION: %s -->',__METHOD__);\n \t\techo '\n-<script type=\"text/javascript\" language=\"javascript\">\n+<script type=\"text/javascript\">\n function validateForm(silence) {\n \tvar i = 0;\n \tvar valid = true;\n@@ -1598,7 +1612,7 @@ function validateForm(silence) {\n \n \t\t# For DateAttributes, we need to set some defaults for the js_calendar.\n \t\techo '<!-- START: GLOBAL SETTINGS FOR THE js_calendar -->'.\"\\n\";\n-\t\techo '<script type=\"text/javascript\" language=\"javascript\">'.\"\\n\";\n+\t\techo '<script type=\"text/javascript\">'.\"\\n\";\n \t\techo 'var defaults = new Array();'.\"\\n\";\n \t\tprintf('var default_date_format = \"%s\";',$_SESSION[APPCONFIG]->getValue('appearance','date'));\n \t\techo \"\\n\";\n@@ -1609,7 +1623,7 @@ function validateForm(silence) {\n \t\tforeach ($this->template->getAttributesShown() as $attribute)\n \t\t\t$this->draw('Javascript',$attribute);\n \n-\t\techo '<script type=\"text/javascript\" language=\"javascript\">validateForm(true);</script>'.\"\\n\";\n+\t\techo '<script type=\"text/javascript\">validateForm(true);</script>'.\"\\n\";\n \t\tprintf('<!-- END: %s -->',__METHOD__);\n \t\techo \"\\n\";\n \t}\n@@ -1633,7 +1647,7 @@ private function drawTemplateJavascript() {\n \t\tprintf('<!-- START: %s -->',__METHOD__);\n \n \t\techo '\n-<script type=\"text/javascript\" language=\"javascript\">\n+<script type=\"text/javascript\">\n var attrTrace;\n function fill(id,value) {\n \tattrTrace = new Array();\n@@ -1718,7 +1732,7 @@ protected function drawStartValueLineAttribute($attribute) {\n \t\telse\n \t\t\techo '<tr>';\n \n-\t\techo '<td class=\"value\" colspan=2>';\n+\t\techo '<td class=\"value\" colspan=\"2\">';\n \t}\n \n \tprotected function drawEndValueLineAttribute($attribute) {\n@@ -1784,15 +1798,15 @@ protected function drawIconAttribute($attribute,$val) {\n \n \t\telse {\n \t\t\tif ($icon = $attribute->getIcon())\n-\t\t\t\tprintf('<img src=\"%s\" alt=\"Icon\" align=\"top\" />&nbsp;',$icon);\n+\t\t\t\tprintf('<img src=\"%s\" alt=\"Icon\" style=\"float: right;\" />&nbsp;',$icon);\n \t\t}\n \t}\n \n \tprotected function drawDnValueIconAttribute($attribute,$val) {\n \t\tif (DEBUGTMP) printf('<font size=-2>%s</font><br />',__METHOD__);\n \n \t\tif (strlen($val) <= 0)\n-\t\t\tprintf('<img src=\"%s/ldap-alias.png\" alt=\"Go\" align=\"top\" />&nbsp;',IMGDIR);\n+\t\t\tprintf('<img src=\"%s/ldap-alias.png\" alt=\"Go\" style=\"float: right;\" />&nbsp;',IMGDIR);\n \t\telseif ($this->getServer()->dnExists($val))\n \t\t\tprintf('<a href=\"cmd.php?cmd=template_engine&amp;server_id=%s&amp;dn=%s\" title=\"%s %s\"><img src=\"%s/ldap-alias.png\" alt=\"Go\" /></a>&nbsp;',\n \t\t\t\t$this->getServerID(),rawurlencode($val),_('Go to'),$val,IMGDIR);\n@@ -1803,7 +1817,7 @@ protected function drawDnValueIconAttribute($attribute,$val) {\n \tprotected function drawMailValueIconAttribute($attribute,$val) {\n \t\tif (DEBUGTMP) printf('<font size=-2>%s</font><br />',__METHOD__);\n \n-\t\t$img = sprintf('<img src=\"%s/mail.png\" alt=\"%s\" align=\"top\" />',IMGDIR,_('Mail'));\n+\t\t$img = sprintf('<img src=\"%s/mail.png\" alt=\"%s\" style=\"float: right;\" />',IMGDIR,_('Mail'));\n \t\tif (strlen($val) <= 0)\n \t\t\techo $img;\n \t\telse\n@@ -1814,13 +1828,13 @@ protected function drawMailValueIconAttribute($attribute,$val) {\n \tprotected function drawUrlValueIconAttribute($attribute,$val) {\n \t\tif (DEBUGTMP) printf('<font size=-2>%s</font><br />',__METHOD__);\n \n-\t\t$img = sprintf('<img src=\"%s/ldap-dc.png\" alt=\"%s\" align=\"top\" />',IMGDIR,_('URL'));\n+\t\t$img = sprintf('<img src=\"%s/ldap-dc.png\" alt=\"%s\" style=\"float: right;\" />',IMGDIR,_('URL'));\n \t\t$url = explode(' +',$val,2);\n \n \t\tif (strlen($val) <= 0)\n \t\t\techo $img;\n \t\telse\n-\t\t\tprintf('<a href=\"%s\" target=\"new\">%s</a>',htmlspecialchars($url[0]),$img);\n+\t\t\tprintf('<a href=\"%s\" onclick=\"target=\\'new\\';\">%s</a>',htmlspecialchars($url[0]),$img);\n \t\techo '&nbsp;';\n \t}\n \n@@ -1838,7 +1852,7 @@ protected function drawJavascriptAttribute($attribute) {\n \t\tprintf('<!-- START: ATTRIBUTE %s (%s)-->',__METHOD__,$attribute->getName());\n \t\techo \"\\n\";\n \n-\t\techo '<script type=\"text/javascript\" language=\"javascript\">'.\"\\n\";\n+\t\techo '<script type=\"text/javascript\">'.\"\\n\";\n \n \t\techo '// focus'.\"\\n\";\n \t\tif ($attribute->needJS('focus')) {\n@@ -1936,7 +1950,7 @@ protected function drawMenuAttribute($attribute) {\n \n \t\t$item = '';\n \n-\t\techo '<table class=\"entry\" border=0><tr><td width=25>&nbsp;</td>';\n+\t\techo '<table class=\"entry\" border=\"0\"><tr><td style=\"width: 25px;\">&nbsp;</td>';\n \t\techo '<td>';\n \t\tforeach (array('add','modify','rename') as $action)\n \t\t\tif ($item = $this->get('MenuItem',$attribute,$action))\n@@ -2048,7 +2062,7 @@ protected function drawValueAttribute($attribute,$i) {\n \t\t$val = $attribute->getValue($i);\n \n \t\tif ($attribute->isVisible()) {\n-\t\t\techo '<table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" border=0><tr><td class=\"icon\" width=25>';\n+\t\t\techo '<table cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" border=\"0\"><tr><td class=\"icon\" style=\"width: 25px;\">';\n \t\t\t$this->draw('Icon',$attribute,$val);\n \t\t\techo '</td>';\n \n@@ -2063,7 +2077,7 @@ protected function drawValueAttribute($attribute,$i) {\n \t\tif ($attribute->isVisible()) {\n \t\t\techo '</td>';\n \n-\t\t\techo '<td valign=\"top\" align=\"right\">';\n+\t\t\techo '<td valign=\"top\" style=\"text-align: right;\">';\n \t\t\t$this->draw('RequiredSymbol',$attribute);\n \t\t\techo '</td></tr></table>';\n \t\t}\n@@ -2129,14 +2143,14 @@ protected function drawHelperAttribute($attribute,$i) {\n \t\t\t\t$id,htmlspecialchars($attribute->getName()),$i);\n \n \t\t\tforeach ($vals as $v) {\n-\t\t\t\tprintf('<option value=\"%s\" %s>%s</option>',$v,($v == $default) ? 'selected' : '',$v);\n+\t\t\t\tprintf('<option value=\"%s\" %s>%s</option>',$v,($v == $default) ? 'selected=\"selected\"' : '',$v);\n \n \t\t\t\tif ($v == $default)\n \t\t\t\t\t$found = true;\n \t\t\t}\n \n \t\t\tif (! $found)\n-\t\t\t\tprintf('<option value=\"%s\" selected>%s</option>',$default,$default ? $default : '&nbsp;');\n+\t\t\t\tprintf('<option value=\"%s\" selected=\"selected\">%s</option>',$default,$default ? $default : '&nbsp;');\n \n \t\t\techo '</select>';\n \n@@ -2185,7 +2199,7 @@ protected function drawJavascriptBinaryAttribute($attribute) {\n \t\techo \"\\n\";\n \n \t\techo '<!-- This form is submitted by JavaScript when the user clicks \"Delete attribute\" on a binary attribute -->';\n-\t\techo '<form name=\"delete_attribute_form\" action=\"cmd.php?cmd=delete_attr\" method=\"post\">';\n+\t\techo '<form id=\"delete_attribute_form\" action=\"cmd.php?cmd=delete_attr\" method=\"post\">';\n \t\tprintf('<input type=\"hidden\" name=\"server_id\" value=\"%s\" />',$this->getServerID());\n \t\tprintf('<input type=\"hidden\" name=\"dn\" value=\"%s\" />',htmlspecialchars($this->template->getDN()));\n \t\tprintf('<input type=\"hidden\" name=\"template\" value=\"%s\" />',$this->template->getID());\n@@ -2194,13 +2208,13 @@ protected function drawJavascriptBinaryAttribute($attribute) {\n \t\techo '</form>';\n \n \t\techo '\n-<script type=\"text/javascript\" language=\"javascript\">\n+<script type=\"text/javascript\">\n function deleteAttribute(attrName,friendlyName,i)\n {\n \tif (confirm(\"'._('Really delete value from attribute').' \\'\" + friendlyName + \"\\'?\")) {\n-\t\tdocument.delete_attribute_form.attr.value = attrName;\n-\t\tdocument.delete_attribute_form.index.value = i;\n-\t\tdocument.delete_attribute_form.submit();\n+\t\tdocument.getElementById(\\'delete_attribute_form\\'.attr.value = attrName;\n+\t\tdocument.getElementById(\\'delete_attribute_form\\'.index.value = i;\n+\t\tdocument.getElementById(\\'delete_attribute_form\\'.submit();\n \t}\n }\n </script>';\n@@ -2224,9 +2238,9 @@ protected function drawJavaScriptDateAttribute($attribute) {\n \n \t\t# This JS may have been rendered by multiple Date attributes\n \t\tif (! $drawn) {\n-\t\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sjscalendar/lang/calendar-en.js\"></script>',JSDIR);\n-\t\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sjscalendar/calendar-setup.js\"></script>',JSDIR);\n-\t\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sdate_selector.js\"></script>',JSDIR);\n+\t\t\tprintf('<script type=\"text/javascript\" src=\"%sjscalendar/lang/calendar-en.js\"></script>',JSDIR);\n+\t\t\tprintf('<script type=\"text/javascript\" src=\"%sjscalendar/calendar-setup.js\"></script>',JSDIR);\n+\t\t\tprintf('<script type=\"text/javascript\" src=\"%sdate_selector.js\"></script>',JSDIR);\n \n \t\t\t$drawn = true;\n \t\t}\n@@ -2240,10 +2254,10 @@ protected function drawJavaScriptDateAttribute($attribute) {\n \t\t\t$config['format'] = $config['date'][$attribute->getName()];\n \n \t\tfor ($i=0;$i<=$attribute->getValueCount();$i++) {\n-\t\t\tprintf('<script type=\"text/javascript\" language=\"javascript\">defaults[\\'new_values_%s_%s\\'] = \\'%s\\';</script>',$attribute->getName(),$i,$config['format']);\n+\t\t\tprintf('<script type=\"text/javascript\">defaults[\\'new_values_%s_%s\\'] = \\'%s\\';</script>',$attribute->getName(),$i,$config['format']);\n \n \t\t\tif (in_array_ignore_case($attribute->getName(),array_keys($config['time'])) && ($config['time'][$attribute->getName()]))\n-\t\t\t\tprintf('<script type=\"text/javascript\" language=\"javascript\">defaults[\\'f_time_%s_%s\\'] = \\'%s\\';</script>',$attribute->getName(),$i,'true');\n+\t\t\t\tprintf('<script type=\"text/javascript\">defaults[\\'f_time_%s_%s\\'] = \\'%s\\';</script>',$attribute->getName(),$i,'true');\n \n \t\t\techo \"\\n\";\n \t\t}\n@@ -2256,7 +2270,7 @@ protected function drawJavaScriptDateAttribute($attribute) {\n \t * Draws an HTML date selector button which, when clicked, pops up a date selector dialog.\n \t */\n \tprotected function drawSelectorPopupDateAttribute($attribute,$i) {\n-\t\tprintf('<a href=\"javascript:dateSelector(\\'%s_%s\\');\" title=\"%s\"><img class=\"chooser\" src=\"%s/calendar.png\" id=\"f_trigger_%s_%s\" style=\"cursor: pointer;\" alt=\"Calendar\" /></a>',\n+\t\tprintf('<a href=\"javascript:dateSelector(\\'%s_%s\\');\" title=\"%s\"><img src=\"%s/calendar.png\" alt=\"Calendar\" class=\"chooser\" id=\"f_trigger_%s_%s\" style=\"cursor: pointer;\" /></a>',\n \t\t\t$attribute->getName(),$i,_('Click to popup a dialog to select a date graphically'),IMGDIR,$attribute->getName(),$i);\n \t}\n \n@@ -2299,7 +2313,7 @@ protected function drawJavascriptPasswordAttribute($attribute) {\n \n \t\t# Add the javascript so we can call check password later.\n \t\techo '\n-<script type=\"text/javascript\" language=\"javascript\">\n+<script type=\"text/javascript\">\n \tfunction passwordComparePopup(component_id) {\n \t\tmywindow = open(\\'password_checker.php\\',\\'myname\\',\\'resizable=no,width=500,height=200,scrollbars=1\\');\n \t\tmywindow.location.href = \\'password_checker.php?componentid=\\'+component_id;\n@@ -2337,7 +2351,7 @@ protected function drawJavascriptRandomPasswordAttribute($attribute) {\n \t\t$pwd = str_replace(\"'\",\"\\\\'\",$pwd);\n \n \t\tprintf(\"\\n<!-- %s -->\\n\",__METHOD__);\n-\t\techo '<script type=\"text/javascript\" language=\"javascript\">'.\"\\n\";\n+\t\techo '<script type=\"text/javascript\">'.\"\\n\";\n \t\techo 'var i = 0;'.\"\\n\";\n \t\tprintf('var component = document.getElementById(\\'new_values_%s_\\'+i);',$attribute->getName());\n \t\techo \"\\n\";\n@@ -2368,14 +2382,14 @@ protected function drawDefaultHelperPasswordAttribute($attribute,$i) {\n \t\t\t$default = $this->getServer()->getValue('appearance','password_hash');\n \n \t\tif (! $attribute->getPostValue())\n-\t\t\tprintf('<input type=\"hidden\" name=\"post_value[%s][]\" value=\"%s\"/>',$attribute->getName(),$i);\n+\t\t\tprintf('<input type=\"hidden\" name=\"post_value[%s][]\" value=\"%s\" />',$attribute->getName(),$i);\n \n \t\tprintf('<select name=\"%s[%s][%s]\" id=\"%s_%s_%s\">',\n \t\t\t$id,htmlspecialchars($attribute->getName()),$i,\n \t\t\t$id,htmlspecialchars($attribute->getName()),$i);\n \n \t\tforeach (password_types() as $v => $display)\n-\t\t\tprintf('<option value=\"%s\" %s>%s</option>',$v,($v == $default) ? 'selected' : '',$display);\n+\t\t\tprintf('<option value=\"%s\" %s>%s</option>',$v,($v == $default) ? 'selected=\"selected\"' : '',$display);\n \n \t\techo '</select>';\n \t}\n@@ -2384,7 +2398,7 @@ protected function drawDefaultHelperSambaPasswordAttribute($attribute,$i) {\n \t\t$id = 'enc';\n \n \t\tif (! $attribute->getPostValue())\n-\t\t\tprintf('<input type=\"hidden\" name=\"post_value[%s][]\" value=\"%s\"/>',$attribute->getName(),$i);\n+\t\t\tprintf('<input type=\"hidden\" name=\"post_value[%s][]\" value=\"%s\" />',$attribute->getName(),$i);\n \n \t\tswitch ($attribute->getName()) {\n \t\t\tcase 'sambalmpassword' : $enc = 'lm'; break;\n@@ -2394,7 +2408,7 @@ protected function drawDefaultHelperSambaPasswordAttribute($attribute,$i) {\n \t\t\t\treturn '';\n \t\t}\n \n-\t\tprintf('<input type=\"hidden\" name=\"%s[%s][%s]\" id=\"%s_%s_%s\" value=\"%s\">',\n+\t\tprintf('<input type=\"hidden\" name=\"%s[%s][%s]\" id=\"%s_%s_%s\" value=\"%s\" />',\n \t\t\t$id,htmlspecialchars($attribute->getName()),$i,\n \t\t\t$id,htmlspecialchars($attribute->getName()),$i,$enc);\n \t}"
            },
            {
                "sha": "15de838b7ef380d915fe95b02d8841bcdf0cef3c",
                "filename": "lib/functions.php",
                "status": "modified",
                "additions": 13,
                "deletions": 17,
                "changes": 30,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/lib%2Ffunctions.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/lib%2Ffunctions.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/lib%2Ffunctions.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -167,7 +167,7 @@ function app_error_handler($errno,$errstr,$file,$lineno) {\n \t\t$body .= sprintf('<tr><td>Web server:</td><td><b>%s</b></td></tr>',isset($_SERVER['SERVER_SOFTWARE']) ? $_SERVER['SERVER_SOFTWARE'] : 'SCRIPT');\n \n \t\tif (function_exists('get_href'))\n-\t\t\t$body .= sprintf('<tr><td colspan=\"2\"><a href=\"%s\" target=\"_blank\"><center>%s.</center></a></td></tr>',\n+\t\t\t$body .= sprintf('<tr><td colspan=\"2\"><a href=\"%s\" onclick=\"target=\\'_blank\\';\"><center>%s.</center></a></td></tr>',\n \t\t\t\tget_href('search_bug',\"&summary_keyword=\".rawurlencode($errstr)),\n \t\t\t\t_('Please check and see if this bug has been reported'));\n \t\t$body .= '</table>';\n@@ -375,31 +375,31 @@ function cmd_control_pane($type) {\n \t\t\t\t'forum'=>array(\n \t\t\t\t\t'title'=>_('Forum'),\n \t\t\t\t\t'enable'=>isset($_SESSION[APPCONFIG]) ? $_SESSION[APPCONFIG]->isCommandAvailable('cmd','oslinks') : true,\n-\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" target=\"_blank\"',get_href('forum'),_('Forum')),\n+\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" onclick=\"target=\\'_blank\\';\"',get_href('forum'),_('Forum')),\n \t\t\t\t\t'image'=>sprintf('<img src=\"%s/forum-big.png\" alt=\"%s\" />',IMGDIR,_('Forum'))),\n \n \t\t\t\t'feature'=>array(\n \t\t\t\t\t'title'=>_('Request feature'),\n \t\t\t\t\t'enable'=>isset($_SESSION[APPCONFIG]) ? $_SESSION[APPCONFIG]->isCommandAvailable('cmd','oslinks') : true,\n-\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" target=\"_blank\"',get_href('add_rfe'),_('Request feature')),\n+\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" onclick=\"target=\\'_blank\\';\"',get_href('add_rfe'),_('Request feature')),\n \t\t\t\t\t'image'=>sprintf('<img src=\"%s/request-feature-big.png\" alt=\"%s\" />',IMGDIR,_('Request feature'))),\n \n \t\t\t\t'bug'=>array(\n \t\t\t\t\t'title'=>_('Report a bug'),\n \t\t\t\t\t'enable'=>isset($_SESSION[APPCONFIG]) ? $_SESSION[APPCONFIG]->isCommandAvailable('cmd','oslinks') : true,\n-\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" target=\"_blank\"',get_href('add_bug'),_('Report a bug')),\n+\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" onclick=\"target=\\'_blank\\';\"',get_href('add_bug'),_('Report a bug')),\n \t\t\t\t\t'image'=>sprintf('<img src=\"%s/bug-big.png\" alt=\"%s\" />',IMGDIR,_('Report a bug'))),\n \n \t\t\t\t'donation'=>array(\n \t\t\t\t\t'title'=>_('Donate'),\n \t\t\t\t\t'enable'=>isset($_SESSION[APPCONFIG]) ? $_SESSION[APPCONFIG]->isCommandAvailable('cmd','oslinks') : true,\n-\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" target=\"_blank\"',get_href('donate'),_('Donate')),\n+\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" onclick=\"target=\\'_blank\\';\"',get_href('donate'),_('Donate')),\n \t\t\t\t\t'image'=>sprintf('<img src=\"%s/smile-big.png\" alt=\"%s\" />',IMGDIR,_('Donate'))),\n \n \t\t\t\t'help'=>array(\n \t\t\t\t\t'title'=>_('Help'),\n \t\t\t\t\t'enable'=>isset($_SESSION[APPCONFIG]) ? $_SESSION[APPCONFIG]->isCommandAvailable('cmd','oslinks') : true,\n-\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" target=\"_blank\"',get_href('documentation'),_('Help')),\n+\t\t\t\t\t'link'=>sprintf('href=\"%s\" title=\"%s\" onclick=\"target=\\'_blank\\';\"',get_href('documentation'),_('Help')),\n \t\t\t\t\t'image'=>sprintf('<img src=\"%s/help-big.png\" alt=\"%s\" />',IMGDIR,_('Help')))\n \t\t\t);\n \n@@ -615,7 +615,7 @@ function error($msg,$type='note',$redirect=null,$fatal=false,$backtrace=false) {\n \t\t\t\t$display = strlen(serialize($line['args'])) < 50 ? htmlspecialchars(serialize($line['args'])) : htmlspecialchars(substr(serialize($line['args']),0,50)).'...<TRUNCATED>';\n \t\t\t\t$_SESSION['backtrace'][$error]['args'] = $line['args'];\n \t\t\t\tif (file_exists(LIBDIR.'../tools/unserialize.php'))\n-\t\t\t\t\t$body .= sprintf('&nbsp;(<a href=\"%s?index=%s\" target=\"backtrace\">%s</a>)',\n+\t\t\t\t\t$body .= sprintf('&nbsp;(<a href=\"%s?index=%s\" onclick=\"target=\\'backtrace\\';\">%s</a>)',\n \t\t\t\t\t\t'../tools/unserialize.php',$error,$display);\n \t\t\t\telse\n \t\t\t\t\t$body .= sprintf('&nbsp;(%s)',$display);\n@@ -1919,7 +1919,7 @@ function support_oid_to_text($key) {\n \t\t\tif ($oid_id) {\n \t\t\t\t$CACHE[$oid_id]['title'] = isset($entry[4]) ? $entry[4] : null;\n \t\t\t\t$CACHE[$oid_id]['ref'] = isset($entry[6]) ? $entry[6] : null;\n-\t\t\t\t$desc = isset($entry[8]) ? $entry[8] : sprintf('<acryonym title=\"%s\"><small>%s</small></acryonym>',$unknown['desc'],$unknown['title']);\n+\t\t\t\t$desc = isset($entry[8]) ? $entry[8] : sprintf('<acronym title=\"%s\">%s</acronym>',$unknown['desc'],$unknown['title']);\n \t\t\t\t$CACHE[$oid_id]['desc'] = preg_replace('/\\s+/',' ',$desc);\n \t\t\t}\n \t\t}\n@@ -1931,7 +1931,7 @@ function support_oid_to_text($key) {\n \t\treturn array(\n \t\t\t'title'=>$key,\n \t\t\t'ref'=>null,\n-\t\t\t'desc'=>sprintf('<acryonym title=\"%s\"><small>%s</small></acryonym>',$unknown['desc'],$unknown['title']));\n+\t\t\t'desc'=>sprintf('<acronym title=\"%s\">%s</acronym>',$unknown['desc'],$unknown['title']));\n }\n \n /**\n@@ -1941,7 +1941,7 @@ function ldap_error_msg($msg,$errnum) {\n \tif (DEBUG_ENABLED && (($fargs=func_get_args())||$fargs='NOARGS'))\n \t\tdebug_log('Entered (%%)',1,0,__FILE__,__LINE__,__METHOD__,$fargs);\n \n-\t$body = '<table border=0>';\n+\t$body = '<table border=\"0\">';\n \n \t$errnum = ('0x'.str_pad(dechex($errnum),2,0,STR_PAD_LEFT));\n \t$verbose_error = pla_verbose_error($errnum);\n@@ -2386,15 +2386,11 @@ function get_enc_type($user_password) {\n  *         \"edit_form.member_uid\". See /templates/modification/default.php for example usage.\n  * @param boolean (optional) If true, the function draws the localized text \"choose\" to the right of the button.\n  */\n-function draw_chooser_link($form_element,$include_choose_text=true,$rdn='none') {\n+function draw_chooser_link($form,$element,$include_choose_text=true,$rdn='none') {\n \tif (DEBUG_ENABLED && (($fargs=func_get_args())||$fargs='NOARGS'))\n \t\tdebug_log('Entered (%%)',1,0,__FILE__,__LINE__,__METHOD__,$fargs);\n \n-\tif ($rdn == 'none')\n-\t\t$href = sprintf(\"javascript:dnChooserPopup('%s','');\",$form_element);\n-\telse\n-\t\t$href = sprintf(\"javascript:dnChooserPopup('%s','%s');\",$form_element,$rdn);\n-\n+\t$href = sprintf(\"javascript:dnChooserPopup('%s','%s','%s');\",$form,$element,$rdn == 'none' ? '' : rawurlencode($rdn));\n \t$title = _('Click to popup a dialog to select an entry (DN) graphically');\n \n \tprintf('<a href=\"%s\" title=\"%s\"><img class=\"chooser\" src=\"%s/find.png\" alt=\"Find\" /></a>',$href,$title,IMGDIR);\n@@ -2795,7 +2791,7 @@ function server_select_list($selected=null,$logged_on=false,$name='index',$isVis\n \n \t\t\t$count++;\n \t\t\t$server_menu_html .= sprintf('<option value=\"%s\" %s>%s</option>',\n-\t\t\t\t$server->getIndex(),($server->getIndex() == $selected ? 'selected' : ''),$server->getName());\n+\t\t\t\t$server->getIndex(),($server->getIndex() == $selected ? 'selected=\"selected\"' : ''),$server->getName());\n \n \t\t\t# We will set this variable, in case there is only 1 hit.\n \t\t\t$selected_server = $server;"
            },
            {
                "sha": "aedccc724ef1f0355e838b0c18920bf4ac8faeac",
                "filename": "lib/page.php",
                "status": "modified",
                "additions": 19,
                "deletions": 21,
                "changes": 40,
                "blob_url": "https://github.com/leenooks/phpLDAPadmin/blob/f713afc8d164169516c91b0988531f2accb9bce6/lib%2Fpage.php",
                "raw_url": "https://github.com/leenooks/phpLDAPadmin/raw/f713afc8d164169516c91b0988531f2accb9bce6/lib%2Fpage.php",
                "contents_url": "https://api.github.com/repos/leenooks/phpLDAPadmin/contents/lib%2Fpage.php?ref=f713afc8d164169516c91b0988531f2accb9bce6",
                "patch": "@@ -79,12 +79,10 @@ public function __construct($index=null) {\n \t\tob_start();\n \n \t\t# Initial Values\n-\t\t$this->_pageheader[] .= '<?xml version=\"1.0\" encoding=\"utf-8\"?>'.\"\\n\";\n-\t\t$this->_pageheader[] .= '<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML Basic 1.0//EN\"'.\"\\n\";\n-\t\t$this->_pageheader[] .= '\"http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd\">'.\"\\n\";\n-\t\t$this->_pageheader[] .= \"\\n\";\n-\t\t$this->_pageheader[] .= '<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"auto\" lang=\"auto\" dir=\"ltr\">'.\"\\n\";\n-\t\t$this->_pageheader[] .= \"\\n\";\n+\t\t#$this->_pageheader[] .= '<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML Basic 1.0//EN\"';\n+\t\t#$this->_pageheader[] .= '\"http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd\">'.\"\\n\";\n+\t\t$this->_pageheader[] = '<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">';\n+\t\t$this->_pageheader[] .= '<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"auto\">'.\"\\n\";\n \t}\n \n \t/* Add to the HTML Header */\n@@ -121,8 +119,8 @@ private function pageheader_print() {\n \t\tif (defined('JSDIR')) {\n \t\t\tprintf('<link type=\"text/css\" rel=\"stylesheet\" media=\"all\" href=\"%sjscalendar/calendar-blue.css\" title=\"blue\" />',JSDIR);\n \t\t\techo \"\\n\";\n-\t\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sajax_functions.js\"></script>',JSDIR);\n-\t\t\tprintf('<script type=\"text/javascript\" language=\"javascript\" src=\"%sjscalendar/calendar.js\"></script>',JSDIR);\n+\t\t\tprintf('<script type=\"text/javascript\" src=\"%sajax_functions.js\"></script>',JSDIR);\n+\t\t\tprintf('<script type=\"text/javascript\" src=\"%sjscalendar/calendar.js\"></script>',JSDIR);\n \t\t\techo \"\\n\";\n \t\t}\n \n@@ -146,8 +144,8 @@ private function head_print() {\n \n \t\techo '<tr class=\"pagehead\">';\n \n-\t\techo '<td colspan=3><div id=\"ajHEAD\"><table width=100% border=0><tr>';\n-\t\tprintf('<td align=\"left\"><a href=\"%s\" target=\"_blank\"><img src=\"%s\" alt=\"Logo\" class=\"logo\" /></a></td>',get_href('sf'),$this->_app['logo']);\n+\t\techo '<td colspan=\"3\"><div id=\"ajHEAD\"><table width=\"100%\" border=\"0\"><tr>';\n+\t\tprintf('<td style=\"text-align: left;\"><a href=\"%s\" onclick=\"target=\\'_blank\\';\"><img src=\"%s\" alt=\"Logo\" class=\"logo\" /></a></td>',get_href('sf'),$this->_app['logo']);\n \n \t\techo '<td class=\"imagetop\">';\n \t\t$empty = true;\n@@ -175,7 +173,7 @@ private function control_print() {\n \t\tif (defined('DEBUG_ENABLED') && DEBUG_ENABLED && (($fargs=func_get_args())||$fargs='NOARGS'))\n \t\t\tdebug_log('Entered (%%)',129,0,__FILE__,__LINE__,__METHOD__,$fargs);\n \n-\t\techo '<table class=\"control\" width=100% border=0>';\n+\t\techo '<table class=\"control\" width=\"100%\" border=\"0\">';\n \t\techo '<tr><td>';\n \n \t\t$empty = true;\n@@ -210,7 +208,7 @@ protected function tree() {\n \t\t\t$this->index = min(array_keys($_SESSION[APPCONFIG]->getServerList()));\n \n \t\tif (count($_SESSION[APPCONFIG]->getServerList()) > 1) {\n-\t\t\techo '<form name=\"server_select\" action=\"cmd.php\" method=\"post\">';\n+\t\t\techo '<form id=\"server_select\" action=\"cmd.php\" method=\"post\">';\n \t\t\techo '<table class=\"server_select\"><tr><td>';\n \t\t\tprintf('%s:<br />%s',_('Server Select'),\n \t\t\t\tserver_select_list($this->index,false,'index',true,sprintf(\"onchange=\\\"tree_unhide('index',%s)\\\"\",$this->index)));\n@@ -245,7 +243,7 @@ private function block_print($side) {\n \t\tif (! isset($this->_block[$side]))\n \t\t\treturn;\n \n-\t\tprintf('<td class=\"%s\" colspan=2>',$side);\n+\t\tprintf('<td class=\"%s\" colspan=\"2\">',$side);\n \t\tforeach ($this->_block[$side] as $object)\n \t\t\techo $object->draw($side);\n \t\techo '</td>';\n@@ -273,7 +271,7 @@ private function sysmsg() {\n \t\t\t\t}\n \n \t\t\t\tif (isset($details['title']))\n-\t\t\t\t\tprintf('<tr><td class=\"icon\" rowspan=2 align=\"right\"><img src=\"%s\" alt=\"%s\" /></td><td class=\"head\" align=\"right\">%s</td></tr>',\n+\t\t\t\t\tprintf('<tr><td class=\"icon\" rowspan=\"2\"><img src=\"%s\" alt=\"%s\" /></td><td class=\"head\">%s</td></tr>',\n \t\t\t\t\t\t$icon,$details['type'],$details['title']);\n \n \t\t\t\tif (isset($details['body']))\n@@ -317,10 +315,10 @@ private function footer_print() {\n \t\tif (defined('DEBUG_ENABLED') && DEBUG_ENABLED && (($fargs=func_get_args())||$fargs='NOARGS'))\n \t\t\tdebug_log('Entered (%%)',129,0,__FILE__,__LINE__,__METHOD__,$fargs);\n \n-\t\tprintf('<tr class=\"foot\"><td><small>%s</small></td><td colspan=2><div id=\"ajFOOT\">%s</div>%s</td></tr>',\n+\t\tprintf('<tr class=\"foot\"><td><small>%s</small></td><td colspan=\"2\"><div id=\"ajFOOT\">%s</div>%s</td></tr>',\n \t\t\tisCompress() ? '[C]' : '&nbsp;',\n \t\t\tapp_version(),\n-\t\t\tget_href('logo') ? sprintf('<a href=\"%s\"><img src=\"%s\" border=\"0\" alt=\"SourceForge.net Logo\" /></a>',get_href('sf'),get_href('logo')) : '&nbsp;');\n+\t\t\tget_href('logo') ? sprintf('<a href=\"%s\"><img src=\"%s\" alt=\"SourceForge.net Logo\" style=\"border: 0px;\" /></a>',get_href('sf'),get_href('logo')) : '&nbsp;');\n \t}\n \n \t/**\n@@ -382,14 +380,14 @@ public function display($filter=array()) {\n \t\t# Page Header\n \t\techo '<body>';\n \t\techo \"\\n\";\n-\t\techo '<table class=\"page\" border=0 width=100%>';\n+\t\techo '<table class=\"page\" border=\"0\" width=\"100%\">';\n \n \t\tif ($display['HEAD'])\n \t\t\t$this->head_print();\n \n \t\t# Control Line\n \t\tif ($display['CONTROL']) {\n-\t\t\techo '<tr class=\"control\"><td colspan=3>';\n+\t\t\techo '<tr class=\"control\"><td colspan=\"3\">';\n \t\t\techo '<div id=\"ajCONTROL\">';\n \t\t\t$this->control_print();\n \t\t\techo '</div></td></tr>';\n@@ -400,15 +398,15 @@ public function display($filter=array()) {\n \t\techo '<tr>';\n \n \t\tif ($display['TREE']) {\n-\t\t\techo '<td class=\"tree\" colspan=2>';\n-\t\t\tprintf('<acronym title=\"%s\"><img src=\"%s/plus.png\" align=\"right\" onClick=\"if (document.getElementById(\\'ajTREE\\').style.display == \\'none\\') { document.getElementById(\\'ajTREE\\').style.display = \\'block\\' } else { document.getElementById(\\'ajTREE\\').style.display = \\'none\\' };\"/></acronym>',_('Hide/Unhide the tree'),IMGDIR);\n+\t\t\techo '<td class=\"tree\" colspan=\"2\">';\n+\t\t\tprintf('<acronym title=\"%s\"><img src=\"%s/plus.png\" alt=\"\" style=\"float: right;\" onclick=\"if (document.getElementById(\\'ajTREE\\').style.display == \\'none\\') { document.getElementById(\\'ajTREE\\').style.display = \\'block\\' } else { document.getElementById(\\'ajTREE\\').style.display = \\'none\\' };\"/></acronym>',_('Hide/Unhide the tree'),IMGDIR);\n \t\t\techo '<div id=\"ajTREE\">';\n \t\t\t$this->tree();\n \t\t\techo '</div>';\n \t\t\techo '</td>';\n \t\t}\n \n-\t\techo '<td class=\"body\" width=80%>';\n+\t\techo '<td class=\"body\" style=\"width: 80%;\">';\n \t\techo '<div id=\"ajBODY\">';\n \t\techo \"\\n\";\n \t\t$this->body();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/kanboard/kanboard/commits/7ce61c34d962ca8b5dce776289ddf4b207be6e78",
        "url": "https://api.github.com/repos/kanboard/kanboard/commits/7ce61c34d962ca8b5dce776289ddf4b207be6e78",
        "html_url": "https://github.com/kanboard/kanboard/commit/7ce61c34d962ca8b5dce776289ddf4b207be6e78",
        "message": "fix: verify the session hasn't expired before returning data",
        "files": [
            {
                "sha": "464170dd143b4dc65d627145cf1f6ef115d70bef",
                "filename": "app/Core/Session/SessionHandler.php",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/kanboard/kanboard/blob/7ce61c34d962ca8b5dce776289ddf4b207be6e78/app%2FCore%2FSession%2FSessionHandler.php",
                "raw_url": "https://github.com/kanboard/kanboard/raw/7ce61c34d962ca8b5dce776289ddf4b207be6e78/app%2FCore%2FSession%2FSessionHandler.php",
                "contents_url": "https://api.github.com/repos/kanboard/kanboard/contents/app%2FCore%2FSession%2FSessionHandler.php?ref=7ce61c34d962ca8b5dce776289ddf4b207be6e78",
                "patch": "@@ -51,7 +51,10 @@ public function open($savePath, $name)\n     #[\\ReturnTypeWillChange]\n     public function read($sessionID)\n     {\n-        $result = $this->db->table(self::TABLE)->eq('id', $sessionID)->findOneColumn('data');\n+        $result = $this->db->table(self::TABLE)->eq('id', $sessionID)->gt('expire_at', time())->findOneColumn('data');\n+\n+        // Note: Returning false display an error message and write() is never called\n+        // preventing new sessions to be created when calling session_start()\n         return $result ?: '';\n     }\n "
            },
            {
                "sha": "4943caaefe10e3f41f409f2559fca3fed8de286d",
                "filename": "docker/etc/php83/conf.d/local.ini",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/kanboard/kanboard/blob/7ce61c34d962ca8b5dce776289ddf4b207be6e78/docker%2Fetc%2Fphp83%2Fconf.d%2Flocal.ini",
                "raw_url": "https://github.com/kanboard/kanboard/raw/7ce61c34d962ca8b5dce776289ddf4b207be6e78/docker%2Fetc%2Fphp83%2Fconf.d%2Flocal.ini",
                "contents_url": "https://api.github.com/repos/kanboard/kanboard/contents/docker%2Fetc%2Fphp83%2Fconf.d%2Flocal.ini?ref=7ce61c34d962ca8b5dce776289ddf4b207be6e78",
                "patch": "@@ -13,3 +13,5 @@ opcache.save_comments = 0\n opcache.enable_file_override = 1\n opcache.jit_buffer_size = 100M\n opcache.jit = tracing\n+session.gc_divisor = 100\n+session.gc_probability = 15"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/withastro/astro/commits/e7d14c374b9d45e27089994a4eb72186d05514de",
        "url": "https://api.github.com/repos/withastro/astro/commits/e7d14c374b9d45e27089994a4eb72186d05514de",
        "html_url": "https://github.com/withastro/astro/commit/e7d14c374b9d45e27089994a4eb72186d05514de",
        "message": "fix: `checkOrigin` headers check (#12632)\n\n* Merge commit from fork\n\n* fix: enforce check origin logic\n\n* address feedback\n\n* --amend",
        "files": [
            {
                "sha": "75f5f82271555cf492238d237c0d9ef63a124038",
                "filename": ".changeset/swift-pandas-serve.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/withastro/astro/blob/e7d14c374b9d45e27089994a4eb72186d05514de/.changeset%2Fswift-pandas-serve.md",
                "raw_url": "https://github.com/withastro/astro/raw/e7d14c374b9d45e27089994a4eb72186d05514de/.changeset%2Fswift-pandas-serve.md",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/.changeset%2Fswift-pandas-serve.md?ref=e7d14c374b9d45e27089994a4eb72186d05514de",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'astro': patch\n+---\n+\n+Fixes an issue where the `checkOrigin` feature wasn't correctly checking the `content-type` header"
            },
            {
                "sha": "f89f5c6682727de3c55d45891b64b3aca256a4ef",
                "filename": "packages/astro/src/core/app/middlewares.ts",
                "status": "modified",
                "additions": 36,
                "deletions": 15,
                "changes": 51,
                "blob_url": "https://github.com/withastro/astro/blob/e7d14c374b9d45e27089994a4eb72186d05514de/packages%2Fastro%2Fsrc%2Fcore%2Fapp%2Fmiddlewares.ts",
                "raw_url": "https://github.com/withastro/astro/raw/e7d14c374b9d45e27089994a4eb72186d05514de/packages%2Fastro%2Fsrc%2Fcore%2Fapp%2Fmiddlewares.ts",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Fsrc%2Fcore%2Fapp%2Fmiddlewares.ts?ref=e7d14c374b9d45e27089994a4eb72186d05514de",
                "patch": "@@ -21,22 +21,43 @@ const FORM_CONTENT_TYPES = [\n export function createOriginCheckMiddleware(): MiddlewareHandler {\n \treturn defineMiddleware((context, next) => {\n \t\tconst { request, url } = context;\n-\t\tconst contentType = request.headers.get('content-type');\n-\t\tif (contentType) {\n-\t\t\tif (FORM_CONTENT_TYPES.includes(contentType.toLowerCase())) {\n-\t\t\t\tconst forbidden =\n-\t\t\t\t\t(request.method === 'POST' ||\n-\t\t\t\t\t\trequest.method === 'PUT' ||\n-\t\t\t\t\t\trequest.method === 'PATCH' ||\n-\t\t\t\t\t\trequest.method === 'DELETE') &&\n-\t\t\t\t\trequest.headers.get('origin') !== url.origin;\n-\t\t\t\tif (forbidden) {\n-\t\t\t\t\treturn new Response(`Cross-site ${request.method} form submissions are forbidden`, {\n-\t\t\t\t\t\tstatus: 403,\n-\t\t\t\t\t});\n-\t\t\t\t}\n+\t\tif (request.method === \"GET\") {\n+\t\t\treturn next();\n+\t\t}\n+\t\tconst sameOrigin =\n+\t\t\t(request.method === 'POST' ||\n+\t\t\t\trequest.method === 'PUT' ||\n+\t\t\t\trequest.method === 'PATCH' ||\n+\t\t\t\trequest.method === 'DELETE') &&\n+\t\t\trequest.headers.get('origin') === url.origin;\n+\t\t\n+\t\tconst hasContentType = request.headers.has('content-type')\n+\t\tif (hasContentType) {\n+\t\t\tconst formLikeHeader = hasFormLikeHeader(request.headers.get('content-type'));\n+\t\t\tif (formLikeHeader && !sameOrigin) {\n+\t\t\t\treturn new Response(`Cross-site ${request.method} form submissions are forbidden`, {\n+\t\t\t\t\tstatus: 403,\n+\t\t\t\t});\n+\t\t\t}\n+\t\t} else {\n+\t\t\tif (!sameOrigin) {\n+\t\t\t\treturn new Response(`Cross-site ${request.method} form submissions are forbidden`, {\n+\t\t\t\t\tstatus: 403,\n+\t\t\t\t});\n \t\t\t}\n \t\t}\n-\t\treturn next();\n+\n+\t\treturn next()\n \t});\n }\n+\n+function hasFormLikeHeader(contentType: string | null): boolean {\n+\tif (contentType) {\n+\t\tfor (const FORM_CONTENT_TYPE of FORM_CONTENT_TYPES) {\n+\t\t\tif (contentType.toLowerCase().includes(FORM_CONTENT_TYPE)) {\n+\t\t\t\treturn true;\n+\t\t\t}\n+\t\t}\n+\t}\n+\treturn false;\n+}"
            },
            {
                "sha": "f8067000d23cddb6fb3f66893e69d7e3a72907ff",
                "filename": "packages/astro/test/csrf-protection.test.js",
                "status": "modified",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/withastro/astro/blob/e7d14c374b9d45e27089994a4eb72186d05514de/packages%2Fastro%2Ftest%2Fcsrf-protection.test.js",
                "raw_url": "https://github.com/withastro/astro/raw/e7d14c374b9d45e27089994a4eb72186d05514de/packages%2Fastro%2Ftest%2Fcsrf-protection.test.js",
                "contents_url": "https://api.github.com/repos/withastro/astro/contents/packages%2Fastro%2Ftest%2Fcsrf-protection.test.js?ref=e7d14c374b9d45e27089994a4eb72186d05514de",
                "patch": "@@ -46,6 +46,22 @@ describe('CSRF origin check', () => {\n \t\t});\n \t\tresponse = await app.render(request);\n \t\tassert.equal(response.status, 403);\n+\n+\t\trequest = new Request('http://example.com/api/', {\n+\t\t\theaders: { origin: 'http://loreum.com', 'content-type': 'application/x-www-form-urlencoded; some-other-value' },\n+\t\t\tmethod: 'POST',\n+\t\t});\n+\t\tresponse = await app.render(request);\n+\t\tassert.equal(response.status, 403);\n+\n+\t\trequest = new Request('http://example.com/api/', {\n+\t\t\theaders: { origin: 'http://loreum.com', },\n+\t\t\tmethod: 'POST',\n+\t\t\tcredentials: 'include',\n+\t\t\tbody: new Blob([\"a=b\"],{})\n+\t\t});\n+\t\tresponse = await app.render(request);\n+\t\tassert.equal(response.status, 403);\n \t});\n \n \tit(\"return 403 when the origin doesn't match and calling a PUT\", async () => {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/craftcms/cms/commits/82e893fb794d30563da296bca31379c0df0079b3",
        "url": "https://api.github.com/repos/craftcms/cms/commits/82e893fb794d30563da296bca31379c0df0079b3",
        "html_url": "https://github.com/craftcms/cms/commit/82e893fb794d30563da296bca31379c0df0079b3",
        "message": "Fixed an RCE vulnerability",
        "files": [
            {
                "sha": "aa13552dbe9741f629e4f031d9594393d3822a9a",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/craftcms/cms/blob/82e893fb794d30563da296bca31379c0df0079b3/CHANGELOG.md",
                "raw_url": "https://github.com/craftcms/cms/raw/82e893fb794d30563da296bca31379c0df0079b3/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/craftcms/cms/contents/CHANGELOG.md?ref=82e893fb794d30563da296bca31379c0df0079b3",
                "patch": "@@ -1,5 +1,9 @@\n # Release Notes for Craft CMS 4\n \n+## Unreleased\n+\n+- Fixed an RCE vulnerability.\n+\n ## 4.13.1.1 - 2024-11-18\n \n - Fixed a PHP error. ([#16142](https://github.com/craftcms/cms/issues/16142))"
            },
            {
                "sha": "f123f4c04cd091e0ea6a2864b5ea74f813f37ce5",
                "filename": "bootstrap/bootstrap.php",
                "status": "modified",
                "additions": 10,
                "deletions": 7,
                "changes": 17,
                "blob_url": "https://github.com/craftcms/cms/blob/82e893fb794d30563da296bca31379c0df0079b3/bootstrap%2Fbootstrap.php",
                "raw_url": "https://github.com/craftcms/cms/raw/82e893fb794d30563da296bca31379c0df0079b3/bootstrap%2Fbootstrap.php",
                "contents_url": "https://api.github.com/repos/craftcms/cms/contents/bootstrap%2Fbootstrap.php?ref=82e893fb794d30563da296bca31379c0df0079b3",
                "patch": "@@ -27,8 +27,15 @@\n // Determine the paths\n // -----------------------------------------------------------------------------\n \n-$findConfig = function(string $cliName, string $envName) {\n-    return App::cliOption($cliName, true) ?? App::env($envName);\n+$findConfig = function(string $cliName, string $envName) use ($appType) {\n+    if ($appType === 'console') {\n+        $value = App::cliOption($cliName, true);\n+        if ($value !== null) {\n+            return $value;\n+        }\n+    }\n+\n+    return App::env($envName);\n };\n \n // Set the vendor path. By default assume that it's 4 levels up from here\n@@ -49,11 +56,7 @@\n // Set the environment\n // -----------------------------------------------------------------------------\n \n-$environment = App::cliOption('--env', true)\n-    ?? App::env('CRAFT_ENVIRONMENT')\n-    ?? App::env('ENVIRONMENT')\n-    ?? $_SERVER['SERVER_NAME']\n-    ?? null;\n+$environment = $findConfig('--env', 'CRAFT_ENVIRONMENT') ?? App::env('ENVIRONMENT') ?? $_SERVER['SERVER_NAME'] ?? null;\n \n // Load the general config\n // -----------------------------------------------------------------------------"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/envoyproxy/envoy/commits/da56f6da63079baecef9183436ee5f4141a59af8",
        "url": "https://api.github.com/repos/envoyproxy/envoy/commits/da56f6da63079baecef9183436ee5f4141a59af8",
        "html_url": "https://github.com/envoyproxy/envoy/commit/da56f6da63079baecef9183436ee5f4141a59af8",
        "message": "[balsa] fix for 1xx response mixup\n\nSigned-off-by: Paul Ogilby <pgal@google.com>\n\nSigned-off-by: Ryan Northey <ryan@synca.io>",
        "files": [
            {
                "sha": "24a72f4122fb7a2b4b1813f98b2790eea2340f4b",
                "filename": "changelogs/current.yaml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/changelogs%2Fcurrent.yaml",
                "raw_url": "https://github.com/envoyproxy/envoy/raw/da56f6da63079baecef9183436ee5f4141a59af8/changelogs%2Fcurrent.yaml",
                "contents_url": "https://api.github.com/repos/envoyproxy/envoy/contents/changelogs%2Fcurrent.yaml?ref=da56f6da63079baecef9183436ee5f4141a59af8",
                "patch": "@@ -169,6 +169,10 @@ bug_fixes:\n - area: happy_eyeballs\n   change: |\n     Validate that ``additional_address`` are IP addresses instead of crashing when sorting.\n+- area: balsa\n+  change: |\n+    Fix incorrect handling of non-101 1xx responses. This fix can be temporarily reverted by setting runtime guard\n+    ``envoy.reloadable_features.wait_for_first_byte_before_balsa_msg_done`` to false.\n \n removed_config_or_runtime:\n # *Normally occurs at the end of the* :ref:`deprecation period <deprecated>`"
            },
            {
                "sha": "70493fc0ec4d1c0a152d0bc1672d7f19cf2a50aa",
                "filename": "source/common/http/http1/balsa_parser.cc",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/source%2Fcommon%2Fhttp%2Fhttp1%2Fbalsa_parser.cc",
                "raw_url": "https://github.com/envoyproxy/envoy/raw/da56f6da63079baecef9183436ee5f4141a59af8/source%2Fcommon%2Fhttp%2Fhttp1%2Fbalsa_parser.cc",
                "contents_url": "https://api.github.com/repos/envoyproxy/envoy/contents/source%2Fcommon%2Fhttp%2Fhttp1%2Fbalsa_parser.cc?ref=da56f6da63079baecef9183436ee5f4141a59af8",
                "patch": "@@ -360,7 +360,10 @@ void BalsaParser::HeaderDone() {\n void BalsaParser::ContinueHeaderDone() {}\n \n void BalsaParser::MessageDone() {\n-  if (status_ == ParserStatus::Error) {\n+  if (status_ == ParserStatus::Error ||\n+      // In the case of early 1xx, MessageDone() can be called twice in a row.\n+      // The !first_byte_processed_ check is to make this function idempotent.\n+      (wait_for_first_byte_before_msg_done_ && !first_byte_processed_)) {\n     return;\n   }\n   status_ = convertResult(connection_->onMessageComplete());"
            },
            {
                "sha": "321dc0a01bfb7623e0f4eb6bb752ab21e3193ff2",
                "filename": "source/common/http/http1/balsa_parser.h",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/source%2Fcommon%2Fhttp%2Fhttp1%2Fbalsa_parser.h",
                "raw_url": "https://github.com/envoyproxy/envoy/raw/da56f6da63079baecef9183436ee5f4141a59af8/source%2Fcommon%2Fhttp%2Fhttp1%2Fbalsa_parser.h",
                "contents_url": "https://api.github.com/repos/envoyproxy/envoy/contents/source%2Fcommon%2Fhttp%2Fhttp1%2Fbalsa_parser.h?ref=da56f6da63079baecef9183436ee5f4141a59af8",
                "patch": "@@ -85,6 +85,9 @@ class BalsaParser : public Parser, public quiche::BalsaVisitorInterface {\n   // Latched value of `envoy.reloadable_features.http1_balsa_delay_reset`.\n   const bool delay_reset_ =\n       Runtime::runtimeFeatureEnabled(\"envoy.reloadable_features.http1_balsa_delay_reset\");\n+  // Latched value of `envoy.reloadable_features.wait_for_first_byte_before_balsa_msg_done`.\n+  const bool wait_for_first_byte_before_msg_done_ = Runtime::runtimeFeatureEnabled(\n+      \"envoy.reloadable_features.wait_for_first_byte_before_balsa_msg_done\");\n };\n \n } // namespace Http1"
            },
            {
                "sha": "c1d277f380003a8cbe4a5610785e98da5a20f537",
                "filename": "source/common/runtime/runtime_features.cc",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/source%2Fcommon%2Fruntime%2Fruntime_features.cc",
                "raw_url": "https://github.com/envoyproxy/envoy/raw/da56f6da63079baecef9183436ee5f4141a59af8/source%2Fcommon%2Fruntime%2Fruntime_features.cc",
                "contents_url": "https://api.github.com/repos/envoyproxy/envoy/contents/source%2Fcommon%2Fruntime%2Fruntime_features.cc?ref=da56f6da63079baecef9183436ee5f4141a59af8",
                "patch": "@@ -102,6 +102,7 @@ RUNTIME_GUARD(envoy_reloadable_features_use_route_host_mutation_for_auto_sni_san\n RUNTIME_GUARD(envoy_reloadable_features_use_typed_metadata_in_proxy_protocol_listener);\n RUNTIME_GUARD(envoy_reloadable_features_validate_connect);\n RUNTIME_GUARD(envoy_reloadable_features_validate_upstream_headers);\n+RUNTIME_GUARD(envoy_reloadable_features_wait_for_first_byte_before_balsa_msg_done);\n RUNTIME_GUARD(envoy_reloadable_features_xds_failover_to_primary_enabled);\n RUNTIME_GUARD(envoy_reloadable_features_xds_prevent_resource_copy);\n RUNTIME_GUARD(envoy_reloadable_features_xdstp_path_avoid_colon_encoding);"
            },
            {
                "sha": "809ab849d9fd3b7ececfbd41ce0174f220c5c155",
                "filename": "test/integration/protocol_integration_test.cc",
                "status": "modified",
                "additions": 84,
                "deletions": 0,
                "changes": 84,
                "blob_url": "https://github.com/envoyproxy/envoy/blob/da56f6da63079baecef9183436ee5f4141a59af8/test%2Fintegration%2Fprotocol_integration_test.cc",
                "raw_url": "https://github.com/envoyproxy/envoy/raw/da56f6da63079baecef9183436ee5f4141a59af8/test%2Fintegration%2Fprotocol_integration_test.cc",
                "contents_url": "https://api.github.com/repos/envoyproxy/envoy/contents/test%2Fintegration%2Fprotocol_integration_test.cc?ref=da56f6da63079baecef9183436ee5f4141a59af8",
                "patch": "@@ -1551,6 +1551,90 @@ TEST_P(ProtocolIntegrationTest, EnvoyProxying104) {\n   testEnvoyProxying1xx(false, false, false, \"104\");\n }\n \n+TEST_P(DownstreamProtocolIntegrationTest, EnvoyProxying102DelayBalsaReset) {\n+  if (GetParam().http1_implementation != Http1ParserImpl::BalsaParser ||\n+      GetParam().upstream_protocol != Http::CodecType::HTTP1 ||\n+      GetParam().downstream_protocol != Http::CodecType::HTTP1) {\n+    GTEST_SKIP() << \"This test is only relevant for HTTP1 BalsaParser\";\n+  }\n+  config_helper_.addConfigModifier(\n+      [&](envoy::extensions::filters::network::http_connection_manager::v3::HttpConnectionManager&\n+              hcm) -> void { hcm.set_proxy_100_continue(true); });\n+  config_helper_.addRuntimeOverride(\n+      \"envoy.reloadable_features.wait_for_first_byte_before_balsa_msg_done\", \"false\");\n+  config_helper_.addRuntimeOverride(\"envoy.reloadable_features.http1_balsa_delay_reset\", \"true\");\n+  initialize();\n+\n+  codec_client_ = makeHttpConnection(lookupPort(\"http\"));\n+  auto response = codec_client_->makeHeaderOnlyRequest(\n+      Http::TestRequestHeaderMapImpl{{\":method\", \"HEAD\"},\n+                                     {\":path\", \"/dynamo/url\"},\n+                                     {\":scheme\", \"http\"},\n+                                     {\":authority\", \"sni.lyft.com\"},\n+                                     {\"expect\", \"100-contINUE\"}});\n+  waitForNextUpstreamRequest();\n+  upstream_request_->encode1xxHeaders(Http::TestResponseHeaderMapImpl{{\":status\", \"102\"}});\n+  response->waitFor1xxHeaders();\n+  upstream_request_->encodeHeaders(default_response_headers_, true);\n+\n+  EXPECT_FALSE(response->waitForEndStream());\n+\n+  cleanupUpstreamAndDownstream();\n+}\n+\n+TEST_P(DownstreamProtocolIntegrationTest, EnvoyProxying102DelayBalsaResetWaitForFirstByte) {\n+  if (GetParam().http1_implementation != Http1ParserImpl::BalsaParser ||\n+      GetParam().upstream_protocol != Http::CodecType::HTTP1) {\n+    GTEST_SKIP() << \"This test is only relevant for HTTP1 upstream with BalsaParser\";\n+  }\n+  config_helper_.addConfigModifier(\n+      [&](envoy::extensions::filters::network::http_connection_manager::v3::HttpConnectionManager&\n+              hcm) -> void { hcm.set_proxy_100_continue(true); });\n+  config_helper_.addRuntimeOverride(\n+      \"envoy.reloadable_features.wait_for_first_byte_before_balsa_msg_done\", \"true\");\n+  config_helper_.addRuntimeOverride(\"envoy.reloadable_features.http1_balsa_delay_reset\", \"true\");\n+  initialize();\n+\n+  codec_client_ = makeHttpConnection(lookupPort(\"http\"));\n+  auto response = codec_client_->makeHeaderOnlyRequest(\n+      Http::TestRequestHeaderMapImpl{{\":method\", \"HEAD\"},\n+                                     {\":path\", \"/dynamo/url\"},\n+                                     {\":scheme\", \"http\"},\n+                                     {\":authority\", \"sni.lyft.com\"},\n+                                     {\"expect\", \"100-contINUE\"}});\n+  waitForNextUpstreamRequest();\n+  upstream_request_->encode1xxHeaders(Http::TestResponseHeaderMapImpl{{\":status\", \"102\"}});\n+  response->waitFor1xxHeaders();\n+  upstream_request_->encodeHeaders(default_response_headers_, true);\n+  ASSERT_TRUE(response->waitForEndStream());\n+}\n+\n+TEST_P(DownstreamProtocolIntegrationTest, EnvoyProxying102NoDelayBalsaReset) {\n+  if (GetParam().http1_implementation != Http1ParserImpl::BalsaParser ||\n+      GetParam().upstream_protocol != Http::CodecType::HTTP1) {\n+    GTEST_SKIP() << \"This test is only relevant for HTTP1 upstream with BalsaParser\";\n+  }\n+  config_helper_.addConfigModifier(\n+      [&](envoy::extensions::filters::network::http_connection_manager::v3::HttpConnectionManager&\n+              hcm) -> void { hcm.set_proxy_100_continue(true); });\n+  config_helper_.addRuntimeOverride(\"envoy.reloadable_features.http1_balsa_delay_reset\", \"false\");\n+  initialize();\n+\n+  codec_client_ = makeHttpConnection(lookupPort(\"http\"));\n+  auto response = codec_client_->makeHeaderOnlyRequest(\n+      Http::TestRequestHeaderMapImpl{{\":method\", \"HEAD\"},\n+                                     {\":path\", \"/dynamo/url\"},\n+                                     {\":scheme\", \"http\"},\n+                                     {\":authority\", \"sni.lyft.com\"},\n+                                     {\"expect\", \"100-contINUE\"}});\n+\n+  waitForNextUpstreamRequest();\n+  upstream_request_->encode1xxHeaders(Http::TestResponseHeaderMapImpl{{\":status\", \"102\"}});\n+  response->waitFor1xxHeaders();\n+  upstream_request_->encodeHeaders(default_response_headers_, true);\n+  ASSERT_TRUE(response->waitForEndStream());\n+}\n+\n TEST_P(ProtocolIntegrationTest, TwoRequests) { testTwoRequests(); }\n \n TEST_P(ProtocolIntegrationTest, TwoRequestsWithForcedBackup) { testTwoRequests(true); }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dataease/dataease/commits/0db4872a52eccf6e83dd9359aa05db52dd580ec1",
        "url": "https://api.github.com/repos/dataease/dataease/commits/0db4872a52eccf6e83dd9359aa05db52dd580ec1",
        "html_url": "https://github.com/dataease/dataease/commit/0db4872a52eccf6e83dd9359aa05db52dd580ec1",
        "message": "fix: \u6570\u636e\u6e90\u4fee\u590dmysql\u3001Redshift\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e",
        "files": [
            {
                "sha": "3b875f2dc8c2188a0e4cdca45ceef6517b9b090b",
                "filename": "core/backend/src/main/java/io/dataease/dto/datasource/MysqlConfiguration.java",
                "status": "modified",
                "additions": 10,
                "deletions": 9,
                "changes": 19,
                "blob_url": "https://github.com/dataease/dataease/blob/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FMysqlConfiguration.java",
                "raw_url": "https://github.com/dataease/dataease/raw/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FMysqlConfiguration.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FMysqlConfiguration.java?ref=0db4872a52eccf6e83dd9359aa05db52dd580ec1",
                "patch": "@@ -19,24 +19,25 @@ public class MysqlConfiguration extends JdbcConfiguration {\n     private List<String> illegalParameters = Arrays.asList(\"autoDeserialize\", \"queryInterceptors\", \"statementInterceptors\", \"detectCustomCollations\", \"allowloadlocalinfile\", \"allowUrlInLocalInfile\", \"allowLoadLocalInfileInPath\");\n \n     public String getJdbc() {\n+        String jdbcUrl = \"\";\n         if (StringUtils.isEmpty(extraParams.trim())) {\n-            return \"jdbc:mysql://HOSTNAME:PORT/DATABASE\".replace(\"HOSTNAME\", getHost().trim()).replace(\"PORT\", getPort().toString().trim()).replace(\"DATABASE\", getDataBase().trim());\n+            jdbcUrl = \"jdbc:mysql://HOSTNAME:PORT/DATABASE\".replace(\"HOSTNAME\", getHost().trim()).replace(\"PORT\", getPort().toString().trim()).replace(\"DATABASE\", getDataBase().trim());\n         } else {\n-            for (String illegalParameter : getIllegalParameters()) {\n-                if (getExtraParams().toLowerCase().contains(illegalParameter.toLowerCase()) || URLDecoder.decode(getExtraParams()).contains(illegalParameter.toLowerCase())) {\n-                    throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n-                }\n+            jdbcUrl = \"jdbc:mysql://HOSTNAME:PORT/DATABASE?EXTRA_PARAMS\".replace(\"HOSTNAME\", getHost().trim()).replace(\"PORT\", getPort().toString().trim()).replace(\"DATABASE\", getDataBase().trim()).replace(\"EXTRA_PARAMS\", getExtraParams().trim());\n+        }\n+        for (String illegalParameter : getIllegalParameters()) {\n+            if (jdbcUrl.toLowerCase().contains(illegalParameter.toLowerCase()) || URLDecoder.decode(jdbcUrl).contains(illegalParameter.toLowerCase())) {\n+                throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n             }\n-\n-            return \"jdbc:mysql://HOSTNAME:PORT/DATABASE?EXTRA_PARAMS\".replace(\"HOSTNAME\", getHost().trim()).replace(\"PORT\", getPort().toString().trim()).replace(\"DATABASE\", getDataBase().trim()).replace(\"EXTRA_PARAMS\", getExtraParams().trim());\n         }\n+        return jdbcUrl;\n     }\n \n-    public List<String> getIllegalParameters(){\n+    public List<String> getIllegalParameters() {\n         List<String> newIllegalParameters = new ArrayList<>();\n         newIllegalParameters.addAll(illegalParameters);\n         newIllegalParameters.addAll(Arrays.asList(\"allowloadlocalinfile\", \"allowUrlInLocalInfile\", \"allowLoadLocalInfileInPath\"));\n         return newIllegalParameters;\n     }\n \n-}\n\\ No newline at end of file\n+}"
            },
            {
                "sha": "279748cdc7894347c021163aed51858934fcd0f7",
                "filename": "core/backend/src/main/java/io/dataease/dto/datasource/PgConfiguration.java",
                "status": "modified",
                "additions": 10,
                "deletions": 8,
                "changes": 18,
                "blob_url": "https://github.com/dataease/dataease/blob/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FPgConfiguration.java",
                "raw_url": "https://github.com/dataease/dataease/raw/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FPgConfiguration.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FPgConfiguration.java?ref=0db4872a52eccf6e83dd9359aa05db52dd580ec1",
                "patch": "@@ -19,31 +19,33 @@ public class PgConfiguration extends JdbcConfiguration {\n \n \n     public String getJdbc() {\n+        String jdbcUrl = \"\";\n         if (StringUtils.isEmpty(extraParams.trim())) {\n             if (StringUtils.isEmpty(getSchema())) {\n-                return \"jdbc:postgresql://HOSTNAME:PORT/DATABASE\"\n+                jdbcUrl = \"jdbc:postgresql://HOSTNAME:PORT/DATABASE\"\n                         .replace(\"HOSTNAME\", getHost().trim())\n                         .replace(\"PORT\", getPort().toString().trim())\n                         .replace(\"DATABASE\", getDataBase().trim());\n             } else {\n-                return \"jdbc:postgresql://HOSTNAME:PORT/DATABASE?currentSchema=SCHEMA\"\n+                jdbcUrl = \"jdbc:postgresql://HOSTNAME:PORT/DATABASE?currentSchema=SCHEMA\"\n                         .replace(\"HOSTNAME\", getHost().trim())\n                         .replace(\"PORT\", getPort().toString().trim())\n                         .replace(\"DATABASE\", getDataBase().trim())\n                         .replace(\"SCHEMA\", getSchema().trim());\n             }\n         } else {\n-            for (String illegalParameter : illegalParameters) {\n-                if (getExtraParams().toLowerCase().contains(illegalParameter.toLowerCase()) || URLDecoder.decode(getExtraParams()).contains(illegalParameter.toLowerCase())) {\n-                    throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n-                }\n-            }\n-            return \"jdbc:postgresql://HOSTNAME:PORT/DATABASE?EXTRA_PARAMS\"\n+            jdbcUrl = \"jdbc:postgresql://HOSTNAME:PORT/DATABASE?EXTRA_PARAMS\"\n                     .replace(\"HOSTNAME\", getHost().trim())\n                     .replace(\"PORT\", getPort().toString().trim())\n                     .replace(\"DATABASE\", getDataBase().trim())\n                     .replace(\"EXTRA_PARAMS\", getExtraParams().trim());\n+        }\n \n+        for (String illegalParameter : illegalParameters) {\n+            if (jdbcUrl.toLowerCase().contains(illegalParameter.toLowerCase()) || URLDecoder.decode(jdbcUrl).contains(illegalParameter.toLowerCase())) {\n+                throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n+            }\n         }\n+        return jdbcUrl;\n     }\n }"
            },
            {
                "sha": "34a5409226f1118b75b8f5b059f6dc58cf82d583",
                "filename": "core/backend/src/main/java/io/dataease/dto/datasource/RedshiftConfiguration.java",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/dataease/dataease/blob/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FRedshiftConfiguration.java",
                "raw_url": "https://github.com/dataease/dataease/raw/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FRedshiftConfiguration.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FRedshiftConfiguration.java?ref=0db4872a52eccf6e83dd9359aa05db52dd580ec1",
                "patch": "@@ -4,17 +4,29 @@\n import lombok.Getter;\n import lombok.Setter;\n \n+import java.net.URLDecoder;\n+import java.util.Arrays;\n+import java.util.List;\n+\n @Getter\n @Setter\n public class RedshiftConfiguration extends JdbcConfiguration {\n \n     private String driver = \"com.amazon.redshift.jdbc42.Driver\";\n+    private List<String> illegalParameters = Arrays.asList(\"socketFactory\", \"socketFactoryArg\", \"sslfactory\", \"sslfactoryarg\", \"loggerLevel\", \"loggerFile\", \"allowUrlInLocalInfile\", \"allowLoadLocalInfileInPath\");\n+\n \n     public String getJdbc() {\n-        // \u8fde\u63a5\u53c2\u6570\u5148\u5199\u6b7b\uff0c\u540e\u8fb9\u8981\u628a\u7f16\u7801\u3001\u65f6\u533a\u7b49\u53c2\u6570\u653e\u5230\u6570\u636e\u6e90\u7684\u8bbe\u7f6e\u4e2d\n-        return \"jdbc:redshift://HOSTNAME:PORT/DATABASE\"\n+\n+        String jdbcUrl = \"jdbc:redshift://HOSTNAME:PORT/DATABASE\"\n                 .replace(\"HOSTNAME\", getHost().trim())\n                 .replace(\"PORT\", getPort().toString().trim())\n                 .replace(\"DATABASE\", getDataBase().trim());\n+        for (String illegalParameter : illegalParameters) {\n+            if (jdbcUrl.toLowerCase().contains(illegalParameter.toLowerCase())) {\n+                throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n+            }\n+        }\n+        return jdbcUrl;\n     }\n-}\n\\ No newline at end of file\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dataease/dataease/commits/0db4872a52eccf6e83dd9359aa05db52dd580ec1",
        "url": "https://api.github.com/repos/dataease/dataease/commits/0db4872a52eccf6e83dd9359aa05db52dd580ec1",
        "html_url": "https://github.com/dataease/dataease/commit/0db4872a52eccf6e83dd9359aa05db52dd580ec1",
        "message": "fix: \u6570\u636e\u6e90\u4fee\u590dmysql\u3001Redshift\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e",
        "files": [
            {
                "sha": "3b875f2dc8c2188a0e4cdca45ceef6517b9b090b",
                "filename": "core/backend/src/main/java/io/dataease/dto/datasource/MysqlConfiguration.java",
                "status": "modified",
                "additions": 10,
                "deletions": 9,
                "changes": 19,
                "blob_url": "https://github.com/dataease/dataease/blob/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FMysqlConfiguration.java",
                "raw_url": "https://github.com/dataease/dataease/raw/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FMysqlConfiguration.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FMysqlConfiguration.java?ref=0db4872a52eccf6e83dd9359aa05db52dd580ec1",
                "patch": "@@ -19,24 +19,25 @@ public class MysqlConfiguration extends JdbcConfiguration {\n     private List<String> illegalParameters = Arrays.asList(\"autoDeserialize\", \"queryInterceptors\", \"statementInterceptors\", \"detectCustomCollations\", \"allowloadlocalinfile\", \"allowUrlInLocalInfile\", \"allowLoadLocalInfileInPath\");\n \n     public String getJdbc() {\n+        String jdbcUrl = \"\";\n         if (StringUtils.isEmpty(extraParams.trim())) {\n-            return \"jdbc:mysql://HOSTNAME:PORT/DATABASE\".replace(\"HOSTNAME\", getHost().trim()).replace(\"PORT\", getPort().toString().trim()).replace(\"DATABASE\", getDataBase().trim());\n+            jdbcUrl = \"jdbc:mysql://HOSTNAME:PORT/DATABASE\".replace(\"HOSTNAME\", getHost().trim()).replace(\"PORT\", getPort().toString().trim()).replace(\"DATABASE\", getDataBase().trim());\n         } else {\n-            for (String illegalParameter : getIllegalParameters()) {\n-                if (getExtraParams().toLowerCase().contains(illegalParameter.toLowerCase()) || URLDecoder.decode(getExtraParams()).contains(illegalParameter.toLowerCase())) {\n-                    throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n-                }\n+            jdbcUrl = \"jdbc:mysql://HOSTNAME:PORT/DATABASE?EXTRA_PARAMS\".replace(\"HOSTNAME\", getHost().trim()).replace(\"PORT\", getPort().toString().trim()).replace(\"DATABASE\", getDataBase().trim()).replace(\"EXTRA_PARAMS\", getExtraParams().trim());\n+        }\n+        for (String illegalParameter : getIllegalParameters()) {\n+            if (jdbcUrl.toLowerCase().contains(illegalParameter.toLowerCase()) || URLDecoder.decode(jdbcUrl).contains(illegalParameter.toLowerCase())) {\n+                throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n             }\n-\n-            return \"jdbc:mysql://HOSTNAME:PORT/DATABASE?EXTRA_PARAMS\".replace(\"HOSTNAME\", getHost().trim()).replace(\"PORT\", getPort().toString().trim()).replace(\"DATABASE\", getDataBase().trim()).replace(\"EXTRA_PARAMS\", getExtraParams().trim());\n         }\n+        return jdbcUrl;\n     }\n \n-    public List<String> getIllegalParameters(){\n+    public List<String> getIllegalParameters() {\n         List<String> newIllegalParameters = new ArrayList<>();\n         newIllegalParameters.addAll(illegalParameters);\n         newIllegalParameters.addAll(Arrays.asList(\"allowloadlocalinfile\", \"allowUrlInLocalInfile\", \"allowLoadLocalInfileInPath\"));\n         return newIllegalParameters;\n     }\n \n-}\n\\ No newline at end of file\n+}"
            },
            {
                "sha": "279748cdc7894347c021163aed51858934fcd0f7",
                "filename": "core/backend/src/main/java/io/dataease/dto/datasource/PgConfiguration.java",
                "status": "modified",
                "additions": 10,
                "deletions": 8,
                "changes": 18,
                "blob_url": "https://github.com/dataease/dataease/blob/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FPgConfiguration.java",
                "raw_url": "https://github.com/dataease/dataease/raw/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FPgConfiguration.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FPgConfiguration.java?ref=0db4872a52eccf6e83dd9359aa05db52dd580ec1",
                "patch": "@@ -19,31 +19,33 @@ public class PgConfiguration extends JdbcConfiguration {\n \n \n     public String getJdbc() {\n+        String jdbcUrl = \"\";\n         if (StringUtils.isEmpty(extraParams.trim())) {\n             if (StringUtils.isEmpty(getSchema())) {\n-                return \"jdbc:postgresql://HOSTNAME:PORT/DATABASE\"\n+                jdbcUrl = \"jdbc:postgresql://HOSTNAME:PORT/DATABASE\"\n                         .replace(\"HOSTNAME\", getHost().trim())\n                         .replace(\"PORT\", getPort().toString().trim())\n                         .replace(\"DATABASE\", getDataBase().trim());\n             } else {\n-                return \"jdbc:postgresql://HOSTNAME:PORT/DATABASE?currentSchema=SCHEMA\"\n+                jdbcUrl = \"jdbc:postgresql://HOSTNAME:PORT/DATABASE?currentSchema=SCHEMA\"\n                         .replace(\"HOSTNAME\", getHost().trim())\n                         .replace(\"PORT\", getPort().toString().trim())\n                         .replace(\"DATABASE\", getDataBase().trim())\n                         .replace(\"SCHEMA\", getSchema().trim());\n             }\n         } else {\n-            for (String illegalParameter : illegalParameters) {\n-                if (getExtraParams().toLowerCase().contains(illegalParameter.toLowerCase()) || URLDecoder.decode(getExtraParams()).contains(illegalParameter.toLowerCase())) {\n-                    throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n-                }\n-            }\n-            return \"jdbc:postgresql://HOSTNAME:PORT/DATABASE?EXTRA_PARAMS\"\n+            jdbcUrl = \"jdbc:postgresql://HOSTNAME:PORT/DATABASE?EXTRA_PARAMS\"\n                     .replace(\"HOSTNAME\", getHost().trim())\n                     .replace(\"PORT\", getPort().toString().trim())\n                     .replace(\"DATABASE\", getDataBase().trim())\n                     .replace(\"EXTRA_PARAMS\", getExtraParams().trim());\n+        }\n \n+        for (String illegalParameter : illegalParameters) {\n+            if (jdbcUrl.toLowerCase().contains(illegalParameter.toLowerCase()) || URLDecoder.decode(jdbcUrl).contains(illegalParameter.toLowerCase())) {\n+                throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n+            }\n         }\n+        return jdbcUrl;\n     }\n }"
            },
            {
                "sha": "34a5409226f1118b75b8f5b059f6dc58cf82d583",
                "filename": "core/backend/src/main/java/io/dataease/dto/datasource/RedshiftConfiguration.java",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/dataease/dataease/blob/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FRedshiftConfiguration.java",
                "raw_url": "https://github.com/dataease/dataease/raw/0db4872a52eccf6e83dd9359aa05db52dd580ec1/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FRedshiftConfiguration.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/core%2Fbackend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fdto%2Fdatasource%2FRedshiftConfiguration.java?ref=0db4872a52eccf6e83dd9359aa05db52dd580ec1",
                "patch": "@@ -4,17 +4,29 @@\n import lombok.Getter;\n import lombok.Setter;\n \n+import java.net.URLDecoder;\n+import java.util.Arrays;\n+import java.util.List;\n+\n @Getter\n @Setter\n public class RedshiftConfiguration extends JdbcConfiguration {\n \n     private String driver = \"com.amazon.redshift.jdbc42.Driver\";\n+    private List<String> illegalParameters = Arrays.asList(\"socketFactory\", \"socketFactoryArg\", \"sslfactory\", \"sslfactoryarg\", \"loggerLevel\", \"loggerFile\", \"allowUrlInLocalInfile\", \"allowLoadLocalInfileInPath\");\n+\n \n     public String getJdbc() {\n-        // \u8fde\u63a5\u53c2\u6570\u5148\u5199\u6b7b\uff0c\u540e\u8fb9\u8981\u628a\u7f16\u7801\u3001\u65f6\u533a\u7b49\u53c2\u6570\u653e\u5230\u6570\u636e\u6e90\u7684\u8bbe\u7f6e\u4e2d\n-        return \"jdbc:redshift://HOSTNAME:PORT/DATABASE\"\n+\n+        String jdbcUrl = \"jdbc:redshift://HOSTNAME:PORT/DATABASE\"\n                 .replace(\"HOSTNAME\", getHost().trim())\n                 .replace(\"PORT\", getPort().toString().trim())\n                 .replace(\"DATABASE\", getDataBase().trim());\n+        for (String illegalParameter : illegalParameters) {\n+            if (jdbcUrl.toLowerCase().contains(illegalParameter.toLowerCase())) {\n+                throw new RuntimeException(\"Illegal parameter: \" + illegalParameter);\n+            }\n+        }\n+        return jdbcUrl;\n     }\n-}\n\\ No newline at end of file\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/kafka/commits/2cbc5bd3ca22185d9cd357c9db23a2cfb43a0fff",
        "url": "https://api.github.com/repos/apache/kafka/commits/2cbc5bd3ca22185d9cd357c9db23a2cfb43a0fff",
        "html_url": "https://github.com/apache/kafka/commit/2cbc5bd3ca22185d9cd357c9db23a2cfb43a0fff",
        "message": "KAFKA-17636 Fix missing SCRAM bootstrap records (#17305)\n\nFixes a regression introduced by #16669 which inadvertently stopped processing SCRAM arguments from kafka-storage.sh\n\nReviewers: Colin P. McCabe <cmccabe@apache.org>, Federico Valeri <fedevaleri@gmail.com>",
        "files": [
            {
                "sha": "6dc46539614089b29667200ac61bd597dcb8d6e2",
                "filename": "core/src/main/scala/kafka/tools/StorageTool.scala",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/kafka/blob/2cbc5bd3ca22185d9cd357c9db23a2cfb43a0fff/core%2Fsrc%2Fmain%2Fscala%2Fkafka%2Ftools%2FStorageTool.scala",
                "raw_url": "https://github.com/apache/kafka/raw/2cbc5bd3ca22185d9cd357c9db23a2cfb43a0fff/core%2Fsrc%2Fmain%2Fscala%2Fkafka%2Ftools%2FStorageTool.scala",
                "contents_url": "https://api.github.com/repos/apache/kafka/contents/core%2Fsrc%2Fmain%2Fscala%2Fkafka%2Ftools%2FStorageTool.scala?ref=2cbc5bd3ca22185d9cd357c9db23a2cfb43a0fff",
                "patch": "@@ -130,6 +130,8 @@ object StorageTool extends Logging {\n     if (namespace.getBoolean(\"standalone\")) {\n       formatter.setInitialVoters(createStandaloneDynamicVoters(config))\n     }\n+    Option(namespace.getList(\"add_scram\")).\n+      foreach(scramArgs => formatter.setScramArguments(scramArgs.asInstanceOf[util.List[String]]))\n     configToLogDirectories(config).foreach(formatter.addDirectory(_))\n     formatter.run()\n   }"
            },
            {
                "sha": "83b21b43fbabae382d2d98a1112fc4111c5c1fb5",
                "filename": "core/src/test/scala/unit/kafka/tools/StorageToolTest.scala",
                "status": "modified",
                "additions": 49,
                "deletions": 2,
                "changes": 51,
                "blob_url": "https://github.com/apache/kafka/blob/2cbc5bd3ca22185d9cd357c9db23a2cfb43a0fff/core%2Fsrc%2Ftest%2Fscala%2Funit%2Fkafka%2Ftools%2FStorageToolTest.scala",
                "raw_url": "https://github.com/apache/kafka/raw/2cbc5bd3ca22185d9cd357c9db23a2cfb43a0fff/core%2Fsrc%2Ftest%2Fscala%2Funit%2Fkafka%2Ftools%2FStorageToolTest.scala",
                "contents_url": "https://api.github.com/repos/apache/kafka/contents/core%2Fsrc%2Ftest%2Fscala%2Funit%2Fkafka%2Ftools%2FStorageToolTest.scala?ref=2cbc5bd3ca22185d9cd357c9db23a2cfb43a0fff",
                "patch": "@@ -21,12 +21,14 @@ import java.io.{ByteArrayOutputStream, File, PrintStream}\n import java.nio.charset.StandardCharsets\n import java.nio.file.Files\n import java.util\n-import java.util.Properties\n+import java.util.{Optional, Properties}\n import kafka.server.KafkaConfig\n import kafka.utils.TestUtils\n import net.sourceforge.argparse4j.inf.ArgumentParserException\n+import org.apache.kafka.common.metadata.UserScramCredentialRecord\n import org.apache.kafka.common.utils.Utils\n import org.apache.kafka.server.common.Features\n+import org.apache.kafka.metadata.bootstrap.BootstrapDirectory\n import org.apache.kafka.metadata.properties.{MetaPropertiesEnsemble, PropertiesUtils}\n import org.apache.kafka.metadata.storage.FormatterException\n import org.apache.kafka.raft.QuorumConfig\n@@ -37,6 +39,7 @@ import org.junit.jupiter.params.ParameterizedTest\n import org.junit.jupiter.params.provider.ValueSource\n \n import scala.collection.mutable.ListBuffer\n+import scala.jdk.CollectionConverters.IterableHasAsScala\n \n @Timeout(value = 40)\n class StorageToolTest {\n@@ -433,5 +436,49 @@ Found problem:\n       contains(\"Formatting dynamic metadata voter directory %s\".format(availableDirs.head)),\n       \"Failed to find content in output: \" + stream.toString())\n   }\n-}\n \n+  @Test\n+  def testBootstrapScramRecords(): Unit = {\n+    val availableDirs = Seq(TestUtils.tempDir())\n+    val properties = new Properties()\n+    properties.putAll(defaultDynamicQuorumProperties)\n+    properties.setProperty(\"log.dirs\", availableDirs.mkString(\",\"))\n+    val stream = new ByteArrayOutputStream()\n+    val arguments = ListBuffer[String](\n+      \"--release-version\", \"3.9-IV0\",\n+      \"--add-scram\", \"SCRAM-SHA-512=[name=alice,password=changeit]\",\n+      \"--add-scram\", \"SCRAM-SHA-512=[name=bob,password=changeit]\"\n+    )\n+\n+    assertEquals(0, runFormatCommand(stream, properties, arguments.toSeq))\n+\n+    // Not doing full SCRAM record validation since that's covered elsewhere.\n+    // Just checking that we generate the correct number of records\n+    val bootstrapMetadata = new BootstrapDirectory(availableDirs.head.toString, Optional.empty).read\n+    val scramRecords = bootstrapMetadata.records().asScala\n+      .filter(apiMessageAndVersion => apiMessageAndVersion.message().isInstanceOf[UserScramCredentialRecord])\n+      .map(apiMessageAndVersion => apiMessageAndVersion.message().asInstanceOf[UserScramCredentialRecord])\n+      .toList\n+    assertEquals(2, scramRecords.size)\n+    assertEquals(\"alice\", scramRecords.head.name())\n+    assertEquals(\"bob\", scramRecords.last.name())\n+  }\n+\n+  @Test\n+  def testScramRecordsOldReleaseVersion(): Unit = {\n+    val availableDirs = Seq(TestUtils.tempDir())\n+    val properties = new Properties()\n+    properties.putAll(defaultDynamicQuorumProperties)\n+    properties.setProperty(\"log.dirs\", availableDirs.mkString(\",\"))\n+    val stream = new ByteArrayOutputStream()\n+    val arguments = ListBuffer[String](\n+      \"--release-version\", \"3.4\",\n+      \"--add-scram\", \"SCRAM-SHA-512=[name=alice,password=changeit]\",\n+      \"--add-scram\", \"SCRAM-SHA-512=[name=bob,password=changeit]\"\n+    )\n+\n+    assertEquals(\n+      \"SCRAM is only supported in metadata.version 3.5-IV2 or later.\",\n+      assertThrows(classOf[FormatterException], () => runFormatCommand(stream, properties, arguments.toSeq)).getMessage)\n+  }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/spatie/browsershot/commits/dfc3635b83dd980e5c39f8f8c73e87723b99ca01",
        "url": "https://api.github.com/repos/spatie/browsershot/commits/dfc3635b83dd980e5c39f8f8c73e87723b99ca01",
        "html_url": "https://github.com/spatie/browsershot/commit/dfc3635b83dd980e5c39f8f8c73e87723b99ca01",
        "message": "improve detection of file urls",
        "files": [
            {
                "sha": "053c7422a2fb35173a3093bd87faafee947f17ec",
                "filename": "src/Browsershot.php",
                "status": "modified",
                "additions": 6,
                "deletions": 2,
                "changes": 8,
                "blob_url": "https://github.com/spatie/browsershot/blob/dfc3635b83dd980e5c39f8f8c73e87723b99ca01/src%2FBrowsershot.php",
                "raw_url": "https://github.com/spatie/browsershot/raw/dfc3635b83dd980e5c39f8f8c73e87723b99ca01/src%2FBrowsershot.php",
                "contents_url": "https://api.github.com/repos/spatie/browsershot/contents/src%2FBrowsershot.php?ref=dfc3635b83dd980e5c39f8f8c73e87723b99ca01",
                "patch": "@@ -259,8 +259,12 @@ public function setUrl(string $url): static\n     {\n         $url = trim($url);\n \n-        if (str_starts_with(strtolower($url), 'file://') || str_starts_with(strtolower($url), 'file:/')) {\n-            throw FileUrlNotAllowed::make();\n+        $unsupportedProtocols = ['file://', 'file:/', 'file:\\\\', 'file:\\\\\\\\'];\n+\n+        foreach($unsupportedProtocols as $unsupportedProtocol) {\n+            if (str_starts_with(strtolower($url), $unsupportedProtocol)) {\n+                throw FileUrlNotAllowed::make();\n+            }\n         }\n \n         $this->url = $url;"
            },
            {
                "sha": "026a5e5d976b0c2bcbc183c23713e07e92579031",
                "filename": "tests/BrowsershotTest.php",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/spatie/browsershot/blob/dfc3635b83dd980e5c39f8f8c73e87723b99ca01/tests%2FBrowsershotTest.php",
                "raw_url": "https://github.com/spatie/browsershot/raw/dfc3635b83dd980e5c39f8f8c73e87723b99ca01/tests%2FBrowsershotTest.php",
                "contents_url": "https://api.github.com/repos/spatie/browsershot/contents/tests%2FBrowsershotTest.php?ref=dfc3635b83dd980e5c39f8f8c73e87723b99ca01",
                "patch": "@@ -54,7 +54,12 @@\n \n it('will not allow a file url', function () {\n     Browsershot::url('file://test');\n-})->throws(FileUrlNotAllowed::class);\n+})->throws(FileUrlNotAllowed::class)->with([\n+    'file://test',\n+    'file:/test',\n+    'file:\\test',\n+    'file:\\\\test',\n+]);\n \n it('will not allow a file url that has leading spaces', function () {\n     Browsershot::url('    file://test');"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/oven-sh/bun/commits/a234e067a5dc7837602df3fb5489e826920cc65a",
        "url": "https://api.github.com/repos/oven-sh/bun/commits/a234e067a5dc7837602df3fb5489e826920cc65a",
        "html_url": "https://github.com/oven-sh/bun/commit/a234e067a5dc7837602df3fb5489e826920cc65a",
        "message": "Make .get() ignore Object.prototype instead of using getOwn (#14322)",
        "files": [
            {
                "sha": "84d6f8208eebc3e8f87fb645ea05f2df26e6ae1f",
                "filename": "src/bun.js/api/BunObject.zig",
                "status": "modified",
                "additions": 16,
                "deletions": 16,
                "changes": 32,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2FBunObject.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2FBunObject.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2FBunObject.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -329,11 +329,11 @@ pub fn braces(\n     if (arguments.nextEat()) |opts_val| {\n         if (opts_val.isObject()) {\n             if (comptime bun.Environment.allow_assert) {\n-                if (opts_val.getOwnTruthy(globalThis, \"tokenize\")) |tokenize_val| {\n+                if (opts_val.getTruthy(globalThis, \"tokenize\")) |tokenize_val| {\n                     tokenize = if (tokenize_val.isBoolean()) tokenize_val.asBoolean() else false;\n                 }\n \n-                if (opts_val.getOwnTruthy(globalThis, \"parse\")) |tokenize_val| {\n+                if (opts_val.getTruthy(globalThis, \"parse\")) |tokenize_val| {\n                     parse = if (tokenize_val.isBoolean()) tokenize_val.asBoolean() else false;\n                 }\n             }\n@@ -461,11 +461,11 @@ pub fn which(\n \n     if (arguments.nextEat()) |arg| {\n         if (!arg.isEmptyOrUndefinedOrNull() and arg.isObject()) {\n-            if (arg.getOwn(globalThis, \"PATH\")) |str_| {\n+            if (arg.get(globalThis, \"PATH\")) |str_| {\n                 path_str = str_.toSlice(globalThis, globalThis.bunVM().allocator);\n             }\n \n-            if (arg.getOwn(globalThis, \"cwd\")) |str_| {\n+            if (arg.get(globalThis, \"cwd\")) |str_| {\n                 cwd_str = str_.toSlice(globalThis, globalThis.bunVM().allocator);\n             }\n         }\n@@ -514,7 +514,7 @@ pub fn inspect(\n         const arg1 = arguments[1];\n \n         if (arg1.isObject()) {\n-            if (arg1.getOwnTruthy(globalThis, \"depth\")) |opt| {\n+            if (arg1.getTruthy(globalThis, \"depth\")) |opt| {\n                 if (opt.isInt32()) {\n                     const arg = opt.toInt32();\n                     if (arg < 0) {\n@@ -779,7 +779,7 @@ pub fn openInEditor(\n \n     if (arguments.nextEat()) |opts| {\n         if (!opts.isUndefinedOrNull()) {\n-            if (opts.getOwnTruthy(globalThis, \"editor\")) |editor_val| {\n+            if (opts.getTruthy(globalThis, \"editor\")) |editor_val| {\n                 var sliced = editor_val.toSlice(globalThis, arguments.arena.allocator());\n                 const prev_name = edit.name;\n \n@@ -799,11 +799,11 @@ pub fn openInEditor(\n                 }\n             }\n \n-            if (opts.getOwnTruthy(globalThis, \"line\")) |line_| {\n+            if (opts.getTruthy(globalThis, \"line\")) |line_| {\n                 line = line_.toSlice(globalThis, arguments.arena.allocator()).slice();\n             }\n \n-            if (opts.getOwnTruthy(globalThis, \"column\")) |column_| {\n+            if (opts.getTruthy(globalThis, \"column\")) |column_| {\n                 column = column_.toSlice(globalThis, arguments.arena.allocator()).slice();\n             }\n         }\n@@ -1711,7 +1711,7 @@ pub const Crypto = struct {\n \n                 pub fn fromJS(globalObject: *JSC.JSGlobalObject, value: JSC.JSValue) ?Value {\n                     if (value.isObject()) {\n-                        if (value.getOwnTruthy(globalObject, \"algorithm\")) |algorithm_value| {\n+                        if (value.getTruthy(globalObject, \"algorithm\")) |algorithm_value| {\n                             if (!algorithm_value.isString()) {\n                                 globalObject.throwInvalidArgumentType(\"hash\", \"algorithm\", \"string\");\n                                 return null;\n@@ -1728,7 +1728,7 @@ pub const Crypto = struct {\n                                         .bcrypt = PasswordObject.Algorithm.Value.bcrpyt_default,\n                                     };\n \n-                                    if (value.getOwnTruthy(globalObject, \"cost\")) |rounds_value| {\n+                                    if (value.getTruthy(globalObject, \"cost\")) |rounds_value| {\n                                         if (!rounds_value.isNumber()) {\n                                             globalObject.throwInvalidArgumentType(\"hash\", \"cost\", \"number\");\n                                             return null;\n@@ -1749,7 +1749,7 @@ pub const Crypto = struct {\n                                 inline .argon2id, .argon2d, .argon2i => |tag| {\n                                     var argon = Algorithm.Argon2Params{};\n \n-                                    if (value.getOwnTruthy(globalObject, \"timeCost\")) |time_value| {\n+                                    if (value.getTruthy(globalObject, \"timeCost\")) |time_value| {\n                                         if (!time_value.isNumber()) {\n                                             globalObject.throwInvalidArgumentType(\"hash\", \"timeCost\", \"number\");\n                                             return null;\n@@ -1765,7 +1765,7 @@ pub const Crypto = struct {\n                                         argon.time_cost = @as(u32, @intCast(time_cost));\n                                     }\n \n-                                    if (value.getOwnTruthy(globalObject, \"memoryCost\")) |memory_value| {\n+                                    if (value.getTruthy(globalObject, \"memoryCost\")) |memory_value| {\n                                         if (!memory_value.isNumber()) {\n                                             globalObject.throwInvalidArgumentType(\"hash\", \"memoryCost\", \"number\");\n                                             return null;\n@@ -4599,11 +4599,11 @@ fn stringWidth(globalObject: *JSC.JSGlobalObject, callframe: *JSC.CallFrame) JSC\n     var ambiguous_as_wide = false;\n \n     if (options_object.isObject()) {\n-        if (options_object.getOwnTruthy(globalObject, \"countAnsiEscapeCodes\")) |count_ansi_escapes_value| {\n+        if (options_object.getTruthy(globalObject, \"countAnsiEscapeCodes\")) |count_ansi_escapes_value| {\n             if (count_ansi_escapes_value.isBoolean())\n                 count_ansi_escapes = count_ansi_escapes_value.toBoolean();\n         }\n-        if (options_object.getOwnTruthy(globalObject, \"ambiguousIsNarrow\")) |ambiguous_is_narrow| {\n+        if (options_object.getTruthy(globalObject, \"ambiguousIsNarrow\")) |ambiguous_is_narrow| {\n             if (ambiguous_is_narrow.isBoolean())\n                 ambiguous_as_wide = !ambiguous_is_narrow.toBoolean();\n         }\n@@ -4784,7 +4784,7 @@ pub const JSZlib = struct {\n                 library = .zlib;\n             }\n \n-            if (options_val.getOwnTruthy(globalThis, \"library\")) |library_value| {\n+            if (options_val.getTruthy(globalThis, \"library\")) |library_value| {\n                 if (!library_value.isString()) {\n                     globalThis.throwInvalidArguments(\"Expected library to be a string\", .{});\n                     return .zero;\n@@ -4911,7 +4911,7 @@ pub const JSZlib = struct {\n                 library = .zlib;\n             }\n \n-            if (options_val.getOwnTruthy(globalThis, \"library\")) |library_value| {\n+            if (options_val.getTruthy(globalThis, \"library\")) |library_value| {\n                 if (!library_value.isString()) {\n                     globalThis.throwInvalidArguments(\"Expected library to be a string\", .{});\n                     return .zero;"
            },
            {
                "sha": "557e45ee0c8beb6d1b306739fc41bd715dc85bc1",
                "filename": "src/bun.js/api/JSBundler.zig",
                "status": "modified",
                "additions": 26,
                "deletions": 26,
                "changes": 52,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2FJSBundler.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2FJSBundler.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2FJSBundler.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -109,7 +109,7 @@ pub const JSBundler = struct {\n                         return error.JSError;\n                     }\n \n-                    if (plugin.getOwnOptional(globalThis, \"name\", ZigString.Slice) catch null) |slice| {\n+                    if (plugin.getOptional(globalThis, \"name\", ZigString.Slice) catch null) |slice| {\n                         defer slice.deinit();\n                         if (slice.len == 0) {\n                             globalThis.throwInvalidArguments(\"Expected plugin to have a non-empty name\", .{});\n@@ -153,13 +153,13 @@ pub const JSBundler = struct {\n                 }\n             }\n \n-            if (config.getOwnTruthy(globalThis, \"macros\")) |macros_flag| {\n+            if (config.getTruthy(globalThis, \"macros\")) |macros_flag| {\n                 if (!macros_flag.coerce(bool, globalThis)) {\n                     this.no_macros = true;\n                 }\n             }\n \n-            if (try config.getOwnOptional(globalThis, \"bytecode\", bool)) |bytecode| {\n+            if (try config.getOptional(globalThis, \"bytecode\", bool)) |bytecode| {\n                 this.bytecode = bytecode;\n \n                 if (bytecode) {\n@@ -169,7 +169,7 @@ pub const JSBundler = struct {\n                 }\n             }\n \n-            if (try config.getOwnOptionalEnum(globalThis, \"target\", options.Target)) |target| {\n+            if (try config.getOptionalEnum(globalThis, \"target\", options.Target)) |target| {\n                 this.target = target;\n \n                 if (target != .bun and this.bytecode) {\n@@ -179,18 +179,18 @@ pub const JSBundler = struct {\n             }\n \n             var has_out_dir = false;\n-            if (try config.getOwnOptional(globalThis, \"outdir\", ZigString.Slice)) |slice| {\n+            if (try config.getOptional(globalThis, \"outdir\", ZigString.Slice)) |slice| {\n                 defer slice.deinit();\n                 try this.outdir.appendSliceExact(slice.slice());\n                 has_out_dir = true;\n             }\n \n-            if (try config.getOwnOptional(globalThis, \"banner\", ZigString.Slice)) |slice| {\n+            if (try config.getOptional(globalThis, \"banner\", ZigString.Slice)) |slice| {\n                 defer slice.deinit();\n                 try this.banner.appendSliceExact(slice.slice());\n             }\n \n-            if (config.getOwnTruthy(globalThis, \"sourcemap\")) |source_map_js| {\n+            if (config.getTruthy(globalThis, \"sourcemap\")) |source_map_js| {\n                 if (bun.FeatureFlags.breaking_changes_1_2 and config.isBoolean()) {\n                     if (source_map_js == .true) {\n                         this.source_map = if (has_out_dir)\n@@ -207,11 +207,11 @@ pub const JSBundler = struct {\n                 }\n             }\n \n-            if (try config.getOwnOptionalEnum(globalThis, \"packages\", options.PackagesOption)) |packages| {\n+            if (try config.getOptionalEnum(globalThis, \"packages\", options.PackagesOption)) |packages| {\n                 this.packages = packages;\n             }\n \n-            if (try config.getOwnOptionalEnum(globalThis, \"format\", options.Format)) |format| {\n+            if (try config.getOptionalEnum(globalThis, \"format\", options.Format)) |format| {\n                 this.format = format;\n \n                 if (this.bytecode and format != .cjs) {\n@@ -220,28 +220,28 @@ pub const JSBundler = struct {\n                 }\n             }\n \n-            // if (try config.getOwnOptional(globalThis, \"hot\", bool)) |hot| {\n+            // if (try config.getOptional(globalThis, \"hot\", bool)) |hot| {\n             //     this.hot = hot;\n             // }\n \n-            if (try config.getOwnOptional(globalThis, \"splitting\", bool)) |hot| {\n+            if (try config.getOptional(globalThis, \"splitting\", bool)) |hot| {\n                 this.code_splitting = hot;\n             }\n \n-            if (config.getOwnTruthy(globalThis, \"minify\")) |hot| {\n+            if (config.getTruthy(globalThis, \"minify\")) |hot| {\n                 if (hot.isBoolean()) {\n                     const value = hot.coerce(bool, globalThis);\n                     this.minify.whitespace = value;\n                     this.minify.syntax = value;\n                     this.minify.identifiers = value;\n                 } else if (hot.isObject()) {\n-                    if (try hot.getOwnOptional(globalThis, \"whitespace\", bool)) |whitespace| {\n+                    if (try hot.getOptional(globalThis, \"whitespace\", bool)) |whitespace| {\n                         this.minify.whitespace = whitespace;\n                     }\n-                    if (try hot.getOwnOptional(globalThis, \"syntax\", bool)) |syntax| {\n+                    if (try hot.getOptional(globalThis, \"syntax\", bool)) |syntax| {\n                         this.minify.syntax = syntax;\n                     }\n-                    if (try hot.getOwnOptional(globalThis, \"identifiers\", bool)) |syntax| {\n+                    if (try hot.getOptional(globalThis, \"identifiers\", bool)) |syntax| {\n                         this.minify.identifiers = syntax;\n                     }\n                 } else {\n@@ -265,19 +265,19 @@ pub const JSBundler = struct {\n                 return error.JSError;\n             }\n \n-            if (config.getOwnTruthy(globalThis, \"emitDCEAnnotations\")) |flag| {\n+            if (config.getTruthy(globalThis, \"emitDCEAnnotations\")) |flag| {\n                 if (flag.coerce(bool, globalThis)) {\n                     this.emit_dce_annotations = true;\n                 }\n             }\n \n-            if (config.getOwnTruthy(globalThis, \"ignoreDCEAnnotations\")) |flag| {\n+            if (config.getTruthy(globalThis, \"ignoreDCEAnnotations\")) |flag| {\n                 if (flag.coerce(bool, globalThis)) {\n                     this.ignore_dce_annotations = true;\n                 }\n             }\n \n-            if (config.getOwnTruthy(globalThis, \"conditions\")) |conditions_value| {\n+            if (config.getTruthy(globalThis, \"conditions\")) |conditions_value| {\n                 if (conditions_value.isString()) {\n                     var slice = conditions_value.toSliceOrNull(globalThis) orelse {\n                         globalThis.throwInvalidArguments(\"Expected conditions to be an array of strings\", .{});\n@@ -303,7 +303,7 @@ pub const JSBundler = struct {\n \n             {\n                 const path: ZigString.Slice = brk: {\n-                    if (try config.getOwnOptional(globalThis, \"root\", ZigString.Slice)) |slice| {\n+                    if (try config.getOptional(globalThis, \"root\", ZigString.Slice)) |slice| {\n                         break :brk slice;\n                     }\n \n@@ -344,21 +344,21 @@ pub const JSBundler = struct {\n                 }\n             }\n \n-            // if (try config.getOwnOptional(globalThis, \"dir\", ZigString.Slice)) |slice| {\n+            // if (try config.getOptional(globalThis, \"dir\", ZigString.Slice)) |slice| {\n             //     defer slice.deinit();\n             //     this.appendSliceExact(slice.slice()) catch unreachable;\n             // } else {\n             //     this.appendSliceExact(globalThis.bunVM().bundler.fs.top_level_dir) catch unreachable;\n             // }\n \n-            if (try config.getOwnOptional(globalThis, \"publicPath\", ZigString.Slice)) |slice| {\n+            if (try config.getOptional(globalThis, \"publicPath\", ZigString.Slice)) |slice| {\n                 defer slice.deinit();\n                 try this.public_path.appendSliceExact(slice.slice());\n             }\n \n-            if (config.getOwnTruthy(globalThis, \"naming\")) |naming| {\n+            if (config.getTruthy(globalThis, \"naming\")) |naming| {\n                 if (naming.isString()) {\n-                    if (try config.getOwnOptional(globalThis, \"naming\", ZigString.Slice)) |slice| {\n+                    if (try config.getOptional(globalThis, \"naming\", ZigString.Slice)) |slice| {\n                         defer slice.deinit();\n                         if (!strings.hasPrefixComptime(slice.slice(), \"./\")) {\n                             try this.names.owned_entry_point.appendSliceExact(\"./\");\n@@ -367,7 +367,7 @@ pub const JSBundler = struct {\n                         this.names.entry_point.data = this.names.owned_entry_point.list.items;\n                     }\n                 } else if (naming.isObject()) {\n-                    if (try naming.getOwnOptional(globalThis, \"entry\", ZigString.Slice)) |slice| {\n+                    if (try naming.getOptional(globalThis, \"entry\", ZigString.Slice)) |slice| {\n                         defer slice.deinit();\n                         if (!strings.hasPrefixComptime(slice.slice(), \"./\")) {\n                             try this.names.owned_entry_point.appendSliceExact(\"./\");\n@@ -376,7 +376,7 @@ pub const JSBundler = struct {\n                         this.names.entry_point.data = this.names.owned_entry_point.list.items;\n                     }\n \n-                    if (try naming.getOwnOptional(globalThis, \"chunk\", ZigString.Slice)) |slice| {\n+                    if (try naming.getOptional(globalThis, \"chunk\", ZigString.Slice)) |slice| {\n                         defer slice.deinit();\n                         if (!strings.hasPrefixComptime(slice.slice(), \"./\")) {\n                             try this.names.owned_chunk.appendSliceExact(\"./\");\n@@ -385,7 +385,7 @@ pub const JSBundler = struct {\n                         this.names.chunk.data = this.names.owned_chunk.list.items;\n                     }\n \n-                    if (try naming.getOwnOptional(globalThis, \"asset\", ZigString.Slice)) |slice| {\n+                    if (try naming.getOptional(globalThis, \"asset\", ZigString.Slice)) |slice| {\n                         defer slice.deinit();\n                         if (!strings.hasPrefixComptime(slice.slice(), \"./\")) {\n                             try this.names.owned_asset.appendSliceExact(\"./\");"
            },
            {
                "sha": "2308ebc5a30b40c2673ad93c0b261c18a6bfea55",
                "filename": "src/bun.js/api/JSTranspiler.zig",
                "status": "modified",
                "additions": 23,
                "deletions": 23,
                "changes": 46,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2FJSTranspiler.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2FJSTranspiler.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2FJSTranspiler.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -329,7 +329,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         return transpiler;\n     }\n \n-    if (object.getOwnTruthy(globalObject, \"define\")) |define| {\n+    if (object.getTruthy(globalObject, \"define\")) |define| {\n         define: {\n             if (define.isUndefinedOrNull()) {\n                 break :define;\n@@ -378,7 +378,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         }\n     }\n \n-    if (object.getOwn(globalThis, \"external\")) |external| {\n+    if (object.get(globalThis, \"external\")) |external| {\n         external: {\n             if (external.isUndefinedOrNull()) break :external;\n \n@@ -418,7 +418,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         }\n     }\n \n-    if (object.getOwn(globalThis, \"loader\")) |loader| {\n+    if (object.get(globalThis, \"loader\")) |loader| {\n         if (Loader.fromJS(globalThis, loader, exception)) |resolved| {\n             if (!resolved.isJavaScriptLike()) {\n                 JSC.throwInvalidArguments(\"only JavaScript-like loaders supported for now\", .{}, globalObject, exception);\n@@ -433,7 +433,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         }\n     }\n \n-    if (object.getOwn(globalThis, \"target\")) |target| {\n+    if (object.get(globalThis, \"target\")) |target| {\n         if (Target.fromJS(globalThis, target, exception)) |resolved| {\n             transpiler.transform.target = resolved.toAPI();\n         }\n@@ -443,7 +443,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         }\n     }\n \n-    if (object.getOwn(globalThis, \"tsconfig\")) |tsconfig| {\n+    if (object.get(globalThis, \"tsconfig\")) |tsconfig| {\n         tsconfig: {\n             if (tsconfig.isUndefinedOrNull()) break :tsconfig;\n             const kind = tsconfig.jsType();\n@@ -482,7 +482,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         else => false,\n     };\n \n-    if (object.getOwnTruthy(globalThis, \"macro\")) |macros| {\n+    if (object.getTruthy(globalThis, \"macro\")) |macros| {\n         macros: {\n             if (macros.isUndefinedOrNull()) break :macros;\n             if (macros.isBoolean()) {\n@@ -517,39 +517,39 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         }\n     }\n \n-    if (object.getOwnOptional(globalThis, \"autoImportJSX\", bool) catch return transpiler) |flag| {\n+    if (object.getOptional(globalThis, \"autoImportJSX\", bool) catch return transpiler) |flag| {\n         transpiler.runtime.auto_import_jsx = flag;\n     }\n \n-    if (object.getOwnOptional(globalThis, \"allowBunRuntime\", bool) catch return transpiler) |flag| {\n+    if (object.getOptional(globalThis, \"allowBunRuntime\", bool) catch return transpiler) |flag| {\n         transpiler.runtime.allow_runtime = flag;\n     }\n \n-    if (object.getOwnOptional(globalThis, \"inline\", bool) catch return transpiler) |flag| {\n+    if (object.getOptional(globalThis, \"inline\", bool) catch return transpiler) |flag| {\n         transpiler.runtime.inlining = flag;\n     }\n \n-    if (object.getOwnOptional(globalThis, \"minifyWhitespace\", bool) catch return transpiler) |flag| {\n+    if (object.getOptional(globalThis, \"minifyWhitespace\", bool) catch return transpiler) |flag| {\n         transpiler.minify_whitespace = flag;\n     }\n \n-    if (object.getOwnOptional(globalThis, \"deadCodeElimination\", bool) catch return transpiler) |flag| {\n+    if (object.getOptional(globalThis, \"deadCodeElimination\", bool) catch return transpiler) |flag| {\n         transpiler.dead_code_elimination = flag;\n     }\n \n-    if (object.getOwnTruthy(globalThis, \"minify\")) |hot| {\n+    if (object.getTruthy(globalThis, \"minify\")) |hot| {\n         if (hot.isBoolean()) {\n             transpiler.minify_whitespace = hot.coerce(bool, globalThis);\n             transpiler.minify_syntax = transpiler.minify_whitespace;\n             transpiler.minify_identifiers = transpiler.minify_syntax;\n         } else if (hot.isObject()) {\n-            if (try hot.getOwnOptional(globalThis, \"whitespace\", bool)) |whitespace| {\n+            if (try hot.getOptional(globalThis, \"whitespace\", bool)) |whitespace| {\n                 transpiler.minify_whitespace = whitespace;\n             }\n-            if (try hot.getOwnOptional(globalThis, \"syntax\", bool)) |syntax| {\n+            if (try hot.getOptional(globalThis, \"syntax\", bool)) |syntax| {\n                 transpiler.minify_syntax = syntax;\n             }\n-            if (try hot.getOwnOptional(globalThis, \"identifiers\", bool)) |syntax| {\n+            if (try hot.getOptional(globalThis, \"identifiers\", bool)) |syntax| {\n                 transpiler.minify_identifiers = syntax;\n             }\n         } else {\n@@ -558,7 +558,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         }\n     }\n \n-    if (object.getOwn(globalThis, \"sourcemap\")) |flag| {\n+    if (object.get(globalThis, \"sourcemap\")) |flag| {\n         if (flag.isBoolean() or flag.isUndefinedOrNull()) {\n             if (flag.toBoolean()) {\n                 transpiler.transform.source_map = .@\"inline\";\n@@ -575,21 +575,21 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         }\n     }\n \n-    if (try object.getOwnOptionalEnum(globalThis, \"packages\", options.PackagesOption)) |packages| {\n+    if (try object.getOptionalEnum(globalThis, \"packages\", options.PackagesOption)) |packages| {\n         transpiler.transform.packages = packages.toAPI();\n     }\n \n     var tree_shaking: ?bool = null;\n-    if (object.getOwnOptional(globalThis, \"treeShaking\", bool) catch return transpiler) |treeShaking| {\n+    if (object.getOptional(globalThis, \"treeShaking\", bool) catch return transpiler) |treeShaking| {\n         tree_shaking = treeShaking;\n     }\n \n     var trim_unused_imports: ?bool = null;\n-    if (object.getOwnOptional(globalThis, \"trimUnusedImports\", bool) catch return transpiler) |trimUnusedImports| {\n+    if (object.getOptional(globalThis, \"trimUnusedImports\", bool) catch return transpiler) |trimUnusedImports| {\n         trim_unused_imports = trimUnusedImports;\n     }\n \n-    if (object.getOwnTruthy(globalThis, \"exports\")) |exports| {\n+    if (object.getTruthy(globalThis, \"exports\")) |exports| {\n         if (!exports.isObject()) {\n             JSC.throwInvalidArguments(\"exports must be an object\", .{}, globalObject, exception);\n             return transpiler;\n@@ -598,7 +598,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         var replacements = Runtime.Features.ReplaceableExport.Map{};\n         errdefer replacements.clearAndFree(bun.default_allocator);\n \n-        if (exports.getOwnTruthy(globalThis, \"eliminate\")) |eliminate| {\n+        if (exports.getTruthy(globalThis, \"eliminate\")) |eliminate| {\n             if (!eliminate.jsType().isArray()) {\n                 JSC.throwInvalidArguments(\"exports.eliminate must be an array\", .{}, globalObject, exception);\n                 return transpiler;\n@@ -640,7 +640,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n             }\n         }\n \n-        if (exports.getOwnTruthy(globalThis, \"replace\")) |replace| {\n+        if (exports.getTruthy(globalThis, \"replace\")) |replace| {\n             if (!replace.isObject()) {\n                 JSC.throwInvalidArguments(\"replace must be an object\", .{}, globalObject, exception);\n                 return transpiler;\n@@ -717,7 +717,7 @@ fn transformOptionsFromJSC(globalObject: JSC.C.JSContextRef, temp_allocator: std\n         transpiler.runtime.replace_exports = replacements;\n     }\n \n-    if (object.getOwnTruthy(globalThis, \"logLevel\")) |logLevel| {\n+    if (object.getTruthy(globalThis, \"logLevel\")) |logLevel| {\n         if (logger.Log.Level.Map.fromJS(globalObject, logLevel)) |level| {\n             transpiler.log.level = level;\n         } else {"
            },
            {
                "sha": "d2f1d43c03d80142ba6484ae561ddd25a43e1572",
                "filename": "src/bun.js/api/bun/socket.zig",
                "status": "modified",
                "additions": 13,
                "deletions": 13,
                "changes": 26,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fbun%2Fsocket.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fbun%2Fsocket.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2Fbun%2Fsocket.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -239,7 +239,7 @@ const Handlers = struct {\n             .{ \"onHandshake\", \"handshake\" },\n         };\n         inline for (pairs) |pair| {\n-            if (opts.getOwnTruthyComptime(globalObject, pair.@\"1\")) |callback_value| {\n+            if (opts.getTruthyComptime(globalObject, pair.@\"1\")) |callback_value| {\n                 if (!callback_value.isCell() or !callback_value.isCallable(globalObject.vm())) {\n                     exception.* = JSC.toInvalidArguments(comptime std.fmt.comptimePrint(\"Expected \\\"{s}\\\" callback to be a function\", .{pair.@\"1\"}), .{}, globalObject).asObjectRef();\n                     return null;\n@@ -254,7 +254,7 @@ const Handlers = struct {\n             return null;\n         }\n \n-        if (opts.getOwnTruthy(globalObject, \"binaryType\")) |binary_type_value| {\n+        if (opts.getTruthy(globalObject, \"binaryType\")) |binary_type_value| {\n             if (!binary_type_value.isString()) {\n                 exception.* = JSC.toInvalidArguments(\"Expected \\\"binaryType\\\" to be a string\", .{}, globalObject).asObjectRef();\n                 return null;\n@@ -341,13 +341,13 @@ pub const SocketConfig = struct {\n         }\n \n         hostname_or_unix: {\n-            if (opts.getOwnTruthy(globalObject, \"fd\")) |fd_| {\n+            if (opts.getTruthy(globalObject, \"fd\")) |fd_| {\n                 if (fd_.isNumber()) {\n                     break :hostname_or_unix;\n                 }\n             }\n \n-            if (opts.getOwnTruthy(globalObject, \"unix\")) |unix_socket| {\n+            if (opts.getTruthy(globalObject, \"unix\")) |unix_socket| {\n                 if (!unix_socket.isString()) {\n                     exception.* = JSC.toInvalidArguments(\"Expected \\\"unix\\\" to be a string\", .{}, globalObject).asObjectRef();\n                     return null;\n@@ -365,17 +365,17 @@ pub const SocketConfig = struct {\n                 }\n             }\n \n-            if (opts.getOwnTruthy(globalObject, \"exclusive\")) |_| {\n+            if (opts.getTruthy(globalObject, \"exclusive\")) |_| {\n                 exclusive = true;\n             }\n \n-            if (opts.getOwnTruthy(globalObject, \"hostname\") orelse opts.getOwnTruthy(globalObject, \"host\")) |hostname| {\n+            if (opts.getTruthy(globalObject, \"hostname\") orelse opts.getTruthy(globalObject, \"host\")) |hostname| {\n                 if (!hostname.isString()) {\n                     exception.* = JSC.toInvalidArguments(\"Expected \\\"hostname\\\" to be a string\", .{}, globalObject).asObjectRef();\n                     return null;\n                 }\n \n-                var port_value = opts.getOwn(globalObject, \"port\") orelse JSValue.zero;\n+                var port_value = opts.get(globalObject, \"port\") orelse JSValue.zero;\n                 hostname_or_unix = hostname.getZigString(globalObject).toSlice(bun.default_allocator);\n \n                 if (port_value.isEmptyOrUndefinedOrNull() and hostname_or_unix.len > 0) {\n@@ -423,7 +423,7 @@ pub const SocketConfig = struct {\n             return null;\n         }\n \n-        var handlers = Handlers.fromJS(globalObject, opts.getOwn(globalObject, \"socket\") orelse JSValue.zero, exception) orelse {\n+        var handlers = Handlers.fromJS(globalObject, opts.get(globalObject, \"socket\") orelse JSValue.zero, exception) orelse {\n             hostname_or_unix.deinit();\n             return null;\n         };\n@@ -542,7 +542,7 @@ pub const Listener = struct {\n \n         var exception: JSC.C.JSValueRef = null;\n \n-        const socket_obj = opts.getOwn(globalObject, \"socket\") orelse {\n+        const socket_obj = opts.get(globalObject, \"socket\") orelse {\n             globalObject.throw(\"Expected \\\"socket\\\" object\", .{});\n             return .zero;\n         };\n@@ -1069,7 +1069,7 @@ pub const Listener = struct {\n         vm.eventLoop().ensureWaker();\n \n         var connection: Listener.UnixOrHost = blk: {\n-            if (opts.getOwnTruthy(globalObject, \"fd\")) |fd_| {\n+            if (opts.getTruthy(globalObject, \"fd\")) |fd_| {\n                 if (fd_.isNumber()) {\n                     const fd = fd_.asFileDescriptor();\n                     break :blk .{ .fd = fd };\n@@ -2308,7 +2308,7 @@ fn NewSocket(comptime ssl: bool) type {\n \n             var exception: JSC.C.JSValueRef = null;\n \n-            const socket_obj = opts.getOwn(globalObject, \"socket\") orelse {\n+            const socket_obj = opts.get(globalObject, \"socket\") orelse {\n                 globalObject.throw(\"Expected \\\"socket\\\" option\", .{});\n                 return .zero;\n             };\n@@ -3082,7 +3082,7 @@ fn NewSocket(comptime ssl: bool) type {\n                 return .zero;\n             }\n \n-            const socket_obj = opts.getOwn(globalObject, \"socket\") orelse {\n+            const socket_obj = opts.get(globalObject, \"socket\") orelse {\n                 globalObject.throw(\"Expected \\\"socket\\\" option\", .{});\n                 return .zero;\n             };\n@@ -4007,7 +4007,7 @@ pub fn jsUpgradeDuplexToTLS(globalObject: *JSC.JSGlobalObject, callframe: *JSC.C\n         return .zero;\n     }\n \n-    const socket_obj = opts.getOwn(globalObject, \"socket\") orelse {\n+    const socket_obj = opts.get(globalObject, \"socket\") orelse {\n         globalObject.throw(\"Expected \\\"socket\\\" option\", .{});\n         return .zero;\n     };"
            },
            {
                "sha": "0488615ee91a05ebd8e08292cd1a4c68003a7191",
                "filename": "src/bun.js/api/bun/subprocess.zig",
                "status": "modified",
                "additions": 17,
                "deletions": 17,
                "changes": 34,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fbun%2Fsubprocess.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fbun%2Fsubprocess.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2Fbun%2Fsubprocess.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -1745,15 +1745,15 @@ pub const Subprocess = struct {\n             } else if (!args.isObject()) {\n                 globalThis.throwInvalidArguments(\"cmd must be an array\", .{});\n                 return .zero;\n-            } else if (args.getOwnTruthy(globalThis, \"cmd\")) |cmd_value_| {\n+            } else if (args.getTruthy(globalThis, \"cmd\")) |cmd_value_| {\n                 cmd_value = cmd_value_;\n             } else {\n                 globalThis.throwInvalidArguments(\"cmd must be an array\", .{});\n                 return .zero;\n             }\n \n             if (args.isObject()) {\n-                if (args.getOwnTruthy(globalThis, \"argv0\")) |argv0_| {\n+                if (args.getTruthy(globalThis, \"argv0\")) |argv0_| {\n                     const argv0_str = argv0_.getZigString(globalThis);\n                     if (argv0_str.len > 0) {\n                         argv0 = argv0_str.toOwnedSliceZ(allocator) catch {\n@@ -1764,7 +1764,7 @@ pub const Subprocess = struct {\n                 }\n \n                 // need to update `cwd` before searching for executable with `Which.which`\n-                if (args.getOwnTruthy(globalThis, \"cwd\")) |cwd_| {\n+                if (args.getTruthy(globalThis, \"cwd\")) |cwd_| {\n                     const cwd_str = cwd_.getZigString(globalThis);\n                     if (cwd_str.len > 0) {\n                         cwd = cwd_str.toOwnedSliceZ(allocator) catch {\n@@ -1849,10 +1849,10 @@ pub const Subprocess = struct {\n             if (args != .zero and args.isObject()) {\n                 // This must run before the stdio parsing happens\n                 if (!is_sync) {\n-                    if (args.getOwnTruthy(globalThis, \"ipc\")) |val| {\n+                    if (args.getTruthy(globalThis, \"ipc\")) |val| {\n                         if (val.isCell() and val.isCallable(globalThis.vm())) {\n                             maybe_ipc_mode = ipc_mode: {\n-                                if (args.getOwnTruthy(globalThis, \"serialization\")) |mode_val| {\n+                                if (args.getTruthy(globalThis, \"serialization\")) |mode_val| {\n                                     if (mode_val.isString()) {\n                                         break :ipc_mode IPC.Mode.fromJS(globalThis, mode_val) orelse {\n                                             if (!globalThis.hasException()) {\n@@ -1875,15 +1875,15 @@ pub const Subprocess = struct {\n                     }\n                 }\n \n-                if (args.getOwnTruthy(globalThis, \"signal\")) |signal_val| {\n+                if (args.getTruthy(globalThis, \"signal\")) |signal_val| {\n                     if (signal_val.as(JSC.WebCore.AbortSignal)) |signal| {\n                         abort_signal = signal.ref();\n                     } else {\n                         return globalThis.throwInvalidArgumentTypeValue(\"signal\", \"AbortSignal\", signal_val);\n                     }\n                 }\n \n-                if (args.getOwnTruthy(globalThis, \"onDisconnect\")) |onDisconnect_| {\n+                if (args.getTruthy(globalThis, \"onDisconnect\")) |onDisconnect_| {\n                     if (!onDisconnect_.isCell() or !onDisconnect_.isCallable(globalThis.vm())) {\n                         globalThis.throwInvalidArguments(\"onDisconnect must be a function or undefined\", .{});\n                         return .zero;\n@@ -1895,7 +1895,7 @@ pub const Subprocess = struct {\n                         onDisconnect_.withAsyncContextIfNeeded(globalThis);\n                 }\n \n-                if (args.getOwnTruthy(globalThis, \"onExit\")) |onExit_| {\n+                if (args.getTruthy(globalThis, \"onExit\")) |onExit_| {\n                     if (!onExit_.isCell() or !onExit_.isCallable(globalThis.vm())) {\n                         globalThis.throwInvalidArguments(\"onExit must be a function or undefined\", .{});\n                         return .zero;\n@@ -1907,7 +1907,7 @@ pub const Subprocess = struct {\n                         onExit_.withAsyncContextIfNeeded(globalThis);\n                 }\n \n-                if (args.getOwnTruthy(globalThis, \"env\")) |object| {\n+                if (args.getTruthy(globalThis, \"env\")) |object| {\n                     if (!object.isObject()) {\n                         globalThis.throwInvalidArguments(\"env must be an object\", .{});\n                         return .zero;\n@@ -1923,7 +1923,7 @@ pub const Subprocess = struct {\n                     };\n                     env_array = envp_managed.moveToUnmanaged();\n                 }\n-                if (args.getOwn(globalThis, \"stdio\")) |stdio_val| {\n+                if (args.get(globalThis, \"stdio\")) |stdio_val| {\n                     if (!stdio_val.isEmptyOrUndefinedOrNull()) {\n                         if (stdio_val.jsType().isArray()) {\n                             var stdio_iter = stdio_val.arrayIterator(globalThis);\n@@ -1962,44 +1962,44 @@ pub const Subprocess = struct {\n                         }\n                     }\n                 } else {\n-                    if (args.getOwn(globalThis, \"stdin\")) |value| {\n+                    if (args.get(globalThis, \"stdin\")) |value| {\n                         if (!stdio[0].extract(globalThis, 0, value))\n                             return .zero;\n                     }\n \n-                    if (args.getOwn(globalThis, \"stderr\")) |value| {\n+                    if (args.get(globalThis, \"stderr\")) |value| {\n                         if (!stdio[2].extract(globalThis, 2, value))\n                             return .zero;\n                     }\n \n-                    if (args.getOwn(globalThis, \"stdout\")) |value| {\n+                    if (args.get(globalThis, \"stdout\")) |value| {\n                         if (!stdio[1].extract(globalThis, 1, value))\n                             return .zero;\n                     }\n                 }\n \n                 if (comptime !is_sync) {\n-                    if (args.getOwn(globalThis, \"lazy\")) |lazy_val| {\n+                    if (args.get(globalThis, \"lazy\")) |lazy_val| {\n                         if (lazy_val.isBoolean()) {\n                             lazy = lazy_val.toBoolean();\n                         }\n                     }\n                 }\n \n-                if (args.getOwn(globalThis, \"detached\")) |detached_val| {\n+                if (args.get(globalThis, \"detached\")) |detached_val| {\n                     if (detached_val.isBoolean()) {\n                         detached = detached_val.toBoolean();\n                     }\n                 }\n \n                 if (Environment.isWindows) {\n-                    if (args.getOwn(globalThis, \"windowsHide\")) |val| {\n+                    if (args.get(globalThis, \"windowsHide\")) |val| {\n                         if (val.isBoolean()) {\n                             windows_hide = val.asBoolean();\n                         }\n                     }\n \n-                    if (args.getOwn(globalThis, \"windowsVerbatimArguments\")) |val| {\n+                    if (args.get(globalThis, \"windowsVerbatimArguments\")) |val| {\n                         if (val.isBoolean()) {\n                             windows_verbatim_arguments = val.asBoolean();\n                         }"
            },
            {
                "sha": "c8252ee664cccc0dd4dd62fcc503f2becd09ffdc",
                "filename": "src/bun.js/api/bun/udp_socket.zig",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fbun%2Fudp_socket.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fbun%2Fudp_socket.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2Fbun%2Fudp_socket.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -129,7 +129,7 @@ pub const UDPSocketConfig = struct {\n         }\n \n         const hostname = brk: {\n-            if (options.getOwnTruthy(globalThis, \"hostname\")) |value| {\n+            if (options.getTruthy(globalThis, \"hostname\")) |value| {\n                 if (!value.isString()) {\n                     globalThis.throwInvalidArguments(\"Expected \\\"hostname\\\" to be a string\", .{});\n                     return null;\n@@ -144,7 +144,7 @@ pub const UDPSocketConfig = struct {\n         defer if (globalThis.hasException()) default_allocator.free(hostname);\n \n         const port: u16 = brk: {\n-            if (options.getOwnTruthy(globalThis, \"port\")) |value| {\n+            if (options.getTruthy(globalThis, \"port\")) |value| {\n                 const number = value.coerceToInt32(globalThis);\n                 if (number < 0 or number > 0xffff) {\n                     globalThis.throwInvalidArguments(\"Expected \\\"port\\\" to be an integer between 0 and 65535\", .{});\n@@ -161,13 +161,13 @@ pub const UDPSocketConfig = struct {\n             .port = port,\n         };\n \n-        if (options.getOwnTruthy(globalThis, \"socket\")) |socket| {\n+        if (options.getTruthy(globalThis, \"socket\")) |socket| {\n             if (!socket.isObject()) {\n                 globalThis.throwInvalidArguments(\"Expected \\\"socket\\\" to be an object\", .{});\n                 return null;\n             }\n \n-            if (options.getOwnTruthy(globalThis, \"binaryType\")) |value| {\n+            if (options.getTruthy(globalThis, \"binaryType\")) |value| {\n                 if (!value.isString()) {\n                     globalThis.throwInvalidArguments(\"Expected \\\"socket.binaryType\\\" to be a string\", .{});\n                     return null;\n@@ -180,7 +180,7 @@ pub const UDPSocketConfig = struct {\n             }\n \n             inline for (handlers) |handler| {\n-                if (socket.getOwnTruthyComptime(globalThis, handler.@\"0\")) |value| {\n+                if (socket.getTruthyComptime(globalThis, handler.@\"0\")) |value| {\n                     if (!value.isCell() or !value.isCallable(globalThis.vm())) {\n                         globalThis.throwInvalidArguments(\"Expected \\\"socket.{s}\\\" to be a function\", .{handler.@\"0\"});\n                         return null;\n@@ -198,13 +198,13 @@ pub const UDPSocketConfig = struct {\n             }\n         }\n \n-        if (options.getOwnTruthy(globalThis, \"connect\")) |connect| {\n+        if (options.getTruthy(globalThis, \"connect\")) |connect| {\n             if (!connect.isObject()) {\n                 globalThis.throwInvalidArguments(\"Expected \\\"connect\\\" to be an object\", .{});\n                 return null;\n             }\n \n-            const connect_host_js = connect.getOwnTruthy(globalThis, \"hostname\") orelse {\n+            const connect_host_js = connect.getTruthy(globalThis, \"hostname\") orelse {\n                 globalThis.throwInvalidArguments(\"Expected \\\"connect.hostname\\\" to be a string\", .{});\n                 return null;\n             };\n@@ -214,7 +214,7 @@ pub const UDPSocketConfig = struct {\n                 return null;\n             }\n \n-            const connect_port_js = connect.getOwnTruthy(globalThis, \"port\") orelse {\n+            const connect_port_js = connect.getTruthy(globalThis, \"port\") orelse {\n                 globalThis.throwInvalidArguments(\"Expected \\\"connect.port\\\" to be an integer\", .{});\n                 return null;\n             };"
            },
            {
                "sha": "16ffd9407584ec7fc196502af5dfa80a9c1bdd81",
                "filename": "src/bun.js/api/ffi.zig",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fffi.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fffi.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2Fffi.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -655,7 +655,7 @@ pub const FFI = struct {\n             return .zero;\n         }\n \n-        if (object.getOwnTruthy(globalThis, \"flags\")) |flags_value| {\n+        if (object.getTruthy(globalThis, \"flags\")) |flags_value| {\n             if (flags_value.isArray()) {\n                 var iter = flags_value.arrayIterator(globalThis);\n \n@@ -692,7 +692,7 @@ pub const FFI = struct {\n             return .zero;\n         }\n \n-        if (object.getOwnTruthy(globalThis, \"define\")) |define_value| {\n+        if (object.getTruthy(globalThis, \"define\")) |define_value| {\n             if (define_value.isObject()) {\n                 const Iter = JSC.JSPropertyIterator(.{ .include_value = true, .skip_empty_name = true });\n                 var iter = Iter.init(globalThis, define_value);\n@@ -722,7 +722,7 @@ pub const FFI = struct {\n             return .zero;\n         }\n \n-        if (object.getOwnTruthy(globalThis, \"include\")) |include_value| {\n+        if (object.getTruthy(globalThis, \"include\")) |include_value| {\n             compile_c.include_dirs = StringArray.fromJS(globalThis, include_value, \"include\");\n         }\n \n@@ -1347,11 +1347,11 @@ pub const FFI = struct {\n \n         var threadsafe = false;\n \n-        if (value.getOwnTruthy(global, \"threadsafe\")) |threadsafe_value| {\n+        if (value.getTruthy(global, \"threadsafe\")) |threadsafe_value| {\n             threadsafe = threadsafe_value.toBoolean();\n         }\n \n-        if (value.getOwnTruthy(global, \"returns\")) |ret_value| brk: {\n+        if (value.getTruthy(global, \"returns\")) |ret_value| brk: {\n             if (ret_value.isAnyInt()) {\n                 const int = ret_value.toInt32();\n                 switch (int) {"
            },
            {
                "sha": "3083c98bdcae4bed1c55f6ae0a075044b4d81033",
                "filename": "src/bun.js/api/filesystem_router.zig",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Ffilesystem_router.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Ffilesystem_router.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2Ffilesystem_router.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -69,7 +69,7 @@ pub const FileSystemRouter = struct {\n         var asset_prefix_slice: ZigString.Slice = .{};\n \n         var out_buf: [bun.MAX_PATH_BYTES * 2]u8 = undefined;\n-        if (argument.getOwn(globalThis, \"style\")) |style_val| {\n+        if (argument.get(globalThis, \"style\")) |style_val| {\n             if (!style_val.getZigString(globalThis).eqlComptime(\"nextjs\")) {\n                 globalThis.throwInvalidArguments(\"Only 'nextjs' style is currently implemented\", .{});\n                 return null;\n@@ -79,7 +79,7 @@ pub const FileSystemRouter = struct {\n             return null;\n         }\n \n-        if (argument.getOwn(globalThis, \"dir\")) |dir| {\n+        if (argument.get(globalThis, \"dir\")) |dir| {\n             if (!dir.isString()) {\n                 globalThis.throwInvalidArguments(\"Expected dir to be a string\", .{});\n                 return null;\n@@ -104,7 +104,7 @@ pub const FileSystemRouter = struct {\n         arena.* = bun.ArenaAllocator.init(globalThis.allocator());\n         const allocator = arena.allocator();\n         var extensions = std.ArrayList(string).init(allocator);\n-        if (argument.getOwn(globalThis, \"fileExtensions\")) |file_extensions| {\n+        if (argument.get(globalThis, \"fileExtensions\")) |file_extensions| {\n             if (!file_extensions.jsType().isArray()) {\n                 globalThis.throwInvalidArguments(\"Expected fileExtensions to be an Array\", .{});\n                 origin_str.deinit();\n@@ -128,7 +128,7 @@ pub const FileSystemRouter = struct {\n             }\n         }\n \n-        if (argument.getOwnTruthy(globalThis, \"assetPrefix\")) |asset_prefix| {\n+        if (argument.getTruthy(globalThis, \"assetPrefix\")) |asset_prefix| {\n             if (!asset_prefix.isString()) {\n                 globalThis.throwInvalidArguments(\"Expected assetPrefix to be a string\", .{});\n                 origin_str.deinit();\n@@ -174,7 +174,7 @@ pub const FileSystemRouter = struct {\n             return null;\n         };\n \n-        if (argument.getOwn(globalThis, \"origin\")) |origin| {\n+        if (argument.get(globalThis, \"origin\")) |origin| {\n             if (!origin.isString()) {\n                 globalThis.throwInvalidArguments(\"Expected origin to be a string\", .{});\n                 arena.deinit();"
            },
            {
                "sha": "122aff963b989a1480fbaa955eabf77186984b67",
                "filename": "src/bun.js/api/glob.zig",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fglob.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fglob.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2Fglob.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -120,23 +120,23 @@ const ScanOpts = struct {\n             return null;\n         }\n \n-        if (optsObj.getOwnTruthy(globalThis, \"onlyFiles\")) |only_files| {\n+        if (optsObj.getTruthy(globalThis, \"onlyFiles\")) |only_files| {\n             out.only_files = if (only_files.isBoolean()) only_files.asBoolean() else false;\n         }\n \n-        if (optsObj.getOwnTruthy(globalThis, \"throwErrorOnBrokenSymlink\")) |error_on_broken| {\n+        if (optsObj.getTruthy(globalThis, \"throwErrorOnBrokenSymlink\")) |error_on_broken| {\n             out.error_on_broken_symlinks = if (error_on_broken.isBoolean()) error_on_broken.asBoolean() else false;\n         }\n \n-        if (optsObj.getOwnTruthy(globalThis, \"followSymlinks\")) |followSymlinksVal| {\n+        if (optsObj.getTruthy(globalThis, \"followSymlinks\")) |followSymlinksVal| {\n             out.follow_symlinks = if (followSymlinksVal.isBoolean()) followSymlinksVal.asBoolean() else false;\n         }\n \n-        if (optsObj.getOwnTruthy(globalThis, \"absolute\")) |absoluteVal| {\n+        if (optsObj.getTruthy(globalThis, \"absolute\")) |absoluteVal| {\n             out.absolute = if (absoluteVal.isBoolean()) absoluteVal.asBoolean() else false;\n         }\n \n-        if (optsObj.getOwnTruthy(globalThis, \"cwd\")) |cwdVal| {\n+        if (optsObj.getTruthy(globalThis, \"cwd\")) |cwdVal| {\n             if (!cwdVal.isString()) {\n                 globalThis.throw(\"{s}: invalid `cwd`, not a string\", .{fnName});\n                 return null;\n@@ -152,7 +152,7 @@ const ScanOpts = struct {\n             }\n         }\n \n-        if (optsObj.getOwnTruthy(globalThis, \"dot\")) |dot| {\n+        if (optsObj.getTruthy(globalThis, \"dot\")) |dot| {\n             out.dot = if (dot.isBoolean()) dot.asBoolean() else false;\n         }\n "
            },
            {
                "sha": "755a6a9d4c5d1b2c1bb1330e7e930bfe9cce4eaf",
                "filename": "src/bun.js/api/server.zig",
                "status": "modified",
                "additions": 46,
                "deletions": 46,
                "changes": 92,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fserver.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fapi%2Fserver.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fapi%2Fserver.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -764,7 +764,7 @@ pub const ServerConfig = struct {\n             result.reject_unauthorized = @intFromBool(vm.getTLSRejectUnauthorized());\n \n             // Required\n-            if (obj.getOwnTruthy(global, \"keyFile\")) |key_file_name| {\n+            if (obj.getTruthy(global, \"keyFile\")) |key_file_name| {\n                 var sliced = key_file_name.toSlice(global, bun.default_allocator);\n                 defer sliced.deinit();\n                 if (sliced.len > 0) {\n@@ -780,7 +780,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"key\")) |js_obj| {\n+            if (obj.getTruthy(global, \"key\")) |js_obj| {\n                 if (js_obj.jsType().isArray()) {\n                     const count = js_obj.getLength(global);\n                     if (count > 0) {\n@@ -863,7 +863,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"certFile\")) |cert_file_name| {\n+            if (obj.getTruthy(global, \"certFile\")) |cert_file_name| {\n                 var sliced = cert_file_name.toSlice(global, bun.default_allocator);\n                 defer sliced.deinit();\n                 if (sliced.len > 0) {\n@@ -878,7 +878,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"ALPNProtocols\")) |protocols| {\n+            if (obj.getTruthy(global, \"ALPNProtocols\")) |protocols| {\n                 if (JSC.Node.StringOrBuffer.fromJS(global, arena.allocator(), protocols)) |sb| {\n                     defer sb.deinit();\n                     const sliced = sb.slice();\n@@ -896,7 +896,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"cert\")) |js_obj| {\n+            if (obj.getTruthy(global, \"cert\")) |js_obj| {\n                 if (js_obj.jsType().isArray()) {\n                     const count = js_obj.getLength(global);\n                     if (count > 0) {\n@@ -979,7 +979,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"requestCert\")) |request_cert| {\n+            if (obj.getTruthy(global, \"requestCert\")) |request_cert| {\n                 if (request_cert.isBoolean()) {\n                     result.request_cert = if (request_cert.asBoolean()) 1 else 0;\n                     any = true;\n@@ -990,7 +990,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"rejectUnauthorized\")) |reject_unauthorized| {\n+            if (obj.getTruthy(global, \"rejectUnauthorized\")) |reject_unauthorized| {\n                 if (reject_unauthorized.isBoolean()) {\n                     result.reject_unauthorized = if (reject_unauthorized.asBoolean()) 1 else 0;\n                     any = true;\n@@ -1001,7 +1001,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"ciphers\")) |ssl_ciphers| {\n+            if (obj.getTruthy(global, \"ciphers\")) |ssl_ciphers| {\n                 var sliced = ssl_ciphers.toSlice(global, bun.default_allocator);\n                 defer sliced.deinit();\n                 if (sliced.len > 0) {\n@@ -1011,7 +1011,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"serverName\") orelse obj.getOwnTruthy(global, \"servername\")) |server_name| {\n+            if (obj.getTruthy(global, \"serverName\") orelse obj.getTruthy(global, \"servername\")) |server_name| {\n                 var sliced = server_name.toSlice(global, bun.default_allocator);\n                 defer sliced.deinit();\n                 if (sliced.len > 0) {\n@@ -1021,7 +1021,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"ca\")) |js_obj| {\n+            if (obj.getTruthy(global, \"ca\")) |js_obj| {\n                 if (js_obj.jsType().isArray()) {\n                     const count = js_obj.getLength(global);\n                     if (count > 0) {\n@@ -1104,7 +1104,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (obj.getOwnTruthy(global, \"caFile\")) |ca_file_name| {\n+            if (obj.getTruthy(global, \"caFile\")) |ca_file_name| {\n                 var sliced = ca_file_name.toSlice(global, bun.default_allocator);\n                 defer sliced.deinit();\n                 if (sliced.len > 0) {\n@@ -1118,25 +1118,25 @@ pub const ServerConfig = struct {\n             }\n             // Optional\n             if (any) {\n-                if (obj.getOwnTruthy(global, \"secureOptions\")) |secure_options| {\n+                if (obj.getTruthy(global, \"secureOptions\")) |secure_options| {\n                     if (secure_options.isNumber()) {\n                         result.secure_options = secure_options.toU32();\n                     }\n                 }\n \n-                if (obj.getOwnTruthy(global, \"clientRenegotiationLimit\")) |client_renegotiation_limit| {\n+                if (obj.getTruthy(global, \"clientRenegotiationLimit\")) |client_renegotiation_limit| {\n                     if (client_renegotiation_limit.isNumber()) {\n                         result.client_renegotiation_limit = client_renegotiation_limit.toU32();\n                     }\n                 }\n \n-                if (obj.getOwnTruthy(global, \"clientRenegotiationWindow\")) |client_renegotiation_window| {\n+                if (obj.getTruthy(global, \"clientRenegotiationWindow\")) |client_renegotiation_window| {\n                     if (client_renegotiation_window.isNumber()) {\n                         result.client_renegotiation_window = client_renegotiation_window.toU32();\n                     }\n                 }\n \n-                if (obj.getOwnTruthy(global, \"dhParamsFile\")) |dh_params_file_name| {\n+                if (obj.getTruthy(global, \"dhParamsFile\")) |dh_params_file_name| {\n                     var sliced = dh_params_file_name.toSlice(global, bun.default_allocator);\n                     defer sliced.deinit();\n                     if (sliced.len > 0) {\n@@ -1149,15 +1149,15 @@ pub const ServerConfig = struct {\n                     }\n                 }\n \n-                if (obj.getOwnTruthy(global, \"passphrase\")) |passphrase| {\n+                if (obj.getTruthy(global, \"passphrase\")) |passphrase| {\n                     var sliced = passphrase.toSlice(global, bun.default_allocator);\n                     defer sliced.deinit();\n                     if (sliced.len > 0) {\n                         result.passphrase = bun.default_allocator.dupeZ(u8, sliced.slice()) catch unreachable;\n                     }\n                 }\n \n-                if (obj.getOwn(global, \"lowMemoryMode\")) |low_memory_mode| {\n+                if (obj.get(global, \"lowMemoryMode\")) |low_memory_mode| {\n                     if (low_memory_mode.isBoolean() or low_memory_mode.isUndefined()) {\n                         result.low_memory_mode = low_memory_mode.toBoolean();\n                         any = true;\n@@ -1240,7 +1240,7 @@ pub const ServerConfig = struct {\n                 return args;\n             }\n \n-            if (arg.getOwn(global, \"static\")) |static| {\n+            if (arg.get(global, \"static\")) |static| {\n                 if (!static.isObject()) {\n                     JSC.throwInvalidArguments(\"Bun.serve expects 'static' to be an object shaped like { [pathname: string]: Response }\", .{}, global, exception);\n                     return args;\n@@ -1285,7 +1285,7 @@ pub const ServerConfig = struct {\n \n             if (global.hasException()) return args;\n \n-            if (arg.getOwn(global, \"idleTimeout\")) |value| {\n+            if (arg.get(global, \"idleTimeout\")) |value| {\n                 if (!value.isUndefinedOrNull()) {\n                     if (!value.isAnyInt()) {\n                         JSC.throwInvalidArguments(\"Bun.serve expects idleTimeout to be an integer\", .{}, global, exception);\n@@ -1303,7 +1303,7 @@ pub const ServerConfig = struct {\n                 }\n             }\n \n-            if (arg.getOwnTruthy(global, \"webSocket\") orelse arg.getOwnTruthy(global, \"websocket\")) |websocket_object| {\n+            if (arg.getTruthy(global, \"webSocket\") orelse arg.getTruthy(global, \"websocket\")) |websocket_object| {\n                 if (!websocket_object.isObject()) {\n                     JSC.throwInvalidArguments(\"Expected websocket to be an object\", .{}, global, exception);\n                     if (args.ssl_config) |*conf| {\n@@ -1323,7 +1323,7 @@ pub const ServerConfig = struct {\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwnTruthy(global, \"port\")) |port_| {\n+            if (arg.getTruthy(global, \"port\")) |port_| {\n                 args.address.tcp.port = @as(\n                     u16,\n                     @intCast(@min(\n@@ -1335,7 +1335,7 @@ pub const ServerConfig = struct {\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwnTruthy(global, \"baseURI\")) |baseURI| {\n+            if (arg.getTruthy(global, \"baseURI\")) |baseURI| {\n                 var sliced = baseURI.toSlice(global, bun.default_allocator);\n \n                 if (sliced.len > 0) {\n@@ -1345,7 +1345,7 @@ pub const ServerConfig = struct {\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwnTruthy(global, \"hostname\") orelse arg.getOwnTruthy(global, \"host\")) |host| {\n+            if (arg.getTruthy(global, \"hostname\") orelse arg.getTruthy(global, \"host\")) |host| {\n                 const host_str = host.toSlice(\n                     global,\n                     bun.default_allocator,\n@@ -1359,7 +1359,7 @@ pub const ServerConfig = struct {\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwnTruthy(global, \"unix\")) |unix| {\n+            if (arg.getTruthy(global, \"unix\")) |unix| {\n                 const unix_str = unix.toSlice(\n                     global,\n                     bun.default_allocator,\n@@ -1376,7 +1376,7 @@ pub const ServerConfig = struct {\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwn(global, \"id\")) |id| {\n+            if (arg.get(global, \"id\")) |id| {\n                 if (id.isUndefinedOrNull()) {\n                     args.allow_hot = false;\n                 } else {\n@@ -1394,18 +1394,18 @@ pub const ServerConfig = struct {\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwn(global, \"development\")) |dev| {\n+            if (arg.get(global, \"development\")) |dev| {\n                 args.development = dev.coerce(bool, global);\n                 args.reuse_port = !args.development;\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwn(global, \"reusePort\")) |dev| {\n+            if (arg.get(global, \"reusePort\")) |dev| {\n                 args.reuse_port = dev.coerce(bool, global);\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwn(global, \"inspector\")) |inspector| {\n+            if (arg.get(global, \"inspector\")) |inspector| {\n                 args.inspector = inspector.coerce(bool, global);\n \n                 if (args.inspector and !args.development) {\n@@ -1415,14 +1415,14 @@ pub const ServerConfig = struct {\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwnTruthy(global, \"maxRequestBodySize\")) |max_request_body_size| {\n+            if (arg.getTruthy(global, \"maxRequestBodySize\")) |max_request_body_size| {\n                 if (max_request_body_size.isNumber()) {\n                     args.max_request_body_size = @as(u64, @intCast(@max(0, max_request_body_size.toInt64())));\n                 }\n             }\n             if (global.hasException()) return args;\n \n-            if (arg.getOwnTruthyComptime(global, \"error\")) |onError| {\n+            if (arg.getTruthyComptime(global, \"error\")) |onError| {\n                 if (!onError.isCallable(global.vm())) {\n                     JSC.throwInvalidArguments(\"Expected error to be a function\", .{}, global, exception);\n                     return args;\n@@ -4191,7 +4191,7 @@ pub const WebSocketServer = struct {\n \n             var valid = false;\n \n-            if (object.getOwnTruthyComptime(globalObject, \"message\")) |message_| {\n+            if (object.getTruthyComptime(globalObject, \"message\")) |message_| {\n                 if (!message_.isCallable(vm)) {\n                     globalObject.throwInvalidArguments(\"websocket expects a function for the message option\", .{});\n                     return null;\n@@ -4202,7 +4202,7 @@ pub const WebSocketServer = struct {\n                 valid = true;\n             }\n \n-            if (object.getOwnTruthy(globalObject, \"open\")) |open_| {\n+            if (object.getTruthy(globalObject, \"open\")) |open_| {\n                 if (!open_.isCallable(vm)) {\n                     globalObject.throwInvalidArguments(\"websocket expects a function for the open option\", .{});\n                     return null;\n@@ -4213,7 +4213,7 @@ pub const WebSocketServer = struct {\n                 valid = true;\n             }\n \n-            if (object.getOwnTruthy(globalObject, \"close\")) |close_| {\n+            if (object.getTruthy(globalObject, \"close\")) |close_| {\n                 if (!close_.isCallable(vm)) {\n                     globalObject.throwInvalidArguments(\"websocket expects a function for the close option\", .{});\n                     return null;\n@@ -4224,7 +4224,7 @@ pub const WebSocketServer = struct {\n                 valid = true;\n             }\n \n-            if (object.getOwnTruthy(globalObject, \"drain\")) |drain_| {\n+            if (object.getTruthy(globalObject, \"drain\")) |drain_| {\n                 if (!drain_.isCallable(vm)) {\n                     globalObject.throwInvalidArguments(\"websocket expects a function for the drain option\", .{});\n                     return null;\n@@ -4235,7 +4235,7 @@ pub const WebSocketServer = struct {\n                 valid = true;\n             }\n \n-            if (object.getOwnTruthy(globalObject, \"onError\")) |onError_| {\n+            if (object.getTruthy(globalObject, \"onError\")) |onError_| {\n                 if (!onError_.isCallable(vm)) {\n                     globalObject.throwInvalidArguments(\"websocket expects a function for the onError option\", .{});\n                     return null;\n@@ -4245,7 +4245,7 @@ pub const WebSocketServer = struct {\n                 onError.ensureStillAlive();\n             }\n \n-            if (object.getOwnTruthy(globalObject, \"ping\")) |cb| {\n+            if (object.getTruthy(globalObject, \"ping\")) |cb| {\n                 if (!cb.isCallable(vm)) {\n                     globalObject.throwInvalidArguments(\"websocket expects a function for the ping option\", .{});\n                     return null;\n@@ -4255,7 +4255,7 @@ pub const WebSocketServer = struct {\n                 valid = true;\n             }\n \n-            if (object.getOwnTruthy(globalObject, \"pong\")) |cb| {\n+            if (object.getTruthy(globalObject, \"pong\")) |cb| {\n                 if (!cb.isCallable(vm)) {\n                     globalObject.throwInvalidArguments(\"websocket expects a function for the pong option\", .{});\n                     return null;\n@@ -4354,7 +4354,7 @@ pub const WebSocketServer = struct {\n             return null;\n         }\n \n-        if (object.getOwn(globalObject, \"perMessageDeflate\")) |per_message_deflate| {\n+        if (object.get(globalObject, \"perMessageDeflate\")) |per_message_deflate| {\n             getter: {\n                 if (per_message_deflate.isUndefined()) {\n                     break :getter;\n@@ -4369,7 +4369,7 @@ pub const WebSocketServer = struct {\n                     break :getter;\n                 }\n \n-                if (per_message_deflate.getOwnTruthy(globalObject, \"compress\")) |compression| {\n+                if (per_message_deflate.getTruthy(globalObject, \"compress\")) |compression| {\n                     if (compression.isBoolean()) {\n                         server.compression |= if (compression.toBoolean()) uws.SHARED_COMPRESSOR else 0;\n                     } else if (compression.isString()) {\n@@ -4389,7 +4389,7 @@ pub const WebSocketServer = struct {\n                     }\n                 }\n \n-                if (per_message_deflate.getOwnTruthy(globalObject, \"decompress\")) |compression| {\n+                if (per_message_deflate.getTruthy(globalObject, \"decompress\")) |compression| {\n                     if (compression.isBoolean()) {\n                         server.compression |= if (compression.toBoolean()) uws.SHARED_DECOMPRESSOR else 0;\n                     } else if (compression.isString()) {\n@@ -4411,7 +4411,7 @@ pub const WebSocketServer = struct {\n             }\n         }\n \n-        if (object.getOwn(globalObject, \"maxPayloadLength\")) |value| {\n+        if (object.get(globalObject, \"maxPayloadLength\")) |value| {\n             if (!value.isUndefinedOrNull()) {\n                 if (!value.isAnyInt()) {\n                     globalObject.throwInvalidArguments(\"websocket expects maxPayloadLength to be an integer\", .{});\n@@ -4421,7 +4421,7 @@ pub const WebSocketServer = struct {\n             }\n         }\n \n-        if (object.getOwn(globalObject, \"idleTimeout\")) |value| {\n+        if (object.get(globalObject, \"idleTimeout\")) |value| {\n             if (!value.isUndefinedOrNull()) {\n                 if (!value.isAnyInt()) {\n                     globalObject.throwInvalidArguments(\"websocket expects idleTimeout to be an integer\", .{});\n@@ -4441,7 +4441,7 @@ pub const WebSocketServer = struct {\n                 server.idleTimeout = idleTimeout;\n             }\n         }\n-        if (object.getOwn(globalObject, \"backpressureLimit\")) |value| {\n+        if (object.get(globalObject, \"backpressureLimit\")) |value| {\n             if (!value.isUndefinedOrNull()) {\n                 if (!value.isAnyInt()) {\n                     globalObject.throwInvalidArguments(\"websocket expects backpressureLimit to be an integer\", .{});\n@@ -4452,7 +4452,7 @@ pub const WebSocketServer = struct {\n             }\n         }\n \n-        if (object.getOwn(globalObject, \"closeOnBackpressureLimit\")) |value| {\n+        if (object.get(globalObject, \"closeOnBackpressureLimit\")) |value| {\n             if (!value.isUndefinedOrNull()) {\n                 if (!value.isBoolean()) {\n                     globalObject.throwInvalidArguments(\"websocket expects closeOnBackpressureLimit to be a boolean\", .{});\n@@ -4463,7 +4463,7 @@ pub const WebSocketServer = struct {\n             }\n         }\n \n-        if (object.getOwn(globalObject, \"sendPings\")) |value| {\n+        if (object.get(globalObject, \"sendPings\")) |value| {\n             if (!value.isUndefinedOrNull()) {\n                 if (!value.isBoolean()) {\n                     globalObject.throwInvalidArguments(\"websocket expects sendPings to be a boolean\", .{});\n@@ -4474,7 +4474,7 @@ pub const WebSocketServer = struct {\n             }\n         }\n \n-        if (object.getOwn(globalObject, \"publishToSelf\")) |value| {\n+        if (object.get(globalObject, \"publishToSelf\")) |value| {\n             if (!value.isUndefinedOrNull()) {\n                 if (!value.isBoolean()) {\n                     globalObject.throwInvalidArguments(\"websocket expects publishToSelf to be a boolean\", .{});"
            },
            {
                "sha": "119b3925cc740169acd9199a2f266286e0597927",
                "filename": "src/bun.js/base.zig",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fbase.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fbase.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fbase.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -1103,7 +1103,7 @@ pub fn wrapInstanceMethod(\n                     },\n                     ?JSC.Cloudflare.ContentOptions => {\n                         if (iter.nextEat()) |content_arg| {\n-                            if (content_arg.getOwn(globalThis.ptr(), \"html\")) |html_val| {\n+                            if (content_arg.get(globalThis.ptr(), \"html\")) |html_val| {\n                                 args[i] = .{ .html = html_val.toBoolean() };\n                             }\n                         } else {\n@@ -1267,7 +1267,7 @@ pub fn wrapStaticMethod(\n                     },\n                     ?JSC.Cloudflare.ContentOptions => {\n                         if (iter.nextEat()) |content_arg| {\n-                            if (content_arg.getOwn(globalThis.ptr(), \"html\")) |html_val| {\n+                            if (content_arg.get(globalThis.ptr(), \"html\")) |html_val| {\n                                 args[i] = .{ .html = html_val.toBoolean() };\n                             }\n                         } else {"
            },
            {
                "sha": "d3ecb8e78ac947bcd074651eb86ad0bc85fa54ec",
                "filename": "src/bun.js/bindings/ObjectBindings.cpp",
                "status": "added",
                "additions": 76,
                "deletions": 0,
                "changes": 76,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fbindings%2FObjectBindings.cpp",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fbindings%2FObjectBindings.cpp",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fbindings%2FObjectBindings.cpp?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -0,0 +1,76 @@\n+#include \"root.h\"\n+#include <JavaScriptCore/JSObject.h>\n+#include <JavaScriptCore/JSObjectInlines.h>\n+#include <JavaScriptCore/PropertySlot.h>\n+#include <JavaScriptCore/JSGlobalObject.h>\n+\n+namespace Bun {\n+\n+using namespace JSC;\n+\n+static bool getNonIndexPropertySlotPrototypePollutionMitigation(JSC::VM& vm, JSObject* object, JSGlobalObject* globalObject, PropertyName propertyName, PropertySlot& slot)\n+{\n+    // This method only supports non-index PropertyNames.\n+    ASSERT(!parseIndex(propertyName));\n+\n+    auto scope = DECLARE_THROW_SCOPE(vm);\n+    JSObject* objectPrototype = nullptr;\n+    while (true) {\n+        Structure* structure = object->structureID().decode();\n+        if (LIKELY(!TypeInfo::overridesGetOwnPropertySlot(object->inlineTypeFlags()))) {\n+            if (object->getOwnNonIndexPropertySlot(vm, structure, propertyName, slot))\n+                return true;\n+        } else {\n+            bool hasSlot = structure->classInfoForCells()->methodTable.getOwnPropertySlot(object, globalObject, propertyName, slot);\n+            RETURN_IF_EXCEPTION(scope, false);\n+            if (hasSlot)\n+                return true;\n+            if (UNLIKELY(slot.isVMInquiry() && slot.isTaintedByOpaqueObject()))\n+                return false;\n+            if (object->type() == ProxyObjectType && slot.internalMethodType() == PropertySlot::InternalMethodType::HasProperty)\n+                return false;\n+        }\n+        JSValue prototype;\n+        if (LIKELY(!structure->typeInfo().overridesGetPrototype() || slot.internalMethodType() == PropertySlot::InternalMethodType::VMInquiry))\n+            prototype = object->getPrototypeDirect();\n+        else {\n+            prototype = object->getPrototype(vm, globalObject);\n+            RETURN_IF_EXCEPTION(scope, false);\n+        }\n+        if (!prototype.isObject())\n+            return false;\n+        object = asObject(prototype);\n+        // -- If we reach the object prototype, we stop.\n+        if (objectPrototype == nullptr) {\n+            objectPrototype = globalObject->objectPrototype();\n+        }\n+        if (object == objectPrototype) {\n+            return false;\n+        }\n+    }\n+\n+    return false;\n+}\n+\n+JSC::JSValue getIfPropertyExistsPrototypePollutionMitigation(JSC::VM& vm, JSC::JSGlobalObject* globalObject, JSC::JSObject* object, const JSC::PropertyName& name)\n+{\n+    auto scope = DECLARE_THROW_SCOPE(vm);\n+    auto propertySlot = PropertySlot(object, PropertySlot::InternalMethodType::HasProperty);\n+    auto isDefined = getNonIndexPropertySlotPrototypePollutionMitigation(vm, object, globalObject, name, propertySlot);\n+\n+    if (!isDefined) {\n+        return {};\n+    }\n+\n+    scope.assertNoException();\n+    JSValue value = propertySlot.getValue(globalObject, name);\n+    RETURN_IF_EXCEPTION(scope, {});\n+    return value;\n+}\n+\n+JSC::JSValue getIfPropertyExistsPrototypePollutionMitigation(JSC::JSGlobalObject* globalObject, JSC::JSObject* object, const JSC::PropertyName& name)\n+{\n+    return getIfPropertyExistsPrototypePollutionMitigation(JSC::getVM(globalObject), globalObject, object, name);\n+}\n+\n+}"
            },
            {
                "sha": "8c32283cbb40471f666303f231f23c93a2c693f5",
                "filename": "src/bun.js/bindings/ObjectBindings.h",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fbindings%2FObjectBindings.h",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fbindings%2FObjectBindings.h",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fbindings%2FObjectBindings.h?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -0,0 +1,16 @@\n+#pragma once\n+\n+namespace Bun {\n+\n+JSC::JSValue getIfPropertyExistsPrototypePollutionMitigation(JSC::JSGlobalObject* globalObject, JSC::JSObject* object, const JSC::PropertyName& name);\n+\n+/**\n+ * This is `JSObject::getIfPropertyExists`, except it stops when it reaches globalObject->objectPrototype().\n+ *\n+ * This means that for a prototype pollution attack to work, they would need to modify the specific prototype instead of the generic one shared by most objects.\n+ *\n+ * This method also does not support index properties.\n+ */\n+JSC::JSValue getIfPropertyExistsPrototypePollutionMitigation(JSC::VM& vm, JSC::JSGlobalObject* globalObject, JSC::JSObject* object, const JSC::PropertyName& name);\n+\n+}"
            },
            {
                "sha": "8409ffa856dd6d402ca1990677803f7cfc008447",
                "filename": "src/bun.js/bindings/bindings.cpp",
                "status": "modified",
                "additions": 6,
                "deletions": 4,
                "changes": 10,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fbindings%2Fbindings.cpp",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fbindings%2Fbindings.cpp",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fbindings%2Fbindings.cpp?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -123,6 +123,7 @@\n #include \"JavaScriptCore/CustomGetterSetter.h\"\n \n #include \"ErrorStackFrame.h\"\n+#include \"ObjectBindings.h\"\n \n #if OS(DARWIN)\n #if BUN_DEBUG\n@@ -3708,23 +3709,24 @@ JSC__JSValue JSC__JSValue__getIfPropertyExistsImpl(JSC__JSValue JSValue0,\n     const auto identifier = JSC::Identifier::fromString(vm, propertyString);\n     const auto property = JSC::PropertyName(identifier);\n \n-    return JSC::JSValue::encode(object->getIfPropertyExists(globalObject, property));\n+    return JSC::JSValue::encode(Bun::getIfPropertyExistsPrototypePollutionMitigation(vm, globalObject, object, property));\n }\n \n extern \"C\" JSC__JSValue JSC__JSValue__getIfPropertyExistsImplString(JSC__JSValue JSValue0, JSC__JSGlobalObject* globalObject, BunString* propertyName)\n {\n     ASSERT_NO_PENDING_EXCEPTION(globalObject);\n     JSValue value = JSC::JSValue::decode(JSValue0);\n-    if (UNLIKELY(!value.isObject()))\n+    JSC::JSObject* object = value.getObject();\n+    if (UNLIKELY(!object))\n         return JSValue::encode({});\n \n     JSC::VM& vm = globalObject->vm();\n-    JSC::JSObject* object = value.getObject();\n+\n     WTF::String propertyNameString = propertyName->tag == BunStringTag::Empty ? WTF::String(\"\"_s) : propertyName->toWTFString(BunString::ZeroCopy);\n     auto identifier = JSC::Identifier::fromString(vm, propertyNameString);\n     auto property = JSC::PropertyName(identifier);\n \n-    return JSC::JSValue::encode(object->getIfPropertyExists(globalObject, property));\n+    return JSC::JSValue::encode(Bun::getIfPropertyExistsPrototypePollutionMitigation(vm, globalObject, object, property));\n }\n \n extern \"C\" JSC__JSValue JSC__JSValue__getOwn(JSC__JSValue JSValue0, JSC__JSGlobalObject* globalObject, BunString* propertyName)"
            },
            {
                "sha": "6750ff5ad50eacaa6989ef7ec4c60f33ddb9e638",
                "filename": "src/bun.js/modules/NodeModuleModule.h",
                "status": "modified",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fmodules%2FNodeModuleModule.h",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fmodules%2FNodeModuleModule.h",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fmodules%2FNodeModuleModule.h?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -22,11 +22,6 @@ namespace Bun {\n   void addNodeModuleConstructorProperties(JSC::VM &vm, Zig::GlobalObject *globalObject);\n }\n \n-\n-\n-\n-\n-\n namespace Zig {\n \n void generateNativeModule_NodeModule(                                     "
            },
            {
                "sha": "6f58d591eb7621bf409a46d1c4baa7997068d9d0",
                "filename": "src/bun.js/webcore.zig",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fwebcore.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fwebcore.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fwebcore.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -403,7 +403,7 @@ pub const Crypto = struct {\n                 return .zero;\n             }\n \n-            if (options_value.getOwnTruthy(globalThis, \"cost\") orelse options_value.getOwnTruthy(globalThis, \"N\")) |N_value| {\n+            if (options_value.getTruthy(globalThis, \"cost\") orelse options_value.getTruthy(globalThis, \"N\")) |N_value| {\n                 if (cost != null) return throwInvalidParameter(globalThis);\n                 const N_int = N_value.to(i64);\n                 if (N_int < 0 or !N_value.isNumber()) {\n@@ -418,7 +418,7 @@ pub const Crypto = struct {\n                 }\n             }\n \n-            if (options_value.getOwnTruthy(globalThis, \"blockSize\") orelse options_value.getOwn(globalThis, \"r\")) |r_value| {\n+            if (options_value.getTruthy(globalThis, \"blockSize\") orelse options_value.getTruthy(globalThis, \"r\")) |r_value| {\n                 if (blockSize != null) return throwInvalidParameter(globalThis);\n                 const r_int = r_value.to(i64);\n                 if (r_int < 0 or !r_value.isNumber()) {\n@@ -433,7 +433,7 @@ pub const Crypto = struct {\n                 }\n             }\n \n-            if (options_value.getOwnTruthy(globalThis, \"parallelization\") orelse options_value.getOwn(globalThis, \"p\")) |p_value| {\n+            if (options_value.getTruthy(globalThis, \"parallelization\") orelse options_value.getTruthy(globalThis, \"p\")) |p_value| {\n                 if (parallelization != null) return throwInvalidParameter(globalThis);\n                 const p_int = p_value.to(i64);\n                 if (p_int < 0 or !p_value.isNumber()) {\n@@ -448,7 +448,7 @@ pub const Crypto = struct {\n                 }\n             }\n \n-            if (options_value.getOwnTruthy(globalThis, \"maxmem\")) |value| {\n+            if (options_value.getTruthy(globalThis, \"maxmem\")) |value| {\n                 const p_int = value.to(i64);\n                 if (p_int < 0 or !value.isNumber()) {\n                     return throwInvalidParams("
            },
            {
                "sha": "a66967e74cdd476d187b39dd688e194b40e97116",
                "filename": "src/bun.js/webcore/blob.zig",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fwebcore%2Fblob.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fwebcore%2Fblob.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fwebcore%2Fblob.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -1018,7 +1018,7 @@ pub const Blob = struct {\n \n         if (args.nextEat()) |options_object| {\n             if (options_object.isObject()) {\n-                if (options_object.getOwnTruthy(globalThis, \"createPath\")) |create_directory| {\n+                if (options_object.getTruthy(globalThis, \"createPath\")) |create_directory| {\n                     if (!create_directory.isBoolean()) {\n                         globalThis.throwInvalidArgumentType(\"write\", \"options.createPath\", \"boolean\");\n                         return .zero;"
            },
            {
                "sha": "9c2f589f3771f94a86142da37c7c89e5114a9017",
                "filename": "src/bun.js/webcore/streams.zig",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fwebcore%2Fstreams.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbun.js%2Fwebcore%2Fstreams.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbun.js%2Fwebcore%2Fstreams.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -533,7 +533,7 @@ pub const StreamStart = union(Tag) {\n             return .{ .empty = {} };\n         }\n \n-        if (value.getOwn(globalThis, \"chunkSize\")) |chunkSize| {\n+        if (value.get(globalThis, \"chunkSize\")) |chunkSize| {\n             if (chunkSize.isNumber())\n                 return .{ .chunk_size = @as(Blob.SizeType, @intCast(@as(i52, @truncate(chunkSize.toInt64())))) };\n         }"
            },
            {
                "sha": "4c66c6e0e2f17d23cf943e58a2e05887f3e607b8",
                "filename": "src/bundler.zig",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbundler.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fbundler.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fbundler.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -166,7 +166,7 @@ pub const PluginRunner = struct {\n             bun.String.init(importer),\n             target,\n         ) orelse return null;\n-        const path_value = on_resolve_plugin.getOwn(global, \"path\") orelse return null;\n+        const path_value = on_resolve_plugin.get(global, \"path\") orelse return null;\n         if (path_value.isEmptyOrUndefinedOrNull()) return null;\n         if (!path_value.isString()) {\n             log.addError(null, loc, \"Expected \\\"path\\\" to be a string\") catch unreachable;\n@@ -199,7 +199,7 @@ pub const PluginRunner = struct {\n         }\n         var static_namespace = true;\n         const user_namespace: bun.String = brk: {\n-            if (on_resolve_plugin.getOwn(global, \"namespace\")) |namespace_value| {\n+            if (on_resolve_plugin.get(global, \"namespace\")) |namespace_value| {\n                 if (!namespace_value.isString()) {\n                     log.addError(null, loc, \"Expected \\\"namespace\\\" to be a string\") catch unreachable;\n                     return null;\n@@ -265,7 +265,7 @@ pub const PluginRunner = struct {\n             importer,\n             target,\n         ) orelse return null;\n-        const path_value = on_resolve_plugin.getOwn(global, \"path\") orelse return null;\n+        const path_value = on_resolve_plugin.get(global, \"path\") orelse return null;\n         if (path_value.isEmptyOrUndefinedOrNull()) return null;\n         if (!path_value.isString()) {\n             return JSC.ErrorableString.err(\n@@ -295,7 +295,7 @@ pub const PluginRunner = struct {\n         }\n         var static_namespace = true;\n         const user_namespace: bun.String = brk: {\n-            if (on_resolve_plugin.getOwn(global, \"namespace\")) |namespace_value| {\n+            if (on_resolve_plugin.get(global, \"namespace\")) |namespace_value| {\n                 if (!namespace_value.isString()) {\n                     return JSC.ErrorableString.err(\n                         error.JSErrorObject,"
            },
            {
                "sha": "95d195a28376849c0e3cbdf5bf7d751c1ed8e60e",
                "filename": "src/css/values/color_js.zig",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fcss%2Fvalues%2Fcolor_js.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fcss%2Fvalues%2Fcolor_js.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fcss%2Fvalues%2Fcolor_js.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -230,17 +230,17 @@ pub fn jsFunctionColor(globalThis: *JSC.JSGlobalObject, callFrame: *JSC.CallFram\n                 },\n             }\n         } else if (args[0].isObject()) {\n-            const r = colorIntFromJS(globalThis, args[0].getOwn(globalThis, \"r\") orelse .zero, \"r\") orelse return .zero;\n+            const r = colorIntFromJS(globalThis, args[0].get(globalThis, \"r\") orelse .zero, \"r\") orelse return .zero;\n \n             if (globalThis.hasException()) {\n                 return .zero;\n             }\n-            const g = colorIntFromJS(globalThis, args[0].getOwn(globalThis, \"g\") orelse .zero, \"g\") orelse return .zero;\n+            const g = colorIntFromJS(globalThis, args[0].get(globalThis, \"g\") orelse .zero, \"g\") orelse return .zero;\n \n             if (globalThis.hasException()) {\n                 return .zero;\n             }\n-            const b = colorIntFromJS(globalThis, args[0].getOwn(globalThis, \"b\") orelse .zero, \"b\") orelse return .zero;\n+            const b = colorIntFromJS(globalThis, args[0].get(globalThis, \"b\") orelse .zero, \"b\") orelse return .zero;\n \n             if (globalThis.hasException()) {\n                 return .zero;"
            },
            {
                "sha": "a72765b4b3d68fc759a2b1de0b0829d9aa604d44",
                "filename": "src/dns.zig",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/oven-sh/bun/blob/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fdns.zig",
                "raw_url": "https://github.com/oven-sh/bun/raw/a234e067a5dc7837602df3fb5489e826920cc65a/src%2Fdns.zig",
                "contents_url": "https://api.github.com/repos/oven-sh/bun/contents/src%2Fdns.zig?ref=a234e067a5dc7837602df3fb5489e826920cc65a",
                "patch": "@@ -74,23 +74,23 @@ pub const GetAddrInfo = struct {\n             if (value.isObject()) {\n                 var options = Options{};\n \n-                if (value.getOwn(globalObject, \"family\")) |family| {\n+                if (value.get(globalObject, \"family\")) |family| {\n                     options.family = try Family.fromJS(family, globalObject);\n                 }\n \n-                if (value.getOwn(globalObject, \"socketType\") orelse value.getOwn(globalObject, \"socktype\")) |socktype| {\n+                if (value.get(globalObject, \"socketType\") orelse value.get(globalObject, \"socktype\")) |socktype| {\n                     options.socktype = try SocketType.fromJS(socktype, globalObject);\n                 }\n \n-                if (value.getOwn(globalObject, \"protocol\")) |protocol| {\n+                if (value.get(globalObject, \"protocol\")) |protocol| {\n                     options.protocol = try Protocol.fromJS(protocol, globalObject);\n                 }\n \n-                if (value.getOwn(globalObject, \"backend\")) |backend| {\n+                if (value.get(globalObject, \"backend\")) |backend| {\n                     options.backend = try Backend.fromJS(backend, globalObject);\n                 }\n \n-                if (value.getOwn(globalObject, \"flags\")) |flags| {\n+                if (value.get(globalObject, \"flags\")) |flags| {\n                     if (!flags.isNumber())\n                         return error.InvalidFlags;\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/UniSharp/laravel-filemanager/commits/8170760c0ae316d77b9363cd4c76ab68d3f63f0b",
        "url": "https://api.github.com/repos/UniSharp/laravel-filemanager/commits/8170760c0ae316d77b9363cd4c76ab68d3f63f0b",
        "html_url": "https://github.com/UniSharp/laravel-filemanager/commit/8170760c0ae316d77b9363cd4c76ab68d3f63f0b",
        "message": "fix(security): file extension should not contain special characters",
        "files": [
            {
                "sha": "4f9ac26feb810c477273753e5f19deb93bcdc406",
                "filename": "src/Exceptions/InvalidExtensionException.php",
                "status": "added",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/UniSharp/laravel-filemanager/blob/8170760c0ae316d77b9363cd4c76ab68d3f63f0b/src%2FExceptions%2FInvalidExtensionException.php",
                "raw_url": "https://github.com/UniSharp/laravel-filemanager/raw/8170760c0ae316d77b9363cd4c76ab68d3f63f0b/src%2FExceptions%2FInvalidExtensionException.php",
                "contents_url": "https://api.github.com/repos/UniSharp/laravel-filemanager/contents/src%2FExceptions%2FInvalidExtensionException.php?ref=8170760c0ae316d77b9363cd4c76ab68d3f63f0b",
                "patch": "@@ -0,0 +1,11 @@\n+<?php\n+\n+namespace UniSharp\\LaravelFilemanager\\Exceptions;\n+\n+class InvalidExtensionException extends \\Exception\n+{\n+    public function __construct()\n+    {\n+        $this->message = 'File extension is not valid.';\n+    }\n+}"
            },
            {
                "sha": "770554147313d1ebb4328ad3609c6c4c8cea48f6",
                "filename": "src/LfmUploadValidator.php",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/UniSharp/laravel-filemanager/blob/8170760c0ae316d77b9363cd4c76ab68d3f63f0b/src%2FLfmUploadValidator.php",
                "raw_url": "https://github.com/UniSharp/laravel-filemanager/raw/8170760c0ae316d77b9363cd4c76ab68d3f63f0b/src%2FLfmUploadValidator.php",
                "contents_url": "https://api.github.com/repos/UniSharp/laravel-filemanager/contents/src%2FLfmUploadValidator.php?ref=8170760c0ae316d77b9363cd4c76ab68d3f63f0b",
                "patch": "@@ -9,6 +9,7 @@\n use UniSharp\\LaravelFilemanager\\Exceptions\\FileFailedToUploadException;\n use UniSharp\\LaravelFilemanager\\Exceptions\\FileSizeExceedConfigurationMaximumException;\n use UniSharp\\LaravelFilemanager\\Exceptions\\FileSizeExceedIniMaximumException;\n+use UniSharp\\LaravelFilemanager\\Exceptions\\InvalidExtensionException;\n use UniSharp\\LaravelFilemanager\\Exceptions\\InvalidMimeTypeException;\n use UniSharp\\LaravelFilemanager\\LfmPath;\n \n@@ -94,6 +95,17 @@ public function mimeTypeIsValid($available_mime_types)\n         return $this;\n     }\n \n+    public function extensionIsValid()\n+    {\n+        $extension = strtolower($this->file->getClientOriginalExtension());\n+\n+        if (preg_match('/[^a-zA-Z0-9]/', $extension) > 0) {\n+            throw new InvalidExtensionException();\n+        }\n+\n+        return $this;\n+    }\n+\n     public function sizeIsLowerThanConfiguredMaximum($max_size_in_kb)\n     {\n         // size to kb unit is needed"
            },
            {
                "sha": "959400105fad145ca75f3d4ce414a5d4263aa09c",
                "filename": "tests/LfmUploadValidatorTest.php",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/UniSharp/laravel-filemanager/blob/8170760c0ae316d77b9363cd4c76ab68d3f63f0b/tests%2FLfmUploadValidatorTest.php",
                "raw_url": "https://github.com/UniSharp/laravel-filemanager/raw/8170760c0ae316d77b9363cd4c76ab68d3f63f0b/tests%2FLfmUploadValidatorTest.php",
                "contents_url": "https://api.github.com/repos/UniSharp/laravel-filemanager/contents/tests%2FLfmUploadValidatorTest.php?ref=8170760c0ae316d77b9363cd4c76ab68d3f63f0b",
                "patch": "@@ -9,6 +9,7 @@\n use UniSharp\\LaravelFilemanager\\Exceptions\\FileFailedToUploadException;\n use UniSharp\\LaravelFilemanager\\Exceptions\\FileSizeExceedConfigurationMaximumException;\n use UniSharp\\LaravelFilemanager\\Exceptions\\FileSizeExceedIniMaximumException;\n+use UniSharp\\LaravelFilemanager\\Exceptions\\InvalidExtensionException;\n use UniSharp\\LaravelFilemanager\\Exceptions\\InvalidMimeTypeException;\n use UniSharp\\LaravelFilemanager\\LfmPath;\n use UniSharp\\LaravelFilemanager\\LfmUploadValidator;\n@@ -167,6 +168,18 @@ public function testFailsExtensionIsNotExcutableWithExtensionNotLowerCase()\n         $validator->extensionIsNotExcutable(['php', 'html']);\n     }\n \n+    public function testFailsExtensionIsValidWithSpecialCharacters()\n+    {\n+        $uploaded_file = m::mock(UploadedFile::class);\n+        $uploaded_file->shouldReceive('getClientOriginalExtension')->andReturn('html@');\n+\n+        $validator = new LfmUploadValidator($uploaded_file);\n+\n+        $this->expectException(InvalidExtensionException::class);\n+\n+        $validator->extensionIsValid();\n+    }\n+\n     public function testPassesSizeIsLowerThanConfiguredMaximum()\n     {\n         $uploaded_file = m::mock(UploadedFile::class);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/project-chip/connectedhomeip/commits/27ca6ec255b78168e04bd71e0f1a473869cf144b",
        "url": "https://api.github.com/repos/project-chip/connectedhomeip/commits/27ca6ec255b78168e04bd71e0f1a473869cf144b",
        "html_url": "https://github.com/project-chip/connectedhomeip/commit/27ca6ec255b78168e04bd71e0f1a473869cf144b",
        "message": "Fix Null Pointer Dereference in TCP Packet Handling (#36751)\n\n* Fix Null Pointer Dereference in TCP Packet Handling\n\n* Fix handle zero messageSize in TCP packet processing\n\n* Add test for TCP MessageSize\n\n* Modify test\n\n* Restyled by clang-format\n\n* Modify the position of an if statement\n\n* Modify test\n\n---------\n\nCo-authored-by: BoB13-Matter <--global>\nCo-authored-by: Restyled.io <commits@restyled.io>",
        "files": [
            {
                "sha": "f12ee7892ad2d04dc38c8dcfd851132070fdc6d9",
                "filename": "src/transport/raw/TCP.cpp",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/project-chip/connectedhomeip/blob/27ca6ec255b78168e04bd71e0f1a473869cf144b/src%2Ftransport%2Fraw%2FTCP.cpp",
                "raw_url": "https://github.com/project-chip/connectedhomeip/raw/27ca6ec255b78168e04bd71e0f1a473869cf144b/src%2Ftransport%2Fraw%2FTCP.cpp",
                "contents_url": "https://api.github.com/repos/project-chip/connectedhomeip/contents/src%2Ftransport%2Fraw%2FTCP.cpp?ref=27ca6ec255b78168e04bd71e0f1a473869cf144b",
                "patch": "@@ -343,7 +343,15 @@ CHIP_ERROR TCPBase::ProcessReceivedBuffer(Inet::TCPEndPoint * endPoint, const Pe\n             // We have not yet received the complete message.\n             return CHIP_NO_ERROR;\n         }\n+\n         state->mReceived.Consume(kPacketSizeBytes);\n+\n+        if (messageSize == 0)\n+        {\n+            // No payload but considered a valid message. Return success to keep the connection alive.\n+            return CHIP_NO_ERROR;\n+        }\n+\n         ReturnErrorOnFailure(ProcessSingleMessage(peerAddress, state, messageSize));\n     }\n "
            },
            {
                "sha": "80d56707481c45834ddc29cb8218d699b78c77b4",
                "filename": "src/transport/raw/tests/TestTCP.cpp",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/project-chip/connectedhomeip/blob/27ca6ec255b78168e04bd71e0f1a473869cf144b/src%2Ftransport%2Fraw%2Ftests%2FTestTCP.cpp",
                "raw_url": "https://github.com/project-chip/connectedhomeip/raw/27ca6ec255b78168e04bd71e0f1a473869cf144b/src%2Ftransport%2Fraw%2Ftests%2FTestTCP.cpp",
                "contents_url": "https://api.github.com/repos/project-chip/connectedhomeip/contents/src%2Ftransport%2Fraw%2Ftests%2FTestTCP.cpp?ref=27ca6ec255b78168e04bd71e0f1a473869cf144b",
                "patch": "@@ -64,7 +64,8 @@ constexpr NodeId kSourceNodeId      = 123654;\n constexpr NodeId kDestinationNodeId = 111222333;\n constexpr uint32_t kMessageCounter  = 18;\n \n-const char PAYLOAD[] = \"Hello!\";\n+const char PAYLOAD[]          = \"Hello!\";\n+const char messageSize_TEST[] = \"\\x00\\x00\\x00\\x00\";\n \n class MockTransportMgrDelegate : public chip::TransportMgrDelegate\n {\n@@ -633,6 +634,12 @@ TEST_F(TestTCP, CheckProcessReceivedBuffer)\n     TestData testData[2];\n     gMockTransportMgrDelegate.SetCallback(TestDataCallbackCheck, testData);\n \n+    // Test a single packet buffer with zero message size.\n+    System::PacketBufferHandle buf = System::PacketBufferHandle::NewWithData(messageSize_TEST, 4);\n+    ASSERT_NE(&buf, nullptr);\n+    err = TestAccess::ProcessReceivedBuffer(tcp, lEndPoint, lPeerAddress, std::move(buf));\n+    EXPECT_EQ(err, CHIP_NO_ERROR);\n+\n     // Test a single packet buffer.\n     gMockTransportMgrDelegate.mReceiveHandlerCallCount = 0;\n     EXPECT_TRUE(testData[0].Init((const uint32_t[]){ 111, 0 }));"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/project-chip/connectedhomeip/commits/e3277eb02ed8115de5887e8beca0e35007ba71f3",
        "url": "https://api.github.com/repos/project-chip/connectedhomeip/commits/e3277eb02ed8115de5887e8beca0e35007ba71f3",
        "html_url": "https://github.com/project-chip/connectedhomeip/commit/e3277eb02ed8115de5887e8beca0e35007ba71f3",
        "message": "Enforce a maximum entry limit during append operations (#36843)\n\n* Enforce a maximum entry limit during append operations\r\n\r\n* Add test for this change",
        "files": [
            {
                "sha": "0030f6280976967f67e4b337522d6e913eaca23f",
                "filename": "src/app/clusters/user-label-server/user-label-server.cpp",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/project-chip/connectedhomeip/blob/e3277eb02ed8115de5887e8beca0e35007ba71f3/src%2Fapp%2Fclusters%2Fuser-label-server%2Fuser-label-server.cpp",
                "raw_url": "https://github.com/project-chip/connectedhomeip/raw/e3277eb02ed8115de5887e8beca0e35007ba71f3/src%2Fapp%2Fclusters%2Fuser-label-server%2Fuser-label-server.cpp",
                "contents_url": "https://api.github.com/repos/project-chip/connectedhomeip/contents/src%2Fapp%2Fclusters%2Fuser-label-server%2Fuser-label-server.cpp?ref=e3277eb02ed8115de5887e8beca0e35007ba71f3",
                "patch": "@@ -143,6 +143,7 @@ CHIP_ERROR UserLabelAttrAccess::WriteLabelList(const ConcreteDataAttributePath &\n \n         return provider->SetUserLabelList(endpoint, labelList);\n     }\n+\n     if (aPath.mListOp == ConcreteDataAttributePath::ListOperation::AppendItem)\n     {\n         Structs::LabelStruct::DecodableType entry;"
            },
            {
                "sha": "935fe88c2b662c196e9f72569a8656e5bc4f3e44",
                "filename": "src/app/tests/suites/TestUserLabelClusterConstraints.yaml",
                "status": "modified",
                "additions": 32,
                "deletions": 0,
                "changes": 32,
                "blob_url": "https://github.com/project-chip/connectedhomeip/blob/e3277eb02ed8115de5887e8beca0e35007ba71f3/src%2Fapp%2Ftests%2Fsuites%2FTestUserLabelClusterConstraints.yaml",
                "raw_url": "https://github.com/project-chip/connectedhomeip/raw/e3277eb02ed8115de5887e8beca0e35007ba71f3/src%2Fapp%2Ftests%2Fsuites%2FTestUserLabelClusterConstraints.yaml",
                "contents_url": "https://api.github.com/repos/project-chip/connectedhomeip/contents/src%2Fapp%2Ftests%2Fsuites%2FTestUserLabelClusterConstraints.yaml?ref=e3277eb02ed8115de5887e8beca0e35007ba71f3",
                "patch": "@@ -55,3 +55,35 @@ tests:\n               ]\n       response:\n           error: CONSTRAINT_ERROR\n+\n+    - label: \"Attempt to write a large label list\"\n+      command: \"writeAttribute\"\n+      attribute: \"LabelList\"\n+      arguments:\n+          value: [\n+                  # Example repeated user labels to blow up the maximum allowed\n+                  { Label: \"roomName\", Value: \"master bedroom 1\" },\n+                  { Label: \"orientation\", Value: \"east\" },\n+                  { Label: \"floor\", Value: \"2\" },\n+                  { Label: \"roomType\", Value: \"bedroom\" },\n+                  { Label: \"someKey5\", Value: \"someVal5\" },\n+                  { Label: \"someKey6\", Value: \"someVal6\" },\n+                  { Label: \"someKey7\", Value: \"someVal7\" },\n+                  { Label: \"someKey8\", Value: \"someVal8\" },\n+                  { Label: \"someKey9\", Value: \"someVal9\" },\n+                  { Label: \"someKey10\", Value: \"someVal10\" },\n+                  { Label: \"someKey11\", Value: \"someVal11\" },\n+                  { Label: \"someKey12\", Value: \"someVal12\" },\n+                  { Label: \"someKey13\", Value: \"someVal13\" },\n+                  { Label: \"someKey14\", Value: \"someVal14\" },\n+                  { Label: \"someKey15\", Value: \"someVal15\" },\n+                  { Label: \"someKey16\", Value: \"someVal16\" },\n+                  { Label: \"someKey17\", Value: \"someVal17\" },\n+                  { Label: \"someKey18\", Value: \"someVal18\" },\n+                  { Label: \"someKey19\", Value: \"someVal19\" },\n+                  { Label: \"someKey20\", Value: \"someVal20\" },\n+              ]\n+      response:\n+          # When the cluster runs out of capacity to store these entries,\n+          # we expect a FAILURE get returned.\n+          error: FAILURE"
            },
            {
                "sha": "28191cd4f82352d7ae2158c1cd169d1b09b0fa82",
                "filename": "src/platform/DeviceInfoProvider.cpp",
                "status": "modified",
                "additions": 8,
                "deletions": 3,
                "changes": 11,
                "blob_url": "https://github.com/project-chip/connectedhomeip/blob/e3277eb02ed8115de5887e8beca0e35007ba71f3/src%2Fplatform%2FDeviceInfoProvider.cpp",
                "raw_url": "https://github.com/project-chip/connectedhomeip/raw/e3277eb02ed8115de5887e8beca0e35007ba71f3/src%2Fplatform%2FDeviceInfoProvider.cpp",
                "contents_url": "https://api.github.com/repos/project-chip/connectedhomeip/contents/src%2Fplatform%2FDeviceInfoProvider.cpp?ref=e3277eb02ed8115de5887e8beca0e35007ba71f3",
                "patch": "@@ -82,11 +82,16 @@ CHIP_ERROR DeviceInfoProvider::AppendUserLabel(EndpointId endpoint, const UserLa\n {\n     size_t length;\n \n-    // Increase the size of UserLabelList by 1\n+    // Fetch current list length\n     ReturnErrorOnFailure(GetUserLabelLength(endpoint, length));\n-    ReturnErrorOnFailure(SetUserLabelLength(endpoint, length + 1));\n \n-    // Append the user label at the end of UserLabelList\n+    if (length >= kMaxUserLabelListLength)\n+    {\n+        return CHIP_ERROR_NO_MEMORY;\n+    }\n+\n+    // Add the new entry to the list\n+    ReturnErrorOnFailure(SetUserLabelLength(endpoint, length + 1));\n     ReturnErrorOnFailure(SetUserLabelAt(endpoint, length, label));\n \n     return CHIP_NO_ERROR;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/071032a108bd9e9fce9e66d00c36d56bd4b334df",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/071032a108bd9e9fce9e66d00c36d56bd4b334df",
        "html_url": "https://github.com/keycloak/keycloak/commit/071032a108bd9e9fce9e66d00c36d56bd4b334df",
        "message": "Fixing the condition for embedded cache MTLS encryption\n\nCloses #28750\n\nSigned-off-by: Alexander Schwartz <aschwart@redhat.com>",
        "files": [
            {
                "sha": "2f631243506c0397a25b2a440529e30ba5b33c89",
                "filename": "quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/storage/legacy/infinispan/CacheManagerFactory.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/071032a108bd9e9fce9e66d00c36d56bd4b334df/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fstorage%2Flegacy%2Finfinispan%2FCacheManagerFactory.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/071032a108bd9e9fce9e66d00c36d56bd4b334df/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fstorage%2Flegacy%2Finfinispan%2FCacheManagerFactory.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fstorage%2Flegacy%2Finfinispan%2FCacheManagerFactory.java?ref=071032a108bd9e9fce9e66d00c36d56bd4b334df",
                "patch": "@@ -179,7 +179,7 @@ private void configureTransportStack(ConfigurationBuilderHolder builder) {\n             transportConfig.defaultTransport().stack(transportStack);\n         }\n \n-        if (Configuration.isTrue(CachingOptions.CACHE_REMOTE_TLS_ENABLED)) {\n+        if (Configuration.isTrue(CachingOptions.CACHE_EMBEDDED_MTLS_ENABLED_PROPERTY)) {\n             validateTlsAvailable(transportConfig.build());\n             var tls = new TLS()\n                     .enabled(true)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/36defd5f33b2da5d705f179bbaa21c28b13a9996",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/36defd5f33b2da5d705f179bbaa21c28b13a9996",
        "html_url": "https://github.com/keycloak/keycloak/commit/36defd5f33b2da5d705f179bbaa21c28b13a9996",
        "message": "cache-embedded-mtls-enabled is ignored\n\nFixes #34644\n\nSigned-off-by: Pedro Ruivo <pruivo@redhat.com>",
        "files": [
            {
                "sha": "0286ca6914d005959e024839b2d11762ba7ecc89",
                "filename": "quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/storage/infinispan/CacheManagerFactory.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/36defd5f33b2da5d705f179bbaa21c28b13a9996/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fstorage%2Finfinispan%2FCacheManagerFactory.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/36defd5f33b2da5d705f179bbaa21c28b13a9996/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fstorage%2Finfinispan%2FCacheManagerFactory.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fstorage%2Finfinispan%2FCacheManagerFactory.java?ref=36defd5f33b2da5d705f179bbaa21c28b13a9996",
                "patch": "@@ -401,7 +401,7 @@ private static int getStartTimeout() {\n \n     private static void configureTransportStack(ConfigurationBuilderHolder builder, EntityManager em) {\n         var transportConfig = builder.getGlobalConfigurationBuilder().transport();\n-        if (Configuration.isTrue(CachingOptions.CACHE_EMBEDDED_MTLS_ENABLED_PROPERTY)) {\n+        if (Configuration.isTrue(CachingOptions.CACHE_EMBEDDED_MTLS_ENABLED)) {\n             validateTlsAvailable(transportConfig.build());\n             var tls = new TLS()\n                   .enabled(true)"
            },
            {
                "sha": "9760c94d7aa8f9cd7a509b2a3d9efc959545f50a",
                "filename": "quarkus/tests/integration/src/test/java/org/keycloak/it/cli/dist/OptionsDistTest.java",
                "status": "modified",
                "additions": 11,
                "deletions": 3,
                "changes": 14,
                "blob_url": "https://github.com/keycloak/keycloak/blob/36defd5f33b2da5d705f179bbaa21c28b13a9996/quarkus%2Ftests%2Fintegration%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Fit%2Fcli%2Fdist%2FOptionsDistTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/36defd5f33b2da5d705f179bbaa21c28b13a9996/quarkus%2Ftests%2Fintegration%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Fit%2Fcli%2Fdist%2FOptionsDistTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/quarkus%2Ftests%2Fintegration%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Fit%2Fcli%2Fdist%2FOptionsDistTest.java?ref=36defd5f33b2da5d705f179bbaa21c28b13a9996",
                "patch": "@@ -33,6 +33,7 @@\n import java.nio.file.Paths;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n import static org.keycloak.quarkus.runtime.cli.command.Main.CONFIG_FILE_LONG_NAME;\n \n @DistributionTest\n@@ -96,25 +97,32 @@ public void testExpressionsInConfigFile(KeycloakDistribution distribution) {\n         result.assertMessage(\"- log-syslog-app-name: Available only when Syslog is activated.\");\n     }\n \n+    @Test\n+    @Order(7)\n+    @Launch({\"start\", \"--cache-embedded-mtls-enabled=true\", \"--http-enabled=true\", \"--hostname-strict=false\"})\n+    public void testCacheEmbeddedMtlsEnabled(LaunchResult result) {\n+        assertTrue(result.getOutputStream().stream().anyMatch(s -> s.contains(\"Property cache-embedded-mtls-key-store-file required but not specified\")));\n+    }\n+\n     // Start-dev should be executed as last tests - build is done for development mode\n \n     @Test\n-    @Order(7)\n+    @Order(8)\n     @Launch({\"start-dev\", \"--test=invalid\"})\n     public void testServerDoesNotStartIfValidationFailDuringReAugStartDev(LaunchResult result) {\n         assertEquals(1, result.getErrorStream().stream().filter(s -> s.contains(\"Unknown option: '--test'\")).count());\n     }\n \n     @Test\n-    @Order(8)\n+    @Order(9)\n     @Launch({\"start-dev\", \"--log=console\", \"--log-file-output=json\"})\n     public void testServerDoesNotStartDevIfDisabledFileLogOption(LaunchResult result) {\n         assertEquals(1, result.getErrorStream().stream().filter(s -> s.contains(\"Disabled option: '--log-file-output'. Available only when File log handler is activated\")).count());\n         assertEquals(1, result.getErrorStream().stream().filter(s -> s.contains(\"Possible solutions: --log, --log-console-output, --log-console-level, --log-console-format, --log-console-color, --log-level\")).count());\n     }\n \n     @Test\n-    @Order(9)\n+    @Order(10)\n     @Launch({\"start-dev\", \"--log=file\", \"--log-file-output=json\", \"--log-console-color=true\"})\n     public void testServerStartDevIfEnabledFileLogOption(LaunchResult result) {\n         assertEquals(0, result.getErrorStream().stream().filter(s -> s.contains(\"Disabled option: '--log-file-output'. Available only when File log handler is activated\")).count());"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/a95bf2b0303442a2c9a1ac364b0e63b56049e33a",
        "url": "https://api.github.com/repos/apache/tomcat/commits/a95bf2b0303442a2c9a1ac364b0e63b56049e33a",
        "html_url": "https://github.com/apache/tomcat/commit/a95bf2b0303442a2c9a1ac364b0e63b56049e33a",
        "message": "Limit to 10 attributes. Add option to delete attribute.",
        "files": [
            {
                "sha": "5755cadf0ea1237a76edaf7fedb2dc65f13a08d2",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/tomcat/blob/a95bf2b0303442a2c9a1ac364b0e63b56049e33a/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/a95bf2b0303442a2c9a1ac364b0e63b56049e33a/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=a95bf2b0303442a2c9a1ac364b0e63b56049e33a",
                "patch": "@@ -278,6 +278,11 @@\n         Examples. Add a hard coded limit of 10 attributes per session for the\n         servlet session example. (markt)\n       </add>\n+      <add>\n+        Examples. Add the ability to delete session attributes and add a hard\n+        coded limit of 10 attributes per session for the JSP form authentication\n+        example. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "987a30fd1878f6aa1fcb63800c16c19b4dd1ea38",
                "filename": "webapps/examples/jsp/security/protected/index.jsp",
                "status": "modified",
                "additions": 41,
                "deletions": 8,
                "changes": 49,
                "blob_url": "https://github.com/apache/tomcat/blob/a95bf2b0303442a2c9a1ac364b0e63b56049e33a/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/a95bf2b0303442a2c9a1ac364b0e63b56049e33a/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp?ref=a95bf2b0303442a2c9a1ac364b0e63b56049e33a",
                "patch": "@@ -14,8 +14,10 @@\n   See the License for the specific language governing permissions and\n   limitations under the License.\n --%>\n-<%@ page import=\"java.util.Enumeration\" %>\n+<%@ page import=\"java.net.URLEncoder\" %>\n+<%@ page import=\"java.nio.charset.StandardCharsets\" %>\n <%@ page import=\"java.security.Principal\" %>\n+<%@ page import=\"java.util.Enumeration\" %>\n <%@ page import=\"org.apache.catalina.TomcatPrincipal\" %>\n <%\n   if (request.getParameter(\"logoff\") != null) {\n@@ -121,31 +123,62 @@ enter it here:\n %>\n <br><br>\n \n+<%\n+  // Count the existing attributes\n+  int sessionAttributeCount = 0;\n+  Enumeration<String> names = session.getAttributeNames();\n+  while (names.hasMoreElements()) {\n+    names.nextElement();\n+    sessionAttributeCount++;\n+  }\n+\n+  String dataName = request.getParameter(\"dataName\");\n+  String dataValue = request.getParameter(\"dataValue\");\n+  if (dataName != null) {\n+    if (dataValue == null) {\n+      session.removeAttribute(dataName);\n+      sessionAttributeCount--;\n+    } else if (sessionAttributeCount < 10) {\n+      session.setAttribute(dataName, dataValue);\n+      sessionAttributeCount++;\n+    } else {\n+%>\n+<p>Session attribute [<%= util.HTMLFilter.filter(dataName) %>] not added as there are already 10 attributes in the\n+session. Delete an attribute before adding another.</p>\n+<%\n+    }\n+  }\n+\n+  if (sessionAttributeCount < 10) {\n+%>\n To add some data to the authenticated session, enter it here:\n <form method=\"GET\" action='<%= response.encodeURL(\"index.jsp\") %>'>\n <input type=\"text\" name=\"dataName\">\n <input type=\"text\" name=\"dataValue\">\n <input type=\"submit\" >\n </form>\n-<br><br>\n-\n <%\n-  String dataName = request.getParameter(\"dataName\");\n-  if (dataName != null) {\n-    session.setAttribute(dataName, request.getParameter(\"dataValue\"));\n+  } else {\n+%>\n+<p>You may not add more than 10 attributes to this session.</p>\n+<%\n   }\n %>\n+<br><br>\n+\n <p>The authenticated session contains the following attributes:</p>\n <table>\n <tr><th>Name</th><th>Value</th></tr>\n <%\n-  Enumeration<String> names = session.getAttributeNames();\n+  names = session.getAttributeNames();\n   while (names.hasMoreElements()) {\n     String name = names.nextElement();\n+    String value = session.getAttribute(name).toString();\n %>\n <tr>\n   <td><%= util.HTMLFilter.filter(name) %></td>\n-  <td><%= util.HTMLFilter.filter(String.valueOf(session.getAttribute(name))) %></td>\n+  <td><%= util.HTMLFilter.filter(value) %></td>\n+  <td><a href='<%= response.encodeURL(\"index.jsp?dataName=\" + URLEncoder.encode(name, StandardCharsets.UTF_8)) %>'>delete</a></td>\n </tr>\n <%\n   }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/c2f7ce21c3fb12caefee87c517a8bb4f80700044",
        "url": "https://api.github.com/repos/apache/tomcat/commits/c2f7ce21c3fb12caefee87c517a8bb4f80700044",
        "html_url": "https://github.com/apache/tomcat/commit/c2f7ce21c3fb12caefee87c517a8bb4f80700044",
        "message": "Limit to 10 attributes. Add option to delete attribute.",
        "files": [
            {
                "sha": "4910aeffd247ca7e3b682c0255a42969f115e53a",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/tomcat/blob/c2f7ce21c3fb12caefee87c517a8bb4f80700044/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/c2f7ce21c3fb12caefee87c517a8bb4f80700044/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=c2f7ce21c3fb12caefee87c517a8bb4f80700044",
                "patch": "@@ -268,6 +268,11 @@\n         Examples. Add a hard coded limit of 10 attributes per session for the\n         servlet session example. (markt)\n       </add>\n+      <add>\n+        Examples. Add the ability to delete session attributes and add a hard\n+        coded limit of 10 attributes per session for the JSP form authentication\n+        example. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "987a30fd1878f6aa1fcb63800c16c19b4dd1ea38",
                "filename": "webapps/examples/jsp/security/protected/index.jsp",
                "status": "modified",
                "additions": 41,
                "deletions": 8,
                "changes": 49,
                "blob_url": "https://github.com/apache/tomcat/blob/c2f7ce21c3fb12caefee87c517a8bb4f80700044/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/c2f7ce21c3fb12caefee87c517a8bb4f80700044/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp?ref=c2f7ce21c3fb12caefee87c517a8bb4f80700044",
                "patch": "@@ -14,8 +14,10 @@\n   See the License for the specific language governing permissions and\n   limitations under the License.\n --%>\n-<%@ page import=\"java.util.Enumeration\" %>\n+<%@ page import=\"java.net.URLEncoder\" %>\n+<%@ page import=\"java.nio.charset.StandardCharsets\" %>\n <%@ page import=\"java.security.Principal\" %>\n+<%@ page import=\"java.util.Enumeration\" %>\n <%@ page import=\"org.apache.catalina.TomcatPrincipal\" %>\n <%\n   if (request.getParameter(\"logoff\") != null) {\n@@ -121,31 +123,62 @@ enter it here:\n %>\n <br><br>\n \n+<%\n+  // Count the existing attributes\n+  int sessionAttributeCount = 0;\n+  Enumeration<String> names = session.getAttributeNames();\n+  while (names.hasMoreElements()) {\n+    names.nextElement();\n+    sessionAttributeCount++;\n+  }\n+\n+  String dataName = request.getParameter(\"dataName\");\n+  String dataValue = request.getParameter(\"dataValue\");\n+  if (dataName != null) {\n+    if (dataValue == null) {\n+      session.removeAttribute(dataName);\n+      sessionAttributeCount--;\n+    } else if (sessionAttributeCount < 10) {\n+      session.setAttribute(dataName, dataValue);\n+      sessionAttributeCount++;\n+    } else {\n+%>\n+<p>Session attribute [<%= util.HTMLFilter.filter(dataName) %>] not added as there are already 10 attributes in the\n+session. Delete an attribute before adding another.</p>\n+<%\n+    }\n+  }\n+\n+  if (sessionAttributeCount < 10) {\n+%>\n To add some data to the authenticated session, enter it here:\n <form method=\"GET\" action='<%= response.encodeURL(\"index.jsp\") %>'>\n <input type=\"text\" name=\"dataName\">\n <input type=\"text\" name=\"dataValue\">\n <input type=\"submit\" >\n </form>\n-<br><br>\n-\n <%\n-  String dataName = request.getParameter(\"dataName\");\n-  if (dataName != null) {\n-    session.setAttribute(dataName, request.getParameter(\"dataValue\"));\n+  } else {\n+%>\n+<p>You may not add more than 10 attributes to this session.</p>\n+<%\n   }\n %>\n+<br><br>\n+\n <p>The authenticated session contains the following attributes:</p>\n <table>\n <tr><th>Name</th><th>Value</th></tr>\n <%\n-  Enumeration<String> names = session.getAttributeNames();\n+  names = session.getAttributeNames();\n   while (names.hasMoreElements()) {\n     String name = names.nextElement();\n+    String value = session.getAttribute(name).toString();\n %>\n <tr>\n   <td><%= util.HTMLFilter.filter(name) %></td>\n-  <td><%= util.HTMLFilter.filter(String.valueOf(session.getAttribute(name))) %></td>\n+  <td><%= util.HTMLFilter.filter(value) %></td>\n+  <td><a href='<%= response.encodeURL(\"index.jsp?dataName=\" + URLEncoder.encode(name, StandardCharsets.UTF_8)) %>'>delete</a></td>\n </tr>\n <%\n   }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/9ffd23fc27f5d1fc95bf97e5cea175c8968f4533",
        "url": "https://api.github.com/repos/apache/tomcat/commits/9ffd23fc27f5d1fc95bf97e5cea175c8968f4533",
        "html_url": "https://github.com/apache/tomcat/commit/9ffd23fc27f5d1fc95bf97e5cea175c8968f4533",
        "message": "Revert change made for testing",
        "files": [
            {
                "sha": "b324e0250d8a39dbec97b613df2ffee83d6f8b97",
                "filename": "webapps/examples/WEB-INF/classes/RequestHeaderExample.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/9ffd23fc27f5d1fc95bf97e5cea175c8968f4533/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/9ffd23fc27f5d1fc95bf97e5cea175c8968f4533/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java?ref=9ffd23fc27f5d1fc95bf97e5cea175c8968f4533",
                "patch": "@@ -73,7 +73,7 @@ protected boolean prefersJSON(String acceptHeader) {\n \n             // text/html, application/html, etc.\n             if (accept.contains(\"html\")) {\n-                return true;\n+                return false;\n             }\n         }\n         return false;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/d63a10afc142b12f462a15f7d10f79fd80ff94eb",
        "url": "https://api.github.com/repos/apache/tomcat/commits/d63a10afc142b12f462a15f7d10f79fd80ff94eb",
        "html_url": "https://github.com/apache/tomcat/commit/d63a10afc142b12f462a15f7d10f79fd80ff94eb",
        "message": "Limit shopping cart to pre-defined items",
        "files": [
            {
                "sha": "f3a303c9530d1887d0b0ef7dd24acdd1ad8df902",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=d63a10afc142b12f462a15f7d10f79fd80ff94eb",
                "patch": "@@ -278,6 +278,10 @@\n         coded limit of 10 attributes per session for the JSP form authentication\n         example. (markt)\n       </add>\n+      <add>\n+        Examples. Limit the shopping cart example to only allow adding the\n+        pre-defined items to the cart. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "7088557b9595d64775c8559325e2a6880044a20d",
                "filename": "webapps/examples/WEB-INF/classes/sessions/DummyCart.java",
                "status": "modified",
                "additions": 25,
                "deletions": 17,
                "changes": 42,
                "blob_url": "https://github.com/apache/tomcat/blob/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FDummyCart.java",
                "raw_url": "https://github.com/apache/tomcat/raw/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FDummyCart.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FDummyCart.java?ref=d63a10afc142b12f462a15f7d10f79fd80ff94eb",
                "patch": "@@ -16,42 +16,50 @@\n  */\n package sessions;\n \n-import java.util.ArrayList;\n import java.util.Collections;\n-import java.util.List;\n+import java.util.HashSet;\n+import java.util.Set;\n \n public class DummyCart {\n-    final List<String> items = Collections.synchronizedList(new ArrayList<>());\n+    final Set<Item> items = Collections.synchronizedSet(new HashSet<>());\n+    int itemId = -1;\n     String submit = null;\n-    String item = null;\n \n-    private void addItem(String name) {\n-        items.add(name);\n+    public void setItemId(int itemId) {\n+        this.itemId = itemId;\n     }\n \n-    private void removeItem(String name) {\n-        items.remove(name);\n+    public void setSubmit(String s) {\n+        submit = s;\n     }\n \n-    public void setItem(String name) {\n-        item = name;\n+    private void addItem(int itemId) {\n+        try {\n+            items.add(Item.values()[itemId]);\n+        } catch (ArrayIndexOutOfBoundsException e) {\n+            // Ignore. Can only happen if user edits URL directly.\n+        }\n     }\n \n-    public void setSubmit(String s) {\n-        submit = s;\n+    private void removeItem(int itemId) {\n+        try {\n+            items.remove(Item.values()[itemId]);\n+        } catch (ArrayIndexOutOfBoundsException e) {\n+            // Ignore. Can only happen if user edits URL directly.\n+        }\n     }\n \n-    public String[] getItems() {\n-        return items.toArray(new String[0]);\n+    public Item[] getItems() {\n+        return items.toArray(new Item[0]);\n     }\n \n     public void processRequest() {\n         // null value for submit - user hit enter instead of clicking on\n         // \"add\" or \"remove\"\n         if (submit == null || submit.equals(\"add\")) {\n-            addItem(item);\n+            addItem(itemId);\n         } else if (submit.equals(\"remove\")) {\n-            removeItem(item);\n+            removeItem(itemId);\n         }\n \n         // reset at the end of the request\n@@ -61,6 +69,6 @@ public void processRequest() {\n     // reset\n     private void reset() {\n         submit = null;\n-        item = null;\n+        itemId = -1;\n     }\n }"
            },
            {
                "sha": "447d04443744ac96bd08aebcca8541e84c66fe78",
                "filename": "webapps/examples/WEB-INF/classes/sessions/Item.java",
                "status": "added",
                "additions": 37,
                "deletions": 0,
                "changes": 37,
                "blob_url": "https://github.com/apache/tomcat/blob/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FItem.java",
                "raw_url": "https://github.com/apache/tomcat/raw/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FItem.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FItem.java?ref=d63a10afc142b12f462a15f7d10f79fd80ff94eb",
                "patch": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package sessions;\n+\n+public enum Item {\n+\n+    VIDEO(\"Beavis & Butt-head Video collection\"),\n+    MOVIE(\"X-files movie\"),\n+    TAPES(\"Twin peaks tapes\"),\n+    CD(\"NIN CD\"),\n+    BOOK(\"JSP Book\"),\n+    TICKETS(\"Concert tickets\");\n+\n+    private final String title;\n+\n+    Item(String title) {\n+        this.title = title;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+}"
            },
            {
                "sha": "cda01d62fd29d8126a911d0e3257ec045e22f95c",
                "filename": "webapps/examples/jsp/index.html",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2Fjsp%2Findex.html",
                "raw_url": "https://github.com/apache/tomcat/raw/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2Fjsp%2Findex.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Findex.html?ref=d63a10afc142b12f462a15f7d10f79fd80ff94eb",
                "patch": "@@ -228,7 +228,7 @@ <h2>JSP 1.2 Examples</h2>\n <tr>\n <td>Carts</td>\n \n-<td style=\"width: 30%;\"><a href=\"sessions/carts.html\"><img src=\"images/execute.gif\" alt=\"\"></a><a href=\"sessions/carts.html\">Execute</a></td>\n+<td style=\"width: 30%;\"><a href=\"sessions/shopping.jsp\"><img src=\"images/execute.gif\" alt=\"\"></a><a href=\"sessions/shopping.jsp\">Execute</a></td>\n \n <td style=\"width: 30%;\"><a href=\"sessions/crt.html\"><img src=\"images/code.gif\" alt=\"\"></a><a href=\"sessions/crt.html\">Source</a></td>\n </tr>"
            },
            {
                "sha": "fa5624dee6bdd1fe173ca14af1b7b241d4ffbee2",
                "filename": "webapps/examples/jsp/sessions/carts.jsp",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/apache/tomcat/blob/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcarts.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcarts.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcarts.jsp?ref=d63a10afc142b12f462a15f7d10f79fd80ff94eb",
                "patch": "@@ -27,10 +27,10 @@\n <br> You have the following items in your cart:\n <ol>\n <%\n-    String[] items = cart.getItems();\n-    for (String item : items) {\n+    Item[] items = cart.getItems();\n+    for (Item item : items) {\n %>\n-<li> <% out.print(util.HTMLFilter.filter(item)); %>\n+<li> <% out.print(util.HTMLFilter.filter(item.getTitle())); %>\n <%\n     }\n %>\n@@ -39,5 +39,5 @@\n </FONT>\n \n <hr>\n-<%@ include file =\"carts.html\" %>\n+<%@ include file =\"shopping.jsp\" %>\n </html>"
            },
            {
                "sha": "28ace66012c776da97c7d34c58155ec1bb09fc95",
                "filename": "webapps/examples/jsp/sessions/crt.html",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/apache/tomcat/blob/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcrt.html",
                "raw_url": "https://github.com/apache/tomcat/raw/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcrt.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcrt.html?ref=d63a10afc142b12f462a15f7d10f79fd80ff94eb",
                "patch": "@@ -22,9 +22,12 @@\n </head>\n \n <body bgcolor=\"#FFFFFF\">\n-<p><font color=\"#0000FF\"><a href=\"carts.html\"><img src=\"../images/execute.gif\" align=\"right\" border=\"0\"></a><a href=\"../index.html\"><img src=\"../images/return.gif\" width=\"24\" height=\"24\" align=\"right\" border=\"0\"></a></font></p>\n+<p><font color=\"#0000FF\"><a href=\"shopping.jsp\"><img src=\"../images/execute.gif\" align=\"right\" border=\"0\"></a><a href=\"../index.html\"><img src=\"../images/return.gif\" width=\"24\" height=\"24\" align=\"right\" border=\"0\"></a></font></p>\n \n-<h3><a href=\"carts.jsp.html\">Source Code for Cart Example<font color=\"#0000FF\"></a>\n+<h3><a href=\"shopping.jsp.html\">Source Code for Cart Example Shopping Page<font color=\"#0000FF\"></a>\n+  </font> </h3>\n+\n+<h3><a href=\"carts.jsp.html\">Source Code for Cart Example Cart Page<font color=\"#0000FF\"></a>\n   </font> </h3>\n \n <h3><a href=\"DummyCart.html\">Property Sheet for DummyCart"
            },
            {
                "sha": "3487b10295477e4d07dba4b7bcc896ade41c7838",
                "filename": "webapps/examples/jsp/sessions/shopping.jsp",
                "status": "renamed",
                "additions": 19,
                "deletions": 22,
                "changes": 41,
                "blob_url": "https://github.com/apache/tomcat/blob/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2Fjsp%2Fsessions%2Fshopping.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/d63a10afc142b12f462a15f7d10f79fd80ff94eb/webapps%2Fexamples%2Fjsp%2Fsessions%2Fshopping.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsessions%2Fshopping.jsp?ref=d63a10afc142b12f462a15f7d10f79fd80ff94eb",
                "patch": "@@ -1,5 +1,4 @@\n-<html>\n-<!--\n+<%--\n  Licensed to the Apache Software Foundation (ASF) under one or more\n   contributor license agreements.  See the NOTICE file distributed with\n   this work for additional information regarding copyright ownership.\n@@ -14,40 +13,38 @@\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n--->\n-\n+--%>\n+<%@ page import=\"sessions.Item\" %>\n+<html>\n <head>\n-    <title>carts</title>\n+<title>Shopping Cart Example</title>\n </head>\n \n- <body bgcolor=\"white\">\n+<body bgcolor=\"white\">\n <font size = 5 color=\"#CC0000\">\n \n <form type=POST action=carts.jsp>\n-<BR>\n+<br>\n Please enter item to add or remove:\n <br>\n-Add Item:\n-\n-<SELECT NAME=\"item\">\n-<OPTION>Beavis & Butt-head Video collection\n-<OPTION>X-files movie\n-<OPTION>Twin peaks tapes\n-<OPTION>NIN CD\n-<OPTION>JSP Book\n-<OPTION>Concert tickets\n-<OPTION>Love life\n-<OPTION>Switch blade\n-<OPTION>Rex, Rugs & Rock n' Roll\n-</SELECT>\n-\n+Select Item:\n+\n+<select name=\"itemId\">\n+<%\n+  for (Item item : Item.values()) {\n+%>\n+  <option value=\"<%= item.ordinal() %>\"><%= item.getTitle() %></option>\n+<%\n+  }\n+%>\n+</select>\n \n <br> <br>\n <INPUT TYPE=submit name=\"submit\" value=\"add\">\n <INPUT TYPE=submit name=\"submit\" value=\"remove\">\n \n </form>\n \n-</FONT>\n+</font>\n </body>\n </html>",
                "previous_filename": "webapps/examples/jsp/sessions/carts.html"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/1d88dd3ffaed76188dd4ee32ce77709ce6e153cd",
        "url": "https://api.github.com/repos/apache/tomcat/commits/1d88dd3ffaed76188dd4ee32ce77709ce6e153cd",
        "html_url": "https://github.com/apache/tomcat/commit/1d88dd3ffaed76188dd4ee32ce77709ce6e153cd",
        "message": "Obfuscate session cookie values for JSON output as well as HTML",
        "files": [
            {
                "sha": "1431d3ebd986704a585f97c3286ddb07818d3048",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/1d88dd3ffaed76188dd4ee32ce77709ce6e153cd/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/1d88dd3ffaed76188dd4ee32ce77709ce6e153cd/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=1d88dd3ffaed76188dd4ee32ce77709ce6e153cd",
                "patch": "@@ -246,6 +246,10 @@\n         Examples. Fix broken links when Servlet Request Info example is called\n         via a URL that includes a pathInfo component. (markt)\n       </fix>\n+      <fix>\n+        Examples. Expand the obfuscation of session cookie values in the request\n+        header example to JSON responses. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "e32f8c2336741f47efa61d1bd8be4d4dcd2749c9",
                "filename": "webapps/examples/WEB-INF/classes/RequestHeaderExample.java",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/apache/tomcat/blob/1d88dd3ffaed76188dd4ee32ce77709ce6e153cd/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/1d88dd3ffaed76188dd4ee32ce77709ce6e153cd/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java?ref=1d88dd3ffaed76188dd4ee32ce77709ce6e153cd",
                "patch": "@@ -73,7 +73,7 @@ protected boolean prefersJSON(String acceptHeader) {\n \n             // text/html, application/html, etc.\n             if (accept.contains(\"html\")) {\n-                return false;\n+                return true;\n             }\n         }\n         return false;\n@@ -138,8 +138,20 @@ protected void renderJSON(HttpServletRequest request, HttpServletResponse respon\n             String headerName = e.nextElement();\n             String headerValue = request.getHeader(headerName);\n \n-            out.append(\"{\\\"\").append(JSONFilter.escape(headerName)).append(\"\\\":\\\"\")\n-                    .append(JSONFilter.escape(headerValue)).append(\"\\\"}\");\n+            out.append(\"{\\\"\").append(JSONFilter.escape(headerName)).append(\"\\\":\\\"\");\n+\n+\n+            if (headerName.toLowerCase(Locale.ENGLISH).contains(\"cookie\")) {\n+                HttpSession session = request.getSession(false);\n+                String sessionId = null;\n+                if (session != null) {\n+                    sessionId = session.getId();\n+                }\n+                out.append(JSONFilter.escape(CookieFilter.filter(headerValue, sessionId)));\n+            } else {\n+                out.append(JSONFilter.escape(headerValue));\n+            }\n+            out.append(\"\\\"}\");\n \n             if (e.hasMoreElements()) {\n                 out.append(',');"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/dbec927859d9484cb8bd680a7c67b1a560f48444",
        "url": "https://api.github.com/repos/apache/tomcat/commits/dbec927859d9484cb8bd680a7c67b1a560f48444",
        "html_url": "https://github.com/apache/tomcat/commit/dbec927859d9484cb8bd680a7c67b1a560f48444",
        "message": "Limit to 10 attributes. Add option to delete attribute.",
        "files": [
            {
                "sha": "18f9d7ac27bab058e2764e5a978bf304b5841ffa",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/tomcat/blob/dbec927859d9484cb8bd680a7c67b1a560f48444/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/dbec927859d9484cb8bd680a7c67b1a560f48444/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=dbec927859d9484cb8bd680a7c67b1a560f48444",
                "patch": "@@ -268,6 +268,11 @@\n         Examples. Add a hard coded limit of 10 attributes per session for the\n         servlet session example. (markt)\n       </add>\n+      <add>\n+        Examples. Add the ability to delete session attributes and add a hard\n+        coded limit of 10 attributes per session for the JSP form authentication\n+        example. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "987a30fd1878f6aa1fcb63800c16c19b4dd1ea38",
                "filename": "webapps/examples/jsp/security/protected/index.jsp",
                "status": "modified",
                "additions": 41,
                "deletions": 8,
                "changes": 49,
                "blob_url": "https://github.com/apache/tomcat/blob/dbec927859d9484cb8bd680a7c67b1a560f48444/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/dbec927859d9484cb8bd680a7c67b1a560f48444/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp?ref=dbec927859d9484cb8bd680a7c67b1a560f48444",
                "patch": "@@ -14,8 +14,10 @@\n   See the License for the specific language governing permissions and\n   limitations under the License.\n --%>\n-<%@ page import=\"java.util.Enumeration\" %>\n+<%@ page import=\"java.net.URLEncoder\" %>\n+<%@ page import=\"java.nio.charset.StandardCharsets\" %>\n <%@ page import=\"java.security.Principal\" %>\n+<%@ page import=\"java.util.Enumeration\" %>\n <%@ page import=\"org.apache.catalina.TomcatPrincipal\" %>\n <%\n   if (request.getParameter(\"logoff\") != null) {\n@@ -121,31 +123,62 @@ enter it here:\n %>\n <br><br>\n \n+<%\n+  // Count the existing attributes\n+  int sessionAttributeCount = 0;\n+  Enumeration<String> names = session.getAttributeNames();\n+  while (names.hasMoreElements()) {\n+    names.nextElement();\n+    sessionAttributeCount++;\n+  }\n+\n+  String dataName = request.getParameter(\"dataName\");\n+  String dataValue = request.getParameter(\"dataValue\");\n+  if (dataName != null) {\n+    if (dataValue == null) {\n+      session.removeAttribute(dataName);\n+      sessionAttributeCount--;\n+    } else if (sessionAttributeCount < 10) {\n+      session.setAttribute(dataName, dataValue);\n+      sessionAttributeCount++;\n+    } else {\n+%>\n+<p>Session attribute [<%= util.HTMLFilter.filter(dataName) %>] not added as there are already 10 attributes in the\n+session. Delete an attribute before adding another.</p>\n+<%\n+    }\n+  }\n+\n+  if (sessionAttributeCount < 10) {\n+%>\n To add some data to the authenticated session, enter it here:\n <form method=\"GET\" action='<%= response.encodeURL(\"index.jsp\") %>'>\n <input type=\"text\" name=\"dataName\">\n <input type=\"text\" name=\"dataValue\">\n <input type=\"submit\" >\n </form>\n-<br><br>\n-\n <%\n-  String dataName = request.getParameter(\"dataName\");\n-  if (dataName != null) {\n-    session.setAttribute(dataName, request.getParameter(\"dataValue\"));\n+  } else {\n+%>\n+<p>You may not add more than 10 attributes to this session.</p>\n+<%\n   }\n %>\n+<br><br>\n+\n <p>The authenticated session contains the following attributes:</p>\n <table>\n <tr><th>Name</th><th>Value</th></tr>\n <%\n-  Enumeration<String> names = session.getAttributeNames();\n+  names = session.getAttributeNames();\n   while (names.hasMoreElements()) {\n     String name = names.nextElement();\n+    String value = session.getAttribute(name).toString();\n %>\n <tr>\n   <td><%= util.HTMLFilter.filter(name) %></td>\n-  <td><%= util.HTMLFilter.filter(String.valueOf(session.getAttribute(name))) %></td>\n+  <td><%= util.HTMLFilter.filter(value) %></td>\n+  <td><a href='<%= response.encodeURL(\"index.jsp?dataName=\" + URLEncoder.encode(name, StandardCharsets.UTF_8)) %>'>delete</a></td>\n </tr>\n <%\n   }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/4a335c6dcba8d6f8a54629eda392a50da267bdf4",
        "url": "https://api.github.com/repos/apache/tomcat/commits/4a335c6dcba8d6f8a54629eda392a50da267bdf4",
        "html_url": "https://github.com/apache/tomcat/commit/4a335c6dcba8d6f8a54629eda392a50da267bdf4",
        "message": "Limit shopping cart to pre-defined items",
        "files": [
            {
                "sha": "1ea45f8f449f004656a59ee91732dbf16f5ad4f1",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=4a335c6dcba8d6f8a54629eda392a50da267bdf4",
                "patch": "@@ -288,6 +288,10 @@\n         coded limit of 10 attributes per session for the JSP form authentication\n         example. (markt)\n       </add>\n+      <add>\n+        Examples. Limit the shopping cart example to only allow adding the\n+        pre-defined items to the cart. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "7088557b9595d64775c8559325e2a6880044a20d",
                "filename": "webapps/examples/WEB-INF/classes/sessions/DummyCart.java",
                "status": "modified",
                "additions": 25,
                "deletions": 17,
                "changes": 42,
                "blob_url": "https://github.com/apache/tomcat/blob/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FDummyCart.java",
                "raw_url": "https://github.com/apache/tomcat/raw/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FDummyCart.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FDummyCart.java?ref=4a335c6dcba8d6f8a54629eda392a50da267bdf4",
                "patch": "@@ -16,42 +16,50 @@\n  */\n package sessions;\n \n-import java.util.ArrayList;\n import java.util.Collections;\n-import java.util.List;\n+import java.util.HashSet;\n+import java.util.Set;\n \n public class DummyCart {\n-    final List<String> items = Collections.synchronizedList(new ArrayList<>());\n+    final Set<Item> items = Collections.synchronizedSet(new HashSet<>());\n+    int itemId = -1;\n     String submit = null;\n-    String item = null;\n \n-    private void addItem(String name) {\n-        items.add(name);\n+    public void setItemId(int itemId) {\n+        this.itemId = itemId;\n     }\n \n-    private void removeItem(String name) {\n-        items.remove(name);\n+    public void setSubmit(String s) {\n+        submit = s;\n     }\n \n-    public void setItem(String name) {\n-        item = name;\n+    private void addItem(int itemId) {\n+        try {\n+            items.add(Item.values()[itemId]);\n+        } catch (ArrayIndexOutOfBoundsException e) {\n+            // Ignore. Can only happen if user edits URL directly.\n+        }\n     }\n \n-    public void setSubmit(String s) {\n-        submit = s;\n+    private void removeItem(int itemId) {\n+        try {\n+            items.remove(Item.values()[itemId]);\n+        } catch (ArrayIndexOutOfBoundsException e) {\n+            // Ignore. Can only happen if user edits URL directly.\n+        }\n     }\n \n-    public String[] getItems() {\n-        return items.toArray(new String[0]);\n+    public Item[] getItems() {\n+        return items.toArray(new Item[0]);\n     }\n \n     public void processRequest() {\n         // null value for submit - user hit enter instead of clicking on\n         // \"add\" or \"remove\"\n         if (submit == null || submit.equals(\"add\")) {\n-            addItem(item);\n+            addItem(itemId);\n         } else if (submit.equals(\"remove\")) {\n-            removeItem(item);\n+            removeItem(itemId);\n         }\n \n         // reset at the end of the request\n@@ -61,6 +69,6 @@ public void processRequest() {\n     // reset\n     private void reset() {\n         submit = null;\n-        item = null;\n+        itemId = -1;\n     }\n }"
            },
            {
                "sha": "447d04443744ac96bd08aebcca8541e84c66fe78",
                "filename": "webapps/examples/WEB-INF/classes/sessions/Item.java",
                "status": "added",
                "additions": 37,
                "deletions": 0,
                "changes": 37,
                "blob_url": "https://github.com/apache/tomcat/blob/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FItem.java",
                "raw_url": "https://github.com/apache/tomcat/raw/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FItem.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FItem.java?ref=4a335c6dcba8d6f8a54629eda392a50da267bdf4",
                "patch": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package sessions;\n+\n+public enum Item {\n+\n+    VIDEO(\"Beavis & Butt-head Video collection\"),\n+    MOVIE(\"X-files movie\"),\n+    TAPES(\"Twin peaks tapes\"),\n+    CD(\"NIN CD\"),\n+    BOOK(\"JSP Book\"),\n+    TICKETS(\"Concert tickets\");\n+\n+    private final String title;\n+\n+    Item(String title) {\n+        this.title = title;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+}"
            },
            {
                "sha": "cda01d62fd29d8126a911d0e3257ec045e22f95c",
                "filename": "webapps/examples/jsp/index.html",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2Fjsp%2Findex.html",
                "raw_url": "https://github.com/apache/tomcat/raw/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2Fjsp%2Findex.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Findex.html?ref=4a335c6dcba8d6f8a54629eda392a50da267bdf4",
                "patch": "@@ -228,7 +228,7 @@ <h2>JSP 1.2 Examples</h2>\n <tr>\n <td>Carts</td>\n \n-<td style=\"width: 30%;\"><a href=\"sessions/carts.html\"><img src=\"images/execute.gif\" alt=\"\"></a><a href=\"sessions/carts.html\">Execute</a></td>\n+<td style=\"width: 30%;\"><a href=\"sessions/shopping.jsp\"><img src=\"images/execute.gif\" alt=\"\"></a><a href=\"sessions/shopping.jsp\">Execute</a></td>\n \n <td style=\"width: 30%;\"><a href=\"sessions/crt.html\"><img src=\"images/code.gif\" alt=\"\"></a><a href=\"sessions/crt.html\">Source</a></td>\n </tr>"
            },
            {
                "sha": "fa5624dee6bdd1fe173ca14af1b7b241d4ffbee2",
                "filename": "webapps/examples/jsp/sessions/carts.jsp",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/apache/tomcat/blob/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcarts.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcarts.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcarts.jsp?ref=4a335c6dcba8d6f8a54629eda392a50da267bdf4",
                "patch": "@@ -27,10 +27,10 @@\n <br> You have the following items in your cart:\n <ol>\n <%\n-    String[] items = cart.getItems();\n-    for (String item : items) {\n+    Item[] items = cart.getItems();\n+    for (Item item : items) {\n %>\n-<li> <% out.print(util.HTMLFilter.filter(item)); %>\n+<li> <% out.print(util.HTMLFilter.filter(item.getTitle())); %>\n <%\n     }\n %>\n@@ -39,5 +39,5 @@\n </FONT>\n \n <hr>\n-<%@ include file =\"carts.html\" %>\n+<%@ include file =\"shopping.jsp\" %>\n </html>"
            },
            {
                "sha": "28ace66012c776da97c7d34c58155ec1bb09fc95",
                "filename": "webapps/examples/jsp/sessions/crt.html",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/apache/tomcat/blob/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcrt.html",
                "raw_url": "https://github.com/apache/tomcat/raw/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcrt.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcrt.html?ref=4a335c6dcba8d6f8a54629eda392a50da267bdf4",
                "patch": "@@ -22,9 +22,12 @@\n </head>\n \n <body bgcolor=\"#FFFFFF\">\n-<p><font color=\"#0000FF\"><a href=\"carts.html\"><img src=\"../images/execute.gif\" align=\"right\" border=\"0\"></a><a href=\"../index.html\"><img src=\"../images/return.gif\" width=\"24\" height=\"24\" align=\"right\" border=\"0\"></a></font></p>\n+<p><font color=\"#0000FF\"><a href=\"shopping.jsp\"><img src=\"../images/execute.gif\" align=\"right\" border=\"0\"></a><a href=\"../index.html\"><img src=\"../images/return.gif\" width=\"24\" height=\"24\" align=\"right\" border=\"0\"></a></font></p>\n \n-<h3><a href=\"carts.jsp.html\">Source Code for Cart Example<font color=\"#0000FF\"></a>\n+<h3><a href=\"shopping.jsp.html\">Source Code for Cart Example Shopping Page<font color=\"#0000FF\"></a>\n+  </font> </h3>\n+\n+<h3><a href=\"carts.jsp.html\">Source Code for Cart Example Cart Page<font color=\"#0000FF\"></a>\n   </font> </h3>\n \n <h3><a href=\"DummyCart.html\">Property Sheet for DummyCart"
            },
            {
                "sha": "3487b10295477e4d07dba4b7bcc896ade41c7838",
                "filename": "webapps/examples/jsp/sessions/shopping.jsp",
                "status": "renamed",
                "additions": 19,
                "deletions": 22,
                "changes": 41,
                "blob_url": "https://github.com/apache/tomcat/blob/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2Fjsp%2Fsessions%2Fshopping.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/4a335c6dcba8d6f8a54629eda392a50da267bdf4/webapps%2Fexamples%2Fjsp%2Fsessions%2Fshopping.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsessions%2Fshopping.jsp?ref=4a335c6dcba8d6f8a54629eda392a50da267bdf4",
                "patch": "@@ -1,5 +1,4 @@\n-<html>\n-<!--\n+<%--\n  Licensed to the Apache Software Foundation (ASF) under one or more\n   contributor license agreements.  See the NOTICE file distributed with\n   this work for additional information regarding copyright ownership.\n@@ -14,40 +13,38 @@\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n--->\n-\n+--%>\n+<%@ page import=\"sessions.Item\" %>\n+<html>\n <head>\n-    <title>carts</title>\n+<title>Shopping Cart Example</title>\n </head>\n \n- <body bgcolor=\"white\">\n+<body bgcolor=\"white\">\n <font size = 5 color=\"#CC0000\">\n \n <form type=POST action=carts.jsp>\n-<BR>\n+<br>\n Please enter item to add or remove:\n <br>\n-Add Item:\n-\n-<SELECT NAME=\"item\">\n-<OPTION>Beavis & Butt-head Video collection\n-<OPTION>X-files movie\n-<OPTION>Twin peaks tapes\n-<OPTION>NIN CD\n-<OPTION>JSP Book\n-<OPTION>Concert tickets\n-<OPTION>Love life\n-<OPTION>Switch blade\n-<OPTION>Rex, Rugs & Rock n' Roll\n-</SELECT>\n-\n+Select Item:\n+\n+<select name=\"itemId\">\n+<%\n+  for (Item item : Item.values()) {\n+%>\n+  <option value=\"<%= item.ordinal() %>\"><%= item.getTitle() %></option>\n+<%\n+  }\n+%>\n+</select>\n \n <br> <br>\n <INPUT TYPE=submit name=\"submit\" value=\"add\">\n <INPUT TYPE=submit name=\"submit\" value=\"remove\">\n \n </form>\n \n-</FONT>\n+</font>\n </body>\n </html>",
                "previous_filename": "webapps/examples/jsp/sessions/carts.html"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/84065e26ca4555e63a922bb29b13b0a1c86b7654",
        "url": "https://api.github.com/repos/apache/tomcat/commits/84065e26ca4555e63a922bb29b13b0a1c86b7654",
        "html_url": "https://github.com/apache/tomcat/commit/84065e26ca4555e63a922bb29b13b0a1c86b7654",
        "message": "Add a limit of 10 attributes per session to the session example",
        "files": [
            {
                "sha": "84effc445c7880ac894fdd5c2ae5fd2797266b16",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/84065e26ca4555e63a922bb29b13b0a1c86b7654/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/84065e26ca4555e63a922bb29b13b0a1c86b7654/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=84065e26ca4555e63a922bb29b13b0a1c86b7654",
                "patch": "@@ -254,6 +254,10 @@\n         Examples. Add the ability to delete session attributes in the servlet\n         session example. (markt)\n       </add>\n+      <add>\n+        Examples. Add a hard coded limit of 10 attributes per session for the\n+        servlet session example. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "60eaa2e03e4b78ab5e311a847ee1a89a6bb48744",
                "filename": "webapps/examples/WEB-INF/classes/SessionExample.java",
                "status": "modified",
                "additions": 60,
                "deletions": 34,
                "changes": 94,
                "blob_url": "https://github.com/apache/tomcat/blob/84065e26ca4555e63a922bb29b13b0a1c86b7654/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/84065e26ca4555e63a922bb29b13b0a1c86b7654/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java?ref=84065e26ca4555e63a922bb29b13b0a1c86b7654",
                "patch": "@@ -41,6 +41,9 @@ public class SessionExample extends HttpServlet {\n \n     private static final long serialVersionUID = 1L;\n \n+    private static final int SESSION_ATTRIBUTE_COUNT_LIMIT = 10;\n+\n+\n     @Override\n     public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {\n         ResourceBundle rb = ResourceBundle.getBundle(\"LocalStrings\", request.getLocale());\n@@ -76,15 +79,34 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n         out.println(rb.getString(\"sessions.lastaccessed\") + \" \");\n         out.println(new Date(session.getLastAccessedTime()));\n \n+        // Count the existing attributes\n+        int sessionAttributeCount = 0;\n+        Enumeration<String> names = session.getAttributeNames();\n+        while (names.hasMoreElements()) {\n+            names.nextElement();\n+            sessionAttributeCount++;\n+        }\n+\n         String dataName = request.getParameter(\"dataname\");\n         String dataValue = request.getParameter(\"datavalue\");\n         if (dataName != null) {\n-            session.setAttribute(dataName, dataValue);\n+            if (dataValue == null) {\n+                session.removeAttribute(dataName);\n+                sessionAttributeCount--;\n+            } else if (sessionAttributeCount < SESSION_ATTRIBUTE_COUNT_LIMIT) {\n+                session.setAttribute(dataName, dataValue);\n+                sessionAttributeCount++;\n+            } else {\n+                out.print(\"<p> Session attribute [\");\n+                out.print(HTMLFilter.filter(dataName));\n+                out.print(\"] not added as there are already \"+ SESSION_ATTRIBUTE_COUNT_LIMIT + \" attributes in the \");\n+                out.println(\"session. Delete an attribute before adding another.\");\n+            }\n         }\n \n-        out.println(\"<P>\");\n+        out.println(\"<p>\");\n         out.println(rb.getString(\"sessions.data\") + \"<br>\");\n-        Enumeration<String> names = session.getAttributeNames();\n+        names = session.getAttributeNames();\n         while (names.hasMoreElements()) {\n             String name = names.nextElement();\n             String value = session.getAttribute(name).toString();\n@@ -96,37 +118,41 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n             out.println(\"<br>\");\n         }\n \n-        out.println(\"<P>\");\n-        out.print(\"<form action=\\\"\");\n-        out.print(response.encodeURL(\"SessionExample\"));\n-        out.print(\"\\\" \");\n-        out.println(\"method=POST>\");\n-        out.println(rb.getString(\"sessions.dataname\"));\n-        out.println(\"<input type=text size=20 name=dataname>\");\n-        out.println(\"<br>\");\n-        out.println(rb.getString(\"sessions.datavalue\"));\n-        out.println(\"<input type=text size=20 name=datavalue>\");\n-        out.println(\"<br>\");\n-        out.println(\"<input type=submit>\");\n-        out.println(\"</form>\");\n-\n-        out.println(\"<P>GET based form:<br>\");\n-        out.print(\"<form action=\\\"\");\n-        out.print(response.encodeURL(\"SessionExample\"));\n-        out.print(\"\\\" \");\n-        out.println(\"method=GET>\");\n-        out.println(rb.getString(\"sessions.dataname\"));\n-        out.println(\"<input type=text size=20 name=dataname>\");\n-        out.println(\"<br>\");\n-        out.println(rb.getString(\"sessions.datavalue\"));\n-        out.println(\"<input type=text size=20 name=datavalue>\");\n-        out.println(\"<br>\");\n-        out.println(\"<input type=submit>\");\n-        out.println(\"</form>\");\n-\n-        out.print(\"<p><a href=\\\"\");\n-        out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=exampleName&datavalue=exampleValue\")));\n-        out.println(\"\\\" >URL encoded </a>\");\n+        if (sessionAttributeCount < SESSION_ATTRIBUTE_COUNT_LIMIT) {\n+            out.println(\"<p>\");\n+            out.print(\"<form action=\\\"\");\n+            out.print(response.encodeURL(\"SessionExample\"));\n+            out.print(\"\\\" \");\n+            out.println(\"method=POST>\");\n+            out.println(rb.getString(\"sessions.dataname\"));\n+            out.println(\"<input type=text size=20 name=dataname>\");\n+            out.println(\"<br>\");\n+            out.println(rb.getString(\"sessions.datavalue\"));\n+            out.println(\"<input type=text size=20 name=datavalue>\");\n+            out.println(\"<br>\");\n+            out.println(\"<input type=submit>\");\n+            out.println(\"</form>\");\n+\n+            out.println(\"<p>GET based form:<br>\");\n+            out.print(\"<form action=\\\"\");\n+            out.print(response.encodeURL(\"SessionExample\"));\n+            out.print(\"\\\" \");\n+            out.println(\"method=GET>\");\n+            out.println(rb.getString(\"sessions.dataname\"));\n+            out.println(\"<input type=text size=20 name=dataname>\");\n+            out.println(\"<br>\");\n+            out.println(rb.getString(\"sessions.datavalue\"));\n+            out.println(\"<input type=text size=20 name=datavalue>\");\n+            out.println(\"<br>\");\n+            out.println(\"<input type=submit>\");\n+            out.println(\"</form>\");\n+\n+            out.print(\"<p><a href=\\\"\");\n+            out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=exampleName&datavalue=exampleValue\")));\n+            out.println(\"\\\" >URL encoded </a>\");\n+        } else {\n+            out.print(\"<p>You may not add more than \" + SESSION_ATTRIBUTE_COUNT_LIMIT + \" attributes to this session.\");\n+        }\n \n         out.println(\"</body>\");\n         out.println(\"</html>\");"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/84c4af76e7a10fc7f8630ce62e6a46632ea4a90e",
        "url": "https://api.github.com/repos/apache/tomcat/commits/84c4af76e7a10fc7f8630ce62e6a46632ea4a90e",
        "html_url": "https://github.com/apache/tomcat/commit/84c4af76e7a10fc7f8630ce62e6a46632ea4a90e",
        "message": "Remove JSP calendar example.",
        "files": [
            {
                "sha": "5b3e1738c283cb3b73a9411096260e058c863b9e",
                "filename": "build.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/apache/tomcat/blob/84c4af76e7a10fc7f8630ce62e6a46632ea4a90e/build.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/84c4af76e7a10fc7f8630ce62e6a46632ea4a90e/build.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/build.xml?ref=84c4af76e7a10fc7f8630ce62e6a46632ea4a90e",
                "patch": "@@ -1646,15 +1646,6 @@\n       </fileset>\n     </txt2html>\n \n-    <txt2html todir=\"${tomcat.build}/webapps/examples/jsp/cal\">\n-      <fileset dir=\"webapps/examples/WEB-INF/classes/cal\">\n-        <include name=\"Entries.java\"/>\n-        <include name=\"Entry.java\"/>\n-        <include name=\"JspCalendar.java\"/>\n-        <include name=\"TableBean.java\"/>\n-      </fileset>\n-    </txt2html>\n-\n     <txt2html todir=\"${tomcat.build}/webapps/examples/jsp/jsptoserv\">\n       <fileset dir=\"webapps/examples/WEB-INF/classes\">\n         <include name=\"ServletToJsp.java\"/>"
            },
            {
                "sha": "865595dfac408665aca0bd7b150c4d12f305a64c",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/tomcat/blob/84c4af76e7a10fc7f8630ce62e6a46632ea4a90e/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/84c4af76e7a10fc7f8630ce62e6a46632ea4a90e/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=84c4af76e7a10fc7f8630ce62e6a46632ea4a90e",
                "patch": "@@ -282,6 +282,9 @@\n         Examples. Limit the shopping cart example to only allow adding the\n         pre-defined items to the cart. (markt)\n       </add>\n+      <fix>\n+        Examples. Remove JSP calendar example. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "cac611a03b1f6a85e8773a15cf3b413d68e538d9",
                "filename": "webapps/examples/WEB-INF/classes/cal/Entries.java",
                "status": "removed",
                "additions": 0,
                "deletions": 63,
                "changes": 63,
                "blob_url": "https://github.com/apache/tomcat/blob/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntries.java",
                "raw_url": "https://github.com/apache/tomcat/raw/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntries.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntries.java?ref=e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403",
                "patch": "@@ -1,63 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n-\n-import javax.servlet.http.HttpServletRequest;\n-\n-public class Entries {\n-\n-    private final Map<String, Entry> entries;\n-    private static final String[] time = { \"8am\", \"9am\", \"10am\", \"11am\",\n-            \"12pm\", \"1pm\", \"2pm\", \"3pm\", \"4pm\", \"5pm\", \"6pm\", \"7pm\", \"8pm\" };\n-    public static final int rows = 12;\n-\n-    public Entries() {\n-        entries = new ConcurrentHashMap<>(rows);\n-        for (int i = 0; i < rows; i++) {\n-            entries.put(time[i], new Entry(time[i]));\n-        }\n-    }\n-\n-    public int getRows() {\n-        return rows;\n-    }\n-\n-    public Entry getEntry(int index) {\n-        return this.entries.get(time[index]);\n-    }\n-\n-    public int getIndex(String tm) {\n-        for (int i = 0; i < rows; i++) {\n-            if (tm.equals(time[i])) {\n-                return i;\n-            }\n-        }\n-        return -1;\n-    }\n-\n-    public void processRequest(HttpServletRequest request, String tm) {\n-        int index = getIndex(tm);\n-        if (index >= 0) {\n-            String descr = request.getParameter(\"description\");\n-            entries.get(time[index]).setDescription(descr);\n-        }\n-    }\n-\n-}"
            },
            {
                "sha": "ac248bfa316957f5e2917690466268d5aa6bba2b",
                "filename": "webapps/examples/WEB-INF/classes/cal/Entry.java",
                "status": "removed",
                "additions": 0,
                "deletions": 52,
                "changes": 52,
                "blob_url": "https://github.com/apache/tomcat/blob/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntry.java",
                "raw_url": "https://github.com/apache/tomcat/raw/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntry.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntry.java?ref=e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403",
                "patch": "@@ -1,52 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-public class Entry {\n-\n-    final String hour;\n-    String description;\n-\n-    public Entry(String hour) {\n-        this.hour = hour;\n-        this.description = \"\";\n-\n-    }\n-\n-    public String getHour() {\n-        return this.hour;\n-    }\n-\n-    public String getColor() {\n-        if (description.equals(\"\")) {\n-            return \"lightblue\";\n-        }\n-        return \"red\";\n-    }\n-\n-    public String getDescription() {\n-        if (description.equals(\"\")) {\n-            return \"None\";\n-        }\n-        return this.description;\n-    }\n-\n-    public void setDescription(String descr) {\n-        description = descr;\n-    }\n-\n-}"
            },
            {
                "sha": "29541cccb40008953ce3ef102b11da5be2079092",
                "filename": "webapps/examples/WEB-INF/classes/cal/JspCalendar.java",
                "status": "removed",
                "additions": 0,
                "deletions": 152,
                "changes": 152,
                "blob_url": "https://github.com/apache/tomcat/blob/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FJspCalendar.java",
                "raw_url": "https://github.com/apache/tomcat/raw/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FJspCalendar.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FJspCalendar.java?ref=e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403",
                "patch": "@@ -1,152 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-import java.util.Calendar;\n-import java.util.Date;\n-\n-public class JspCalendar {\n-    final Calendar  calendar;\n-\n-    public JspCalendar() {\n-        calendar = Calendar.getInstance();\n-        Date trialTime = new Date();\n-        calendar.setTime(trialTime);\n-    }\n-\n-\n-    public int getYear() {\n-        return calendar.get(Calendar.YEAR);\n-    }\n-\n-    public String getMonth() {\n-        int m = getMonthInt();\n-        String[] months = new String [] { \"January\", \"February\", \"March\",\n-                                        \"April\", \"May\", \"June\",\n-                                        \"July\", \"August\", \"September\",\n-                                        \"October\", \"November\", \"December\" };\n-        if (m > 12) {\n-            return \"Unknown to Man\";\n-        }\n-\n-        return months[m - 1];\n-\n-    }\n-\n-    public String getDay() {\n-        int x = getDayOfWeek();\n-        String[] days = new String[] {\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\",\n-                                      \"Thursday\", \"Friday\", \"Saturday\"};\n-\n-        if (x > 7) {\n-            return \"Unknown to Man\";\n-        }\n-\n-        return days[x - 1];\n-\n-    }\n-\n-    public int getMonthInt() {\n-        return 1 + calendar.get(Calendar.MONTH);\n-    }\n-\n-    public String getDate() {\n-        return getMonthInt() + \"/\" + getDayOfMonth() + \"/\" +  getYear();\n-    }\n-\n-    public String getCurrentDate() {\n-        Date dt = new Date ();\n-        calendar.setTime (dt);\n-        return getMonthInt() + \"/\" + getDayOfMonth() + \"/\" +  getYear();\n-\n-    }\n-\n-    public String getNextDate() {\n-        calendar.set (Calendar.DAY_OF_MONTH, getDayOfMonth() + 1);\n-        return getDate ();\n-    }\n-\n-    public String getPrevDate() {\n-        calendar.set (Calendar.DAY_OF_MONTH, getDayOfMonth() - 1);\n-        return getDate ();\n-    }\n-\n-    public String getTime() {\n-        return getHour() + \":\" + getMinute() + \":\" + getSecond();\n-    }\n-\n-    public int getDayOfMonth() {\n-        return calendar.get(Calendar.DAY_OF_MONTH);\n-    }\n-\n-    public int getDayOfYear() {\n-        return calendar.get(Calendar.DAY_OF_YEAR);\n-    }\n-\n-    public int getWeekOfYear() {\n-        return calendar.get(Calendar.WEEK_OF_YEAR);\n-    }\n-\n-    public int getWeekOfMonth() {\n-        return calendar.get(Calendar.WEEK_OF_MONTH);\n-    }\n-\n-    public int getDayOfWeek() {\n-        return calendar.get(Calendar.DAY_OF_WEEK);\n-    }\n-\n-    public int getHour() {\n-        return calendar.get(Calendar.HOUR_OF_DAY);\n-    }\n-\n-    public int getMinute() {\n-        return calendar.get(Calendar.MINUTE);\n-    }\n-\n-\n-    public int getSecond() {\n-        return calendar.get(Calendar.SECOND);\n-    }\n-\n-\n-    public int getEra() {\n-        return calendar.get(Calendar.ERA);\n-    }\n-\n-    public String getUSTimeZone() {\n-        String[] zones = new String[] {\"Hawaii\", \"Alaskan\", \"Pacific\",\n-                                       \"Mountain\", \"Central\", \"Eastern\"};\n-\n-        return zones[10 + getZoneOffset()];\n-    }\n-\n-    public int getZoneOffset() {\n-        return calendar.get(Calendar.ZONE_OFFSET)/(60*60*1000);\n-    }\n-\n-\n-    public int getDSTOffset() {\n-        return calendar.get(Calendar.DST_OFFSET)/(60*60*1000);\n-    }\n-\n-\n-    public int getAMPM() {\n-        return calendar.get(Calendar.AM_PM);\n-    }\n-}\n-\n-"
            },
            {
                "sha": "9f1cc4a6cf7d2a6e1a247242d7792cb465cd1b56",
                "filename": "webapps/examples/WEB-INF/classes/cal/TableBean.java",
                "status": "removed",
                "additions": 0,
                "deletions": 106,
                "changes": 106,
                "blob_url": "https://github.com/apache/tomcat/blob/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FTableBean.java",
                "raw_url": "https://github.com/apache/tomcat/raw/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FTableBean.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FTableBean.java?ref=e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403",
                "patch": "@@ -1,106 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n-\n-import javax.servlet.http.HttpServletRequest;\n-\n-public class TableBean {\n-\n-    private final Map<String, Entries> table;\n-    private final JspCalendar JspCal;\n-    private Entries entries;\n-    private String date;\n-    private String name = null;\n-    private String email = null;\n-    private boolean processError = false;\n-\n-    public TableBean() {\n-        this.table = new ConcurrentHashMap<>(10);\n-        this.JspCal = new JspCalendar();\n-        this.date = JspCal.getCurrentDate();\n-    }\n-\n-    public void setName(String nm) {\n-        this.name = nm;\n-    }\n-\n-    public String getName() {\n-        return this.name;\n-    }\n-\n-    public void setEmail(String mail) {\n-        this.email = mail;\n-    }\n-\n-    public String getEmail() {\n-        return this.email;\n-    }\n-\n-    public String getDate() {\n-        return this.date;\n-    }\n-\n-    public Entries getEntries() {\n-        return this.entries;\n-    }\n-\n-    public void processRequest(HttpServletRequest request) {\n-\n-        // Get the name and e-mail.\n-        this.processError = false;\n-        if (name == null || name.equals(\"\")) {\n-            setName(request.getParameter(\"name\"));\n-        }\n-        if (email == null || email.equals(\"\")) {\n-            setEmail(request.getParameter(\"email\"));\n-        }\n-        if (name == null || email == null || name.equals(\"\")\n-                || email.equals(\"\")) {\n-            this.processError = true;\n-            return;\n-        }\n-\n-        // Get the date.\n-        String dateR = request.getParameter(\"date\");\n-        if (dateR == null) {\n-            date = JspCal.getCurrentDate();\n-        } else if (dateR.equalsIgnoreCase(\"next\")) {\n-            date = JspCal.getNextDate();\n-        } else if (dateR.equalsIgnoreCase(\"prev\")) {\n-            date = JspCal.getPrevDate();\n-        }\n-\n-        entries = table.get(date);\n-        if (entries == null) {\n-            entries = new Entries();\n-            table.put(date, entries);\n-        }\n-\n-        // If time is provided add the event.\n-        String time = request.getParameter(\"time\");\n-        if (time != null) {\n-            entries.processRequest(request, time);\n-        }\n-    }\n-\n-    public boolean getProcessError() {\n-        return this.processError;\n-    }\n-}"
            },
            {
                "sha": "ce29c13f9608d9521d4f148ecb15f73dd3e3c997",
                "filename": "webapps/examples/jsp/cal/cal1.jsp",
                "status": "removed",
                "additions": 0,
                "deletions": 94,
                "changes": 94,
                "blob_url": "https://github.com/apache/tomcat/blob/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal1.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal1.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal1.jsp?ref=e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403",
                "patch": "@@ -1,94 +0,0 @@\n-<%--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n---%>\n-<%@page contentType=\"text/html; charset=UTF-8\" %>\n-<HTML>\n-<HEAD><TITLE>\n-    Calendar: A JSP APPLICATION\n-</TITLE></HEAD>\n-\n-\n-<BODY BGCOLOR=\"white\">\n-\n-<%@ page language=\"java\" import=\"cal.*\" %>\n-<jsp:useBean id=\"table\" scope=\"session\" class=\"cal.TableBean\" />\n-\n-<%\n-    table.processRequest(request);\n-    if (table.getProcessError() == false) {\n-%>\n-\n-<!-- HTML table goes here -->\n-<CENTER>\n-<TABLE WIDTH=60% BGCOLOR=yellow CELLPADDING=15>\n-<TR>\n-<TD ALIGN=CENTER> <A HREF=cal1.jsp?date=prev> prev </A>\n-<TD ALIGN=CENTER> Calendar:<%= table.getDate() %></TD>\n-<TD ALIGN=CENTER> <A HREF=cal1.jsp?date=next> next </A>\n-</TR>\n-</TABLE>\n-\n-<!-- the main table -->\n-<TABLE WIDTH=60% BGCOLOR=lightblue BORDER=1 CELLPADDING=10>\n-<TR>\n-<TH> Time </TH>\n-<TH> Appointment </TH>\n-</TR>\n-<FORM METHOD=POST ACTION=cal1.jsp>\n-<%\n-    for(int i=0; i<table.getEntries().getRows(); i++) {\n-       cal.Entry entr = table.getEntries().getEntry(i);\n-%>\n-    <TR>\n-    <TD>\n-    <A HREF=cal2.jsp?time=<%= entr.getHour() %>>\n-        <%= entr.getHour() %> </A>\n-    </TD>\n-    <TD BGCOLOR=<%= entr.getColor() %>>\n-    <% out.print(util.HTMLFilter.filter(entr.getDescription())); %>\n-    </TD>\n-    </TR>\n-<%\n-    }\n-%>\n-</FORM>\n-</TABLE>\n-<BR>\n-\n-<!-- footer -->\n-<TABLE WIDTH=60% BGCOLOR=yellow CELLPADDING=15>\n-<TR>\n-<TD ALIGN=CENTER>  <% out.print(util.HTMLFilter.filter(table.getName())); %> :\n-             <% out.print(util.HTMLFilter.filter(table.getEmail())); %> </TD>\n-</TR>\n-</TABLE>\n-</CENTER>\n-\n-<%\n-    } else {\n-%>\n-<font size=5>\n-    You must enter your name and email address correctly.\n-</font>\n-<%\n-    }\n-%>\n-\n-\n-</BODY>\n-</HTML>\n-\n-"
            },
            {
                "sha": "e7e14d8e0468825cc23b95a8c332c8990acfd873",
                "filename": "webapps/examples/jsp/cal/cal2.jsp",
                "status": "removed",
                "additions": 0,
                "deletions": 45,
                "changes": 45,
                "blob_url": "https://github.com/apache/tomcat/blob/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal2.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal2.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal2.jsp?ref=e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403",
                "patch": "@@ -1,45 +0,0 @@\n-<%--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n---%>\n-<%@page contentType=\"text/html; charset=UTF-8\" %>\n-<HTML>\n-<HEAD><TITLE>\n-    Calendar: A JSP APPLICATION\n-</TITLE></HEAD>\n-\n-\n-<BODY BGCOLOR=\"white\">\n-<jsp:useBean id=\"table\" scope=\"session\" class=\"cal.TableBean\" />\n-\n-<%\n-    String time = request.getParameter (\"time\");\n-%>\n-\n-<FONT SIZE=5> Please add the following event:\n-<BR> <h3> Date <%= table.getDate() %>\n-<BR> Time <%= util.HTMLFilter.filter(time) %> </h3>\n-</FONT>\n-<FORM METHOD=POST ACTION=cal1.jsp>\n-<BR>\n-<BR> <INPUT NAME=\"date\" TYPE=HIDDEN VALUE=\"current\">\n-<BR> <INPUT NAME=\"time\" TYPE=HIDDEN VALUE=\"<%= util.HTMLFilter.filter(time) %>\">\n-<BR> <h2> Description of the event <INPUT NAME=\"description\" TYPE=TEXT SIZE=20> </h2>\n-<BR> <INPUT TYPE=SUBMIT VALUE=\"submit\">\n-</FORM>\n-\n-</BODY>\n-</HTML>\n-"
            },
            {
                "sha": "a0a3ea1841341fbd612d633dc5bed3f0171b1c36",
                "filename": "webapps/examples/jsp/cal/calendar.html",
                "status": "removed",
                "additions": 0,
                "deletions": 43,
                "changes": 43,
                "blob_url": "https://github.com/apache/tomcat/blob/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2Fjsp%2Fcal%2Fcalendar.html",
                "raw_url": "https://github.com/apache/tomcat/raw/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2Fjsp%2Fcal%2Fcalendar.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Fcalendar.html?ref=e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403",
                "patch": "@@ -1,43 +0,0 @@\n-<html>\n-<!--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<head>\n-<title>Untitled Document</title>\n-<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\n-</head>\n-\n-<body bgcolor=\"#FFFFFF\">\n-<p><font color=\"#0000FF\"><a href=\"login.html\"><img src=\"../images/execute.gif\" align=\"right\" border=\"0\"></a><a href=\"../index.html\"><img src=\"../images/return.gif\" width=\"24\" height=\"24\" align=\"right\" border=\"0\"></a></font></p>\n-\n-<h2> Source Code for Calendar Example. <br>\n-<h3><a href=\"cal1.jsp.html\">cal1.jsp<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-<h3><a href=\"cal2.jsp.html\">cal2.jsp<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-\n-<br>\n-<h2> Beans.\n-<h3><a href=\"TableBean.java.html\">TableBean<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-<h3><a href=\"Entries.java.html\">Entries<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-<h3><a href=\"Entry.java.html\">Entry<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-\n-</body>\n-</html>"
            },
            {
                "sha": "8a62eca07b4ddf67fc130ef410fd7fa04faf366f",
                "filename": "webapps/examples/jsp/cal/login.html",
                "status": "removed",
                "additions": 0,
                "deletions": 47,
                "changes": 47,
                "blob_url": "https://github.com/apache/tomcat/blob/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2Fjsp%2Fcal%2Flogin.html",
                "raw_url": "https://github.com/apache/tomcat/raw/e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403/webapps%2Fexamples%2Fjsp%2Fcal%2Flogin.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Flogin.html?ref=e9c725c90e3e8e9b04d17ce5e9af6bf5ec341403",
                "patch": "@@ -1,47 +0,0 @@\n-<html>\n-<!--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<head>\n-    <title> Login page for the calendar. </title>\n-</head>\n-\n-<body bgcolor=\"white\">\n-<center>\n-\n-    <font size=7 color=\"red\"> Please Enter the following information: </font>\n-\n-<br>\n-    <form method=GET action=cal1.jsp>\n-\n-        <font size=5> Name <input type=text name=\"name\" size=20>\n-        </font>\n-        <br>\n-        <font size=5> Email <input type=text name=\"email\" size=20>\n-        </font>\n-        <br>\n-        <input type=submit name=action value=\"Submit\">\n-\n-    </form>\n-<hr>\n-<font size=3 color=\"red\"> Note: This application does not implement the complete\n-functionality of a typical calendar application. It demonstrates a way JSP can\n-be used with HTML tables and forms.</font>\n-\n-</center>\n-</body>\n-</html>"
            },
            {
                "sha": "ed2da43b9a126f6ba5d79e0af9ac66d0561043c2",
                "filename": "webapps/examples/jsp/index.html",
                "status": "modified",
                "additions": 0,
                "deletions": 8,
                "changes": 8,
                "blob_url": "https://github.com/apache/tomcat/blob/84c4af76e7a10fc7f8630ce62e6a46632ea4a90e/webapps%2Fexamples%2Fjsp%2Findex.html",
                "raw_url": "https://github.com/apache/tomcat/raw/84c4af76e7a10fc7f8630ce62e6a46632ea4a90e/webapps%2Fexamples%2Fjsp%2Findex.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Findex.html?ref=84c4af76e7a10fc7f8630ce62e6a46632ea4a90e",
                "patch": "@@ -249,14 +249,6 @@ <h2>JSP 1.2 Examples</h2>\n <td style=\"width: 30%;\"><a href=\"colors/clr.html\"><img src=\"images/code.gif\" alt=\"\"></a><a href=\"colors/clr.html\">Source</a></td>\n </tr>\n \n-<tr>\n-<td>Calendar</td>\n-\n-<td style=\"width: 30%;\"><a href=\"cal/login.html\"><img src=\"images/execute.gif\" alt=\"\"></a><a href=\"cal/login.html\">Execute</a></td>\n-\n-<td style=\"width: 30%;\"><a href=\"cal/calendar.html\"><img src=\"images/code.gif\" alt=\"\"></a><a href=\"cal/calendar.html\">Source</a></td>\n-</tr>\n-\n <tr>\n <td>Include</td>\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/721544ea28e92549824b106be954a9f411867a1c",
        "url": "https://api.github.com/repos/apache/tomcat/commits/721544ea28e92549824b106be954a9f411867a1c",
        "html_url": "https://github.com/apache/tomcat/commit/721544ea28e92549824b106be954a9f411867a1c",
        "message": "Add the ability to delete session attributes.",
        "files": [
            {
                "sha": "8d3b6900f6fbdfb98f4c9049d5c01b535dc449d5",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/721544ea28e92549824b106be954a9f411867a1c/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/721544ea28e92549824b106be954a9f411867a1c/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=721544ea28e92549824b106be954a9f411867a1c",
                "patch": "@@ -250,6 +250,10 @@\n         Examples. Expand the obfuscation of session cookie values in the request\n         header example to JSON responses. (markt)\n       </fix>\n+      <add>\n+        Examples. Add the ability to delete session attributes in the servlet\n+        session example. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "b3de2f8669561ede676b2034362b71055e3acc87",
                "filename": "webapps/examples/WEB-INF/classes/SessionExample.java",
                "status": "modified",
                "additions": 11,
                "deletions": 3,
                "changes": 14,
                "blob_url": "https://github.com/apache/tomcat/blob/721544ea28e92549824b106be954a9f411867a1c/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/721544ea28e92549824b106be954a9f411867a1c/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java?ref=721544ea28e92549824b106be954a9f411867a1c",
                "patch": "@@ -1,3 +1,4 @@\n+\n /*\n  * Licensed to the Apache Software Foundation (ASF) under one or more\n  * contributor license agreements.  See the NOTICE file distributed with\n@@ -16,6 +17,8 @@\n  */\n import java.io.IOException;\n import java.io.PrintWriter;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n import java.util.Date;\n import java.util.Enumeration;\n import java.util.ResourceBundle;\n@@ -75,7 +78,7 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n \n         String dataName = request.getParameter(\"dataname\");\n         String dataValue = request.getParameter(\"datavalue\");\n-        if (dataName != null && dataValue != null) {\n+        if (dataName != null) {\n             session.setAttribute(dataName, dataValue);\n         }\n \n@@ -85,7 +88,12 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n         while (names.hasMoreElements()) {\n             String name = names.nextElement();\n             String value = session.getAttribute(name).toString();\n-            out.println(HTMLFilter.filter(name) + \" = \" + HTMLFilter.filter(value) + \"<br>\");\n+            out.println(HTMLFilter.filter(name) + \" = \" + HTMLFilter.filter(value));\n+            out.print(\"<a href=\\\"\");\n+            out.print(HTMLFilter.filter(\n+                    response.encodeURL(\"SessionExample?dataname=\" + URLEncoder.encode(name, StandardCharsets.UTF_8))));\n+            out.println(\"\\\" >delete</a>\");\n+            out.println(\"<br>\");\n         }\n \n         out.println(\"<P>\");\n@@ -117,7 +125,7 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n         out.println(\"</form>\");\n \n         out.print(\"<p><a href=\\\"\");\n-        out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=foo&datavalue=bar\")));\n+        out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=exampleName&datavalue=exampleValue\")));\n         out.println(\"\\\" >URL encoded </a>\");\n \n         out.println(\"</body>\");"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/cb1707685472994e9d924746f8c91cb116fa5213",
        "url": "https://api.github.com/repos/apache/tomcat/commits/cb1707685472994e9d924746f8c91cb116fa5213",
        "html_url": "https://github.com/apache/tomcat/commit/cb1707685472994e9d924746f8c91cb116fa5213",
        "message": "Revert change made for testing",
        "files": [
            {
                "sha": "86f0ed0e29bf604afcd6681434caef08185f01b0",
                "filename": "webapps/examples/WEB-INF/classes/RequestHeaderExample.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/cb1707685472994e9d924746f8c91cb116fa5213/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/cb1707685472994e9d924746f8c91cb116fa5213/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java?ref=cb1707685472994e9d924746f8c91cb116fa5213",
                "patch": "@@ -73,7 +73,7 @@ protected boolean prefersJSON(String acceptHeader) {\n \n             // text/html, application/html, etc.\n             if (accept.contains(\"html\")) {\n-                return true;\n+                return false;\n             }\n         }\n         return false;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/54e56495e9a106218efe9fc9c79d976c0032bbfd",
        "url": "https://api.github.com/repos/apache/tomcat/commits/54e56495e9a106218efe9fc9c79d976c0032bbfd",
        "html_url": "https://github.com/apache/tomcat/commit/54e56495e9a106218efe9fc9c79d976c0032bbfd",
        "message": "Remove JSP calendar example.",
        "files": [
            {
                "sha": "2490a0b7376ab56fb165b03a70c59b4549903be0",
                "filename": "build.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/apache/tomcat/blob/54e56495e9a106218efe9fc9c79d976c0032bbfd/build.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/54e56495e9a106218efe9fc9c79d976c0032bbfd/build.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/build.xml?ref=54e56495e9a106218efe9fc9c79d976c0032bbfd",
                "patch": "@@ -1675,15 +1675,6 @@\n       </fileset>\n     </txt2html>\n \n-    <txt2html todir=\"${tomcat.build}/webapps/examples/jsp/cal\">\n-      <fileset dir=\"webapps/examples/WEB-INF/classes/cal\">\n-        <include name=\"Entries.java\"/>\n-        <include name=\"Entry.java\"/>\n-        <include name=\"JspCalendar.java\"/>\n-        <include name=\"TableBean.java\"/>\n-      </fileset>\n-    </txt2html>\n-\n     <txt2html todir=\"${tomcat.build}/webapps/examples/jsp/jsptoserv\">\n       <fileset dir=\"webapps/examples/WEB-INF/classes\">\n         <include name=\"ServletToJsp.java\"/>"
            },
            {
                "sha": "ac65b90c5ac0624b671b916b1ed48fa30e909aa5",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/tomcat/blob/54e56495e9a106218efe9fc9c79d976c0032bbfd/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/54e56495e9a106218efe9fc9c79d976c0032bbfd/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=54e56495e9a106218efe9fc9c79d976c0032bbfd",
                "patch": "@@ -282,6 +282,9 @@\n         Examples. Limit the shopping cart example to only allow adding the\n         pre-defined items to the cart. (markt)\n       </add>\n+      <fix>\n+        Examples. Remove JSP calendar example. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "5c6cd498889cf2c1d682ea48af0476501b70e855",
                "filename": "webapps/examples/WEB-INF/classes/cal/Entries.java",
                "status": "removed",
                "additions": 0,
                "deletions": 63,
                "changes": 63,
                "blob_url": "https://github.com/apache/tomcat/blob/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntries.java",
                "raw_url": "https://github.com/apache/tomcat/raw/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntries.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntries.java?ref=89386a29dd878c79fc3b3d1b65e8796c9da80b01",
                "patch": "@@ -1,63 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n-\n-import jakarta.servlet.http.HttpServletRequest;\n-\n-public class Entries {\n-\n-    private final Map<String, Entry> entries;\n-    private static final String[] time = { \"8am\", \"9am\", \"10am\", \"11am\",\n-            \"12pm\", \"1pm\", \"2pm\", \"3pm\", \"4pm\", \"5pm\", \"6pm\", \"7pm\", \"8pm\" };\n-    public static final int rows = 12;\n-\n-    public Entries() {\n-        entries = new ConcurrentHashMap<>(rows);\n-        for (int i = 0; i < rows; i++) {\n-            entries.put(time[i], new Entry(time[i]));\n-        }\n-    }\n-\n-    public int getRows() {\n-        return rows;\n-    }\n-\n-    public Entry getEntry(int index) {\n-        return this.entries.get(time[index]);\n-    }\n-\n-    public int getIndex(String tm) {\n-        for (int i = 0; i < rows; i++) {\n-            if (tm.equals(time[i])) {\n-                return i;\n-            }\n-        }\n-        return -1;\n-    }\n-\n-    public void processRequest(HttpServletRequest request, String tm) {\n-        int index = getIndex(tm);\n-        if (index >= 0) {\n-            String descr = request.getParameter(\"description\");\n-            entries.get(time[index]).setDescription(descr);\n-        }\n-    }\n-\n-}"
            },
            {
                "sha": "ac248bfa316957f5e2917690466268d5aa6bba2b",
                "filename": "webapps/examples/WEB-INF/classes/cal/Entry.java",
                "status": "removed",
                "additions": 0,
                "deletions": 52,
                "changes": 52,
                "blob_url": "https://github.com/apache/tomcat/blob/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntry.java",
                "raw_url": "https://github.com/apache/tomcat/raw/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntry.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntry.java?ref=89386a29dd878c79fc3b3d1b65e8796c9da80b01",
                "patch": "@@ -1,52 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-public class Entry {\n-\n-    final String hour;\n-    String description;\n-\n-    public Entry(String hour) {\n-        this.hour = hour;\n-        this.description = \"\";\n-\n-    }\n-\n-    public String getHour() {\n-        return this.hour;\n-    }\n-\n-    public String getColor() {\n-        if (description.equals(\"\")) {\n-            return \"lightblue\";\n-        }\n-        return \"red\";\n-    }\n-\n-    public String getDescription() {\n-        if (description.equals(\"\")) {\n-            return \"None\";\n-        }\n-        return this.description;\n-    }\n-\n-    public void setDescription(String descr) {\n-        description = descr;\n-    }\n-\n-}"
            },
            {
                "sha": "29541cccb40008953ce3ef102b11da5be2079092",
                "filename": "webapps/examples/WEB-INF/classes/cal/JspCalendar.java",
                "status": "removed",
                "additions": 0,
                "deletions": 152,
                "changes": 152,
                "blob_url": "https://github.com/apache/tomcat/blob/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FJspCalendar.java",
                "raw_url": "https://github.com/apache/tomcat/raw/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FJspCalendar.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FJspCalendar.java?ref=89386a29dd878c79fc3b3d1b65e8796c9da80b01",
                "patch": "@@ -1,152 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-import java.util.Calendar;\n-import java.util.Date;\n-\n-public class JspCalendar {\n-    final Calendar  calendar;\n-\n-    public JspCalendar() {\n-        calendar = Calendar.getInstance();\n-        Date trialTime = new Date();\n-        calendar.setTime(trialTime);\n-    }\n-\n-\n-    public int getYear() {\n-        return calendar.get(Calendar.YEAR);\n-    }\n-\n-    public String getMonth() {\n-        int m = getMonthInt();\n-        String[] months = new String [] { \"January\", \"February\", \"March\",\n-                                        \"April\", \"May\", \"June\",\n-                                        \"July\", \"August\", \"September\",\n-                                        \"October\", \"November\", \"December\" };\n-        if (m > 12) {\n-            return \"Unknown to Man\";\n-        }\n-\n-        return months[m - 1];\n-\n-    }\n-\n-    public String getDay() {\n-        int x = getDayOfWeek();\n-        String[] days = new String[] {\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\",\n-                                      \"Thursday\", \"Friday\", \"Saturday\"};\n-\n-        if (x > 7) {\n-            return \"Unknown to Man\";\n-        }\n-\n-        return days[x - 1];\n-\n-    }\n-\n-    public int getMonthInt() {\n-        return 1 + calendar.get(Calendar.MONTH);\n-    }\n-\n-    public String getDate() {\n-        return getMonthInt() + \"/\" + getDayOfMonth() + \"/\" +  getYear();\n-    }\n-\n-    public String getCurrentDate() {\n-        Date dt = new Date ();\n-        calendar.setTime (dt);\n-        return getMonthInt() + \"/\" + getDayOfMonth() + \"/\" +  getYear();\n-\n-    }\n-\n-    public String getNextDate() {\n-        calendar.set (Calendar.DAY_OF_MONTH, getDayOfMonth() + 1);\n-        return getDate ();\n-    }\n-\n-    public String getPrevDate() {\n-        calendar.set (Calendar.DAY_OF_MONTH, getDayOfMonth() - 1);\n-        return getDate ();\n-    }\n-\n-    public String getTime() {\n-        return getHour() + \":\" + getMinute() + \":\" + getSecond();\n-    }\n-\n-    public int getDayOfMonth() {\n-        return calendar.get(Calendar.DAY_OF_MONTH);\n-    }\n-\n-    public int getDayOfYear() {\n-        return calendar.get(Calendar.DAY_OF_YEAR);\n-    }\n-\n-    public int getWeekOfYear() {\n-        return calendar.get(Calendar.WEEK_OF_YEAR);\n-    }\n-\n-    public int getWeekOfMonth() {\n-        return calendar.get(Calendar.WEEK_OF_MONTH);\n-    }\n-\n-    public int getDayOfWeek() {\n-        return calendar.get(Calendar.DAY_OF_WEEK);\n-    }\n-\n-    public int getHour() {\n-        return calendar.get(Calendar.HOUR_OF_DAY);\n-    }\n-\n-    public int getMinute() {\n-        return calendar.get(Calendar.MINUTE);\n-    }\n-\n-\n-    public int getSecond() {\n-        return calendar.get(Calendar.SECOND);\n-    }\n-\n-\n-    public int getEra() {\n-        return calendar.get(Calendar.ERA);\n-    }\n-\n-    public String getUSTimeZone() {\n-        String[] zones = new String[] {\"Hawaii\", \"Alaskan\", \"Pacific\",\n-                                       \"Mountain\", \"Central\", \"Eastern\"};\n-\n-        return zones[10 + getZoneOffset()];\n-    }\n-\n-    public int getZoneOffset() {\n-        return calendar.get(Calendar.ZONE_OFFSET)/(60*60*1000);\n-    }\n-\n-\n-    public int getDSTOffset() {\n-        return calendar.get(Calendar.DST_OFFSET)/(60*60*1000);\n-    }\n-\n-\n-    public int getAMPM() {\n-        return calendar.get(Calendar.AM_PM);\n-    }\n-}\n-\n-"
            },
            {
                "sha": "e7821257cf5942641da9b42d91ea55e0904a72f1",
                "filename": "webapps/examples/WEB-INF/classes/cal/TableBean.java",
                "status": "removed",
                "additions": 0,
                "deletions": 106,
                "changes": 106,
                "blob_url": "https://github.com/apache/tomcat/blob/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FTableBean.java",
                "raw_url": "https://github.com/apache/tomcat/raw/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FTableBean.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FTableBean.java?ref=89386a29dd878c79fc3b3d1b65e8796c9da80b01",
                "patch": "@@ -1,106 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n-\n-import jakarta.servlet.http.HttpServletRequest;\n-\n-public class TableBean {\n-\n-    private final Map<String, Entries> table;\n-    private final JspCalendar JspCal;\n-    private Entries entries;\n-    private String date;\n-    private String name = null;\n-    private String email = null;\n-    private boolean processError = false;\n-\n-    public TableBean() {\n-        this.table = new ConcurrentHashMap<>(10);\n-        this.JspCal = new JspCalendar();\n-        this.date = JspCal.getCurrentDate();\n-    }\n-\n-    public void setName(String nm) {\n-        this.name = nm;\n-    }\n-\n-    public String getName() {\n-        return this.name;\n-    }\n-\n-    public void setEmail(String mail) {\n-        this.email = mail;\n-    }\n-\n-    public String getEmail() {\n-        return this.email;\n-    }\n-\n-    public String getDate() {\n-        return this.date;\n-    }\n-\n-    public Entries getEntries() {\n-        return this.entries;\n-    }\n-\n-    public void processRequest(HttpServletRequest request) {\n-\n-        // Get the name and e-mail.\n-        this.processError = false;\n-        if (name == null || name.equals(\"\")) {\n-            setName(request.getParameter(\"name\"));\n-        }\n-        if (email == null || email.equals(\"\")) {\n-            setEmail(request.getParameter(\"email\"));\n-        }\n-        if (name == null || email == null || name.equals(\"\")\n-                || email.equals(\"\")) {\n-            this.processError = true;\n-            return;\n-        }\n-\n-        // Get the date.\n-        String dateR = request.getParameter(\"date\");\n-        if (dateR == null) {\n-            date = JspCal.getCurrentDate();\n-        } else if (dateR.equalsIgnoreCase(\"next\")) {\n-            date = JspCal.getNextDate();\n-        } else if (dateR.equalsIgnoreCase(\"prev\")) {\n-            date = JspCal.getPrevDate();\n-        }\n-\n-        entries = table.get(date);\n-        if (entries == null) {\n-            entries = new Entries();\n-            table.put(date, entries);\n-        }\n-\n-        // If time is provided add the event.\n-        String time = request.getParameter(\"time\");\n-        if (time != null) {\n-            entries.processRequest(request, time);\n-        }\n-    }\n-\n-    public boolean getProcessError() {\n-        return this.processError;\n-    }\n-}"
            },
            {
                "sha": "ce29c13f9608d9521d4f148ecb15f73dd3e3c997",
                "filename": "webapps/examples/jsp/cal/cal1.jsp",
                "status": "removed",
                "additions": 0,
                "deletions": 94,
                "changes": 94,
                "blob_url": "https://github.com/apache/tomcat/blob/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal1.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal1.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal1.jsp?ref=89386a29dd878c79fc3b3d1b65e8796c9da80b01",
                "patch": "@@ -1,94 +0,0 @@\n-<%--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n---%>\n-<%@page contentType=\"text/html; charset=UTF-8\" %>\n-<HTML>\n-<HEAD><TITLE>\n-    Calendar: A JSP APPLICATION\n-</TITLE></HEAD>\n-\n-\n-<BODY BGCOLOR=\"white\">\n-\n-<%@ page language=\"java\" import=\"cal.*\" %>\n-<jsp:useBean id=\"table\" scope=\"session\" class=\"cal.TableBean\" />\n-\n-<%\n-    table.processRequest(request);\n-    if (table.getProcessError() == false) {\n-%>\n-\n-<!-- HTML table goes here -->\n-<CENTER>\n-<TABLE WIDTH=60% BGCOLOR=yellow CELLPADDING=15>\n-<TR>\n-<TD ALIGN=CENTER> <A HREF=cal1.jsp?date=prev> prev </A>\n-<TD ALIGN=CENTER> Calendar:<%= table.getDate() %></TD>\n-<TD ALIGN=CENTER> <A HREF=cal1.jsp?date=next> next </A>\n-</TR>\n-</TABLE>\n-\n-<!-- the main table -->\n-<TABLE WIDTH=60% BGCOLOR=lightblue BORDER=1 CELLPADDING=10>\n-<TR>\n-<TH> Time </TH>\n-<TH> Appointment </TH>\n-</TR>\n-<FORM METHOD=POST ACTION=cal1.jsp>\n-<%\n-    for(int i=0; i<table.getEntries().getRows(); i++) {\n-       cal.Entry entr = table.getEntries().getEntry(i);\n-%>\n-    <TR>\n-    <TD>\n-    <A HREF=cal2.jsp?time=<%= entr.getHour() %>>\n-        <%= entr.getHour() %> </A>\n-    </TD>\n-    <TD BGCOLOR=<%= entr.getColor() %>>\n-    <% out.print(util.HTMLFilter.filter(entr.getDescription())); %>\n-    </TD>\n-    </TR>\n-<%\n-    }\n-%>\n-</FORM>\n-</TABLE>\n-<BR>\n-\n-<!-- footer -->\n-<TABLE WIDTH=60% BGCOLOR=yellow CELLPADDING=15>\n-<TR>\n-<TD ALIGN=CENTER>  <% out.print(util.HTMLFilter.filter(table.getName())); %> :\n-             <% out.print(util.HTMLFilter.filter(table.getEmail())); %> </TD>\n-</TR>\n-</TABLE>\n-</CENTER>\n-\n-<%\n-    } else {\n-%>\n-<font size=5>\n-    You must enter your name and email address correctly.\n-</font>\n-<%\n-    }\n-%>\n-\n-\n-</BODY>\n-</HTML>\n-\n-"
            },
            {
                "sha": "e7e14d8e0468825cc23b95a8c332c8990acfd873",
                "filename": "webapps/examples/jsp/cal/cal2.jsp",
                "status": "removed",
                "additions": 0,
                "deletions": 45,
                "changes": 45,
                "blob_url": "https://github.com/apache/tomcat/blob/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal2.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal2.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal2.jsp?ref=89386a29dd878c79fc3b3d1b65e8796c9da80b01",
                "patch": "@@ -1,45 +0,0 @@\n-<%--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n---%>\n-<%@page contentType=\"text/html; charset=UTF-8\" %>\n-<HTML>\n-<HEAD><TITLE>\n-    Calendar: A JSP APPLICATION\n-</TITLE></HEAD>\n-\n-\n-<BODY BGCOLOR=\"white\">\n-<jsp:useBean id=\"table\" scope=\"session\" class=\"cal.TableBean\" />\n-\n-<%\n-    String time = request.getParameter (\"time\");\n-%>\n-\n-<FONT SIZE=5> Please add the following event:\n-<BR> <h3> Date <%= table.getDate() %>\n-<BR> Time <%= util.HTMLFilter.filter(time) %> </h3>\n-</FONT>\n-<FORM METHOD=POST ACTION=cal1.jsp>\n-<BR>\n-<BR> <INPUT NAME=\"date\" TYPE=HIDDEN VALUE=\"current\">\n-<BR> <INPUT NAME=\"time\" TYPE=HIDDEN VALUE=\"<%= util.HTMLFilter.filter(time) %>\">\n-<BR> <h2> Description of the event <INPUT NAME=\"description\" TYPE=TEXT SIZE=20> </h2>\n-<BR> <INPUT TYPE=SUBMIT VALUE=\"submit\">\n-</FORM>\n-\n-</BODY>\n-</HTML>\n-"
            },
            {
                "sha": "a0a3ea1841341fbd612d633dc5bed3f0171b1c36",
                "filename": "webapps/examples/jsp/cal/calendar.html",
                "status": "removed",
                "additions": 0,
                "deletions": 43,
                "changes": 43,
                "blob_url": "https://github.com/apache/tomcat/blob/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2Fjsp%2Fcal%2Fcalendar.html",
                "raw_url": "https://github.com/apache/tomcat/raw/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2Fjsp%2Fcal%2Fcalendar.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Fcalendar.html?ref=89386a29dd878c79fc3b3d1b65e8796c9da80b01",
                "patch": "@@ -1,43 +0,0 @@\n-<html>\n-<!--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<head>\n-<title>Untitled Document</title>\n-<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\n-</head>\n-\n-<body bgcolor=\"#FFFFFF\">\n-<p><font color=\"#0000FF\"><a href=\"login.html\"><img src=\"../images/execute.gif\" align=\"right\" border=\"0\"></a><a href=\"../index.html\"><img src=\"../images/return.gif\" width=\"24\" height=\"24\" align=\"right\" border=\"0\"></a></font></p>\n-\n-<h2> Source Code for Calendar Example. <br>\n-<h3><a href=\"cal1.jsp.html\">cal1.jsp<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-<h3><a href=\"cal2.jsp.html\">cal2.jsp<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-\n-<br>\n-<h2> Beans.\n-<h3><a href=\"TableBean.java.html\">TableBean<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-<h3><a href=\"Entries.java.html\">Entries<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-<h3><a href=\"Entry.java.html\">Entry<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-\n-</body>\n-</html>"
            },
            {
                "sha": "8a62eca07b4ddf67fc130ef410fd7fa04faf366f",
                "filename": "webapps/examples/jsp/cal/login.html",
                "status": "removed",
                "additions": 0,
                "deletions": 47,
                "changes": 47,
                "blob_url": "https://github.com/apache/tomcat/blob/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2Fjsp%2Fcal%2Flogin.html",
                "raw_url": "https://github.com/apache/tomcat/raw/89386a29dd878c79fc3b3d1b65e8796c9da80b01/webapps%2Fexamples%2Fjsp%2Fcal%2Flogin.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Flogin.html?ref=89386a29dd878c79fc3b3d1b65e8796c9da80b01",
                "patch": "@@ -1,47 +0,0 @@\n-<html>\n-<!--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<head>\n-    <title> Login page for the calendar. </title>\n-</head>\n-\n-<body bgcolor=\"white\">\n-<center>\n-\n-    <font size=7 color=\"red\"> Please Enter the following information: </font>\n-\n-<br>\n-    <form method=GET action=cal1.jsp>\n-\n-        <font size=5> Name <input type=text name=\"name\" size=20>\n-        </font>\n-        <br>\n-        <font size=5> Email <input type=text name=\"email\" size=20>\n-        </font>\n-        <br>\n-        <input type=submit name=action value=\"Submit\">\n-\n-    </form>\n-<hr>\n-<font size=3 color=\"red\"> Note: This application does not implement the complete\n-functionality of a typical calendar application. It demonstrates a way JSP can\n-be used with HTML tables and forms.</font>\n-\n-</center>\n-</body>\n-</html>"
            },
            {
                "sha": "d8ef283629a4c6627e95f70fb81ab994e152216c",
                "filename": "webapps/examples/jsp/index.html",
                "status": "modified",
                "additions": 0,
                "deletions": 8,
                "changes": 8,
                "blob_url": "https://github.com/apache/tomcat/blob/54e56495e9a106218efe9fc9c79d976c0032bbfd/webapps%2Fexamples%2Fjsp%2Findex.html",
                "raw_url": "https://github.com/apache/tomcat/raw/54e56495e9a106218efe9fc9c79d976c0032bbfd/webapps%2Fexamples%2Fjsp%2Findex.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Findex.html?ref=54e56495e9a106218efe9fc9c79d976c0032bbfd",
                "patch": "@@ -249,14 +249,6 @@ <h2>JSP 1.2 Examples</h2>\n <td style=\"width: 30%;\"><a href=\"colors/clr.html\"><img src=\"images/code.gif\" alt=\"\"></a><a href=\"colors/clr.html\">Source</a></td>\n </tr>\n \n-<tr>\n-<td>Calendar</td>\n-\n-<td style=\"width: 30%;\"><a href=\"cal/login.html\"><img src=\"images/execute.gif\" alt=\"\"></a><a href=\"cal/login.html\">Execute</a></td>\n-\n-<td style=\"width: 30%;\"><a href=\"cal/calendar.html\"><img src=\"images/code.gif\" alt=\"\"></a><a href=\"cal/calendar.html\">Source</a></td>\n-</tr>\n-\n <tr>\n <td>Include</td>\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/f57a9d9847c1038be61f5818d73b8be907c460d4",
        "url": "https://api.github.com/repos/apache/tomcat/commits/f57a9d9847c1038be61f5818d73b8be907c460d4",
        "html_url": "https://github.com/apache/tomcat/commit/f57a9d9847c1038be61f5818d73b8be907c460d4",
        "message": "Obfuscate session cookie values for JSON output as well as HTML",
        "files": [
            {
                "sha": "87270a98434774d56bc955da63d83f6fe4aa564a",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/f57a9d9847c1038be61f5818d73b8be907c460d4/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/f57a9d9847c1038be61f5818d73b8be907c460d4/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=f57a9d9847c1038be61f5818d73b8be907c460d4",
                "patch": "@@ -246,6 +246,10 @@\n         Examples. Fix broken links when Servlet Request Info example is called\n         via a URL that includes a pathInfo component. (markt)\n       </fix>\n+      <fix>\n+        Examples. Expand the obfuscation of session cookie values in the request\n+        header example to JSON responses. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "db6e4b10c51f82d776bc87ad5c6a1858a4ed785e",
                "filename": "webapps/examples/WEB-INF/classes/RequestHeaderExample.java",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/apache/tomcat/blob/f57a9d9847c1038be61f5818d73b8be907c460d4/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/f57a9d9847c1038be61f5818d73b8be907c460d4/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java?ref=f57a9d9847c1038be61f5818d73b8be907c460d4",
                "patch": "@@ -73,7 +73,7 @@ protected boolean prefersJSON(String acceptHeader) {\n \n             // text/html, application/html, etc.\n             if (accept.contains(\"html\")) {\n-                return false;\n+                return true;\n             }\n         }\n         return false;\n@@ -138,8 +138,20 @@ protected void renderJSON(HttpServletRequest request, HttpServletResponse respon\n             String headerName = e.nextElement();\n             String headerValue = request.getHeader(headerName);\n \n-            out.append(\"{\\\"\").append(JSONFilter.escape(headerName)).append(\"\\\":\\\"\")\n-                    .append(JSONFilter.escape(headerValue)).append(\"\\\"}\");\n+            out.append(\"{\\\"\").append(JSONFilter.escape(headerName)).append(\"\\\":\\\"\");\n+\n+\n+            if (headerName.toLowerCase(Locale.ENGLISH).contains(\"cookie\")) {\n+                HttpSession session = request.getSession(false);\n+                String sessionId = null;\n+                if (session != null) {\n+                    sessionId = session.getId();\n+                }\n+                out.append(JSONFilter.escape(CookieFilter.filter(headerValue, sessionId)));\n+            } else {\n+                out.append(JSONFilter.escape(headerValue));\n+            }\n+            out.append(\"\\\"}\");\n \n             if (e.hasMoreElements()) {\n                 out.append(',');"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/722814668708c42a61b0c1e340b15bc2b785c0d1",
        "url": "https://api.github.com/repos/apache/tomcat/commits/722814668708c42a61b0c1e340b15bc2b785c0d1",
        "html_url": "https://github.com/apache/tomcat/commit/722814668708c42a61b0c1e340b15bc2b785c0d1",
        "message": "Remove JSP calendar example.",
        "files": [
            {
                "sha": "920c293bd9ebe98552092e6d7b9cc5ae4b5c929c",
                "filename": "build.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/apache/tomcat/blob/722814668708c42a61b0c1e340b15bc2b785c0d1/build.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/722814668708c42a61b0c1e340b15bc2b785c0d1/build.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/build.xml?ref=722814668708c42a61b0c1e340b15bc2b785c0d1",
                "patch": "@@ -1670,15 +1670,6 @@\n       </fileset>\n     </txt2html>\n \n-    <txt2html todir=\"${tomcat.build}/webapps/examples/jsp/cal\">\n-      <fileset dir=\"webapps/examples/WEB-INF/classes/cal\">\n-        <include name=\"Entries.java\"/>\n-        <include name=\"Entry.java\"/>\n-        <include name=\"JspCalendar.java\"/>\n-        <include name=\"TableBean.java\"/>\n-      </fileset>\n-    </txt2html>\n-\n     <txt2html todir=\"${tomcat.build}/webapps/examples/jsp/jsptoserv\">\n       <fileset dir=\"webapps/examples/WEB-INF/classes\">\n         <include name=\"ServletToJsp.java\"/>"
            },
            {
                "sha": "900ddb9317271eb3535262aa9e52c3f1889a864d",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/tomcat/blob/722814668708c42a61b0c1e340b15bc2b785c0d1/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/722814668708c42a61b0c1e340b15bc2b785c0d1/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=722814668708c42a61b0c1e340b15bc2b785c0d1",
                "patch": "@@ -292,6 +292,9 @@\n         Examples. Limit the shopping cart example to only allow adding the\n         pre-defined items to the cart. (markt)\n       </add>\n+      <fix>\n+        Examples. Remove JSP calendar example. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "5c6cd498889cf2c1d682ea48af0476501b70e855",
                "filename": "webapps/examples/WEB-INF/classes/cal/Entries.java",
                "status": "removed",
                "additions": 0,
                "deletions": 63,
                "changes": 63,
                "blob_url": "https://github.com/apache/tomcat/blob/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntries.java",
                "raw_url": "https://github.com/apache/tomcat/raw/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntries.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntries.java?ref=a40f368f9dd251e36f90058c9805580fa06afd97",
                "patch": "@@ -1,63 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n-\n-import jakarta.servlet.http.HttpServletRequest;\n-\n-public class Entries {\n-\n-    private final Map<String, Entry> entries;\n-    private static final String[] time = { \"8am\", \"9am\", \"10am\", \"11am\",\n-            \"12pm\", \"1pm\", \"2pm\", \"3pm\", \"4pm\", \"5pm\", \"6pm\", \"7pm\", \"8pm\" };\n-    public static final int rows = 12;\n-\n-    public Entries() {\n-        entries = new ConcurrentHashMap<>(rows);\n-        for (int i = 0; i < rows; i++) {\n-            entries.put(time[i], new Entry(time[i]));\n-        }\n-    }\n-\n-    public int getRows() {\n-        return rows;\n-    }\n-\n-    public Entry getEntry(int index) {\n-        return this.entries.get(time[index]);\n-    }\n-\n-    public int getIndex(String tm) {\n-        for (int i = 0; i < rows; i++) {\n-            if (tm.equals(time[i])) {\n-                return i;\n-            }\n-        }\n-        return -1;\n-    }\n-\n-    public void processRequest(HttpServletRequest request, String tm) {\n-        int index = getIndex(tm);\n-        if (index >= 0) {\n-            String descr = request.getParameter(\"description\");\n-            entries.get(time[index]).setDescription(descr);\n-        }\n-    }\n-\n-}"
            },
            {
                "sha": "ac248bfa316957f5e2917690466268d5aa6bba2b",
                "filename": "webapps/examples/WEB-INF/classes/cal/Entry.java",
                "status": "removed",
                "additions": 0,
                "deletions": 52,
                "changes": 52,
                "blob_url": "https://github.com/apache/tomcat/blob/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntry.java",
                "raw_url": "https://github.com/apache/tomcat/raw/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntry.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FEntry.java?ref=a40f368f9dd251e36f90058c9805580fa06afd97",
                "patch": "@@ -1,52 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-public class Entry {\n-\n-    final String hour;\n-    String description;\n-\n-    public Entry(String hour) {\n-        this.hour = hour;\n-        this.description = \"\";\n-\n-    }\n-\n-    public String getHour() {\n-        return this.hour;\n-    }\n-\n-    public String getColor() {\n-        if (description.equals(\"\")) {\n-            return \"lightblue\";\n-        }\n-        return \"red\";\n-    }\n-\n-    public String getDescription() {\n-        if (description.equals(\"\")) {\n-            return \"None\";\n-        }\n-        return this.description;\n-    }\n-\n-    public void setDescription(String descr) {\n-        description = descr;\n-    }\n-\n-}"
            },
            {
                "sha": "29541cccb40008953ce3ef102b11da5be2079092",
                "filename": "webapps/examples/WEB-INF/classes/cal/JspCalendar.java",
                "status": "removed",
                "additions": 0,
                "deletions": 152,
                "changes": 152,
                "blob_url": "https://github.com/apache/tomcat/blob/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FJspCalendar.java",
                "raw_url": "https://github.com/apache/tomcat/raw/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FJspCalendar.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FJspCalendar.java?ref=a40f368f9dd251e36f90058c9805580fa06afd97",
                "patch": "@@ -1,152 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-import java.util.Calendar;\n-import java.util.Date;\n-\n-public class JspCalendar {\n-    final Calendar  calendar;\n-\n-    public JspCalendar() {\n-        calendar = Calendar.getInstance();\n-        Date trialTime = new Date();\n-        calendar.setTime(trialTime);\n-    }\n-\n-\n-    public int getYear() {\n-        return calendar.get(Calendar.YEAR);\n-    }\n-\n-    public String getMonth() {\n-        int m = getMonthInt();\n-        String[] months = new String [] { \"January\", \"February\", \"March\",\n-                                        \"April\", \"May\", \"June\",\n-                                        \"July\", \"August\", \"September\",\n-                                        \"October\", \"November\", \"December\" };\n-        if (m > 12) {\n-            return \"Unknown to Man\";\n-        }\n-\n-        return months[m - 1];\n-\n-    }\n-\n-    public String getDay() {\n-        int x = getDayOfWeek();\n-        String[] days = new String[] {\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\",\n-                                      \"Thursday\", \"Friday\", \"Saturday\"};\n-\n-        if (x > 7) {\n-            return \"Unknown to Man\";\n-        }\n-\n-        return days[x - 1];\n-\n-    }\n-\n-    public int getMonthInt() {\n-        return 1 + calendar.get(Calendar.MONTH);\n-    }\n-\n-    public String getDate() {\n-        return getMonthInt() + \"/\" + getDayOfMonth() + \"/\" +  getYear();\n-    }\n-\n-    public String getCurrentDate() {\n-        Date dt = new Date ();\n-        calendar.setTime (dt);\n-        return getMonthInt() + \"/\" + getDayOfMonth() + \"/\" +  getYear();\n-\n-    }\n-\n-    public String getNextDate() {\n-        calendar.set (Calendar.DAY_OF_MONTH, getDayOfMonth() + 1);\n-        return getDate ();\n-    }\n-\n-    public String getPrevDate() {\n-        calendar.set (Calendar.DAY_OF_MONTH, getDayOfMonth() - 1);\n-        return getDate ();\n-    }\n-\n-    public String getTime() {\n-        return getHour() + \":\" + getMinute() + \":\" + getSecond();\n-    }\n-\n-    public int getDayOfMonth() {\n-        return calendar.get(Calendar.DAY_OF_MONTH);\n-    }\n-\n-    public int getDayOfYear() {\n-        return calendar.get(Calendar.DAY_OF_YEAR);\n-    }\n-\n-    public int getWeekOfYear() {\n-        return calendar.get(Calendar.WEEK_OF_YEAR);\n-    }\n-\n-    public int getWeekOfMonth() {\n-        return calendar.get(Calendar.WEEK_OF_MONTH);\n-    }\n-\n-    public int getDayOfWeek() {\n-        return calendar.get(Calendar.DAY_OF_WEEK);\n-    }\n-\n-    public int getHour() {\n-        return calendar.get(Calendar.HOUR_OF_DAY);\n-    }\n-\n-    public int getMinute() {\n-        return calendar.get(Calendar.MINUTE);\n-    }\n-\n-\n-    public int getSecond() {\n-        return calendar.get(Calendar.SECOND);\n-    }\n-\n-\n-    public int getEra() {\n-        return calendar.get(Calendar.ERA);\n-    }\n-\n-    public String getUSTimeZone() {\n-        String[] zones = new String[] {\"Hawaii\", \"Alaskan\", \"Pacific\",\n-                                       \"Mountain\", \"Central\", \"Eastern\"};\n-\n-        return zones[10 + getZoneOffset()];\n-    }\n-\n-    public int getZoneOffset() {\n-        return calendar.get(Calendar.ZONE_OFFSET)/(60*60*1000);\n-    }\n-\n-\n-    public int getDSTOffset() {\n-        return calendar.get(Calendar.DST_OFFSET)/(60*60*1000);\n-    }\n-\n-\n-    public int getAMPM() {\n-        return calendar.get(Calendar.AM_PM);\n-    }\n-}\n-\n-"
            },
            {
                "sha": "e7821257cf5942641da9b42d91ea55e0904a72f1",
                "filename": "webapps/examples/WEB-INF/classes/cal/TableBean.java",
                "status": "removed",
                "additions": 0,
                "deletions": 106,
                "changes": 106,
                "blob_url": "https://github.com/apache/tomcat/blob/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FTableBean.java",
                "raw_url": "https://github.com/apache/tomcat/raw/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FTableBean.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fcal%2FTableBean.java?ref=a40f368f9dd251e36f90058c9805580fa06afd97",
                "patch": "@@ -1,106 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package cal;\n-\n-import java.util.Map;\n-import java.util.concurrent.ConcurrentHashMap;\n-\n-import jakarta.servlet.http.HttpServletRequest;\n-\n-public class TableBean {\n-\n-    private final Map<String, Entries> table;\n-    private final JspCalendar JspCal;\n-    private Entries entries;\n-    private String date;\n-    private String name = null;\n-    private String email = null;\n-    private boolean processError = false;\n-\n-    public TableBean() {\n-        this.table = new ConcurrentHashMap<>(10);\n-        this.JspCal = new JspCalendar();\n-        this.date = JspCal.getCurrentDate();\n-    }\n-\n-    public void setName(String nm) {\n-        this.name = nm;\n-    }\n-\n-    public String getName() {\n-        return this.name;\n-    }\n-\n-    public void setEmail(String mail) {\n-        this.email = mail;\n-    }\n-\n-    public String getEmail() {\n-        return this.email;\n-    }\n-\n-    public String getDate() {\n-        return this.date;\n-    }\n-\n-    public Entries getEntries() {\n-        return this.entries;\n-    }\n-\n-    public void processRequest(HttpServletRequest request) {\n-\n-        // Get the name and e-mail.\n-        this.processError = false;\n-        if (name == null || name.equals(\"\")) {\n-            setName(request.getParameter(\"name\"));\n-        }\n-        if (email == null || email.equals(\"\")) {\n-            setEmail(request.getParameter(\"email\"));\n-        }\n-        if (name == null || email == null || name.equals(\"\")\n-                || email.equals(\"\")) {\n-            this.processError = true;\n-            return;\n-        }\n-\n-        // Get the date.\n-        String dateR = request.getParameter(\"date\");\n-        if (dateR == null) {\n-            date = JspCal.getCurrentDate();\n-        } else if (dateR.equalsIgnoreCase(\"next\")) {\n-            date = JspCal.getNextDate();\n-        } else if (dateR.equalsIgnoreCase(\"prev\")) {\n-            date = JspCal.getPrevDate();\n-        }\n-\n-        entries = table.get(date);\n-        if (entries == null) {\n-            entries = new Entries();\n-            table.put(date, entries);\n-        }\n-\n-        // If time is provided add the event.\n-        String time = request.getParameter(\"time\");\n-        if (time != null) {\n-            entries.processRequest(request, time);\n-        }\n-    }\n-\n-    public boolean getProcessError() {\n-        return this.processError;\n-    }\n-}"
            },
            {
                "sha": "ce29c13f9608d9521d4f148ecb15f73dd3e3c997",
                "filename": "webapps/examples/jsp/cal/cal1.jsp",
                "status": "removed",
                "additions": 0,
                "deletions": 94,
                "changes": 94,
                "blob_url": "https://github.com/apache/tomcat/blob/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal1.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal1.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal1.jsp?ref=a40f368f9dd251e36f90058c9805580fa06afd97",
                "patch": "@@ -1,94 +0,0 @@\n-<%--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n---%>\n-<%@page contentType=\"text/html; charset=UTF-8\" %>\n-<HTML>\n-<HEAD><TITLE>\n-    Calendar: A JSP APPLICATION\n-</TITLE></HEAD>\n-\n-\n-<BODY BGCOLOR=\"white\">\n-\n-<%@ page language=\"java\" import=\"cal.*\" %>\n-<jsp:useBean id=\"table\" scope=\"session\" class=\"cal.TableBean\" />\n-\n-<%\n-    table.processRequest(request);\n-    if (table.getProcessError() == false) {\n-%>\n-\n-<!-- HTML table goes here -->\n-<CENTER>\n-<TABLE WIDTH=60% BGCOLOR=yellow CELLPADDING=15>\n-<TR>\n-<TD ALIGN=CENTER> <A HREF=cal1.jsp?date=prev> prev </A>\n-<TD ALIGN=CENTER> Calendar:<%= table.getDate() %></TD>\n-<TD ALIGN=CENTER> <A HREF=cal1.jsp?date=next> next </A>\n-</TR>\n-</TABLE>\n-\n-<!-- the main table -->\n-<TABLE WIDTH=60% BGCOLOR=lightblue BORDER=1 CELLPADDING=10>\n-<TR>\n-<TH> Time </TH>\n-<TH> Appointment </TH>\n-</TR>\n-<FORM METHOD=POST ACTION=cal1.jsp>\n-<%\n-    for(int i=0; i<table.getEntries().getRows(); i++) {\n-       cal.Entry entr = table.getEntries().getEntry(i);\n-%>\n-    <TR>\n-    <TD>\n-    <A HREF=cal2.jsp?time=<%= entr.getHour() %>>\n-        <%= entr.getHour() %> </A>\n-    </TD>\n-    <TD BGCOLOR=<%= entr.getColor() %>>\n-    <% out.print(util.HTMLFilter.filter(entr.getDescription())); %>\n-    </TD>\n-    </TR>\n-<%\n-    }\n-%>\n-</FORM>\n-</TABLE>\n-<BR>\n-\n-<!-- footer -->\n-<TABLE WIDTH=60% BGCOLOR=yellow CELLPADDING=15>\n-<TR>\n-<TD ALIGN=CENTER>  <% out.print(util.HTMLFilter.filter(table.getName())); %> :\n-             <% out.print(util.HTMLFilter.filter(table.getEmail())); %> </TD>\n-</TR>\n-</TABLE>\n-</CENTER>\n-\n-<%\n-    } else {\n-%>\n-<font size=5>\n-    You must enter your name and email address correctly.\n-</font>\n-<%\n-    }\n-%>\n-\n-\n-</BODY>\n-</HTML>\n-\n-"
            },
            {
                "sha": "e7e14d8e0468825cc23b95a8c332c8990acfd873",
                "filename": "webapps/examples/jsp/cal/cal2.jsp",
                "status": "removed",
                "additions": 0,
                "deletions": 45,
                "changes": 45,
                "blob_url": "https://github.com/apache/tomcat/blob/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal2.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal2.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Fcal2.jsp?ref=a40f368f9dd251e36f90058c9805580fa06afd97",
                "patch": "@@ -1,45 +0,0 @@\n-<%--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n---%>\n-<%@page contentType=\"text/html; charset=UTF-8\" %>\n-<HTML>\n-<HEAD><TITLE>\n-    Calendar: A JSP APPLICATION\n-</TITLE></HEAD>\n-\n-\n-<BODY BGCOLOR=\"white\">\n-<jsp:useBean id=\"table\" scope=\"session\" class=\"cal.TableBean\" />\n-\n-<%\n-    String time = request.getParameter (\"time\");\n-%>\n-\n-<FONT SIZE=5> Please add the following event:\n-<BR> <h3> Date <%= table.getDate() %>\n-<BR> Time <%= util.HTMLFilter.filter(time) %> </h3>\n-</FONT>\n-<FORM METHOD=POST ACTION=cal1.jsp>\n-<BR>\n-<BR> <INPUT NAME=\"date\" TYPE=HIDDEN VALUE=\"current\">\n-<BR> <INPUT NAME=\"time\" TYPE=HIDDEN VALUE=\"<%= util.HTMLFilter.filter(time) %>\">\n-<BR> <h2> Description of the event <INPUT NAME=\"description\" TYPE=TEXT SIZE=20> </h2>\n-<BR> <INPUT TYPE=SUBMIT VALUE=\"submit\">\n-</FORM>\n-\n-</BODY>\n-</HTML>\n-"
            },
            {
                "sha": "a0a3ea1841341fbd612d633dc5bed3f0171b1c36",
                "filename": "webapps/examples/jsp/cal/calendar.html",
                "status": "removed",
                "additions": 0,
                "deletions": 43,
                "changes": 43,
                "blob_url": "https://github.com/apache/tomcat/blob/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2Fjsp%2Fcal%2Fcalendar.html",
                "raw_url": "https://github.com/apache/tomcat/raw/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2Fjsp%2Fcal%2Fcalendar.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Fcalendar.html?ref=a40f368f9dd251e36f90058c9805580fa06afd97",
                "patch": "@@ -1,43 +0,0 @@\n-<html>\n-<!--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<head>\n-<title>Untitled Document</title>\n-<meta http-equiv=\"Content-Type\" content=\"text/html; charset=iso-8859-1\">\n-</head>\n-\n-<body bgcolor=\"#FFFFFF\">\n-<p><font color=\"#0000FF\"><a href=\"login.html\"><img src=\"../images/execute.gif\" align=\"right\" border=\"0\"></a><a href=\"../index.html\"><img src=\"../images/return.gif\" width=\"24\" height=\"24\" align=\"right\" border=\"0\"></a></font></p>\n-\n-<h2> Source Code for Calendar Example. <br>\n-<h3><a href=\"cal1.jsp.html\">cal1.jsp<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-<h3><a href=\"cal2.jsp.html\">cal2.jsp<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-\n-<br>\n-<h2> Beans.\n-<h3><a href=\"TableBean.java.html\">TableBean<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-<h3><a href=\"Entries.java.html\">Entries<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-<h3><a href=\"Entry.java.html\">Entry<font color=\"#0000FF\"></a>\n-  </font> </h3>\n-\n-</body>\n-</html>"
            },
            {
                "sha": "8a62eca07b4ddf67fc130ef410fd7fa04faf366f",
                "filename": "webapps/examples/jsp/cal/login.html",
                "status": "removed",
                "additions": 0,
                "deletions": 47,
                "changes": 47,
                "blob_url": "https://github.com/apache/tomcat/blob/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2Fjsp%2Fcal%2Flogin.html",
                "raw_url": "https://github.com/apache/tomcat/raw/a40f368f9dd251e36f90058c9805580fa06afd97/webapps%2Fexamples%2Fjsp%2Fcal%2Flogin.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fcal%2Flogin.html?ref=a40f368f9dd251e36f90058c9805580fa06afd97",
                "patch": "@@ -1,47 +0,0 @@\n-<html>\n-<!--\n- Licensed to the Apache Software Foundation (ASF) under one or more\n-  contributor license agreements.  See the NOTICE file distributed with\n-  this work for additional information regarding copyright ownership.\n-  The ASF licenses this file to You under the Apache License, Version 2.0\n-  (the \"License\"); you may not use this file except in compliance with\n-  the License.  You may obtain a copy of the License at\n-\n-      http://www.apache.org/licenses/LICENSE-2.0\n-\n-  Unless required by applicable law or agreed to in writing, software\n-  distributed under the License is distributed on an \"AS IS\" BASIS,\n-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-  See the License for the specific language governing permissions and\n-  limitations under the License.\n--->\n-\n-<head>\n-    <title> Login page for the calendar. </title>\n-</head>\n-\n-<body bgcolor=\"white\">\n-<center>\n-\n-    <font size=7 color=\"red\"> Please Enter the following information: </font>\n-\n-<br>\n-    <form method=GET action=cal1.jsp>\n-\n-        <font size=5> Name <input type=text name=\"name\" size=20>\n-        </font>\n-        <br>\n-        <font size=5> Email <input type=text name=\"email\" size=20>\n-        </font>\n-        <br>\n-        <input type=submit name=action value=\"Submit\">\n-\n-    </form>\n-<hr>\n-<font size=3 color=\"red\"> Note: This application does not implement the complete\n-functionality of a typical calendar application. It demonstrates a way JSP can\n-be used with HTML tables and forms.</font>\n-\n-</center>\n-</body>\n-</html>"
            },
            {
                "sha": "d8ef283629a4c6627e95f70fb81ab994e152216c",
                "filename": "webapps/examples/jsp/index.html",
                "status": "modified",
                "additions": 0,
                "deletions": 8,
                "changes": 8,
                "blob_url": "https://github.com/apache/tomcat/blob/722814668708c42a61b0c1e340b15bc2b785c0d1/webapps%2Fexamples%2Fjsp%2Findex.html",
                "raw_url": "https://github.com/apache/tomcat/raw/722814668708c42a61b0c1e340b15bc2b785c0d1/webapps%2Fexamples%2Fjsp%2Findex.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Findex.html?ref=722814668708c42a61b0c1e340b15bc2b785c0d1",
                "patch": "@@ -249,14 +249,6 @@ <h2>JSP 1.2 Examples</h2>\n <td style=\"width: 30%;\"><a href=\"colors/clr.html\"><img src=\"images/code.gif\" alt=\"\"></a><a href=\"colors/clr.html\">Source</a></td>\n </tr>\n \n-<tr>\n-<td>Calendar</td>\n-\n-<td style=\"width: 30%;\"><a href=\"cal/login.html\"><img src=\"images/execute.gif\" alt=\"\"></a><a href=\"cal/login.html\">Execute</a></td>\n-\n-<td style=\"width: 30%;\"><a href=\"cal/calendar.html\"><img src=\"images/code.gif\" alt=\"\"></a><a href=\"cal/calendar.html\">Source</a></td>\n-</tr>\n-\n <tr>\n <td>Include</td>\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/c0a23927ea5e061ca3fdff695138464179fe674a",
        "url": "https://api.github.com/repos/apache/tomcat/commits/c0a23927ea5e061ca3fdff695138464179fe674a",
        "html_url": "https://github.com/apache/tomcat/commit/c0a23927ea5e061ca3fdff695138464179fe674a",
        "message": "Add the ability to delete session attributes.",
        "files": [
            {
                "sha": "5a5bac60e507c96b56894862fe75ed74e2325b10",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/c0a23927ea5e061ca3fdff695138464179fe674a/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/c0a23927ea5e061ca3fdff695138464179fe674a/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=c0a23927ea5e061ca3fdff695138464179fe674a",
                "patch": "@@ -260,6 +260,10 @@\n         Examples. Expand the obfuscation of session cookie values in the request\n         header example to JSON responses. (markt)\n       </fix>\n+      <add>\n+        Examples. Add the ability to delete session attributes in the servlet\n+        session example. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "76b8fba15b62c1d225cf478447e58f4a9bf1eb2c",
                "filename": "webapps/examples/WEB-INF/classes/SessionExample.java",
                "status": "modified",
                "additions": 11,
                "deletions": 3,
                "changes": 14,
                "blob_url": "https://github.com/apache/tomcat/blob/c0a23927ea5e061ca3fdff695138464179fe674a/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/c0a23927ea5e061ca3fdff695138464179fe674a/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java?ref=c0a23927ea5e061ca3fdff695138464179fe674a",
                "patch": "@@ -1,3 +1,4 @@\n+\n /*\n  * Licensed to the Apache Software Foundation (ASF) under one or more\n  * contributor license agreements.  See the NOTICE file distributed with\n@@ -16,6 +17,8 @@\n  */\n import java.io.IOException;\n import java.io.PrintWriter;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n import java.util.Date;\n import java.util.Enumeration;\n import java.util.ResourceBundle;\n@@ -75,7 +78,7 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n \n         String dataName = request.getParameter(\"dataname\");\n         String dataValue = request.getParameter(\"datavalue\");\n-        if (dataName != null && dataValue != null) {\n+        if (dataName != null) {\n             session.setAttribute(dataName, dataValue);\n         }\n \n@@ -85,7 +88,12 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n         while (names.hasMoreElements()) {\n             String name = names.nextElement();\n             String value = session.getAttribute(name).toString();\n-            out.println(HTMLFilter.filter(name) + \" = \" + HTMLFilter.filter(value) + \"<br>\");\n+            out.println(HTMLFilter.filter(name) + \" = \" + HTMLFilter.filter(value));\n+            out.print(\"<a href=\\\"\");\n+            out.print(HTMLFilter.filter(\n+                    response.encodeURL(\"SessionExample?dataname=\" + URLEncoder.encode(name, StandardCharsets.UTF_8))));\n+            out.println(\"\\\" >delete</a>\");\n+            out.println(\"<br>\");\n         }\n \n         out.println(\"<P>\");\n@@ -117,7 +125,7 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n         out.println(\"</form>\");\n \n         out.print(\"<p><a href=\\\"\");\n-        out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=foo&datavalue=bar\")));\n+        out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=exampleName&datavalue=exampleValue\")));\n         out.println(\"\\\" >URL encoded </a>\");\n \n         out.println(\"</body>\");"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/75ff7e8622edcc024b268677aa789ee8f0880ecc",
        "url": "https://api.github.com/repos/apache/tomcat/commits/75ff7e8622edcc024b268677aa789ee8f0880ecc",
        "html_url": "https://github.com/apache/tomcat/commit/75ff7e8622edcc024b268677aa789ee8f0880ecc",
        "message": "Fix back-port",
        "files": [
            {
                "sha": "f4c90b8b715c12b3b75c149db1e260f95ca6efcd",
                "filename": "webapps/examples/jsp/security/protected/index.jsp",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/75ff7e8622edcc024b268677aa789ee8f0880ecc/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/75ff7e8622edcc024b268677aa789ee8f0880ecc/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsecurity%2Fprotected%2Findex.jsp?ref=75ff7e8622edcc024b268677aa789ee8f0880ecc",
                "patch": "@@ -178,7 +178,7 @@ To add some data to the authenticated session, enter it here:\n <tr>\n   <td><%= util.HTMLFilter.filter(name) %></td>\n   <td><%= util.HTMLFilter.filter(value) %></td>\n-  <td><a href='<%= response.encodeURL(\"index.jsp?dataName=\" + URLEncoder.encode(name, StandardCharsets.UTF_8)) %>'>delete</a></td>\n+  <td><a href='<%= response.encodeURL(\"index.jsp?dataName=\" + URLEncoder.encode(name, \"UTF-8\")) %>'>delete</a></td>\n </tr>\n <%\n   }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/e8c16cdba833884e1bd49fff1f1cb699da177585",
        "url": "https://api.github.com/repos/apache/tomcat/commits/e8c16cdba833884e1bd49fff1f1cb699da177585",
        "html_url": "https://github.com/apache/tomcat/commit/e8c16cdba833884e1bd49fff1f1cb699da177585",
        "message": "Add a limit of 10 attributes per session to the session example",
        "files": [
            {
                "sha": "9729bc7fd257660f6ce7a263edfd5c5e874d8177",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/e8c16cdba833884e1bd49fff1f1cb699da177585/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/e8c16cdba833884e1bd49fff1f1cb699da177585/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=e8c16cdba833884e1bd49fff1f1cb699da177585",
                "patch": "@@ -254,6 +254,10 @@\n         Examples. Add the ability to delete session attributes in the servlet\n         session example. (markt)\n       </add>\n+      <add>\n+        Examples. Add a hard coded limit of 10 attributes per session for the\n+        servlet session example. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "14d81fea5c62bed3240a2d1f18b71160f2b5f636",
                "filename": "webapps/examples/WEB-INF/classes/SessionExample.java",
                "status": "modified",
                "additions": 60,
                "deletions": 34,
                "changes": 94,
                "blob_url": "https://github.com/apache/tomcat/blob/e8c16cdba833884e1bd49fff1f1cb699da177585/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/e8c16cdba833884e1bd49fff1f1cb699da177585/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java?ref=e8c16cdba833884e1bd49fff1f1cb699da177585",
                "patch": "@@ -41,6 +41,9 @@ public class SessionExample extends HttpServlet {\n \n     private static final long serialVersionUID = 1L;\n \n+    private static final int SESSION_ATTRIBUTE_COUNT_LIMIT = 10;\n+\n+\n     @Override\n     public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {\n         ResourceBundle rb = ResourceBundle.getBundle(\"LocalStrings\", request.getLocale());\n@@ -76,15 +79,34 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n         out.println(rb.getString(\"sessions.lastaccessed\") + \" \");\n         out.println(new Date(session.getLastAccessedTime()));\n \n+        // Count the existing attributes\n+        int sessionAttributeCount = 0;\n+        Enumeration<String> names = session.getAttributeNames();\n+        while (names.hasMoreElements()) {\n+            names.nextElement();\n+            sessionAttributeCount++;\n+        }\n+\n         String dataName = request.getParameter(\"dataname\");\n         String dataValue = request.getParameter(\"datavalue\");\n         if (dataName != null) {\n-            session.setAttribute(dataName, dataValue);\n+            if (dataValue == null) {\n+                session.removeAttribute(dataName);\n+                sessionAttributeCount--;\n+            } else if (sessionAttributeCount < SESSION_ATTRIBUTE_COUNT_LIMIT) {\n+                session.setAttribute(dataName, dataValue);\n+                sessionAttributeCount++;\n+            } else {\n+                out.print(\"<p> Session attribute [\");\n+                out.print(HTMLFilter.filter(dataName));\n+                out.print(\"] not added as there are already \"+ SESSION_ATTRIBUTE_COUNT_LIMIT + \" attributes in the \");\n+                out.println(\"session. Delete an attribute before adding another.\");\n+            }\n         }\n \n-        out.println(\"<P>\");\n+        out.println(\"<p>\");\n         out.println(rb.getString(\"sessions.data\") + \"<br>\");\n-        Enumeration<String> names = session.getAttributeNames();\n+        names = session.getAttributeNames();\n         while (names.hasMoreElements()) {\n             String name = names.nextElement();\n             String value = session.getAttribute(name).toString();\n@@ -96,37 +118,41 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n             out.println(\"<br>\");\n         }\n \n-        out.println(\"<P>\");\n-        out.print(\"<form action=\\\"\");\n-        out.print(response.encodeURL(\"SessionExample\"));\n-        out.print(\"\\\" \");\n-        out.println(\"method=POST>\");\n-        out.println(rb.getString(\"sessions.dataname\"));\n-        out.println(\"<input type=text size=20 name=dataname>\");\n-        out.println(\"<br>\");\n-        out.println(rb.getString(\"sessions.datavalue\"));\n-        out.println(\"<input type=text size=20 name=datavalue>\");\n-        out.println(\"<br>\");\n-        out.println(\"<input type=submit>\");\n-        out.println(\"</form>\");\n-\n-        out.println(\"<P>GET based form:<br>\");\n-        out.print(\"<form action=\\\"\");\n-        out.print(response.encodeURL(\"SessionExample\"));\n-        out.print(\"\\\" \");\n-        out.println(\"method=GET>\");\n-        out.println(rb.getString(\"sessions.dataname\"));\n-        out.println(\"<input type=text size=20 name=dataname>\");\n-        out.println(\"<br>\");\n-        out.println(rb.getString(\"sessions.datavalue\"));\n-        out.println(\"<input type=text size=20 name=datavalue>\");\n-        out.println(\"<br>\");\n-        out.println(\"<input type=submit>\");\n-        out.println(\"</form>\");\n-\n-        out.print(\"<p><a href=\\\"\");\n-        out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=exampleName&datavalue=exampleValue\")));\n-        out.println(\"\\\" >URL encoded </a>\");\n+        if (sessionAttributeCount < SESSION_ATTRIBUTE_COUNT_LIMIT) {\n+            out.println(\"<p>\");\n+            out.print(\"<form action=\\\"\");\n+            out.print(response.encodeURL(\"SessionExample\"));\n+            out.print(\"\\\" \");\n+            out.println(\"method=POST>\");\n+            out.println(rb.getString(\"sessions.dataname\"));\n+            out.println(\"<input type=text size=20 name=dataname>\");\n+            out.println(\"<br>\");\n+            out.println(rb.getString(\"sessions.datavalue\"));\n+            out.println(\"<input type=text size=20 name=datavalue>\");\n+            out.println(\"<br>\");\n+            out.println(\"<input type=submit>\");\n+            out.println(\"</form>\");\n+\n+            out.println(\"<p>GET based form:<br>\");\n+            out.print(\"<form action=\\\"\");\n+            out.print(response.encodeURL(\"SessionExample\"));\n+            out.print(\"\\\" \");\n+            out.println(\"method=GET>\");\n+            out.println(rb.getString(\"sessions.dataname\"));\n+            out.println(\"<input type=text size=20 name=dataname>\");\n+            out.println(\"<br>\");\n+            out.println(rb.getString(\"sessions.datavalue\"));\n+            out.println(\"<input type=text size=20 name=datavalue>\");\n+            out.println(\"<br>\");\n+            out.println(\"<input type=submit>\");\n+            out.println(\"</form>\");\n+\n+            out.print(\"<p><a href=\\\"\");\n+            out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=exampleName&datavalue=exampleValue\")));\n+            out.println(\"\\\" >URL encoded </a>\");\n+        } else {\n+            out.print(\"<p>You may not add more than \" + SESSION_ATTRIBUTE_COUNT_LIMIT + \" attributes to this session.\");\n+        }\n \n         out.println(\"</body>\");\n         out.println(\"</html>\");"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/4d5cc6538d91386f950373ac8120e98c2c78ed3a",
        "url": "https://api.github.com/repos/apache/tomcat/commits/4d5cc6538d91386f950373ac8120e98c2c78ed3a",
        "html_url": "https://github.com/apache/tomcat/commit/4d5cc6538d91386f950373ac8120e98c2c78ed3a",
        "message": "Limit shopping cart to pre-defined items",
        "files": [
            {
                "sha": "3f1579373bd48defeb3a66ecd0ca4081c56097a6",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=4d5cc6538d91386f950373ac8120e98c2c78ed3a",
                "patch": "@@ -278,6 +278,10 @@\n         coded limit of 10 attributes per session for the JSP form authentication\n         example. (markt)\n       </add>\n+      <add>\n+        Examples. Limit the shopping cart example to only allow adding the\n+        pre-defined items to the cart. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "7088557b9595d64775c8559325e2a6880044a20d",
                "filename": "webapps/examples/WEB-INF/classes/sessions/DummyCart.java",
                "status": "modified",
                "additions": 25,
                "deletions": 17,
                "changes": 42,
                "blob_url": "https://github.com/apache/tomcat/blob/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FDummyCart.java",
                "raw_url": "https://github.com/apache/tomcat/raw/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FDummyCart.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FDummyCart.java?ref=4d5cc6538d91386f950373ac8120e98c2c78ed3a",
                "patch": "@@ -16,42 +16,50 @@\n  */\n package sessions;\n \n-import java.util.ArrayList;\n import java.util.Collections;\n-import java.util.List;\n+import java.util.HashSet;\n+import java.util.Set;\n \n public class DummyCart {\n-    final List<String> items = Collections.synchronizedList(new ArrayList<>());\n+    final Set<Item> items = Collections.synchronizedSet(new HashSet<>());\n+    int itemId = -1;\n     String submit = null;\n-    String item = null;\n \n-    private void addItem(String name) {\n-        items.add(name);\n+    public void setItemId(int itemId) {\n+        this.itemId = itemId;\n     }\n \n-    private void removeItem(String name) {\n-        items.remove(name);\n+    public void setSubmit(String s) {\n+        submit = s;\n     }\n \n-    public void setItem(String name) {\n-        item = name;\n+    private void addItem(int itemId) {\n+        try {\n+            items.add(Item.values()[itemId]);\n+        } catch (ArrayIndexOutOfBoundsException e) {\n+            // Ignore. Can only happen if user edits URL directly.\n+        }\n     }\n \n-    public void setSubmit(String s) {\n-        submit = s;\n+    private void removeItem(int itemId) {\n+        try {\n+            items.remove(Item.values()[itemId]);\n+        } catch (ArrayIndexOutOfBoundsException e) {\n+            // Ignore. Can only happen if user edits URL directly.\n+        }\n     }\n \n-    public String[] getItems() {\n-        return items.toArray(new String[0]);\n+    public Item[] getItems() {\n+        return items.toArray(new Item[0]);\n     }\n \n     public void processRequest() {\n         // null value for submit - user hit enter instead of clicking on\n         // \"add\" or \"remove\"\n         if (submit == null || submit.equals(\"add\")) {\n-            addItem(item);\n+            addItem(itemId);\n         } else if (submit.equals(\"remove\")) {\n-            removeItem(item);\n+            removeItem(itemId);\n         }\n \n         // reset at the end of the request\n@@ -61,6 +69,6 @@ public void processRequest() {\n     // reset\n     private void reset() {\n         submit = null;\n-        item = null;\n+        itemId = -1;\n     }\n }"
            },
            {
                "sha": "447d04443744ac96bd08aebcca8541e84c66fe78",
                "filename": "webapps/examples/WEB-INF/classes/sessions/Item.java",
                "status": "added",
                "additions": 37,
                "deletions": 0,
                "changes": 37,
                "blob_url": "https://github.com/apache/tomcat/blob/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FItem.java",
                "raw_url": "https://github.com/apache/tomcat/raw/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FItem.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2Fsessions%2FItem.java?ref=4d5cc6538d91386f950373ac8120e98c2c78ed3a",
                "patch": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package sessions;\n+\n+public enum Item {\n+\n+    VIDEO(\"Beavis & Butt-head Video collection\"),\n+    MOVIE(\"X-files movie\"),\n+    TAPES(\"Twin peaks tapes\"),\n+    CD(\"NIN CD\"),\n+    BOOK(\"JSP Book\"),\n+    TICKETS(\"Concert tickets\");\n+\n+    private final String title;\n+\n+    Item(String title) {\n+        this.title = title;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+}"
            },
            {
                "sha": "dc25005b2710787761cd6438a6c717dd07c519b0",
                "filename": "webapps/examples/jsp/index.html",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2Fjsp%2Findex.html",
                "raw_url": "https://github.com/apache/tomcat/raw/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2Fjsp%2Findex.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Findex.html?ref=4d5cc6538d91386f950373ac8120e98c2c78ed3a",
                "patch": "@@ -228,7 +228,7 @@ <h2>JSP 1.2 Examples</h2>\n <tr>\n <td>Carts</td>\n \n-<td style=\"width: 30%;\"><a href=\"sessions/carts.html\"><img src=\"images/execute.gif\" alt=\"\"></a><a href=\"sessions/carts.html\">Execute</a></td>\n+<td style=\"width: 30%;\"><a href=\"sessions/shopping.jsp\"><img src=\"images/execute.gif\" alt=\"\"></a><a href=\"sessions/shopping.jsp\">Execute</a></td>\n \n <td style=\"width: 30%;\"><a href=\"sessions/crt.html\"><img src=\"images/code.gif\" alt=\"\"></a><a href=\"sessions/crt.html\">Source</a></td>\n </tr>"
            },
            {
                "sha": "fa5624dee6bdd1fe173ca14af1b7b241d4ffbee2",
                "filename": "webapps/examples/jsp/sessions/carts.jsp",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/apache/tomcat/blob/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcarts.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcarts.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcarts.jsp?ref=4d5cc6538d91386f950373ac8120e98c2c78ed3a",
                "patch": "@@ -27,10 +27,10 @@\n <br> You have the following items in your cart:\n <ol>\n <%\n-    String[] items = cart.getItems();\n-    for (String item : items) {\n+    Item[] items = cart.getItems();\n+    for (Item item : items) {\n %>\n-<li> <% out.print(util.HTMLFilter.filter(item)); %>\n+<li> <% out.print(util.HTMLFilter.filter(item.getTitle())); %>\n <%\n     }\n %>\n@@ -39,5 +39,5 @@\n </FONT>\n \n <hr>\n-<%@ include file =\"carts.html\" %>\n+<%@ include file =\"shopping.jsp\" %>\n </html>"
            },
            {
                "sha": "28ace66012c776da97c7d34c58155ec1bb09fc95",
                "filename": "webapps/examples/jsp/sessions/crt.html",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/apache/tomcat/blob/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcrt.html",
                "raw_url": "https://github.com/apache/tomcat/raw/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcrt.html",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsessions%2Fcrt.html?ref=4d5cc6538d91386f950373ac8120e98c2c78ed3a",
                "patch": "@@ -22,9 +22,12 @@\n </head>\n \n <body bgcolor=\"#FFFFFF\">\n-<p><font color=\"#0000FF\"><a href=\"carts.html\"><img src=\"../images/execute.gif\" align=\"right\" border=\"0\"></a><a href=\"../index.html\"><img src=\"../images/return.gif\" width=\"24\" height=\"24\" align=\"right\" border=\"0\"></a></font></p>\n+<p><font color=\"#0000FF\"><a href=\"shopping.jsp\"><img src=\"../images/execute.gif\" align=\"right\" border=\"0\"></a><a href=\"../index.html\"><img src=\"../images/return.gif\" width=\"24\" height=\"24\" align=\"right\" border=\"0\"></a></font></p>\n \n-<h3><a href=\"carts.jsp.html\">Source Code for Cart Example<font color=\"#0000FF\"></a>\n+<h3><a href=\"shopping.jsp.html\">Source Code for Cart Example Shopping Page<font color=\"#0000FF\"></a>\n+  </font> </h3>\n+\n+<h3><a href=\"carts.jsp.html\">Source Code for Cart Example Cart Page<font color=\"#0000FF\"></a>\n   </font> </h3>\n \n <h3><a href=\"DummyCart.html\">Property Sheet for DummyCart"
            },
            {
                "sha": "3487b10295477e4d07dba4b7bcc896ade41c7838",
                "filename": "webapps/examples/jsp/sessions/shopping.jsp",
                "status": "renamed",
                "additions": 19,
                "deletions": 22,
                "changes": 41,
                "blob_url": "https://github.com/apache/tomcat/blob/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2Fjsp%2Fsessions%2Fshopping.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/4d5cc6538d91386f950373ac8120e98c2c78ed3a/webapps%2Fexamples%2Fjsp%2Fsessions%2Fshopping.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2Fjsp%2Fsessions%2Fshopping.jsp?ref=4d5cc6538d91386f950373ac8120e98c2c78ed3a",
                "patch": "@@ -1,5 +1,4 @@\n-<html>\n-<!--\n+<%--\n  Licensed to the Apache Software Foundation (ASF) under one or more\n   contributor license agreements.  See the NOTICE file distributed with\n   this work for additional information regarding copyright ownership.\n@@ -14,40 +13,38 @@\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n--->\n-\n+--%>\n+<%@ page import=\"sessions.Item\" %>\n+<html>\n <head>\n-    <title>carts</title>\n+<title>Shopping Cart Example</title>\n </head>\n \n- <body bgcolor=\"white\">\n+<body bgcolor=\"white\">\n <font size = 5 color=\"#CC0000\">\n \n <form type=POST action=carts.jsp>\n-<BR>\n+<br>\n Please enter item to add or remove:\n <br>\n-Add Item:\n-\n-<SELECT NAME=\"item\">\n-<OPTION>Beavis & Butt-head Video collection\n-<OPTION>X-files movie\n-<OPTION>Twin peaks tapes\n-<OPTION>NIN CD\n-<OPTION>JSP Book\n-<OPTION>Concert tickets\n-<OPTION>Love life\n-<OPTION>Switch blade\n-<OPTION>Rex, Rugs & Rock n' Roll\n-</SELECT>\n-\n+Select Item:\n+\n+<select name=\"itemId\">\n+<%\n+  for (Item item : Item.values()) {\n+%>\n+  <option value=\"<%= item.ordinal() %>\"><%= item.getTitle() %></option>\n+<%\n+  }\n+%>\n+</select>\n \n <br> <br>\n <INPUT TYPE=submit name=\"submit\" value=\"add\">\n <INPUT TYPE=submit name=\"submit\" value=\"remove\">\n \n </form>\n \n-</FONT>\n+</font>\n </body>\n </html>",
                "previous_filename": "webapps/examples/jsp/sessions/carts.html"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/3315a9027a7eaab18f42625b97b569940ff1365d",
        "url": "https://api.github.com/repos/apache/tomcat/commits/3315a9027a7eaab18f42625b97b569940ff1365d",
        "html_url": "https://github.com/apache/tomcat/commit/3315a9027a7eaab18f42625b97b569940ff1365d",
        "message": "Fix backprot",
        "files": [
            {
                "sha": "14e7c9701c84a990814e5e647f90a1874a461a46",
                "filename": "webapps/examples/WEB-INF/classes/SessionExample.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/apache/tomcat/blob/3315a9027a7eaab18f42625b97b569940ff1365d/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/3315a9027a7eaab18f42625b97b569940ff1365d/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java?ref=3315a9027a7eaab18f42625b97b569940ff1365d",
                "patch": "@@ -18,7 +18,6 @@\n import java.io.IOException;\n import java.io.PrintWriter;\n import java.net.URLEncoder;\n-import java.nio.charset.StandardCharsets;\n import java.util.Date;\n import java.util.Enumeration;\n import java.util.ResourceBundle;\n@@ -113,7 +112,7 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n             out.println(HTMLFilter.filter(name) + \" = \" + HTMLFilter.filter(value));\n             out.print(\"<a href=\\\"\");\n             out.print(HTMLFilter.filter(\n-                    response.encodeURL(\"SessionExample?dataname=\" + URLEncoder.encode(name, StandardCharsets.UTF_8))));\n+                    response.encodeURL(\"SessionExample?dataname=\" + URLEncoder.encode(name, \"UTF-8\"))));\n             out.println(\"\\\" >delete</a>\");\n             out.println(\"<br>\");\n         }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/aa5b4d0043289cf054f531ec55126c980d3572e1",
        "url": "https://api.github.com/repos/apache/tomcat/commits/aa5b4d0043289cf054f531ec55126c980d3572e1",
        "html_url": "https://github.com/apache/tomcat/commit/aa5b4d0043289cf054f531ec55126c980d3572e1",
        "message": "Add the ability to delete session attributes.",
        "files": [
            {
                "sha": "9dce2c5aaa3b0367060e8508968a4ba0d2a4a394",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/aa5b4d0043289cf054f531ec55126c980d3572e1/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/aa5b4d0043289cf054f531ec55126c980d3572e1/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=aa5b4d0043289cf054f531ec55126c980d3572e1",
                "patch": "@@ -250,6 +250,10 @@\n         Examples. Expand the obfuscation of session cookie values in the request\n         header example to JSON responses. (markt)\n       </fix>\n+      <add>\n+        Examples. Add the ability to delete session attributes in the servlet\n+        session example. (markt)\n+      </add>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "76b8fba15b62c1d225cf478447e58f4a9bf1eb2c",
                "filename": "webapps/examples/WEB-INF/classes/SessionExample.java",
                "status": "modified",
                "additions": 11,
                "deletions": 3,
                "changes": 14,
                "blob_url": "https://github.com/apache/tomcat/blob/aa5b4d0043289cf054f531ec55126c980d3572e1/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/aa5b4d0043289cf054f531ec55126c980d3572e1/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FSessionExample.java?ref=aa5b4d0043289cf054f531ec55126c980d3572e1",
                "patch": "@@ -1,3 +1,4 @@\n+\n /*\n  * Licensed to the Apache Software Foundation (ASF) under one or more\n  * contributor license agreements.  See the NOTICE file distributed with\n@@ -16,6 +17,8 @@\n  */\n import java.io.IOException;\n import java.io.PrintWriter;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n import java.util.Date;\n import java.util.Enumeration;\n import java.util.ResourceBundle;\n@@ -75,7 +78,7 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n \n         String dataName = request.getParameter(\"dataname\");\n         String dataValue = request.getParameter(\"datavalue\");\n-        if (dataName != null && dataValue != null) {\n+        if (dataName != null) {\n             session.setAttribute(dataName, dataValue);\n         }\n \n@@ -85,7 +88,12 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n         while (names.hasMoreElements()) {\n             String name = names.nextElement();\n             String value = session.getAttribute(name).toString();\n-            out.println(HTMLFilter.filter(name) + \" = \" + HTMLFilter.filter(value) + \"<br>\");\n+            out.println(HTMLFilter.filter(name) + \" = \" + HTMLFilter.filter(value));\n+            out.print(\"<a href=\\\"\");\n+            out.print(HTMLFilter.filter(\n+                    response.encodeURL(\"SessionExample?dataname=\" + URLEncoder.encode(name, StandardCharsets.UTF_8))));\n+            out.println(\"\\\" >delete</a>\");\n+            out.println(\"<br>\");\n         }\n \n         out.println(\"<P>\");\n@@ -117,7 +125,7 @@ public void doGet(HttpServletRequest request, HttpServletResponse response) thro\n         out.println(\"</form>\");\n \n         out.print(\"<p><a href=\\\"\");\n-        out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=foo&datavalue=bar\")));\n+        out.print(HTMLFilter.filter(response.encodeURL(\"SessionExample?dataname=exampleName&datavalue=exampleValue\")));\n         out.println(\"\\\" >URL encoded </a>\");\n \n         out.println(\"</body>\");"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/bbd82e9593314ade4cfd57248f9285fbad686f66",
        "url": "https://api.github.com/repos/apache/tomcat/commits/bbd82e9593314ade4cfd57248f9285fbad686f66",
        "html_url": "https://github.com/apache/tomcat/commit/bbd82e9593314ade4cfd57248f9285fbad686f66",
        "message": "Revert change made for testing",
        "files": [
            {
                "sha": "86f0ed0e29bf604afcd6681434caef08185f01b0",
                "filename": "webapps/examples/WEB-INF/classes/RequestHeaderExample.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/bbd82e9593314ade4cfd57248f9285fbad686f66/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/bbd82e9593314ade4cfd57248f9285fbad686f66/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java?ref=bbd82e9593314ade4cfd57248f9285fbad686f66",
                "patch": "@@ -73,7 +73,7 @@ protected boolean prefersJSON(String acceptHeader) {\n \n             // text/html, application/html, etc.\n             if (accept.contains(\"html\")) {\n-                return true;\n+                return false;\n             }\n         }\n         return false;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/4f0236606961176257b883213e1621b1859ed746",
        "url": "https://api.github.com/repos/apache/tomcat/commits/4f0236606961176257b883213e1621b1859ed746",
        "html_url": "https://github.com/apache/tomcat/commit/4f0236606961176257b883213e1621b1859ed746",
        "message": "Obfuscate session cookie values for JSON output as well as HTML",
        "files": [
            {
                "sha": "af4536506f8d8ff7238fe578bb2cc23c76321cc1",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/4f0236606961176257b883213e1621b1859ed746/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/4f0236606961176257b883213e1621b1859ed746/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=4f0236606961176257b883213e1621b1859ed746",
                "patch": "@@ -256,6 +256,10 @@\n         Examples. Fix broken links when Servlet Request Info example is called\n         via a URL that includes a pathInfo component. (markt)\n       </fix>\n+      <fix>\n+        Examples. Expand the obfuscation of session cookie values in the request\n+        header example to JSON responses. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name = \"Other\">"
            },
            {
                "sha": "db6e4b10c51f82d776bc87ad5c6a1858a4ed785e",
                "filename": "webapps/examples/WEB-INF/classes/RequestHeaderExample.java",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/apache/tomcat/blob/4f0236606961176257b883213e1621b1859ed746/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "raw_url": "https://github.com/apache/tomcat/raw/4f0236606961176257b883213e1621b1859ed746/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fexamples%2FWEB-INF%2Fclasses%2FRequestHeaderExample.java?ref=4f0236606961176257b883213e1621b1859ed746",
                "patch": "@@ -73,7 +73,7 @@ protected boolean prefersJSON(String acceptHeader) {\n \n             // text/html, application/html, etc.\n             if (accept.contains(\"html\")) {\n-                return false;\n+                return true;\n             }\n         }\n         return false;\n@@ -138,8 +138,20 @@ protected void renderJSON(HttpServletRequest request, HttpServletResponse respon\n             String headerName = e.nextElement();\n             String headerValue = request.getHeader(headerName);\n \n-            out.append(\"{\\\"\").append(JSONFilter.escape(headerName)).append(\"\\\":\\\"\")\n-                    .append(JSONFilter.escape(headerValue)).append(\"\\\"}\");\n+            out.append(\"{\\\"\").append(JSONFilter.escape(headerName)).append(\"\\\":\\\"\");\n+\n+\n+            if (headerName.toLowerCase(Locale.ENGLISH).contains(\"cookie\")) {\n+                HttpSession session = request.getSession(false);\n+                String sessionId = null;\n+                if (session != null) {\n+                    sessionId = session.getId();\n+                }\n+                out.append(JSONFilter.escape(CookieFilter.filter(headerValue, sessionId)));\n+            } else {\n+                out.append(JSONFilter.escape(headerValue));\n+            }\n+            out.append(\"\\\"}\");\n \n             if (e.hasMoreElements()) {\n                 out.append(',');"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2",
        "url": "https://api.github.com/repos/apache/tomcat/commits/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2",
        "html_url": "https://github.com/apache/tomcat/commit/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2",
        "message": "Fix inconsistent resource metadata with current GET and PUT/DELETE\n\nConcurrent reads and writes (e.g. HTTP GET and PUT / DELETE) for the\nsame path cause corruption of the FileResource where some of the fields\nare set as if the file exists and some as set as if it does not.",
        "files": [
            {
                "sha": "142472c33cd6f8fac922889d1fb84f54429cf87e",
                "filename": "java/org/apache/catalina/WebResourceLockSet.java",
                "status": "added",
                "additions": 73,
                "deletions": 0,
                "changes": 73,
                "blob_url": "https://github.com/apache/tomcat/blob/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2/java%2Forg%2Fapache%2Fcatalina%2FWebResourceLockSet.java",
                "raw_url": "https://github.com/apache/tomcat/raw/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2/java%2Forg%2Fapache%2Fcatalina%2FWebResourceLockSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2FWebResourceLockSet.java?ref=8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2",
                "patch": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.catalina;\n+\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.concurrent.locks.ReentrantReadWriteLock;\n+\n+/**\n+ * Interface implemented by {@link WebResourceSet} implementations that wish to provide locking functionality.\n+ */\n+public interface WebResourceLockSet {\n+\n+    /**\n+     * Lock the resource at the provided path for reading. The resource is not required to exist. Read locks are not\n+     * exclusive.\n+     *\n+     * @param path The path to the resource to be locked for reading\n+     *\n+     * @return The {@link ResourceLock} that must be passed to {@link #unlockForRead(ResourceLock)} to release the lock\n+     */\n+    ResourceLock lockForRead(String path);\n+\n+    /**\n+     * Release a read lock from the resource associated with the given {@link ResourceLock}.\n+     *\n+     * @param resourceLock The {@link ResourceLock} associated with the resource for which a read lock should be\n+     *                         released\n+     */\n+    void unlockForRead(ResourceLock resourceLock);\n+\n+    /**\n+     * Lock the resource at the provided path for writing. The resource is not required to exist. Write locks are\n+     * exclusive.\n+     *\n+     * @param path The path to the resource to be locked for writing\n+     *\n+     * @return The {@link ResourceLock} that must be passed to {@link #unlockForWrite(ResourceLock)} to release the lock\n+     */\n+    ResourceLock lockForWrite(String path);\n+\n+    /**\n+     * Release the write lock from the resource associated with the given {@link ResourceLock}.\n+     *\n+     * @param resourceLock The {@link ResourceLock} associated with the resource for which the write lock should be\n+     *                         released\n+     */\n+    void unlockForWrite(ResourceLock resourceLock);\n+\n+\n+    class ResourceLock {\n+        public final AtomicInteger count = new AtomicInteger(0);\n+        public final ReentrantReadWriteLock reentrantLock = new ReentrantReadWriteLock();\n+        public final String key;\n+\n+        public ResourceLock(String key) {\n+            this.key = key;\n+        }\n+    }\n+}"
            },
            {
                "sha": "02ddc6ec887cc023f6696de9f19546563c6b9c54",
                "filename": "java/org/apache/catalina/webresources/DirResourceSet.java",
                "status": "modified",
                "additions": 171,
                "deletions": 28,
                "changes": 199,
                "blob_url": "https://github.com/apache/tomcat/blob/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "raw_url": "https://github.com/apache/tomcat/raw/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java?ref=8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2",
                "patch": "@@ -22,24 +22,35 @@\n import java.io.InputStream;\n import java.nio.file.Files;\n import java.nio.file.StandardCopyOption;\n+import java.util.HashMap;\n+import java.util.Locale;\n+import java.util.Map;\n import java.util.Set;\n import java.util.jar.Manifest;\n \n import org.apache.catalina.LifecycleException;\n import org.apache.catalina.WebResource;\n+import org.apache.catalina.WebResourceLockSet;\n import org.apache.catalina.WebResourceRoot;\n import org.apache.catalina.WebResourceRoot.ResourceSetType;\n import org.apache.catalina.util.ResourceSet;\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n+import org.apache.tomcat.util.http.RequestUtil;\n \n /**\n  * Represents a {@link org.apache.catalina.WebResourceSet} based on a directory.\n  */\n-public class DirResourceSet extends AbstractFileResourceSet {\n+public class DirResourceSet extends AbstractFileResourceSet implements WebResourceLockSet {\n \n     private static final Log log = LogFactory.getLog(DirResourceSet.class);\n \n+    private boolean caseSensitive = true;\n+\n+    private Map<String,ResourceLock> resourceLocksByPath = new HashMap<>();\n+    private Object resourceLocksByPathLock = new Object();\n+\n+\n     /**\n      * A no argument constructor is required for this to work with the digester.\n      */\n@@ -91,22 +102,33 @@ public WebResource getResource(String path) {\n         String webAppMount = getWebAppMount();\n         WebResourceRoot root = getRoot();\n         if (path.startsWith(webAppMount)) {\n-            File f = file(path.substring(webAppMount.length()), false);\n-            if (f == null) {\n-                return new EmptyResource(root, path);\n-            }\n-            if (!f.exists()) {\n-                return new EmptyResource(root, path, f);\n-            }\n-            if (f.isDirectory() && path.charAt(path.length() - 1) != '/') {\n-                path = path + '/';\n+            /*\n+             * Lock the path for reading until the WebResource has been constructed. The lock prevents concurrent reads\n+             * and writes (e.g. HTTP GET and PUT / DELETE) for the same path causing corruption of the FileResource\n+             * where some of the fields are set as if the file exists and some as set as if it does not.\n+             */\n+            ResourceLock lock = lockForRead(path);\n+            try {\n+                File f = file(path.substring(webAppMount.length()), false);\n+                if (f == null) {\n+                    return new EmptyResource(root, path);\n+                }\n+                if (!f.exists()) {\n+                    return new EmptyResource(root, path, f);\n+                }\n+                if (f.isDirectory() && path.charAt(path.length() - 1) != '/') {\n+                    path = path + '/';\n+                }\n+                return new FileResource(root, path, f, isReadOnly(), getManifest(), this, lock.key);\n+            } finally {\n+                unlockForRead(lock);\n             }\n-            return new FileResource(root, path, f, isReadOnly(), getManifest());\n         } else {\n             return new EmptyResource(root, path);\n         }\n     }\n \n+\n     @Override\n     public String[] list(String path) {\n         checkPath(path);\n@@ -246,32 +268,42 @@ public boolean write(String path, InputStream is, boolean overwrite) {\n             return false;\n         }\n \n-        File dest = null;\n         String webAppMount = getWebAppMount();\n-        if (path.startsWith(webAppMount)) {\n+        if (!path.startsWith(webAppMount)) {\n+            return false;\n+        }\n+\n+        File dest = null;\n+        /*\n+         * Lock the path for writing until the write is complete. The lock prevents concurrent reads and writes (e.g.\n+         * HTTP GET and PUT / DELETE) for the same path causing corruption of the FileResource where some of the fields\n+         * are set as if the file exists and some as set as if it does not.\n+         */\n+        ResourceLock lock = lockForWrite(path);\n+        try {\n             dest = file(path.substring(webAppMount.length()), false);\n             if (dest == null) {\n                 return false;\n             }\n-        } else {\n-            return false;\n-        }\n \n-        if (dest.exists() && !overwrite) {\n-            return false;\n-        }\n+            if (dest.exists() && !overwrite) {\n+                return false;\n+            }\n \n-        try {\n-            if (overwrite) {\n-                Files.copy(is, dest.toPath(), StandardCopyOption.REPLACE_EXISTING);\n-            } else {\n-                Files.copy(is, dest.toPath());\n+            try {\n+                if (overwrite) {\n+                    Files.copy(is, dest.toPath(), StandardCopyOption.REPLACE_EXISTING);\n+                } else {\n+                    Files.copy(is, dest.toPath());\n+                }\n+            } catch (IOException ioe) {\n+                return false;\n             }\n-        } catch (IOException ioe) {\n-            return false;\n-        }\n \n-        return true;\n+            return true;\n+        } finally {\n+            unlockForWrite(lock);\n+        }\n     }\n \n     @Override\n@@ -286,6 +318,7 @@ protected void checkType(File file) {\n     @Override\n     protected void initInternal() throws LifecycleException {\n         super.initInternal();\n+        caseSensitive = isCaseSensitive();\n         // Is this an exploded web application?\n         if (getWebAppMount().equals(\"\")) {\n             // Look for a manifest\n@@ -299,4 +332,114 @@ protected void initInternal() throws LifecycleException {\n             }\n         }\n     }\n+\n+\n+    /*\n+     * Determines if this ResourceSet is based on a case sensitive file system or not.\n+     */\n+    private boolean isCaseSensitive() {\n+        try {\n+            String canonicalPath = getFileBase().getCanonicalPath();\n+            File upper = new File(canonicalPath.toUpperCase(Locale.ENGLISH));\n+            if (!canonicalPath.equals(upper.getCanonicalPath())) {\n+                return true;\n+            }\n+            File lower = new File(canonicalPath.toLowerCase(Locale.ENGLISH));\n+            if (!canonicalPath.equals(lower.getCanonicalPath())) {\n+                return true;\n+            }\n+            /*\n+             * Both upper and lower case versions of the current fileBase have the same canonical path so the file\n+             * system must be case insensitive.\n+             */\n+        } catch (IOException ioe) {\n+            log.warn(sm.getString(\"dirResourceSet.isCaseSensitive.fail\", getFileBase().getAbsolutePath()), ioe);\n+        }\n+\n+        return false;\n+    }\n+\n+\n+    private String getLockKey(String path) {\n+        // Normalize path to ensure that the same key is used for the same path.\n+        String normalisedPath = RequestUtil.normalize(path);\n+        if (caseSensitive) {\n+            return normalisedPath;\n+        }\n+        return normalisedPath.toLowerCase(Locale.ENGLISH);\n+    }\n+\n+\n+    @Override\n+    public ResourceLock lockForRead(String path) {\n+        String key = getLockKey(path);\n+        ResourceLock resourceLock = null;\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Obtain the ResourceLock and increment the usage count inside the sync to ensure that that map always has\n+             * a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            resourceLock = resourceLocksByPath.get(key);\n+            if (resourceLock == null) {\n+                resourceLock = new ResourceLock(key);\n+            }\n+            resourceLock.count.incrementAndGet();\n+        }\n+        // Obtain the lock outside the sync as it will block if there is a current write lock.\n+        resourceLock.reentrantLock.readLock().lock();\n+        return resourceLock;\n+    }\n+\n+\n+    @Override\n+    public void unlockForRead(ResourceLock resourceLock) {\n+        // Unlock outside the sync as there is no need to do it inside.\n+        resourceLock.reentrantLock.readLock().unlock();\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Decrement the usage count and remove ResourceLocks no longer required inside the sync to ensure that that\n+             * map always has a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            if (resourceLock.count.decrementAndGet() == 0) {\n+                resourceLocksByPath.remove(resourceLock.key);\n+            }\n+        }\n+    }\n+\n+\n+    @Override\n+    public ResourceLock lockForWrite(String path) {\n+        String key = getLockKey(path);\n+        ResourceLock resourceLock = null;\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Obtain the ResourceLock and increment the usage count inside the sync to ensure that that map always has\n+             * a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            resourceLock = resourceLocksByPath.get(key);\n+            if (resourceLock == null) {\n+                resourceLock = new ResourceLock(key);\n+            }\n+            resourceLock.count.incrementAndGet();\n+        }\n+        // Obtain the lock outside the sync as it will block if there are any other current locks.\n+        resourceLock.reentrantLock.writeLock().lock();\n+        return resourceLock;\n+    }\n+\n+\n+    @Override\n+    public void unlockForWrite(ResourceLock resourceLock) {\n+        // Unlock outside the sync as there is no need to do it inside.\n+        resourceLock.reentrantLock.writeLock().unlock();\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Decrement the usage count and remove ResourceLocks no longer required inside the sync to ensure that that\n+             * map always has a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            if (resourceLock.count.decrementAndGet() == 0) {\n+                resourceLocksByPath.remove(resourceLock.key);\n+            }\n+        }\n+    }\n }"
            },
            {
                "sha": "354022f9096d7724f7290878bee712f3c8e35ea7",
                "filename": "java/org/apache/catalina/webresources/FileResource.java",
                "status": "modified",
                "additions": 28,
                "deletions": 1,
                "changes": 29,
                "blob_url": "https://github.com/apache/tomcat/blob/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FFileResource.java",
                "raw_url": "https://github.com/apache/tomcat/raw/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FFileResource.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FFileResource.java?ref=8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2",
                "patch": "@@ -31,6 +31,8 @@\n import java.security.cert.Certificate;\n import java.util.jar.Manifest;\n \n+import org.apache.catalina.WebResourceLockSet;\n+import org.apache.catalina.WebResourceLockSet.ResourceLock;\n import org.apache.catalina.WebResourceRoot;\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n@@ -62,10 +64,20 @@ public class FileResource extends AbstractResource {\n     private final boolean readOnly;\n     private final Manifest manifest;\n     private final boolean needConvert;\n+    private final WebResourceLockSet lockSet;\n+    private final String lockKey;\n \n     public FileResource(WebResourceRoot root, String webAppPath, File resource, boolean readOnly, Manifest manifest) {\n+        this(root, webAppPath, resource, readOnly, manifest, null, null);\n+    }\n+\n+\n+    public FileResource(WebResourceRoot root, String webAppPath, File resource, boolean readOnly, Manifest manifest,\n+            WebResourceLockSet lockSet, String lockKey) {\n         super(root, webAppPath);\n         this.resource = resource;\n+        this.lockSet = lockSet;\n+        this.lockKey = lockKey;\n \n         if (webAppPath.charAt(webAppPath.length() - 1) == '/') {\n             String realName = resource.getName() + '/';\n@@ -117,7 +129,22 @@ public boolean delete() {\n         if (readOnly) {\n             return false;\n         }\n-        return resource.delete();\n+        /*\n+         * Lock the path for writing until the delete is complete. The lock prevents concurrent reads and writes (e.g.\n+         * HTTP GET and PUT / DELETE) for the same path causing corruption of the FileResource where some of the fields\n+         * are set as if the file exists and some as set as if it does not.\n+         */\n+        ResourceLock lock = null;\n+        if (lockSet != null) {\n+            lock = lockSet.lockForWrite(lockKey);\n+        }\n+        try {\n+            return resource.delete();\n+        } finally {\n+            if (lockSet != null) {\n+                lockSet.unlockForWrite(lock);\n+            }\n+        }\n     }\n \n     @Override"
            },
            {
                "sha": "301c13eb806329f535c23bdef16218e1c2a54f60",
                "filename": "java/org/apache/catalina/webresources/LocalStrings.properties",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/tomcat/blob/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FLocalStrings.properties",
                "raw_url": "https://github.com/apache/tomcat/raw/8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FLocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FLocalStrings.properties?ref=8554f6b1722b33a2ce8b0a3fad37825f3a75f2d2",
                "patch": "@@ -36,6 +36,7 @@ cachedResource.invalidURL=Unable to create an instance of CachedResourceURLStrea\n \n classpathUrlStreamHandler.notFound=Unable to load the resource [{0}] using the thread context class loader or the current class''s class loader\n \n+dirResourceSet.isCaseSensitive.fail=Error trying to determine if file system at [{0}] is case sensitive so assuming it is not case sensitive\n dirResourceSet.manifestFail=Failed to read manifest from [{0}]\n dirResourceSet.notDirectory=The directory specified by base and internal path [{0}]{1}[{2}] does not exist.\n dirResourceSet.writeNpe=The input stream may not be null"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/684247ae85fa633b9197b32391de59fc54703842",
        "url": "https://api.github.com/repos/apache/tomcat/commits/684247ae85fa633b9197b32391de59fc54703842",
        "html_url": "https://github.com/apache/tomcat/commit/684247ae85fa633b9197b32391de59fc54703842",
        "message": "Fix for inconsistent metadata was incomplete\n\nNeed to add key to map once created so it is visible to other threads",
        "files": [
            {
                "sha": "f1d4e86199ee002b0fa57aa342f0818ad9f4f28c",
                "filename": "java/org/apache/catalina/webresources/DirResourceSet.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/684247ae85fa633b9197b32391de59fc54703842/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "raw_url": "https://github.com/apache/tomcat/raw/684247ae85fa633b9197b32391de59fc54703842/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java?ref=684247ae85fa633b9197b32391de59fc54703842",
                "patch": "@@ -382,6 +382,7 @@ public ResourceLock lockForRead(String path) {\n             resourceLock = resourceLocksByPath.get(key);\n             if (resourceLock == null) {\n                 resourceLock = new ResourceLock(key);\n+                resourceLocksByPath.put(key, resourceLock);\n             }\n             resourceLock.count.incrementAndGet();\n         }\n@@ -419,6 +420,7 @@ public ResourceLock lockForWrite(String path) {\n             resourceLock = resourceLocksByPath.get(key);\n             if (resourceLock == null) {\n                 resourceLock = new ResourceLock(key);\n+                resourceLocksByPath.put(key, resourceLock);\n             }\n             resourceLock.count.incrementAndGet();\n         }"
            },
            {
                "sha": "1e3c16f9264be36dd201f9406ff23e5f0be99e91",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/684247ae85fa633b9197b32391de59fc54703842/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/684247ae85fa633b9197b32391de59fc54703842/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=684247ae85fa633b9197b32391de59fc54703842",
                "patch": "@@ -128,6 +128,10 @@\n         constructors or property related methods throw a checked exception.\n         (remm)\n       </fix>\n+      <fix>\n+        The previous fix for incosistent resource metadata during concurrent\n+        reads and writes was incomplete. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/631500b0c9b2a2a2abb707e3de2e10a5936e5d41",
        "url": "https://api.github.com/repos/apache/tomcat/commits/631500b0c9b2a2a2abb707e3de2e10a5936e5d41",
        "html_url": "https://github.com/apache/tomcat/commit/631500b0c9b2a2a2abb707e3de2e10a5936e5d41",
        "message": "Fix for inconsistent metadata was incomplete\n\nNeed to add key to map once created so it is visible to other threads",
        "files": [
            {
                "sha": "f1d4e86199ee002b0fa57aa342f0818ad9f4f28c",
                "filename": "java/org/apache/catalina/webresources/DirResourceSet.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/631500b0c9b2a2a2abb707e3de2e10a5936e5d41/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "raw_url": "https://github.com/apache/tomcat/raw/631500b0c9b2a2a2abb707e3de2e10a5936e5d41/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java?ref=631500b0c9b2a2a2abb707e3de2e10a5936e5d41",
                "patch": "@@ -382,6 +382,7 @@ public ResourceLock lockForRead(String path) {\n             resourceLock = resourceLocksByPath.get(key);\n             if (resourceLock == null) {\n                 resourceLock = new ResourceLock(key);\n+                resourceLocksByPath.put(key, resourceLock);\n             }\n             resourceLock.count.incrementAndGet();\n         }\n@@ -419,6 +420,7 @@ public ResourceLock lockForWrite(String path) {\n             resourceLock = resourceLocksByPath.get(key);\n             if (resourceLock == null) {\n                 resourceLock = new ResourceLock(key);\n+                resourceLocksByPath.put(key, resourceLock);\n             }\n             resourceLock.count.incrementAndGet();\n         }"
            },
            {
                "sha": "7f2fa714377bd7ac8a37168fb1886f15fc4154c7",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/631500b0c9b2a2a2abb707e3de2e10a5936e5d41/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/631500b0c9b2a2a2abb707e3de2e10a5936e5d41/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=631500b0c9b2a2a2abb707e3de2e10a5936e5d41",
                "patch": "@@ -128,6 +128,10 @@\n         constructors or property related methods throw a checked exception.\n         (remm)\n       </fix>\n+      <fix>\n+        The previous fix for incosistent resource metadata during concurrent\n+        reads and writes was incomplete. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/cc7a98b57c6dc1df21979fcff94a36e068f4456c",
        "url": "https://api.github.com/repos/apache/tomcat/commits/cc7a98b57c6dc1df21979fcff94a36e068f4456c",
        "html_url": "https://github.com/apache/tomcat/commit/cc7a98b57c6dc1df21979fcff94a36e068f4456c",
        "message": "Fix inconsistent resource metadata with current GET and PUT/DELETE\n\nConcurrent reads and writes (e.g. HTTP GET and PUT / DELETE) for the\nsame path cause corruption of the FileResource where some of the fields\nare set as if the file exists and some as set as if it does not.",
        "files": [
            {
                "sha": "142472c33cd6f8fac922889d1fb84f54429cf87e",
                "filename": "java/org/apache/catalina/WebResourceLockSet.java",
                "status": "added",
                "additions": 73,
                "deletions": 0,
                "changes": 73,
                "blob_url": "https://github.com/apache/tomcat/blob/cc7a98b57c6dc1df21979fcff94a36e068f4456c/java%2Forg%2Fapache%2Fcatalina%2FWebResourceLockSet.java",
                "raw_url": "https://github.com/apache/tomcat/raw/cc7a98b57c6dc1df21979fcff94a36e068f4456c/java%2Forg%2Fapache%2Fcatalina%2FWebResourceLockSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2FWebResourceLockSet.java?ref=cc7a98b57c6dc1df21979fcff94a36e068f4456c",
                "patch": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.catalina;\n+\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.concurrent.locks.ReentrantReadWriteLock;\n+\n+/**\n+ * Interface implemented by {@link WebResourceSet} implementations that wish to provide locking functionality.\n+ */\n+public interface WebResourceLockSet {\n+\n+    /**\n+     * Lock the resource at the provided path for reading. The resource is not required to exist. Read locks are not\n+     * exclusive.\n+     *\n+     * @param path The path to the resource to be locked for reading\n+     *\n+     * @return The {@link ResourceLock} that must be passed to {@link #unlockForRead(ResourceLock)} to release the lock\n+     */\n+    ResourceLock lockForRead(String path);\n+\n+    /**\n+     * Release a read lock from the resource associated with the given {@link ResourceLock}.\n+     *\n+     * @param resourceLock The {@link ResourceLock} associated with the resource for which a read lock should be\n+     *                         released\n+     */\n+    void unlockForRead(ResourceLock resourceLock);\n+\n+    /**\n+     * Lock the resource at the provided path for writing. The resource is not required to exist. Write locks are\n+     * exclusive.\n+     *\n+     * @param path The path to the resource to be locked for writing\n+     *\n+     * @return The {@link ResourceLock} that must be passed to {@link #unlockForWrite(ResourceLock)} to release the lock\n+     */\n+    ResourceLock lockForWrite(String path);\n+\n+    /**\n+     * Release the write lock from the resource associated with the given {@link ResourceLock}.\n+     *\n+     * @param resourceLock The {@link ResourceLock} associated with the resource for which the write lock should be\n+     *                         released\n+     */\n+    void unlockForWrite(ResourceLock resourceLock);\n+\n+\n+    class ResourceLock {\n+        public final AtomicInteger count = new AtomicInteger(0);\n+        public final ReentrantReadWriteLock reentrantLock = new ReentrantReadWriteLock();\n+        public final String key;\n+\n+        public ResourceLock(String key) {\n+            this.key = key;\n+        }\n+    }\n+}"
            },
            {
                "sha": "02ddc6ec887cc023f6696de9f19546563c6b9c54",
                "filename": "java/org/apache/catalina/webresources/DirResourceSet.java",
                "status": "modified",
                "additions": 171,
                "deletions": 28,
                "changes": 199,
                "blob_url": "https://github.com/apache/tomcat/blob/cc7a98b57c6dc1df21979fcff94a36e068f4456c/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "raw_url": "https://github.com/apache/tomcat/raw/cc7a98b57c6dc1df21979fcff94a36e068f4456c/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java?ref=cc7a98b57c6dc1df21979fcff94a36e068f4456c",
                "patch": "@@ -22,24 +22,35 @@\n import java.io.InputStream;\n import java.nio.file.Files;\n import java.nio.file.StandardCopyOption;\n+import java.util.HashMap;\n+import java.util.Locale;\n+import java.util.Map;\n import java.util.Set;\n import java.util.jar.Manifest;\n \n import org.apache.catalina.LifecycleException;\n import org.apache.catalina.WebResource;\n+import org.apache.catalina.WebResourceLockSet;\n import org.apache.catalina.WebResourceRoot;\n import org.apache.catalina.WebResourceRoot.ResourceSetType;\n import org.apache.catalina.util.ResourceSet;\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n+import org.apache.tomcat.util.http.RequestUtil;\n \n /**\n  * Represents a {@link org.apache.catalina.WebResourceSet} based on a directory.\n  */\n-public class DirResourceSet extends AbstractFileResourceSet {\n+public class DirResourceSet extends AbstractFileResourceSet implements WebResourceLockSet {\n \n     private static final Log log = LogFactory.getLog(DirResourceSet.class);\n \n+    private boolean caseSensitive = true;\n+\n+    private Map<String,ResourceLock> resourceLocksByPath = new HashMap<>();\n+    private Object resourceLocksByPathLock = new Object();\n+\n+\n     /**\n      * A no argument constructor is required for this to work with the digester.\n      */\n@@ -91,22 +102,33 @@ public WebResource getResource(String path) {\n         String webAppMount = getWebAppMount();\n         WebResourceRoot root = getRoot();\n         if (path.startsWith(webAppMount)) {\n-            File f = file(path.substring(webAppMount.length()), false);\n-            if (f == null) {\n-                return new EmptyResource(root, path);\n-            }\n-            if (!f.exists()) {\n-                return new EmptyResource(root, path, f);\n-            }\n-            if (f.isDirectory() && path.charAt(path.length() - 1) != '/') {\n-                path = path + '/';\n+            /*\n+             * Lock the path for reading until the WebResource has been constructed. The lock prevents concurrent reads\n+             * and writes (e.g. HTTP GET and PUT / DELETE) for the same path causing corruption of the FileResource\n+             * where some of the fields are set as if the file exists and some as set as if it does not.\n+             */\n+            ResourceLock lock = lockForRead(path);\n+            try {\n+                File f = file(path.substring(webAppMount.length()), false);\n+                if (f == null) {\n+                    return new EmptyResource(root, path);\n+                }\n+                if (!f.exists()) {\n+                    return new EmptyResource(root, path, f);\n+                }\n+                if (f.isDirectory() && path.charAt(path.length() - 1) != '/') {\n+                    path = path + '/';\n+                }\n+                return new FileResource(root, path, f, isReadOnly(), getManifest(), this, lock.key);\n+            } finally {\n+                unlockForRead(lock);\n             }\n-            return new FileResource(root, path, f, isReadOnly(), getManifest());\n         } else {\n             return new EmptyResource(root, path);\n         }\n     }\n \n+\n     @Override\n     public String[] list(String path) {\n         checkPath(path);\n@@ -246,32 +268,42 @@ public boolean write(String path, InputStream is, boolean overwrite) {\n             return false;\n         }\n \n-        File dest = null;\n         String webAppMount = getWebAppMount();\n-        if (path.startsWith(webAppMount)) {\n+        if (!path.startsWith(webAppMount)) {\n+            return false;\n+        }\n+\n+        File dest = null;\n+        /*\n+         * Lock the path for writing until the write is complete. The lock prevents concurrent reads and writes (e.g.\n+         * HTTP GET and PUT / DELETE) for the same path causing corruption of the FileResource where some of the fields\n+         * are set as if the file exists and some as set as if it does not.\n+         */\n+        ResourceLock lock = lockForWrite(path);\n+        try {\n             dest = file(path.substring(webAppMount.length()), false);\n             if (dest == null) {\n                 return false;\n             }\n-        } else {\n-            return false;\n-        }\n \n-        if (dest.exists() && !overwrite) {\n-            return false;\n-        }\n+            if (dest.exists() && !overwrite) {\n+                return false;\n+            }\n \n-        try {\n-            if (overwrite) {\n-                Files.copy(is, dest.toPath(), StandardCopyOption.REPLACE_EXISTING);\n-            } else {\n-                Files.copy(is, dest.toPath());\n+            try {\n+                if (overwrite) {\n+                    Files.copy(is, dest.toPath(), StandardCopyOption.REPLACE_EXISTING);\n+                } else {\n+                    Files.copy(is, dest.toPath());\n+                }\n+            } catch (IOException ioe) {\n+                return false;\n             }\n-        } catch (IOException ioe) {\n-            return false;\n-        }\n \n-        return true;\n+            return true;\n+        } finally {\n+            unlockForWrite(lock);\n+        }\n     }\n \n     @Override\n@@ -286,6 +318,7 @@ protected void checkType(File file) {\n     @Override\n     protected void initInternal() throws LifecycleException {\n         super.initInternal();\n+        caseSensitive = isCaseSensitive();\n         // Is this an exploded web application?\n         if (getWebAppMount().equals(\"\")) {\n             // Look for a manifest\n@@ -299,4 +332,114 @@ protected void initInternal() throws LifecycleException {\n             }\n         }\n     }\n+\n+\n+    /*\n+     * Determines if this ResourceSet is based on a case sensitive file system or not.\n+     */\n+    private boolean isCaseSensitive() {\n+        try {\n+            String canonicalPath = getFileBase().getCanonicalPath();\n+            File upper = new File(canonicalPath.toUpperCase(Locale.ENGLISH));\n+            if (!canonicalPath.equals(upper.getCanonicalPath())) {\n+                return true;\n+            }\n+            File lower = new File(canonicalPath.toLowerCase(Locale.ENGLISH));\n+            if (!canonicalPath.equals(lower.getCanonicalPath())) {\n+                return true;\n+            }\n+            /*\n+             * Both upper and lower case versions of the current fileBase have the same canonical path so the file\n+             * system must be case insensitive.\n+             */\n+        } catch (IOException ioe) {\n+            log.warn(sm.getString(\"dirResourceSet.isCaseSensitive.fail\", getFileBase().getAbsolutePath()), ioe);\n+        }\n+\n+        return false;\n+    }\n+\n+\n+    private String getLockKey(String path) {\n+        // Normalize path to ensure that the same key is used for the same path.\n+        String normalisedPath = RequestUtil.normalize(path);\n+        if (caseSensitive) {\n+            return normalisedPath;\n+        }\n+        return normalisedPath.toLowerCase(Locale.ENGLISH);\n+    }\n+\n+\n+    @Override\n+    public ResourceLock lockForRead(String path) {\n+        String key = getLockKey(path);\n+        ResourceLock resourceLock = null;\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Obtain the ResourceLock and increment the usage count inside the sync to ensure that that map always has\n+             * a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            resourceLock = resourceLocksByPath.get(key);\n+            if (resourceLock == null) {\n+                resourceLock = new ResourceLock(key);\n+            }\n+            resourceLock.count.incrementAndGet();\n+        }\n+        // Obtain the lock outside the sync as it will block if there is a current write lock.\n+        resourceLock.reentrantLock.readLock().lock();\n+        return resourceLock;\n+    }\n+\n+\n+    @Override\n+    public void unlockForRead(ResourceLock resourceLock) {\n+        // Unlock outside the sync as there is no need to do it inside.\n+        resourceLock.reentrantLock.readLock().unlock();\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Decrement the usage count and remove ResourceLocks no longer required inside the sync to ensure that that\n+             * map always has a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            if (resourceLock.count.decrementAndGet() == 0) {\n+                resourceLocksByPath.remove(resourceLock.key);\n+            }\n+        }\n+    }\n+\n+\n+    @Override\n+    public ResourceLock lockForWrite(String path) {\n+        String key = getLockKey(path);\n+        ResourceLock resourceLock = null;\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Obtain the ResourceLock and increment the usage count inside the sync to ensure that that map always has\n+             * a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            resourceLock = resourceLocksByPath.get(key);\n+            if (resourceLock == null) {\n+                resourceLock = new ResourceLock(key);\n+            }\n+            resourceLock.count.incrementAndGet();\n+        }\n+        // Obtain the lock outside the sync as it will block if there are any other current locks.\n+        resourceLock.reentrantLock.writeLock().lock();\n+        return resourceLock;\n+    }\n+\n+\n+    @Override\n+    public void unlockForWrite(ResourceLock resourceLock) {\n+        // Unlock outside the sync as there is no need to do it inside.\n+        resourceLock.reentrantLock.writeLock().unlock();\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Decrement the usage count and remove ResourceLocks no longer required inside the sync to ensure that that\n+             * map always has a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            if (resourceLock.count.decrementAndGet() == 0) {\n+                resourceLocksByPath.remove(resourceLock.key);\n+            }\n+        }\n+    }\n }"
            },
            {
                "sha": "f109893d9e00582121043e2830f160b69cb98bf2",
                "filename": "java/org/apache/catalina/webresources/FileResource.java",
                "status": "modified",
                "additions": 28,
                "deletions": 1,
                "changes": 29,
                "blob_url": "https://github.com/apache/tomcat/blob/cc7a98b57c6dc1df21979fcff94a36e068f4456c/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FFileResource.java",
                "raw_url": "https://github.com/apache/tomcat/raw/cc7a98b57c6dc1df21979fcff94a36e068f4456c/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FFileResource.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FFileResource.java?ref=cc7a98b57c6dc1df21979fcff94a36e068f4456c",
                "patch": "@@ -31,6 +31,8 @@\n import java.security.cert.Certificate;\n import java.util.jar.Manifest;\n \n+import org.apache.catalina.WebResourceLockSet;\n+import org.apache.catalina.WebResourceLockSet.ResourceLock;\n import org.apache.catalina.WebResourceRoot;\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n@@ -62,10 +64,20 @@ public class FileResource extends AbstractResource {\n     private final boolean readOnly;\n     private final Manifest manifest;\n     private final boolean needConvert;\n+    private final WebResourceLockSet lockSet;\n+    private final String lockKey;\n \n     public FileResource(WebResourceRoot root, String webAppPath, File resource, boolean readOnly, Manifest manifest) {\n+        this(root, webAppPath, resource, readOnly, manifest, null, null);\n+    }\n+\n+\n+    public FileResource(WebResourceRoot root, String webAppPath, File resource, boolean readOnly, Manifest manifest,\n+            WebResourceLockSet lockSet, String lockKey) {\n         super(root, webAppPath);\n         this.resource = resource;\n+        this.lockSet = lockSet;\n+        this.lockKey = lockKey;\n \n         if (webAppPath.charAt(webAppPath.length() - 1) == '/') {\n             String realName = resource.getName() + '/';\n@@ -117,7 +129,22 @@ public boolean delete() {\n         if (readOnly) {\n             return false;\n         }\n-        return resource.delete();\n+        /*\n+         * Lock the path for writing until the delete is complete. The lock prevents concurrent reads and writes (e.g.\n+         * HTTP GET and PUT / DELETE) for the same path causing corruption of the FileResource where some of the fields\n+         * are set as if the file exists and some as set as if it does not.\n+         */\n+        ResourceLock lock = null;\n+        if (lockSet != null) {\n+            lock = lockSet.lockForWrite(lockKey);\n+        }\n+        try {\n+            return resource.delete();\n+        } finally {\n+            if (lockSet != null) {\n+                lockSet.unlockForWrite(lock);\n+            }\n+        }\n     }\n \n     @Override"
            },
            {
                "sha": "70d4847faa0265a20aa04f3111a4c86df51dd902",
                "filename": "java/org/apache/catalina/webresources/LocalStrings.properties",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/tomcat/blob/cc7a98b57c6dc1df21979fcff94a36e068f4456c/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FLocalStrings.properties",
                "raw_url": "https://github.com/apache/tomcat/raw/cc7a98b57c6dc1df21979fcff94a36e068f4456c/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FLocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FLocalStrings.properties?ref=cc7a98b57c6dc1df21979fcff94a36e068f4456c",
                "patch": "@@ -33,6 +33,7 @@ cachedResource.invalidURL=Unable to create an instance of CachedResourceURLStrea\n \n classpathUrlStreamHandler.notFound=Unable to load the resource [{0}] using the thread context class loader or the current class''s class loader\n \n+dirResourceSet.isCaseSensitive.fail=Error trying to determine if file system at [{0}] is case sensitive so assuming it is not case sensitive\n dirResourceSet.manifestFail=Failed to read manifest from [{0}]\n dirResourceSet.notDirectory=The directory specified by base and internal path [{0}]{1}[{2}] does not exist.\n dirResourceSet.writeNpe=The input stream may not be null"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/05ddeeaa54df1e2dc427d0164bedd6b79f78d81f",
        "url": "https://api.github.com/repos/apache/tomcat/commits/05ddeeaa54df1e2dc427d0164bedd6b79f78d81f",
        "html_url": "https://github.com/apache/tomcat/commit/05ddeeaa54df1e2dc427d0164bedd6b79f78d81f",
        "message": "Fix for inconsistent metadata was incomplete\n\nNeed to add key to map once created so it is visible to other threads",
        "files": [
            {
                "sha": "f1d4e86199ee002b0fa57aa342f0818ad9f4f28c",
                "filename": "java/org/apache/catalina/webresources/DirResourceSet.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/05ddeeaa54df1e2dc427d0164bedd6b79f78d81f/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "raw_url": "https://github.com/apache/tomcat/raw/05ddeeaa54df1e2dc427d0164bedd6b79f78d81f/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java?ref=05ddeeaa54df1e2dc427d0164bedd6b79f78d81f",
                "patch": "@@ -382,6 +382,7 @@ public ResourceLock lockForRead(String path) {\n             resourceLock = resourceLocksByPath.get(key);\n             if (resourceLock == null) {\n                 resourceLock = new ResourceLock(key);\n+                resourceLocksByPath.put(key, resourceLock);\n             }\n             resourceLock.count.incrementAndGet();\n         }\n@@ -419,6 +420,7 @@ public ResourceLock lockForWrite(String path) {\n             resourceLock = resourceLocksByPath.get(key);\n             if (resourceLock == null) {\n                 resourceLock = new ResourceLock(key);\n+                resourceLocksByPath.put(key, resourceLock);\n             }\n             resourceLock.count.incrementAndGet();\n         }"
            },
            {
                "sha": "17cc2c96b71205a0223ff9ca21b6b44c82c2c8d3",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/tomcat/blob/05ddeeaa54df1e2dc427d0164bedd6b79f78d81f/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/05ddeeaa54df1e2dc427d0164bedd6b79f78d81f/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=05ddeeaa54df1e2dc427d0164bedd6b79f78d81f",
                "patch": "@@ -128,6 +128,10 @@\n         constructors or property related methods throw a checked exception.\n         (remm)\n       </fix>\n+      <fix>\n+        The previous fix for incosistent resource metadata during concurrent\n+        reads and writes was incomplete. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Coyote\">"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/43b507ebac9d268b1ea3d908e296cc6e46795c00",
        "url": "https://api.github.com/repos/apache/tomcat/commits/43b507ebac9d268b1ea3d908e296cc6e46795c00",
        "html_url": "https://github.com/apache/tomcat/commit/43b507ebac9d268b1ea3d908e296cc6e46795c00",
        "message": "Fix inconsistent resource metadata with current GET and PUT/DELETE\n\nConcurrent reads and writes (e.g. HTTP GET and PUT / DELETE) for the\nsame path cause corruption of the FileResource where some of the fields\nare set as if the file exists and some as set as if it does not.",
        "files": [
            {
                "sha": "142472c33cd6f8fac922889d1fb84f54429cf87e",
                "filename": "java/org/apache/catalina/WebResourceLockSet.java",
                "status": "added",
                "additions": 73,
                "deletions": 0,
                "changes": 73,
                "blob_url": "https://github.com/apache/tomcat/blob/43b507ebac9d268b1ea3d908e296cc6e46795c00/java%2Forg%2Fapache%2Fcatalina%2FWebResourceLockSet.java",
                "raw_url": "https://github.com/apache/tomcat/raw/43b507ebac9d268b1ea3d908e296cc6e46795c00/java%2Forg%2Fapache%2Fcatalina%2FWebResourceLockSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2FWebResourceLockSet.java?ref=43b507ebac9d268b1ea3d908e296cc6e46795c00",
                "patch": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.catalina;\n+\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.concurrent.locks.ReentrantReadWriteLock;\n+\n+/**\n+ * Interface implemented by {@link WebResourceSet} implementations that wish to provide locking functionality.\n+ */\n+public interface WebResourceLockSet {\n+\n+    /**\n+     * Lock the resource at the provided path for reading. The resource is not required to exist. Read locks are not\n+     * exclusive.\n+     *\n+     * @param path The path to the resource to be locked for reading\n+     *\n+     * @return The {@link ResourceLock} that must be passed to {@link #unlockForRead(ResourceLock)} to release the lock\n+     */\n+    ResourceLock lockForRead(String path);\n+\n+    /**\n+     * Release a read lock from the resource associated with the given {@link ResourceLock}.\n+     *\n+     * @param resourceLock The {@link ResourceLock} associated with the resource for which a read lock should be\n+     *                         released\n+     */\n+    void unlockForRead(ResourceLock resourceLock);\n+\n+    /**\n+     * Lock the resource at the provided path for writing. The resource is not required to exist. Write locks are\n+     * exclusive.\n+     *\n+     * @param path The path to the resource to be locked for writing\n+     *\n+     * @return The {@link ResourceLock} that must be passed to {@link #unlockForWrite(ResourceLock)} to release the lock\n+     */\n+    ResourceLock lockForWrite(String path);\n+\n+    /**\n+     * Release the write lock from the resource associated with the given {@link ResourceLock}.\n+     *\n+     * @param resourceLock The {@link ResourceLock} associated with the resource for which the write lock should be\n+     *                         released\n+     */\n+    void unlockForWrite(ResourceLock resourceLock);\n+\n+\n+    class ResourceLock {\n+        public final AtomicInteger count = new AtomicInteger(0);\n+        public final ReentrantReadWriteLock reentrantLock = new ReentrantReadWriteLock();\n+        public final String key;\n+\n+        public ResourceLock(String key) {\n+            this.key = key;\n+        }\n+    }\n+}"
            },
            {
                "sha": "02ddc6ec887cc023f6696de9f19546563c6b9c54",
                "filename": "java/org/apache/catalina/webresources/DirResourceSet.java",
                "status": "modified",
                "additions": 171,
                "deletions": 28,
                "changes": 199,
                "blob_url": "https://github.com/apache/tomcat/blob/43b507ebac9d268b1ea3d908e296cc6e46795c00/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "raw_url": "https://github.com/apache/tomcat/raw/43b507ebac9d268b1ea3d908e296cc6e46795c00/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FDirResourceSet.java?ref=43b507ebac9d268b1ea3d908e296cc6e46795c00",
                "patch": "@@ -22,24 +22,35 @@\n import java.io.InputStream;\n import java.nio.file.Files;\n import java.nio.file.StandardCopyOption;\n+import java.util.HashMap;\n+import java.util.Locale;\n+import java.util.Map;\n import java.util.Set;\n import java.util.jar.Manifest;\n \n import org.apache.catalina.LifecycleException;\n import org.apache.catalina.WebResource;\n+import org.apache.catalina.WebResourceLockSet;\n import org.apache.catalina.WebResourceRoot;\n import org.apache.catalina.WebResourceRoot.ResourceSetType;\n import org.apache.catalina.util.ResourceSet;\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n+import org.apache.tomcat.util.http.RequestUtil;\n \n /**\n  * Represents a {@link org.apache.catalina.WebResourceSet} based on a directory.\n  */\n-public class DirResourceSet extends AbstractFileResourceSet {\n+public class DirResourceSet extends AbstractFileResourceSet implements WebResourceLockSet {\n \n     private static final Log log = LogFactory.getLog(DirResourceSet.class);\n \n+    private boolean caseSensitive = true;\n+\n+    private Map<String,ResourceLock> resourceLocksByPath = new HashMap<>();\n+    private Object resourceLocksByPathLock = new Object();\n+\n+\n     /**\n      * A no argument constructor is required for this to work with the digester.\n      */\n@@ -91,22 +102,33 @@ public WebResource getResource(String path) {\n         String webAppMount = getWebAppMount();\n         WebResourceRoot root = getRoot();\n         if (path.startsWith(webAppMount)) {\n-            File f = file(path.substring(webAppMount.length()), false);\n-            if (f == null) {\n-                return new EmptyResource(root, path);\n-            }\n-            if (!f.exists()) {\n-                return new EmptyResource(root, path, f);\n-            }\n-            if (f.isDirectory() && path.charAt(path.length() - 1) != '/') {\n-                path = path + '/';\n+            /*\n+             * Lock the path for reading until the WebResource has been constructed. The lock prevents concurrent reads\n+             * and writes (e.g. HTTP GET and PUT / DELETE) for the same path causing corruption of the FileResource\n+             * where some of the fields are set as if the file exists and some as set as if it does not.\n+             */\n+            ResourceLock lock = lockForRead(path);\n+            try {\n+                File f = file(path.substring(webAppMount.length()), false);\n+                if (f == null) {\n+                    return new EmptyResource(root, path);\n+                }\n+                if (!f.exists()) {\n+                    return new EmptyResource(root, path, f);\n+                }\n+                if (f.isDirectory() && path.charAt(path.length() - 1) != '/') {\n+                    path = path + '/';\n+                }\n+                return new FileResource(root, path, f, isReadOnly(), getManifest(), this, lock.key);\n+            } finally {\n+                unlockForRead(lock);\n             }\n-            return new FileResource(root, path, f, isReadOnly(), getManifest());\n         } else {\n             return new EmptyResource(root, path);\n         }\n     }\n \n+\n     @Override\n     public String[] list(String path) {\n         checkPath(path);\n@@ -246,32 +268,42 @@ public boolean write(String path, InputStream is, boolean overwrite) {\n             return false;\n         }\n \n-        File dest = null;\n         String webAppMount = getWebAppMount();\n-        if (path.startsWith(webAppMount)) {\n+        if (!path.startsWith(webAppMount)) {\n+            return false;\n+        }\n+\n+        File dest = null;\n+        /*\n+         * Lock the path for writing until the write is complete. The lock prevents concurrent reads and writes (e.g.\n+         * HTTP GET and PUT / DELETE) for the same path causing corruption of the FileResource where some of the fields\n+         * are set as if the file exists and some as set as if it does not.\n+         */\n+        ResourceLock lock = lockForWrite(path);\n+        try {\n             dest = file(path.substring(webAppMount.length()), false);\n             if (dest == null) {\n                 return false;\n             }\n-        } else {\n-            return false;\n-        }\n \n-        if (dest.exists() && !overwrite) {\n-            return false;\n-        }\n+            if (dest.exists() && !overwrite) {\n+                return false;\n+            }\n \n-        try {\n-            if (overwrite) {\n-                Files.copy(is, dest.toPath(), StandardCopyOption.REPLACE_EXISTING);\n-            } else {\n-                Files.copy(is, dest.toPath());\n+            try {\n+                if (overwrite) {\n+                    Files.copy(is, dest.toPath(), StandardCopyOption.REPLACE_EXISTING);\n+                } else {\n+                    Files.copy(is, dest.toPath());\n+                }\n+            } catch (IOException ioe) {\n+                return false;\n             }\n-        } catch (IOException ioe) {\n-            return false;\n-        }\n \n-        return true;\n+            return true;\n+        } finally {\n+            unlockForWrite(lock);\n+        }\n     }\n \n     @Override\n@@ -286,6 +318,7 @@ protected void checkType(File file) {\n     @Override\n     protected void initInternal() throws LifecycleException {\n         super.initInternal();\n+        caseSensitive = isCaseSensitive();\n         // Is this an exploded web application?\n         if (getWebAppMount().equals(\"\")) {\n             // Look for a manifest\n@@ -299,4 +332,114 @@ protected void initInternal() throws LifecycleException {\n             }\n         }\n     }\n+\n+\n+    /*\n+     * Determines if this ResourceSet is based on a case sensitive file system or not.\n+     */\n+    private boolean isCaseSensitive() {\n+        try {\n+            String canonicalPath = getFileBase().getCanonicalPath();\n+            File upper = new File(canonicalPath.toUpperCase(Locale.ENGLISH));\n+            if (!canonicalPath.equals(upper.getCanonicalPath())) {\n+                return true;\n+            }\n+            File lower = new File(canonicalPath.toLowerCase(Locale.ENGLISH));\n+            if (!canonicalPath.equals(lower.getCanonicalPath())) {\n+                return true;\n+            }\n+            /*\n+             * Both upper and lower case versions of the current fileBase have the same canonical path so the file\n+             * system must be case insensitive.\n+             */\n+        } catch (IOException ioe) {\n+            log.warn(sm.getString(\"dirResourceSet.isCaseSensitive.fail\", getFileBase().getAbsolutePath()), ioe);\n+        }\n+\n+        return false;\n+    }\n+\n+\n+    private String getLockKey(String path) {\n+        // Normalize path to ensure that the same key is used for the same path.\n+        String normalisedPath = RequestUtil.normalize(path);\n+        if (caseSensitive) {\n+            return normalisedPath;\n+        }\n+        return normalisedPath.toLowerCase(Locale.ENGLISH);\n+    }\n+\n+\n+    @Override\n+    public ResourceLock lockForRead(String path) {\n+        String key = getLockKey(path);\n+        ResourceLock resourceLock = null;\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Obtain the ResourceLock and increment the usage count inside the sync to ensure that that map always has\n+             * a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            resourceLock = resourceLocksByPath.get(key);\n+            if (resourceLock == null) {\n+                resourceLock = new ResourceLock(key);\n+            }\n+            resourceLock.count.incrementAndGet();\n+        }\n+        // Obtain the lock outside the sync as it will block if there is a current write lock.\n+        resourceLock.reentrantLock.readLock().lock();\n+        return resourceLock;\n+    }\n+\n+\n+    @Override\n+    public void unlockForRead(ResourceLock resourceLock) {\n+        // Unlock outside the sync as there is no need to do it inside.\n+        resourceLock.reentrantLock.readLock().unlock();\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Decrement the usage count and remove ResourceLocks no longer required inside the sync to ensure that that\n+             * map always has a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            if (resourceLock.count.decrementAndGet() == 0) {\n+                resourceLocksByPath.remove(resourceLock.key);\n+            }\n+        }\n+    }\n+\n+\n+    @Override\n+    public ResourceLock lockForWrite(String path) {\n+        String key = getLockKey(path);\n+        ResourceLock resourceLock = null;\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Obtain the ResourceLock and increment the usage count inside the sync to ensure that that map always has\n+             * a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            resourceLock = resourceLocksByPath.get(key);\n+            if (resourceLock == null) {\n+                resourceLock = new ResourceLock(key);\n+            }\n+            resourceLock.count.incrementAndGet();\n+        }\n+        // Obtain the lock outside the sync as it will block if there are any other current locks.\n+        resourceLock.reentrantLock.writeLock().lock();\n+        return resourceLock;\n+    }\n+\n+\n+    @Override\n+    public void unlockForWrite(ResourceLock resourceLock) {\n+        // Unlock outside the sync as there is no need to do it inside.\n+        resourceLock.reentrantLock.writeLock().unlock();\n+        synchronized (resourceLocksByPathLock) {\n+            /*\n+             * Decrement the usage count and remove ResourceLocks no longer required inside the sync to ensure that that\n+             * map always has a consistent view of the currently \"in-use\" ResourceLocks.\n+             */\n+            if (resourceLock.count.decrementAndGet() == 0) {\n+                resourceLocksByPath.remove(resourceLock.key);\n+            }\n+        }\n+    }\n }"
            },
            {
                "sha": "354022f9096d7724f7290878bee712f3c8e35ea7",
                "filename": "java/org/apache/catalina/webresources/FileResource.java",
                "status": "modified",
                "additions": 28,
                "deletions": 1,
                "changes": 29,
                "blob_url": "https://github.com/apache/tomcat/blob/43b507ebac9d268b1ea3d908e296cc6e46795c00/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FFileResource.java",
                "raw_url": "https://github.com/apache/tomcat/raw/43b507ebac9d268b1ea3d908e296cc6e46795c00/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FFileResource.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FFileResource.java?ref=43b507ebac9d268b1ea3d908e296cc6e46795c00",
                "patch": "@@ -31,6 +31,8 @@\n import java.security.cert.Certificate;\n import java.util.jar.Manifest;\n \n+import org.apache.catalina.WebResourceLockSet;\n+import org.apache.catalina.WebResourceLockSet.ResourceLock;\n import org.apache.catalina.WebResourceRoot;\n import org.apache.juli.logging.Log;\n import org.apache.juli.logging.LogFactory;\n@@ -62,10 +64,20 @@ public class FileResource extends AbstractResource {\n     private final boolean readOnly;\n     private final Manifest manifest;\n     private final boolean needConvert;\n+    private final WebResourceLockSet lockSet;\n+    private final String lockKey;\n \n     public FileResource(WebResourceRoot root, String webAppPath, File resource, boolean readOnly, Manifest manifest) {\n+        this(root, webAppPath, resource, readOnly, manifest, null, null);\n+    }\n+\n+\n+    public FileResource(WebResourceRoot root, String webAppPath, File resource, boolean readOnly, Manifest manifest,\n+            WebResourceLockSet lockSet, String lockKey) {\n         super(root, webAppPath);\n         this.resource = resource;\n+        this.lockSet = lockSet;\n+        this.lockKey = lockKey;\n \n         if (webAppPath.charAt(webAppPath.length() - 1) == '/') {\n             String realName = resource.getName() + '/';\n@@ -117,7 +129,22 @@ public boolean delete() {\n         if (readOnly) {\n             return false;\n         }\n-        return resource.delete();\n+        /*\n+         * Lock the path for writing until the delete is complete. The lock prevents concurrent reads and writes (e.g.\n+         * HTTP GET and PUT / DELETE) for the same path causing corruption of the FileResource where some of the fields\n+         * are set as if the file exists and some as set as if it does not.\n+         */\n+        ResourceLock lock = null;\n+        if (lockSet != null) {\n+            lock = lockSet.lockForWrite(lockKey);\n+        }\n+        try {\n+            return resource.delete();\n+        } finally {\n+            if (lockSet != null) {\n+                lockSet.unlockForWrite(lock);\n+            }\n+        }\n     }\n \n     @Override"
            },
            {
                "sha": "301c13eb806329f535c23bdef16218e1c2a54f60",
                "filename": "java/org/apache/catalina/webresources/LocalStrings.properties",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/tomcat/blob/43b507ebac9d268b1ea3d908e296cc6e46795c00/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FLocalStrings.properties",
                "raw_url": "https://github.com/apache/tomcat/raw/43b507ebac9d268b1ea3d908e296cc6e46795c00/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FLocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fwebresources%2FLocalStrings.properties?ref=43b507ebac9d268b1ea3d908e296cc6e46795c00",
                "patch": "@@ -36,6 +36,7 @@ cachedResource.invalidURL=Unable to create an instance of CachedResourceURLStrea\n \n classpathUrlStreamHandler.notFound=Unable to load the resource [{0}] using the thread context class loader or the current class''s class loader\n \n+dirResourceSet.isCaseSensitive.fail=Error trying to determine if file system at [{0}] is case sensitive so assuming it is not case sensitive\n dirResourceSet.manifestFail=Failed to read manifest from [{0}]\n dirResourceSet.notDirectory=The directory specified by base and internal path [{0}]{1}[{2}] does not exist.\n dirResourceSet.writeNpe=The input stream may not be null"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rizinorg/rizin/commits/c025dcee40c8eac2ab559f2caa3798a2dbf019e4",
        "url": "https://api.github.com/repos/rizinorg/rizin/commits/c025dcee40c8eac2ab559f2caa3798a2dbf019e4",
        "html_url": "https://github.com/rizinorg/rizin/commit/c025dcee40c8eac2ab559f2caa3798a2dbf019e4",
        "message": "DWARF: Fix ANSI Escape Sequence Injection vulns via DWARF (#4190)\n\n* DWARF: Fix ANSI Escape Sequence Injection vulns via DWARF\r\n* DWARF: Reduce one memory copy in rz_bin_dwarf_attr_string\r\n* DWARF: move Doxygen of `rz_bin_dwarf_attr_string` from the header to the implementation",
        "files": [
            {
                "sha": "be69a9ae98b306543138badca485f1a9654fd674",
                "filename": "librz/bin/dwarf/attr.c",
                "status": "modified",
                "additions": 23,
                "deletions": 0,
                "changes": 23,
                "blob_url": "https://github.com/rizinorg/rizin/blob/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/librz%2Fbin%2Fdwarf%2Fattr.c",
                "raw_url": "https://github.com/rizinorg/rizin/raw/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/librz%2Fbin%2Fdwarf%2Fattr.c",
                "contents_url": "https://api.github.com/repos/rizinorg/rizin/contents/librz%2Fbin%2Fdwarf%2Fattr.c?ref=c025dcee40c8eac2ab559f2caa3798a2dbf019e4",
                "patch": "@@ -237,3 +237,26 @@ RZ_IPI void RzBinDwarfAttr_fini(RzBinDwarfAttr *attr) {\n \t\tbreak;\n \t};\n }\n+\n+/**\n+ * \\brief Safely get the string from an RzBinDwarfAttrValue if it has one.\n+ */\n+RZ_API RZ_OWN char *rz_bin_dwarf_attr_string(\n+\tRZ_BORROW RZ_NONNULL const RzBinDwarfAttr *attr,\n+\tRZ_BORROW RZ_NULLABLE const RzBinDWARF *dw,\n+\tut64 str_offsets_base) {\n+\trz_return_val_if_fail(attr, NULL);\n+\n+\tconst RzBinDwarfAttrValue *v = &attr->value;\n+\tconst char *orig = NULL;\n+\tif (v->kind == RzBinDwarfAttr_String) {\n+\t\torig = v->string;\n+\t} else if (v->kind == RzBinDwarfAttr_StrRef && dw) {\n+\t\torig = rz_bin_dwarf_str_get(dw->str, v->u64);\n+\t} else if (v->kind == RzBinDwarfAttr_StrOffsetIndex && dw) {\n+\t\torig = rz_bin_dwarf_str_offsets_get(dw->str, dw->str_offsets, str_offsets_base, v->u64);\n+\t} else if (v->kind == RzBinDwarfAttr_LineStrRef && dw) {\n+\t\torig = rz_bin_dwarf_line_str_get(dw->line_str, v->u64);\n+\t}\n+\treturn str_escape_copy(orig);\n+}"
            },
            {
                "sha": "f936c04374c03929beaf91771ec5413dcdb55a25",
                "filename": "librz/bin/dwarf/dwarf_private.h",
                "status": "modified",
                "additions": 22,
                "deletions": 0,
                "changes": 22,
                "blob_url": "https://github.com/rizinorg/rizin/blob/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/librz%2Fbin%2Fdwarf%2Fdwarf_private.h",
                "raw_url": "https://github.com/rizinorg/rizin/raw/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/librz%2Fbin%2Fdwarf%2Fdwarf_private.h",
                "contents_url": "https://api.github.com/repos/rizinorg/rizin/contents/librz%2Fbin%2Fdwarf%2Fdwarf_private.h?ref=c025dcee40c8eac2ab559f2caa3798a2dbf019e4",
                "patch": "@@ -8,6 +8,28 @@\n #include <rz_bin_dwarf.h>\n #include \"macro.h\"\n \n+static inline char *str_escape_copy(const char *p) {\n+\tif (!p) {\n+\t\treturn NULL;\n+\t}\n+\tRzStrEscOptions opt = {\n+\t\t.dot_nl = true,\n+\t\t.esc_bslash = true,\n+\t\t.esc_double_quotes = true,\n+\t\t.show_asciidot = false\n+\t};\n+\treturn rz_str_escape_utf8(p, &opt);\n+}\n+\n+static inline void str_escape(char **p) {\n+\tif (!(p && *p)) {\n+\t\treturn;\n+\t}\n+\tchar *out = str_escape_copy(*p);\n+\tfree(*p);\n+\t*p = out;\n+}\n+\n typedef struct {\n \tut64 unit_offset;\n \tRzBinDwarfEncoding *encoding;"
            },
            {
                "sha": "c8882b4653c4e69c84f8cde2c5128f3b36421ded",
                "filename": "librz/bin/dwarf/endian_reader.c",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/rizinorg/rizin/blob/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/librz%2Fbin%2Fdwarf%2Fendian_reader.c",
                "raw_url": "https://github.com/rizinorg/rizin/raw/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/librz%2Fbin%2Fdwarf%2Fendian_reader.c",
                "contents_url": "https://api.github.com/repos/rizinorg/rizin/contents/librz%2Fbin%2Fdwarf%2Fendian_reader.c?ref=c025dcee40c8eac2ab559f2caa3798a2dbf019e4",
                "patch": "@@ -242,6 +242,7 @@ RZ_IPI char *read_string(RzBinEndianReader *reader) {\n \tRET_NULL_IF_FAIL(x);\n \tut64 len = strlen(x) + 1;\n \trz_buf_seek(reader->buffer, (st64)len, SEEK_CUR);\n+\tstr_escape(&x);\n \treturn x;\n }\n "
            },
            {
                "sha": "11c528bf5f3966c6157af5705761206074584a2e",
                "filename": "librz/include/rz_bin_dwarf.h",
                "status": "modified",
                "additions": 4,
                "deletions": 20,
                "changes": 24,
                "blob_url": "https://github.com/rizinorg/rizin/blob/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/librz%2Finclude%2Frz_bin_dwarf.h",
                "raw_url": "https://github.com/rizinorg/rizin/raw/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/librz%2Finclude%2Frz_bin_dwarf.h",
                "contents_url": "https://api.github.com/repos/rizinorg/rizin/contents/librz%2Finclude%2Frz_bin_dwarf.h?ref=c025dcee40c8eac2ab559f2caa3798a2dbf019e4",
                "patch": "@@ -1816,26 +1816,10 @@ RZ_API void rz_bin_dwarf_addr_free(RzBinDwarfAddr *self);\n RZ_API RZ_OWN RzBinDwarfAddr *rz_bin_dwarf_addr_new(RZ_OWN RZ_NONNULL RzBinEndianReader *reader);\n RZ_API RZ_OWN RzBinDwarfAddr *rz_bin_dwarf_addr_from_file(RZ_BORROW RZ_NONNULL RzBinFile *bf);\n \n-/**\n- * \\brief Safely get the string from an RzBinDwarfAttrValue if it has one.\n- */\n-static inline char *rz_bin_dwarf_attr_string(\n-\tconst RzBinDwarfAttr *attr,\n-\tconst RzBinDWARF *dw,\n-\tut64 str_offsets_base) {\n-\trz_return_val_if_fail(attr, NULL);\n-\tconst RzBinDwarfAttrValue *v = &attr->value;\n-\tif (v->kind == RzBinDwarfAttr_String) {\n-\t\treturn rz_str_dup(v->string);\n-\t} else if (v->kind == RzBinDwarfAttr_StrRef && dw) {\n-\t\treturn rz_str_dup(rz_bin_dwarf_str_get(dw->str, v->u64));\n-\t} else if (v->kind == RzBinDwarfAttr_StrOffsetIndex && dw) {\n-\t\treturn rz_str_dup(rz_bin_dwarf_str_offsets_get(dw->str, dw->str_offsets, str_offsets_base, v->u64));\n-\t} else if (v->kind == RzBinDwarfAttr_LineStrRef && dw) {\n-\t\treturn rz_str_dup(rz_bin_dwarf_line_str_get(dw->line_str, v->u64));\n-\t}\n-\treturn NULL;\n-}\n+RZ_API RZ_OWN char *rz_bin_dwarf_attr_string(\n+\tRZ_BORROW RZ_NONNULL const RzBinDwarfAttr *attr,\n+\tRZ_BORROW RZ_NULLABLE const RzBinDWARF *dw,\n+\tut64 str_offsets_base);\n \n static inline ut64 rz_bin_dwarf_attr_addr(\n \tconst RzBinDwarfAttr *attr,"
            },
            {
                "sha": "46075800f8998745064f4ca23d3324cdf5e5c810",
                "filename": "test/db/cmd/dwarf",
                "status": "modified",
                "additions": 421,
                "deletions": 0,
                "changes": 421,
                "blob_url": "https://github.com/rizinorg/rizin/blob/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/test%2Fdb%2Fcmd%2Fdwarf",
                "raw_url": "https://github.com/rizinorg/rizin/raw/c025dcee40c8eac2ab559f2caa3798a2dbf019e4/test%2Fdb%2Fcmd%2Fdwarf",
                "contents_url": "https://api.github.com/repos/rizinorg/rizin/contents/test%2Fdb%2Fcmd%2Fdwarf?ref=c025dcee40c8eac2ab559f2caa3798a2dbf019e4",
                "patch": "@@ -1,3 +1,424 @@\n+NAME=\"ansi injection via dwarf\"\n+FILE=bins/elf/dwarf_test_func_patched\n+ARGS=-AA\n+CMDS=<<EOF\n+id\n+C\n+xc\n+EOF\n+EXPECT=<<EOF\n+    1      DW_TAG_compile_unit       [has children] (0x0)\n+    DW_AT_producer                 DW_FORM_strp\n+    DW_AT_language                 DW_FORM_data1\n+    DW_AT_name                     DW_FORM_strp\n+    DW_AT_comp_dir                 DW_FORM_strp\n+    DW_AT_low_pc                   DW_FORM_addr\n+    DW_AT_high_pc                  DW_FORM_data8\n+    DW_AT_stmt_list                DW_FORM_sec_offset\n+    2      DW_TAG_base_type          [no children] (0x13)\n+    DW_AT_byte_size                DW_FORM_data1\n+    DW_AT_encoding                 DW_FORM_data1\n+    DW_AT_name                     DW_FORM_strp\n+    3      DW_TAG_base_type          [no children] (0x1e)\n+    DW_AT_byte_size                DW_FORM_data1\n+    DW_AT_encoding                 DW_FORM_data1\n+    DW_AT_name                     DW_FORM_string\n+    4      DW_TAG_pointer_type       [no children] (0x29)\n+    DW_AT_byte_size                DW_FORM_data1\n+    DW_AT_type                     DW_FORM_ref4\n+    5      DW_TAG_const_type         [no children] (0x32)\n+    DW_AT_type                     DW_FORM_ref4\n+    6      DW_TAG_subprogram         [has children] (0x39)\n+    DW_AT_external                 DW_FORM_flag_present\n+    DW_AT_name                     DW_FORM_strp\n+    DW_AT_decl_file                DW_FORM_data1\n+    DW_AT_decl_line                DW_FORM_data2\n+    DW_AT_decl_column              DW_FORM_data1\n+    DW_AT_prototyped               DW_FORM_flag_present\n+    DW_AT_type                     DW_FORM_ref4\n+    DW_AT_declaration              DW_FORM_flag_present\n+    DW_AT_sibling                  DW_FORM_ref4\n+    7      DW_TAG_formal_parameter   [no children] (0x50)\n+    DW_AT_type                     DW_FORM_ref4\n+    8      DW_TAG_subprogram         [no children] (0x57)\n+    DW_AT_external                 DW_FORM_flag_present\n+    DW_AT_name                     DW_FORM_strp\n+    DW_AT_decl_file                DW_FORM_data1\n+    DW_AT_decl_line                DW_FORM_data1\n+    DW_AT_decl_column              DW_FORM_data1\n+    DW_AT_type                     DW_FORM_ref4\n+    DW_AT_low_pc                   DW_FORM_addr\n+    DW_AT_high_pc                  DW_FORM_data8\n+    DW_AT_frame_base               DW_FORM_exprloc\n+    DW_AT_GNU_all_tail_call_sites  DW_FORM_flag_present\n+    9      DW_TAG_subprogram         [has children] (0x71)\n+    DW_AT_external                 DW_FORM_flag_present\n+    DW_AT_name                     DW_FORM_strp\n+    DW_AT_decl_file                DW_FORM_data1\n+    DW_AT_decl_line                DW_FORM_data1\n+    DW_AT_decl_column              DW_FORM_data1\n+    DW_AT_prototyped               DW_FORM_flag_present\n+    DW_AT_low_pc                   DW_FORM_addr\n+    DW_AT_high_pc                  DW_FORM_data8\n+    DW_AT_frame_base               DW_FORM_exprloc\n+    DW_AT_GNU_all_tail_call_sites  DW_FORM_flag_present\n+    10     DW_TAG_formal_parameter   [no children] (0x8b)\n+    DW_AT_name                     DW_FORM_string\n+    DW_AT_decl_file                DW_FORM_data1\n+    DW_AT_decl_line                DW_FORM_data1\n+    DW_AT_decl_column              DW_FORM_data1\n+    DW_AT_type                     DW_FORM_ref4\n+    DW_AT_location                 DW_FORM_exprloc\n+\n+  Compilation Unit @ offset 0x0:\n+   Length:        0xe7\n+   Version:       4\n+   Abbrev Offset: 0x0\n+   Pointer Size:  8\n+\n+<0xb>: Abbrev Number: 1    (DW_TAG_compile_unit)\n+\tDW_AT_producer [DW_FORM_strp]\t: (indirect string, .debug_str+0x1e): GNU C17 11.3.0 -mtune=generic -march=x86-64 -gdwarf-4 -O0 -fasynchronous-unwind-tables -fstack-protector-strong -fstack-clash-protection -fcf-protection\n+\tDW_AT_language [DW_FORM_data1]\t: 12   (C99)\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0x133): dwarf_test.c\n+\tDW_AT_comp_dir [DW_FORM_strp]\t: (indirect string, .debug_str+0xe1): /home/potato/projects/sec/subjects/r2/r2_esc_seq_inj\n+\tDW_AT_low_pc [DW_FORM_addr]\t: 0x1149\n+\tDW_AT_high_pc [DW_FORM_data8]\t: 61\n+\tDW_AT_stmt_list [DW_FORM_sec_offset]\t: <0x0>\n+<0x2d>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 8\n+\tDW_AT_encoding [DW_FORM_data1]\t: 7\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0xc1): long unsigned int\n+<0x34>: Abbrev Number: 3    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 4\n+\tDW_AT_encoding [DW_FORM_data1]\t: 5\n+\tDW_AT_name [DW_FORM_string]\t: int\n+<0x3b>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 8\n+\tDW_AT_encoding [DW_FORM_data1]\t: 5\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0x5): long int\n+<0x42>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 8\n+\tDW_AT_encoding [DW_FORM_data1]\t: 5\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0x0): long long int\n+<0x49>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 1\n+\tDW_AT_encoding [DW_FORM_data1]\t: 8\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0xd3): unsigned char\n+<0x50>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 2\n+\tDW_AT_encoding [DW_FORM_data1]\t: 7\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0x116): short unsigned int\n+<0x57>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 4\n+\tDW_AT_encoding [DW_FORM_data1]\t: 7\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0xc6): unsigned int\n+<0x5e>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 1\n+\tDW_AT_encoding [DW_FORM_data1]\t: 6\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0xd5): signed char\n+<0x65>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 2\n+\tDW_AT_encoding [DW_FORM_data1]\t: 5\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0x129): short int\n+<0x6c>: Abbrev Number: 4    (DW_TAG_pointer_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 8\n+\tDW_AT_type [DW_FORM_ref4]\t: <0x72>\n+<0x72>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 1\n+\tDW_AT_encoding [DW_FORM_data1]\t: 6\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0xdc): char\n+<0x79>: Abbrev Number: 5    (DW_TAG_const_type)\n+\tDW_AT_type [DW_FORM_ref4]\t: <0x72>\n+<0x7e>: Abbrev Number: 2    (DW_TAG_base_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 8\n+\tDW_AT_encoding [DW_FORM_data1]\t: 7\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0xbc): long long unsigned int\n+<0x85>: Abbrev Number: 6    (DW_TAG_subprogram)\n+\tDW_AT_external [DW_FORM_flag_present]\t: 1\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0x19): puts\n+\tDW_AT_decl_file [DW_FORM_data1]\t: 2\n+\tDW_AT_decl_line [DW_FORM_data2]\t: 661\n+\tDW_AT_decl_column [DW_FORM_data1]\t: 12\n+\tDW_AT_prototyped [DW_FORM_flag_present]\t: 1\n+\tDW_AT_type [DW_FORM_ref4]\t: <0x34>\n+\tDW_AT_declaration [DW_FORM_flag_present]\t: 1\n+\tDW_AT_sibling [DW_FORM_ref4]\t: <0x9c>\n+<0x96>: Abbrev Number: 7    (DW_TAG_formal_parameter)\n+\tDW_AT_type [DW_FORM_ref4]\t: <0x9c>\n+<0x9b>: Abbrev Number: 0    (DW_TAG_null_entry)\n+<0x9c>: Abbrev Number: 4    (DW_TAG_pointer_type)\n+\tDW_AT_byte_size [DW_FORM_data1]\t: 8\n+\tDW_AT_type [DW_FORM_ref4]\t: <0x79>\n+<0xa2>: Abbrev Number: 8    (DW_TAG_subprogram)\n+\tDW_AT_external [DW_FORM_flag_present]\t: 1\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0xb7): main\n+\tDW_AT_decl_file [DW_FORM_data1]\t: 1\n+\tDW_AT_decl_line [DW_FORM_data1]\t: 8\n+\tDW_AT_decl_column [DW_FORM_data1]\t: 5\n+\tDW_AT_type [DW_FORM_ref4]\t: <0x34>\n+\tDW_AT_low_pc [DW_FORM_addr]\t: 0x1168\n+\tDW_AT_high_pc [DW_FORM_data8]\t: 30\n+\tDW_AT_frame_base [DW_FORM_exprloc]\t: 1 byte block: 0x9c\n+\tDW_AT_GNU_all_tail_call_sites [DW_FORM_flag_present]\t: 1\n+<0xc0>: Abbrev Number: 9    (DW_TAG_subprogram)\n+\tDW_AT_external [DW_FORM_flag_present]\t: 1\n+\tDW_AT_name [DW_FORM_strp]\t: (indirect string, .debug_str+0xe): \\\\e[33m_func\n+\tDW_AT_decl_file [DW_FORM_data1]\t: 1\n+\tDW_AT_decl_line [DW_FORM_data1]\t: 4\n+\tDW_AT_decl_column [DW_FORM_data1]\t: 6\n+\tDW_AT_prototyped [DW_FORM_flag_present]\t: 1\n+\tDW_AT_low_pc [DW_FORM_addr]\t: 0x1149\n+\tDW_AT_high_pc [DW_FORM_data8]\t: 31\n+\tDW_AT_frame_base [DW_FORM_exprloc]\t: 1 byte block: 0x9c\n+\tDW_AT_GNU_all_tail_call_sites [DW_FORM_flag_present]\t: 1\n+<0xda>: Abbrev Number: 10   (DW_TAG_formal_parameter)\n+\tDW_AT_name [DW_FORM_string]\t: msg\n+\tDW_AT_decl_file [DW_FORM_data1]\t: 1\n+\tDW_AT_decl_line [DW_FORM_data1]\t: 4\n+\tDW_AT_decl_column [DW_FORM_data1]\t: 23\n+\tDW_AT_type [DW_FORM_ref4]\t: <0x6c>\n+\tDW_AT_location [DW_FORM_exprloc]\t: 2 byte block: 0x9168\n+<0xe9>: Abbrev Number: 0    (DW_TAG_null_entry)\n+<0xea>: Abbrev Number: 0    (DW_TAG_null_entry)\n+\n+Contents of the .debug_aranges section:\n+  Address Range Set\n+   Unit Length:           0x2c\n+   64bit:                 false\n+   Version:               2\n+   Offset in .debug_info: 0x0\n+   Address Size:          8\n+   Segment Size:          0\n+   Ranges:\n+    address            length\n+    0x0000000000001149 0x000000000000003d\n+    0x0000000000000000 0x0000000000000000\n+\n+Raw dump of debug contents of section .debug_line:\n+\n+ Header information[0x0]\n+  Length:                             103\n+  DWARF Version:                      4\n+  Header Length:                      60\n+  Minimum Instruction Length:         1\n+  Maximum Operations per Instruction: 1\n+  Initial value of 'is_stmt':         1\n+  Line Base:                          -5\n+  Line Range:                         14\n+  Opcode Base:                        13\n+\n+ Opcodes:\n+standard_opcode_lengths[DW_LNS_copy] = 0\n+standard_opcode_lengths[DW_LNS_advance_pc] = 1\n+standard_opcode_lengths[DW_LNS_advance_line] = 1\n+standard_opcode_lengths[DW_LNS_set_file] = 1\n+standard_opcode_lengths[DW_LNS_set_column] = 1\n+standard_opcode_lengths[DW_LNS_negate_stmt] = 0\n+standard_opcode_lengths[DW_LNS_set_basic_block] = 0\n+standard_opcode_lengths[DW_LNS_const_add_pc] = 0\n+standard_opcode_lengths[DW_LNS_fixed_advance_pc] = 1\n+standard_opcode_lengths[DW_LNS_set_prologue_end] = 0\n+standard_opcode_lengths[DW_LNS_set_epilogue_begin] = 0\n+standard_opcode_lengths[DW_LNS_set_isa] = 1\n+\n+ The Directory Table:\n+  1     /usr/include\n+\n+ The File Name Table:\n+  Entry Dir     Time      Size       Name\n+  1     0       0         0          \\e[36m_test.c\n+  2     1       0         0          stdio.h\n+\n+ Line Number Statements:\n+  DW_LNS_set_column\t28\n+  DW_LNE_set_address\t0x1149\n+  Special opcode\t21\n+  DW_LNS_set_column\t5\n+  Special opcode\t243\n+  DW_LNS_set_column\t1\n+  Special opcode\t187\n+  DW_LNS_set_column\t12\n+  Special opcode\t62\n+  DW_LNS_set_column\t5\n+  Special opcode\t131\n+  DW_LNS_set_column\t12\n+  Special opcode\t229\n+  DW_LNS_set_column\t1\n+  Special opcode\t89\n+  DW_LNS_advance_pc\t2\n+  DW_LNE_end_sequence\n+\n+0x00001149\t/home/potato/projects/sec/subjects/r2/r2_esc_seq_inj/\\e[36m_test.c\t4\t28\n+0x00001159\t/home/potato/projects/sec/subjects/r2/r2_esc_seq_inj/\\e[36m_test.c\t5\t5\n+0x00001165\t/home/potato/projects/sec/subjects/r2/r2_esc_seq_inj/\\e[36m_test.c\t6\t1\n+0x00001168\t/home/potato/projects/sec/subjects/r2/r2_esc_seq_inj/\\e[36m_test.c\t8\t12\n+0x00001170\t/home/potato/projects/sec/subjects/r2/r2_esc_seq_inj/\\e[36m_test.c\t9\t5\n+0x0000117f\t/home/potato/projects/sec/subjects/r2/r2_esc_seq_inj/\\e[36m_test.c\t10\t12\n+0x00001184\t/home/potato/projects/sec/subjects/r2/r2_esc_seq_inj/\\e[36m_test.c\t11\t1\n+0x00001186\t-\t0\t0\n+0x00000318 CCu \"[00] -r-- section size 28 named .interp\"\n+0x00000338 CCu \"[01] -r-- section size 48 named .note.gnu.property\"\n+0x00000368 CCu \"[02] -r-- section size 36 named .note.gnu.build-id\"\n+0x0000038c CCu \"[03] -r-- section size 32 named .note.ABI-tag\"\n+0x000003b0 CCu \"[04] -r-- section size 36 named .gnu.hash\"\n+0x000003d8 CCu \"[05] -r-- section size 168 named .dynsym\"\n+0x00000480 CCu \"[06] -r-- section size 141 named .dynstr\"\n+0x0000050e CCu \"[07] -r-- section size 14 named .gnu.version\"\n+0x00000520 CCu \"[08] -r-- section size 48 named .gnu.version_r\"\n+0x00000550 data Cd 8\n+0x00000550 CCu \"[09] -r-- section size 192 named .rela.dyn\"\n+0x00000558 data Cd 8\n+0x00000560 data Cd 8\n+0x00000568 data Cd 8\n+0x00000570 data Cd 8\n+0x00000578 data Cd 8\n+0x00000580 data Cd 8\n+0x00000588 data Cd 8\n+0x00000590 data Cd 8\n+0x00000598 data Cd 8\n+0x000005a0 data Cd 8\n+0x000005a8 data Cd 8\n+0x000005b0 data Cd 8\n+0x000005b8 data Cd 8\n+0x000005c0 data Cd 8\n+0x000005c8 data Cd 8\n+0x000005d0 data Cd 8\n+0x000005d8 data Cd 8\n+0x000005e0 data Cd 8\n+0x000005e8 data Cd 8\n+0x000005f0 data Cd 8\n+0x000005f8 data Cd 8\n+0x00000600 data Cd 8\n+0x00000608 data Cd 8\n+0x00000610 data Cd 8\n+0x00000610 CCu \"[10] -r-- section size 24 named .rela.plt\"\n+0x00000618 data Cd 8\n+0x00000620 data Cd 8\n+0x00001000 CCu \"[11] -r-x section size 27 named .init\"\n+0x00001020 CCu \"[12] -r-x section size 32 named .plt\"\n+0x00001040 CCu \"[13] -r-x section size 16 named .plt.got\"\n+0x00001050 CCu \"[14] -r-x section size 16 named .plt.sec\"\n+0x00001060 CCu \"[15] -r-x section size 294 named .text\"\n+0x00001066 void *rtld_fini\n+0x00001069 int argc\n+0x0000106a char **ubp_av\n+0x00001073 void *fini\n+0x00001076 void *init\n+0x00001078 void *main\n+0x00001155 arg1\n+0x0000115d const char *s\n+0x00001177 int64_t arg1\n+0x00001188 CCu \"[16] -r-x section size 13 named .fini\"\n+0x00002000 CCu \"[17] -r-- section size 16 named .rodata\"\n+0x00002004 ascii[12] \"hello world\"\n+0x00002010 CCu \"[18] -r-- section size 60 named .eh_frame_hdr\"\n+0x00002050 CCu \"[19] -r-- section size 204 named .eh_frame\"\n+0x00003db8 data Cd 8\n+0x00003db8 CCu \"[20] -rw- section size 8 named .init_array\"\n+0x00003dc0 data Cd 8\n+0x00003dc0 CCu \"[21] -rw- section size 8 named .fini_array\"\n+0x00003dc8 data Cd 8\n+0x00003dc8 CCu \"[22] -rw- section size 496 named .dynamic\"\n+0x00003dd0 data Cd 8\n+0x00003dd8 data Cd 8\n+0x00003de0 data Cd 8\n+0x00003de8 data Cd 8\n+0x00003df0 data Cd 8\n+0x00003df8 data Cd 8\n+0x00003e00 data Cd 8\n+0x00003e08 data Cd 8\n+0x00003e10 data Cd 8\n+0x00003e18 data Cd 8\n+0x00003e20 data Cd 8\n+0x00003e28 data Cd 8\n+0x00003e30 data Cd 8\n+0x00003e38 data Cd 8\n+0x00003e40 data Cd 8\n+0x00003e48 data Cd 8\n+0x00003e50 data Cd 8\n+0x00003e58 data Cd 8\n+0x00003e60 data Cd 8\n+0x00003e68 data Cd 8\n+0x00003e70 data Cd 8\n+0x00003e78 data Cd 8\n+0x00003e80 data Cd 8\n+0x00003e88 data Cd 8\n+0x00003e90 data Cd 8\n+0x00003e98 data Cd 8\n+0x00003ea0 data Cd 8\n+0x00003ea8 data Cd 8\n+0x00003eb0 data Cd 8\n+0x00003eb8 data Cd 8\n+0x00003ec0 data Cd 8\n+0x00003ec8 data Cd 8\n+0x00003ed0 data Cd 8\n+0x00003ed8 data Cd 8\n+0x00003ee0 data Cd 8\n+0x00003ee8 data Cd 8\n+0x00003ef0 data Cd 8\n+0x00003ef8 data Cd 8\n+0x00003f00 data Cd 8\n+0x00003f08 data Cd 8\n+0x00003f10 data Cd 8\n+0x00003f18 data Cd 8\n+0x00003f20 data Cd 8\n+0x00003f28 data Cd 8\n+0x00003f30 data Cd 8\n+0x00003f38 data Cd 8\n+0x00003f40 data Cd 8\n+0x00003f48 data Cd 8\n+0x00003f50 data Cd 8\n+0x00003f58 data Cd 8\n+0x00003f60 data Cd 8\n+0x00003f68 data Cd 8\n+0x00003f70 data Cd 8\n+0x00003f78 data Cd 8\n+0x00003f80 data Cd 8\n+0x00003f88 data Cd 8\n+0x00003f90 data Cd 8\n+0x00003f98 data Cd 8\n+0x00003fa0 data Cd 8\n+0x00003fa8 data Cd 8\n+0x00003fb0 data Cd 8\n+0x00003fb8 data Cd 8\n+0x00003fb8 CCu \"[23] -rw- section size 72 named .got\"\n+0x00003fc0 data Cd 8\n+0x00003fc8 data Cd 8\n+0x00003fd0 data Cd 8\n+0x00003fd8 data Cd 8\n+0x00003fe0 data Cd 8\n+0x00003fe8 data Cd 8\n+0x00003ff0 data Cd 8\n+0x00003ff8 data Cd 8\n+0x00004000 CCu \"[24] -rw- section size 16 named .data\"\n+0x00004008 data Cd 8\n+0x00004010 CCu \"[25] -rw- section size 8 named .bss\"\n+0x00004020 data Cd 8\n+0x00004028 data Cd 8\n+0x00004030 data Cd 8\n+0x00004038 data Cd 8\n+0x00004040 data Cd 8\n+0x00004048 data Cd 8\n+- offset -   0 1  2 3  4 5  6 7  8 9  A B  C D  E F  0123456789ABCDEF  comment\n+0x00001060  f30f 1efa 31ed 4989 d15e 4889 e248 83e4  ....1.I..^H..H..  ; sym._start  ; [15] -r-x section size 294 named .text  ; void *rtld_fini  ; int argc  ; char **ubp_av\n+0x00001070  f050 5445 31c0 31c9 488d 3de9 0000 00ff  .PTE1.1.H.=.....  ; void *fini  ; void *init  ; void *main\n+0x00001080  1553 2f00 00f4 662e 0f1f 8400 0000 0000  .S/...f.........\n+0x00001090  488d 3d79 2f00 0048 8d05 722f 0000 4839  H.=y/..H..r/..H9  ; sym.deregister_tm_clones\n+0x000010a0  f874 1548 8b05 362f 0000 4885 c074 09ff  .t.H..6/..H..t..\n+0x000010b0  e00f 1f80 0000 0000 c30f 1f80 0000 0000  ................\n+0x000010c0  488d 3d49 2f00 0048 8d35 422f 0000 4829  H.=I/..H.5B/..H)  ; sym.register_tm_clones\n+0x000010d0  fe48 89f0 48c1 ee3f 48c1 f803 4801 c648  .H..H..?H...H..H\n+0x000010e0  d1fe 7414 488b 0505 2f00 0048 85c0 7408  ..t.H.../..H..t.\n+0x000010f0  ffe0 660f 1f44 0000 c30f 1f80 0000 0000  ..f..D..........\n+0x00001100  f30f 1efa 803d 052f 0000 0075 2b55 4883  .....=./...u+UH.  ; sym.__do_global_dtors_aux\n+0x00001110  3de2 2e00 0000 4889 e574 0c48 8b3d e62e  =.....H..t.H.=..\n+0x00001120  0000 e819 ffff ffe8 64ff ffff c605 dd2e  ........d.......\n+0x00001130  0000 015d c30f 1f00 c30f 1f80 0000 0000  ...]............\n+0x00001140  f30f 1efa e977 ffff fff3 0f1e fa55 4889  .....w.......UH.  ; sym.frame_dummy  ; dbg.__e_33m_func\n+0x00001150  e548 83ec 1048 897d f848 8b45 f848 89c7  .H...H.}.H.E.H..  ; arg1  ; const char *s\n+EOF\n+RUN\n+\n NAME=\"Static variables inside function\"\n FILE=bins/elf/dwarf/static_var\n CMDS=<<EOF"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/geoserver/geoserver/commits/8cd1590a604a10875de67b04995f1952f631f920",
        "url": "https://api.github.com/repos/geoserver/geoserver/commits/8cd1590a604a10875de67b04995f1952f631f920",
        "html_url": "https://github.com/geoserver/geoserver/commit/8cd1590a604a10875de67b04995f1952f631f920",
        "message": "hide private info on about page",
        "files": [
            {
                "sha": "c8260e60f9428fc6e2457fb27e3973ebd473561a",
                "filename": "src/web/core/src/main/java/org/geoserver/web/AboutGeoServerPage.html",
                "status": "modified",
                "additions": 33,
                "deletions": 31,
                "changes": 64,
                "blob_url": "https://github.com/geoserver/geoserver/blob/8cd1590a604a10875de67b04995f1952f631f920/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FAboutGeoServerPage.html",
                "raw_url": "https://github.com/geoserver/geoserver/raw/8cd1590a604a10875de67b04995f1952f631f920/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FAboutGeoServerPage.html",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FAboutGeoServerPage.html?ref=8cd1590a604a10875de67b04995f1952f631f920",
                "patch": "@@ -2,37 +2,39 @@\n   <body>\n     <wicket:extend>\n       <form>\n-       <fieldset class=\"mt-3\">\n-         <legend>\n-           <wicket:message key=\"buildInformation\">Build Information</wicket:message>\n-         </legend>\n-         <ul>\n-           <li>\n-             <label for=\"version\"><wicket:message key=\"geoserverVersion\">Version</wicket:message></label>\n-             <span id=\"version\"><wicket:message key=\"version\"></wicket:message></span>\n-           </li>\n-           <li>\n-             <label for=\"buildRevision\"><wicket:message key=\"gitRevision\">Git Revision</wicket:message></label>\n-             <span id=\"buildRevision\"><wicket:message key=\"build.revision\"></wicket:message></span>\n-           </li>\n-           <li>\n-             <label for=\"buildDate\"><wicket:message key=\"buildDate\">Build Date</wicket:message></label>\n-             <span id=\"buildDate\"><wicket:message key=\"build.date\"></wicket:message></span>\n-           </li>\n-           <li>\n-             <label for=\"geotoolsInfo\"><wicket:message key=\"geotoolsVersion\">GeoTools Version</wicket:message></label>\n-             <span id=\"geotoolsInfo\">\n-               <span wicket:id=\"geotoolsVersion\"></span> (rev <span wicket:id=\"geotoolsRevision\"></span>)\n-             </span>\n-           </li>\n-           <li>\n-             <label for=\"geowebcacheInfo\"><wicket:message key=\"geowebcacheVersion\">GeoWebCache Version</wicket:message></label>\n-             <span id=\"geotoolsInfo\">\n-               <span wicket:id=\"geowebcacheVersion\"></span> (rev <span wicket:id=\"geowebcacheRevision\"></span>)\n-             </span>\n-           </li>\n-         </ul>\n-       </fieldset>\n+          <wicket:container wicket:id=\"privateInfo\">\n+               <fieldset  class=\"mt-3\">\n+                 <legend>\n+                   <wicket:message key=\"buildInformation\">Build Information</wicket:message>\n+                 </legend>\n+                 <ul>\n+                   <li>\n+                     <label for=\"version\"><wicket:message key=\"geoserverVersion\">Version</wicket:message></label>\n+                     <span id=\"version\"><wicket:message key=\"version\"></wicket:message></span>\n+                   </li>\n+                   <li>\n+                     <label for=\"buildRevision\"><wicket:message key=\"gitRevision\">Git Revision</wicket:message></label>\n+                     <span id=\"buildRevision\"><wicket:message key=\"build.revision\"></wicket:message></span>\n+                   </li>\n+                   <li>\n+                     <label for=\"buildDate\"><wicket:message key=\"buildDate\">Build Date</wicket:message></label>\n+                     <span id=\"buildDate\"><wicket:message key=\"build.date\"></wicket:message></span>\n+                   </li>\n+                   <li>\n+                     <label for=\"geotoolsInfo\"><wicket:message key=\"geotoolsVersion\">GeoTools Version</wicket:message></label>\n+                     <span id=\"geotoolsInfo\">\n+                       <span wicket:id=\"geotoolsVersion\"></span> (rev <span wicket:id=\"geotoolsRevision\"></span>)\n+                     </span>\n+                   </li>\n+                   <li>\n+                     <label for=\"geowebcacheInfo\"><wicket:message key=\"geowebcacheVersion\">GeoWebCache Version</wicket:message></label>\n+                     <span id=\"geotoolsInfo\">\n+                       <span wicket:id=\"geowebcacheVersion\"></span> (rev <span wicket:id=\"geowebcacheRevision\"></span>)\n+                     </span>\n+                   </li>\n+                 </ul>\n+               </fieldset>\n+          </wicket:container>\n        <fieldset>\n            <legend><wicket:message key=\"moreInformation\">More Information</wicket:message></legend>\n            <p>"
            },
            {
                "sha": "a02c1d42c44ef3893ef9b60090eadc9232a40d1a",
                "filename": "src/web/core/src/main/java/org/geoserver/web/AboutGeoServerPage.java",
                "status": "modified",
                "additions": 24,
                "deletions": 4,
                "changes": 28,
                "blob_url": "https://github.com/geoserver/geoserver/blob/8cd1590a604a10875de67b04995f1952f631f920/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FAboutGeoServerPage.java",
                "raw_url": "https://github.com/geoserver/geoserver/raw/8cd1590a604a10875de67b04995f1952f631f920/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FAboutGeoServerPage.java",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FAboutGeoServerPage.java?ref=8cd1590a604a10875de67b04995f1952f631f920",
                "patch": "@@ -6,7 +6,10 @@\n package org.geoserver.web;\n \n import java.util.logging.Level;\n+import org.apache.wicket.markup.html.WebMarkupContainer;\n import org.apache.wicket.markup.html.basic.Label;\n+import org.geoserver.platform.GeoServerExtensions;\n+import org.geoserver.security.GeoServerSecurityManager;\n import org.geotools.util.factory.GeoTools;\n \n /**\n@@ -16,11 +19,28 @@\n  */\n public class AboutGeoServerPage extends GeoServerBasePage {\n \n+    GeoServerSecurityManager getManager() {\n+        return GeoServerExtensions.bean(GeoServerSecurityManager.class);\n+    }\n+\n     public AboutGeoServerPage() {\n-        add(new Label(\"geotoolsVersion\", GeoTools.getVersion().toString()));\n-        add(new Label(\"geotoolsRevision\", GeoTools.getBuildRevision()));\n-        add(new Label(\"geowebcacheVersion\", getGwcVersion()));\n-        add(new Label(\"geowebcacheRevision\", getGwcRevision()));\n+        // hide info based on if the user is admin or not\n+        var privateInfo = new WebMarkupContainer(\"privateInfo\");\n+        add(privateInfo);\n+\n+        var isAdmin = getManager().checkAuthenticationForAdminRole();\n+        if (isAdmin) {\n+            privateInfo.add(new Label(\"geotoolsVersion\", GeoTools.getVersion().toString()));\n+            privateInfo.add(new Label(\"geotoolsRevision\", GeoTools.getBuildRevision()));\n+            privateInfo.add(new Label(\"geowebcacheVersion\", getGwcVersion()));\n+            privateInfo.add(new Label(\"geowebcacheRevision\", getGwcRevision()));\n+        } else {\n+            add(new Label(\"geotoolsVersion\", GeoTools.getVersion().toString()));\n+            add(new Label(\"geotoolsRevision\", GeoTools.getBuildRevision()));\n+            add(new Label(\"geowebcacheVersion\", getGwcVersion()));\n+            add(new Label(\"geowebcacheRevision\", getGwcRevision()));\n+            privateInfo.setVisible(false);\n+        }\n     }\n \n     public String getGwcVersion() {"
            },
            {
                "sha": "8de8d11328f1f3b36f8cb83617a146bb6bb6c5fe",
                "filename": "src/web/core/src/test/java/org/geoserver/web/GeoServerAboutPageTest.java",
                "status": "modified",
                "additions": 22,
                "deletions": 0,
                "changes": 22,
                "blob_url": "https://github.com/geoserver/geoserver/blob/8cd1590a604a10875de67b04995f1952f631f920/src%2Fweb%2Fcore%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerAboutPageTest.java",
                "raw_url": "https://github.com/geoserver/geoserver/raw/8cd1590a604a10875de67b04995f1952f631f920/src%2Fweb%2Fcore%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerAboutPageTest.java",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fweb%2Fcore%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerAboutPageTest.java?ref=8cd1590a604a10875de67b04995f1952f631f920",
                "patch": "@@ -7,6 +7,8 @@\n import static org.hamcrest.CoreMatchers.instanceOf;\n import static org.hamcrest.MatcherAssert.assertThat;\n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n \n import org.apache.wicket.util.tester.TagTester;\n import org.junit.Test;\n@@ -26,4 +28,24 @@ public void testLoginFormAction() throws Exception {\n                 \"http://localhost/context/j_spring_security_check\",\n                 tagTester.getAttribute(\"action\"));\n     }\n+\n+    /**\n+     * The About page should hide the sensitive information (like version info, etc...). This test:\n+     * gets the page as a non-admin -> version info should NOT be there gets the page as ADMIN ->\n+     * version info SHOULD be there\n+     */\n+    @Test\n+    public void testHideSensitiveInfo() throws Exception {\n+        logout();\n+        tester.executeUrl(\"./wicket/bookmarkable/org.geoserver.web.AboutGeoServerPage\");\n+\n+        String responseTxt = tester.getLastResponse().getDocument();\n+        assertFalse(responseTxt.contains(\"geotoolsInfo\"));\n+\n+        login();\n+        tester.executeUrl(\"./wicket/bookmarkable/org.geoserver.web.AboutGeoServerPage\");\n+\n+        responseTxt = tester.getLastResponse().getDocument();\n+        assertTrue(responseTxt.contains(\"geotoolsInfo\"));\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/geoserver/geoserver/commits/74fdab745a5deff20ac99abca24d8695fe1a52f8",
        "url": "https://api.github.com/repos/geoserver/geoserver/commits/74fdab745a5deff20ac99abca24d8695fe1a52f8",
        "html_url": "https://github.com/geoserver/geoserver/commit/74fdab745a5deff20ac99abca24d8695fe1a52f8",
        "message": "hide version info on footer and (not visible to user on browser, but in HTML) header",
        "files": [
            {
                "sha": "9dd92bbf26f2b5e74490a55c71abbed5d03399b1",
                "filename": "src/web/core/src/main/java/org/geoserver/web/GeoServerBasePage.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/geoserver/geoserver/blob/74fdab745a5deff20ac99abca24d8695fe1a52f8/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerBasePage.java",
                "raw_url": "https://github.com/geoserver/geoserver/raw/74fdab745a5deff20ac99abca24d8695fe1a52f8/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerBasePage.java",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerBasePage.java?ref=74fdab745a5deff20ac99abca24d8695fe1a52f8",
                "patch": "@@ -267,7 +267,7 @@ protected void onComponentTag(org.apache.wicket.markup.ComponentTag tag) {\n         // home page link\n         add(\n                 new BookmarkablePageLink<>(\"home\", GeoServerHomePage.class)\n-                        .add(new Label(\"label\", new StringResourceModel(\"home\", null, null))));\n+                        .add(new Label(\"label\", \"\")));\n \n         // dev buttons\n         DeveloperToolbar devToolbar = new DeveloperToolbar(\"devButtons\");"
            },
            {
                "sha": "c5fb4f6c1865b72b131b8175115c13334d2551bc",
                "filename": "src/web/core/src/main/java/org/geoserver/web/GeoServerHomePage.java",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/geoserver/geoserver/blob/74fdab745a5deff20ac99abca24d8695fe1a52f8/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerHomePage.java",
                "raw_url": "https://github.com/geoserver/geoserver/raw/74fdab745a5deff20ac99abca24d8695fe1a52f8/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerHomePage.java",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fweb%2Fcore%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerHomePage.java?ref=74fdab745a5deff20ac99abca24d8695fe1a52f8",
                "patch": "@@ -645,6 +645,12 @@ private Label belongsTo(ContactInfo contactInfo, Locale locale) {\n     private Label footerMessage(ContactInfo contactInfo, Locale locale) {\n         String version = String.valueOf(new ResourceModel(\"version\").getObject());\n \n+        boolean admin = getSession().isAdmin();\n+        if (!admin) {\n+            Label footerMessage = new Label(\"footerMessage\", \"\");\n+            return footerMessage;\n+        }\n+\n         HashMap<String, String> params = new HashMap<>();\n         params.put(\"version\", version);\n "
            },
            {
                "sha": "523d7974d0bc66a5ddbaa66f4900903fe42bac8f",
                "filename": "src/web/core/src/test/java/org/geoserver/web/GeoServerHomePageTest.java",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/geoserver/geoserver/blob/74fdab745a5deff20ac99abca24d8695fe1a52f8/src%2Fweb%2Fcore%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerHomePageTest.java",
                "raw_url": "https://github.com/geoserver/geoserver/raw/74fdab745a5deff20ac99abca24d8695fe1a52f8/src%2Fweb%2Fcore%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerHomePageTest.java",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fweb%2Fcore%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fweb%2FGeoServerHomePageTest.java?ref=74fdab745a5deff20ac99abca24d8695fe1a52f8",
                "patch": "@@ -12,6 +12,7 @@\n import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertNotSame;\n import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n \n import java.util.ArrayList;\n import java.util.Collections;\n@@ -21,6 +22,7 @@\n import org.apache.wicket.Page;\n import org.apache.wicket.markup.html.basic.Label;\n import org.apache.wicket.markup.html.form.TextField;\n+import org.apache.wicket.model.StringResourceModel;\n import org.apache.wicket.util.tester.FormTester;\n import org.geoserver.catalog.PublishedInfo;\n import org.geoserver.catalog.WorkspaceInfo;\n@@ -290,6 +292,23 @@ public void testAutoSelection() throws Exception {\n         tester.assertComponent(\"form:layer:select\", Select2DropDownChoice.class);\n     }\n \n+    @Test\n+    public void testHideSensitiveInfo() throws Exception {\n+        logout();\n+        tester.startPage(GeoServerHomePage.class);\n+\n+        var version = new StringResourceModel(\"version\", null, null).getString();\n+\n+        String responseTxt = tester.getLastResponse().getDocument();\n+        assertFalse(responseTxt.contains(version));\n+\n+        login();\n+        tester.startPage(GeoServerHomePage.class);\n+\n+        responseTxt = tester.getLastResponse().getDocument();\n+        assertTrue(responseTxt.contains(version));\n+    }\n+\n     public static class MockHomePageContentProvider implements GeoServerHomePageContentProvider {\n         @Override\n         public Component getPageBodyComponent(final String id) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/geoserver/geoserver/commits/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99",
        "url": "https://api.github.com/repos/geoserver/geoserver/commits/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99",
        "html_url": "https://github.com/geoserver/geoserver/commit/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99",
        "message": "[GEOS-11401] Introduce environmental variables for Module Status page\n\nturn off system-environment and system-property based on environement variable (default = don't show\nadd doc\nuse optional.empty()\nchanges from miceg's review\nchanges from miceg's review\njody and andrea feedback\ndoc changes - miceg",
        "files": [
            {
                "sha": "2d7ea2f1a4c584360645c5bc484d7223141982c7",
                "filename": "doc/en/user/source/configuration/properties/index.rst",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/geoserver/geoserver/blob/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/doc%2Fen%2Fuser%2Fsource%2Fconfiguration%2Fproperties%2Findex.rst",
                "raw_url": "https://github.com/geoserver/geoserver/raw/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/doc%2Fen%2Fuser%2Fsource%2Fconfiguration%2Fproperties%2Findex.rst",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/doc%2Fen%2Fuser%2Fsource%2Fconfiguration%2Fproperties%2Findex.rst?ref=5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99",
                "patch": "@@ -31,6 +31,18 @@ GeoServer Property Reference\n      - x\n      - x\n      - x\n+   * - GEOSERVER_MODULE_SYSTEM_ENVIRONMENT_STATUS_ENABLED\n+       \n+       :ref:`module_status_security_environment_vars`\n+     -  \n+     -  \n+     - x\n+   * - GEOSERVER_MODULE_SYSTEM_PROPERTY_STATUS_ENABLED\n+       \n+       :ref:`module_status_security_environment_vars`     \n+     -  \n+     -  \n+     - x\n    * - GEOWEBCACHE_CACHE_DIR\n        \n        :doc:`/geowebcache/config`"
            },
            {
                "sha": "2b271c62102a155caca1932180ea4f5041712c42",
                "filename": "doc/en/user/source/production/config.rst",
                "status": "modified",
                "additions": 31,
                "deletions": 0,
                "changes": 31,
                "blob_url": "https://github.com/geoserver/geoserver/blob/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/doc%2Fen%2Fuser%2Fsource%2Fproduction%2Fconfig.rst",
                "raw_url": "https://github.com/geoserver/geoserver/raw/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/doc%2Fen%2Fuser%2Fsource%2Fproduction%2Fconfig.rst",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/doc%2Fen%2Fuser%2Fsource%2Fproduction%2Fconfig.rst?ref=5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99",
                "patch": "@@ -139,6 +139,37 @@ In some circumstances, you might want to completely disable the web administrati\n * Set the Java system property ``GEOSERVER_CONSOLE_DISABLED`` to true by adding ``-DGEOSERVER_CONSOLE_DISABLED=true`` to your container's JVM options\n * Remove all of the :file:`gs-web*-.jar` files from :file:`WEB-INF/lib`\n \n+.. _module_status_security_environment_vars:\n+\n+Showing Environment Variables and Java System Properties\n+''''''''''''''''''''''''''''''''''''''''''''''''''''''''\n+\n+Module status information is available describing the operational environment.\n+\n+* The :guilabel:`GeoServer Status` page :ref:`config_serverstatus_module`.\n+* The REST ``/geoserver/rest/about/status`` endpoint lists module status information\n+\n+1. By default GeoServer does **not** show Environment Variables and Java System Properties.\n+\n+2. To show environment variables and Java system properties on the status page and REST API, start GeoServer with these environment variables set to ``true``:\n+\n+   * `GEOSERVER_MODULE_SYSTEM_ENVIRONMENT_STATUS_ENABLED`\n+   * `GEOSERVER_MODULE_SYSTEM_PROPERTY_STATUS_ENABLED`\n+\n+3. In a production system, these should be set to ``false`` (or leave them undefined).\n+\n+   .. warning::\n+\n+      While this feature can help an administrator debug a GeoServer instance's configuration, environment variables can include sensitive information such as database passwords and API access keys/tokens, particularly when running in a containerised environment (such as Docker or Kubernetes) or with ``ALLOW_ENV_PARAMETRIZATION=true``.\n+\n+   .. note:: Linux\n+   \n+      Linux administrators can get a list of all environment variables set at GeoServer startup with:\n+\n+      .. code-block:: bash\n+\n+         tr '\\0' '\\n' < /proc/${GEOSERVER_PID}/environ\n+\n Application Server Guidance\n ---------------------------\n "
            },
            {
                "sha": "1b72b1a8117856f17504b1a4b4e03bc8f04361df",
                "filename": "src/platform/src/main/java/org/geoserver/platform/SystemEnvironmentStatus.java",
                "status": "modified",
                "additions": 49,
                "deletions": 0,
                "changes": 49,
                "blob_url": "https://github.com/geoserver/geoserver/blob/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/src%2Fplatform%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemEnvironmentStatus.java",
                "raw_url": "https://github.com/geoserver/geoserver/raw/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/src%2Fplatform%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemEnvironmentStatus.java",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fplatform%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemEnvironmentStatus.java?ref=5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99",
                "patch": "@@ -7,10 +7,23 @@\n \n import java.util.Map.Entry;\n import java.util.Optional;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+import org.geotools.util.logging.Logging;\n \n /** Report system environment details to server status page. */\n public class SystemEnvironmentStatus implements ModuleStatus {\n \n+    private static final Logger LOGGER = Logging.getLogger(SystemEnvironmentStatus.class);\n+\n+    /**\n+     * Name of the environment variable that turns on the details (listing of all environment\n+     * variables) for this module. \"false\" = don't show, \"true\" = show all the environment variables\n+     * on the web interface.\n+     */\n+    public static final String SystemEnvironmentStatusEnabledEnvironmentVar =\n+            \"GEOSERVER_MODULE_SYSTEM_ENVIRONMENT_STATUS_ENABLED\";\n+\n     @Override\n     public String getModule() {\n         return \"system-environment\";\n@@ -41,8 +54,44 @@ public boolean isEnabled() {\n         return true;\n     }\n \n+    /** For Testing - this can be mocked to change environment variables. */\n+    String getEnvironmentVariable(String envVar) {\n+        return System.getenv(envVar);\n+    }\n+\n+    /**\n+     * returns true if the message (list of variables) should be shown\n+     *\n+     * <p>Uses environment variable SystemPropertyStatusEnabledEnvironmentVar\n+     * (\"GEOSERVER_MODULE_SYSTEM_ENVIRONMENT_STATUS_ENABLED\") not defined -> false (default) bad\n+     * value -> false (default)\n+     */\n+    public boolean isShow() {\n+        String val = getEnvironmentVariable(SystemEnvironmentStatusEnabledEnvironmentVar);\n+        if (val == null) {\n+            return false; // not defined -> default\n+        }\n+        if (val.equalsIgnoreCase(\"true\") || val.equalsIgnoreCase(\"false\")) {\n+            return val.equalsIgnoreCase(\"true\");\n+        }\n+        LOGGER.log(\n+                Level.WARNING,\n+                String.format(\n+                        \"environment variable '%s' should be 'true' or 'false', but was '%s'\",\n+                        SystemEnvironmentStatusEnabledEnvironmentVar, val));\n+        return false; // bad value -> default\n+    }\n+\n     @Override\n     public Optional<String> getMessage() {\n+        if (!isShow()) {\n+            var message =\n+                    String.format(\n+                            \"Environment variables hidden for security reasons.  Set the environment variable '%s' to 'true' to see them.\",\n+                            SystemEnvironmentStatusEnabledEnvironmentVar);\n+            return Optional.of(message);\n+        }\n+\n         StringBuffer result = new StringBuffer();\n         for (Entry<String, String> entry : System.getenv().entrySet()) {\n             result.append(entry.getKey().toString() + \"=\" + entry.getValue().toString() + \"\\n\");"
            },
            {
                "sha": "f53dbe29930292d707b3c3777689e8bc1770d142",
                "filename": "src/platform/src/main/java/org/geoserver/platform/SystemPropertyStatus.java",
                "status": "modified",
                "additions": 48,
                "deletions": 0,
                "changes": 48,
                "blob_url": "https://github.com/geoserver/geoserver/blob/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/src%2Fplatform%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemPropertyStatus.java",
                "raw_url": "https://github.com/geoserver/geoserver/raw/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/src%2Fplatform%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemPropertyStatus.java",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fplatform%2Fsrc%2Fmain%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemPropertyStatus.java?ref=5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99",
                "patch": "@@ -7,9 +7,22 @@\n \n import java.util.Map.Entry;\n import java.util.Optional;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+import org.geotools.util.logging.Logging;\n \n public class SystemPropertyStatus implements ModuleStatus {\n \n+    private static final Logger LOGGER = Logging.getLogger(SystemPropertyStatus.class);\n+\n+    /**\n+     * Name of the environment variable that turns on the details (listing of all property\n+     * variables) for this module. \"false\" = don't show, \"true\" = show all the environment variables\n+     * on the web interface.\n+     */\n+    public static final String SystemPropertyStatusEnabledEnvironmentVar =\n+            \"GEOSERVER_MODULE_SYSTEM_PROPERTY_STATUS_ENABLED\";\n+\n     @Override\n     public String getModule() {\n         return \"system-properties\";\n@@ -40,8 +53,43 @@ public boolean isEnabled() {\n         return true;\n     }\n \n+    /** For Testing - this can be mocked to change environment variables. */\n+    String getEnvironmentVariable(String envVar) {\n+        return System.getenv(envVar);\n+    }\n+\n+    /**\n+     * returns true if the message (list of variables) should be shown\n+     *\n+     * <p>Uses environment variable SystemPropertyStatusEnabledEnvironmentVar\n+     * (\"GEOSERVER_MODULE_SYSTEM_PROPERTY_STATUS_ENABLED\") not defined -> false (default) bad value\n+     * -> false (default)\n+     */\n+    public boolean isShow() {\n+        String val = getEnvironmentVariable(SystemPropertyStatusEnabledEnvironmentVar);\n+        if (val == null) {\n+            return false; // not defined -> default\n+        }\n+        if (val.equalsIgnoreCase(\"true\") || val.equalsIgnoreCase(\"false\")) {\n+            return val.equalsIgnoreCase(\"true\");\n+        }\n+        LOGGER.log(\n+                Level.WARNING,\n+                String.format(\n+                        \"environment variable '%s' should be 'true' or 'false', but was '%s'\",\n+                        SystemPropertyStatusEnabledEnvironmentVar, val));\n+        return false; // bad value -> default\n+    }\n+\n     @Override\n     public Optional<String> getMessage() {\n+        if (!isShow()) {\n+            var message =\n+                    String.format(\n+                            \"Java system properties hidden for security reasons.  Set the environment variable '%s' to 'true' to see them.\",\n+                            SystemPropertyStatusEnabledEnvironmentVar);\n+            return Optional.of(message);\n+        }\n         StringBuffer result = new StringBuffer();\n         for (Entry<Object, Object> entry : System.getProperties().entrySet()) {\n             result.append(entry.getKey().toString() + \"=\" + entry.getValue().toString() + \"\\n\");"
            },
            {
                "sha": "477129694c299910e9c118fb4d31b28aad7d6811",
                "filename": "src/platform/src/test/java/org/geoserver/platform/SystemEnvironmentTest.java",
                "status": "modified",
                "additions": 80,
                "deletions": 1,
                "changes": 81,
                "blob_url": "https://github.com/geoserver/geoserver/blob/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/src%2Fplatform%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemEnvironmentTest.java",
                "raw_url": "https://github.com/geoserver/geoserver/raw/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/src%2Fplatform%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemEnvironmentTest.java",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fplatform%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemEnvironmentTest.java?ref=5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99",
                "patch": "@@ -8,6 +8,7 @@\n import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertTrue;\n \n+import java.util.ArrayList;\n import java.util.HashMap;\n import java.util.Map;\n import java.util.logging.Logger;\n@@ -26,12 +27,90 @@ public void testSystemPropertiesStatus() {\n         String key = System.getenv().keySet().iterator().next();\n         String value = System.getenv(key);\n \n-        SystemEnvironmentStatus status = new SystemEnvironmentStatus();\n+        SystemEnvironmentStatus status =\n+                new SystemEnvironmentStatus() {\n+                    String getEnvironmentVariable(String envVar) {\n+                        return \"true\";\n+                    }\n+                };\n+\n         assertTrue(status.getMessage().isPresent());\n         assertTrue(status.getMessage().get().contains(key));\n         assertTrue(status.getMessage().get().contains(value));\n     }\n \n+    /**\n+     * Tests the SystemEnvironmentStatusEnabledEnvironmentVar so it turns on/off the message (list\n+     * of environment vars).\n+     */\n+    @Test\n+    public void testEnabled() {\n+        final var VALUE = new ArrayList<String>();\n+\n+        // create subclass of SystemEnvironmentStatus so we can change the value of the environment\n+        // variable.\n+        // VALUE empty -> null\n+        // otherwise its the first item in the VALUE\n+        // if the request is for a different environment var -> throw\n+        SystemEnvironmentStatus status =\n+                new SystemEnvironmentStatus() {\n+                    String getEnvironmentVariable(String envVar) {\n+                        if (envVar.equals(\n+                                SystemEnvironmentStatus\n+                                        .SystemEnvironmentStatusEnabledEnvironmentVar)) {\n+                            if (VALUE.isEmpty()) {\n+                                return null;\n+                            }\n+                            return VALUE.get(0);\n+                        }\n+                        throw new RuntimeException(\"bad var\");\n+                    }\n+                };\n+\n+        VALUE.clear();\n+        VALUE.add(\"true\");\n+        assertTrue(status.isShow());\n+        assertTrue(!status.getMessage().isEmpty());\n+\n+        VALUE.clear();\n+        VALUE.add(\"TRUE\");\n+        assertTrue(status.isShow());\n+        assertTrue(!status.getMessage().isEmpty());\n+\n+        VALUE.clear();\n+        VALUE.add(\"FALSE\");\n+        assertFalse(status.isShow());\n+        assertTrue(\n+                status.getMessage()\n+                        .get()\n+                        .startsWith(\"Environment variables hidden for security reasons.\"));\n+\n+        VALUE.clear();\n+        VALUE.add(\"false\");\n+        assertFalse(status.isShow());\n+        assertTrue(\n+                status.getMessage()\n+                        .get()\n+                        .startsWith(\"Environment variables hidden for security reasons.\"));\n+\n+        // default -> false\n+        VALUE.clear();\n+        assertFalse(status.isShow());\n+        assertTrue(\n+                status.getMessage()\n+                        .get()\n+                        .startsWith(\"Environment variables hidden for security reasons.\"));\n+\n+        // bad value -> false\n+        VALUE.clear();\n+        VALUE.add(\"maybe\");\n+        assertFalse(status.isShow());\n+        assertTrue(\n+                status.getMessage()\n+                        .get()\n+                        .startsWith(\"Environment variables hidden for security reasons.\"));\n+    }\n+\n     @Test\n     public void testGeoServerEnvironmentDefaultValue() {\n         System.clearProperty(\"ALLOW_ENV_PARAMETRIZATION\");"
            },
            {
                "sha": "ba7b6f273c3d57ffdca1488a824d9aa438685438",
                "filename": "src/platform/src/test/java/org/geoserver/platform/SystemPropertiesStatusTest.java",
                "status": "modified",
                "additions": 81,
                "deletions": 1,
                "changes": 82,
                "blob_url": "https://github.com/geoserver/geoserver/blob/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/src%2Fplatform%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemPropertiesStatusTest.java",
                "raw_url": "https://github.com/geoserver/geoserver/raw/5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99/src%2Fplatform%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemPropertiesStatusTest.java",
                "contents_url": "https://api.github.com/repos/geoserver/geoserver/contents/src%2Fplatform%2Fsrc%2Ftest%2Fjava%2Forg%2Fgeoserver%2Fplatform%2FSystemPropertiesStatusTest.java?ref=5fd5f35ae176eff3cc4667a5cf48e4bf5dc4ea99",
                "patch": "@@ -5,8 +5,10 @@\n \n package org.geoserver.platform;\n \n+import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertTrue;\n \n+import java.util.ArrayList;\n import org.junit.Test;\n \n public class SystemPropertiesStatusTest {\n@@ -18,9 +20,87 @@ public class SystemPropertiesStatusTest {\n     @Test\n     public void testSystemPropertiesStatus() {\n         System.setProperty(KEY, VALUE);\n-        SystemPropertyStatus status = new SystemPropertyStatus();\n+\n+        SystemPropertyStatus status =\n+                new SystemPropertyStatus() {\n+                    String getEnvironmentVariable(String envVar) {\n+                        return \"true\";\n+                    }\n+                };\n+\n         assertTrue(status.getMessage().isPresent());\n         assertTrue(status.getMessage().get().contains(KEY));\n         assertTrue(status.getMessage().get().contains(VALUE));\n     }\n+\n+    /**\n+     * Tests the SystemPropertyStatusEnabledEnvironmentVar so it turns on/off the message (list of\n+     * property vars).\n+     */\n+    @Test\n+    public void testEnabled() {\n+        final var VALUE = new ArrayList<String>();\n+\n+        // create subclass of SystemPropertyStatus so we can change the value of the environment\n+        // variable.\n+        // VALUE empty -> null\n+        // otherwise its the first item in the VALUE\n+        // if the request is for a different environment var -> throw\n+        SystemPropertyStatus status =\n+                new SystemPropertyStatus() {\n+                    String getEnvironmentVariable(String envVar) {\n+                        if (envVar.equals(\n+                                SystemPropertyStatus.SystemPropertyStatusEnabledEnvironmentVar)) {\n+                            if (VALUE.isEmpty()) {\n+                                return null;\n+                            }\n+                            return VALUE.get(0);\n+                        }\n+                        throw new RuntimeException(\"bad var\");\n+                    }\n+                };\n+\n+        VALUE.clear();\n+        VALUE.add(\"true\");\n+        assertTrue(status.isShow());\n+        assertTrue(!status.getMessage().isEmpty());\n+\n+        VALUE.clear();\n+        VALUE.add(\"TRUE\");\n+        assertTrue(status.isShow());\n+        assertTrue(!status.getMessage().isEmpty());\n+\n+        VALUE.clear();\n+        VALUE.add(\"FALSE\");\n+        assertFalse(status.isShow());\n+        assertTrue(\n+                status.getMessage()\n+                        .get()\n+                        .startsWith(\"Java system properties hidden for security reasons.\"));\n+\n+        VALUE.clear();\n+        VALUE.add(\"false\");\n+        assertFalse(status.isShow());\n+        assertTrue(\n+                status.getMessage()\n+                        .get()\n+                        .startsWith(\"Java system properties hidden for security reasons.\"));\n+\n+        // default -> false\n+        VALUE.clear();\n+        assertFalse(status.isShow());\n+        assertTrue(\n+                status.getMessage()\n+                        .get()\n+                        .startsWith(\"Java system properties hidden for security reasons.\"));\n+\n+        // bad value -> false\n+        VALUE.clear();\n+        VALUE.add(\"maybe\");\n+        assertFalse(status.isShow());\n+        assertTrue(\n+                status.getMessage()\n+                        .get()\n+                        .startsWith(\"Java system properties hidden for security reasons.\"));\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/minio/minio/commits/f246c9053f9603e610d98439799bdd2a6b293427",
        "url": "https://api.github.com/repos/minio/minio/commits/f246c9053f9603e610d98439799bdd2a6b293427",
        "html_url": "https://github.com/minio/minio/commit/f246c9053f9603e610d98439799bdd2a6b293427",
        "message": "fix: Privilege escalation in IAM import API (#20756)\n\nThis API had missing permissions checking, allowing a user to change\r\ntheir policy mapping by:\r\n\r\n1. Craft iam-info.zip file: Update own user permission in\r\nuser_mappings.json\r\n2. Upload it via `mc admin cluster iam import nobody iam-info.zip`\r\n\r\nHere `nobody` can be a user with pretty much any kind of permission (but\r\nnot anonymous) and this ends up working.\r\n\r\nSome more detailed steps - start from a fresh setup:\r\n\r\n```\r\n./minio server /tmp/d{1...4} &\r\nmc alias set myminio http://localhost:9000 minioadmin minioadmin\r\nmc admin user add myminio nobody nobody123\r\nmc admin policy attach myminio readwrite nobody nobody123\r\nmc alias set nobody http://localhost:9000 nobody nobody123\r\n\r\nmc admin cluster iam export myminio\r\nmkdir /tmp/x && mv myminio-iam-info.zip /tmp/x\r\ncd /tmp/x\r\nunzip myminio-iam-info.zip\r\necho '{\"nobody\":{\"version\":1,\"policy\":\"consoleAdmin\",\"updatedAt\":\"2024-08-13T19:47:10.1Z\"}}' > \\\r\n      iam-assets/user_mappings.json\r\nzip -r myminio-iam-info-updated.zip iam-assets/\r\n\r\nmc admin cluster iam import nobody ./myminio-iam-info-updated.zip\r\nmc admin service restart nobody\r\n```",
        "files": [
            {
                "sha": "320b186df1a317ec05e6d3d278eba5374e862c1d",
                "filename": "cmd/admin-handlers-users.go",
                "status": "modified",
                "additions": 4,
                "deletions": 44,
                "changes": 48,
                "blob_url": "https://github.com/minio/minio/blob/f246c9053f9603e610d98439799bdd2a6b293427/cmd%2Fadmin-handlers-users.go",
                "raw_url": "https://github.com/minio/minio/raw/f246c9053f9603e610d98439799bdd2a6b293427/cmd%2Fadmin-handlers-users.go",
                "contents_url": "https://api.github.com/repos/minio/minio/contents/cmd%2Fadmin-handlers-users.go?ref=f246c9053f9603e610d98439799bdd2a6b293427",
                "patch": "@@ -2032,6 +2032,7 @@ func (a adminAPIHandlers) ExportIAM(w http.ResponseWriter, r *http.Request) {\n \t// Get current object layer instance.\n \tobjectAPI, _ := validateAdminReq(ctx, w, r, policy.ExportIAMAction)\n \tif objectAPI == nil {\n+\t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(ErrServerNotInitialized), r.URL)\n \t\treturn\n \t}\n \t// Initialize a zip writer which will provide a zipped content\n@@ -2254,17 +2255,13 @@ func (a adminAPIHandlers) ImportIAMV2(w http.ResponseWriter, r *http.Request) {\n func (a adminAPIHandlers) importIAM(w http.ResponseWriter, r *http.Request, apiVer string) {\n \tctx := r.Context()\n \n-\t// Get current object layer instance.\n-\tobjectAPI := newObjectLayerFn()\n+\t// Validate signature, permissions and get current object layer instance.\n+\tobjectAPI, _ := validateAdminReq(ctx, w, r, policy.ImportIAMAction)\n \tif objectAPI == nil || globalNotificationSys == nil {\n \t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(ErrServerNotInitialized), r.URL)\n \t\treturn\n \t}\n-\tcred, owner, s3Err := validateAdminSignature(ctx, r, \"\")\n-\tif s3Err != ErrNone {\n-\t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(s3Err), r.URL)\n-\t\treturn\n-\t}\n+\n \tdata, err := io.ReadAll(r.Body)\n \tif err != nil {\n \t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(ErrInvalidRequest), r.URL)\n@@ -2354,38 +2351,12 @@ func (a adminAPIHandlers) importIAM(w http.ResponseWriter, r *http.Request, apiV\n \t\t\t\t\treturn\n \t\t\t\t}\n \n-\t\t\t\tif (cred.IsTemp() || cred.IsServiceAccount()) && cred.ParentUser == accessKey {\n-\t\t\t\t\t// Incoming access key matches parent user then we should\n-\t\t\t\t\t// reject password change requests.\n-\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAddUserInvalidArgument, err, allUsersFile, accessKey), r.URL)\n-\t\t\t\t\treturn\n-\t\t\t\t}\n-\n \t\t\t\t// Check if accessKey has beginning and end space characters, this only applies to new users.\n \t\t\t\tif !exists && hasSpaceBE(accessKey) {\n \t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminResourceInvalidArgument, err, allUsersFile, accessKey), r.URL)\n \t\t\t\t\treturn\n \t\t\t\t}\n \n-\t\t\t\tcheckDenyOnly := false\n-\t\t\t\tif accessKey == cred.AccessKey {\n-\t\t\t\t\t// Check that there is no explicit deny - otherwise it's allowed\n-\t\t\t\t\t// to change one's own password.\n-\t\t\t\t\tcheckDenyOnly = true\n-\t\t\t\t}\n-\n-\t\t\t\tif !globalIAMSys.IsAllowed(policy.Args{\n-\t\t\t\t\tAccountName:     cred.AccessKey,\n-\t\t\t\t\tGroups:          cred.Groups,\n-\t\t\t\t\tAction:          policy.CreateUserAdminAction,\n-\t\t\t\t\tConditionValues: getConditionValues(r, \"\", cred),\n-\t\t\t\t\tIsOwner:         owner,\n-\t\t\t\t\tClaims:          cred.Claims,\n-\t\t\t\t\tDenyOnly:        checkDenyOnly,\n-\t\t\t\t}) {\n-\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAccessDenied, err, allUsersFile, accessKey), r.URL)\n-\t\t\t\t\treturn\n-\t\t\t\t}\n \t\t\t\tif _, err = globalIAMSys.CreateUser(ctx, accessKey, ureq); err != nil {\n \t\t\t\t\tfailed.Users = append(failed.Users, madmin.IAMErrEntity{Name: accessKey, Error: err})\n \t\t\t\t} else {\n@@ -2485,17 +2456,6 @@ func (a adminAPIHandlers) importIAM(w http.ResponseWriter, r *http.Request, apiV\n \t\t\t\t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(ErrAdminResourceInvalidArgument), r.URL)\n \t\t\t\t\treturn\n \t\t\t\t}\n-\t\t\t\tif !globalIAMSys.IsAllowed(policy.Args{\n-\t\t\t\t\tAccountName:     cred.AccessKey,\n-\t\t\t\t\tGroups:          cred.Groups,\n-\t\t\t\t\tAction:          policy.CreateServiceAccountAdminAction,\n-\t\t\t\t\tConditionValues: getConditionValues(r, \"\", cred),\n-\t\t\t\t\tIsOwner:         owner,\n-\t\t\t\t\tClaims:          cred.Claims,\n-\t\t\t\t}) {\n-\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAccessDenied, err, allSvcAcctsFile, user), r.URL)\n-\t\t\t\t\treturn\n-\t\t\t\t}\n \t\t\t\tupdateReq := true\n \t\t\t\t_, _, err = globalIAMSys.GetServiceAccount(ctx, svcAcctReq.AccessKey)\n \t\t\t\tif err != nil {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/minio/minio/commits/580d9db85e04f1b63cc2909af50f0ed08afa965f",
        "url": "https://api.github.com/repos/minio/minio/commits/580d9db85e04f1b63cc2909af50f0ed08afa965f",
        "html_url": "https://github.com/minio/minio/commit/580d9db85e04f1b63cc2909af50f0ed08afa965f",
        "message": "Add APIs to import/export IAM data (#15014)",
        "files": [
            {
                "sha": "867f4b8a776fb3e38d91cf9e124660b1b113950d",
                "filename": "cmd/admin-bucket-handlers.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/minio/minio/blob/580d9db85e04f1b63cc2909af50f0ed08afa965f/cmd%2Fadmin-bucket-handlers.go",
                "raw_url": "https://github.com/minio/minio/raw/580d9db85e04f1b63cc2909af50f0ed08afa965f/cmd%2Fadmin-bucket-handlers.go",
                "contents_url": "https://api.github.com/repos/minio/minio/contents/cmd%2Fadmin-bucket-handlers.go?ref=580d9db85e04f1b63cc2909af50f0ed08afa965f",
                "patch": "@@ -804,7 +804,7 @@ func (a adminAPIHandlers) ImportBucketMetadataHandler(w http.ResponseWriter, r *\n \tfor _, file := range zr.File {\n \t\treader, err := file.Open()\n \t\tif err != nil {\n-\t\t\twriteErrorResponse(ctx, w, importError(ctx, err, file.Name, bucket), r.URL)\n+\t\t\twriteErrorResponse(ctx, w, importError(ctx, err, file.Name, \"\"), r.URL)\n \t\t\treturn\n \t\t}\n \t\tsz := file.FileInfo().Size()"
            },
            {
                "sha": "2d74914434ce2c3261debd72a9a3a24df6549905",
                "filename": "cmd/admin-handler-utils.go",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/minio/minio/blob/580d9db85e04f1b63cc2909af50f0ed08afa965f/cmd%2Fadmin-handler-utils.go",
                "raw_url": "https://github.com/minio/minio/raw/580d9db85e04f1b63cc2909af50f0ed08afa965f/cmd%2Fadmin-handler-utils.go",
                "contents_url": "https://api.github.com/repos/minio/minio/contents/cmd%2Fadmin-handler-utils.go?ref=580d9db85e04f1b63cc2909af50f0ed08afa965f",
                "patch": "@@ -240,3 +240,11 @@ func importError(ctx context.Context, err error, fname, entity string) APIError\n \t}\n \treturn toAPIError(ctx, fmt.Errorf(\"error importing %s from %s with: %w\", entity, fname, err))\n }\n+\n+// wraps import error for more context\n+func importErrorWithAPIErr(ctx context.Context, apiErr APIErrorCode, err error, fname, entity string) APIError {\n+\tif entity == \"\" {\n+\t\treturn errorCodes.ToAPIErrWithErr(apiErr, fmt.Errorf(\"error importing %s with: %w\", fname, err))\n+\t}\n+\treturn errorCodes.ToAPIErrWithErr(apiErr, fmt.Errorf(\"error importing %s from %s with: %w\", entity, fname, err))\n+}"
            },
            {
                "sha": "3c9ff26186f41e33f5637067eed2d6203055e870",
                "filename": "cmd/admin-handlers-users.go",
                "status": "modified",
                "additions": 678,
                "deletions": 1,
                "changes": 679,
                "blob_url": "https://github.com/minio/minio/blob/580d9db85e04f1b63cc2909af50f0ed08afa965f/cmd%2Fadmin-handlers-users.go",
                "raw_url": "https://github.com/minio/minio/raw/580d9db85e04f1b63cc2909af50f0ed08afa965f/cmd%2Fadmin-handlers-users.go",
                "contents_url": "https://api.github.com/repos/minio/minio/contents/cmd%2Fadmin-handlers-users.go?ref=580d9db85e04f1b63cc2909af50f0ed08afa965f",
                "patch": "@@ -24,9 +24,12 @@ import (\n \t\"io\"\n \t\"io/ioutil\"\n \t\"net/http\"\n+\t\"os\"\n \t\"sort\"\n+\t\"time\"\n \n \t\"github.com/gorilla/mux\"\n+\t\"github.com/klauspost/compress/zip\"\n \t\"github.com/minio/madmin-go\"\n \t\"github.com/minio/minio/internal/auth\"\n \t\"github.com/minio/minio/internal/config/dns\"\n@@ -629,7 +632,7 @@ func (a adminAPIHandlers) AddServiceAccount(w http.ResponseWriter, r *http.Reque\n \t\t\topts.claims[k] = v\n \t\t}\n \t} else {\n-\t\t// Need permission if we are creating a service acccount for a\n+\t\t// Need permission if we are creating a service account for a\n \t\t// user <> to the request sender\n \t\tif !globalIAMSys.IsAllowed(iampolicy.Args{\n \t\t\tAccountName:     requestorUser,\n@@ -1512,3 +1515,677 @@ func (a adminAPIHandlers) SetPolicyForUserOrGroup(w http.ResponseWriter, r *http\n \t\treturn\n \t}\n }\n+\n+const (\n+\tallPoliciesFile            = \"policies.json\"\n+\tallUsersFile               = \"users.json\"\n+\tallGroupsFile              = \"groups.json\"\n+\tallSvcAcctsFile            = \"svcaccts.json\"\n+\tuserPolicyMappingsFile     = \"user_mappings.json\"\n+\tgroupPolicyMappingsFile    = \"group_mappings.json\"\n+\tstsUserPolicyMappingsFile  = \"stsuser_mappings.json\"\n+\tstsGroupPolicyMappingsFile = \"stsgroup_mappings.json\"\n+)\n+\n+// ExportIAMHandler - exports all iam info as a zipped file\n+func (a adminAPIHandlers) ExportIAM(w http.ResponseWriter, r *http.Request) {\n+\tctx := newContext(r, w, \"ExportIAM\")\n+\tdefer logger.AuditLog(ctx, w, r, mustGetClaimsFromToken(r))\n+\n+\t// Get current object layer instance.\n+\tobjectAPI, _ := validateAdminReq(ctx, w, r, iampolicy.ExportIAMAction)\n+\tif objectAPI == nil {\n+\t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(ErrServerNotInitialized), r.URL)\n+\t\treturn\n+\t}\n+\t// Initialize a zip writer which will provide a zipped content\n+\t// of bucket metadata\n+\tzipWriter := zip.NewWriter(w)\n+\tdefer zipWriter.Close()\n+\trawDataFn := func(r io.Reader, filename string, sz int) error {\n+\t\theader, zerr := zip.FileInfoHeader(dummyFileInfo{\n+\t\t\tname:    filename,\n+\t\t\tsize:    int64(sz),\n+\t\t\tmode:    0o600,\n+\t\t\tmodTime: time.Now(),\n+\t\t\tisDir:   false,\n+\t\t\tsys:     nil,\n+\t\t})\n+\t\tif zerr != nil {\n+\t\t\tlogger.LogIf(ctx, zerr)\n+\t\t\treturn nil\n+\t\t}\n+\t\theader.Method = zip.Deflate\n+\t\tzwriter, zerr := zipWriter.CreateHeader(header)\n+\t\tif zerr != nil {\n+\t\t\tlogger.LogIf(ctx, zerr)\n+\t\t\treturn nil\n+\t\t}\n+\t\tif _, err := io.Copy(zwriter, r); err != nil {\n+\t\t\tlogger.LogIf(ctx, err)\n+\t\t}\n+\t\treturn nil\n+\t}\n+\n+\tiamFiles := []string{\n+\t\tallPoliciesFile,\n+\t\tallUsersFile,\n+\t\tallGroupsFile,\n+\t\tallSvcAcctsFile,\n+\t\tuserPolicyMappingsFile,\n+\t\tgroupPolicyMappingsFile,\n+\t\tstsUserPolicyMappingsFile,\n+\t\tstsGroupPolicyMappingsFile,\n+\t}\n+\tfor _, iamFile := range iamFiles {\n+\t\tswitch iamFile {\n+\t\tcase allPoliciesFile:\n+\t\t\tallPolicies, err := globalIAMSys.ListPolicies(ctx, \"\")\n+\t\t\tif err != nil {\n+\t\t\t\tlogger.LogIf(ctx, err)\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\tpoliciesData, err := json.Marshal(allPolicies)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif err = rawDataFn(bytes.NewReader(policiesData), iamFile, len(policiesData)); err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\tcase allUsersFile:\n+\t\t\tuserCreds := make(map[string]auth.Credentials)\n+\t\t\tglobalIAMSys.store.rlock()\n+\t\t\terr := globalIAMSys.store.loadUsers(ctx, regUser, userCreds)\n+\t\t\tglobalIAMSys.store.runlock()\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tuserAccounts := make(map[string]madmin.AddOrUpdateUserReq)\n+\t\t\tfor u, cred := range userCreds {\n+\t\t\t\tstatus := madmin.AccountDisabled\n+\t\t\t\tif cred.IsValid() {\n+\t\t\t\t\tstatus = madmin.AccountEnabled\n+\t\t\t\t}\n+\t\t\t\tuserAccounts[u] = madmin.AddOrUpdateUserReq{\n+\t\t\t\t\tSecretKey: cred.SecretKey,\n+\t\t\t\t\tStatus:    status,\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tuserData, err := json.Marshal(userAccounts)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\tif err = rawDataFn(bytes.NewReader(userData), iamFile, len(userData)); err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\tcase allGroupsFile:\n+\t\t\tgroups := make(map[string]GroupInfo)\n+\t\t\tglobalIAMSys.store.rlock()\n+\t\t\terr := globalIAMSys.store.loadGroups(ctx, groups)\n+\t\t\tglobalIAMSys.store.runlock()\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tgroupData, err := json.Marshal(groups)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\tif err = rawDataFn(bytes.NewReader(groupData), iamFile, len(groupData)); err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\tcase allSvcAcctsFile:\n+\t\t\tserviceAccounts := make(map[string]auth.Credentials)\n+\t\t\tglobalIAMSys.store.rlock()\n+\t\t\terr := globalIAMSys.store.loadUsers(ctx, svcUser, serviceAccounts)\n+\t\t\tglobalIAMSys.store.runlock()\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tsvcAccts := make(map[string]madmin.SRSvcAccCreate)\n+\t\t\tfor user, acc := range serviceAccounts {\n+\t\t\t\tif user == siteReplicatorSvcAcc {\n+\t\t\t\t\t// skip the site replicate svc account as it should be created automatically if\n+\t\t\t\t\t// site replication is enabled.\n+\t\t\t\t\tcontinue\n+\t\t\t\t}\n+\t\t\t\tclaims, err := globalIAMSys.GetClaimsForSvcAcc(ctx, acc.AccessKey)\n+\t\t\t\tif err != nil {\n+\t\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t\t_, policy, err := globalIAMSys.GetServiceAccount(ctx, acc.AccessKey)\n+\t\t\t\tif err != nil {\n+\t\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\n+\t\t\t\tvar policyJSON []byte\n+\t\t\t\tif policy != nil {\n+\t\t\t\t\tpolicyJSON, err = json.Marshal(policy)\n+\t\t\t\t\tif err != nil {\n+\t\t\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\t\t\treturn\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tsvcAccts[user] = madmin.SRSvcAccCreate{\n+\t\t\t\t\tParent:        acc.ParentUser,\n+\t\t\t\t\tAccessKey:     user,\n+\t\t\t\t\tSecretKey:     acc.SecretKey,\n+\t\t\t\t\tGroups:        acc.Groups,\n+\t\t\t\t\tClaims:        claims,\n+\t\t\t\t\tSessionPolicy: json.RawMessage(policyJSON),\n+\t\t\t\t\tStatus:        acc.Status,\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tsvcAccData, err := json.Marshal(svcAccts)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\tif err = rawDataFn(bytes.NewReader(svcAccData), iamFile, len(svcAccData)); err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\tcase userPolicyMappingsFile:\n+\t\t\tuserPolicyMap := make(map[string]MappedPolicy)\n+\t\t\tglobalIAMSys.store.rlock()\n+\t\t\terr := globalIAMSys.store.loadMappedPolicies(ctx, regUser, false, userPolicyMap)\n+\t\t\tglobalIAMSys.store.runlock()\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tuserPolData, err := json.Marshal(userPolicyMap)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\tif err = rawDataFn(bytes.NewReader(userPolData), iamFile, len(userPolData)); err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\tcase groupPolicyMappingsFile:\n+\t\t\tgroupPolicyMap := make(map[string]MappedPolicy)\n+\t\t\tglobalIAMSys.store.rlock()\n+\t\t\terr := globalIAMSys.store.loadMappedPolicies(ctx, regUser, true, groupPolicyMap)\n+\t\t\tglobalIAMSys.store.runlock()\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tgrpPolData, err := json.Marshal(groupPolicyMap)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\tif err = rawDataFn(bytes.NewReader(grpPolData), iamFile, len(grpPolData)); err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\tcase stsUserPolicyMappingsFile:\n+\t\t\tuserPolicyMap := make(map[string]MappedPolicy)\n+\t\t\tglobalIAMSys.store.rlock()\n+\t\t\terr := globalIAMSys.store.loadMappedPolicies(ctx, stsUser, false, userPolicyMap)\n+\t\t\tglobalIAMSys.store.runlock()\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tuserPolData, err := json.Marshal(userPolicyMap)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif err = rawDataFn(bytes.NewReader(userPolData), iamFile, len(userPolData)); err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\tcase stsGroupPolicyMappingsFile:\n+\t\t\tgroupPolicyMap := make(map[string]MappedPolicy)\n+\t\t\tglobalIAMSys.store.rlock()\n+\t\t\terr := globalIAMSys.store.loadMappedPolicies(ctx, stsUser, true, groupPolicyMap)\n+\t\t\tglobalIAMSys.store.runlock()\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tgrpPolData, err := json.Marshal(groupPolicyMap)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif err = rawDataFn(bytes.NewReader(grpPolData), iamFile, len(grpPolData)); err != nil {\n+\t\t\t\twriteErrorResponse(ctx, w, exportError(ctx, err, iamFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t}\n+\t}\n+}\n+\n+// ImportIAM - imports all IAM info into MinIO\n+func (a adminAPIHandlers) ImportIAM(w http.ResponseWriter, r *http.Request) {\n+\tctx := newContext(r, w, \"ImportIAM\")\n+\n+\tdefer logger.AuditLog(ctx, w, r, mustGetClaimsFromToken(r))\n+\n+\t// Get current object layer instance.\n+\tobjectAPI := newObjectLayerFn()\n+\tif objectAPI == nil || globalNotificationSys == nil {\n+\t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(ErrServerNotInitialized), r.URL)\n+\t\treturn\n+\t}\n+\tcred, claims, owner, s3Err := validateAdminSignature(ctx, r, \"\")\n+\tif s3Err != ErrNone {\n+\t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(s3Err), r.URL)\n+\t\treturn\n+\t}\n+\tdata, err := ioutil.ReadAll(r.Body)\n+\tif err != nil {\n+\t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(ErrInvalidRequest), r.URL)\n+\t\treturn\n+\t}\n+\treader := bytes.NewReader(data)\n+\tzr, err := zip.NewReader(reader, int64(len(data)))\n+\tif err != nil {\n+\t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(ErrInvalidRequest), r.URL)\n+\t\treturn\n+\t}\n+\t// import policies first\n+\t{\n+\t\tf, err := zr.Open(allPoliciesFile)\n+\t\tswitch {\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\tcase err != nil:\n+\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, allPoliciesFile, \"\"), r.URL)\n+\t\t\treturn\n+\t\tdefault:\n+\t\t\tdefer f.Close()\n+\t\t\tvar allPolicies map[string]iampolicy.Policy\n+\t\t\tdata, err = ioutil.ReadAll(f)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, allPoliciesFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\terr = json.Unmarshal(data, &allPolicies)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminConfigBadJSON, err, allPoliciesFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tfor policyName, policy := range allPolicies {\n+\t\t\t\tif policy.IsEmpty() {\n+\t\t\t\t\terr = globalIAMSys.DeletePolicy(ctx, policyName, true)\n+\t\t\t\t} else {\n+\t\t\t\t\terr = globalIAMSys.SetPolicy(ctx, policyName, policy)\n+\t\t\t\t}\n+\t\t\t\tif err != nil {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, allPoliciesFile, policyName), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t// import users\n+\t{\n+\t\tf, err := zr.Open(allUsersFile)\n+\t\tswitch {\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\tcase err != nil:\n+\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, allUsersFile, \"\"), r.URL)\n+\t\t\treturn\n+\t\tdefault:\n+\t\t\tdefer f.Close()\n+\t\t\tvar userAccts map[string]madmin.AddOrUpdateUserReq\n+\t\t\tdata, err := ioutil.ReadAll(f)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, allUsersFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\terr = json.Unmarshal(data, &userAccts)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminConfigBadJSON, err, allUsersFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tfor accessKey, ureq := range userAccts {\n+\t\t\t\t// Not allowed to add a user with same access key as root credential\n+\t\t\t\tif owner && accessKey == cred.AccessKey {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAddUserInvalidArgument, err, allUsersFile, accessKey), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\n+\t\t\t\tuserCred, exists := globalIAMSys.GetUser(ctx, accessKey)\n+\t\t\t\tif exists && (userCred.IsTemp() || userCred.IsServiceAccount()) {\n+\t\t\t\t\t// Updating STS credential is not allowed, and this API does not\n+\t\t\t\t\t// support updating service accounts.\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAddUserInvalidArgument, err, allUsersFile, accessKey), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\n+\t\t\t\tif (cred.IsTemp() || cred.IsServiceAccount()) && cred.ParentUser == accessKey {\n+\t\t\t\t\t// Incoming access key matches parent user then we should\n+\t\t\t\t\t// reject password change requests.\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAddUserInvalidArgument, err, allUsersFile, accessKey), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\n+\t\t\t\t// Check if accessKey has beginning and end space characters, this only applies to new users.\n+\t\t\t\tif !exists && hasSpaceBE(accessKey) {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminResourceInvalidArgument, err, allUsersFile, accessKey), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\n+\t\t\t\tcheckDenyOnly := false\n+\t\t\t\tif accessKey == cred.AccessKey {\n+\t\t\t\t\t// Check that there is no explicit deny - otherwise it's allowed\n+\t\t\t\t\t// to change one's own password.\n+\t\t\t\t\tcheckDenyOnly = true\n+\t\t\t\t}\n+\n+\t\t\t\tif !globalIAMSys.IsAllowed(iampolicy.Args{\n+\t\t\t\t\tAccountName:     cred.AccessKey,\n+\t\t\t\t\tGroups:          cred.Groups,\n+\t\t\t\t\tAction:          iampolicy.CreateUserAdminAction,\n+\t\t\t\t\tConditionValues: getConditionValues(r, \"\", cred.AccessKey, claims),\n+\t\t\t\t\tIsOwner:         owner,\n+\t\t\t\t\tClaims:          claims,\n+\t\t\t\t\tDenyOnly:        checkDenyOnly,\n+\t\t\t\t}) {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAccessDenied, err, allUsersFile, accessKey), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t\tif err = globalIAMSys.CreateUser(ctx, accessKey, ureq); err != nil {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, toAdminAPIErrCode(ctx, err), err, allUsersFile, accessKey), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t// import groups\n+\t{\n+\t\tf, err := zr.Open(allGroupsFile)\n+\t\tswitch {\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\tcase err != nil:\n+\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, allGroupsFile, \"\"), r.URL)\n+\t\t\treturn\n+\t\tdefault:\n+\t\t\tdefer f.Close()\n+\t\t\tvar grpInfos map[string]GroupInfo\n+\t\t\tdata, err := ioutil.ReadAll(f)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, allGroupsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif err = json.Unmarshal(data, &grpInfos); err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminConfigBadJSON, err, allGroupsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tfor group, grpInfo := range grpInfos {\n+\t\t\t\t// Check if group already exists\n+\t\t\t\tif _, gerr := globalIAMSys.GetGroupDescription(group); gerr != nil {\n+\t\t\t\t\t// If group does not exist, then check if the group has beginning and end space characters\n+\t\t\t\t\t// we will reject such group names.\n+\t\t\t\t\tif errors.Is(gerr, errNoSuchGroup) && hasSpaceBE(group) {\n+\t\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminResourceInvalidArgument, err, allGroupsFile, group), r.URL)\n+\t\t\t\t\t\treturn\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tif gerr := globalIAMSys.AddUsersToGroup(ctx, group, grpInfo.Members); gerr != nil {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, allGroupsFile, group), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t// import service accounts\n+\t{\n+\t\tf, err := zr.Open(allSvcAcctsFile)\n+\t\tswitch {\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\tcase err != nil:\n+\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, allSvcAcctsFile, \"\"), r.URL)\n+\t\t\treturn\n+\t\tdefault:\n+\t\t\tdefer f.Close()\n+\t\t\tvar serviceAcctReqs map[string]madmin.SRSvcAccCreate\n+\t\t\tdata, err := ioutil.ReadAll(f)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, allSvcAcctsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif err = json.Unmarshal(data, &serviceAcctReqs); err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminConfigBadJSON, err, allSvcAcctsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tfor user, svcAcctReq := range serviceAcctReqs {\n+\t\t\t\tvar sp *iampolicy.Policy\n+\t\t\t\tvar err error\n+\t\t\t\tif len(svcAcctReq.SessionPolicy) > 0 {\n+\t\t\t\t\tsp, err = iampolicy.ParseConfig(bytes.NewReader(svcAcctReq.SessionPolicy))\n+\t\t\t\t\tif err != nil {\n+\t\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, allSvcAcctsFile, user), r.URL)\n+\t\t\t\t\t\treturn\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\t// service account access key cannot have space characters beginning and end of the string.\n+\t\t\t\tif hasSpaceBE(svcAcctReq.AccessKey) {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, errorCodes.ToAPIErr(ErrAdminResourceInvalidArgument), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t\tif !globalIAMSys.IsAllowed(iampolicy.Args{\n+\t\t\t\t\tAccountName:     svcAcctReq.AccessKey,\n+\t\t\t\t\tGroups:          svcAcctReq.Groups,\n+\t\t\t\t\tAction:          iampolicy.CreateServiceAccountAdminAction,\n+\t\t\t\t\tConditionValues: getConditionValues(r, \"\", cred.AccessKey, claims),\n+\t\t\t\t\tIsOwner:         owner,\n+\t\t\t\t\tClaims:          claims,\n+\t\t\t\t}) {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAccessDenied, err, allSvcAcctsFile, user), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t\tupdateReq := true\n+\t\t\t\t_, _, err = globalIAMSys.GetServiceAccount(ctx, svcAcctReq.AccessKey)\n+\t\t\t\tif err != nil {\n+\t\t\t\t\tif !errors.Is(err, errNoSuchServiceAccount) {\n+\t\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, allSvcAcctsFile, user), r.URL)\n+\t\t\t\t\t\treturn\n+\t\t\t\t\t}\n+\t\t\t\t\tupdateReq = false\n+\t\t\t\t}\n+\t\t\t\tif updateReq {\n+\t\t\t\t\topts := updateServiceAccountOpts{\n+\t\t\t\t\t\tsecretKey:     svcAcctReq.SecretKey,\n+\t\t\t\t\t\tstatus:        svcAcctReq.Status,\n+\t\t\t\t\t\tsessionPolicy: sp,\n+\t\t\t\t\t}\n+\t\t\t\t\terr = globalIAMSys.UpdateServiceAccount(ctx, svcAcctReq.AccessKey, opts)\n+\t\t\t\t\tif err != nil {\n+\t\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, allSvcAcctsFile, user), r.URL)\n+\t\t\t\t\t\treturn\n+\t\t\t\t\t}\n+\t\t\t\t\tcontinue\n+\t\t\t\t}\n+\t\t\t\topts := newServiceAccountOpts{\n+\t\t\t\t\taccessKey:     user,\n+\t\t\t\t\tsecretKey:     svcAcctReq.SecretKey,\n+\t\t\t\t\tsessionPolicy: sp,\n+\t\t\t\t\tclaims:        svcAcctReq.Claims,\n+\t\t\t\t}\n+\n+\t\t\t\t// In case of LDAP we need to resolve the targetUser to a DN and\n+\t\t\t\t// query their groups:\n+\t\t\t\tif globalLDAPConfig.Enabled {\n+\t\t\t\t\topts.claims[ldapUserN] = svcAcctReq.AccessKey // simple username\n+\t\t\t\t\ttargetUser, _, err := globalLDAPConfig.LookupUserDN(svcAcctReq.AccessKey)\n+\t\t\t\t\tif err != nil {\n+\t\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, allSvcAcctsFile, user), r.URL)\n+\t\t\t\t\t\treturn\n+\t\t\t\t\t}\n+\t\t\t\t\topts.claims[ldapUser] = targetUser // username DN\n+\t\t\t\t}\n+\n+\t\t\t\tif _, err = globalIAMSys.NewServiceAccount(ctx, svcAcctReq.Parent, svcAcctReq.Groups, opts); err != nil {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, allSvcAcctsFile, user), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t// import user policy mappings\n+\t{\n+\t\tf, err := zr.Open(userPolicyMappingsFile)\n+\t\tswitch {\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\tcase err != nil:\n+\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, userPolicyMappingsFile, \"\"), r.URL)\n+\t\t\treturn\n+\t\tdefault:\n+\t\t\tdefer f.Close()\n+\t\t\tvar userPolicyMap map[string]MappedPolicy\n+\t\t\tdata, err := ioutil.ReadAll(f)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, userPolicyMappingsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif err = json.Unmarshal(data, &userPolicyMap); err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminConfigBadJSON, err, userPolicyMappingsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tfor u, pm := range userPolicyMap {\n+\t\t\t\t// disallow setting policy mapping if user is a temporary user\n+\t\t\t\tok, _, err := globalIAMSys.IsTempUser(u)\n+\t\t\t\tif err != nil && err != errNoSuchUser {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, userPolicyMappingsFile, u), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t\tif ok {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, errIAMActionNotAllowed, userPolicyMappingsFile, u), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t\tif err := globalIAMSys.PolicyDBSet(ctx, u, pm.Policies, false); err != nil {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, userPolicyMappingsFile, u), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t// import group policy mappings\n+\t{\n+\t\tf, err := zr.Open(groupPolicyMappingsFile)\n+\t\tswitch {\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\tcase err != nil:\n+\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, groupPolicyMappingsFile, \"\"), r.URL)\n+\t\t\treturn\n+\t\tdefault:\n+\t\t\tdefer f.Close()\n+\t\t\tvar grpPolicyMap map[string]MappedPolicy\n+\t\t\tdata, err := ioutil.ReadAll(f)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, groupPolicyMappingsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif err = json.Unmarshal(data, &grpPolicyMap); err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminConfigBadJSON, err, groupPolicyMappingsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tfor g, pm := range grpPolicyMap {\n+\t\t\t\tif err := globalIAMSys.PolicyDBSet(ctx, g, pm.Policies, true); err != nil {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, groupPolicyMappingsFile, g), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t// import sts user policy mappings\n+\t{\n+\t\tf, err := zr.Open(stsUserPolicyMappingsFile)\n+\t\tswitch {\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\tcase err != nil:\n+\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, stsUserPolicyMappingsFile, \"\"), r.URL)\n+\t\t\treturn\n+\t\tdefault:\n+\t\t\tdefer f.Close()\n+\t\t\tvar userPolicyMap map[string]MappedPolicy\n+\t\t\tdata, err := ioutil.ReadAll(f)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, stsUserPolicyMappingsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif err = json.Unmarshal(data, &userPolicyMap); err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminConfigBadJSON, err, stsUserPolicyMappingsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tfor u, pm := range userPolicyMap {\n+\t\t\t\t// disallow setting policy mapping if user is a temporary user\n+\t\t\t\tok, _, err := globalIAMSys.IsTempUser(u)\n+\t\t\t\tif err != nil && err != errNoSuchUser {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, stsUserPolicyMappingsFile, u), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t\tif ok {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, errIAMActionNotAllowed, stsUserPolicyMappingsFile, u), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t\tif err := globalIAMSys.PolicyDBSet(ctx, u, pm.Policies, false); err != nil {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, stsUserPolicyMappingsFile, u), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t// import sts group policy mappings\n+\t{\n+\t\tf, err := zr.Open(stsGroupPolicyMappingsFile)\n+\t\tswitch {\n+\t\tcase errors.Is(err, os.ErrNotExist):\n+\t\tcase err != nil:\n+\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, stsGroupPolicyMappingsFile, \"\"), r.URL)\n+\t\t\treturn\n+\t\tdefault:\n+\t\t\tdefer f.Close()\n+\t\t\tvar grpPolicyMap map[string]MappedPolicy\n+\t\t\tdata, err := ioutil.ReadAll(f)\n+\t\t\tif err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrInvalidRequest, err, stsGroupPolicyMappingsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif err = json.Unmarshal(data, &grpPolicyMap); err != nil {\n+\t\t\t\twriteErrorResponseJSON(ctx, w, importErrorWithAPIErr(ctx, ErrAdminConfigBadJSON, err, stsGroupPolicyMappingsFile, \"\"), r.URL)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tfor g, pm := range grpPolicyMap {\n+\t\t\t\tif err := globalIAMSys.PolicyDBSet(ctx, g, pm.Policies, true); err != nil {\n+\t\t\t\t\twriteErrorResponseJSON(ctx, w, importError(ctx, err, stsGroupPolicyMappingsFile, g), r.URL)\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+}"
            },
            {
                "sha": "d2364bd32d288a12cbbab1140f73dd0683f8e6a4",
                "filename": "cmd/admin-router.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/minio/minio/blob/580d9db85e04f1b63cc2909af50f0ed08afa965f/cmd%2Fadmin-router.go",
                "raw_url": "https://github.com/minio/minio/raw/580d9db85e04f1b63cc2909af50f0ed08afa965f/cmd%2Fadmin-router.go",
                "contents_url": "https://api.github.com/repos/minio/minio/contents/cmd%2Fadmin-router.go?ref=580d9db85e04f1b63cc2909af50f0ed08afa965f",
                "patch": "@@ -170,6 +170,12 @@ func registerAdminRouter(router *mux.Router, enableConfigOps bool) {\n \t\t// Set Group Status\n \t\tadminRouter.Methods(http.MethodPut).Path(adminVersion+\"/set-group-status\").HandlerFunc(gz(httpTraceHdrs(adminAPI.SetGroupStatus))).Queries(\"group\", \"{group:.*}\").Queries(\"status\", \"{status:.*}\")\n \n+\t\t// Export IAM info to zipped file\n+\t\tadminRouter.Methods(http.MethodGet).Path(adminVersion + \"/export-iam\").HandlerFunc(httpTraceHdrs(adminAPI.ExportIAM))\n+\n+\t\t// Import IAM info\n+\t\tadminRouter.Methods(http.MethodPut).Path(adminVersion + \"/import-iam\").HandlerFunc(httpTraceHdrs(adminAPI.ImportIAM))\n+\n \t\t// GetBucketQuotaConfig\n \t\tadminRouter.Methods(http.MethodGet).Path(adminVersion+\"/get-bucket-quota\").HandlerFunc(\n \t\t\tgz(httpTraceHdrs(adminAPI.GetBucketQuotaConfigHandler))).Queries(\"bucket\", \"{bucket:.*}\")"
            },
            {
                "sha": "20f3f9cad80c3e56f6b2ee3656fa590a7a4bb9d1",
                "filename": "go.mod",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/minio/minio/blob/580d9db85e04f1b63cc2909af50f0ed08afa965f/go.mod",
                "raw_url": "https://github.com/minio/minio/raw/580d9db85e04f1b63cc2909af50f0ed08afa965f/go.mod",
                "contents_url": "https://api.github.com/repos/minio/minio/contents/go.mod?ref=580d9db85e04f1b63cc2909af50f0ed08afa965f",
                "patch": "@@ -50,7 +50,7 @@ require (\n \tgithub.com/minio/kes v0.19.2\n \tgithub.com/minio/madmin-go v1.3.14\n \tgithub.com/minio/minio-go/v7 v7.0.29\n-\tgithub.com/minio/pkg v1.1.25\n+\tgithub.com/minio/pkg v1.1.26\n \tgithub.com/minio/selfupdate v0.4.0\n \tgithub.com/minio/sha256-simd v1.0.0\n \tgithub.com/minio/simdjson-go v0.4.2"
            },
            {
                "sha": "8a17bb5023ed9dc0fa46ab2f612512a45e271690",
                "filename": "go.sum",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/minio/minio/blob/580d9db85e04f1b63cc2909af50f0ed08afa965f/go.sum",
                "raw_url": "https://github.com/minio/minio/raw/580d9db85e04f1b63cc2909af50f0ed08afa965f/go.sum",
                "contents_url": "https://api.github.com/repos/minio/minio/contents/go.sum?ref=580d9db85e04f1b63cc2909af50f0ed08afa965f",
                "patch": "@@ -636,8 +636,8 @@ github.com/minio/minio-go/v7 v7.0.23/go.mod h1:ei5JjmxwHaMrgsMrn4U/+Nmg+d8MKS1U2\n github.com/minio/minio-go/v7 v7.0.29 h1:7md6lIq1s6zPzUiDRX1BVLHolA4pDM8RMQqIszaJbY0=\n github.com/minio/minio-go/v7 v7.0.29/go.mod h1:x81+AX5gHSfCSqw7jxRKHvxUXMlE5uKX0Vb75Xk5yYg=\n github.com/minio/pkg v1.1.20/go.mod h1:Xo7LQshlxGa9shKwJ7NzQbgW4s8T/Wc1cOStR/eUiMY=\n-github.com/minio/pkg v1.1.25 h1:QYLzmTFUV5D3bY9qXKzDj7eW2C+HOPcdtIZft9q2Azo=\n-github.com/minio/pkg v1.1.25/go.mod h1:z9PfmEI804KFkF6eY4LoGe8IDVvTCsYGVuaf58Dr0WI=\n+github.com/minio/pkg v1.1.26 h1:a8x4sHNBxCiHEkxZ/0EBTLqvV3nMtM2G/A6lXNfXN3U=\n+github.com/minio/pkg v1.1.26/go.mod h1:z9PfmEI804KFkF6eY4LoGe8IDVvTCsYGVuaf58Dr0WI=\n github.com/minio/selfupdate v0.4.0 h1:A7t07pN4Ch1tBTIRStW0KhUVyykz+2muCqFsITQeEW8=\n github.com/minio/selfupdate v0.4.0/go.mod h1:mcDkzMgq8PRcpCRJo/NlPY7U45O5dfYl2Y0Rg7IustY=\n github.com/minio/sha256-simd v0.1.1/go.mod h1:B5e1o+1/KgNmWrSQK08Y6Z1Vb5pwIktudl0J58iy0KM="
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/usmannasir/cyberpanel/commits/f0cf648c7851c96c36bb0c390d13e60931f45900",
        "url": "https://api.github.com/repos/usmannasir/cyberpanel/commits/f0cf648c7851c96c36bb0c390d13e60931f45900",
        "html_url": "https://github.com/usmannasir/cyberpanel/commit/f0cf648c7851c96c36bb0c390d13e60931f45900",
        "message": "bug fix: phpmyadmin login",
        "files": [
            {
                "sha": "3b2f92d4418741a2a4014ea463df51e971ef6908",
                "filename": "plogical/phpmyadminsignin.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/usmannasir/cyberpanel/blob/f0cf648c7851c96c36bb0c390d13e60931f45900/plogical%2Fphpmyadminsignin.php",
                "raw_url": "https://github.com/usmannasir/cyberpanel/raw/f0cf648c7851c96c36bb0c390d13e60931f45900/plogical%2Fphpmyadminsignin.php",
                "contents_url": "https://api.github.com/repos/usmannasir/cyberpanel/contents/plogical%2Fphpmyadminsignin.php?ref=f0cf648c7851c96c36bb0c390d13e60931f45900",
                "patch": "@@ -11,8 +11,8 @@\n \n         ### Get credentials using the token\n \n-        $token = $_POST['token'];\n-        $username = $_POST['username'];\n+        $token = htmlspecialchars($_POST['token'], ENT_QUOTES, 'UTF-8');\n+        $username = htmlspecialchars($_POST['username'], ENT_QUOTES, 'UTF-8');\n \n         //$url = \"/dataBases/fetchDetailsPHPMYAdmin?token=\" . $token . '&username=' . $username;\n         $url = \"/dataBases/fetchDetailsPHPMYAdmin\";\n@@ -38,7 +38,7 @@\n         session_name(PMA_SIGNON_SESSIONNAME);\n         @session_start();\n \n-        $username = $_POST['username'];\n+        $username = htmlspecialchars($_POST['username'], ENT_QUOTES, 'UTF-8');\n         $password = $_POST['password'];\n \n         $_SESSION['PMA_single_signon_user'] = $username;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/commits/a36718525e08ad0f2a809363001bf105efc5fe1c",
        "url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/commits/a36718525e08ad0f2a809363001bf105efc5fe1c",
        "html_url": "https://github.com/pavel-odintsov/fastnetmon/commit/a36718525e08ad0f2a809363001bf105efc5fe1c",
        "message": "DoS: explicitly blocked zero length data templates for Netflow v9 as they have no sense\nDoS: explicitly blocked zero length options templates for Netflow v9 as they have no sense\nDoS: Added fix for FPE / division by zero in Netflow v9 logic when length of template is zero\n\nReported by Evgeny Shtanov aka Klavishnik",
        "files": [
            {
                "sha": "b9833fd55213ef89cc4cad9219db96f5326d0af0",
                "filename": "src/netflow_plugin/netflow_v9_collector.cpp",
                "status": "modified",
                "additions": 29,
                "deletions": 1,
                "changes": 30,
                "blob_url": "https://github.com/pavel-odintsov/fastnetmon/blob/a36718525e08ad0f2a809363001bf105efc5fe1c/src%2Fnetflow_plugin%2Fnetflow_v9_collector.cpp",
                "raw_url": "https://github.com/pavel-odintsov/fastnetmon/raw/a36718525e08ad0f2a809363001bf105efc5fe1c/src%2Fnetflow_plugin%2Fnetflow_v9_collector.cpp",
                "contents_url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/contents/src%2Fnetflow_plugin%2Fnetflow_v9_collector.cpp?ref=a36718525e08ad0f2a809363001bf105efc5fe1c",
                "patch": "@@ -64,7 +64,9 @@ bool process_netflow_v9_options_template(const uint8_t* pkt, size_t flowset_leng\n     std::vector<template_record_t> template_records_map;\n     uint32_t total_size = 0;\n \n-    for (; offset < fast_ntoh(options_nested_header->option_length);) {\n+     uint32_t option_length = fast_ntoh(options_nested_header->option_length);\n+\n+    for (; offset < option_length;) {\n         records_number++;\n         const netflow9_template_flowset_record_t* tmplr =\n             (const netflow9_template_flowset_record_t*)(zone_address_without_skopes + offset);\n@@ -92,6 +94,15 @@ bool process_netflow_v9_options_template(const uint8_t* pkt, size_t flowset_leng\n     field_template.type                = netflow_template_type_t::Options;\n     field_template.option_scope_length = scopes_total_size;\n \n+    // Templates with total length which is zero do not make any sense and have to be ignored\n+    // We need templates to decode data blob and decoding zero length value is meaningless\n+    if (field_template.total_length == 0) {\n+       logger << log4cpp::Priority::ERROR\n+               << \"Received zero length malformed options Netfow v9 template \" << template_id\n+               << \" from \" << client_addres_in_string_format;\n+        return false;\n+    }\n+\n     // We need to know when we received it\n     field_template.timestamp = current_inaccurate_time;\n \n@@ -183,6 +194,15 @@ bool process_netflow_v9_template(const uint8_t* pkt,\n             // TODO: introduce netflow9_check_rec_len\n         }\n \n+        // Templates with total length which is zero do not make any sense and have to be ignored\n+        // We need templates to decode data blob and decoding zero length value is meaningless\n+        if (total_size == 0) {\n+            logger << log4cpp::Priority::ERROR\n+                << \"Received zero length malformed data Netflow v9 template \" << template_id\n+                << \" from \" << client_addres_in_string_format;\n+            return false;\n+        }\n+\n         template_t field_template{};\n \n         field_template.template_id  = template_id;\n@@ -1473,6 +1493,14 @@ bool process_netflow_v9_data(const uint8_t* pkt,\n         return false;\n     }\n \n+    // Check that template total length is not zero as we're going to divide by it\n+    if (field_template->total_length == 0) {\n+        logger << log4cpp::Priority::ERROR\n+               << \"Zero template length is not valid \"\n+               << \"client \" << client_addres_in_string_format << \" source_id: \" << source_id;\n+       return false;\n+    }\n+\n     uint32_t offset       = sizeof(*dath);\n     uint32_t num_flowsets = (flowset_length - offset) / field_template->total_length;\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/commits/5164a29603fff9dd445b7660a35090989f005000",
        "url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/commits/5164a29603fff9dd445b7660a35090989f005000",
        "html_url": "https://github.com/pavel-odintsov/fastnetmon/commit/5164a29603fff9dd445b7660a35090989f005000",
        "message": "Fixed DoS vulnerability in sFlow v5 plugin which caused crash of FastNetMon with specially crafted packet. Reported by Evgeny Shtanov aka @Klavishnik",
        "files": [
            {
                "sha": "f32a038886cee286eb2375868edf72d35a592314",
                "filename": "src/libsflow/libsflow.hpp",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/pavel-odintsov/fastnetmon/blob/5164a29603fff9dd445b7660a35090989f005000/src%2Flibsflow%2Flibsflow.hpp",
                "raw_url": "https://github.com/pavel-odintsov/fastnetmon/raw/5164a29603fff9dd445b7660a35090989f005000/src%2Flibsflow%2Flibsflow.hpp",
                "contents_url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/contents/src%2Flibsflow%2Flibsflow.hpp?ref=5164a29603fff9dd445b7660a35090989f005000",
                "patch": "@@ -15,6 +15,9 @@\n // We need it for sanity checks\n const uint32_t max_udp_packet_size = 65535;\n \n+// We need to limit number of samples by reasonable number\n+const int32_t max_sflow_sample_number = 256;\n+\n enum class sflow_sample_type_t : unsigned int {\n     FLOW_SAMPLE             = 1,\n     COUNTER_SAMPLE          = 2,"
            },
            {
                "sha": "98754fa87ba8fda1feba79072f8abe26b61c6a0f",
                "filename": "src/sflow_plugin/sflow_collector.cpp",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/pavel-odintsov/fastnetmon/blob/5164a29603fff9dd445b7660a35090989f005000/src%2Fsflow_plugin%2Fsflow_collector.cpp",
                "raw_url": "https://github.com/pavel-odintsov/fastnetmon/raw/5164a29603fff9dd445b7660a35090989f005000/src%2Fsflow_plugin%2Fsflow_collector.cpp",
                "contents_url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/contents/src%2Fsflow_plugin%2Fsflow_collector.cpp?ref=5164a29603fff9dd445b7660a35090989f005000",
                "patch": "@@ -515,6 +515,16 @@ void parse_sflow_v5_packet(const uint8_t* payload_ptr, unsigned int payload_leng\n         return;\n     }\n \n+    // As we're going to allocate memory using this value as number of elements \n+    // we need to ensure that we capped it by reasonable value\n+    if (sflow_header_accessor.get_datagram_samples_count() > max_sflow_sample_number) {\n+         logger << log4cpp::Priority::ERROR << plugin_log_prefix\n+               << \"Number of sFlow samples in packet \" << sflow_header_accessor.get_datagram_samples_count()\n+              << \" exceeds allowed maximum value \" << max_sflow_sample_number;\n+        sflow_bad_packets++;\n+        return;\n+    }\n+\n     std::vector<sample_tuple_t> samples_vector;\n     samples_vector.reserve(sflow_header_accessor.get_datagram_samples_count());\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/commits/65c40ee92dd5bcad1ab52cbafa1afd62cf669e48",
        "url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/commits/65c40ee92dd5bcad1ab52cbafa1afd62cf669e48",
        "html_url": "https://github.com/pavel-odintsov/fastnetmon/commit/65c40ee92dd5bcad1ab52cbafa1afd62cf669e48",
        "message": "Added capping logic for sFlow counter and flow samples to reduce chances of DoS",
        "files": [
            {
                "sha": "611a9e94d8dd33d63627c8b0bc2a800626e9b3af",
                "filename": "src/libsflow/libsflow.hpp",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/pavel-odintsov/fastnetmon/blob/65c40ee92dd5bcad1ab52cbafa1afd62cf669e48/src%2Flibsflow%2Flibsflow.hpp",
                "raw_url": "https://github.com/pavel-odintsov/fastnetmon/raw/65c40ee92dd5bcad1ab52cbafa1afd62cf669e48/src%2Flibsflow%2Flibsflow.hpp",
                "contents_url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/contents/src%2Flibsflow%2Flibsflow.hpp?ref=65c40ee92dd5bcad1ab52cbafa1afd62cf669e48",
                "patch": "@@ -18,6 +18,12 @@ const uint32_t max_udp_packet_size = 65535;\n // We need to limit number of samples by reasonable number\n const int32_t max_sflow_sample_number = 256;\n \n+// We need to limit number of counter samples by reasonable number\n+const uint32_t max_number_of_counter_records = 256;\n+\n+// We need to limit number of flow samples by reasonable number\n+const uint32_t max_number_of_flow_records = 256;\n+\n enum class sflow_sample_type_t : unsigned int {\n     FLOW_SAMPLE             = 1,\n     COUNTER_SAMPLE          = 2,"
            },
            {
                "sha": "01c71dd4ae4fea9518bd12595694235fd3908256",
                "filename": "src/sflow_plugin/sflow_collector.cpp",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/pavel-odintsov/fastnetmon/blob/65c40ee92dd5bcad1ab52cbafa1afd62cf669e48/src%2Fsflow_plugin%2Fsflow_collector.cpp",
                "raw_url": "https://github.com/pavel-odintsov/fastnetmon/raw/65c40ee92dd5bcad1ab52cbafa1afd62cf669e48/src%2Fsflow_plugin%2Fsflow_collector.cpp",
                "contents_url": "https://api.github.com/repos/pavel-odintsov/fastnetmon/contents/src%2Fsflow_plugin%2Fsflow_collector.cpp?ref=65c40ee92dd5bcad1ab52cbafa1afd62cf669e48",
                "patch": "@@ -330,6 +330,17 @@ bool process_sflow_flow_sample(const uint8_t* data_pointer,\n         return false;\n     }\n \n+    if (sflow_sample_header_unified_accessor.get_number_of_flow_records() > max_number_of_flow_records) {\n+        logger << log4cpp::Priority::ERROR << plugin_log_prefix << \"flow records number \"\n+            << sflow_sample_header_unified_accessor.get_number_of_flow_records()\n+            << \" exceeds maximum value \"\n+            << max_number_of_flow_records;\n+\n+        sflow_bad_flow_samples++;\n+\n+        return false;\n+    }\n+\n     const uint8_t* flow_record_zone_start = data_pointer + sflow_sample_header_unified_accessor.get_original_payload_length();\n \n     std::vector<record_tuple_t> vector_tuple;\n@@ -609,6 +620,14 @@ bool process_sflow_counter_sample(const uint8_t* data_pointer,\n         return false;\n     }\n \n+    if (sflow_counter_header_unified_accessor.get_number_of_counter_records() > max_number_of_counter_records) {\n+        logger << log4cpp::Priority::ERROR << plugin_log_prefix << \"number of counter records \"\n+                << sflow_counter_header_unified_accessor.get_number_of_counter_records()\n+                << \" exceeds maximum value \"\n+                << max_number_of_counter_records;\n+        return false;\n+    }\n+\n     std::vector<counter_record_sample_t> counter_record_sample_vector;\n     counter_record_sample_vector.reserve(sflow_counter_header_unified_accessor.get_number_of_counter_records());\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cyclotruc/gitingest/commits/9996a06a94450497c1abb35997f5e6cbc9b571ff",
        "url": "https://api.github.com/repos/coderamp-labs/gitingest/commits/9996a06a94450497c1abb35997f5e6cbc9b571ff",
        "html_url": "https://github.com/coderamp-labs/gitingest/commit/9996a06a94450497c1abb35997f5e6cbc9b571ff",
        "message": "Fix file management and permissions issues (#23)",
        "files": [
            {
                "sha": "95147895448292677ed3fdbfcc4a22b1e0e15cc0",
                "filename": "Dockerfile",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/coderamp-labs/gitingest/blob/9996a06a94450497c1abb35997f5e6cbc9b571ff/Dockerfile",
                "raw_url": "https://github.com/coderamp-labs/gitingest/raw/9996a06a94450497c1abb35997f5e6cbc9b571ff/Dockerfile",
                "contents_url": "https://api.github.com/repos/coderamp-labs/gitingest/contents/Dockerfile?ref=9996a06a94450497c1abb35997f5e6cbc9b571ff",
                "patch": "@@ -2,9 +2,18 @@ FROM python:3.12\n \n WORKDIR /app\n \n+# Create a non-root user\n+RUN useradd -m -u 1000 appuser\n+\n COPY src/ ./\n COPY requirements.txt ./\n \n RUN pip install -r requirements.txt\n \n+# Change ownership of the application files\n+RUN chown -R appuser:appuser /app\n+\n+# Switch to non-root user\n+USER appuser\n+\n CMD [\"uvicorn\", \"main:app\", \"--reload\"]"
            },
            {
                "sha": "d7845d588863de001a3a920626df3a0bf623e5b6",
                "filename": "requirements.txt",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/coderamp-labs/gitingest/blob/9996a06a94450497c1abb35997f5e6cbc9b571ff/requirements.txt",
                "raw_url": "https://github.com/coderamp-labs/gitingest/raw/9996a06a94450497c1abb35997f5e6cbc9b571ff/requirements.txt",
                "contents_url": "https://api.github.com/repos/coderamp-labs/gitingest/contents/requirements.txt?ref=9996a06a94450497c1abb35997f5e6cbc9b571ff",
                "patch": "@@ -1,4 +1,5 @@\n fastapi[standard]\n uvicorn\n fastapi-analytics\n-slowapi\n\\ No newline at end of file\n+slowapi\n+tokencost\n\\ No newline at end of file"
            },
            {
                "sha": "82ee0a77a939c52f91809a2712ecd889fdf07193",
                "filename": "src/ingest.py",
                "status": "modified",
                "additions": 107,
                "deletions": 3,
                "changes": 110,
                "blob_url": "https://github.com/coderamp-labs/gitingest/blob/9996a06a94450497c1abb35997f5e6cbc9b571ff/src%2Fingest.py",
                "raw_url": "https://github.com/coderamp-labs/gitingest/raw/9996a06a94450497c1abb35997f5e6cbc9b571ff/src%2Fingest.py",
                "contents_url": "https://api.github.com/repos/coderamp-labs/gitingest/contents/src%2Fingest.py?ref=9996a06a94450497c1abb35997f5e6cbc9b571ff",
                "patch": "@@ -4,6 +4,10 @@\n from tokencost import count_string_tokens\n from typing import Dict, List, Union\n \n+MAX_DIRECTORY_DEPTH = 10  # Maximum depth of directory traversal\n+MAX_FILES = 10000  # Maximum number of files to process\n+MAX_TOTAL_SIZE_BYTES = 100 * 1024 * 1024  # 100MB total size limit\n+\n def should_ignore(path: str, base_path: str, ignore_patterns: List[str]) -> bool:\n     \"\"\"Checks if a file or directory should be ignored based on patterns.\"\"\"\n     name = os.path.basename(path)\n@@ -15,6 +19,19 @@ def should_ignore(path: str, base_path: str, ignore_patterns: List[str]) -> bool\n             return True\n     return False\n \n+def is_safe_symlink(symlink_path: str, base_path: str) -> bool:\n+    \"\"\"Check if a symlink points to a location within the base directory.\"\"\"\n+    try:\n+        # Get the absolute path of the symlink target\n+        target_path = os.path.realpath(symlink_path)\n+        # Get the absolute path of the base directory\n+        base_path = os.path.realpath(base_path)\n+        # Check if the target path starts with the base path\n+        return os.path.commonpath([target_path]) == os.path.commonpath([target_path, base_path])\n+    except (OSError, ValueError):\n+        # If there's any error resolving the paths, consider it unsafe\n+        return False\n+\n def is_text_file(file_path: str) -> bool:\n     \"\"\"Determines if a file is likely a text file based on its content.\"\"\"\n     try:\n@@ -32,8 +49,34 @@ def read_file_content(file_path: str) -> str:\n     except Exception as e:\n         return f\"Error reading file: {str(e)}\"\n     \n-def scan_directory(path: str, ignore_patterns: List[str], base_path: str) -> Dict:\n-    \"\"\"Recursively analyzes a directory and its contents.\"\"\"\n+def scan_directory(path: str, ignore_patterns: List[str], base_path: str, seen_paths: set = None, depth: int = 0, stats: Dict = None) -> Dict:\n+    \"\"\"Recursively analyzes a directory and its contents with safety limits.\"\"\"\n+    if seen_paths is None:\n+        seen_paths = set()\n+    if stats is None:\n+        stats = {\"total_files\": 0, \"total_size\": 0}\n+        \n+    # Check depth limit\n+    if depth > MAX_DIRECTORY_DEPTH:\n+        print(f\"Skipping deep directory: {path} (max depth {MAX_DIRECTORY_DEPTH} reached)\")\n+        return None\n+        \n+    # Check total files limit\n+    if stats[\"total_files\"] >= MAX_FILES:\n+        print(f\"Skipping further processing: maximum file limit ({MAX_FILES}) reached\")\n+        return None\n+        \n+    # Check total size limit\n+    if stats[\"total_size\"] >= MAX_TOTAL_SIZE_BYTES:\n+        print(f\"Skipping further processing: maximum total size ({MAX_TOTAL_SIZE_BYTES/1024/1024:.1f}MB) reached\")\n+        return None\n+        \n+    real_path = os.path.realpath(path)\n+    if real_path in seen_paths:\n+        print(f\"Skipping already visited path: {path}\")\n+        return None\n+    seen_paths.add(real_path)\n+    \n     result = {\n         \"name\": os.path.basename(path),\n         \"type\": \"directory\",\n@@ -51,8 +94,69 @@ def scan_directory(path: str, ignore_patterns: List[str], base_path: str) -> Dic\n             if should_ignore(item_path, base_path, ignore_patterns):\n                 continue\n \n+            # Handle symlinks\n+            if os.path.islink(item_path):\n+                if not is_safe_symlink(item_path, base_path):\n+                    print(f\"Skipping symlink that points outside base directory: {item_path}\")\n+                    continue\n+                real_path = os.path.realpath(item_path)\n+                if real_path in seen_paths:\n+                    print(f\"Skipping already visited symlink target: {item_path}\")\n+                    continue\n+                \n+                if os.path.isfile(real_path):\n+                    file_size = os.path.getsize(real_path)\n+                    # Check if adding this file would exceed total size limit\n+                    if stats[\"total_size\"] + file_size > MAX_TOTAL_SIZE_BYTES:\n+                        print(f\"Skipping file {item_path}: would exceed total size limit\")\n+                        continue\n+                        \n+                    stats[\"total_files\"] += 1\n+                    stats[\"total_size\"] += file_size\n+                    \n+                    if stats[\"total_files\"] > MAX_FILES:\n+                        print(f\"Maximum file limit ({MAX_FILES}) reached\")\n+                        return result\n+                        \n+                    is_text = is_text_file(real_path)\n+                    content = read_file_content(real_path) if is_text else \"[Non-text file]\"\n+                    \n+                    child = {\n+                        \"name\": item,\n+                        \"type\": \"file\",\n+                        \"size\": file_size,\n+                        \"content\": content,\n+                        \"path\": item_path\n+                    }\n+                    result[\"children\"].append(child)\n+                    result[\"size\"] += file_size\n+                    result[\"file_count\"] += 1\n+                    \n+                elif os.path.isdir(real_path):\n+                    subdir = scan_directory(real_path, ignore_patterns, base_path, seen_paths, depth + 1, stats)\n+                    if subdir:\n+                        subdir[\"name\"] = item\n+                        subdir[\"path\"] = item_path\n+                        result[\"children\"].append(subdir)\n+                        result[\"size\"] += subdir[\"size\"]\n+                        result[\"file_count\"] += subdir[\"file_count\"]\n+                        result[\"dir_count\"] += 1 + subdir[\"dir_count\"]\n+                continue\n+\n             if os.path.isfile(item_path):\n                 file_size = os.path.getsize(item_path)\n+                # Check if adding this file would exceed total size limit\n+                if stats[\"total_size\"] + file_size > MAX_TOTAL_SIZE_BYTES:\n+                    print(f\"Skipping file {item_path}: would exceed total size limit\")\n+                    continue\n+                    \n+                stats[\"total_files\"] += 1\n+                stats[\"total_size\"] += file_size\n+                \n+                if stats[\"total_files\"] > MAX_FILES:\n+                    print(f\"Maximum file limit ({MAX_FILES}) reached\")\n+                    return result\n+                    \n                 is_text = is_text_file(item_path)\n                 content = read_file_content(item_path) if is_text else \"[Non-text file]\"\n                 \n@@ -68,7 +172,7 @@ def scan_directory(path: str, ignore_patterns: List[str], base_path: str) -> Dic\n                 result[\"file_count\"] += 1\n                 \n             elif os.path.isdir(item_path):\n-                subdir = scan_directory(item_path, ignore_patterns, base_path)\n+                subdir = scan_directory(item_path, ignore_patterns, base_path, seen_paths, depth + 1, stats)\n                 if subdir:\n                     result[\"children\"].append(subdir)\n                     result[\"size\"] += subdir[\"size\"]"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/man-group/dtale/commits/1e26ed3ca12fe83812b90f12a2b3e5fb0b740f7a",
        "url": "https://api.github.com/repos/man-group/dtale/commits/1e26ed3ca12fe83812b90f12a2b3e5fb0b740f7a",
        "html_url": "https://github.com/man-group/dtale/commit/1e26ed3ca12fe83812b90f12a2b3e5fb0b740f7a",
        "message": "https://github.com/man-group/dtale/issues/894: updates to 'update-settings' endpoint",
        "files": [
            {
                "sha": "4fd680a6696f3826c483a2236fae8cdb2eef13a3",
                "filename": "dtale/views.py",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/man-group/dtale/blob/1e26ed3ca12fe83812b90f12a2b3e5fb0b740f7a/dtale%2Fviews.py",
                "raw_url": "https://github.com/man-group/dtale/raw/1e26ed3ca12fe83812b90f12a2b3e5fb0b740f7a/dtale%2Fviews.py",
                "contents_url": "https://api.github.com/repos/man-group/dtale/contents/dtale%2Fviews.py?ref=1e26ed3ca12fe83812b90f12a2b3e5fb0b740f7a",
                "patch": "@@ -1625,6 +1625,13 @@ def update_settings(data_id):\n     \"\"\"\n \n     updated_settings = get_json_arg(request, \"settings\", {})\n+\n+    # block users from manually updating 'enable_custom_filters'\n+    if \"enable_custom_filters\" in updated_settings:\n+        raise ValueError(\n+            \"Cannot alter the property 'enable_custom_filters' from this endpoint\"\n+        )\n+\n     if not global_state.load_flag(data_id, \"enable_custom_filters\", False):\n         updated_settings.pop(\"query\", None)\n "
            },
            {
                "sha": "8c8fc273b7a5472366b6c4678e08a2c28ea9c3fb",
                "filename": "tests/dtale/test_views.py",
                "status": "modified",
                "additions": 15,
                "deletions": 0,
                "changes": 15,
                "blob_url": "https://github.com/man-group/dtale/blob/1e26ed3ca12fe83812b90f12a2b3e5fb0b740f7a/tests%2Fdtale%2Ftest_views.py",
                "raw_url": "https://github.com/man-group/dtale/raw/1e26ed3ca12fe83812b90f12a2b3e5fb0b740f7a/tests%2Fdtale%2Ftest_views.py",
                "contents_url": "https://api.github.com/repos/man-group/dtale/contents/tests%2Fdtale%2Ftest_views.py?ref=1e26ed3ca12fe83812b90f12a2b3e5fb0b740f7a",
                "patch": "@@ -585,6 +585,21 @@ def test_update_settings(test_data, unittest):\n             response_data = response.get_json()\n             assert \"error\" in response_data\n \n+    settings = json.dumps(dict(enable_custom_filters=True))\n+    with app.test_client() as c:\n+        with ExitStack() as stack:\n+            global_state.set_data(c.port, None)\n+            response = c.get(\n+                \"/dtale/update-settings/{}\".format(c.port),\n+                query_string=dict(settings=settings),\n+            )\n+            assert response.status_code == 200, \"should return 200 response\"\n+            response_data = response.get_json()\n+            assert (\n+                response_data[\"error\"]\n+                == \"Cannot alter the property 'enable_custom_filters' from this endpoint\"\n+            )\n+\n \n @pytest.mark.unit\n def test_update_formats():"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/laravel/pulse/commits/d1a5bf2eca36c6e3bedb4ceecd45df7d002a1ebc",
        "url": "https://api.github.com/repos/laravel/pulse/commits/d1a5bf2eca36c6e3bedb4ceecd45df7d002a1ebc",
        "html_url": "https://github.com/laravel/pulse/commit/d1a5bf2eca36c6e3bedb4ceecd45df7d002a1ebc",
        "message": "Update RemembersQueries.php (#429)",
        "files": [
            {
                "sha": "77f770555b9cbefc79bfa02a24af728d1c3e408d",
                "filename": "src/Livewire/Concerns/RemembersQueries.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/laravel/pulse/blob/d1a5bf2eca36c6e3bedb4ceecd45df7d002a1ebc/src%2FLivewire%2FConcerns%2FRemembersQueries.php",
                "raw_url": "https://github.com/laravel/pulse/raw/d1a5bf2eca36c6e3bedb4ceecd45df7d002a1ebc/src%2FLivewire%2FConcerns%2FRemembersQueries.php",
                "contents_url": "https://api.github.com/repos/laravel/pulse/contents/src%2FLivewire%2FConcerns%2FRemembersQueries.php?ref=d1a5bf2eca36c6e3bedb4ceecd45df7d002a1ebc",
                "patch": "@@ -17,7 +17,7 @@ trait RemembersQueries\n      *\n      * @return array{0: mixed, 1: float, 2: string}\n      */\n-    public function remember(callable $query, string $key = '', DateTimeInterface|DateInterval|Closure|int|null $ttl = 5): array\n+    protected function remember(callable $query, string $key = '', DateTimeInterface|DateInterval|Closure|int|null $ttl = 5): array\n     {\n         return App::make(CacheStoreResolver::class)->store()->remember('laravel:pulse:'.static::class.':'.$key.':'.$this->period, $ttl, function () use ($query) {\n             $start = CarbonImmutable::now('UTC')->toDateTimeString();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/thorsten/phpMyFAQ/commits/fa0f7368dc3288eedb1915def64ef8fb270f711d",
        "url": "https://api.github.com/repos/thorsten/phpMyFAQ/commits/fa0f7368dc3288eedb1915def64ef8fb270f711d",
        "html_url": "https://github.com/thorsten/phpMyFAQ/commit/fa0f7368dc3288eedb1915def64ef8fb270f711d",
        "message": "fix: corrected issue if unauthorized user try to access FAQs via solution ID",
        "files": [
            {
                "sha": "91f10dd86a166c75a675584fbd2e0ba947021d3f",
                "filename": "phpmyfaq/src/phpMyFAQ/Faq.php",
                "status": "modified",
                "additions": 8,
                "deletions": 3,
                "changes": 11,
                "blob_url": "https://github.com/thorsten/phpMyFAQ/blob/fa0f7368dc3288eedb1915def64ef8fb270f711d/phpmyfaq%2Fsrc%2FphpMyFAQ%2FFaq.php",
                "raw_url": "https://github.com/thorsten/phpMyFAQ/raw/fa0f7368dc3288eedb1915def64ef8fb270f711d/phpmyfaq%2Fsrc%2FphpMyFAQ%2FFaq.php",
                "contents_url": "https://api.github.com/repos/thorsten/phpMyFAQ/contents/phpmyfaq%2Fsrc%2FphpMyFAQ%2FFaq.php?ref=fa0f7368dc3288eedb1915def64ef8fb270f711d",
                "patch": "@@ -1237,11 +1237,14 @@ public function getRecordBySolutionId(int $solutionId): void\n     {\n         $query = sprintf(\n             'SELECT\n-                *\n+                fd.*, COALESCE(fdg.group_id, -1) AS group_id, fdu.user_id\n             FROM\n                 %sfaqdata fd\n-            LEFT JOIN\n-                %sfaqdata_group fdg\n+            LEFT JOIN (\n+                SELECT record_id, group_id FROM %sfaqdata_group fdg WHERE fdg.group_id <> -1\n+                UNION ALL\n+                SELECT fd.id AS record_id, -1 AS group_id FROM %sfaqdata fd WHERE fd.solution_id = %d\n+            ) AS fdg\n             ON\n                 fd.id = fdg.record_id\n             LEFT JOIN\n@@ -1255,6 +1258,8 @@ public function getRecordBySolutionId(int $solutionId): void\n             Database::getTablePrefix(),\n             Database::getTablePrefix(),\n             $solutionId,\n+            Database::getTablePrefix(),\n+            $solutionId,\n             $this->queryPermission($this->groupSupport)\n         );\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/sunscrapers/djoser/commits/d33c3993c0c735f23cbedc60fa59fce69354f19d",
        "url": "https://api.github.com/repos/sunscrapers/djoser/commits/d33c3993c0c735f23cbedc60fa59fce69354f19d",
        "html_url": "https://github.com/sunscrapers/djoser/commit/d33c3993c0c735f23cbedc60fa59fce69354f19d",
        "message": "rollback 8f65bfff16577c7fb0f52bbabf5fb69f6809ba62, add support for ModelBackend.user_can_authenticate",
        "files": [
            {
                "sha": "129c9f7021bfcb0f79ba9d8b9c5bcdb854ee23b1",
                "filename": "djoser/serializers.py",
                "status": "modified",
                "additions": 3,
                "deletions": 7,
                "changes": 10,
                "blob_url": "https://github.com/sunscrapers/djoser/blob/d33c3993c0c735f23cbedc60fa59fce69354f19d/djoser%2Fserializers.py",
                "raw_url": "https://github.com/sunscrapers/djoser/raw/d33c3993c0c735f23cbedc60fa59fce69354f19d/djoser%2Fserializers.py",
                "contents_url": "https://api.github.com/repos/sunscrapers/djoser/contents/djoser%2Fserializers.py?ref=d33c3993c0c735f23cbedc60fa59fce69354f19d",
                "patch": "@@ -118,17 +118,13 @@ def __init__(self, *args, **kwargs):\n \n     def validate(self, attrs):\n         password = attrs.get(\"password\")\n-        params = {settings.LOGIN_FIELD: attrs.get(settings.LOGIN_FIELD)}\n+        params = {\"username\": attrs.get(settings.LOGIN_FIELD)}\n         self.user = authenticate(\n             request=self.context.get(\"request\"), **params, password=password\n         )\n         if not self.user:\n-            self.user = User.objects.filter(**params).first()\n-            if self.user and not self.user.check_password(password):\n-                self.fail(\"invalid_credentials\")\n-        if self.user and self.user.is_active:\n-            return attrs\n-        self.fail(\"invalid_credentials\")\n+            self.fail(\"invalid_credentials\")\n+        return attrs\n \n \n class UserFunctionsMixin:"
            },
            {
                "sha": "16498a7c8491fdd9ea6474b7f95eba9011525c69",
                "filename": "testproject/testapp/tests/test_token_create.py",
                "status": "modified",
                "additions": 217,
                "deletions": 17,
                "changes": 234,
                "blob_url": "https://github.com/sunscrapers/djoser/blob/d33c3993c0c735f23cbedc60fa59fce69354f19d/testproject%2Ftestapp%2Ftests%2Ftest_token_create.py",
                "raw_url": "https://github.com/sunscrapers/djoser/raw/d33c3993c0c735f23cbedc60fa59fce69354f19d/testproject%2Ftestapp%2Ftests%2Ftest_token_create.py",
                "contents_url": "https://api.github.com/repos/sunscrapers/djoser/contents/testproject%2Ftestapp%2Ftests%2Ftest_token_create.py?ref=d33c3993c0c735f23cbedc60fa59fce69354f19d",
                "patch": "@@ -1,6 +1,9 @@\n import django\n+from unittest import mock\n+\n from django.conf import settings as django_settings\n from django.contrib.auth import user_logged_in, user_login_failed\n+from django.contrib.auth.backends import ModelBackend\n from django.test import override_settings\n from djet import assertions\n from rest_framework import status\n@@ -37,9 +40,221 @@ def test_post_should_login_user(self):\n         self.assertNotEqual(user.last_login, previous_last_login)\n         self.assertTrue(self.signal_sent)\n \n+    @override_settings(\n+        AUTHENTICATION_BACKENDS=[\n+            \"django.contrib.auth.backends.ModelBackend\",\n+        ]\n+    )\n+    @override_settings(\n+        DJOSER=dict(django_settings.DJOSER, **{\"LOGIN_FIELD\": \"username\"})\n+    )\n+    def test_post_should_not_login_if_model_backend_user_can_authenticate__LOGIN_FIELD_username__USERNAME_FIELD_username(  # noqa: E501\n+        self,\n+    ):\n+        user = create_user()\n+        user_logged_in.connect(self.signal_receiver)\n+        previous_last_login = user.last_login\n+\n+        with mock.patch(\"djoser.serializers.User.USERNAME_FIELD\", \"username\"):\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=True\n+            ):\n+                response = self.client.post(\n+                    self.base_url,\n+                    {\"username\": user.username, \"password\": user.raw_password},\n+                )\n+                self.assert_status_equal(response, status.HTTP_200_OK)\n+\n+                user.refresh_from_db()\n+                self.assertEqual(response.data[\"auth_token\"], user.auth_token.key)\n+                self.assertNotEqual(user.last_login, previous_last_login)\n+                self.assertTrue(self.signal_sent)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=False\n+            ):\n+                response = self.client.post(\n+                    self.base_url,\n+                    {\"username\": user.username, \"password\": user.raw_password},\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=True\n+            ):\n+                response = self.client.post(\n+                    self.base_url, {\"email\": user.email, \"password\": user.raw_password}\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=False\n+            ):\n+                response = self.client.post(\n+                    self.base_url, {\"email\": user.email, \"password\": user.raw_password}\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+    @override_settings(\n+        AUTHENTICATION_BACKENDS=[\n+            \"django.contrib.auth.backends.ModelBackend\",\n+        ]\n+    )\n+    @override_settings(DJOSER=dict(django_settings.DJOSER, **{\"LOGIN_FIELD\": \"email\"}))\n+    def test_post_should_not_login_if_model_backend_user_can_authenticate__LOGIN_FIELD_email__USERNAME_FIELD_username(  # noqa: E501\n+        self,\n+    ):\n+        user = create_user()\n+        user_logged_in.connect(self.signal_receiver)\n+        previous_last_login = user.last_login\n+\n+        with mock.patch(\"djoser.serializers.User.USERNAME_FIELD\", \"username\"):\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=True\n+            ):\n+                response = self.client.post(\n+                    self.base_url,\n+                    {\"username\": user.username, \"password\": user.raw_password},\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=False\n+            ):\n+                response = self.client.post(\n+                    self.base_url,\n+                    {\"username\": user.username, \"password\": user.raw_password},\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=True\n+            ):\n+                response = self.client.post(\n+                    self.base_url, {\"email\": user.email, \"password\": user.raw_password}\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=False\n+            ):\n+                response = self.client.post(\n+                    self.base_url, {\"email\": user.email, \"password\": user.raw_password}\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+        user.refresh_from_db()\n+        self.assertEqual(user.last_login, previous_last_login)\n+        self.assertFalse(self.signal_sent)\n+\n+    @override_settings(\n+        AUTHENTICATION_BACKENDS=[\n+            \"django.contrib.auth.backends.ModelBackend\",\n+        ]\n+    )\n+    @override_settings(\n+        DJOSER=dict(django_settings.DJOSER, **{\"LOGIN_FIELD\": \"username\"})\n+    )\n+    def test_post_should_not_login_if_model_backend_user_can_authenticate__LOGIN_FIELD_username__USERNAME_FIELD_email(  # noqa: E501\n+        self,\n+    ):\n+        user = create_user()\n+        user_logged_in.connect(self.signal_receiver)\n+        previous_last_login = user.last_login\n+\n+        with mock.patch(\"djoser.serializers.User.USERNAME_FIELD\", \"email\"):\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=True\n+            ):\n+                response = self.client.post(\n+                    self.base_url,\n+                    {\"username\": user.username, \"password\": user.raw_password},\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=False\n+            ):\n+                response = self.client.post(\n+                    self.base_url,\n+                    {\"username\": user.username, \"password\": user.raw_password},\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=True\n+            ):\n+                response = self.client.post(\n+                    self.base_url, {\"email\": user.email, \"password\": user.raw_password}\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=False\n+            ):\n+                response = self.client.post(\n+                    self.base_url, {\"email\": user.email, \"password\": user.raw_password}\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+        user.refresh_from_db()\n+        self.assertEqual(user.last_login, previous_last_login)\n+        self.assertFalse(self.signal_sent)\n+\n+    @override_settings(\n+        AUTHENTICATION_BACKENDS=[\n+            \"django.contrib.auth.backends.ModelBackend\",\n+        ]\n+    )\n+    @override_settings(DJOSER=dict(django_settings.DJOSER, **{\"LOGIN_FIELD\": \"email\"}))\n+    def test_post_should_not_login_if_model_backend_user_can_authenticate__LOGIN_FIELD_email__USERNAME_FIELD_email(  # noqa: E501\n+        self,\n+    ):\n+        user = create_user()\n+        user_logged_in.connect(self.signal_receiver)\n+        previous_last_login = user.last_login\n+\n+        with mock.patch(\"djoser.serializers.User.USERNAME_FIELD\", \"email\"):\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=True\n+            ):\n+                response = self.client.post(\n+                    self.base_url,\n+                    {\"username\": user.username, \"password\": user.raw_password},\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=False\n+            ):\n+                response = self.client.post(\n+                    self.base_url,\n+                    {\"username\": user.username, \"password\": user.raw_password},\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=True\n+            ):\n+                response = self.client.post(\n+                    self.base_url, {\"email\": user.email, \"password\": user.raw_password}\n+                )\n+                self.assert_status_equal(response, status.HTTP_200_OK)\n+\n+                user.refresh_from_db()\n+                self.assertEqual(response.data[\"auth_token\"], user.auth_token.key)\n+                self.assertNotEqual(user.last_login, previous_last_login)\n+                self.assertTrue(self.signal_sent)\n+\n+            with mock.patch.object(\n+                ModelBackend, \"user_can_authenticate\", return_value=False\n+            ):\n+                response = self.client.post(\n+                    self.base_url, {\"email\": user.email, \"password\": user.raw_password}\n+                )\n+                self.assert_status_equal(response, status.HTTP_400_BAD_REQUEST)\n+\n     def test_post_should_not_login_if_user_is_not_active(self):\n-        \"\"\"In Django >= 1.10 authenticate() returns None if user is inactive,\n-        while in Django < 1.10 authenticate() succeeds if user is inactive.\"\"\"\n         user = create_user()\n         data = {\"username\": user.username, \"password\": user.raw_password}\n         user.is_active = False\n@@ -81,18 +296,3 @@ def test_post_should_not_login_if_empty_request(self):\n             response.data[\"non_field_errors\"],\n             [settings.CONSTANTS.messages.INVALID_CREDENTIALS_ERROR],\n         )\n-\n-    @override_settings(DJOSER=dict(django_settings.DJOSER, **{\"LOGIN_FIELD\": \"email\"}))\n-    def test_login_using_email(self):\n-        user = create_user()\n-        previous_last_login = user.last_login\n-        data = {\"email\": user.email, \"password\": user.raw_password}\n-        user_logged_in.connect(self.signal_receiver)\n-\n-        response = self.client.post(self.base_url, data)\n-        user.refresh_from_db()\n-\n-        self.assert_status_equal(response, status.HTTP_200_OK)\n-        self.assertEqual(response.data[\"auth_token\"], user.auth_token.key)\n-        self.assertNotEqual(user.last_login, previous_last_login)\n-        self.assertTrue(self.signal_sent)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/spatie/browsershot/commits/fae8396641b961f62bd756920b14f01a4391296e",
        "url": "https://api.github.com/repos/spatie/browsershot/commits/fae8396641b961f62bd756920b14f01a4391296e",
        "html_url": "https://github.com/spatie/browsershot/commit/fae8396641b961f62bd756920b14f01a4391296e",
        "message": "make sure urls with leading spaces are not accepted",
        "files": [
            {
                "sha": "1e9188578a5ea41261e278112712419376c4ba3d",
                "filename": ".github/workflows/run-tests.yml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/spatie/browsershot/blob/fae8396641b961f62bd756920b14f01a4391296e/.github%2Fworkflows%2Frun-tests.yml",
                "raw_url": "https://github.com/spatie/browsershot/raw/fae8396641b961f62bd756920b14f01a4391296e/.github%2Fworkflows%2Frun-tests.yml",
                "contents_url": "https://api.github.com/repos/spatie/browsershot/contents/.github%2Fworkflows%2Frun-tests.yml?ref=fae8396641b961f62bd756920b14f01a4391296e",
                "patch": "@@ -9,7 +9,7 @@ jobs:\n             fail-fast: false\n             matrix:\n                 os: [ubuntu-latest]\n-                php: [8.3, 8.2]\n+                php: [8.4, 8.3, 8.2]\n                 stability: [prefer-lowest, prefer-stable]\n \n         name: P${{ matrix.php }} - ${{ matrix.stability }} - ${{ matrix.os }}"
            },
            {
                "sha": "43dd1c19609e74da67af64045ef0df341f435e61",
                "filename": "composer.json",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/spatie/browsershot/blob/fae8396641b961f62bd756920b14f01a4391296e/composer.json",
                "raw_url": "https://github.com/spatie/browsershot/raw/fae8396641b961f62bd756920b14f01a4391296e/composer.json",
                "contents_url": "https://api.github.com/repos/spatie/browsershot/contents/composer.json?ref=fae8396641b961f62bd756920b14f01a4391296e",
                "patch": "@@ -29,10 +29,10 @@\n         \"ext-fileinfo\": \"*\"\n     },\n     \"require-dev\": {\n-        \"pestphp/pest\": \"^1.20\",\n+        \"pestphp/pest\": \"^3.0\",\n         \"spatie/image\": \"^3.6\",\n         \"spatie/pdf-to-text\": \"^1.52\",\n-        \"spatie/phpunit-snapshot-assertions\": \"^4.2.3\"\n+        \"spatie/phpunit-snapshot-assertions\": \"^4.2.3|^5.0\"\n     },\n     \"autoload\": {\n         \"psr-4\": {"
            },
            {
                "sha": "84452613e76a7e7a764d28ce86e05aa2b6da9340",
                "filename": "src/Browsershot.php",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/spatie/browsershot/blob/fae8396641b961f62bd756920b14f01a4391296e/src%2FBrowsershot.php",
                "raw_url": "https://github.com/spatie/browsershot/raw/fae8396641b961f62bd756920b14f01a4391296e/src%2FBrowsershot.php",
                "contents_url": "https://api.github.com/repos/spatie/browsershot/contents/src%2FBrowsershot.php?ref=fae8396641b961f62bd756920b14f01a4391296e",
                "patch": "@@ -257,6 +257,8 @@ public function waitForSelector(string $selector, array $options = []): static\n \n     public function setUrl(string $url): static\n     {\n+        $url = trim($url);\n+\n         if (str_starts_with(strtolower($url), 'file://') || str_starts_with(strtolower($url), 'file:/')) {\n             throw FileUrlNotAllowed::make();\n         }"
            },
            {
                "sha": "62cc4df1972f928128cd6399826fe52336db9b33",
                "filename": "tests/BrowsershotTest.php",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/spatie/browsershot/blob/fae8396641b961f62bd756920b14f01a4391296e/tests%2FBrowsershotTest.php",
                "raw_url": "https://github.com/spatie/browsershot/raw/fae8396641b961f62bd756920b14f01a4391296e/tests%2FBrowsershotTest.php",
                "contents_url": "https://api.github.com/repos/spatie/browsershot/contents/tests%2FBrowsershotTest.php?ref=fae8396641b961f62bd756920b14f01a4391296e",
                "patch": "@@ -56,6 +56,10 @@\n     Browsershot::url('file://test');\n })->throws(FileUrlNotAllowed::class);\n \n+it('will not allow a file url that has leading spaces', function () {\n+    Browsershot::url('    file://test');\n+})->throws(FileUrlNotAllowed::class);\n+\n it('will not allow html to contain file://', function () {\n     Browsershot::html('<h1><img src=\"file://\" /></h1>');\n })->throws(HtmlIsNotAllowedToContainFile::class);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/beego/beego/commits/e7fa4835f71f47ab1d13afd638cebf661800d5a4",
        "url": "https://api.github.com/repos/beego/beego/commits/e7fa4835f71f47ab1d13afd638cebf661800d5a4",
        "html_url": "https://github.com/beego/beego/commit/e7fa4835f71f47ab1d13afd638cebf661800d5a4",
        "message": "modify: file cache writer md5 to sha256 (#5727)\n\n* modify: file cache writer md5 to sha256\r\n\r\n* modify: file cache writer md5 to sha256\r\n\r\n* modify: file cache writer md5 to sha256",
        "files": [
            {
                "sha": "e665cdc16a3524bace8bd60bf6604be2ec55e746",
                "filename": "client/cache/file.go",
                "status": "modified",
                "additions": 8,
                "deletions": 6,
                "changes": 14,
                "blob_url": "https://github.com/beego/beego/blob/e7fa4835f71f47ab1d13afd638cebf661800d5a4/client%2Fcache%2Ffile.go",
                "raw_url": "https://github.com/beego/beego/raw/e7fa4835f71f47ab1d13afd638cebf661800d5a4/client%2Fcache%2Ffile.go",
                "contents_url": "https://api.github.com/repos/beego/beego/contents/client%2Fcache%2Ffile.go?ref=e7fa4835f71f47ab1d13afd638cebf661800d5a4",
                "patch": "@@ -17,7 +17,7 @@ package cache\n import (\n \t\"bytes\"\n \t\"context\"\n-\t\"crypto/md5\"\n+\t\"crypto/sha256\"\n \t\"encoding/gob\"\n \t\"encoding/hex\"\n \t\"encoding/json\"\n@@ -123,29 +123,30 @@ func (fc *FileCache) Init() error {\n \n // getCacheFileName returns a md5 encoded file name.\n func (fc *FileCache) getCacheFileName(key string) (string, error) {\n-\tm := md5.New()\n+\tm := sha256.New()\n \t_, _ = io.WriteString(m, key)\n-\tkeyMd5 := hex.EncodeToString(m.Sum(nil))\n+\tkeySha256 := hex.EncodeToString(m.Sum(nil))\n \tcachePath := fc.CachePath\n \tswitch fc.DirectoryLevel {\n \tcase 2:\n-\t\tcachePath = filepath.Join(cachePath, keyMd5[0:2], keyMd5[2:4])\n+\t\tcachePath = filepath.Join(cachePath, keySha256[0:2], keySha256[2:4])\n \tcase 1:\n-\t\tcachePath = filepath.Join(cachePath, keyMd5[0:2])\n+\t\tcachePath = filepath.Join(cachePath, keySha256[0:2])\n \t}\n \tok, err := exists(cachePath)\n \tif err != nil {\n \t\treturn \"\", err\n \t}\n \tif !ok {\n+\t\tfmt.Printf(\"cachePath: %s\\n\", cachePath)\n \t\terr = os.MkdirAll(cachePath, os.ModePerm)\n \t\tif err != nil {\n \t\t\treturn \"\", berror.Wrapf(err, CreateFileCacheDirFailed,\n \t\t\t\t\"could not create the directory: %s\", cachePath)\n \t\t}\n \t}\n \n-\treturn filepath.Join(cachePath, fmt.Sprintf(\"%s%s\", keyMd5, fc.FileSuffix)), nil\n+\treturn filepath.Join(cachePath, fmt.Sprintf(\"%s%s\", keySha256, fc.FileSuffix)), nil\n }\n \n // Get value from file cache.\n@@ -212,6 +213,7 @@ func (fc *FileCache) Put(ctx context.Context, key string, val interface{}, timeo\n \t}\n \n \tfn, err := fc.getCacheFileName(key)\n+\n \tif err != nil {\n \t\treturn err\n \t}"
            },
            {
                "sha": "db2b8ada87696cba92546458578623e93459781d",
                "filename": "client/cache/file_test.go",
                "status": "modified",
                "additions": 8,
                "deletions": 2,
                "changes": 10,
                "blob_url": "https://github.com/beego/beego/blob/e7fa4835f71f47ab1d13afd638cebf661800d5a4/client%2Fcache%2Ffile_test.go",
                "raw_url": "https://github.com/beego/beego/raw/e7fa4835f71f47ab1d13afd638cebf661800d5a4/client%2Fcache%2Ffile_test.go",
                "contents_url": "https://api.github.com/repos/beego/beego/contents/client%2Fcache%2Ffile_test.go?ref=e7fa4835f71f47ab1d13afd638cebf661800d5a4",
                "patch": "@@ -17,11 +17,10 @@ package cache\n import (\n \t\"context\"\n \t\"fmt\"\n+\t\"github.com/stretchr/testify/assert\"\n \t\"os\"\n \t\"path/filepath\"\n \t\"testing\"\n-\n-\t\"github.com/stretchr/testify/assert\"\n )\n \n func TestFileCacheStartAndGC(t *testing.T) {\n@@ -30,6 +29,8 @@ func TestFileCacheStartAndGC(t *testing.T) {\n \tassert.NotNil(t, err)\n \terr = fc.StartAndGC(`{}`)\n \tassert.Nil(t, err)\n+\t_, err = fc.getCacheFileName(\"key1\")\n+\tassert.Nil(t, err)\n \n \tassert.Equal(t, fc.CachePath, FileCachePath)\n \tassert.Equal(t, fc.DirectoryLevel, FileCacheDirectoryLevel)\n@@ -47,12 +48,17 @@ func TestFileCacheStartAndGC(t *testing.T) {\n \tassert.Equal(t, fc.DirectoryLevel, 2)\n \tassert.Equal(t, fc.EmbedExpiry, 0)\n \tassert.Equal(t, fc.FileSuffix, \".bin\")\n+\t_, err = fc.getCacheFileName(\"key1\")\n+\tassert.Nil(t, err)\n \n \terr = fc.StartAndGC(fmt.Sprintf(`{\"CachePath\":\"%s\",\"FileSuffix\":\".bin\",\"DirectoryLevel\":\"aaa\",\"EmbedExpiry\":\"0\"}`, str))\n \tassert.NotNil(t, err)\n \n \terr = fc.StartAndGC(fmt.Sprintf(`{\"CachePath\":\"%s\",\"FileSuffix\":\".bin\",\"DirectoryLevel\":\"2\",\"EmbedExpiry\":\"aaa\"}`, str))\n \tassert.NotNil(t, err)\n+\n+\t_, err = fc.getCacheFileName(\"key1\")\n+\tassert.Nil(t, err)\n }\n \n func TestFileCacheInit(t *testing.T) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/shuchkin/simplexlsx/commits/cb4e716259e83d18e89292a4f1b721f4d34e28c2",
        "url": "https://api.github.com/repos/shuchkin/simplexlsx/commits/cb4e716259e83d18e89292a4f1b721f4d34e28c2",
        "html_url": "https://github.com/shuchkin/simplexlsx/commit/cb4e716259e83d18e89292a4f1b721f4d34e28c2",
        "message": "1.1.12",
        "files": [
            {
                "sha": "f012f82b575b950e8bb9f821ffc35819bdc9bf88",
                "filename": "src/SimpleXLSXEx.php",
                "status": "modified",
                "additions": 16,
                "deletions": 14,
                "changes": 30,
                "blob_url": "https://github.com/shuchkin/simplexlsx/blob/cb4e716259e83d18e89292a4f1b721f4d34e28c2/src%2FSimpleXLSXEx.php",
                "raw_url": "https://github.com/shuchkin/simplexlsx/raw/cb4e716259e83d18e89292a4f1b721f4d34e28c2/src%2FSimpleXLSXEx.php",
                "contents_url": "https://api.github.com/repos/shuchkin/simplexlsx/contents/src%2FSimpleXLSXEx.php?ref=cb4e716259e83d18e89292a4f1b721f4d34e28c2",
                "patch": "@@ -129,9 +129,9 @@ public function readThemeColors()\n             foreach ($colors12 as $c) {\n                 $v = $this->xlsx->theme->themeElements->clrScheme->{$c};\n                 if (isset($v->sysClr)) {\n-                    $this->themeColors[] = (string) $v->sysClr['lastClr'];\n+                    $this->themeColors[] = substr((string) $v->sysClr['lastClr'], 0, 6);\n                 } elseif (isset($v->srgbClr)) {\n-                    $this->themeColors[] = (string) $v->srgbClr['val'];\n+                    $this->themeColors[] = substr((string) $v->srgbClr['val'], 0, 6);\n                 } else {\n                     $this->themeColors[] = null;\n                 }\n@@ -148,7 +148,7 @@ public function readFonts()\n             foreach ($this->xlsx->styles->fonts->font as $v) {\n                 $u = '';\n                 if (isset($v->u)) {\n-                    $u = isset($v->u['val']) ? (string) $v->u['val'] : 'single';\n+                    $u = isset($v->u['val']) ? htmlspecialchars((string) $v->u['val'], ENT_QUOTES) : 'single';\n                 }\n                 $f = [\n                     'b' => isset($v->b) && ($v->b['val'] === null || $v->b['val']),\n@@ -157,10 +157,10 @@ public function readFonts()\n                     'strike' => isset($v->strike) && ($v->strike['val'] === null || $v->strike['val']),\n                     'sz' => isset($v->sz['val']) ? (int) $v->sz['val'] : 11,\n                     'color' => $this->getColorValue($v->color),\n-                    'name' => isset($v->name['val']) ? (string) $v->name['val'] : 'Calibri',\n+                    'name' => isset($v->name['val']) ? htmlspecialchars((string) $v->name['val'], ENT_QUOTES) : 'Calibri',\n                     'family' => isset($v->family['val']) ? (int) $v->family['val'] : 2,\n                     'charset' => isset($v->charset['val']) ? (int) $v->charset['val'] : 1,\n-                    'scheme' => isset($v->scheme['val']) ? (string) $v->scheme['val'] : 'minor'\n+                    'scheme' => isset($v->scheme['val']) ? htmlspecialchars((string) $v->scheme['val'], ENT_QUOTES) : 'minor'\n                 ];\n                 $this->fonts[] = $f;\n             }\n@@ -174,7 +174,7 @@ public function readFills()\n             foreach ($this->xlsx->styles->fills->fill as $v) {\n                 if (isset($v->patternFill)) {\n                     $this->fills[] = [\n-                        'pattern' => isset($v->patternFill['patternType']) ? (string) $v->patternFill['patternType'] : 'none',\n+                        'pattern' => isset($v->patternFill['patternType']) ? htmlspecialchars((string) $v->patternFill['patternType'], ENT_QUOTES) : 'none',\n                         'fgcolor' => $this->getColorValue($v->patternFill->fgColor),\n                         'bgcolor' => $this->getColorValue($v->patternFill->bgColor)\n                     ];\n@@ -185,35 +185,37 @@ public function readFills()\n     public function readBorders()\n     {\n         $this->borders = [];\n+        $styles = ['none', 'thin', 'medium', 'dashed', 'dotted', 'thick', 'double', 'hair', 'mediumDashed', 'dashDot',\n+            'mediumDashDot', 'dashDotDot', 'mediumDashDotDot', 'slantDashDot'];\n         if (isset($this->xlsx->styles->borders->border)) {\n             foreach ($this->xlsx->styles->borders->border as $v) {\n                 $this->borders[] = [\n                     'left' => [\n-                        'style' => (string) $v->left['style'],\n+                        'style' => in_array((string) $v->left['style'], $styles) ? (string) $v->left['style'] : 'none',\n                         'color' => $this->getColorValue($v->left->color)\n                     ],\n                     'right' => [\n-                        'style' => (string) $v->right['style'],\n+                        'style' => in_array((string) $v->right['style'], $styles) ? (string) $v->right['style'] : 'none',\n                         'color' => $this->getColorValue($v->right->color)\n                     ],\n                     'top' => [\n-                        'style' => (string) $v->top['style'],\n+                        'style' => in_array((string) $v->top['style'], $styles) ? (string) $v->top['style'] : 'none',\n                         'color' => $this->getColorValue($v->top->color)\n                     ],\n                     'bottom' => [\n-                        'style' => (string) $v->bottom['style'],\n+                        'style' => in_array((string) $v->bottom['style'], $styles) ? (string) $v->bottom['style'] : 'none',\n                         'color' => $this->getColorValue($v->bottom->color)\n                     ],\n                     'diagonal' => [\n-                        'style' => (string) $v->diagonal['style'],\n+                        'style' => in_array((string) $v->diagonal['style'], $styles) ? (string) $v->diagonal['style'] : 'none',\n                         'color' => $this->getColorValue($v->diagonal->color)\n                     ],\n                     'horizontal' => [\n-                        'style' => (string) $v->horizontal['style'],\n+                        'style' => in_array((string) $v->horizontal['style'], $styles) ? (string) $v->horizontal['style'] : 'none',\n                         'color' => $this->getColorValue($v->horizontal->color)\n                     ],\n                     'vertical' => [\n-                        'style' => (string) $v->vertical['style'],\n+                        'style' => in_array((string) $v->vertical['style'], $styles) ? (string) $v->vertical['style'] : 'none',\n                         'color' => $this->getColorValue($v->vertical->color)\n                     ],\n                     'diagonalUp' => (bool) $v['diagonalUp'],\n@@ -616,7 +618,7 @@ public function getColorValue(SimpleXMLElement $a = null, $default = '')\n         }\n         $c = $default; // auto\n         if ($a['rgb'] !== null) {\n-            $c = substr((string) $a['rgb'], 2); // FFCCBBAA -> CCBBAA\n+            $c = substr((string) $a['rgb'], 2, 6); // FFCCBBAA -> CCBBAA\n         } elseif ($a['indexed'] !== null && isset(static::$IC[ (int) $a['indexed'] ])) {\n             $c = static::$IC[ (int) $a['indexed'] ];\n         } elseif ($a['theme'] !== null && isset($this->themeColors[ (int) $a['theme'] ])) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/8493435ff9606905a2d913607d6c79862d0c168d",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/8493435ff9606905a2d913607d6c79862d0c168d",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/8493435ff9606905a2d913607d6c79862d0c168d",
        "message": "XWIKI-21207: Improve the evaluation of ConfigurableClass\n* Stop evaluating pretty names (which seems like an old feature no longer used anywhere)\n* Introduce ConfigurableObjectEvaluator to safely evaluate heading and linkPrefix properties",
        "files": [
            {
                "sha": "a91cae2e1291c671a442a65bdf1a40842d93fde5",
                "filename": "xwiki-platform-core/xwiki-platform-administration/pom.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fpom.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fpom.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-administration%2Fpom.xml?ref=8493435ff9606905a2d913607d6c79862d0c168d",
                "patch": "@@ -32,6 +32,7 @@\n   <packaging>pom</packaging>\n   <description>Application for administrating wiki features like users, groups, rights etc.</description>\n   <modules>\n+    <module>xwiki-platform-administration-api</module>\n     <module>xwiki-platform-administration-ui</module>\n   </modules>\n   <profiles>"
            },
            {
                "sha": "abfa44d3a0d5d1469574b24650d7e87610c173ed",
                "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-api/pom.xml",
                "status": "added",
                "additions": 50,
                "deletions": 0,
                "changes": 50,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fpom.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fpom.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fpom.xml?ref=8493435ff9606905a2d913607d6c79862d0c168d",
                "patch": "@@ -0,0 +1,50 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <groupId>org.xwiki.platform</groupId>\n+    <artifactId>xwiki-platform-administration</artifactId>\n+    <version>16.4.0-SNAPSHOT</version>\n+  </parent>\n+  <artifactId>xwiki-platform-administration-api</artifactId>\n+  <name>XWiki Platform - Administration - API</name>\n+  <packaging>jar</packaging>\n+  <description>XWiki Platform - Administration - API</description>\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-oldcore</artifactId>\n+      <version>${project.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.commons</groupId>\n+      <artifactId>xwiki-commons-component-api</artifactId>\n+      <version>${commons.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.commons</groupId>\n+      <artifactId>xwiki-commons-tool-test-component</artifactId>\n+      <version>${commons.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+  </dependencies>\n+</project>"
            },
            {
                "sha": "30d85bbd09af4f7aba3be04eb8bba127714f88da",
                "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-api/src/main/java/org/xwiki/administration/api/ConfigurableObjectEvaluator.java",
                "status": "added",
                "additions": 62,
                "deletions": 0,
                "changes": 62,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Fadministration%2Fapi%2FConfigurableObjectEvaluator.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Fadministration%2Fapi%2FConfigurableObjectEvaluator.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fxwiki%2Fadministration%2Fapi%2FConfigurableObjectEvaluator.java?ref=8493435ff9606905a2d913607d6c79862d0c168d",
                "patch": "@@ -0,0 +1,62 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.administration.api;\n+\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+import javax.inject.Named;\n+import javax.inject.Singleton;\n+\n+import org.xwiki.component.annotation.Component;\n+import org.xwiki.evaluation.ObjectEvaluator;\n+import org.xwiki.evaluation.ObjectEvaluatorException;\n+import org.xwiki.evaluation.ObjectPropertyEvaluator;\n+\n+import com.xpn.xwiki.objects.BaseObject;\n+\n+/**\n+ * Evaluator for objects of class {@code XWiki.ConfigurableClass}.\n+ * Returns a Map storing the evaluated content for \"heading\" and \"linkPrefix\" properties.\n+ *\n+ * @version $Id$\n+ * @since 15.10.9\n+ * @since 16.3.0\n+ */\n+@Component\n+@Singleton\n+@Named(ConfigurableObjectEvaluator.ROLE_HINT)\n+public class ConfigurableObjectEvaluator implements ObjectEvaluator\n+{\n+    /**\n+     * The role hint of this component.\n+     */\n+    public static final String ROLE_HINT = \"XWiki.ConfigurableClass\";\n+\n+    @Inject\n+    @Named(\"velocity\")\n+    private ObjectPropertyEvaluator velocityPropertyEvaluator;\n+\n+    @Override\n+    public Map<String, String> evaluate(BaseObject object) throws ObjectEvaluatorException\n+    {\n+        return this.velocityPropertyEvaluator.evaluateProperties(object, \"heading\", \"linkPrefix\");\n+    }\n+}"
            },
            {
                "sha": "149adf7174ed4289bbf980cab652553366baf213",
                "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-api/src/main/resources/META-INF/components.txt",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fcomponents.txt",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fcomponents.txt",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fsrc%2Fmain%2Fresources%2FMETA-INF%2Fcomponents.txt?ref=8493435ff9606905a2d913607d6c79862d0c168d",
                "patch": "@@ -0,0 +1 @@\n+org.xwiki.administration.api.ConfigurableObjectEvaluator"
            },
            {
                "sha": "c3dd835085f10001fb9d0fa18a38894e471fdf83",
                "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-api/src/test/java/org/xwiki/administration/api/ConfigurableObjectEvaluatorTest.java",
                "status": "added",
                "additions": 80,
                "deletions": 0,
                "changes": 80,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fadministration%2Fapi%2FConfigurableObjectEvaluatorTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fadministration%2Fapi%2FConfigurableObjectEvaluatorTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-api%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fadministration%2Fapi%2FConfigurableObjectEvaluatorTest.java?ref=8493435ff9606905a2d913607d6c79862d0c168d",
                "patch": "@@ -0,0 +1,80 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.administration.api;\n+\n+import java.util.Map;\n+\n+import javax.inject.Named;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mock;\n+import org.xwiki.evaluation.ObjectEvaluatorException;\n+import org.xwiki.evaluation.ObjectPropertyEvaluator;\n+import org.xwiki.test.junit5.mockito.ComponentTest;\n+import org.xwiki.test.junit5.mockito.InjectMockComponents;\n+import org.xwiki.test.junit5.mockito.MockComponent;\n+\n+import com.xpn.xwiki.objects.BaseObject;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Validate {@link ConfigurableObjectEvaluator}.\n+ *\n+ * @version $Id$\n+ */\n+@ComponentTest\n+class ConfigurableObjectEvaluatorTest\n+{\n+    @InjectMockComponents\n+    private ConfigurableObjectEvaluator configurableObjectEvaluator;\n+\n+    @MockComponent\n+    @Named(\"velocity\")\n+    private ObjectPropertyEvaluator velocityObjectPropertyEvaluator;\n+\n+    @Mock\n+    private BaseObject baseObject;\n+\n+    @BeforeEach\n+    void setUp() throws ObjectEvaluatorException\n+    {\n+        when(this.baseObject.getStringValue(\"heading\")).thenReturn(\"unevaluated heading\");\n+        when(this.baseObject.getStringValue(\"linkPrefix\")).thenReturn(\"unevaluated linkPrefix\");\n+\n+        Map<String, String> evaluatedVelocityProperties =\n+            Map.of(\"heading\", \"evaluated heading\", \"linkPrefix\", \"evaluated linkPrefix\");\n+\n+        when(this.velocityObjectPropertyEvaluator.evaluateProperties(this.baseObject, \"heading\", \"linkPrefix\"))\n+            .thenReturn(evaluatedVelocityProperties);\n+    }\n+\n+    @Test\n+    void checkEvaluationThroughPropertyEvaluator() throws ObjectEvaluatorException\n+    {\n+        Map<String, String> evaluationResults = this.configurableObjectEvaluator.evaluate(this.baseObject);\n+        verify(this.velocityObjectPropertyEvaluator).evaluateProperties(this.baseObject, \"heading\", \"linkPrefix\");\n+        assertEquals(\"evaluated heading\", evaluationResults.get(\"heading\"));\n+        assertEquals(\"evaluated linkPrefix\", evaluationResults.get(\"linkPrefix\"));\n+    }\n+}"
            },
            {
                "sha": "43d4a2d23182cd639e34a3e9c043a5539cfa32b2",
                "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/pom.xml",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fpom.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fpom.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fpom.xml?ref=8493435ff9606905a2d913607d6c79862d0c168d",
                "patch": "@@ -104,6 +104,12 @@\n       <version>${project.version}</version>\n       <scope>runtime</scope>\n     </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-administration-api</artifactId>\n+      <version>${project.version}</version>\n+    </dependency>\n+\n     <!-- Test dependencies. -->\n     <dependency>\n       <groupId>org.xwiki.platform</groupId>"
            },
            {
                "sha": "7f60c604f9aca19c54fbdbf388e6523804aa018f",
                "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ConfigurableClass.xml",
                "status": "modified",
                "additions": 11,
                "deletions": 23,
                "changes": 34,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FConfigurableClass.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FConfigurableClass.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FConfigurableClass.xml?ref=8493435ff9606905a2d913607d6c79862d0c168d",
                "patch": "@@ -195,32 +195,23 @@ $xwiki.jsfx.use('js/xwiki/actionbuttons/actionButtons.js', true)\n         #set($formId = \"${section.toLowerCase()}_${app.getFullName()}\")\n         #set($escapedAppName = $escapetool.xml($app.getFullName()))\n         #foreach($configurableObj in $configurableObjs)\n-          ## Execute the content code if any\n-          ## FIXME: we have to do that before the title before of the dropPermissions\n-          #set($codeToExecute = \"$!app.getValue('codeToExecute', $configurableObj)\")\n-          #if($codeToExecute != '')\n-            #set($codeToExecuteResult = $configurableObj.display('codeToExecute', 'view', false))\n+          #set ($heading = $app.getValue('heading', $configurableObj))\n+          #set ($codeToExecute = \"$!app.getValue('codeToExecute', $configurableObj)\")\n+          ## If linkPrefix is set, then we will make each property label a link which starts with that prefix.\n+          #set ($linkPrefix = \"$!app.getValue('linkPrefix', $configurableObj)\")\n+          #if (!$app.restricted)\n+            #set ($evaluatedConfigurableObj = $configurableObj.evaluate())\n+            #set ($heading = $evaluatedConfigurableObj.heading)\n+            #set ($linkPrefix = $evaluatedConfigurableObj.linkPrefix)\n           #end\n           ## Display the header if one exists.\n-          #set($heading = $app.getValue('heading', $configurableObj))\n           #if($heading &amp;&amp; $heading != '')\n-            ## This application should not run with programming rights because it evaluates code which may not be trustworthy.\n-            ## Removing the next line will open a security hole.\n-            ## Can't use $configurableObj.display('heading', 'view', false) to have proper heading id (because of the html macro)\n-            ## FIXME: find a cleaner solution\n-            #set($void = $doc.dropPermissions())\n-            #if ($services.security.authorization.hasAccess(\"script\",\n-              $app.authors.effectiveMetadataAuthor, $app.documentReference) &amp;&amp; !$app.restricted)\n-              #set($evaluatedHeading = \"#evaluate($heading)\")\n-            #else\n-              #set($evaluatedHeading = $heading)\n-            #end\n-            == $services.rendering.escape($evaluatedHeading, 'xwiki/2.1') ==\n+            == $services.rendering.escape($heading, 'xwiki/2.1') ==\n           #end\n           ## Display code to execute\n-          #if($codeToExecute != '')\n+          #if ($codeToExecute != '')\n             (%class=\"codeToExecute\"%)(((##\n-              $codeToExecuteResult\n+              $configurableObj.display('codeToExecute', 'view', false)\n             )))\n           #end\n           ##\n@@ -230,9 +221,6 @@ $xwiki.jsfx.use('js/xwiki/actionbuttons/actionButtons.js', true)\n             #set($propertiesToShow = [])\n           #end\n           ##\n-          ## If linkPrefix is set, then we will make each property label a link which starts with that prefix.\n-          #set($linkPrefix = \"$!app.getValue('linkPrefix', $configurableObj)\")\n-          ##\n           ## If the Configurable object specifies a configuration class, use it,\n           ## otherwise assume custom forms are used instead.\n           #set($configClassName = \"$!app.getValue('configurationClass', $configurableObj)\")"
            },
            {
                "sha": "e6e3857d0cdd4fe3da7768e39de746ca0257a88e",
                "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ConfigurableClassMacros.xml",
                "status": "modified",
                "additions": 2,
                "deletions": 5,
                "changes": 7,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FConfigurableClassMacros.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FConfigurableClassMacros.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FConfigurableClassMacros.xml?ref=8493435ff9606905a2d913607d6c79862d0c168d",
                "patch": "@@ -339,8 +339,6 @@\n       #if($propertiesToShow.size() &gt; 0 &amp;&amp; !$propertiesToShow.contains($propName))\n         ## Silently skip over this property.\n       #else\n-        #set($prettyName = \"#evaluate($app.displayPrettyName($propName, $obj))\")\n-        ##\n         #set($hintKey = \"${obj.xWikiClass.name}_${propName}.hint\")\n         #set($hint = $services.localization.render($hintKey))\n         #if($hint == $hintKey)\n@@ -364,11 +362,10 @@\n           $out ##\n           #set ($out = '')\n         #end\n-        $escapetool.xml($prettyName)\n+        $escapetool.xml($app.displayPrettyName($propName, $obj))\n         &lt;/label&gt;\n         #if($linkPrefix != '')\n-          #set($linkScript = \"$linkPrefix$propName\")\n-          &lt;a href=\"$escapetool.xml(\"#evaluate($linkScript)\")\" class=\"xHelp\" title=\"$services.localization.render('admin.documentation')\"&gt;$services.localization.render('admin.documentation')&lt;/a&gt;\n+          &lt;a href=\"$escapetool.xml($linkPrefix + $propName)\" class=\"xHelp\" title=\"$services.localization.render('admin.documentation')\"&gt;$services.localization.render('admin.documentation')&lt;/a&gt;\n         #end\n         #if ($hint)\n           &lt;span class=\"xHint\"&gt;$hint&lt;/span&gt;"
            },
            {
                "sha": "47493119ed3cd0041597ac3ce74752382a9a38ca",
                "filename": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/test/java/org/xwiki/administration/ConfigurableClassPageTest.java",
                "status": "modified",
                "additions": 63,
                "deletions": 5,
                "changes": 68,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fadministration%2FConfigurableClassPageTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8493435ff9606905a2d913607d6c79862d0c168d/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fadministration%2FConfigurableClassPageTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-administration%2Fxwiki-platform-administration-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fadministration%2FConfigurableClassPageTest.java?ref=8493435ff9606905a2d913607d6c79862d0c168d",
                "patch": "@@ -24,6 +24,7 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Objects;\n+import java.util.concurrent.Callable;\n \n import org.apache.http.client.utils.URLEncodedUtils;\n import org.jsoup.nodes.Document;\n@@ -32,6 +33,9 @@\n import org.junit.jupiter.params.ParameterizedTest;\n import org.junit.jupiter.params.provider.ValueSource;\n import org.mockito.Mock;\n+import org.xwiki.administration.api.ConfigurableObjectEvaluator;\n+import org.xwiki.evaluation.internal.DefaultObjectEvaluator;\n+import org.xwiki.evaluation.internal.VelocityObjectPropertyEvaluator;\n import org.xwiki.localization.macro.internal.TranslationMacro;\n import org.xwiki.model.reference.DocumentReference;\n import org.xwiki.query.internal.ScriptQuery;\n@@ -41,6 +45,7 @@\n import org.xwiki.rendering.internal.macro.message.ErrorMessageMacro;\n import org.xwiki.rendering.internal.macro.message.WarningMessageMacro;\n import org.xwiki.script.service.ScriptService;\n+import org.xwiki.security.authorization.AuthorExecutor;\n import org.xwiki.security.authorization.Right;\n import org.xwiki.security.script.SecurityScriptServiceComponentList;\n import org.xwiki.test.annotation.ComponentList;\n@@ -51,17 +56,23 @@\n import org.xwiki.user.UserReferenceComponentList;\n import org.xwiki.user.internal.converter.DocumentUserReferenceConverter;\n import org.xwiki.user.internal.document.DocumentUserReference;\n+import org.xwiki.velocity.VelocityEngine;\n+import org.xwiki.velocity.VelocityManager;\n \n import com.xpn.xwiki.doc.XWikiDocument;\n import com.xpn.xwiki.internal.model.reference.DocumentReferenceConverter;\n import com.xpn.xwiki.objects.BaseObject;\n+import com.xpn.xwiki.objects.classes.BaseClass;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.fail;\n import static org.mockito.ArgumentMatchers.any;\n import static org.mockito.ArgumentMatchers.anyInt;\n import static org.mockito.ArgumentMatchers.anyString;\n import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.spy;\n+import static org.mockito.Mockito.verify;\n import static org.mockito.Mockito.when;\n \n /**\n@@ -81,7 +92,10 @@\n     ErrorMessageMacro.class,\n     WarningMessageMacro.class,\n     DocumentUserReferenceConverter.class,\n-    DocumentReferenceConverter.class\n+    DocumentReferenceConverter.class,\n+    DefaultObjectEvaluator.class,\n+    VelocityObjectPropertyEvaluator.class,\n+    ConfigurableObjectEvaluator.class\n })\n class ConfigurableClassPageTest extends PageTest\n {\n@@ -100,6 +114,8 @@ class ConfigurableClassPageTest extends PageTest\n \n     private static final String MY_SECTION_SERIALIZED = \"XWiki.]],{{noscript /}}\";\n \n+    private static final String CONFIG_CLASS_NAME = \"TestClass\";\n+\n     private static final String WEB_HOME = \"WebHome\";\n \n     @Mock\n@@ -108,6 +124,10 @@ class ConfigurableClassPageTest extends PageTest\n     @Mock\n     private ScriptQuery query;\n \n+    private AuthorExecutor authorExecutor;\n+\n+    private VelocityEngine velocityEngine;\n+\n     @BeforeEach\n     void setUp() throws Exception\n     {\n@@ -122,6 +142,21 @@ void setUp() throws Exception\n         when(this.query.setOffset(anyInt())).thenReturn(this.query);\n         when(this.query.bindValues(any(Map.class))).thenReturn(this.query);\n         when(this.query.bindValues(any(List.class))).thenReturn(this.query);\n+\n+        this.authorExecutor = this.componentManager.registerMockComponent(AuthorExecutor.class, true);\n+\n+        // Spy Velocity Engine.\n+        VelocityManager velocityManager = this.componentManager.getInstance(VelocityManager.class);\n+        this.velocityEngine = velocityManager.getVelocityEngine();\n+        this.velocityEngine = spy(this.velocityEngine);\n+        velocityManager = spy(velocityManager);\n+        this.componentManager.registerComponent(VelocityManager.class, velocityManager);\n+        when(velocityManager.getVelocityEngine()).thenReturn(this.velocityEngine);\n+\n+        when(this.authorExecutor.call(any(), any(), any())).thenAnswer(invocation -> {\n+            Callable<?> callable = invocation.getArgument(0);\n+            return callable.call();\n+        });\n     }\n \n     @Test\n@@ -167,12 +202,23 @@ void checkScriptRight(boolean hasScript) throws Exception\n         when(this.oldcore.getMockRightService()\n             .hasAccessLevel(eq(\"edit\"), any(), any(), any())).thenReturn(true);\n \n+        DocumentReference configClassRef = new DocumentReference(\"xwiki\", SPACE_NAME, CONFIG_CLASS_NAME);\n+        XWikiDocument configClassDoc = new XWikiDocument(configClassRef);\n+        BaseClass configClass = new BaseClass();\n+        configClass.addTextField(\"test\", \"Test\", 10);\n+        configClassDoc.setXClass(configClass);\n+        this.xwiki.saveDocument(configClassDoc, this.context);\n+\n         XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);\n+        BaseObject configObject = mySectionDoc.newXObject(configClassRef, this.context);\n         BaseObject object = mySectionDoc.newXObject(CONFIGURABLE_CLASS, this.context);\n         object.setStringValue(\"displayInCategory\", \"other\");\n         object.setStringValue(\"displayInSection\", \"other\");\n+        object.setStringValue(\"configurationClass\", SPACE_NAME + \".\" + CONFIG_CLASS_NAME);\n         String originalHeading = \"$appName {{noscript /}}\";\n         object.setStringValue(\"heading\", originalHeading);\n+        String originalLinkPrefix = \"\\\"prefix/$appName/{{noscript /}}/\";\n+        object.setStringValue(\"linkPrefix\", originalLinkPrefix);\n         object.set(\"scope\", \"WIKI+ALL_SPACES\", this.context);\n         DocumentReference userReference = new DocumentReference(WIKI_NAME, SPACE_NAME, \"Admin\");\n         mySectionDoc.getAuthors().setEffectiveMetadataAuthor(new DocumentUserReference(userReference, true));\n@@ -181,13 +227,25 @@ void checkScriptRight(boolean hasScript) throws Exception\n             userReference, mySectionDoc.getDocumentReference())).thenReturn(hasScript);\n \n         Document htmlPage = renderHTMLPage(CONFIGURABLE_CLASS);\n-        String expected;\n+        verify(this.oldcore.getMockAuthorizationManager()).hasAccess(Right.SCRIPT, userReference, MY_SECTION);\n+\n+        String expectedHeading;\n+        String expectedLink;\n         if (hasScript) {\n-            expected = String.format(\"%s {{noscript /}}\", MY_SECTION_SERIALIZED);\n+            expectedHeading = String.format(\"%s {{noscript /}}\", MY_SECTION_SERIALIZED);\n+            expectedLink = String.format(\"\\\"prefix/%s/{{noscript /}}/test\", MY_SECTION_SERIALIZED);\n+            verify(this.authorExecutor).call(any(), eq(userReference), eq(MY_SECTION));\n+            verify(this.velocityEngine).evaluate(any(), any(), any(), eq(originalHeading));\n+            verify(this.velocityEngine).evaluate(any(), any(), any(), eq(originalLinkPrefix));\n         } else {\n-            expected = originalHeading;\n+            expectedHeading = originalHeading;\n+            expectedLink = originalLinkPrefix + \"test\";\n+            verify(this.velocityEngine, never()).evaluate(any(), any(), any(), eq(originalHeading));\n+            verify(this.velocityEngine, never()).evaluate(any(), any(), any(), eq(originalLinkPrefix));\n         }\n-        assertEquals(expected, htmlPage.selectFirst(\"h2\").text());\n+\n+        assertEquals(expectedHeading, Objects.requireNonNull(htmlPage.selectFirst(\"h2\")).text());\n+        assertEquals(expectedLink, Objects.requireNonNull(htmlPage.selectFirst(\"a\")).attr(\"href\"));\n     }\n \n     @Test"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/40e1afe001d61eafdf13f3621b4b597a0e58a3e3",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/40e1afe001d61eafdf13f3621b4b597a0e58a3e3",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/40e1afe001d61eafdf13f3621b4b597a0e58a3e3",
        "message": "XWIKI-22030: Improve escaping in macros list\n\n* Improve escaping in XWikiSyntaxMacrosList\n* Add test case to XWikiSyntaxMacrosListPageTest",
        "files": [
            {
                "sha": "e215d58c92b0977b2fed524a95224783621fd518",
                "filename": "xwiki-platform-core/xwiki-platform-help/xwiki-platform-help-ui/src/main/resources/XWiki/XWikiSyntaxMacrosList.xml",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/40e1afe001d61eafdf13f3621b4b597a0e58a3e3/xwiki-platform-core%2Fxwiki-platform-help%2Fxwiki-platform-help-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FXWikiSyntaxMacrosList.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/40e1afe001d61eafdf13f3621b4b597a0e58a3e3/xwiki-platform-core%2Fxwiki-platform-help%2Fxwiki-platform-help-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FXWikiSyntaxMacrosList.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-help%2Fxwiki-platform-help-ui%2Fsrc%2Fmain%2Fresources%2FXWiki%2FXWikiSyntaxMacrosList.xml?ref=40e1afe001d61eafdf13f3621b4b597a0e58a3e3",
                "patch": "@@ -39,10 +39,10 @@\n   <content>{{velocity}}\n ## If the translation key exists, use its value, otherwise use to the provided fallback value. \n #macro (translateOrElse $translationKey $fallback)\n- #if($services.localization.get($translationKey))\n+  #if($services.localization.get($translationKey))\n     $services.rendering.escape($services.localization.render($translationKey), 'xwiki/2.1')##\n   #else\n-    $fallback##\n+    $services.rendering.escape($fallback, 'xwiki/2.1')##\n   #end\n #end\n "
            },
            {
                "sha": "c2ed94ccbb4492ddba35be7eba8af06e367484d9",
                "filename": "xwiki-platform-core/xwiki-platform-help/xwiki-platform-help-ui/src/test/java/org/xwiki/help/XWikiSyntaxMacrosListPageTest.java",
                "status": "modified",
                "additions": 54,
                "deletions": 16,
                "changes": 70,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/40e1afe001d61eafdf13f3621b4b597a0e58a3e3/xwiki-platform-core%2Fxwiki-platform-help%2Fxwiki-platform-help-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fhelp%2FXWikiSyntaxMacrosListPageTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/40e1afe001d61eafdf13f3621b4b597a0e58a3e3/xwiki-platform-core%2Fxwiki-platform-help%2Fxwiki-platform-help-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fhelp%2FXWikiSyntaxMacrosListPageTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-help%2Fxwiki-platform-help-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fhelp%2FXWikiSyntaxMacrosListPageTest.java?ref=40e1afe001d61eafdf13f3621b4b597a0e58a3e3",
                "patch": "@@ -27,6 +27,7 @@\n import org.jsoup.nodes.Document;\n import org.jsoup.nodes.Element;\n import org.jsoup.select.Elements;\n+import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n import org.xwiki.context.internal.concurrent.DefaultContextStoreManager;\n import org.xwiki.localization.macro.internal.TranslationMacro;\n@@ -49,13 +50,15 @@\n import org.xwiki.test.annotation.ComponentList;\n import org.xwiki.test.page.HTML50ComponentList;\n import org.xwiki.test.page.PageTest;\n+import org.xwiki.test.page.TestNoScriptMacro;\n import org.xwiki.test.page.XWikiSyntax21ComponentList;\n \n import com.xpn.xwiki.DefaultSkinAccessBridge;\n import com.xpn.xwiki.doc.XWikiDocument;\n import com.xpn.xwiki.objects.BaseObject;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.mockito.ArgumentMatchers.any;\n import static org.mockito.Mockito.mock;\n import static org.mockito.Mockito.when;\n@@ -88,19 +91,30 @@\n     // End of XWikiWikiModel\n     DocumentXHTMLLinkTypeRenderer.class,\n     DocumentResourceReferenceEntityReferenceResolver.class,\n+    TestNoScriptMacro.class,\n     TranslationMacro.class\n })\n class XWikiSyntaxMacrosListPageTest extends PageTest\n {\n     public static final DocumentReference DOCUMENT_REFERENCE =\n         new DocumentReference(\"xwiki\", \"XWiki\", \"XWikiSyntaxMacrosList\");\n \n-    @Test\n-    void renderTable() throws Exception\n+    private DefaultWikiMacro myMacro;\n+\n+    @BeforeEach\n+    void setUp() throws Exception\n     {\n         // Initialize \"WikiMacroClass\"\n         this.xwiki.initializeMandatoryDocuments(this.context);\n \n+        // Mock the database.\n+        Query query = mock(Query.class);\n+        QueryManagerScriptService queryManagerScriptService =\n+            this.componentManager.registerMockComponent(ScriptService.class, \"query\", QueryManagerScriptService.class,\n+                false);\n+        when(queryManagerScriptService.xwql(any())).thenReturn(query);\n+        when(query.execute()).thenReturn(List.of(\"xwiki:XWiki.MyMacro\"));\n+\n         // Create a wiki macro.\n         XWikiDocument myMacroDocument = this.xwiki.getDocument(new DocumentReference(\"xwiki\", \"XWiki\", \"MyMacro\"),\n             this.context);\n@@ -111,20 +125,17 @@ void renderTable() throws Exception\n         this.xwiki.saveDocument(myMacroDocument, this.context);\n \n         // Register the wiki macro component.\n-        DefaultWikiMacro myMacro =\n+        this.myMacro =\n             this.componentManager.registerMockComponent(Macro.class, \"mymacro\", DefaultWikiMacro.class, false);\n-        DefaultMacroDescriptor macroDescriptor =\n-            new DefaultMacroDescriptor(new MacroId(\"mymacro\"), \"My Macro\", \"My Macro Description\");\n-        macroDescriptor.setDefaultCategories(Set.of(\"Category1\", \"Category2\"));\n-        when(myMacro.getDescriptor()).thenReturn(macroDescriptor);\n+    }\n \n-        // Mock the database.\n-        Query query = mock(Query.class);\n-        QueryManagerScriptService queryManagerScriptService =\n-            this.componentManager.registerMockComponent(ScriptService.class, \"query\", QueryManagerScriptService.class,\n-                false);\n-        when(queryManagerScriptService.xwql(any())).thenReturn(query);\n-        when(query.execute()).thenReturn(List.of(\"xwiki:XWiki.MyMacro\"));\n+    @Test\n+    void renderTable() throws Exception\n+    {\n+        DefaultMacroDescriptor macroDescriptor = new DefaultMacroDescriptor(new MacroId(\"mymacro\"), \"My Macro\",\n+            \"My Macro Description\");\n+        macroDescriptor.setDefaultCategories(Set.of(\"Category1\", \"Category2\"));\n+        when(this.myMacro.getDescriptor()).thenReturn(macroDescriptor);\n \n         // Render the page.\n         Document document = renderHTMLPage(DOCUMENT_REFERENCE);\n@@ -144,12 +155,39 @@ void renderTable() throws Exception\n             \"XWiki.WikiMacroClass_visibility_Global\");\n         assertWikiMacro(trs.get(3), \"mymacro\", \"/xwiki/bin/view/XWiki/MyMacro\", \"My Macro\",\n             Set.of(\"Category1\", \"Category2\"), \"My Macro Description\", \"XWiki.WikiMacroClass_visibility_WIKI\");\n-        assertJavaMacro(trs.get(4), \"translation\", \"Translation\", \"Content\",\n+        assertJavaMacro(trs.get(4), \"noscript\", \"NoScript\", \"\", \"No Script!\", \"XWiki.WikiMacroClass_visibility_Global\");\n+        assertJavaMacro(trs.get(5), \"translation\", \"Translation\", \"Content\",\n             \"Display a translation message.\", \"XWiki.WikiMacroClass_visibility_Global\");\n-        assertJavaMacro(trs.get(5), \"velocity\", \"Velocity\", \"Development\", \"Executes a Velocity script.\",\n+        assertJavaMacro(trs.get(6), \"velocity\", \"Velocity\", \"Development\", \"Executes a Velocity script.\",\n             \"XWiki.WikiMacroClass_visibility_Global\");\n     }\n \n+    @Test\n+    void checkTableEscaping() throws Exception\n+    {\n+        String unescapedString = \"{{noscript /}}\";\n+\n+        DefaultMacroDescriptor macroDescriptor = new DefaultMacroDescriptor(new MacroId(\"mymacro\"), unescapedString,\n+            unescapedString);\n+        macroDescriptor.setDefaultCategories(Set.of(unescapedString));\n+        when(this.myMacro.getDescriptor()).thenReturn(macroDescriptor);\n+\n+        Document document = renderHTMLPage(DOCUMENT_REFERENCE);\n+\n+        Elements trs = document.select(\"tr\");\n+        Element myMacroTr = null;\n+        for (Element tr : trs) {\n+            Element th = tr.selectFirst(\"td\");\n+            if (th != null && th.text().equals(\"mymacro\")) {\n+                myMacroTr = tr;\n+            }\n+        }\n+\n+        assertNotNull(myMacroTr);\n+        assertWikiMacro(myMacroTr, \"mymacro\", \"/xwiki/bin/view/XWiki/MyMacro\", unescapedString, Set.of(unescapedString),\n+            unescapedString, \"XWiki.WikiMacroClass_visibility_WIKI\");\n+    }\n+\n     private void assertWikiMacro(Element rowElement, String id, String link, String name, Set<String> categories,\n         String description, String visibility)\n     {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/54bcc5a7a2e440cc591b91eece9c13dc0c487331",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/54bcc5a7a2e440cc591b91eece9c13dc0c487331",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/54bcc5a7a2e440cc591b91eece9c13dc0c487331",
        "message": "XWIKI-21663: Improve Scheduler access",
        "files": [
            {
                "sha": "d45d66e3f6428af53ac167314c418fd9d30ef80f",
                "filename": "xwiki-platform-core/xwiki-platform-oldcore/src/main/resources/ApplicationResources.properties",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-oldcore%2Fsrc%2Fmain%2Fresources%2FApplicationResources.properties",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-oldcore%2Fsrc%2Fmain%2Fresources%2FApplicationResources.properties",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-oldcore%2Fsrc%2Fmain%2Fresources%2FApplicationResources.properties?ref=54bcc5a7a2e440cc591b91eece9c13dc0c487331",
                "patch": "@@ -2896,6 +2896,7 @@ xe.scheduler.job.backtolist=Back to the job list\n xe.scheduler.job.object=This sheet must be applied to a page that holds a scheduler job object.\n xe.scheduler.updateJobClassComment=Created/Updated Scheduler Job Class definition\n xe.scheduler.invalidToken=Invalid token, please try again by clicking on the desired action below.\n+xe.scheduler.missingProgrammingRights=This action requires programming rights.\n \n ### Statistics application\n xe.statistics.activity=Activity Statistics"
            },
            {
                "sha": "3749c123ac8c9c0d614e361e1e4105ed3975393f",
                "filename": "xwiki-platform-core/xwiki-platform-scheduler/xwiki-platform-scheduler-ui/pom.xml",
                "status": "modified",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fpom.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fpom.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fpom.xml?ref=54bcc5a7a2e440cc591b91eece9c13dc0c487331",
                "patch": "@@ -97,5 +97,26 @@\n       <type>test-jar</type>\n       <scope>test</scope>\n     </dependency>\n+    <!-- Provides the component list for SecurityAuthorizationScriptService. -->\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-security-authorization-script</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-security-authorization-script</artifactId>\n+      <version>${project.version}</version>\n+      <type>test-jar</type>\n+      <scope>test</scope>\n+    </dependency>\n+    <!-- Provides TranslationMacro -->\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-localization-macro</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n   </dependencies>\n </project>"
            },
            {
                "sha": "7ac702ba4e19f19039a5696dc4baedfdee65a479",
                "filename": "xwiki-platform-core/xwiki-platform-scheduler/xwiki-platform-scheduler-ui/src/main/resources/Scheduler/WebHome.xml",
                "status": "modified",
                "additions": 30,
                "deletions": 23,
                "changes": 53,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fsrc%2Fmain%2Fresources%2FScheduler%2FWebHome.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fsrc%2Fmain%2Fresources%2FScheduler%2FWebHome.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fsrc%2Fmain%2Fresources%2FScheduler%2FWebHome.xml?ref=54bcc5a7a2e440cc591b91eece9c13dc0c487331",
                "patch": "@@ -41,7 +41,8 @@\n ##\n #set ($scheduler = $xwiki.scheduler)\n ##\n-## If the sheet is called with an action ($request.do), let us first process this action\n+## If the sheet is called with an action ($request.do), let us first process this action after checking the user has\n+## programming rights.\n ## Possible values are : \"schedule\", \"pause\", \"resume\", \"unschedule\", \"delete\"\n ##\n #if (\"$!request.do\" != '' &amp;&amp; \"$!request.which\" != '')\n@@ -51,23 +52,29 @@\n   #set ($tJobHolder = $request.which)\n   #set ($jobDoc = $xwiki.getDocument($tJobHolder))\n   #set ($jobObj = $jobDoc.getObject('XWiki.SchedulerJobClass'))\n-  #if (!$services.csrf.isTokenValid($request.form_token))\n+  #if (!$services.security.authorization.hasAccess('programming', $xcontext.userReference, $doc.documentReference))\n+     ##\n+     ## Check that the user has programming rights\n+     ##\n+     {{error}}{{translation key='xe.scheduler.missingProgrammingRights'/}}{{/error}}\n+\n+  #elseif (!$services.csrf.isTokenValid($request.form_token))\n      ##\n      ## Check that the CSRF token matches the user before any operation\n      ##\n-     {{error}}$services.localization.render('xe.scheduler.invalidToken'){{/error}}\n+     {{error}}{{translation key='xe.scheduler.invalidToken'/}}{{/error}}\n \n   #elseif ($request.do == 'schedule')\n     ##\n     ## Schedule a job\n     ##\n     #set ($ok = $scheduler.scheduleJob($jobObj))\n     #if (!$ok)\n-      {{error}}$xcontext.get('error'){{/error}}\n+      {{error}}$escapetool.xml($xcontext.get('error')){{/error}}\n \n     #else\n       #set ($jobName = \"$jobObj.get('jobName')\")\n-      {{info}}$services.localization.render('xe.scheduler.jobscheduled', [$jobName, $scheduler.getNextFireTime($jobObj)]){{/info}}\n+      {{info}}$escapetool.xml($services.localization.render('xe.scheduler.jobscheduled', [$jobName, $scheduler.getNextFireTime($jobObj)])){{/info}}\n \n     #end\n   #elseif ($request.do == 'pause')\n@@ -76,10 +83,10 @@\n     ##\n     #set ($ok = $scheduler.pauseJob($jobObj))\n     #if (!$ok)\n-      {{error}}$xcontext.get('error'){{/error}}\n+      {{error}}$escapetool.xml($xcontext.get('error')){{/error}}\n \n     #else\n-      {{info}}$services.localization.render('xe.scheduler.paused', [$jobObj.get('jobName')]){{/info}}\n+      {{info}}$escapetool.xml($services.localization.render('xe.scheduler.paused', [$jobObj.get('jobName')])){{/info}}\n \n     #end\n   #elseif ($request.do == 'resume')\n@@ -88,10 +95,10 @@\n     ##\n     #set ($ok = $scheduler.resumeJob($jobObj))\n     #if (!$ok)\n-      {{error}}$xcontext.get('error'){{/error}}\n+      {{error}}$escapetool.xml($xcontext.get('error')){{/error}}\n \n     #else\n-      {{info}}$services.localization.render('xe.scheduler.resumed', [$jobObj.get('jobName'), $scheduler.getNextFireTime($jobObj)]){{/info}}\n+      {{info}}$escapetool.xml($services.localization.render('xe.scheduler.resumed', [$jobObj.get('jobName'), $scheduler.getNextFireTime($jobObj)])){{/info}}\n \n     #end\n   #elseif ($request.do == 'unschedule')\n@@ -100,10 +107,10 @@\n     ##\n     #set ($ok = $scheduler.unscheduleJob($jobObj))\n     #if (!$ok)\n-      {{error}}$xcontext.get('error'){{/error}}\n+      {{error}}$escapetool.xml($xcontext.get('error')){{/error}}\n \n     #else\n-      {{info}}$services.localization.render('xe.scheduler.unscheduled', [$jobObj.get('jobName')]){{/info}}\n+      {{info}}$escapetool.xml($services.localization.render('xe.scheduler.unscheduled', [$jobObj.get('jobName')])){{/info}}\n \n     #end\n   #elseif ($request.do == 'delete')\n@@ -118,7 +125,7 @@\n         #set ($deleteRedirect = $xwiki.getURL($jobObj.getName(), 'delete'))\n         $response.sendRedirect($deleteRedirect)\n       #else\n-        {{error}}$xcontext.get('error'){{/error}}\n+        {{error}}$escapetool.xml($xcontext.get('error')){{/error}}\n \n       #end\n     #else\n@@ -131,23 +138,23 @@\n     ##\n     #set ($ok = $scheduler.triggerJob($jobObj))\n     #if (!$ok)\n-      {{error}}$xcontext.get('error'){{/error}}\n+      {{error}}$escapetool.xml($xcontext.get('error')){{/error}}\n \n     #else\n-      {{info}}$services.localization.render('xe.scheduler.triggered', [$jobObj.get('jobName')]){{/info}}\n+      {{info}}$escapetool.xml($services.localization.render('xe.scheduler.triggered', [$jobObj.get('jobName')])){{/info}}\n \n     #end\n   #end\n #end\n-$services.localization.render('xe.scheduler.welcome')\n+{{translation key='xe.scheduler.welcome'/}}\n \n-= $services.localization.render('xe.scheduler.jobs.list') =\n+= {{translation key='xe.scheduler.jobs.list'/}} =\n \n ##\n ## Retrieve all scheduler jobs\n ## Display their name, status, possible next fire time, and available actions\n ##\n-|=(%scope=\"col\"%)$services.localization.render('xe.scheduler.jobs.name')|=(%scope=\"col\"%)$services.localization.render('xe.scheduler.jobs.status')|=(%scope=\"col\"%)$services.localization.render('xe.scheduler.jobs.next')|=(%scope=\"col\"%)$services.localization.render('xe.scheduler.jobs.actions')\n+|=(%scope=\"col\"%){{translation key='xe.scheduler.jobs.name'/}}|=(%scope=\"col\"%){{translation key='xe.scheduler.jobs.status'/}}|=(%scope=\"col\"%){{translation key='xe.scheduler.jobs.next'/}}|=(%scope=\"col\"%){{translation key='xe.scheduler.jobs.actions'/}}\n #foreach ($docName in $services.query.xwql('from doc.object(XWiki.SchedulerJobClass) as jobs where doc.fullName &lt;&gt; ''XWiki.SchedulerJobTemplate''').execute())\n   #set ($jobHolder = $xwiki.getDocument($docName))\n   #set ($job = $jobHolder.getObject('XWiki.SchedulerJobClass'))\n@@ -159,7 +166,7 @@ $services.localization.render('xe.scheduler.welcome')\n   #if ($status != 'None')\n     #set ($firetime = $scheduler.getNextFireTime($job))\n   #else\n-    #set ($firetime = $services.localization.render('xe.scheduler.jobs.next.undefined'))\n+    #set ($firetime = \"{{translation key='xe.scheduler.jobs.next.undefined'/}}\")\n   #end\n   #set ($actions = ['trigger'])\n   #if ($status == 'None')\n@@ -170,7 +177,7 @@ $services.localization.render('xe.scheduler.welcome')\n     #set ($ok = $actions.addAll(['resume', 'unschedule']))\n   #end\n   #set ($ok = $actions.add('delete'))\n-|$job.get('jobName')|$status|$firetime|**$services.localization.render('xe.scheduler.jobs.actions.access')** [[$services.localization.render('xe.scheduler.jobs.actions.view')&gt;&gt;$services.rendering.escape($jobHolder.fullName, 'xwiki/2.1')]]#if($jobHolder.hasAccessLevel('programming')) [[$services.localization.render('xe.scheduler.jobs.actions.edit')&gt;&gt;path:${jobHolder.getURL('edit')}]]#end **$services.localization.render('xe.scheduler.jobs.actions.manage')**#foreach($action in $actions) [[$services.localization.render(\"xe.scheduler.jobs.actions.$action\")&gt;&gt;path:$doc.getURL('view', $escapetool.url({'do': $action, 'which': $jobHolder.fullName, 'form_token': $services.csrf.token}))]]#end\n+|$job.get('jobName')|$status|$firetime|**{{translation key='xe.scheduler.jobs.actions.access'/}}** [[{{translation key='xe.scheduler.jobs.actions.view'/}}&gt;&gt;$services.rendering.escape($jobHolder.fullName, 'xwiki/2.1')]]#if($jobHolder.hasAccessLevel('programming')) [[{{translation key='xe.scheduler.jobs.actions.edit'/}}&gt;&gt;path:${jobHolder.getURL('edit')}]]#end **{{translation key='xe.scheduler.jobs.actions.manage'/}}**#foreach($action in $actions) [[{{translation key='xe.scheduler.jobs.actions.$action'/}}&gt;&gt;path:$doc.getURL('view', $escapetool.url({'do': $action, 'which': $jobHolder.fullName, 'form_token': $services.csrf.token}))]]#end\n \n #end\n #if ($doc.hasAccessLevel('programming'))\n@@ -181,12 +188,12 @@ $services.localization.render('xe.scheduler.welcome')\n ## schedule, pause, etc.\n ##\n \n-= $services.localization.render('xe.scheduler.jobs.create') =\n+= {{translation key='xe.scheduler.jobs.create'/}} =\n \n ##\n ## Form to create a new Job\n ##\n-{{info}}$services.localization.render('xe.scheduler.jobs.explaincreate'){{/info}}\n+{{info}}{{translation key='xe.scheduler.jobs.explaincreate'/}}{{/info}}\n \n {{html}}\n &lt;form action=\"$doc.getURL('create')\" id=\"newdoc\" class=\"form-inline\"&gt;&lt;div&gt;\n@@ -195,7 +202,7 @@ $services.localization.render('xe.scheduler.welcome')\n   &lt;input type=\"hidden\" name=\"template\" value=\"XWiki.SchedulerJobTemplate\" /&gt;\n   &lt;input type=\"hidden\" name=\"sheet\" value=\"1\" /&gt;\n   &lt;input type=\"hidden\" name=\"space\" value=\"Scheduler\"/&gt;\n-  &lt;label class=\"sr-only\" for=\"page\"&gt;$services.localization.render('xe.scheduler.jobs.create.nameTip')&lt;/label&gt;\n+  &lt;label class=\"sr-only\" for=\"page\"&gt;$escapetool.xml($services.localization.render('xe.scheduler.jobs.create.nameTip'))&lt;/label&gt;\n   &lt;input id=\"page\" name=\"page\" size=\"30\" type=\"text\"\n       placeholder=\"$escapetool.xml($services.localization.render('xe.scheduler.jobs.create.nameTip'))\" /&gt;\n   &lt;span class=\"buttonwrapper\"&gt;\n@@ -207,7 +214,7 @@ $services.localization.render('xe.scheduler.welcome')\n \n #else\n \n-  {{warning}}$services.localization.render('xe.scheduler.jobs.warning'){{/warning}}\n+  {{warning}}{{translation key='xe.scheduler.jobs.warning'/}}{{/warning}}\n \n #end\n {{/velocity}}</content>"
            },
            {
                "sha": "6c6eed6ad0468b10b84ff5fdacf1200a54e057f6",
                "filename": "xwiki-platform-core/xwiki-platform-scheduler/xwiki-platform-scheduler-ui/src/main/resources/Scheduler/WebPreferences.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 167,
                "changes": 168,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fsrc%2Fmain%2Fresources%2FScheduler%2FWebPreferences.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fsrc%2Fmain%2Fresources%2FScheduler%2FWebPreferences.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fsrc%2Fmain%2Fresources%2FScheduler%2FWebPreferences.xml?ref=54bcc5a7a2e440cc591b91eece9c13dc0c487331",
                "patch": "@@ -114,176 +114,10 @@\n       <groups>XWiki.XWikiAdminGroup</groups>\n     </property>\n     <property>\n-      <levels>admin,edit</levels>\n+      <levels>view,edit,comment,delete,admin</levels>\n     </property>\n     <property>\n       <users/>\n     </property>\n   </object>\n-  <object>\n-    <name>Scheduler.WebPreferences</name>\n-    <number>1</number>\n-    <className>XWiki.XWikiGlobalRights</className>\n-    <guid>0b2c7da3-315a-4a6d-b782-5de0b20b6497</guid>\n-    <class>\n-      <name>XWiki.XWikiGlobalRights</name>\n-      <customClass/>\n-      <customMapping/>\n-      <defaultViewSheet/>\n-      <defaultEditSheet/>\n-      <defaultWeb/>\n-      <nameField/>\n-      <validationScript/>\n-      <allow>\n-        <defaultValue>1</defaultValue>\n-        <disabled>0</disabled>\n-        <displayFormType>select</displayFormType>\n-        <displayType>allow</displayType>\n-        <name>allow</name>\n-        <number>4</number>\n-        <prettyName>Allow/Deny</prettyName>\n-        <unmodifiable>0</unmodifiable>\n-        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n-      </allow>\n-      <groups>\n-        <cache>0</cache>\n-        <disabled>0</disabled>\n-        <displayType>input</displayType>\n-        <multiSelect>1</multiSelect>\n-        <name>groups</name>\n-        <number>1</number>\n-        <picker>1</picker>\n-        <prettyName>Groups</prettyName>\n-        <relationalStorage>0</relationalStorage>\n-        <separator> </separator>\n-        <size>5</size>\n-        <unmodifiable>0</unmodifiable>\n-        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n-      </groups>\n-      <levels>\n-        <cache>0</cache>\n-        <disabled>0</disabled>\n-        <displayType>select</displayType>\n-        <multiSelect>1</multiSelect>\n-        <name>levels</name>\n-        <number>2</number>\n-        <prettyName>Levels</prettyName>\n-        <relationalStorage>0</relationalStorage>\n-        <separator> </separator>\n-        <size>3</size>\n-        <unmodifiable>0</unmodifiable>\n-        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n-      </levels>\n-      <users>\n-        <cache>0</cache>\n-        <disabled>0</disabled>\n-        <displayType>input</displayType>\n-        <multiSelect>1</multiSelect>\n-        <name>users</name>\n-        <number>3</number>\n-        <picker>1</picker>\n-        <prettyName>Users</prettyName>\n-        <relationalStorage>0</relationalStorage>\n-        <separator> </separator>\n-        <size>5</size>\n-        <unmodifiable>0</unmodifiable>\n-        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n-      </users>\n-    </class>\n-    <property>\n-      <allow>0</allow>\n-    </property>\n-    <property>\n-      <groups>XWiki.XWikiAllGroup</groups>\n-    </property>\n-    <property>\n-      <levels>view</levels>\n-    </property>\n-    <property>\n-      <users/>\n-    </property>\n-  </object>\n-  <object>\n-    <name>Scheduler.WebPreferences</name>\n-    <number>2</number>\n-    <className>XWiki.XWikiGlobalRights</className>\n-    <guid>fef3f075-e0ed-46d1-991f-680326129a9d</guid>\n-    <class>\n-      <name>XWiki.XWikiGlobalRights</name>\n-      <customClass/>\n-      <customMapping/>\n-      <defaultViewSheet/>\n-      <defaultEditSheet/>\n-      <defaultWeb/>\n-      <nameField/>\n-      <validationScript/>\n-      <allow>\n-        <defaultValue>1</defaultValue>\n-        <disabled>0</disabled>\n-        <displayFormType>select</displayFormType>\n-        <displayType>allow</displayType>\n-        <name>allow</name>\n-        <number>4</number>\n-        <prettyName>Allow/Deny</prettyName>\n-        <unmodifiable>0</unmodifiable>\n-        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>\n-      </allow>\n-      <groups>\n-        <cache>0</cache>\n-        <disabled>0</disabled>\n-        <displayType>input</displayType>\n-        <multiSelect>1</multiSelect>\n-        <name>groups</name>\n-        <number>1</number>\n-        <picker>1</picker>\n-        <prettyName>Groups</prettyName>\n-        <relationalStorage>0</relationalStorage>\n-        <separator> </separator>\n-        <size>5</size>\n-        <unmodifiable>0</unmodifiable>\n-        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>\n-      </groups>\n-      <levels>\n-        <cache>0</cache>\n-        <disabled>0</disabled>\n-        <displayType>select</displayType>\n-        <multiSelect>1</multiSelect>\n-        <name>levels</name>\n-        <number>2</number>\n-        <prettyName>Levels</prettyName>\n-        <relationalStorage>0</relationalStorage>\n-        <separator> </separator>\n-        <size>3</size>\n-        <unmodifiable>0</unmodifiable>\n-        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>\n-      </levels>\n-      <users>\n-        <cache>0</cache>\n-        <disabled>0</disabled>\n-        <displayType>input</displayType>\n-        <multiSelect>1</multiSelect>\n-        <name>users</name>\n-        <number>3</number>\n-        <picker>1</picker>\n-        <prettyName>Users</prettyName>\n-        <relationalStorage>0</relationalStorage>\n-        <separator> </separator>\n-        <size>5</size>\n-        <unmodifiable>0</unmodifiable>\n-        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>\n-      </users>\n-    </class>\n-    <property>\n-      <allow>0</allow>\n-    </property>\n-    <property>\n-      <groups/>\n-    </property>\n-    <property>\n-      <levels>view</levels>\n-    </property>\n-    <property>\n-      <users>XWiki.XWikiGuest</users>\n-    </property>\n-  </object>\n </xwikidoc>"
            },
            {
                "sha": "bef8cf950f27255a0714463cbb4d8375599e6084",
                "filename": "xwiki-platform-core/xwiki-platform-scheduler/xwiki-platform-scheduler-ui/src/test/java/org/xwiki/scheduler/ui/SchedulerPageTest.java",
                "status": "modified",
                "additions": 29,
                "deletions": 0,
                "changes": 29,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fscheduler%2Fui%2FSchedulerPageTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/54bcc5a7a2e440cc591b91eece9c13dc0c487331/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fscheduler%2Fui%2FSchedulerPageTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-scheduler%2Fxwiki-platform-scheduler-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Fscheduler%2Fui%2FSchedulerPageTest.java?ref=54bcc5a7a2e440cc591b91eece9c13dc0c487331",
                "patch": "@@ -32,6 +32,7 @@\n import org.mockito.Mock;\n import org.quartz.Trigger;\n import org.xwiki.csrf.script.CSRFTokenScriptService;\n+import org.xwiki.localization.macro.internal.TranslationMacro;\n import org.xwiki.model.reference.DocumentReference;\n import org.xwiki.query.internal.ScriptQuery;\n import org.xwiki.query.script.QueryManagerScriptService;\n@@ -41,6 +42,10 @@\n import org.xwiki.rendering.internal.macro.message.InfoMessageMacro;\n import org.xwiki.rendering.internal.macro.message.WarningMessageMacro;\n import org.xwiki.script.service.ScriptService;\n+import org.xwiki.security.authorization.Right;\n+import org.xwiki.security.authorization.script.SecurityAuthorizationScriptService;\n+import org.xwiki.security.script.SecurityScriptService;\n+import org.xwiki.security.script.SecurityScriptServiceComponentList;\n import org.xwiki.test.annotation.ComponentList;\n import org.xwiki.test.page.HTML50ComponentList;\n import org.xwiki.test.page.PageTest;\n@@ -77,8 +82,10 @@\n     ErrorMessageMacro.class,\n     SchedulerJobClassDocumentInitializer.class,\n     TestNoScriptMacro.class,\n+    TranslationMacro.class,\n     WarningMessageMacro.class\n })\n+@SecurityScriptServiceComponentList\n @RenderingScriptServiceComponentList\n @DefaultRenderingConfigurationComponentList\n @HTML50ComponentList\n@@ -98,6 +105,8 @@ class SchedulerPageTest extends PageTest\n \n     private CSRFTokenScriptService tokenService;\n \n+    private SecurityAuthorizationScriptService authorizationScriptService;\n+\n     private SchedulerPluginApi schedulerPluginApi;\n \n     @Mock\n@@ -138,6 +147,9 @@ void setUp() throws Exception\n         // Fake programming access level to display the complete page.\n         when(this.oldcore.getMockRightService().hasAccessLevel(eq(\"programming\"), anyString(), anyString(),\n             any(XWikiContext.class))).thenReturn(true);\n+        this.authorizationScriptService = this.oldcore.getMocker().getInstance(ScriptService.class,\n+            SecurityScriptService.ROLEHINT + \".\" + SecurityAuthorizationScriptService.ID);\n+        when(this.authorizationScriptService.hasAccess(eq(Right.PROGRAM), any(), any())).thenReturn(true);\n     }\n \n     /**\n@@ -178,6 +190,23 @@ void checkValidCSRFToken() throws Exception\n         assertTrue(result.getElementsByClass(\"errormessage\").isEmpty());\n     }\n \n+    /**\n+     * Check that the trigger operation fails if the user is missing programming rights.\n+     */\n+    @Test\n+    void checkMissingProgrammingRights() throws Exception\n+    {\n+        when(this.authorizationScriptService.hasAccess(eq(Right.PROGRAM), any(), any())).thenReturn(false);\n+        when(this.schedulerPluginApi.triggerJob(this.testJobObjectApi)).thenReturn(true);\n+\n+        this.request.put(\"do\", \"trigger\");\n+        this.request.put(\"which\", \"Scheduler.TestJob\");\n+        Document result = renderHTMLPage(SCHEDULER_WEB_HOME);\n+\n+        verify(this.schedulerPluginApi, never()).triggerJob(any(Object.class));\n+        assertEquals(\"xe.scheduler.missingProgrammingRights\", result.getElementsByClass(\"errormessage\").text());\n+    }\n+\n     /**\n      * List every possible action that can be applied to a job depending on its current status.\n      *"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/http4k/http4k/commits/35297adc6d6aca4951d50d8cdf17ff87a8b19fbc",
        "url": "https://api.github.com/repos/http4k/http4k/commits/35297adc6d6aca4951d50d8cdf17ff87a8b19fbc",
        "html_url": "https://github.com/http4k/http4k/commit/35297adc6d6aca4951d50d8cdf17ff87a8b19fbc",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "4f36957f398d3daa03b3cbbdf6de7ac4017c46fe",
                "filename": "core/format/xml/src/main/kotlin/org/http4k/format/Xml.kt",
                "status": "modified",
                "additions": 17,
                "deletions": 6,
                "changes": 23,
                "blob_url": "https://github.com/http4k/http4k/blob/35297adc6d6aca4951d50d8cdf17ff87a8b19fbc/core%2Fformat%2Fxml%2Fsrc%2Fmain%2Fkotlin%2Forg%2Fhttp4k%2Fformat%2FXml.kt",
                "raw_url": "https://github.com/http4k/http4k/raw/35297adc6d6aca4951d50d8cdf17ff87a8b19fbc/core%2Fformat%2Fxml%2Fsrc%2Fmain%2Fkotlin%2Forg%2Fhttp4k%2Fformat%2FXml.kt",
                "contents_url": "https://api.github.com/repos/http4k/http4k/contents/core%2Fformat%2Fxml%2Fsrc%2Fmain%2Fkotlin%2Forg%2Fhttp4k%2Fformat%2FXml.kt?ref=35297adc6d6aca4951d50d8cdf17ff87a8b19fbc",
                "patch": "@@ -19,6 +19,7 @@ import org.w3c.dom.Document\n import java.io.InputStream\n import java.io.StringWriter\n import java.nio.ByteBuffer\n+import javax.xml.XMLConstants\n import javax.xml.parsers.DocumentBuilderFactory\n import javax.xml.transform.TransformerFactory\n import javax.xml.transform.dom.DOMSource\n@@ -39,9 +40,10 @@ object Xml : AutoMarshallingXml() {\n     @JvmName(\"stringAsXmlToJsonElement\")\n     fun asXmlToJsonElement(input: String): JsonElement = input.asXmlToJsonElement()\n \n-    fun String.asXmlDocument(): Document =\n+    fun String.asXmlDocument(config: XmlParsingConfig = defaultXmlParsingConfig): Document =\n         DocumentBuilderFactory\n             .newInstance()\n+            .apply(config)\n             .newDocumentBuilder()\n             .parse(byteInputStream())\n \n@@ -63,14 +65,15 @@ object Xml : AutoMarshallingXml() {\n     /**\n      * Convenience function to write the object as XML to the message body and set the content type.\n      */\n-    fun <IN : Any> BiDiLensSpec<IN, String>.xml() = map({ it.asXmlDocument() }, { it.asXmlString() })\n+    fun <IN : Any> BiDiLensSpec<IN, String>.xml(config: XmlParsingConfig = defaultXmlParsingConfig) = map({ it.asXmlDocument(config) }, { it.asXmlString() })\n \n-    fun asBiDiMapping() =\n-        BiDiMapping<String, Document>({ it.asXmlDocument() }, { it.asXmlString() })\n+    fun asBiDiMapping(config: XmlParsingConfig = defaultXmlParsingConfig) =\n+        BiDiMapping<String, Document>({ it.asXmlDocument(config) }, { it.asXmlString() })\n \n     fun Body.Companion.xml(\n         description: String? = null,\n-        contentNegotiation: ContentNegotiation = ContentNegotiation.None\n+        contentNegotiation: ContentNegotiation = ContentNegotiation.None,\n+        config: XmlParsingConfig = defaultXmlParsingConfig\n     ): BiDiBodyLensSpec<Document> =\n         httpBodyRoot(\n             listOf(Meta(true, \"body\", ObjectParam, \"body\", description, emptyMap())),\n@@ -79,5 +82,13 @@ object Xml : AutoMarshallingXml() {\n         )\n             .map(Body::payload) { Body(it) }\n             .map(ByteBuffer::asString, String::asByteBuffer)\n-            .map({ it.asXmlDocument() }, { it.asXmlString() })\n+            .map({ it.asXmlDocument(config) }, { it.asXmlString() })\n+}\n+\n+typealias XmlParsingConfig = DocumentBuilderFactory.() -> Unit\n+\n+val defaultXmlParsingConfig: XmlParsingConfig = {\n+    isExpandEntityReferences = false\n+    setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\")\n+    setAttribute(XMLConstants.ACCESS_EXTERNAL_SCHEMA, \"\")\n }"
            },
            {
                "sha": "8bd63d4fac370edf4570d692771e717d8630fd6a",
                "filename": "core/format/xml/src/test/kotlin/org/http4k/format/XmlSecurityTest.kt",
                "status": "added",
                "additions": 122,
                "deletions": 0,
                "changes": 122,
                "blob_url": "https://github.com/http4k/http4k/blob/35297adc6d6aca4951d50d8cdf17ff87a8b19fbc/core%2Fformat%2Fxml%2Fsrc%2Ftest%2Fkotlin%2Forg%2Fhttp4k%2Fformat%2FXmlSecurityTest.kt",
                "raw_url": "https://github.com/http4k/http4k/raw/35297adc6d6aca4951d50d8cdf17ff87a8b19fbc/core%2Fformat%2Fxml%2Fsrc%2Ftest%2Fkotlin%2Forg%2Fhttp4k%2Fformat%2FXmlSecurityTest.kt",
                "contents_url": "https://api.github.com/repos/http4k/http4k/contents/core%2Fformat%2Fxml%2Fsrc%2Ftest%2Fkotlin%2Forg%2Fhttp4k%2Fformat%2FXmlSecurityTest.kt?ref=35297adc6d6aca4951d50d8cdf17ff87a8b19fbc",
                "patch": "@@ -0,0 +1,122 @@\n+package org.http4k.format\n+\n+import com.natpryce.hamkrest.assertion.assertThat\n+import com.natpryce.hamkrest.equalTo\n+import org.http4k.core.Body\n+import org.http4k.core.ContentType.Companion.APPLICATION_XML\n+import org.http4k.core.HttpHandler\n+import org.http4k.core.Method\n+import org.http4k.core.Request\n+import org.http4k.core.Response\n+import org.http4k.core.Status.Companion.BAD_REQUEST\n+import org.http4k.core.Status.Companion.OK\n+import org.http4k.format.Xml.asXmlString\n+import org.http4k.format.Xml.xml\n+import org.http4k.lens.contentType\n+import org.http4k.server.ApacheServer\n+import org.http4k.server.asServer\n+import org.http4k.util.PortBasedTest\n+import org.junit.jupiter.api.Test\n+import org.w3c.dom.Document\n+import java.util.concurrent.atomic.AtomicBoolean\n+\n+class XmlSecurityTest : PortBasedTest {\n+\n+    @Test\n+    fun `does not expand external entity`() {\n+        val websiteAccessed = AtomicBoolean(false)\n+\n+        val maliciousWebsite = { _: Request ->\n+            websiteAccessed.set(true);\n+            Response(OK)\n+        }.asServer(ApacheServer(0)).start()\n+\n+        val requestBody =\n+            \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+                <!DOCTYPE root [<!ENTITY xxe SYSTEM \"http://localhost:${maliciousWebsite.port()}\">]>\n+                <root>&xxe;</root>\n+            \"\"\".trimIndent()\n+\n+        val xmlLens = Body.xml().toLens()\n+\n+        val app: HttpHandler = { request ->\n+            try {\n+                val xmlDocument: Document = xmlLens(request)\n+                Response(OK).body(xmlDocument.asXmlString())\n+            } catch (e: Exception) {\n+                Response(BAD_REQUEST).body(\"Invalid XML: ${e.message}\")\n+            }\n+        }\n+\n+        app(Request(Method.POST, \"/\").contentType(APPLICATION_XML).body(requestBody))\n+        assertThat(websiteAccessed.get(), equalTo(false))\n+    }\n+\n+    @Test\n+    fun `external schema is not loaded`() {\n+        val websiteAccessed = AtomicBoolean(false)\n+\n+        val maliciousWebsite = { _: Request ->\n+            websiteAccessed.set(true);\n+            Response(OK)\n+        }.asServer(ApacheServer(0)).start()\n+\n+        val requestBody = \"\"\"\n+            <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+            <user xmlns:xsi=\"http://localhost:${maliciousWebsite.port()}\"\n+                  xsi:noNamespaceSchemaLocation=\"http://localhost:${maliciousWebsite.port()}\">\n+                <name>John Doe</name>\n+                <email>john@example.com</email>\n+                <age>30</age>\n+            </user>\n+        \"\"\".trimIndent()\n+\n+        val xmlLens = Body.xml().toLens()\n+\n+        val app: HttpHandler = { request ->\n+            try {\n+                val xmlDocument: Document = xmlLens(request)\n+                Response(OK).body(xmlDocument.asXmlString())\n+            } catch (e: Exception) {\n+                Response(BAD_REQUEST).body(\"Invalid XML: ${e.message}\")\n+            }\n+        }\n+\n+        app(Request(Method.POST, \"/\").contentType(APPLICATION_XML).body(requestBody))\n+        assertThat(websiteAccessed.get(), equalTo(false))\n+    }\n+\n+    @Test\n+    fun `external dtd is not loaded`() {\n+        val websiteAccessed = AtomicBoolean(false)\n+\n+        val maliciousWebsite = { _: Request ->\n+            websiteAccessed.set(true);\n+            Response(OK)\n+        }.asServer(ApacheServer(0)).start()\n+\n+        val requestBody = \"\"\"\n+            <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+            <!DOCTYPE note SYSTEM \"http://localhost:${maliciousWebsite.port()}\">\n+            <note>\n+                <to>Alice</to>\n+                <from>Bob</from>\n+                <message>Hello</message>\n+            </note>\n+        \"\"\".trimIndent()\n+\n+        val xmlLens = Body.xml().toLens()\n+\n+        val app: HttpHandler = { request ->\n+            try {\n+                val xmlDocument: Document = xmlLens(request)\n+                Response(OK).body(xmlDocument.asXmlString())\n+            } catch (e: Exception) {\n+                Response(BAD_REQUEST).body(\"Invalid XML: ${e.message}\")\n+            }\n+        }\n+\n+        app(Request(Method.POST, \"/\").contentType(APPLICATION_XML).body(requestBody))\n+        assertThat(websiteAccessed.get(), equalTo(false))\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/673076e2e8b88a36cdeaf7007843aa9ca1a068a0",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/673076e2e8b88a36cdeaf7007843aa9ca1a068a0",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/673076e2e8b88a36cdeaf7007843aa9ca1a068a0",
        "message": "XWIKI-17568: clean sort parameter value\n\n- do not produce an error if the \"sort\" parameter\n  is empty of missing",
        "files": [
            {
                "sha": "dabb02d8fc135a63af77c8767ac6905d0cfbabcf",
                "filename": "xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/getdocuments.vm",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/673076e2e8b88a36cdeaf7007843aa9ca1a068a0/xwiki-platform-core%2Fxwiki-platform-web%2Fxwiki-platform-web-templates%2Fsrc%2Fmain%2Fresources%2Ftemplates%2Fgetdocuments.vm",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/673076e2e8b88a36cdeaf7007843aa9ca1a068a0/xwiki-platform-core%2Fxwiki-platform-web%2Fxwiki-platform-web-templates%2Fsrc%2Fmain%2Fresources%2Ftemplates%2Fgetdocuments.vm",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-web%2Fxwiki-platform-web-templates%2Fsrc%2Fmain%2Fresources%2Ftemplates%2Fgetdocuments.vm?ref=673076e2e8b88a36cdeaf7007843aa9ca1a068a0",
                "patch": "@@ -80,12 +80,12 @@ $response.setContentType(\"application/json\")\n ## ORDER\n ##\n #set ($order = \"$!request.sort\")\n-#if (!$regextool.compile('^(doc\\.)?\\w+$').matcher($order).matches())\n-  { \"error\" : \"invalid sort parameter\" }\n-  #stop (\"invalid sort parameter [$order] found\")\n-#end\n #set ($orderQueryPart = '')\n #if ($order != '')\n+  #if (!$regextool.compile('^(doc\\.)?\\w+$').matcher($order).matches())\n+    { \"error\" : \"invalid sort parameter\" }\n+    #stop (\"invalid sort parameter [$order] found\")\n+  #end\n   #set ($orderDirection = \"$!{request.get('dir').toLowerCase()}\")\n   #if (\"$!orderDirection\" != '' && \"$!orderDirection\" != 'asc')\n     #set($orderDirection = 'desc')"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/8659f17d500522bf33595e402391592a35a162e8",
        "url": "https://api.github.com/repos/xwiki/xwiki-platform/commits/8659f17d500522bf33595e402391592a35a162e8",
        "html_url": "https://github.com/xwiki/xwiki-platform/commit/8659f17d500522bf33595e402391592a35a162e8",
        "message": "XWIKI-21890: Improve escaping in Extension Sheet",
        "files": [
            {
                "sha": "6d84f30e18ad53b4271be18f3d92da705a2df695",
                "filename": "xwiki-platform-core/xwiki-platform-repository/xwiki-platform-repository-server-ui/pom.xml",
                "status": "modified",
                "additions": 47,
                "deletions": 0,
                "changes": 47,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8659f17d500522bf33595e402391592a35a162e8/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fpom.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8659f17d500522bf33595e402391592a35a162e8/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fpom.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fpom.xml?ref=8659f17d500522bf33595e402391592a35a162e8",
                "patch": "@@ -96,6 +96,53 @@\n       <version>${rendering.version}</version>\n       <scope>runtime</scope>\n     </dependency>\n+    <!-- Test dependencies. -->\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-test-page</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-uiextension-api</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+      <type>test-jar</type>\n+    </dependency>\n+    <!-- Provides the component list for RenderingScriptService. -->\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-rendering-xwiki</artifactId>\n+      <version>${project.version}</version>\n+      <type>test-jar</type>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-rendering-configuration-default</artifactId>\n+      <version>${project.version}</version>\n+      <type>test-jar</type>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-rendering-macro-groovy</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.platform</groupId>\n+      <artifactId>xwiki-platform-logging-script</artifactId>\n+      <version>${project.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.xwiki.commons</groupId>\n+      <artifactId>xwiki-commons-logging-logback</artifactId>\n+      <version>${commons.version}</version>\n+      <scope>test</scope>\n+    </dependency>\n   </dependencies>\n   <build>\n     <plugins>"
            },
            {
                "sha": "38a093a8187c627b942ed6471f9e260f23726642",
                "filename": "xwiki-platform-core/xwiki-platform-repository/xwiki-platform-repository-server-ui/src/main/resources/ExtensionCode/ExtensionAuthorsDisplayer.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8659f17d500522bf33595e402391592a35a162e8/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fsrc%2Fmain%2Fresources%2FExtensionCode%2FExtensionAuthorsDisplayer.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8659f17d500522bf33595e402391592a35a162e8/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fsrc%2Fmain%2Fresources%2FExtensionCode%2FExtensionAuthorsDisplayer.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fsrc%2Fmain%2Fresources%2FExtensionCode%2FExtensionAuthorsDisplayer.xml?ref=8659f17d500522bf33595e402391592a35a162e8",
                "patch": "@@ -88,7 +88,7 @@\n     &lt;/script&gt;\n   {{/html}}\n #else\n-  #foreach($page in $pageList)#if($foreach.count &gt; 1), #end#if($xwiki.exists($page))[[${xwiki.getUserName($page, false)}&gt;&gt;$page]]#else$page#end#end\n+  #foreach($page in $pageList)#if($foreach.count &gt; 1), #end#if($xwiki.exists($page))[[${xwiki.getUserName($page, false)}&gt;&gt;$page]]#else$services.rendering.escape($page, 'xwiki/2.1')#end#end\n #end\n {{/velocity}}</content>\n   <object>"
            },
            {
                "sha": "94af5b41f5f5dfb0d64ec5e2373afbacf797e07b",
                "filename": "xwiki-platform-core/xwiki-platform-repository/xwiki-platform-repository-server-ui/src/main/resources/ExtensionCode/ExtensionSheet.xml",
                "status": "modified",
                "additions": 28,
                "deletions": 24,
                "changes": 52,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8659f17d500522bf33595e402391592a35a162e8/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fsrc%2Fmain%2Fresources%2FExtensionCode%2FExtensionSheet.xml",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8659f17d500522bf33595e402391592a35a162e8/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fsrc%2Fmain%2Fresources%2FExtensionCode%2FExtensionSheet.xml",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fsrc%2Fmain%2Fresources%2FExtensionCode%2FExtensionSheet.xml?ref=8659f17d500522bf33595e402391592a35a162e8",
                "patch": "@@ -90,9 +90,9 @@\n     (% class=\"extensionSummary\" %)\n     #set($icon = $doc.getValue(\"icon\"))\n     #if (\"$!{icon.trim()}\" != \"\")\n-      |[[image:${doc.getValue('icon')}]]|**{{{$doc.getValue(\"summary\")}}}**\n+      |[[image:${services.rendering.escape($doc.getValue('icon'), 'xwiki/2.1')}]]|**${services.rendering.escape($doc.getValue(\"summary\"), 'xwiki/2.1')}**\n     #else\n-      |[[image:icon:cog]]|**{{{$doc.getValue(\"summary\")}}}**\n+      |[[image:icon:cog]]|**${services.rendering.escape($doc.getValue(\"summary\"), 'xwiki/2.1')}**\n     #end\n \n     ## Viewing\n@@ -116,14 +116,14 @@\n       #if (\"$!typeDisplay\" == '')\n         #set($typeDisplay = $type)\n       #end\n-      |(% class=\"label\" width='30%' %)Type(%%)|$typeDisplay\n+      |(% class=\"label\" width='30%' %)Type(%%)|$services.rendering.escape($typeDisplay, 'xwiki/2.1')\n       ##------- Category --------------\n       #set($categoryDisplay = $extensionCategoryObject.getProperty('name').value)\n       #if (\"$!categoryDisplay\" == '')\n         #set($categoryDisplay = $category)\n       #end\n       #if ($categoryDisplay)\n-      |(% class=\"label\" width='30%' %)Category(%%)|$categoryDisplay\n+      |(% class=\"label\" width='30%' %)Category(%%)|$services.rendering.escape($categoryDisplay, 'xwiki/2.1')\n       #end\n       ##------- Developed By --------\n       #set($authors = $doc.getValue(\"authors\"))\n@@ -134,23 +134,23 @@\n         #end\n       ##------- Active Installs --------\n       #if ($doc.getValue('installedCount') &amp;&amp; $doc.getValue('showInstalledCount') != 0)\n-        |(% class=\"label\" %)Active Installs(%%)|$!doc.getValue('installedCount')\n+        |(% class=\"label\" %)Active Installs(%%)|$services.rendering.escape($!doc.getValue('installedCount'), 'xwiki/2.1')\n       #end\n       ##------- Rating --------\n       |(% class=\"label\" %)Rating(%%)|#displayFullRating($doc.documentReference)\n       ##------- Website --------------\n       #set($website = $extension.getProperty(\"website\").value)\n       #if (\"$!website\" != '')\n         |(% class=\"label\" %)Website(%%)|#if ($website.length() &gt; 40)\n-                                          [[{{{$website.substring(0, 40)...}}}&gt;&gt;url:$website]]\n+                                          [[$services.rendering.escape($services.rendering.escape($website.substring(0, 40), 'xwiki/2.1'), 'xwiki/2.1')...&gt;&gt;$services.rendering.escape($website, 'xwiki/2.1')]]\n                                         #else\n-                                          $website\n+                                          [[$services.rendering.escape($website, 'xwiki/2.1')]]\n                                         #end\n       #end\n       ##------- License --------\n       #set($licenseName = $doc.getValue(\"licenseName\"))\n       #if (\"$!licenseName\" != \"\")\n-        |(% class=\"label\" %)License(%%)|$licenseName\n+        |(% class=\"label\" %)License(%%)|$services.rendering.escape($licenseName, 'xwiki/2.1')\n       #else\n         |(% class=\"label\" %)License(%%)|Unknown\n       #end\n@@ -178,21 +178,21 @@\n           #set ($download = $lastVersionObject.getProperty(\"download\").value)\n           #if (\"$!download\" == '')\n             #if ($doc.getAttachment(\"${id}-${version}.${type}\"))\n-              [[$services.icon.render('download')  Download v$version&gt;&gt;attach:${id}-${version}.${type}||class=\"btn btn-primary\"]]##\n+              [[$services.icon.render('download')  Download v$services.rendering.escape($services.rendering.escape($version, 'xwiki/2.1'), 'xwiki/2.1')&gt;&gt;$services.rendering.escape(\"attach:${id}-${version}.${type}\")||class=\"btn btn-primary\"]]##\n             #end\n           #else\n-            [[$services.icon.render('download')  Download v$version&gt;&gt;${download}||class=\"btn btn-primary\"]]##\n+            [[$services.icon.render('download')  Download v$services.rendering.escape($services.rendering.escape($version, 'xwiki/2.1'), 'xwiki/2.1')&gt;&gt;$services.rendering.escape($download, 'xwiki/2.1')||class=\"btn btn-primary\"]]##\n           #end\n         #end\n         ##------- Source --------\n         #set($source = $doc.getValue(\"source\"))\n         #if (\"$!source\" != \"\")\n-          [[Sources&gt;&gt;${source}||class=\"btn btn-default\"]]##\n+          [[Sources&gt;&gt;$services.rendering.escape($source, 'xwiki/2.1')||class=\"btn btn-default\"]]##\n         #end\n         ##------- Issues --------\n         #set($issues = $doc.getValue(\"issueManagementURL\"))\n         #if (\"$!issues\" != \"\")\n-          [[Issues&gt;&gt;${issues}||class=\"btn btn-default\"]]##\n+          [[Issues&gt;&gt;$services.rendering.escape($issues, 'xwiki/2.1')||class=\"btn btn-default\"]]##\n         #end\n       )))\n     {{/box}}\n@@ -240,7 +240,7 @@\n     |Category|#if($proxyExtensionObject)$doc.display('category', 'view')#else$doc.display('category')#end~\n     |Summary|#if($proxyExtensionObject)$doc.display('summary', 'view')#else$doc.display('summary')#end~\n     ## FIXME: there seems to be a bug with custom displayer where they don't take into account the mode passed to display\n-    |Authors|#if($proxyExtensionObject)$doc.getValue('authors')#else$doc.display('authors')#end~\n+    |Authors|#if($proxyExtensionObject)$services.rendering.escape($doc.getValue('authors').toString(), 'xwiki/2.1')#else$doc.display('authors')#end~\n     |License|#if($proxyExtensionObject)$doc.display('licenseName', 'view')#else$doc.display('licenseName')#end~\n     |Source|$doc.display('source')\n     |Display Icon Location\n@@ -255,9 +255,11 @@\n     = Description =\n     #if ($isViewMode)\n       ## Make sure to resolve reference based on the right document\n-      $doc.getValue(\"description\")\n+      {{context transformationContext=\"document\" restricted=true}}\n+        $doc.getValue('description')\n+      {{/context}}\n     #else\n-      $doc.display(\"description\")\n+      $doc.display('description')\n     #end\n \n     #if ($extensionTypeObject &amp;&amp; $lastVersionObject &amp;&amp; \"$!{extension.getProperty('customInstallationOnly').value}\" != '1')\n@@ -272,7 +274,7 @@\n \n       #if ($isEditMode)\n         ; Custom installation only\n-        : $extension.customInstallationOnly\n+        : $extension.display('customInstallationOnly', 'edit')\n       #end\n       ##\n       ## Standard installation\n@@ -288,9 +290,11 @@\n       #if ($isEditMode)\n         == Custom installation instructions\n \n-        $extension.installation\n+        $extension.display('installation', 'edit')\n       #elseif ($extraInstallation != '')\n-        $extraInstallation\n+        {{context transformationContext=\"document\" restricted=true}}\n+          $extraInstallation\n+        {{/context}}\n       #end\n     #end\n \n@@ -299,7 +303,7 @@\n       #set ($releaseNotes = [])\n       #set ($versions = $doc.getObjects(\"ExtensionCode.ExtensionVersionClass\"))\n       #foreach ($versionObject in $versions)\n-        #set ($notes = $!{versionObject.getProperty('notes').value})\n+        #set ($notes = $!{versionObject.display('notes', 'read')})\n         #set ($version = $!{versionObject.getProperty('version').value})\n         #if (\"$!notes\" != '' &amp;&amp; \"$!version\" != '')\n           #set ($discard = $releaseNotes.add([$version, $notes]))\n@@ -310,26 +314,26 @@\n       #if (!$releaseNotes.isEmpty())\n         = Release Notes =\n         #foreach ($entry in $releaseNotes)\n-          == v$entry.get(0) ==\n+          == v$services.rendering.escape($entry.get(0), 'xwiki/2.1') ==\n           $entry.get(1)\n         #end\n       #end\n \n-      #set($extensionDependencies = $doc.getObjects('ExtensionCode.ExtensionDependencyClass', 'extensionVersion', $lastVersionObject.version))\n+      #set($extensionDependencies = $doc.getObjects('ExtensionCode.ExtensionDependencyClass', 'extensionVersion', $lastVersionObject.getValue('version')))\n       #if ($extensionDependencies.size() &gt; 0)\n         = Dependencies =\n \n-         Dependencies for this extension (${extension.getProperty('id').value} ${doc.getValue('lastVersion')}):\n+         Dependencies for this extension ($services.rendering.escape(\"${extension.getValue('id')} ${doc.getValue('lastVersion')}\", 'xwiki/2.1')):\n          #foreach($extensionDependency in $extensionDependencies)\n           #set($dependencyDocumentName = $null)\n           #set($dependencyDocumentNames = $services.query.xwql('from doc.object(ExtensionCode.ExtensionClass) as extension where extension.id = :id').bindValue(\"id\", $extensionDependency.id).execute())\n           #if (!$dependencyDocumentNames.isEmpty())\n             #set($dependencyDocumentName = $dependencyDocumentNames.get(0))\n           #end\n           #if ($dependencyDocumentName)\n-            * [[$extensionDependency.id&gt;&gt;$dependencyDocumentName]] $extensionDependency.constraint\n+            * [[$services.rendering.escape($services.rendering.escape($extensionDependency.getValue('id'), 'xwiki/2.1'), 'xwiki/2.1')&gt;&gt;$services.rendering.escape($dependencyDocumentName, 'xwiki/2.1')]] $services.rendering.escape($extensionDependency.getValue('constraint'), 'xwiki/2.1')\n           #else\n-            * $extensionDependency.id $extensionDependency.constraint\n+            * $services.rendering.escape(\"${extensionDependency.getValue('id')} ${extensionDependency.getValue('constraint')}\", 'xwiki/2.1')\n           #end\n         #end\n       #end"
            },
            {
                "sha": "e470d9562935cad032d99cad74cd8b3293cd6bfd",
                "filename": "xwiki-platform-core/xwiki-platform-repository/xwiki-platform-repository-server-ui/src/test/java/org/xwiki/repository/server/ui/ExtensionSheetPageTest.java",
                "status": "added",
                "additions": 196,
                "deletions": 0,
                "changes": 196,
                "blob_url": "https://github.com/xwiki/xwiki-platform/blob/8659f17d500522bf33595e402391592a35a162e8/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frepository%2Fserver%2Fui%2FExtensionSheetPageTest.java",
                "raw_url": "https://github.com/xwiki/xwiki-platform/raw/8659f17d500522bf33595e402391592a35a162e8/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frepository%2Fserver%2Fui%2FExtensionSheetPageTest.java",
                "contents_url": "https://api.github.com/repos/xwiki/xwiki-platform/contents/xwiki-platform-core%2Fxwiki-platform-repository%2Fxwiki-platform-repository-server-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fxwiki%2Frepository%2Fserver%2Fui%2FExtensionSheetPageTest.java?ref=8659f17d500522bf33595e402391592a35a162e8",
                "patch": "@@ -0,0 +1,196 @@\n+/*\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+package org.xwiki.repository.server.ui;\n+\n+import java.util.List;\n+\n+import javax.inject.Named;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.xwiki.groovy.internal.DefaultGroovyConfiguration;\n+import org.xwiki.groovy.internal.GroovyScriptEngineFactory;\n+import org.xwiki.logging.logback.internal.DefaultLoggerManager;\n+import org.xwiki.logging.script.LoggingScriptService;\n+import org.xwiki.model.reference.DocumentReference;\n+import org.xwiki.observation.internal.DefaultObservationManager;\n+import org.xwiki.query.Query;\n+import org.xwiki.query.script.QueryManagerScriptService;\n+import org.xwiki.rendering.RenderingScriptServiceComponentList;\n+import org.xwiki.rendering.async.internal.AsyncMacro;\n+import org.xwiki.rendering.async.internal.block.DefaultBlockAsyncRenderer;\n+import org.xwiki.rendering.internal.configuration.DefaultRenderingConfigurationComponentList;\n+import org.xwiki.rendering.internal.macro.box.DefaultBoxMacro;\n+import org.xwiki.rendering.internal.macro.context.ContextMacro;\n+import org.xwiki.rendering.internal.macro.context.ContextMacroDocument;\n+import org.xwiki.rendering.internal.macro.groovy.GroovyMacro;\n+import org.xwiki.rendering.internal.macro.script.PermissionCheckerListener;\n+import org.xwiki.rendering.internal.macro.source.DefaultMacroWikiContentSourceFactory;\n+import org.xwiki.rendering.internal.macro.toc.DefaultTocEntriesResolver;\n+import org.xwiki.rendering.internal.macro.toc.DefaultTocTreeBuilderFactory;\n+import org.xwiki.rendering.internal.macro.toc.TocMacro;\n+import org.xwiki.rendering.macro.script.MacroPermissionPolicy;\n+import org.xwiki.rendering.transformation.MacroTransformationContext;\n+import org.xwiki.script.service.ScriptService;\n+import org.xwiki.test.annotation.ComponentList;\n+import org.xwiki.test.junit5.mockito.MockComponent;\n+import org.xwiki.test.page.HTML50ComponentList;\n+import org.xwiki.test.page.PageTest;\n+import org.xwiki.test.page.TestNoScriptMacro;\n+import org.xwiki.test.page.XWikiSyntax21ComponentList;\n+\n+import com.xpn.xwiki.doc.XWikiDocument;\n+import com.xpn.xwiki.objects.BaseObject;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Page Test for {@code ExtensionCode.ExtensionSheet}.\n+ *\n+ * @version $Id$\n+ * @since 15.10.9\n+ * @since 16.3.0RC1\n+ */\n+@RenderingScriptServiceComponentList\n+@DefaultRenderingConfigurationComponentList\n+@HTML50ComponentList\n+@XWikiSyntax21ComponentList\n+@ComponentList({\n+    AsyncMacro.class,\n+    ContextMacroDocument.class,\n+    ContextMacro.class,\n+    DefaultBlockAsyncRenderer.class,\n+    DefaultBoxMacro.class,\n+    DefaultGroovyConfiguration.class,\n+    DefaultLoggerManager.class,\n+    DefaultMacroWikiContentSourceFactory.class,\n+    DefaultObservationManager.class,\n+    DefaultTocEntriesResolver.class,\n+    DefaultTocTreeBuilderFactory.class,\n+    GroovyMacro.class,\n+    GroovyScriptEngineFactory.class,\n+    LoggingScriptService.class,\n+    PermissionCheckerListener.class,\n+    TestNoScriptMacro.class,\n+    TocMacro.class,\n+})\n+public class ExtensionSheetPageTest extends PageTest\n+{\n+    private static final String WIKI_NAME = \"xwiki\";\n+\n+    private static final DocumentReference EXTENSION_SHEET =\n+        new DocumentReference(WIKI_NAME, \"ExtensionCode\", \"ExtensionSheet\");\n+\n+    private static final DocumentReference EXTENSION_CLASS =\n+        new DocumentReference(WIKI_NAME, \"ExtensionCode\", \"ExtensionClass\");\n+\n+    private static final DocumentReference EXTENSION_DEPENDENCY_CLASS =\n+        new DocumentReference(WIKI_NAME, \"ExtensionCode\", \"ExtensionDependencyClass\");\n+\n+    private static final DocumentReference EXTENSION_VERSION_CLASS =\n+        new DocumentReference(WIKI_NAME, \"ExtensionCode\", \"ExtensionVersionClass\");\n+\n+    private static final DocumentReference EXTENSION_AUTHORS_DISPLAYER =\n+        new DocumentReference(WIKI_NAME, \"ExtensionCode\", \"ExtensionAuthorsDisplayer\");\n+\n+    private static final DocumentReference TEST_PAGE =\n+        new DocumentReference(WIKI_NAME, \"Test\", \"TestDocument\");\n+\n+    private XWikiDocument testPageDocument;\n+\n+    private XWikiDocument extensionSheetDocument;\n+\n+    @MockComponent\n+    @Named(\"groovy\")\n+    private MacroPermissionPolicy groovyMacroPermissionPolicy;\n+\n+    @BeforeEach\n+    void setUp() throws Exception\n+    {\n+        this.xwiki.initializeMandatoryDocuments(this.context);\n+        loadPage(EXTENSION_AUTHORS_DISPLAYER);\n+        loadPage(EXTENSION_DEPENDENCY_CLASS);\n+        loadPage(EXTENSION_VERSION_CLASS);\n+        loadPage(EXTENSION_CLASS);\n+        loadPage(EXTENSION_SHEET);\n+\n+        String testString = \"]]}}}{{async}}{{velocity}}{{noscript /}}{{/velocity}}{{/async}}\";\n+        String groovyTestString = \"\"\"\n+                {{async}}\n+                {{groovy}}\n+                services.logging.getLogger(\"Groovy\").error(\"SHOULD NOT BE CALLED!\")\n+                {{/groovy}}\n+                {{/async}}\n+            \"\"\";\n+\n+        this.extensionSheetDocument = this.xwiki.getDocument(EXTENSION_SHEET, this.context);\n+\n+        this.testPageDocument = this.xwiki.getDocument(TEST_PAGE, this.context);\n+        this.testPageDocument.setTitle(\"Extension Test\");\n+        BaseObject extensionObject =\n+            this.testPageDocument.newXObject(EXTENSION_CLASS, this.context);\n+        extensionObject.setStringValue(\"id\", testString);\n+        extensionObject.setStringValue(\"name\", testString);\n+        extensionObject.setStringValue(\"description\", groovyTestString);\n+        extensionObject.setStringValue(\"summary\", testString);\n+        extensionObject.setStringValue(\"icon\", testString);\n+        extensionObject.setStringValue(\"type\", testString);\n+        extensionObject.setStringValue(\"category\", testString);\n+        extensionObject.setStringValue(\"installedCount\", testString);\n+        extensionObject.setStringValue(\"licenseName\", testString);\n+        extensionObject.setStringValue(\"issueManagementURL\", testString);\n+        extensionObject.setStringValue(\"installation\", groovyTestString);\n+        extensionObject.setStringValue(\"lastVersion\", testString);\n+        extensionObject.setStringListValue(\"authors\", List.of(testString));\n+\n+        BaseObject extensionVersionObject = this.testPageDocument.newXObject(EXTENSION_VERSION_CLASS, this.context);\n+        extensionVersionObject.setStringValue(\"version\", testString);\n+        extensionVersionObject.setStringValue(\"notes\", groovyTestString);\n+\n+        BaseObject extensionDependencyObject =\n+            this.testPageDocument.newXObject(EXTENSION_DEPENDENCY_CLASS, this.context);\n+        extensionDependencyObject.setStringValue(\"extensionVersion\", testString);\n+        extensionDependencyObject.setStringValue(\"id\", testString);\n+        extensionDependencyObject.setStringValue(\"constraint\", testString);\n+\n+        // Mock the database.\n+        Query query = mock(Query.class);\n+        QueryManagerScriptService queryManagerScriptService =\n+            this.componentManager.registerMockComponent(ScriptService.class, \"query\", QueryManagerScriptService.class,\n+                false);\n+        when(queryManagerScriptService.xwql(any())).thenReturn(query);\n+        when(query.bindValue(any(), any())).thenReturn(query);\n+        when(query.execute()).thenReturn(List.of());\n+\n+        // Mock restricted contexts.\n+        when(this.groovyMacroPermissionPolicy.hasPermission(any(), any())).thenAnswer(i ->\n+            !((MacroTransformationContext) i.getArgument(1)).getTransformationContext().isRestricted());\n+    }\n+\n+    @Test\n+    void display() throws Exception\n+    {\n+        this.context.setDoc(this.testPageDocument);\n+        // The only expectation is to not get any error log due to macro executions.\n+        renderHTMLPage(this.extensionSheetDocument);\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ltdrdata/ComfyUI-Impact-Pack/commits/a43dae373e648ae0f0cc0c9768c3cea6a72acff7",
        "url": "https://api.github.com/repos/ltdrdata/ComfyUI-Impact-Pack/commits/a43dae373e648ae0f0cc0c9768c3cea6a72acff7",
        "html_url": "https://github.com/ltdrdata/ComfyUI-Impact-Pack/commit/a43dae373e648ae0f0cc0c9768c3cea6a72acff7",
        "message": "remove useless code",
        "files": [
            {
                "sha": "f1f2ba9f9f3059d69e01e2c7256750f084b39723",
                "filename": "modules/impact/config.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/ltdrdata/ComfyUI-Impact-Pack/blob/a43dae373e648ae0f0cc0c9768c3cea6a72acff7/modules%2Fimpact%2Fconfig.py",
                "raw_url": "https://github.com/ltdrdata/ComfyUI-Impact-Pack/raw/a43dae373e648ae0f0cc0c9768c3cea6a72acff7/modules%2Fimpact%2Fconfig.py",
                "contents_url": "https://api.github.com/repos/ltdrdata/ComfyUI-Impact-Pack/contents/modules%2Fimpact%2Fconfig.py?ref=a43dae373e648ae0f0cc0c9768c3cea6a72acff7",
                "patch": "@@ -1,7 +1,7 @@\n import configparser\n import os\n \n-version_code = [7, 6, 1]\n+version_code = [7, 6, 2]\n version = f\"V{version_code[0]}.{version_code[1]}\" + (f'.{version_code[2]}' if len(version_code) > 2 else '')\n \n dependency_version = 22"
            },
            {
                "sha": "7da33f1cf7f9e6127e3340435b01aee1434cfe73",
                "filename": "modules/impact/impact_server.py",
                "status": "modified",
                "additions": 0,
                "deletions": 31,
                "changes": 31,
                "blob_url": "https://github.com/ltdrdata/ComfyUI-Impact-Pack/blob/a43dae373e648ae0f0cc0c9768c3cea6a72acff7/modules%2Fimpact%2Fimpact_server.py",
                "raw_url": "https://github.com/ltdrdata/ComfyUI-Impact-Pack/raw/a43dae373e648ae0f0cc0c9768c3cea6a72acff7/modules%2Fimpact%2Fimpact_server.py",
                "contents_url": "https://api.github.com/repos/ltdrdata/ComfyUI-Impact-Pack/contents/modules%2Fimpact%2Fimpact_server.py?ref=a43dae373e648ae0f0cc0c9768c3cea6a72acff7",
                "patch": "@@ -24,37 +24,6 @@\n from server import PromptServer\n \n \n-@PromptServer.instance.routes.post(\"/upload/temp\")\n-async def upload_image(request):\n-    upload_dir = folder_paths.get_temp_directory()\n-\n-    if not os.path.exists(upload_dir):\n-        os.makedirs(upload_dir)\n-    \n-    post = await request.post()\n-    image = post.get(\"image\")\n-\n-    if image and image.file:\n-        filename = image.filename\n-        if not filename:\n-            return web.Response(status=400)\n-\n-        split = os.path.splitext(filename)\n-        i = 1\n-        while os.path.exists(os.path.join(upload_dir, filename)):\n-            filename = f\"{split[0]} ({i}){split[1]}\"\n-            i += 1\n-\n-        filepath = os.path.join(upload_dir, filename)\n-\n-        with open(filepath, \"wb\") as f:\n-            f.write(image.file.read())\n-        \n-        return web.json_response({\"name\": filename})\n-    else:\n-        return web.Response(status=400)\n-\n-\n sam_predictor = None\n default_sam_model_name = os.path.join(impact_pack.model_path, \"sams\", \"sam_vit_b_01ec64.pth\")\n "
            },
            {
                "sha": "43bc52e9f750453e5b51f3fc61c0da90b150a93c",
                "filename": "pyproject.toml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/ltdrdata/ComfyUI-Impact-Pack/blob/a43dae373e648ae0f0cc0c9768c3cea6a72acff7/pyproject.toml",
                "raw_url": "https://github.com/ltdrdata/ComfyUI-Impact-Pack/raw/a43dae373e648ae0f0cc0c9768c3cea6a72acff7/pyproject.toml",
                "contents_url": "https://api.github.com/repos/ltdrdata/ComfyUI-Impact-Pack/contents/pyproject.toml?ref=a43dae373e648ae0f0cc0c9768c3cea6a72acff7",
                "patch": "@@ -1,7 +1,7 @@\n [project]\n name = \"comfyui-impact-pack\"\n description = \"This extension offers various detector nodes and detailer nodes that allow you to configure a workflow that automatically enhances facial details. And provide iterative upscaler.\"\n-version = \"7.6.1\"\n+version = \"7.6.2\"\n license = { file = \"LICENSE.txt\" }\n dependencies = [\"segment-anything\", \"scikit-image\", \"piexif\", \"transformers\", \"opencv-python-headless\", \"GitPython\", \"scipy>=1.11.4\"]\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cert-manager/cert-manager/commits/3a4c9eb55e2e43570679840bbe3217869fbc8efc",
        "url": "https://api.github.com/repos/cert-manager/cert-manager/commits/3a4c9eb55e2e43570679840bbe3217869fbc8efc",
        "html_url": "https://github.com/cert-manager/cert-manager/commit/3a4c9eb55e2e43570679840bbe3217869fbc8efc",
        "message": "security: Add functions to limit max PEM sizes allowable\n\nIncludes a lot of comments explaining how the maxima were calculated.\nThis is _very_ conservative, and assumes we're dealing with RSA keys\ntwice the size of what we actually allow as a maximum.\n\nFrom running the included benchmark it seems the pathological runtime is\nabout 13617196ns (13ms) on an M2 Max which seems acceptable.\n\nSigned-off-by: Ashley Davis <ashley.davis@venafi.com>",
        "files": [
            {
                "sha": "cf0b87e06821e422a3c444e43e29c5ad5fe0beb3",
                "filename": "internal/pem/decode.go",
                "status": "added",
                "additions": 124,
                "deletions": 0,
                "changes": 124,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/3a4c9eb55e2e43570679840bbe3217869fbc8efc/internal%2Fpem%2Fdecode.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/3a4c9eb55e2e43570679840bbe3217869fbc8efc/internal%2Fpem%2Fdecode.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/internal%2Fpem%2Fdecode.go?ref=3a4c9eb55e2e43570679840bbe3217869fbc8efc",
                "patch": "@@ -0,0 +1,124 @@\n+/*\n+Copyright 2024 The cert-manager Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+*/\n+\n+// Package pem provides utility functions for safely decoding PEM data, placing upper limits on the size\n+// of data that will be processed. It functions as an extension to the standard library \"encoding/pem\" functions.\n+package pem\n+\n+import (\n+\tstdpem \"encoding/pem\"\n+\t\"errors\"\n+\t\"fmt\"\n+)\n+\n+// The constants below are estimates at reasonable upper bounds for sizes of PEM data that cert-manager might encounter.\n+// cert-manager supports RSA, ECDSA and Ed25519 keys, of which RSA keys are by far the largest.\n+\n+// We'll aim to support RSA certs / keys which are larger than the maximum size (defined in pkg/util/pki.MaxRSAKeySize).\n+\n+// RSA keys grow proportional to the size of the RSA key used. For example:\n+// PEM-encoded RSA Keys: 4096-bit is ~3kB, 8192-bit is ~6kB and a 16k-bit key is ~12kB.\n+\n+// Certificates have two variables; the public key of the cert, and the signature from the signing cert.\n+// An N-bit key produces an N-byte signature, so as a worst case for us, a 16kB RSA key will create a 2kB signature.\n+\n+// PEM-encoded RSA X.509 certificates:\n+// Signed with  1k-bit RSA key: 4096-bit is ~1.4kB, 8192-bit is ~2kB, 16k-bit is ~3.5kB\n+// Signed with 16k-bit RSA key: 4096-bit is ~3.3kB, 8192-bit is ~4kB, 16k-bit is ~5.4kB\n+\n+// See https://fm4dd.com/openssl/certexamples.shtm for examples of large RSA certs / keys\n+\n+const (\n+\t// maxCertificatePEMSize is the maximum size, in bytes, of a single PEM-encoded X.509 certificate which SafeDecodeSingleCertificate will accept.\n+\t// The value is based on how large a \"realistic\" (but still very large) self-signed 16k-bit RSA certficate might be.\n+\t// 16k-bit RSA keys are impractical on most on modern hardware due to how slow they can be,\n+\t// so we can reasonably assume that no real-world PEM-encoded X.509 cert will be this large.\n+\t// Note that X.509 certificates can contain extra abitrary data (e.g. DNS names, policy names, etc) whose size is hard to predict.\n+\t// So we guess at how much of that data we'll allow in very large certs and allow about 1kB of such data.\n+\tmaxCertificatePEMSize = 6500\n+\n+\t// maxPrivateKeyPEMSize is the maximum size, in bytes, of PEM-encoded private keys which SafeDecodePrivateKey will accept.\n+\t// cert-manager supports RSA, ECDSA and Ed25519 keys, of which RSA is by far the largest.\n+\t// The value is based on how large a \"realistic\" (but very large) 16k-bit RSA private key might be.\n+\t// Given that 16k-bit RSA keys are so slow to use as to be impractical on modern hardware,\n+\t// we can reasonably assume that no real-world PEM-encoded key will be this large.\n+\tmaxPrivateKeyPEMSize = 13000\n+\n+\t// maxChainSize is the maximum number of 16k-bit RSA certificates signed by 16k-bit RSA CAs we'll allow in a given call to SafeDecodeMultipleCertificates.\n+\t// This is _not_ the maximum number of certificates cert-manager will process in a given chain, which could be much larger.\n+\t// This is simply the maximum number of worst-case certificates we'll accept in a chain.\n+\tmaxChainSize = 10\n+)\n+\n+var (\n+\t// ErrNoPEMData is returned when the given data contained no PEM\n+\tErrNoPEMData = errors.New(\"no PEM data was found in given input\")\n+)\n+\n+// ErrPEMDataTooLarge is returned when the given data is larger than the maximum allowed\n+type ErrPEMDataTooLarge int\n+\n+// Error returns an error string\n+func (e ErrPEMDataTooLarge) Error() string {\n+\treturn fmt.Sprintf(\"provided PEM data was larger than the maximum %dB\", int(e))\n+}\n+\n+func safeDecodeInternal(b []byte, maxSize int) (*stdpem.Block, []byte, error) {\n+\tif len(b) > maxSize {\n+\t\treturn nil, b, ErrPEMDataTooLarge(maxSize)\n+\t}\n+\n+\tblock, rest := stdpem.Decode(b)\n+\tif block == nil {\n+\t\treturn nil, rest, ErrNoPEMData\n+\t}\n+\n+\treturn block, rest, nil\n+}\n+\n+// SafeDecodePrivateKey calls [encoding/pem.Decode] on the given input as long as it's within a sensible range for\n+// how large we expect a private key to be. The baseline is a 16k-bit RSA private key, which is larger than the maximum\n+// supported by cert-manager for key generation.\n+func SafeDecodePrivateKey(b []byte) (*stdpem.Block, []byte, error) {\n+\treturn safeDecodeInternal(b, maxPrivateKeyPEMSize)\n+}\n+\n+// SafeDecodeCSR calls [encoding/pem.Decode] on the given input as long as it's within a sensible range for\n+// how large we expect a single PEM-encoded PKCS#10 CSR to be.\n+// We assume that a PKCS#12 CSR is smaller than a single certificate because our assumptions are that\n+// a certificate has a large public key and a large signature, which is roughly the case for a CSR.\n+// We also assume that we'd only ever decode one CSR which is the case in practice.\n+func SafeDecodeCSR(b []byte) (*stdpem.Block, []byte, error) {\n+\treturn safeDecodeInternal(b, maxCertificatePEMSize)\n+}\n+\n+// SafeDecodeSingleCertificate calls [encoding/pem.Decode] on the given input as long as it's within a sensible range for\n+// how large we expect a single PEM-encoded X.509 certificate to be.\n+// The baseline is a 16k-bit RSA certificate signed by a different 16k-bit RSA CA, which is larger than the maximum\n+// supported by cert-manager for key generation.\n+func SafeDecodeSingleCertificate(b []byte) (*stdpem.Block, []byte, error) {\n+\treturn safeDecodeInternal(b, maxCertificatePEMSize)\n+}\n+\n+// SafeDecodeMultipleCertificates calls [encoding/pem.Decode] on the given input as long as it's within a sensible range for\n+// how large we expect a reasonable-length PEM-encoded X.509 certificate chain to be.\n+// The baseline is several 16k-bit RSA certificates, all signed by 16k-bit RSA keys, which is larger than the maximum\n+// supported by cert-manager for key generation.\n+// The maximum number of chains supported by this function is not reflective of the maximum chain length supported by\n+// cert-manager; a larger chain of smaller certificate should be supported.\n+func SafeDecodeMultipleCertificates(b []byte) (*stdpem.Block, []byte, error) {\n+\treturn safeDecodeInternal(b, maxCertificatePEMSize*maxChainSize)\n+}"
            },
            {
                "sha": "099dacf233dbcf37be67ddcb29b9d8b59a7fbee6",
                "filename": "internal/pem/decode_test.go",
                "status": "added",
                "additions": 160,
                "deletions": 0,
                "changes": 160,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/3a4c9eb55e2e43570679840bbe3217869fbc8efc/internal%2Fpem%2Fdecode_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/3a4c9eb55e2e43570679840bbe3217869fbc8efc/internal%2Fpem%2Fdecode_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/internal%2Fpem%2Fdecode_test.go?ref=3a4c9eb55e2e43570679840bbe3217869fbc8efc",
                "patch": "@@ -0,0 +1,160 @@\n+/*\n+Copyright 2024 The cert-manager Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+*/\n+\n+package pem\n+\n+import (\n+\tstdpem \"encoding/pem\"\n+\t\"fmt\"\n+\t\"os\"\n+\t\"slices\"\n+\t\"testing\"\n+\t\"time\"\n+)\n+\n+// fuzzFile is a fuzz-test-generated file which causes significant slowdown when passed to\n+// the standard library pem.Decode function. It's used as a test case to ensure that our\n+// safe PEM decoding functions reject it.\n+var fuzzFile []byte\n+\n+// pathologicalFuzzFile is a copy of fuzzFile trimmed to fit inside our max allowable size\n+var pathologicalFuzzFile []byte\n+\n+func init() {\n+\tfuzzFilename := \"./testdata/issue-ghsa-r4pg-vg54-wxx4.bin\"\n+\n+\tvar err error\n+\tfuzzFile, err = os.ReadFile(fuzzFilename)\n+\tif err != nil {\n+\t\tpanic(fmt.Errorf(\"failed to read fuzz file %q: %s\", fuzzFilename, err))\n+\t}\n+\n+\tmaxChainSize := maxCertificatePEMSize * maxChainSize\n+\n+\t// Assert that SafeDecodeMultipleCertificates has the largest max size so we're definitely\n+\t// testing the worst case with pathologicalFuzzFile\n+\tif maxChainSize < maxPrivateKeyPEMSize {\n+\t\tpanic(fmt.Errorf(\"invalid test: expected max cert chain size %d to be larger than maxPrivateKeyPEMSize %d\", maxChainSize, maxPrivateKeyPEMSize))\n+\t}\n+\n+\tpathologicalFuzzFile = fuzzFile[:maxChainSize-1]\n+}\n+\n+func TestFuzzData(t *testing.T) {\n+\t// The fuzz test data should be rejected by all Safe* functions\n+\n+\t// Ensure fuzz test data is larger than the max we allow\n+\tif len(fuzzFile) < maxCertificatePEMSize*maxChainSize {\n+\t\tt.Fatalf(\"invalid test; fuzz file data is smaller than the maximum allowed input\")\n+\t}\n+\n+\tvar block *stdpem.Block\n+\tvar rest []byte\n+\tvar err error\n+\n+\texpPrivateKeyError := ErrPEMDataTooLarge(maxPrivateKeyPEMSize)\n+\texpCSRError := ErrPEMDataTooLarge(maxCertificatePEMSize)\n+\texpSingleCertError := ErrPEMDataTooLarge(maxCertificatePEMSize)\n+\texpMultiCertError := ErrPEMDataTooLarge(maxCertificatePEMSize * maxChainSize)\n+\n+\tblock, rest, err = SafeDecodePrivateKey(fuzzFile)\n+\tif err != expPrivateKeyError {\n+\t\tt.Errorf(\"SafeDecodePrivateKey: wanted %s but got %v\", expPrivateKeyError, err)\n+\t}\n+\n+\tif block != nil {\n+\t\tt.Errorf(\"SafeDecodePrivateKey: expected block to be nil\")\n+\t}\n+\n+\tif !slices.Equal(rest, fuzzFile) {\n+\t\tt.Errorf(\"SafeDecodePrivateKey: expected rest to equal input\")\n+\t}\n+\n+\tblock, rest, err = SafeDecodeCSR(fuzzFile)\n+\tif err != expCSRError {\n+\t\tt.Errorf(\"SafeDecodeCSR: wanted %s but got %v\", expCSRError, err)\n+\t}\n+\n+\tif block != nil {\n+\t\tt.Errorf(\"SafeDecodeCSR: expected block to be nil\")\n+\t}\n+\n+\tif !slices.Equal(rest, fuzzFile) {\n+\t\tt.Errorf(\"SafeDecodeCSR: expected rest to equal input\")\n+\t}\n+\n+\tblock, rest, err = SafeDecodeSingleCertificate(fuzzFile)\n+\tif err != expSingleCertError {\n+\t\tt.Errorf(\"SafeDecodeSingleCertificate: wanted %s but got %v\", expSingleCertError, err)\n+\t}\n+\n+\tif block != nil {\n+\t\tt.Errorf(\"SafeDecodeSingleCertificate: expected block to be nil\")\n+\t}\n+\n+\tif !slices.Equal(rest, fuzzFile) {\n+\t\tt.Errorf(\"SafeDecodeSingleCertificate: expected rest to equal input\")\n+\t}\n+\n+\tblock, rest, err = SafeDecodeMultipleCertificates(fuzzFile)\n+\tif err != expMultiCertError {\n+\t\tt.Errorf(\"SafeDecodeMultipleCertificates: wanted %s but got %v\", expMultiCertError, err)\n+\t}\n+\n+\tif block != nil {\n+\t\tt.Errorf(\"SafeDecodeSingleCertificate: expected block to be nil\")\n+\t}\n+\n+\tif !slices.Equal(rest, fuzzFile) {\n+\t\tt.Errorf(\"SafeDecodeMultipleCertificates: expected rest to equal input\")\n+\t}\n+}\n+\n+func testPathologicalInternal(t testing.TB) {\n+\tblock, rest, err := SafeDecodeMultipleCertificates(pathologicalFuzzFile)\n+\n+\tif err != ErrNoPEMData {\n+\t\tt.Errorf(\"pathological input: expected err %s but got %v\", ErrNoPEMData, err)\n+\t}\n+\n+\tif block != nil {\n+\t\tt.Errorf(\"pathological input: expected block to be nil\")\n+\t}\n+\n+\tif !slices.Equal(rest, pathologicalFuzzFile) {\n+\t\tt.Errorf(\"pathological input: expected rest to equal input\")\n+\t}\n+}\n+\n+func TestPathologicalInput(t *testing.T) {\n+\t// This test checks the runtime of the worst case scenario, so we can check it's not unacceptably\n+\t// slow (indicating that our max sizes might be too permissive)\n+\tbeforeCall := time.Now()\n+\n+\ttestPathologicalInternal(t)\n+\n+\tafterCall := time.Now()\n+\n+\tcallDuration := afterCall.Sub(beforeCall)\n+\n+\tt.Logf(\"pathological input: took %s to execute\", callDuration)\n+}\n+\n+func BenchmarkPathologicalInput(b *testing.B) {\n+\tfor n := 0; n < b.N; n++ {\n+\t\ttestPathologicalInternal(b)\n+\t}\n+}"
            },
            {
                "sha": "f47fb26776347ccc8608d7a912c2b54f9d5aca47",
                "filename": "internal/pem/testdata/issue-ghsa-r4pg-vg54-wxx4.bin",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/3a4c9eb55e2e43570679840bbe3217869fbc8efc/internal%2Fpem%2Ftestdata%2Fissue-ghsa-r4pg-vg54-wxx4.bin",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/3a4c9eb55e2e43570679840bbe3217869fbc8efc/internal%2Fpem%2Ftestdata%2Fissue-ghsa-r4pg-vg54-wxx4.bin",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/internal%2Fpem%2Ftestdata%2Fissue-ghsa-r4pg-vg54-wxx4.bin?ref=3a4c9eb55e2e43570679840bbe3217869fbc8efc"
            },
            {
                "sha": "d615c6120a4fde62973de37aec0be18dffba5a7a",
                "filename": "pkg/util/pki/generate_keysize_test.go",
                "status": "added",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/3a4c9eb55e2e43570679840bbe3217869fbc8efc/pkg%2Futil%2Fpki%2Fgenerate_keysize_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/3a4c9eb55e2e43570679840bbe3217869fbc8efc/pkg%2Futil%2Fpki%2Fgenerate_keysize_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Futil%2Fpki%2Fgenerate_keysize_test.go?ref=3a4c9eb55e2e43570679840bbe3217869fbc8efc",
                "patch": "@@ -0,0 +1,27 @@\n+/*\n+Copyright 2024 The cert-manager Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+*/\n+\n+package pki\n+\n+import \"testing\"\n+\n+func TestMaxRSAKeySizeSanity(t *testing.T) {\n+\t// This test ensures that if we bump our max RSA key size in the future, someone will come and\n+\t// re-check our assumptions about max PEM sizes.\n+\tif MaxRSAKeySize > 8192 {\n+\t\tt.Fatalf(\"MaxRSAKeySize has been increased which may invalidate the assumptions for safe PEM decoding in internal/pem/*.go\\nCheck the max sizes and change this test once complete!\")\n+\t}\n+}"
            },
            {
                "sha": "fd84563276f500726a1f0d56d46eff42ab79418e",
                "filename": "pkg/util/pki/parse.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/3a4c9eb55e2e43570679840bbe3217869fbc8efc/pkg%2Futil%2Fpki%2Fparse.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/3a4c9eb55e2e43570679840bbe3217869fbc8efc/pkg%2Futil%2Fpki%2Fparse.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Futil%2Fpki%2Fparse.go?ref=3a4c9eb55e2e43570679840bbe3217869fbc8efc",
                "patch": "@@ -25,7 +25,7 @@ import (\n )\n \n // DecodePrivateKeyBytes will decode a PEM encoded private key into a crypto.Signer.\n-// It supports ECDSA and RSA private keys only. All other types will return err.\n+// It supports ECDSA, RSA and EdDSA private keys only. All other types will return err.\n func DecodePrivateKeyBytes(keyBytes []byte) (crypto.Signer, error) {\n \t// decode the private key pem\n \tblock, _ := pem.Decode(keyBytes)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cert-manager/cert-manager/commits/f22f78c8c0a64d718e203b326bc844c488ad7850",
        "url": "https://api.github.com/repos/cert-manager/cert-manager/commits/f22f78c8c0a64d718e203b326bc844c488ad7850",
        "html_url": "https://github.com/cert-manager/cert-manager/commit/f22f78c8c0a64d718e203b326bc844c488ad7850",
        "message": "security: remove calls to pem.Decode in non-test code\n\nSigned-off-by: Ashley Davis <ashley.davis@venafi.com>",
        "files": [
            {
                "sha": "1294bbb57bd82f8d873b342486da9fd6ce4ce04d",
                "filename": "internal/controller/certificates/policies/checks_test.go",
                "status": "modified",
                "additions": 6,
                "deletions": 2,
                "changes": 8,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/internal%2Fcontroller%2Fcertificates%2Fpolicies%2Fchecks_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/internal%2Fcontroller%2Fcertificates%2Fpolicies%2Fchecks_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/internal%2Fcontroller%2Fcertificates%2Fpolicies%2Fchecks_test.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -17,7 +17,6 @@ limitations under the License.\n package policies\n \n import (\n-\t\"encoding/pem\"\n \t\"testing\"\n \t\"time\"\n \n@@ -28,6 +27,7 @@ import (\n \tfakeclock \"k8s.io/utils/clock/testing\"\n \t\"k8s.io/utils/ptr\"\n \n+\t\"github.com/cert-manager/cert-manager/internal/pem\"\n \tcmapi \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n \tcmmeta \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n \t\"github.com/cert-manager/cert-manager/pkg/util/pki\"\n@@ -1125,7 +1125,11 @@ func Test_SecretSecretTemplateManagedFieldsMismatch(t *testing.T) {\n func Test_SecretAdditionalOutputFormatsMismatch(t *testing.T) {\n \tcert := []byte(\"a\")\n \tpk := testcrypto.MustCreatePEMPrivateKey(t)\n-\tblock, _ := pem.Decode(pk)\n+\tblock, _, err := pem.SafeDecodePrivateKey(pk)\n+\tif err != nil {\n+\t\tt.Fatalf(\"got unexpected error decoding PEM: %s\", err)\n+\t}\n+\n \tpkDER := block.Bytes\n \tcombinedPEM := append(append(pk, '\\n'), cert...)\n "
            },
            {
                "sha": "18bb769482c8cdc92f222df82e117a6b06b712f8",
                "filename": "internal/controller/certificates/secrets.go",
                "status": "modified",
                "additions": 8,
                "deletions": 2,
                "changes": 10,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/internal%2Fcontroller%2Fcertificates%2Fsecrets.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/internal%2Fcontroller%2Fcertificates%2Fsecrets.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/internal%2Fcontroller%2Fcertificates%2Fsecrets.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -19,8 +19,8 @@ package certificates\n import (\n \t\"bytes\"\n \t\"crypto/x509\"\n-\t\"encoding/pem\"\n \n+\t\"github.com/cert-manager/cert-manager/internal/pem\"\n \tcmapi \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n \tcmutil \"github.com/cert-manager/cert-manager/pkg/util\"\n \tutilpki \"github.com/cert-manager/cert-manager/pkg/util/pki\"\n@@ -86,7 +86,13 @@ func AnnotationsForCertificate(certificate *x509.Certificate) (map[string]string\n // OutputFormatDER returns the byte slice of the private key in DER format. To\n // be used for Certificate's Additional Output Format DER.\n func OutputFormatDER(privateKey []byte) []byte {\n-\tblock, _ := pem.Decode(privateKey)\n+\t// NOTE: This call to pem.SafeDecodePrivateKey ignores errors.\n+\t// This is acceptable here since we're calling this function only on PEM data which we created\n+\t// by encoding the private key. As such, we can be fairly confident that:\n+\t// 1) The PEM is valid\n+\t// 2) The PEM isn't attacker-controlled (and as such unsafe to decode)\n+\n+\tblock, _, _ := pem.SafeDecodePrivateKey(privateKey)\n \treturn block.Bytes\n }\n "
            },
            {
                "sha": "2af09daa9484072a53b0855f366b573f571836cc",
                "filename": "pkg/controller/acmeorders/sync.go",
                "status": "modified",
                "additions": 10,
                "deletions": 5,
                "changes": 15,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Fcontroller%2Facmeorders%2Fsync.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Fcontroller%2Facmeorders%2Fsync.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Fcontroller%2Facmeorders%2Fsync.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -37,6 +37,7 @@ import (\n \n \t\"github.com/cert-manager/cert-manager/internal/controller/feature\"\n \tinternalorders \"github.com/cert-manager/cert-manager/internal/controller/orders\"\n+\tsafepem \"github.com/cert-manager/cert-manager/internal/pem\"\n \t\"github.com/cert-manager/cert-manager/pkg/acme\"\n \tacmecl \"github.com/cert-manager/cert-manager/pkg/acme/client\"\n \tcmacme \"github.com/cert-manager/cert-manager/pkg/apis/acme/v1\"\n@@ -511,13 +512,17 @@ func (c *controller) finalizeOrder(ctx context.Context, cl acmecl.Interface, o *\n \t// only supported DER encoded CSRs and not PEM encoded as they are intended\n \t// to be as part of our API.\n \t// To work around this, we first attempt to decode the Request into DER bytes\n-\t// by running pem.Decode. If the PEM block is empty, we assume that the Request\n+\t// by running pem.SafeDecodeCSR. If the PEM block is empty, we assume that the Request\n \t// is DER encoded and continue to call FinalizeOrder.\n \tvar derBytes []byte\n-\tblock, _ := pem.Decode(o.Spec.Request)\n-\tif block == nil {\n-\t\tlog.V(logf.WarnLevel).Info(\"failed to parse Request as PEM data, attempting to treat Request as DER encoded for compatibility reasons\")\n-\t\tderBytes = o.Spec.Request\n+\tblock, _, err := safepem.SafeDecodeCSR(o.Spec.Request)\n+\tif err != nil {\n+\t\tif err == safepem.ErrNoPEMData {\n+\t\t\tlog.V(logf.WarnLevel).Info(\"failed to parse Request as PEM data, attempting to treat Request as DER encoded for compatibility reasons\")\n+\t\t\tderBytes = o.Spec.Request\n+\t\t} else {\n+\t\t\treturn err\n+\t\t}\n \t} else {\n \t\tderBytes = block.Bytes\n \t}"
            },
            {
                "sha": "88e930b26962b8e45ac51beac20f35b3e23afe7f",
                "filename": "pkg/controller/acmeorders/sync_test.go",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Fcontroller%2Facmeorders%2Fsync_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Fcontroller%2Facmeorders%2Fsync_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Fcontroller%2Facmeorders%2Fsync_test.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -18,7 +18,6 @@ package acmeorders\n \n import (\n \t\"context\"\n-\t\"encoding/pem\"\n \t\"errors\"\n \t\"fmt\"\n \t\"testing\"\n@@ -31,6 +30,7 @@ import (\n \tcoretesting \"k8s.io/client-go/testing\"\n \tfakeclock \"k8s.io/utils/clock/testing\"\n \n+\t\"github.com/cert-manager/cert-manager/internal/pem\"\n \taccountstest \"github.com/cert-manager/cert-manager/pkg/acme/accounts/test\"\n \tacmecl \"github.com/cert-manager/cert-manager/pkg/acme/client\"\n \tcmacme \"github.com/cert-manager/cert-manager/pkg/apis/acme/v1\"\n@@ -244,10 +244,11 @@ Dfvp7OOGAN6dEOM4+qR9sdjoSYKEBpsr6GtPAQw4dy753ec5\n \tdecodeAll := func(pemBytes []byte) [][]byte {\n \t\tvar blocks [][]byte\n \t\tfor {\n-\t\t\tblock, rest := pem.Decode(pemBytes)\n+\t\t\tblock, rest, _ := pem.SafeDecodeMultipleCertificates(pemBytes)\n \t\t\tif block == nil {\n \t\t\t\tbreak\n \t\t\t}\n+\n \t\t\tblocks = append(blocks, block.Bytes)\n \t\t\tpemBytes = rest\n \t\t}"
            },
            {
                "sha": "de266772fc5b248beb2581467aec4405be2c078b",
                "filename": "pkg/controller/certificates/issuing/internal/secret_test.go",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Fcontroller%2Fcertificates%2Fissuing%2Finternal%2Fsecret_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Fcontroller%2Fcertificates%2Fissuing%2Finternal%2Fsecret_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Fcontroller%2Fcertificates%2Fissuing%2Finternal%2Fsecret_test.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -18,7 +18,6 @@ package internal\n \n import (\n \t\"context\"\n-\t\"encoding/pem\"\n \t\"errors\"\n \t\"strings\"\n \t\"testing\"\n@@ -34,6 +33,7 @@ import (\n \tfakeclock \"k8s.io/utils/clock/testing\"\n \t\"k8s.io/utils/ptr\"\n \n+\t\"github.com/cert-manager/cert-manager/internal/pem\"\n \tcmapi \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n \tcmmeta \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n \tcontrollerpkg \"github.com/cert-manager/cert-manager/pkg/controller\"\n@@ -87,7 +87,7 @@ func Test_SecretsManager(t *testing.T) {\n \t\t\tcmapi.CertificateAdditionalOutputFormat{Type: \"CombinedPEM\"},\n \t\t),\n \t)\n-\tblock, _ := pem.Decode(baseCertBundle.PrivateKeyBytes)\n+\tblock, _, _ := pem.SafeDecodePrivateKey(baseCertBundle.PrivateKeyBytes)\n \ttlsDerContent := block.Bytes\n \n \ttests := map[string]struct {"
            },
            {
                "sha": "5f9f5422bdfc444706cbc9cac9f5ecb951c21ef4",
                "filename": "pkg/controller/certificates/issuing/secret_manager_test.go",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Fcontroller%2Fcertificates%2Fissuing%2Fsecret_manager_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Fcontroller%2Fcertificates%2Fissuing%2Fsecret_manager_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Fcontroller%2Fcertificates%2Fissuing%2Fsecret_manager_test.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -18,7 +18,6 @@ package issuing\n \n import (\n \t\"context\"\n-\t\"encoding/pem\"\n \t\"testing\"\n \n \t\"github.com/stretchr/testify/assert\"\n@@ -28,6 +27,7 @@ import (\n \t\"k8s.io/utils/ptr\"\n \n \t\"github.com/cert-manager/cert-manager/internal/controller/certificates/policies\"\n+\t\"github.com/cert-manager/cert-manager/internal/pem\"\n \tcmapi \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n \tcmmeta \"github.com/cert-manager/cert-manager/pkg/apis/meta/v1\"\n \t\"github.com/cert-manager/cert-manager/pkg/controller/certificates/issuing/internal\"\n@@ -40,7 +40,9 @@ func Test_ensureSecretData(t *testing.T) {\n \n \tpk := testcrypto.MustCreatePEMPrivateKey(t)\n \tcert := testcrypto.MustCreateCert(t, pk, &cmapi.Certificate{Spec: cmapi.CertificateSpec{CommonName: \"test\"}})\n-\tblock, _ := pem.Decode(pk)\n+\n+\tblock, _, _ := pem.SafeDecodePrivateKey(pk)\n+\n \tpkDER := block.Bytes\n \tcombinedPEM := append(append(pk, '\\n'), cert...)\n "
            },
            {
                "sha": "697151b491f93738ab36a2c5017a4cc450be70fc",
                "filename": "pkg/util/pki/generate_test.go",
                "status": "modified",
                "additions": 11,
                "deletions": 3,
                "changes": 14,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fgenerate_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fgenerate_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Futil%2Fpki%2Fgenerate_test.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -25,12 +25,12 @@ import (\n \t\"crypto/rsa\"\n \t\"crypto/x509\"\n \t\"crypto/x509/pkix\"\n-\t\"encoding/pem\"\n \t\"fmt\"\n \t\"strings\"\n \t\"testing\"\n \t\"time\"\n \n+\t\"github.com/cert-manager/cert-manager/internal/pem\"\n \tv1 \"github.com/cert-manager/cert-manager/pkg/apis/certmanager/v1\"\n )\n \n@@ -423,11 +423,16 @@ O7WnDn8nuLFdW+NzzbIrTw==\n \n \ttestFn := func(test testT) func(*testing.T) {\n \t\treturn func(t *testing.T) {\n-\t\t\tblock, _ := pem.Decode(privateKeyBytes)\n+\t\t\tblock, _, err := pem.SafeDecodePrivateKey(privateKeyBytes)\n+\t\t\tif err != nil {\n+\t\t\t\tt.Fatalf(\"expected no PEM decode err but got %s\", err)\n+\t\t\t}\n+\n \t\t\tdecodedKey, err := x509.ParsePKCS8PrivateKey(block.Bytes)\n \t\t\tif err != nil {\n \t\t\t\tt.Fatal(err)\n \t\t\t}\n+\n \t\t\tencodedKey, err := EncodePrivateKey(decodedKey, test.keyEncoding)\n \t\t\tif test.expectErr {\n \t\t\t\tif err == nil {\n@@ -449,7 +454,10 @@ O7WnDn8nuLFdW+NzzbIrTw==\n \n \t\t\t\texpectedEncoding := test.keyEncoding\n \t\t\t\tactualEncoding := v1.PrivateKeyEncoding(\"\")\n-\t\t\t\tblock, _ := pem.Decode(encodedKey)\n+\t\t\t\tblock, _, err := pem.SafeDecodePrivateKey(encodedKey)\n+\t\t\t\tif err != nil {\n+\t\t\t\t\tt.Fatalf(\"expected no PEM decode err but got %s\", err)\n+\t\t\t\t}\n \n \t\t\t\tswitch block.Type {\n \t\t\t\tcase \"PRIVATE KEY\":"
            },
            {
                "sha": "e7e15679937a9469f576bf80882c56419b055bd3",
                "filename": "pkg/util/pki/nameconstraints_test.go",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fnameconstraints_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fnameconstraints_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Futil%2Fpki%2Fnameconstraints_test.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -20,13 +20,14 @@ import (\n \t\"bytes\"\n \t\"crypto/x509\"\n \t\"crypto/x509/pkix\"\n-\t\"encoding/pem\"\n \t\"fmt\"\n \t\"net\"\n \t\"strings\"\n \t\"testing\"\n \n \t\"github.com/stretchr/testify/assert\"\n+\n+\t\"github.com/cert-manager/cert-manager/internal/pem\"\n )\n \n // TestMarshalNameConstraints tests the MarshalNameConstraints function\n@@ -202,7 +203,11 @@ func getExtensionFromPem(pemData string) (pkix.Extension, error) {\n \tpemData = strings.TrimSpace(pemData)\n \tcsrPEM := []byte(pemData)\n \n-\tblock, _ := pem.Decode(csrPEM)\n+\tblock, _, err := pem.SafeDecodeCSR(csrPEM)\n+\tif err != nil {\n+\t\treturn pkix.Extension{}, fmt.Errorf(\"expected no PEM decode err but got %s\", err)\n+\t}\n+\n \tif block == nil || block.Type != \"CERTIFICATE REQUEST\" {\n \t\treturn pkix.Extension{}, fmt.Errorf(\"Failed to decode PEM block or the type is not 'CERTIFICATE REQUEST'\")\n \t}"
            },
            {
                "sha": "62daf9857df38d8a279d3fea0470b6c12a157118",
                "filename": "pkg/util/pki/parse.go",
                "status": "modified",
                "additions": 16,
                "deletions": 9,
                "changes": 25,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fparse.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fparse.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Futil%2Fpki%2Fparse.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -19,17 +19,18 @@ package pki\n import (\n \t\"crypto\"\n \t\"crypto/x509\"\n-\t\"encoding/pem\"\n+\tstdpem \"encoding/pem\"\n \n+\t\"github.com/cert-manager/cert-manager/internal/pem\"\n \t\"github.com/cert-manager/cert-manager/pkg/util/errors\"\n )\n \n // DecodePrivateKeyBytes will decode a PEM encoded private key into a crypto.Signer.\n // It supports ECDSA, RSA and EdDSA private keys only. All other types will return err.\n func DecodePrivateKeyBytes(keyBytes []byte) (crypto.Signer, error) {\n \t// decode the private key pem\n-\tblock, _ := pem.Decode(keyBytes)\n-\tif block == nil {\n+\tblock, _, err := pem.SafeDecodePrivateKey(keyBytes)\n+\tif err != nil {\n \t\treturn nil, errors.NewInvalidData(\"error decoding private key PEM block\")\n \t}\n \n@@ -77,13 +78,19 @@ func DecodeX509CertificateChainBytes(certBytes []byte) ([]*x509.Certificate, err\n func DecodeX509CertificateSetBytes(certBytes []byte) ([]*x509.Certificate, error) {\n \tcerts := []*x509.Certificate{}\n \n-\tvar block *pem.Block\n+\tvar block *stdpem.Block\n \n \tfor {\n+\t\tvar err error\n+\n \t\t// decode the tls certificate pem\n-\t\tblock, certBytes = pem.Decode(certBytes)\n-\t\tif block == nil {\n-\t\t\tbreak\n+\t\tblock, certBytes, err = pem.SafeDecodeMultipleCertificates(certBytes)\n+\t\tif err != nil {\n+\t\t\tif err == pem.ErrNoPEMData {\n+\t\t\t\tbreak\n+\t\t\t}\n+\n+\t\t\treturn nil, err\n \t\t}\n \n \t\t// parse the tls certificate\n@@ -113,8 +120,8 @@ func DecodeX509CertificateBytes(certBytes []byte) (*x509.Certificate, error) {\n \n // DecodeX509CertificateRequestBytes will decode a PEM encoded x509 Certificate Request.\n func DecodeX509CertificateRequestBytes(csrBytes []byte) (*x509.CertificateRequest, error) {\n-\tblock, _ := pem.Decode(csrBytes)\n-\tif block == nil {\n+\tblock, _, err := pem.SafeDecodeCSR(csrBytes)\n+\tif err != nil {\n \t\treturn nil, errors.NewInvalidData(\"error decoding certificate request PEM block\")\n \t}\n "
            },
            {
                "sha": "aab8aec0940ca52fc23069efe9cf5facfa8f1091",
                "filename": "pkg/util/pki/parse_certificate_chain.go",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fparse_certificate_chain.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fparse_certificate_chain.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Futil%2Fpki%2Fparse_certificate_chain.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -93,8 +93,7 @@ func ParseSingleCertificateChain(certs []*x509.Certificate) (PEMBundle, error) {\n \t}\n \n \t// To prevent a malicious input from causing a DoS, we limit the number of unique\n-\t// certificates to 1000. This helps us avoid issues with O(n^2) time complexity\n-\t// in the algorithm below.\n+\t// certificates. This helps us avoid issues with O(n^2) time complexity in the algorithm below.\n \tif len(certs) > 1000 {\n \t\treturn PEMBundle{}, errors.NewInvalidData(\"certificate chain is too long, must be less than 1000 certificates\")\n \t}"
            },
            {
                "sha": "24bc6af1a1bb3c1d35c4e008eda61409bbacbcde",
                "filename": "pkg/util/pki/parse_certificate_chain_test.go",
                "status": "modified",
                "additions": 33,
                "deletions": 28,
                "changes": 61,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fparse_certificate_chain_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fparse_certificate_chain_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Futil%2Fpki%2Fparse_certificate_chain_test.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -90,7 +90,7 @@ func joinPEM(first []byte, rest ...[]byte) []byte {\n \treturn first\n }\n \n-func TestParseSingleCertificateChain(t *testing.T) {\n+func TestParseSingleCertificateChainPEM(t *testing.T) {\n \troot := mustCreateBundle(t, nil, \"root\")\n \tintA1 := mustCreateBundle(t, root, \"intA-1\")\n \tintA2 := mustCreateBundle(t, intA1, \"intA-2\")\n@@ -100,20 +100,20 @@ func TestParseSingleCertificateChain(t *testing.T) {\n \tleafInterCN := mustCreateBundle(t, intA2, intA2.cert.Subject.CommonName)\n \trandom := mustCreateBundle(t, nil, \"random\")\n \n-\tvar thousandCertBundle PEMBundle\n+\tvar bigCertBundle PEMBundle\n \t{\n \t\troot := mustCreateBundle(t, nil, \"root\")\n-\t\tthousandCertBundle.CAPEM = root.pem\n+\t\tbigCertBundle.CAPEM = root.pem\n \n \t\tcert := root\n \t\tvar pems [][]byte\n-\t\tfor i := 0; i < 999; i++ {\n+\t\tfor i := 0; i < 100; i++ {\n \t\t\tcert = mustCreateBundle(t, cert, fmt.Sprintf(\"int-%d\", i))\n \t\t\tpems = append(pems, cert.pem)\n \t\t}\n \n \t\tfor _, pem := range slices.Backward(pems) {\n-\t\t\tthousandCertBundle.ChainPEM = joinPEM(thousandCertBundle.ChainPEM, pem)\n+\t\t\tbigCertBundle.ChainPEM = joinPEM(bigCertBundle.ChainPEM, pem)\n \t\t}\n \t}\n \n@@ -212,18 +212,18 @@ func TestParseSingleCertificateChain(t *testing.T) {\n \t\t\texpPEMBundle: PEMBundle{ChainPEM: joinPEM(root.pem), CAPEM: root.pem},\n \t\t\texpErr:       false,\n \t\t},\n-\t\t\"if long chain is passed (<= 1000 certs), a result should be returned quickly\": {\n-\t\t\tinputBundle:  joinPEM(thousandCertBundle.ChainPEM, thousandCertBundle.CAPEM),\n-\t\t\texpPEMBundle: thousandCertBundle,\n+\t\t\"if acceptable long chain is passed, a result should be returned quickly\": {\n+\t\t\tinputBundle:  joinPEM(bigCertBundle.ChainPEM, bigCertBundle.CAPEM),\n+\t\t\texpPEMBundle: bigCertBundle,\n \t\t\texpErr:       false,\n \t\t},\n-\t\t\"if very long chain is passed (> 1000 certs), should error without DoS (1)\": {\n+\t\t\"if unacceptably long chain is passed, should error without DoS\": {\n \t\t\tinputBundle: func() []byte {\n \t\t\t\troot := mustCreateBundle(t, nil, \"root\")\n \n \t\t\t\tcert := root\n \t\t\t\tvar chain []byte\n-\t\t\t\tfor i := 0; i < 1001; i++ {\n+\t\t\t\tfor i := 0; i < 501; i++ {\n \t\t\t\t\tcert = mustCreateBundle(t, cert, fmt.Sprintf(\"int-%d\", i))\n \t\t\t\t\tchain = joinPEM(chain, cert.pem)\n \t\t\t\t}\n@@ -232,24 +232,7 @@ func TestParseSingleCertificateChain(t *testing.T) {\n \t\t\t}(),\n \t\t\texpPEMBundle: PEMBundle{},\n \t\t\texpErr:       true,\n-\t\t\texpErrString: \"certificate chain is too long, must be less than 1000 certificates\",\n-\t\t},\n-\t\t\"if very long chain is passed (> 1000 certs), should error without DoS (2)\": {\n-\t\t\tinputBundle: func() []byte {\n-\t\t\t\troot := mustCreateBundle(t, nil, \"root\")\n-\n-\t\t\t\tcert := root\n-\t\t\t\tvar chain []byte\n-\t\t\t\tfor i := 0; i < 10000; i++ {\n-\t\t\t\t\tcert = mustCreateBundle(t, cert, fmt.Sprintf(\"int-%d\", i))\n-\t\t\t\t\tchain = joinPEM(chain, cert.pem)\n-\t\t\t\t}\n-\n-\t\t\t\treturn chain\n-\t\t\t}(),\n-\t\t\texpPEMBundle: PEMBundle{},\n-\t\t\texpErr:       true,\n-\t\t\texpErrString: \"certificate chain is too long, must be less than 1000 certificates\",\n+\t\t\texpErrString: \"provided PEM data was larger than the maximum 65000B\",\n \t\t},\n \t}\n \n@@ -278,3 +261,25 @@ func TestParseSingleCertificateChain(t *testing.T) {\n \t\t})\n \t}\n }\n+\n+func TestParseSingleCertificateChain(t *testing.T) {\n+\t// ParseSingleCertificateChain is mostly tested in TestParseSingleCertificateChainPEM;\n+\t// this test checks that passing in too many small certs is correctly rejected\n+\tvar inputBundle []*x509.Certificate\n+\n+\tfor i := 0; i < 1001; i++ {\n+\t\tcert := mustCreateBundle(t, nil, fmt.Sprintf(\"cert-%d\", i))\n+\t\tinputBundle = append(inputBundle, cert.cert)\n+\t}\n+\n+\t_, err := ParseSingleCertificateChain(inputBundle)\n+\tif err == nil {\n+\t\tt.Fatalf(\"expected error but got none from ParseSingleCertificateChain\")\n+\t}\n+\n+\texpErr := \"certificate chain is too long, must be less than 1000 certificates\"\n+\n+\tif err.Error() != expErr {\n+\t\tt.Fatalf(\"expected err to be %s but it was %s\", expErr, err.Error())\n+\t}\n+}"
            },
            {
                "sha": "5567685f858a9cddb940a8e02b9899781fd3179b",
                "filename": "pkg/util/pki/sans_test.go",
                "status": "modified",
                "additions": 12,
                "deletions": 3,
                "changes": 15,
                "blob_url": "https://github.com/cert-manager/cert-manager/blob/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fsans_test.go",
                "raw_url": "https://github.com/cert-manager/cert-manager/raw/f22f78c8c0a64d718e203b326bc844c488ad7850/pkg%2Futil%2Fpki%2Fsans_test.go",
                "contents_url": "https://api.github.com/repos/cert-manager/cert-manager/contents/pkg%2Futil%2Fpki%2Fsans_test.go?ref=f22f78c8c0a64d718e203b326bc844c488ad7850",
                "patch": "@@ -20,13 +20,18 @@ import (\n \t\"crypto/x509\"\n \t\"crypto/x509/pkix\"\n \t\"encoding/asn1\"\n-\t\"encoding/pem\"\n \t\"reflect\"\n \t\"testing\"\n+\n+\t\"github.com/cert-manager/cert-manager/internal/pem\"\n )\n \n func extractSANsFromCertificate(t *testing.T, certDER string) pkix.Extension {\n-\tblock, rest := pem.Decode([]byte(certDER))\n+\tblock, rest, err := pem.SafeDecodeSingleCertificate([]byte(certDER))\n+\tif err != nil {\n+\t\tt.Fatalf(\"expected no PEM decode err but got %s\", err)\n+\t}\n+\n \tif len(rest) > 0 {\n \t\tt.Fatal(\"Expected no rest\")\n \t}\n@@ -47,7 +52,11 @@ func extractSANsFromCertificate(t *testing.T, certDER string) pkix.Extension {\n }\n \n func extractSANsFromCertificateRequest(t *testing.T, csrDER string) pkix.Extension {\n-\tblock, rest := pem.Decode([]byte(csrDER))\n+\tblock, rest, err := pem.SafeDecodeCSR([]byte(csrDER))\n+\tif err != nil {\n+\t\tt.Fatalf(\"expected no PEM decode err but got %s\", err)\n+\t}\n+\n \tif len(rest) > 0 {\n \t\tt.Fatal(\"Expected no rest\")\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/quarkusio/quarkus-http/commits/cfc99d80fce2e3a3dbf06972e648e79e925a7ae7",
        "url": "https://api.github.com/repos/quarkusio/quarkus-http/commits/cfc99d80fce2e3a3dbf06972e648e79e925a7ae7",
        "html_url": "https://github.com/quarkusio/quarkus-http/commit/cfc99d80fce2e3a3dbf06972e648e79e925a7ae7",
        "message": "Merge pull request #170 from aloubyansky/cookie-improper-quotes",
        "files": [
            {
                "sha": "58e6736b88e16eabe594187c2dd8f95a1a87cfef",
                "filename": "core/src/main/java/io/undertow/util/Cookies.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/quarkusio/quarkus-http/blob/cfc99d80fce2e3a3dbf06972e648e79e925a7ae7/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Futil%2FCookies.java",
                "raw_url": "https://github.com/quarkusio/quarkus-http/raw/cfc99d80fce2e3a3dbf06972e648e79e925a7ae7/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Futil%2FCookies.java",
                "contents_url": "https://api.github.com/repos/quarkusio/quarkus-http/contents/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Futil%2FCookies.java?ref=cfc99d80fce2e3a3dbf06972e648e79e925a7ae7",
                "patch": "@@ -271,6 +271,9 @@ private static void parseCookie(final String cookie, final Map<String, Cookie> p\n                         cookieCount = createCookie(name, cookie.substring(start, i), maxCookies, cookieCount, cookies, additional);\n                         state = 0;\n                         start = i + 1;\n+                    } else if (c == ';' || (commaIsSeperator && c == ',')) {\n+                        state = 0;\n+                        start = i + 1;\n                     }\n                     break;\n                 }"
            },
            {
                "sha": "4b72cfc56927aefff5690b263908f13431a5705a",
                "filename": "core/src/test/java/io/undertow/util/CookiesTestCase.java",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/quarkusio/quarkus-http/blob/cfc99d80fce2e3a3dbf06972e648e79e925a7ae7/core%2Fsrc%2Ftest%2Fjava%2Fio%2Fundertow%2Futil%2FCookiesTestCase.java",
                "raw_url": "https://github.com/quarkusio/quarkus-http/raw/cfc99d80fce2e3a3dbf06972e648e79e925a7ae7/core%2Fsrc%2Ftest%2Fjava%2Fio%2Fundertow%2Futil%2FCookiesTestCase.java",
                "contents_url": "https://api.github.com/repos/quarkusio/quarkus-http/contents/core%2Fsrc%2Ftest%2Fjava%2Fio%2Fundertow%2Futil%2FCookiesTestCase.java?ref=cfc99d80fce2e3a3dbf06972e648e79e925a7ae7",
                "patch": "@@ -362,4 +362,18 @@ public void testInvalidRfc6265CookieInDomain() {\n         Rfc6265CookieSupport.validateDomain(cookie.getDomain());\n     }\n \n+    @Test\n+    public void testNoDoubleQuoteTermination() {\n+        Map<String, Cookie> cookies = Cookies.parseRequestCookies(4, false, Arrays.asList(\"CUSTOMER=\\\"WILE_E_COYOTE\\\"; BAD=\\\"X; SHIPPING=FEDEX\"), true);\n+        Assert.assertEquals(2, cookies.size());\n+        Cookie cookie = cookies.get(\"CUSTOMER\");\n+        Assert.assertEquals(\"CUSTOMER\", cookie.getName());\n+        Assert.assertEquals(\"WILE_E_COYOTE\", cookie.getValue());\n+        cookie = cookies.get(\"BAD\");\n+        Assert.assertNull(cookie);\n+        cookie = cookies.get(\"SHIPPING\");\n+        Assert.assertEquals(\"SHIPPING\", cookie.getName());\n+        Assert.assertEquals(\"FEDEX\", cookie.getValue());\n+        Assert.assertNotNull(cookie);\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ltdrdata/ComfyUI-Manager/commits/ffc095a3e5acc1c404773a0510e6d055a6a72b0e",
        "url": "https://api.github.com/repos/Comfy-Org/ComfyUI-Manager/commits/ffc095a3e5acc1c404773a0510e6d055a6a72b0e",
        "html_url": "https://github.com/Comfy-Org/ComfyUI-Manager/commit/ffc095a3e5acc1c404773a0510e6d055a6a72b0e",
        "message": "robust validation",
        "files": [
            {
                "sha": "c4bf22264726d24c2bd6bc5032fb4301cd670cde",
                "filename": "glob/manager_core.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Comfy-Org/ComfyUI-Manager/blob/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob%2Fmanager_core.py",
                "raw_url": "https://github.com/Comfy-Org/ComfyUI-Manager/raw/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob%2Fmanager_core.py",
                "contents_url": "https://api.github.com/repos/Comfy-Org/ComfyUI-Manager/contents/glob%2Fmanager_core.py?ref=ffc095a3e5acc1c404773a0510e6d055a6a72b0e",
                "patch": "@@ -23,7 +23,7 @@\n import cm_global\n from manager_util import *\n \n-version = [2, 51]\n+version = [2, 51, 1]\n version_str = f\"V{version[0]}.{version[1]}\" + (f'.{version[2]}' if len(version) > 2 else '')\n \n "
            },
            {
                "sha": "197283ad638d9b81b91f071688c3e043afb176ed",
                "filename": "glob/manager_server.py",
                "status": "modified",
                "additions": 14,
                "deletions": 3,
                "changes": 17,
                "blob_url": "https://github.com/Comfy-Org/ComfyUI-Manager/blob/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob%2Fmanager_server.py",
                "raw_url": "https://github.com/Comfy-Org/ComfyUI-Manager/raw/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/glob%2Fmanager_server.py",
                "contents_url": "https://api.github.com/repos/Comfy-Org/ComfyUI-Manager/contents/glob%2Fmanager_server.py?ref=ffc095a3e5acc1c404773a0510e6d055a6a72b0e",
                "patch": "@@ -47,7 +47,9 @@ def handle_stream(stream, prefix):\n \n \n def is_allowed_security_level(level):\n-    if level == 'high':\n+    if level == 'block':\n+        return False\n+    elif level == 'high':\n         if is_local_mode:\n             return core.get_config()['security_level'].lower() in ['weak', 'normal-']\n         else:\n@@ -58,7 +60,7 @@ def is_allowed_security_level(level):\n         return True\n \n \n-async def get_risky_level(files):\n+async def get_risky_level(files, pip_packages):\n     json_data1 = await core.get_data_by_mode('local', 'custom-node-list.json')\n     json_data2 = await core.get_data_by_mode('cache', 'custom-node-list.json', channel_url='https://github.com/ltdrdata/ComfyUI-Manager/raw/main')\n \n@@ -70,6 +72,15 @@ async def get_risky_level(files):\n         if x not in all_urls:\n             return \"high\"\n \n+    all_pip_packages = set()\n+    for x in json_data1['custom_nodes'] + json_data2['custom_nodes']:\n+        if \"pip\" in x:\n+            all_pip_packages.update(x['pip'])\n+\n+    for p in pip_packages:\n+        if p not in all_pip_packages:\n+            return \"block\"\n+\n     return \"middle\"\n \n \n@@ -791,7 +802,7 @@ async def install_custom_node(request):\n \n     json_data = await request.json()\n \n-    risky_level = await get_risky_level(json_data['files'])\n+    risky_level = await get_risky_level(json_data['files'], json_data.get('pip', []))\n     if not is_allowed_security_level(risky_level):\n         print(SECURITY_MESSAGE_GENERAL)\n         return web.Response(status=404)"
            },
            {
                "sha": "43a3c014044a8a6a0aca365f40ba9d49ce5ce2b1",
                "filename": "pyproject.toml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Comfy-Org/ComfyUI-Manager/blob/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/pyproject.toml",
                "raw_url": "https://github.com/Comfy-Org/ComfyUI-Manager/raw/ffc095a3e5acc1c404773a0510e6d055a6a72b0e/pyproject.toml",
                "contents_url": "https://api.github.com/repos/Comfy-Org/ComfyUI-Manager/contents/pyproject.toml?ref=ffc095a3e5acc1c404773a0510e6d055a6a72b0e",
                "patch": "@@ -1,7 +1,7 @@\n [project]\n name = \"comfyui-manager\"\n description = \"ComfyUI-Manager provides features to install and manage custom nodes for ComfyUI, as well as various functionalities to assist with ComfyUI.\"\n-version = \"2.51\"\n+version = \"2.51.1\"\n license = { file = \"LICENSE.txt\" }\n dependencies = [\"GitPython\", \"PyGithub\", \"matrix-client==0.4.0\", \"transformers\", \"huggingface-hub>0.20\", \"typer\", \"rich\", \"typing-extensions\"]\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rizinorg/rizin/commits/75bac3088b2ec173e22d4be9d525ceacc987cf02",
        "url": "https://api.github.com/repos/rizinorg/rizin/commits/75bac3088b2ec173e22d4be9d525ceacc987cf02",
        "html_url": "https://github.com/rizinorg/rizin/commit/75bac3088b2ec173e22d4be9d525ceacc987cf02",
        "message": "Backport radare2#c84b7232626badd075caf3ae29661b609164bac6\n\nFix heap buffer overflow in dyldcache parser ##crash\n\n* Reported by: Lazymio via huntr.dev\n* Reproducer: dyldovf",
        "files": [
            {
                "sha": "ef41fa24afabc2a9f20216c4eafbb631c74fcd28",
                "filename": "librz/bin/format/mach0/dyldcache.c",
                "status": "modified",
                "additions": 6,
                "deletions": 5,
                "changes": 11,
                "blob_url": "https://github.com/rizinorg/rizin/blob/75bac3088b2ec173e22d4be9d525ceacc987cf02/librz%2Fbin%2Fformat%2Fmach0%2Fdyldcache.c",
                "raw_url": "https://github.com/rizinorg/rizin/raw/75bac3088b2ec173e22d4be9d525ceacc987cf02/librz%2Fbin%2Fformat%2Fmach0%2Fdyldcache.c",
                "contents_url": "https://api.github.com/repos/rizinorg/rizin/contents/librz%2Fbin%2Fformat%2Fmach0%2Fdyldcache.c?ref=75bac3088b2ec173e22d4be9d525ceacc987cf02",
                "patch": "@@ -356,12 +356,13 @@ static void populate_cache_maps(RzDyldCache *cache) {\n \t}\n }\n \n-static cache_accel_t *read_cache_accel(RzBuffer *cache_buf, RzDyldCacheHeader *hdr, cache_map_t *maps) {\n+static cache_accel_t *read_cache_accel(RzBuffer *cache_buf, RzDyldCacheHeader *hdr, cache_map_t *maps, size_t n_maps) {\n \tif (!cache_buf || !hdr || !rz_dyldcache_header_may_have_accel(hdr) || !hdr->accelerateInfoSize || !hdr->accelerateInfoAddr) {\n \t\treturn NULL;\n \t}\n \n-\tut64 offset = va2pa(hdr->accelerateInfoAddr, hdr->mappingCount, maps, cache_buf, 0, NULL, NULL);\n+\tsize_t map_count = RZ_MIN(hdr->mappingCount, n_maps);\n+\tut64 offset = va2pa(hdr->accelerateInfoAddr, map_count, maps, cache_buf, 0, NULL, NULL);\n \tif (!offset) {\n \t\treturn NULL;\n \t}\n@@ -634,6 +635,8 @@ static RzList /*<RzDyldBinImage *>*/ *create_cache_bins(RzDyldCache *cache) {\n \t\treturn NULL;\n \t}\n \n+\tut16 *dep_array = NULL;\n+\tcache_imgxtr_t *extras = NULL;\n \tchar *target_libs = NULL;\n \tRzList *target_lib_names = NULL;\n \tint *deps = NULL;\n@@ -663,8 +666,6 @@ static RzList /*<RzDyldBinImage *>*/ *create_cache_bins(RzDyldCache *cache) {\n \t\t\tgoto next;\n \t\t}\n \n-\t\tut16 *dep_array = NULL;\n-\t\tcache_imgxtr_t *extras = NULL;\n \t\tif (target_libs) {\n \t\t\tHtPU *path_to_idx = NULL;\n \t\t\tsize_t dep_array_count = 0;\n@@ -1350,7 +1351,7 @@ RZ_API RzDyldCache *rz_dyldcache_new_buf(RzBuffer *buf) {\n \tif (!cache->maps) {\n \t\tgoto cupertino;\n \t}\n-\tcache->accel = read_cache_accel(cache->buf, cache->hdr, cache->maps);\n+\tcache->accel = read_cache_accel(cache->buf, cache->hdr, cache->maps, cache->n_maps);\n \tcache->bins = create_cache_bins(cache);\n \tif (!cache->bins) {\n \t\tgoto cupertino;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/siyuan-note/siyuan/commits/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "url": "https://api.github.com/repos/siyuan-note/siyuan/commits/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "html_url": "https://github.com/siyuan-note/siyuan/commit/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "message": ":lock: Some security vulnerabilities https://github.com/siyuan-note/siyuan/issues/13426",
        "files": [
            {
                "sha": "82e7d504a56ddcfc392ebbbc1cd8253d9ab6feb2",
                "filename": "kernel/api/template.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fapi%2Ftemplate.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fapi%2Ftemplate.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fapi%2Ftemplate.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -80,6 +80,12 @@ func renderTemplate(c *gin.Context) {\n \t\treturn\n \t}\n \n+\tif !util.IsAbsPathInWorkspace(p) {\n+\t\tret.Code = -1\n+\t\tret.Msg = \"Path [\" + p + \"] is not in workspace\"\n+\t\treturn\n+\t}\n+\n \tpreview := false\n \tif previewArg := arg[\"preview\"]; nil != previewArg {\n \t\tpreview = previewArg.(bool)"
            },
            {
                "sha": "b844b08bfc097ff5e905d12db111534f4a40b8d8",
                "filename": "kernel/model/export.go",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fexport.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fexport.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fmodel%2Fexport.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -532,7 +532,13 @@ func ExportResources(resourcePaths []string, mainName string) (exportFilePath st\n \n \t// \u5c06\u9700\u8981\u5bfc\u51fa\u7684\u6587\u4ef6/\u6587\u4ef6\u5939\u590d\u5236\u5230\u4e34\u65f6\u6587\u4ef6\u5939\n \tfor _, resourcePath := range resourcePaths {\n-\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath)    // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath) // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tif !util.IsAbsPathInWorkspace(resourceFullPath) {\n+\t\t\tlogging.LogErrorf(\"resource path [%s] is not in workspace\", resourceFullPath)\n+\t\t\terr = errors.New(\"resource path [\" + resourcePath + \"] is not in workspace\")\n+\t\t\treturn\n+\t\t}\n+\n \t\tresourceBaseName := filepath.Base(resourceFullPath)                   // \u8d44\u6e90\u540d\u79f0\n \t\tresourceCopyPath := filepath.Join(exportFolderPath, resourceBaseName) // \u8d44\u6e90\u526f\u672c\u5b8c\u6574\u8def\u5f84\n \t\tif err = filelock.Copy(resourceFullPath, resourceCopyPath); err != nil {"
            },
            {
                "sha": "04fcd83c2f27ceaf56c66edbb697337d303e0453",
                "filename": "kernel/model/upload.go",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fupload.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fupload.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fmodel%2Fupload.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -132,6 +132,11 @@ func Upload(c *gin.Context) {\n \tif nil != form.Value[\"assetsDirPath\"] {\n \t\trelAssetsDirPath = form.Value[\"assetsDirPath\"][0]\n \t\tassetsDirPath = filepath.Join(util.DataDir, relAssetsDirPath)\n+\t\tif !util.IsAbsPathInWorkspace(assetsDirPath) {\n+\t\t\tret.Code = -1\n+\t\t\tret.Msg = \"Path [\" + assetsDirPath + \"] is not in workspace\"\n+\t\t\treturn\n+\t\t}\n \t}\n \tif !gulu.File.IsExist(assetsDirPath) {\n \t\tif err = os.MkdirAll(assetsDirPath, 0755); err != nil {"
            },
            {
                "sha": "0472a42f6590931bbf18db5faa6158f8a1c266d5",
                "filename": "kernel/treenode/template.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Ftreenode%2Ftemplate.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Ftreenode%2Ftemplate.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Ftreenode%2Ftemplate.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -31,6 +31,12 @@ import (\n \n func BuiltInTemplateFuncs() (ret template.FuncMap) {\n \tret = sprig.TxtFuncMap()\n+\n+\t// \u56e0\u4e3a\u5b89\u5168\u539f\u56e0\u79fb\u9664\u4e00\u4e9b\u51fd\u6570 https://github.com/siyuan-note/siyuan/issues/13426\n+\tdelete(ret, \"env\")\n+\tdelete(ret, \"expandenv\")\n+\tdelete(ret, \"getHostByName\")\n+\n \tret[\"Weekday\"] = util.Weekday\n \tret[\"WeekdayCN\"] = util.WeekdayCN\n \tret[\"WeekdayCN2\"] = util.WeekdayCN2"
            },
            {
                "sha": "ed562a514d5b45484e5a522be2bd8886a5affec7",
                "filename": "kernel/util/path.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Futil%2Fpath.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Futil%2Fpath.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Futil%2Fpath.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -302,3 +302,7 @@ func GetAbsPathInWorkspace(relPath string) (string, error) {\n \t}\n \treturn \"\", os.ErrPermission\n }\n+\n+func IsAbsPathInWorkspace(absPath string) bool {\n+\treturn IsSubPath(WorkspaceDir, absPath)\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/siyuan-note/siyuan/commits/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "url": "https://api.github.com/repos/siyuan-note/siyuan/commits/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "html_url": "https://github.com/siyuan-note/siyuan/commit/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "message": ":lock: Some security vulnerabilities https://github.com/siyuan-note/siyuan/issues/13426",
        "files": [
            {
                "sha": "82e7d504a56ddcfc392ebbbc1cd8253d9ab6feb2",
                "filename": "kernel/api/template.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fapi%2Ftemplate.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fapi%2Ftemplate.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fapi%2Ftemplate.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -80,6 +80,12 @@ func renderTemplate(c *gin.Context) {\n \t\treturn\n \t}\n \n+\tif !util.IsAbsPathInWorkspace(p) {\n+\t\tret.Code = -1\n+\t\tret.Msg = \"Path [\" + p + \"] is not in workspace\"\n+\t\treturn\n+\t}\n+\n \tpreview := false\n \tif previewArg := arg[\"preview\"]; nil != previewArg {\n \t\tpreview = previewArg.(bool)"
            },
            {
                "sha": "b844b08bfc097ff5e905d12db111534f4a40b8d8",
                "filename": "kernel/model/export.go",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fexport.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fexport.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fmodel%2Fexport.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -532,7 +532,13 @@ func ExportResources(resourcePaths []string, mainName string) (exportFilePath st\n \n \t// \u5c06\u9700\u8981\u5bfc\u51fa\u7684\u6587\u4ef6/\u6587\u4ef6\u5939\u590d\u5236\u5230\u4e34\u65f6\u6587\u4ef6\u5939\n \tfor _, resourcePath := range resourcePaths {\n-\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath)    // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath) // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tif !util.IsAbsPathInWorkspace(resourceFullPath) {\n+\t\t\tlogging.LogErrorf(\"resource path [%s] is not in workspace\", resourceFullPath)\n+\t\t\terr = errors.New(\"resource path [\" + resourcePath + \"] is not in workspace\")\n+\t\t\treturn\n+\t\t}\n+\n \t\tresourceBaseName := filepath.Base(resourceFullPath)                   // \u8d44\u6e90\u540d\u79f0\n \t\tresourceCopyPath := filepath.Join(exportFolderPath, resourceBaseName) // \u8d44\u6e90\u526f\u672c\u5b8c\u6574\u8def\u5f84\n \t\tif err = filelock.Copy(resourceFullPath, resourceCopyPath); err != nil {"
            },
            {
                "sha": "04fcd83c2f27ceaf56c66edbb697337d303e0453",
                "filename": "kernel/model/upload.go",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fupload.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fupload.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fmodel%2Fupload.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -132,6 +132,11 @@ func Upload(c *gin.Context) {\n \tif nil != form.Value[\"assetsDirPath\"] {\n \t\trelAssetsDirPath = form.Value[\"assetsDirPath\"][0]\n \t\tassetsDirPath = filepath.Join(util.DataDir, relAssetsDirPath)\n+\t\tif !util.IsAbsPathInWorkspace(assetsDirPath) {\n+\t\t\tret.Code = -1\n+\t\t\tret.Msg = \"Path [\" + assetsDirPath + \"] is not in workspace\"\n+\t\t\treturn\n+\t\t}\n \t}\n \tif !gulu.File.IsExist(assetsDirPath) {\n \t\tif err = os.MkdirAll(assetsDirPath, 0755); err != nil {"
            },
            {
                "sha": "0472a42f6590931bbf18db5faa6158f8a1c266d5",
                "filename": "kernel/treenode/template.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Ftreenode%2Ftemplate.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Ftreenode%2Ftemplate.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Ftreenode%2Ftemplate.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -31,6 +31,12 @@ import (\n \n func BuiltInTemplateFuncs() (ret template.FuncMap) {\n \tret = sprig.TxtFuncMap()\n+\n+\t// \u56e0\u4e3a\u5b89\u5168\u539f\u56e0\u79fb\u9664\u4e00\u4e9b\u51fd\u6570 https://github.com/siyuan-note/siyuan/issues/13426\n+\tdelete(ret, \"env\")\n+\tdelete(ret, \"expandenv\")\n+\tdelete(ret, \"getHostByName\")\n+\n \tret[\"Weekday\"] = util.Weekday\n \tret[\"WeekdayCN\"] = util.WeekdayCN\n \tret[\"WeekdayCN2\"] = util.WeekdayCN2"
            },
            {
                "sha": "ed562a514d5b45484e5a522be2bd8886a5affec7",
                "filename": "kernel/util/path.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Futil%2Fpath.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Futil%2Fpath.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Futil%2Fpath.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -302,3 +302,7 @@ func GetAbsPathInWorkspace(relPath string) (string, error) {\n \t}\n \treturn \"\", os.ErrPermission\n }\n+\n+func IsAbsPathInWorkspace(absPath string) bool {\n+\treturn IsSubPath(WorkspaceDir, absPath)\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/siyuan-note/siyuan/commits/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "url": "https://api.github.com/repos/siyuan-note/siyuan/commits/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "html_url": "https://github.com/siyuan-note/siyuan/commit/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "message": ":lock: Some security vulnerabilities https://github.com/siyuan-note/siyuan/issues/13426",
        "files": [
            {
                "sha": "82e7d504a56ddcfc392ebbbc1cd8253d9ab6feb2",
                "filename": "kernel/api/template.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fapi%2Ftemplate.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fapi%2Ftemplate.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fapi%2Ftemplate.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -80,6 +80,12 @@ func renderTemplate(c *gin.Context) {\n \t\treturn\n \t}\n \n+\tif !util.IsAbsPathInWorkspace(p) {\n+\t\tret.Code = -1\n+\t\tret.Msg = \"Path [\" + p + \"] is not in workspace\"\n+\t\treturn\n+\t}\n+\n \tpreview := false\n \tif previewArg := arg[\"preview\"]; nil != previewArg {\n \t\tpreview = previewArg.(bool)"
            },
            {
                "sha": "b844b08bfc097ff5e905d12db111534f4a40b8d8",
                "filename": "kernel/model/export.go",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fexport.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fexport.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fmodel%2Fexport.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -532,7 +532,13 @@ func ExportResources(resourcePaths []string, mainName string) (exportFilePath st\n \n \t// \u5c06\u9700\u8981\u5bfc\u51fa\u7684\u6587\u4ef6/\u6587\u4ef6\u5939\u590d\u5236\u5230\u4e34\u65f6\u6587\u4ef6\u5939\n \tfor _, resourcePath := range resourcePaths {\n-\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath)    // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath) // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tif !util.IsAbsPathInWorkspace(resourceFullPath) {\n+\t\t\tlogging.LogErrorf(\"resource path [%s] is not in workspace\", resourceFullPath)\n+\t\t\terr = errors.New(\"resource path [\" + resourcePath + \"] is not in workspace\")\n+\t\t\treturn\n+\t\t}\n+\n \t\tresourceBaseName := filepath.Base(resourceFullPath)                   // \u8d44\u6e90\u540d\u79f0\n \t\tresourceCopyPath := filepath.Join(exportFolderPath, resourceBaseName) // \u8d44\u6e90\u526f\u672c\u5b8c\u6574\u8def\u5f84\n \t\tif err = filelock.Copy(resourceFullPath, resourceCopyPath); err != nil {"
            },
            {
                "sha": "04fcd83c2f27ceaf56c66edbb697337d303e0453",
                "filename": "kernel/model/upload.go",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fupload.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fupload.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fmodel%2Fupload.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -132,6 +132,11 @@ func Upload(c *gin.Context) {\n \tif nil != form.Value[\"assetsDirPath\"] {\n \t\trelAssetsDirPath = form.Value[\"assetsDirPath\"][0]\n \t\tassetsDirPath = filepath.Join(util.DataDir, relAssetsDirPath)\n+\t\tif !util.IsAbsPathInWorkspace(assetsDirPath) {\n+\t\t\tret.Code = -1\n+\t\t\tret.Msg = \"Path [\" + assetsDirPath + \"] is not in workspace\"\n+\t\t\treturn\n+\t\t}\n \t}\n \tif !gulu.File.IsExist(assetsDirPath) {\n \t\tif err = os.MkdirAll(assetsDirPath, 0755); err != nil {"
            },
            {
                "sha": "0472a42f6590931bbf18db5faa6158f8a1c266d5",
                "filename": "kernel/treenode/template.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Ftreenode%2Ftemplate.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Ftreenode%2Ftemplate.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Ftreenode%2Ftemplate.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -31,6 +31,12 @@ import (\n \n func BuiltInTemplateFuncs() (ret template.FuncMap) {\n \tret = sprig.TxtFuncMap()\n+\n+\t// \u56e0\u4e3a\u5b89\u5168\u539f\u56e0\u79fb\u9664\u4e00\u4e9b\u51fd\u6570 https://github.com/siyuan-note/siyuan/issues/13426\n+\tdelete(ret, \"env\")\n+\tdelete(ret, \"expandenv\")\n+\tdelete(ret, \"getHostByName\")\n+\n \tret[\"Weekday\"] = util.Weekday\n \tret[\"WeekdayCN\"] = util.WeekdayCN\n \tret[\"WeekdayCN2\"] = util.WeekdayCN2"
            },
            {
                "sha": "ed562a514d5b45484e5a522be2bd8886a5affec7",
                "filename": "kernel/util/path.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Futil%2Fpath.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Futil%2Fpath.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Futil%2Fpath.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -302,3 +302,7 @@ func GetAbsPathInWorkspace(relPath string) (string, error) {\n \t}\n \treturn \"\", os.ErrPermission\n }\n+\n+func IsAbsPathInWorkspace(absPath string) bool {\n+\treturn IsSubPath(WorkspaceDir, absPath)\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/siyuan-note/siyuan/commits/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "url": "https://api.github.com/repos/siyuan-note/siyuan/commits/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "html_url": "https://github.com/siyuan-note/siyuan/commit/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
        "message": ":lock: Some security vulnerabilities https://github.com/siyuan-note/siyuan/issues/13426",
        "files": [
            {
                "sha": "82e7d504a56ddcfc392ebbbc1cd8253d9ab6feb2",
                "filename": "kernel/api/template.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fapi%2Ftemplate.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fapi%2Ftemplate.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fapi%2Ftemplate.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -80,6 +80,12 @@ func renderTemplate(c *gin.Context) {\n \t\treturn\n \t}\n \n+\tif !util.IsAbsPathInWorkspace(p) {\n+\t\tret.Code = -1\n+\t\tret.Msg = \"Path [\" + p + \"] is not in workspace\"\n+\t\treturn\n+\t}\n+\n \tpreview := false\n \tif previewArg := arg[\"preview\"]; nil != previewArg {\n \t\tpreview = previewArg.(bool)"
            },
            {
                "sha": "b844b08bfc097ff5e905d12db111534f4a40b8d8",
                "filename": "kernel/model/export.go",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fexport.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fexport.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fmodel%2Fexport.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -532,7 +532,13 @@ func ExportResources(resourcePaths []string, mainName string) (exportFilePath st\n \n \t// \u5c06\u9700\u8981\u5bfc\u51fa\u7684\u6587\u4ef6/\u6587\u4ef6\u5939\u590d\u5236\u5230\u4e34\u65f6\u6587\u4ef6\u5939\n \tfor _, resourcePath := range resourcePaths {\n-\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath)    // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tresourceFullPath := filepath.Join(util.WorkspaceDir, resourcePath) // \u8d44\u6e90\u5b8c\u6574\u8def\u5f84\n+\t\tif !util.IsAbsPathInWorkspace(resourceFullPath) {\n+\t\t\tlogging.LogErrorf(\"resource path [%s] is not in workspace\", resourceFullPath)\n+\t\t\terr = errors.New(\"resource path [\" + resourcePath + \"] is not in workspace\")\n+\t\t\treturn\n+\t\t}\n+\n \t\tresourceBaseName := filepath.Base(resourceFullPath)                   // \u8d44\u6e90\u540d\u79f0\n \t\tresourceCopyPath := filepath.Join(exportFolderPath, resourceBaseName) // \u8d44\u6e90\u526f\u672c\u5b8c\u6574\u8def\u5f84\n \t\tif err = filelock.Copy(resourceFullPath, resourceCopyPath); err != nil {"
            },
            {
                "sha": "04fcd83c2f27ceaf56c66edbb697337d303e0453",
                "filename": "kernel/model/upload.go",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fupload.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Fmodel%2Fupload.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Fmodel%2Fupload.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -132,6 +132,11 @@ func Upload(c *gin.Context) {\n \tif nil != form.Value[\"assetsDirPath\"] {\n \t\trelAssetsDirPath = form.Value[\"assetsDirPath\"][0]\n \t\tassetsDirPath = filepath.Join(util.DataDir, relAssetsDirPath)\n+\t\tif !util.IsAbsPathInWorkspace(assetsDirPath) {\n+\t\t\tret.Code = -1\n+\t\t\tret.Msg = \"Path [\" + assetsDirPath + \"] is not in workspace\"\n+\t\t\treturn\n+\t\t}\n \t}\n \tif !gulu.File.IsExist(assetsDirPath) {\n \t\tif err = os.MkdirAll(assetsDirPath, 0755); err != nil {"
            },
            {
                "sha": "0472a42f6590931bbf18db5faa6158f8a1c266d5",
                "filename": "kernel/treenode/template.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Ftreenode%2Ftemplate.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Ftreenode%2Ftemplate.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Ftreenode%2Ftemplate.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -31,6 +31,12 @@ import (\n \n func BuiltInTemplateFuncs() (ret template.FuncMap) {\n \tret = sprig.TxtFuncMap()\n+\n+\t// \u56e0\u4e3a\u5b89\u5168\u539f\u56e0\u79fb\u9664\u4e00\u4e9b\u51fd\u6570 https://github.com/siyuan-note/siyuan/issues/13426\n+\tdelete(ret, \"env\")\n+\tdelete(ret, \"expandenv\")\n+\tdelete(ret, \"getHostByName\")\n+\n \tret[\"Weekday\"] = util.Weekday\n \tret[\"WeekdayCN\"] = util.WeekdayCN\n \tret[\"WeekdayCN2\"] = util.WeekdayCN2"
            },
            {
                "sha": "ed562a514d5b45484e5a522be2bd8886a5affec7",
                "filename": "kernel/util/path.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/siyuan-note/siyuan/blob/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Futil%2Fpath.go",
                "raw_url": "https://github.com/siyuan-note/siyuan/raw/e70ed57f6e4852e2bd702671aeb8eb3a47a36d71/kernel%2Futil%2Fpath.go",
                "contents_url": "https://api.github.com/repos/siyuan-note/siyuan/contents/kernel%2Futil%2Fpath.go?ref=e70ed57f6e4852e2bd702671aeb8eb3a47a36d71",
                "patch": "@@ -302,3 +302,7 @@ func GetAbsPathInWorkspace(relPath string) (string, error) {\n \t}\n \treturn \"\", os.ErrPermission\n }\n+\n+func IsAbsPathInWorkspace(absPath string) bool {\n+\treturn IsSubPath(WorkspaceDir, absPath)\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pwndoc/pwndoc/commits/1d4219c596f4f518798492e48386a20c6e9a2fe6",
        "url": "https://api.github.com/repos/pwndoc/pwndoc/commits/1d4219c596f4f518798492e48386a20c6e9a2fe6",
        "html_url": "https://github.com/pwndoc/pwndoc/commit/1d4219c596f4f518798492e48386a20c6e9a2fe6",
        "message": "Merge commit from fork\n\nAdded validation of the extension",
        "files": [
            {
                "sha": "a7156d784d667d2b783aa7b0507503928baea00a",
                "filename": "backend/src/routes/template.js",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/pwndoc/pwndoc/blob/1d4219c596f4f518798492e48386a20c6e9a2fe6/backend%2Fsrc%2Froutes%2Ftemplate.js",
                "raw_url": "https://github.com/pwndoc/pwndoc/raw/1d4219c596f4f518798492e48386a20c6e9a2fe6/backend%2Fsrc%2Froutes%2Ftemplate.js",
                "contents_url": "https://api.github.com/repos/pwndoc/pwndoc/contents/backend%2Fsrc%2Froutes%2Ftemplate.js?ref=1d4219c596f4f518798492e48386a20c6e9a2fe6",
                "patch": "@@ -46,6 +46,12 @@ module.exports = function(app) {\n             return;\n         }\n \n+        // Fix for GHSA-2mqc-gg7h-76p6\n+        if (req.body.ext && !utils.validFilename(req.body.ext)) {\n+            Response.BadParameters(res, 'Bad name format');\n+            return;\n+        }\n+\n         var template = {};\n         // Optional parameters\n         if (req.body.name) template.name = req.body.name;"
            },
            {
                "sha": "5b978fadb6eff23d38a007c2a4ab03edfa3449a5",
                "filename": "backend/tests/template.test.js",
                "status": "modified",
                "additions": 38,
                "deletions": 0,
                "changes": 38,
                "blob_url": "https://github.com/pwndoc/pwndoc/blob/1d4219c596f4f518798492e48386a20c6e9a2fe6/backend%2Ftests%2Ftemplate.test.js",
                "raw_url": "https://github.com/pwndoc/pwndoc/raw/1d4219c596f4f518798492e48386a20c6e9a2fe6/backend%2Ftests%2Ftemplate.test.js",
                "contents_url": "https://api.github.com/repos/pwndoc/pwndoc/contents/backend%2Ftests%2Ftemplate.test.js?ref=1d4219c596f4f518798492e48386a20c6e9a2fe6",
                "patch": "@@ -122,6 +122,44 @@ module.exports = function(request, app) {\n         expect(response.status).toBe(404)\n       })\n \n+      it('Update template with invalid filename (Avoid security regression)', async () => {\n+        var template = { name: \"Template Updated../../../../src/config/config.json\" }\n+\n+        var response = await request(app).put(`/api/templates/${template1Id}`)\n+          .set('Cookie', [\n+            `token=JWT ${userToken}`\n+          ])\n+          .send(template)\n+        expect(response.status).toBe(422)\n+      })\n+\n+      it('Update template with invalid file extension (Avoid security regression)', async () => {\n+        var template = {\n+          name: \"Template Updated\",\n+          ext: \"../src/config/config.json\"\n+        }\n+\n+        var response = await request(app).put(`/api/templates/${template1Id}`)\n+          .set('Cookie', [\n+            `token=JWT ${userToken}`\n+          ])\n+          .send(template)\n+        expect(response.status).toBe(422)\n+      })\n+\n+      it('Update template with invalid file extension - No file name (Avoid security regression)', async () => {\n+        var template = {\n+          ext: \"../src/config/config.json\"\n+        }\n+\n+        var response = await request(app).put(`/api/templates/${template1Id}`)\n+          .set('Cookie', [\n+            `token=JWT ${userToken}`\n+          ])\n+          .send(template)\n+        expect(response.status).toBe(422)\n+      })\n+\n       it('Delete template', async () => {\n         var response = await request(app).delete(`/api/templates/${template2Id}`)\n           .set('Cookie', ["
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/HabitRPG/habitica/commits/946ade5da1f52a804ef2ba76d49416c43e8166bf",
        "url": "https://api.github.com/repos/HabitRPG/habitica/commits/946ade5da1f52a804ef2ba76d49416c43e8166bf",
        "html_url": "https://github.com/HabitRPG/habitica/commit/946ade5da1f52a804ef2ba76d49416c43e8166bf",
        "message": "Merge commit from fork\n\nCo-authored-by: Sabe Jones <sabe@habitica.com>",
        "files": [
            {
                "sha": "59e71df90e955d3b404204dbc29555b28d6ac4a3",
                "filename": "website/client/package-lock.json",
                "status": "modified",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage-lock.json",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage-lock.json",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fpackage-lock.json?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -23,7 +23,6 @@\n         \"bootstrap\": \"^4.6.0\",\n         \"bootstrap-vue\": \"^2.23.1\",\n         \"core-js\": \"^3.33.1\",\n-        \"dompurify\": \"^3.0.3\",\n         \"eslint\": \"7.32.0\",\n         \"eslint-config-habitrpg\": \"6.2.0\",\n         \"eslint-plugin-mocha\": \"5.3.0\",\n@@ -5389,11 +5388,6 @@\n         \"url\": \"https://github.com/fb55/domhandler?sponsor=1\"\n       }\n     },\n-    \"node_modules/dompurify\": {\n-      \"version\": \"3.0.6\",\n-      \"resolved\": \"https://registry.npmjs.org/dompurify/-/dompurify-3.0.6.tgz\",\n-      \"integrity\": \"sha512-ilkD8YEnnGh1zJ240uJsW7AzE+2qpbOUYjacomn3AvJ6J4JhKGSZ2nh4wUIXPZrEPppaCLx5jFe8T89Rk8tQ7w==\"\n-    },\n     \"node_modules/domutils\": {\n       \"version\": \"2.8.0\",\n       \"resolved\": \"https://registry.npmjs.org/domutils/-/domutils-2.8.0.tgz\","
            },
            {
                "sha": "e19536a787e62d532bcd693aee61666471d75536",
                "filename": "website/client/package.json",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage.json",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage.json",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fpackage.json?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -25,7 +25,6 @@\n     \"bootstrap\": \"^4.6.0\",\n     \"bootstrap-vue\": \"^2.23.1\",\n     \"core-js\": \"^3.33.1\",\n-    \"dompurify\": \"^3.0.3\",\n     \"eslint\": \"7.32.0\",\n     \"eslint-config-habitrpg\": \"6.2.0\",\n     \"eslint-plugin-mocha\": \"5.3.0\","
            },
            {
                "sha": "5559d62f6b4e02b4edf02c612bab1e9b3f36a39b",
                "filename": "website/client/src/components/auth/registerLoginReset.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 7,
                "changes": 9,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fauth%2FregisterLoginReset.vue",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fauth%2FregisterLoginReset.vue",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fsrc%2Fcomponents%2Fauth%2FregisterLoginReset.vue?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -608,17 +608,17 @@ import axios from 'axios';\n import hello from 'hellojs';\n import debounce from 'lodash/debounce';\n import isEmail from 'validator/es/lib/isEmail';\n-import DOMPurify from 'dompurify';\n import { MINIMUM_PASSWORD_LENGTH } from '@/../../common/script/constants';\n import { buildAppleAuthUrl } from '../../libs/auth';\n-\n+import sanitizeRedirect from '@/mixins/sanitizeRedirect';\n import exclamation from '@/assets/svg/exclamation.svg';\n import gryphon from '@/assets/svg/gryphon.svg';\n import habiticaIcon from '@/assets/svg/logo-horizontal.svg';\n import googleIcon from '@/assets/svg/google.svg';\n import appleIcon from '@/assets/svg/apple_black.svg';\n \n export default {\n+  mixins: [sanitizeRedirect],\n   data () {\n     const data = {\n       username: '',\n@@ -747,11 +747,6 @@ export default {\n         }\n       });\n     }, 500),\n-    sanitizeRedirect (redirect) {\n-      if (!redirect) return '/';\n-      const sanitizedString = DOMPurify.sanitize(redirect).replace(/\\\\|\\/\\/|\\./g, '');\n-      return sanitizedString;\n-    },\n     async register () {\n       // @TODO do not use alert\n       if (!this.email) {"
            },
            {
                "sha": "89f17756b211fa56cfc268a8a1763f5cc17ae9df",
                "filename": "website/client/src/components/static/home.vue",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fstatic%2Fhome.vue",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fstatic%2Fhome.vue",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fsrc%2Fcomponents%2Fstatic%2Fhome.vue?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -784,6 +784,7 @@ import debounce from 'lodash/debounce';\n import isEmail from 'validator/es/lib/isEmail';\n import { MINIMUM_PASSWORD_LENGTH } from '@/../../common/script/constants';\n import { buildAppleAuthUrl } from '../../libs/auth';\n+import sanitizeRedirect from '@/mixins/sanitizeRedirect';\n import googlePlay from '@/assets/images/home/google-play-badge.svg';\n import iosAppStore from '@/assets/images/home/ios-app-store.svg';\n import iphones from '@/assets/images/home/iphones.svg';\n@@ -804,6 +805,7 @@ import makeuseof from '@/assets/images/home/make-use-of.svg';\n import thenewyorktimes from '@/assets/images/home/the-new-york-times.svg';\n \n export default {\n+  mixins: [sanitizeRedirect],\n   data () {\n     return {\n       icons: Object.freeze({\n@@ -923,7 +925,9 @@ export default {\n         groupInvite,\n       });\n \n-      window.location.href = this.$route.query.redirectTo || '/';\n+      const redirect = this.sanitizeRedirect(this.$route.query.redirectTo);\n+\n+      window.location.href = redirect;\n     },\n     playButtonClick () {\n       this.$router.push('/register');"
            },
            {
                "sha": "aea7eddb115d536996ca8e26bea9c7d470a960b8",
                "filename": "website/client/src/mixins/sanitizeRedirect.js",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fmixins%2FsanitizeRedirect.js",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fmixins%2FsanitizeRedirect.js",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fsrc%2Fmixins%2FsanitizeRedirect.js?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -0,0 +1,16 @@\n+export default {\n+  methods: {\n+    sanitizeRedirect (redirect) {\n+      if (!redirect) {\n+        return '/';\n+      }\n+      if (process.env.TRUSTED_DOMAINS.split(',').includes(redirect)) {\n+        return redirect;\n+      }\n+      if (redirect.slice(0, 1) !== '/' || redirect.slice(1, 1) === '/') {\n+        return '/';\n+      }\n+      return redirect;\n+    },\n+  },\n+};"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/HabitRPG/habitica/commits/946ade5da1f52a804ef2ba76d49416c43e8166bf",
        "url": "https://api.github.com/repos/HabitRPG/habitica/commits/946ade5da1f52a804ef2ba76d49416c43e8166bf",
        "html_url": "https://github.com/HabitRPG/habitica/commit/946ade5da1f52a804ef2ba76d49416c43e8166bf",
        "message": "Merge commit from fork\n\nCo-authored-by: Sabe Jones <sabe@habitica.com>",
        "files": [
            {
                "sha": "59e71df90e955d3b404204dbc29555b28d6ac4a3",
                "filename": "website/client/package-lock.json",
                "status": "modified",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage-lock.json",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage-lock.json",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fpackage-lock.json?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -23,7 +23,6 @@\n         \"bootstrap\": \"^4.6.0\",\n         \"bootstrap-vue\": \"^2.23.1\",\n         \"core-js\": \"^3.33.1\",\n-        \"dompurify\": \"^3.0.3\",\n         \"eslint\": \"7.32.0\",\n         \"eslint-config-habitrpg\": \"6.2.0\",\n         \"eslint-plugin-mocha\": \"5.3.0\",\n@@ -5389,11 +5388,6 @@\n         \"url\": \"https://github.com/fb55/domhandler?sponsor=1\"\n       }\n     },\n-    \"node_modules/dompurify\": {\n-      \"version\": \"3.0.6\",\n-      \"resolved\": \"https://registry.npmjs.org/dompurify/-/dompurify-3.0.6.tgz\",\n-      \"integrity\": \"sha512-ilkD8YEnnGh1zJ240uJsW7AzE+2qpbOUYjacomn3AvJ6J4JhKGSZ2nh4wUIXPZrEPppaCLx5jFe8T89Rk8tQ7w==\"\n-    },\n     \"node_modules/domutils\": {\n       \"version\": \"2.8.0\",\n       \"resolved\": \"https://registry.npmjs.org/domutils/-/domutils-2.8.0.tgz\","
            },
            {
                "sha": "e19536a787e62d532bcd693aee61666471d75536",
                "filename": "website/client/package.json",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage.json",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage.json",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fpackage.json?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -25,7 +25,6 @@\n     \"bootstrap\": \"^4.6.0\",\n     \"bootstrap-vue\": \"^2.23.1\",\n     \"core-js\": \"^3.33.1\",\n-    \"dompurify\": \"^3.0.3\",\n     \"eslint\": \"7.32.0\",\n     \"eslint-config-habitrpg\": \"6.2.0\",\n     \"eslint-plugin-mocha\": \"5.3.0\","
            },
            {
                "sha": "5559d62f6b4e02b4edf02c612bab1e9b3f36a39b",
                "filename": "website/client/src/components/auth/registerLoginReset.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 7,
                "changes": 9,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fauth%2FregisterLoginReset.vue",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fauth%2FregisterLoginReset.vue",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fsrc%2Fcomponents%2Fauth%2FregisterLoginReset.vue?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -608,17 +608,17 @@ import axios from 'axios';\n import hello from 'hellojs';\n import debounce from 'lodash/debounce';\n import isEmail from 'validator/es/lib/isEmail';\n-import DOMPurify from 'dompurify';\n import { MINIMUM_PASSWORD_LENGTH } from '@/../../common/script/constants';\n import { buildAppleAuthUrl } from '../../libs/auth';\n-\n+import sanitizeRedirect from '@/mixins/sanitizeRedirect';\n import exclamation from '@/assets/svg/exclamation.svg';\n import gryphon from '@/assets/svg/gryphon.svg';\n import habiticaIcon from '@/assets/svg/logo-horizontal.svg';\n import googleIcon from '@/assets/svg/google.svg';\n import appleIcon from '@/assets/svg/apple_black.svg';\n \n export default {\n+  mixins: [sanitizeRedirect],\n   data () {\n     const data = {\n       username: '',\n@@ -747,11 +747,6 @@ export default {\n         }\n       });\n     }, 500),\n-    sanitizeRedirect (redirect) {\n-      if (!redirect) return '/';\n-      const sanitizedString = DOMPurify.sanitize(redirect).replace(/\\\\|\\/\\/|\\./g, '');\n-      return sanitizedString;\n-    },\n     async register () {\n       // @TODO do not use alert\n       if (!this.email) {"
            },
            {
                "sha": "89f17756b211fa56cfc268a8a1763f5cc17ae9df",
                "filename": "website/client/src/components/static/home.vue",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fstatic%2Fhome.vue",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fstatic%2Fhome.vue",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fsrc%2Fcomponents%2Fstatic%2Fhome.vue?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -784,6 +784,7 @@ import debounce from 'lodash/debounce';\n import isEmail from 'validator/es/lib/isEmail';\n import { MINIMUM_PASSWORD_LENGTH } from '@/../../common/script/constants';\n import { buildAppleAuthUrl } from '../../libs/auth';\n+import sanitizeRedirect from '@/mixins/sanitizeRedirect';\n import googlePlay from '@/assets/images/home/google-play-badge.svg';\n import iosAppStore from '@/assets/images/home/ios-app-store.svg';\n import iphones from '@/assets/images/home/iphones.svg';\n@@ -804,6 +805,7 @@ import makeuseof from '@/assets/images/home/make-use-of.svg';\n import thenewyorktimes from '@/assets/images/home/the-new-york-times.svg';\n \n export default {\n+  mixins: [sanitizeRedirect],\n   data () {\n     return {\n       icons: Object.freeze({\n@@ -923,7 +925,9 @@ export default {\n         groupInvite,\n       });\n \n-      window.location.href = this.$route.query.redirectTo || '/';\n+      const redirect = this.sanitizeRedirect(this.$route.query.redirectTo);\n+\n+      window.location.href = redirect;\n     },\n     playButtonClick () {\n       this.$router.push('/register');"
            },
            {
                "sha": "aea7eddb115d536996ca8e26bea9c7d470a960b8",
                "filename": "website/client/src/mixins/sanitizeRedirect.js",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fmixins%2FsanitizeRedirect.js",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fmixins%2FsanitizeRedirect.js",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fsrc%2Fmixins%2FsanitizeRedirect.js?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -0,0 +1,16 @@\n+export default {\n+  methods: {\n+    sanitizeRedirect (redirect) {\n+      if (!redirect) {\n+        return '/';\n+      }\n+      if (process.env.TRUSTED_DOMAINS.split(',').includes(redirect)) {\n+        return redirect;\n+      }\n+      if (redirect.slice(0, 1) !== '/' || redirect.slice(1, 1) === '/') {\n+        return '/';\n+      }\n+      return redirect;\n+    },\n+  },\n+};"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/HabitRPG/habitica/commits/946ade5da1f52a804ef2ba76d49416c43e8166bf",
        "url": "https://api.github.com/repos/HabitRPG/habitica/commits/946ade5da1f52a804ef2ba76d49416c43e8166bf",
        "html_url": "https://github.com/HabitRPG/habitica/commit/946ade5da1f52a804ef2ba76d49416c43e8166bf",
        "message": "Merge commit from fork\n\nCo-authored-by: Sabe Jones <sabe@habitica.com>",
        "files": [
            {
                "sha": "59e71df90e955d3b404204dbc29555b28d6ac4a3",
                "filename": "website/client/package-lock.json",
                "status": "modified",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage-lock.json",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage-lock.json",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fpackage-lock.json?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -23,7 +23,6 @@\n         \"bootstrap\": \"^4.6.0\",\n         \"bootstrap-vue\": \"^2.23.1\",\n         \"core-js\": \"^3.33.1\",\n-        \"dompurify\": \"^3.0.3\",\n         \"eslint\": \"7.32.0\",\n         \"eslint-config-habitrpg\": \"6.2.0\",\n         \"eslint-plugin-mocha\": \"5.3.0\",\n@@ -5389,11 +5388,6 @@\n         \"url\": \"https://github.com/fb55/domhandler?sponsor=1\"\n       }\n     },\n-    \"node_modules/dompurify\": {\n-      \"version\": \"3.0.6\",\n-      \"resolved\": \"https://registry.npmjs.org/dompurify/-/dompurify-3.0.6.tgz\",\n-      \"integrity\": \"sha512-ilkD8YEnnGh1zJ240uJsW7AzE+2qpbOUYjacomn3AvJ6J4JhKGSZ2nh4wUIXPZrEPppaCLx5jFe8T89Rk8tQ7w==\"\n-    },\n     \"node_modules/domutils\": {\n       \"version\": \"2.8.0\",\n       \"resolved\": \"https://registry.npmjs.org/domutils/-/domutils-2.8.0.tgz\","
            },
            {
                "sha": "e19536a787e62d532bcd693aee61666471d75536",
                "filename": "website/client/package.json",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage.json",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fpackage.json",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fpackage.json?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -25,7 +25,6 @@\n     \"bootstrap\": \"^4.6.0\",\n     \"bootstrap-vue\": \"^2.23.1\",\n     \"core-js\": \"^3.33.1\",\n-    \"dompurify\": \"^3.0.3\",\n     \"eslint\": \"7.32.0\",\n     \"eslint-config-habitrpg\": \"6.2.0\",\n     \"eslint-plugin-mocha\": \"5.3.0\","
            },
            {
                "sha": "5559d62f6b4e02b4edf02c612bab1e9b3f36a39b",
                "filename": "website/client/src/components/auth/registerLoginReset.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 7,
                "changes": 9,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fauth%2FregisterLoginReset.vue",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fauth%2FregisterLoginReset.vue",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fsrc%2Fcomponents%2Fauth%2FregisterLoginReset.vue?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -608,17 +608,17 @@ import axios from 'axios';\n import hello from 'hellojs';\n import debounce from 'lodash/debounce';\n import isEmail from 'validator/es/lib/isEmail';\n-import DOMPurify from 'dompurify';\n import { MINIMUM_PASSWORD_LENGTH } from '@/../../common/script/constants';\n import { buildAppleAuthUrl } from '../../libs/auth';\n-\n+import sanitizeRedirect from '@/mixins/sanitizeRedirect';\n import exclamation from '@/assets/svg/exclamation.svg';\n import gryphon from '@/assets/svg/gryphon.svg';\n import habiticaIcon from '@/assets/svg/logo-horizontal.svg';\n import googleIcon from '@/assets/svg/google.svg';\n import appleIcon from '@/assets/svg/apple_black.svg';\n \n export default {\n+  mixins: [sanitizeRedirect],\n   data () {\n     const data = {\n       username: '',\n@@ -747,11 +747,6 @@ export default {\n         }\n       });\n     }, 500),\n-    sanitizeRedirect (redirect) {\n-      if (!redirect) return '/';\n-      const sanitizedString = DOMPurify.sanitize(redirect).replace(/\\\\|\\/\\/|\\./g, '');\n-      return sanitizedString;\n-    },\n     async register () {\n       // @TODO do not use alert\n       if (!this.email) {"
            },
            {
                "sha": "89f17756b211fa56cfc268a8a1763f5cc17ae9df",
                "filename": "website/client/src/components/static/home.vue",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fstatic%2Fhome.vue",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fcomponents%2Fstatic%2Fhome.vue",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fsrc%2Fcomponents%2Fstatic%2Fhome.vue?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -784,6 +784,7 @@ import debounce from 'lodash/debounce';\n import isEmail from 'validator/es/lib/isEmail';\n import { MINIMUM_PASSWORD_LENGTH } from '@/../../common/script/constants';\n import { buildAppleAuthUrl } from '../../libs/auth';\n+import sanitizeRedirect from '@/mixins/sanitizeRedirect';\n import googlePlay from '@/assets/images/home/google-play-badge.svg';\n import iosAppStore from '@/assets/images/home/ios-app-store.svg';\n import iphones from '@/assets/images/home/iphones.svg';\n@@ -804,6 +805,7 @@ import makeuseof from '@/assets/images/home/make-use-of.svg';\n import thenewyorktimes from '@/assets/images/home/the-new-york-times.svg';\n \n export default {\n+  mixins: [sanitizeRedirect],\n   data () {\n     return {\n       icons: Object.freeze({\n@@ -923,7 +925,9 @@ export default {\n         groupInvite,\n       });\n \n-      window.location.href = this.$route.query.redirectTo || '/';\n+      const redirect = this.sanitizeRedirect(this.$route.query.redirectTo);\n+\n+      window.location.href = redirect;\n     },\n     playButtonClick () {\n       this.$router.push('/register');"
            },
            {
                "sha": "aea7eddb115d536996ca8e26bea9c7d470a960b8",
                "filename": "website/client/src/mixins/sanitizeRedirect.js",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/HabitRPG/habitica/blob/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fmixins%2FsanitizeRedirect.js",
                "raw_url": "https://github.com/HabitRPG/habitica/raw/946ade5da1f52a804ef2ba76d49416c43e8166bf/website%2Fclient%2Fsrc%2Fmixins%2FsanitizeRedirect.js",
                "contents_url": "https://api.github.com/repos/HabitRPG/habitica/contents/website%2Fclient%2Fsrc%2Fmixins%2FsanitizeRedirect.js?ref=946ade5da1f52a804ef2ba76d49416c43e8166bf",
                "patch": "@@ -0,0 +1,16 @@\n+export default {\n+  methods: {\n+    sanitizeRedirect (redirect) {\n+      if (!redirect) {\n+        return '/';\n+      }\n+      if (process.env.TRUSTED_DOMAINS.split(',').includes(redirect)) {\n+        return redirect;\n+      }\n+      if (redirect.slice(0, 1) !== '/' || redirect.slice(1, 1) === '/') {\n+        return '/';\n+      }\n+      return redirect;\n+    },\n+  },\n+};"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/golang/crypto/commits/b4f1988a35dee11ec3e05d6bf3e90b695fbd8909",
        "url": "https://api.github.com/repos/golang/crypto/commits/b4f1988a35dee11ec3e05d6bf3e90b695fbd8909",
        "html_url": "https://github.com/golang/crypto/commit/b4f1988a35dee11ec3e05d6bf3e90b695fbd8909",
        "message": "ssh: make the public key cache a 1-entry FIFO cache\n\nUsers of the the ssh package seem to extremely commonly misuse the\nPublicKeyCallback API, assuming that the key passed in the last call\nbefore a connection is established is the key used for authentication.\nSome users then make authorization decisions based on this key. This\nproperty is not documented, and may not be correct, due to the caching\nbehavior of the package, resulting in users making incorrect\nauthorization decisions about the connection.\n\nThis change makes the cache a one entry FIFO cache, making the assumed\nproperty, that the last call to PublicKeyCallback represents the key\nactually used for authentication, actually hold.\n\nThanks to Damien Tournoud, Patrick Dawkins, Vince Parker, and\nJules Duvivier from the Platform.sh / Upsun engineering team\nfor reporting this issue.\n\nFixes golang/go#70779\nFixes CVE-2024-45337\n\nChange-Id: Ife7c7b4045d8b6bcd7e3a417bdfae370c709797f\nReviewed-on: https://go-review.googlesource.com/c/crypto/+/635315\nReviewed-by: Roland Shoemaker <roland@golang.org>\nAuto-Submit: Gopher Robot <gobot@golang.org>\nReviewed-by: Damien Neil <dneil@google.com>\nReviewed-by: Nicola Murino <nicola.murino@gmail.com>\nLUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>",
        "files": [
            {
                "sha": "5b5ccd96f4539604a0977ab1333208aadfbd4f9f",
                "filename": "ssh/server.go",
                "status": "modified",
                "additions": 11,
                "deletions": 4,
                "changes": 15,
                "blob_url": "https://github.com/golang/crypto/blob/b4f1988a35dee11ec3e05d6bf3e90b695fbd8909/ssh%2Fserver.go",
                "raw_url": "https://github.com/golang/crypto/raw/b4f1988a35dee11ec3e05d6bf3e90b695fbd8909/ssh%2Fserver.go",
                "contents_url": "https://api.github.com/repos/golang/crypto/contents/ssh%2Fserver.go?ref=b4f1988a35dee11ec3e05d6bf3e90b695fbd8909",
                "patch": "@@ -149,15 +149,21 @@ func (s *ServerConfig) AddHostKey(key Signer) {\n }\n \n // cachedPubKey contains the results of querying whether a public key is\n-// acceptable for a user.\n+// acceptable for a user. This is a FIFO cache.\n type cachedPubKey struct {\n \tuser       string\n \tpubKeyData []byte\n \tresult     error\n \tperms      *Permissions\n }\n \n-const maxCachedPubKeys = 16\n+// maxCachedPubKeys is the number of cache entries we store.\n+//\n+// Due to consistent misuse of the PublicKeyCallback API, we have reduced this\n+// to 1, such that the only key in the cache is the most recently seen one. This\n+// forces the behavior that the last call to PublicKeyCallback will always be\n+// with the key that is used for authentication.\n+const maxCachedPubKeys = 1\n \n // pubKeyCache caches tests for public keys.  Since SSH clients\n // will query whether a public key is acceptable before attempting to\n@@ -179,9 +185,10 @@ func (c *pubKeyCache) get(user string, pubKeyData []byte) (cachedPubKey, bool) {\n \n // add adds the given tuple to the cache.\n func (c *pubKeyCache) add(candidate cachedPubKey) {\n-\tif len(c.keys) < maxCachedPubKeys {\n-\t\tc.keys = append(c.keys, candidate)\n+\tif len(c.keys) >= maxCachedPubKeys {\n+\t\tc.keys = c.keys[1:]\n \t}\n+\tc.keys = append(c.keys, candidate)\n }\n \n // ServerConn is an authenticated SSH connection, as seen from the"
            },
            {
                "sha": "ba1bd10e8273732347c1db845102a06da28133f0",
                "filename": "ssh/server_test.go",
                "status": "modified",
                "additions": 49,
                "deletions": 0,
                "changes": 49,
                "blob_url": "https://github.com/golang/crypto/blob/b4f1988a35dee11ec3e05d6bf3e90b695fbd8909/ssh%2Fserver_test.go",
                "raw_url": "https://github.com/golang/crypto/raw/b4f1988a35dee11ec3e05d6bf3e90b695fbd8909/ssh%2Fserver_test.go",
                "contents_url": "https://api.github.com/repos/golang/crypto/contents/ssh%2Fserver_test.go?ref=b4f1988a35dee11ec3e05d6bf3e90b695fbd8909",
                "patch": "@@ -5,6 +5,7 @@\n package ssh\n \n import (\n+\t\"bytes\"\n \t\"errors\"\n \t\"fmt\"\n \t\"io\"\n@@ -299,6 +300,54 @@ func TestBannerError(t *testing.T) {\n \t}\n }\n \n+func TestPublicKeyCallbackLastSeen(t *testing.T) {\n+\tvar lastSeenKey PublicKey\n+\n+\tc1, c2, err := netPipe()\n+\tif err != nil {\n+\t\tt.Fatalf(\"netPipe: %v\", err)\n+\t}\n+\tdefer c1.Close()\n+\tdefer c2.Close()\n+\tserverConf := &ServerConfig{\n+\t\tPublicKeyCallback: func(conn ConnMetadata, key PublicKey) (*Permissions, error) {\n+\t\t\tlastSeenKey = key\n+\t\t\tfmt.Printf(\"seen %#v\\n\", key)\n+\t\t\tif _, ok := key.(*dsaPublicKey); !ok {\n+\t\t\t\treturn nil, errors.New(\"nope\")\n+\t\t\t}\n+\t\t\treturn nil, nil\n+\t\t},\n+\t}\n+\tserverConf.AddHostKey(testSigners[\"ecdsap256\"])\n+\n+\tdone := make(chan struct{})\n+\tgo func() {\n+\t\tdefer close(done)\n+\t\tNewServerConn(c1, serverConf)\n+\t}()\n+\n+\tclientConf := ClientConfig{\n+\t\tUser: \"user\",\n+\t\tAuth: []AuthMethod{\n+\t\t\tPublicKeys(testSigners[\"rsa\"], testSigners[\"dsa\"], testSigners[\"ed25519\"]),\n+\t\t},\n+\t\tHostKeyCallback: InsecureIgnoreHostKey(),\n+\t}\n+\n+\t_, _, _, err = NewClientConn(c2, \"\", &clientConf)\n+\tif err != nil {\n+\t\tt.Fatal(err)\n+\t}\n+\t<-done\n+\n+\texpectedPublicKey := testSigners[\"dsa\"].PublicKey().Marshal()\n+\tlastSeenMarshalled := lastSeenKey.Marshal()\n+\tif !bytes.Equal(lastSeenMarshalled, expectedPublicKey) {\n+\t\tt.Errorf(\"unexpected key: got %#v, want %#v\", lastSeenKey, testSigners[\"dsa\"].PublicKey())\n+\t}\n+}\n+\n type markerConn struct {\n \tclosed uint32\n \tused   uint32"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/struts/commits/1ecfbae46543a83e131404f8dcc84b3d0d554854",
        "url": "https://api.github.com/repos/apache/struts/commits/1ecfbae46543a83e131404f8dcc84b3d0d554854",
        "html_url": "https://github.com/apache/struts/commit/1ecfbae46543a83e131404f8dcc84b3d0d554854",
        "message": "WW-5386 Delete deprecated FileUploadInterceptor",
        "files": [
            {
                "sha": "7065fed1d270e1aed0341931494cde0ceee5f1e7",
                "filename": "core/src/main/java/org/apache/struts2/interceptor/FileUploadInterceptor.java",
                "status": "removed",
                "additions": 0,
                "deletions": 273,
                "changes": 273,
                "blob_url": "https://github.com/apache/struts/blob/9d624069aa61ce1489f863bfc9af08400aca51b5/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptor.java",
                "raw_url": "https://github.com/apache/struts/raw/9d624069aa61ce1489f863bfc9af08400aca51b5/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptor.java?ref=9d624069aa61ce1489f863bfc9af08400aca51b5",
                "patch": "@@ -1,273 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *  http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-package org.apache.struts2.interceptor;\n-\n-import com.opensymphony.xwork2.ActionContext;\n-import com.opensymphony.xwork2.ActionInvocation;\n-import com.opensymphony.xwork2.ActionProxy;\n-import com.opensymphony.xwork2.interceptor.ValidationAware;\n-import jakarta.servlet.http.HttpServletRequest;\n-import org.apache.logging.log4j.LogManager;\n-import org.apache.logging.log4j.Logger;\n-import org.apache.struts2.action.UploadedFilesAware;\n-import org.apache.struts2.dispatcher.Parameter;\n-import org.apache.struts2.dispatcher.multipart.MultiPartRequestWrapper;\n-import org.apache.struts2.dispatcher.multipart.UploadedFile;\n-\n-import java.util.ArrayList;\n-import java.util.Enumeration;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n-\n-/**\n- * <!-- START SNIPPET: description -->\n- * <p>\n- * Interceptor that is based off of {@link MultiPartRequestWrapper}, which is automatically applied for any request that\n- * includes a file. It adds the following parameters, where [File Name] is the name given to the file uploaded by the\n- * HTML form:\n- * </p>\n- * <ul>\n- *\n- * <li>[File Name] : File - the actual File</li>\n- *\n- * <li>[File Name]ContentType : String - the content type of the file</li>\n- *\n- * <li>[File Name]FileName : String - the actual name of the file uploaded (not the HTML name)</li>\n- *\n- * </ul>\n- *\n- * <p>You can get access to these files by merely providing setters in your action that correspond to any of the three\n- * patterns above, such as setDocument(File document), setDocumentContentType(String contentType), etc.\n- * <br>See the example code section.\n- * </p>\n- *\n- * <p> This interceptor will add several field errors, assuming that the action implements {@link ValidationAware}.\n- * These error messages are based on several i18n values stored in struts-messages.properties, a default i18n file\n- * processed for all i18n requests. You can override the text of these messages by providing text for the following\n- * keys:\n- * </p>\n- *\n- * <ul>\n- *\n- * <li>struts.messages.error.uploading - a general error that occurs when the file could not be uploaded</li>\n- *\n- * <li>struts.messages.error.file.too.large - occurs when the uploaded file is too large</li>\n- *\n- * <li>struts.messages.error.content.type.not.allowed - occurs when the uploaded file does not match the expected\n- * content types specified</li>\n- *\n- * <li>struts.messages.error.file.extension.not.allowed - occurs when the uploaded file does not match the expected\n- * file extensions specified</li>\n- *\n- * </ul>\n- * <p>\n- * <!-- END SNIPPET: description -->\n- *\n- * <p><u>Interceptor parameters:</u></p>\n- * <p>\n- * <!-- START SNIPPET: parameters -->\n- *\n- * <ul>\n- *\n- * <li>maximumSize (optional) - the maximum size (in bytes) that the interceptor will allow a file reference to be set\n- * on the action. Note, this is <b>not</b> related to the various properties found in struts.properties.\n- * Default to approximately 2MB.</li>\n- *\n- * <li>allowedTypes (optional) - a comma separated list of content types (ie: text/html) that the interceptor will allow\n- * a file reference to be set on the action. If none is specified allow all types to be uploaded.</li>\n- *\n- * <li>allowedExtensions (optional) - a comma separated list of file extensions (ie: .html) that the interceptor will allow\n- * a file reference to be set on the action. If none is specified allow all extensions to be uploaded.</li>\n- * </ul>\n- * <p>\n- * <p>\n- * <!-- END SNIPPET: parameters -->\n- *\n- * <p><u>Extending the interceptor:</u></p>\n- * <p>\n- * <p>\n- * <p>\n- * <!-- START SNIPPET: extending -->\n- * <p>\n- * You can extend this interceptor and override the acceptFile method to provide more control over which files\n- * are supported and which are not.\n- * </p>\n- * <!-- END SNIPPET: extending -->\n- *\n- * <p><u>Example code:</u></p>\n- *\n- * <pre>\n- * <!-- START SNIPPET: example-configuration -->\n- * &lt;action name=\"doUpload\" class=\"com.example.UploadAction\"&gt;\n- *     &lt;interceptor-ref name=\"fileUpload\"/&gt;\n- *     &lt;interceptor-ref name=\"basicStack\"/&gt;\n- *     &lt;result name=\"success\"&gt;good_result.jsp&lt;/result&gt;\n- * &lt;/action&gt;\n- * <!-- END SNIPPET: example-configuration -->\n- * </pre>\n- * <p>\n- * <!-- START SNIPPET: multipart-note -->\n- * <p>\n- * You must set the encoding to <code>multipart/form-data</code> in the form where the user selects the file to upload.\n- * </p>\n- * <!-- END SNIPPET: multipart-note -->\n- *\n- * <pre>\n- * <!-- START SNIPPET: example-form -->\n- *   &lt;s:form action=\"doUpload\" method=\"post\" enctype=\"multipart/form-data\"&gt;\n- *       &lt;s:file name=\"upload\" label=\"File\"/&gt;\n- *       &lt;s:submit/&gt;\n- *   &lt;/s:form&gt;\n- * <!-- END SNIPPET: example-form -->\n- * </pre>\n- * <p>\n- * And then in your action code you'll have access to the File object if you provide setters according to the\n- * naming convention documented in the start.\n- * </p>\n- *\n- * <pre>\n- * <!-- START SNIPPET: example-action -->\n- *    package com.example;\n- *\n- *    import java.io.File;\n- *    import com.opensymphony.xwork2.ActionSupport;\n- *\n- *    public UploadAction extends ActionSupport {\n- *       private File file;\n- *       private String contentType;\n- *       private String filename;\n- *\n- *       public void setUpload(File file) {\n- *          this.file = file;\n- *       }\n- *\n- *       public void setUploadContentType(String contentType) {\n- *          this.contentType = contentType;\n- *       }\n- *\n- *       public void setUploadFileName(String filename) {\n- *          this.filename = filename;\n- *       }\n- *\n- *       public String execute() {\n- *          //...\n- *          return SUCCESS;\n- *       }\n- *  }\n- * <!-- END SNIPPET: example-action -->\n- * </pre>\n- *\n- * @deprecated since Struts 6.4.0, use {@link ActionFileUploadInterceptor} instead\n- */\n-@Deprecated\n-public class FileUploadInterceptor extends AbstractFileUploadInterceptor {\n-\n-    private static final long serialVersionUID = -4764627478894962478L;\n-\n-    protected static final Logger LOG = LogManager.getLogger(FileUploadInterceptor.class);\n-\n-    /* (non-Javadoc)\n-     * @see com.opensymphony.xwork2.interceptor.Interceptor#intercept(com.opensymphony.xwork2.ActionInvocation)\n-     */\n-\n-    public String intercept(ActionInvocation invocation) throws Exception {\n-        ActionContext ac = invocation.getInvocationContext();\n-\n-        HttpServletRequest request = ac.getServletRequest();\n-\n-        if (!(request instanceof MultiPartRequestWrapper multiWrapper)) {\n-            if (LOG.isDebugEnabled()) {\n-                ActionProxy proxy = invocation.getProxy();\n-                LOG.debug(getTextMessage(STRUTS_MESSAGES_BYPASS_REQUEST_KEY,\n-                        new String[]{proxy.getNamespace(), proxy.getActionName()})\n-                );\n-            }\n-\n-            return invocation.invoke();\n-        }\n-\n-        Object action = invocation.getAction();\n-        if (action instanceof UploadedFilesAware) {\n-            LOG.debug(\"Ignoring action: {} implementing: {} as it will be handled by: {}\",\n-                    invocation.getProxy().getActionName(),\n-                    UploadedFilesAware.class.getSimpleName(),\n-                    ActionFileUploadInterceptor.class.getSimpleName()\n-            );\n-            return invocation.invoke();\n-        }\n-\n-        applyValidation(action, multiWrapper);\n-\n-        // bind allowed Files\n-        Enumeration<String> fileParameterNames = multiWrapper.getFileParameterNames();\n-        while (fileParameterNames != null && fileParameterNames.hasMoreElements()) {\n-            // get the value of this input tag\n-            String inputName = fileParameterNames.nextElement();\n-\n-            // get the content type\n-            String[] contentType = multiWrapper.getContentTypes(inputName);\n-\n-            if (isNonEmpty(contentType)) {\n-                // get the name of the file from the input tag\n-                String[] fileName = multiWrapper.getFileNames(inputName);\n-\n-                if (isNonEmpty(fileName)) {\n-                    // get a File object for the uploaded File\n-                    UploadedFile[] files = multiWrapper.getFiles(inputName);\n-                    if (files != null && files.length > 0) {\n-                        List<UploadedFile> acceptedFiles = new ArrayList<>(files.length);\n-                        List<String> acceptedContentTypes = new ArrayList<>(files.length);\n-                        List<String> acceptedFileNames = new ArrayList<>(files.length);\n-                        String contentTypeName = inputName + \"ContentType\";\n-                        String fileNameName = inputName + \"FileName\";\n-\n-                        for (int index = 0; index < files.length; index++) {\n-                            if (acceptFile(action, files[index], fileName[index], contentType[index], inputName)) {\n-                                acceptedFiles.add(files[index]);\n-                                acceptedContentTypes.add(contentType[index]);\n-                                acceptedFileNames.add(fileName[index]);\n-                            }\n-                        }\n-\n-                        if (!acceptedFiles.isEmpty()) {\n-                            Map<String, Parameter> newParams = new HashMap<>();\n-                            newParams.put(inputName, new Parameter.File(inputName, acceptedFiles.toArray(new UploadedFile[0])));\n-                            newParams.put(contentTypeName, new Parameter.File(contentTypeName, acceptedContentTypes.toArray(new String[0])));\n-                            newParams.put(fileNameName, new Parameter.File(fileNameName, acceptedFileNames.toArray(new String[0])));\n-                            ac.getParameters().appendAll(newParams);\n-                        }\n-                    }\n-                } else {\n-                    if (LOG.isWarnEnabled()) {\n-                        LOG.warn(getTextMessage(action, STRUTS_MESSAGES_INVALID_FILE_KEY, new String[]{inputName}));\n-                    }\n-                }\n-            } else {\n-                if (LOG.isWarnEnabled()) {\n-                    LOG.warn(getTextMessage(action, STRUTS_MESSAGES_INVALID_CONTENT_TYPE_KEY, new String[]{inputName}));\n-                }\n-            }\n-        }\n-\n-        // invoke action\n-        return invocation.invoke();\n-    }\n-\n-}"
            },
            {
                "sha": "9365e83480c2128535217318d349933f47c51cc6",
                "filename": "core/src/main/resources/struts-default.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/apache/struts/blob/1ecfbae46543a83e131404f8dcc84b3d0d554854/core%2Fsrc%2Fmain%2Fresources%2Fstruts-default.xml",
                "raw_url": "https://github.com/apache/struts/raw/1ecfbae46543a83e131404f8dcc84b3d0d554854/core%2Fsrc%2Fmain%2Fresources%2Fstruts-default.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core%2Fsrc%2Fmain%2Fresources%2Fstruts-default.xml?ref=1ecfbae46543a83e131404f8dcc84b3d0d554854",
                "patch": "@@ -57,7 +57,6 @@\n             <interceptor name=\"debugging\" class=\"org.apache.struts2.interceptor.debugging.DebuggingInterceptor\"/>\n             <interceptor name=\"execAndWait\" class=\"org.apache.struts2.interceptor.ExecuteAndWaitInterceptor\"/>\n             <interceptor name=\"exception\" class=\"com.opensymphony.xwork2.interceptor.ExceptionMappingInterceptor\"/>\n-            <interceptor name=\"fileUpload\" class=\"org.apache.struts2.interceptor.FileUploadInterceptor\"/>\n             <interceptor name=\"actionFileUpload\" class=\"org.apache.struts2.interceptor.ActionFileUploadInterceptor\"/>\n             <interceptor name=\"i18n\" class=\"org.apache.struts2.interceptor.I18nInterceptor\"/>\n             <interceptor name=\"logger\" class=\"com.opensymphony.xwork2.interceptor.LoggingInterceptor\"/>\n@@ -114,12 +113,6 @@\n                 <interceptor-ref name=\"workflow\"/>\n             </interceptor-stack>\n \n-            <!-- Sample file upload stack -->\n-            <interceptor-stack name=\"fileUploadStack\">\n-                <interceptor-ref name=\"fileUpload\"/>\n-                <interceptor-ref name=\"basicStack\"/>\n-            </interceptor-stack>\n-\n             <!-- Action based file upload stack -->\n             <interceptor-stack name=\"actionFileUploadStack\">\n                 <interceptor-ref name=\"actionFileUpload\"/>\n@@ -169,7 +162,6 @@\n                 <interceptor-ref name=\"prepare\"/>\n                 <interceptor-ref name=\"chain\"/>\n                 <interceptor-ref name=\"modelDriven\"/>\n-                <interceptor-ref name=\"fileUpload\"/>\n                 <interceptor-ref name=\"actionFileUpload\"/>\n                 <interceptor-ref name=\"staticParams\"/>\n                 <interceptor-ref name=\"actionMappingParams\"/>\n@@ -208,7 +200,6 @@\n                 <interceptor-ref name=\"chain\"/>\n                 <interceptor-ref name=\"scopedModelDriven\"/>\n                 <interceptor-ref name=\"modelDriven\"/>\n-                <interceptor-ref name=\"fileUpload\"/>\n                 <interceptor-ref name=\"actionFileUpload\"/>\n                 <interceptor-ref name=\"checkbox\"/>\n                 <interceptor-ref name=\"datetime\"/>"
            },
            {
                "sha": "872122066a4a4c2c952e1a02adb17de0a2f7491a",
                "filename": "core/src/test/java/org/apache/struts2/interceptor/FileUploadInterceptorTest.java",
                "status": "removed",
                "additions": 0,
                "deletions": 659,
                "changes": 659,
                "blob_url": "https://github.com/apache/struts/blob/9d624069aa61ce1489f863bfc9af08400aca51b5/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptorTest.java",
                "raw_url": "https://github.com/apache/struts/raw/9d624069aa61ce1489f863bfc9af08400aca51b5/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptorTest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptorTest.java?ref=9d624069aa61ce1489f863bfc9af08400aca51b5",
                "patch": "@@ -1,659 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *  http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- */\n-package org.apache.struts2.interceptor;\n-\n-import com.opensymphony.xwork2.ActionContext;\n-import com.opensymphony.xwork2.ActionSupport;\n-import com.opensymphony.xwork2.DefaultLocaleProvider;\n-import com.opensymphony.xwork2.ValidationAwareSupport;\n-import com.opensymphony.xwork2.mock.MockActionInvocation;\n-import com.opensymphony.xwork2.mock.MockActionProxy;\n-import com.opensymphony.xwork2.util.ClassLoaderUtil;\n-import org.apache.commons.fileupload2.jakarta.servlet6.JakartaServletFileUpload;\n-import org.apache.struts2.StrutsInternalTestCase;\n-import org.apache.struts2.action.UploadedFilesAware;\n-import org.apache.struts2.dispatcher.HttpParameters;\n-import org.apache.struts2.dispatcher.multipart.JakartaMultiPartRequest;\n-import org.apache.struts2.dispatcher.multipart.MultiPartRequestWrapper;\n-import org.apache.struts2.dispatcher.multipart.StrutsUploadedFile;\n-import org.apache.struts2.dispatcher.multipart.UploadedFile;\n-import org.assertj.core.util.Files;\n-import org.springframework.mock.web.MockHttpServletRequest;\n-\n-import java.io.File;\n-import java.net.URI;\n-import java.net.URL;\n-import java.nio.charset.StandardCharsets;\n-import java.util.Collection;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Locale;\n-import java.util.Map;\n-\n-import static org.assertj.core.api.Assertions.assertThat;\n-\n-/**\n- * Test case for FileUploadInterceptor.\n- */\n-public class FileUploadInterceptorTest extends StrutsInternalTestCase {\n-\n-    private static final UploadedFile EMPTY_FILE = new UploadedFile() {\n-        @Override\n-        public Long length() {\n-            return 0L;\n-        }\n-\n-        @Override\n-        public String getName() {\n-            return \"\";\n-        }\n-\n-        @Override\n-        public boolean isFile() {\n-            return false;\n-        }\n-\n-        @Override\n-        public boolean delete() {\n-            return false;\n-        }\n-\n-        @Override\n-        public String getAbsolutePath() {\n-            return null;\n-        }\n-\n-        @Override\n-        public File getContent() {\n-            return Files.newTemporaryFile();\n-        }\n-\n-        @Override\n-        public String getOriginalName() {\n-            return null;\n-        }\n-\n-        @Override\n-        public String getContentType() {\n-            return null;\n-        }\n-    };\n-\n-    private FileUploadInterceptor interceptor;\n-    private File tempDir;\n-    private MockHttpServletRequest request;\n-\n-    public void testAcceptFileWithEmptyAllowedTypesAndExtensions() {\n-        // when allowed type is empty\n-        ValidationAwareSupport validation = new ValidationAwareSupport();\n-        boolean ok = interceptor.acceptFile(validation, EMPTY_FILE, \"filename\", \"text/plain\", \"inputName\");\n-\n-        assertTrue(ok);\n-        assertTrue(validation.getFieldErrors().isEmpty());\n-        assertFalse(validation.hasErrors());\n-    }\n-\n-    public void testAcceptFileWithoutEmptyTypes() {\n-        interceptor.setAllowedTypes(\"text/plain\");\n-\n-        // when file is of allowed types\n-        ValidationAwareSupport validation = new ValidationAwareSupport();\n-        boolean ok = interceptor.acceptFile(validation, EMPTY_FILE, \"filename.txt\", \"text/plain\", \"inputName\");\n-\n-        assertTrue(ok);\n-        assertTrue(validation.getFieldErrors().isEmpty());\n-        assertFalse(validation.hasErrors());\n-\n-        // when file is not of allowed types\n-        validation = new ValidationAwareSupport();\n-        boolean notOk = interceptor.acceptFile(validation, EMPTY_FILE, \"filename.html\", \"text/html\", \"inputName\");\n-\n-        assertFalse(notOk);\n-        assertFalse(validation.getFieldErrors().isEmpty());\n-        assertTrue(validation.hasErrors());\n-    }\n-\n-\n-    public void testAcceptFileWithWildcardContent() {\n-        interceptor.setAllowedTypes(\"text/*\");\n-\n-        ValidationAwareSupport validation = new ValidationAwareSupport();\n-        boolean ok = interceptor.acceptFile(validation, EMPTY_FILE, \"filename.txt\", \"text/plain\", \"inputName\");\n-\n-        assertTrue(ok);\n-        assertTrue(validation.getFieldErrors().isEmpty());\n-        assertFalse(validation.hasErrors());\n-\n-        interceptor.setAllowedTypes(\"text/h*\");\n-        validation = new ValidationAwareSupport();\n-        boolean notOk = interceptor.acceptFile(validation, EMPTY_FILE, \"filename.html\", \"text/plain\", \"inputName\");\n-\n-        assertFalse(notOk);\n-        assertFalse(validation.getFieldErrors().isEmpty());\n-        assertTrue(validation.hasErrors());\n-    }\n-\n-    public void testAcceptFileWithoutEmptyExtensions() {\n-        interceptor.setAllowedExtensions(\".txt\");\n-\n-        // when file is of allowed extensions\n-        ValidationAwareSupport validation = new ValidationAwareSupport();\n-        boolean ok = interceptor.acceptFile(validation, EMPTY_FILE, \"filename.txt\", \"text/plain\", \"inputName\");\n-\n-        assertTrue(ok);\n-        assertTrue(validation.getFieldErrors().isEmpty());\n-        assertFalse(validation.hasErrors());\n-\n-        // when file is not of allowed extensions\n-        validation = new ValidationAwareSupport();\n-        boolean notOk = interceptor.acceptFile(validation, EMPTY_FILE, \"filename.html\", \"text/html\", \"inputName\");\n-\n-        assertFalse(notOk);\n-        assertFalse(validation.getFieldErrors().isEmpty());\n-        assertTrue(validation.hasErrors());\n-\n-        //test with multiple extensions\n-        interceptor.setAllowedExtensions(\".txt,.lol\");\n-        validation = new ValidationAwareSupport();\n-        ok = interceptor.acceptFile(validation, EMPTY_FILE, \"filename.lol\", \"text/plain\", \"inputName\");\n-\n-        assertTrue(ok);\n-        assertTrue(validation.getFieldErrors().isEmpty());\n-        assertFalse(validation.hasErrors());\n-    }\n-\n-    public void testAcceptFileWithNoFile() {\n-        interceptor.setAllowedTypes(\"text/plain\");\n-\n-        // when file is not of allowed types\n-        ValidationAwareSupport validation = new ValidationAwareSupport();\n-        boolean notOk = interceptor.acceptFile(validation, null, \"filename.html\", \"text/html\", \"inputName\");\n-\n-        assertFalse(notOk);\n-        assertFalse(validation.getFieldErrors().isEmpty());\n-        assertTrue(validation.hasErrors());\n-        List<String> errors = validation.getFieldErrors().get(\"inputName\");\n-        assertEquals(1, errors.size());\n-        String msg = errors.get(0);\n-        assertTrue(msg.startsWith(\"Error uploading:\"));\n-        assertTrue(msg.indexOf(\"inputName\") > 0);\n-    }\n-\n-    public void testAcceptFileWithMaxSize() throws Exception {\n-        interceptor.setMaximumSize(10L);\n-\n-        // when file is not of allowed types\n-        ValidationAwareSupport validation = new ValidationAwareSupport();\n-\n-        URL url = ClassLoaderUtil.getResource(\"log4j2.xml\", FileUploadInterceptorTest.class);\n-        File file = new File(new URI(url.toString()));\n-        assertTrue(\"log4j2.xml should be in src/test folder\", file.exists());\n-        UploadedFile uploadedFile = StrutsUploadedFile.Builder.create(file)\n-                .withContentType(\"text/html\")\n-                .withOriginalName(\"filename\")\n-                .build();\n-\n-        boolean notOk = interceptor.acceptFile(validation, uploadedFile, \"filename\", \"text/html\", \"inputName\");\n-\n-        assertFalse(notOk);\n-        assertFalse(validation.getFieldErrors().isEmpty());\n-        assertTrue(validation.hasErrors());\n-        List<String> errors = validation.getFieldErrors().get(\"inputName\");\n-        assertEquals(1, errors.size());\n-        String msg = errors.get(0);\n-        // the error message should contain at least this test\n-        assertThat(msg).contains(\n-                \"The file is too large to be uploaded\",\n-                \"inputName\",\n-                \"log4j2.xml\",\n-                \"allowed mx size is 10\"\n-        );\n-    }\n-\n-    public void testNoMultipartRequest() throws Exception {\n-        MyFileupAction action = new MyFileupAction();\n-\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setAction(action);\n-        mai.setResultCode(\"NoMultipart\");\n-        mai.setInvocationContext(ActionContext.getContext());\n-\n-        // if no multipart request it will bypass and execute it\n-        assertEquals(\"NoMultipart\", interceptor.intercept(mai));\n-    }\n-\n-    public void testInvalidContentTypeMultipartRequest() throws Exception {\n-        request.setContentType(\"multipart/form-data\"); // not a multipart contentype\n-        request.setMethod(\"post\");\n-\n-        MyFileupAction action = container.inject(MyFileupAction.class);\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setAction(action);\n-        mai.setResultCode(\"success\");\n-        mai.setInvocationContext(ActionContext.getContext());\n-\n-        ActionContext.getContext().withParameters(HttpParameters.create().build());\n-        ActionContext.getContext().withServletRequest(createMultipartRequestMaxSize(2000));\n-\n-        interceptor.intercept(mai);\n-\n-        assertTrue(action.hasErrors());\n-    }\n-\n-    public void testNoContentMultipartRequest() throws Exception {\n-        request.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-        request.setMethod(\"post\");\n-        request.addHeader(\"Content-type\", \"multipart/form-data\");\n-        request.setContent(null); // there is no content\n-\n-        MyFileupAction action = container.inject(MyFileupAction.class);\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setAction(action);\n-        mai.setResultCode(\"success\");\n-        mai.setInvocationContext(ActionContext.getContext());\n-\n-        ActionContext.getContext().withParameters(HttpParameters.create().build());\n-        ActionContext.getContext().withServletRequest(createMultipartRequestMaxSize(2000));\n-\n-        interceptor.intercept(mai);\n-\n-        assertTrue(action.hasErrors());\n-    }\n-\n-    public void testSuccessUploadOfATextFileMultipartRequest() throws Exception {\n-        request.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-        request.setMethod(\"post\");\n-        request.addHeader(\"Content-type\", \"multipart/form-data; boundary=---1234\");\n-\n-        // inspired by the unit tests for jakarta commons fileupload\n-        String content = (\"-----1234\\r\\n\" +\n-                \"Content-Disposition: form-data; name=\\\"file\\\"; filename=\\\"deleteme.txt\\\"\\r\\n\" +\n-                \"Content-Type: text/html\\r\\n\" +\n-                \"\\r\\n\" +\n-                \"Unit test of FileUploadInterceptor\" +\n-                \"\\r\\n\" +\n-                \"-----1234--\\r\\n\");\n-        request.setContent(content.getBytes(StandardCharsets.US_ASCII));\n-\n-        MyFileupAction action = new MyFileupAction();\n-\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setAction(action);\n-        mai.setResultCode(\"success\");\n-        mai.setInvocationContext(ActionContext.getContext());\n-        Map<String, Object> param = new HashMap<>();\n-        ActionContext.getContext().withParameters(HttpParameters.create(param).build());\n-        ActionContext.getContext().withServletRequest(createMultipartRequestMaxSize(2000));\n-\n-        interceptor.intercept(mai);\n-\n-        assertFalse(action.hasErrors());\n-\n-        HttpParameters parameters = mai.getInvocationContext().getParameters();\n-        assertEquals(3, parameters.keySet().size());\n-        UploadedFile[] files = (UploadedFile[]) parameters.get(\"file\").getObject();\n-        String[] fileContentTypes = parameters.get(\"fileContentType\").getMultipleValues();\n-        String[] fileRealFilenames = parameters.get(\"fileFileName\").getMultipleValues();\n-\n-        assertNotNull(files);\n-        assertNotNull(fileContentTypes);\n-        assertNotNull(fileRealFilenames);\n-        assertEquals(1, files.length);\n-        assertEquals(1, fileContentTypes.length);\n-        assertEquals(1, fileRealFilenames.length);\n-        assertEquals(\"text/html\", fileContentTypes[0]);\n-        assertNotNull(\"deleteme.txt\", fileRealFilenames[0]);\n-    }\n-\n-    /**\n-     * tests whether with multiple files sent with the same name, the ones with forbiddenTypes (see\n-     * FileUploadInterceptor.setAllowedTypes(...) ) are sorted out.\n-     */\n-    public void testMultipleAccept() throws Exception {\n-        final String htmlContent = \"<html><head></head><body>html content</body></html>\";\n-        final String plainContent = \"plain content\";\n-        final String bondary = \"simple boundary\";\n-        final String endline = \"\\r\\n\";\n-\n-        request.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-        request.setMethod(\"POST\");\n-        request.addHeader(\"Content-type\", \"multipart/form-data; boundary=\" + bondary);\n-        String content = encodeTextFile(\"test.html\", \"text/plain\", plainContent) +\n-                encodeTextFile(\"test1.html\", \"text/html\", htmlContent) +\n-                encodeTextFile(\"test2.html\", \"text/html\", htmlContent) +\n-                endline +\n-                endline +\n-                endline +\n-                \"--\" +\n-                bondary +\n-                \"--\" +\n-                endline;\n-        request.setContent(content.getBytes());\n-\n-        assertTrue(JakartaServletFileUpload.isMultipartContent(request));\n-\n-        MyFileupAction action = new MyFileupAction();\n-        container.inject(action);\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setAction(action);\n-        mai.setResultCode(\"success\");\n-        mai.setInvocationContext(ActionContext.getContext());\n-        Map<String, Object> param = new HashMap<>();\n-        ActionContext.getContext().withParameters(HttpParameters.create(param).build());\n-        ActionContext.getContext().withServletRequest(createMultipartRequestMaxSize(2000));\n-\n-        interceptor.setAllowedTypes(\"text/html\");\n-        interceptor.intercept(mai);\n-\n-        HttpParameters parameters = mai.getInvocationContext().getParameters();\n-        assertEquals(3, parameters.keySet().size());\n-        UploadedFile[] files = (UploadedFile[]) parameters.get(\"file\").getObject();\n-        String[] fileContentTypes = parameters.get(\"fileContentType\").getMultipleValues();\n-        String[] fileRealFilenames = parameters.get(\"fileFileName\").getMultipleValues();\n-\n-        assertNotNull(files);\n-        assertNotNull(fileContentTypes);\n-        assertNotNull(fileRealFilenames);\n-        assertEquals(\"files accepted \", 2, files.length);\n-        assertEquals(2, fileContentTypes.length);\n-        assertEquals(2, fileRealFilenames.length);\n-        assertEquals(\"text/html\", fileContentTypes[0]);\n-        assertNotNull(\"test1.html\", fileRealFilenames[0]);\n-    }\n-\n-    public void testUnacceptedNumberOfFiles() throws Exception {\n-        final String htmlContent = \"<html><head></head><body>html content</body></html>\";\n-        final String plainContent = \"plain content\";\n-        final String boundary = \"simple boundary\";\n-        final String endline = \"\\r\\n\";\n-\n-        request.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-        request.setMethod(\"POST\");\n-        request.addHeader(\"Content-type\", \"multipart/form-data; boundary=\" + boundary);\n-        String content = encodeTextFile(\"test.html\", \"text/plain\", plainContent) +\n-                encodeTextFile(\"test1.html\", \"text/html\", htmlContent) +\n-                encodeTextFile(\"test2.html\", \"text/html\", htmlContent) +\n-                encodeTextFile(\"test3.html\", \"text/html\", htmlContent) +\n-                endline +\n-                \"--\" +\n-                boundary +\n-                \"--\" +\n-                endline;\n-        request.setContent(content.getBytes());\n-\n-        assertTrue(JakartaServletFileUpload.isMultipartContent(request));\n-\n-        MyFileupAction action = new MyFileupAction();\n-        container.inject(action);\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setAction(action);\n-        mai.setResultCode(\"success\");\n-        mai.setInvocationContext(ActionContext.getContext());\n-        Map<String, Object> param = new HashMap<>();\n-        ActionContext.getContext()\n-                .withParameters(HttpParameters.create(param).build())\n-                .withServletRequest(createMultipartRequestMaxFiles());\n-\n-        interceptor.setAllowedTypes(\"text/html\");\n-        interceptor.intercept(mai);\n-\n-        HttpParameters parameters = mai.getInvocationContext().getParameters();\n-        assertEquals(0, parameters.keySet().size());\n-        assertEquals(1, action.getActionErrors().size());\n-        assertEquals(\n-                \"Request exceeded allowed number of files! Permitted number of files is: 3!\",\n-                action.getActionErrors().iterator().next()\n-        );\n-    }\n-\n-    public void testMultipartRequestMaxFileSize() throws Exception {\n-        request.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-        request.setMethod(\"post\");\n-        request.addHeader(\"Content-type\", \"multipart/form-data; boundary=---1234\");\n-\n-        // inspired by the unit tests for jakarta commons fileupload\n-        String content = (\"-----1234\\r\\n\" +\n-                \"Content-Disposition: form-data; name=\\\"file\\\"; filename=\\\"deleteme.txt\\\"\\r\\n\" +\n-                \"Content-Type: text/html\\r\\n\" +\n-                \"\\r\\n\" +\n-                \"Unit test of FileUploadInterceptor\" +\n-                \"\\r\\n\" +\n-                \"-----1234--\\r\\n\");\n-        request.setContent(content.getBytes(StandardCharsets.US_ASCII));\n-\n-        MyFileupAction action = container.inject(MyFileupAction.class);\n-\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setAction(action);\n-        mai.setResultCode(\"success\");\n-        mai.setInvocationContext(ActionContext.getContext());\n-        Map<String, Object> param = new HashMap<>();\n-        ActionContext.getContext()\n-                .withParameters(HttpParameters.create(param).build())\n-                .withServletRequest(createMultipartRequestMaxFileSize());\n-\n-        interceptor.intercept(mai);\n-\n-        assertTrue(action.hasActionErrors());\n-\n-        Collection<String> errors = action.getActionErrors();\n-        assertEquals(1, errors.size());\n-        String msg = errors.iterator().next();\n-        // FIXME: the expected size is 40 - length of the string\n-        assertEquals(\n-                \"File deleteme.txt assigned to file exceeded allowed size limit! Max size allowed is: 10 but file was: 11!\",\n-                msg);\n-    }\n-\n-    public void testMultipartRequestMaxStringLength() throws Exception {\n-        request.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-        request.setMethod(\"post\");\n-        request.addHeader(\"Content-type\", \"multipart/form-data; boundary=---1234\");\n-\n-        // inspired by the unit tests for jakarta commons fileupload\n-        String content = (\"-----1234\\r\\n\" +\n-                \"Content-Disposition: form-data; name=\\\"file\\\"; filename=\\\"deleteme.txt\\\"\\r\\n\" +\n-                \"Content-Type: text/html\\r\\n\" +\n-                \"\\r\\n\" +\n-                \"Unit test of FileUploadInterceptor\" +\n-                \"\\r\\n\" +\n-                \"-----1234\\r\\n\" +\n-                \"Content-Disposition: form-data; name=\\\"normalFormField1\\\"\\r\\n\" +\n-                \"\\r\\n\" +\n-                \"it works\" +\n-                \"\\r\\n\" +\n-                \"-----1234\\r\\n\" +\n-                \"Content-Disposition: form-data; name=\\\"normalFormField2\\\"\\r\\n\" +\n-                \"\\r\\n\" +\n-                \"long string should not work\" +\n-                \"\\r\\n\" +\n-                \"-----1234--\\r\\n\");\n-        request.setContent(content.getBytes(StandardCharsets.US_ASCII));\n-\n-        MyFileupAction action = container.inject(MyFileupAction.class);\n-\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setAction(action);\n-        mai.setResultCode(\"success\");\n-        mai.setInvocationContext(ActionContext.getContext());\n-        Map<String, Object> param = new HashMap<>();\n-        ActionContext.getContext()\n-                .withParameters(HttpParameters.create(param).build())\n-                .withServletRequest(createMultipartRequestMaxStringLength());\n-\n-        interceptor.intercept(mai);\n-\n-        assertTrue(action.hasActionErrors());\n-\n-        Collection<String> errors = action.getActionErrors();\n-        assertEquals(1, errors.size());\n-        String msg = errors.iterator().next();\n-        assertEquals(\n-                \"The request parameter \\\"normalFormField2\\\" was too long. Max length allowed is 20, but found 27!\",\n-                msg);\n-    }\n-\n-    public void testMultipartRequestLocalizedError() throws Exception {\n-        request.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-        request.setMethod(\"post\");\n-        request.addHeader(\"Content-type\", \"multipart/form-data; boundary=---1234\");\n-\n-        // inspired by the unit tests for jakarta commons fileupload\n-        String content = (\"-----1234\\r\\n\" +\n-                \"Content-Disposition: form-data; name=\\\"file\\\"; filename=\\\"deleteme.txt\\\"\\r\\n\" +\n-                \"Content-Type: text/html\\r\\n\" +\n-                \"\\r\\n\" +\n-                \"Unit test of FileUploadInterceptor\" +\n-                \"\\r\\n\" +\n-                \"-----1234--\\r\\n\");\n-        request.setContent(content.getBytes(StandardCharsets.US_ASCII));\n-\n-        MyFileupAction action = container.inject(MyFileupAction.class);\n-\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setAction(action);\n-        mai.setResultCode(\"success\");\n-        mai.setInvocationContext(ActionContext.getContext());\n-        Map<String, Object> param = new HashMap<>();\n-        ActionContext.getContext()\n-                .withParameters(HttpParameters.create(param).build())\n-                .withLocale(Locale.GERMAN)\n-                .withServletRequest(createMultipartRequestMaxSize(10));\n-\n-        interceptor.intercept(mai);\n-\n-        assertTrue(action.hasActionErrors());\n-\n-        Collection<String> errors = action.getActionErrors();\n-        assertEquals(1, errors.size());\n-        String msg = errors.iterator().next();\n-        // the error message should contain at least this test\n-        assertTrue(msg.startsWith(\"Der Request \u00fcbertraf die maximal erlaubte Gr\u00f6\u00dfe\"));\n-    }\n-\n-    public void testSkippingUploadedFileAware() throws Exception {\n-        request.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-        request.setMethod(\"post\");\n-        request.addHeader(\"Content-type\", \"multipart/form-data; boundary=---1234\");\n-\n-        // inspired by the unit tests for jakarta commons fileupload\n-        String content = (\"-----1234\\r\\n\" +\n-                \"Content-Disposition: form-data; name=\\\"file\\\"; filename=\\\"deleteme.txt\\\"\\r\\n\" +\n-                \"Content-Type: text/html\\r\\n\" +\n-                \"\\r\\n\" +\n-                \"Unit test of FileUploadInterceptor\" +\n-                \"\\r\\n\" +\n-                \"-----1234--\\r\\n\");\n-        request.setContent(content.getBytes(StandardCharsets.US_ASCII));\n-\n-        MyFileUploadAction action = container.inject(MyFileUploadAction.class);\n-\n-        MockActionInvocation mai = new MockActionInvocation();\n-        mai.setInvocationContext(ActionContext.getContext());\n-        mai.setAction(action);\n-        MockActionProxy map = new MockActionProxy();\n-        map.setActionName(\"uploadedFiles\");\n-        mai.setProxy(map);\n-        ActionContext.getContext()\n-                .withParameters(HttpParameters.create(new HashMap<String, Object>()).build())\n-                .withServletRequest(createMultipartRequestMaxSize(10));\n-\n-        interceptor.intercept(mai);\n-\n-        assertFalse(action.hasActionErrors());\n-    }\n-\n-    private String encodeTextFile(String filename, String contentType, String content) {\n-        return \"\\r\\n\" +\n-                \"--\" +\n-                \"simple boundary\" +\n-                \"\\r\\n\" +\n-                \"Content-Disposition: form-data; name=\\\"\" +\n-                \"file\" +\n-                \"\\\"; filename=\\\"\" +\n-                filename +\n-                \"\\r\\n\" +\n-                \"Content-Type: \" +\n-                contentType +\n-                \"\\r\\n\" +\n-                \"\\r\\n\" +\n-                content;\n-    }\n-\n-    private MultiPartRequestWrapper createMultipartRequestMaxFileSize() {\n-        return createMultipartRequest(-1, 10, -1, -1);\n-    }\n-\n-    private MultiPartRequestWrapper createMultipartRequestMaxFiles() {\n-        return createMultipartRequest(-1, -1, 3, -1);\n-    }\n-\n-    private MultiPartRequestWrapper createMultipartRequestMaxSize(int maxsize) {\n-        return createMultipartRequest(maxsize, -1, -1, -1);\n-    }\n-\n-    private MultiPartRequestWrapper createMultipartRequestMaxStringLength() {\n-        return createMultipartRequest(-1, -1, -1, 20);\n-    }\n-\n-    private MultiPartRequestWrapper createMultipartRequest(int maxsize, int maxfilesize, int maxfiles, int maxStringLength) {\n-        JakartaMultiPartRequest jak = new JakartaMultiPartRequest();\n-        jak.setMaxSize(String.valueOf(maxsize));\n-        jak.setMaxFileSize(String.valueOf(maxfilesize));\n-        jak.setMaxFiles(String.valueOf(maxfiles));\n-        jak.setMaxStringLength(String.valueOf(maxStringLength));\n-        jak.setDefaultEncoding(StandardCharsets.UTF_8.name());\n-        return new MultiPartRequestWrapper(jak, request, tempDir.getAbsolutePath(), new DefaultLocaleProvider());\n-    }\n-\n-    @Override\n-    protected void setUp() throws Exception {\n-        super.setUp();\n-\n-        request = new MockHttpServletRequest();\n-        interceptor = new FileUploadInterceptor();\n-        container.inject(interceptor);\n-        tempDir = File.createTempFile(\"struts\", \"fileupload\");\n-        assertThat(tempDir.delete()).isTrue();\n-        assertThat(tempDir.mkdirs()).isTrue();\n-    }\n-\n-    @Override\n-    protected void tearDown() throws Exception {\n-        interceptor.destroy();\n-        super.tearDown();\n-    }\n-\n-    public static class MyFileupAction extends ActionSupport {\n-    }\n-\n-    public static class MyFileUploadAction extends ActionSupport implements UploadedFilesAware {\n-        private List<UploadedFile> uploadedFiles;\n-\n-        @Override\n-        public void withUploadedFiles(List<UploadedFile> uploadedFiles) {\n-            this.uploadedFiles = uploadedFiles;\n-        }\n-\n-        public List<UploadedFile> getUploadFiles() {\n-            return this.uploadedFiles;\n-        }\n-    }\n-\n-}"
            },
            {
                "sha": "530366af5cc8f1f3de3b552a64f27f2b9cf32b2e",
                "filename": "plugins/bean-validation/src/main/resources/struts-plugin.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/1ecfbae46543a83e131404f8dcc84b3d0d554854/plugins%2Fbean-validation%2Fsrc%2Fmain%2Fresources%2Fstruts-plugin.xml",
                "raw_url": "https://github.com/apache/struts/raw/1ecfbae46543a83e131404f8dcc84b3d0d554854/plugins%2Fbean-validation%2Fsrc%2Fmain%2Fresources%2Fstruts-plugin.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins%2Fbean-validation%2Fsrc%2Fmain%2Fresources%2Fstruts-plugin.xml?ref=1ecfbae46543a83e131404f8dcc84b3d0d554854",
                "patch": "@@ -47,7 +47,7 @@\n                 <interceptor-ref name=\"chain\"/>\n                 <interceptor-ref name=\"scopedModelDriven\"/>\n                 <interceptor-ref name=\"modelDriven\"/>\n-                <interceptor-ref name=\"fileUpload\"/>\n+                <interceptor-ref name=\"actionFileUpload\"/>\n                 <interceptor-ref name=\"checkbox\"/>\n                 <interceptor-ref name=\"datetime\"/>\n                 <interceptor-ref name=\"multiselect\"/>"
            },
            {
                "sha": "88ec44b6febe1452090090995b80bbb8300f253f",
                "filename": "plugins/rest/src/main/resources/struts-plugin.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/1ecfbae46543a83e131404f8dcc84b3d0d554854/plugins%2Frest%2Fsrc%2Fmain%2Fresources%2Fstruts-plugin.xml",
                "raw_url": "https://github.com/apache/struts/raw/1ecfbae46543a83e131404f8dcc84b3d0d554854/plugins%2Frest%2Fsrc%2Fmain%2Fresources%2Fstruts-plugin.xml",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/plugins%2Frest%2Fsrc%2Fmain%2Fresources%2Fstruts-plugin.xml?ref=1ecfbae46543a83e131404f8dcc84b3d0d554854",
                "patch": "@@ -86,7 +86,7 @@\n                 <interceptor-ref name=\"modelDriven\">\n                     <param name=\"refreshModelBeforeResult\">true</param>\n                 </interceptor-ref>\n-                <interceptor-ref name=\"fileUpload\"/>\n+                <interceptor-ref name=\"actionFileUpload\"/>\n                 <interceptor-ref name=\"checkbox\"/>\n                 <interceptor-ref name=\"staticParams\"/>\n                 <interceptor-ref name=\"params\"/>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/struts/commits/3ef9ade8902a63bb560892453eeca02bfddefc78",
        "url": "https://api.github.com/repos/apache/struts/commits/3ef9ade8902a63bb560892453eeca02bfddefc78",
        "html_url": "https://github.com/apache/struts/commit/3ef9ade8902a63bb560892453eeca02bfddefc78",
        "message": "WW-5371 Document how to use the new file upload logic",
        "files": [
            {
                "sha": "92ec9c98b8e7acc5e5f95464eca45816942c94d1",
                "filename": "core/src/main/java/org/apache/struts2/action/UploadedFilesAware.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/struts/blob/3ef9ade8902a63bb560892453eeca02bfddefc78/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Faction%2FUploadedFilesAware.java",
                "raw_url": "https://github.com/apache/struts/raw/3ef9ade8902a63bb560892453eeca02bfddefc78/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Faction%2FUploadedFilesAware.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Faction%2FUploadedFilesAware.java?ref=3ef9ade8902a63bb560892453eeca02bfddefc78",
                "patch": "@@ -33,7 +33,7 @@ public interface UploadedFilesAware {\n      * Notifies action about the multiple uploaded files, when a single file is uploaded\n      * the list will have just one element\n      *\n-     * @param uploadedFiles a list of {@link UploadedFile}.\n+     * @param uploadedFiles a list of {@link UploadedFile}, cannot be null. It can be empty.\n      */\n     void withUploadedFiles(List<UploadedFile> uploadedFiles);\n "
            },
            {
                "sha": "763b5d63418eb54d336e2d28645f047043653e4c",
                "filename": "core/src/main/java/org/apache/struts2/dispatcher/multipart/JakartaStreamMultiPartRequest.java",
                "status": "modified",
                "additions": 5,
                "deletions": 8,
                "changes": 13,
                "blob_url": "https://github.com/apache/struts/blob/3ef9ade8902a63bb560892453eeca02bfddefc78/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Fdispatcher%2Fmultipart%2FJakartaStreamMultiPartRequest.java",
                "raw_url": "https://github.com/apache/struts/raw/3ef9ade8902a63bb560892453eeca02bfddefc78/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Fdispatcher%2Fmultipart%2FJakartaStreamMultiPartRequest.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Fdispatcher%2Fmultipart%2FJakartaStreamMultiPartRequest.java?ref=3ef9ade8902a63bb560892453eeca02bfddefc78",
                "patch": "@@ -44,6 +44,7 @@\n import java.util.List;\n import java.util.Map;\n import java.util.UUID;\n+import java.util.stream.Collectors;\n \n /**\n  * Multi-part form data request adapter for Jakarta Commons FileUpload package that\n@@ -109,16 +110,12 @@ public UploadedFile[] getFile(String fieldName) {\n             return null;\n         }\n \n-        List<UploadedFile> files = new ArrayList<>(infos.size());\n-        for (FileInfo fileInfo : infos) {\n-            UploadedFile file = StrutsUploadedFile.Builder.create(fileInfo.getFile())\n+        return infos.stream().map(fileInfo ->\n+            StrutsUploadedFile.Builder.create(fileInfo.getFile())\n                 .withContentType(fileInfo.contentType)\n                 .withOriginalName(fileInfo.originalName)\n-                .build();\n-            files.add(file);\n-        }\n-\n-        return files.toArray(new UploadedFile[0]);\n+                .build()\n+        ).toArray(UploadedFile[]::new);\n     }\n \n     /* (non-Javadoc)"
            },
            {
                "sha": "c42d125af022517224613ffde182ed941b223c77",
                "filename": "core/src/main/java/org/apache/struts2/interceptor/ActionFileUploadInterceptor.java",
                "status": "modified",
                "additions": 36,
                "deletions": 81,
                "changes": 117,
                "blob_url": "https://github.com/apache/struts/blob/3ef9ade8902a63bb560892453eeca02bfddefc78/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FActionFileUploadInterceptor.java",
                "raw_url": "https://github.com/apache/struts/raw/3ef9ade8902a63bb560892453eeca02bfddefc78/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FActionFileUploadInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FActionFileUploadInterceptor.java?ref=3ef9ade8902a63bb560892453eeca02bfddefc78",
                "patch": "@@ -33,141 +33,96 @@\n import java.util.List;\n \n /**\n- * <!-- START SNIPPET: description -->\n  * <p>\n  * Interceptor that is based off of {@link MultiPartRequestWrapper}, which is automatically applied for any request that\n- * includes a file. It adds the following parameters, where [File Name] is the name given to the file uploaded by the\n- * HTML form:\n+ * includes a file when the support for multi-part request is enabled,\n+ * see <a href=\"https://struts.apache.org/core-developers/file-upload.html#disabling-file-upload-support\">Disabling file upload</a>.\n  * </p>\n- * <ul>\n- *\n- * <li>[File Name] : File - the actual File</li>\n- *\n- * <li>[File Name]ContentType : String - the content type of the file</li>\n  *\n- * <li>[File Name]FileName : String - the actual name of the file uploaded (not the HTML name)</li>\n- *\n- * </ul>\n- *\n- * <p>You can get access to these files by merely providing setters in your action that correspond to any of the three\n- * patterns above, such as setDocument(File document), setDocumentContentType(String contentType), etc.\n- * <br>See the example code section.\n+ * <p>\n+ * You can get access to these files by implementing {@link UploadedFilesAware} interface. The interceptor will then\n+ * call {@link UploadedFilesAware#withUploadedFiles(List)} when there are files which were accepted during the upload process.\n  * </p>\n  *\n- * <p> This interceptor will add several field errors, assuming that the action implements {@link ValidationAware}.\n+ * <p>\n+ * This interceptor will add several field errors, assuming that the action implements {@link ValidationAware}.\n  * These error messages are based on several i18n values stored in struts-messages.properties, a default i18n file\n  * processed for all i18n requests. You can override the text of these messages by providing text for the following\n  * keys:\n  * </p>\n  *\n  * <ul>\n- *\n  * <li>struts.messages.error.uploading - a general error that occurs when the file could not be uploaded</li>\n- *\n  * <li>struts.messages.error.file.too.large - occurs when the uploaded file is too large</li>\n- *\n  * <li>struts.messages.error.content.type.not.allowed - occurs when the uploaded file does not match the expected\n  * content types specified</li>\n- *\n  * <li>struts.messages.error.file.extension.not.allowed - occurs when the uploaded file does not match the expected\n  * file extensions specified</li>\n- *\n  * </ul>\n- * <p>\n- * <!-- END SNIPPET: description -->\n- *\n- * <p><u>Interceptor parameters:</u></p>\n- * <p>\n- * <!-- START SNIPPET: parameters -->\n  *\n+ * <p>Interceptor parameters:</p>\n  * <ul>\n- *\n  * <li>maximumSize (optional) - the maximum size (in bytes) that the interceptor will allow a file reference to be set\n  * on the action. Note, this is <b>not</b> related to the various properties found in struts.properties.\n  * Default to approximately 2MB.</li>\n- *\n  * <li>allowedTypes (optional) - a comma separated list of content types (ie: text/html) that the interceptor will allow\n  * a file reference to be set on the action. If none is specified allow all types to be uploaded.</li>\n- *\n  * <li>allowedExtensions (optional) - a comma separated list of file extensions (ie: .html) that the interceptor will allow\n  * a file reference to be set on the action. If none is specified allow all extensions to be uploaded.</li>\n  * </ul>\n- * <p>\n- * <p>\n- * <!-- END SNIPPET: parameters -->\n  *\n- * <p><u>Extending the interceptor:</u></p>\n- * <p>\n- * <p>\n- * <p>\n- * <!-- START SNIPPET: extending -->\n- * <p>\n- * You can extend this interceptor and override the acceptFile method to provide more control over which files\n- * are supported and which are not.\n- * </p>\n- * <!-- END SNIPPET: extending -->\n- *\n- * <p><u>Example code:</u></p>\n+ * <p>Example code:</p>\n  *\n  * <pre>\n- * <!-- START SNIPPET: example-configuration -->\n  * &lt;action name=\"doUpload\" class=\"com.example.UploadAction\"&gt;\n- *     &lt;interceptor-ref name=\"fileUpload\"/&gt;\n+ *     &lt;interceptor-ref name=\"actionFileUpload\"/&gt;\n  *     &lt;interceptor-ref name=\"basicStack\"/&gt;\n  *     &lt;result name=\"success\"&gt;good_result.jsp&lt;/result&gt;\n  * &lt;/action&gt;\n- * <!-- END SNIPPET: example-configuration -->\n  * </pre>\n  * <p>\n- * <!-- START SNIPPET: multipart-note -->\n  * <p>\n  * You must set the encoding to <code>multipart/form-data</code> in the form where the user selects the file to upload.\n  * </p>\n- * <!-- END SNIPPET: multipart-note -->\n- *\n  * <pre>\n- * <!-- START SNIPPET: example-form -->\n  *   &lt;s:form action=\"doUpload\" method=\"post\" enctype=\"multipart/form-data\"&gt;\n  *       &lt;s:file name=\"upload\" label=\"File\"/&gt;\n  *       &lt;s:submit/&gt;\n  *   &lt;/s:form&gt;\n- * <!-- END SNIPPET: example-form -->\n  * </pre>\n  * <p>\n  * And then in your action code you'll have access to the File object if you provide setters according to the\n  * naming convention documented in the start.\n  * </p>\n  *\n  * <pre>\n- * <!-- START SNIPPET: example-action -->\n- *    package com.example;\n- *\n- *    import java.io.File;\n- *    import com.opensymphony.xwork2.ActionSupport;\n- *\n- *    public UploadAction extends ActionSupport {\n- *       private File file;\n- *       private String contentType;\n- *       private String filename;\n- *\n- *       public void setUpload(File file) {\n- *          this.file = file;\n- *       }\n- *\n- *       public void setUploadContentType(String contentType) {\n- *          this.contentType = contentType;\n- *       }\n- *\n- *       public void setUploadFileName(String filename) {\n- *          this.filename = filename;\n- *       }\n- *\n- *       public String execute() {\n- *          //...\n- *          return SUCCESS;\n- *       }\n+ *  package com.example;\n+ *\n+ *  import java.io.File;\n+ *  import com.opensymphony.xwork2.ActionSupport;\n+ *  import org.apache.struts2.action.UploadedFilesAware;\n+ *\n+ *  public UploadAction extends ActionSupport implements UploadedFilesAware {\n+ *    private UploadedFile uploadedFile;\n+ *    private String contentType;\n+ *    private String fileName;\n+ *    private String originalName;\n+ *\n+ *    &#064;Override\n+ *    public void withUploadedFiles(List<UploadedFile> uploadedFiles) {\n+ *        if (!uploadedFiles.isEmpty() > 0) {\n+ *            this.uploadedFile = uploadedFiles.get(0);\n+ *            this.fileName = uploadedFile.getName();\n+ *            this.contentType = uploadedFile.getContentType();\n+ *            this.originalName = uploadedFile.getOriginalName();\n+ *        }\n+ *    }\n+ *\n+ *    public String execute() {\n+ *       //...\n+ *       return SUCCESS;\n+ *    }\n  *  }\n- * <!-- END SNIPPET: example-action -->\n  * </pre>\n  */\n public class ActionFileUploadInterceptor extends AbstractFileUploadInterceptor {"
            },
            {
                "sha": "86f8a64be0a2f02501b4de94f8f0d57a2cde8bcf",
                "filename": "core/src/main/java/org/apache/struts2/interceptor/FileUploadInterceptor.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/struts/blob/3ef9ade8902a63bb560892453eeca02bfddefc78/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptor.java",
                "raw_url": "https://github.com/apache/struts/raw/3ef9ade8902a63bb560892453eeca02bfddefc78/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptor.java?ref=3ef9ade8902a63bb560892453eeca02bfddefc78",
                "patch": "@@ -172,7 +172,10 @@\n  *  }\n  * <!-- END SNIPPET: example-action -->\n  * </pre>\n+ *\n+ * @deprecated since Struts 6.4.0, use {@link ActionFileUploadInterceptor} instead\n  */\n+@Deprecated\n public class FileUploadInterceptor extends AbstractFileUploadInterceptor {\n \n     private static final long serialVersionUID = -4764627478894962478L;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/struts/commits/930fef7679d7247db9e460c146b1698a9d7ad1e4",
        "url": "https://api.github.com/repos/apache/struts/commits/930fef7679d7247db9e460c146b1698a9d7ad1e4",
        "html_url": "https://github.com/apache/struts/commit/930fef7679d7247db9e460c146b1698a9d7ad1e4",
        "message": "Merge pull request #1180 from henrikplate/fix-CVE-2024-53677\n\nFix CVE-2024-53677 in 2-3-x",
        "files": [
            {
                "sha": "056ba229156f95b7aa14aba7a1c0ec3840cba8e5",
                "filename": "core/src/main/java/org/apache/struts2/interceptor/FileUploadInterceptor.java",
                "status": "modified",
                "additions": 12,
                "deletions": 9,
                "changes": 21,
                "blob_url": "https://github.com/apache/struts/blob/930fef7679d7247db9e460c146b1698a9d7ad1e4/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptor.java",
                "raw_url": "https://github.com/apache/struts/raw/930fef7679d7247db9e460c146b1698a9d7ad1e4/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptor.java",
                "contents_url": "https://api.github.com/repos/apache/struts/contents/core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fstruts2%2Finterceptor%2FFileUploadInterceptor.java?ref=930fef7679d7247db9e460c146b1698a9d7ad1e4",
                "patch": "@@ -306,9 +306,9 @@ public String intercept(ActionInvocation invocation) throws Exception {\n                         if (!acceptedFiles.isEmpty()) {\n                             Map<String, Object> params = ac.getParameters();\n \n-                            putCaseInsensitive(params, inputName, acceptedFiles.toArray(new File[acceptedFiles.size()]));\n-                            putCaseInsensitive(params, contentTypeName, acceptedContentTypes.toArray(new String[acceptedContentTypes.size()]));\n-                            putCaseInsensitive(params, fileNameName, acceptedFileNames.toArray(new String[acceptedFileNames.size()]));\n+                            params.put(inputName, acceptedFiles.toArray(new File[acceptedFiles.size()]));\n+                            putWithCheck(params, contentTypeName, acceptedContentTypes.toArray(new String[acceptedContentTypes.size()]));\n+                            putWithCheck(params, fileNameName, acceptedFileNames.toArray(new String[acceptedFileNames.size()]));\n                         }\n                     }\n                 } else {\n@@ -328,19 +328,22 @@ public String intercept(ActionInvocation invocation) throws Exception {\n     }\n \n     /**\n-     * Removes existing parameters with identical name (case-insensitive) before adding the given parameter.\n-     * Minimal invasiv solution to fix CVE-2023-50164 for the 2.3.x branch.\n+     * Removes existing parameters that contain the given name (case-insensitive) before adding the parameter.\n+     * Minimal invasiv solution to fix CVE-2023-50164 and CVE-2024-53677 for the 2.3.x branch.\n+     * For example, malicious parameters \"uploadFileName\" (CVE-2023-50164) or \"top.uploadFileName\" (CVE-2024-53677)\n+     * would be removed from the map before adding the legitimate parameter \"UploadFileName\".\n      * \n      * @param params - parameters to update.\n-     * @param key    - parameter name (compared case-insensitive with existing ones).\n+     * @param key    - parameter name (compared with existing ones).\n      * @param value  - parameter value.\n      */\n-    private void putCaseInsensitive(Map<String, Object> params, String key, Object value) {\n-        // Remove existing map entry if its key is equal to the given key (case-insensitive)\n+    private void putWithCheck(Map<String, Object> params, String key, Object value) {\n+        // Remove existing map entry if it contains the given key (a check for case- \n+        // insensitive equality does not catch all OGNL expressions, cf. CVE-2024-53677).\n         Iterator<Map.Entry<String, Object>> iterator = params.entrySet().iterator();\n         while (iterator.hasNext()) {\n             Map.Entry<String, Object> entry = iterator.next();\n-            if (key.equalsIgnoreCase(entry.getKey())) {\n+            if (entry.getKey().toLowerCase().contains(key.toLowerCase())) {\n                 iterator.remove();\n             }\n         }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/sigstore/sigstore-python/commits/300b502ae99ebfaace124f1f4e422a6a669369cf",
        "url": "https://api.github.com/repos/sigstore/sigstore-python/commits/300b502ae99ebfaace124f1f4e422a6a669369cf",
        "html_url": "https://github.com/sigstore/sigstore-python/commit/300b502ae99ebfaace124f1f4e422a6a669369cf",
        "message": "fix: require an inclusion promise when log integration time is used (#1247)",
        "files": [
            {
                "sha": "109106b52270b5e050a9e06bc616799d26271d1e",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/sigstore/sigstore-python/blob/300b502ae99ebfaace124f1f4e422a6a669369cf/CHANGELOG.md",
                "raw_url": "https://github.com/sigstore/sigstore-python/raw/300b502ae99ebfaace124f1f4e422a6a669369cf/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-python/contents/CHANGELOG.md?ref=300b502ae99ebfaace124f1f4e422a6a669369cf",
                "patch": "@@ -36,6 +36,10 @@ All versions prior to 0.9.0 are untracked.\n   verifying legacy bundles was never shown\n   ([#1198](https://github.com/sigstore/sigstore-python/pull/1198))\n \n+* Strengthened the requirement that an inclusion promise is present\n+  *if* no other source of signed time is present\n+  ([#1247](https://github.com/sigstore/sigstore-python/pull/1247))\n+\n ## [3.5.3]\n \n ### Fixed"
            },
            {
                "sha": "e9693cc9faaff113641fb31406a7760740c41e3e",
                "filename": "sigstore/models.py",
                "status": "modified",
                "additions": 13,
                "deletions": 2,
                "changes": 15,
                "blob_url": "https://github.com/sigstore/sigstore-python/blob/300b502ae99ebfaace124f1f4e422a6a669369cf/sigstore%2Fmodels.py",
                "raw_url": "https://github.com/sigstore/sigstore-python/raw/300b502ae99ebfaace124f1f4e422a6a669369cf/sigstore%2Fmodels.py",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-python/contents/sigstore%2Fmodels.py?ref=300b502ae99ebfaace124f1f4e422a6a669369cf",
                "patch": "@@ -525,8 +525,11 @@ def _verify(self) -> None:\n         # * For 0.2+, an inclusion proof is required; the client MUST\n         #   verify the inclusion proof. The inclusion prof MUST contain\n         #   a checkpoint.\n-        #   The inclusion promise is NOT required; if present, the client\n-        #   SHOULD verify it.\n+        #\n+        #   The inclusion promise is NOT required if another source of signed\n+        #   time (such as a signed timestamp) is present. If no other source\n+        #   of signed time is present, then the inclusion promise MUST be\n+        #   present.\n         #\n         # Before all of this, we require that the inclusion proof be present\n         # (when constructing the LogEntry).\n@@ -543,6 +546,14 @@ def _verify(self) -> None:\n             if not log_entry.inclusion_proof.checkpoint:\n                 raise InvalidBundle(\"expected checkpoint in inclusion proof\")\n \n+            if (\n+                not log_entry.inclusion_promise\n+                and not self._inner.verification_material.timestamp_verification_data.rfc3161_timestamps\n+            ):\n+                raise InvalidBundle(\n+                    \"bundle must contain an inclusion promise or signed timestamp(s)\"\n+                )\n+\n         self._log_entry = log_entry\n \n     @property"
            },
            {
                "sha": "59437caf14d015b541ee684a76c68e2b0e50b5aa",
                "filename": "sigstore/verify/verifier.py",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/sigstore/sigstore-python/blob/300b502ae99ebfaace124f1f4e422a6a669369cf/sigstore%2Fverify%2Fverifier.py",
                "raw_url": "https://github.com/sigstore/sigstore-python/raw/300b502ae99ebfaace124f1f4e422a6a669369cf/sigstore%2Fverify%2Fverifier.py",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-python/contents/sigstore%2Fverify%2Fverifier.py?ref=300b502ae99ebfaace124f1f4e422a6a669369cf",
                "patch": "@@ -227,7 +227,12 @@ def _establish_time(self, bundle: Bundle) -> List[TimestampVerificationResult]:\n \n         # If a timestamp from the Transparency Service is available, the Verifier MUST\n         # perform path validation using the timestamp from the Transparency Service.\n-        if timestamp := bundle.log_entry.integrated_time:\n+        # NOTE: We only include this timestamp if it's accompanied by an inclusion\n+        # promise that cryptographically binds it. We verify the inclusion promise\n+        # itself later, as part of log entry verification.\n+        if (\n+            timestamp := bundle.log_entry.integrated_time\n+        ) and bundle.log_entry.inclusion_promise:\n             verified_timestamps.append(\n                 TimestampVerificationResult(\n                     source=TimestampSource.TRANSPARENCY_SERVICE,"
            },
            {
                "sha": "4ac2ecef5ce13381596e607f73a81fff79a5b4bf",
                "filename": "test/assets/bundle_v3_github.whl.sigstore",
                "status": "modified",
                "additions": 62,
                "deletions": 1,
                "changes": 63,
                "blob_url": "https://github.com/sigstore/sigstore-python/blob/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Fassets%2Fbundle_v3_github.whl.sigstore",
                "raw_url": "https://github.com/sigstore/sigstore-python/raw/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Fassets%2Fbundle_v3_github.whl.sigstore",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-python/contents/test%2Fassets%2Fbundle_v3_github.whl.sigstore?ref=300b502ae99ebfaace124f1f4e422a6a669369cf",
                "patch": "@@ -1 +1,62 @@\n-{\"mediaType\": \"application/vnd.dev.sigstore.bundle+json;version=0.2\", \"verificationMaterial\": {\"x509CertificateChain\": {\"certificates\": [{\"rawBytes\": \"MIIGzzCCBlSgAwIBAgIUM29bvYkrDKnBVZmVeloTUMlZqNYwCgYIKoZIzj0EAwMwNzEVMBMGA1UEChMMc2lnc3RvcmUuZGV2MR4wHAYDVQQDExVzaWdzdG9yZS1pbnRlcm1lZGlhdGUwHhcNMjQwMzE5MjI0MTE1WhcNMjQwMzE5MjI1MTE1WjAAMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE1q8wmpmK0vesCD05ZE1o5Jyu+g/CtLZLXNEZiIomh1jquPMCZrhlPdOfzQws+E+IUBX3pcVUxtn4rYKnMH39oaOCBXMwggVvMA4GA1UdDwEB/wQEAwIHgDATBgNVHSUEDDAKBggrBgEFBQcDAzAdBgNVHQ4EFgQU0PaUbhtp84Orb2YatvZkIjkZiOEwHwYDVR0jBBgwFoAU39Ppz1YkEZb5qNjpKFWixi4YZD8wZgYDVR0RAQH/BFwwWoZYaHR0cHM6Ly9naXRodWIuY29tL3RyYWlsb2ZiaXRzL3JmYzg3ODUucHkvLmdpdGh1Yi93b3JrZmxvd3MvcmVsZWFzZS55bWxAcmVmcy90YWdzL3YwLjEuMjA5BgorBgEEAYO/MAEBBCtodHRwczovL3Rva2VuLmFjdGlvbnMuZ2l0aHVidXNlcmNvbnRlbnQuY29tMBUGCisGAQQBg78wAQIEB3JlbGVhc2UwNgYKKwYBBAGDvzABAwQoZDhiNGE2NDQ1ZjM4YzQ4YjkxMzdhODA5OTcwNmQ5YjgwNzMxNDZlNDAVBgorBgEEAYO/MAEEBAdyZWxlYXNlMCQGCisGAQQBg78wAQUEFnRyYWlsb2ZiaXRzL3JmYzg3ODUucHkwHgYKKwYBBAGDvzABBgQQcmVmcy90YWdzL3YwLjEuMjA7BgorBgEEAYO/MAEIBC0MK2h0dHBzOi8vdG9rZW4uYWN0aW9ucy5naXRodWJ1c2VyY29udGVudC5jb20waAYKKwYBBAGDvzABCQRaDFhodHRwczovL2dpdGh1Yi5jb20vdHJhaWxvZmJpdHMvcmZjODc4NS5weS8uZ2l0aHViL3dvcmtmbG93cy9yZWxlYXNlLnltbEByZWZzL3RhZ3MvdjAuMS4yMDgGCisGAQQBg78wAQoEKgwoZDhiNGE2NDQ1ZjM4YzQ4YjkxMzdhODA5OTcwNmQ5YjgwNzMxNDZlNDAdBgorBgEEAYO/MAELBA8MDWdpdGh1Yi1ob3N0ZWQwOQYKKwYBBAGDvzABDAQrDClodHRwczovL2dpdGh1Yi5jb20vdHJhaWxvZmJpdHMvcmZjODc4NS5weTA4BgorBgEEAYO/MAENBCoMKGQ4YjRhNjQ0NWYzOGM0OGI5MTM3YTgwOTk3MDZkOWI4MDczMTQ2ZTQwIAYKKwYBBAGDvzABDgQSDBByZWZzL3RhZ3MvdjAuMS4yMBkGCisGAQQBg78wAQ8ECwwJNzY4MjEzOTk3MC4GCisGAQQBg78wARAEIAweaHR0cHM6Ly9naXRodWIuY29tL3RyYWlsb2ZiaXRzMBcGCisGAQQBg78wAREECQwHMjMxNDQyMzBoBgorBgEEAYO/MAESBFoMWGh0dHBzOi8vZ2l0aHViLmNvbS90cmFpbG9mYml0cy9yZmM4Nzg1LnB5Ly5naXRodWIvd29ya2Zsb3dzL3JlbGVhc2UueW1sQHJlZnMvdGFncy92MC4xLjIwOAYKKwYBBAGDvzABEwQqDChkOGI0YTY0NDVmMzhjNDhiOTEzN2E4MDk5NzA2ZDliODA3MzE0NmU0MBcGCisGAQQBg78wARQECQwHcmVsZWFzZTBcBgorBgEEAYO/MAEVBE4MTGh0dHBzOi8vZ2l0aHViLmNvbS90cmFpbG9mYml0cy9yZmM4Nzg1LnB5L2FjdGlvbnMvcnVucy84MzUxMDU4NTAxL2F0dGVtcHRzLzEwFgYKKwYBBAGDvzABFgQIDAZwdWJsaWMwgYoGCisGAQQB1nkCBAIEfAR6AHgAdgDdPTBqxscRMmMZHhyZZzcCokpeuN48rf+HinKALynujgAAAY5Y4EK+AAAEAwBHMEUCIDagfjpw1AZX374vFXGDSZgJ9Kqrcq7Tk/Us3f7nmVQ1AiEA4esGBrDhflbIUujUmYC3eUWFFBgXHfABLiSDwciTQw8wCgYIKoZIzj0EAwMDaQAwZgIxAM6gKI5vKoqcvTkv87Foq3WXNYmAhPj3qaQ5ocXQXsWzHeNWGB6lSHTG3ENyapqYBgIxAMJW9ly3JXEdI5ydHfz+GZoh1kyc0XFUPp4V4kVjnUXY+KtoQWKSPHaZMkYC/szXhg==\"}]}, \"tlogEntries\": [{\"logIndex\": \"79605083\", \"logId\": {\"keyId\": \"wNI9atQGlz+VWfO6LRygH4QUfY/8W4RFwiT5i5WRgB0=\"}, \"kindVersion\": {\"kind\": \"hashedrekord\", \"version\": \"0.0.1\"}, \"integratedTime\": \"1710888076\", \"inclusionPromise\": {\"signedEntryTimestamp\": \"MEYCIQD8ohK48/Ls8D4Qd3dQZl6geplAt0p5Sgpa1wabniB/ZgIhALsVfKCe1m2KKtaEImxijm5bO2K49NltHWafJE2a1hnr\"}, \"inclusionProof\": {\"logIndex\": \"75441652\", \"rootHash\": \"uAqI3id6JHPMMNUltHIKHuX1kVHpm5y7jSfnbaRO+E4=\", \"treeSize\": \"75441653\", \"hashes\": [\"XoeIGlDW7f2lVjTlQEXPaV7szUXY2BECAEKtNA/lgfk=\", \"Pz5CyFQH78eikJoZuJ44Ls4R5najWJ1nKWunxb/vxeM=\", \"COo4wZnRb/d6zZOa7RP1euSRFb7H5EX5bYXs4HEQ0uU=\", \"1A4EnFDN5UCHjrJDWPuYDmY+ZLb4B+Jvis+k3ti+wjs=\", \"bBpWKtQryG7/tMDt9HDvKk/Fp3S+q7gTnYF56qGKMiI=\", \"ZR8qbYzXTNaK4SaofTZtbR0srNmOJ0Yx891OF5/G2gQ=\", \"7MueyMCRkh/GaluPkJl3xQFyXFq/SS9xykP299KtvS0=\", \"kFt/VRwfXksHcnd9vpdeifz3N16KyWQoDxAPfLlRwTA=\", \"gtt9e0foHZTCS9w+epNsmDWbwvX4FNV1EAg0rhxLfjg=\", \"BGqH+LzVuhuqCLiUvBJaB2hlsvtu2a15qq1WGw6mG44=\", \"OeS7D4kPES7ChE7kWSEmhbAMqBcKVj/z8/afMK4Y3pI=\", \"JtjqvAqFyXXYjWlZfDzElHpEzdBjsz1LmGFJuYx0kTU=\", \"s/ZIVcfcD4/nuZwUtQf4ydGsIAkGTPTzk3b0zhUC95k=\", \"YU1jZY/fp5tJdGF/i+/7ez8107O4/lOUp7acMPFEaOA=\", \"7Z18YLBAvejEV4nJHIKoks/xlijnhR005qTW2w4QtHg=\", \"98enzMaC+x5oCMvIZQA5z8vu2apDMCFvE/935NfuPw8=\"], \"checkpoint\": {\"envelope\": \"rekor.sigstore.dev - 2605736670972794746\\n75441653\\nuAqI3id6JHPMMNUltHIKHuX1kVHpm5y7jSfnbaRO+E4=\\n\\n\\u2014 rekor.sigstore.dev wNI9ajBGAiEA5perJLLm94gCQOQT5/vO29OXWNZ1SoengZDZ/U6vsOUCIQDBL0BIkCjWGR6V622znnVpXF5D1g0jPgajBlHh8uSc8g==\\n\"}}, \"canonicalizedBody\": \"eyJhcGlWZXJzaW9uIjoiMC4wLjEiLCJraW5kIjoiaGFzaGVkcmVrb3JkIiwic3BlYyI6eyJkYXRhIjp7Imhhc2giOnsiYWxnb3JpdGhtIjoic2hhMjU2IiwidmFsdWUiOiJjNGU5MmU5ZWNjODI4YmVmMmFhN2RiYTFkZThhYzk4MzUxMWY3NTMyYTBkZjExYzc3MGQzOTA5OWEyNWNmMjAxIn19LCJzaWduYXR1cmUiOnsiY29udGVudCI6Ik1FWUNJUUNlSDZFM01wWm5nV0E2UlBnOEhBbC9aNzY0aFRGWXljTnlGM1IrbVBUU2JBSWhBUGdNUzhxQk04bENFVTJYVzc2NW15TU16Mnp1eXU5aVRGNDBQSCtYWmxKUSIsInB1YmxpY0tleSI6eyJjb250ZW50IjoiTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVZDZla05EUW14VFowRjNTVUpCWjBsVlRUSTVZblpaYTNKRVMyNUNWbHB0Vm1Wc2IxUlZUV3hhY1U1WmQwTm5XVWxMYjFwSmVtb3dSVUYzVFhjS1RucEZWazFDVFVkQk1WVkZRMmhOVFdNeWJHNWpNMUoyWTIxVmRWcEhWakpOVWpSM1NFRlpSRlpSVVVSRmVGWjZZVmRrZW1SSE9YbGFVekZ3WW01U2JBcGpiVEZzV2tkc2FHUkhWWGRJYUdOT1RXcFJkMDE2UlRWTmFra3dUVlJGTVZkb1kwNU5hbEYzVFhwRk5VMXFTVEZOVkVVeFYycEJRVTFHYTNkRmQxbElDa3R2V2tsNmFqQkRRVkZaU1V0dldrbDZhakJFUVZGalJGRm5RVVV4Y1RoM2JYQnRTekIyWlhORFJEQTFXa1V4YnpWS2VYVXJaeTlEZEV4YVRGaE9SVm9LYVVsdmJXZ3hhbkYxVUUxRFduSm9iRkJrVDJaNlVYZHpLMFVyU1ZWQ1dETndZMVpWZUhSdU5ISlpTMjVOU0RNNWIyRlBRMEpZVFhkbloxWjJUVUUwUndwQk1WVmtSSGRGUWk5M1VVVkJkMGxJWjBSQlZFSm5UbFpJVTFWRlJFUkJTMEpuWjNKQ1owVkdRbEZqUkVGNlFXUkNaMDVXU0ZFMFJVWm5VVlV3VUdGVkNtSm9kSEE0TkU5eVlqSlpZWFIyV210SmFtdGFhVTlGZDBoM1dVUldVakJxUWtKbmQwWnZRVlV6T1ZCd2VqRlphMFZhWWpWeFRtcHdTMFpYYVhocE5Ga0tXa1E0ZDFwbldVUldVakJTUVZGSUwwSkdkM2RYYjFwWllVaFNNR05JVFRaTWVUbHVZVmhTYjJSWFNYVlpNamwwVEROU2VWbFhiSE5pTWxwcFlWaFNlZ3BNTTBwdFdYcG5NMDlFVlhWalNHdDJURzFrY0dSSGFERlphVGt6WWpOS2NscHRlSFprTTAxMlkyMVdjMXBYUm5wYVV6VTFZbGQ0UVdOdFZtMWplVGt3Q2xsWFpIcE1NMWwzVEdwRmRVMXFRVFZDWjI5eVFtZEZSVUZaVHk5TlFVVkNRa04wYjJSSVVuZGplbTkyVEROU2RtRXlWblZNYlVacVpFZHNkbUp1VFhVS1dqSnNNR0ZJVm1sa1dFNXNZMjFPZG1KdVVteGlibEYxV1RJNWRFMUNWVWREYVhOSFFWRlJRbWMzT0hkQlVVbEZRak5LYkdKSFZtaGpNbFYzVG1kWlN3cExkMWxDUWtGSFJIWjZRVUpCZDFGdldrUm9hVTVIUlRKT1JGRXhXbXBOTkZsNlVUUlphbXQ0VFhwa2FFOUVRVFZQVkdOM1RtMVJOVmxxWjNkT2VrMTRDazVFV214T1JFRldRbWR2Y2tKblJVVkJXVTh2VFVGRlJVSkJaSGxhVjNoc1dWaE9iRTFEVVVkRGFYTkhRVkZSUW1jM09IZEJVVlZGUm01U2VWbFhiSE1LWWpKYWFXRllVbnBNTTBwdFdYcG5NMDlFVlhWalNHdDNTR2RaUzB0M1dVSkNRVWRFZG5wQlFrSm5VVkZqYlZadFkzazVNRmxYWkhwTU0xbDNUR3BGZFFwTmFrRTNRbWR2Y2tKblJVVkJXVTh2VFVGRlNVSkRNRTFMTW1nd1pFaENlazlwT0haa1J6bHlXbGMwZFZsWFRqQmhWemwxWTNrMWJtRllVbTlrVjBveENtTXlWbmxaTWpsMVpFZFdkV1JETldwaU1qQjNZVUZaUzB0M1dVSkNRVWRFZG5wQlFrTlJVbUZFUm1odlpFaFNkMk42YjNaTU1tUndaRWRvTVZscE5Xb0tZakl3ZG1SSVNtaGhWM2gyV20xS2NHUklUWFpqYlZwcVQwUmpORTVUTlhkbFV6aDFXakpzTUdGSVZtbE1NMlIyWTIxMGJXSkhPVE5qZVRsNVdsZDRiQXBaV0U1c1RHNXNkR0pGUW5sYVYxcDZURE5TYUZvelRYWmtha0YxVFZNMGVVMUVaMGREYVhOSFFWRlJRbWMzT0hkQlVXOUZTMmQzYjFwRWFHbE9SMFV5Q2s1RVVURmFhazAwV1hwUk5GbHFhM2hOZW1Sb1QwUkJOVTlVWTNkT2JWRTFXV3BuZDA1NlRYaE9SRnBzVGtSQlpFSm5iM0pDWjBWRlFWbFBMMDFCUlV3S1FrRTRUVVJYWkhCa1IyZ3hXV2t4YjJJelRqQmFWMUYzVDFGWlMwdDNXVUpDUVVkRWRucEJRa1JCVVhKRVEyeHZaRWhTZDJONmIzWk1NbVJ3WkVkb01RcFphVFZxWWpJd2RtUklTbWhoVjNoMldtMUtjR1JJVFhaamJWcHFUMFJqTkU1VE5YZGxWRUUwUW1kdmNrSm5SVVZCV1U4dlRVRkZUa0pEYjAxTFIxRTBDbGxxVW1oT2FsRXdUbGRaZWs5SFRUQlBSMGsxVFZSTk0xbFVaM2RQVkdzelRVUmFhMDlYU1RSTlJHTjZUVlJSTWxwVVVYZEpRVmxMUzNkWlFrSkJSMFFLZG5wQlFrUm5VVk5FUWtKNVdsZGFla3d6VW1oYU0wMTJaR3BCZFUxVE5IbE5RbXRIUTJselIwRlJVVUpuTnpoM1FWRTRSVU4zZDBwT2VsazBUV3BGZWdwUFZHc3pUVU0wUjBOcGMwZEJVVkZDWnpjNGQwRlNRVVZKUVhkbFlVaFNNR05JVFRaTWVUbHVZVmhTYjJSWFNYVlpNamwwVEROU2VWbFhiSE5pTWxwcENtRllVbnBOUW1OSFEybHpSMEZSVVVKbk56aDNRVkpGUlVOUmQwaE5hazE0VGtSUmVVMTZRbTlDWjI5eVFtZEZSVUZaVHk5TlFVVlRRa1p2VFZkSGFEQUtaRWhDZWs5cE9IWmFNbXd3WVVoV2FVeHRUblppVXprd1kyMUdjR0pIT1cxWmJXd3dZM2s1ZVZwdFRUUk9lbWN4VEc1Q05VeDVOVzVoV0ZKdlpGZEpkZ3BrTWpsNVlUSmFjMkl6WkhwTU0wcHNZa2RXYUdNeVZYVmxWekZ6VVVoS2JGcHVUWFprUjBadVkzazVNazFETkhoTWFrbDNUMEZaUzB0M1dVSkNRVWRFQ25aNlFVSkZkMUZ4UkVOb2EwOUhTVEJaVkZrd1RrUldiVTE2YUdwT1JHaHBUMVJGZWs0eVJUUk5SR3MxVG5wQk1scEViR2xQUkVFelRYcEZNRTV0VlRBS1RVSmpSME5wYzBkQlVWRkNaemM0ZDBGU1VVVkRVWGRJWTIxV2MxcFhSbnBhVkVKalFtZHZja0puUlVWQldVOHZUVUZGVmtKRk5FMVVSMmd3WkVoQ2VncFBhVGgyV2pKc01HRklWbWxNYlU1MllsTTVNR050Um5CaVJ6bHRXVzFzTUdONU9YbGFiVTAwVG5wbk1VeHVRalZNTWtacVpFZHNkbUp1VFhaamJsWjFDbU41T0RSTmVsVjRUVVJWTkU1VVFYaE1Na1l3WkVkV2RHTklVbnBNZWtWM1JtZFpTMHQzV1VKQ1FVZEVkbnBCUWtablVVbEVRVnAzWkZkS2MyRlhUWGNLWjFsdlIwTnBjMGRCVVZGQ01XNXJRMEpCU1VWbVFWSTJRVWhuUVdSblJHUlFWRUp4ZUhOalVrMXRUVnBJYUhsYVducGpRMjlyY0dWMVRqUTRjbVlyU0FwcGJrdEJUSGx1ZFdwblFVRkJXVFZaTkVWTEswRkJRVVZCZDBKSVRVVlZRMGxFWVdkbWFuQjNNVUZhV0RNM05IWkdXRWRFVTFwblNqbExjWEpqY1RkVUNtc3ZWWE16WmpkdWJWWlJNVUZwUlVFMFpYTkhRbkpFYUdac1lrbFZkV3BWYlZsRE0yVlZWMFpHUW1kWVNHWkJRa3hwVTBSM1kybFVVWGM0ZDBObldVa0tTMjlhU1hwcU1FVkJkMDFFWVZGQmQxcG5TWGhCVFRablMwazFka3R2Y1dOMlZHdDJPRGRHYjNFelYxaE9XVzFCYUZCcU0zRmhVVFZ2WTFoUldITlhlZ3BJWlU1WFIwSTJiRk5JVkVjelJVNTVZWEJ4V1VKblNYaEJUVXBYT1d4NU0wcFlSV1JKTlhsa1NHWjZLMGRhYjJneGEzbGpNRmhHVlZCd05GWTBhMVpxQ201VldGa3JTM1J2VVZkTFUxQklZVnBOYTFsREwzTjZXR2huUFQwS0xTMHRMUzFGVGtRZ1EwVlNWRWxHU1VOQlZFVXRMUzB0TFFvPSJ9fX19\"}]}, \"messageSignature\": {\"messageDigest\": {\"algorithm\": \"SHA2_256\", \"digest\": \"xOkunsyCi+8qp9uh3orJg1EfdTKg3xHHcNOQmaJc8gE=\"}, \"signature\": \"MEYCIQCeH6E3MpZngWA6RPg8HAl/Z764hTFYycNyF3R+mPTSbAIhAPgMS8qBM8lCEU2XW765myMMz2zuyu9iTF40PH+XZlJQ\"}}\n+{\n+    \"mediaType\": \"application/vnd.dev.sigstore.bundle+json;version=0.2\",\n+    \"verificationMaterial\": {\n+        \"x509CertificateChain\": {\n+            \"certificates\": [\n+                {\n+                    \"rawBytes\": \"MIIGzzCCBlSgAwIBAgIUM29bvYkrDKnBVZmVeloTUMlZqNYwCgYIKoZIzj0EAwMwNzEVMBMGA1UEChMMc2lnc3RvcmUuZGV2MR4wHAYDVQQDExVzaWdzdG9yZS1pbnRlcm1lZGlhdGUwHhcNMjQwMzE5MjI0MTE1WhcNMjQwMzE5MjI1MTE1WjAAMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE1q8wmpmK0vesCD05ZE1o5Jyu+g/CtLZLXNEZiIomh1jquPMCZrhlPdOfzQws+E+IUBX3pcVUxtn4rYKnMH39oaOCBXMwggVvMA4GA1UdDwEB/wQEAwIHgDATBgNVHSUEDDAKBggrBgEFBQcDAzAdBgNVHQ4EFgQU0PaUbhtp84Orb2YatvZkIjkZiOEwHwYDVR0jBBgwFoAU39Ppz1YkEZb5qNjpKFWixi4YZD8wZgYDVR0RAQH/BFwwWoZYaHR0cHM6Ly9naXRodWIuY29tL3RyYWlsb2ZiaXRzL3JmYzg3ODUucHkvLmdpdGh1Yi93b3JrZmxvd3MvcmVsZWFzZS55bWxAcmVmcy90YWdzL3YwLjEuMjA5BgorBgEEAYO/MAEBBCtodHRwczovL3Rva2VuLmFjdGlvbnMuZ2l0aHVidXNlcmNvbnRlbnQuY29tMBUGCisGAQQBg78wAQIEB3JlbGVhc2UwNgYKKwYBBAGDvzABAwQoZDhiNGE2NDQ1ZjM4YzQ4YjkxMzdhODA5OTcwNmQ5YjgwNzMxNDZlNDAVBgorBgEEAYO/MAEEBAdyZWxlYXNlMCQGCisGAQQBg78wAQUEFnRyYWlsb2ZiaXRzL3JmYzg3ODUucHkwHgYKKwYBBAGDvzABBgQQcmVmcy90YWdzL3YwLjEuMjA7BgorBgEEAYO/MAEIBC0MK2h0dHBzOi8vdG9rZW4uYWN0aW9ucy5naXRodWJ1c2VyY29udGVudC5jb20waAYKKwYBBAGDvzABCQRaDFhodHRwczovL2dpdGh1Yi5jb20vdHJhaWxvZmJpdHMvcmZjODc4NS5weS8uZ2l0aHViL3dvcmtmbG93cy9yZWxlYXNlLnltbEByZWZzL3RhZ3MvdjAuMS4yMDgGCisGAQQBg78wAQoEKgwoZDhiNGE2NDQ1ZjM4YzQ4YjkxMzdhODA5OTcwNmQ5YjgwNzMxNDZlNDAdBgorBgEEAYO/MAELBA8MDWdpdGh1Yi1ob3N0ZWQwOQYKKwYBBAGDvzABDAQrDClodHRwczovL2dpdGh1Yi5jb20vdHJhaWxvZmJpdHMvcmZjODc4NS5weTA4BgorBgEEAYO/MAENBCoMKGQ4YjRhNjQ0NWYzOGM0OGI5MTM3YTgwOTk3MDZkOWI4MDczMTQ2ZTQwIAYKKwYBBAGDvzABDgQSDBByZWZzL3RhZ3MvdjAuMS4yMBkGCisGAQQBg78wAQ8ECwwJNzY4MjEzOTk3MC4GCisGAQQBg78wARAEIAweaHR0cHM6Ly9naXRodWIuY29tL3RyYWlsb2ZiaXRzMBcGCisGAQQBg78wAREECQwHMjMxNDQyMzBoBgorBgEEAYO/MAESBFoMWGh0dHBzOi8vZ2l0aHViLmNvbS90cmFpbG9mYml0cy9yZmM4Nzg1LnB5Ly5naXRodWIvd29ya2Zsb3dzL3JlbGVhc2UueW1sQHJlZnMvdGFncy92MC4xLjIwOAYKKwYBBAGDvzABEwQqDChkOGI0YTY0NDVmMzhjNDhiOTEzN2E4MDk5NzA2ZDliODA3MzE0NmU0MBcGCisGAQQBg78wARQECQwHcmVsZWFzZTBcBgorBgEEAYO/MAEVBE4MTGh0dHBzOi8vZ2l0aHViLmNvbS90cmFpbG9mYml0cy9yZmM4Nzg1LnB5L2FjdGlvbnMvcnVucy84MzUxMDU4NTAxL2F0dGVtcHRzLzEwFgYKKwYBBAGDvzABFgQIDAZwdWJsaWMwgYoGCisGAQQB1nkCBAIEfAR6AHgAdgDdPTBqxscRMmMZHhyZZzcCokpeuN48rf+HinKALynujgAAAY5Y4EK+AAAEAwBHMEUCIDagfjpw1AZX374vFXGDSZgJ9Kqrcq7Tk/Us3f7nmVQ1AiEA4esGBrDhflbIUujUmYC3eUWFFBgXHfABLiSDwciTQw8wCgYIKoZIzj0EAwMDaQAwZgIxAM6gKI5vKoqcvTkv87Foq3WXNYmAhPj3qaQ5ocXQXsWzHeNWGB6lSHTG3ENyapqYBgIxAMJW9ly3JXEdI5ydHfz+GZoh1kyc0XFUPp4V4kVjnUXY+KtoQWKSPHaZMkYC/szXhg==\"\n+                }\n+            ]\n+        },\n+        \"tlogEntries\": [\n+            {\n+                \"logIndex\": \"79605083\",\n+                \"logId\": {\n+                    \"keyId\": \"wNI9atQGlz+VWfO6LRygH4QUfY/8W4RFwiT5i5WRgB0=\"\n+                },\n+                \"kindVersion\": {\n+                    \"kind\": \"hashedrekord\",\n+                    \"version\": \"0.0.1\"\n+                },\n+                \"integratedTime\": \"1710888076\",\n+                \"inclusionPromise\": {\n+                    \"signedEntryTimestamp\": \"MEYCIQD8ohK48/Ls8D4Qd3dQZl6geplAt0p5Sgpa1wabniB/ZgIhALsVfKCe1m2KKtaEImxijm5bO2K49NltHWafJE2a1hnr\"\n+                },\n+                \"inclusionProof\": {\n+                    \"logIndex\": \"75441652\",\n+                    \"rootHash\": \"uAqI3id6JHPMMNUltHIKHuX1kVHpm5y7jSfnbaRO+E4=\",\n+                    \"treeSize\": \"75441653\",\n+                    \"hashes\": [\n+                        \"XoeIGlDW7f2lVjTlQEXPaV7szUXY2BECAEKtNA/lgfk=\",\n+                        \"Pz5CyFQH78eikJoZuJ44Ls4R5najWJ1nKWunxb/vxeM=\",\n+                        \"COo4wZnRb/d6zZOa7RP1euSRFb7H5EX5bYXs4HEQ0uU=\",\n+                        \"1A4EnFDN5UCHjrJDWPuYDmY+ZLb4B+Jvis+k3ti+wjs=\",\n+                        \"bBpWKtQryG7/tMDt9HDvKk/Fp3S+q7gTnYF56qGKMiI=\",\n+                        \"ZR8qbYzXTNaK4SaofTZtbR0srNmOJ0Yx891OF5/G2gQ=\",\n+                        \"7MueyMCRkh/GaluPkJl3xQFyXFq/SS9xykP299KtvS0=\",\n+                        \"kFt/VRwfXksHcnd9vpdeifz3N16KyWQoDxAPfLlRwTA=\",\n+                        \"gtt9e0foHZTCS9w+epNsmDWbwvX4FNV1EAg0rhxLfjg=\",\n+                        \"BGqH+LzVuhuqCLiUvBJaB2hlsvtu2a15qq1WGw6mG44=\",\n+                        \"OeS7D4kPES7ChE7kWSEmhbAMqBcKVj/z8/afMK4Y3pI=\",\n+                        \"JtjqvAqFyXXYjWlZfDzElHpEzdBjsz1LmGFJuYx0kTU=\",\n+                        \"s/ZIVcfcD4/nuZwUtQf4ydGsIAkGTPTzk3b0zhUC95k=\",\n+                        \"YU1jZY/fp5tJdGF/i+/7ez8107O4/lOUp7acMPFEaOA=\",\n+                        \"7Z18YLBAvejEV4nJHIKoks/xlijnhR005qTW2w4QtHg=\",\n+                        \"98enzMaC+x5oCMvIZQA5z8vu2apDMCFvE/935NfuPw8=\"\n+                    ],\n+                    \"checkpoint\": {\n+                        \"envelope\": \"rekor.sigstore.dev - 2605736670972794746\\n75441653\\nuAqI3id6JHPMMNUltHIKHuX1kVHpm5y7jSfnbaRO+E4=\\n\\n\\u2014 rekor.sigstore.dev wNI9ajBGAiEA5perJLLm94gCQOQT5/vO29OXWNZ1SoengZDZ/U6vsOUCIQDBL0BIkCjWGR6V622znnVpXF5D1g0jPgajBlHh8uSc8g==\\n\"\n+                    }\n+                },\n+                \"canonicalizedBody\": \"eyJhcGlWZXJzaW9uIjoiMC4wLjEiLCJraW5kIjoiaGFzaGVkcmVrb3JkIiwic3BlYyI6eyJkYXRhIjp7Imhhc2giOnsiYWxnb3JpdGhtIjoic2hhMjU2IiwidmFsdWUiOiJjNGU5MmU5ZWNjODI4YmVmMmFhN2RiYTFkZThhYzk4MzUxMWY3NTMyYTBkZjExYzc3MGQzOTA5OWEyNWNmMjAxIn19LCJzaWduYXR1cmUiOnsiY29udGVudCI6Ik1FWUNJUUNlSDZFM01wWm5nV0E2UlBnOEhBbC9aNzY0aFRGWXljTnlGM1IrbVBUU2JBSWhBUGdNUzhxQk04bENFVTJYVzc2NW15TU16Mnp1eXU5aVRGNDBQSCtYWmxKUSIsInB1YmxpY0tleSI6eyJjb250ZW50IjoiTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVZDZla05EUW14VFowRjNTVUpCWjBsVlRUSTVZblpaYTNKRVMyNUNWbHB0Vm1Wc2IxUlZUV3hhY1U1WmQwTm5XVWxMYjFwSmVtb3dSVUYzVFhjS1RucEZWazFDVFVkQk1WVkZRMmhOVFdNeWJHNWpNMUoyWTIxVmRWcEhWakpOVWpSM1NFRlpSRlpSVVVSRmVGWjZZVmRrZW1SSE9YbGFVekZ3WW01U2JBcGpiVEZzV2tkc2FHUkhWWGRJYUdOT1RXcFJkMDE2UlRWTmFra3dUVlJGTVZkb1kwNU5hbEYzVFhwRk5VMXFTVEZOVkVVeFYycEJRVTFHYTNkRmQxbElDa3R2V2tsNmFqQkRRVkZaU1V0dldrbDZhakJFUVZGalJGRm5RVVV4Y1RoM2JYQnRTekIyWlhORFJEQTFXa1V4YnpWS2VYVXJaeTlEZEV4YVRGaE9SVm9LYVVsdmJXZ3hhbkYxVUUxRFduSm9iRkJrVDJaNlVYZHpLMFVyU1ZWQ1dETndZMVpWZUhSdU5ISlpTMjVOU0RNNWIyRlBRMEpZVFhkbloxWjJUVUUwUndwQk1WVmtSSGRGUWk5M1VVVkJkMGxJWjBSQlZFSm5UbFpJVTFWRlJFUkJTMEpuWjNKQ1owVkdRbEZqUkVGNlFXUkNaMDVXU0ZFMFJVWm5VVlV3VUdGVkNtSm9kSEE0TkU5eVlqSlpZWFIyV210SmFtdGFhVTlGZDBoM1dVUldVakJxUWtKbmQwWnZRVlV6T1ZCd2VqRlphMFZhWWpWeFRtcHdTMFpYYVhocE5Ga0tXa1E0ZDFwbldVUldVakJTUVZGSUwwSkdkM2RYYjFwWllVaFNNR05JVFRaTWVUbHVZVmhTYjJSWFNYVlpNamwwVEROU2VWbFhiSE5pTWxwcFlWaFNlZ3BNTTBwdFdYcG5NMDlFVlhWalNHdDJURzFrY0dSSGFERlphVGt6WWpOS2NscHRlSFprTTAxMlkyMVdjMXBYUm5wYVV6VTFZbGQ0UVdOdFZtMWplVGt3Q2xsWFpIcE1NMWwzVEdwRmRVMXFRVFZDWjI5eVFtZEZSVUZaVHk5TlFVVkNRa04wYjJSSVVuZGplbTkyVEROU2RtRXlWblZNYlVacVpFZHNkbUp1VFhVS1dqSnNNR0ZJVm1sa1dFNXNZMjFPZG1KdVVteGlibEYxV1RJNWRFMUNWVWREYVhOSFFWRlJRbWMzT0hkQlVVbEZRak5LYkdKSFZtaGpNbFYzVG1kWlN3cExkMWxDUWtGSFJIWjZRVUpCZDFGdldrUm9hVTVIUlRKT1JGRXhXbXBOTkZsNlVUUlphbXQ0VFhwa2FFOUVRVFZQVkdOM1RtMVJOVmxxWjNkT2VrMTRDazVFV214T1JFRldRbWR2Y2tKblJVVkJXVTh2VFVGRlJVSkJaSGxhVjNoc1dWaE9iRTFEVVVkRGFYTkhRVkZSUW1jM09IZEJVVlZGUm01U2VWbFhiSE1LWWpKYWFXRllVbnBNTTBwdFdYcG5NMDlFVlhWalNHdDNTR2RaUzB0M1dVSkNRVWRFZG5wQlFrSm5VVkZqYlZadFkzazVNRmxYWkhwTU0xbDNUR3BGZFFwTmFrRTNRbWR2Y2tKblJVVkJXVTh2VFVGRlNVSkRNRTFMTW1nd1pFaENlazlwT0haa1J6bHlXbGMwZFZsWFRqQmhWemwxWTNrMWJtRllVbTlrVjBveENtTXlWbmxaTWpsMVpFZFdkV1JETldwaU1qQjNZVUZaUzB0M1dVSkNRVWRFZG5wQlFrTlJVbUZFUm1odlpFaFNkMk42YjNaTU1tUndaRWRvTVZscE5Xb0tZakl3ZG1SSVNtaGhWM2gyV20xS2NHUklUWFpqYlZwcVQwUmpORTVUTlhkbFV6aDFXakpzTUdGSVZtbE1NMlIyWTIxMGJXSkhPVE5qZVRsNVdsZDRiQXBaV0U1c1RHNXNkR0pGUW5sYVYxcDZURE5TYUZvelRYWmtha0YxVFZNMGVVMUVaMGREYVhOSFFWRlJRbWMzT0hkQlVXOUZTMmQzYjFwRWFHbE9SMFV5Q2s1RVVURmFhazAwV1hwUk5GbHFhM2hOZW1Sb1QwUkJOVTlVWTNkT2JWRTFXV3BuZDA1NlRYaE9SRnBzVGtSQlpFSm5iM0pDWjBWRlFWbFBMMDFCUlV3S1FrRTRUVVJYWkhCa1IyZ3hXV2t4YjJJelRqQmFWMUYzVDFGWlMwdDNXVUpDUVVkRWRucEJRa1JCVVhKRVEyeHZaRWhTZDJONmIzWk1NbVJ3WkVkb01RcFphVFZxWWpJd2RtUklTbWhoVjNoMldtMUtjR1JJVFhaamJWcHFUMFJqTkU1VE5YZGxWRUUwUW1kdmNrSm5SVVZCV1U4dlRVRkZUa0pEYjAxTFIxRTBDbGxxVW1oT2FsRXdUbGRaZWs5SFRUQlBSMGsxVFZSTk0xbFVaM2RQVkdzelRVUmFhMDlYU1RSTlJHTjZUVlJSTWxwVVVYZEpRVmxMUzNkWlFrSkJSMFFLZG5wQlFrUm5VVk5FUWtKNVdsZGFla3d6VW1oYU0wMTJaR3BCZFUxVE5IbE5RbXRIUTJselIwRlJVVUpuTnpoM1FWRTRSVU4zZDBwT2VsazBUV3BGZWdwUFZHc3pUVU0wUjBOcGMwZEJVVkZDWnpjNGQwRlNRVVZKUVhkbFlVaFNNR05JVFRaTWVUbHVZVmhTYjJSWFNYVlpNamwwVEROU2VWbFhiSE5pTWxwcENtRllVbnBOUW1OSFEybHpSMEZSVVVKbk56aDNRVkpGUlVOUmQwaE5hazE0VGtSUmVVMTZRbTlDWjI5eVFtZEZSVUZaVHk5TlFVVlRRa1p2VFZkSGFEQUtaRWhDZWs5cE9IWmFNbXd3WVVoV2FVeHRUblppVXprd1kyMUdjR0pIT1cxWmJXd3dZM2s1ZVZwdFRUUk9lbWN4VEc1Q05VeDVOVzVoV0ZKdlpGZEpkZ3BrTWpsNVlUSmFjMkl6WkhwTU0wcHNZa2RXYUdNeVZYVmxWekZ6VVVoS2JGcHVUWFprUjBadVkzazVNazFETkhoTWFrbDNUMEZaUzB0M1dVSkNRVWRFQ25aNlFVSkZkMUZ4UkVOb2EwOUhTVEJaVkZrd1RrUldiVTE2YUdwT1JHaHBUMVJGZWs0eVJUUk5SR3MxVG5wQk1scEViR2xQUkVFelRYcEZNRTV0VlRBS1RVSmpSME5wYzBkQlVWRkNaemM0ZDBGU1VVVkRVWGRJWTIxV2MxcFhSbnBhVkVKalFtZHZja0puUlVWQldVOHZUVUZGVmtKRk5FMVVSMmd3WkVoQ2VncFBhVGgyV2pKc01HRklWbWxNYlU1MllsTTVNR050Um5CaVJ6bHRXVzFzTUdONU9YbGFiVTAwVG5wbk1VeHVRalZNTWtacVpFZHNkbUp1VFhaamJsWjFDbU41T0RSTmVsVjRUVVJWTkU1VVFYaE1Na1l3WkVkV2RHTklVbnBNZWtWM1JtZFpTMHQzV1VKQ1FVZEVkbnBCUWtablVVbEVRVnAzWkZkS2MyRlhUWGNLWjFsdlIwTnBjMGRCVVZGQ01XNXJRMEpCU1VWbVFWSTJRVWhuUVdSblJHUlFWRUp4ZUhOalVrMXRUVnBJYUhsYVducGpRMjlyY0dWMVRqUTRjbVlyU0FwcGJrdEJUSGx1ZFdwblFVRkJXVFZaTkVWTEswRkJRVVZCZDBKSVRVVlZRMGxFWVdkbWFuQjNNVUZhV0RNM05IWkdXRWRFVTFwblNqbExjWEpqY1RkVUNtc3ZWWE16WmpkdWJWWlJNVUZwUlVFMFpYTkhRbkpFYUdac1lrbFZkV3BWYlZsRE0yVlZWMFpHUW1kWVNHWkJRa3hwVTBSM1kybFVVWGM0ZDBObldVa0tTMjlhU1hwcU1FVkJkMDFFWVZGQmQxcG5TWGhCVFRablMwazFka3R2Y1dOMlZHdDJPRGRHYjNFelYxaE9XVzFCYUZCcU0zRmhVVFZ2WTFoUldITlhlZ3BJWlU1WFIwSTJiRk5JVkVjelJVNTVZWEJ4V1VKblNYaEJUVXBYT1d4NU0wcFlSV1JKTlhsa1NHWjZLMGRhYjJneGEzbGpNRmhHVlZCd05GWTBhMVpxQ201VldGa3JTM1J2VVZkTFUxQklZVnBOYTFsREwzTjZXR2huUFQwS0xTMHRMUzFGVGtRZ1EwVlNWRWxHU1VOQlZFVXRMUzB0TFFvPSJ9fX19\"\n+            }\n+        ]\n+    },\n+    \"messageSignature\": {\n+        \"messageDigest\": {\n+            \"algorithm\": \"SHA2_256\",\n+            \"digest\": \"xOkunsyCi+8qp9uh3orJg1EfdTKg3xHHcNOQmaJc8gE=\"\n+        },\n+        \"signature\": \"MEYCIQCeH6E3MpZngWA6RPg8HAl/Z764hTFYycNyF3R+mPTSbAIhAPgMS8qBM8lCEU2XW765myMMz2zuyu9iTF40PH+XZlJQ\"\n+    }\n+}"
            },
            {
                "sha": "35f74a572261ce578b8210f12f14baec220ab700",
                "filename": "test/assets/bundle_v3_no_signed_time.txt",
                "status": "added",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/sigstore/sigstore-python/blob/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Fassets%2Fbundle_v3_no_signed_time.txt",
                "raw_url": "https://github.com/sigstore/sigstore-python/raw/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Fassets%2Fbundle_v3_no_signed_time.txt",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-python/contents/test%2Fassets%2Fbundle_v3_no_signed_time.txt?ref=300b502ae99ebfaace124f1f4e422a6a669369cf",
                "patch": "@@ -0,0 +1,6 @@\n+DO NOT MODIFY ME!\n+\n+this is the input for bundle_v3_no_signed_time, which ensures clients reject\n+bundles that don't have a source of signed time.\n+\n+DO NOT MODIFY ME!"
            },
            {
                "sha": "b5cad65280605a4dc2ca27c518f6952e962774c0",
                "filename": "test/assets/bundle_v3_no_signed_time.txt.sigstore.json",
                "status": "added",
                "additions": 50,
                "deletions": 0,
                "changes": 50,
                "blob_url": "https://github.com/sigstore/sigstore-python/blob/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Fassets%2Fbundle_v3_no_signed_time.txt.sigstore.json",
                "raw_url": "https://github.com/sigstore/sigstore-python/raw/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Fassets%2Fbundle_v3_no_signed_time.txt.sigstore.json",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-python/contents/test%2Fassets%2Fbundle_v3_no_signed_time.txt.sigstore.json?ref=300b502ae99ebfaace124f1f4e422a6a669369cf",
                "patch": "@@ -0,0 +1,50 @@\n+{\n+    \"mediaType\": \"application/vnd.dev.sigstore.bundle.v0.3+json\",\n+    \"verificationMaterial\": {\n+        \"certificate\": {\n+            \"rawBytes\": \"MIIC1DCCAlugAwIBAgIUXgKINnY7rbT5gHmj9yeiZXGg3rkwCgYIKoZIzj0EAwMwNzEVMBMGA1UEChMMc2lnc3RvcmUuZGV2MR4wHAYDVQQDExVzaWdzdG9yZS1pbnRlcm1lZGlhdGUwHhcNMjQxMjEwMjE0MTI1WhcNMjQxMjEwMjE1MTI1WjAAMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE4ul4I08UFGizCla6qRUGFiwEPNsFRnvBPDvQ4ViJ+Q83HOlYWWxCAjoJpGd9FWtyxTPKDsG0n4t6Mr+jSwz22KOCAXowggF2MA4GA1UdDwEB/wQEAwIHgDATBgNVHSUEDDAKBggrBgEFBQcDAzAdBgNVHQ4EFgQUZ7cNLqQlnKAXnf6jmb9cv70dppgwHwYDVR0jBBgwFoAU39Ppz1YkEZb5qNjpKFWixi4YZD8wIwYDVR0RAQH/BBkwF4EVd2lsbGlhbUB5b3NzYXJpYW4ubmV0MCwGCisGAQQBg78wAQEEHmh0dHBzOi8vZ2l0aHViLmNvbS9sb2dpbi9vYXV0aDAuBgorBgEEAYO/MAEIBCAMHmh0dHBzOi8vZ2l0aHViLmNvbS9sb2dpbi9vYXV0aDCBiwYKKwYBBAHWeQIEAgR9BHsAeQB3AN09MGrGxxEyYxkeHJlnNwKiSl643jyt/4eKcoAvKe6OAAABk7KFEeIAAAQDAEgwRgIhAOeS6rR2aksHhN9Rxbx+ANuAlXhP4vTPKMLBHd6JAm4lAiEAx+/kzKJ2SxSCAYm582jKeAa1LCVmUaO85FO2WTV7MYEwCgYIKoZIzj0EAwMDZwAwZAIwDXrVAPgutWZWPfE3QWy/4gG/PbMbYUfqNsEpQEeMm8GeraZN3zffzw16FFhWsMbXAjApxDNgKvmztHOKStyvmOXPiJCixzx/gLFbhVn7Q+qY6vjC83B0XgPsyQ2T0i8Ldzg=\"\n+        },\n+        \"tlogEntries\": [\n+            {\n+                \"logIndex\": \"154562758\",\n+                \"logId\": {\n+                    \"keyId\": \"wNI9atQGlz+VWfO6LRygH4QUfY/8W4RFwiT5i5WRgB0=\"\n+                },\n+                \"kindVersion\": {\n+                    \"kind\": \"hashedrekord\",\n+                    \"version\": \"0.0.1\"\n+                },\n+                \"integratedTime\": \"1733866885\",\n+                \"inclusionProof\": {\n+                    \"logIndex\": \"32658496\",\n+                    \"rootHash\": \"IbC2+n9aYhFlm5nFwkp+j7/Hc9XuYWxyE5OlXIoIijY=\",\n+                    \"treeSize\": \"32658497\",\n+                    \"hashes\": [\n+                        \"CVvwGSdkZ5FUDnltf3Me3nXyco4G9mwTsYbIxz0RS+U=\",\n+                        \"DJrEpKAKhEPhZ5aKvlaRImFebTv5tc17rsfOkhSS6fY=\",\n+                        \"tsYfO+hUsl4KKY+qsPx/k4NzOzE5zWRsc4Ufgn4oh/U=\",\n+                        \"ZjSpDQt5kIQfJd6B/BDNWLRhYOGwnlxE6pT4JJaiD5s=\",\n+                        \"OMoiMVnwD3sG6Cc6HCg+ySmqBAH1nn0mA5+tjFxiyeg=\",\n+                        \"gSWKL2k1ZGZm45C8hSdNwWan8qOrszl5X7Ws56h+FVM=\",\n+                        \"R7hO1X+KgSw8Oojd8i2+G3BzBYztkRBE6LpYSXPg33U=\",\n+                        \"oOecFfN3YqDOkbijS/ej1WF5Da/Gt/AZNhbwE9uoOE8=\",\n+                        \"4lUF0YOu9XkIDXKXA0wMSzd6VeDY3TZAgmoOeWmS2+Y=\",\n+                        \"gf+9m552B3PnkWnO0o4KdVvjcT3WVHLrCbf1DoVYKFw=\"\n+                    ],\n+                    \"checkpoint\": {\n+                        \"envelope\": \"rekor.sigstore.dev - 1193050959916656506\\n32658497\\nIbC2+n9aYhFlm5nFwkp+j7/Hc9XuYWxyE5OlXIoIijY=\\n\\n\\u2014 rekor.sigstore.dev wNI9ajBGAiEAgjFaCZlVvHUnDgxLf+4XjN6ahWNkkKh9QFTOqHBpyw4CIQDmy4JQs+2BKtvheo/HQogyhh5EYGYZeBDdRvyyX1fg+w==\\n\"\n+                    }\n+                },\n+                \"canonicalizedBody\": \"eyJhcGlWZXJzaW9uIjoiMC4wLjEiLCJraW5kIjoiaGFzaGVkcmVrb3JkIiwic3BlYyI6eyJkYXRhIjp7Imhhc2giOnsiYWxnb3JpdGhtIjoic2hhMjU2IiwidmFsdWUiOiJjYTZkZTk5YTExZDNkMzgwNTZkODM4YzdkYzlhMjNhMTFhMGM4MWJjYWNlMGQxMWVhYTMwMWEyZmZiNDgyYzQyIn19LCJzaWduYXR1cmUiOnsiY29udGVudCI6Ik1FWUNJUUMzc2pYZVZoTHRqbE13dG0yRE5CYVdVaFBWOVJ1U1dsWW1EcHQzRzFQVW5RSWhBUElxRHUwTVkza1FtelE2QmswS2VSTW5mQ3Y0VVdEVU5jclRnN0cyYjdzTCIsInB1YmxpY0tleSI6eyJjb250ZW50IjoiTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVTXhSRU5EUVd4MVowRjNTVUpCWjBsVldHZExTVTV1V1RkeVlsUTFaMGh0YWpsNVpXbGFXRWRuTTNKcmQwTm5XVWxMYjFwSmVtb3dSVUYzVFhjS1RucEZWazFDVFVkQk1WVkZRMmhOVFdNeWJHNWpNMUoyWTIxVmRWcEhWakpOVWpSM1NFRlpSRlpSVVVSRmVGWjZZVmRrZW1SSE9YbGFVekZ3WW01U2JBcGpiVEZzV2tkc2FHUkhWWGRJYUdOT1RXcFJlRTFxUlhkTmFrVXdUVlJKTVZkb1kwNU5hbEY0VFdwRmQwMXFSVEZOVkVreFYycEJRVTFHYTNkRmQxbElDa3R2V2tsNmFqQkRRVkZaU1V0dldrbDZhakJFUVZGalJGRm5RVVUwZFd3MFNUQTRWVVpIYVhwRGJHRTJjVkpWUjBacGQwVlFUbk5HVW01MlFsQkVkbEVLTkZacFNpdFJPRE5JVDJ4WlYxZDRRMEZxYjBwd1IyUTVSbGQwZVhoVVVFdEVjMGN3YmpSME5rMXlLMnBUZDNveU1rdFBRMEZZYjNkblowWXlUVUUwUndwQk1WVmtSSGRGUWk5M1VVVkJkMGxJWjBSQlZFSm5UbFpJVTFWRlJFUkJTMEpuWjNKQ1owVkdRbEZqUkVGNlFXUkNaMDVXU0ZFMFJVWm5VVlZhTjJOT0NreHhVV3h1UzBGWWJtWTJhbTFpT1dOMk56QmtjSEJuZDBoM1dVUldVakJxUWtKbmQwWnZRVlV6T1ZCd2VqRlphMFZhWWpWeFRtcHdTMFpYYVhocE5Ga0tXa1E0ZDBsM1dVUldVakJTUVZGSUwwSkNhM2RHTkVWV1pESnNjMkpIYkdoaVZVSTFZak5PZWxsWVNuQlpWelIxWW0xV01FMURkMGREYVhOSFFWRlJRZ3BuTnpoM1FWRkZSVWh0YURCa1NFSjZUMms0ZGxveWJEQmhTRlpwVEcxT2RtSlRPWE5pTW1Sd1ltazVkbGxZVmpCaFJFRjFRbWR2Y2tKblJVVkJXVTh2Q2sxQlJVbENRMEZOU0cxb01HUklRbnBQYVRoMldqSnNNR0ZJVm1sTWJVNTJZbE01YzJJeVpIQmlhVGwyV1ZoV01HRkVRMEpwZDFsTFMzZFpRa0pCU0ZjS1pWRkpSVUZuVWpsQ1NITkJaVkZDTTBGT01EbE5SM0pIZUhoRmVWbDRhMlZJU214dVRuZExhVk5zTmpRemFubDBMelJsUzJOdlFYWkxaVFpQUVVGQlFncHJOMHRHUldWSlFVRkJVVVJCUldkM1VtZEphRUZQWlZNMmNsSXlZV3R6U0doT09WSjRZbmdyUVU1MVFXeFlhRkEwZGxSUVMwMU1Ra2hrTmtwQmJUUnNDa0ZwUlVGNEt5OXJla3RLTWxONFUwTkJXVzAxT0RKcVMyVkJZVEZNUTFadFZXRlBPRFZHVHpKWFZGWTNUVmxGZDBObldVbExiMXBKZW1vd1JVRjNUVVFLV25kQmQxcEJTWGRFV0hKV1FWQm5kWFJYV2xkUVprVXpVVmQ1THpSblJ5OVFZazFpV1ZWbWNVNXpSWEJSUldWTmJUaEhaWEpoV2s0emVtWm1lbmN4TmdwR1JtaFhjMDFpV0VGcVFYQjRSRTVuUzNadGVuUklUMHRUZEhsMmJVOVlVR2xLUTJsNGVuZ3ZaMHhHWW1oV2JqZFJLM0ZaTm5acVF6Z3pRakJZWjFCekNubFJNbFF3YVRoTVpIcG5QUW90TFMwdExVVk9SQ0JEUlZKVVNVWkpRMEZVUlMwdExTMHRDZz09In19fX0=\"\n+            }\n+        ],\n+        \"timestampVerificationData\": {}\n+    },\n+    \"messageSignature\": {\n+        \"messageDigest\": {\n+            \"algorithm\": \"SHA2_256\",\n+            \"digest\": \"ym3pmhHT04BW2DjH3JojoRoMgbys4NEeqjAaL/tILEI=\"\n+        },\n+        \"signature\": \"MEYCIQC3sjXeVhLtjlMwtm2DNBaWUhPV9RuSWlYmDpt3G1PUnQIhAPIqDu0MY3kQmzQ6Bk0KeRMnfCv4UWDUNcrTg7G2b7sL\"\n+    }\n+}"
            },
            {
                "sha": "d96e32b37f3a777e0ac9fe6d98f3b4bd4ad2da30",
                "filename": "test/unit/conftest.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/sigstore/sigstore-python/blob/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Funit%2Fconftest.py",
                "raw_url": "https://github.com/sigstore/sigstore-python/raw/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Funit%2Fconftest.py",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-python/contents/test%2Funit%2Fconftest.py?ref=300b502ae99ebfaace124f1f4e422a6a669369cf",
                "patch": "@@ -117,6 +117,8 @@ def signing_bundle(asset):\n     def _signing_bundle(name: str) -> tuple[Path, Bundle]:\n         file = asset(name)\n         bundle_path = asset(f\"{name}.sigstore\")\n+        if not bundle_path.is_file():\n+            bundle_path = asset(f\"{name}.sigstore.json\")\n         bundle = Bundle.from_json(bundle_path.read_bytes())\n \n         return (file, bundle)"
            },
            {
                "sha": "f5f7e1f7821957e172896fbd4ee5637c3129f58e",
                "filename": "test/unit/test_models.py",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/sigstore/sigstore-python/blob/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Funit%2Ftest_models.py",
                "raw_url": "https://github.com/sigstore/sigstore-python/raw/300b502ae99ebfaace124f1f4e422a6a669369cf/test%2Funit%2Ftest_models.py",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-python/contents/test%2Funit%2Ftest_models.py?ref=300b502ae99ebfaace124f1f4e422a6a669369cf",
                "patch": "@@ -180,6 +180,13 @@ def test_bundle_roundtrip(self, signing_bundle):\n             bundle.to_json()\n         )\n \n+    def test_bundle_missing_signed_time(self, signing_bundle):\n+        with pytest.raises(\n+            InvalidBundle,\n+            match=r\"bundle must contain an inclusion promise or signed timestamp\\(s\\)\",\n+        ):\n+            signing_bundle(\"bundle_v3_no_signed_time.txt\")\n+\n \n class TestKnownBundleTypes:\n     def test_str(self):"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails/commits/2e3f41e4538b9ca1044357f6644f037bbb7c6c49",
        "url": "https://api.github.com/repos/rails/rails/commits/2e3f41e4538b9ca1044357f6644f037bbb7c6c49",
        "html_url": "https://github.com/rails/rails/commit/2e3f41e4538b9ca1044357f6644f037bbb7c6c49",
        "message": "Add CSP directive validation\n\nValidate directives to make sure they don't include semicolons or\nwhitespace. These are special and denote lists and termination of\ndirectives.\n\n[CVE-2024-54133]",
        "files": [
            {
                "sha": "33c2b25f18648e57a4b4d2324677706f41361deb",
                "filename": "actionpack/CHANGELOG.md",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/rails/rails/blob/2e3f41e4538b9ca1044357f6644f037bbb7c6c49/actionpack%2FCHANGELOG.md",
                "raw_url": "https://github.com/rails/rails/raw/2e3f41e4538b9ca1044357f6644f037bbb7c6c49/actionpack%2FCHANGELOG.md",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2FCHANGELOG.md?ref=2e3f41e4538b9ca1044357f6644f037bbb7c6c49",
                "patch": "@@ -1,3 +1,11 @@\n+*   Add validation to content security policies to disallow spaces and semicolons.\n+    Developers should use multiple arguments, and different directive methods instead.\n+\n+    [CVE-2024-54133]\n+\n+    *Gannon McGibbon*\n+\n+\n ## Rails 8.0.0 (November 07, 2024) ##\n \n *   No changes."
            },
            {
                "sha": "9194765a2e27e6df51d12b5af5c6ffbbcce5b5b0",
                "filename": "actionpack/lib/action_dispatch/http/content_security_policy.rb",
                "status": "modified",
                "additions": 21,
                "deletions": 4,
                "changes": 25,
                "blob_url": "https://github.com/rails/rails/blob/2e3f41e4538b9ca1044357f6644f037bbb7c6c49/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb",
                "raw_url": "https://github.com/rails/rails/raw/2e3f41e4538b9ca1044357f6644f037bbb7c6c49/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb?ref=2e3f41e4538b9ca1044357f6644f037bbb7c6c49",
                "patch": "@@ -26,6 +26,9 @@ module ActionDispatch # :nodoc:\n   #       policy.report_uri \"/csp-violation-report-endpoint\"\n   #     end\n   class ContentSecurityPolicy\n+    class InvalidDirectiveError < StandardError\n+    end\n+\n     class Middleware\n       def initialize(app)\n         @app = app\n@@ -320,9 +323,9 @@ def build_directives(context, nonce, nonce_directives)\n         @directives.map do |directive, sources|\n           if sources.is_a?(Array)\n             if nonce && nonce_directive?(directive, nonce_directives)\n-              \"#{directive} #{build_directive(sources, context).join(' ')} 'nonce-#{nonce}'\"\n+              \"#{directive} #{build_directive(directive, sources, context).join(' ')} 'nonce-#{nonce}'\"\n             else\n-              \"#{directive} #{build_directive(sources, context).join(' ')}\"\n+              \"#{directive} #{build_directive(directive, sources, context).join(' ')}\"\n             end\n           elsif sources\n             directive\n@@ -332,8 +335,22 @@ def build_directives(context, nonce, nonce_directives)\n         end\n       end\n \n-      def build_directive(sources, context)\n-        sources.map { |source| resolve_source(source, context) }\n+      def validate(directive, sources)\n+        sources.flatten.each do |source|\n+          if source.include?(\";\") || source != source.gsub(/[[:space:]]/, \"\")\n+            raise InvalidDirectiveError, <<~MSG.squish\n+              Invalid Content Security Policy #{directive}: \"#{source}\".\n+              Directive values must not contain whitespace or semicolons.\n+              Please use multiple arguments or other directive methods instead.\n+            MSG\n+          end\n+        end\n+      end\n+\n+      def build_directive(directive, sources, context)\n+        resolved_sources = sources.map { |source| resolve_source(source, context) }\n+\n+        validate(directive, resolved_sources)\n       end\n \n       def resolve_source(source, context)"
            },
            {
                "sha": "b0b6067cc71c01835e85a5bcad17a8c84a4aa689",
                "filename": "actionpack/test/dispatch/content_security_policy_test.rb",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/rails/rails/blob/2e3f41e4538b9ca1044357f6644f037bbb7c6c49/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb",
                "raw_url": "https://github.com/rails/rails/raw/2e3f41e4538b9ca1044357f6644f037bbb7c6c49/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb?ref=2e3f41e4538b9ca1044357f6644f037bbb7c6c49",
                "patch": "@@ -23,6 +23,33 @@ def test_dup\n     assert_equal copied.build, @policy.build\n   end\n \n+  def test_whitespace_validation\n+    @policy.base_uri \"https://some.url https://other.url\"\n+\n+    error = assert_raises(ActionDispatch::ContentSecurityPolicy::InvalidDirectiveError) do\n+      @policy.build\n+    end\n+    assert_equal(<<~MSG.squish, error.message)\n+      Invalid Content Security Policy base-uri: \"https://some.url https://other.url\".\n+      Directive values must not contain whitespace or semicolons.\n+      Please use multiple arguments or other directive methods instead.\n+    MSG\n+  end\n+\n+\n+  def test_semicolon_validation\n+    @policy.base_uri \"https://some.url; script-src https://other.url\"\n+\n+    error = assert_raises(ActionDispatch::ContentSecurityPolicy::InvalidDirectiveError) do\n+      @policy.build\n+    end\n+    assert_equal(<<~MSG.squish, error.message)\n+      Invalid Content Security Policy base-uri: \"https://some.url; script-src https://other.url\".\n+      Directive values must not contain whitespace or semicolons.\n+      Please use multiple arguments or other directive methods instead.\n+    MSG\n+  end\n+\n   def test_mappings\n     @policy.script_src :data\n     assert_equal \"script-src data:\", @policy.build"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails/commits/5558e72f22fc69c1c407b31ac5fb3b4ce087b542",
        "url": "https://api.github.com/repos/rails/rails/commits/5558e72f22fc69c1c407b31ac5fb3b4ce087b542",
        "html_url": "https://github.com/rails/rails/commit/5558e72f22fc69c1c407b31ac5fb3b4ce087b542",
        "message": "Add CSP directive validation\n\nValidate directives to make sure they don't include semicolons or\nwhitespace. These are special and denote lists and termination of\ndirectives.\n\n[CVE-2024-54133]",
        "files": [
            {
                "sha": "7b8b3227e6615b2dda7366aac9dee04ce119babb",
                "filename": "actionpack/CHANGELOG.md",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/rails/rails/blob/5558e72f22fc69c1c407b31ac5fb3b4ce087b542/actionpack%2FCHANGELOG.md",
                "raw_url": "https://github.com/rails/rails/raw/5558e72f22fc69c1c407b31ac5fb3b4ce087b542/actionpack%2FCHANGELOG.md",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2FCHANGELOG.md?ref=5558e72f22fc69c1c407b31ac5fb3b4ce087b542",
                "patch": "@@ -1,3 +1,11 @@\n+*   Add validation to content security policies to disallow spaces and semicolons.\n+    Developers should use multiple arguments, and different directive methods instead.\n+\n+    [CVE-2024-54133]\n+\n+    *Gannon McGibbon*\n+\n+\n ## Rails 7.1.5 (October 30, 2024) ##\n \n *   No changes."
            },
            {
                "sha": "41064745ae999afa933831b27349eb41b37f3e4a",
                "filename": "actionpack/lib/action_dispatch/http/content_security_policy.rb",
                "status": "modified",
                "additions": 21,
                "deletions": 4,
                "changes": 25,
                "blob_url": "https://github.com/rails/rails/blob/5558e72f22fc69c1c407b31ac5fb3b4ce087b542/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb",
                "raw_url": "https://github.com/rails/rails/raw/5558e72f22fc69c1c407b31ac5fb3b4ce087b542/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb?ref=5558e72f22fc69c1c407b31ac5fb3b4ce087b542",
                "patch": "@@ -24,6 +24,9 @@ module ActionDispatch # :nodoc:\n   #     policy.report_uri \"/csp-violation-report-endpoint\"\n   #   end\n   class ContentSecurityPolicy\n+    class InvalidDirectiveError < StandardError\n+    end\n+\n     class Middleware\n       def initialize(app)\n         @app = app\n@@ -317,9 +320,9 @@ def build_directives(context, nonce, nonce_directives)\n         @directives.map do |directive, sources|\n           if sources.is_a?(Array)\n             if nonce && nonce_directive?(directive, nonce_directives)\n-              \"#{directive} #{build_directive(sources, context).join(' ')} 'nonce-#{nonce}'\"\n+              \"#{directive} #{build_directive(directive, sources, context).join(' ')} 'nonce-#{nonce}'\"\n             else\n-              \"#{directive} #{build_directive(sources, context).join(' ')}\"\n+              \"#{directive} #{build_directive(directive, sources, context).join(' ')}\"\n             end\n           elsif sources\n             directive\n@@ -329,8 +332,22 @@ def build_directives(context, nonce, nonce_directives)\n         end\n       end\n \n-      def build_directive(sources, context)\n-        sources.map { |source| resolve_source(source, context) }\n+      def validate(directive, sources)\n+        sources.flatten.each do |source|\n+          if source.include?(\";\") || source != source.gsub(/[[:space:]]/, \"\")\n+            raise InvalidDirectiveError, <<~MSG.squish\n+              Invalid Content Security Policy #{directive}: \"#{source}\".\n+              Directive values must not contain whitespace or semicolons.\n+              Please use multiple arguments or other directive methods instead.\n+            MSG\n+          end\n+        end\n+      end\n+\n+      def build_directive(directive, sources, context)\n+        resolved_sources = sources.map { |source| resolve_source(source, context) }\n+\n+        validate(directive, resolved_sources)\n       end\n \n       def resolve_source(source, context)"
            },
            {
                "sha": "5ccc2755485a415c49cb96b079bb6a89d9d831e3",
                "filename": "actionpack/test/dispatch/content_security_policy_test.rb",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/rails/rails/blob/5558e72f22fc69c1c407b31ac5fb3b4ce087b542/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb",
                "raw_url": "https://github.com/rails/rails/raw/5558e72f22fc69c1c407b31ac5fb3b4ce087b542/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb?ref=5558e72f22fc69c1c407b31ac5fb3b4ce087b542",
                "patch": "@@ -23,6 +23,33 @@ def test_dup\n     assert_equal copied.build, @policy.build\n   end\n \n+  def test_whitespace_validation\n+    @policy.base_uri \"https://some.url https://other.url\"\n+\n+    error = assert_raises(ActionDispatch::ContentSecurityPolicy::InvalidDirectiveError) do\n+      @policy.build\n+    end\n+    assert_equal(<<~MSG.squish, error.message)\n+      Invalid Content Security Policy base-uri: \"https://some.url https://other.url\".\n+      Directive values must not contain whitespace or semicolons.\n+      Please use multiple arguments or other directive methods instead.\n+    MSG\n+  end\n+\n+\n+  def test_semicolon_validation\n+    @policy.base_uri \"https://some.url; script-src https://other.url\"\n+\n+    error = assert_raises(ActionDispatch::ContentSecurityPolicy::InvalidDirectiveError) do\n+      @policy.build\n+    end\n+    assert_equal(<<~MSG.squish, error.message)\n+      Invalid Content Security Policy base-uri: \"https://some.url; script-src https://other.url\".\n+      Directive values must not contain whitespace or semicolons.\n+      Please use multiple arguments or other directive methods instead.\n+    MSG\n+  end\n+\n   def test_mappings\n     @policy.script_src :data\n     assert_equal \"script-src data:\", @policy.build"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails/commits/cb16a3bb515b5d769f73926d9757270ace691f1d",
        "url": "https://api.github.com/repos/rails/rails/commits/cb16a3bb515b5d769f73926d9757270ace691f1d",
        "html_url": "https://github.com/rails/rails/commit/cb16a3bb515b5d769f73926d9757270ace691f1d",
        "message": "Add CSP directive validation\n\nValidate directives to make sure they don't include semicolons or\nwhitespace. These are special and denote lists and termination of\ndirectives.\n\n[CVE-2024-54133]",
        "files": [
            {
                "sha": "bdc5ee34176222f954216015804f7a235f307a91",
                "filename": "actionpack/CHANGELOG.md",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/rails/rails/blob/cb16a3bb515b5d769f73926d9757270ace691f1d/actionpack%2FCHANGELOG.md",
                "raw_url": "https://github.com/rails/rails/raw/cb16a3bb515b5d769f73926d9757270ace691f1d/actionpack%2FCHANGELOG.md",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2FCHANGELOG.md?ref=cb16a3bb515b5d769f73926d9757270ace691f1d",
                "patch": "@@ -1,3 +1,10 @@\n+*   Add validation to content security policies to disallow spaces and semicolons.\n+    Developers should use multiple arguments, and different directive methods instead.\n+\n+    [CVE-2024-54133]\n+\n+    *Gannon McGibbon*\n+\n ## Rails 7.0.8.6 (October 23, 2024) ##\n \n *   No changes."
            },
            {
                "sha": "9975c2edc039bfe6ec36d76be41b3cd465b01f38",
                "filename": "actionpack/lib/action_dispatch/http/content_security_policy.rb",
                "status": "modified",
                "additions": 21,
                "deletions": 4,
                "changes": 25,
                "blob_url": "https://github.com/rails/rails/blob/cb16a3bb515b5d769f73926d9757270ace691f1d/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb",
                "raw_url": "https://github.com/rails/rails/raw/cb16a3bb515b5d769f73926d9757270ace691f1d/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb?ref=cb16a3bb515b5d769f73926d9757270ace691f1d",
                "patch": "@@ -22,6 +22,9 @@ module ActionDispatch # :nodoc:\n   #     policy.report_uri \"/csp-violation-report-endpoint\"\n   #   end\n   class ContentSecurityPolicy\n+    class InvalidDirectiveError < StandardError\n+    end\n+\n     class Middleware\n       CONTENT_TYPE = \"Content-Type\"\n       POLICY = \"Content-Security-Policy\"\n@@ -316,9 +319,9 @@ def build_directives(context, nonce, nonce_directives)\n         @directives.map do |directive, sources|\n           if sources.is_a?(Array)\n             if nonce && nonce_directive?(directive, nonce_directives)\n-              \"#{directive} #{build_directive(sources, context).join(' ')} 'nonce-#{nonce}'\"\n+              \"#{directive} #{build_directive(directive, sources, context).join(' ')} 'nonce-#{nonce}'\"\n             else\n-              \"#{directive} #{build_directive(sources, context).join(' ')}\"\n+              \"#{directive} #{build_directive(directive, sources, context).join(' ')}\"\n             end\n           elsif sources\n             directive\n@@ -328,8 +331,22 @@ def build_directives(context, nonce, nonce_directives)\n         end\n       end\n \n-      def build_directive(sources, context)\n-        sources.map { |source| resolve_source(source, context) }\n+      def validate(directive, sources)\n+        sources.flatten.each do |source|\n+          if source.include?(\";\") || source != source.gsub(/[[:space:]]/, \"\")\n+            raise InvalidDirectiveError, <<~MSG.squish\n+              Invalid Content Security Policy #{directive}: \"#{source}\".\n+              Directive values must not contain whitespace or semicolons.\n+              Please use multiple arguments or other directive methods instead.\n+            MSG\n+          end\n+        end\n+      end\n+\n+      def build_directive(directive, sources, context)\n+        resolved_sources = sources.map { |source| resolve_source(source, context) }\n+\n+        validate(directive, resolved_sources)\n       end\n \n       def resolve_source(source, context)"
            },
            {
                "sha": "810e4394d93b9f2d97d40c230e9b44ab296cbf4c",
                "filename": "actionpack/test/dispatch/content_security_policy_test.rb",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/rails/rails/blob/cb16a3bb515b5d769f73926d9757270ace691f1d/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb",
                "raw_url": "https://github.com/rails/rails/raw/cb16a3bb515b5d769f73926d9757270ace691f1d/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb?ref=cb16a3bb515b5d769f73926d9757270ace691f1d",
                "patch": "@@ -23,6 +23,33 @@ def test_dup\n     assert_equal copied.build, @policy.build\n   end\n \n+  def test_whitespace_validation\n+    @policy.base_uri \"https://some.url https://other.url\"\n+\n+    error = assert_raises(ActionDispatch::ContentSecurityPolicy::InvalidDirectiveError) do\n+      @policy.build\n+    end\n+    assert_equal(<<~MSG.squish, error.message)\n+      Invalid Content Security Policy base-uri: \"https://some.url https://other.url\".\n+      Directive values must not contain whitespace or semicolons.\n+      Please use multiple arguments or other directive methods instead.\n+    MSG\n+  end\n+\n+\n+  def test_semicolon_validation\n+    @policy.base_uri \"https://some.url; script-src https://other.url\"\n+\n+    error = assert_raises(ActionDispatch::ContentSecurityPolicy::InvalidDirectiveError) do\n+      @policy.build\n+    end\n+    assert_equal(<<~MSG.squish, error.message)\n+      Invalid Content Security Policy base-uri: \"https://some.url; script-src https://other.url\".\n+      Directive values must not contain whitespace or semicolons.\n+      Please use multiple arguments or other directive methods instead.\n+    MSG\n+  end\n+\n   def test_mappings\n     @policy.script_src :data\n     assert_equal \"script-src data:\", @policy.build"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails/commits/3da2479cfe1e00177114b17e496213c40d286b3a",
        "url": "https://api.github.com/repos/rails/rails/commits/3da2479cfe1e00177114b17e496213c40d286b3a",
        "html_url": "https://github.com/rails/rails/commit/3da2479cfe1e00177114b17e496213c40d286b3a",
        "message": "Add CSP directive validation\n\nValidate directives to make sure they don't include semicolons or\nwhitespace. These are special and denote lists and termination of\ndirectives.\n\n[CVE-2024-54133]",
        "files": [
            {
                "sha": "047b5be3fe016c36bcda8b0bfec7523e69bb525e",
                "filename": "actionpack/CHANGELOG.md",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/rails/rails/blob/3da2479cfe1e00177114b17e496213c40d286b3a/actionpack%2FCHANGELOG.md",
                "raw_url": "https://github.com/rails/rails/raw/3da2479cfe1e00177114b17e496213c40d286b3a/actionpack%2FCHANGELOG.md",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2FCHANGELOG.md?ref=3da2479cfe1e00177114b17e496213c40d286b3a",
                "patch": "@@ -1,3 +1,11 @@\n+*   Add validation to content security policies to disallow spaces and semicolons.\n+    Developers should use multiple arguments, and different directive methods instead.\n+\n+    [CVE-2024-54133]\n+\n+    *Gannon McGibbon*\n+\n+\n ## Rails 7.2.2 (October 30, 2024) ##\n \n *   Fix non-GET requests not updating cookies in `ActionController::TestCase`."
            },
            {
                "sha": "cd7c262a0384f125a5e714cdff2e999ee07f7a20",
                "filename": "actionpack/lib/action_dispatch/http/content_security_policy.rb",
                "status": "modified",
                "additions": 21,
                "deletions": 4,
                "changes": 25,
                "blob_url": "https://github.com/rails/rails/blob/3da2479cfe1e00177114b17e496213c40d286b3a/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb",
                "raw_url": "https://github.com/rails/rails/raw/3da2479cfe1e00177114b17e496213c40d286b3a/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2Flib%2Faction_dispatch%2Fhttp%2Fcontent_security_policy.rb?ref=3da2479cfe1e00177114b17e496213c40d286b3a",
                "patch": "@@ -26,6 +26,9 @@ module ActionDispatch # :nodoc:\n   #       policy.report_uri \"/csp-violation-report-endpoint\"\n   #     end\n   class ContentSecurityPolicy\n+    class InvalidDirectiveError < StandardError\n+    end\n+\n     class Middleware\n       def initialize(app)\n         @app = app\n@@ -319,9 +322,9 @@ def build_directives(context, nonce, nonce_directives)\n         @directives.map do |directive, sources|\n           if sources.is_a?(Array)\n             if nonce && nonce_directive?(directive, nonce_directives)\n-              \"#{directive} #{build_directive(sources, context).join(' ')} 'nonce-#{nonce}'\"\n+              \"#{directive} #{build_directive(directive, sources, context).join(' ')} 'nonce-#{nonce}'\"\n             else\n-              \"#{directive} #{build_directive(sources, context).join(' ')}\"\n+              \"#{directive} #{build_directive(directive, sources, context).join(' ')}\"\n             end\n           elsif sources\n             directive\n@@ -331,8 +334,22 @@ def build_directives(context, nonce, nonce_directives)\n         end\n       end\n \n-      def build_directive(sources, context)\n-        sources.map { |source| resolve_source(source, context) }\n+      def validate(directive, sources)\n+        sources.flatten.each do |source|\n+          if source.include?(\";\") || source != source.gsub(/[[:space:]]/, \"\")\n+            raise InvalidDirectiveError, <<~MSG.squish\n+              Invalid Content Security Policy #{directive}: \"#{source}\".\n+              Directive values must not contain whitespace or semicolons.\n+              Please use multiple arguments or other directive methods instead.\n+            MSG\n+          end\n+        end\n+      end\n+\n+      def build_directive(directive, sources, context)\n+        resolved_sources = sources.map { |source| resolve_source(source, context) }\n+\n+        validate(directive, resolved_sources)\n       end\n \n       def resolve_source(source, context)"
            },
            {
                "sha": "5ccc2755485a415c49cb96b079bb6a89d9d831e3",
                "filename": "actionpack/test/dispatch/content_security_policy_test.rb",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/rails/rails/blob/3da2479cfe1e00177114b17e496213c40d286b3a/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb",
                "raw_url": "https://github.com/rails/rails/raw/3da2479cfe1e00177114b17e496213c40d286b3a/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails/contents/actionpack%2Ftest%2Fdispatch%2Fcontent_security_policy_test.rb?ref=3da2479cfe1e00177114b17e496213c40d286b3a",
                "patch": "@@ -23,6 +23,33 @@ def test_dup\n     assert_equal copied.build, @policy.build\n   end\n \n+  def test_whitespace_validation\n+    @policy.base_uri \"https://some.url https://other.url\"\n+\n+    error = assert_raises(ActionDispatch::ContentSecurityPolicy::InvalidDirectiveError) do\n+      @policy.build\n+    end\n+    assert_equal(<<~MSG.squish, error.message)\n+      Invalid Content Security Policy base-uri: \"https://some.url https://other.url\".\n+      Directive values must not contain whitespace or semicolons.\n+      Please use multiple arguments or other directive methods instead.\n+    MSG\n+  end\n+\n+\n+  def test_semicolon_validation\n+    @policy.base_uri \"https://some.url; script-src https://other.url\"\n+\n+    error = assert_raises(ActionDispatch::ContentSecurityPolicy::InvalidDirectiveError) do\n+      @policy.build\n+    end\n+    assert_equal(<<~MSG.squish, error.message)\n+      Invalid Content Security Policy base-uri: \"https://some.url; script-src https://other.url\".\n+      Directive values must not contain whitespace or semicolons.\n+      Please use multiple arguments or other directive methods instead.\n+    MSG\n+  end\n+\n   def test_mappings\n     @policy.script_src :data\n     assert_equal \"script-src data:\", @policy.build"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pnpm/pnpm/commits/11afcddea48f25ed5117a87dc1780a55222b9743",
        "url": "https://api.github.com/repos/pnpm/pnpm/commits/11afcddea48f25ed5117a87dc1780a55222b9743",
        "html_url": "https://github.com/pnpm/pnpm/commit/11afcddea48f25ed5117a87dc1780a55222b9743",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "0c85b2f9bc728ff0cb897af29d334898940ad0a4",
                "filename": ".changeset/silent-wombats-roll.md",
                "status": "added",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/pnpm/pnpm/blob/11afcddea48f25ed5117a87dc1780a55222b9743/.changeset%2Fsilent-wombats-roll.md",
                "raw_url": "https://github.com/pnpm/pnpm/raw/11afcddea48f25ed5117a87dc1780a55222b9743/.changeset%2Fsilent-wombats-roll.md",
                "contents_url": "https://api.github.com/repos/pnpm/pnpm/contents/.changeset%2Fsilent-wombats-roll.md?ref=11afcddea48f25ed5117a87dc1780a55222b9743",
                "patch": "@@ -0,0 +1,6 @@\n+---\n+\"@pnpm/npm-resolver\": patch\n+\"pnpm\": patch\n+---\n+\n+Don't ever save mutated metadata to the metadata cache."
            },
            {
                "sha": "137cd81bc535228a95a5d1309cca514e76e9f034",
                "filename": "resolving/npm-resolver/src/pickPackage.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/pnpm/pnpm/blob/11afcddea48f25ed5117a87dc1780a55222b9743/resolving%2Fnpm-resolver%2Fsrc%2FpickPackage.ts",
                "raw_url": "https://github.com/pnpm/pnpm/raw/11afcddea48f25ed5117a87dc1780a55222b9743/resolving%2Fnpm-resolver%2Fsrc%2FpickPackage.ts",
                "contents_url": "https://api.github.com/repos/pnpm/pnpm/contents/resolving%2Fnpm-resolver%2Fsrc%2FpickPackage.ts?ref=11afcddea48f25ed5117a87dc1780a55222b9743",
                "patch": "@@ -205,10 +205,12 @@ export async function pickPackage (\n       // only save meta to cache, when it is fresh\n       ctx.metaCache.set(spec.name, meta)\n       if (!opts.dryRun) {\n+        // We stringify this meta here to avoid saving any mutations that could happen to the meta object.\n+        const stringifiedMeta = JSON.stringify(meta)\n         // eslint-disable-next-line @typescript-eslint/no-floating-promises\n         runLimited(pkgMirror, (limit) => limit(async () => {\n           try {\n-            await saveMeta(pkgMirror, meta)\n+            await saveMeta(pkgMirror, stringifiedMeta)\n           } catch (err: any) { // eslint-disable-line\n             // We don't care if this file was not written to the cache\n           }\n@@ -285,14 +287,14 @@ async function loadMeta (pkgMirror: string): Promise<PackageMeta | null> {\n \n const createdDirs = new Set<string>()\n \n-async function saveMeta (pkgMirror: string, meta: PackageMeta): Promise<void> {\n+async function saveMeta (pkgMirror: string, meta: string): Promise<void> {\n   const dir = path.dirname(pkgMirror)\n   if (!createdDirs.has(dir)) {\n     await fs.mkdir(dir, { recursive: true })\n     createdDirs.add(dir)\n   }\n   const temp = pathTemp(pkgMirror)\n-  await gfs.writeFile(temp, JSON.stringify(meta))\n+  await gfs.writeFile(temp, meta)\n   await renameOverwrite(temp, pkgMirror)\n }\n "
            },
            {
                "sha": "c700ae2e942fdb72e0c14153c0fc9e64a0e97895",
                "filename": "resolving/npm-resolver/test/index.ts",
                "status": "modified",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/pnpm/pnpm/blob/11afcddea48f25ed5117a87dc1780a55222b9743/resolving%2Fnpm-resolver%2Ftest%2Findex.ts",
                "raw_url": "https://github.com/pnpm/pnpm/raw/11afcddea48f25ed5117a87dc1780a55222b9743/resolving%2Fnpm-resolver%2Ftest%2Findex.ts",
                "contents_url": "https://api.github.com/repos/pnpm/pnpm/contents/resolving%2Fnpm-resolver%2Ftest%2Findex.ts?ref=11afcddea48f25ed5117a87dc1780a55222b9743",
                "patch": "@@ -92,6 +92,27 @@ test('resolveFromNpm()', async () => {\n   expect(meta['dist-tags']).toBeTruthy()\n })\n \n+test('resolveFromNpm() does not save mutated meta to the cache', async () => {\n+  nock(registry)\n+    .get('/is-positive')\n+    .reply(200, isPositiveMeta)\n+\n+  const cacheDir = tempy.directory()\n+  const { resolveFromNpm } = createResolveFromNpm({\n+    cacheDir,\n+  })\n+  const resolveResult = await resolveFromNpm({ alias: 'is-positive', pref: '1.0.0' }, {\n+    registry,\n+  })\n+\n+  resolveResult!.manifest!.version = '1000'\n+\n+  // The resolve function does not wait for the package meta cache file to be saved\n+  // so we must delay for a bit in order to read it\n+  const meta = await retryLoadJsonFile<any>(path.join(cacheDir, 'metadata/registry.npmjs.org/is-positive.json')) // eslint-disable-line @typescript-eslint/no-explicit-any\n+  expect(meta.versions['1.0.0'].version).toBe('1.0.0')\n+})\n+\n test('resolveFromNpm() should save metadata to a unique file when the package name has upper case letters', async () => {\n   nock(registry)\n     .get('/JSON')"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pwndoc/pwndoc/commits/1d4219c596f4f518798492e48386a20c6e9a2fe6",
        "url": "https://api.github.com/repos/pwndoc/pwndoc/commits/1d4219c596f4f518798492e48386a20c6e9a2fe6",
        "html_url": "https://github.com/pwndoc/pwndoc/commit/1d4219c596f4f518798492e48386a20c6e9a2fe6",
        "message": "Merge commit from fork\n\nAdded validation of the extension",
        "files": [
            {
                "sha": "a7156d784d667d2b783aa7b0507503928baea00a",
                "filename": "backend/src/routes/template.js",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/pwndoc/pwndoc/blob/1d4219c596f4f518798492e48386a20c6e9a2fe6/backend%2Fsrc%2Froutes%2Ftemplate.js",
                "raw_url": "https://github.com/pwndoc/pwndoc/raw/1d4219c596f4f518798492e48386a20c6e9a2fe6/backend%2Fsrc%2Froutes%2Ftemplate.js",
                "contents_url": "https://api.github.com/repos/pwndoc/pwndoc/contents/backend%2Fsrc%2Froutes%2Ftemplate.js?ref=1d4219c596f4f518798492e48386a20c6e9a2fe6",
                "patch": "@@ -46,6 +46,12 @@ module.exports = function(app) {\n             return;\n         }\n \n+        // Fix for GHSA-2mqc-gg7h-76p6\n+        if (req.body.ext && !utils.validFilename(req.body.ext)) {\n+            Response.BadParameters(res, 'Bad name format');\n+            return;\n+        }\n+\n         var template = {};\n         // Optional parameters\n         if (req.body.name) template.name = req.body.name;"
            },
            {
                "sha": "5b978fadb6eff23d38a007c2a4ab03edfa3449a5",
                "filename": "backend/tests/template.test.js",
                "status": "modified",
                "additions": 38,
                "deletions": 0,
                "changes": 38,
                "blob_url": "https://github.com/pwndoc/pwndoc/blob/1d4219c596f4f518798492e48386a20c6e9a2fe6/backend%2Ftests%2Ftemplate.test.js",
                "raw_url": "https://github.com/pwndoc/pwndoc/raw/1d4219c596f4f518798492e48386a20c6e9a2fe6/backend%2Ftests%2Ftemplate.test.js",
                "contents_url": "https://api.github.com/repos/pwndoc/pwndoc/contents/backend%2Ftests%2Ftemplate.test.js?ref=1d4219c596f4f518798492e48386a20c6e9a2fe6",
                "patch": "@@ -122,6 +122,44 @@ module.exports = function(request, app) {\n         expect(response.status).toBe(404)\n       })\n \n+      it('Update template with invalid filename (Avoid security regression)', async () => {\n+        var template = { name: \"Template Updated../../../../src/config/config.json\" }\n+\n+        var response = await request(app).put(`/api/templates/${template1Id}`)\n+          .set('Cookie', [\n+            `token=JWT ${userToken}`\n+          ])\n+          .send(template)\n+        expect(response.status).toBe(422)\n+      })\n+\n+      it('Update template with invalid file extension (Avoid security regression)', async () => {\n+        var template = {\n+          name: \"Template Updated\",\n+          ext: \"../src/config/config.json\"\n+        }\n+\n+        var response = await request(app).put(`/api/templates/${template1Id}`)\n+          .set('Cookie', [\n+            `token=JWT ${userToken}`\n+          ])\n+          .send(template)\n+        expect(response.status).toBe(422)\n+      })\n+\n+      it('Update template with invalid file extension - No file name (Avoid security regression)', async () => {\n+        var template = {\n+          ext: \"../src/config/config.json\"\n+        }\n+\n+        var response = await request(app).put(`/api/templates/${template1Id}`)\n+          .set('Cookie', [\n+            `token=JWT ${userToken}`\n+          ])\n+          .send(template)\n+        expect(response.status).toBe(422)\n+      })\n+\n       it('Delete template', async () => {\n         var response = await request(app).delete(`/api/templates/${template2Id}`)\n           .set('Cookie', ["
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/peerigon/angular-expressions/commits/97f7ad94006156eeb97fc942332578b6cfbf8eef",
        "url": "https://api.github.com/repos/peerigon/angular-expressions/commits/97f7ad94006156eeb97fc942332578b6cfbf8eef",
        "html_url": "https://github.com/peerigon/angular-expressions/commit/97f7ad94006156eeb97fc942332578b6cfbf8eef",
        "message": "Fix CVE-2024-54152",
        "files": [
            {
                "sha": "1782865cc3e5d2d2a2b20575ad589c1f5660b886",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/peerigon/angular-expressions/blob/97f7ad94006156eeb97fc942332578b6cfbf8eef/CHANGELOG.md",
                "raw_url": "https://github.com/peerigon/angular-expressions/raw/97f7ad94006156eeb97fc942332578b6cfbf8eef/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/peerigon/angular-expressions/contents/CHANGELOG.md?ref=97f7ad94006156eeb97fc942332578b6cfbf8eef",
                "patch": "@@ -1,3 +1,15 @@\n+### 1.4.3\n+\n+Disallow access to prototype chain (CVE-2024-54152) when using compile with locals (two arguments in the called function) :\n+\n+```js\n+compile(\"__proto__\")({}, {});\n+```\n+\n+=> This now returns undefined, previously it would give you the `__proto__` instance which would allow Remote Code Execution.\n+\n+Thanks to [@JorianWoltjer](https://github.com/JorianWoltjer) who found the vulnerability and reported it.\n+\n ### 1.4.2\n \n Make `handleThis` the default if you use the `Lexer` and `Parser` directly, and you don't use `.compile`."
            },
            {
                "sha": "d25b692cf50447199153cd532e2a0310b8abf815",
                "filename": "lib/parse.js",
                "status": "modified",
                "additions": 51,
                "deletions": 7,
                "changes": 58,
                "blob_url": "https://github.com/peerigon/angular-expressions/blob/97f7ad94006156eeb97fc942332578b6cfbf8eef/lib%2Fparse.js",
                "raw_url": "https://github.com/peerigon/angular-expressions/raw/97f7ad94006156eeb97fc942332578b6cfbf8eef/lib%2Fparse.js",
                "contents_url": "https://api.github.com/repos/peerigon/angular-expressions/contents/lib%2Fparse.js?ref=97f7ad94006156eeb97fc942332578b6cfbf8eef",
                "patch": "@@ -42,6 +42,17 @@ if (\"I\".toLowerCase() !== \"i\") {\n \tlowercase = manualLowercase;\n }\n \n+// Run a function and disallow temporarly the use of the Function constructor\n+// This makes arbitrary code generation attacks way more complicated.\n+function runWithFunctionConstructorProtection(fn) {\n+\tvar originalFunctionConstructor = Function.prototype.constructor;\n+\tdelete Function.prototype.constructor;\n+\tvar result = fn();\n+\t// eslint-disable-next-line no-extend-native\n+\tFunction.prototype.constructor = originalFunctionConstructor;\n+\treturn result;\n+}\n+\n var jqLite, // delay binding since jQuery could be loaded after us.\n \ttoString = Object.prototype.toString,\n \tgetPrototypeOf = Object.getPrototypeOf,\n@@ -1690,15 +1701,28 @@ ASTCompiler.prototype = {\n \t\t\textra +\n \t\t\tthis.watchFns() +\n \t\t\t\"return fn;\";\n+\n \t\t// eslint-disable-next-line no-new-func\n-\t\tvar fn = new Function(\n+\t\tvar wrappedFn = new Function(\n \t\t\t\"$filter\",\n \t\t\t\"getStringValue\",\n \t\t\t\"ifDefined\",\n \t\t\t\"plus\",\n \t\t\tfnString\n \t\t)(this.$filter, getStringValue, ifDefined, plusFn);\n \n+\t\tvar fn = function (s, l, a, i) {\n+\t\t\treturn runWithFunctionConstructorProtection(function () {\n+\t\t\t\treturn wrappedFn(s, l, a, i);\n+\t\t\t});\n+\t\t};\n+\t\tfn.assign = function (s, v, l) {\n+\t\t\treturn runWithFunctionConstructorProtection(function () {\n+\t\t\t\treturn wrappedFn.assign(s, v, l);\n+\t\t\t});\n+\t\t};\n+\t\tfn.inputs = wrappedFn.inputs;\n+\n \t\tthis.state = this.stage = undefined;\n \t\tfn.ast = ast;\n \t\tfn.literal = isLiteral(ast);\n@@ -1892,7 +1916,12 @@ ASTCompiler.prototype = {\n \t\t\t\t\t\t);\n \t\t\t\t\t},\n \t\t\t\t\tintoId &&\n-\t\t\t\t\t\tself.lazyAssign(intoId, self.nonComputedMember(\"l\", ast.name))\n+\t\t\t\t\t\tfunction () {\n+\t\t\t\t\t\t\tself.if_(\n+\t\t\t\t\t\t\t\tself.hasOwnProperty_(\"l\", ast.name),\n+\t\t\t\t\t\t\t\tself.lazyAssign(intoId, self.nonComputedMember(\"l\", ast.name))\n+\t\t\t\t\t\t\t);\n+\t\t\t\t\t\t}\n \t\t\t\t);\n \t\t\t\trecursionFn(intoId);\n \t\t\t\tbreak;\n@@ -2166,7 +2195,7 @@ ASTCompiler.prototype = {\n \t},\n \n \tfilter: function (filterName) {\n-\t\tif (!this.state.filters.hasOwnProperty(filterName)) {\n+\t\tif (!hasOwnProperty.call(this.state.filters, filterName)) {\n \t\t\tthis.state.filters[filterName] = this.nextId(true);\n \t\t}\n \t\treturn this.state.filters[filterName];\n@@ -2258,7 +2287,7 @@ ASTCompiler.prototype = {\n \t\t\tleft +\n \t\t\t\"[\" +\n \t\t\tright +\n-\t\t\t\"] : null)\"\n+\t\t\t\"] : undefined)\"\n \t\t);\n \t},\n \n@@ -2375,7 +2404,7 @@ ASTInterpreter.prototype = {\n \t\tforEach(ast.body, function (expression) {\n \t\t\texpressions.push(self.recurse(expression.expression));\n \t\t});\n-\t\tvar fn =\n+\t\tvar wrappedFn =\n \t\t\tast.body.length === 0\n \t\t\t\t? noop\n \t\t\t\t: ast.body.length === 1\n@@ -2389,10 +2418,22 @@ ASTInterpreter.prototype = {\n \t\t\t\t\t\t};\n \n \t\tif (assign) {\n-\t\t\tfn.assign = function (scope, value, locals) {\n+\t\t\twrappedFn.assign = function (scope, value, locals) {\n \t\t\t\treturn assign(scope, locals, value);\n \t\t\t};\n \t\t}\n+\n+\t\tvar fn = function (scope, locals) {\n+\t\t\treturn runWithFunctionConstructorProtection(function () {\n+\t\t\t\treturn wrappedFn(scope, locals);\n+\t\t\t});\n+\t\t};\n+\t\tfn.assign = function (scope, value, locals) {\n+\t\t\treturn runWithFunctionConstructorProtection(function () {\n+\t\t\t\treturn wrappedFn.assign(scope, value, locals);\n+\t\t\t});\n+\t\t};\n+\n \t\tif (inputs) {\n \t\t\tfn.inputs = inputs;\n \t\t}\n@@ -2720,7 +2761,10 @@ ASTInterpreter.prototype = {\n \t\t\tif (create && create !== 1 && base && base[name] == null) {\n \t\t\t\tbase[name] = {};\n \t\t\t}\n-\t\t\tvar value = base ? base[name] : undefined;\n+\t\t\tvar value;\n+\t\t\tif (base && hasOwnProperty.call(base, name)) {\n+\t\t\t\tvalue = base ? base[name] : undefined;\n+\t\t\t}\n \t\t\tif (context) {\n \t\t\t\treturn { context: base, name: name, value: value };\n \t\t\t}"
            },
            {
                "sha": "3ec21ff1a3e72f566ed9aa630fb6cc58912d7aa0",
                "filename": "test/main.test.js",
                "status": "modified",
                "additions": 69,
                "deletions": 2,
                "changes": 71,
                "blob_url": "https://github.com/peerigon/angular-expressions/blob/97f7ad94006156eeb97fc942332578b6cfbf8eef/test%2Fmain.test.js",
                "raw_url": "https://github.com/peerigon/angular-expressions/raw/97f7ad94006156eeb97fc942332578b6cfbf8eef/test%2Fmain.test.js",
                "contents_url": "https://api.github.com/repos/peerigon/angular-expressions/contents/test%2Fmain.test.js?ref=97f7ad94006156eeb97fc942332578b6cfbf8eef",
                "patch": "@@ -226,13 +226,40 @@ describe(\"expressions\", function () {\n \t\t\t\texpect(result).to.equal(undefined);\n \t\t\t});\n \n+\t\t\tit(\"should not leak indirectly with string concatenation with locals\", function () {\n+\t\t\t\tevaluate = compile(\n+\t\t\t\t\t\"a = null; a = ''['c'+'onstructor']['c'+'onstructor']; a = a('return process;'); a();\",\n+\t\t\t\t\t{ csp: true }\n+\t\t\t\t);\n+\t\t\t\tconst result = evaluate({}, {});\n+\t\t\t\texpect(result).to.equal(undefined);\n+\t\t\t});\n+\n \t\t\tit(\"should not leak indirectly with literal string\", function () {\n \t\t\t\tevaluate = compile(\n \t\t\t\t\t\"a = null; a = ''['constructor']['constructor']; a = a('return process;'); a();\"\n \t\t\t\t);\n \t\t\t\tconst result = evaluate({});\n \t\t\t\texpect(result).to.equal(undefined);\n \t\t\t});\n+\n+\t\t\tit(\"should not be able to rewrite hasOwnProperty\", function () {\n+\t\t\t\tconst scope = {\n+\t\t\t\t\t// Pre-condition: any function in scope that returns a truthy value\n+\t\t\t\t\tfunc: function () {\n+\t\t\t\t\t\treturn \"anything truthy\";\n+\t\t\t\t\t},\n+\t\t\t\t};\n+\t\t\t\tconst options = {\n+\t\t\t\t\t// Force to use ASTInterpreter\n+\t\t\t\t\tcsp: true,\n+\t\t\t\t};\n+\t\t\t\tconst result = expressions.compile(\n+\t\t\t\t\t\"hasOwnProperty = func; constructor.getPrototypeOf(toString).constructor('return process')()\",\n+\t\t\t\t\toptions\n+\t\t\t\t)(scope, scope);\n+\t\t\t\texpect(result).to.equal(undefined);\n+\t\t\t});\n \t\t});\n \n \t\tdescribe(\"when evaluating dot-notated assignments\", function () {\n@@ -676,6 +703,13 @@ describe(\"expressions\", function () {\n \t\t\t});\n \t\t\texpect(evaluate(scope)).to.equal(\"myval\");\n \t\t});\n+\n+\t\tit(\"should be possible to calc this+this+this\", function () {\n+\t\t\tconst evaluate = compile(\"this+this+this\", {\n+\t\t\t\tcsp: false,\n+\t\t\t});\n+\t\t\texpect(evaluate(1)).to.equal(3);\n+\t\t});\n \t});\n \n \tdescribe(\"Equality\", function () {\n@@ -756,7 +790,7 @@ describe(\"expressions\", function () {\n \n \t\tit(\"should not leak with computed prop\", function () {\n \t\t\tevaluate = compile(\"a['split']\");\n-\t\t\texpect(evaluate({ a: \"\" })).to.eql(null);\n+\t\t\texpect(evaluate({ a: \"\" })).to.eql(undefined);\n \t\t});\n \n \t\tit(\"should allow to read string length\", function () {\n@@ -782,11 +816,44 @@ describe(\"expressions\", function () {\n \t\t\t);\n \t\t});\n \n-\t\tit(\"should work with __proto__\", function () {\n+\t\tit(\"should not show value of __proto__\", function () {\n \t\t\tevaluate = compile(\"__proto__\");\n \t\t\texpect(evaluate({})).to.eql(undefined);\n \t\t});\n \n+\t\tit(\"should not show value of __proto__ if passing context (second argument) with csp = false\", function () {\n+\t\t\tevaluate = compile(\"__proto__\");\n+\t\t\texpect(evaluate({}, {})).to.eql(undefined);\n+\t\t});\n+\n+\t\tit(\"should not show value of __proto__ if passing context (second argument) with csp = true\", function () {\n+\t\t\tevaluate = compile(\"__proto__\", {\n+\t\t\t\tcsp: true,\n+\t\t\t});\n+\t\t\texpect(evaluate({}, {})).to.eql(undefined);\n+\t\t});\n+\n+\t\tit(\"should not show value of constructor if passing context (second argument) with csp = true\", function () {\n+\t\t\tevaluate = compile(\"constructor\", {\n+\t\t\t\tcsp: true,\n+\t\t\t});\n+\t\t\texpect(evaluate({}, {})).to.eql(undefined);\n+\t\t});\n+\n+\t\tit(\"should not show value of this['__proto__'] if passing context (second argument) with csp = true\", function () {\n+\t\t\tevaluate = compile(\"this['__proto' + '__']\", {\n+\t\t\t\tcsp: true,\n+\t\t\t});\n+\t\t\texpect(evaluate({}, {})).to.eql(undefined);\n+\t\t});\n+\n+\t\tit(\"should not show value of this['__proto__'] if passing context (second argument) with csp = false\", function () {\n+\t\t\tevaluate = compile(\"this['__proto' + '__']\", {\n+\t\t\t\tcsp: false,\n+\t\t\t});\n+\t\t\texpect(evaluate({}, {})).to.eql(undefined);\n+\t\t});\n+\n \t\tit(\"should work with toString\", function () {\n \t\t\tevaluate = compile(\"toString\");\n \t\t\texpect(evaluate({ toString: 10 })).to.eql(10);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ArtifexSoftware/mupdf/commits/b5c898a30f068b5342e8263a2cd5b9f0be291aac",
        "url": "https://api.github.com/repos/ArtifexSoftware/mupdf/commits/b5c898a30f068b5342e8263a2cd5b9f0be291aac",
        "html_url": "https://github.com/ArtifexSoftware/mupdf/commit/b5c898a30f068b5342e8263a2cd5b9f0be291aac",
        "message": "Bug 707996: Declare variable fz_var to avoid stale values.\n\nA fuzzed file provoked an ASAN warning when building release mode.\n\nFor good measure, also declare a variable in an unrelated function\nin the same tool fz_var.",
        "files": [
            {
                "sha": "b3c5a0f96eb2f461d21659083efc2f6f9e70bedc",
                "filename": "source/tools/pdfextract.c",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/ArtifexSoftware/mupdf/blob/b5c898a30f068b5342e8263a2cd5b9f0be291aac/source%2Ftools%2Fpdfextract.c",
                "raw_url": "https://github.com/ArtifexSoftware/mupdf/raw/b5c898a30f068b5342e8263a2cd5b9f0be291aac/source%2Ftools%2Fpdfextract.c",
                "contents_url": "https://api.github.com/repos/ArtifexSoftware/mupdf/contents/source%2Ftools%2Fpdfextract.c?ref=b5c898a30f068b5342e8263a2cd5b9f0be291aac",
                "patch": "@@ -119,6 +119,7 @@ static void saveimage(pdf_obj *ref)\n \tint type;\n \n \tfz_var(image);\n+\tfz_var(mask);\n \tfz_var(pix);\n \n \tfz_try(ctx)\n@@ -251,7 +252,9 @@ static void savefont(pdf_obj *dict)\n \n static void extractobject(int num)\n {\n-\tpdf_obj *ref;\n+\tpdf_obj *ref = NULL;\n+\n+\tfz_var(ref);\n \n \tfz_try(ctx)\n \t{"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/avwo/whistle/commits/d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf",
        "url": "https://api.github.com/repos/avwo/whistle/commits/d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf",
        "html_url": "https://github.com/avwo/whistle/commit/d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf",
        "message": "feat: refine --allowOrigin",
        "files": [
            {
                "sha": "8fa624e5b77ae861610edff9ee8f453f4aba5f3f",
                "filename": "biz/webui/lib/index.js",
                "status": "modified",
                "additions": 32,
                "deletions": 39,
                "changes": 71,
                "blob_url": "https://github.com/avwo/whistle/blob/d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf/biz%2Fwebui%2Flib%2Findex.js",
                "raw_url": "https://github.com/avwo/whistle/raw/d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf/biz%2Fwebui%2Flib%2Findex.js",
                "contents_url": "https://api.github.com/repos/avwo/whistle/contents/biz%2Fwebui%2Flib%2Findex.js?ref=d1b8ca275dc4e453bd2efed392c0fd4b92f73cdf",
                "patch": "@@ -291,47 +291,17 @@ app.use(function(req, res, next) {\n   if (req.headers.host !== 'rootca.pro') {\n     return next();\n   }\n-  var type = 'crt';\n-  if (!req.path.indexOf('/cer')) {\n-    type = 'cer';\n+  var type = 'cer';\n+  if (!req.path.indexOf('/crt')) {\n+    type = 'crt';\n   } else if (!req.path.indexOf('/pem')) {\n     type = 'pem';\n   }\n   res.download(getRootCAFile(), 'rootCA.' + type);\n });\n \n-function checkAllowOrigin(req) {\n-  if (config.allowAllOrigin ||\n-    req.headers['sec-fetch-site'] === 'same-origin' ||\n-    ALLOW_CROSS_URLS.indexOf(req.path) !== -1) {\n-    return true;\n-  }\n-  var host = req.headers['x-whistle-origin-host'];\n+function isAllowHost(host) {\n   var list = config.allowOrigin;\n-  if (!host) {\n-    host = req.headers.origin;\n-    if (!host || typeof host !== 'string') {\n-      return true;\n-    }\n-    var index = host.indexOf('://');\n-    if (index !== -1) {\n-      host = host.substring(index + 3);\n-    }\n-    host = util.parseHost(host)[0];\n-    if (!host) {\n-      return false;\n-    }\n-    if (!list) {\n-      if (config.isWebUIHost(host)) {\n-        req._isWebUIHost = true;\n-        return true;\n-      }\n-      return false;\n-    }\n-  }\n-  if (host === '*') {\n-    return false;\n-  }\n   if (list) {\n     for (var i = 0, len = list.length; i < len; i++) {\n       var h = list[i];\n@@ -340,18 +310,41 @@ function checkAllowOrigin(req) {\n       }\n     }\n   }\n-  if (config.isWebUIHost(host)) {\n-    req._isWebUIHost = true;\n+}\n+\n+function checkInternalPath(req) {\n+  if (config.allowAllOrigin || ALLOW_CROSS_URLS.indexOf(req.path) !== -1) {\n     return true;\n   }\n-  return false;\n+  var host = req.headers['x-whistle-origin-host'];\n+  return !host || isAllowHost(host);\n+}\n+\n+function checkAllowOrigin(req) {\n+  var host = req.headers.origin;\n+  if (!host || typeof host !== 'string' ||\n+    req.headers['sec-fetch-site'] === 'same-origin') {\n+    return false;\n+  }\n+  if (config.allowAllOrigin) {\n+    return true;\n+  }\n+  if (!config.allowOrigin) {\n+    return false;\n+  }\n+  var index = host.indexOf('://');\n+  if (index !== -1) {\n+    host = host.substring(index + 3);\n+  }\n+  host = util.parseHost(host)[0];\n+  return host && isAllowHost(host);\n }\n \n function cgiHandler(req, res) {\n-  if (UP_PATH_REGEXP.test(req.path) || !checkAllowOrigin(req)) {\n+  if (UP_PATH_REGEXP.test(req.path) || !checkInternalPath(req)) {\n     return res.status(403).end('Forbidden');\n   }\n-  if (!req._isWebUIHost && req.headers.origin) {\n+  if (checkAllowOrigin(req)) {\n     res.setHeader('access-control-allow-origin', req.headers.origin);\n     res.setHeader('access-control-allow-credentials', true);\n   }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/drupal/core/commits/1664030d399c73b4144f410f2ccc68c66a947f8d",
        "url": "https://api.github.com/repos/drupal/core/commits/1664030d399c73b4144f410f2ccc68c66a947f8d",
        "html_url": "https://github.com/drupal/core/commit/1664030d399c73b4144f410f2ccc68c66a947f8d",
        "message": "SA-CORE-2024-007 by mcdruid, larowlan",
        "files": [
            {
                "sha": "87739a90c96c9381a6b6936abafdcb39336c9e95",
                "filename": "modules/views/src/ViewExecutable.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/drupal/core/blob/1664030d399c73b4144f410f2ccc68c66a947f8d/modules%2Fviews%2Fsrc%2FViewExecutable.php",
                "raw_url": "https://github.com/drupal/core/raw/1664030d399c73b4144f410f2ccc68c66a947f8d/modules%2Fviews%2Fsrc%2FViewExecutable.php",
                "contents_url": "https://api.github.com/repos/drupal/core/contents/modules%2Fviews%2Fsrc%2FViewExecutable.php?ref=1664030d399c73b4144f410f2ccc68c66a947f8d",
                "patch": "@@ -8,6 +8,7 @@\n use Drupal\\Core\\Routing\\RouteProviderInterface;\n use Drupal\\Core\\Session\\AccountInterface;\n use Drupal\\views\\Plugin\\views\\display\\DisplayRouterInterface;\n+use Drupal\\views\\Plugin\\views\\query\\QueryPluginBase;\n use Drupal\\views\\Plugin\\ViewsPluginManager;\n use Symfony\\Component\\HttpFoundation\\Request;\n use Symfony\\Component\\HttpFoundation\\Response;\n@@ -219,7 +220,7 @@ class ViewExecutable {\n    *\n    * @var \\Drupal\\views\\Plugin\\views\\query\\QueryPluginBase\n    */\n-  public $query = NULL;\n+  public ?QueryPluginBase $query = NULL;\n \n   /**\n    * The used pager plugin used by the current executed view."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/drupal/core/commits/17f362b988e6ad6bd5cc1e7e8a7a0804e1536fbc",
        "url": "https://api.github.com/repos/drupal/core/commits/17f362b988e6ad6bd5cc1e7e8a7a0804e1536fbc",
        "html_url": "https://github.com/drupal/core/commit/17f362b988e6ad6bd5cc1e7e8a7a0804e1536fbc",
        "message": "SA-CORE-2024-006 by mcdruid, larowlan",
        "files": [
            {
                "sha": "820fe041fc665a6ee6d69431e82d7bdfcb675991",
                "filename": "lib/Drupal/Core/Config/StorageComparer.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/drupal/core/blob/17f362b988e6ad6bd5cc1e7e8a7a0804e1536fbc/lib%2FDrupal%2FCore%2FConfig%2FStorageComparer.php",
                "raw_url": "https://github.com/drupal/core/raw/17f362b988e6ad6bd5cc1e7e8a7a0804e1536fbc/lib%2FDrupal%2FCore%2FConfig%2FStorageComparer.php",
                "contents_url": "https://api.github.com/repos/drupal/core/contents/lib%2FDrupal%2FCore%2FConfig%2FStorageComparer.php?ref=17f362b988e6ad6bd5cc1e7e8a7a0804e1536fbc",
                "patch": "@@ -4,6 +4,7 @@\n \n use Drupal\\Component\\Datetime\\Time;\n use Drupal\\Component\\Datetime\\TimeInterface;\n+use Drupal\\Core\\Cache\\CacheBackendInterface;\n use Drupal\\Core\\Cache\\MemoryBackend;\n use Drupal\\Core\\Cache\\NullBackend;\n use Drupal\\Core\\Config\\Entity\\ConfigDependencyManager;\n@@ -85,7 +86,7 @@ class StorageComparer implements StorageComparerInterface {\n    *\n    * @var \\Drupal\\Core\\Cache\\CacheBackendInterface\n    */\n-  protected $targetCacheStorage;\n+  protected CacheBackendInterface $targetCacheStorage;\n \n   /**\n    * Indicates whether the target storage should be wrapped in a cache."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/drupal/core/commits/7ae0e8f1824e15f8b2b06e4da09836250e85e934",
        "url": "https://api.github.com/repos/drupal/core/commits/7ae0e8f1824e15f8b2b06e4da09836250e85e934",
        "html_url": "https://github.com/drupal/core/commit/7ae0e8f1824e15f8b2b06e4da09836250e85e934",
        "message": "SA-CORE-2024-004 by zengenuity, cilefen, kristiaanvandeneynde, mcdruid, larowlan",
        "files": [
            {
                "sha": "23c7019bdcc1b8fbcd1ba96accaebffd8f6ff6b7",
                "filename": "lib/Drupal/Core/Validation/Plugin/Validation/Constraint/UniqueFieldConstraint.php",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/drupal/core/blob/7ae0e8f1824e15f8b2b06e4da09836250e85e934/lib%2FDrupal%2FCore%2FValidation%2FPlugin%2FValidation%2FConstraint%2FUniqueFieldConstraint.php",
                "raw_url": "https://github.com/drupal/core/raw/7ae0e8f1824e15f8b2b06e4da09836250e85e934/lib%2FDrupal%2FCore%2FValidation%2FPlugin%2FValidation%2FConstraint%2FUniqueFieldConstraint.php",
                "contents_url": "https://api.github.com/repos/drupal/core/contents/lib%2FDrupal%2FCore%2FValidation%2FPlugin%2FValidation%2FConstraint%2FUniqueFieldConstraint.php?ref=7ae0e8f1824e15f8b2b06e4da09836250e85e934",
                "patch": "@@ -17,6 +17,16 @@ class UniqueFieldConstraint extends SymfonyConstraint {\n \n   public $message = 'A @entity_type with @field_name %value already exists.';\n \n+  /**\n+   * This constraint is case-insensitive by default.\n+   *\n+   * For example \"FOO\" and \"foo\" would be considered as equivalent, and\n+   * validation of the constraint would fail.\n+   *\n+   * @var bool\n+   */\n+  public $caseSensitive = FALSE;\n+\n   /**\n    * {@inheritdoc}\n    */"
            },
            {
                "sha": "149030512117a95fb680b252e9bd0a8abce67bcc",
                "filename": "lib/Drupal/Core/Validation/Plugin/Validation/Constraint/UniqueFieldValueValidator.php",
                "status": "modified",
                "additions": 12,
                "deletions": 1,
                "changes": 13,
                "blob_url": "https://github.com/drupal/core/blob/7ae0e8f1824e15f8b2b06e4da09836250e85e934/lib%2FDrupal%2FCore%2FValidation%2FPlugin%2FValidation%2FConstraint%2FUniqueFieldValueValidator.php",
                "raw_url": "https://github.com/drupal/core/raw/7ae0e8f1824e15f8b2b06e4da09836250e85e934/lib%2FDrupal%2FCore%2FValidation%2FPlugin%2FValidation%2FConstraint%2FUniqueFieldValueValidator.php",
                "contents_url": "https://api.github.com/repos/drupal/core/contents/lib%2FDrupal%2FCore%2FValidation%2FPlugin%2FValidation%2FConstraint%2FUniqueFieldValueValidator.php?ref=7ae0e8f1824e15f8b2b06e4da09836250e85e934",
                "patch": "@@ -64,12 +64,23 @@ public function validate($items, Constraint $constraint): void {\n       ->getStorage($entity_type_id)\n       ->getAggregateQuery()\n       ->accessCheck(FALSE)\n-      ->condition($field_name, $item_values, 'IN')\n       ->groupBy(\"$field_name.$property_name\");\n     if (!$is_new) {\n       $entity_id = $entity->id();\n       $query->condition($id_key, $entity_id, '<>');\n     }\n+\n+    if ($constraint->caseSensitive) {\n+      $query->condition($field_name, $item_values, 'IN');\n+    }\n+    else {\n+      $or_group = $query->orConditionGroup();\n+      foreach ($item_values as $item_value) {\n+        $or_group->condition($field_name, \\Drupal::database()->escapeLike($item_value), 'LIKE');\n+      }\n+      $query->condition($or_group);\n+    }\n+\n     $results = $query->execute();\n \n     if (!empty($results)) {"
            },
            {
                "sha": "fd2300a7ca188258687d798693f400baf6197c6e",
                "filename": "modules/file/src/Plugin/Validation/Constraint/FileUriUnique.php",
                "status": "modified",
                "additions": 14,
                "deletions": 3,
                "changes": 17,
                "blob_url": "https://github.com/drupal/core/blob/7ae0e8f1824e15f8b2b06e4da09836250e85e934/modules%2Ffile%2Fsrc%2FPlugin%2FValidation%2FConstraint%2FFileUriUnique.php",
                "raw_url": "https://github.com/drupal/core/raw/7ae0e8f1824e15f8b2b06e4da09836250e85e934/modules%2Ffile%2Fsrc%2FPlugin%2FValidation%2FConstraint%2FFileUriUnique.php",
                "contents_url": "https://api.github.com/repos/drupal/core/contents/modules%2Ffile%2Fsrc%2FPlugin%2FValidation%2FConstraint%2FFileUriUnique.php?ref=7ae0e8f1824e15f8b2b06e4da09836250e85e934",
                "patch": "@@ -4,7 +4,8 @@\n \n use Drupal\\Core\\StringTranslation\\TranslatableMarkup;\n use Drupal\\Core\\Validation\\Attribute\\Constraint;\n-use Symfony\\Component\\Validator\\Constraint as SymfonyConstraint;\n+use Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint\\UniqueFieldConstraint;\n+use Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint\\UniqueFieldValueValidator;\n \n /**\n  * Supports validating file URIs.\n@@ -13,15 +14,25 @@\n   id: 'FileUriUnique',\n   label: new TranslatableMarkup('File URI', [], ['context' => 'Validation'])\n )]\n-class FileUriUnique extends SymfonyConstraint {\n+class FileUriUnique extends UniqueFieldConstraint {\n \n   public $message = 'The file %value already exists. Enter a unique file URI.';\n \n+  /**\n+   * This constraint is case-sensitive.\n+   *\n+   * For example \"public://foo.txt\" and \"public://FOO.txt\" are treated as\n+   * different values, and can co-exist.\n+   *\n+   * @var bool\n+   */\n+  public $caseSensitive = TRUE;\n+\n   /**\n    * {@inheritdoc}\n    */\n   public function validatedBy(): string {\n-    return '\\Drupal\\Core\\Validation\\Plugin\\Validation\\Constraint\\UniqueFieldValueValidator';\n+    return UniqueFieldValueValidator::class;\n   }\n \n }"
            },
            {
                "sha": "2e2f24def8f488279b536db5a3a9a53ec00b47bb",
                "filename": "modules/user/user.install",
                "status": "modified",
                "additions": 25,
                "deletions": 9,
                "changes": 34,
                "blob_url": "https://github.com/drupal/core/blob/7ae0e8f1824e15f8b2b06e4da09836250e85e934/modules%2Fuser%2Fuser.install",
                "raw_url": "https://github.com/drupal/core/raw/7ae0e8f1824e15f8b2b06e4da09836250e85e934/modules%2Fuser%2Fuser.install",
                "contents_url": "https://api.github.com/repos/drupal/core/contents/modules%2Fuser%2Fuser.install?ref=7ae0e8f1824e15f8b2b06e4da09836250e85e934",
                "patch": "@@ -98,6 +98,7 @@ function user_requirements($phase): array {\n   if ($phase !== 'runtime') {\n     return [];\n   }\n+  $return = [];\n \n   $result = (bool) \\Drupal::entityQuery('user')\n     ->accessCheck(FALSE)\n@@ -106,17 +107,32 @@ function user_requirements($phase): array {\n     ->execute();\n \n   if ($result === FALSE) {\n-    return [\n-      'anonymous user' => [\n-        'title' => t('Anonymous user'),\n-        'description' => t('The anonymous user does not exist. See the <a href=\":url\">restore the anonymous (user ID 0) user record</a> for more information', [\n-          ':url' => 'https://www.drupal.org/node/1029506',\n-        ]),\n-        'severity' => REQUIREMENT_WARNING,\n-      ],\n+    $return['anonymous user'] = [\n+      'title' => t('Anonymous user'),\n+      'description' => t('The anonymous user does not exist. See the <a href=\":url\">restore the anonymous (user ID 0) user record</a> for more information', [\n+        ':url' => 'https://www.drupal.org/node/1029506',\n+      ]),\n+      'severity' => REQUIREMENT_WARNING,\n+    ];\n+  }\n+\n+  $query = \\Drupal::database()->select('users_field_data');\n+  $query->addExpression('LOWER(mail)', 'lower_mail');\n+  $query->groupBy('lower_mail');\n+  $query->having('COUNT(uid) > :matches', [':matches' => 1]);\n+  $conflicts = $query->countQuery()->execute()->fetchField();\n+\n+  if ($conflicts > 0) {\n+    $return['conflicting emails'] = [\n+      'title' => t('Conflicting user emails'),\n+      'description' => t('Some user accounts have email addresses that differ only by case. For example, one account might have alice@example.com and another might have Alice@Example.com. See <a href=\":url\">Conflicting User Emails</a> for more information.', [\n+        ':url' => 'https://www.drupal.org/node/3486109',\n+      ]),\n+      'severity' => REQUIREMENT_WARNING,\n     ];\n   }\n-  return [];\n+\n+  return $return;\n }\n \n /**"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/drupal/core/commits/276ac67ad891605052e0a24fb36ece9caaa511e8",
        "url": "https://api.github.com/repos/drupal/core/commits/276ac67ad891605052e0a24fb36ece9caaa511e8",
        "html_url": "https://github.com/drupal/core/commit/276ac67ad891605052e0a24fb36ece9caaa511e8",
        "message": "SA-CORE-2024-003 by jrb, larowlan, catch, mingsong, poker10, longwave, benjifisher",
        "files": [
            {
                "sha": "dbcf989fa7f7657ee3bbc222487554342619e761",
                "filename": "lib/Drupal/Core/Ajax/MessageCommand.php",
                "status": "modified",
                "additions": 7,
                "deletions": 3,
                "changes": 10,
                "blob_url": "https://github.com/drupal/core/blob/276ac67ad891605052e0a24fb36ece9caaa511e8/lib%2FDrupal%2FCore%2FAjax%2FMessageCommand.php",
                "raw_url": "https://github.com/drupal/core/raw/276ac67ad891605052e0a24fb36ece9caaa511e8/lib%2FDrupal%2FCore%2FAjax%2FMessageCommand.php",
                "contents_url": "https://api.github.com/repos/drupal/core/contents/lib%2FDrupal%2FCore%2FAjax%2FMessageCommand.php?ref=276ac67ad891605052e0a24fb36ece9caaa511e8",
                "patch": "@@ -2,6 +2,8 @@\n \n namespace Drupal\\Core\\Ajax;\n \n+use Drupal\\Component\\Render\\MarkupInterface;\n+use Drupal\\Component\\Utility\\Xss;\n use Drupal\\Core\\Asset\\AttachedAssets;\n \n /**\n@@ -68,7 +70,7 @@ class MessageCommand implements CommandInterface, CommandWithAttachedAssetsInter\n   /**\n    * The message text.\n    *\n-   * @var string\n+   * @var string|\\Drupal\\Component\\Render\\MarkupInterface\n    */\n   protected $message;\n \n@@ -96,7 +98,7 @@ class MessageCommand implements CommandInterface, CommandWithAttachedAssetsInter\n   /**\n    * Constructs a MessageCommand object.\n    *\n-   * @param string $message\n+   * @param string|\\Drupal\\Component\\Render\\MarkupInterface $message\n    *   The text of the message.\n    * @param string|null $wrapper_query_selector\n    *   The query selector of the element to display messages in when they\n@@ -120,7 +122,9 @@ public function __construct($message, $wrapper_query_selector = NULL, array $opt\n   public function render() {\n     return [\n       'command' => 'message',\n-      'message' => $this->message,\n+      'message' => $this->message instanceof MarkupInterface\n+        ? (string) $this->message\n+        : Xss::filterAdmin($this->message),\n       'messageWrapperQuerySelector' => $this->wrapperQuerySelector,\n       'messageOptions' => $this->options,\n       'clearPrevious' => $this->clearPrevious,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/gohugoio/hugo/commits/54398f8d572c689f9785d59e907fd910a23401b0",
        "url": "https://api.github.com/repos/gohugoio/hugo/commits/54398f8d572c689f9785d59e907fd910a23401b0",
        "html_url": "https://github.com/gohugoio/hugo/commit/54398f8d572c689f9785d59e907fd910a23401b0",
        "message": "tpl/tplimpl: Escape Markdown attributes in render hooks and shortcodes",
        "files": [
            {
                "sha": "7f2c3503216b49d04b13eb9b091172a47c03c3d4",
                "filename": "hugolib/content_render_hooks_test.go",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/gohugoio/hugo/blob/54398f8d572c689f9785d59e907fd910a23401b0/hugolib%2Fcontent_render_hooks_test.go",
                "raw_url": "https://github.com/gohugoio/hugo/raw/54398f8d572c689f9785d59e907fd910a23401b0/hugolib%2Fcontent_render_hooks_test.go",
                "contents_url": "https://api.github.com/repos/gohugoio/hugo/contents/hugolib%2Fcontent_render_hooks_test.go?ref=54398f8d572c689f9785d59e907fd910a23401b0",
                "patch": "@@ -90,7 +90,7 @@ baseURL=\"https://example.org\"\n   [markup.goldmark]\n     [markup.goldmark.renderer]\n       unsafe = true\n-    \n+\n `)\n \n \tb.WithTemplates(\"index.html\", `\n@@ -223,16 +223,16 @@ iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAA\n iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==\n -- layouts/_default/single.html --\n {{ .Title }}|{{ .Content }}|$\n-\t\n+\n `\n \n \tt.Run(\"Default multilingual\", func(t *testing.T) {\n \t\tb := Test(t, files)\n \n \t\tb.AssertFileContent(\"public/nn/p1/index.html\",\n-\t\t\t\"p1|<p><a href=\\\"/nn/p2/\\\">P2</a\\n></p>\", \"<img alt=\\\"Pixel\\\" src=\\\"/nn/p1/pixel.nn.png\\\">\")\n+\t\t\t\"p1|<p><a href=\\\"/nn/p2/\\\">P2</a\\n></p>\", \"<img src=\\\"/nn/p1/pixel.nn.png\\\" alt=\\\"Pixel\\\">\")\n \t\tb.AssertFileContent(\"public/en/p1/index.html\",\n-\t\t\t\"p1 en|<p><a href=\\\"/en/p2/\\\">P2</a\\n></p>\", \"<img alt=\\\"Pixel\\\" src=\\\"/nn/p1/pixel.nn.png\\\">\")\n+\t\t\t\"p1 en|<p><a href=\\\"/en/p2/\\\">P2</a\\n></p>\", \"<img src=\\\"/nn/p1/pixel.nn.png\\\" alt=\\\"Pixel\\\">\")\n \t})\n \n \tt.Run(\"Disabled\", func(t *testing.T) {\n@@ -279,7 +279,7 @@ Image: ![alt-\"<>&](/destination-\"<> 'title-\"<>&')\n \t\t\tif enabled {\n \t\t\t\tb.AssertFileContent(\"public/index.html\",\n \t\t\t\t\t\"Link: <a href=\\\"/destination-%22%3C%3E\\\" title=\\\"title-&#34;&lt;&gt;&amp;\\\">text-&quot;&lt;&gt;&amp;</a>\",\n-\t\t\t\t\t\"img alt=\\\"alt-&quot;&lt;&gt;&amp;\\\" src=\\\"/destination-%22%3C%3E\\\" title=\\\"title-&#34;&lt;&gt;&amp;\\\">\",\n+\t\t\t\t\t\"img src=\\\"/destination-%22%3C%3E\\\" alt=\\\"alt-&quot;&lt;&gt;&amp;\\\" title=\\\"title-&#34;&lt;&gt;&amp;\\\">\",\n \t\t\t\t\t\"&gt;&lt;script&gt;\",\n \t\t\t\t)\n \t\t\t} else {"
            },
            {
                "sha": "36cf953ae187e2a19d8770e8adcf007090b3b161",
                "filename": "markup/goldmark/tables/tables_integration_test.go",
                "status": "modified",
                "additions": 8,
                "deletions": 7,
                "changes": 15,
                "blob_url": "https://github.com/gohugoio/hugo/blob/54398f8d572c689f9785d59e907fd910a23401b0/markup%2Fgoldmark%2Ftables%2Ftables_integration_test.go",
                "raw_url": "https://github.com/gohugoio/hugo/raw/54398f8d572c689f9785d59e907fd910a23401b0/markup%2Fgoldmark%2Ftables%2Ftables_integration_test.go",
                "contents_url": "https://api.github.com/repos/gohugoio/hugo/contents/markup%2Fgoldmark%2Ftables%2Ftables_integration_test.go?ref=54398f8d572c689f9785d59e907fd910a23401b0",
                "patch": "@@ -89,6 +89,12 @@ title = true\n | Codecademy Hoodie |  False   | 42.99 |\n {.foo}\n \n+## Table 2\n+\n+a|b\n+---|---\n+1|2\n+{id=\"\\\"><script>alert()</script>\"}\n \n -- layouts/_default/single.html --\n Summary: {{ .Summary }}\n@@ -97,7 +103,8 @@ Content: {{ .Content }}\n `\n \tb := hugolib.Test(t, files)\n \n-\tb.AssertFileContent(\"public/p1/index.html\", \"<table class=\\\"foo\\\">\")\n+\tb.AssertFileContent(\"public/p1/index.html\", `<table class=\"foo\">`)\n+\tb.AssertFileContent(\"public/p1/index.html\", `<table id=\"&#34;&gt;&lt;script&gt;alert()&lt;/script&gt;\">`)\n }\n \n // Issue 12811.\n@@ -166,14 +173,8 @@ title: \"Home\"\n | Codecademy Tee    |  False   | 19.99 |\n | Codecademy Hoodie |  False   | 42.99 |\n \n-\n-\n-\n-\n -- layouts/index.xml --\n Content: {{ .Content }}\n-\n-\n `\n \tb := hugolib.Test(t, files)\n "
            },
            {
                "sha": "5c0f4383597d10fb567c9e0d1ba01b72c29ea6b2",
                "filename": "tpl/tplimpl/embedded/templates/_default/_markup/render-image.html",
                "status": "modified",
                "additions": 7,
                "deletions": 6,
                "changes": 13,
                "blob_url": "https://github.com/gohugoio/hugo/blob/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2F_default%2F_markup%2Frender-image.html",
                "raw_url": "https://github.com/gohugoio/hugo/raw/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2F_default%2F_markup%2Frender-image.html",
                "contents_url": "https://api.github.com/repos/gohugoio/hugo/contents/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2F_default%2F_markup%2Frender-image.html?ref=54398f8d572c689f9785d59e907fd910a23401b0",
                "patch": "@@ -1,7 +1,7 @@\n {{- $u := urls.Parse .Destination -}}\n {{- $src := $u.String -}}\n {{- if not $u.IsAbs -}}\n-  {{- $path := strings.TrimPrefix \"./\" $u.Path }}\n+  {{- $path := strings.TrimPrefix \"./\" $u.Path -}}\n   {{- with or (.PageInner.Resources.Get $path) (resources.Get $path) -}}\n     {{- $src = .RelPermalink -}}\n     {{- with $u.RawQuery -}}\n@@ -12,11 +12,12 @@\n     {{- end -}}\n   {{- end -}}\n {{- end -}}\n-{{- $attributes := merge .Attributes (dict \"alt\" .Text \"src\" $src \"title\" (.Title | transform.HTMLEscape)) -}}\n-<img\n-  {{- range $k, $v := $attributes -}}\n+<img src=\"{{ $src }}\" alt=\"{{ .Text }}\"\n+  {{- with .Title }} title=\"{{ . }}\" {{- end -}}\n+  {{- range $k, $v := .Attributes -}}\n     {{- if $v -}}\n-      {{- printf \" %s=%q\" $k $v | safeHTMLAttr -}}\n+      {{- printf \" %s=%q\" $k ($v | transform.HTMLEscape) | safeHTMLAttr -}}\n     {{- end -}}\n-  {{- end -}}>\n+  {{- end -}}\n+>\n {{- /**/ -}}"
            },
            {
                "sha": "95e15aba426f19294fbb8d2a35281d845f24793f",
                "filename": "tpl/tplimpl/embedded/templates/_default/_markup/render-link.html",
                "status": "modified",
                "additions": 5,
                "deletions": 12,
                "changes": 17,
                "blob_url": "https://github.com/gohugoio/hugo/blob/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2F_default%2F_markup%2Frender-link.html",
                "raw_url": "https://github.com/gohugoio/hugo/raw/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2F_default%2F_markup%2Frender-link.html",
                "contents_url": "https://api.github.com/repos/gohugoio/hugo/contents/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2F_default%2F_markup%2Frender-link.html?ref=54398f8d572c689f9785d59e907fd910a23401b0",
                "patch": "@@ -1,9 +1,9 @@\n {{- $u := urls.Parse .Destination -}}\n {{- $href := $u.String -}}\n-{{- if strings.HasPrefix $u.String \"#\" }}\n-  {{- $href = printf \"%s#%s\" .PageInner.RelPermalink $u.Fragment }}\n-{{- else if not $u.IsAbs -}}\n-  {{- $path := strings.TrimPrefix \"./\" $u.Path }}\n+{{- if strings.HasPrefix $u.String \"#\" -}}\n+  {{- $href = printf \"%s#%s\" .PageInner.RelPermalink $u.Fragment -}}\n+{{- else if and $href (not $u.IsAbs) -}}\n+  {{- $path := strings.TrimPrefix \"./\" $u.Path -}}\n   {{- with or\n     ($.PageInner.GetPage $path)\n     ($.PageInner.Resources.Get $path)\n@@ -18,12 +18,5 @@\n     {{- end -}}\n   {{- end -}}\n {{- end -}}\n-{{- $attributes := dict \"href\" $href \"title\" (.Title | transform.HTMLEscape) -}}\n-<a\n-  {{- range $k, $v := $attributes -}}\n-    {{- if $v -}}\n-      {{- printf \" %s=%q\" $k $v | safeHTMLAttr -}}\n-    {{- end -}}\n-  {{- end -}}\n-  >{{ .Text }}</a>\n+<a href=\"{{ $href }}\" {{- with .Title }} title=\"{{ . }}\" {{- end }}>{{ .Text }}</a>\n {{- /**/ -}}"
            },
            {
                "sha": "c43a72832877953f32081e53a1bb7fced1351e0c",
                "filename": "tpl/tplimpl/embedded/templates/_default/_markup/render-table.html",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/gohugoio/hugo/blob/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2F_default%2F_markup%2Frender-table.html",
                "raw_url": "https://github.com/gohugoio/hugo/raw/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2F_default%2F_markup%2Frender-table.html",
                "contents_url": "https://api.github.com/repos/gohugoio/hugo/contents/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2F_default%2F_markup%2Frender-table.html?ref=54398f8d572c689f9785d59e907fd910a23401b0",
                "patch": "@@ -1,7 +1,7 @@\n <table\n   {{- range $k, $v := .Attributes }}\n     {{- if $v }}\n-      {{- printf \" %s=%q\" $k $v | safeHTMLAttr }}\n+      {{- printf \" %s=%q\" $k ($v | transform.HTMLEscape) | safeHTMLAttr }}\n     {{- end }}\n   {{- end }}>\n   <thead>"
            },
            {
                "sha": "441469d0ad09a3dedf605eff1a231c948cc07afb",
                "filename": "tpl/tplimpl/embedded/templates/shortcodes/youtube.html",
                "status": "modified",
                "additions": 25,
                "deletions": 32,
                "changes": 57,
                "blob_url": "https://github.com/gohugoio/hugo/blob/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2Fshortcodes%2Fyoutube.html",
                "raw_url": "https://github.com/gohugoio/hugo/raw/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2Fshortcodes%2Fyoutube.html",
                "contents_url": "https://api.github.com/repos/gohugoio/hugo/contents/tpl%2Ftplimpl%2Fembedded%2Ftemplates%2Fshortcodes%2Fyoutube.html?ref=54398f8d572c689f9785d59e907fd910a23401b0",
                "patch": "@@ -26,7 +26,7 @@\n {{- if not $pc.Disable }}\n   {{- with $id := or (.Get \"id\") (.Get 0) }}\n \n-    {{/* Set defaults. */}}\n+    {{- /* Set defaults. */}}\n     {{- $allowFullScreen := \"allowfullscreen\" }}\n     {{- $autoplay := 0 }}\n     {{- $class := \"\" }}\n@@ -70,23 +70,8 @@\n     {{- $start := or ($.Get \"start\") $start }}\n     {{- $title := or ($.Get \"title\") $title }}\n \n-    {{- /* Determine host. */}}\n-    {{- $host := cond $pc.PrivacyEnhanced \"www.youtube-nocookie.com\" \"www.youtube.com\" }}\n-\n-    {{- /* Set styles. */}}\n-    {{- $divStyle := \"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\" }}\n-    {{- $iframeStyle := \"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" }}\n-    {{- if $class }}\n-      {{- $iframeStyle = \"\" }}\n-    {{- end }}\n-\n-    {{- /* Set class or style of wrapping div element. */}}\n-    {{- $divClassOrStyle := printf \"style=%q\" $divStyle }}\n-    {{- with $class }}\n-      {{- $divClassOrStyle = printf \"class=%q\" $class }}\n-    {{- end }}\n-\n     {{- /* Define src attribute. */}}\n+    {{- $host := cond $pc.PrivacyEnhanced \"www.youtube-nocookie.com\" \"www.youtube.com\" }}\n     {{- $src := printf \"https://%s/embed/%s\" $host $id }}\n     {{- $params := dict\n       \"autoplay\" $autoplay\n@@ -108,25 +93,33 @@\n       {{- $src = printf \"%s?%s\" $src . }}\n     {{- end }}\n \n+    {{- /* Set div attributes. */}}\n+    {{- $divStyle := \"position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;\" }}\n+    {{- if $class }}\n+      {{- $divStyle = \"\" }}\n+    {{- end }}\n+\n     {{- /* Set iframe attributes. */}}\n-    {{- $iframeAttributes := dict\n-      \"allow\" \"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\"\n-      \"allowfullscreen\" $allowFullScreen\n-      \"loading\" $loading\n-      \"referrerpolicy\" \"strict-origin-when-cross-origin\"\n-      \"src\" $src\n-      \"style\" $iframeStyle\n-      \"title\" $title\n-    }}\n+    {{- $iframeStyle := \"position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;\" }}\n+    {{- if $class }}\n+      {{- $iframeStyle = \"\" }}\n+    {{- end }}\n+    {{- $allow := \"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" }}\n+    {{- $referrerpolicy := \"strict-origin-when-cross-origin\" }}\n \n     {{- /* Render. */}}\n-    <div {{ $divClassOrStyle | safeHTMLAttr }}>\n+    <div\n+      {{- with $class }} class=\"{{ . }}\" {{- end }}\n+      {{- with $divStyle }} style=\"{{ . | safeCSS }}\" {{- end -}}\n+    >\n       <iframe\n-        {{- range $k, $v := $iframeAttributes }}\n-          {{- if $v }}\n-            {{- printf \" %s=%q\" $k $v | safeHTMLAttr }}\n-          {{- end }}\n-        {{- end }}\n+        {{- with $allow }} allow=\"{{ . }}\" {{- end }}\n+        {{- with $allowFullScreen }} allowfullscreen=\"{{ . }}\" {{- end }}\n+        {{- with $loading }} loading=\"{{ . }}\" {{- end }}\n+        {{- with $referrerpolicy }} referrerpolicy=\"{{ . }}\" {{- end }}\n+        {{- with $src }} src=\"{{ . }}\" {{- end }}\n+        {{- with $iframeStyle}} style=\"{{ . | safeCSS }}\" {{- end }}\n+        {{- with $title }} title=\"{{ . }}\" {{- end -}}\n       ></iframe>\n     </div>\n   {{- else }}"
            },
            {
                "sha": "9f5f670a80fd0ff997984a74a8de33024b9a23ca",
                "filename": "tpl/tplimpl/render_hook_integration_test.go",
                "status": "modified",
                "additions": 23,
                "deletions": 5,
                "changes": 28,
                "blob_url": "https://github.com/gohugoio/hugo/blob/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Frender_hook_integration_test.go",
                "raw_url": "https://github.com/gohugoio/hugo/raw/54398f8d572c689f9785d59e907fd910a23401b0/tpl%2Ftplimpl%2Frender_hook_integration_test.go",
                "contents_url": "https://api.github.com/repos/gohugoio/hugo/contents/tpl%2Ftplimpl%2Frender_hook_integration_test.go?ref=54398f8d572c689f9785d59e907fd910a23401b0",
                "patch": "@@ -91,6 +91,9 @@ title: s1/p3\n [430](p2/)\n [440](/s1/p2/)\n [450](../s1/p2/)\n+\n+// empty\n+[]()\n `\n \n \tb := hugolib.Test(t, files)\n@@ -122,6 +125,8 @@ title: s1/p3\n \t\t`<a href=\"/s1/p2/\">430</a>`,\n \t\t`<a href=\"/s1/p2/\">440</a>`,\n \t\t`<a href=\"/s1/p2/\">450</a>`,\n+\n+\t\t`<a href=\"\"></a>`,\n \t)\n \n \tb.AssertFileContent(\"public/s1/p2/index.html\",\n@@ -148,10 +153,17 @@ block = false\n [markup.goldmark.renderHooks.image]\n enableDefault = true\n -- content/p1/index.md --\n+![]()\n+\n ![alt1](./pixel.png)\n \n-![alt2](pixel.png?a=b&c=d#fragment)\n+![alt2-&<>'](pixel.png \"&<>'\")\n+\n+![alt3](pixel.png?a=b&c=d#fragment)\n {.foo #bar}\n+\n+![alt4](pixel.png)\n+{id=\"\\\"><script>alert()</script>\"}\n -- content/p1/pixel.png --\n iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==\n -- layouts/_default/single.html --\n@@ -160,15 +172,21 @@ iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAA\n \n \tb := hugolib.Test(t, files)\n \tb.AssertFileContent(\"public/p1/index.html\",\n-\t\t`<img alt=\"alt1\" src=\"/dir/p1/pixel.png\">`,\n-\t\t`<img alt=\"alt2\" src=\"/dir/p1/pixel.png?a=b&c=d#fragment\">`,\n+\t\t`<img src=\"\" alt=\"\">`,\n+\t\t`<img src=\"/dir/p1/pixel.png\" alt=\"alt1\">`,\n+\t\t`<img src=\"/dir/p1/pixel.png\" alt=\"alt2-&amp;&lt;&gt;&rsquo;\" title=\"&amp;&lt;&gt;&#39;\">`,\n+\t\t`<img src=\"/dir/p1/pixel.png?a=b&amp;c=d#fragment\" alt=\"alt3\">`,\n+\t\t`<img src=\"/dir/p1/pixel.png\" alt=\"alt4\">`,\n \t)\n \n \tfiles = strings.Replace(files, \"block = false\", \"block = true\", -1)\n \n \tb = hugolib.Test(t, files)\n \tb.AssertFileContent(\"public/p1/index.html\",\n-\t\t`<img alt=\"alt1\" src=\"/dir/p1/pixel.png\">`,\n-\t\t`<img alt=\"alt2\" class=\"foo\" id=\"bar\" src=\"/dir/p1/pixel.png?a=b&c=d#fragment\">`,\n+\t\t`<img src=\"\" alt=\"\">`,\n+\t\t`<img src=\"/dir/p1/pixel.png\" alt=\"alt1\">`,\n+\t\t`<img src=\"/dir/p1/pixel.png\" alt=\"alt2-&amp;&lt;&gt;&rsquo;\" title=\"&amp;&lt;&gt;&#39;\">`,\n+\t\t`<img src=\"/dir/p1/pixel.png?a=b&amp;c=d#fragment\" alt=\"alt3\" class=\"foo\" id=\"bar\">`,\n+\t\t`<img src=\"/dir/p1/pixel.png\" alt=\"alt4\" id=\"&#34;&gt;&lt;script&gt;alert()&lt;/script&gt;\">`,\n \t)\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/directus/directus/commits/ce0397d16cf767b5293cd57f626c5349b5732a21",
        "url": "https://api.github.com/repos/directus/directus/commits/ce0397d16cf767b5293cd57f626c5349b5732a21",
        "html_url": "https://github.com/directus/directus/commit/ce0397d16cf767b5293cd57f626c5349b5732a21",
        "message": "Merge commit from fork (#24108)\n\n* set default accountability for all unauthenticated connections\r\n\r\n* Added changeset",
        "files": [
            {
                "sha": "07ac3c28eb06b05c3a114c92af83da39f9b17e2a",
                "filename": ".changeset/healthy-crews-cover.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/directus/directus/blob/ce0397d16cf767b5293cd57f626c5349b5732a21/.changeset%2Fhealthy-crews-cover.md",
                "raw_url": "https://github.com/directus/directus/raw/ce0397d16cf767b5293cd57f626c5349b5732a21/.changeset%2Fhealthy-crews-cover.md",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/.changeset%2Fhealthy-crews-cover.md?ref=ce0397d16cf767b5293cd57f626c5349b5732a21",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@directus/api': patch\n+---\n+\n+Fixed unauthenticated data access on a public websocket"
            },
            {
                "sha": "fecc2279f5cd56b5428e3a2a32eb6c5ae59c9cf5",
                "filename": "api/src/websocket/controllers/base.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/directus/directus/blob/ce0397d16cf767b5293cd57f626c5349b5732a21/api%2Fsrc%2Fwebsocket%2Fcontrollers%2Fbase.ts",
                "raw_url": "https://github.com/directus/directus/raw/ce0397d16cf767b5293cd57f626c5349b5732a21/api%2Fsrc%2Fwebsocket%2Fcontrollers%2Fbase.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Fwebsocket%2Fcontrollers%2Fbase.ts?ref=ce0397d16cf767b5293cd57f626c5349b5732a21",
                "patch": "@@ -21,6 +21,7 @@ import type { AuthenticationState, UpgradeContext, WebSocketAuthentication, WebS\n import { getExpiresAtForToken } from '../utils/get-expires-at-for-token.js';\n import { getMessageType } from '../utils/message.js';\n import { waitForAnyMessage, waitForMessageType } from '../utils/wait-for-message.js';\n+import { createDefaultAccountability } from '../../permissions/utils/create-default-accountability.js';\n \n const TOKEN_CHECK_INTERVAL = 15 * 60 * 1000; // 15 minutes\n \n@@ -149,7 +150,7 @@ export default abstract class SocketController {\n \n \t\tthis.server.handleUpgrade(request, socket, head, async (ws) => {\n \t\t\tthis.catchInvalidMessages(ws);\n-\t\t\tconst state = { accountability: null, expires_at: null } as AuthenticationState;\n+\t\t\tconst state = { accountability: createDefaultAccountability(), expires_at: null } as AuthenticationState;\n \t\t\tthis.server.emit('connection', ws, state);\n \t\t});\n \t}"
            },
            {
                "sha": "078dc1906ef0433344816edddd858b0684c88221",
                "filename": "api/src/websocket/controllers/graphql.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/directus/directus/blob/ce0397d16cf767b5293cd57f626c5349b5732a21/api%2Fsrc%2Fwebsocket%2Fcontrollers%2Fgraphql.ts",
                "raw_url": "https://github.com/directus/directus/raw/ce0397d16cf767b5293cd57f626c5349b5732a21/api%2Fsrc%2Fwebsocket%2Fcontrollers%2Fgraphql.ts",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/api%2Fsrc%2Fwebsocket%2Fcontrollers%2Fgraphql.ts?ref=ce0397d16cf767b5293cd57f626c5349b5732a21",
                "patch": "@@ -14,6 +14,7 @@ import type { AuthenticationState, GraphQLSocket, UpgradeContext, WebSocketClien\n import { getMessageType } from '../utils/message.js';\n import SocketController from './base.js';\n import { registerWebSocketEvents } from './hooks.js';\n+import { createDefaultAccountability } from '../../permissions/utils/create-default-accountability.js';\n \n const logger = useLogger();\n \n@@ -117,7 +118,7 @@ export class GraphQLSubscriptionController extends SocketController {\n \n \tprotected override async handleHandshakeUpgrade({ request, socket, head }: UpgradeContext) {\n \t\tthis.server.handleUpgrade(request, socket, head, async (ws) => {\n-\t\t\tthis.server.emit('connection', ws, { accountability: null, expires_at: null });\n+\t\t\tthis.server.emit('connection', ws, { accountability: createDefaultAccountability(), expires_at: null });\n \t\t\t// actual enforcement is handled by the setTokenExpireTimer function\n \t\t});\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/wintercms/winter/commits/fb88e6fabde3b3278ce1844e581c87dcf7daee22",
        "url": "https://api.github.com/repos/wintercms/winter/commits/fb88e6fabde3b3278ce1844e581c87dcf7daee22",
        "html_url": "https://github.com/wintercms/winter/commit/fb88e6fabde3b3278ce1844e581c87dcf7daee22",
        "message": "Merge commit from fork\n\n* Harden theme objects, prevent certain properties from being passed through to ThemeData object\n\n* Improve and properly scope Twig security policy\n\n- Deny access to \"include\" and \"extends\" tags/functions, as per Markup docs\n- Block methods that write, delete or modify records and attributes in Database/Eloquent and Halcyon models\n- Block access to theme datasource\n- Prevent extensions from being created or directly interacted with (models and properties provided to extended objects should still be OK)\n\n* Minor\n\n* Make theme magic method calls case insensitive\n\n* Allow include and extends tags/functions\n\n* Add additional blocked methods\n\n* Add test cases",
        "files": [
            {
                "sha": "64d7d76aee0e4d52bdc2c6d53535f3233413a8c2",
                "filename": "modules/cms/classes/Theme.php",
                "status": "modified",
                "additions": 23,
                "deletions": 11,
                "changes": 34,
                "blob_url": "https://github.com/wintercms/winter/blob/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules%2Fcms%2Fclasses%2FTheme.php",
                "raw_url": "https://github.com/wintercms/winter/raw/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules%2Fcms%2Fclasses%2FTheme.php",
                "contents_url": "https://api.github.com/repos/wintercms/winter/contents/modules%2Fcms%2Fclasses%2FTheme.php?ref=fb88e6fabde3b3278ce1844e581c87dcf7daee22",
                "patch": "@@ -1,22 +1,25 @@\n-<?php namespace Cms\\Classes;\n+<?php\n+\n+namespace Cms\\Classes;\n \n-use App;\n-use ApplicationException;\n-use Cache;\n use Cms\\Models\\ThemeData;\n-use Config;\n use DirectoryIterator;\n-use Event;\n use Exception;\n-use File;\n-use Lang;\n+use Illuminate\\Support\\Facades\\App;\n+use Illuminate\\Support\\Facades\\Cache;\n+use Illuminate\\Support\\Facades\\Lang;\n use System\\Models\\Parameter;\n-use SystemException;\n-use Url;\n+use Winter\\Storm\\Exception\\ApplicationException;\n+use Winter\\Storm\\Exception\\SystemException;\n use Winter\\Storm\\Halcyon\\Datasource\\DatasourceInterface;\n use Winter\\Storm\\Halcyon\\Datasource\\DbDatasource;\n use Winter\\Storm\\Halcyon\\Datasource\\FileDatasource;\n-use Yaml;\n+use Winter\\Storm\\Support\\Facades\\Config;\n+use Winter\\Storm\\Support\\Facades\\Event;\n+use Winter\\Storm\\Support\\Facades\\File;\n+use Winter\\Storm\\Support\\Facades\\Url;\n+use Winter\\Storm\\Support\\Facades\\Yaml;\n+use Winter\\Storm\\Support\\Str;\n \n /**\n  * This class represents the CMS theme.\n@@ -682,6 +685,11 @@ public function getDatasource(): DatasourceInterface\n      */\n     public function __get($name)\n     {\n+        if (in_array(strtolower($name), ['id', 'path', 'dirname', 'config', 'formconfig', 'previewimageurl'])) {\n+            $method = 'get'. ucfirst($name);\n+            return $this->$method();\n+        }\n+\n         if ($this->hasCustomData()) {\n             return $this->getCustomData()->{$name};\n         }\n@@ -694,6 +702,10 @@ public function __get($name)\n      */\n     public function __isset($key)\n     {\n+        if (in_array(strtolower($key), ['id', 'path', 'dirname', 'config', 'formconfig', 'previewimageurl'])) {\n+            return true;\n+        }\n+\n         if ($this->hasCustomData()) {\n             $theme = $this->getCustomData();\n             return $theme->offsetExists($key);"
            },
            {
                "sha": "03015851ff04370eacdd128d52aa7f06ae3951f6",
                "filename": "modules/cms/models/ThemeData.php",
                "status": "modified",
                "additions": 6,
                "deletions": 4,
                "changes": 10,
                "blob_url": "https://github.com/wintercms/winter/blob/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules%2Fcms%2Fmodels%2FThemeData.php",
                "raw_url": "https://github.com/wintercms/winter/raw/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules%2Fcms%2Fmodels%2FThemeData.php",
                "contents_url": "https://api.github.com/repos/wintercms/winter/contents/modules%2Fcms%2Fmodels%2FThemeData.php?ref=fb88e6fabde3b3278ce1844e581c87dcf7daee22",
                "patch": "@@ -1,11 +1,13 @@\n-<?php namespace Cms\\Models;\n+<?php\n+\n+namespace Cms\\Models;\n \n-use Lang;\n-use Model;\n use Cms\\Classes\\Theme as CmsTheme;\n-use System\\Classes\\CombineAssets;\n use Exception;\n+use Illuminate\\Support\\Facades\\Lang;\n+use System\\Classes\\CombineAssets;\n use System\\Models\\File;\n+use Winter\\Storm\\Database\\Model;\n \n /**\n  * Customization data used by a theme"
            },
            {
                "sha": "7fcd8018d969ae2a48f19f51fe9c478779ca5059",
                "filename": "modules/system/tests/twig/SecurityPolicyTest.php",
                "status": "added",
                "additions": 269,
                "deletions": 0,
                "changes": 269,
                "blob_url": "https://github.com/wintercms/winter/blob/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules%2Fsystem%2Ftests%2Ftwig%2FSecurityPolicyTest.php",
                "raw_url": "https://github.com/wintercms/winter/raw/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules%2Fsystem%2Ftests%2Ftwig%2FSecurityPolicyTest.php",
                "contents_url": "https://api.github.com/repos/wintercms/winter/contents/modules%2Fsystem%2Ftests%2Ftwig%2FSecurityPolicyTest.php?ref=fb88e6fabde3b3278ce1844e581c87dcf7daee22",
                "patch": "@@ -0,0 +1,269 @@\n+<?php\n+\n+namespace System\\Tests\\Twig;\n+\n+use Cms\\Classes\\Controller;\n+use Cms\\Classes\\Page;\n+use Cms\\Classes\\Theme;\n+use System\\Tests\\Bootstrap\\TestCase;\n+use Twig\\Environment;\n+use Winter\\Storm\\Filesystem\\Filesystem;\n+use Winter\\Storm\\Halcyon\\Datasource\\FileDatasource;\n+\n+class SecurityPolicyTest extends TestCase\n+{\n+    protected Environment $twig;\n+\n+    public function testCannotGetTwigInstanceFromCmsController()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set twig = this.controller.getTwig() %}\n+            {{ this.controller.getTwig() }}\n+        ');\n+    }\n+\n+    public function testCannotGetTwigLoaderFromCmsController()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set loader = this.controller.getLoader() %}\n+            {{ loader.load(\\'/\\') }}\n+        ');\n+    }\n+\n+    public function testCannotRunAPageObjectFromWithinTwig()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {{ this.controller.runPage() }}\n+        ');\n+    }\n+\n+    public function testCannotExtendAPageWithADynamicMethod()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set page = this.page.addDynamicMethod(\"test\") %}\n+        ');\n+    }\n+\n+    public function testCannotExtendAPageWithADynamicProperty()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set page = this.page.addDynamicProperty(\"test\", \"value\") %}\n+        ');\n+    }\n+\n+    public function testCannotWriteToAModel()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set modelTest = model.setAttribute(\"test\", \"value\") %}\n+        ', [\n+            'model' => new \\Winter\\Storm\\Database\\Model(),\n+        ]);\n+    }\n+\n+    public function testCanReadFromAModel()\n+    {\n+        $model = new \\Winter\\Storm\\Database\\Model();\n+        $model->test = 'value';\n+\n+        $result = trim($this->renderTwigInCmsController('\n+            {% set modelTest = model.getAttribute(\"test\") %}\n+            {{- modelTest -}}\n+        ', [\n+            'model' => $model,\n+        ]));\n+        $this->assertEquals('value', $result);\n+    }\n+\n+    public function testCannotFillAModel()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        try {\n+            $model = new \\Winter\\Storm\\Database\\Model();\n+            $model->addFillable('test');\n+            $model->test = 'value';\n+\n+            $this->renderTwigInCmsController('\n+                {% set modelTest = model.fill({ test: \\'value2\\' }) %}\n+            ', [\n+                'model' => new \\Winter\\Storm\\Database\\Model(),\n+            ]);\n+        } catch (\\Twig\\Sandbox\\SecurityNotAllowedMethodError $e) {\n+            // Ensure value hasn't changed\n+            $this->assertEquals('value', $model->test);\n+            throw $e;\n+        }\n+    }\n+\n+    public function testCannotSaveAModel()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set modelTest = model.save() %}\n+        ', [\n+            'model' => new \\Winter\\Storm\\Database\\Model(),\n+        ]);\n+    }\n+\n+    public function testCannotPushAModel()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set modelTest = model.push() %}\n+        ', [\n+            'model' => new \\Winter\\Storm\\Database\\Model(),\n+        ]);\n+    }\n+\n+    public function testCannotUpdateAModel()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $model = new \\Winter\\Storm\\Database\\Model();\n+        $model->addFillable('test');\n+        $model->test = 'value';\n+\n+        $this->renderTwigInCmsController('\n+            {% set modelTest = model.update({ test: \\'value2\\' }) %}\n+        ', [\n+            'model' => $model,\n+        ]);\n+    }\n+\n+    public function testCannotDeleteAModel()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set modelTest = model.delete() %}\n+        ', [\n+            'model' => new \\Winter\\Storm\\Database\\Model(),\n+        ]);\n+    }\n+\n+    public function testCannotForceDeleteAModel()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set modelTest = model.forceDelete() %}\n+        ', [\n+            'model' => new \\Winter\\Storm\\Database\\Model(),\n+        ]);\n+    }\n+\n+    public function testCannotExtendAModelWithABehaviour()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set model = model.extendClassWith(\"Winter\\Storm\\Database\\Behaviors\\Encryptable\") %}\n+        ', [\n+            'model' => new \\Winter\\Storm\\Database\\Model(),\n+        ]);\n+    }\n+\n+    public function testExtendingModelBeforePassingIntoTwigShouldStillWork()\n+    {\n+        $model = new \\Winter\\Storm\\Database\\Model();\n+        $model->addDynamicMethod('foo', function () {\n+            return 'foo';\n+        });\n+\n+        $result = trim($this->renderTwigInCmsController('\n+            {{- model.foo() -}}\n+        ', [\n+            'model' => $model,\n+        ]));\n+        $this->assertEquals('foo', $result);\n+    }\n+\n+    public function testCannotGetDatasourceFromTheme()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set datasource = this.theme.getDatasource() %}\n+        ');\n+    }\n+\n+    // Even if someone decides to be clever and make the datasource available, you shouldn't be able to insert/delete/update\n+    public function testCannotDeleteInDatasource()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set datasource = datasource.delete() %}\n+        ', [\n+            'datasource' => new FileDatasource(\n+                base_path('modules/system/tests/fixtures/themes/test'),\n+                new Filesystem()\n+            ),\n+        ]);\n+    }\n+\n+    public function testCannotInsertInDatasource()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set datasource = datasource.insert() %}\n+        ', [\n+            'datasource' => new FileDatasource(\n+                base_path('modules/system/tests/fixtures/themes/test'),\n+                new Filesystem()\n+            ),\n+        ]);\n+    }\n+\n+    public function testCannotUpdateInDatasource()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set datasource = datasource.update() %}\n+        ', [\n+            'datasource' => new FileDatasource(\n+                base_path('modules/system/tests/fixtures/themes/test'),\n+                new Filesystem()\n+            ),\n+        ]);\n+    }\n+\n+    public function testCannotChangeThemeDirectory()\n+    {\n+        $this->expectException(\\Twig\\Sandbox\\SecurityNotAllowedMethodError::class);\n+\n+        $this->renderTwigInCmsController('\n+            {% set theme = this.theme.setDirName(\"test\") %}\n+        ');\n+    }\n+\n+    protected function renderTwigInCmsController(string $source, array $vars = [])\n+    {\n+        $controller = new Controller();\n+        $twig = $controller->getTwig();\n+        $template = $twig->createTemplate($source, 'test.case');\n+        return $twig->render($template, [\n+            'this' => [\n+                'controller' => $controller,\n+                'page' => new Page(),\n+                'theme' => new Theme()\n+            ],\n+        ] + $vars);\n+    }\n+}"
            },
            {
                "sha": "6aab78e74a4262e56f86f69d9569b407e084b57a",
                "filename": "modules/system/twig/SecurityPolicy.php",
                "status": "modified",
                "additions": 113,
                "deletions": 23,
                "changes": 136,
                "blob_url": "https://github.com/wintercms/winter/blob/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules%2Fsystem%2Ftwig%2FSecurityPolicy.php",
                "raw_url": "https://github.com/wintercms/winter/raw/fb88e6fabde3b3278ce1844e581c87dcf7daee22/modules%2Fsystem%2Ftwig%2FSecurityPolicy.php",
                "contents_url": "https://api.github.com/repos/wintercms/winter/contents/modules%2Fsystem%2Ftwig%2FSecurityPolicy.php?ref=fb88e6fabde3b3278ce1844e581c87dcf7daee22",
                "patch": "@@ -1,48 +1,115 @@\n-<?php namespace System\\Twig;\n+<?php\n \n+namespace System\\Twig;\n+\n+use Cms\\Classes\\Controller;\n+use Cms\\Classes\\Theme;\n+use Illuminate\\Database\\Eloquent\\Model as DbModel;\n+use Winter\\Storm\\Halcyon\\Model as HalcyonModel;\n use Twig\\Markup;\n+use Twig\\Sandbox\\SecurityNotAllowedFunctionError;\n use Twig\\Template;\n use Twig\\Sandbox\\SecurityPolicyInterface;\n use Twig\\Sandbox\\SecurityNotAllowedMethodError;\n use Twig\\Sandbox\\SecurityNotAllowedPropertyError;\n+use Twig\\Sandbox\\SecurityNotAllowedTagError;\n+use Winter\\Storm\\Halcyon\\Datasource\\DatasourceInterface;\n \n /**\n  * SecurityPolicy globally blocks accessibility of certain methods and properties.\n  *\n  * @package winter\\wn-system-module\n- * @author Alexey Bobkov, Samuel Georges, Luke Towers\n+ * @author Alexey Bobkov, Samuel Georges, Luke Towers, Ben Thomson\n  */\n final class SecurityPolicy implements SecurityPolicyInterface\n {\n     /**\n-     * @var array List of forbidden methods.\n+     * @var array<string, string[]> List of forbidden methods, grouped by applicable instance.\n      */\n     protected $blockedMethods = [\n-        // Prevent accessing Twig itself\n-        'getTwig',\n-\n-        // \\Winter\\Storm\\Extension\\ExtendableTrait\n-        'addDynamicMethod',\n-        'addDynamicProperty',\n-\n-        // \\Winter\\Storm\\Support\\Traits\\Emitter\n-        'bindEvent',\n-        'bindEventOnce',\n-\n-        // Eloquent & Halcyon data modification\n-        'insert',\n-        'update',\n-        'delete',\n-        'write',\n+        '*' => [\n+            // Prevent accessing Twig itself\n+            'getTwig',\n+\n+            // Prevent extensions of any objects\n+            'addDynamicMethod',\n+            'addDynamicProperty',\n+            'extendClassWith',\n+            'getClassExtension',\n+            'extendableSet',\n+\n+            // Prevent binding to events\n+            'bindEvent',\n+            'bindEventOnce',\n+        ],\n+\n+        // Prevent some controller methods\n+        Controller::class => [\n+            'runPage',\n+            'renderPage',\n+            'getLoader',\n+        ],\n+\n+        // Prevent model data modification\n+        DbModel::class => [\n+            'fill',\n+            'setAttribute',\n+            'setRawAttributes',\n+            'save',\n+            'push',\n+            'update',\n+            'delete',\n+            'forceDelete',\n+        ],\n+        HalcyonModel::class => [\n+            'fill',\n+            'setAttribute',\n+            'setRawAttributes',\n+            'setSettingsAttribute',\n+            'setFileNameAttribute',\n+            'save',\n+            'push',\n+            'update',\n+            'delete',\n+            'forceDelete',\n+        ],\n+        DatasourceInterface::class => [\n+            'insert',\n+            'update',\n+            'delete',\n+            'forceDelete',\n+            'write',\n+            'usingSource',\n+            'pushToSource',\n+            'removeFromSource',\n+        ],\n+        Theme::class => [\n+            'setDirName',\n+            'registerHalcyonDatasource',\n+            'getDatasource'\n+        ],\n+    ];\n+\n+    /**\n+     * @var array<string, string[]> List of forbidden properties, grouped by applicable instance.\n+     */\n+    protected $blockedProperties = [\n+        Theme::class => [\n+            'datasource',\n+        ],\n     ];\n \n     /**\n      * Constructor\n      */\n     public function __construct()\n     {\n-        foreach ($this->blockedMethods as $i => $m) {\n-            $this->blockedMethods[$i] = strtolower($m);\n+        foreach ($this->blockedMethods as $type => $methods) {\n+            $this->blockedMethods[$type] = array_map('strtolower', $methods);\n+        }\n+\n+        foreach ($this->blockedProperties as $type => $properties) {\n+            $this->blockedProperties[$type] = array_map('strtolower', $properties);\n         }\n     }\n \n@@ -69,6 +136,19 @@ public function checkSecurity($tags, $filters, $functions): void\n      */\n     public function checkPropertyAllowed($obj, $property): void\n     {\n+        // No need to check Twig internal objects\n+        if ($obj instanceof Template || $obj instanceof Markup) {\n+            return;\n+        }\n+\n+        $property = strtolower($property);\n+\n+        foreach ($this->blockedProperties as $type => $properties) {\n+            if ($obj instanceof $type && in_array($property, $properties)) {\n+                $class = get_class($obj);\n+                throw new SecurityNotAllowedPropertyError(sprintf('Getting \"%s\" property in a \"%s\" object is blocked.', $property, $class), $class, $property);\n+            }\n+        }\n     }\n \n     /**\n@@ -85,10 +165,20 @@ public function checkMethodAllowed($obj, $method): void\n             return;\n         }\n \n-        $blockedMethod = strtolower($method);\n-        if (in_array($blockedMethod, $this->blockedMethods)) {\n+        $method = strtolower($method);\n+\n+        if (\n+            in_array($method, $this->blockedMethods['*'])\n+        ) {\n             $class = get_class($obj);\n             throw new SecurityNotAllowedMethodError(sprintf('Calling \"%s\" method on a \"%s\" object is blocked.', $method, $class), $class, $method);\n         }\n+\n+        foreach ($this->blockedMethods as $type => $methods) {\n+            if ($obj instanceof $type && in_array($method, $methods)) {\n+                $class = get_class($obj);\n+                throw new SecurityNotAllowedMethodError(sprintf('Calling \"%s\" method on a \"%s\" object is blocked.', $method, $class), $class, $method);\n+            }\n+        }\n     }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/commits/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
        "url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/commits/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
        "html_url": "https://github.com/wildfly-security/wildfly-elytron/commit/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
        "message": "[ELY-2887] Add a nonce to OIDC requests for CVE-2024-12369",
        "files": [
            {
                "sha": "b7f944a08bee94735df6e6db8217052da12d1ca6",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/AuthenticationError.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FAuthenticationError.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FAuthenticationError.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FAuthenticationError.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -36,7 +36,8 @@ public enum Reason {\n         INVALID_TOKEN,\n         STALE_TOKEN,\n         NO_AUTHORIZATION_HEADER,\n-        NO_QUERY_PARAMETER_ACCESS_TOKEN\n+        NO_QUERY_PARAMETER_ACCESS_TOKEN,\n+        INVALID_NONCE\n     }\n \n     private Reason reason;"
            },
            {
                "sha": "0173786cec42ff5e2af632a902b78b9720216354",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/ElytronMessages.java",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FElytronMessages.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FElytronMessages.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FElytronMessages.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -238,5 +238,13 @@ interface ElytronMessages extends BasicLogger {\n     @Message(id = 23057, value = \"principal-attribute '%s' claim does not exist, falling back to 'sub'\")\n     void principalAttributeClaimDoesNotExist(String principalAttributeClaim);\n \n+    @Message(id = 23071, value = \"Invalid ID token nonce: %s\")\n+    String invalidNonceValue(String name);\n+\n+    @Message(id = 23072, value = \"No such algorithm: '%s'\")\n+    IllegalArgumentException noSuchAlgorithm(String algorithm);\n+\n+    @Message(id = 23073, value = \"Nonce cookie does not exist\")\n+    String nonceCookieDoesNotExist();\n }\n "
            },
            {
                "sha": "25242a704bccb5470fcc5be173d3160a58f82c42",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/IDToken.java",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FIDToken.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FIDToken.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FIDToken.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -51,6 +51,7 @@ public class IDToken extends JsonWebToken {\n     public static final String CLAIMS_LOCALES = \"claims_locales\";\n     public static final String ACR = \"acr\";\n     public static final String S_HASH = \"s_hash\";\n+    public static final String NONCE = \"nonce\";\n \n     /**\n      * Construct a new instance.\n@@ -220,4 +221,7 @@ public String getAcr() {\n         return getClaimValueAsString(ACR);\n     }\n \n+    public String getNonce() {\n+        return getClaimValueAsString(NONCE);\n+    }\n }"
            },
            {
                "sha": "1fa6fc36963e8033a76977c78637787bb957b9d1",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/Oidc.java",
                "status": "modified",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidc.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidc.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidc.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -19,11 +19,15 @@\n package org.wildfly.security.http.oidc;\n \n import static org.wildfly.security.http.oidc.ElytronMessages.log;\n+import static org.wildfly.security.jose.jwk.JWKUtil.BASE64_URL;\n \n import java.io.IOException;\n import java.io.InputStream;\n import java.net.InetAddress;\n import java.net.UnknownHostException;\n+import java.nio.charset.StandardCharsets;\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n import java.util.Map;\n import java.util.StringTokenizer;\n import java.util.UUID;\n@@ -34,6 +38,7 @@\n import org.apache.http.HttpResponse;\n import org.apache.http.client.methods.HttpRequestBase;\n import org.jose4j.jws.AlgorithmIdentifiers;\n+import org.wildfly.common.iteration.ByteIterator;\n import org.wildfly.security.jose.util.JsonSerialization;\n \n /**\n@@ -81,13 +86,15 @@ public class Oidc {\n     public static final String REDIRECT_URI = \"redirect_uri\";\n     public static final String REFRESH_TOKEN = \"refresh_token\";\n     public static final String RESPONSE_TYPE = \"response_type\";\n+    public static final String SESSION_RANDOM_VALUE=\"session_random_value\";\n     public static final String SESSION_STATE = \"session_state\";\n     public static final String SOAP_ACTION = \"SOAPAction\";\n     public static final String STALE_TOKEN = \"Stale token\";\n     public static final String STATE = \"state\";\n     public static final int INVALID_ISSUED_FOR_CLAIM = -1;\n     public static final int INVALID_AT_HASH_CLAIM = -2;\n     public static final int INVALID_TYPE_CLAIM = -3;\n+    public static final int INVALID_SESSION_RANDOM_VALUE = -4;\n     static final String OIDC_CLIENT_CONFIG_RESOLVER = \"oidc.config.resolver\";\n     static final String OIDC_CONFIG_FILE_LOCATION = \"oidc.config.file\";\n     static final String OIDC_JSON_FILE = \"/WEB-INF/oidc.json\";\n@@ -368,4 +375,14 @@ protected static boolean checkCachedAccountMatchesRequest(OidcAccount account, O\n         return true;\n     }\n \n+    protected static String getCryptographicValue(final String src) {\n+        try {\n+            MessageDigest md = MessageDigest.getInstance(SHA256);\n+            md.update(src.getBytes(StandardCharsets.UTF_8));\n+            return ByteIterator.ofBytes(md.digest())\n+                    .base64Encode(BASE64_URL, false).drainToString();\n+        } catch (NoSuchAlgorithmException e) {\n+            throw log.noSuchAlgorithm(e.getMessage());\n+        }\n+    }\n }"
            },
            {
                "sha": "f19898c2c8a5538b05d9d18c6078cbd5bebf42c2",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/OidcCookieTokenStore.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcCookieTokenStore.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcCookieTokenStore.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcCookieTokenStore.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -21,6 +21,7 @@\n import static org.wildfly.security.http.oidc.ElytronMessages.log;\n import static org.wildfly.security.http.oidc.Oidc.OIDC_STATE_COOKIE;\n import static org.wildfly.security.http.oidc.Oidc.checkCachedAccountMatchesRequest;\n+import static org.wildfly.security.http.oidc.Oidc.SESSION_RANDOM_VALUE;\n \n import java.net.URISyntaxException;\n import java.util.List;\n@@ -227,7 +228,7 @@ public static OidcPrincipal<RefreshableOidcSecurityContext> getPrincipalFromCook\n                 idToken = new IDToken(new JwtConsumerBuilder().setSkipSignatureVerification().setSkipAllValidators().build().processToClaims(idTokenString));\n             }\n             log.debug(\"Token obtained from cookie\");\n-            RefreshableOidcSecurityContext secContext = new RefreshableOidcSecurityContext(deployment, tokenStore, accessTokenString, accessToken, idTokenString, idToken, refreshTokenString);\n+            RefreshableOidcSecurityContext secContext = new RefreshableOidcSecurityContext(deployment, facade.getRequest().getCookie(SESSION_RANDOM_VALUE), tokenStore, accessTokenString, accessToken, idTokenString, idToken, refreshTokenString);\n             return new OidcPrincipal<>(idToken.getPrincipalName(deployment), secContext);\n         } catch (InvalidJwtException e) {\n             log.failedToParseTokenFromCookie(e);"
            },
            {
                "sha": "a0dd76c97f91a3c4619e02293cddffa53cacbe17",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/OidcRequestAuthenticator.java",
                "status": "modified",
                "additions": 20,
                "deletions": 5,
                "changes": 25,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcRequestAuthenticator.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcRequestAuthenticator.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcRequestAuthenticator.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -19,6 +19,7 @@\n package org.wildfly.security.http.oidc;\n \n import static org.wildfly.security.http.oidc.ElytronMessages.log;\n+import static org.wildfly.security.http.oidc.IDToken.NONCE;\n import static org.wildfly.security.http.oidc.Oidc.ALLOW_QUERY_PARAMS_PROPERTY_NAME;\n import static org.wildfly.security.http.oidc.Oidc.CLIENT_ID;\n import static org.wildfly.security.http.oidc.Oidc.CODE;\n@@ -33,6 +34,7 @@\n import static org.wildfly.security.http.oidc.Oidc.REDIRECT_URI;\n import static org.wildfly.security.http.oidc.Oidc.RESPONSE_TYPE;\n import static org.wildfly.security.http.oidc.Oidc.SCOPE;\n+import static org.wildfly.security.http.oidc.Oidc.SESSION_RANDOM_VALUE;\n import static org.wildfly.security.http.oidc.Oidc.SESSION_STATE;\n import static org.wildfly.security.http.oidc.Oidc.STATE;\n import static org.wildfly.security.http.oidc.Oidc.UI_LOCALES;\n@@ -47,6 +49,7 @@\n import java.net.URL;\n import java.security.AccessController;\n import java.security.PrivilegedAction;\n+import java.security.SecureRandom;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n@@ -56,6 +59,7 @@\n import org.apache.http.NameValuePair;\n import org.apache.http.client.utils.URIBuilder;\n import org.apache.http.message.BasicNameValuePair;\n+import org.wildfly.common.iteration.ByteIterator;\n import org.wildfly.security.http.HttpConstants;\n \n /**\n@@ -75,7 +79,7 @@ public class OidcRequestAuthenticator {\n     protected AuthChallenge challenge;\n     protected String refreshToken;\n     protected String strippedOauthParametersRequestUri;\n-\n+    private int NONCE_SIZE = 36;\n     static final boolean ALLOW_QUERY_PARAMS_PROPERTY;\n \n     static {\n@@ -161,7 +165,7 @@ protected String getCode() {\n         return getQueryParamValue(facade, CODE);\n     }\n \n-    protected String getRedirectUri(String state) {\n+    protected String getRedirectUri(String state, String sessionRandomValueHash) {\n         String url = getRequestUrl();\n         log.debugf(\"callback uri: %s\", url);\n \n@@ -199,7 +203,8 @@ protected String getRedirectUri(String state) {\n                     .addParameter(RESPONSE_TYPE, CODE)\n                     .addParameter(CLIENT_ID, deployment.getResourceName())\n                     .addParameter(REDIRECT_URI, rewrittenRedirectUri(url))\n-                    .addParameter(STATE, state);\n+                    .addParameter(STATE, state)\n+                    .addParameter(NONCE, sessionRandomValueHash);\n             redirectUriBuilder.addParameters(forwardedQueryParams);\n             return redirectUriBuilder.build().toString();\n         } catch (URISyntaxException e) {\n@@ -217,7 +222,8 @@ protected String getStateCode() {\n \n     protected AuthChallenge loginRedirect() {\n         final String state = getStateCode();\n-        final String redirect = getRedirectUri(state);\n+        final String sessionRandomValue = generateSessionRandomValue();\n+        final String redirect = getRedirectUri(state, Oidc.getCryptographicValue(sessionRandomValue));\n         if (redirect == null) {\n             return challenge(HttpStatus.SC_FORBIDDEN, AuthenticationError.Reason.NO_REDIRECT_URI, null);\n         }\n@@ -235,6 +241,7 @@ public boolean challenge(OidcHttpFacade exchange) {\n                 exchange.getResponse().setStatus(HttpStatus.SC_MOVED_TEMPORARILY);\n                 exchange.getResponse().setCookie(deployment.getStateCookieName(), state, \"/\", null, -1, deployment.getSSLRequired().isRequired(facade.getRequest().getRemoteAddr()), true);\n                 exchange.getResponse().setHeader(HttpConstants.LOCATION, redirect);\n+                exchange.getResponse().setCookie(SESSION_RANDOM_VALUE, sessionRandomValue, \"/\", null, -1, deployment.getSSLRequired().isRequired(facade.getRequest().getRemoteAddr()), true);\n                 return true;\n             }\n         };\n@@ -362,7 +369,8 @@ protected AuthChallenge resolveCode(String code) {\n \n         try {\n             TokenValidator tokenValidator = TokenValidator.builder(deployment).build();\n-            TokenValidator.VerifiedTokens verifiedTokens = tokenValidator.parseAndVerifyToken(idTokenString, tokenString);\n+            TokenValidator.VerifiedTokens verifiedTokens = tokenValidator.parseAndVerifyToken(idTokenString, tokenString,\n+                                        facade.getRequest().getCookie(SESSION_RANDOM_VALUE));\n             idToken = verifiedTokens.getIdToken();\n             token = verifiedTokens.getAccessToken();\n             log.debug(\"Token Verification succeeded!\");\n@@ -435,4 +443,11 @@ private static boolean hasScope(String scopeParam, String targetScope) {\n         }\n         return false;\n     }\n+\n+    private String generateSessionRandomValue() {\n+        SecureRandom random = new SecureRandom();\n+        byte[] nonceData = new byte[NONCE_SIZE];\n+        random.nextBytes(nonceData);\n+        return ByteIterator.ofBytes(nonceData).base64Encode().drainToString();\n+    }\n }"
            },
            {
                "sha": "8ee58e4540cf6b5137158e710b3323396c251334",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/RefreshableOidcSecurityContext.java",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRefreshableOidcSecurityContext.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRefreshableOidcSecurityContext.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRefreshableOidcSecurityContext.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -34,16 +34,18 @@ public class RefreshableOidcSecurityContext extends OidcSecurityContext {\n     protected transient OidcClientConfiguration clientConfiguration;\n     protected transient OidcTokenStore tokenStore;\n     protected String refreshToken;\n+    protected transient OidcHttpFacade.Cookie cookie;\n \n     public RefreshableOidcSecurityContext() {\n     }\n \n-    public RefreshableOidcSecurityContext(OidcClientConfiguration clientConfiguration, OidcTokenStore tokenStore, String tokenString,\n+    public RefreshableOidcSecurityContext(OidcClientConfiguration clientConfiguration, OidcHttpFacade.Cookie cookie, OidcTokenStore tokenStore, String tokenString,\n                                           AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {\n         super(tokenString, token, idTokenString, idToken);\n         this.clientConfiguration = clientConfiguration;\n         this.tokenStore = tokenStore;\n         this.refreshToken = refreshToken;\n+        this.cookie = cookie;\n     }\n \n     @Override\n@@ -149,7 +151,7 @@ public boolean refreshToken(boolean checkActive) {\n             IDToken idToken;\n             try {\n                 TokenValidator tokenValidator = TokenValidator.builder(clientConfiguration).build();\n-                TokenValidator.VerifiedTokens verifiedTokens = tokenValidator.parseAndVerifyToken(idTokenString, accessTokenString);\n+                TokenValidator.VerifiedTokens verifiedTokens = tokenValidator.parseAndVerifyToken(idTokenString, accessTokenString, cookie);\n                 idToken = verifiedTokens.getIdToken();\n                 accessToken = verifiedTokens.getAccessToken();\n                 log.debug(\"Token Verification succeeded!\");"
            },
            {
                "sha": "423cf11fa32db5ced89bb1f2a0346f8be61cd651",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/RequestAuthenticator.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRequestAuthenticator.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRequestAuthenticator.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRequestAuthenticator.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -24,6 +24,7 @@\n import static org.wildfly.security.http.oidc.Oidc.FACES_REQUEST;\n import static org.wildfly.security.http.oidc.Oidc.HTML_CONTENT_TYPE;\n import static org.wildfly.security.http.oidc.Oidc.PARTIAL;\n+import static org.wildfly.security.http.oidc.Oidc.SESSION_RANDOM_VALUE;\n import static org.wildfly.security.http.oidc.Oidc.SOAP_ACTION;\n import static org.wildfly.security.http.oidc.Oidc.TEXT_CONTENT_TYPE;\n import static org.wildfly.security.http.oidc.Oidc.WILDCARD_CONTENT_TYPE;\n@@ -202,14 +203,14 @@ protected boolean verifySSL() {\n     }\n \n     protected void completeAuthentication(OidcRequestAuthenticator oidc) {\n-        RefreshableOidcSecurityContext session = new RefreshableOidcSecurityContext(deployment, facade.getTokenStore(), oidc.getTokenString(), oidc.getToken(), oidc.getIDTokenString(), oidc.getIDToken(), oidc.getRefreshToken());\n+        RefreshableOidcSecurityContext session = new RefreshableOidcSecurityContext(deployment, facade.getRequest().getCookie(SESSION_RANDOM_VALUE), facade.getTokenStore(), oidc.getTokenString(), oidc.getToken(), oidc.getIDTokenString(), oidc.getIDToken(), oidc.getRefreshToken());\n         final OidcPrincipal<RefreshableOidcSecurityContext> principal = new OidcPrincipal<>(oidc.getIDToken().getPrincipalName(deployment), session);\n         completeOidcAuthentication(principal);\n         log.debugv(\"User ''{0}'' invoking ''{1}'' on client ''{2}''\", principal.getName(), facade.getRequest().getURI(), deployment.getResourceName());\n     }\n \n     protected void completeAuthentication(BearerTokenRequestAuthenticator bearer) {\n-        RefreshableOidcSecurityContext session = new RefreshableOidcSecurityContext(deployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);\n+        RefreshableOidcSecurityContext session = new RefreshableOidcSecurityContext(deployment, facade.getRequest().getCookie(SESSION_RANDOM_VALUE), null, bearer.getTokenString(), bearer.getToken(), null, null, null);\n         final OidcPrincipal<RefreshableOidcSecurityContext> principal = new OidcPrincipal<>(bearer.getToken().getPrincipalName(deployment), session);\n         completeBearerAuthentication(principal);\n         log.debugv(\"User ''{0}'' invoking ''{1}'' on client ''{2}''\", principal.getName(), facade.getRequest().getURI(), deployment.getResourceName());"
            },
            {
                "sha": "c78c4f663501da9b1c6c853ab8606b1639bfcbde",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/TokenValidator.java",
                "status": "modified",
                "additions": 30,
                "deletions": 1,
                "changes": 31,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FTokenValidator.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FTokenValidator.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FTokenValidator.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -24,6 +24,7 @@\n import static org.wildfly.security.http.oidc.Oidc.INVALID_AT_HASH_CLAIM;\n import static org.wildfly.security.http.oidc.Oidc.INVALID_ISSUED_FOR_CLAIM;\n import static org.wildfly.security.http.oidc.Oidc.INVALID_TYPE_CLAIM;\n+import static org.wildfly.security.http.oidc.Oidc.INVALID_SESSION_RANDOM_VALUE;\n import static org.wildfly.security.http.oidc.Oidc.getJavaAlgorithmForHash;\n import static org.wildfly.security.jose.jwk.JWKUtil.BASE64_URL;\n \n@@ -82,12 +83,14 @@ private TokenValidator(Builder builder) {\n      * @return the {@code VerifiedTokens} if the ID token was valid\n      * @throws OidcException if the ID token is invalid\n      */\n-    public VerifiedTokens parseAndVerifyToken(final String idToken, final String accessToken) throws OidcException {\n+    public VerifiedTokens parseAndVerifyToken(final String idToken, final String accessToken, OidcHttpFacade.Cookie cookie) throws OidcException {\n         try {\n             JwtContext idJwtContext = setVerificationKey(idToken, jwtConsumerBuilder);\n             jwtConsumerBuilder.setExpectedAudience(clientConfiguration.getResourceName());\n             jwtConsumerBuilder.registerValidator(new AzpValidator(clientConfiguration.getResourceName()));\n             jwtConsumerBuilder.registerValidator(new AtHashValidator(accessToken, clientConfiguration.getTokenSignatureAlgorithm()));\n+            jwtConsumerBuilder.registerValidator(new NonceValidator(cookie));\n+\n             // second pass to validate\n             jwtConsumerBuilder.build().processContext(idJwtContext);\n             JwtClaims idJwtClaims = idJwtContext.getJwtClaims();\n@@ -276,6 +279,32 @@ public ErrorCodeValidator.Error validate(JwtContext jwtContext) throws Malformed\n         }\n     }\n \n+    private static class NonceValidator implements ErrorCodeValidator {\n+        private OidcHttpFacade.Cookie cookie;\n+\n+        public NonceValidator(OidcHttpFacade.Cookie cookie) {\n+            this.cookie = cookie;\n+        }\n+\n+        public ErrorCodeValidator.Error validate(JwtContext jwtContext) throws MalformedClaimException {\n+            JwtClaims idJwtClaims = jwtContext.getJwtClaims();\n+            IDToken idToken = new IDToken(idJwtClaims);\n+\n+            if (cookie != null) {\n+                String sessionRandomValue = Oidc.getCryptographicValue(cookie.getValue());\n+                String nonceValue = idToken.getNonce();\n+                if (!sessionRandomValue.equals(nonceValue)) {\n+                    return new ErrorCodeValidator.Error(INVALID_SESSION_RANDOM_VALUE,\n+                            log.invalidNonceValue(nonceValue));\n+                }\n+            } else {\n+                return new ErrorCodeValidator.Error(INVALID_SESSION_RANDOM_VALUE,\n+                        log.nonceCookieDoesNotExist());\n+            }\n+            return null;\n+        }\n+    }\n+\n     private static class TypeValidator implements ErrorCodeValidator {\n         public static final String TYPE = \"typ\";\n         private final String expectedType;"
            },
            {
                "sha": "f1b19e70a4aee48948481e3bce88f0f1ffc0191a",
                "filename": "http/oidc/src/test/java/org/wildfly/security/http/oidc/OidcBaseTest.java",
                "status": "modified",
                "additions": 62,
                "deletions": 6,
                "changes": 68,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcBaseTest.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcBaseTest.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcBaseTest.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -22,6 +22,7 @@\n import static org.junit.Assert.assertNotNull;\n import static org.junit.Assert.assertTrue;\n import static org.wildfly.security.http.oidc.Oidc.OIDC_NAME;\n+import static org.wildfly.security.http.oidc.Oidc.SESSION_RANDOM_VALUE;\n \n import java.io.ByteArrayInputStream;\n import java.io.IOException;\n@@ -185,6 +186,32 @@ public MockResponse dispatch(RecordedRequest recordedRequest) throws Interrupted\n         };\n     }\n \n+    protected static Dispatcher createAppResponse(HttpServerAuthenticationMechanism mechanism,\n+                                                  int expectedStatusCode, String expectedLocation,\n+                                                  String clientPageText, List<HttpServerCookie> cookies) {\n+        return new Dispatcher() {\n+            @Override\n+            public MockResponse dispatch(RecordedRequest recordedRequest) throws InterruptedException {\n+                String path = recordedRequest.getPath();\n+                if (path.contains(\"/\" + CLIENT_APP) && path.contains(\"&code=\")) {\n+                    try {\n+                        TestingHttpServerRequest request = new TestingHttpServerRequest(new String[0],\n+                                new URI(recordedRequest.getRequestUrl().toString()), cookies);\n+                        mechanism.evaluateRequest(request);\n+                        TestingHttpServerResponse response = request.getResponse();\n+                        assertEquals(expectedStatusCode, response.getStatusCode());\n+                        assertEquals(expectedLocation, response.getLocation());\n+                        return new MockResponse().setBody(clientPageText);\n+                    } catch (Exception e) {\n+                        throw new RuntimeException(e);\n+                    }\n+                }\n+                return new MockResponse()\n+                        .setBody(\"\");\n+            }\n+        };\n+    }\n+\n     protected static Dispatcher createAppResponse(HttpServerAuthenticationMechanism mechanism, int expectedStatusCode, String expectedLocation, String clientPageText,\n                                                   Map<String, Object> sessionScopeAttachments) {\n         return new Dispatcher() {\n@@ -305,27 +332,43 @@ protected String getCookieString(HttpServerCookie cookie) {\n         return header.toString();\n     }\n \n+    protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n+                                         int expectedDispatcherStatusCode, String expectedLocation, String clientPageText,\n+                                         boolean changeSessionId) throws Exception {\n+        performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, getClientUrl(),\n+                expectedLocation, clientPageText, changeSessionId);\n+    }\n+\n     protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n                                          int expectedDispatcherStatusCode, String expectedLocation, String clientPageText) throws Exception {\n-        performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, getClientUrl(), expectedLocation, clientPageText);\n+        performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, getClientUrl(), expectedLocation, clientPageText, false);\n     }\n \n     protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n                                          int expectedDispatcherStatusCode, String expectedLocation, String clientPageText,\n                                          CallbackHandler callbackHandler) throws Exception {\n         performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, getClientUrl(), expectedLocation, clientPageText,\n-                callbackHandler);\n+                callbackHandler, false);\n+    }\n+\n+    protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n+                                         int expectedDispatcherStatusCode, String clientUrl, String expectedLocation,\n+                                         String clientPageText) throws Exception {\n+        performAuthentication(oidcConfig, username, password, loginToKeycloak,\n+                expectedDispatcherStatusCode, clientUrl, expectedLocation,\n+                clientPageText, false);\n     }\n \n     protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n-                                         int expectedDispatcherStatusCode, String clientUrl, String expectedLocation, String clientPageText) throws Exception {\n+                                         int expectedDispatcherStatusCode, String clientUrl, String expectedLocation,\n+                                         String clientPageText, boolean changeSessionId) throws Exception {\n         performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, clientUrl, expectedLocation, clientPageText,\n-                getCallbackHandler());\n+                getCallbackHandler(), changeSessionId);\n     }\n \n     protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n                                          int expectedDispatcherStatusCode, String clientUrl, String expectedLocation, String clientPageText,\n-                                         CallbackHandler callbackHandler) throws Exception {\n+                                         CallbackHandler callbackHandler, boolean changeSessionId) throws Exception {\n         try {\n             Map<String, Object> props = new HashMap<>();\n             OidcClientConfiguration oidcClientConfiguration = OidcClientConfigurationBuilder.build(oidcConfig);\n@@ -343,7 +386,20 @@ protected void performAuthentication(InputStream oidcConfig, String username, St\n             assertEquals(Status.NO_AUTH, request.getResult());\n \n             if (loginToKeycloak) {\n-                client.setDispatcher(createAppResponse(mechanism, expectedDispatcherStatusCode, expectedLocation, clientPageText));\n+                // change the sessionRandomValue value so that the compare to nonce will fail.\n+                List<HttpServerCookie> tmpCookies = response.getCookies();\n+                if (changeSessionId) {\n+                    for (HttpServerCookie c : tmpCookies) {\n+                        if (c.getName().equals(SESSION_RANDOM_VALUE)) {\n+                            HttpServerCookie tmpCookie = HttpServerCookie.getInstance(c.getName(),\n+                                    \"9999\" + c.getValue(), c.getDomain(), c.getMaxAge(), c.getPath(),\n+                                    c.isSecure(), c.getVersion(), c.isHttpOnly());\n+                            tmpCookies.remove(c);\n+                            tmpCookies.add(tmpCookie);\n+                        }\n+                    }\n+                }\n+                client.setDispatcher(createAppResponse(mechanism, expectedDispatcherStatusCode, expectedLocation, clientPageText, tmpCookies));\n                 TextPage page = loginToKeycloak(username, password, requestUri, response.getLocation(),\n                         response.getCookies()).click();\n                 assertTrue(page.getContent().contains(clientPageText));"
            },
            {
                "sha": "859cd1ad3b070be31595c4a8cc38363ecfc8c7c6",
                "filename": "http/oidc/src/test/java/org/wildfly/security/http/oidc/OidcSecurityRealmTest.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcSecurityRealmTest.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcSecurityRealmTest.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcSecurityRealmTest.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -72,7 +72,7 @@ public void testGetRealmIdentityWithNonOidcPrincipal() throws RealmUnavailableEx\n     @Test\n     public void testGetRealmIdentityNoRoles() throws RealmUnavailableException {\n         // setup\n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(new OidcClientConfiguration(),\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(new OidcClientConfiguration(), null,\n                 null, null, new AccessToken(new JwtClaims()), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -108,7 +108,7 @@ public void testGetRealmIdentityRolesCombined() throws RealmUnavailableException\n         jwtClaims.setClaim(\"resource_access\", resourceAccess);\n         jwtClaims.setClaim(\"realm_access\", createRoles(\"roleC\", \"roleD\"));\n \n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -137,7 +137,7 @@ public void testGetRealmIdentityOnlyRealmRoles() throws RealmUnavailableExceptio\n         jwtClaims.setClaim(\"resource_access\", resourceAccess);\n         jwtClaims.setClaim(\"realm_access\", createRoles(\"roleC\", \"roleD\"));\n \n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -165,7 +165,7 @@ public void testGetRealmIdentityOnlyResourceRoles() throws RealmUnavailableExcep\n         jwtClaims.setClaim(\"resource_access\", resourceAccess);\n         jwtClaims.setClaim(\"\", new RealmAccessClaim(createRoles(\"roleC\", \"roleD\")));\n \n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -193,7 +193,7 @@ public void testGetRealmIdentityNoMappings() throws RealmUnavailableException {\n         jwtClaims.setClaim(\"resource_access\", resourceAccess);\n         jwtClaims.setClaim(\"\", new RealmAccessClaim(createRoles(\"roleC\", \"roleD\")));\n \n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -390,7 +390,7 @@ private static String getRealmAndResourceRolesClaims(boolean includeRealmAndReso\n     }\n \n     private Attributes.Entry getRealmIdentityRoles(OidcClientConfiguration clientConfiguration, JwtClaims jwtClaims) throws RealmUnavailableException {\n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n "
            },
            {
                "sha": "21e6832f1e3659f9ed0f4293a1535e83100e6149",
                "filename": "http/oidc/src/test/java/org/wildfly/security/http/oidc/OidcTest.java",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcTest.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcTest.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcTest.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -206,6 +206,13 @@ KeycloakConfiguration.ALICE_PASSWORD, true, HttpStatus.SC_MOVED_TEMPORARILY, get\n                 getCallbackHandler());\n     }\n \n+    @Test\n+    public void testStandardConfigWithNonceMismatch() throws Exception {\n+        performAuthentication(getOidcConfigurationInputStreamWithProviderUrl(),\n+                KeycloakConfiguration.ALICE, KeycloakConfiguration.ALICE_PASSWORD, true,\n+                HttpStatus.SC_FORBIDDEN, null, CLIENT_PAGE_TEXT, true);\n+    }\n+\n     /*****************************************************************************************************************************************\n      * Tests for multi-tenancy.\n      *"
            },
            {
                "sha": "cef580ca4bc1885143e336c85b9f665e06d9fe3d",
                "filename": "tests/base/src/test/java/org/wildfly/security/http/impl/AbstractBaseHttpTest.java",
                "status": "modified",
                "additions": 10,
                "deletions": 42,
                "changes": 52,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/tests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Fimpl%2FAbstractBaseHttpTest.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb/tests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Fimpl%2FAbstractBaseHttpTest.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/tests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Fimpl%2FAbstractBaseHttpTest.java?ref=d7754f5a6a91ceb0f4dbbbfe301991f6a55404cb",
                "patch": "@@ -191,49 +191,17 @@ public TestingHttpServerRequest(String[] authorization, URI requestURI, String c\n             this.requestURI = requestURI;\n             this.cookies = new ArrayList<>();\n             if (cookie != null) {\n-                final String cookieName = cookie.substring(0, cookie.indexOf('='));\n-                final String cookieValue = cookie.substring(cookie.indexOf('=') + 1);\n-                cookies.add(new HttpServerCookie() {\n-                    @Override\n-                    public String getName() {\n-                        return cookieName;\n-                    }\n-\n-                    @Override\n-                    public String getValue() {\n-                        return cookieValue;\n-                    }\n-\n-                    @Override\n-                    public String getDomain() {\n-                        return null;\n-                    }\n-\n-                    @Override\n-                    public int getMaxAge() {\n-                        return -1;\n-                    }\n-\n-                    @Override\n-                    public String getPath() {\n-                        return \"/\";\n-                    }\n-\n-                    @Override\n-                    public boolean isSecure() {\n-                        return false;\n-                    }\n-\n-                    @Override\n-                    public int getVersion() {\n-                        return 0;\n-                    }\n-\n-                    @Override\n-                    public boolean isHttpOnly() {\n-                        return true;\n+                String[] cookiesArr = cookie.split(\";\");\n+                if (cookiesArr.length == 0) {\n+                    cookiesArr[0] = cookie;\n+                }\n+                for (int i = 0; i < cookiesArr.length; i++) {\n+                    String[] cookiePair = cookiesArr[i].trim().split(\"=\");\n+                    if (cookiePair.length == 2) {\n+                        this.cookies.add(HttpServerCookie.getInstance(\n+                                cookiePair[0], cookiePair[1], null, -1, \"/\", false, 0, true));\n                     }\n-                });\n+                }\n             }\n         }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/commits/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
        "url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/commits/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
        "html_url": "https://github.com/wildfly-security/wildfly-elytron/commit/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
        "message": "[ELY-2887] Add a nonce to OIDC requests for CVE-2024-12369",
        "files": [
            {
                "sha": "b7f944a08bee94735df6e6db8217052da12d1ca6",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/AuthenticationError.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FAuthenticationError.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FAuthenticationError.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FAuthenticationError.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -36,7 +36,8 @@ public enum Reason {\n         INVALID_TOKEN,\n         STALE_TOKEN,\n         NO_AUTHORIZATION_HEADER,\n-        NO_QUERY_PARAMETER_ACCESS_TOKEN\n+        NO_QUERY_PARAMETER_ACCESS_TOKEN,\n+        INVALID_NONCE\n     }\n \n     private Reason reason;"
            },
            {
                "sha": "1b2a5289b11cf3252a08bd83375b540055b35a77",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/ElytronMessages.java",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FElytronMessages.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FElytronMessages.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FElytronMessages.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -278,5 +278,14 @@ interface ElytronMessages extends BasicLogger {\n \n     @Message(id = 23070, value = \"Authentication request format must be one of the following: oauth2, request, request_uri.\")\n     RuntimeException invalidAuthenticationRequestFormat();\n+\n+    @Message(id = 23071, value = \"Invalid ID token nonce: %s\")\n+    String invalidNonceValue(String name);\n+\n+    @Message(id = 23072, value = \"No such algorithm: '%s'\")\n+    IllegalArgumentException noSuchAlgorithm(String algorithm);\n+\n+    @Message(id = 23073, value = \"Nonce cookie does not exist\")\n+    String nonceCookieDoesNotExist();\n }\n "
            },
            {
                "sha": "e54dc40eac4c429529dca7e7a75fa4fa2343bb98",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/IDToken.java",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FIDToken.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FIDToken.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FIDToken.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -53,6 +53,7 @@ public class IDToken extends JsonWebToken {\n     public static final String CLAIMS_LOCALES = \"claims_locales\";\n     public static final String ACR = \"acr\";\n     public static final String S_HASH = \"s_hash\";\n+    public static final String NONCE = \"nonce\";\n \n     /**\n      * Construct a new instance.\n@@ -228,4 +229,7 @@ public String getAcr() {\n         return getClaimValueAsString(ACR);\n     }\n \n+    public String getNonce() {\n+        return getClaimValueAsString(NONCE);\n+    }\n }"
            },
            {
                "sha": "9694b31a658a55bb19209c0993347294679bd21d",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/Oidc.java",
                "status": "modified",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidc.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidc.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidc.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -19,11 +19,15 @@\n package org.wildfly.security.http.oidc;\n \n import static org.wildfly.security.http.oidc.ElytronMessages.log;\n+import static org.wildfly.security.jose.jwk.JWKUtil.BASE64_URL;\n \n import java.io.IOException;\n import java.io.InputStream;\n import java.net.InetAddress;\n import java.net.UnknownHostException;\n+import java.nio.charset.StandardCharsets;\n+import java.security.MessageDigest;\n+import java.security.NoSuchAlgorithmException;\n import java.util.Map;\n import java.util.StringTokenizer;\n import java.util.UUID;\n@@ -34,6 +38,7 @@\n import org.apache.http.HttpResponse;\n import org.apache.http.client.methods.HttpRequestBase;\n import org.jose4j.jws.AlgorithmIdentifiers;\n+import org.wildfly.common.iteration.ByteIterator;\n import org.wildfly.security.jose.util.JsonSerialization;\n \n /**\n@@ -111,6 +116,7 @@ public class Oidc {\n     public static final String REDIRECT_URI = \"redirect_uri\";\n     public static final String REFRESH_TOKEN = \"refresh_token\";\n     public static final String RESPONSE_TYPE = \"response_type\";\n+    public static final String SESSION_RANDOM_VALUE=\"session_random_value\";\n     public static final String SESSION_STATE = \"session_state\";\n     public static final String SOAP_ACTION = \"SOAPAction\";\n     public static final String SSL_REQUIRED = \"ssl-required\";\n@@ -119,6 +125,7 @@ public class Oidc {\n     public static final int INVALID_ISSUED_FOR_CLAIM = -1;\n     public static final int INVALID_AT_HASH_CLAIM = -2;\n     public static final int INVALID_TYPE_CLAIM = -3;\n+    public static final int INVALID_SESSION_RANDOM_VALUE = -4;\n     static final String OIDC_CLIENT_CONFIG_RESOLVER = \"oidc.config.resolver\";\n     static final String OIDC_CONFIG_FILE_LOCATION = \"oidc.config.file\";\n     static final String OIDC_JSON_FILE = \"/WEB-INF/oidc.json\";\n@@ -445,4 +452,14 @@ protected static boolean checkCachedAccountMatchesRequest(OidcAccount account, O\n         return true;\n     }\n \n+    protected static String getCryptographicValue(final String src) {\n+        try {\n+            MessageDigest md = MessageDigest.getInstance(SHA256);\n+            md.update(src.getBytes(StandardCharsets.UTF_8));\n+            return ByteIterator.ofBytes(md.digest())\n+                    .base64Encode(BASE64_URL, false).drainToString();\n+        } catch (NoSuchAlgorithmException e) {\n+            throw log.noSuchAlgorithm(e.getMessage());\n+        }\n+    }\n }"
            },
            {
                "sha": "f19898c2c8a5538b05d9d18c6078cbd5bebf42c2",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/OidcCookieTokenStore.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcCookieTokenStore.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcCookieTokenStore.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcCookieTokenStore.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -21,6 +21,7 @@\n import static org.wildfly.security.http.oidc.ElytronMessages.log;\n import static org.wildfly.security.http.oidc.Oidc.OIDC_STATE_COOKIE;\n import static org.wildfly.security.http.oidc.Oidc.checkCachedAccountMatchesRequest;\n+import static org.wildfly.security.http.oidc.Oidc.SESSION_RANDOM_VALUE;\n \n import java.net.URISyntaxException;\n import java.util.List;\n@@ -227,7 +228,7 @@ public static OidcPrincipal<RefreshableOidcSecurityContext> getPrincipalFromCook\n                 idToken = new IDToken(new JwtConsumerBuilder().setSkipSignatureVerification().setSkipAllValidators().build().processToClaims(idTokenString));\n             }\n             log.debug(\"Token obtained from cookie\");\n-            RefreshableOidcSecurityContext secContext = new RefreshableOidcSecurityContext(deployment, tokenStore, accessTokenString, accessToken, idTokenString, idToken, refreshTokenString);\n+            RefreshableOidcSecurityContext secContext = new RefreshableOidcSecurityContext(deployment, facade.getRequest().getCookie(SESSION_RANDOM_VALUE), tokenStore, accessTokenString, accessToken, idTokenString, idToken, refreshTokenString);\n             return new OidcPrincipal<>(idToken.getPrincipalName(deployment), secContext);\n         } catch (InvalidJwtException e) {\n             log.failedToParseTokenFromCookie(e);"
            },
            {
                "sha": "78cc0ebc062bc81b57e1d49b853d66c0008b04ef",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/OidcRequestAuthenticator.java",
                "status": "modified",
                "additions": 37,
                "deletions": 13,
                "changes": 50,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcRequestAuthenticator.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcRequestAuthenticator.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcRequestAuthenticator.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -23,6 +23,7 @@\n import static org.jose4j.jws.AlgorithmIdentifiers.HMAC_SHA512;\n import static org.jose4j.jws.AlgorithmIdentifiers.NONE;\n import static org.wildfly.security.http.oidc.ElytronMessages.log;\n+import static org.wildfly.security.http.oidc.IDToken.NONCE;\n import static org.wildfly.security.http.oidc.Oidc.ALLOW_QUERY_PARAMS_PROPERTY_NAME;\n import static org.wildfly.security.http.oidc.Oidc.CLIENT_ID;\n import static org.wildfly.security.http.oidc.Oidc.CODE;\n@@ -39,6 +40,7 @@\n import static org.wildfly.security.http.oidc.Oidc.REQUEST;\n import static org.wildfly.security.http.oidc.Oidc.REQUEST_URI;\n import static org.wildfly.security.http.oidc.Oidc.SCOPE;\n+import static org.wildfly.security.http.oidc.Oidc.SESSION_RANDOM_VALUE;\n import static org.wildfly.security.http.oidc.Oidc.SESSION_STATE;\n import static org.wildfly.security.http.oidc.Oidc.STATE;\n import static org.wildfly.security.http.oidc.Oidc.UI_LOCALES;\n@@ -59,6 +61,7 @@\n import java.security.Key;\n import java.security.KeyPair;\n import java.security.PublicKey;\n+import java.security.SecureRandom;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.HashSet;\n@@ -76,6 +79,7 @@\n import org.jose4j.jwt.JwtClaims;\n import org.jose4j.keys.HmacKey;\n import org.jose4j.lang.JoseException;\n+import org.wildfly.common.iteration.ByteIterator;\n import org.wildfly.security.http.HttpConstants;\n \n /**\n@@ -96,6 +100,8 @@ public class OidcRequestAuthenticator {\n     protected String refreshToken;\n     protected String strippedOauthParametersRequestUri;\n \n+    private int NONCE_SIZE = 36;\n+\n     static final boolean ALLOW_QUERY_PARAMS_PROPERTY;\n \n     static {\n@@ -181,7 +187,7 @@ protected String getCode() {\n         return getQueryParamValue(facade, CODE);\n     }\n \n-    protected String getRedirectUri(String state) {\n+    protected String getRedirectUri(String state, String sessionRandomValueHash) {\n         String url = getRequestUrl();\n         log.debugf(\"callback uri: %s\", url);\n \n@@ -229,31 +235,31 @@ protected String getRedirectUri(String state) {\n                     if (deployment.getRequestParameterSupported()) {\n                         // add request objects into request parameter\n                         try {\n-                            createRequestWithRequestParameter(REQUEST, redirectUriBuilder, redirectUri, state, forwardedQueryParams);\n+                            createRequestWithRequestParameter(REQUEST, redirectUriBuilder, redirectUri, state, forwardedQueryParams, sessionRandomValueHash);\n                         } catch (IOException | JoseException e) {\n                             throw log.unableToCreateRequestWithRequestParameter(e);\n                         }\n                     } else {\n                         // send request as usual\n-                        createOAuthRequest(redirectUriBuilder, redirectUri, state, forwardedQueryParams);\n+                        createOAuthRequest(redirectUriBuilder, redirectUri, state, forwardedQueryParams, sessionRandomValueHash);\n                         log.requestParameterNotSupported();\n                     }\n                     break;\n                 case REQUEST_URI:\n                     if (deployment.getRequestUriParameterSupported()) {\n                         try {\n-                            createRequestWithRequestParameter(REQUEST_URI, redirectUriBuilder, redirectUri, state, forwardedQueryParams);\n+                            createRequestWithRequestParameter(REQUEST_URI, redirectUriBuilder, redirectUri, state, forwardedQueryParams, sessionRandomValueHash);\n                         } catch (IOException | JoseException e) {\n                             throw log.unableToCreateRequestUriWithRequestParameter(e);\n                         }\n                     } else {\n                         // send request as usual\n-                        createOAuthRequest(redirectUriBuilder, redirectUri, state, forwardedQueryParams);\n+                        createOAuthRequest(redirectUriBuilder, redirectUri, state, forwardedQueryParams, sessionRandomValueHash);\n                         log.requestParameterNotSupported();\n                     }\n                     break;\n                 default:\n-                    createOAuthRequest(redirectUriBuilder, redirectUri, state, forwardedQueryParams);\n+                    createOAuthRequest(redirectUriBuilder, redirectUri, state, forwardedQueryParams, sessionRandomValueHash);\n                     break;\n             }\n             return redirectUriBuilder.build().toString();\n@@ -262,15 +268,16 @@ protected String getRedirectUri(String state) {\n         }\n     }\n \n-    protected URIBuilder createOAuthRequest(URIBuilder redirectUriBuilder, String redirectUri, String state, List<NameValuePair> forwardedQueryParams) {\n+    protected URIBuilder createOAuthRequest(URIBuilder redirectUriBuilder, String redirectUri, String state, List<NameValuePair> forwardedQueryParams, String sessionRandomValueHash) {\n         redirectUriBuilder.addParameter(REDIRECT_URI, redirectUri)\n                 .addParameter(STATE, state)\n-                .addParameters(forwardedQueryParams);\n+                .addParameters(forwardedQueryParams)\n+                .addParameter(NONCE, sessionRandomValueHash);\n         return redirectUriBuilder;\n     }\n \n-    protected URIBuilder createRequestWithRequestParameter(String requestFormat, URIBuilder redirectUriBuilder, String redirectUri, String state, List<NameValuePair> forwardedQueryParams) throws JoseException, IOException {\n-        String request = convertToRequestParameter(redirectUriBuilder, redirectUri, state, forwardedQueryParams);\n+    protected URIBuilder createRequestWithRequestParameter(String requestFormat, URIBuilder redirectUriBuilder, String redirectUri, String state, List<NameValuePair> forwardedQueryParams, String sessionRandomValueHash) throws JoseException, IOException {\n+        String request = convertToRequestParameter(redirectUriBuilder, redirectUri, state, forwardedQueryParams, sessionRandomValueHash);\n \n         switch (requestFormat) {\n             case REQUEST:\n@@ -296,7 +303,8 @@ protected String getStateCode() {\n \n     protected AuthChallenge loginRedirect() {\n         final String state = getStateCode();\n-        final String redirect = getRedirectUri(state);\n+        final String sessionRandomValue = generateSessionRandomValue();\n+        final String redirect = getRedirectUri(state, Oidc.getCryptographicValue(sessionRandomValue));\n         if (redirect == null) {\n             return challenge(HttpStatus.SC_FORBIDDEN, AuthenticationError.Reason.NO_REDIRECT_URI, null);\n         }\n@@ -314,6 +322,8 @@ public boolean challenge(OidcHttpFacade exchange) {\n                 exchange.getResponse().setStatus(HttpStatus.SC_MOVED_TEMPORARILY);\n                 exchange.getResponse().setCookie(deployment.getStateCookieName(), state, \"/\", null, -1, deployment.getSSLRequired().isRequired(facade.getRequest().getRemoteAddr()), true);\n                 exchange.getResponse().setHeader(HttpConstants.LOCATION, redirect);\n+                exchange.getResponse().setCookie(SESSION_RANDOM_VALUE, sessionRandomValue, \"/\", null, -1, deployment.getSSLRequired().isRequired(facade.getRequest().getRemoteAddr()), true);\n+\n                 return true;\n             }\n         };\n@@ -336,6 +346,7 @@ protected AuthChallenge checkStateCookie() {\n             log.warn(\"state parameter was null\");\n             return challenge(HttpStatus.SC_BAD_REQUEST, AuthenticationError.Reason.INVALID_STATE_COOKIE, null);\n         }\n+\n         if (!state.equals(stateCookieValue)) {\n             log.warn(\"state parameter invalid\");\n             log.warn(\"cookie: \" + stateCookieValue);\n@@ -441,9 +452,12 @@ protected AuthChallenge resolveCode(String code) {\n \n         try {\n             TokenValidator tokenValidator = TokenValidator.builder(deployment).build();\n-            TokenValidator.VerifiedTokens verifiedTokens = tokenValidator.parseAndVerifyToken(idTokenString, tokenString);\n+\n+            TokenValidator.VerifiedTokens verifiedTokens = tokenValidator.parseAndVerifyToken(idTokenString, tokenString,\n+                    facade.getRequest().getCookie(SESSION_RANDOM_VALUE));\n             idToken = verifiedTokens.getIdToken();\n             token = verifiedTokens.getAccessToken();\n+\n             log.debug(\"Token Verification succeeded!\");\n         } catch (OidcException e) {\n             log.failedVerificationOfToken(e.getMessage());\n@@ -456,6 +470,7 @@ protected AuthChallenge resolveCode(String code) {\n             log.error(\"Stale token\");\n             return challenge(HttpStatus.SC_FORBIDDEN, AuthenticationError.Reason.STALE_TOKEN, null);\n         }\n+\n         log.debug(\"successfully authenticated\");\n         return null;\n     }\n@@ -535,7 +550,7 @@ private void addScopes(String scopes, Set<String> allScopes) {\n         }\n     }\n \n-    private String convertToRequestParameter(URIBuilder redirectUriBuilder, String redirectUri, String state, List<NameValuePair> forwardedQueryParams) throws JoseException, IOException {\n+    private String convertToRequestParameter(URIBuilder redirectUriBuilder, String redirectUri, String state, List<NameValuePair> forwardedQueryParams, String sessionRandomValueHash) throws JoseException, IOException {\n         redirectUriBuilder.addParameter(SCOPE, OIDC_SCOPE);\n \n         JwtClaims jwtClaims = new JwtClaims();\n@@ -545,10 +560,12 @@ private String convertToRequestParameter(URIBuilder redirectUriBuilder, String r\n         for ( NameValuePair parameter: forwardedQueryParams) {\n             jwtClaims.setClaim(parameter.getName(), parameter.getValue());\n         }\n+\n         jwtClaims.setClaim(STATE, state);\n         jwtClaims.setClaim(REDIRECT_URI, redirectUri);\n         jwtClaims.setClaim(RESPONSE_TYPE, CODE);\n         jwtClaims.setClaim(CLIENT_ID, deployment.getResourceName());\n+        jwtClaims.setClaim(NONCE, sessionRandomValueHash);\n \n         // sign JWT first before encrypting\n         JsonWebSignature signedRequest = signRequest(jwtClaims, deployment);\n@@ -622,4 +639,11 @@ private JsonWebEncryption encryptRequest(JsonWebSignature signedRequest) throws\n             return jsonEncryption;\n         }\n     }\n+\n+    private String generateSessionRandomValue() {\n+        SecureRandom random = new SecureRandom();\n+        byte[] nonceData = new byte[NONCE_SIZE];\n+        random.nextBytes(nonceData);\n+        return ByteIterator.ofBytes(nonceData).base64Encode().drainToString();\n+    }\n }"
            },
            {
                "sha": "8ee58e4540cf6b5137158e710b3323396c251334",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/RefreshableOidcSecurityContext.java",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRefreshableOidcSecurityContext.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRefreshableOidcSecurityContext.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRefreshableOidcSecurityContext.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -34,16 +34,18 @@ public class RefreshableOidcSecurityContext extends OidcSecurityContext {\n     protected transient OidcClientConfiguration clientConfiguration;\n     protected transient OidcTokenStore tokenStore;\n     protected String refreshToken;\n+    protected transient OidcHttpFacade.Cookie cookie;\n \n     public RefreshableOidcSecurityContext() {\n     }\n \n-    public RefreshableOidcSecurityContext(OidcClientConfiguration clientConfiguration, OidcTokenStore tokenStore, String tokenString,\n+    public RefreshableOidcSecurityContext(OidcClientConfiguration clientConfiguration, OidcHttpFacade.Cookie cookie, OidcTokenStore tokenStore, String tokenString,\n                                           AccessToken token, String idTokenString, IDToken idToken, String refreshToken) {\n         super(tokenString, token, idTokenString, idToken);\n         this.clientConfiguration = clientConfiguration;\n         this.tokenStore = tokenStore;\n         this.refreshToken = refreshToken;\n+        this.cookie = cookie;\n     }\n \n     @Override\n@@ -149,7 +151,7 @@ public boolean refreshToken(boolean checkActive) {\n             IDToken idToken;\n             try {\n                 TokenValidator tokenValidator = TokenValidator.builder(clientConfiguration).build();\n-                TokenValidator.VerifiedTokens verifiedTokens = tokenValidator.parseAndVerifyToken(idTokenString, accessTokenString);\n+                TokenValidator.VerifiedTokens verifiedTokens = tokenValidator.parseAndVerifyToken(idTokenString, accessTokenString, cookie);\n                 idToken = verifiedTokens.getIdToken();\n                 accessToken = verifiedTokens.getAccessToken();\n                 log.debug(\"Token Verification succeeded!\");"
            },
            {
                "sha": "c2b25b120d7576574230d50b5209491a3f4aa72e",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/RequestAuthenticator.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRequestAuthenticator.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRequestAuthenticator.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FRequestAuthenticator.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -24,6 +24,7 @@\n import static org.wildfly.security.http.oidc.Oidc.FACES_REQUEST;\n import static org.wildfly.security.http.oidc.Oidc.HTML_CONTENT_TYPE;\n import static org.wildfly.security.http.oidc.Oidc.PARTIAL;\n+import static org.wildfly.security.http.oidc.Oidc.SESSION_RANDOM_VALUE;\n import static org.wildfly.security.http.oidc.Oidc.SOAP_ACTION;\n import static org.wildfly.security.http.oidc.Oidc.TEXT_CONTENT_TYPE;\n import static org.wildfly.security.http.oidc.Oidc.WILDCARD_CONTENT_TYPE;\n@@ -200,14 +201,14 @@ protected boolean verifySSL() {\n     }\n \n     protected void completeAuthentication(OidcRequestAuthenticator oidc) {\n-        RefreshableOidcSecurityContext session = new RefreshableOidcSecurityContext(deployment, facade.getTokenStore(), oidc.getTokenString(), oidc.getToken(), oidc.getIDTokenString(), oidc.getIDToken(), oidc.getRefreshToken());\n+        RefreshableOidcSecurityContext session = new RefreshableOidcSecurityContext(deployment, facade.getRequest().getCookie(SESSION_RANDOM_VALUE), facade.getTokenStore(), oidc.getTokenString(), oidc.getToken(), oidc.getIDTokenString(), oidc.getIDToken(), oidc.getRefreshToken());\n         final OidcPrincipal<RefreshableOidcSecurityContext> principal = new OidcPrincipal<>(oidc.getIDToken().getPrincipalName(deployment), session);\n         completeOidcAuthentication(principal);\n         log.debugv(\"User ''{0}'' invoking ''{1}'' on client ''{2}''\", principal.getName(), facade.getRequest().getURI(), deployment.getResourceName());\n     }\n \n     protected void completeAuthentication(BearerTokenRequestAuthenticator bearer) {\n-        RefreshableOidcSecurityContext session = new RefreshableOidcSecurityContext(deployment, null, bearer.getTokenString(), bearer.getToken(), null, null, null);\n+        RefreshableOidcSecurityContext session = new RefreshableOidcSecurityContext(deployment, facade.getRequest().getCookie(SESSION_RANDOM_VALUE), null, bearer.getTokenString(), bearer.getToken(), null, null, null);\n         final OidcPrincipal<RefreshableOidcSecurityContext> principal = new OidcPrincipal<>(bearer.getToken().getPrincipalName(deployment), session);\n         completeBearerAuthentication(principal);\n         log.debugv(\"User ''{0}'' invoking ''{1}'' on client ''{2}''\", principal.getName(), facade.getRequest().getURI(), deployment.getResourceName());"
            },
            {
                "sha": "8edf35177a33a8d39224027ccba671d55187fc03",
                "filename": "http/oidc/src/main/java/org/wildfly/security/http/oidc/TokenValidator.java",
                "status": "modified",
                "additions": 31,
                "deletions": 1,
                "changes": 32,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FTokenValidator.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FTokenValidator.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Fmain%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FTokenValidator.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -23,6 +23,7 @@\n import static org.wildfly.security.http.oidc.Oidc.DISABLE_TYP_CLAIM_VALIDATION_PROPERTY_NAME;\n import static org.wildfly.security.http.oidc.Oidc.INVALID_AT_HASH_CLAIM;\n import static org.wildfly.security.http.oidc.Oidc.INVALID_ISSUED_FOR_CLAIM;\n+import static org.wildfly.security.http.oidc.Oidc.INVALID_SESSION_RANDOM_VALUE;\n import static org.wildfly.security.http.oidc.Oidc.INVALID_TYPE_CLAIM;\n import static org.wildfly.security.http.oidc.Oidc.getJavaAlgorithmForHash;\n import static org.wildfly.security.jose.jwk.JWKUtil.BASE64_URL;\n@@ -82,12 +83,14 @@ private TokenValidator(Builder builder) {\n      * @return the {@code VerifiedTokens} if the ID token was valid\n      * @throws OidcException if the ID token is invalid\n      */\n-    public VerifiedTokens parseAndVerifyToken(final String idToken, final String accessToken) throws OidcException {\n+    public VerifiedTokens parseAndVerifyToken(final String idToken, final String accessToken, OidcHttpFacade.Cookie cookie) throws OidcException {\n         try {\n             JwtContext idJwtContext = setVerificationKey(idToken, jwtConsumerBuilder);\n             jwtConsumerBuilder.setExpectedAudience(clientConfiguration.getResourceName());\n             jwtConsumerBuilder.registerValidator(new AzpValidator(clientConfiguration.getResourceName()));\n             jwtConsumerBuilder.registerValidator(new AtHashValidator(accessToken, clientConfiguration.getTokenSignatureAlgorithm()));\n+            jwtConsumerBuilder.registerValidator(new NonceValidator(cookie));\n+\n             // second pass to validate\n             jwtConsumerBuilder.build().processContext(idJwtContext);\n             JwtClaims idJwtClaims = idJwtContext.getJwtClaims();\n@@ -288,6 +291,33 @@ private static String getAccessTokenHash(String accessTokenString, String jwsAlg\n \n     }\n \n+\n+    private static class NonceValidator implements ErrorCodeValidator {\n+        private OidcHttpFacade.Cookie cookie;\n+\n+        public NonceValidator(OidcHttpFacade.Cookie cookie) {\n+            this.cookie = cookie;\n+        }\n+\n+        public ErrorCodeValidator.Error validate(JwtContext jwtContext) throws MalformedClaimException {\n+            JwtClaims idJwtClaims = jwtContext.getJwtClaims();\n+            IDToken idToken = new IDToken(idJwtClaims);\n+\n+            if (cookie != null) {\n+                String sessionRandomValue = Oidc.getCryptographicValue(cookie.getValue());\n+                String nonceValue = idToken.getNonce();\n+                if (!sessionRandomValue.equals(nonceValue)) {\n+                    return new ErrorCodeValidator.Error(INVALID_SESSION_RANDOM_VALUE,\n+                            log.invalidNonceValue(nonceValue));\n+                }\n+            } else {\n+                return new ErrorCodeValidator.Error(INVALID_SESSION_RANDOM_VALUE,\n+                        log.nonceCookieDoesNotExist());\n+            }\n+            return null;\n+        }\n+    }\n+\n     private static class TypeValidator implements ErrorCodeValidator {\n         public static final String TYPE = \"typ\";\n         private final String expectedType;"
            },
            {
                "sha": "52f5f85b5adfc254c924d18ef6d2f3cdab9e95d4",
                "filename": "http/oidc/src/test/java/org/wildfly/security/http/oidc/OidcBaseTest.java",
                "status": "modified",
                "additions": 60,
                "deletions": 5,
                "changes": 65,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcBaseTest.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcBaseTest.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcBaseTest.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -22,6 +22,7 @@\n import static org.junit.Assert.assertNotNull;\n import static org.junit.Assert.assertTrue;\n import static org.wildfly.security.http.oidc.Oidc.OIDC_NAME;\n+import static org.wildfly.security.http.oidc.Oidc.SESSION_RANDOM_VALUE;\n \n import java.io.ByteArrayInputStream;\n import java.io.IOException;\n@@ -211,6 +212,33 @@ public MockResponse dispatch(RecordedRequest recordedRequest) throws Interrupted\n         };\n     }\n \n+    protected static Dispatcher createAppResponse(HttpServerAuthenticationMechanism mechanism,\n+                                                  int expectedStatusCode, String expectedLocation,\n+                                                  String clientPageText, List<HttpServerCookie> cookies) {\n+        return new Dispatcher() {\n+            @Override\n+            public MockResponse dispatch(RecordedRequest recordedRequest) throws InterruptedException {\n+                String path = recordedRequest.getPath();\n+                if (path.contains(\"/\" + CLIENT_APP) && path.contains(\"&code=\")) {\n+                    try {\n+\n+                        TestingHttpServerRequest request = new TestingHttpServerRequest(new String[0],\n+                                new URI(recordedRequest.getRequestUrl().toString()), cookies);\n+                        mechanism.evaluateRequest(request);\n+                        TestingHttpServerResponse response = request.getResponse();\n+                        assertEquals(expectedStatusCode, response.getStatusCode());\n+                        assertEquals(expectedLocation, response.getLocation());\n+                        return new MockResponse().setBody(clientPageText);\n+                    } catch (Exception e) {\n+                        throw new RuntimeException(e);\n+                    }\n+                }\n+                return new MockResponse()\n+                        .setBody(\"\");\n+            }\n+        };\n+    }\n+\n     protected static Dispatcher createAppResponse(HttpServerAuthenticationMechanism mechanism, int expectedStatusCode, String expectedLocation, String clientPageText,\n                                                   Map<String, Object> sessionScopeAttachments) {\n         return new Dispatcher() {\n@@ -351,24 +379,37 @@ protected void checkForScopeClaims(Callback callback, String expectedScopes) thr\n     protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n                                        int expectedDispatcherStatusCode, String expectedLocation, String clientPageText) throws Exception {\n         performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, getClientUrl(), expectedLocation,\n-                clientPageText, null, false);\n+                clientPageText, null, false, false );\n+    }\n+\n+    protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n+                                         int expectedDispatcherStatusCode, String expectedLocation, String clientPageText,\n+                                         boolean changeSessionId) throws Exception {\n+        performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, getClientUrl(), expectedLocation,\n+                clientPageText, null, false, changeSessionId);\n     }\n \n     protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n                                          int expectedDispatcherStatusCode, String clientUrl, String expectedLocation, String clientPageText) throws Exception {\n         performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, clientUrl, expectedLocation,\n-                clientPageText, null, false);\n+                clientPageText, null, false, false);\n     }\n \n+    protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak, int expectedDispatcherStatusCode,\n+                                         String expectedLocation, String clientPageText, String expectedScope, boolean checkInvalidScopeError,\n+                                         boolean changeSessionId) throws Exception {\n+        performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, getClientUrl(), expectedLocation, clientPageText,\n+                expectedScope, checkInvalidScopeError, changeSessionId);\n+    }\n     protected void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak, int expectedDispatcherStatusCode,\n                                          String expectedLocation, String clientPageText, String expectedScope, boolean checkInvalidScopeError) throws Exception {\n         performAuthentication(oidcConfig, username, password, loginToKeycloak, expectedDispatcherStatusCode, getClientUrl(), expectedLocation, clientPageText,\n-                expectedScope, checkInvalidScopeError);\n+                expectedScope, checkInvalidScopeError, false);\n     }\n \n     private void performAuthentication(InputStream oidcConfig, String username, String password, boolean loginToKeycloak,\n                                        int expectedDispatcherStatusCode, String clientUrl, String expectedLocation, String clientPageText,\n-                                       String expectedScope, boolean checkInvalidScopeError) throws Exception {\n+                                       String expectedScope, boolean checkInvalidScopeError, boolean changeSessionId) throws Exception {\n         try {\n             Map<String, Object> props = new HashMap<>();\n             OidcClientConfiguration oidcClientConfiguration = OidcClientConfigurationBuilder.build(oidcConfig);\n@@ -394,7 +435,21 @@ private void performAuthentication(InputStream oidcConfig, String username, Stri\n             }\n \n             if (loginToKeycloak) {\n-                client.setDispatcher(createAppResponse(mechanism, expectedDispatcherStatusCode, expectedLocation, clientPageText));\n+                // change the sessionRandomValue value so that the compare to nonce will fail.\n+                List<HttpServerCookie> tmpCookies = response.getCookies();\n+                if (changeSessionId) {\n+                    for (HttpServerCookie c : tmpCookies) {\n+                        if (c.getName().equals(SESSION_RANDOM_VALUE)) {\n+                            HttpServerCookie tmpCookie = HttpServerCookie.getInstance(c.getName(),\n+                                    \"9999\" + c.getValue(), c.getDomain(), c.getMaxAge(), c.getPath(),\n+                                    c.isSecure(), c.getVersion(), c.isHttpOnly());\n+                            tmpCookies.remove(c);\n+                            tmpCookies.add(tmpCookie);\n+                        }\n+                    }\n+                }\n+                client.setDispatcher(createAppResponse(mechanism, expectedDispatcherStatusCode,\n+                        expectedLocation, clientPageText, tmpCookies));\n \n                 if (checkInvalidScopeError) {\n                     WebClient webClient = getWebClient();"
            },
            {
                "sha": "859cd1ad3b070be31595c4a8cc38363ecfc8c7c6",
                "filename": "http/oidc/src/test/java/org/wildfly/security/http/oidc/OidcSecurityRealmTest.java",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcSecurityRealmTest.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcSecurityRealmTest.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcSecurityRealmTest.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -72,7 +72,7 @@ public void testGetRealmIdentityWithNonOidcPrincipal() throws RealmUnavailableEx\n     @Test\n     public void testGetRealmIdentityNoRoles() throws RealmUnavailableException {\n         // setup\n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(new OidcClientConfiguration(),\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(new OidcClientConfiguration(), null,\n                 null, null, new AccessToken(new JwtClaims()), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -108,7 +108,7 @@ public void testGetRealmIdentityRolesCombined() throws RealmUnavailableException\n         jwtClaims.setClaim(\"resource_access\", resourceAccess);\n         jwtClaims.setClaim(\"realm_access\", createRoles(\"roleC\", \"roleD\"));\n \n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -137,7 +137,7 @@ public void testGetRealmIdentityOnlyRealmRoles() throws RealmUnavailableExceptio\n         jwtClaims.setClaim(\"resource_access\", resourceAccess);\n         jwtClaims.setClaim(\"realm_access\", createRoles(\"roleC\", \"roleD\"));\n \n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -165,7 +165,7 @@ public void testGetRealmIdentityOnlyResourceRoles() throws RealmUnavailableExcep\n         jwtClaims.setClaim(\"resource_access\", resourceAccess);\n         jwtClaims.setClaim(\"\", new RealmAccessClaim(createRoles(\"roleC\", \"roleD\")));\n \n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -193,7 +193,7 @@ public void testGetRealmIdentityNoMappings() throws RealmUnavailableException {\n         jwtClaims.setClaim(\"resource_access\", resourceAccess);\n         jwtClaims.setClaim(\"\", new RealmAccessClaim(createRoles(\"roleC\", \"roleD\")));\n \n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n \n@@ -390,7 +390,7 @@ private static String getRealmAndResourceRolesClaims(boolean includeRealmAndReso\n     }\n \n     private Attributes.Entry getRealmIdentityRoles(OidcClientConfiguration clientConfiguration, JwtClaims jwtClaims) throws RealmUnavailableException {\n-        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,\n+        RefreshableOidcSecurityContext securityContext = new RefreshableOidcSecurityContext(clientConfiguration,null,\n                 null, null, new AccessToken(jwtClaims), null, null, null);\n         OidcPrincipal principal = new OidcPrincipal(\"john\", securityContext);\n "
            },
            {
                "sha": "b6bf51f1e1861ab34649ba01c8d045825ea76bb2",
                "filename": "http/oidc/src/test/java/org/wildfly/security/http/oidc/OidcTest.java",
                "status": "modified",
                "additions": 22,
                "deletions": 0,
                "changes": 22,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcTest.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcTest.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/http%2Foidc%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Foidc%2FOidcTest.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -367,6 +367,28 @@ public void testRequestObjectConfigMissingENCValue() throws Exception {\n         testRequestObjectInvalidConfiguration(getOidcConfigurationInputStreamWithoutEncValue(REQUEST.getValue(), RSA_OAEP), RequestObjectErrorType.MISSING_ENC_VALUE);\n     }\n \n+    @Test\n+    // Generate an invalid sessionRandomValue so that the nonce check fails\n+    public void testRequestParameterNonceMismatch() throws Exception {\n+        performAuthentication(\n+                getOidcConfigurationInputStreamWithRequestParameter(REQUEST.getValue(), NONE, \"\", \"\"),\n+                KeycloakConfiguration.ALICE, KeycloakConfiguration.ALICE_PASSWORD,true,\n+                HttpStatus.SC_FORBIDDEN,null, CLIENT_PAGE_TEXT, true);\n+    }\n+\n+    @Test\n+    public void testRequestUriParameterNonceMismatch() throws Exception {\n+        performAuthentication(getOidcConfigurationInputStreamWithRequestParameter(REQUEST_URI.getValue(), NONE, \"\", \"\"),\n+                KeycloakConfiguration.ALICE, KeycloakConfiguration.ALICE_PASSWORD, true,\n+                HttpStatus.SC_FORBIDDEN, null, CLIENT_PAGE_TEXT, true);\n+    }\n+\n+    @Test\n+    public void testStandardConfigWithNonceMismatch() throws Exception {\n+        performAuthentication(getOidcConfigurationInputStreamWithProviderUrl(), KeycloakConfiguration.ALICE, KeycloakConfiguration.ALICE_PASSWORD,\n+                true, HttpStatus.SC_FORBIDDEN, null, CLIENT_PAGE_TEXT, true);\n+    }\n+\n     /*****************************************************************************************************************************************\n      * Tests for multi-tenancy.\n      *"
            },
            {
                "sha": "aa744a40813195dc7fed8d69eb3e1e49f802a5d4",
                "filename": "tests/base/src/test/java/org/wildfly/security/http/impl/AbstractBaseHttpTest.java",
                "status": "modified",
                "additions": 12,
                "deletions": 3,
                "changes": 15,
                "blob_url": "https://github.com/wildfly-security/wildfly-elytron/blob/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/tests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Fimpl%2FAbstractBaseHttpTest.java",
                "raw_url": "https://github.com/wildfly-security/wildfly-elytron/raw/5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb/tests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Fimpl%2FAbstractBaseHttpTest.java",
                "contents_url": "https://api.github.com/repos/wildfly-security/wildfly-elytron/contents/tests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fwildfly%2Fsecurity%2Fhttp%2Fimpl%2FAbstractBaseHttpTest.java?ref=5ac5e6bbcba58883b3cebb2ddbcec4de140c5ceb",
                "patch": "@@ -213,11 +213,20 @@ public TestingHttpServerRequest(String[] authorization, URI requestURI, String c\n             }\n             this.remoteUser = null;\n             this.requestURI = requestURI;\n+\n             this.cookies = new ArrayList<>();\n             if (cookie != null) {\n-                final String cookieName = cookie.substring(0, cookie.indexOf('='));\n-                final String cookieValue = cookie.substring(cookie.indexOf('=') + 1);\n-                cookies.add(HttpServerCookie.getInstance(cookieName, cookieValue, null, -1, \"/\", false, 0, true));\n+                String[] cookiesArr = cookie.split(\";\");\n+                if (cookiesArr.length == 0) {\n+                    cookiesArr[0] = cookie;\n+                }\n+                for (int i = 0; i < cookiesArr.length; i++) {\n+                    String[] cookiePair = cookiesArr[i].trim().split(\"=\");\n+                    if (cookiePair.length == 2) {\n+                        this.cookies.add(HttpServerCookie.getInstance(\n+                                cookiePair[0], cookiePair[1], null, -1, \"/\", false, 0, true));\n+                    }\n+                }\n             }\n         }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/basecamp/trix/commits/272c7e27e722608732a67108ad3fe7870e233ac8",
        "url": "https://api.github.com/repos/basecamp/trix/commits/272c7e27e722608732a67108ad3fe7870e233ac8",
        "html_url": "https://github.com/basecamp/trix/commit/272c7e27e722608732a67108ad3fe7870e233ac8",
        "message": "Sanitize HTML with DOMPurify\n\nSanitize HTML with DOMPurify to prevent XSS attacks. This is a fix\nfor two security vulnerabilities for MathML and embed\nbased bypasses when pasting data into a Trix editor.",
        "files": [
            {
                "sha": "4002b0009f799ccc562b749de4dad36db066a522",
                "filename": "package.json",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/basecamp/trix/blob/272c7e27e722608732a67108ad3fe7870e233ac8/package.json",
                "raw_url": "https://github.com/basecamp/trix/raw/272c7e27e722608732a67108ad3fe7870e233ac8/package.json",
                "contents_url": "https://api.github.com/repos/basecamp/trix/contents/package.json?ref=272c7e27e722608732a67108ad3fe7870e233ac8",
                "patch": "@@ -68,5 +68,8 @@\n     \"postrelease\": \"git push && git push --tags\",\n     \"dev\": \"web-dev-server --app-index index.html  --root-dir dist --node-resolve --open\",\n     \"start\": \"yarn build-assets && concurrently --kill-others --names js,css,dev-server 'yarn watch' 'yarn build-css --watch' 'yarn dev'\"\n+  },\n+  \"dependencies\": {\n+    \"dompurify\": \"^3.2.0\"\n   }\n }"
            },
            {
                "sha": "beadf105611a4cadf77c3685f95b9ccf0054c693",
                "filename": "rollup.config.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/basecamp/trix/blob/272c7e27e722608732a67108ad3fe7870e233ac8/rollup.config.js",
                "raw_url": "https://github.com/basecamp/trix/raw/272c7e27e722608732a67108ad3fe7870e233ac8/rollup.config.js",
                "contents_url": "https://api.github.com/repos/basecamp/trix/contents/rollup.config.js?ref=272c7e27e722608732a67108ad3fe7870e233ac8",
                "patch": "@@ -41,7 +41,7 @@ const terserConfig = terser({\n       const type = comment.type\n       if (type == \"comment2\") {\n         // multiline comment\n-        return /Copyright/.test(text)\n+        return /@license|Copyright/.test(text)\n       }\n     },\n   },"
            },
            {
                "sha": "f3ddbf7fda0470e6ef5d7430ee413a813b420e9f",
                "filename": "src/test/system/pasting_test.js",
                "status": "modified",
                "additions": 30,
                "deletions": 0,
                "changes": 30,
                "blob_url": "https://github.com/basecamp/trix/blob/272c7e27e722608732a67108ad3fe7870e233ac8/src%2Ftest%2Fsystem%2Fpasting_test.js",
                "raw_url": "https://github.com/basecamp/trix/raw/272c7e27e722608732a67108ad3fe7870e233ac8/src%2Ftest%2Fsystem%2Fpasting_test.js",
                "contents_url": "https://api.github.com/repos/basecamp/trix/contents/src%2Ftest%2Fsystem%2Fpasting_test.js?ref=272c7e27e722608732a67108ad3fe7870e233ac8",
                "patch": "@@ -119,6 +119,36 @@ testGroup(\"Pasting\", { template: \"editor_empty\" }, () => {\n     delete window.unsanitized\n   })\n \n+  test(\"paste data-trix-attachment encoded mathml\", async () => {\n+    window.unsanitized = []\n+    const pasteData = {\n+      \"text/plain\": \"x\",\n+      \"text/html\": `\\\n+      copy<div data-trix-attachment=\"{&quot;contentType&quot;:&quot;text/html5&quot;,&quot;content&quot;:&quot;&lt;math&gt;&lt;mtext&gt;&lt;table&gt;&lt;mglyph&gt;&lt;style&gt;&lt;img src=x onerror=alert()&gt;&lt;/style&gt;XSS POC&quot;}\"></div>me\n+      `,\n+    }\n+\n+    await pasteContent(pasteData)\n+    await delay(20)\n+    assert.deepEqual(window.unsanitized, [])\n+    delete window.unsanitized\n+  })\n+\n+  test(\"paste data-trix-attachment encoded embed\", async () => {\n+    window.unsanitized = []\n+    const pasteData = {\n+      \"text/plain\": \"x\",\n+      \"text/html\": `\\\n+      copy<div data-trix-attachment=\"{&quot;contentType&quot;:&quot;text/html5&quot;,&quot;content&quot;:&quot;&lt;embed src='javascript:alert(1)'&gt;XSS POC&quot;}\"></div>me\n+      `,\n+    }\n+\n+    await pasteContent(pasteData)\n+    await delay(20)\n+    assert.deepEqual(window.unsanitized, [])\n+    delete window.unsanitized\n+  })\n+\n   test(\"prefers plain text when html lacks formatting\", async () => {\n     const pasteData = {\n       \"text/html\": \"<meta charset='utf-8'>a\\nb\","
            },
            {
                "sha": "4e93e70112e9907d0168bc8850a8c98dc9896d17",
                "filename": "src/trix/models/html_sanitizer.js",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/basecamp/trix/blob/272c7e27e722608732a67108ad3fe7870e233ac8/src%2Ftrix%2Fmodels%2Fhtml_sanitizer.js",
                "raw_url": "https://github.com/basecamp/trix/raw/272c7e27e722608732a67108ad3fe7870e233ac8/src%2Ftrix%2Fmodels%2Fhtml_sanitizer.js",
                "contents_url": "https://api.github.com/repos/basecamp/trix/contents/src%2Ftrix%2Fmodels%2Fhtml_sanitizer.js?ref=272c7e27e722608732a67108ad3fe7870e233ac8",
                "patch": "@@ -1,6 +1,7 @@\n import BasicObject from \"trix/core/basic_object\"\n \n import { nodeIsAttachmentElement, removeNode, tagName, walkTree } from \"trix/core/helpers\"\n+import DOMPurify from \"dompurify\"\n \n const DEFAULT_ALLOWED_ATTRIBUTES = \"style href src width height language class\".split(\" \")\n const DEFAULT_FORBIDDEN_PROTOCOLS = \"javascript:\".split(\" \")\n@@ -29,7 +30,8 @@ export default class HTMLSanitizer extends BasicObject {\n \n   sanitize() {\n     this.sanitizeElements()\n-    return this.normalizeListElementNesting()\n+    this.normalizeListElementNesting()\n+    return DOMPurify.sanitize(this.body, { ADD_ATTR: [ \"language\" ], RETURN_DOM: true } )\n   }\n \n   getHTML() {"
            },
            {
                "sha": "37a871b5e8fccee819542d4f347f51adbfaf15c5",
                "filename": "yarn.lock",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/basecamp/trix/blob/272c7e27e722608732a67108ad3fe7870e233ac8/yarn.lock",
                "raw_url": "https://github.com/basecamp/trix/raw/272c7e27e722608732a67108ad3fe7870e233ac8/yarn.lock",
                "contents_url": "https://api.github.com/repos/basecamp/trix/contents/yarn.lock?ref=272c7e27e722608732a67108ad3fe7870e233ac8",
                "patch": "@@ -2829,6 +2829,11 @@ domhandler@^4.2.0, domhandler@^4.3.1:\n   dependencies:\n     domelementtype \"^2.2.0\"\n \n+dompurify@^3.2.0:\n+  version \"3.2.0\"\n+  resolved \"https://registry.yarnpkg.com/dompurify/-/dompurify-3.2.0.tgz#53c414317c51503183696fcdef6dd3f916c607ed\"\n+  integrity sha512-AMdOzK44oFWqHEi0wpOqix/fUNY707OmoeFDnbi3Q5I8uOpy21ufUA5cDJPr0bosxrflOVD/H2DMSvuGKJGfmQ==\n+\n domutils@^2.8.0:\n   version \"2.8.0\"\n   resolved \"https://registry.yarnpkg.com/domutils/-/domutils-2.8.0.tgz#4437def5db6e2d1f5d6ee859bd95ca7d02048135\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Enalean/tuleap/commits/d3686ab152b6f64ff835e7dd3c99d97b36a9d4d5",
        "url": "https://api.github.com/repos/Enalean/tuleap/commits/d3686ab152b6f64ff835e7dd3c99d97b36a9d4d5",
        "html_url": "https://github.com/Enalean/tuleap/commit/d3686ab152b6f64ff835e7dd3c99d97b36a9d4d5",
        "message": "fix: request #40459: XSS in Gantt chart\n\nChange-Id: I816eaa5f3bf4a0c41cde57dbba5a460ba04552cb",
        "files": [
            {
                "sha": "aa83908e43551a93073bf564091ad1808bc4414c",
                "filename": "src/embedded_vendor/jpgraph/jpgraph_gantt.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/Enalean/tuleap/blob/d3686ab152b6f64ff835e7dd3c99d97b36a9d4d5/src%2Fembedded_vendor%2Fjpgraph%2Fjpgraph_gantt.php",
                "raw_url": "https://github.com/Enalean/tuleap/raw/d3686ab152b6f64ff835e7dd3c99d97b36a9d4d5/src%2Fembedded_vendor%2Fjpgraph%2Fjpgraph_gantt.php",
                "contents_url": "https://api.github.com/repos/Enalean/tuleap/contents/src%2Fembedded_vendor%2Fjpgraph%2Fjpgraph_gantt.php?ref=d3686ab152b6f64ff835e7dd3c99d97b36a9d4d5",
                "patch": "@@ -3648,7 +3648,7 @@ public function Stroke($aImg, $aScale)\n                     }\n \n                     if (! empty($this->title->csimalt[$i])) {\n-                        $tmp             = $this->title->csimalt[$i];\n+                        $tmp             = Codendi_HTMLPurifier::instance()->purify($this->title->csimalt[$i]);\n                         $this->csimarea .= \" title=\\\"$tmp\\\" alt=\\\"$tmp\\\" \";\n                     }\n                     $this->csimarea .= \" />\\n\";\n@@ -3697,7 +3697,7 @@ public function Stroke($aImg, $aScale)\n             }\n \n             if ($this->csimalt != '') {\n-                $tmp             = $this->csimalt;\n+                $tmp             = Codendi_HTMLPurifier::instance()->purify($this->csimalt);\n                 $this->csimarea .= \" title=\\\"$tmp\\\" alt=\\\"$tmp\\\" \";\n             }\n             $this->csimarea .= \" />\\n\";\n@@ -3835,7 +3835,7 @@ public function Stroke($aImg, $aScale)\n                     }\n \n                     if (! empty($this->title->csimalt[$i])) {\n-                        $tmp             = $this->title->csimalt[$i];\n+                        $tmp             = Codendi_HTMLPurifier::instance()->purify($this->title->csimalt[$i]);\n                         $this->csimarea .= \" title=\\\"$tmp\\\" alt=\\\"$tmp\\\" \";\n                     }\n                     $this->csimarea .= \" />\\n\";"
            },
            {
                "sha": "11198df49964617bec6b5932b7c73ee38791e71a",
                "filename": "src/embedded_vendor/jpgraph/jpgraph_plotmark.inc.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/Enalean/tuleap/blob/d3686ab152b6f64ff835e7dd3c99d97b36a9d4d5/src%2Fembedded_vendor%2Fjpgraph%2Fjpgraph_plotmark.inc.php",
                "raw_url": "https://github.com/Enalean/tuleap/raw/d3686ab152b6f64ff835e7dd3c99d97b36a9d4d5/src%2Fembedded_vendor%2Fjpgraph%2Fjpgraph_plotmark.inc.php",
                "contents_url": "https://api.github.com/repos/Enalean/tuleap/contents/src%2Fembedded_vendor%2Fjpgraph%2Fjpgraph_plotmark.inc.php?ref=d3686ab152b6f64ff835e7dd3c99d97b36a9d4d5",
                "patch": "@@ -169,7 +169,7 @@ public function AddCSIMPoly($aPts)\n             }\n \n             if (! empty($this->csimalt)) {\n-                $tmp              = sprintf($this->csimalt, $this->yvalue, $this->xvalue);\n+                $tmp              = Codendi_HTMLPurifier::instance()->purify(sprintf($this->csimalt, $this->yvalue, $this->xvalue));\n                 $this->csimareas .= \" title=\\\"$tmp\\\" alt=\\\"$tmp\\\"\";\n             }\n             $this->csimareas .= \" />\\n\";\n@@ -190,7 +190,7 @@ public function AddCSIMCircle($x, $y, $r)\n             }\n \n             if (! empty($this->csimalt)) {\n-                $tmp              = sprintf($this->csimalt, $this->yvalue, $this->xvalue);\n+                $tmp              = Codendi_HTMLPurifier::instance()->purify(sprintf($this->csimalt, $this->yvalue, $this->xvalue));\n                 $this->csimareas .= \" title=\\\"$tmp\\\" alt=\\\"$tmp\\\" \";\n             }\n             $this->csimareas .= \" />\\n\";\n@@ -349,7 +349,7 @@ public function Stroke($img, $x, $y)\n                 }\n \n                 if (! empty($this->csimalt)) {\n-                    $tmp              = sprintf($this->csimalt, $this->yvalue, $this->xvalue);\n+                    $tmp              = Codendi_HTMLPurifier::instance()->purify(sprintf($this->csimalt, $this->yvalue, $this->xvalue));\n                     $this->csimareas .= \" title=\\\"$tmp\\\" alt=\\\"$tmp\\\" \";\n                 }\n                 $this->csimareas .= \" />\\n\";"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/superset/commits/7650c47e72f28559e91524f5d68d50c2060df4c7",
        "url": "https://api.github.com/repos/apache/superset/commits/7650c47e72f28559e91524f5d68d50c2060df4c7",
        "html_url": "https://github.com/apache/superset/commit/7650c47e72f28559e91524f5d68d50c2060df4c7",
        "message": "fix: Gamma users shouldn't be able to create roles (#29687)",
        "files": [
            {
                "sha": "54873905787e6d67d1abc26c7246faf12c649d9b",
                "filename": "superset/security/manager.py",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/apache/superset/blob/7650c47e72f28559e91524f5d68d50c2060df4c7/superset%2Fsecurity%2Fmanager.py",
                "raw_url": "https://github.com/apache/superset/raw/7650c47e72f28559e91524f5d68d50c2060df4c7/superset%2Fsecurity%2Fmanager.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fsecurity%2Fmanager.py?ref=7650c47e72f28559e91524f5d68d50c2060df4c7",
                "patch": "@@ -238,6 +238,12 @@ class SupersetSecurityManager(  # pylint: disable=too-many-public-methods\n         \"SQL Lab\",\n         \"User Registrations\",\n         \"User's Statistics\",\n+        # Guarding all AB_ADD_SECURITY_API = True REST APIs\n+        \"Role\",\n+        \"Permission\",\n+        \"PermissionViewMenu\",\n+        \"ViewMenu\",\n+        \"User\",\n     } | USER_MODEL_VIEWS\n \n     ALPHA_ONLY_VIEW_MENUS = {"
            },
            {
                "sha": "c2d9b130cdc5813abe225cad3e7eb8d4f7114d4d",
                "filename": "tests/integration_tests/security/api_tests.py",
                "status": "modified",
                "additions": 62,
                "deletions": 0,
                "changes": 62,
                "blob_url": "https://github.com/apache/superset/blob/7650c47e72f28559e91524f5d68d50c2060df4c7/tests%2Fintegration_tests%2Fsecurity%2Fapi_tests.py",
                "raw_url": "https://github.com/apache/superset/raw/7650c47e72f28559e91524f5d68d50c2060df4c7/tests%2Fintegration_tests%2Fsecurity%2Fapi_tests.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Fintegration_tests%2Fsecurity%2Fapi_tests.py?ref=7650c47e72f28559e91524f5d68d50c2060df4c7",
                "patch": "@@ -26,6 +26,7 @@\n from superset.models.dashboard import Dashboard\n from superset.utils.urls import get_url_host\n from superset.utils import json\n+from tests.integration_tests.conftest import with_config\n from tests.integration_tests.base_tests import SupersetTestCase\n from tests.integration_tests.constants import ADMIN_USERNAME, GAMMA_USERNAME\n from tests.integration_tests.fixtures.birth_names_dashboard import (\n@@ -135,3 +136,64 @@ def test_post_guest_token_bad_resources(self):\n         )\n \n         self.assert400(response)\n+\n+\n+class TestSecurityRolesApi(SupersetTestCase):\n+    uri = \"api/v1/security/roles/\"  # noqa: F541\n+\n+    @with_config({\"FAB_ADD_SECURITY_API\": True})\n+    def test_get_security_roles_admin(self):\n+        \"\"\"\n+        Security API: Admin should be able to get roles\n+        \"\"\"\n+        self.login(ADMIN_USERNAME)\n+        response = self.client.get(self.uri)\n+        self.assert200(response)\n+\n+    @with_config({\"FAB_ADD_SECURITY_API\": True})\n+    def test_get_security_roles_gamma(self):\n+        \"\"\"\n+        Security API: Gamma should not be able to get roles\n+        \"\"\"\n+        self.login(GAMMA_USERNAME)\n+        response = self.client.get(self.uri)\n+        self.assert403(response)\n+\n+    @with_config({\"FAB_ADD_SECURITY_API\": True})\n+    def test_post_security_roles_gamma(self):\n+        \"\"\"\n+        Security API: Gamma should not be able to create roles\n+        \"\"\"\n+        self.login(GAMMA_USERNAME)\n+        response = self.client.post(\n+            self.uri,\n+            data=json.dumps({\"name\": \"new_role\"}),\n+            content_type=\"application/json\",\n+        )\n+        self.assert403(response)\n+\n+    @with_config({\"FAB_ADD_SECURITY_API\": True})\n+    def test_put_security_roles_gamma(self):\n+        \"\"\"\n+        Security API: Gamma shouldnt be able to update roles\n+        \"\"\"\n+        self.login(GAMMA_USERNAME)\n+        response = self.client.put(\n+            f\"{self.uri}1\",\n+            data=json.dumps({\"name\": \"new_role\"}),\n+            content_type=\"application/json\",\n+        )\n+        self.assert403(response)\n+\n+    @with_config({\"FAB_ADD_SECURITY_API\": True})\n+    def test_delete_security_roles_gamma(self):\n+        \"\"\"\n+        Security API: Gamma shouldnt be able to delete roles\n+        \"\"\"\n+        self.login(GAMMA_USERNAME)\n+        response = self.client.delete(\n+            f\"{self.uri}1\",\n+            data=json.dumps({\"name\": \"new_role\"}),\n+            content_type=\"application/json\",\n+        )\n+        self.assert403(response)"
            },
            {
                "sha": "19f8c3029826379ece915c529e5527be9d8f63f8",
                "filename": "tests/integration_tests/superset_test_config.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/superset/blob/7650c47e72f28559e91524f5d68d50c2060df4c7/tests%2Fintegration_tests%2Fsuperset_test_config.py",
                "raw_url": "https://github.com/apache/superset/raw/7650c47e72f28559e91524f5d68d50c2060df4c7/tests%2Fintegration_tests%2Fsuperset_test_config.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/tests%2Fintegration_tests%2Fsuperset_test_config.py?ref=7650c47e72f28559e91524f5d68d50c2060df4c7",
                "patch": "@@ -137,6 +137,8 @@ def GET_FEATURE_FLAGS_FUNC(ff):\n \n ALERT_REPORTS_QUERY_EXECUTION_MAX_TRIES = 3\n \n+FAB_ADD_SECURITY_API = True\n+\n \n class CeleryConfig:\n     broker_url = f\"redis://{REDIS_HOST}:{REDIS_PORT}/{REDIS_CELERY_DB}\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/superset/commits/ac3a10d8f192520580b8ce545cf418dc7928d27c",
        "url": "https://api.github.com/repos/apache/superset/commits/ac3a10d8f192520580b8ce545cf418dc7928d27c",
        "html_url": "https://github.com/apache/superset/commit/ac3a10d8f192520580b8ce545cf418dc7928d27c",
        "message": "fix: don't show metadata for embedded dashboards (#30875)",
        "files": [
            {
                "sha": "9a2c414d00f7a49fc0e512180091e5ecb73869b4",
                "filename": "superset-frontend/src/dashboard/components/Header/Header.test.tsx",
                "status": "modified",
                "additions": 45,
                "deletions": 0,
                "changes": 45,
                "blob_url": "https://github.com/apache/superset/blob/ac3a10d8f192520580b8ce545cf418dc7928d27c/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FHeader%2FHeader.test.tsx",
                "raw_url": "https://github.com/apache/superset/raw/ac3a10d8f192520580b8ce545cf418dc7928d27c/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FHeader%2FHeader.test.tsx",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FHeader%2FHeader.test.tsx?ref=ac3a10d8f192520580b8ce545cf418dc7928d27c",
                "patch": "@@ -373,3 +373,48 @@ test('should render an extension component if one is supplied', () => {\n     screen.getByText('dashboard.nav.right extension component'),\n   ).toBeInTheDocument();\n });\n+\n+test('should NOT render MetadataBar when in edit mode', () => {\n+  const mockedProps = {\n+    ...createProps(),\n+    editMode: true,\n+    dashboardInfo: {\n+      ...createProps().dashboardInfo,\n+      userId: '123',\n+    },\n+  };\n+  setup(mockedProps);\n+  expect(\n+    screen.queryByText(mockedProps.dashboardInfo.changed_on_delta_humanized),\n+  ).not.toBeInTheDocument();\n+});\n+\n+test('should NOT render MetadataBar when embedded', () => {\n+  const mockedProps = {\n+    ...createProps(),\n+    editMode: false,\n+    dashboardInfo: {\n+      ...createProps().dashboardInfo,\n+      userId: undefined,\n+    },\n+  };\n+  setup(mockedProps);\n+  expect(\n+    screen.queryByText(mockedProps.dashboardInfo.changed_on_delta_humanized),\n+  ).not.toBeInTheDocument();\n+});\n+\n+test('should render MetadataBar when not in edit mode and not embedded', () => {\n+  const mockedProps = {\n+    ...createProps(),\n+    editMode: false,\n+    dashboardInfo: {\n+      ...createProps().dashboardInfo,\n+      userId: '123',\n+    },\n+  };\n+  setup(mockedProps);\n+  expect(\n+    screen.getByText(mockedProps.dashboardInfo.changed_on_delta_humanized),\n+  ).toBeInTheDocument();\n+});"
            },
            {
                "sha": "39dcff8d4c0d05e1c310c5d928104825a763fb02",
                "filename": "superset-frontend/src/dashboard/components/Header/index.jsx",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/superset/blob/ac3a10d8f192520580b8ce545cf418dc7928d27c/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FHeader%2Findex.jsx",
                "raw_url": "https://github.com/apache/superset/raw/ac3a10d8f192520580b8ce545cf418dc7928d27c/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FHeader%2Findex.jsx",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend%2Fsrc%2Fdashboard%2Fcomponents%2FHeader%2Findex.jsx?ref=ac3a10d8f192520580b8ce545cf418dc7928d27c",
                "patch": "@@ -496,6 +496,7 @@ class Header extends PureComponent {\n     const refreshWarning =\n       dashboardInfo.common?.conf\n         ?.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE;\n+    const isEmbedded = !dashboardInfo?.userId;\n \n     const handleOnPropertiesChange = updates => {\n       const { dashboardInfoChanged, dashboardTitleChanged } = this.props;\n@@ -553,7 +554,7 @@ class Header extends PureComponent {\n                 visible={!editMode}\n               />\n             ),\n-            !editMode && (\n+            !editMode && !isEmbedded && (\n               <MetadataBar\n                 items={this.getMetadataItems()}\n                 tooltipPlacement=\"bottom\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/superset/commits/0e0028260fc8a2099250701524a489f3c9aa146f",
        "url": "https://api.github.com/repos/apache/superset/commits/0e0028260fc8a2099250701524a489f3c9aa146f",
        "html_url": "https://github.com/apache/superset/commit/0e0028260fc8a2099250701524a489f3c9aa146f",
        "message": "fix: add more disallowed pg functions (#29454)",
        "files": [
            {
                "sha": "4e5f707edd43d6bfbf468a7a68f40a9f0b82a73b",
                "filename": "superset/config.py",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/apache/superset/blob/0e0028260fc8a2099250701524a489f3c9aa146f/superset%2Fconfig.py",
                "raw_url": "https://github.com/apache/superset/raw/0e0028260fc8a2099250701524a489f3c9aa146f/superset%2Fconfig.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset%2Fconfig.py?ref=0e0028260fc8a2099250701524a489f3c9aa146f",
                "patch": "@@ -1276,7 +1276,16 @@ def CSV_TO_HIVE_UPLOAD_DIRECTORY_FUNC(  # pylint: disable=invalid-name\n # unsafe SQL functions in SQL Lab and Charts. The keys of the dictionary are the engine\n # names, and the values are sets of disallowed functions.\n DISALLOWED_SQL_FUNCTIONS: dict[str, set[str]] = {\n-    \"postgresql\": {\"version\", \"query_to_xml\", \"inet_server_addr\", \"inet_client_addr\"},\n+    \"postgresql\": {\n+        \"database_to_xml\",\n+        \"inet_client_addr\",\n+        \"inet_server_addr\",\n+        \"query_to_xml\",\n+        \"query_to_xml_and_xmlschema\",\n+        \"table_to_xml\",\n+        \"table_to_xml_and_xmlschema\",\n+        \"version\",\n+    },\n     \"clickhouse\": {\"url\"},\n     \"mysql\": {\"version\"},\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Unstructured-IO/unstructured/commits/171b5df09fc3346aba8ce91c04de5b3e094a86bd",
        "url": "https://api.github.com/repos/Unstructured-IO/unstructured/commits/171b5df09fc3346aba8ce91c04de5b3e094a86bd",
        "html_url": "https://github.com/Unstructured-IO/unstructured/commit/171b5df09fc3346aba8ce91c04de5b3e094a86bd",
        "message": "fix: set `resolve_entities=False` in `partition_xml` (#3088)\n\n### Summary\n\nCloses #3078. Sets `resolve_entities=False` for parsing XML with `lxml`\nin `partition_xml` to avoid text being dynamically injected into the\ndocument.\n\n### Testing\n\n`pytest test_unstructured/partition/test_xml.py` continues to pass with\nthe update.",
        "files": [
            {
                "sha": "70aa3685604f04102ea7072d360f5cd62d661576",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/Unstructured-IO/unstructured/blob/171b5df09fc3346aba8ce91c04de5b3e094a86bd/CHANGELOG.md",
                "raw_url": "https://github.com/Unstructured-IO/unstructured/raw/171b5df09fc3346aba8ce91c04de5b3e094a86bd/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/Unstructured-IO/unstructured/contents/CHANGELOG.md?ref=171b5df09fc3346aba8ce91c04de5b3e094a86bd",
                "patch": "@@ -1,4 +1,4 @@\n-## 0.14.3-dev1\n+## 0.14.3-dev2\n \n ### Enhancements\n \n@@ -8,6 +8,8 @@\n \n ### Fixes\n \n+**Turn off XML resolve entities** Sets `resolve_entities=False` for XML parsing with `lxml`\n+  to avoid text being dynamically injected into the XML document.\n * Add the missing `form_extraction_skip_tables` argument to the `partition_pdf_or_image` call.\n \n ## 0.14.2"
            },
            {
                "sha": "f9fccef86f1c44598cb4af70bcd08de8274d87b5",
                "filename": "unstructured/__version__.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Unstructured-IO/unstructured/blob/171b5df09fc3346aba8ce91c04de5b3e094a86bd/unstructured%2F__version__.py",
                "raw_url": "https://github.com/Unstructured-IO/unstructured/raw/171b5df09fc3346aba8ce91c04de5b3e094a86bd/unstructured%2F__version__.py",
                "contents_url": "https://api.github.com/repos/Unstructured-IO/unstructured/contents/unstructured%2F__version__.py?ref=171b5df09fc3346aba8ce91c04de5b3e094a86bd",
                "patch": "@@ -1 +1 @@\n-__version__ = \"0.14.3-dev1\"  # pragma: no cover\n+__version__ = \"0.14.3-dev2\"  # pragma: no cover"
            },
            {
                "sha": "b6cc2accb904a8f93396a89b9415afdcfd28d31b",
                "filename": "unstructured/partition/xml.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Unstructured-IO/unstructured/blob/171b5df09fc3346aba8ce91c04de5b3e094a86bd/unstructured%2Fpartition%2Fxml.py",
                "raw_url": "https://github.com/Unstructured-IO/unstructured/raw/171b5df09fc3346aba8ce91c04de5b3e094a86bd/unstructured%2Fpartition%2Fxml.py",
                "contents_url": "https://api.github.com/repos/Unstructured-IO/unstructured/contents/unstructured%2Fpartition%2Fxml.py?ref=171b5df09fc3346aba8ce91c04de5b3e094a86bd",
                "patch": "@@ -51,7 +51,7 @@ def _get_leaf_elements(\n     \"\"\"Parse the XML tree in a memory efficient manner if possible.\"\"\"\n     element_stack = []\n \n-    element_iterator = etree.iterparse(file, events=(\"start\", \"end\"))\n+    element_iterator = etree.iterparse(file, events=(\"start\", \"end\"), resolve_entities=False)\n     # NOTE(alan) If xml_path is used for filtering, I've yet to find a good way to stream\n     # elements through in a memory efficient way, so we bite the bullet and load it all into\n     # memory."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nilsonLazarin/WeGIA/commits/3998672f1b86db58eab2808a640903d73b37bd2d",
        "url": "https://api.github.com/repos/LabRedesCefetRJ/WeGIA/commits/3998672f1b86db58eab2808a640903d73b37bd2d",
        "html_url": "https://github.com/LabRedesCefetRJ/WeGIA/commit/3998672f1b86db58eab2808a640903d73b37bd2d",
        "message": "Verifica\u00e7\u00e3o de permiss\u00e3o para alterar a senha [Issue #791]",
        "files": [
            {
                "sha": "bb5a91794cae5a6a8dd627a124bd750dd7c9d16e",
                "filename": "controle/FuncionarioControle.php",
                "status": "modified",
                "additions": 16,
                "deletions": 1,
                "changes": 17,
                "blob_url": "https://github.com/LabRedesCefetRJ/WeGIA/blob/3998672f1b86db58eab2808a640903d73b37bd2d/controle%2FFuncionarioControle.php",
                "raw_url": "https://github.com/LabRedesCefetRJ/WeGIA/raw/3998672f1b86db58eab2808a640903d73b37bd2d/controle%2FFuncionarioControle.php",
                "contents_url": "https://api.github.com/repos/LabRedesCefetRJ/WeGIA/contents/controle%2FFuncionarioControle.php?ref=3998672f1b86db58eab2808a640903d73b37bd2d",
                "patch": "@@ -850,6 +850,22 @@ public function alterarInfPessoal()\n     public function alterarSenha()\r\n     {\r\n         extract($_REQUEST); \r\n+\r\n+    \r\n+        $funcionarioDAO=new FuncionarioDAO();\r\n+       \r\n+        if($id_pessoa != $_SESSION['id_pessoa']){\r\n+            try{\r\n+                if(!$funcionarioDAO->verificaAdm($_SESSION['id_pessoa'])){\r\n+                    http_response_code(401);\r\n+                    exit('Opera\u00e7\u00e3o negada: O usu\u00e1rio logado n\u00e3o \u00e9 o mesmo de que se deseja alterar a senha');\r\n+                }\r\n+            }catch(PDOException $e){\r\n+                echo $e->getMessage();\r\n+                exit();\r\n+            }\r\n+        }\r\n+\r\n         $nova_senha=hash('sha256', $nova_senha);\r\n         if(isset($redir)){\r\n             $page = $redir;\r\n@@ -864,7 +880,6 @@ public function alterarSenha()\n         }elseif ($verificacao==2) {\r\n             header(\"Location: \".WWW.\"html/$page?verificacao=\".$verificacao);\r\n         }else{\r\n-            $funcionarioDAO=new FuncionarioDAO();\r\n             try {\r\n                 $funcionarioDAO->alterarSenha($id_pessoa, $nova_senha);\r\n                  $conexao =  mysqli_connect(DB_HOST,DB_USER,DB_PASSWORD,DB_NAME);\r"
            },
            {
                "sha": "133ddf34b2c1f23dafbafa979078e4ab13346ed0",
                "filename": "controle/control.php",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/LabRedesCefetRJ/WeGIA/blob/3998672f1b86db58eab2808a640903d73b37bd2d/controle%2Fcontrol.php",
                "raw_url": "https://github.com/LabRedesCefetRJ/WeGIA/raw/3998672f1b86db58eab2808a640903d73b37bd2d/controle%2Fcontrol.php",
                "contents_url": "https://api.github.com/repos/LabRedesCefetRJ/WeGIA/contents/controle%2Fcontrol.php?ref=3998672f1b86db58eab2808a640903d73b37bd2d",
                "patch": "@@ -3,6 +3,7 @@\n ini_set('display_errors', 1);\n ini_set('display_startup_erros', 1);\n error_reporting(E_ALL);\n+session_start();\n \n function processaRequisicao($nomeClasse, $metodo, $modulo = null){\n \tif ($nomeClasse && $metodo) {\n@@ -12,6 +13,11 @@ function processaRequisicao($nomeClasse, $metodo, $modulo = null){\n             include_once $nomeClasse . \".php\";\n         }\n \n+\t\tif(!isset($_SESSION['id_pessoa'])){\n+\t\t\thttp_response_code(401);\n+\t\t\texit('Opera\u00e7\u00e3o negada: Cliente n\u00e3o autorizado');\n+\t\t}\n+\n         // Cria uma inst\u00e2ncia da classe e chama o m\u00e9todo\n         $objeto = new $nomeClasse();\n         $objeto->$metodo();"
            },
            {
                "sha": "9a068e328f1037a2d7fbf74d931c1e90e7667d27",
                "filename": "dao/FuncionarioDAO.php",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/LabRedesCefetRJ/WeGIA/blob/3998672f1b86db58eab2808a640903d73b37bd2d/dao%2FFuncionarioDAO.php",
                "raw_url": "https://github.com/LabRedesCefetRJ/WeGIA/raw/3998672f1b86db58eab2808a640903d73b37bd2d/dao%2FFuncionarioDAO.php",
                "contents_url": "https://api.github.com/repos/LabRedesCefetRJ/WeGIA/contents/dao%2FFuncionarioDAO.php?ref=3998672f1b86db58eab2808a640903d73b37bd2d",
                "patch": "@@ -15,6 +15,24 @@\n \n class FuncionarioDAO\n {\n+\n+    public function verificaAdm($id){\n+        $pdo = Conexao::connect();\n+\n+        $buscaAdm = 'SELECT * FROM pessoa WHERE id_pessoa=:id AND adm_configurado=1';\n+\n+        $stmt = $pdo->prepare($buscaAdm);\n+        $stmt->bindParam(':id', $id);\n+\n+        $stmt->execute();\n+\n+        if($stmt->rowCount() == 1){\n+            return true;\n+        }\n+\n+        return false;\n+    }\n+\n     public function retornarIdPessoa($id_funcionario)\n     {\n         try {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openwrt/asu/commits/920c8a13d97b4d4095f0d939cf0aaae777e0f87e",
        "url": "https://api.github.com/repos/openwrt/asu/commits/920c8a13d97b4d4095f0d939cf0aaae777e0f87e",
        "html_url": "https://github.com/openwrt/asu/commit/920c8a13d97b4d4095f0d939cf0aaae777e0f87e",
        "message": "chore: cleanups and OpenWrt One as default\n\nremove some unecessary conditions, use OpenWrt One as default example,\nrun isort, bettern patterns for fields\n\nSigned-off-by: Paul Spooren <mail@aparcar.org>",
        "files": [
            {
                "sha": "f1c4718ef5a8ef0d69858a201cdc20f4dd32fc31",
                "filename": "asu/build.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/openwrt/asu/blob/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/asu%2Fbuild.py",
                "raw_url": "https://github.com/openwrt/asu/raw/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/asu%2Fbuild.py",
                "contents_url": "https://api.github.com/repos/openwrt/asu/contents/asu%2Fbuild.py?ref=920c8a13d97b4d4095f0d939cf0aaae777e0f87e",
                "patch": "@@ -245,7 +245,7 @@ def build(build_request: BuildRequest, job=None):\n         \"image\",\n         f\"PROFILE={build_request.profile}\",\n         f\"PACKAGES={' '.join(build_cmd_packages)}\",\n-        f\"EXTRA_IMAGE_NAME={packages_hash}\",\n+        f\"EXTRA_IMAGE_NAME={packages_hash[:12]}\",\n         f\"BIN_DIR=/builder/{request_hash}\",\n     ]\n "
            },
            {
                "sha": "e0d07fd5ebc29d8eebbfeb331a08eba40aefd525",
                "filename": "asu/build_request.py",
                "status": "modified",
                "additions": 17,
                "deletions": 5,
                "changes": 22,
                "blob_url": "https://github.com/openwrt/asu/blob/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/asu%2Fbuild_request.py",
                "raw_url": "https://github.com/openwrt/asu/raw/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/asu%2Fbuild_request.py",
                "contents_url": "https://api.github.com/repos/openwrt/asu/contents/asu%2Fbuild_request.py?ref=920c8a13d97b4d4095f0d939cf0aaae777e0f87e",
                "patch": "@@ -1,8 +1,12 @@\n from typing import Annotated\n+\n from pydantic import BaseModel, Field\n \n from asu.config import settings\n \n+STRING_PATTERN = r\"^[\\w.,-]*$\"\n+TARGET_PATTERN = r\"^[\\w]*/[\\w]*$\"\n+\n \n class BuildRequest(BaseModel):\n     distro: Annotated[\n@@ -12,16 +16,18 @@ class BuildRequest(BaseModel):\n                 This parameter is currently optional since no other\n                 distributions are supported.\n             \"\"\".strip(),\n+            pattern=STRING_PATTERN,\n         ),\n     ] = \"openwrt\"\n     version: Annotated[\n         str,\n         Field(\n-            examples=[\"23.05.2\"],\n+            examples=[\"24.10.0-rc2\"],\n             description=\"\"\"\n                 It is recommended to always upgrade to the latest version,\n                 however it is possible to request older images for testing.\n             \"\"\".strip(),\n+            pattern=STRING_PATTERN,\n         ),\n     ]\n     version_code: Annotated[\n@@ -34,30 +40,33 @@ class BuildRequest(BaseModel):\n                 resulting firmware is a different revision, the build results\n                 in an error.\n             \"\"\".strip(),\n+            pattern=STRING_PATTERN,\n         ),\n     ] = \"\"\n     target: Annotated[\n         str,\n         Field(\n-            examples=[\"ath79/generic\"],\n+            examples=[\"mediatek/filogic\"],\n             description=\"\"\"\n             It is recommended to always upgrade to the latest version, however\n             it is possible to request older images for testing.\n             \"\"\".strip(),\n+            pattern=TARGET_PATTERN,\n         ),\n     ]\n     profile: Annotated[\n         str,\n         Field(\n-            examples=[\"8dev_carambola2\"],\n+            examples=[\"openwrt_one\"],\n             description=\"\"\"\n                 The ImageBuilder `PROFILE`.  Can be found with `ubus call\n                 system board` as the `board_name` value.\n                 \"\"\".strip(),\n+            pattern=STRING_PATTERN,\n         ),\n     ]\n     packages: Annotated[\n-        list[str],\n+        list[Annotated[str, Field(pattern=STRING_PATTERN)]],\n         Field(\n             examples=[[\"vim\", \"tmux\"]],\n             description=\"\"\"\n@@ -69,7 +78,10 @@ class BuildRequest(BaseModel):\n         ),\n     ] = []\n     packages_versions: Annotated[\n-        dict,\n+        dict[\n+            Annotated[str, Field(pattern=STRING_PATTERN)],\n+            Annotated[str, Field(pattern=STRING_PATTERN)],\n+        ],\n         Field(\n             examples=[{\"vim\": \"1.2.3\", \"tmux\": \"2.3.4\"}],\n             description=\"\"\""
            },
            {
                "sha": "d8c29ad526d88243561049bc027fbc1359b322f8",
                "filename": "asu/main.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/openwrt/asu/blob/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/asu%2Fmain.py",
                "raw_url": "https://github.com/openwrt/asu/raw/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/asu%2Fmain.py",
                "contents_url": "https://api.github.com/repos/openwrt/asu/contents/asu%2Fmain.py?ref=920c8a13d97b4d4095f0d939cf0aaae777e0f87e",
                "patch": "@@ -16,10 +16,10 @@\n from asu.routers import api\n from asu.util import (\n     get_redis_client,\n+    is_post_kmod_split_build,\n     parse_feeds_conf,\n-    parse_packages_file,\n     parse_kernel_version,\n-    is_post_kmod_split_build,\n+    parse_packages_file,\n )\n \n logging.basicConfig(encoding=\"utf-8\", level=settings.log_level)"
            },
            {
                "sha": "c3c365f1220dcff3ff864748c26ed5f675cd37e4",
                "filename": "asu/util.py",
                "status": "modified",
                "additions": 4,
                "deletions": 10,
                "changes": 14,
                "blob_url": "https://github.com/openwrt/asu/blob/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/asu%2Futil.py",
                "raw_url": "https://github.com/openwrt/asu/raw/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/asu%2Futil.py",
                "contents_url": "https://api.github.com/repos/openwrt/asu/contents/asu%2Futil.py?ref=920c8a13d97b4d4095f0d939cf0aaae777e0f87e",
                "patch": "@@ -4,7 +4,7 @@\n import json\n import logging\n import struct\n-from os import getuid, getgid\n+from os import getgid, getuid\n from pathlib import Path\n from re import match\n from tarfile import TarFile\n@@ -22,9 +22,6 @@\n from asu.build_request import BuildRequest\n from asu.config import settings\n \n-\n-REQUEST_HASH_LENGTH: int = 32\n-\n log: logging.Logger = logging.getLogger(\"rq.worker\")\n log.propagate = False  # Suppress duplicate log messages.\n \n@@ -66,18 +63,16 @@ def get_branch(version_or_branch: str) -> dict[str, str]:\n     return {**settings.branches.get(branch_name, {}), \"name\": branch_name}\n \n \n-def get_str_hash(string: str, length: int = REQUEST_HASH_LENGTH) -> str:\n+def get_str_hash(string: str) -> str:\n     \"\"\"Return sha256sum of str with optional length\n \n     Args:\n         string (str): input string\n-        length (int): hash length\n \n     Returns:\n         str: hash of string with specified length\n     \"\"\"\n-    h = hashlib.sha256(bytes(string or \"\", \"utf-8\"))\n-    return h.hexdigest()[:length]\n+    return hashlib.sha256(bytes(string or \"\", \"utf-8\")).hexdigest()\n \n \n def get_file_hash(path: str) -> str:\n@@ -145,7 +140,6 @@ def get_request_hash(build_request: BuildRequest) -> str:\n                 str(build_request.repositories),\n             ]\n         ),\n-        REQUEST_HASH_LENGTH,\n     )\n \n \n@@ -161,7 +155,7 @@ def get_packages_hash(packages: list[str]) -> str:\n     Returns:\n         str: hash of `req`\n     \"\"\"\n-    return get_str_hash(\" \".join(sorted(list(set(packages)))), 12)\n+    return get_str_hash(\" \".join(sorted(list(set(packages)))))\n \n \n def fingerprint_pubkey_usign(pubkey: str) -> str:"
            },
            {
                "sha": "6a731d1f4e01bd5435f4fe2b3bdf804c96da3c5a",
                "filename": "tests/test_api.py",
                "status": "modified",
                "additions": 6,
                "deletions": 3,
                "changes": 9,
                "blob_url": "https://github.com/openwrt/asu/blob/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/tests%2Ftest_api.py",
                "raw_url": "https://github.com/openwrt/asu/raw/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/tests%2Ftest_api.py",
                "contents_url": "https://api.github.com/repos/openwrt/asu/contents/tests%2Ftest_api.py?ref=920c8a13d97b4d4095f0d939cf0aaae777e0f87e",
                "patch": "@@ -178,8 +178,8 @@ def test_api_build_request_hash(client):\n         profile=\"testprofile\",\n     )\n \n-    case12hash = \"8731372f84b0022c070e6127bad24eb2\"\n-    case34hash = \"0dab3b60bd8174da250e2ea2942a3744\"\n+    case12hash = \"8d8e0aa2fd95bb75dba4aff4279dd6f976a40ad17300927d54b8a9a9b0576306\"\n+    case34hash = \"6b1645013216da39ee09deae75b87b0636f3c50648b037750b0a80448ce5c7ca\"\n \n     # Case 1 - diff_packages=True, first package ordering\n     json[\"diff_packages\"] = True\n@@ -702,7 +702,10 @@ def test_api_build_defaults_filled_allowed(app):\n \n     assert response.status_code == 200\n     data = response.json()\n-    assert data[\"request_hash\"] == \"c9836b2259eec0c3a31868fe77a19983\"\n+    assert (\n+        data[\"request_hash\"]\n+        == \"9c8d0cd7d9ec208a233b954edb20c3c20b5c11103bb7f5f1ebface565f8c6720\"\n+    )\n \n \n def test_api_build_defaults_filled_too_big(app):"
            },
            {
                "sha": "d2126a18e1cc8b4056668a06863e336017ced682",
                "filename": "tests/test_util.py",
                "status": "modified",
                "additions": 18,
                "deletions": 7,
                "changes": 25,
                "blob_url": "https://github.com/openwrt/asu/blob/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/tests%2Ftest_util.py",
                "raw_url": "https://github.com/openwrt/asu/raw/920c8a13d97b4d4095f0d939cf0aaae777e0f87e/tests%2Ftest_util.py",
                "contents_url": "https://api.github.com/repos/openwrt/asu/contents/tests%2Ftest_util.py?ref=920c8a13d97b4d4095f0d939cf0aaae777e0f87e",
                "patch": "@@ -16,46 +16,57 @@\n     get_podman,\n     get_request_hash,\n     get_str_hash,\n+    is_post_kmod_split_build,\n     parse_feeds_conf,\n+    parse_kernel_version,\n     parse_manifest,\n     parse_packages_file,\n-    parse_kernel_version,\n-    is_post_kmod_split_build,\n     run_cmd,\n     verify_usign,\n )\n \n \n def test_get_str_hash():\n-    assert get_str_hash(\"test\", 12) == \"9f86d081884c\"\n+    assert (\n+        get_str_hash(\"test\")\n+        == \"9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08\"\n+    )\n \n \n def test_get_file_hash():\n     file_fd, file_path = tempfile.mkstemp()\n     os.write(file_fd, b\"test\")\n \n-    assert get_file_hash(file_path).startswith(\"9f86d081884c\")\n+    assert get_file_hash(file_path).startswith(\n+        \"9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08\"\n+    )\n \n     os.close(file_fd)\n     os.unlink(file_path)\n \n \n def test_get_packages_hash():\n-    assert get_packages_hash([\"test1\", \"test2\"]) == \"57aab5949a36\"\n+    assert (\n+        get_packages_hash([\"test1\", \"test2\"])\n+        == \"57aab5949a36e66b535a8cb13e39e9e093181c9000c016990d7be9eb86a9b9e8\"\n+    )\n \n \n def test_get_request_hash():\n     request = BuildRequest(\n         **{\n             \"distro\": \"test\",\n             \"version\": \"test\",\n-            \"target\": \"test\",\n+            \"target\": \"testtarget/testsubtarget\",\n             \"profile\": \"test\",\n             \"packages\": [\"test\"],\n         }\n     )\n \n-    assert get_request_hash(request) == \"3944eba49da93e2c605a7e9980e52765\"\n+    assert (\n+        get_request_hash(request)\n+        == \"99ff721439cd696f7da259541a07d7bfc7eb6c45a844db532e0384b464e23f46\"\n+    )\n \n \n def test_diff_packages():"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/open-quantum-safe/liboqs/commits/cce1bfde4e52c524b087b9687020d283fbde0f24",
        "url": "https://api.github.com/repos/open-quantum-safe/liboqs/commits/cce1bfde4e52c524b087b9687020d283fbde0f24",
        "html_url": "https://github.com/open-quantum-safe/liboqs/commit/cce1bfde4e52c524b087b9687020d283fbde0f24",
        "message": "Run copy_from_upstream.py\n\nSigned-off-by: Spencer Wilson <spencer.wilson@uwaterloo.ca>",
        "files": [
            {
                "sha": "df32ecdb2cf8427aabf7b13ddb3eaaa89ad84dfc",
                "filename": "docs/algorithms/kem/hqc.md",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/open-quantum-safe/liboqs/blob/cce1bfde4e52c524b087b9687020d283fbde0f24/docs%2Falgorithms%2Fkem%2Fhqc.md",
                "raw_url": "https://github.com/open-quantum-safe/liboqs/raw/cce1bfde4e52c524b087b9687020d283fbde0f24/docs%2Falgorithms%2Fkem%2Fhqc.md",
                "contents_url": "https://api.github.com/repos/open-quantum-safe/liboqs/contents/docs%2Falgorithms%2Fkem%2Fhqc.md?ref=cce1bfde4e52c524b087b9687020d283fbde0f24",
                "patch": "@@ -6,7 +6,7 @@\n - **Authors' website**: https://pqc-hqc.org/\n - **Specification version**: 2023-04-30.\n - **Primary Source**<a name=\"primary-source\"></a>:\n-  - **Source**: https://github.com/PQClean/PQClean/commit/8e221ae797b229858a0b0d784577a8cb149d5789\n+  - **Source**: https://github.com/PQClean/PQClean/commit/8e221ae797b229858a0b0d784577a8cb149d5789 with copy_from_upstream patches\n   - **Implementation license (SPDX-Identifier)**: Public domain\n - **Ancestors of primary source**:\n   - https://github.com/SWilson4/package-pqclean/tree/8db1b24b/hqc, which takes it from:"
            },
            {
                "sha": "a9d0bb260f028a5eac6d4d380354ed909e5966bb",
                "filename": "docs/algorithms/kem/hqc.yml",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/open-quantum-safe/liboqs/blob/cce1bfde4e52c524b087b9687020d283fbde0f24/docs%2Falgorithms%2Fkem%2Fhqc.yml",
                "raw_url": "https://github.com/open-quantum-safe/liboqs/raw/cce1bfde4e52c524b087b9687020d283fbde0f24/docs%2Falgorithms%2Fkem%2Fhqc.yml",
                "contents_url": "https://api.github.com/repos/open-quantum-safe/liboqs/contents/docs%2Falgorithms%2Fkem%2Fhqc.yml?ref=cce1bfde4e52c524b087b9687020d283fbde0f24",
                "patch": "@@ -77,3 +77,4 @@ parameter-sets:\n primary-upstream:\n   spdx-license-identifier: Public domain\n   source: https://github.com/PQClean/PQClean/commit/8e221ae797b229858a0b0d784577a8cb149d5789\n+    with copy_from_upstream patches"
            },
            {
                "sha": "c722a7578c9bff63678adbff3bb5aadb221eae30",
                "filename": "src/kem/hqc/pqclean_hqc-128_clean/kem.c",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/open-quantum-safe/liboqs/blob/cce1bfde4e52c524b087b9687020d283fbde0f24/src%2Fkem%2Fhqc%2Fpqclean_hqc-128_clean%2Fkem.c",
                "raw_url": "https://github.com/open-quantum-safe/liboqs/raw/cce1bfde4e52c524b087b9687020d283fbde0f24/src%2Fkem%2Fhqc%2Fpqclean_hqc-128_clean%2Fkem.c",
                "contents_url": "https://api.github.com/repos/open-quantum-safe/liboqs/contents/src%2Fkem%2Fhqc%2Fpqclean_hqc-128_clean%2Fkem.c?ref=cce1bfde4e52c524b087b9687020d283fbde0f24",
                "patch": "@@ -87,7 +87,7 @@ int PQCLEAN_HQC128_CLEAN_crypto_kem_dec(uint8_t *ss, const uint8_t *ct, const ui\n     uint8_t result;\n     uint64_t u[VEC_N_SIZE_64] = {0};\n     uint64_t v[VEC_N1N2_SIZE_64] = {0};\n-    const uint8_t *pk = sk + SEED_BYTES;\n+    const uint8_t *pk = sk + SEED_BYTES + VEC_K_SIZE_BYTES;\n     uint8_t sigma[VEC_K_SIZE_BYTES] = {0};\n     uint8_t theta[SHAKE256_512_BYTES] = {0};\n     uint64_t u2[VEC_N_SIZE_64] = {0};\n@@ -115,7 +115,7 @@ int PQCLEAN_HQC128_CLEAN_crypto_kem_dec(uint8_t *ss, const uint8_t *ct, const ui\n     result |= PQCLEAN_HQC128_CLEAN_vect_compare((uint8_t *)u, (uint8_t *)u2, VEC_N_SIZE_BYTES);\n     result |= PQCLEAN_HQC128_CLEAN_vect_compare((uint8_t *)v, (uint8_t *)v2, VEC_N1N2_SIZE_BYTES);\n \n-    result = (uint8_t) (-((int16_t) result) >> 15);\n+    result -= 1;\n \n     for (size_t i = 0; i < VEC_K_SIZE_BYTES; ++i) {\n         mc[i] = (m[i] & result) ^ (sigma[i] & ~result);\n@@ -126,5 +126,5 @@ int PQCLEAN_HQC128_CLEAN_crypto_kem_dec(uint8_t *ss, const uint8_t *ct, const ui\n     PQCLEAN_HQC128_CLEAN_store8_arr(mc + VEC_K_SIZE_BYTES + VEC_N_SIZE_BYTES, VEC_N1N2_SIZE_BYTES, v, VEC_N1N2_SIZE_64);\n     PQCLEAN_HQC128_CLEAN_shake256_512_ds(&shake256state, ss, mc, VEC_K_SIZE_BYTES + VEC_N_SIZE_BYTES + VEC_N1N2_SIZE_BYTES, K_FCT_DOMAIN);\n \n-    return -(~result & 1);\n+    return (result & 1) - 1;\n }"
            },
            {
                "sha": "95a0023d9ad1a652412a49c5d3d4cf88cf33a5b7",
                "filename": "src/kem/hqc/pqclean_hqc-192_clean/kem.c",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/open-quantum-safe/liboqs/blob/cce1bfde4e52c524b087b9687020d283fbde0f24/src%2Fkem%2Fhqc%2Fpqclean_hqc-192_clean%2Fkem.c",
                "raw_url": "https://github.com/open-quantum-safe/liboqs/raw/cce1bfde4e52c524b087b9687020d283fbde0f24/src%2Fkem%2Fhqc%2Fpqclean_hqc-192_clean%2Fkem.c",
                "contents_url": "https://api.github.com/repos/open-quantum-safe/liboqs/contents/src%2Fkem%2Fhqc%2Fpqclean_hqc-192_clean%2Fkem.c?ref=cce1bfde4e52c524b087b9687020d283fbde0f24",
                "patch": "@@ -87,7 +87,7 @@ int PQCLEAN_HQC192_CLEAN_crypto_kem_dec(uint8_t *ss, const uint8_t *ct, const ui\n     uint8_t result;\n     uint64_t u[VEC_N_SIZE_64] = {0};\n     uint64_t v[VEC_N1N2_SIZE_64] = {0};\n-    const uint8_t *pk = sk + SEED_BYTES;\n+    const uint8_t *pk = sk + SEED_BYTES + VEC_K_SIZE_BYTES;\n     uint8_t sigma[VEC_K_SIZE_BYTES] = {0};\n     uint8_t theta[SHAKE256_512_BYTES] = {0};\n     uint64_t u2[VEC_N_SIZE_64] = {0};\n@@ -115,7 +115,7 @@ int PQCLEAN_HQC192_CLEAN_crypto_kem_dec(uint8_t *ss, const uint8_t *ct, const ui\n     result |= PQCLEAN_HQC192_CLEAN_vect_compare((uint8_t *)u, (uint8_t *)u2, VEC_N_SIZE_BYTES);\n     result |= PQCLEAN_HQC192_CLEAN_vect_compare((uint8_t *)v, (uint8_t *)v2, VEC_N1N2_SIZE_BYTES);\n \n-    result = (uint8_t) (-((int16_t) result) >> 15);\n+    result -= 1;\n \n     for (size_t i = 0; i < VEC_K_SIZE_BYTES; ++i) {\n         mc[i] = (m[i] & result) ^ (sigma[i] & ~result);\n@@ -126,5 +126,5 @@ int PQCLEAN_HQC192_CLEAN_crypto_kem_dec(uint8_t *ss, const uint8_t *ct, const ui\n     PQCLEAN_HQC192_CLEAN_store8_arr(mc + VEC_K_SIZE_BYTES + VEC_N_SIZE_BYTES, VEC_N1N2_SIZE_BYTES, v, VEC_N1N2_SIZE_64);\n     PQCLEAN_HQC192_CLEAN_shake256_512_ds(&shake256state, ss, mc, VEC_K_SIZE_BYTES + VEC_N_SIZE_BYTES + VEC_N1N2_SIZE_BYTES, K_FCT_DOMAIN);\n \n-    return -(~result & 1);\n+    return (result & 1) - 1;\n }"
            },
            {
                "sha": "d4c6a08fa656112a641888ddc0eef2ec7589db4a",
                "filename": "src/kem/hqc/pqclean_hqc-256_clean/kem.c",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/open-quantum-safe/liboqs/blob/cce1bfde4e52c524b087b9687020d283fbde0f24/src%2Fkem%2Fhqc%2Fpqclean_hqc-256_clean%2Fkem.c",
                "raw_url": "https://github.com/open-quantum-safe/liboqs/raw/cce1bfde4e52c524b087b9687020d283fbde0f24/src%2Fkem%2Fhqc%2Fpqclean_hqc-256_clean%2Fkem.c",
                "contents_url": "https://api.github.com/repos/open-quantum-safe/liboqs/contents/src%2Fkem%2Fhqc%2Fpqclean_hqc-256_clean%2Fkem.c?ref=cce1bfde4e52c524b087b9687020d283fbde0f24",
                "patch": "@@ -87,7 +87,7 @@ int PQCLEAN_HQC256_CLEAN_crypto_kem_dec(uint8_t *ss, const uint8_t *ct, const ui\n     uint8_t result;\n     uint64_t u[VEC_N_SIZE_64] = {0};\n     uint64_t v[VEC_N1N2_SIZE_64] = {0};\n-    const uint8_t *pk = sk + SEED_BYTES;\n+    const uint8_t *pk = sk + SEED_BYTES + VEC_K_SIZE_BYTES;\n     uint8_t sigma[VEC_K_SIZE_BYTES] = {0};\n     uint8_t theta[SHAKE256_512_BYTES] = {0};\n     uint64_t u2[VEC_N_SIZE_64] = {0};\n@@ -115,7 +115,7 @@ int PQCLEAN_HQC256_CLEAN_crypto_kem_dec(uint8_t *ss, const uint8_t *ct, const ui\n     result |= PQCLEAN_HQC256_CLEAN_vect_compare((uint8_t *)u, (uint8_t *)u2, VEC_N_SIZE_BYTES);\n     result |= PQCLEAN_HQC256_CLEAN_vect_compare((uint8_t *)v, (uint8_t *)v2, VEC_N1N2_SIZE_BYTES);\n \n-    result = (uint8_t) (-((int16_t) result) >> 15);\n+    result -= 1;\n \n     for (size_t i = 0; i < VEC_K_SIZE_BYTES; ++i) {\n         mc[i] = (m[i] & result) ^ (sigma[i] & ~result);\n@@ -126,5 +126,5 @@ int PQCLEAN_HQC256_CLEAN_crypto_kem_dec(uint8_t *ss, const uint8_t *ct, const ui\n     PQCLEAN_HQC256_CLEAN_store8_arr(mc + VEC_K_SIZE_BYTES + VEC_N_SIZE_BYTES, VEC_N1N2_SIZE_BYTES, v, VEC_N1N2_SIZE_64);\n     PQCLEAN_HQC256_CLEAN_shake256_512_ds(&shake256state, ss, mc, VEC_K_SIZE_BYTES + VEC_N_SIZE_BYTES + VEC_N1N2_SIZE_BYTES, K_FCT_DOMAIN);\n \n-    return -(~result & 1);\n+    return (result & 1) - 1;\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/e991ac8f2037d78140e417cc9a9486223eb3e786",
        "url": "https://api.github.com/repos/python/cpython/commits/e991ac8f2037d78140e417cc9a9486223eb3e786",
        "html_url": "https://github.com/python/cpython/commit/e991ac8f2037d78140e417cc9a9486223eb3e786",
        "message": "gh-127655: Ensure `_SelectorSocketTransport.writelines` pauses the protocol if needed (#127656)\n\nEnsure `_SelectorSocketTransport.writelines` pauses the protocol if it reaches the high water mark as needed. \n\nCo-authored-by: Kumar Aditya <kumaraditya@python.org>",
        "files": [
            {
                "sha": "f1ab9b12d69a5d8037f1a3ba9856f6141a491f67",
                "filename": "Lib/asyncio/selector_events.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/python/cpython/blob/e991ac8f2037d78140e417cc9a9486223eb3e786/Lib%2Fasyncio%2Fselector_events.py",
                "raw_url": "https://github.com/python/cpython/raw/e991ac8f2037d78140e417cc9a9486223eb3e786/Lib%2Fasyncio%2Fselector_events.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Fasyncio%2Fselector_events.py?ref=e991ac8f2037d78140e417cc9a9486223eb3e786",
                "patch": "@@ -1175,6 +1175,7 @@ def writelines(self, list_of_data):\n         # If the entire buffer couldn't be written, register a write handler\n         if self._buffer:\n             self._loop._add_writer(self._sock_fd, self._write_ready)\n+            self._maybe_pause_protocol()\n \n     def can_write_eof(self):\n         return True"
            },
            {
                "sha": "efca30f37414f95db3cd7fc271d67f48058bfb19",
                "filename": "Lib/test/test_asyncio/test_selector_events.py",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/python/cpython/blob/e991ac8f2037d78140e417cc9a9486223eb3e786/Lib%2Ftest%2Ftest_asyncio%2Ftest_selector_events.py",
                "raw_url": "https://github.com/python/cpython/raw/e991ac8f2037d78140e417cc9a9486223eb3e786/Lib%2Ftest%2Ftest_asyncio%2Ftest_selector_events.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_asyncio%2Ftest_selector_events.py?ref=e991ac8f2037d78140e417cc9a9486223eb3e786",
                "patch": "@@ -805,6 +805,18 @@ def test_writelines_send_partial(self):\n         self.assertTrue(self.sock.send.called)\n         self.assertTrue(self.loop.writers)\n \n+    def test_writelines_pauses_protocol(self):\n+        data = memoryview(b'data')\n+        self.sock.send.return_value = 2\n+        self.sock.send.fileno.return_value = 7\n+\n+        transport = self.socket_transport()\n+        transport._high_water = 1\n+        transport.writelines([data])\n+        self.assertTrue(self.protocol.pause_writing.called)\n+        self.assertTrue(self.sock.send.called)\n+        self.assertTrue(self.loop.writers)\n+\n     @unittest.skipUnless(selector_events._HAS_SENDMSG, 'no sendmsg')\n     def test_write_sendmsg_full(self):\n         data = memoryview(b'data')"
            },
            {
                "sha": "76cfc58121d3bd634284f6f7f84b8fe21e41c149",
                "filename": "Misc/NEWS.d/next/Security/2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/python/cpython/blob/e991ac8f2037d78140e417cc9a9486223eb3e786/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst",
                "raw_url": "https://github.com/python/cpython/raw/e991ac8f2037d78140e417cc9a9486223eb3e786/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst?ref=e991ac8f2037d78140e417cc9a9486223eb3e786",
                "patch": "@@ -0,0 +1 @@\n+Fixed the :class:`!asyncio.selector_events._SelectorSocketTransport` transport not pausing writes for the protocol when the buffer reaches the high water mark when using :meth:`asyncio.WriteTransport.writelines`."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/71e8429ac8e2adc10084ab5ec29a62f4b6671a82",
        "url": "https://api.github.com/repos/python/cpython/commits/71e8429ac8e2adc10084ab5ec29a62f4b6671a82",
        "html_url": "https://github.com/python/cpython/commit/71e8429ac8e2adc10084ab5ec29a62f4b6671a82",
        "message": "[3.13] gh-127655: Ensure `_SelectorSocketTransport.writelines` pauses the protocol if needed (GH-127656) (#127663)\n\ngh-127655: Ensure `_SelectorSocketTransport.writelines` pauses the protocol if needed (GH-127656)\n\nEnsure `_SelectorSocketTransport.writelines` pauses the protocol if it reaches the high water mark as needed.\n(cherry picked from commit e991ac8f2037d78140e417cc9a9486223eb3e786)\n\nCo-authored-by: J. Nick Koston <nick@koston.org>\nCo-authored-by: Kumar Aditya <kumaraditya@python.org>",
        "files": [
            {
                "sha": "f1ab9b12d69a5d8037f1a3ba9856f6141a491f67",
                "filename": "Lib/asyncio/selector_events.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/python/cpython/blob/71e8429ac8e2adc10084ab5ec29a62f4b6671a82/Lib%2Fasyncio%2Fselector_events.py",
                "raw_url": "https://github.com/python/cpython/raw/71e8429ac8e2adc10084ab5ec29a62f4b6671a82/Lib%2Fasyncio%2Fselector_events.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Fasyncio%2Fselector_events.py?ref=71e8429ac8e2adc10084ab5ec29a62f4b6671a82",
                "patch": "@@ -1175,6 +1175,7 @@ def writelines(self, list_of_data):\n         # If the entire buffer couldn't be written, register a write handler\n         if self._buffer:\n             self._loop._add_writer(self._sock_fd, self._write_ready)\n+            self._maybe_pause_protocol()\n \n     def can_write_eof(self):\n         return True"
            },
            {
                "sha": "efca30f37414f95db3cd7fc271d67f48058bfb19",
                "filename": "Lib/test/test_asyncio/test_selector_events.py",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/python/cpython/blob/71e8429ac8e2adc10084ab5ec29a62f4b6671a82/Lib%2Ftest%2Ftest_asyncio%2Ftest_selector_events.py",
                "raw_url": "https://github.com/python/cpython/raw/71e8429ac8e2adc10084ab5ec29a62f4b6671a82/Lib%2Ftest%2Ftest_asyncio%2Ftest_selector_events.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_asyncio%2Ftest_selector_events.py?ref=71e8429ac8e2adc10084ab5ec29a62f4b6671a82",
                "patch": "@@ -805,6 +805,18 @@ def test_writelines_send_partial(self):\n         self.assertTrue(self.sock.send.called)\n         self.assertTrue(self.loop.writers)\n \n+    def test_writelines_pauses_protocol(self):\n+        data = memoryview(b'data')\n+        self.sock.send.return_value = 2\n+        self.sock.send.fileno.return_value = 7\n+\n+        transport = self.socket_transport()\n+        transport._high_water = 1\n+        transport.writelines([data])\n+        self.assertTrue(self.protocol.pause_writing.called)\n+        self.assertTrue(self.sock.send.called)\n+        self.assertTrue(self.loop.writers)\n+\n     @unittest.skipUnless(selector_events._HAS_SENDMSG, 'no sendmsg')\n     def test_write_sendmsg_full(self):\n         data = memoryview(b'data')"
            },
            {
                "sha": "76cfc58121d3bd634284f6f7f84b8fe21e41c149",
                "filename": "Misc/NEWS.d/next/Security/2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/python/cpython/blob/71e8429ac8e2adc10084ab5ec29a62f4b6671a82/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst",
                "raw_url": "https://github.com/python/cpython/raw/71e8429ac8e2adc10084ab5ec29a62f4b6671a82/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst?ref=71e8429ac8e2adc10084ab5ec29a62f4b6671a82",
                "patch": "@@ -0,0 +1 @@\n+Fixed the :class:`!asyncio.selector_events._SelectorSocketTransport` transport not pausing writes for the protocol when the buffer reaches the high water mark when using :meth:`asyncio.WriteTransport.writelines`."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/9aa0deb2eef2655a1029ba228527b152353135b5",
        "url": "https://api.github.com/repos/python/cpython/commits/9aa0deb2eef2655a1029ba228527b152353135b5",
        "html_url": "https://github.com/python/cpython/commit/9aa0deb2eef2655a1029ba228527b152353135b5",
        "message": "[3.12] gh-127655: Ensure `_SelectorSocketTransport.writelines` pauses the protocol if needed (GH-127656) (#127664)\n\ngh-127655: Ensure `_SelectorSocketTransport.writelines` pauses the protocol if needed (GH-127656)\n\nEnsure `_SelectorSocketTransport.writelines` pauses the protocol if it reaches the high water mark as needed.\n(cherry picked from commit e991ac8f2037d78140e417cc9a9486223eb3e786)\n\nCo-authored-by: J. Nick Koston <nick@koston.org>\nCo-authored-by: Kumar Aditya <kumaraditya@python.org>",
        "files": [
            {
                "sha": "dd79ad18df3b18a8fc8af40ca642dd5387ac3ec2",
                "filename": "Lib/asyncio/selector_events.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/python/cpython/blob/9aa0deb2eef2655a1029ba228527b152353135b5/Lib%2Fasyncio%2Fselector_events.py",
                "raw_url": "https://github.com/python/cpython/raw/9aa0deb2eef2655a1029ba228527b152353135b5/Lib%2Fasyncio%2Fselector_events.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Fasyncio%2Fselector_events.py?ref=9aa0deb2eef2655a1029ba228527b152353135b5",
                "patch": "@@ -1183,6 +1183,7 @@ def writelines(self, list_of_data):\n         # If the entire buffer couldn't be written, register a write handler\n         if self._buffer:\n             self._loop._add_writer(self._sock_fd, self._write_ready)\n+            self._maybe_pause_protocol()\n \n     def can_write_eof(self):\n         return True"
            },
            {
                "sha": "736c19796ef3fc7f33bd2d5cf0ed59805bb09903",
                "filename": "Lib/test/test_asyncio/test_selector_events.py",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/python/cpython/blob/9aa0deb2eef2655a1029ba228527b152353135b5/Lib%2Ftest%2Ftest_asyncio%2Ftest_selector_events.py",
                "raw_url": "https://github.com/python/cpython/raw/9aa0deb2eef2655a1029ba228527b152353135b5/Lib%2Ftest%2Ftest_asyncio%2Ftest_selector_events.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_asyncio%2Ftest_selector_events.py?ref=9aa0deb2eef2655a1029ba228527b152353135b5",
                "patch": "@@ -805,6 +805,18 @@ def test_writelines_send_partial(self):\n         self.assertTrue(self.sock.send.called)\n         self.assertTrue(self.loop.writers)\n \n+    def test_writelines_pauses_protocol(self):\n+        data = memoryview(b'data')\n+        self.sock.send.return_value = 2\n+        self.sock.send.fileno.return_value = 7\n+\n+        transport = self.socket_transport()\n+        transport._high_water = 1\n+        transport.writelines([data])\n+        self.assertTrue(self.protocol.pause_writing.called)\n+        self.assertTrue(self.sock.send.called)\n+        self.assertTrue(self.loop.writers)\n+\n     @unittest.skipUnless(selector_events._HAS_SENDMSG, 'no sendmsg')\n     def test_write_sendmsg_full(self):\n         data = memoryview(b'data')"
            },
            {
                "sha": "76cfc58121d3bd634284f6f7f84b8fe21e41c149",
                "filename": "Misc/NEWS.d/next/Security/2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/python/cpython/blob/9aa0deb2eef2655a1029ba228527b152353135b5/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst",
                "raw_url": "https://github.com/python/cpython/raw/9aa0deb2eef2655a1029ba228527b152353135b5/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FSecurity%2F2024-12-05-21-35-19.gh-issue-127655.xpPoOf.rst?ref=9aa0deb2eef2655a1029ba228527b152353135b5",
                "patch": "@@ -0,0 +1 @@\n+Fixed the :class:`!asyncio.selector_events._SelectorSocketTransport` transport not pausing writes for the protocol when the buffer reaches the high water mark when using :meth:`asyncio.WriteTransport.writelines`."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/commits/76a829c088f0813ab3244a3bd0036111017409b0",
        "url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/commits/76a829c088f0813ab3244a3bd0036111017409b0",
        "html_url": "https://github.com/MacWarrior/clipbucket-v5/commit/76a829c088f0813ab3244a3bd0036111017409b0",
        "message": "Front office : Fix upload security issue (Thanks @0xbko)",
        "files": [
            {
                "sha": "24afc8fde349013371bb8b0f19e0534f6cf53e95",
                "filename": "upload/changelog/551.json",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fchangelog%2F551.json",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fchangelog%2F551.json",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fchangelog%2F551.json?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -1,6 +1,6 @@\n {\n   \"version\":\"5.5.1\",\n-  \"revision\":\"199\",\n+  \"revision\":\"200\",\n   \"status\":\"dev\",\n   \"detail\":[\n     {\n@@ -193,6 +193,7 @@\n         ,\"Fix signup wrong date format\"\n         ,\"Fix featured video filter\"\n         ,\"Fix search results pagination\"\n+        ,\"Fix upload security issue (Thanks @0xbko)\"\n       ]\n     },\n     {"
            },
            {
                "sha": "deac45f7c5f998367bd0080b4cb4344fc888ba2e",
                "filename": "upload/includes/classes/photos.class.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fincludes%2Fclasses%2Fphotos.class.php",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fincludes%2Fclasses%2Fphotos.class.php",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fincludes%2Fclasses%2Fphotos.class.php?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -2906,9 +2906,9 @@ function photo_embed_codes($newArr)\n      *\r\n      * @return string\r\n      */\r\n-    function encode_key($key)\r\n+    function encode_key($key): string\r\n     {\r\n-        return base64_encode(serialize($key));\r\n+        return base64_encode(json_encode($key));\r\n     }\r\n \r\n     /**\r\n@@ -2920,7 +2920,7 @@ function encode_key($key)\n      */\r\n     function decode_key($key)\r\n     {\r\n-        return unserialize(base64_decode($key));\r\n+        return json_decode(base64_decode($key));\r\n     }\r\n \r\n     /**\r"
            },
            {
                "sha": "1a43442a301e94b447c7be6303137f2ebfe98113",
                "filename": "upload/includes/classes/rediscache.class.php",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fincludes%2Fclasses%2Frediscache.class.php",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fincludes%2Fclasses%2Frediscache.class.php",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fincludes%2Fclasses%2Frediscache.class.php?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -105,7 +105,6 @@ public function isEnabled(): bool\n         return $this->isEnabled;\n     }\n \n-\n     private static function redislize($data): string\n     {\n         // Only serialize if it's not a string or a integer"
            },
            {
                "sha": "f853ba13ba209585ee305504c2b28ad2cec7fb08",
                "filename": "upload/upload.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fupload.php",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fupload.php",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fupload.php?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -8,7 +8,7 @@\n subtitle('upload');\r\n \r\n if (isset($_GET['collection'])) {\r\n-    $selected_collection = unserialize(base64_decode($_GET['collection']));\r\n+    $selected_collection = json_decode(base64_decode($_GET['collection']));\r\n     assign('selected_collection', Collection::getInstance()->getOne(['collection_id'=>$selected_collection]));\r\n }\r\n \r"
            },
            {
                "sha": "73069e1e166392a2119f99a7271f456200d8033a",
                "filename": "upload/view_collection.php",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fview_collection.php",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fview_collection.php",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fview_collection.php?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -78,14 +78,14 @@\n         subtitle($cdetails['collection_name']);\r\n         if ($cdetails['type'] == 'photos') {\r\n             if (SEO == 'yes') {\r\n-                $link = '/photo_upload/' . base64_encode(serialize($cdetails['collection_id']));\r\n+                $link = '/photo_upload/' . base64_encode(json_encode($cdetails['collection_id']));\r\n             }\r\n-            $link = '/photo_upload.php?collection=' . base64_encode(serialize($cdetails['collection_id']));\r\n+            $link = '/photo_upload.php?collection=' . base64_encode(json_encode($cdetails['collection_id']));\r\n         } elseif ($cdetails['type'] == 'videos') {\r\n             if (SEO == 'yes') {\r\n-                $link = '/upload/' . base64_encode(serialize($cdetails['collection_id']));\r\n+                $link = '/upload/' . base64_encode(json_encode($cdetails['collection_id']));\r\n             }\r\n-            $link = '/upload.php?collection=' . base64_encode(serialize($cdetails['collection_id']));\r\n+            $link = '/upload.php?collection=' . base64_encode(json_encode($cdetails['collection_id']));\r\n         }\r\n         assign('link_add_more',  $link);\r\n     }\r"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/commits/76a829c088f0813ab3244a3bd0036111017409b0",
        "url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/commits/76a829c088f0813ab3244a3bd0036111017409b0",
        "html_url": "https://github.com/MacWarrior/clipbucket-v5/commit/76a829c088f0813ab3244a3bd0036111017409b0",
        "message": "Front office : Fix upload security issue (Thanks @0xbko)",
        "files": [
            {
                "sha": "24afc8fde349013371bb8b0f19e0534f6cf53e95",
                "filename": "upload/changelog/551.json",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fchangelog%2F551.json",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fchangelog%2F551.json",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fchangelog%2F551.json?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -1,6 +1,6 @@\n {\n   \"version\":\"5.5.1\",\n-  \"revision\":\"199\",\n+  \"revision\":\"200\",\n   \"status\":\"dev\",\n   \"detail\":[\n     {\n@@ -193,6 +193,7 @@\n         ,\"Fix signup wrong date format\"\n         ,\"Fix featured video filter\"\n         ,\"Fix search results pagination\"\n+        ,\"Fix upload security issue (Thanks @0xbko)\"\n       ]\n     },\n     {"
            },
            {
                "sha": "deac45f7c5f998367bd0080b4cb4344fc888ba2e",
                "filename": "upload/includes/classes/photos.class.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fincludes%2Fclasses%2Fphotos.class.php",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fincludes%2Fclasses%2Fphotos.class.php",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fincludes%2Fclasses%2Fphotos.class.php?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -2906,9 +2906,9 @@ function photo_embed_codes($newArr)\n      *\r\n      * @return string\r\n      */\r\n-    function encode_key($key)\r\n+    function encode_key($key): string\r\n     {\r\n-        return base64_encode(serialize($key));\r\n+        return base64_encode(json_encode($key));\r\n     }\r\n \r\n     /**\r\n@@ -2920,7 +2920,7 @@ function encode_key($key)\n      */\r\n     function decode_key($key)\r\n     {\r\n-        return unserialize(base64_decode($key));\r\n+        return json_decode(base64_decode($key));\r\n     }\r\n \r\n     /**\r"
            },
            {
                "sha": "1a43442a301e94b447c7be6303137f2ebfe98113",
                "filename": "upload/includes/classes/rediscache.class.php",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fincludes%2Fclasses%2Frediscache.class.php",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fincludes%2Fclasses%2Frediscache.class.php",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fincludes%2Fclasses%2Frediscache.class.php?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -105,7 +105,6 @@ public function isEnabled(): bool\n         return $this->isEnabled;\n     }\n \n-\n     private static function redislize($data): string\n     {\n         // Only serialize if it's not a string or a integer"
            },
            {
                "sha": "f853ba13ba209585ee305504c2b28ad2cec7fb08",
                "filename": "upload/upload.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fupload.php",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fupload.php",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fupload.php?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -8,7 +8,7 @@\n subtitle('upload');\r\n \r\n if (isset($_GET['collection'])) {\r\n-    $selected_collection = unserialize(base64_decode($_GET['collection']));\r\n+    $selected_collection = json_decode(base64_decode($_GET['collection']));\r\n     assign('selected_collection', Collection::getInstance()->getOne(['collection_id'=>$selected_collection]));\r\n }\r\n \r"
            },
            {
                "sha": "73069e1e166392a2119f99a7271f456200d8033a",
                "filename": "upload/view_collection.php",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/MacWarrior/clipbucket-v5/blob/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fview_collection.php",
                "raw_url": "https://github.com/MacWarrior/clipbucket-v5/raw/76a829c088f0813ab3244a3bd0036111017409b0/upload%2Fview_collection.php",
                "contents_url": "https://api.github.com/repos/MacWarrior/clipbucket-v5/contents/upload%2Fview_collection.php?ref=76a829c088f0813ab3244a3bd0036111017409b0",
                "patch": "@@ -78,14 +78,14 @@\n         subtitle($cdetails['collection_name']);\r\n         if ($cdetails['type'] == 'photos') {\r\n             if (SEO == 'yes') {\r\n-                $link = '/photo_upload/' . base64_encode(serialize($cdetails['collection_id']));\r\n+                $link = '/photo_upload/' . base64_encode(json_encode($cdetails['collection_id']));\r\n             }\r\n-            $link = '/photo_upload.php?collection=' . base64_encode(serialize($cdetails['collection_id']));\r\n+            $link = '/photo_upload.php?collection=' . base64_encode(json_encode($cdetails['collection_id']));\r\n         } elseif ($cdetails['type'] == 'videos') {\r\n             if (SEO == 'yes') {\r\n-                $link = '/upload/' . base64_encode(serialize($cdetails['collection_id']));\r\n+                $link = '/upload/' . base64_encode(json_encode($cdetails['collection_id']));\r\n             }\r\n-            $link = '/upload.php?collection=' . base64_encode(serialize($cdetails['collection_id']));\r\n+            $link = '/upload.php?collection=' . base64_encode(json_encode($cdetails['collection_id']));\r\n         }\r\n         assign('link_add_more',  $link);\r\n     }\r"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/thorsten/phpMyFAQ/commits/b9289a0b2233df864361c131cd177b6715fbb0fe",
        "url": "https://api.github.com/repos/thorsten/phpMyFAQ/commits/b9289a0b2233df864361c131cd177b6715fbb0fe",
        "html_url": "https://github.com/thorsten/phpMyFAQ/commit/b9289a0b2233df864361c131cd177b6715fbb0fe",
        "message": "fix: added SensitiveParameter attribute for database usernames and passwords",
        "files": [
            {
                "sha": "2b0157c8ca4b105434fdd1ee5c2ae70df6a47ced",
                "filename": "phpmyfaq/src/phpMyFAQ/Database/Mysqli.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/thorsten/phpMyFAQ/blob/b9289a0b2233df864361c131cd177b6715fbb0fe/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FMysqli.php",
                "raw_url": "https://github.com/thorsten/phpMyFAQ/raw/b9289a0b2233df864361c131cd177b6715fbb0fe/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FMysqli.php",
                "contents_url": "https://api.github.com/repos/thorsten/phpMyFAQ/contents/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FMysqli.php?ref=b9289a0b2233df864361c131cd177b6715fbb0fe",
                "patch": "@@ -62,7 +62,7 @@ class Mysqli implements DatabaseDriver\n      */\n     public function connect(\n         string $host,\n-        string $user,\n+        #[\\SensitiveParameter] string $user,\n         #[SensitiveParameter] string $password,\n         string $database = '',\n         int|null $port = null"
            },
            {
                "sha": "3d809a3d072cd2eaa2c5f29c275acf5136384919",
                "filename": "phpmyfaq/src/phpMyFAQ/Database/Pgsql.php",
                "status": "modified",
                "additions": 14,
                "deletions": 6,
                "changes": 20,
                "blob_url": "https://github.com/thorsten/phpMyFAQ/blob/b9289a0b2233df864361c131cd177b6715fbb0fe/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FPgsql.php",
                "raw_url": "https://github.com/thorsten/phpMyFAQ/raw/b9289a0b2233df864361c131cd177b6715fbb0fe/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FPgsql.php",
                "contents_url": "https://api.github.com/repos/thorsten/phpMyFAQ/contents/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FPgsql.php?ref=b9289a0b2233df864361c131cd177b6715fbb0fe",
                "patch": "@@ -48,7 +48,7 @@ class Pgsql implements DatabaseDriver\n     /**\n      * The connection resource.\n      */\n-    private Connection|null $conn = null;\n+    private Connection|bool $conn = false;\n \n     /**\n      * Connects to the database.\n@@ -61,8 +61,8 @@ class Pgsql implements DatabaseDriver\n      */\n     public function connect(\n         string $host,\n-        string $user,\n-        string $password,\n+        #[\\SensitiveParameter] string $user,\n+        #[\\SensitiveParameter] string $password,\n         string $database = '',\n         int|null $port = null\n     ): ?bool {\n@@ -75,10 +75,18 @@ public function connect(\n             $password\n         );\n \n-        $this->conn = pg_connect($connectionString);\n+        try {\n+            $this->conn = pg_connect($connectionString);\n \n-        if ($database === '' || !$this->conn) {\n-            Database::errorPage(pg_last_error($this->conn));\n+            if ($this->conn === false) {\n+                throw new Exception('No PostgreSQL connection opened yet');\n+            }\n+\n+            if ($database === '') {\n+                throw new Exception('Database name is empty');\n+            }\n+        } catch (Exception $e) {\n+            Database::errorPage($e->getMessage());\n             die();\n         }\n "
            },
            {
                "sha": "d4903e33fdd6565b332bda123a891aaee70e5758",
                "filename": "phpmyfaq/src/phpMyFAQ/Database/Sqlite3.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/thorsten/phpMyFAQ/blob/b9289a0b2233df864361c131cd177b6715fbb0fe/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FSqlite3.php",
                "raw_url": "https://github.com/thorsten/phpMyFAQ/raw/b9289a0b2233df864361c131cd177b6715fbb0fe/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FSqlite3.php",
                "contents_url": "https://api.github.com/repos/thorsten/phpMyFAQ/contents/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FSqlite3.php?ref=b9289a0b2233df864361c131cd177b6715fbb0fe",
                "patch": "@@ -65,7 +65,7 @@ class Sqlite3 implements DatabaseDriver\n     public function connect(\n         string $host,\n         string $user,\n-        string $password,\n+        #[\\SensitiveParameter] string $password,\n         string $database = '',\n         int|null $port = null\n     ): ?bool {"
            },
            {
                "sha": "f2bcda424ed2a0f9d36b43437b11fabb93be71cc",
                "filename": "phpmyfaq/src/phpMyFAQ/Database/Sqlsrv.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/thorsten/phpMyFAQ/blob/b9289a0b2233df864361c131cd177b6715fbb0fe/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FSqlsrv.php",
                "raw_url": "https://github.com/thorsten/phpMyFAQ/raw/b9289a0b2233df864361c131cd177b6715fbb0fe/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FSqlsrv.php",
                "contents_url": "https://api.github.com/repos/thorsten/phpMyFAQ/contents/phpmyfaq%2Fsrc%2FphpMyFAQ%2FDatabase%2FSqlsrv.php?ref=b9289a0b2233df864361c131cd177b6715fbb0fe",
                "patch": "@@ -57,8 +57,8 @@ class Sqlsrv implements DatabaseDriver\n      */\n     public function connect(\n         string $host,\n-        string $user,\n-        string $password,\n+        #[\\SensitiveParameter] string $user,\n+        #[\\SensitiveParameter] string $password,\n         string $database = '',\n         int|null $port = null\n     ): ?bool {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/canonical/lxd/commits/92468bb60f4f1edf38ff0434414bea4f28afa711",
        "url": "https://api.github.com/repos/canonical/lxd/commits/92468bb60f4f1edf38ff0434414bea4f28afa711",
        "html_url": "https://github.com/canonical/lxd/commit/92468bb60f4f1edf38ff0434414bea4f28afa711",
        "message": "lxd: Update `allowProjectResourceList` to use new auth utils.\n\nSigned-off-by: Mark Laing <mark.laing@canonical.com>",
        "files": [
            {
                "sha": "5d62a22d786b5b9d68405d59166494c054fcbb8f",
                "filename": "lxd/daemon.go",
                "status": "modified",
                "additions": 12,
                "deletions": 32,
                "changes": 44,
                "blob_url": "https://github.com/canonical/lxd/blob/92468bb60f4f1edf38ff0434414bea4f28afa711/lxd%2Fdaemon.go",
                "raw_url": "https://github.com/canonical/lxd/raw/92468bb60f4f1edf38ff0434414bea4f28afa711/lxd%2Fdaemon.go",
                "contents_url": "https://api.github.com/repos/canonical/lxd/contents/lxd%2Fdaemon.go?ref=92468bb60f4f1edf38ff0434414bea4f28afa711",
                "patch": "@@ -310,52 +310,32 @@ func allowProjectResourceList(d *Daemon, r *http.Request) response.Response {\n \t\treturn response.Forbidden(nil)\n \t}\n \n-\tisRoot, err := auth.IsRootUserFromCtx(r.Context())\n+\tisServerAdmin, err := auth.IsServerAdmin(r.Context(), d.identityCache)\n \tif err != nil {\n \t\treturn response.InternalError(fmt.Errorf(\"Failed to determine caller privilege: %w\", err))\n \t}\n \n \t// A root user can list resources in any project.\n-\tif isRoot {\n+\tif isServerAdmin {\n \t\treturn response.EmptySyncResponse\n \t}\n \n-\tauthenticationMethod, err := auth.GetAuthenticationMethodFromCtx(r.Context())\n+\tid, err := auth.GetIdentityFromCtx(r.Context(), d.identityCache)\n \tif err != nil {\n-\t\treturn response.InternalError(fmt.Errorf(\"Failed to determine caller authentication method: %w\", err))\n+\t\treturn response.InternalError(fmt.Errorf(\"Failed to determine caller identity: %w\", err))\n \t}\n \n-\t// OIDC authenticated clients are governed by fine-grained auth. They can call the endpoint but may see an empty list.\n-\tif authenticationMethod == api.AuthenticationMethodOIDC {\n-\t\treturn response.EmptySyncResponse\n-\t}\n-\n-\tusername, err := auth.GetUsernameFromCtx(r.Context())\n-\tif err != nil {\n-\t\treturn response.InternalError(fmt.Errorf(\"Failed to determine caller username: %w\", err))\n-\t}\n-\n-\tid, err := d.identityCache.Get(authenticationMethod, username)\n-\tif err != nil {\n-\t\tif authenticationMethod == auth.AuthenticationMethodPKI && api.StatusErrorCheck(err, http.StatusNotFound) {\n-\t\t\t// PKI user is implicitly trusted if they are not in the identity cache, since `core.trust_ca_certificates` is true.\n-\t\t\treturn response.EmptySyncResponse\n-\t\t}\n-\n-\t\treturn response.InternalError(fmt.Errorf(\"Failed loading certificate for %q: %w\", username, err))\n-\t}\n-\n-\tisRestricted, err := identity.IsRestrictedIdentityType(id.IdentityType)\n-\tif err != nil {\n-\t\treturn response.InternalError(fmt.Errorf(\"Failed to check restricted status of identity: %w\", err))\n-\t}\n-\n-\t// Unrestricted TLS clients can list resources in any project.\n-\tif !isRestricted {\n+\tswitch id.IdentityType {\n+\tcase api.IdentityTypeOIDCClient:\n+\t\t// OIDC authenticated clients are governed by fine-grained auth. They can call the endpoint but may see an empty list.\n \t\treturn response.EmptySyncResponse\n+\tcase api.IdentityTypeCertificateClientRestricted:\n+\t\t// A restricted client may be able to call the endpoint, continue.\n+\tdefault:\n+\t\t// No other identity types may list resources (e.g. metrics certificates).\n+\t\treturn response.Forbidden(nil)\n \t}\n \n-\t// We now have a restricted TLS certificate.\n \t// all-projects requests are not allowed\n \tif shared.IsTrue(request.QueryParam(r, \"all-projects\")) {\n \t\treturn response.Forbidden(fmt.Errorf(\"Certificate is restricted\"))"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/f01c26a013b1889f0c217c643964513acf17f6a4",
        "url": "https://api.github.com/repos/pillarjs/path-to-regexp/commits/f01c26a013b1889f0c217c643964513acf17f6a4",
        "html_url": "https://github.com/pillarjs/path-to-regexp/commit/f01c26a013b1889f0c217c643964513acf17f6a4",
        "message": "Merge commit from fork\n\n* Fix backtracking protection\n\n* Add test",
        "files": [
            {
                "sha": "95d2f4bbad4a8fb52c7937fc3abdc28ea68b7d72",
                "filename": "index.js",
                "status": "modified",
                "additions": 9,
                "deletions": 3,
                "changes": 12,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/f01c26a013b1889f0c217c643964513acf17f6a4/index.js",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/f01c26a013b1889f0c217c643964513acf17f6a4/index.js",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/index.js?ref=f01c26a013b1889f0c217c643964513acf17f6a4",
                "patch": "@@ -72,20 +72,26 @@ function pathToRegexp(path, keys, options) {\n   path = path.replace(\n     /\\\\.|(\\/)?(\\.)?:(\\w+)(\\(.*?\\))?(\\*)?(\\?)?|[.*]|\\/\\(/g,\n     function (match, slash, format, key, capture, star, optional, offset) {\n-      pos = offset + match.length;\n-\n       if (match[0] === '\\\\') {\n         backtrack += match;\n+        pos += 2;\n         return match;\n       }\n \n       if (match === '.') {\n         backtrack += '\\\\.';\n         extraOffset += 1;\n+        pos += 1;\n         return '\\\\.';\n       }\n \n-      backtrack = slash || format ? '' : path.slice(pos, offset);\n+      if (slash || format) {\n+        backtrack = '';\n+      } else {\n+        backtrack += path.slice(pos, offset);\n+      }\n+\n+      pos = offset + match.length;\n \n       if (match === '*') {\n         extraOffset += 3;"
            },
            {
                "sha": "537160e9e83100fadce94d619c7f86e82a604abb",
                "filename": "test.js",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/pillarjs/path-to-regexp/blob/f01c26a013b1889f0c217c643964513acf17f6a4/test.js",
                "raw_url": "https://github.com/pillarjs/path-to-regexp/raw/f01c26a013b1889f0c217c643964513acf17f6a4/test.js",
                "contents_url": "https://api.github.com/repos/pillarjs/path-to-regexp/contents/test.js?ref=f01c26a013b1889f0c217c643964513acf17f6a4",
                "patch": "@@ -8,6 +8,10 @@ describe('path-to-regexp', function () {\n     }, /path must be a string, array of strings, or regular expression/);\n   });\n \n+  it('should generate a regex without backtracking', function () {\n+    assert.deepEqual(pathToRegExp('/:a-:b'), /^(?:\\/([^/]+?))-(?:((?:(?!\\/|-).)+?))\\/?$/i);\n+  });\n+\n   describe('strings', function () {\n     it('should match simple paths', function () {\n       var params = [];"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/sigstore/sigstore-java/commits/23fb4885e6704a5df4977f7acf253a745349edf9",
        "url": "https://api.github.com/repos/sigstore/sigstore-java/commits/23fb4885e6704a5df4977f7acf253a745349edf9",
        "html_url": "https://github.com/sigstore/sigstore-java/commit/23fb4885e6704a5df4977f7acf253a745349edf9",
        "message": "Merge commit from fork\n\nFix checkpoint signature verification",
        "files": [
            {
                "sha": "5bc765b6d29258d808213354d4164a89b5e942de",
                "filename": "fuzzing/src/main/java/fuzzing/SignerVerifierFuzzer.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/sigstore/sigstore-java/blob/23fb4885e6704a5df4977f7acf253a745349edf9/fuzzing%2Fsrc%2Fmain%2Fjava%2Ffuzzing%2FSignerVerifierFuzzer.java",
                "raw_url": "https://github.com/sigstore/sigstore-java/raw/23fb4885e6704a5df4977f7acf253a745349edf9/fuzzing%2Fsrc%2Fmain%2Fjava%2Ffuzzing%2FSignerVerifierFuzzer.java",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-java/contents/fuzzing%2Fsrc%2Fmain%2Fjava%2Ffuzzing%2FSignerVerifierFuzzer.java?ref=23fb4885e6704a5df4977f7acf253a745349edf9",
                "patch": "@@ -36,8 +36,8 @@ public static void fuzzerTestOneInput(FuzzedDataProvider data) {\n       byte[] signature1 = signer.sign(byteArray);\n       byte[] signature2 = signer.signDigest(byteArray);\n \n-      verifier.verify(byteArray, signature1);\n-      verifier.verifyDigest(byteArray, signature2);\n+      var unused1 = verifier.verify(byteArray, signature1);\n+      var unused2 = verifier.verifyDigest(byteArray, signature2);\n     } catch (InvalidKeyException | NoSuchAlgorithmException | SignatureException e) {\n       // Known exception\n     }"
            },
            {
                "sha": "14b243bc5f18a0e0bd364fa0af20f67375b210ee",
                "filename": "sigstore-java/src/main/java/dev/sigstore/encryption/signers/Verifier.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/sigstore/sigstore-java/blob/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Fencryption%2Fsigners%2FVerifier.java",
                "raw_url": "https://github.com/sigstore/sigstore-java/raw/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Fencryption%2Fsigners%2FVerifier.java",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-java/contents/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Fencryption%2Fsigners%2FVerifier.java?ref=23fb4885e6704a5df4977f7acf253a745349edf9",
                "patch": "@@ -16,6 +16,7 @@\n package dev.sigstore.encryption.signers;\n \n import java.security.*;\n+import javax.annotation.CheckReturnValue;\n \n /** A verifier helper that wraps common verification operations for use within this library. */\n public interface Verifier {\n@@ -30,6 +31,7 @@ public interface Verifier {\n    * @param signature the signature associated with the artifact\n    * @return true if the signature is valid, false otherwise\n    */\n+  @CheckReturnValue\n   boolean verify(byte[] artifact, byte[] signature)\n       throws NoSuchAlgorithmException, InvalidKeyException, SignatureException;\n \n@@ -41,6 +43,7 @@ boolean verify(byte[] artifact, byte[] signature)\n    * @param signature the signature associated with the artifact\n    * @return true if the signature is valid, false otherwise\n    */\n+  @CheckReturnValue\n   boolean verifyDigest(byte[] artifactDigest, byte[] signature)\n       throws NoSuchAlgorithmException, InvalidKeyException, SignatureException;\n }"
            },
            {
                "sha": "1850c7ca3f6f9b0c536191146fa979f78dfd25a7",
                "filename": "sigstore-java/src/main/java/dev/sigstore/rekor/client/Checkpoints.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/sigstore/sigstore-java/blob/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Frekor%2Fclient%2FCheckpoints.java",
                "raw_url": "https://github.com/sigstore/sigstore-java/raw/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Frekor%2Fclient%2FCheckpoints.java",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-java/contents/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Frekor%2Fclient%2FCheckpoints.java?ref=23fb4885e6704a5df4977f7acf253a745349edf9",
                "patch": "@@ -71,6 +71,7 @@ static Checkpoint from(String encoded) throws RekorParseException {\n     }\n \n     return ImmutableCheckpoint.builder()\n+        .signedData(header + \"\\n\")\n         .origin(origin)\n         .size(size)\n         .base64Hash(base64Hash)"
            },
            {
                "sha": "0ae01180e388dbbfc0e9db42e01c6d3dabea68bb",
                "filename": "sigstore-java/src/main/java/dev/sigstore/rekor/client/RekorEntry.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/sigstore/sigstore-java/blob/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Frekor%2Fclient%2FRekorEntry.java",
                "raw_url": "https://github.com/sigstore/sigstore-java/raw/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Frekor%2Fclient%2FRekorEntry.java",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-java/contents/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Frekor%2Fclient%2FRekorEntry.java?ref=23fb4885e6704a5df4977f7acf253a745349edf9",
                "patch": "@@ -87,6 +87,9 @@ default Checkpoint parsedCheckpoint() throws RekorParseException {\n \n   @Value.Immutable\n   interface Checkpoint {\n+    /** Signed portion of checkpoint. */\n+    String getSignedData();\n+\n     /** Unique identity for the log. */\n     String getOrigin();\n "
            },
            {
                "sha": "93c9adccc7ec466ca7e1072b25bb42c39e8dd570",
                "filename": "sigstore-java/src/main/java/dev/sigstore/rekor/client/RekorVerifier.java",
                "status": "modified",
                "additions": 6,
                "deletions": 2,
                "changes": 8,
                "blob_url": "https://github.com/sigstore/sigstore-java/blob/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Frekor%2Fclient%2FRekorVerifier.java",
                "raw_url": "https://github.com/sigstore/sigstore-java/raw/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Frekor%2Fclient%2FRekorVerifier.java",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-java/contents/sigstore-java%2Fsrc%2Fmain%2Fjava%2Fdev%2Fsigstore%2Frekor%2Fclient%2FRekorVerifier.java?ref=23fb4885e6704a5df4977f7acf253a745349edf9",
                "patch": "@@ -20,6 +20,7 @@\n import dev.sigstore.rekor.client.RekorEntry.Checkpoint;\n import dev.sigstore.trustroot.SigstoreTrustedRoot;\n import dev.sigstore.trustroot.TransparencyLog;\n+import java.nio.charset.StandardCharsets;\n import java.security.InvalidKeyException;\n import java.security.NoSuchAlgorithmException;\n import java.security.SignatureException;\n@@ -163,9 +164,12 @@ private void verifyCheckpoint(RekorEntry entry, TransparencyLog tlog)\n             \"Checkpoint key hint did not match provided log public key\");\n       }\n     }\n+    var signedData = checkpoint.getSignedData();\n     try {\n-      Verifiers.newVerifier(tlog.getPublicKey().toJavaPublicKey())\n-          .verifyDigest(inclusionRootHash, sig.getSignature());\n+      if (!Verifiers.newVerifier(tlog.getPublicKey().toJavaPublicKey())\n+          .verify(signedData.getBytes(StandardCharsets.UTF_8), sig.getSignature())) {\n+        throw new RekorVerificationException(\"Checkpoint signature was invalid\");\n+      }\n     } catch (NoSuchAlgorithmException\n         | InvalidKeySpecException\n         | SignatureException"
            },
            {
                "sha": "bdee62b6201505c12f3823e13ca9952e590fb346",
                "filename": "sigstore-java/src/test/java/dev/sigstore/KeylessVerifierTest.java",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/sigstore/sigstore-java/blob/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Ftest%2Fjava%2Fdev%2Fsigstore%2FKeylessVerifierTest.java",
                "raw_url": "https://github.com/sigstore/sigstore-java/raw/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Ftest%2Fjava%2Fdev%2Fsigstore%2FKeylessVerifierTest.java",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-java/contents/sigstore-java%2Fsrc%2Ftest%2Fjava%2Fdev%2Fsigstore%2FKeylessVerifierTest.java?ref=23fb4885e6704a5df4977f7acf253a745349edf9",
                "patch": "@@ -86,6 +86,25 @@ public void testVerify_mismatchedArtifactHash() throws Exception {\n                 VerificationOptions.empty()));\n   }\n \n+  @Test\n+  public void testVerify_badCheckpointSignature() throws Exception {\n+    var bundleFile =\n+        Resources.toString(\n+            Resources.getResource(\n+                \"dev/sigstore/samples/bundles/bundle-with-bad-checkpoint-signature.sigstore\"),\n+            StandardCharsets.UTF_8);\n+    var artifact = Resources.getResource(\"dev/sigstore/samples/bundles/artifact.txt\").getPath();\n+\n+    var verifier = KeylessVerifier.builder().sigstorePublicDefaults().build();\n+    Assertions.assertThrows(\n+        KeylessVerificationException.class,\n+        () ->\n+            verifier.verify(\n+                Path.of(artifact),\n+                Bundle.from(new StringReader(bundleFile)),\n+                VerificationOptions.empty()));\n+  }\n+\n   @Test\n   public void testVerify_errorsOnDSSEBundle() throws Exception {\n     var bundleFile ="
            },
            {
                "sha": "cca75f7039268edc2a4d7dadb7b79d925df5ec4d",
                "filename": "sigstore-java/src/test/resources/dev/sigstore/samples/bundles/bundle-with-bad-checkpoint-signature.sigstore",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/sigstore/sigstore-java/blob/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Ftest%2Fresources%2Fdev%2Fsigstore%2Fsamples%2Fbundles%2Fbundle-with-bad-checkpoint-signature.sigstore",
                "raw_url": "https://github.com/sigstore/sigstore-java/raw/23fb4885e6704a5df4977f7acf253a745349edf9/sigstore-java%2Fsrc%2Ftest%2Fresources%2Fdev%2Fsigstore%2Fsamples%2Fbundles%2Fbundle-with-bad-checkpoint-signature.sigstore",
                "contents_url": "https://api.github.com/repos/sigstore/sigstore-java/contents/sigstore-java%2Fsrc%2Ftest%2Fresources%2Fdev%2Fsigstore%2Fsamples%2Fbundles%2Fbundle-with-bad-checkpoint-signature.sigstore?ref=23fb4885e6704a5df4977f7acf253a745349edf9",
                "patch": "@@ -0,0 +1 @@\n+{\"mediaType\": \"application/vnd.dev.sigstore.bundle+json;version=0.1\", \"verificationMaterial\": {\"x509CertificateChain\": {\"certificates\": [{\"rawBytes\": \"MIIIGTCCB5+gAwIBAgIUBPWs4OPN1kte0mUMGZrZ6ozMVRkwCgYIKoZIzj0EAwMwNzEVMBMGA1UEChMMc2lnc3RvcmUuZGV2MR4wHAYDVQQDExVzaWdzdG9yZS1pbnRlcm1lZGlhdGUwHhcNMjMwNzEyMTU1NjM1WhcNMjMwNzEyMTYwNjM1WjAAMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEVr33uVAPA1SpA5w/mmBF9ariW8E7oizIQKqiYfxwSb1zftqZZX045y3tPbRkIWe+t7MUYliQknQ954rDDEASnKOCBr4wgga6MA4GA1UdDwEB/wQEAwIHgDATBgNVHSUEDDAKBggrBgEFBQcDAzAdBgNVHQ4EFgQUx2TNZkruHC2aCdyIXscI8N/8q2owHwYDVR0jBBgwFoAU39Ppz1YkEZb5qNjpKFWixi4YZD8wgaUGA1UdEQEB/wSBmjCBl4aBlGh0dHBzOi8vZ2l0aHViLmNvbS9zaWdzdG9yZS1jb25mb3JtYW5jZS9leHRyZW1lbHktZGFuZ2Vyb3VzLXB1YmxpYy1vaWRjLWJlYWNvbi8uZ2l0aHViL3dvcmtmbG93cy9leHRyZW1lbHktZGFuZ2Vyb3VzLW9pZGMtYmVhY29uLnltbEByZWZzL2hlYWRzL21haW4wOQYKKwYBBAGDvzABAQQraHR0cHM6Ly90b2tlbi5hY3Rpb25zLmdpdGh1YnVzZXJjb250ZW50LmNvbTAfBgorBgEEAYO/MAECBBF3b3JrZmxvd19kaXNwYXRjaDA2BgorBgEEAYO/MAEDBChhZjc4NWI2ZDNiMGZhMGMwYWExMzA1ZmFlZTdjZTYwMzZlOGQ5MGM0MC0GCisGAQQBg78wAQQEH0V4dHJlbWVseSBkYW5nZXJvdXMgT0lEQyBiZWFjb24wSQYKKwYBBAGDvzABBQQ7c2lnc3RvcmUtY29uZm9ybWFuY2UvZXh0cmVtZWx5LWRhbmdlcm91cy1wdWJsaWMtb2lkYy1iZWFjb24wHQYKKwYBBAGDvzABBgQPcmVmcy9oZWFkcy9tYWluMDsGCisGAQQBg78wAQgELQwraHR0cHM6Ly90b2tlbi5hY3Rpb25zLmdpdGh1YnVzZXJjb250ZW50LmNvbTCBpgYKKwYBBAGDvzABCQSBlwyBlGh0dHBzOi8vZ2l0aHViLmNvbS9zaWdzdG9yZS1jb25mb3JtYW5jZS9leHRyZW1lbHktZGFuZ2Vyb3VzLXB1YmxpYy1vaWRjLWJlYWNvbi8uZ2l0aHViL3dvcmtmbG93cy9leHRyZW1lbHktZGFuZ2Vyb3VzLW9pZGMtYmVhY29uLnltbEByZWZzL2hlYWRzL21haW4wOAYKKwYBBAGDvzABCgQqDChhZjc4NWI2ZDNiMGZhMGMwYWExMzA1ZmFlZTdjZTYwMzZlOGQ5MGM0MB0GCisGAQQBg78wAQsEDwwNZ2l0aHViLWhvc3RlZDBeBgorBgEEAYO/MAEMBFAMTmh0dHBzOi8vZ2l0aHViLmNvbS9zaWdzdG9yZS1jb25mb3JtYW5jZS9leHRyZW1lbHktZGFuZ2Vyb3VzLXB1YmxpYy1vaWRjLWJlYWNvbjA4BgorBgEEAYO/MAENBCoMKGFmNzg1YjZkM2IwZmEwYzBhYTEzMDVmYWVlN2NlNjAzNmU4ZDkwYzQwHwYKKwYBBAGDvzABDgQRDA9yZWZzL2hlYWRzL21haW4wGQYKKwYBBAGDvzABDwQLDAk2MzI1OTY4OTcwNwYKKwYBBAGDvzABEAQpDCdodHRwczovL2dpdGh1Yi5jb20vc2lnc3RvcmUtY29uZm9ybWFuY2UwGQYKKwYBBAGDvzABEQQLDAkxMzE4MDQ1NjMwgaYGCisGAQQBg78wARIEgZcMgZRodHRwczovL2dpdGh1Yi5jb20vc2lnc3RvcmUtY29uZm9ybWFuY2UvZXh0cmVtZWx5LWRhbmdlcm91cy1wdWJsaWMtb2lkYy1iZWFjb24vLmdpdGh1Yi93b3JrZmxvd3MvZXh0cmVtZWx5LWRhbmdlcm91cy1vaWRjLWJlYWNvbi55bWxAcmVmcy9oZWFkcy9tYWluMDgGCisGAQQBg78wARMEKgwoYWY3ODViNmQzYjBmYTBjMGFhMTMwNWZhZWU3Y2U2MDM2ZThkOTBjNDAhBgorBgEEAYO/MAEUBBMMEXdvcmtmbG93X2Rpc3BhdGNoMIGBBgorBgEEAYO/MAEVBHMMcWh0dHBzOi8vZ2l0aHViLmNvbS9zaWdzdG9yZS1jb25mb3JtYW5jZS9leHRyZW1lbHktZGFuZ2Vyb3VzLXB1YmxpYy1vaWRjLWJlYWNvbi9hY3Rpb25zL3J1bnMvNTUzMzc0MTQ5Ny9hdHRlbXB0cy8xMIGKBgorBgEEAdZ5AgQCBHwEegB4AHYA3T0wasbHETJjGR4cmWc3AqJKXrjePK3/h4pygC8p7o4AAAGJStGTCwAABAMARzBFAiBCA4jZQP4CwMiWoeS7WMW46QkI4e7OsNH3yVhf5wdBvgIhAPJYxdsi9NqOXVZsEUtCup8m1m/2zG39FTGlgE0MorDFMAoGCCqGSM49BAMDA2gAMGUCMEYWRwI5QJeOwNCuV4tnZ0n5QNlUlP0BtX5V2ZTQLqcQbWtneC7tLptiYgr0Z62UDQIxAO6ItXAH+sbZcsbj08xr3GApM6hjvyTAl39pS3Y3sZwAz8lfQDHNL4eALEo1heAYVg==\"}]}, \"tlogEntries\": [{\"logIndex\": \"27246492\", \"logId\": {\"keyId\": \"wNI9atQGlz+VWfO6LRygH4QUfY/8W4RFwiT5i5WRgB0=\"}, \"kindVersion\": {\"kind\": \"hashedrekord\", \"version\": \"0.0.1\"}, \"integratedTime\": \"1689177396\", \"inclusionPromise\": {\"signedEntryTimestamp\": \"MEUCIQCvkqgP1sCP3BiNYQ+36o79yGXZP5CNeo7OmpmVT6kehgIgegEh0UlZwjMj2KEi/X0nm9cyq+vuG8uOGqG4i//nqgM=\"}, \"inclusionProof\": {\"logIndex\": \"23083061\", \"rootHash\": \"dauhleYK4YyAdxwwDtR0l0KnSOWZdG2bwqHftlanvcI=\", \"treeSize\": \"23083062\", \"hashes\": [\"/vK4Da3g7ZhRgme8FxCi8QIBL7DSlwpSwyERyIV+uS8=\", \"k9N2htTx+7tA55tT0tiB/BO4uqaqSxqTV34ouZgCBWk=\", \"/ArdEa96pCZQOyrxyKhOHxd2HHEsXBldxS8p23CNIkk=\", \"5GQbI53IAmYSDjLtEjG0PNzp0hk2+W/eEkCbJlNqTKc=\", \"O86OnjaE1s+pcHWna1/xdeZ7ubCXgVmtV1f7nWlWYLI=\", \"Hj0TEef/bwMHB10DPoFLu5+RSLTGJ5YRaQWqwwVIp0s=\", \"aRtyVlt3GYDP4qaYrEAWqiGqcYDELxyk7Fl3icGXOoA=\", \"ZdynT2d4F3NFQNBurFDaZBoYMVRjbQjlTnSL1hL67+s=\", \"3VHoQOiS1wCTrX4dseLeo9UDNMc0XTYORE0i/Entn14=\", \"rXEsmEJN4PEoTU8US4qVtdIsGB1MCiRlGOepoiC99kM=\"], \"checkpoint\": {\"envelope\": \"rekor.sigstore.dev - 2605736670972794746\\n23083062\\ndauhleYK4YyAdxwwDtR0l0KnSOWZdG2bwqHftlanvcI=\\nTimestamp: 1689177396617352539\\n\\n\\u2014 rekor.sigstore.dev wNI9ajBFAiBxaGyEtxkzZLkaCSEJqFuSS3dJjEZCNiyByVs1CNVQ8gIhAOoNnXtmMtTctV2oRnSRUZAo4EWUYPK/vBsqOzAU6TMs\\n\"}}, \"canonicalizedBody\": \"eyJhcGlWZXJzaW9uIjoiMC4wLjEiLCJraW5kIjoiaGFzaGVkcmVrb3JkIiwic3BlYyI6eyJkYXRhIjp7Imhhc2giOnsiYWxnb3JpdGhtIjoic2hhMjU2IiwidmFsdWUiOiJhMGNmYzcxMjcxZDZlMjc4ZTU3Y2QzMzJmZjk1N2MzZjcwNDNmZGRhMzU0YzRjYmIxOTBhMzBkNTZlZmEwMWJmIn19LCJzaWduYXR1cmUiOnsiY29udGVudCI6Ik1FUUNJRk9wYVhLV3Z2QkR3VGhEalRIWDd0RkY4bGlSb1N4TFpJc1Nlb1VNLzZENEFpQnhWOS9SblRNTXcxdDZubmlYMHJDdXdyZjhWaCtmZUxGdTk5bTRpciszeUE9PSIsInB1YmxpY0tleSI6eyJjb250ZW50IjoiTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVbEhWRU5EUWpVclowRjNTVUpCWjBsVlFsQlhjelJQVUU0eGEzUmxNRzFWVFVkYWNsbzJiM3BOVmxKcmQwTm5XVWxMYjFwSmVtb3dSVUYzVFhjS1RucEZWazFDVFVkQk1WVkZRMmhOVFdNeWJHNWpNMUoyWTIxVmRWcEhWakpOVWpSM1NFRlpSRlpSVVVSRmVGWjZZVmRrZW1SSE9YbGFVekZ3WW01U2JBcGpiVEZzV2tkc2FHUkhWWGRJYUdOT1RXcE5kMDU2UlhsTlZGVXhUbXBOTVZkb1kwNU5hazEzVG5wRmVVMVVXWGRPYWsweFYycEJRVTFHYTNkRmQxbElDa3R2V2tsNmFqQkRRVkZaU1V0dldrbDZhakJFUVZGalJGRm5RVVZXY2pNemRWWkJVRUV4VTNCQk5YY3ZiVzFDUmpsaGNtbFhPRVUzYjJsNlNWRkxjV2tLV1daNGQxTmlNWHBtZEhGYVdsZ3dORFY1TTNSUVlsSnJTVmRsSzNRM1RWVlpiR2xSYTI1Uk9UVTBja1JFUlVGVGJrdFBRMEp5TkhkbloyRTJUVUUwUndwQk1WVmtSSGRGUWk5M1VVVkJkMGxJWjBSQlZFSm5UbFpJVTFWRlJFUkJTMEpuWjNKQ1owVkdRbEZqUkVGNlFXUkNaMDVXU0ZFMFJVWm5VVlY0TWxST0NscHJjblZJUXpKaFEyUjVTVmh6WTBrNFRpODRjVEp2ZDBoM1dVUldVakJxUWtKbmQwWnZRVlV6T1ZCd2VqRlphMFZhWWpWeFRtcHdTMFpYYVhocE5Ga0tXa1E0ZDJkaFZVZEJNVlZrUlZGRlFpOTNVMEp0YWtOQ2JEUmhRbXhIYURCa1NFSjZUMms0ZGxveWJEQmhTRlpwVEcxT2RtSlRPWHBoVjJSNlpFYzVlUXBhVXpGcVlqSTFiV0l6U25SWlZ6VnFXbE01YkdWSVVubGFWekZzWWtocmRGcEhSblZhTWxaNVlqTldla3hZUWpGWmJYaHdXWGt4ZG1GWFVtcE1WMHBzQ2xsWFRuWmlhVGgxV2pKc01HRklWbWxNTTJSMlkyMTBiV0pIT1ROamVUbHNaVWhTZVZwWE1XeGlTR3QwV2tkR2RWb3lWbmxpTTFaNlRGYzVjRnBIVFhRS1dXMVdhRmt5T1hWTWJteDBZa1ZDZVZwWFducE1NbWhzV1ZkU2Vrd3lNV2hoVnpSM1QxRlpTMHQzV1VKQ1FVZEVkbnBCUWtGUlVYSmhTRkl3WTBoTk5ncE1lVGt3WWpKMGJHSnBOV2haTTFKd1lqSTFla3h0WkhCa1IyZ3hXVzVXZWxwWVNtcGlNalV3V2xjMU1FeHRUblppVkVGbVFtZHZja0puUlVWQldVOHZDazFCUlVOQ1FrWXpZak5LY2xwdGVIWmtNVGxyWVZoT2QxbFlVbXBoUkVFeVFtZHZja0puUlVWQldVOHZUVUZGUkVKRGFHaGFhbU0wVGxkSk1scEVUbWtLVFVkYWFFMUhUWGRaVjBWNFRYcEJNVnB0Um14YVZHUnFXbFJaZDAxNldteFBSMUUxVFVkTk1FMURNRWREYVhOSFFWRlJRbWMzT0hkQlVWRkZTREJXTkFwa1NFcHNZbGRXYzJWVFFtdFpWelZ1V2xoS2RtUllUV2RVTUd4RlVYbENhVnBYUm1waU1qUjNVMUZaUzB0M1dVSkNRVWRFZG5wQlFrSlJVVGRqTW14dUNtTXpVblpqYlZWMFdUSTVkVnB0T1hsaVYwWjFXVEpWZGxwWWFEQmpiVlowV2xkNE5VeFhVbWhpYldSc1kyMDVNV041TVhka1YwcHpZVmROZEdJeWJHc0tXWGt4YVZwWFJtcGlNalIzU0ZGWlMwdDNXVUpDUVVkRWRucEJRa0puVVZCamJWWnRZM2s1YjFwWFJtdGplVGwwV1Zkc2RVMUVjMGREYVhOSFFWRlJRZ3BuTnpoM1FWRm5SVXhSZDNKaFNGSXdZMGhOTmt4NU9UQmlNblJzWW1rMWFGa3pVbkJpTWpWNlRHMWtjR1JIYURGWmJsWjZXbGhLYW1JeU5UQmFWelV3Q2t4dFRuWmlWRU5DY0dkWlMwdDNXVUpDUVVkRWRucEJRa05SVTBKc2QzbENiRWRvTUdSSVFucFBhVGgyV2pKc01HRklWbWxNYlU1MllsTTVlbUZYWkhvS1pFYzVlVnBUTVdwaU1qVnRZak5LZEZsWE5XcGFVemxzWlVoU2VWcFhNV3hpU0d0MFdrZEdkVm95Vm5saU0xWjZURmhDTVZsdGVIQlplVEYyWVZkU2FncE1WMHBzV1ZkT2RtSnBPSFZhTW13d1lVaFdhVXd6WkhaamJYUnRZa2M1TTJONU9XeGxTRko1V2xjeGJHSklhM1JhUjBaMVdqSldlV0l6Vm5wTVZ6bHdDbHBIVFhSWmJWWm9XVEk1ZFV4dWJIUmlSVUo1V2xkYWVrd3lhR3haVjFKNlRESXhhR0ZYTkhkUFFWbExTM2RaUWtKQlIwUjJla0ZDUTJkUmNVUkRhR2dLV21wak5FNVhTVEphUkU1cFRVZGFhRTFIVFhkWlYwVjRUWHBCTVZwdFJteGFWR1JxV2xSWmQwMTZXbXhQUjFFMVRVZE5NRTFDTUVkRGFYTkhRVkZSUWdwbk56aDNRVkZ6UlVSM2QwNWFNbXd3WVVoV2FVeFhhSFpqTTFKc1drUkNaVUpuYjNKQ1owVkZRVmxQTDAxQlJVMUNSa0ZOVkcxb01HUklRbnBQYVRoMkNsb3liREJoU0ZacFRHMU9kbUpUT1hwaFYyUjZaRWM1ZVZwVE1XcGlNalZ0WWpOS2RGbFhOV3BhVXpsc1pVaFNlVnBYTVd4aVNHdDBXa2RHZFZveVZua0tZak5XZWt4WVFqRlpiWGh3V1hreGRtRlhVbXBNVjBwc1dWZE9kbUpxUVRSQ1oyOXlRbWRGUlVGWlR5OU5RVVZPUWtOdlRVdEhSbTFPZW1jeFdXcGFhd3BOTWtsM1dtMUZkMWw2UW1oWlZFVjZUVVJXYlZsWFZteE9NazVzVG1wQmVrNXRWVFJhUkd0M1dYcFJkMGgzV1V0TGQxbENRa0ZIUkhaNlFVSkVaMUZTQ2tSQk9YbGFWMXA2VERKb2JGbFhVbnBNTWpGb1lWYzBkMGRSV1V0TGQxbENRa0ZIUkhaNlFVSkVkMUZNUkVGck1rMTZTVEZQVkZrMFQxUmpkMDUzV1VzS1MzZFpRa0pCUjBSMmVrRkNSVUZSY0VSRFpHOWtTRkozWTNwdmRrd3laSEJrUjJneFdXazFhbUl5TUhaak1teHVZek5TZG1OdFZYUlpNamwxV20wNWVRcGlWMFoxV1RKVmQwZFJXVXRMZDFsQ1FrRkhSSFo2UVVKRlVWRk1SRUZyZUUxNlJUUk5SRkV4VG1wTmQyZGhXVWREYVhOSFFWRlJRbWMzT0hkQlVrbEZDbWRhWTAxbldsSnZaRWhTZDJONmIzWk1NbVJ3WkVkb01WbHBOV3BpTWpCMll6SnNibU16VW5aamJWVjBXVEk1ZFZwdE9YbGlWMFoxV1RKVmRscFlhREFLWTIxV2RGcFhlRFZNVjFKb1ltMWtiR050T1RGamVURjNaRmRLYzJGWFRYUmlNbXhyV1hreGFWcFhSbXBpTWpSMlRHMWtjR1JIYURGWmFUa3pZak5LY2dwYWJYaDJaRE5OZGxwWWFEQmpiVlowV2xkNE5VeFhVbWhpYldSc1kyMDVNV041TVhaaFYxSnFURmRLYkZsWFRuWmlhVFUxWWxkNFFXTnRWbTFqZVRsdkNscFhSbXRqZVRsMFdWZHNkVTFFWjBkRGFYTkhRVkZSUW1jM09IZEJVazFGUzJkM2IxbFhXVE5QUkZacFRtMVJlbGxxUW0xWlZFSnFUVWRHYUUxVVRYY0tUbGRhYUZwWFZUTlpNbFV5VFVSTk1scFVhR3RQVkVKcVRrUkJhRUpuYjNKQ1owVkZRVmxQTDAxQlJWVkNRazFOUlZoa2RtTnRkRzFpUnpreldESlNjQXBqTTBKb1pFZE9iMDFKUjBKQ1oyOXlRbWRGUlVGWlR5OU5RVVZXUWtoTlRXTlhhREJrU0VKNlQyazRkbG95YkRCaFNGWnBURzFPZG1KVE9YcGhWMlI2Q21SSE9YbGFVekZxWWpJMWJXSXpTblJaVnpWcVdsTTViR1ZJVW5sYVZ6RnNZa2hyZEZwSFJuVmFNbFo1WWpOV2VreFlRakZaYlhod1dYa3hkbUZYVW1vS1RGZEtiRmxYVG5aaWFUbG9XVE5TY0dJeU5YcE1NMG94WW01TmRrNVVWWHBOZW1Nd1RWUlJOVTU1T1doa1NGSnNZbGhDTUdONU9IaE5TVWRMUW1kdmNncENaMFZGUVdSYU5VRm5VVU5DU0hkRlpXZENORUZJV1VFelZEQjNZWE5pU0VWVVNtcEhValJqYlZkak0wRnhTa3RZY21wbFVFc3pMMmcwY0hsblF6aHdDamR2TkVGQlFVZEtVM1JIVkVOM1FVRkNRVTFCVW5wQ1JrRnBRa05CTkdwYVVWQTBRM2ROYVZkdlpWTTNWMDFYTkRaUmEwazBaVGRQYzA1SU0zbFdhR1lLTlhka1FuWm5TV2hCVUVwWmVHUnphVGxPY1U5WVZscHpSVlYwUTNWd09HMHhiUzh5ZWtjek9VWlVSMnhuUlRCTmIzSkVSazFCYjBkRFEzRkhVMDAwT1FwQ1FVMUVRVEpuUVUxSFZVTk5SVmxYVW5kSk5WRktaVTkzVGtOMVZqUjBibG93YmpWUlRteFZiRkF3UW5SWU5WWXlXbFJSVEhGalVXSlhkRzVsUXpkMENreHdkR2xaWjNJd1dqWXlWVVJSU1hoQlR6WkpkRmhCU0N0ellscGpjMkpxTURoNGNqTkhRWEJOTm1ocWRubFVRV3d6T1hCVE0xa3pjMXAzUVhvNGJHWUtVVVJJVGt3MFpVRk1SVzh4YUdWQldWWm5QVDBLTFMwdExTMUZUa1FnUTBWU1ZFbEdTVU5CVkVVdExTMHRMUW89In19fX0=\"}]}, \"messageSignature\": {\"messageDigest\": {\"algorithm\": \"SHA2_256\", \"digest\": \"oM/HEnHW4njlfNMy/5V8P3BD/do1TEy7GQow1W76Ab8=\"}, \"signature\": \"MEQCIFOpaXKWvvBDwThDjTHX7tFF8liRoSxLZIsSeoUM/6D4AiBxV9/RnTMMw1t6nniX0rCuwrf8Vh+feLFu99m4ir+3yA==\"}}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/directus/directus/commits/c89dbb233fbad2fd0cf41eb99d50c6de4e84195d",
        "url": "https://api.github.com/repos/directus/directus/commits/c89dbb233fbad2fd0cf41eb99d50c6de4e84195d",
        "html_url": "https://github.com/directus/directus/commit/c89dbb233fbad2fd0cf41eb99d50c6de4e84195d",
        "message": "Merge commit from fork\n\n* Prevent rendering HTML in comments sidebar\n\n* removed debug logs\n\n* Update app/src/views/private/components/comments-sidebar-detail.vue\n\nCo-authored-by: Hannes K\u00fcttner <kuettner.hannes@gmail.com>\n\n* fixed weird gh merge\n\n---------\n\nCo-authored-by: Hannes K\u00fcttner <kuettner.hannes@gmail.com>",
        "files": [
            {
                "sha": "f2e18ae7aa88fb6a96b408ff06c5c6d52ac5e0f8",
                "filename": "app/src/views/private/components/comments-sidebar-detail.vue",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/directus/directus/blob/c89dbb233fbad2fd0cf41eb99d50c6de4e84195d/app%2Fsrc%2Fviews%2Fprivate%2Fcomponents%2Fcomments-sidebar-detail.vue",
                "raw_url": "https://github.com/directus/directus/raw/c89dbb233fbad2fd0cf41eb99d50c6de4e84195d/app%2Fsrc%2Fviews%2Fprivate%2Fcomponents%2Fcomments-sidebar-detail.vue",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/app%2Fsrc%2Fviews%2Fprivate%2Fcomponents%2Fcomments-sidebar-detail.vue?ref=c89dbb233fbad2fd0cf41eb99d50c6de4e84195d",
                "patch": "@@ -9,6 +9,7 @@ import { isThisYear, isToday, isYesterday } from 'date-fns';\n import { flatten, groupBy, orderBy } from 'lodash';\n import { Ref, computed, onMounted, ref, toRefs, watch } from 'vue';\n import { useI18n } from 'vue-i18n';\n+import dompurify from 'dompurify';\n import CommentInput from './comment-input.vue';\n import CommentItem from './comment-item.vue';\n \n@@ -100,10 +101,9 @@ function useComments(collection: Ref<string>, primaryKey: Ref<PrimaryKey>) {\n \t\t\tuserPreviews.value = await loadUserPreviews(response, regex);\n \n \t\t\tconst commentsWithTaggedUsers = (response as Comment[]).map((comment) => {\n-\t\t\t\tconst display = (comment.comment as string).replace(\n-\t\t\t\t\tregex,\n-\t\t\t\t\t(match) => `<mark>${userPreviews.value[match.substring(2)]}</mark>`,\n-\t\t\t\t);\n+\t\t\t\tconst display = dompurify\n+\t\t\t\t\t.sanitize(comment.comment as string, { ALLOWED_TAGS: [] })\n+\t\t\t\t\t.replace(regex, (match) => `<mark>${userPreviews.value[match.substring(2)]}</mark>`);\n \n \t\t\t\treturn {\n \t\t\t\t\t...comment,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/directus/directus/commits/4487fb18d5cb09e071b111d2dc0c9d6bcb437633",
        "url": "https://api.github.com/repos/directus/directus/commits/4487fb18d5cb09e071b111d2dc0c9d6bcb437633",
        "html_url": "https://github.com/directus/directus/commit/4487fb18d5cb09e071b111d2dc0c9d6bcb437633",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "98bfcea0aaa847fd83abde62c9215edcd07815b4",
                "filename": "app/src/views/private/components/comments-sidebar-detail.vue",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/directus/directus/blob/4487fb18d5cb09e071b111d2dc0c9d6bcb437633/app%2Fsrc%2Fviews%2Fprivate%2Fcomponents%2Fcomments-sidebar-detail.vue",
                "raw_url": "https://github.com/directus/directus/raw/4487fb18d5cb09e071b111d2dc0c9d6bcb437633/app%2Fsrc%2Fviews%2Fprivate%2Fcomponents%2Fcomments-sidebar-detail.vue",
                "contents_url": "https://api.github.com/repos/directus/directus/contents/app%2Fsrc%2Fviews%2Fprivate%2Fcomponents%2Fcomments-sidebar-detail.vue?ref=4487fb18d5cb09e071b111d2dc0c9d6bcb437633",
                "patch": "@@ -5,6 +5,7 @@ import { localizedFormat } from '@/utils/localized-format';\n import { userName } from '@/utils/user-name';\n import type { PrimaryKey, User } from '@directus/types';\n import { abbreviateNumber } from '@directus/utils';\n+import dompurify from 'dompurify';\n import { isThisYear, isToday, isYesterday } from 'date-fns';\n import { flatten, groupBy, orderBy } from 'lodash';\n import { Ref, onMounted, ref, toRefs, watch } from 'vue';\n@@ -91,10 +92,9 @@ function useActivity(collection: Ref<string>, primaryKey: Ref<PrimaryKey>) {\n \t\t\tuserPreviews.value = await loadUserPreviews(response.data.data, regex);\n \n \t\t\tconst activityWithUsersInComments = (response.data.data as Activity[]).map((comment) => {\n-\t\t\t\tconst display = (comment.comment as string).replace(\n-\t\t\t\t\tregex,\n-\t\t\t\t\t(match) => `<mark>${userPreviews.value[match.substring(2)]}</mark>`,\n-\t\t\t\t);\n+\t\t\t\tconst display = dompurify\n+\t\t\t\t\t.sanitize(comment.comment as string, { ALLOWED_TAGS: [] })\n+\t\t\t\t\t.replace(regex, (match) => `<mark>${userPreviews.value[match.substring(2)]}</mark>`);\n \n \t\t\t\treturn {\n \t\t\t\t\t...comment,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/hive/commits/60027bb9c91a93affcfebd9068f064bc1f2a74c9",
        "url": "https://api.github.com/repos/apache/hive/commits/60027bb9c91a93affcfebd9068f064bc1f2a74c9",
        "html_url": "https://github.com/apache/hive/commit/60027bb9c91a93affcfebd9068f064bc1f2a74c9",
        "message": "HIVE-26539: Prevent unsafe deserialization in PartitionExpressionForMetastore (#3605)",
        "files": [
            {
                "sha": "7e7f6138e59e6d1d41edd9f34a084d109410d433",
                "filename": "ql/src/java/org/apache/hadoop/hive/ql/exec/SerializationUtilities.java",
                "status": "modified",
                "additions": 36,
                "deletions": 3,
                "changes": 39,
                "blob_url": "https://github.com/apache/hive/blob/60027bb9c91a93affcfebd9068f064bc1f2a74c9/ql%2Fsrc%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhive%2Fql%2Fexec%2FSerializationUtilities.java",
                "raw_url": "https://github.com/apache/hive/raw/60027bb9c91a93affcfebd9068f064bc1f2a74c9/ql%2Fsrc%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhive%2Fql%2Fexec%2FSerializationUtilities.java",
                "contents_url": "https://api.github.com/repos/apache/hive/contents/ql%2Fsrc%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhive%2Fql%2Fexec%2FSerializationUtilities.java?ref=60027bb9c91a93affcfebd9068f064bc1f2a74c9",
                "patch": "@@ -124,6 +124,10 @@ private static class KryoWithHooks extends Kryo implements Configurable {\n     private Hook globalHook;\n     // this should be set on-the-fly after borrowing this instance and needs to be reset on release\n     private Configuration configuration;\n+    // default false, should be reset on release\n+    private boolean isExprNodeFirst = false;\n+    // total classes we have met during (de)serialization, should be reset on release\n+    private long classCounter = 0;\n \n     @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n     private static final class SerializerWithHook extends com.esotericsoftware.kryo.Serializer {\n@@ -228,6 +232,32 @@ public void setConf(Configuration conf) {\n     public Configuration getConf() {\n       return configuration;\n     }\n+\n+    @Override\n+    public com.esotericsoftware.kryo.Registration getRegistration(Class type) {\n+      // If PartitionExpressionForMetastore performs deserialization at remote HMS,\n+      // the first class encountered during deserialization must be an ExprNodeDesc,\n+      // throw exception to avoid potential security problem if it is not.\n+      if (isExprNodeFirst && classCounter == 0) {\n+        if (!ExprNodeDesc.class.isAssignableFrom(type)) {\n+          throw new UnsupportedOperationException(\n+              \"The object to be deserialized must be an ExprNodeDesc, but encountered: \" + type);\n+        }\n+      }\n+      classCounter++;\n+      return super.getRegistration(type);\n+    }\n+\n+    public void setExprNodeFirst(boolean isPartFilter) {\n+      this.isExprNodeFirst = isPartFilter;\n+    }\n+\n+    // reset the fields on release\n+    public void restore() {\n+      setConf(null);\n+      isExprNodeFirst = false;\n+      classCounter = 0;\n+    }\n   }\n \n   private static final Object FAKE_REFERENCE = new Object();\n@@ -294,7 +324,7 @@ public static Kryo borrowKryo(Configuration configuration) {\n    */\n   public static void releaseKryo(Kryo kryo) {\n     if (kryo != null){\n-      ((KryoWithHooks) kryo).setConf(null);\n+      ((KryoWithHooks) kryo).restore();\n     }\n     kryoPool.free(kryo);\n   }\n@@ -830,10 +860,13 @@ public static byte[] serializeObjectWithTypeInformation(Serializable object) {\n   /**\n    * Deserializes expression from Kryo.\n    * @param bytes Bytes containing the expression.\n+   * @param isPartFilter ture if it is a partition filter\n    * @return Expression; null if deserialization succeeded, but the result type is incorrect.\n    */\n-  public static <T> T deserializeObjectWithTypeInformation(byte[] bytes) {\n-    Kryo kryo = borrowKryo();\n+  public static <T> T deserializeObjectWithTypeInformation(byte[] bytes,\n+      boolean isPartFilter) {\n+    KryoWithHooks kryo = (KryoWithHooks) borrowKryo();\n+    kryo.setExprNodeFirst(isPartFilter);\n     try (Input inp = new Input(new ByteArrayInputStream(bytes))) {\n       return (T) kryo.readClassAndObject(inp);\n     } finally {"
            },
            {
                "sha": "6547d1d1c7acf370c343701d3f91d618ccab4d37",
                "filename": "ql/src/java/org/apache/hadoop/hive/ql/optimizer/ppr/PartitionExpressionForMetastore.java",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/apache/hive/blob/60027bb9c91a93affcfebd9068f064bc1f2a74c9/ql%2Fsrc%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhive%2Fql%2Foptimizer%2Fppr%2FPartitionExpressionForMetastore.java",
                "raw_url": "https://github.com/apache/hive/raw/60027bb9c91a93affcfebd9068f064bc1f2a74c9/ql%2Fsrc%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhive%2Fql%2Foptimizer%2Fppr%2FPartitionExpressionForMetastore.java",
                "contents_url": "https://api.github.com/repos/apache/hive/contents/ql%2Fsrc%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhive%2Fql%2Foptimizer%2Fppr%2FPartitionExpressionForMetastore.java?ref=60027bb9c91a93affcfebd9068f064bc1f2a74c9",
                "patch": "@@ -37,7 +37,6 @@\n import org.apache.hadoop.hive.ql.parse.SemanticException;\n import org.apache.hadoop.hive.ql.plan.ExprNodeDesc;\n import org.apache.hadoop.hive.ql.plan.ExprNodeDescUtils;\n-import org.apache.hadoop.hive.ql.plan.ExprNodeGenericFuncDesc;\n import org.apache.hadoop.hive.serde2.typeinfo.PrimitiveTypeInfo;\n import org.apache.hadoop.hive.serde2.typeinfo.TypeInfoFactory;\n import org.slf4j.Logger;\n@@ -108,7 +107,7 @@ public boolean filterPartitionsByExpr(List<FieldSchema> partColumns,\n   private ExprNodeDesc deserializeExpr(byte[] exprBytes) throws MetaException {\n     ExprNodeDesc expr = null;\n     try {\n-      expr = SerializationUtilities.deserializeObjectWithTypeInformation(exprBytes);\n+      expr = SerializationUtilities.deserializeObjectWithTypeInformation(exprBytes, true);\n     } catch (Exception ex) {\n       LOG.error(\"Failed to deserialize the expression\", ex);\n       throw new MetaException(ex.getMessage());"
            },
            {
                "sha": "5d58e09a57154aa860936034f43a98b8675b8e80",
                "filename": "ql/src/test/org/apache/hadoop/hive/ql/exec/TestSerializationUtilities.java",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/apache/hive/blob/60027bb9c91a93affcfebd9068f064bc1f2a74c9/ql%2Fsrc%2Ftest%2Forg%2Fapache%2Fhadoop%2Fhive%2Fql%2Fexec%2FTestSerializationUtilities.java",
                "raw_url": "https://github.com/apache/hive/raw/60027bb9c91a93affcfebd9068f064bc1f2a74c9/ql%2Fsrc%2Ftest%2Forg%2Fapache%2Fhadoop%2Fhive%2Fql%2Fexec%2FTestSerializationUtilities.java",
                "contents_url": "https://api.github.com/repos/apache/hive/contents/ql%2Fsrc%2Ftest%2Forg%2Fapache%2Fhadoop%2Fhive%2Fql%2Fexec%2FTestSerializationUtilities.java?ref=60027bb9c91a93affcfebd9068f064bc1f2a74c9",
                "patch": "@@ -22,6 +22,7 @@\n import java.io.IOException;\n import java.io.InputStream;\n import java.util.ArrayList;\n+import java.util.Arrays;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n@@ -32,10 +33,16 @@\n import org.apache.hadoop.hive.conf.HiveConf;\n import org.apache.hadoop.hive.ql.io.orc.OrcInputFormat;\n import org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat;\n+import org.apache.hadoop.hive.ql.plan.ExprNodeColumnDesc;\n+import org.apache.hadoop.hive.ql.plan.ExprNodeDesc;\n+import org.apache.hadoop.hive.ql.plan.ExprNodeDescUtils;\n+import org.apache.hadoop.hive.ql.plan.ExprNodeGenericFuncDesc;\n import org.apache.hadoop.hive.ql.plan.MapWork;\n import org.apache.hadoop.hive.ql.plan.PartitionDesc;\n import org.apache.hadoop.hive.ql.plan.TableDesc;\n import org.apache.hadoop.hive.ql.plan.VectorPartitionDesc;\n+import org.apache.hadoop.hive.ql.udf.generic.GenericUDFOPNull;\n+import org.apache.hadoop.hive.serde2.typeinfo.TypeInfoFactory;\n import org.junit.Assert;\n import org.junit.Test;\n \n@@ -127,6 +134,25 @@ public void testSkippingAppliesToAllPartitions() throws Exception {\n     assertPartitionDescPropertyPresence(mapWork, \"/warehouse/test_table/p=1\", \"serialization.ddl\", false);\n   }\n \n+  @Test\n+  public void testUnsupportedDeserialization() throws Exception {\n+    ArrayList<Long> invalidExpr = new ArrayList<>();\n+    invalidExpr.add(1L);\n+    byte[] buf = SerializationUtilities.serializeObjectWithTypeInformation(invalidExpr);\n+    try {\n+      SerializationUtilities.deserializeObjectWithTypeInformation(buf, true);\n+      Assert.fail(\"Should throw exception as the input is not a valid filter\");\n+    } catch (UnsupportedOperationException e) {\n+      // ignore\n+    }\n+\n+    ExprNodeDesc validExpr = ExprNodeGenericFuncDesc.newInstance(new GenericUDFOPNull(),\n+        Arrays.asList(new ExprNodeColumnDesc(new ColumnInfo(\"_c0\", TypeInfoFactory.stringTypeInfo, \"a\", false))));\n+    buf = SerializationUtilities.serializeObjectWithTypeInformation(validExpr);\n+    ExprNodeDesc desc = SerializationUtilities.deserializeObjectWithTypeInformation(buf, true);\n+    Assert.assertTrue(ExprNodeDescUtils.isSame(validExpr, desc));\n+  }\n+\n   private MapWork doSerDeser(Configuration configuration) throws Exception, IOException {\n     MapWork mapWork = mockMapWorkWithSomePartitionDescProperties();\n     ByteArrayOutputStream baos = new ByteArrayOutputStream();"
            },
            {
                "sha": "9fe936d26ed10b9230d39364282b93a7a6d7aeba",
                "filename": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java",
                "status": "modified",
                "additions": 1,
                "deletions": 20,
                "changes": 21,
                "blob_url": "https://github.com/apache/hive/blob/60027bb9c91a93affcfebd9068f064bc1f2a74c9/standalone-metastore%2Fmetastore-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhive%2Fmetastore%2FObjectStore.java",
                "raw_url": "https://github.com/apache/hive/raw/60027bb9c91a93affcfebd9068f064bc1f2a74c9/standalone-metastore%2Fmetastore-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhive%2Fmetastore%2FObjectStore.java",
                "contents_url": "https://api.github.com/repos/apache/hive/contents/standalone-metastore%2Fmetastore-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhive%2Fmetastore%2FObjectStore.java?ref=60027bb9c91a93affcfebd9068f064bc1f2a74c9",
                "patch": "@@ -422,7 +422,7 @@ private void initialize() {\n     isInitialized = pm != null;\n     if (isInitialized) {\n       dbType = determineDatabaseProduct();\n-      expressionProxy = createExpressionProxy(conf);\n+      expressionProxy = PartFilterExprUtil.createExpressionProxy(conf);\n       if (MetastoreConf.getBoolVar(getConf(), ConfVars.TRY_DIRECT_SQL)) {\n         String schema = PersistenceManagerProvider.getProperty(\"javax.jdo.mapping.Schema\");\n         schema = org.apache.commons.lang3.StringUtils.defaultIfBlank(schema, null);\n@@ -447,25 +447,6 @@ private static String getProductName(PersistenceManager pm) {\n     }\n   }\n \n-  /**\n-   * Creates the proxy used to evaluate expressions. This is here to prevent circular\n-   * dependency - ql -&gt; metastore client &lt;-&gt metastore server -&gt ql. If server and\n-   * client are split, this can be removed.\n-   * @param conf Configuration.\n-   * @return The partition expression proxy.\n-   */\n-  private static PartitionExpressionProxy createExpressionProxy(Configuration conf) {\n-    String className = MetastoreConf.getVar(conf, ConfVars.EXPRESSION_PROXY_CLASS);\n-    try {\n-      Class<? extends PartitionExpressionProxy> clazz =\n-           JavaUtils.getClass(className, PartitionExpressionProxy.class);\n-      return JavaUtils.newInstance(clazz, new Class<?>[0], new Object[0]);\n-    } catch (MetaException e) {\n-      LOG.error(\"Error loading PartitionExpressionProxy\", e);\n-      throw new RuntimeException(\"Error loading PartitionExpressionProxy: \" + e.getMessage());\n-    }\n-  }\n-\n   /**\n    * Configure SSL encryption to the database store.\n    *"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/usmannasir/cyberpanel/commits/6778ad1eaae41f72365da8fd021f9a60369600dc",
        "url": "https://api.github.com/repos/usmannasir/cyberpanel/commits/6778ad1eaae41f72365da8fd021f9a60369600dc",
        "html_url": "https://github.com/usmannasir/cyberpanel/commit/6778ad1eaae41f72365da8fd021f9a60369600dc",
        "message": "restart mysql",
        "files": [
            {
                "sha": "f4c8a13c3444d1ecaa86ed84c766416eb7c32a50",
                "filename": "databases/views.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/usmannasir/cyberpanel/blob/6778ad1eaae41f72365da8fd021f9a60369600dc/databases%2Fviews.py",
                "raw_url": "https://github.com/usmannasir/cyberpanel/raw/6778ad1eaae41f72365da8fd021f9a60369600dc/databases%2Fviews.py",
                "contents_url": "https://api.github.com/repos/usmannasir/cyberpanel/contents/databases%2Fviews.py?ref=6778ad1eaae41f72365da8fd021f9a60369600dc",
                "patch": "@@ -400,7 +400,6 @@ def getMysqlstatus(request):\n def restartMySQL(request):\n     try:\n         userID = request.session['userID']\n-        finalData = mysqlUtilities.restartMySQL()\n         currentACL = ACLManager.loadedACL(userID)\n \n         if currentACL['admin'] == 1:\n@@ -410,6 +409,8 @@ def restartMySQL(request):\n \n         data = {}\n \n+        finalData = mysqlUtilities.restartMySQL()\n+\n         data['status'] = finalData[0]\n         data['error_message'] = finalData[1]\n         json_data = json.dumps(data)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/afe92dbf4321f107012690d476685603d1ccb013",
        "url": "https://api.github.com/repos/librenms/librenms/commits/afe92dbf4321f107012690d476685603d1ccb013",
        "html_url": "https://github.com/librenms/librenms/commit/afe92dbf4321f107012690d476685603d1ccb013",
        "message": "Fix various display name xss (#16723)\n\nhttps://github.com/librenms/librenms/security/advisories/GHSA-pm8j-3v64-92cq",
        "files": [
            {
                "sha": "53ec2a687bb30e04d30d4bebf4b273cd5f188a86",
                "filename": "LibreNMS/Util/Url.php",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/librenms/librenms/blob/afe92dbf4321f107012690d476685603d1ccb013/LibreNMS%2FUtil%2FUrl.php",
                "raw_url": "https://github.com/librenms/librenms/raw/afe92dbf4321f107012690d476685603d1ccb013/LibreNMS%2FUtil%2FUrl.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/LibreNMS%2FUtil%2FUrl.php?ref=afe92dbf4321f107012690d476685603d1ccb013",
                "patch": "@@ -147,9 +147,10 @@ public static function portLink($port, $text = null, $type = null, $overlib = tr\n             $text = $label;\n         }\n \n-        $content = '<div class=list-large>' . addslashes(htmlentities($port->device?->displayName() . ' - ' . $label)) . '</div>';\n+        // strip tags due to complexity of sanitizing here\n+        $content = '<div class=list-large>' . addslashes(htmlentities(strip_tags($port->device?->displayName() . ' - ' . $label))) . '</div>';\n         if ($description = $port->getDescription()) {\n-            $content .= addslashes(htmlentities($description)) . '<br />';\n+            $content .= addslashes(htmlentities(strip_tags($description))) . '<br />';\n         }\n \n         $content .= \"<div style=\\'width: 850px\\'>\";"
            },
            {
                "sha": "d54b05e0dd632849d1eff2e141f31710084b83f9",
                "filename": "app/Http/Controllers/Table/PortsController.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/librenms/librenms/blob/afe92dbf4321f107012690d476685603d1ccb013/app%2FHttp%2FControllers%2FTable%2FPortsController.php",
                "raw_url": "https://github.com/librenms/librenms/raw/afe92dbf4321f107012690d476685603d1ccb013/app%2FHttp%2FControllers%2FTable%2FPortsController.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/app%2FHttp%2FControllers%2FTable%2FPortsController.php?ref=afe92dbf4321f107012690d476685603d1ccb013",
                "patch": "@@ -168,7 +168,7 @@ public function formatItem($port)\n             'ifInErrors_delta' => $port->poll_period ? Number::formatSi($port->ifInErrors_delta / $port->poll_period, 2, 3, 'EPS') : '',\n             'ifOutErrors_delta' => $port->poll_period ? Number::formatSi($port->ifOutErrors_delta / $port->poll_period, 2, 3, 'EPS') : '',\n             'ifType' => Rewrite::normalizeIfType($port->ifType),\n-            'ifAlias' => $port->ifAlias,\n+            'ifAlias' => htmlentities($port->ifAlias),\n             'actions' => (string) view('port.actions', ['port' => $port]),\n         ];\n     }"
            },
            {
                "sha": "d1f3892df34512b60abaa2eeeac2e925ff4f5670",
                "filename": "includes/html/pages/apps.inc.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/librenms/librenms/blob/afe92dbf4321f107012690d476685603d1ccb013/includes%2Fhtml%2Fpages%2Fapps.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/afe92dbf4321f107012690d476685603d1ccb013/includes%2Fhtml%2Fpages%2Fapps.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fapps.inc.php?ref=afe92dbf4321f107012690d476685603d1ccb013",
                "patch": "@@ -645,7 +645,7 @@\n         echo \"<span class='pagemenu-selected'>\";\n     }\n     echo $app_state_info;\n-    echo generate_link($app->displayName(), ['page' => 'apps', 'app' => $app->app_type]);\n+    echo generate_link(htmlentities($app->displayName()), ['page' => 'apps', 'app' => $app->app_type]);\n     if ($vars['app'] == $app->app_type) {\n         echo '</span>';\n     }"
            },
            {
                "sha": "e9b67fba585ba326256e94bd42f7c2264fcfa973",
                "filename": "includes/html/pages/apps/overview.inc.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/librenms/librenms/blob/afe92dbf4321f107012690d476685603d1ccb013/includes%2Fhtml%2Fpages%2Fapps%2Foverview.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/afe92dbf4321f107012690d476685603d1ccb013/includes%2Fhtml%2Fpages%2Fapps%2Foverview.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fapps%2Foverview.inc.php?ref=afe92dbf4321f107012690d476685603d1ccb013",
                "patch": "@@ -16,7 +16,7 @@\n     echo '<div style=\"clear: both;\">';\n     echo $index > 0 ? '<hr />' : '';\n     $index++;\n-    echo '<h4>' . generate_link($groupedApps->first()->displayName(), ['page' => 'apps', 'app' => $type]) . '</h4>';\n+    echo '<h4>' . generate_link(htmlentities($groupedApps->first()->displayName()), ['page' => 'apps', 'app' => $type]) . '</h4>';\n     /** @var \\Illuminate\\Support\\Collection $groupedApps */\n     $groupedApps = $groupedApps->sortBy(function ($app) {\n         return $app->device->hostname;\n@@ -35,15 +35,15 @@\n         $app_state = \\LibreNMS\\Util\\Html::appStateIcon($app->app_state);\n         $app_state_info = '<font color=\"' . $app_state['color'] . '\"><i title=\"' . $app_state['hover_text'] . '\" class=\"fa ' . $app_state['icon'] . ' fa-fw fa-lg\" aria-hidden=\"true\"></i></font>';\n \n-        $overlib_link = '<span style=\"float:left; margin-left: 10px; font-weight: bold;\">' . $app_state_info . optional($app->device)->shortDisplayName() . '</span>';\n+        $overlib_link = '<span style=\"float:left; margin-left: 10px; font-weight: bold;\">' . $app_state_info . htmlentities($app->device?->shortDisplayName() ?? '') . '</span>';\n         if (! empty($app->app_instance)) {\n             $overlib_link .= '<span style=\"float:right; margin-right: 10px; font-weight: bold;\">' . $app->app_instance . '</span>';\n             $content_add = '(' . $app->app_instance . ')';\n         }\n \n         $overlib_link .= '<br/>';\n         $overlib_link .= \\LibreNMS\\Util\\Url::graphTag($graph_array);\n-        $overlib_content = generate_overlib_content($graph_array, optional($app->device)->displayName() . ' - ' . $app->displayName() . $content_add);\n+        $overlib_content = generate_overlib_content($graph_array, htmlentities($app->device?->shortDisplayName() ?? '') . ' - ' . htmlentities($app->displayName()) . $content_add);\n \n         echo \"<div style='display: block; padding: 1px; padding-top: 3px; margin: 2px; min-width: \" . $width_div . 'px; max-width:' . $width_div . \"px; min-height:165px; max-height:165px;\n                       text-align: center; float: left;'>\";"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ZOO-Project/ZOO-Project/commits/641cb18fec58de43a3468f314e5f8808c560e6d9",
        "url": "https://api.github.com/repos/ZOO-Project/ZOO-Project/commits/641cb18fec58de43a3468f314e5f8808c560e6d9",
        "html_url": "https://github.com/ZOO-Project/ZOO-Project/commit/641cb18fec58de43a3468f314e5f8808c560e6d9",
        "message": "Secure the way files are accessed\n\nFix issue when using the file:// protocol relying on allowedPaths parameters\n\nUpdate documentation to add the allowedPaths parameter",
        "files": [
            {
                "sha": "770dd83b219befbf3259b616165723c4a3c3762c",
                "filename": "docs/kernel/configuration.rst",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/ZOO-Project/ZOO-Project/blob/641cb18fec58de43a3468f314e5f8808c560e6d9/docs%2Fkernel%2Fconfiguration.rst",
                "raw_url": "https://github.com/ZOO-Project/ZOO-Project/raw/641cb18fec58de43a3468f314e5f8808c560e6d9/docs%2Fkernel%2Fconfiguration.rst",
                "contents_url": "https://api.github.com/repos/ZOO-Project/ZOO-Project/contents/docs%2Fkernel%2Fconfiguration.rst?ref=641cb18fec58de43a3468f314e5f8808c560e6d9",
                "patch": "@@ -107,6 +107,9 @@ The main.cfg ``[main]`` section parameters are explained bellow.\n   section, then the response codes list given will be considered as\n   valid response code when downloading input data (sample value:\n   ``404,400``).\n+* ``allowedPaths``: if this parameter is present, then the files using the\n+  file:// protocol will be checked against the list of allowed paths. The \n+  list of allowed paths should be separated by a coma.\n \n .. warning:: \n   The ``libPath`` parameter is currently only recognized by services implemented"
            },
            {
                "sha": "1607a09c07f907cf0e6d189310606c5284c5d702",
                "filename": "zoo-project/zoo-kernel/caching.c",
                "status": "modified",
                "additions": 25,
                "deletions": 0,
                "changes": 25,
                "blob_url": "https://github.com/ZOO-Project/ZOO-Project/blob/641cb18fec58de43a3468f314e5f8808c560e6d9/zoo-project%2Fzoo-kernel%2Fcaching.c",
                "raw_url": "https://github.com/ZOO-Project/ZOO-Project/raw/641cb18fec58de43a3468f314e5f8808c560e6d9/zoo-project%2Fzoo-kernel%2Fcaching.c",
                "contents_url": "https://api.github.com/repos/ZOO-Project/ZOO-Project/contents/zoo-project%2Fzoo-kernel%2Fcaching.c?ref=641cb18fec58de43a3468f314e5f8808c560e6d9",
                "patch": "@@ -670,6 +670,31 @@ int runHttpRequests(maps** m,maps** inputs,HINTERNET* hInternet,map** error){\n   return hasAFailure;\n }\n \n+/**\n+ * Ensure that the file:// protocol is used only for allowed paths.\n+ *\n+ * @param pmsConf the maps containing the settings of the main.cfg file\n+ * @param pccPath the path to check\n+ * @return true if the path is accessible, false otherwise\n+ */\n+bool isAllowedPath(maps* pmsConf,const char* pccPath){\n+  map* pmAccessiblePaths=getMapFromMaps(pmsConf,\"main\",\"allowedPaths\");\n+  if(pmAccessiblePaths!=NULL){\n+    char *pcTmp=zStrdup(pmAccessiblePaths->value);\n+    char *pcToken, *pcSavePtr;\n+    pcToken=strtok_r(pcTmp,\",\",&pcSavePtr);\n+    while(pcToken!=NULL){\n+      if(strstr(pccPath,pcToken)!=NULL){\n+        free(pcTmp);\n+        return true;\n+      }\n+      pcToken=strtok_r(NULL,\",\",&pcSavePtr);\n+    }\n+    free(pcTmp);\n+  }\n+  return false;\n+}\n+\n /**\n  * Add a request in the download queue\n  *"
            },
            {
                "sha": "e3e3ae6ca07e96b0fbd834ba22aa2016b2d0cdb6",
                "filename": "zoo-project/zoo-kernel/caching.h",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/ZOO-Project/ZOO-Project/blob/641cb18fec58de43a3468f314e5f8808c560e6d9/zoo-project%2Fzoo-kernel%2Fcaching.h",
                "raw_url": "https://github.com/ZOO-Project/ZOO-Project/raw/641cb18fec58de43a3468f314e5f8808c560e6d9/zoo-project%2Fzoo-kernel%2Fcaching.h",
                "contents_url": "https://api.github.com/repos/ZOO-Project/ZOO-Project/contents/zoo-project%2Fzoo-kernel%2Fcaching.h?ref=641cb18fec58de43a3468f314e5f8808c560e6d9",
                "patch": "@@ -31,6 +31,7 @@ extern \"C\" {\n \n   void addToCache(maps*,char*,char*,char*,int,char*,size_t);\n   char* isInCache(maps*,char*);\n+  bool isAllowedPath(maps*,const char*);\n   int runHttpRequests(maps**,maps**,HINTERNET*,map**);\n   void addRequestToQueue(maps**,HINTERNET*,const char*,bool);\n   int loadRemoteFile(maps**,map**,HINTERNET*,char*);"
            },
            {
                "sha": "78e91c5f64d7ba0978a706eacf94befba6136906",
                "filename": "zoo-project/zoo-kernel/request_parser.c",
                "status": "modified",
                "additions": 16,
                "deletions": 8,
                "changes": 24,
                "blob_url": "https://github.com/ZOO-Project/ZOO-Project/blob/641cb18fec58de43a3468f314e5f8808c560e6d9/zoo-project%2Fzoo-kernel%2Frequest_parser.c",
                "raw_url": "https://github.com/ZOO-Project/ZOO-Project/raw/641cb18fec58de43a3468f314e5f8808c560e6d9/zoo-project%2Fzoo-kernel%2Frequest_parser.c",
                "contents_url": "https://api.github.com/repos/ZOO-Project/ZOO-Project/contents/zoo-project%2Fzoo-kernel%2Frequest_parser.c?ref=641cb18fec58de43a3468f314e5f8808c560e6d9",
                "patch": "@@ -305,15 +305,23 @@ int kvpParseInputs(maps** pmsConf,service* s,map *request_inputs,maps** request_\n             addToMap (tmpmaps->content, tmpn1, tmpv1 + 1);\n           else if (tmpv1 != NULL){\n             char *tmpx2 = url_decode (tmpv1 + 1);\n-            if (strncasecmp (tmpx2, \"http://\", 7) != 0 &&\n-              strncasecmp (tmpx2, \"ftp://\", 6) != 0 &&\n-              strncasecmp (tmpx2, \"https://\", 8) != 0 &&\n-              strncasecmp (tmpx2, \"file://\", 7) != 0){\n+            bool bIsAllowedPath = isAllowedPath(*pmsConf,tmpx2);\n+            if ((strncasecmp (tmpx2, \"http://\", 7) != 0 &&\n+                strncasecmp (tmpx2, \"ftp://\", 6) != 0 &&\n+                strncasecmp (tmpx2, \"https://\", 8) != 0 &&\n+                strncasecmp (tmpx2, \"file://\", 7) != 0)\n+                ||\n+                (strncasecmp (tmpx2, \"file://\", 7) == 0 && !bIsAllowedPath)){\n               char emsg[1024];\n-              sprintf (emsg,\n-                _\n-                (\"Unable to find a valid protocol to download the remote file %s\"),\n-                tmpv1 + 1);\n+              if(strncasecmp (tmpx2, \"file://\", 7) == 0 && !bIsAllowedPath){\n+                sprintf (emsg,\n+                  _(\"Access to the provided file URL is not allowed %s\"),\n+                  tmpv1 + 1);\n+              }else{\n+                sprintf (emsg,\n+                  _(\"Unable to find a valid protocol to download the remote file %s\"),\n+                  tmpv1 + 1);\n+              }\n               free (inputs_as_text);\n               free(cursor_input);\n               free(tmp);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cli/cli/commits/1136764c369aaf0cae4ec2ee09dc35d871076932",
        "url": "https://api.github.com/repos/cli/cli/commits/1136764c369aaf0cae4ec2ee09dc35d871076932",
        "html_url": "https://github.com/cli/cli/commit/1136764c369aaf0cae4ec2ee09dc35d871076932",
        "message": "Merge commit from fork\n\nThe fix",
        "files": [
            {
                "sha": "8f25e84a228b539ed75294a91064ec44bbcf766a",
                "filename": "pkg/cmd/run/download/download.go",
                "status": "modified",
                "additions": 29,
                "deletions": 2,
                "changes": 31,
                "blob_url": "https://github.com/cli/cli/blob/1136764c369aaf0cae4ec2ee09dc35d871076932/pkg%2Fcmd%2Frun%2Fdownload%2Fdownload.go",
                "raw_url": "https://github.com/cli/cli/raw/1136764c369aaf0cae4ec2ee09dc35d871076932/pkg%2Fcmd%2Frun%2Fdownload%2Fdownload.go",
                "contents_url": "https://api.github.com/repos/cli/cli/contents/pkg%2Fcmd%2Frun%2Fdownload%2Fdownload.go?ref=1136764c369aaf0cae4ec2ee09dc35d871076932",
                "patch": "@@ -151,8 +151,10 @@ func runDownload(opts *DownloadOptions) error {\n \topts.IO.StartProgressIndicator()\n \tdefer opts.IO.StopProgressIndicator()\n \n-\t// track downloaded artifacts and avoid re-downloading any of the same name\n+\t// track downloaded artifacts and avoid re-downloading any of the same name, isolate if multiple artifacts\n \tdownloaded := set.NewStringSet()\n+\tisolateArtifacts := isolateArtifacts(wantNames, wantPatterns)\n+\n \tfor _, a := range artifacts {\n \t\tif a.Expired {\n \t\t\tcontinue\n@@ -165,10 +167,16 @@ func runDownload(opts *DownloadOptions) error {\n \t\t\t\tcontinue\n \t\t\t}\n \t\t}\n+\n \t\tdestDir := opts.DestinationDir\n-\t\tif len(wantPatterns) != 0 || len(wantNames) != 1 {\n+\t\tif isolateArtifacts {\n \t\t\tdestDir = filepath.Join(destDir, a.Name)\n \t\t}\n+\n+\t\tif !filepathDescendsFrom(destDir, opts.DestinationDir) {\n+\t\t\treturn fmt.Errorf(\"error downloading %s: would result in path traversal\", a.Name)\n+\t\t}\n+\n \t\terr := opts.Platform.Download(a.DownloadURL, destDir)\n \t\tif err != nil {\n \t\t\treturn fmt.Errorf(\"error downloading %s: %w\", a.Name, err)\n@@ -183,6 +191,25 @@ func runDownload(opts *DownloadOptions) error {\n \treturn nil\n }\n \n+func isolateArtifacts(wantNames []string, wantPatterns []string) bool {\n+\tif len(wantPatterns) > 0 {\n+\t\t// Patterns can match multiple artifacts\n+\t\treturn true\n+\t}\n+\n+\tif len(wantNames) == 0 {\n+\t\t// All artifacts wanted regardless what they are named\n+\t\treturn true\n+\t}\n+\n+\tif len(wantNames) > 1 {\n+\t\t// Multiple, specific artifacts wanted\n+\t\treturn true\n+\t}\n+\n+\treturn false\n+}\n+\n func matchAnyName(names []string, name string) bool {\n \tfor _, n := range names {\n \t\tif name == n {"
            },
            {
                "sha": "aeab2027893877803655eb61b59f2a6dd4127a14",
                "filename": "pkg/cmd/run/download/download_test.go",
                "status": "modified",
                "additions": 500,
                "deletions": 123,
                "changes": 623,
                "blob_url": "https://github.com/cli/cli/blob/1136764c369aaf0cae4ec2ee09dc35d871076932/pkg%2Fcmd%2Frun%2Fdownload%2Fdownload_test.go",
                "raw_url": "https://github.com/cli/cli/raw/1136764c369aaf0cae4ec2ee09dc35d871076932/pkg%2Fcmd%2Frun%2Fdownload%2Fdownload_test.go",
                "contents_url": "https://api.github.com/repos/cli/cli/contents/pkg%2Fcmd%2Frun%2Fdownload%2Fdownload_test.go?ref=1136764c369aaf0cae4ec2ee09dc35d871076932",
                "patch": "@@ -2,8 +2,11 @@ package download\n \n import (\n \t\"bytes\"\n+\t\"errors\"\n+\t\"fmt\"\n \t\"io\"\n \t\"net/http\"\n+\t\"os\"\n \t\"path/filepath\"\n \t\"testing\"\n \n@@ -14,7 +17,6 @@ import (\n \t\"github.com/cli/cli/v2/pkg/iostreams\"\n \t\"github.com/google/shlex\"\n \t\"github.com/stretchr/testify/assert\"\n-\t\"github.com/stretchr/testify/mock\"\n \t\"github.com/stretchr/testify/require\"\n )\n \n@@ -143,159 +145,537 @@ func Test_NewCmdDownload(t *testing.T) {\n \t}\n }\n \n+type testArtifact struct {\n+\tartifact shared.Artifact\n+\tfiles    []string\n+}\n+\n+type fakePlatform struct {\n+\trunArtifacts map[string][]testArtifact\n+}\n+\n+func (f *fakePlatform) List(runID string) ([]shared.Artifact, error) {\n+\tvar runIds []string\n+\tif runID != \"\" {\n+\t\trunIds = []string{runID}\n+\t} else {\n+\t\tfor k := range f.runArtifacts {\n+\t\t\trunIds = append(runIds, k)\n+\t\t}\n+\t}\n+\n+\tvar artifacts []shared.Artifact\n+\tfor _, id := range runIds {\n+\t\tfor _, a := range f.runArtifacts[id] {\n+\t\t\tartifacts = append(artifacts, a.artifact)\n+\t\t}\n+\t}\n+\n+\treturn artifacts, nil\n+}\n+\n+func (f *fakePlatform) Download(url string, dir string) error {\n+\tif err := os.MkdirAll(dir, 0755); err != nil {\n+\t\treturn err\n+\t}\n+\t// Now to be consistent, we find the artifact with the provided URL.\n+\t// It's a bit janky to iterate the runs, to find the right artifact\n+\t// rather than keying directly to it, but it allows the setup of the\n+\t// fake platform to be declarative rather than imperative.\n+\t// Think fakePlatform { artifacts: ... } rather than fakePlatform.makeArtifactAvailable()\n+\tfor _, testArtifacts := range f.runArtifacts {\n+\t\tfor _, testArtifact := range testArtifacts {\n+\t\t\tif testArtifact.artifact.DownloadURL == url {\n+\t\t\t\tfor _, file := range testArtifact.files {\n+\t\t\t\t\tpath := filepath.Join(dir, file)\n+\t\t\t\t\treturn os.WriteFile(path, []byte{}, 0600)\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\treturn errors.New(\"no artifact matches the provided URL\")\n+}\n+\n func Test_runDownload(t *testing.T) {\n \ttests := []struct {\n-\t\tname        string\n-\t\topts        DownloadOptions\n-\t\tmockAPI     func(*mockPlatform)\n-\t\tpromptStubs func(*prompter.MockPrompter)\n-\t\twantErr     string\n+\t\tname          string\n+\t\topts          DownloadOptions\n+\t\tplatform      *fakePlatform\n+\t\tpromptStubs   func(*prompter.MockPrompter)\n+\t\texpectedFiles []string\n+\t\twantErr       string\n \t}{\n \t\t{\n-\t\t\tname: \"download non-expired\",\n+\t\t\tname: \"download non-expired to relative directory\",\n \t\t\topts: DownloadOptions{\n \t\t\t\tRunID:          \"2345\",\n \t\t\t\tDestinationDir: \"./tmp\",\n-\t\t\t\tNames:          []string(nil),\n \t\t\t},\n-\t\t\tmockAPI: func(p *mockPlatform) {\n-\t\t\t\tp.On(\"List\", \"2345\").Return([]shared.Artifact{\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-1\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n-\t\t\t\t\t\tExpired:     false,\n-\t\t\t\t\t},\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"expired-artifact\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/expired.zip\",\n-\t\t\t\t\t\tExpired:     true,\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"expired-artifact\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/expired.zip\",\n+\t\t\t\t\t\t\t\tExpired:     true,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"expired\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-2\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-2\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n-\t\t\t\t\t\tExpired:     false,\n-\t\t\t\t\t},\n-\t\t\t\t}, nil)\n-\t\t\t\tp.On(\"Download\", \"http://download.com/artifact1.zip\", filepath.FromSlash(\"tmp/artifact-1\")).Return(nil)\n-\t\t\t\tp.On(\"Download\", \"http://download.com/artifact2.zip\", filepath.FromSlash(\"tmp/artifact-2\")).Return(nil)\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\texpectedFiles: []string{\n+\t\t\t\tfilepath.Join(\"artifact-1\", \"artifact-1-file\"),\n+\t\t\t\tfilepath.Join(\"artifact-2\", \"artifact-2-file\"),\n \t\t\t},\n \t\t},\n \t\t{\n-\t\t\tname: \"no valid artifacts\",\n+\t\t\tname: \"download non-expired to absolute directory\",\n \t\t\topts: DownloadOptions{\n \t\t\t\tRunID:          \"2345\",\n-\t\t\t\tDestinationDir: \".\",\n-\t\t\t\tNames:          []string(nil),\n+\t\t\t\tDestinationDir: \"/tmp\",\n \t\t\t},\n-\t\t\tmockAPI: func(p *mockPlatform) {\n-\t\t\t\tp.On(\"List\", \"2345\").Return([]shared.Artifact{\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-1\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n-\t\t\t\t\t\tExpired:     true,\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"expired-artifact\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/expired.zip\",\n+\t\t\t\t\t\t\t\tExpired:     true,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"expired\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-2\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-2\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n-\t\t\t\t\t\tExpired:     true,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\texpectedFiles: []string{\n+\t\t\t\tfilepath.Join(\"artifact-1\", \"artifact-1-file\"),\n+\t\t\t\tfilepath.Join(\"artifact-2\", \"artifact-2-file\"),\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname: \"all artifacts are expired\",\n+\t\t\topts: DownloadOptions{\n+\t\t\t\tRunID: \"2345\",\n+\t\t\t},\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     true,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-2\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     true,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t}, nil)\n+\t\t\t\t},\n \t\t\t},\n-\t\t\twantErr: \"no valid artifacts found to download\",\n+\t\t\texpectedFiles: []string{},\n+\t\t\twantErr:       \"no valid artifacts found to download\",\n \t\t},\n \t\t{\n \t\t\tname: \"no name matches\",\n \t\t\topts: DownloadOptions{\n-\t\t\t\tRunID:          \"2345\",\n-\t\t\t\tDestinationDir: \".\",\n-\t\t\t\tNames:          []string{\"artifact-3\"},\n-\t\t\t},\n-\t\t\tmockAPI: func(p *mockPlatform) {\n-\t\t\t\tp.On(\"List\", \"2345\").Return([]shared.Artifact{\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-1\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n-\t\t\t\t\t\tExpired:     false,\n+\t\t\t\tRunID: \"2345\",\n+\t\t\t\tNames: []string{\"artifact-3\"},\n+\t\t\t},\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-2\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-2\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n-\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\texpectedFiles: []string{},\n+\t\t\twantErr:       \"no artifact matches any of the names or patterns provided\",\n+\t\t},\n+\t\t{\n+\t\t\tname: \"pattern matches\",\n+\t\t\topts: DownloadOptions{\n+\t\t\t\tRunID:        \"2345\",\n+\t\t\t\tFilePatterns: []string{\"artifact-*\"},\n+\t\t\t},\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"non-artifact-2\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/non-artifact-2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"non-artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-3\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact3.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-3-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t}, nil)\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\texpectedFiles: []string{\n+\t\t\t\tfilepath.Join(\"artifact-1\", \"artifact-1-file\"),\n+\t\t\t\tfilepath.Join(\"artifact-3\", \"artifact-3-file\"),\n \t\t\t},\n-\t\t\twantErr: \"no artifact matches any of the names or patterns provided\",\n \t\t},\n \t\t{\n \t\t\tname: \"no pattern matches\",\n \t\t\topts: DownloadOptions{\n-\t\t\t\tRunID:          \"2345\",\n-\t\t\t\tDestinationDir: \".\",\n-\t\t\t\tFilePatterns:   []string{\"artifiction-*\"},\n-\t\t\t},\n-\t\t\tmockAPI: func(p *mockPlatform) {\n-\t\t\t\tp.On(\"List\", \"2345\").Return([]shared.Artifact{\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-1\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n-\t\t\t\t\t\tExpired:     false,\n+\t\t\t\tRunID:        \"2345\",\n+\t\t\t\tFilePatterns: []string{\"artifiction-*\"},\n+\t\t\t},\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-2\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-2\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n-\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\texpectedFiles: []string{},\n+\t\t\twantErr:       \"no artifact matches any of the names or patterns provided\",\n+\t\t},\n+\t\t{\n+\t\t\tname: \"want specific single artifact\",\n+\t\t\topts: DownloadOptions{\n+\t\t\t\tRunID: \"2345\",\n+\t\t\t\tNames: []string{\"non-artifact-2\"},\n+\t\t\t},\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"non-artifact-2\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/non-artifact-2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"non-artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-3\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact3.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-3-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t}, nil)\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\texpectedFiles: []string{\n+\t\t\t\tfilepath.Join(\"non-artifact-2-file\"),\n \t\t\t},\n-\t\t\twantErr: \"no artifact matches any of the names or patterns provided\",\n \t\t},\n \t\t{\n-\t\t\tname: \"prompt to select artifact\",\n+\t\t\tname: \"want specific multiple artifacts\",\n \t\t\topts: DownloadOptions{\n-\t\t\t\tRunID:          \"\",\n-\t\t\t\tDoPrompt:       true,\n-\t\t\t\tDestinationDir: \".\",\n-\t\t\t\tNames:          []string(nil),\n+\t\t\t\tRunID: \"2345\",\n+\t\t\t\tNames: []string{\"artifact-1\", \"artifact-3\"},\n \t\t\t},\n-\t\t\tmockAPI: func(p *mockPlatform) {\n-\t\t\t\tp.On(\"List\", \"\").Return([]shared.Artifact{\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-1\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n-\t\t\t\t\t\tExpired:     false,\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"non-artifact-2\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/non-artifact-2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"non-artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-3\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact3.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-3-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"expired-artifact\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/expired.zip\",\n-\t\t\t\t\t\tExpired:     true,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\texpectedFiles: []string{\n+\t\t\t\tfilepath.Join(\"artifact-1\", \"artifact-1-file\"),\n+\t\t\t\tfilepath.Join(\"artifact-3\", \"artifact-3-file\"),\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname: \"avoid redownloading files of the same name\",\n+\t\t\topts: DownloadOptions{\n+\t\t\t\tRunID: \"2345\",\n+\t\t\t},\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-2\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n-\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\texpectedFiles: []string{\n+\t\t\t\tfilepath.Join(\"artifact-1\", \"artifact-1-file\"),\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname: \"prompt to select artifact\",\n+\t\t\topts: DownloadOptions{\n+\t\t\t\tRunID:    \"\",\n+\t\t\t\tDoPrompt: true,\n+\t\t\t\tNames:    []string(nil),\n+\t\t\t},\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-1\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-1-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"expired-artifact\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/expired.zip\",\n+\t\t\t\t\t\t\t\tExpired:     true,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"expired\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t\t{\n-\t\t\t\t\t\tName:        \"artifact-2\",\n-\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.also.zip\",\n-\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\"6789\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"artifact-2\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact2.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"artifact-2-file\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n \t\t\t\t\t},\n-\t\t\t\t}, nil)\n-\t\t\t\tp.On(\"Download\", \"http://download.com/artifact2.zip\", \".\").Return(nil)\n+\t\t\t\t},\n \t\t\t},\n \t\t\tpromptStubs: func(pm *prompter.MockPrompter) {\n \t\t\t\tpm.RegisterMultiSelect(\"Select artifacts to download:\", nil, []string{\"artifact-1\", \"artifact-2\"},\n \t\t\t\t\tfunc(_ string, _, opts []string) ([]int, error) {\n-\t\t\t\t\t\treturn []int{1}, nil\n+\t\t\t\t\t\tfor i, o := range opts {\n+\t\t\t\t\t\t\tif o == \"artifact-2\" {\n+\t\t\t\t\t\t\t\treturn []int{i}, nil\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\treturn nil, fmt.Errorf(\"no artifact-2 found in %v\", opts)\n \t\t\t\t\t})\n \t\t\t},\n+\t\t\texpectedFiles: []string{\n+\t\t\t\tfilepath.Join(\"artifact-2-file\"),\n+\t\t\t},\n+\t\t},\n+\t\t{\n+\t\t\tname: \"handling artifact name with path traversal exploit\",\n+\t\t\topts: DownloadOptions{\n+\t\t\t\tRunID: \"2345\",\n+\t\t\t},\n+\t\t\tplatform: &fakePlatform{\n+\t\t\t\trunArtifacts: map[string][]testArtifact{\n+\t\t\t\t\t\"2345\": {\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tartifact: shared.Artifact{\n+\t\t\t\t\t\t\t\tName:        \"..\",\n+\t\t\t\t\t\t\t\tDownloadURL: \"http://download.com/artifact1.zip\",\n+\t\t\t\t\t\t\t\tExpired:     false,\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tfiles: []string{\n+\t\t\t\t\t\t\t\t\"etc/passwd\",\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t},\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\texpectedFiles: []string{},\n+\t\t\twantErr:       \"error downloading ..: would result in path traversal\",\n \t\t},\n \t}\n \tfor _, tt := range tests {\n \t\tt.Run(tt.name, func(t *testing.T) {\n \t\t\topts := &tt.opts\n+\t\t\tif opts.DestinationDir == \"\" {\n+\t\t\t\topts.DestinationDir = t.TempDir()\n+\t\t\t} else {\n+\t\t\t\topts.DestinationDir = filepath.Join(t.TempDir(), opts.DestinationDir)\n+\t\t\t}\n+\n \t\t\tios, _, stdout, stderr := iostreams.Test()\n \t\t\topts.IO = ios\n-\t\t\topts.Platform = newMockPlatform(t, tt.mockAPI)\n+\t\t\topts.Platform = tt.platform\n \n \t\t\tpm := prompter.NewMockPrompter(t)\n \t\t\topts.Prompter = pm\n@@ -310,34 +690,31 @@ func Test_runDownload(t *testing.T) {\n \t\t\t\trequire.NoError(t, err)\n \t\t\t}\n \n+\t\t\t// Check that the exact number of files exist\n+\t\t\trequire.Equal(t, len(tt.expectedFiles), countFilesInDirRecursively(t, opts.DestinationDir))\n+\n+\t\t\t// Then check that the exact files are correct\n+\t\t\tfor _, name := range tt.expectedFiles {\n+\t\t\t\trequire.FileExists(t, filepath.Join(opts.DestinationDir, name))\n+\t\t\t}\n+\n \t\t\tassert.Equal(t, \"\", stdout.String())\n \t\t\tassert.Equal(t, \"\", stderr.String())\n \t\t})\n \t}\n }\n \n-type mockPlatform struct {\n-\tmock.Mock\n-}\n+func countFilesInDirRecursively(t *testing.T, dir string) int {\n+\tt.Helper()\n \n-func newMockPlatform(t *testing.T, config func(*mockPlatform)) *mockPlatform {\n-\tm := &mockPlatform{}\n-\tm.Test(t)\n-\tt.Cleanup(func() {\n-\t\tm.AssertExpectations(t)\n-\t})\n-\tif config != nil {\n-\t\tconfig(m)\n-\t}\n-\treturn m\n-}\n-\n-func (p *mockPlatform) List(runID string) ([]shared.Artifact, error) {\n-\targs := p.Called(runID)\n-\treturn args.Get(0).([]shared.Artifact), args.Error(1)\n-}\n+\tcount := 0\n+\trequire.NoError(t, filepath.Walk(dir, func(_ string, info os.FileInfo, err error) error {\n+\t\trequire.NoError(t, err)\n+\t\tif !info.IsDir() {\n+\t\t\tcount++\n+\t\t}\n+\t\treturn nil\n+\t}))\n \n-func (p *mockPlatform) Download(url string, dir string) error {\n-\targs := p.Called(url, dir)\n-\treturn args.Error(0)\n+\treturn count\n }"
            },
            {
                "sha": "a68b75fd6b7f1e76aac5d15862878ac9a52f2341",
                "filename": "pkg/cmd/run/download/zip.go",
                "status": "modified",
                "additions": 18,
                "deletions": 6,
                "changes": 24,
                "blob_url": "https://github.com/cli/cli/blob/1136764c369aaf0cae4ec2ee09dc35d871076932/pkg%2Fcmd%2Frun%2Fdownload%2Fzip.go",
                "raw_url": "https://github.com/cli/cli/raw/1136764c369aaf0cae4ec2ee09dc35d871076932/pkg%2Fcmd%2Frun%2Fdownload%2Fzip.go",
                "contents_url": "https://api.github.com/repos/cli/cli/contents/pkg%2Fcmd%2Frun%2Fdownload%2Fzip.go?ref=1136764c369aaf0cae4ec2ee09dc35d871076932",
                "patch": "@@ -71,13 +71,25 @@ func getPerm(m os.FileMode) os.FileMode {\n }\n \n func filepathDescendsFrom(p, dir string) bool {\n+\t// Regardless of the logic below, `p` is never allowed to be current directory `.` or parent directory `..`\n+\t// however we check explicitly here before filepath.Rel() which doesn't cover all cases.\n \tp = filepath.Clean(p)\n-\tdir = filepath.Clean(dir)\n-\tif dir == \".\" && !filepath.IsAbs(p) {\n-\t\treturn !strings.HasPrefix(p, \"..\"+string(filepath.Separator))\n+\n+\tif p == \".\" || p == \"..\" {\n+\t\treturn false\n \t}\n-\tif !strings.HasSuffix(dir, string(filepath.Separator)) {\n-\t\tdir += string(filepath.Separator)\n+\n+\t// filepathDescendsFrom() takes advantage of filepath.Rel() to determine if `p` is descended from `dir`:\n+\t//\n+\t// 1. filepath.Rel() calculates a path to traversal from fictious `dir` to `p`.\n+\t// 2. filepath.Rel() errors in a handful of cases where absolute and relative paths are compared as well as certain traversal edge cases\n+\t//    For more information, https://github.com/golang/go/blob/00709919d09904b17cfe3bfeb35521cbd3fb04f8/src/path/filepath/path_test.go#L1510-L1515\n+\t// 3. If the path to traverse `dir` to `p` requires `..`, then we know it is not descend from / contained in `dir`\n+\t//\n+\t// As-is, this function requires the caller to ensure `p` and `dir` are either 1) both relative or 2) both absolute.\n+\trelativePath, err := filepath.Rel(dir, p)\n+\tif err != nil {\n+\t\treturn false\n \t}\n-\treturn strings.HasPrefix(p, dir)\n+\treturn !strings.HasPrefix(relativePath, \"..\")\n }"
            },
            {
                "sha": "b85122ec57a2afcb6176fd3ed708dfed5d45696e",
                "filename": "pkg/cmd/run/download/zip_test.go",
                "status": "modified",
                "additions": 80,
                "deletions": 0,
                "changes": 80,
                "blob_url": "https://github.com/cli/cli/blob/1136764c369aaf0cae4ec2ee09dc35d871076932/pkg%2Fcmd%2Frun%2Fdownload%2Fzip_test.go",
                "raw_url": "https://github.com/cli/cli/raw/1136764c369aaf0cae4ec2ee09dc35d871076932/pkg%2Fcmd%2Frun%2Fdownload%2Fzip_test.go",
                "contents_url": "https://api.github.com/repos/cli/cli/contents/pkg%2Fcmd%2Frun%2Fdownload%2Fzip_test.go?ref=1136764c369aaf0cae4ec2ee09dc35d871076932",
                "patch": "@@ -130,6 +130,86 @@ func Test_filepathDescendsFrom(t *testing.T) {\n \t\t\t},\n \t\t\twant: false,\n \t\t},\n+\t\t{\n+\t\t\tname: \"deny parent directory filename (`..`) escaping absolute directory\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\"..\"),\n+\t\t\t\tdir: filepath.FromSlash(\"/var/logs/\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"deny parent directory filename (`..`) escaping current directory\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\"..\"),\n+\t\t\t\tdir: filepath.FromSlash(\".\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"deny parent directory filename (`..`) escaping parent directory\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\"..\"),\n+\t\t\t\tdir: filepath.FromSlash(\"..\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"deny parent directory filename (`..`) escaping relative directory\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\"..\"),\n+\t\t\t\tdir: filepath.FromSlash(\"relative-dir\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"deny current directory filename (`.`) in absolute directory\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\".\"),\n+\t\t\t\tdir: filepath.FromSlash(\"/var/logs/\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"deny current directory filename (`.`) in current directory\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\".\"),\n+\t\t\t\tdir: filepath.FromSlash(\".\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"deny current directory filename (`.`) in parent directory\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\".\"),\n+\t\t\t\tdir: filepath.FromSlash(\"..\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"deny current directory filename (`.`) in relative directory\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\".\"),\n+\t\t\t\tdir: filepath.FromSlash(\"relative-dir\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"relative path, absolute dir\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\"whatever\"),\n+\t\t\t\tdir: filepath.FromSlash(\"/a/b/c\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"absolute path, relative dir\",\n+\t\t\targs: args{\n+\t\t\t\tp:   filepath.FromSlash(\"/a/b/c\"),\n+\t\t\t\tdir: filepath.FromSlash(\"whatever\"),\n+\t\t\t},\n+\t\t\twant: false,\n+\t\t},\n \t}\n \tfor _, tt := range tests {\n \t\tt.Run(tt.name, func(t *testing.T) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/MISP/MISP/commits/e02c2b864a85d14d64adf9f878f9c7b2bdd15173",
        "url": "https://api.github.com/repos/MISP/MISP/commits/e02c2b864a85d14d64adf9f878f9c7b2bdd15173",
        "html_url": "https://github.com/MISP/MISP/commit/e02c2b864a85d14d64adf9f878f9c7b2bdd15173",
        "message": "fix: [security] Fixed stored XSS in editor interface for ad-hoc workflows\n\n- As reported by fukusuket (Fukusuke Takahashi)",
        "files": [
            {
                "sha": "ad7d6eedda65ecbaefe6f29ed508c5d8c0747ddb",
                "filename": "app/webroot/js/workflows-editor/workflows-editor.js",
                "status": "modified",
                "additions": 23,
                "deletions": 23,
                "changes": 46,
                "blob_url": "https://github.com/MISP/MISP/blob/e02c2b864a85d14d64adf9f878f9c7b2bdd15173/app%2Fwebroot%2Fjs%2Fworkflows-editor%2Fworkflows-editor.js",
                "raw_url": "https://github.com/MISP/MISP/raw/e02c2b864a85d14d64adf9f878f9c7b2bdd15173/app%2Fwebroot%2Fjs%2Fworkflows-editor%2Fworkflows-editor.js",
                "contents_url": "https://api.github.com/repos/MISP/MISP/contents/app%2Fwebroot%2Fjs%2Fworkflows-editor%2Fworkflows-editor.js?ref=e02c2b864a85d14d64adf9f878f9c7b2bdd15173",
                "patch": "@@ -1,15 +1,15 @@\n var dotBlock_default = doT.template(' \\\n-<div class=\"canvas-workflow-block {{? it.module_data.is_misp_module }} is-misp-module {{?}}\" data-nodeuid=\"{{=it.node_uid}}\"> \\\n+<div class=\"canvas-workflow-block {{? it.module_data.is_misp_module }} is-misp-module {{?}}\" data-nodeuid=\"{{!it.node_uid}}\"> \\\n     <div style=\"width: 100%;\"> \\\n         <div class=\"default-main-container\"> \\\n             {{? it.module_data.icon }} \\\n-                <i class=\"fa-fw fa-{{=it.module_data.icon}} {{=it.module_data.icon_class}}\"></i> \\\n+                <i class=\"fa-fw fa-{{!it.module_data.icon}} {{!it.module_data.icon_class}}\"></i> \\\n             {{?}} \\\n             {{? it.module_data.icon_path }} \\\n-                <span style=\"display: flex; height: 1em;\"><img src=\"/img/{{=it.module_data.icon_path}}\" alt=\"Icon of {{=it.module_data.name}}\" width=\"18\" height=\"18\" style=\"margin: auto 0; filter: grayscale(1);\"></span> \\\n+                <span style=\"display: flex; height: 1em;\"><img src=\"/img/{{!it.module_data.icon_path}}\" alt=\"Icon of {{!it.module_data.name}}\" width=\"18\" height=\"18\" style=\"margin: auto 0; filter: grayscale(1);\"></span> \\\n             {{?}} \\\n             <strong style=\"margin-left: 0.25em;\"> \\\n-                {{=it.module_data.name}} \\\n+                {{!it.module_data.name}} \\\n             </strong> \\\n             {{? it.module_data.is_misp_module }} \\\n                 <sup class=\"is-misp-module\"></sup> \\\n@@ -29,23 +29,23 @@ var dotBlock_default = doT.template(' \\\n                 </span> \\\n             </span> \\\n         </div> \\\n-        <div class=\"muted\" class=\"description\" style=\"margin-bottom: 0.5em;\">{{=it.module_data.description}}</div> \\\n+        <div class=\"muted\" class=\"description\" style=\"margin-bottom: 0.5em;\">{{!it.module_data.description}}</div> \\\n         {{=it._node_param_html}} \\\n     </div> \\\n </div>')\n \n var dotBlock_trigger = doT.template(' \\\n-<div class=\"canvas-workflow-block\" data-nodeuid=\"{{=it.node_uid}}\"> \\\n+<div class=\"canvas-workflow-block\" data-nodeuid=\"{{!it.node_uid}}\"> \\\n     <div style=\"width: 100%;\"> \\\n         <div class=\"default-main-container\" style=\"border:none;\"> \\\n             {{? it.module_data.icon }} \\\n-                <i class=\"fa-fw fa-{{=it.module_data.icon}} {{=it.module_data.icon_class}}\"></i> \\\n+                <i class=\"fa-fw fa-{{!it.module_data.icon}} {{!it.module_data.icon_class}}\"></i> \\\n             {{?}} \\\n             {{? it.module_data.icon_path }} \\\n-                <span style=\"display: flex; height: 1em;\"><img src=\"/img/{{=it.module_data.icon_path}}\" alt=\"Icon of {{=it.module_data.name}}\" width=\"18\" height=\"18\" style=\"margin: auto 0;\"></span> \\\n+                <span style=\"display: flex; height: 1em;\"><img src=\"/img/{{!it.module_data.icon_path}}\" alt=\"Icon of {{!it.module_data.name}}\" width=\"18\" height=\"18\" style=\"margin: auto 0;\"></span> \\\n             {{?}} \\\n             <strong style=\"margin-left: 0.25em;\"> \\\n-                {{=it.module_data.name}} \\\n+                {{!it.module_data.name}} \\\n             </strong> \\\n             <span style=\"margin-left: auto; display: flex; align-items: center; gap: 3px;\"> \\\n                 {{? it.module_data.blocking }} \\\n@@ -69,23 +69,23 @@ var dotBlock_trigger = doT.template(' \\\n                 {{?}} \\\n             </span> \\\n         </div> \\\n-        <div class=\"muted\" class=\"description\" style=\"margin-bottom: 0.5em;\">{{=it.module_data.description}}</div> \\\n+        <div class=\"muted\" class=\"description\" style=\"margin-bottom: 0.5em;\">{{!it.module_data.description}}</div> \\\n         {{=it._node_param_html}} \\\n     </div> \\\n </div>')\n \n var dotBlock_if = doT.template(' \\\n-<div class=\"canvas-workflow-block\" data-nodeuid=\"{{=it.node_uid}}\"> \\\n+<div class=\"canvas-workflow-block\" data-nodeuid=\"{{!it.node_uid}}\"> \\\n     <div style=\"width: 100%;\"> \\\n         <div class=\"default-main-container\"> \\\n             {{? it.module_data.icon }} \\\n-                <i class=\"fa-fw fa-{{=it.module_data.icon}} {{=it.module_data.icon_class}}\"></i> \\\n+                <i class=\"fa-fw fa-{{!it.module_data.icon}} {{!it.module_data.icon_class}}\"></i> \\\n             {{?}} \\\n             {{? it.module_data.icon_path }} \\\n-                <span style=\"display: flex; height: 1em;\"><img src=\"/img/{{=it.module_data.icon_path}}\" alt=\"Icon of {{=it.module_data.name}}\" width=\"18\" height=\"18\" style=\"margin: auto 0;\"></span> \\\n+                <span style=\"display: flex; height: 1em;\"><img src=\"/img/{{!it.module_data.icon_path}}\" alt=\"Icon of {{!it.module_data.name}}\" width=\"18\" height=\"18\" style=\"margin: auto 0;\"></span> \\\n             {{?}} \\\n             <strong style=\"margin-left: 0.25em;\"> \\\n-                {{=it.module_data.name}} \\\n+                {{!it.module_data.name}} \\\n             </strong> \\\n             <span style=\"margin-left: auto;\"> \\\n                 <span class=\"block-notification-container\"> \\\n@@ -101,17 +101,17 @@ var dotBlock_if = doT.template(' \\\n </div>')\n \n var dotBlock_concurrent = doT.template(' \\\n-<div class=\"canvas-workflow-block\" data-nodeuid=\"{{=it.node_uid}}\"> \\\n+<div class=\"canvas-workflow-block\" data-nodeuid=\"{{!it.node_uid}}\"> \\\n     <div style=\"width: 100%;\"> \\\n         <div class=\"default-main-container\"> \\\n             {{? it.module_data.icon }} \\\n-                <i class=\"fa-fw fa-{{=it.module_data.icon}} {{=it.module_data.icon_class}}\"></i> \\\n+                <i class=\"fa-fw fa-{{!it.module_data.icon}} {{!it.module_data.icon_class}}\"></i> \\\n             {{?}} \\\n             {{? it.module_data.icon_path }} \\\n-                <span style=\"display: flex; height: 1em;\"><img src=\"/img/{{=it.module_data.icon_path}}\" alt=\"Icon of {{=it.module_data.name}}\" width=\"18\" height=\"18\" style=\"margin: auto 0;\"></span> \\\n+                <span style=\"display: flex; height: 1em;\"><img src=\"/img/{{!it.module_data.icon_path}}\" alt=\"Icon of {{!it.module_data.name}}\" width=\"18\" height=\"18\" style=\"margin: auto 0;\"></span> \\\n             {{?}} \\\n             <strong style=\"margin-left: 0.25em;\"> \\\n-                {{=it.module_data.name}} \\\n+                {{!it.module_data.name}} \\\n             </strong> \\\n             <span style=\"margin-left: auto;\"> \\\n                 <span class=\"block-notification-container\"> \\\n@@ -123,21 +123,21 @@ var dotBlock_concurrent = doT.template(' \\\n             </span> \\\n         </div> \\\n         {{=it._node_param_html}} \\\n-        <div class=\"muted\" class=\"description\" style=\"margin-bottom: 0.5em;\">{{=it.module_data.description}}</div> \\\n+        <div class=\"muted\" class=\"description\" style=\"margin-bottom: 0.5em;\">{{!it.module_data.description}}</div> \\\n     </div> \\\n </div>')\n \n var dotBlock_error = doT.template(' \\\n-<div class=\"canvas-workflow-block\" data-nodeuid=\"{{=it.node_uid}}\"> \\\n+<div class=\"canvas-workflow-block\" data-nodeuid=\"{{!it.node_uid}}\"> \\\n     <div style=\"width: 100%;\"> \\\n-        <div class=\"alert alert-danger\">{{=it.error}}</div> \\\n+        <div class=\"alert alert-danger\">{{!it.error}}</div> \\\n         <div>Data:</div> \\\n-        <textarea rows=6 style=\"width: 95%;\">{{=it.data}}</textarea> \\\n+        <textarea rows=6 style=\"width: 95%;\">{{!it.data}}</textarea> \\\n     </div> \\\n </div>')\n \n var dotBlock_connectionLabel = doT.template(' \\\n-<span class=\"label label-{{=it.variant}}\" id=\"{{=it.id}}\">{{=it.name}}</span>')\n+<span class=\"label label-{{!it.variant}}\" id=\"{{!it.id}}\">{{!it.name}}</span>')\n \n var classBySeverity = {\n     'info': 'info',"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/MISP/MISP/commits/d0330989e235a8a9f43c90817896de87a589ef7d",
        "url": "https://api.github.com/repos/MISP/MISP/commits/d0330989e235a8a9f43c90817896de87a589ef7d",
        "html_url": "https://github.com/MISP/MISP/commit/d0330989e235a8a9f43c90817896de87a589ef7d",
        "message": "fix: [security] Fixed stored xss when exporting custom clusters into the misp-galaxy format\n\n- As reported by fukusuket (Fukusuke Takahashi)",
        "files": [
            {
                "sha": "dfa4b64431ee86b54fc6440ae07de0c75a9dfe74",
                "filename": "app/View/GalaxyClusters/cluster_export_misp_galaxy.ctp",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/MISP/MISP/blob/d0330989e235a8a9f43c90817896de87a589ef7d/app%2FView%2FGalaxyClusters%2Fcluster_export_misp_galaxy.ctp",
                "raw_url": "https://github.com/MISP/MISP/raw/d0330989e235a8a9f43c90817896de87a589ef7d/app%2FView%2FGalaxyClusters%2Fcluster_export_misp_galaxy.ctp",
                "contents_url": "https://api.github.com/repos/MISP/MISP/contents/app%2FView%2FGalaxyClusters%2Fcluster_export_misp_galaxy.ctp?ref=d0330989e235a8a9f43c90817896de87a589ef7d",
                "patch": "@@ -5,7 +5,7 @@\n         <p>This JSON can be added added to the <code class=\"quickSelect\">misp-galaxy/clusters/<?= h($cluster['GalaxyCluster']['type']) ?>.json</code>.</p>\n         <p>Don't forget to bump the <code>version</code> specified at the end of the <code><?= h($cluster['GalaxyCluster']['type']) ?>.json</code> file.</p>\n \n-        <pre class=\"quickSelect\"><?= JsonTool::encode($convertedCluster, true) ?></pre>\n+        <pre class=\"quickSelect\"><?= JsonTool::encode(h($convertedCluster), true) ?></pre>\n     </div>\n </div>\n <?= $this->element('/genericElements/SideMenu/side_menu', ['menuList' => 'galaxies', 'menuItem' => 'view_cluster']);\n\\ No newline at end of file"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vitessio/vitess/commits/2b71d1b5f8ca676beeab2875525003cd45096217",
        "url": "https://api.github.com/repos/vitessio/vitess/commits/2b71d1b5f8ca676beeab2875525003cd45096217",
        "html_url": "https://github.com/vitessio/vitess/commit/2b71d1b5f8ca676beeab2875525003cd45096217",
        "message": "Merge commit from fork\n\nThese templates were rendered using text/template which is fundamentally\nbroken as it would allow for trivial HTML injection.\n\nInstead render using safehtml/template so that we have automatic\nescaping.\n\nSigned-off-by: Dirkjan Bussink <d.bussink@gmail.com>",
        "files": [
            {
                "sha": "7213353432df10bb532923f3765f2bb8d2e419c5",
                "filename": "go/vt/vtgate/debugenv.go",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/vitessio/vitess/blob/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvtgate%2Fdebugenv.go",
                "raw_url": "https://github.com/vitessio/vitess/raw/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvtgate%2Fdebugenv.go",
                "contents_url": "https://api.github.com/repos/vitessio/vitess/contents/go%2Fvt%2Fvtgate%2Fdebugenv.go?ref=2b71d1b5f8ca676beeab2875525003cd45096217",
                "patch": "@@ -22,9 +22,10 @@ import (\n \t\"html\"\n \t\"net/http\"\n \t\"strconv\"\n-\t\"text/template\"\n \t\"time\"\n \n+\t\"github.com/google/safehtml/template\"\n+\n \t\"vitess.io/vitess/go/acl\"\n \t\"vitess.io/vitess/go/vt/discovery\"\n \t\"vitess.io/vitess/go/vt/log\""
            },
            {
                "sha": "05d301f28be46ea339663e5d463055dc1f3baeb3",
                "filename": "go/vt/vtgate/querylogz.go",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/vitessio/vitess/blob/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvtgate%2Fquerylogz.go",
                "raw_url": "https://github.com/vitessio/vitess/raw/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvtgate%2Fquerylogz.go",
                "contents_url": "https://api.github.com/repos/vitessio/vitess/contents/go%2Fvt%2Fvtgate%2Fquerylogz.go?ref=2b71d1b5f8ca676beeab2875525003cd45096217",
                "patch": "@@ -20,15 +20,15 @@ import (\n \t\"net/http\"\n \t\"strconv\"\n \t\"strings\"\n-\t\"text/template\"\n \t\"time\"\n \n-\t\"vitess.io/vitess/go/vt/vtgate/logstats\"\n+\t\"github.com/google/safehtml/template\"\n \n \t\"vitess.io/vitess/go/acl\"\n \t\"vitess.io/vitess/go/vt/log\"\n \t\"vitess.io/vitess/go/vt/logz\"\n \t\"vitess.io/vitess/go/vt/sqlparser\"\n+\t\"vitess.io/vitess/go/vt/vtgate/logstats\"\n )\n \n var ("
            },
            {
                "sha": "9236b2ac8406ad70d7ece9240187394fe73c0f14",
                "filename": "go/vt/vtgate/querylogz_test.go",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/vitessio/vitess/blob/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvtgate%2Fquerylogz_test.go",
                "raw_url": "https://github.com/vitessio/vitess/raw/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvtgate%2Fquerylogz_test.go",
                "contents_url": "https://api.github.com/repos/vitessio/vitess/contents/go%2Fvt%2Fvtgate%2Fquerylogz_test.go?ref=2b71d1b5f8ca676beeab2875525003cd45096217",
                "patch": "@@ -35,7 +35,7 @@ import (\n \n func TestQuerylogzHandlerFormatting(t *testing.T) {\n \treq, _ := http.NewRequest(\"GET\", \"/querylogz?timeout=10&limit=1\", nil)\n-\tlogStats := logstats.NewLogStats(context.Background(), \"Execute\", \"select name from test_table limit 1000\", \"suuid\", nil)\n+\tlogStats := logstats.NewLogStats(context.Background(), \"Execute\", \"select name, 'inject <script>alert();</script>' from test_table limit 1000\", \"suuid\", nil)\n \tlogStats.StmtType = \"select\"\n \tlogStats.RowsAffected = 1000\n \tlogStats.ShardQueries = 1\n@@ -64,7 +64,7 @@ func TestQuerylogzHandlerFormatting(t *testing.T) {\n \t\t`<td>0.002</td>`,\n \t\t`<td>0.003</td>`,\n \t\t`<td>select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>1000</td>`,\n \t\t`<td></td>`,\n@@ -94,7 +94,7 @@ func TestQuerylogzHandlerFormatting(t *testing.T) {\n \t\t`<td>0.002</td>`,\n \t\t`<td>0.003</td>`,\n \t\t`<td>select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>1000</td>`,\n \t\t`<td></td>`,\n@@ -124,7 +124,7 @@ func TestQuerylogzHandlerFormatting(t *testing.T) {\n \t\t`<td>0.002</td>`,\n \t\t`<td>0.003</td>`,\n \t\t`<td>select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>1000</td>`,\n \t\t`<td></td>`,"
            },
            {
                "sha": "6f1ea854ea9479f7bde84c3ebfeaf486dda75112",
                "filename": "go/vt/vttablet/tabletserver/debugenv.go",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/vitessio/vitess/blob/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvttablet%2Ftabletserver%2Fdebugenv.go",
                "raw_url": "https://github.com/vitessio/vitess/raw/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvttablet%2Ftabletserver%2Fdebugenv.go",
                "contents_url": "https://api.github.com/repos/vitessio/vitess/contents/go%2Fvt%2Fvttablet%2Ftabletserver%2Fdebugenv.go?ref=2b71d1b5f8ca676beeab2875525003cd45096217",
                "patch": "@@ -23,9 +23,10 @@ import (\n \t\"html\"\n \t\"net/http\"\n \t\"strconv\"\n-\t\"text/template\"\n \t\"time\"\n \n+\t\"github.com/google/safehtml/template\"\n+\n \t\"vitess.io/vitess/go/acl\"\n \t\"vitess.io/vitess/go/vt/log\"\n )"
            },
            {
                "sha": "09f375aa3292eca8c2c172b5abf6805c3097efae",
                "filename": "go/vt/vttablet/tabletserver/querylogz.go",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/vitessio/vitess/blob/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvttablet%2Ftabletserver%2Fquerylogz.go",
                "raw_url": "https://github.com/vitessio/vitess/raw/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvttablet%2Ftabletserver%2Fquerylogz.go",
                "contents_url": "https://api.github.com/repos/vitessio/vitess/contents/go%2Fvt%2Fvttablet%2Ftabletserver%2Fquerylogz.go?ref=2b71d1b5f8ca676beeab2875525003cd45096217",
                "patch": "@@ -20,9 +20,10 @@ import (\n \t\"net/http\"\n \t\"strconv\"\n \t\"strings\"\n-\t\"text/template\"\n \t\"time\"\n \n+\t\"github.com/google/safehtml/template\"\n+\n \t\"vitess.io/vitess/go/acl\"\n \t\"vitess.io/vitess/go/vt/log\"\n \t\"vitess.io/vitess/go/vt/logz\""
            },
            {
                "sha": "ee26437f330775d37679d283db29edef2d9860d6",
                "filename": "go/vt/vttablet/tabletserver/querylogz_test.go",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/vitessio/vitess/blob/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvttablet%2Ftabletserver%2Fquerylogz_test.go",
                "raw_url": "https://github.com/vitessio/vitess/raw/2b71d1b5f8ca676beeab2875525003cd45096217/go%2Fvt%2Fvttablet%2Ftabletserver%2Fquerylogz_test.go",
                "contents_url": "https://api.github.com/repos/vitessio/vitess/contents/go%2Fvt%2Fvttablet%2Ftabletserver%2Fquerylogz_test.go?ref=2b71d1b5f8ca676beeab2875525003cd45096217",
                "patch": "@@ -37,7 +37,7 @@ func TestQuerylogzHandler(t *testing.T) {\n \treq, _ := http.NewRequest(\"GET\", \"/querylogz?timeout=10&limit=1\", nil)\n \tlogStats := tabletenv.NewLogStats(context.Background(), \"Execute\")\n \tlogStats.PlanType = planbuilder.PlanSelect.String()\n-\tlogStats.OriginalSQL = \"select name from test_table limit 1000\"\n+\tlogStats.OriginalSQL = \"select name, 'inject <script>alert();</script>' from test_table limit 1000\"\n \tlogStats.RowsAffected = 1000\n \tlogStats.NumberOfQueries = 1\n \tlogStats.StartTime, _ = time.Parse(\"Jan 2 15:04:05\", \"Nov 29 13:33:09\")\n@@ -64,7 +64,7 @@ func TestQuerylogzHandler(t *testing.T) {\n \t\t`<td>0.001</td>`,\n \t\t`<td>1e-08</td>`,\n \t\t`<td>Select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>none</td>`,\n \t\t`<td>1000</td>`,\n@@ -95,7 +95,7 @@ func TestQuerylogzHandler(t *testing.T) {\n \t\t`<td>0.001</td>`,\n \t\t`<td>1e-08</td>`,\n \t\t`<td>Select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>none</td>`,\n \t\t`<td>1000</td>`,\n@@ -126,7 +126,7 @@ func TestQuerylogzHandler(t *testing.T) {\n \t\t`<td>0.001</td>`,\n \t\t`<td>1e-08</td>`,\n \t\t`<td>Select</td>`,\n-\t\t`<td>select name from test_table limit 1000</td>`,\n+\t\tregexp.QuoteMeta(`<td>select name,\u200b &#39;inject &lt;script&gt;alert()\u200b;&lt;/script&gt;&#39; from test_table limit 1000</td>`),\n \t\t`<td>1</td>`,\n \t\t`<td>none</td>`,\n \t\t`<td>1000</td>`,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/commits/27d165872847f5ae7417caf09f37edeeba741e1e",
        "url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/commits/27d165872847f5ae7417caf09f37edeeba741e1e",
        "html_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/commit/27d165872847f5ae7417caf09f37edeeba741e1e",
        "message": "Fixes a stored XSS in Recent Scans diff APK, GHSA-5jc6-h9w7-jm3p",
        "files": [
            {
                "sha": "b07aa2b954df345e107c575b3883264a737b2182",
                "filename": "mobsf/MobSF/init.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/blob/27d165872847f5ae7417caf09f37edeeba741e1e/mobsf%2FMobSF%2Finit.py",
                "raw_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/raw/27d165872847f5ae7417caf09f37edeeba741e1e/mobsf%2FMobSF%2Finit.py",
                "contents_url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/contents/mobsf%2FMobSF%2Finit.py?ref=27d165872847f5ae7417caf09f37edeeba741e1e",
                "patch": "@@ -18,7 +18,7 @@\n \n logger = logging.getLogger(__name__)\n \n-VERSION = '4.2.8'\n+VERSION = '4.2.9'\n BANNER = r\"\"\"\n   __  __       _    ____  _____       _  _    ____  \n  |  \\/  | ___ | |__/ ___||  ___|_   _| || |  |___ \\ "
            },
            {
                "sha": "68614d15fe5771820299c0c920f7d67658ba2d36",
                "filename": "mobsf/MobSF/views/home.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/blob/27d165872847f5ae7417caf09f37edeeba741e1e/mobsf%2FMobSF%2Fviews%2Fhome.py",
                "raw_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/raw/27d165872847f5ae7417caf09f37edeeba741e1e/mobsf%2FMobSF%2Fviews%2Fhome.py",
                "contents_url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/contents/mobsf%2FMobSF%2Fviews%2Fhome.py?ref=27d165872847f5ae7417caf09f37edeeba741e1e",
                "patch": "@@ -163,7 +163,7 @@ def upload(self):\n         request = self.request\n         scanning = Scanning(request)\n         content_type = self.file.content_type\n-        file_name = self.file.name\n+        file_name = sanitize_filename(self.file.name)\n         logger.info('MIME Type: %s FILE: %s', content_type, file_name)\n         if self.file_type.is_apk():\n             return scanning.scan_apk()"
            },
            {
                "sha": "ccf11335251219446df3593682b88d7574a74587",
                "filename": "mobsf/MobSF/views/scanning.py",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/blob/27d165872847f5ae7417caf09f37edeeba741e1e/mobsf%2FMobSF%2Fviews%2Fscanning.py",
                "raw_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/raw/27d165872847f5ae7417caf09f37edeeba741e1e/mobsf%2FMobSF%2Fviews%2Fscanning.py",
                "contents_url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/contents/mobsf%2FMobSF%2Fviews%2Fscanning.py?ref=27d165872847f5ae7417caf09f37edeeba741e1e",
                "patch": "@@ -8,6 +8,7 @@\n from django.utils import timezone\n \n from mobsf.StaticAnalyzer.models import RecentScansDB\n+from mobsf.MobSF.security import sanitize_filename\n \n logger = logging.getLogger(__name__)\n \n@@ -62,7 +63,8 @@ class Scanning(object):\n \n     def __init__(self, request):\n         self.file = request.FILES['file']\n-        self.file_name = request.FILES['file'].name\n+        self.file_name = sanitize_filename(\n+            request.FILES['file'].name)\n         self.data = {\n             'analyzer': 'static_analyzer',\n             'status': 'success',"
            },
            {
                "sha": "15396b1d44b060d0e0f2c6d600c19c87893d8e8d",
                "filename": "mobsf/templates/general/recent.html",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "blob_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/blob/27d165872847f5ae7417caf09f37edeeba741e1e/mobsf%2Ftemplates%2Fgeneral%2Frecent.html",
                "raw_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/raw/27d165872847f5ae7417caf09f37edeeba741e1e/mobsf%2Ftemplates%2Fgeneral%2Frecent.html",
                "contents_url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/contents/mobsf%2Ftemplates%2Fgeneral%2Frecent.html?ref=27d165872847f5ae7417caf09f37edeeba741e1e",
                "patch": "@@ -184,6 +184,18 @@ <h3 class=\"box-title\"><i class=\"fa fa-rocket\"></i> Recent Scans</h3>\n {% block extra_scripts %}\n <script src=\"{% static \"adminlte/plugins/sweetalert2/sweetalert2.min.js\" %}\"></script>\n <script>\n+\n+    // Escape HTML\n+    function escapeHtml(unsafe)\n+    {\n+        return unsafe\n+            .replace(/&/g, \"&amp;\")\n+            .replace(/</g, \"&lt;\")\n+            .replace(/>/g, \"&gt;\")\n+            .replace(/\"/g, \"&quot;\")\n+            .replace(/'/g, \"&#039;\");\n+    }\n+\n     // Diff functions\n     var diff_first_md5 = '';\n     var diff_first_name = '';\n@@ -231,7 +243,7 @@ <h3 class=\"box-title\"><i class=\"fa fa-rocket\"></i> Recent Scans</h3>\n     }\n \n     function diff_cleanup() {\n-        first_td_id = diff_first_md5 + '_' + diff_first_name;\n+        first_td_id = diff_first_md5 + '_' + escapeHtml(diff_first_name);\n         $('[id=\"' + first_td_id + '\"]').closest(\"tr\").removeClass(\"selected\");\n         $('[id=\"' + first_td_id + '\"]').closest(\"tbody\").removeClass(\"selectable_table\");\n         diff_first_md5 = \"\";\n@@ -254,8 +266,8 @@ <h3 class=\"box-title\"><i class=\"fa fa-rocket\"></i> Recent Scans</h3>\n             title: '<strong>Diff confirmation</strong>',\n             type: 'info',\n             html:\n-                '<strong>Do you want to diff - </strong><br />' + diff_first_name +\n-                '<br /> <strong>with - <br /> </strong>' + diff_second_name + ' <br /> <strong>?</strong>',\n+                '<strong>Do you want to diff - </strong><br />' + escapeHtml(diff_first_name) +\n+                '<br /> <strong>with - <br /> </strong>' + escapeHtml(diff_second_name) + ' <br /> <strong>?</strong>',\n \n             showCancelButton: true,\n             cancelButtonText: 'Cancel',"
            },
            {
                "sha": "7bfbd5ac49e69f6b6e5368a8b12c8d86a0b593da",
                "filename": "pyproject.toml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/blob/27d165872847f5ae7417caf09f37edeeba741e1e/pyproject.toml",
                "raw_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/raw/27d165872847f5ae7417caf09f37edeeba741e1e/pyproject.toml",
                "contents_url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/contents/pyproject.toml?ref=27d165872847f5ae7417caf09f37edeeba741e1e",
                "patch": "@@ -1,6 +1,6 @@\n [tool.poetry]\n name = \"mobsf\"\n-version = \"4.2.8\"\n+version = \"4.2.9\"\n description = \"Mobile Security Framework (MobSF) is an automated, all-in-one mobile application (Android/iOS/Windows) pen-testing, malware analysis and security assessment framework capable of performing static and dynamic analysis.\"\n keywords = [\"mobsf\", \"mobile security framework\", \"mobile security\", \"security tool\", \"static analysis\", \"dynamic analysis\", \"malware analysis\"]\n authors = [\"Ajin Abraham <ajin@opensecurity.in>\"]"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/commits/f22c584aa7d43527970c9da61eb678953cfc0a8e",
        "url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/commits/f22c584aa7d43527970c9da61eb678953cfc0a8e",
        "html_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/commit/f22c584aa7d43527970c9da61eb678953cfc0a8e",
        "message": "Fixes GHSA-m435-9v6r-v5f6",
        "files": [
            {
                "sha": "e8868ca0116817fb886615cfc801c427289c186f",
                "filename": "mobsf/StaticAnalyzer/views/android/manifest_analysis.py",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/blob/f22c584aa7d43527970c9da61eb678953cfc0a8e/mobsf%2FStaticAnalyzer%2Fviews%2Fandroid%2Fmanifest_analysis.py",
                "raw_url": "https://github.com/MobSF/Mobile-Security-Framework-MobSF/raw/f22c584aa7d43527970c9da61eb678953cfc0a8e/mobsf%2FStaticAnalyzer%2Fviews%2Fandroid%2Fmanifest_analysis.py",
                "contents_url": "https://api.github.com/repos/MobSF/Mobile-Security-Framework-MobSF/contents/mobsf%2FStaticAnalyzer%2Fviews%2Fandroid%2Fmanifest_analysis.py?ref=f22c584aa7d43527970c9da61eb678953cfc0a8e",
                "patch": "@@ -84,12 +84,15 @@ def _check_url(host, w_url):\n         status_code = 0\n \n         r = requests.get(w_url,\n-            allow_redirects=True,\n+            allow_redirects=False,\n             proxies=proxies,\n             verify=verify,\n             timeout=5)\n \n         status_code = r.status_code\n+        if status_code == 302:\n+            logger.warning('302 Redirect detected, skipping check')\n+            status = False\n         if (str(status_code).startswith('2') and iden in str(r.json())):\n             status = True\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/cd18b0ef00aad1d4a9e1c5d860cd23f80f63c505",
        "url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/cd18b0ef00aad1d4a9e1c5d860cd23f80f63c505",
        "html_url": "https://github.com/rails/rails-html-sanitizer/commit/cd18b0ef00aad1d4a9e1c5d860cd23f80f63c505",
        "message": "test: Nokogiri's HTML5 \"foreign style serialization\" issue\n\nhttps://hackerone.com/reports/2503220",
        "files": [
            {
                "sha": "e743b6f3d200b016cead423747f0d7fd763bd7a5",
                "filename": "test/sanitizer_test.rb",
                "status": "modified",
                "additions": 38,
                "deletions": 0,
                "changes": 38,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/cd18b0ef00aad1d4a9e1c5d860cd23f80f63c505/test%2Fsanitizer_test.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/cd18b0ef00aad1d4a9e1c5d860cd23f80f63c505/test%2Fsanitizer_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/test%2Fsanitizer_test.rb?ref=cd18b0ef00aad1d4a9e1c5d860cd23f80f63c505",
                "patch": "@@ -976,6 +976,34 @@ def test_combination_of_svg_and_style_with_img_payload_2\n       assert_includes(acceptable_results, actual)\n     end\n \n+    def test_combination_of_svg_and_style_with_escaped_img_payload\n+      # https://hackerone.com/reports/2503220\n+      input, tags = \"<svg><style>&lt;img src onerror=alert(1)>\", [\"svg\", \"style\"]\n+      actual = safe_list_sanitize(input, tags: tags)\n+      acceptable_results = [\n+        # libxml2\n+        \"<svg><style>&amp;lt;img src onerror=alert(1)&gt;</style></svg>\",\n+        # libgumbo\n+        \"<svg><style>&lt;img src onerror=alert(1)&gt;</style></svg>\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n+    def test_combination_of_math_and_style_with_escaped_img_payload\n+      # https://hackerone.com/reports/2503220\n+      input, tags = \"<math><style>&lt;img src onerror=alert(1)>\", [\"math\", \"style\"]\n+      actual = safe_list_sanitize(input, tags: tags)\n+      acceptable_results = [\n+        # libxml2\n+        \"<math><style>&amp;lt;img src onerror=alert(1)&gt;</style></math>\",\n+        # libgumbo\n+        \"<math><style>&lt;img src onerror=alert(1)&gt;</style></math>\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n     def test_should_sanitize_illegal_style_properties\n       raw      = %(display:block; position:absolute; left:0; top:0; width:100%; height:100%; z-index:1; background-color:black; background-image:url(http://www.ragingplatypus.com/i/cam-full.jpg); background-x:center; background-y:center; background-repeat:repeat;)\n       expected = %(display:block;width:100%;height:100%;background-color:black;background-x:center;background-y:center;)\n@@ -1075,5 +1103,15 @@ class HTML4SafeListSanitizerTest < Minitest::Test\n   class HTML5SafeListSanitizerTest < Minitest::Test\n     @module_under_test = Rails::HTML5\n     include SafeListSanitizerTest\n+\n+    def test_should_not_be_vulnerable_to_nokogiri_foreign_style_serialization_bug\n+      # https://hackerone.com/reports/2503220\n+      input = \"<svg><style>&lt;img src onerror=alert(1)>\"\n+      result = Rails::HTML5::SafeListSanitizer.new.sanitize(input, tags: [\"svg\", \"style\"])\n+      browser = Nokogiri::HTML5::Document.parse(result)\n+      xss = browser.at_xpath(\"//img/@onerror\")\n+\n+      assert_nil(xss)\n+    end\n   end if loofah_html5_support?\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/b0220b8850d52199a15f83c472d175a4122dd7b1",
        "url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/b0220b8850d52199a15f83c472d175a4122dd7b1",
        "html_url": "https://github.com/rails/rails-html-sanitizer/commit/b0220b8850d52199a15f83c472d175a4122dd7b1",
        "message": "dep: bump Nokogiri dependency to address the foreign style issue\n\nhttps://hackerone.com/reports/2503220",
        "files": [
            {
                "sha": "e3883559fd8b8c768a51af895f8047feae54a6a9",
                "filename": "Gemfile",
                "status": "modified",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/b0220b8850d52199a15f83c472d175a4122dd7b1/Gemfile",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/b0220b8850d52199a15f83c472d175a4122dd7b1/Gemfile",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/Gemfile?ref=b0220b8850d52199a15f83c472d175a4122dd7b1",
                "patch": "@@ -14,7 +14,3 @@ group :rubocop do\n   gem \"rubocop-performance\", require: false\n   gem \"rubocop-rails\", require: false\n end\n-\n-# specify gem versions for old rubies\n-gem \"nokogiri\", \">= 1.7\"\n-gem \"activesupport\", \">= 5\""
            },
            {
                "sha": "5eac85b0ba8ad984856160dcf757e7f2099183e3",
                "filename": "Gemfile.lock",
                "status": "modified",
                "additions": 4,
                "deletions": 14,
                "changes": 18,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/b0220b8850d52199a15f83c472d175a4122dd7b1/Gemfile.lock",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/b0220b8850d52199a15f83c472d175a4122dd7b1/Gemfile.lock",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/Gemfile.lock?ref=b0220b8850d52199a15f83c472d175a4122dd7b1",
                "patch": "@@ -3,7 +3,7 @@ PATH\n   specs:\n     rails-html-sanitizer (1.6.0)\n       loofah (~> 2.21)\n-      nokogiri (~> 1.14)\n+      nokogiri (>= 1.15.7, != 1.16.7, != 1.16.6, != 1.16.5, != 1.16.4, != 1.16.3, != 1.16.2, != 1.16.1, != 1.16.0.rc1, != 1.16.0)\n \n GEM\n   remote: https://rubygems.org/\n@@ -34,18 +34,10 @@ GEM\n     loofah (2.22.0)\n       crass (~> 1.0.2)\n       nokogiri (>= 1.12.0)\n+    mini_portile2 (2.8.8)\n     minitest (5.24.1)\n-    nokogiri (1.16.7-aarch64-linux)\n-      racc (~> 1.4)\n-    nokogiri (1.16.7-arm-linux)\n-      racc (~> 1.4)\n-    nokogiri (1.16.7-arm64-darwin)\n-      racc (~> 1.4)\n-    nokogiri (1.16.7-x86-linux)\n-      racc (~> 1.4)\n-    nokogiri (1.16.7-x86_64-darwin)\n-      racc (~> 1.4)\n-    nokogiri (1.16.7-x86_64-linux)\n+    nokogiri (1.16.8)\n+      mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n     parallel (1.26.2)\n     parser (3.3.4.2)\n@@ -98,9 +90,7 @@ PLATFORMS\n   x86_64-linux\n \n DEPENDENCIES\n-  activesupport (>= 5)\n   minitest\n-  nokogiri (>= 1.7)\n   rails-html-sanitizer!\n   rake\n   rubocop (>= 1.25.1)"
            },
            {
                "sha": "621a44ab2c0dc2184e5992bb8f8df296935ff755",
                "filename": "rails-html-sanitizer.gemspec",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/b0220b8850d52199a15f83c472d175a4122dd7b1/rails-html-sanitizer.gemspec",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/b0220b8850d52199a15f83c472d175a4122dd7b1/rails-html-sanitizer.gemspec",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/rails-html-sanitizer.gemspec?ref=b0220b8850d52199a15f83c472d175a4122dd7b1",
                "patch": "@@ -26,8 +26,10 @@ Gem::Specification.new do |spec|\n   spec.test_files    = Dir[\"test/**/*\"]\n   spec.require_paths = [\"lib\"]\n \n-  # NOTE: There's no need to update dependencies for CVEs in minor releases\n-  # when users can simply run `bundle update loofah`.\n   spec.add_dependency \"loofah\", \"~> 2.21\"\n-  spec.add_dependency \"nokogiri\", \"~> 1.14\"\n+\n+  # A fix was shipped in nokogiri v1.15.7 and v1.16.8 without which there is a vulnerability in this gem.\n+  spec.add_dependency \"nokogiri\", [\">=1.15.7\",\n+                                   \"!=1.16.0\", \"!=1.16.0.rc1\", \"!=1.16.1\", \"!=1.16.2\", \"!=1.16.3\",\n+                                   \"!=1.16.4\", \"!=1.16.5\", \"!=1.16.6\", \"!=1.16.7\"]\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/f02ffbb8465e73920b6de0da940f5530f855965e",
        "url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/f02ffbb8465e73920b6de0da940f5530f855965e",
        "html_url": "https://github.com/rails/rails-html-sanitizer/commit/f02ffbb8465e73920b6de0da940f5530f855965e",
        "message": "fix: Namespace confusion when disallowing 'svg' or 'math'\n\n- https://hackerone.com/reports/2519936\n- https://hackerone.com/reports/2519941\n\nAlso, test that this solution addresses namespace confusion and DOM\nmutation with 'math' + 'mtext'.",
        "files": [
            {
                "sha": "7f6fe27be598bc4e5f1eeddeee2067137090d7f4",
                "filename": "lib/rails/html/scrubbers.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/f02ffbb8465e73920b6de0da940f5530f855965e/lib%2Frails%2Fhtml%2Fscrubbers.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/f02ffbb8465e73920b6de0da940f5530f855965e/lib%2Frails%2Fhtml%2Fscrubbers.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/lib%2Frails%2Fhtml%2Fscrubbers.rb?ref=f02ffbb8465e73920b6de0da940f5530f855965e",
                "patch": "@@ -101,7 +101,11 @@ def keep_node?(node)\n         end\n \n         def scrub_node(node)\n-          node.before(node.children) unless prune # strip\n+          # If a node has a namespace, then it's a tag in either a `math` or `svg` foreign context,\n+          # and we should always prune it to avoid namespace confusion and mutation XSS vectors.\n+          unless prune || node.namespace\n+            node.before(node.children)\n+          end\n           node.remove\n         end\n "
            },
            {
                "sha": "cd21c6cce49107171aa3f4a2eec5260eee8c83eb",
                "filename": "test/sanitizer_test.rb",
                "status": "modified",
                "additions": 63,
                "deletions": 1,
                "changes": 64,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/f02ffbb8465e73920b6de0da940f5530f855965e/test%2Fsanitizer_test.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/f02ffbb8465e73920b6de0da940f5530f855965e/test%2Fsanitizer_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/test%2Fsanitizer_test.rb?ref=f02ffbb8465e73920b6de0da940f5530f855965e",
                "patch": "@@ -918,7 +918,7 @@ def test_combination_of_svg_and_style_with_script_payload\n         # libxml2\n         \"<svg><style>&lt;script&gt;alert(1)&lt;/script&gt;</style></svg>\",\n         # libgumbo\n-        \"<svg><style>alert(1)</style></svg>\"\n+        \"<svg><style></style></svg>\",\n       ]\n \n       assert_includes(acceptable_results, actual)\n@@ -976,6 +976,48 @@ def test_combination_of_svg_and_style_with_img_payload_2\n       assert_includes(acceptable_results, actual)\n     end\n \n+    def test_combination_of_style_and_disallowed_svg_with_script_payload\n+      # https://hackerone.com/reports/2519936\n+      input, tags = \"<svg><style><style class='</style><script>alert(1)</script>'>\", [\"style\"]\n+      actual = safe_list_sanitize(input, tags: tags)\n+      acceptable_results = [\n+        # libxml2\n+        \"<style>&lt;style class='</style>alert(1)'&gt;\",\n+        # libgumbo\n+        \"\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n+    def test_combination_of_style_and_disallowed_math_with_script_payload\n+      # https://hackerone.com/reports/2519936\n+      input, tags = \"<math><style><style class='</style><script>alert(1)</script>'>\", [\"style\"]\n+      actual = safe_list_sanitize(input, tags: tags)\n+      acceptable_results = [\n+        # libxml2\n+        \"<style>&lt;style class='</style>alert(1)'&gt;\",\n+        # libgumbo\n+        \"\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n+    def test_math_with_disallowed_mtext_and_img_payload\n+      # https://hackerone.com/reports/2519941\n+      input, tags = \"<math><mtext><table><mglyph><style><img src=: onerror=alert(1)>\", [\"math\", \"style\"]\n+      actual = safe_list_sanitize(input, tags: tags)\n+      acceptable_results = [\n+        # libxml2\n+        \"<math><style>&lt;img src=: onerror=alert(1)&gt;</style></math>\",\n+        # libgumbo\n+        \"<math></math>\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n     def test_should_sanitize_illegal_style_properties\n       raw      = %(display:block; position:absolute; left:0; top:0; width:100%; height:100%; z-index:1; background-color:black; background-image:url(http://www.ragingplatypus.com/i/cam-full.jpg); background-x:center; background-y:center; background-repeat:repeat;)\n       expected = %(display:block;width:100%;height:100%;background-color:black;background-x:center;background-y:center;)\n@@ -1075,5 +1117,25 @@ class HTML4SafeListSanitizerTest < Minitest::Test\n   class HTML5SafeListSanitizerTest < Minitest::Test\n     @module_under_test = Rails::HTML5\n     include SafeListSanitizerTest\n+\n+    def test_should_not_be_vulnerable_to_ns_confusion_2519936\n+      # https://hackerone.com/reports/2519936\n+      input = \"<math><style><style class='</style><script>alert(1)</script>'>\"\n+      result = Rails::HTML5::SafeListSanitizer.new.sanitize(input, tags: [\"style\"])\n+      browser = Nokogiri::HTML5::Document.parse(result)\n+      xss = browser.at_xpath(\"//script\")\n+\n+      assert_nil(xss)\n+    end\n+\n+    def test_should_not_be_vulnerable_to_ns_confusion_2519941\n+      # https://hackerone.com/reports/2519941\n+      input = \"<math><mtext><table><mglyph><style><img src=: onerror=alert(1)>\"\n+      result = Rails::HTML5::SafeListSanitizer.new.sanitize(input, tags: %w(math style))\n+      browser = Nokogiri::HTML5::Document.parse(result)\n+      xss = browser.at_xpath(\"//img/@onerror\")\n+\n+      assert_nil(xss)\n+    end\n   end if loofah_html5_support?\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/f02ffbb8465e73920b6de0da940f5530f855965e",
        "url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/f02ffbb8465e73920b6de0da940f5530f855965e",
        "html_url": "https://github.com/rails/rails-html-sanitizer/commit/f02ffbb8465e73920b6de0da940f5530f855965e",
        "message": "fix: Namespace confusion when disallowing 'svg' or 'math'\n\n- https://hackerone.com/reports/2519936\n- https://hackerone.com/reports/2519941\n\nAlso, test that this solution addresses namespace confusion and DOM\nmutation with 'math' + 'mtext'.",
        "files": [
            {
                "sha": "7f6fe27be598bc4e5f1eeddeee2067137090d7f4",
                "filename": "lib/rails/html/scrubbers.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/f02ffbb8465e73920b6de0da940f5530f855965e/lib%2Frails%2Fhtml%2Fscrubbers.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/f02ffbb8465e73920b6de0da940f5530f855965e/lib%2Frails%2Fhtml%2Fscrubbers.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/lib%2Frails%2Fhtml%2Fscrubbers.rb?ref=f02ffbb8465e73920b6de0da940f5530f855965e",
                "patch": "@@ -101,7 +101,11 @@ def keep_node?(node)\n         end\n \n         def scrub_node(node)\n-          node.before(node.children) unless prune # strip\n+          # If a node has a namespace, then it's a tag in either a `math` or `svg` foreign context,\n+          # and we should always prune it to avoid namespace confusion and mutation XSS vectors.\n+          unless prune || node.namespace\n+            node.before(node.children)\n+          end\n           node.remove\n         end\n "
            },
            {
                "sha": "cd21c6cce49107171aa3f4a2eec5260eee8c83eb",
                "filename": "test/sanitizer_test.rb",
                "status": "modified",
                "additions": 63,
                "deletions": 1,
                "changes": 64,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/f02ffbb8465e73920b6de0da940f5530f855965e/test%2Fsanitizer_test.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/f02ffbb8465e73920b6de0da940f5530f855965e/test%2Fsanitizer_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/test%2Fsanitizer_test.rb?ref=f02ffbb8465e73920b6de0da940f5530f855965e",
                "patch": "@@ -918,7 +918,7 @@ def test_combination_of_svg_and_style_with_script_payload\n         # libxml2\n         \"<svg><style>&lt;script&gt;alert(1)&lt;/script&gt;</style></svg>\",\n         # libgumbo\n-        \"<svg><style>alert(1)</style></svg>\"\n+        \"<svg><style></style></svg>\",\n       ]\n \n       assert_includes(acceptable_results, actual)\n@@ -976,6 +976,48 @@ def test_combination_of_svg_and_style_with_img_payload_2\n       assert_includes(acceptable_results, actual)\n     end\n \n+    def test_combination_of_style_and_disallowed_svg_with_script_payload\n+      # https://hackerone.com/reports/2519936\n+      input, tags = \"<svg><style><style class='</style><script>alert(1)</script>'>\", [\"style\"]\n+      actual = safe_list_sanitize(input, tags: tags)\n+      acceptable_results = [\n+        # libxml2\n+        \"<style>&lt;style class='</style>alert(1)'&gt;\",\n+        # libgumbo\n+        \"\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n+    def test_combination_of_style_and_disallowed_math_with_script_payload\n+      # https://hackerone.com/reports/2519936\n+      input, tags = \"<math><style><style class='</style><script>alert(1)</script>'>\", [\"style\"]\n+      actual = safe_list_sanitize(input, tags: tags)\n+      acceptable_results = [\n+        # libxml2\n+        \"<style>&lt;style class='</style>alert(1)'&gt;\",\n+        # libgumbo\n+        \"\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n+    def test_math_with_disallowed_mtext_and_img_payload\n+      # https://hackerone.com/reports/2519941\n+      input, tags = \"<math><mtext><table><mglyph><style><img src=: onerror=alert(1)>\", [\"math\", \"style\"]\n+      actual = safe_list_sanitize(input, tags: tags)\n+      acceptable_results = [\n+        # libxml2\n+        \"<math><style>&lt;img src=: onerror=alert(1)&gt;</style></math>\",\n+        # libgumbo\n+        \"<math></math>\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n     def test_should_sanitize_illegal_style_properties\n       raw      = %(display:block; position:absolute; left:0; top:0; width:100%; height:100%; z-index:1; background-color:black; background-image:url(http://www.ragingplatypus.com/i/cam-full.jpg); background-x:center; background-y:center; background-repeat:repeat;)\n       expected = %(display:block;width:100%;height:100%;background-color:black;background-x:center;background-y:center;)\n@@ -1075,5 +1117,25 @@ class HTML4SafeListSanitizerTest < Minitest::Test\n   class HTML5SafeListSanitizerTest < Minitest::Test\n     @module_under_test = Rails::HTML5\n     include SafeListSanitizerTest\n+\n+    def test_should_not_be_vulnerable_to_ns_confusion_2519936\n+      # https://hackerone.com/reports/2519936\n+      input = \"<math><style><style class='</style><script>alert(1)</script>'>\"\n+      result = Rails::HTML5::SafeListSanitizer.new.sanitize(input, tags: [\"style\"])\n+      browser = Nokogiri::HTML5::Document.parse(result)\n+      xss = browser.at_xpath(\"//script\")\n+\n+      assert_nil(xss)\n+    end\n+\n+    def test_should_not_be_vulnerable_to_ns_confusion_2519941\n+      # https://hackerone.com/reports/2519941\n+      input = \"<math><mtext><table><mglyph><style><img src=: onerror=alert(1)>\"\n+      result = Rails::HTML5::SafeListSanitizer.new.sanitize(input, tags: %w(math style))\n+      browser = Nokogiri::HTML5::Document.parse(result)\n+      xss = browser.at_xpath(\"//img/@onerror\")\n+\n+      assert_nil(xss)\n+    end\n   end if loofah_html5_support?\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72",
        "url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72",
        "html_url": "https://github.com/rails/rails-html-sanitizer/commit/a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72",
        "message": "fix: disallow 'mglyph' and 'malignmark' from safe lists\n\nhttps://hackerone.com/reports/2519936",
        "files": [
            {
                "sha": "724bc4458dc043149072e8552a445ec78ea38fa0",
                "filename": "lib/rails/html/scrubbers.rb",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72/lib%2Frails%2Fhtml%2Fscrubbers.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72/lib%2Frails%2Fhtml%2Fscrubbers.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/lib%2Frails%2Fhtml%2Fscrubbers.rb?ref=a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72",
                "patch": "@@ -134,6 +134,19 @@ def validate!(var, name)\n           if var && !var.is_a?(Enumerable)\n             raise ArgumentError, \"You should pass :#{name} as an Enumerable\"\n           end\n+\n+          if var && name == :tags\n+            if var.include?(\"mglyph\")\n+              warn(\"WARNING: 'mglyph' tags cannot be allowed by the PermitScrubber and will be scrubbed\")\n+              var.delete(\"mglyph\")\n+            end\n+\n+            if var.include?(\"malignmark\")\n+              warn(\"WARNING: 'malignmark' tags cannot be allowed by the PermitScrubber and will be scrubbed\")\n+              var.delete(\"malignmark\")\n+            end\n+          end\n+\n           var\n         end\n "
            },
            {
                "sha": "028ca21ff19fcd8f09421d65dd515dcd0441a27f",
                "filename": "test/sanitizer_test.rb",
                "status": "modified",
                "additions": 72,
                "deletions": 0,
                "changes": 72,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72/test%2Fsanitizer_test.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72/test%2Fsanitizer_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/test%2Fsanitizer_test.rb?ref=a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72",
                "patch": "@@ -1026,6 +1026,46 @@ def test_should_sanitize_across_newlines\n       assert_equal \"\", sanitize_css(raw)\n     end\n \n+    def test_should_prune_mglyph\n+      # https://hackerone.com/reports/2519936\n+      input = \"<math><mtext><table><mglyph><style><img src=: onerror=alert(1)>\"\n+      tags = %w(math mtext table mglyph style)\n+\n+      actual = nil\n+      assert_output(nil, /WARNING: 'mglyph' tags cannot be allowed by the PermitScrubber/) do\n+        actual = safe_list_sanitize(input, tags: tags)\n+      end\n+\n+      acceptable_results = [\n+        # libxml2\n+        \"<math><mtext><table><style>&lt;img src=: onerror=alert(1)&gt;</style></table></mtext></math>\",\n+        # libgumbo\n+        \"<math><mtext><style><img src=: onerror=alert(1)></style><table></table></mtext></math>\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n+    def test_should_prune_malignmark\n+      # https://hackerone.com/reports/2519936\n+      input = \"<math><mtext><table><malignmark><style><img src=: onerror=alert(1)>\"\n+      tags = %w(math mtext table malignmark style)\n+\n+      actual = nil\n+      assert_output(nil, /WARNING: 'malignmark' tags cannot be allowed by the PermitScrubber/) do\n+        actual = safe_list_sanitize(input, tags: tags)\n+      end\n+\n+      acceptable_results = [\n+        # libxml2\n+        \"<math><mtext><table><style>&lt;img src=: onerror=alert(1)&gt;</style></table></mtext></math>\",\n+        # libgumbo\n+        \"<math><mtext><style><img src=: onerror=alert(1)></style><table></table></mtext></math>\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n     protected\n       def safe_list_sanitize(input, options = {})\n         module_under_test::SafeListSanitizer.new.sanitize(input, options)\n@@ -1075,5 +1115,37 @@ class HTML4SafeListSanitizerTest < Minitest::Test\n   class HTML5SafeListSanitizerTest < Minitest::Test\n     @module_under_test = Rails::HTML5\n     include SafeListSanitizerTest\n+\n+    def test_should_not_be_vulnerable_to_mglyph_namespace_confusion\n+      # https://hackerone.com/reports/2519936\n+      input = \"<math><mtext><table><mglyph><style><img src=: onerror=alert(1)>\"\n+      tags = %w(math mtext table mglyph style)\n+\n+      result = nil\n+      assert_output(nil, /WARNING/) do\n+        result = safe_list_sanitize(input, tags: tags)\n+      end\n+\n+      browser = Nokogiri::HTML5::Document.parse(result)\n+      xss = browser.at_xpath(\"//img/@onerror\")\n+\n+      assert_nil(xss)\n+    end\n+\n+    def test_should_not_be_vulnerable_to_malignmark_namespace_confusion\n+      # https://hackerone.com/reports/2519936\n+      input = \"<math><mtext><table><malignmark><style><img src=: onerror=alert(1)>\"\n+      tags = %w(math mtext table malignmark style)\n+\n+      result = nil\n+      assert_output(nil, /WARNING/) do\n+        result = safe_list_sanitize(input, tags: tags)\n+      end\n+\n+      browser = Nokogiri::HTML5::Document.parse(result)\n+      xss = browser.at_xpath(\"//img/@onerror\")\n+\n+      assert_nil(xss)\n+    end\n   end if loofah_html5_support?\n end"
            },
            {
                "sha": "eb0446e2269abcf98ebf125221b8e93904566bcb",
                "filename": "test/scrubbers_test.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72/test%2Fscrubbers_test.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72/test%2Fscrubbers_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/test%2Fscrubbers_test.rb?ref=a0a3e8b76b696446ffc6bffcff3bc7b7c6393c72",
                "patch": "@@ -121,6 +121,14 @@ def test_leaves_only_supplied_tags_and_attributes\n     assert_scrubbed html, '<tag></tag><tag cooler=\"\"></tag>'\n   end\n \n+  def test_does_not_allow_safelisted_mglyph\n+    # https://hackerone.com/reports/2519936\n+    assert_output(nil, /WARNING: 'mglyph' tags cannot be allowed by the PermitScrubber/) do\n+      @scrubber.tags = [\"div\", \"mglyph\", \"span\"]\n+    end\n+    assert_equal([\"div\", \"span\"], @scrubber.tags)\n+  end\n+\n   def test_leaves_text\n     assert_scrubbed(\"some text\")\n   end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/16251735e36ebdc302e2f90f2a39cad56879414f",
        "url": "https://api.github.com/repos/rails/rails-html-sanitizer/commits/16251735e36ebdc302e2f90f2a39cad56879414f",
        "html_url": "https://github.com/rails/rails-html-sanitizer/commit/16251735e36ebdc302e2f90f2a39cad56879414f",
        "message": "fix: disallow 'noscript' from safe lists\n\nhttps://hackerone.com/reports/2509647",
        "files": [
            {
                "sha": "7dde73a98bdd15b048787cd637ae4d7d4dfbc945",
                "filename": "lib/rails/html/scrubbers.rb",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/16251735e36ebdc302e2f90f2a39cad56879414f/lib%2Frails%2Fhtml%2Fscrubbers.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/16251735e36ebdc302e2f90f2a39cad56879414f/lib%2Frails%2Fhtml%2Fscrubbers.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/lib%2Frails%2Fhtml%2Fscrubbers.rb?ref=16251735e36ebdc302e2f90f2a39cad56879414f",
                "patch": "@@ -134,6 +134,12 @@ def validate!(var, name)\n           if var && !var.is_a?(Enumerable)\n             raise ArgumentError, \"You should pass :#{name} as an Enumerable\"\n           end\n+\n+          if var && name == :tags && var.include?(\"noscript\")\n+            warn(\"WARNING: 'noscript' tags cannot be allowed by the PermitScrubber and will be scrubbed\")\n+            var.delete(\"noscript\")\n+          end\n+\n           var\n         end\n "
            },
            {
                "sha": "05c4130b140326881d675c473fcd5259eb118454",
                "filename": "test/sanitizer_test.rb",
                "status": "modified",
                "additions": 35,
                "deletions": 0,
                "changes": 35,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/16251735e36ebdc302e2f90f2a39cad56879414f/test%2Fsanitizer_test.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/16251735e36ebdc302e2f90f2a39cad56879414f/test%2Fsanitizer_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/test%2Fsanitizer_test.rb?ref=16251735e36ebdc302e2f90f2a39cad56879414f",
                "patch": "@@ -1026,6 +1026,24 @@ def test_should_sanitize_across_newlines\n       assert_equal \"\", sanitize_css(raw)\n     end\n \n+    def test_should_prune_noscript\n+      # https://hackerone.com/reports/2509647\n+      input, tags = \"<div><noscript><p id='</noscript><script>alert(1)</script>'></noscript>\", [\"p\", \"div\", \"noscript\"]\n+      actual = nil\n+      assert_output(nil, /WARNING: 'noscript' tags cannot be allowed by the PermitScrubber/) do\n+        actual = safe_list_sanitize(input, tags: tags, attributes: %w(id))\n+      end\n+\n+      acceptable_results = [\n+        # libxml2\n+        \"<div><p id=\\\"&lt;/noscript&gt;&lt;script&gt;alert(1)&lt;/script&gt;\\\"></p></div>\",\n+        # libgumbo\n+        \"<div><p id=\\\"</noscript><script>alert(1)</script>\\\"></p></div>\",\n+      ]\n+\n+      assert_includes(acceptable_results, actual)\n+    end\n+\n     protected\n       def safe_list_sanitize(input, options = {})\n         module_under_test::SafeListSanitizer.new.sanitize(input, options)\n@@ -1075,5 +1093,22 @@ class HTML4SafeListSanitizerTest < Minitest::Test\n   class HTML5SafeListSanitizerTest < Minitest::Test\n     @module_under_test = Rails::HTML5\n     include SafeListSanitizerTest\n+\n+    def test_should_not_be_vulnerable_to_noscript_attacks\n+      # https://hackerone.com/reports/2509647\n+      skip(\"browser assertion requires parse_noscript_content_as_text\") unless Nokogiri::VERSION >= \"1.17\"\n+\n+      input = '<noscript><p id=\"</noscript><script>alert(1)</script>\"></noscript>'\n+\n+      result = nil\n+      assert_output(nil, /WARNING/) do\n+        result = Rails::HTML5::SafeListSanitizer.new.sanitize(input, tags: %w(p div noscript), attributes: %w(id class style))\n+      end\n+\n+      browser = Nokogiri::HTML5::Document.parse(result, parse_noscript_content_as_text: true)\n+      xss = browser.at_xpath(\"//script\")\n+\n+      assert_nil(xss)\n+    end\n   end if loofah_html5_support?\n end"
            },
            {
                "sha": "05f00a431531aaefeb480992ae1fe7dde8549475",
                "filename": "test/scrubbers_test.rb",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/rails/rails-html-sanitizer/blob/16251735e36ebdc302e2f90f2a39cad56879414f/test%2Fscrubbers_test.rb",
                "raw_url": "https://github.com/rails/rails-html-sanitizer/raw/16251735e36ebdc302e2f90f2a39cad56879414f/test%2Fscrubbers_test.rb",
                "contents_url": "https://api.github.com/repos/rails/rails-html-sanitizer/contents/test%2Fscrubbers_test.rb?ref=16251735e36ebdc302e2f90f2a39cad56879414f",
                "patch": "@@ -121,6 +121,14 @@ def test_leaves_only_supplied_tags_and_attributes\n     assert_scrubbed html, '<tag></tag><tag cooler=\"\"></tag>'\n   end\n \n+  def test_does_not_allow_safelisted_noscript\n+    # https://hackerone.com/reports/2509647\n+    assert_output(nil, /WARNING: 'noscript' tags cannot be allowed by the PermitScrubber/) do\n+      @scrubber.tags = [\"div\", \"noscript\", \"span\"]\n+    end\n+    assert_equal([\"div\", \"span\"], @scrubber.tags)\n+  end\n+\n   def test_leaves_text\n     assert_scrubbed(\"some text\")\n   end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/AsyncHttpClient/async-http-client/commits/d5a83362f7aed81b93ebca559746ac9be0f95425",
        "url": "https://api.github.com/repos/AsyncHttpClient/async-http-client/commits/d5a83362f7aed81b93ebca559746ac9be0f95425",
        "html_url": "https://github.com/AsyncHttpClient/async-http-client/commit/d5a83362f7aed81b93ebca559746ac9be0f95425",
        "message": "[CookieStore] Only set `Cookie`s if they are not already set (#2033)\n\nThis changes the behavior of the automatic usage of the `CookieStore` to\r\navoid overwriting already-set `Cookie`s and, instead only sets them if\r\nthey do not exist yet.\r\n\r\nCloses https://github.com/AsyncHttpClient/async-http-client/issues/1964\r\n\r\nCo-authored-by: Aayush Atharva <aayush@shieldblaze.com>",
        "files": [
            {
                "sha": "3b417a5a3976a2b0bc39ecf584cf2ddc231f93ef",
                "filename": "client/src/main/java/org/asynchttpclient/DefaultAsyncHttpClient.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/AsyncHttpClient/async-http-client/blob/d5a83362f7aed81b93ebca559746ac9be0f95425/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fasynchttpclient%2FDefaultAsyncHttpClient.java",
                "raw_url": "https://github.com/AsyncHttpClient/async-http-client/raw/d5a83362f7aed81b93ebca559746ac9be0f95425/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fasynchttpclient%2FDefaultAsyncHttpClient.java",
                "contents_url": "https://api.github.com/repos/AsyncHttpClient/async-http-client/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fasynchttpclient%2FDefaultAsyncHttpClient.java?ref=d5a83362f7aed81b93ebca559746ac9be0f95425",
                "patch": "@@ -235,7 +235,7 @@ public <T> ListenableFuture<T> executeRequest(Request request, AsyncHandler<T> h\n                 if (!cookies.isEmpty()) {\n                     RequestBuilder requestBuilder = request.toBuilder();\n                     for (Cookie cookie : cookies) {\n-                        requestBuilder.addOrReplaceCookie(cookie);\n+                        requestBuilder.addCookieIfUnset(cookie);\n                     }\n                     request = requestBuilder.build();\n                 }"
            },
            {
                "sha": "dbc5e41442cdf32044ace47acec67788c1f81e73",
                "filename": "client/src/main/java/org/asynchttpclient/RequestBuilderBase.java",
                "status": "modified",
                "additions": 18,
                "deletions": 3,
                "changes": 21,
                "blob_url": "https://github.com/AsyncHttpClient/async-http-client/blob/d5a83362f7aed81b93ebca559746ac9be0f95425/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fasynchttpclient%2FRequestBuilderBase.java",
                "raw_url": "https://github.com/AsyncHttpClient/async-http-client/raw/d5a83362f7aed81b93ebca559746ac9be0f95425/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fasynchttpclient%2FRequestBuilderBase.java",
                "contents_url": "https://api.github.com/repos/AsyncHttpClient/async-http-client/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fasynchttpclient%2FRequestBuilderBase.java?ref=d5a83362f7aed81b93ebca559746ac9be0f95425",
                "patch": "@@ -323,6 +323,21 @@ public T addCookie(Cookie cookie) {\n      * @return this\n      */\n     public T addOrReplaceCookie(Cookie cookie) {\n+        return maybeAddOrReplaceCookie(cookie, true);\n+    }\n+\n+    /**\n+     * Add a cookie based on its name, if it does not exist yet. Cookies that\n+     * are already set will be ignored.\n+     *\n+     * @param cookie the new cookie\n+     * @return this\n+     */\n+    public T addCookieIfUnset(Cookie cookie) {\n+        return maybeAddOrReplaceCookie(cookie, false);\n+    }\n+\n+    private T maybeAddOrReplaceCookie(Cookie cookie, boolean allowReplace) {\n         String cookieKey = cookie.name();\n         boolean replace = false;\n         int index = 0;\n@@ -335,10 +350,10 @@ public T addOrReplaceCookie(Cookie cookie) {\n \n             index++;\n         }\n-        if (replace) {\n-            cookies.set(index, cookie);\n-        } else {\n+        if (!replace) {\n             cookies.add(cookie);\n+        } else if (allowReplace) {\n+            cookies.set(index, cookie);\n         }\n         return asDerivedType();\n     }"
            },
            {
                "sha": "e60495f809feef59646b17236a82aee2957fcfa7",
                "filename": "client/src/main/java/org/asynchttpclient/netty/handler/intercept/Redirect30xInterceptor.java",
                "status": "modified",
                "additions": 2,
                "deletions": 5,
                "changes": 7,
                "blob_url": "https://github.com/AsyncHttpClient/async-http-client/blob/d5a83362f7aed81b93ebca559746ac9be0f95425/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fasynchttpclient%2Fnetty%2Fhandler%2Fintercept%2FRedirect30xInterceptor.java",
                "raw_url": "https://github.com/AsyncHttpClient/async-http-client/raw/d5a83362f7aed81b93ebca559746ac9be0f95425/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fasynchttpclient%2Fnetty%2Fhandler%2Fintercept%2FRedirect30xInterceptor.java",
                "contents_url": "https://api.github.com/repos/AsyncHttpClient/async-http-client/contents/client%2Fsrc%2Fmain%2Fjava%2Forg%2Fasynchttpclient%2Fnetty%2Fhandler%2Fintercept%2FRedirect30xInterceptor.java?ref=d5a83362f7aed81b93ebca559746ac9be0f95425",
                "patch": "@@ -142,11 +142,8 @@ public boolean exitAfterHandlingRedirect(Channel channel, NettyResponseFuture<?>\n                 CookieStore cookieStore = config.getCookieStore();\n                 if (cookieStore != null) {\n                     // Update request's cookies assuming that cookie store is already updated by Interceptors\n-                    List<Cookie> cookies = cookieStore.get(newUri);\n-                    if (!cookies.isEmpty()) {\n-                        for (Cookie cookie : cookies) {\n-                            requestBuilder.addOrReplaceCookie(cookie);\n-                        }\n+                    for (Cookie cookie : cookieStore.get(newUri)) {\n+                        requestBuilder.addCookieIfUnset(cookie);\n                     }\n                 }\n "
            },
            {
                "sha": "34e79121d31c940af84042fb4b919e565d7734af",
                "filename": "client/src/test/java/org/asynchttpclient/RequestBuilderTest.java",
                "status": "modified",
                "additions": 34,
                "deletions": 0,
                "changes": 34,
                "blob_url": "https://github.com/AsyncHttpClient/async-http-client/blob/d5a83362f7aed81b93ebca559746ac9be0f95425/client%2Fsrc%2Ftest%2Fjava%2Forg%2Fasynchttpclient%2FRequestBuilderTest.java",
                "raw_url": "https://github.com/AsyncHttpClient/async-http-client/raw/d5a83362f7aed81b93ebca559746ac9be0f95425/client%2Fsrc%2Ftest%2Fjava%2Forg%2Fasynchttpclient%2FRequestBuilderTest.java",
                "contents_url": "https://api.github.com/repos/AsyncHttpClient/async-http-client/contents/client%2Fsrc%2Ftest%2Fjava%2Forg%2Fasynchttpclient%2FRequestBuilderTest.java?ref=d5a83362f7aed81b93ebca559746ac9be0f95425",
                "patch": "@@ -166,6 +166,40 @@ public void testAddOrReplaceCookies() {\n         assertEquals(requestBuilder.cookies.size(), 2, \"cookie size must be 2 after adding 1 more cookie i.e. cookie3\");\n     }\n \n+    @RepeatedIfExceptionsTest(repeats = 5)\n+    public void testAddIfUnsetCookies() {\n+        RequestBuilder requestBuilder = new RequestBuilder();\n+        Cookie cookie = new DefaultCookie(\"name\", \"value\");\n+        cookie.setDomain(\"google.com\");\n+        cookie.setPath(\"/\");\n+        cookie.setMaxAge(1000);\n+        cookie.setSecure(true);\n+        cookie.setHttpOnly(true);\n+        requestBuilder.addCookieIfUnset(cookie);\n+        assertEquals(requestBuilder.cookies.size(), 1, \"cookies size should be 1 after adding one cookie\");\n+        assertEquals(requestBuilder.cookies.get(0), cookie, \"cookie does not match\");\n+\n+        Cookie cookie2 = new DefaultCookie(\"name\", \"value\");\n+        cookie2.setDomain(\"google2.com\");\n+        cookie2.setPath(\"/path\");\n+        cookie2.setMaxAge(1001);\n+        cookie2.setSecure(false);\n+        cookie2.setHttpOnly(false);\n+\n+        requestBuilder.addCookieIfUnset(cookie2);\n+        assertEquals(requestBuilder.cookies.size(), 1, \"cookies size should remain 1 as we just ignored cookie2 because of a cookie with same name\");\n+        assertEquals(requestBuilder.cookies.get(0), cookie, \"cookie does not match\");\n+\n+        Cookie cookie3 = new DefaultCookie(\"name2\", \"value\");\n+        cookie3.setDomain(\"google.com\");\n+        cookie3.setPath(\"/\");\n+        cookie3.setMaxAge(1000);\n+        cookie3.setSecure(true);\n+        cookie3.setHttpOnly(true);\n+        requestBuilder.addCookieIfUnset(cookie3);\n+        assertEquals(requestBuilder.cookies.size(), 2, \"cookie size must be 2 after adding 1 more cookie i.e. cookie3\");\n+    }\n+\n     @RepeatedIfExceptionsTest(repeats = 5)\n     public void testSettingQueryParamsBeforeUrlShouldNotProduceNPE() {\n         RequestBuilder requestBuilder = new RequestBuilder();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/EDM115/unzip-bot/commits/5213b693eabb562842cdbf21c1074e91bfa00274",
        "url": "https://api.github.com/repos/EDM115/unzip-bot/commits/5213b693eabb562842cdbf21c1074e91bfa00274",
        "html_url": "https://github.com/EDM115/unzip-bot/commit/5213b693eabb562842cdbf21c1074e91bfa00274",
        "message": "fix: sanitize strings another way",
        "files": [
            {
                "sha": "5e9f81637c864e0d405a5ea7ae64cc51b40c91c1",
                "filename": "unzipbot/modules/ext_script/ext_helper.py",
                "status": "modified",
                "additions": 10,
                "deletions": 10,
                "changes": 20,
                "blob_url": "https://github.com/EDM115/unzip-bot/blob/5213b693eabb562842cdbf21c1074e91bfa00274/unzipbot%2Fmodules%2Fext_script%2Fext_helper.py",
                "raw_url": "https://github.com/EDM115/unzip-bot/raw/5213b693eabb562842cdbf21c1074e91bfa00274/unzipbot%2Fmodules%2Fext_script%2Fext_helper.py",
                "contents_url": "https://api.github.com/repos/EDM115/unzip-bot/contents/unzipbot%2Fmodules%2Fext_script%2Fext_helper.py?ref=5213b693eabb562842cdbf21c1074e91bfa00274",
                "patch": "@@ -2,7 +2,7 @@\n import shutil\n import subprocess\n from asyncio import create_subprocess_shell, subprocess\n-from shlex import join, quote\n+from shlex import quote\n \n from pykeyboard import InlineKeyboard\n from pyrogram.types import InlineKeyboardButton\n@@ -40,7 +40,7 @@ async def cleanup_macos_artifacts(extraction_path):\n async def run_shell_cmds(command):\n     memlimit = calculate_memory_limit()\n     ulimit_cmd = [\"ulimit\", \"-v\", str(memlimit), \"&&\", command]\n-    ulimit_command = join(ulimit_cmd)\n+    ulimit_command = \" \".join(ulimit_cmd)\n     process = await create_subprocess_shell(\n         ulimit_command,\n         stdout=subprocess.PIPE,\n@@ -74,15 +74,15 @@ async def __extract_with_7z_helper(path, archive_path, password=None):\n     else:\n         cmd = [\"7z\", \"x\", f\"-o{quote(path)}\", quote(archive_path), \"-y\"]\n \n-    result = await run_shell_cmds(join(cmd))\n+    result = await run_shell_cmds(\" \".join(cmd))\n \n     return result\n \n \n async def test_with_7z_helper(archive_path):\n     password = \"dont care + didnt ask + cry about it + stay mad + get real + L\"  # skipcq: PTC-W1006, SCT-A000\n     cmd = [\"7z\", \"t\", f\"-p{quote(password)}\", quote(archive_path), \"-y\"]\n-    result = await run_shell_cmds(join(cmd))\n+    result = await run_shell_cmds(\" \".join(cmd))\n \n     return \"Everything is Ok\" in result\n \n@@ -95,23 +95,23 @@ async def __extract_with_unrar_helper(path, archive_path, password=None):\n     else:\n         cmd = [\"unrar\", \"x\", quote(archive_path), quote(path)]\n \n-    result = await run_shell_cmds(join(cmd))\n+    result = await run_shell_cmds(\" \".join(cmd))\n \n     return result\n \n \n async def test_with_unrar_helper(archive_path):\n     password = \"dont care + didnt ask + cry about it + stay mad + get real + L\"  # skipcq: PTC-W1006, SCT-A000\n     cmd = [\"unrar\", \"t\", quote(archive_path), f\"-p{quote(password)}\"]\n-    result = await run_shell_cmds(join(cmd))\n+    result = await run_shell_cmds(\" \".join(cmd))\n \n     return \"All OK\" in result\n \n \n # Extract with zstd (for .tar.zst files)\n async def __extract_with_zstd(path, archive_path):\n     cmd = [\"zstd\", \"-f\", \"--output-dir-flat\", quote(path), \"-d\", quote(archive_path)]\n-    result = await run_shell_cmds(join(cmd))\n+    result = await run_shell_cmds(\" \".join(cmd))\n \n     return result\n \n@@ -128,7 +128,7 @@ async def extr_files(path, archive_path, password=None):\n         filename = await get_files(temp_path)\n         filename = filename[0]\n         cmd = [\"tar\", \"-xvf\", quote(filename), \"-C\", quote(path)]\n-        result2 = await run_shell_cmds(join(cmd))\n+        result2 = await run_shell_cmds(\" \".join(cmd))\n         result += result2\n         shutil.rmtree(temp_path)\n     elif archive_path.endswith((\".tar.zst\", \".zst\", \".tzst\")):\n@@ -165,7 +165,7 @@ async def split_files(iinput, ooutput, size):\n         quote(temp_location),\n         f\"-v{size}b\",\n     ]\n-    await run_shell_cmds(join(cmd))\n+    await run_shell_cmds(\" \".join(cmd))\n     spdir = ooutput.replace(\"/\" + ooutput.split(\"/\")[-1], \"\")\n     files = await get_files(spdir)\n \n@@ -186,7 +186,7 @@ async def merge_files(iinput, ooutput, password=None):\n     else:\n         cmd = [\"7z\", \"x\", f\"-o{quote(ooutput)}\", quote(iinput), \"-y\"]\n \n-    result = await run_shell_cmds(join(cmd))\n+    result = await run_shell_cmds(\" \".join(cmd))\n \n     return result\n "
            },
            {
                "sha": "f683cf55cce2f15934fe8c3c051c61c6b6a50d4c",
                "filename": "unzipbot/modules/ext_script/up_helper.py",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/EDM115/unzip-bot/blob/5213b693eabb562842cdbf21c1074e91bfa00274/unzipbot%2Fmodules%2Fext_script%2Fup_helper.py",
                "raw_url": "https://github.com/EDM115/unzip-bot/raw/5213b693eabb562842cdbf21c1074e91bfa00274/unzipbot%2Fmodules%2Fext_script%2Fup_helper.py",
                "contents_url": "https://api.github.com/repos/EDM115/unzip-bot/contents/unzipbot%2Fmodules%2Fext_script%2Fup_helper.py?ref=5213b693eabb562842cdbf21c1074e91bfa00274",
                "patch": "@@ -5,7 +5,7 @@\n import shutil\n from datetime import timedelta\n from time import time\n-from shlex import join, quote\n+from shlex import quote\n \n from pyrogram.errors import FloodWait, PhotoExtInvalid, PhotoSaveFileInvalid\n \n@@ -194,7 +194,7 @@ async def send_file(unzip_bot, c_id, doc_f, query, full_path, log_msg, split):\n                 \"default=noprint_wrappers=1:nokey=1\",\n                 quote(doc_f),\n             ]\n-            vid_duration = await run_shell_cmds(join(cmd))\n+            vid_duration = await run_shell_cmds(\" \".join(cmd))\n \n             if thumbornot:\n                 thumb_image = Config.THUMB_LOCATION + \"/\" + str(c_id) + \".jpg\"\n@@ -247,7 +247,7 @@ async def send_file(unzip_bot, c_id, doc_f, query, full_path, log_msg, split):\n                         \"1\",\n                         quote(thmb_pth),\n                     ]\n-                    await run_shell_cmds(join(cmd))\n+                    await run_shell_cmds(\" \".join(cmd))\n                 except Exception as e:\n                     LOGGER.warning(e)\n                     shutil.copy(Config.BOT_THUMB, thmb_pth)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/PlexRipper/PlexRipper/commits/184074644a1f5a8ac59519929a9c4b92280fb2a1",
        "url": "https://api.github.com/repos/Reaparr/Reaparr/commits/184074644a1f5a8ac59519929a9c4b92280fb2a1",
        "html_url": "https://github.com/Reaparr/Reaparr/commit/184074644a1f5a8ac59519929a9c4b92280fb2a1",
        "message": "Merge commit from fork\n\nfix(WebAPI): Correctly configured CORS to only allow same-origin requests to the server",
        "files": [
            {
                "sha": "093c5d664a13ee718ba71d043d93bee4563e44d5",
                "filename": "src/WebAPI/Startup.cs",
                "status": "modified",
                "additions": 1,
                "deletions": 4,
                "changes": 5,
                "blob_url": "https://github.com/Reaparr/Reaparr/blob/184074644a1f5a8ac59519929a9c4b92280fb2a1/src%2FWebAPI%2FStartup.cs",
                "raw_url": "https://github.com/Reaparr/Reaparr/raw/184074644a1f5a8ac59519929a9c4b92280fb2a1/src%2FWebAPI%2FStartup.cs",
                "contents_url": "https://api.github.com/repos/Reaparr/Reaparr/contents/src%2FWebAPI%2FStartup.cs?ref=184074644a1f5a8ac59519929a9c4b92280fb2a1",
                "patch": "@@ -118,13 +118,10 @@ public static void ConfigureServices(this IServiceCollection services, IWebHostE\n                 CORSConfiguration,\n                 builder =>\n                 {\n-                    // TODO CORS disabled, otherwise its not working when deployed in a docker container\n-                    // Solution?\n                     builder\n+                        .SetIsOriginAllowed(origin => new Uri(origin).Host == \"localhost\")\n                         .AllowAnyHeader()\n                         .AllowAnyMethod()\n-                        // The combo all origin is allowed with allow credentials is needed to make SignalR work from the client.\n-                        .SetIsOriginAllowed(_ => true)\n                         .AllowCredentials();\n                 }\n             );"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/simplesamlphp/xml-common/commits/fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5",
        "url": "https://api.github.com/repos/simplesamlphp/xml-common/commits/fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5",
        "html_url": "https://github.com/simplesamlphp/xml-common/commit/fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5",
        "message": "Merge commit from fork\n\nExplicitly disable the loading of external entities",
        "files": [
            {
                "sha": "144748300034d8578a59a074b864bb076a7e6119",
                "filename": "src/DOMDocumentFactory.php",
                "status": "modified",
                "additions": 34,
                "deletions": 16,
                "changes": 50,
                "blob_url": "https://github.com/simplesamlphp/xml-common/blob/fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5/src%2FDOMDocumentFactory.php",
                "raw_url": "https://github.com/simplesamlphp/xml-common/raw/fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5/src%2FDOMDocumentFactory.php",
                "contents_url": "https://api.github.com/repos/simplesamlphp/xml-common/contents/src%2FDOMDocumentFactory.php?ref=fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5",
                "patch": "@@ -5,15 +5,16 @@\n namespace SimpleSAML\\XML;\n \n use DOMDocument;\n-use RuntimeException;\n use SimpleSAML\\Assert\\Assert;\n use SimpleSAML\\XML\\Exception\\IOException;\n+use SimpleSAML\\XML\\Exception\\RuntimeException;\n use SimpleSAML\\XML\\Exception\\UnparseableXMLException;\n \n-use function defined;\n use function file_get_contents;\n+use function func_num_args;\n use function libxml_clear_errors;\n use function libxml_get_last_error;\n+use function libxml_set_external_entity_loader;\n use function libxml_use_internal_errors;\n use function sprintf;\n \n@@ -22,25 +23,41 @@\n  */\n final class DOMDocumentFactory\n {\n+    /**\n+     * @var non-negative-int\n+     * TODO: Add LIBXML_NO_XXE to the defaults when PHP 8.4.0 + libxml 2.13.0 become generally available\n+     */\n+    public const DEFAULT_OPTIONS = LIBXML_COMPACT | LIBXML_NONET | LIBXML_NSCLEAN;\n+\n+\n     /**\n      * @param string $xml\n-     * @param non-empty-string $xml\n+     * @param non-negative-int $options\n      *\n      * @return \\DOMDocument\n      */\n-    public static function fromString(string $xml): DOMDocument\n-    {\n+    public static function fromString(\n+        string $xml,\n+        int $options = self::DEFAULT_OPTIONS,\n+    ): DOMDocument {\n+        libxml_set_external_entity_loader(null);\n         Assert::notWhitespaceOnly($xml);\n+        Assert::notRegex(\n+            $xml,\n+            '/<(\\s*)!(\\s*)DOCTYPE/',\n+            'Dangerous XML detected, DOCTYPE nodes are not allowed in the XML body',\n+            RuntimeException::class,\n+        );\n \n         $internalErrors = libxml_use_internal_errors(true);\n         libxml_clear_errors();\n \n-        $domDocument = self::create();\n-        $options = LIBXML_DTDLOAD | LIBXML_DTDATTR | LIBXML_NONET | LIBXML_PARSEHUGE | LIBXML_NSCLEAN;\n-        if (defined('LIBXML_COMPACT')) {\n-            $options |= LIBXML_COMPACT;\n+        // If LIBXML_NO_XXE is available and option not set\n+        if (func_num_args() === 1 && defined('LIBXML_NO_XXE')) {\n+            $options != LIBXML_NO_XXE;\n         }\n \n+        $domDocument = self::create();\n         $loaded = $domDocument->loadXML($xml, $options);\n \n         libxml_use_internal_errors($internalErrors);\n@@ -55,11 +72,11 @@ public static function fromString(string $xml): DOMDocument\n         libxml_clear_errors();\n \n         foreach ($domDocument->childNodes as $child) {\n-            if ($child->nodeType === XML_DOCUMENT_TYPE_NODE) {\n-                throw new RuntimeException(\n-                    'Dangerous XML detected, DOCTYPE nodes are not allowed in the XML body',\n-                );\n-            }\n+            Assert::false(\n+                $child->nodeType === XML_DOCUMENT_TYPE_NODE,\n+                'Dangerous XML detected, DOCTYPE nodes are not allowed in the XML body',\n+                RuntimeException::class,\n+            );\n         }\n \n         return $domDocument;\n@@ -68,10 +85,11 @@ public static function fromString(string $xml): DOMDocument\n \n     /**\n      * @param string $file\n+     * @param non-negative-int $options\n      *\n      * @return \\DOMDocument\n      */\n-    public static function fromFile(string $file): DOMDocument\n+    public static function fromFile(string $file, int $options = self::DEFAULT_OPTIONS): DOMDocument\n     {\n         error_clear_last();\n         $xml = @file_get_contents($file);\n@@ -83,7 +101,7 @@ public static function fromFile(string $file): DOMDocument\n         }\n \n         Assert::notWhitespaceOnly($xml, sprintf('File \"%s\" does not have content', $file), RuntimeException::class);\n-        return static::fromString($xml);\n+        return (func_num_args() === 1) ? static::fromString($xml) : static::fromString($xml, $options);\n     }\n \n "
            },
            {
                "sha": "79c4a6ad105b2892721893b6c616262938950446",
                "filename": "tests/XML/DOMDocumentFactoryTest.php",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/simplesamlphp/xml-common/blob/fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5/tests%2FXML%2FDOMDocumentFactoryTest.php",
                "raw_url": "https://github.com/simplesamlphp/xml-common/raw/fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5/tests%2FXML%2FDOMDocumentFactoryTest.php",
                "contents_url": "https://api.github.com/repos/simplesamlphp/xml-common/contents/tests%2FXML%2FDOMDocumentFactoryTest.php?ref=fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5",
                "patch": "@@ -84,6 +84,19 @@ public function testStringThatContainsDocTypeIsNotAccepted(): void\n     }\n \n \n+    public function testStringThatContainsDocTypeIsNotAccepted2(): void\n+    {\n+        $xml = '<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n+               <!DOCTYPE foo [<!ENTITY % exfiltrate SYSTEM \"file://dev/random\">%exfiltrate;]>\n+               <foo>y</foo>';\n+        $this->expectException(RuntimeException::class);\n+        $this->expectExceptionMessage(\n+            'Dangerous XML detected, DOCTYPE nodes are not allowed in the XML body',\n+        );\n+        DOMDocumentFactory::fromString($xml);\n+    }\n+\n+\n     public function testEmptyFileIsNotValid(): void\n     {\n         $file = 'resources/xml/domdocument_empty.xml';"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/simplesamlphp/saml2/commits/5fd4ce4596656fb0c1278f15b8305825412e89f7",
        "url": "https://api.github.com/repos/simplesamlphp/saml2/commits/5fd4ce4596656fb0c1278f15b8305825412e89f7",
        "html_url": "https://github.com/simplesamlphp/saml2/commit/5fd4ce4596656fb0c1278f15b8305825412e89f7",
        "message": "Merge commit from fork\n\n* Explicitly disable loading of external entities\n\n* Remove problematic options\n\n* Move test for dangerous XML before where the document is loaded\n\n* Defense in depth: test for DOCTYPE in two different ways\n\n* Add unit test\n\n* Use defined() for LIB_NO_XXE",
        "files": [
            {
                "sha": "f69a49e4b43cf3f6ef88b509106b89b2ffa16708",
                "filename": "src/SAML2/DOMDocumentFactory.php",
                "status": "modified",
                "additions": 13,
                "deletions": 1,
                "changes": 14,
                "blob_url": "https://github.com/simplesamlphp/saml2/blob/5fd4ce4596656fb0c1278f15b8305825412e89f7/src%2FSAML2%2FDOMDocumentFactory.php",
                "raw_url": "https://github.com/simplesamlphp/saml2/raw/5fd4ce4596656fb0c1278f15b8305825412e89f7/src%2FSAML2%2FDOMDocumentFactory.php",
                "contents_url": "https://api.github.com/repos/simplesamlphp/saml2/contents/src%2FSAML2%2FDOMDocumentFactory.php?ref=5fd4ce4596656fb0c1278f15b8305825412e89f7",
                "patch": "@@ -30,15 +30,27 @@ public static function fromString(string $xml) : DOMDocument\n     {\n         if (trim($xml) === '') {\n             throw InvalidArgumentException::invalidType('non-empty string', $xml);\n+        } elseif (preg_match('/<(\\s*)!(\\s*)DOCTYPE/', $xml)) {\n+            throw new RuntimeException(\n+                'Dangerous XML detected, DOCTYPE nodes are not allowed in the XML body'\n+            );\n         } elseif (PHP_VERSION_ID < 80000) {\n             $entityLoader = libxml_disable_entity_loader(true);\n+        } else {\n+            libxml_set_external_entity_loader(null);\n         }\n \n         $internalErrors = libxml_use_internal_errors(true);\n         libxml_clear_errors();\n \n         $domDocument = self::create();\n-        $options = LIBXML_DTDLOAD | LIBXML_DTDATTR | LIBXML_NONET | LIBXML_PARSEHUGE;\n+        $options = LIBXML_NONET | LIBXML_PARSEHUGE;\n+\n+        /* LIBXML_NO_XXE available from PHP 8.4 */\n+        if (defined('LIBXML_NO_XXE')) {\n+            $options |= LIBXML_NO_XXE;\n+        }\n+\n         if (defined('LIBXML_COMPACT')) {\n             $options |= LIBXML_COMPACT;\n         }"
            },
            {
                "sha": "1834a22bf8cd98cb69e6f57e2c3dda05a63bb869",
                "filename": "tests/SAML2/DOMDocumentFactoryTest.php",
                "status": "modified",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/simplesamlphp/saml2/blob/5fd4ce4596656fb0c1278f15b8305825412e89f7/tests%2FSAML2%2FDOMDocumentFactoryTest.php",
                "raw_url": "https://github.com/simplesamlphp/saml2/raw/5fd4ce4596656fb0c1278f15b8305825412e89f7/tests%2FSAML2%2FDOMDocumentFactoryTest.php",
                "contents_url": "https://api.github.com/repos/simplesamlphp/saml2/contents/tests%2FSAML2%2FDOMDocumentFactoryTest.php?ref=5fd4ce4596656fb0c1278f15b8305825412e89f7",
                "patch": "@@ -99,6 +99,22 @@ public function testStringThatContainsDocTypeIsNotAccepted() : void\n     }\n \n \n+    /**\n+     * @group                    domdocument\n+     * @return void\n+     */\n+    public function testStringThatContainsDocTypeIsNotAccepted2(): void\n+    {\n+        $xml = '<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n+               <!DOCTYPE foo [<!ENTITY % exfiltrate SYSTEM \"file://dev/random\">%exfiltrate;]>\n+               <foo>y</foo>';\n+        $this->expectException(RuntimeException::class);\n+        $this->expectExceptionMessage(\n+            'Dangerous XML detected, DOCTYPE nodes are not allowed in the XML body',\n+        );\n+        DOMDocumentFactory::fromString($xml);\n+    }\n+\n     /**\n      * @group                    domdocument\n      * @return void"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/quic-go/quic-go/commits/ca31dd355cbe5fc6c5807992d9d1149c66c96a50",
        "url": "https://api.github.com/repos/quic-go/quic-go/commits/ca31dd355cbe5fc6c5807992d9d1149c66c96a50",
        "html_url": "https://github.com/quic-go/quic-go/commit/ca31dd355cbe5fc6c5807992d9d1149c66c96a50",
        "message": "use IP_PMTUDISC_PROBE instead of IP_PMTUDISC_DO on Linux (#4729)",
        "files": [
            {
                "sha": "b09a2394e8e79b3440c38a9251d7f28ef0476eec",
                "filename": "sys_conn_df_linux.go",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/quic-go/quic-go/blob/ca31dd355cbe5fc6c5807992d9d1149c66c96a50/sys_conn_df_linux.go",
                "raw_url": "https://github.com/quic-go/quic-go/raw/ca31dd355cbe5fc6c5807992d9d1149c66c96a50/sys_conn_df_linux.go",
                "contents_url": "https://api.github.com/repos/quic-go/quic-go/contents/sys_conn_df_linux.go?ref=ca31dd355cbe5fc6c5807992d9d1149c66c96a50",
                "patch": "@@ -16,8 +16,8 @@ func setDF(rawConn syscall.RawConn) (bool, error) {\n \t// and the datagram will not be fragmented\n \tvar errDFIPv4, errDFIPv6 error\n \tif err := rawConn.Control(func(fd uintptr) {\n-\t\terrDFIPv4 = unix.SetsockoptInt(int(fd), unix.IPPROTO_IP, unix.IP_MTU_DISCOVER, unix.IP_PMTUDISC_DO)\n-\t\terrDFIPv6 = unix.SetsockoptInt(int(fd), unix.IPPROTO_IPV6, unix.IPV6_MTU_DISCOVER, unix.IPV6_PMTUDISC_DO)\n+\t\terrDFIPv4 = unix.SetsockoptInt(int(fd), unix.IPPROTO_IP, unix.IP_MTU_DISCOVER, unix.IP_PMTUDISC_PROBE)\n+\t\terrDFIPv6 = unix.SetsockoptInt(int(fd), unix.IPPROTO_IPV6, unix.IPV6_MTU_DISCOVER, unix.IPV6_PMTUDISC_PROBE)\n \t}); err != nil {\n \t\treturn false, err\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Kludex/python-multipart/commits/c4fe4d3cebc08c660e57dd709af1ffa7059b3177",
        "url": "https://api.github.com/repos/Kludex/python-multipart/commits/c4fe4d3cebc08c660e57dd709af1ffa7059b3177",
        "html_url": "https://github.com/Kludex/python-multipart/commit/c4fe4d3cebc08c660e57dd709af1ffa7059b3177",
        "message": "Don't warn when CRLF is found after last boundary (#193)",
        "files": [
            {
                "sha": "50074c8fe98c843d391b6908be14c9cbc1f85359",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/Kludex/python-multipart/blob/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/CHANGELOG.md",
                "raw_url": "https://github.com/Kludex/python-multipart/raw/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/Kludex/python-multipart/contents/CHANGELOG.md?ref=c4fe4d3cebc08c660e57dd709af1ffa7059b3177",
                "patch": "@@ -1,5 +1,9 @@\n # Changelog\n \n+## 0.0.19 (2024-11-30)\n+\n+* Don't warn when CRLF is found after last boundary on `MultipartParser` [#193](https://github.com/Kludex/python-multipart/pull/193).\n+\n ## 0.0.18 (2024-11-28)\n \n * Hard break if found data after last boundary on `MultipartParser` [#189](https://github.com/Kludex/python-multipart/pull/189)."
            },
            {
                "sha": "d555f80b365d58c88f7c26666ac52f7bfbab4bba",
                "filename": "python_multipart/__init__.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Kludex/python-multipart/blob/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/python_multipart%2F__init__.py",
                "raw_url": "https://github.com/Kludex/python-multipart/raw/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/python_multipart%2F__init__.py",
                "contents_url": "https://api.github.com/repos/Kludex/python-multipart/contents/python_multipart%2F__init__.py?ref=c4fe4d3cebc08c660e57dd709af1ffa7059b3177",
                "patch": "@@ -2,7 +2,7 @@\n __author__ = \"Andrew Dunham\"\n __license__ = \"Apache\"\n __copyright__ = \"Copyright (c) 2012-2013, Andrew Dunham\"\n-__version__ = \"0.0.18\"\n+__version__ = \"0.0.19\"\n \n from .multipart import (\n     BaseParser,"
            },
            {
                "sha": "a9963793aa0b03e429f991ec830e2ce2fc07347a",
                "filename": "python_multipart/multipart.py",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/Kludex/python-multipart/blob/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/python_multipart%2Fmultipart.py",
                "raw_url": "https://github.com/Kludex/python-multipart/raw/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/python_multipart%2Fmultipart.py",
                "contents_url": "https://api.github.com/repos/Kludex/python-multipart/contents/python_multipart%2Fmultipart.py?ref=c4fe4d3cebc08c660e57dd709af1ffa7059b3177",
                "patch": "@@ -1397,6 +1397,10 @@ def data_callback(name: CallbackName, end_i: int, remaining: bool = False) -> No\n                     i -= 1\n \n             elif state == MultipartState.END:\n+                # Don't do anything if chunk ends with CRLF.\n+                if c == CR and i + 1 < length and data[i + 1] == LF:\n+                    i += 2\n+                    continue\n                 # Skip data after the last boundary.\n                 self.logger.warning(\"Skipping data after last boundary\")\n                 i = length"
            },
            {
                "sha": "bc37333978464eed16cd2a9a9b1cd51bffaebb88",
                "filename": "scripts/check",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Kludex/python-multipart/blob/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/scripts%2Fcheck",
                "raw_url": "https://github.com/Kludex/python-multipart/raw/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/scripts%2Fcheck",
                "contents_url": "https://api.github.com/repos/Kludex/python-multipart/contents/scripts%2Fcheck?ref=c4fe4d3cebc08c660e57dd709af1ffa7059b3177",
                "patch": "@@ -6,5 +6,5 @@ SOURCE_FILES=\"python_multipart multipart tests\"\n \n uvx ruff format --check --diff $SOURCE_FILES\n uvx ruff check $SOURCE_FILES\n-uvx --with types-PyYAML mypy $SOURCE_FILES\n+uv run mypy $SOURCE_FILES\n uvx check-sdist"
            },
            {
                "sha": "ce92ff43f2be2763a85036f073458de4d10b2813",
                "filename": "tests/test_multipart.py",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/Kludex/python-multipart/blob/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/tests%2Ftest_multipart.py",
                "raw_url": "https://github.com/Kludex/python-multipart/raw/c4fe4d3cebc08c660e57dd709af1ffa7059b3177/tests%2Ftest_multipart.py",
                "contents_url": "https://api.github.com/repos/Kludex/python-multipart/contents/tests%2Ftest_multipart.py?ref=c4fe4d3cebc08c660e57dd709af1ffa7059b3177",
                "patch": "@@ -1,5 +1,6 @@\n from __future__ import annotations\n \n+import logging\n import os\n import random\n import sys\n@@ -9,6 +10,7 @@\n from typing import TYPE_CHECKING, cast\n from unittest.mock import Mock\n \n+import pytest\n import yaml\n \n from python_multipart.decoders import Base64Decoder, QuotedPrintableDecoder\n@@ -1248,6 +1250,30 @@ def on_file(f: FileProtocol) -> None:\n         f = FormParser(\"multipart/form-data\", on_field=Mock(), on_file=on_file, boundary=\"boundary\")\n         f.write(data.encode(\"latin-1\"))\n \n+    @pytest.fixture(autouse=True)\n+    def inject_fixtures(self, caplog: pytest.LogCaptureFixture) -> None:\n+        self._caplog = caplog\n+\n+    def test_multipart_parser_data_end_with_crlf_without_warnings(self) -> None:\n+        \"\"\"This test makes sure that the parser does not handle when the data ends with a CRLF.\"\"\"\n+        data = (\n+            \"--boundary\\r\\n\"\n+            'Content-Disposition: form-data; name=\"file\"; filename=\"filename.txt\"\\r\\n'\n+            \"Content-Type: text/plain\\r\\n\\r\\n\"\n+            \"hello\\r\\n\"\n+            \"--boundary--\\r\\n\"\n+        )\n+\n+        files: list[File] = []\n+\n+        def on_file(f: FileProtocol) -> None:\n+            files.append(cast(File, f))\n+\n+        f = FormParser(\"multipart/form-data\", on_field=Mock(), on_file=on_file, boundary=\"boundary\")\n+        with self._caplog.at_level(logging.WARNING):\n+            f.write(data.encode(\"latin-1\"))\n+            assert len(self._caplog.records) == 0\n+\n     def test_max_size_multipart(self) -> None:\n         # Load test data.\n         test_file = \"single_field_single_file.http\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nanopb/nanopb/commits/2b86c255aa52250438d5aba124d0e86db495b378",
        "url": "https://api.github.com/repos/nanopb/nanopb/commits/2b86c255aa52250438d5aba124d0e86db495b378",
        "html_url": "https://github.com/nanopb/nanopb/commit/2b86c255aa52250438d5aba124d0e86db495b378",
        "message": "Fix memory not released on error return (GHSA-xwqq-qxmw-hj5r)\n\nWhen all of the following conditions apply:\n\n* Compile time option PB_ENABLE_MALLOC is enabled.\n* Message contains at least one field with FT_POINTER field type.\n* Custom stream callback is used with unknown stream length (stream.bytes_left = SIZE_MAX)\n* pb_decode_ex() function is used with flag PB_DECODE_DELIMITED.\n* The input message is corrupted (accidentally or maliciously) in the length prefix.\n\nThen the pb_decode_ex() function does not automatically call pb_release(), like is done for other failure cases.\nThis could lead to memory leak and potential denial-of-service.",
        "files": [
            {
                "sha": "5b919aa575d9e2baee7688603aec745acaed4399",
                "filename": "pb_decode.c",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/nanopb/nanopb/blob/2b86c255aa52250438d5aba124d0e86db495b378/pb_decode.c",
                "raw_url": "https://github.com/nanopb/nanopb/raw/2b86c255aa52250438d5aba124d0e86db495b378/pb_decode.c",
                "contents_url": "https://api.github.com/repos/nanopb/nanopb/contents/pb_decode.c?ref=2b86c255aa52250438d5aba124d0e86db495b378",
                "patch": "@@ -1196,7 +1196,7 @@ bool checkreturn pb_decode_ex(pb_istream_t *stream, const pb_msgdesc_t *fields,\n       status = pb_decode_inner(&substream, fields, dest_struct, flags);\n \n       if (!pb_close_string_substream(stream, &substream))\n-        return false;\n+        status = false;\n     }\n     \n #ifdef PB_ENABLE_MALLOC"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/spring-projects/spring-framework/commits/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
        "url": "https://api.github.com/repos/spring-projects/spring-framework/commits/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
        "html_url": "https://github.com/spring-projects/spring-framework/commit/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
        "message": "Use Locale.ROOT consistently for toLower/toUpperCase\n\nCloses gh-33708",
        "files": [
            {
                "sha": "9a9a7d8f30d1f66df4bda0dd242bdbb03414c45d",
                "filename": "spring-beans/src/main/java/org/springframework/beans/support/PropertyComparator.java",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-beans%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fbeans%2Fsupport%2FPropertyComparator.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-beans%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fbeans%2Fsupport%2FPropertyComparator.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-beans%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fbeans%2Fsupport%2FPropertyComparator.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2023 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -19,6 +19,7 @@\n import java.util.Arrays;\n import java.util.Comparator;\n import java.util.List;\n+import java.util.Locale;\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n@@ -77,8 +78,8 @@ public int compare(T o1, T o2) {\n \t\tObject v1 = getPropertyValue(o1);\n \t\tObject v2 = getPropertyValue(o2);\n \t\tif (this.sortDefinition.isIgnoreCase() && (v1 instanceof String text1) && (v2 instanceof String text2)) {\n-\t\t\tv1 = text1.toLowerCase();\n-\t\t\tv2 = text2.toLowerCase();\n+\t\t\tv1 = text1.toLowerCase(Locale.ROOT);\n+\t\t\tv2 = text2.toLowerCase(Locale.ROOT);\n \t\t}\n \n \t\tint result;"
            },
            {
                "sha": "f01a9162b731a77d8ec2b805540eaa3ab3f190f7",
                "filename": "spring-context-support/src/main/java/org/springframework/scheduling/quartz/LocalDataSourceJobStore.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-context-support%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fscheduling%2Fquartz%2FLocalDataSourceJobStore.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-context-support%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fscheduling%2Fquartz%2FLocalDataSourceJobStore.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-context-support%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fscheduling%2Fquartz%2FLocalDataSourceJobStore.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2021 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -19,6 +19,7 @@\n import java.sql.Connection;\n import java.sql.DatabaseMetaData;\n import java.sql.SQLException;\n+import java.util.Locale;\n \n import javax.sql.DataSource;\n \n@@ -155,7 +156,7 @@ public void initialize() {\n \t\t\tString productName = JdbcUtils.extractDatabaseMetaData(this.dataSource,\n \t\t\t\t\tDatabaseMetaData::getDatabaseProductName);\n \t\t\tproductName = JdbcUtils.commonDatabaseName(productName);\n-\t\t\tif (productName != null && productName.toLowerCase().contains(\"hsql\")) {\n+\t\t\tif (productName != null && productName.toLowerCase(Locale.ROOT).contains(\"hsql\")) {\n \t\t\t\tsetUseDBLocks(false);\n \t\t\t\tsetLockHandler(new SimpleSemaphore());\n \t\t\t}"
            },
            {
                "sha": "a6c56fbe9354fa42ca1cf80aaa7d48e82b2b10e5",
                "filename": "spring-context/src/main/java/org/springframework/format/datetime/standard/MonthFormatter.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-context%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fformat%2Fdatetime%2Fstandard%2FMonthFormatter.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-context%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fformat%2Fdatetime%2Fstandard%2FMonthFormatter.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-context%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fformat%2Fdatetime%2Fstandard%2FMonthFormatter.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -34,7 +34,7 @@ class MonthFormatter implements Formatter<Month> {\n \n \t@Override\n \tpublic Month parse(String text, Locale locale) throws ParseException {\n-\t\treturn Month.valueOf(text.toUpperCase());\n+\t\treturn Month.valueOf(text.toUpperCase(Locale.ROOT));\n \t}\n \n \t@Override"
            },
            {
                "sha": "e1702c9a548b8e0d96f175d161c2d10ac93ec1e7",
                "filename": "spring-context/src/main/java/org/springframework/scheduling/support/CronField.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-context%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fscheduling%2Fsupport%2FCronField.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-context%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fscheduling%2Fsupport%2FCronField.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-context%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fscheduling%2Fsupport%2FCronField.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -21,6 +21,7 @@\n import java.time.temporal.ChronoUnit;\n import java.time.temporal.Temporal;\n import java.time.temporal.ValueRange;\n+import java.util.Locale;\n import java.util.function.BiFunction;\n \n import org.springframework.lang.Nullable;\n@@ -143,7 +144,7 @@ private static CronField parseList(String value, Type type, BiFunction<String, T\n \t}\n \n \tprivate static String replaceOrdinals(String value, String[] list) {\n-\t\tvalue = value.toUpperCase();\n+\t\tvalue = value.toUpperCase(Locale.ROOT);\n \t\tfor (int i = 0; i < list.length; i++) {\n \t\t\tString replacement = Integer.toString(i + 1);\n \t\t\tvalue = StringUtils.replace(value, list[i], replacement);"
            },
            {
                "sha": "4e7daa8f411974c5999a69c3e9ae4685d1091613",
                "filename": "spring-core-test/src/main/java/org/springframework/aot/agent/InvocationsRecorderClassVisitor.java",
                "status": "modified",
                "additions": 6,
                "deletions": 5,
                "changes": 11,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-core-test%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Faot%2Fagent%2FInvocationsRecorderClassVisitor.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-core-test%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Faot%2Fagent%2FInvocationsRecorderClassVisitor.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-core-test%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Faot%2Fagent%2FInvocationsRecorderClassVisitor.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2022 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -17,6 +17,7 @@\n package org.springframework.aot.agent;\n \n import java.util.HashSet;\n+import java.util.Locale;\n import java.util.Set;\n \n import org.springframework.asm.ClassVisitor;\n@@ -40,6 +41,7 @@ class InvocationsRecorderClassVisitor extends ClassVisitor implements Opcodes {\n \n \tprivate final ClassWriter classWriter;\n \n+\n \tpublic InvocationsRecorderClassVisitor() {\n \t\tthis(new ClassWriter(ClassWriter.COMPUTE_MAXS));\n \t}\n@@ -49,6 +51,7 @@ private InvocationsRecorderClassVisitor(ClassWriter classWriter) {\n \t\tthis.classWriter = classWriter;\n \t}\n \n+\n \tpublic boolean isTransformed() {\n \t\treturn this.isTransformed;\n \t}\n@@ -64,6 +67,7 @@ public MethodVisitor visitMethod(int access, String name, String descriptor, Str\n \t\treturn new InvocationsRecorderMethodVisitor(mv);\n \t}\n \n+\n \t@SuppressWarnings(\"deprecation\")\n \tclass InvocationsRecorderMethodVisitor extends MethodVisitor implements Opcodes {\n \n@@ -83,7 +87,6 @@ public InvocationsRecorderMethodVisitor(MethodVisitor mv) {\n \t\t\tsuper(SpringAsmInfo.ASM_VERSION, mv);\n \t\t}\n \n-\n \t\t@Override\n \t\tpublic void visitMethodInsn(int opcode, String owner, String name, String descriptor, boolean isInterface) {\n \t\t\tif (isOpcodeSupported(opcode) && shouldRecordMethodCall(owner, name)) {\n@@ -116,21 +119,19 @@ public void visitInvokeDynamicInsn(String name, String descriptor, Handle bootst\n \t\t\tsuper.visitInvokeDynamicInsn(name, descriptor, bootstrapMethodHandle, bootstrapMethodArguments);\n \t\t}\n \n-\n \t\tprivate boolean shouldRecordMethodCall(String owner, String method) {\n \t\t\tString methodReference = owner + \"#\" + method;\n \t\t\treturn instrumentedMethods.contains(methodReference);\n \t\t}\n \n \t\tprivate String rewriteMethodName(String owner, String methodName) {\n \t\t\tint classIndex = owner.lastIndexOf('/');\n-\t\t\treturn owner.substring(classIndex + 1).toLowerCase() + methodName;\n+\t\t\treturn owner.substring(classIndex + 1).toLowerCase(Locale.ROOT) + methodName;\n \t\t}\n \n \t\tprivate String rewriteDescriptor(int opcode, String owner, String name, String descriptor) {\n \t\t\treturn (opcode == Opcodes.INVOKESTATIC || opcode == Opcodes.H_INVOKESTATIC) ? descriptor : \"(L\" + owner + \";\" + descriptor.substring(1);\n \t\t}\n-\n \t}\n \n }"
            },
            {
                "sha": "694e85b87683933abb2c9cc6a629b7b0e9b3d476",
                "filename": "spring-core/src/main/java/org/springframework/core/convert/support/StringToBooleanConverter.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fcore%2Fconvert%2Fsupport%2FStringToBooleanConverter.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fcore%2Fconvert%2Fsupport%2FStringToBooleanConverter.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fcore%2Fconvert%2Fsupport%2FStringToBooleanConverter.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2022 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -16,6 +16,7 @@\n \n package org.springframework.core.convert.support;\n \n+import java.util.Locale;\n import java.util.Set;\n \n import org.springframework.core.convert.converter.Converter;\n@@ -43,7 +44,7 @@ public Boolean convert(String source) {\n \t\tif (value.isEmpty()) {\n \t\t\treturn null;\n \t\t}\n-\t\tvalue = value.toLowerCase();\n+\t\tvalue = value.toLowerCase(Locale.ROOT);\n \t\tif (trueValues.contains(value)) {\n \t\t\treturn Boolean.TRUE;\n \t\t}"
            },
            {
                "sha": "ebea2712530954c4398165cc178c2ea742f48525",
                "filename": "spring-core/src/main/java/org/springframework/core/env/SystemEnvironmentPropertySource.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fcore%2Fenv%2FSystemEnvironmentPropertySource.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fcore%2Fenv%2FSystemEnvironmentPropertySource.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fcore%2Fenv%2FSystemEnvironmentPropertySource.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2021 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -16,6 +16,7 @@\n \n package org.springframework.core.env;\n \n+import java.util.Locale;\n import java.util.Map;\n \n import org.springframework.lang.Nullable;\n@@ -109,7 +110,7 @@ protected final String resolvePropertyName(String name) {\n \t\tif (resolvedName != null) {\n \t\t\treturn resolvedName;\n \t\t}\n-\t\tString uppercasedName = name.toUpperCase();\n+\t\tString uppercasedName = name.toUpperCase(Locale.ROOT);\n \t\tif (!name.equals(uppercasedName)) {\n \t\t\tresolvedName = checkPropertyName(uppercasedName);\n \t\t\tif (resolvedName != null) {"
            },
            {
                "sha": "9a2f12f1cdbf1dd76c015cc6eb3311ff7a424ce8",
                "filename": "spring-core/src/main/java/org/springframework/util/ResourceUtils.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Futil%2FResourceUtils.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Futil%2FResourceUtils.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Futil%2FResourceUtils.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -24,6 +24,7 @@\n import java.net.URISyntaxException;\n import java.net.URL;\n import java.net.URLConnection;\n+import java.util.Locale;\n \n import org.springframework.lang.Nullable;\n \n@@ -306,7 +307,7 @@ public static boolean isJarURL(URL url) {\n \t */\n \tpublic static boolean isJarFileURL(URL url) {\n \t\treturn (URL_PROTOCOL_FILE.equals(url.getProtocol()) &&\n-\t\t\t\turl.getPath().toLowerCase().endsWith(JAR_FILE_EXTENSION));\n+\t\t\t\turl.getPath().toLowerCase(Locale.ROOT).endsWith(JAR_FILE_EXTENSION));\n \t}\n \n \t/**"
            },
            {
                "sha": "9d5053a0e2df5844548e36da7b336932dbdde708",
                "filename": "spring-expression/src/main/java/org/springframework/expression/spel/SpelParserConfiguration.java",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2FSpelParserConfiguration.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2FSpelParserConfiguration.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2FSpelParserConfiguration.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -16,6 +16,8 @@\n \n package org.springframework.expression.spel;\n \n+import java.util.Locale;\n+\n import org.springframework.core.SpringProperties;\n import org.springframework.lang.Nullable;\n \n@@ -46,7 +48,7 @@ public class SpelParserConfiguration {\n \tstatic {\n \t\tString compilerMode = SpringProperties.getProperty(SPRING_EXPRESSION_COMPILER_MODE_PROPERTY_NAME);\n \t\tdefaultCompilerMode = (compilerMode != null ?\n-\t\t\t\tSpelCompilerMode.valueOf(compilerMode.toUpperCase()) : SpelCompilerMode.OFF);\n+\t\t\t\tSpelCompilerMode.valueOf(compilerMode.toUpperCase(Locale.ROOT)) : SpelCompilerMode.OFF);\n \t}\n \n "
            },
            {
                "sha": "0085bb6856cb8f8c56e57dee7818c45c8e30b95e",
                "filename": "spring-expression/src/main/java/org/springframework/expression/spel/ast/TypeReference.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2Fast%2FTypeReference.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2Fast%2FTypeReference.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2Fast%2FTypeReference.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -17,6 +17,7 @@\n package org.springframework.expression.spel.ast;\n \n import java.lang.reflect.Array;\n+import java.util.Locale;\n \n import org.springframework.asm.MethodVisitor;\n import org.springframework.asm.Type;\n@@ -58,7 +59,7 @@ public TypedValue getValueInternal(ExpressionState state) throws EvaluationExcep\n \t\tString typeName = (String) this.children[0].getValueInternal(state).getValue();\n \t\tAssert.state(typeName != null, \"No type name\");\n \t\tif (!typeName.contains(\".\") && Character.isLowerCase(typeName.charAt(0))) {\n-\t\t\tTypeCode tc = TypeCode.valueOf(typeName.toUpperCase());\n+\t\t\tTypeCode tc = TypeCode.valueOf(typeName.toUpperCase(Locale.ROOT));\n \t\t\tif (tc != TypeCode.OBJECT) {\n \t\t\t\t// It is a primitive type\n \t\t\t\tClass<?> clazz = makeArrayIfNecessary(tc.getType());"
            },
            {
                "sha": "c8c341a543757049aeacbc3b10f324644db7b9c9",
                "filename": "spring-expression/src/main/java/org/springframework/expression/spel/standard/InternalSpelExpressionParser.java",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2Fstandard%2FInternalSpelExpressionParser.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2Fstandard%2FInternalSpelExpressionParser.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2Fstandard%2FInternalSpelExpressionParser.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -21,6 +21,7 @@\n import java.util.Collections;\n import java.util.Deque;\n import java.util.List;\n+import java.util.Locale;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n import java.util.regex.Pattern;\n@@ -750,7 +751,7 @@ private SpelNodeImpl eatPossiblyQualifiedId() {\n \t\t\t\tthrow internalException( this.expressionString.length(), SpelMessage.OOD);\n \t\t\t}\n \t\t\tthrow internalException(node.startPos, SpelMessage.NOT_EXPECTED_TOKEN,\n-\t\t\t\t\t\"qualified ID\", node.getKind().toString().toLowerCase());\n+\t\t\t\t\t\"qualified ID\", node.getKind().toString().toLowerCase(Locale.ROOT));\n \t\t}\n \t\treturn new QualifiedIdentifier(qualifiedIdPieces.getFirst().getStartPosition(),\n \t\t\t\tqualifiedIdPieces.getLast().getEndPosition(), qualifiedIdPieces.toArray(new SpelNodeImpl[0]));\n@@ -942,7 +943,7 @@ private Token eatToken(TokenKind expectedKind) {\n \t\t}\n \t\tif (t.kind != expectedKind) {\n \t\t\tthrow internalException(t.startPos, SpelMessage.NOT_EXPECTED_TOKEN,\n-\t\t\t\t\texpectedKind.toString().toLowerCase(), t.getKind().toString().toLowerCase());\n+\t\t\t\t\texpectedKind.toString().toLowerCase(Locale.ROOT), t.getKind().toString().toLowerCase(Locale.ROOT));\n \t\t}\n \t\treturn t;\n \t}\n@@ -1038,7 +1039,7 @@ public String toString(@Nullable Token t) {\n \t\tif (t.getKind().hasPayload()) {\n \t\t\treturn t.stringValue();\n \t\t}\n-\t\treturn t.kind.toString().toLowerCase();\n+\t\treturn t.kind.toString().toLowerCase(Locale.ROOT);\n \t}\n \n \tprivate void checkOperands(Token token, @Nullable SpelNodeImpl left, @Nullable SpelNodeImpl right) {"
            },
            {
                "sha": "379ca5b22250ca593a685519fc25450e0b85e7ae",
                "filename": "spring-expression/src/main/java/org/springframework/expression/spel/standard/Tokenizer.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2Fstandard%2FTokenizer.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2Fstandard%2FTokenizer.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-expression%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fexpression%2Fspel%2Fstandard%2FTokenizer.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -19,6 +19,7 @@\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n+import java.util.Locale;\n \n import org.springframework.expression.spel.InternalParseException;\n import org.springframework.expression.spel.SpelMessage;\n@@ -457,7 +458,7 @@ private void lexIdentifier() {\n \t\t// Check if this is the alternative (textual) representation of an operator (see\n \t\t// ALTERNATIVE_OPERATOR_NAMES).\n \t\tif (subarray.length == 2 || subarray.length == 3) {\n-\t\t\tString asString = new String(subarray).toUpperCase();\n+\t\t\tString asString = new String(subarray).toUpperCase(Locale.ROOT);\n \t\t\tint idx = Arrays.binarySearch(ALTERNATIVE_OPERATOR_NAMES, asString);\n \t\t\tif (idx >= 0) {\n \t\t\t\tpushOneCharOrTwoCharToken(TokenKind.valueOf(asString), start, subarray);"
            },
            {
                "sha": "fdc66aa1c34236169f7851e77a7d27f5dadeaf9c",
                "filename": "spring-jdbc/src/main/java/org/springframework/jdbc/core/metadata/CallMetaDataContext.java",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FCallMetaDataContext.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FCallMetaDataContext.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FCallMetaDataContext.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -385,7 +385,7 @@ protected List<SqlParameter> reconcileParameters(List<SqlParameter> parameters)\n \t\t\t\tif (meta.isReturnParameter()) {\n \t\t\t\t\tparam = declaredParams.get(getFunctionReturnName());\n \t\t\t\t\tif (param == null && !getOutParameterNames().isEmpty()) {\n-\t\t\t\t\t\tparam = declaredParams.get(getOutParameterNames().get(0).toLowerCase());\n+\t\t\t\t\t\tparam = declaredParams.get(getOutParameterNames().get(0).toLowerCase(Locale.ROOT));\n \t\t\t\t\t}\n \t\t\t\t\tif (param == null) {\n \t\t\t\t\t\tthrow new InvalidDataAccessApiUsageException(\n@@ -488,15 +488,15 @@ public Map<String, Object> matchInParameterValuesWithCallParameters(SqlParameter\n \t\t\t\tString parameterName = parameter.getName();\n \t\t\t\tString parameterNameToMatch = obtainMetaDataProvider().parameterNameToUse(parameterName);\n \t\t\t\tif (parameterNameToMatch != null) {\n-\t\t\t\t\tcallParameterNames.put(parameterNameToMatch.toLowerCase(), parameterName);\n+\t\t\t\t\tcallParameterNames.put(parameterNameToMatch.toLowerCase(Locale.ROOT), parameterName);\n \t\t\t\t}\n \t\t\t\tif (parameterName != null) {\n \t\t\t\t\tif (parameterSource.hasValue(parameterName)) {\n \t\t\t\t\t\tmatchedParameters.put(parameterName,\n \t\t\t\t\t\t\t\tSqlParameterSourceUtils.getTypedValue(parameterSource, parameterName));\n \t\t\t\t\t}\n \t\t\t\t\telse {\n-\t\t\t\t\t\tString lowerCaseName = parameterName.toLowerCase();\n+\t\t\t\t\t\tString lowerCaseName = parameterName.toLowerCase(Locale.ROOT);\n \t\t\t\t\t\tif (parameterSource.hasValue(lowerCaseName)) {\n \t\t\t\t\t\t\tmatchedParameters.put(parameterName,\n \t\t\t\t\t\t\t\t\tSqlParameterSourceUtils.getTypedValue(parameterSource, lowerCaseName));\n@@ -556,7 +556,7 @@ else if (logger.isInfoEnabled()) {\n \t\t\t\tString parameterName = parameter.getName();\n \t\t\t\tString parameterNameToMatch = provider.parameterNameToUse(parameterName);\n \t\t\t\tif (parameterNameToMatch != null) {\n-\t\t\t\t\tcallParameterNames.put(parameterNameToMatch.toLowerCase(), parameterName);\n+\t\t\t\t\tcallParameterNames.put(parameterNameToMatch.toLowerCase(Locale.ROOT), parameterName);\n \t\t\t\t}\n \t\t\t}\n \t\t}\n@@ -681,7 +681,7 @@ protected String createParameterBinding(SqlParameter parameter) {\n \t}\n \n \tprivate static String lowerCase(@Nullable String paramName) {\n-\t\treturn (paramName != null ? paramName.toLowerCase() : \"\");\n+\t\treturn (paramName != null ? paramName.toLowerCase(Locale.ROOT) : \"\");\n \t}\n \n }"
            },
            {
                "sha": "66c49564681c54352151b42ec3561dc85b91a130",
                "filename": "spring-jdbc/src/main/java/org/springframework/jdbc/core/metadata/Db2CallMetaDataProvider.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FDb2CallMetaDataProvider.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FDb2CallMetaDataProvider.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FDb2CallMetaDataProvider.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2018 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -18,6 +18,7 @@\n \n import java.sql.DatabaseMetaData;\n import java.sql.SQLException;\n+import java.util.Locale;\n \n import org.springframework.lang.Nullable;\n \n@@ -73,7 +74,7 @@ public String metaDataSchemaNameToUse(@Nullable String schemaName) {\n \n \t\t// Use current user schema if no schema specified...\n \t\tString userName = getUserName();\n-\t\treturn (userName != null ? userName.toUpperCase() : null);\n+\t\treturn (userName != null ? userName.toUpperCase(Locale.ROOT) : null);\n \t}\n \n }"
            },
            {
                "sha": "efaa556cf6b3d1dccd0022c7596500db1318b13b",
                "filename": "spring-jdbc/src/main/java/org/springframework/jdbc/core/metadata/DerbyCallMetaDataProvider.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FDerbyCallMetaDataProvider.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FDerbyCallMetaDataProvider.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FDerbyCallMetaDataProvider.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2018 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -18,6 +18,7 @@\n \n import java.sql.DatabaseMetaData;\n import java.sql.SQLException;\n+import java.util.Locale;\n \n import org.springframework.lang.Nullable;\n \n@@ -45,7 +46,7 @@ public String metaDataSchemaNameToUse(@Nullable String schemaName) {\n \n \t\t// Use current user schema if no schema specified...\n \t\tString userName = getUserName();\n-\t\treturn (userName != null ? userName.toUpperCase() : null);\n+\t\treturn (userName != null ? userName.toUpperCase(Locale.ROOT) : null);\n \t}\n \n }"
            },
            {
                "sha": "5eb124b063f68ee6b10e459fcee1a99f771b8530",
                "filename": "spring-jdbc/src/main/java/org/springframework/jdbc/core/metadata/GenericCallMetaDataProvider.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FGenericCallMetaDataProvider.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FGenericCallMetaDataProvider.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FGenericCallMetaDataProvider.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -22,6 +22,7 @@\n import java.sql.Types;\n import java.util.ArrayList;\n import java.util.List;\n+import java.util.Locale;\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n@@ -284,10 +285,10 @@ private String identifierNameToUse(@Nullable String identifierName) {\n \t\t\treturn null;\n \t\t}\n \t\telse if (isStoresUpperCaseIdentifiers()) {\n-\t\t\treturn identifierName.toUpperCase();\n+\t\t\treturn identifierName.toUpperCase(Locale.ROOT);\n \t\t}\n \t\telse if (isStoresLowerCaseIdentifiers()) {\n-\t\t\treturn identifierName.toLowerCase();\n+\t\t\treturn identifierName.toLowerCase(Locale.ROOT);\n \t\t}\n \t\telse {\n \t\t\treturn identifierName;"
            },
            {
                "sha": "b5e65f418b9bd99c179b5c7bad3efcce807cab58",
                "filename": "spring-jdbc/src/main/java/org/springframework/jdbc/core/metadata/GenericTableMetaDataProvider.java",
                "status": "modified",
                "additions": 7,
                "deletions": 6,
                "changes": 13,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FGenericTableMetaDataProvider.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FGenericTableMetaDataProvider.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FGenericTableMetaDataProvider.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -24,6 +24,7 @@\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.List;\n+import java.util.Locale;\n import java.util.Map;\n \n import org.apache.commons.logging.Log;\n@@ -214,10 +215,10 @@ private String identifierNameToUse(@Nullable String identifierName) {\n \t\t\treturn null;\n \t\t}\n \t\telse if (isStoresUpperCaseIdentifiers()) {\n-\t\t\treturn identifierName.toUpperCase();\n+\t\t\treturn identifierName.toUpperCase(Locale.ROOT);\n \t\t}\n \t\telse if (isStoresLowerCaseIdentifiers()) {\n-\t\t\treturn identifierName.toLowerCase();\n+\t\t\treturn identifierName.toLowerCase(Locale.ROOT);\n \t\t}\n \t\telse {\n \t\t\treturn identifierName;\n@@ -326,10 +327,10 @@ private void locateTableAndProcessMetaData(DatabaseMetaData databaseMetaData,\n \t\t\t\tTableMetaData tmd = new TableMetaData(tables.getString(\"TABLE_CAT\"),\n \t\t\t\t\t\ttables.getString(\"TABLE_SCHEM\"), tables.getString(\"TABLE_NAME\"));\n \t\t\t\tif (tmd.schemaName() == null) {\n-\t\t\t\t\ttableMeta.put(this.userName != null ? this.userName.toUpperCase() : \"\", tmd);\n+\t\t\t\t\ttableMeta.put(this.userName != null ? this.userName.toUpperCase(Locale.ROOT) : \"\", tmd);\n \t\t\t\t}\n \t\t\t\telse {\n-\t\t\t\t\ttableMeta.put(tmd.schemaName().toUpperCase(), tmd);\n+\t\t\t\t\ttableMeta.put(tmd.schemaName().toUpperCase(Locale.ROOT), tmd);\n \t\t\t\t}\n \t\t\t}\n \t\t}\n@@ -356,7 +357,7 @@ private TableMetaData findTableMetaData(@Nullable String schemaName, @Nullable S\n \t\t\tMap<String, TableMetaData> tableMeta) {\n \n \t\tif (schemaName != null) {\n-\t\t\tTableMetaData tmd = tableMeta.get(schemaName.toUpperCase());\n+\t\t\tTableMetaData tmd = tableMeta.get(schemaName.toUpperCase(Locale.ROOT));\n \t\t\tif (tmd == null) {\n \t\t\t\tthrow new DataAccessResourceFailureException(\"Unable to locate table meta-data for '\" +\n \t\t\t\t\t\ttableName + \"' in the '\" + schemaName + \"' schema\");\n@@ -369,7 +370,7 @@ else if (tableMeta.size() == 1) {\n \t\telse {\n \t\t\tTableMetaData tmd = tableMeta.get(getDefaultSchema());\n \t\t\tif (tmd == null) {\n-\t\t\t\ttmd = tableMeta.get(this.userName != null ? this.userName.toUpperCase() : \"\");\n+\t\t\t\ttmd = tableMeta.get(this.userName != null ? this.userName.toUpperCase(Locale.ROOT) : \"\");\n \t\t\t}\n \t\t\tif (tmd == null) {\n \t\t\t\ttmd = tableMeta.get(\"PUBLIC\");"
            },
            {
                "sha": "5b655509783e29382e1698e53dd6a0ddcc65cbf9",
                "filename": "spring-jdbc/src/main/java/org/springframework/jdbc/core/metadata/TableMetaDataContext.java",
                "status": "modified",
                "additions": 9,
                "deletions": 8,
                "changes": 17,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FTableMetaDataContext.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FTableMetaDataContext.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fmetadata%2FTableMetaDataContext.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -20,6 +20,7 @@\n import java.util.Collections;\n import java.util.LinkedHashSet;\n import java.util.List;\n+import java.util.Locale;\n import java.util.Map;\n import java.util.Set;\n \n@@ -217,11 +218,11 @@ protected List<String> reconcileColumnsToUse(List<String> declaredColumns, Strin\n \t\t}\n \t\tSet<String> keys = new LinkedHashSet<>(generatedKeyNames.length);\n \t\tfor (String key : generatedKeyNames) {\n-\t\t\tkeys.add(key.toUpperCase());\n+\t\t\tkeys.add(key.toUpperCase(Locale.ROOT));\n \t\t}\n \t\tList<String> columns = new ArrayList<>();\n \t\tfor (TableParameterMetaData meta : obtainMetaDataProvider().getTableParameterMetaData()) {\n-\t\t\tif (!keys.contains(meta.getParameterName().toUpperCase())) {\n+\t\t\tif (!keys.contains(meta.getParameterName().toUpperCase(Locale.ROOT))) {\n \t\t\t\tcolumns.add(meta.getParameterName());\n \t\t\t}\n \t\t}\n@@ -243,7 +244,7 @@ public List<Object> matchInParameterValuesWithInsertColumns(SqlParameterSource p\n \t\t\t\tvalues.add(SqlParameterSourceUtils.getTypedValue(parameterSource, column));\n \t\t\t}\n \t\t\telse {\n-\t\t\t\tString lowerCaseName = column.toLowerCase();\n+\t\t\t\tString lowerCaseName = column.toLowerCase(Locale.ROOT);\n \t\t\t\tif (parameterSource.hasValue(lowerCaseName)) {\n \t\t\t\t\tvalues.add(SqlParameterSourceUtils.getTypedValue(parameterSource, lowerCaseName));\n \t\t\t\t}\n@@ -276,7 +277,7 @@ public List<Object> matchInParameterValuesWithInsertColumns(Map<String, ?> inPar\n \t\tfor (String column : this.tableColumns) {\n \t\t\tObject value = inParameters.get(column);\n \t\t\tif (value == null) {\n-\t\t\t\tvalue = inParameters.get(column.toLowerCase());\n+\t\t\t\tvalue = inParameters.get(column.toLowerCase(Locale.ROOT));\n \t\t\t\tif (value == null) {\n \t\t\t\t\tfor (Map.Entry<String, ?> entry : inParameters.entrySet()) {\n \t\t\t\t\t\tif (column.equalsIgnoreCase(entry.getKey())) {\n@@ -298,7 +299,7 @@ public List<Object> matchInParameterValuesWithInsertColumns(Map<String, ?> inPar\n \tpublic String createInsertString(String... generatedKeyNames) {\n \t\tSet<String> keys = new LinkedHashSet<>(generatedKeyNames.length);\n \t\tfor (String key : generatedKeyNames) {\n-\t\t\tkeys.add(key.toUpperCase());\n+\t\t\tkeys.add(key.toUpperCase(Locale.ROOT));\n \t\t}\n \n \t\tString identifierQuoteString = (isQuoteIdentifiers() ?\n@@ -326,7 +327,7 @@ public String createInsertString(String... generatedKeyNames) {\n \t\tinsertStatement.append(\" (\");\n \t\tint columnCount = 0;\n \t\tfor (String columnName : getTableColumns()) {\n-\t\t\tif (!keys.contains(columnName.toUpperCase())) {\n+\t\t\tif (!keys.contains(columnName.toUpperCase(Locale.ROOT))) {\n \t\t\t\tcolumnCount++;\n \t\t\t\tif (columnCount > 1) {\n \t\t\t\t\tinsertStatement.append(\", \");\n@@ -366,15 +367,15 @@ public int[] createInsertTypes() {\n \t\tList<TableParameterMetaData> parameters = obtainMetaDataProvider().getTableParameterMetaData();\n \t\tMap<String, TableParameterMetaData> parameterMap = CollectionUtils.newLinkedHashMap(parameters.size());\n \t\tfor (TableParameterMetaData tpmd : parameters) {\n-\t\t\tparameterMap.put(tpmd.getParameterName().toUpperCase(), tpmd);\n+\t\t\tparameterMap.put(tpmd.getParameterName().toUpperCase(Locale.ROOT), tpmd);\n \t\t}\n \t\tint typeIndx = 0;\n \t\tfor (String column : getTableColumns()) {\n \t\t\tif (column == null) {\n \t\t\t\ttypes[typeIndx] = SqlTypeValue.TYPE_UNKNOWN;\n \t\t\t}\n \t\t\telse {\n-\t\t\t\tTableParameterMetaData tpmd = parameterMap.get(column.toUpperCase());\n+\t\t\t\tTableParameterMetaData tpmd = parameterMap.get(column.toUpperCase(Locale.ROOT));\n \t\t\t\tif (tpmd != null) {\n \t\t\t\t\ttypes[typeIndx] = tpmd.getSqlType();\n \t\t\t\t}"
            },
            {
                "sha": "9709561eb2866cf54365f430e330060dba500731",
                "filename": "spring-jdbc/src/main/java/org/springframework/jdbc/core/namedparam/SqlParameterSourceUtils.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fnamedparam%2FSqlParameterSourceUtils.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fnamedparam%2FSqlParameterSourceUtils.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fnamedparam%2FSqlParameterSourceUtils.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2023 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -19,6 +19,7 @@\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.HashMap;\n+import java.util.Locale;\n import java.util.Map;\n \n import org.springframework.jdbc.core.SqlParameterValue;\n@@ -115,7 +116,7 @@ public static Map<String, String> extractCaseInsensitiveParameterNames(SqlParame\n \t\tString[] paramNames = parameterSource.getParameterNames();\n \t\tif (paramNames != null) {\n \t\t\tfor (String name : paramNames) {\n-\t\t\t\tcaseInsensitiveParameterNames.put(name.toLowerCase(), name);\n+\t\t\t\tcaseInsensitiveParameterNames.put(name.toLowerCase(Locale.ROOT), name);\n \t\t\t}\n \t\t}\n \t\treturn caseInsensitiveParameterNames;"
            },
            {
                "sha": "6b86dbb67390785fb7a1d67ca49808a60c3babe2",
                "filename": "spring-jdbc/src/main/java/org/springframework/jdbc/core/simple/AbstractJdbcInsert.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fsimple%2FAbstractJdbcInsert.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fsimple%2FAbstractJdbcInsert.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-jdbc%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjdbc%2Fcore%2Fsimple%2FAbstractJdbcInsert.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2023 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -26,6 +26,7 @@\n import java.util.Collections;\n import java.util.HashMap;\n import java.util.List;\n+import java.util.Locale;\n import java.util.Map;\n \n import javax.sql.DataSource;\n@@ -490,7 +491,7 @@ private KeyHolder executeInsertAndReturnKeyHolderInternal(List<?> values) {\n \t\t\t// get generated keys feature. HSQL is one, PostgreSQL is another. Postgres uses a RETURNING\n \t\t\t// clause while HSQL uses a second query that has to be executed with the same connection.\n \n-\t\t\tif (keyQuery.toUpperCase().startsWith(\"RETURNING\")) {\n+\t\t\tif (keyQuery.toUpperCase(Locale.ROOT).startsWith(\"RETURNING\")) {\n \t\t\t\tLong key = getJdbcTemplate().queryForObject(\n \t\t\t\t\t\tgetInsertString() + \" \" + keyQuery, Long.class, values.toArray());\n \t\t\t\tMap<String, Object> keys = new HashMap<>(2);"
            },
            {
                "sha": "85d075415a9a6469bb9667d7b1fab6c8277aedfb",
                "filename": "spring-jms/src/main/java/org/springframework/jms/config/JmsListenerContainerParser.java",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jms%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjms%2Fconfig%2FJmsListenerContainerParser.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-jms%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjms%2Fconfig%2FJmsListenerContainerParser.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-jms%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Fjms%2Fconfig%2FJmsListenerContainerParser.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2020 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -16,6 +16,8 @@\n \n package org.springframework.jms.config;\n \n+import java.util.Locale;\n+\n import jakarta.jms.Session;\n import org.w3c.dom.Element;\n \n@@ -155,7 +157,7 @@ protected MutablePropertyValues parseSpecificContainerProperties(Element contain\n \t\t\t\t}\n \t\t\t}\n \t\t\telse {\n-\t\t\t\tproperties.add(\"cacheLevelName\", \"CACHE_\" + cache.toUpperCase());\n+\t\t\t\tproperties.add(\"cacheLevelName\", \"CACHE_\" + cache.toUpperCase(Locale.ROOT));\n \t\t\t}\n \t\t}\n "
            },
            {
                "sha": "c348ef157665b1f2864b0d19297fdc94533e1b0a",
                "filename": "spring-test/src/main/java/org/springframework/test/context/NestedTestConfiguration.java",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-test%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Ftest%2Fcontext%2FNestedTestConfiguration.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-test%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Ftest%2Fcontext%2FNestedTestConfiguration.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-test%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Ftest%2Fcontext%2FNestedTestConfiguration.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2023 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -22,6 +22,7 @@\n import java.lang.annotation.Retention;\n import java.lang.annotation.RetentionPolicy;\n import java.lang.annotation.Target;\n+import java.util.Locale;\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n@@ -159,7 +160,7 @@ public static EnclosingConfiguration from(@Nullable String name) {\n \t\t\t\treturn null;\n \t\t\t}\n \t\t\ttry {\n-\t\t\t\treturn EnclosingConfiguration.valueOf(name.trim().toUpperCase());\n+\t\t\t\treturn EnclosingConfiguration.valueOf(name.trim().toUpperCase(Locale.ROOT));\n \t\t\t}\n \t\t\tcatch (IllegalArgumentException ex) {\n \t\t\t\tLog logger = LogFactory.getLog(EnclosingConfiguration.class);\n@@ -171,7 +172,6 @@ public static EnclosingConfiguration from(@Nullable String name) {\n \t\t\t\treturn null;\n \t\t\t}\n \t\t}\n-\n \t}\n \n }"
            },
            {
                "sha": "8997f455b6118be0a6fc95c1449ed49e95ceee21",
                "filename": "spring-test/src/main/java/org/springframework/test/context/TestConstructor.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/spring-projects/spring-framework/blob/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-test%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Ftest%2Fcontext%2FTestConstructor.java",
                "raw_url": "https://github.com/spring-projects/spring-framework/raw/11d4272ff48b4a4dabc4b28dfbff0364a4204bc9/spring-test%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Ftest%2Fcontext%2FTestConstructor.java",
                "contents_url": "https://api.github.com/repos/spring-projects/spring-framework/contents/spring-test%2Fsrc%2Fmain%2Fjava%2Forg%2Fspringframework%2Ftest%2Fcontext%2FTestConstructor.java?ref=11d4272ff48b4a4dabc4b28dfbff0364a4204bc9",
                "patch": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2002-2023 the original author or authors.\n+ * Copyright 2002-2024 the original author or authors.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n@@ -22,6 +22,7 @@\n import java.lang.annotation.Retention;\n import java.lang.annotation.RetentionPolicy;\n import java.lang.annotation.Target;\n+import java.util.Locale;\n \n import org.apache.commons.logging.Log;\n import org.apache.commons.logging.LogFactory;\n@@ -161,7 +162,7 @@ public static AutowireMode from(@Nullable String name) {\n \t\t\t\treturn null;\n \t\t\t}\n \t\t\ttry {\n-\t\t\t\treturn AutowireMode.valueOf(name.trim().toUpperCase());\n+\t\t\t\treturn AutowireMode.valueOf(name.trim().toUpperCase(Locale.ROOT));\n \t\t\t}\n \t\t\tcatch (IllegalArgumentException ex) {\n \t\t\t\tLog logger = LogFactory.getLog(AutowireMode.class);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/radareorg/radare2/commits/72bf3a486fa851797aa21887a40ba0e3d3a6d620",
        "url": "https://api.github.com/repos/radareorg/radare2/commits/72bf3a486fa851797aa21887a40ba0e3d3a6d620",
        "html_url": "https://github.com/radareorg/radare2/commit/72bf3a486fa851797aa21887a40ba0e3d3a6d620",
        "message": "Fix oob write for dwarf with abbrev with count 0",
        "files": [
            {
                "sha": "cce730aaf5ec52c58e0f270555c8701fcb411e7f",
                "filename": "libr/bin/dwarf.c",
                "status": "modified",
                "additions": 32,
                "deletions": 26,
                "changes": 58,
                "blob_url": "https://github.com/radareorg/radare2/blob/72bf3a486fa851797aa21887a40ba0e3d3a6d620/libr%2Fbin%2Fdwarf.c",
                "raw_url": "https://github.com/radareorg/radare2/raw/72bf3a486fa851797aa21887a40ba0e3d3a6d620/libr%2Fbin%2Fdwarf.c",
                "contents_url": "https://api.github.com/repos/radareorg/radare2/contents/libr%2Fbin%2Fdwarf.c?ref=72bf3a486fa851797aa21887a40ba0e3d3a6d620",
                "patch": "@@ -1492,9 +1492,13 @@ static bool init_die(RBinDwarfDie *die, ut64 abbr_code, ut64 attr_count) {\n \tif (!die) {\n \t\treturn false;\n \t}\n-\tdie->attr_values = calloc (sizeof (RBinDwarfAttrValue), attr_count);\n-\tif (!die->attr_values) {\n-\t\treturn false;\n+\tif (attr_count) {\n+\t\tdie->attr_values = calloc (sizeof (RBinDwarfAttrValue), attr_count);\n+\t\tif (!die->attr_values) {\n+\t\t\treturn false;\n+\t\t}\n+\t} else {\n+\t\tdie->attr_values = NULL;\n \t}\n \tdie->abbrev_code = abbr_code;\n \tdie->capacity = attr_count;\n@@ -2176,30 +2180,32 @@ static const ut8 *parse_die(RBin *bin, const ut8 *buf, const ut8 *buf_end, RBinD\n \tfor (i = 0; i < die->count; i++) {\n \t\tmemset (&die->attr_values[i], 0, sizeof (RBinDwarfDie));\n \t}\n-\tfor (i = 0; i < abbrev->count && i < die->capacity; i++) {\n-\t\tmemset (&die->attr_values[i], 0, sizeof (die->attr_values[i]));\n-\t\t// debug_str_len = r_str_nlen (debug_str, buf_end - buf);\n-\t\tconst ut8 *nbuf = parse_attr_value (bin, buf, buf_end - buf,\n-\t\t\t&abbrev->defs[i], &die->attr_values[i], hdr, be);\n-\t\tif (!nbuf) {\n-\t\t\tbreak;\n-\t\t}\n-\t\tbuf = nbuf;\n-\t\tRBinDwarfAttrValue *attribute = &die->attr_values[i];\n-\n-\t\tbool is_string = (attribute->attr_form == DW_FORM_strp || attribute->attr_form == DW_FORM_string ||\n-\t\t\tattribute->attr_form == DW_FORM_line_strp);\n-\t\tbool is_valid_string_form = is_string && attribute->string.content;\n-\t\tif (attribute->attr_name == DW_AT_stmt_list) {\n-\t\t\tdebug_line_offset = attribute->reference;\n-\t\t}\n-\t\tif (attribute->attr_name == DW_AT_comp_dir && is_valid_string_form) {\n-\t\t\tcomp_dir = strdup (attribute->string.content);\n-\t\t\tr_str_ansi_strip (comp_dir);\n-\t\t\tr_str_replace_ch (comp_dir, '\\n', 0, true);\n-\t\t\tr_str_replace_ch (comp_dir, '\\t', 0, true);\n+\tif (abbrev->count) {\n+\t\tfor (i = 0; i < abbrev->count && i < die->capacity; i++) {\n+\t\t\tmemset (&die->attr_values[i], 0, sizeof (die->attr_values[i]));\n+\t\t\t// debug_str_len = r_str_nlen (debug_str, buf_end - buf);\n+\t\t\tconst ut8 *nbuf = parse_attr_value (bin, buf, buf_end - buf,\n+\t\t\t\t&abbrev->defs[i], &die->attr_values[i], hdr, be);\n+\t\t\tif (!nbuf) {\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\tbuf = nbuf;\n+\t\t\tRBinDwarfAttrValue *attribute = &die->attr_values[i];\n+\n+\t\t\tbool is_string = (attribute->attr_form == DW_FORM_strp || attribute->attr_form == DW_FORM_string ||\n+\t\t\t\tattribute->attr_form == DW_FORM_line_strp);\n+\t\t\tbool is_valid_string_form = is_string && attribute->string.content;\n+\t\t\tif (attribute->attr_name == DW_AT_stmt_list) {\n+\t\t\t\tdebug_line_offset = attribute->reference;\n+\t\t\t}\n+\t\t\tif (attribute->attr_name == DW_AT_comp_dir && is_valid_string_form) {\n+\t\t\t\tcomp_dir = strdup (attribute->string.content);\n+\t\t\t\tr_str_ansi_strip (comp_dir);\n+\t\t\t\tr_str_replace_ch (comp_dir, '\\n', 0, true);\n+\t\t\t\tr_str_replace_ch (comp_dir, '\\t', 0, true);\n+\t\t\t}\n+\t\t\tdie->count++;\n \t\t}\n-\t\tdie->count++;\n \t}\n \tcomp_dir_key = get_compilation_directory_key (debug_line_offset);\n \tif (!comp_dir_key) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rizinorg/rizin/commits/e42999dda0be7737fafaf5e63c1c5833a72fd9c9",
        "url": "https://api.github.com/repos/rizinorg/rizin/commits/e42999dda0be7737fafaf5e63c1c5833a72fd9c9",
        "html_url": "https://github.com/rizinorg/rizin/commit/e42999dda0be7737fafaf5e63c1c5833a72fd9c9",
        "message": "mach0_chained_fixup must exit if we cannot read at the current offset.\n\nThis also fixes a log ouptut and optimize the loop iteration",
        "files": [
            {
                "sha": "a56f7e1b1da8029895ddff46d50465fa17a0028e",
                "filename": "librz/bin/format/mach0/mach0_chained_fixups.c",
                "status": "modified",
                "additions": 8,
                "deletions": 7,
                "changes": 15,
                "blob_url": "https://github.com/rizinorg/rizin/blob/e42999dda0be7737fafaf5e63c1c5833a72fd9c9/librz%2Fbin%2Fformat%2Fmach0%2Fmach0_chained_fixups.c",
                "raw_url": "https://github.com/rizinorg/rizin/raw/e42999dda0be7737fafaf5e63c1c5833a72fd9c9/librz%2Fbin%2Fformat%2Fmach0%2Fmach0_chained_fixups.c",
                "contents_url": "https://api.github.com/repos/rizinorg/rizin/contents/librz%2Fbin%2Fformat%2Fmach0%2Fmach0_chained_fixups.c?ref=e42999dda0be7737fafaf5e63c1c5833a72fd9c9",
                "patch": "@@ -179,7 +179,7 @@ RZ_IPI bool MACH0_(parse_chained_fixups)(struct MACH0_(obj_t) * bin, ut32 offset\n \t\treturn false;\n \t}\n \tif (header.fixups_version > 0) {\n-\t\teprintf(\"Unsupported fixups version: %u\\n\", header.fixups_version);\n+\t\tRZ_LOG_ERROR(\"Unsupported fixups version: %u\\n\", header.fixups_version);\n \t\treturn false;\n \t}\n \tut64 starts_at = offset + header.starts_offset;\n@@ -197,15 +197,16 @@ RZ_IPI bool MACH0_(parse_chained_fixups)(struct MACH0_(obj_t) * bin, ut32 offset\n \t\treturn false;\n \t}\n \tut64 cursor = starts_at + sizeof(ut32);\n-\tfor (size_t i = 0; i < cf->starts_count; i++) {\n-\t\tut32 seg_off;\n-\t\tif (!rz_buf_read_le32_at(bin->b, cursor, &seg_off) || !seg_off) {\n+\tsize_t max_count = RZ_MAX(bin->nsegs, cf->starts_count);\n+\tfor (size_t i = 0; i < max_count; i++) {\n+\t\tut32 seg_off = 0;\n+\t\tif (!rz_buf_read_le32_at(bin->b, cursor, &seg_off)) {\n+\t\t\tRZ_LOG_ERROR(\"Failed to read segment offset at: %\" PFMT64x \"\\n\", cursor);\n+\t\t\treturn false;\n+\t\t} else if (!seg_off) {\n \t\t\tcursor += sizeof(ut32);\n \t\t\tcontinue;\n \t\t}\n-\t\tif (i >= bin->nsegs) {\n-\t\t\tbreak;\n-\t\t}\n \t\tstruct rz_dyld_chained_starts_in_segment *cur_seg = RZ_NEW0(struct rz_dyld_chained_starts_in_segment);\n \t\tif (!cur_seg) {\n \t\t\treturn false;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/LibrePhotos/librephotos/commits/32237ddc0b6293a69b983a07b5ad462fcdd6c929",
        "url": "https://api.github.com/repos/LibrePhotos/librephotos/commits/32237ddc0b6293a69b983a07b5ad462fcdd6c929",
        "html_url": "https://github.com/LibrePhotos/librephotos/commit/32237ddc0b6293a69b983a07b5ad462fcdd6c929",
        "message": "fix for xss file upload vulnerability",
        "files": [
            {
                "sha": "d6a20214cfe42cb1824044d34809b6a284104182",
                "filename": "api/views/upload.py",
                "status": "modified",
                "additions": 19,
                "deletions": 5,
                "changes": 24,
                "blob_url": "https://github.com/LibrePhotos/librephotos/blob/32237ddc0b6293a69b983a07b5ad462fcdd6c929/api%2Fviews%2Fupload.py",
                "raw_url": "https://github.com/LibrePhotos/librephotos/raw/32237ddc0b6293a69b983a07b5ad462fcdd6c929/api%2Fviews%2Fupload.py",
                "contents_url": "https://api.github.com/repos/LibrePhotos/librephotos/contents/api%2Fviews%2Fupload.py?ref=32237ddc0b6293a69b983a07b5ad462fcdd6c929",
                "patch": "@@ -45,7 +45,7 @@ def check_permissions(self, request):\n         jwt = request.COOKIES.get(\"jwt\")\n         if jwt is not None:\n             try:\n-                AccessToken(jwt)\n+                token=AccessToken(jwt)\n             except TokenError:\n                 raise ChunkedUploadError(\n                     status=http_status.HTTP_403_FORBIDDEN,\n@@ -57,7 +57,7 @@ def check_permissions(self, request):\n                 detail=\"Authentication credentials were not provided\",\n             )\n         # To-Do: Check if file is allowed type\n-        user = User.objects.filter(id=request.POST.get(\"user\")).first()\n+        user = User.objects.filter(id=token[\"user_id\"]).first()\n         if not user or not user.is_authenticated:\n             raise ChunkedUploadError(\n                 status=http_status.HTTP_403_FORBIDDEN,\n@@ -88,7 +88,7 @@ def check_permissions(self, request):\n         jwt = request.COOKIES.get(\"jwt\")\n         if jwt is not None:\n             try:\n-                AccessToken(jwt)\n+                token=AccessToken(jwt)\n             except TokenError:\n                 raise ChunkedUploadError(\n                     status=http_status.HTTP_403_FORBIDDEN,\n@@ -99,15 +99,29 @@ def check_permissions(self, request):\n                 status=http_status.HTTP_403_FORBIDDEN,\n                 detail=\"Authentication credentials were not provided\",\n             )\n-        user = User.objects.filter(id=request.POST.get(\"user\")).first()\n+        user = User.objects.filter(id=token[\"user_id\"]).first()\n         if not user or not user.is_authenticated:\n             raise ChunkedUploadError(\n                 status=http_status.HTTP_403_FORBIDDEN,\n                 detail=\"Authentication credentials were not provided\",\n             )\n \n     def on_completion(self, uploaded_file, request):\n-        user = User.objects.filter(id=request.POST.get(\"user\")).first()\n+        jwt = request.COOKIES.get(\"jwt\")\n+        if jwt is not None:\n+            try:\n+                token=AccessToken(jwt)\n+            except TokenError:\n+                raise ChunkedUploadError(\n+                    status=http_status.HTTP_403_FORBIDDEN,\n+                    detail=\"Authentication credentials were invalid\",\n+                )\n+        else:\n+            raise ChunkedUploadError(\n+                status=http_status.HTTP_403_FORBIDDEN,\n+                detail=\"Authentication credentials were not provided\",\n+            )\n+        user = User.objects.filter(id=token[\"user_id\"]).first()\n         # Sanitize file name\n         filename = get_valid_filename(request.POST.get(\"filename\"))\n "
            },
            {
                "sha": "67f892d09cfe16a3901dd1f427d987700ec89a0b",
                "filename": "api/views/views.py",
                "status": "modified",
                "additions": 8,
                "deletions": 5,
                "changes": 13,
                "blob_url": "https://github.com/LibrePhotos/librephotos/blob/32237ddc0b6293a69b983a07b5ad462fcdd6c929/api%2Fviews%2Fviews.py",
                "raw_url": "https://github.com/LibrePhotos/librephotos/raw/32237ddc0b6293a69b983a07b5ad462fcdd6c929/api%2Fviews%2Fviews.py",
                "contents_url": "https://api.github.com/repos/LibrePhotos/librephotos/contents/api%2Fviews%2Fviews.py?ref=32237ddc0b6293a69b983a07b5ad462fcdd6c929",
                "patch": "@@ -604,7 +604,6 @@ def get(self, request, path, fname, format=None):\n                 photo = Photo.objects.get(image_hash=image_hash)\n             except Photo.DoesNotExist:\n                 return HttpResponse(status=404)\n-\n             if photo.main_file.path.startswith(\"/nextcloud_media/\"):\n                 internal_path = photo.main_file.path.replace(\n                     \"/nextcloud_media/\", \"/nextcloud_original/\"\n@@ -617,15 +616,16 @@ def get(self, request, path, fname, format=None):\n             else:\n                 # If, for some reason, the file is in a weird place, handle that.\n                 internal_path = None\n-\n             internal_path = quote(internal_path)\n-\n             # grant access if the requested photo is public\n             if photo.public:\n                 response = HttpResponse()\n                 mime = magic.Magic(mime=True)\n                 filename = mime.from_file(photo.main_file.path)\n-                response[\"Content-Type\"] = filename\n+                if photo.video:\n+                    response[\"Content-Type\"] = filename\n+                else:\n+                    response[\"Content-Type\"] = \"image/webp\"\n                 response[\"X-Accel-Redirect\"] = internal_path\n                 return response\n \n@@ -647,7 +647,10 @@ def get(self, request, path, fname, format=None):\n                 response = HttpResponse()\n                 mime = magic.Magic(mime=True)\n                 filename = mime.from_file(photo.main_file.path)\n-                response[\"Content-Type\"] = filename\n+                if photo.video:\n+                    response[\"Content-Type\"] = filename\n+                else:\n+                    response[\"Content-Type\"] = \"image/webp\"\n                 response[\"Content-Disposition\"] = 'inline; filename=\"{}\"'.format(\n                     photo.main_file.path.split(\"/\")[-1]\n                 )"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Automattic/mongoose/commits/33679bcf8ca43d74e3e8ecd4cc224826772d805b",
        "url": "https://api.github.com/repos/Automattic/mongoose/commits/33679bcf8ca43d74e3e8ecd4cc224826772d805b",
        "html_url": "https://github.com/Automattic/mongoose/commit/33679bcf8ca43d74e3e8ecd4cc224826772d805b",
        "message": "fix: disallow using $where in match\n\nFix CVE-2024-53900",
        "files": [
            {
                "sha": "babdf67716d94cd5c777af346e078fb701acfd05",
                "filename": "lib/helpers/populate/assignVals.js",
                "status": "modified",
                "additions": 1,
                "deletions": 5,
                "changes": 6,
                "blob_url": "https://github.com/Automattic/mongoose/blob/33679bcf8ca43d74e3e8ecd4cc224826772d805b/lib%2Fhelpers%2Fpopulate%2FassignVals.js",
                "raw_url": "https://github.com/Automattic/mongoose/raw/33679bcf8ca43d74e3e8ecd4cc224826772d805b/lib%2Fhelpers%2Fpopulate%2FassignVals.js",
                "contents_url": "https://api.github.com/repos/Automattic/mongoose/contents/lib%2Fhelpers%2Fpopulate%2FassignVals.js?ref=33679bcf8ca43d74e3e8ecd4cc224826772d805b",
                "patch": "@@ -243,7 +243,7 @@ function numDocs(v) {\n \n function valueFilter(val, assignmentOpts, populateOptions, allIds) {\n   const userSpecifiedTransform = typeof populateOptions.transform === 'function';\n-  const transform = userSpecifiedTransform ? populateOptions.transform : noop;\n+  const transform = userSpecifiedTransform ? populateOptions.transform : v => v;\n   if (Array.isArray(val)) {\n     // find logic\n     const ret = [];\n@@ -335,7 +335,3 @@ function isPopulatedObject(obj) {\n     obj.$__ != null ||\n     leanPopulateMap.has(obj);\n }\n-\n-function noop(v) {\n-  return v;\n-}"
            },
            {
                "sha": "83aaf981d5749b8b33b86b7dcb2bc9660663a178",
                "filename": "lib/helpers/populate/getModelsMapForPopulate.js",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/Automattic/mongoose/blob/33679bcf8ca43d74e3e8ecd4cc224826772d805b/lib%2Fhelpers%2Fpopulate%2FgetModelsMapForPopulate.js",
                "raw_url": "https://github.com/Automattic/mongoose/raw/33679bcf8ca43d74e3e8ecd4cc224826772d805b/lib%2Fhelpers%2Fpopulate%2FgetModelsMapForPopulate.js",
                "contents_url": "https://api.github.com/repos/Automattic/mongoose/contents/lib%2Fhelpers%2Fpopulate%2FgetModelsMapForPopulate.js?ref=33679bcf8ca43d74e3e8ecd4cc224826772d805b",
                "patch": "@@ -182,6 +182,15 @@ module.exports = function getModelsMapForPopulate(model, docs, options) {\n     if (hasMatchFunction) {\n       match = match.call(doc, doc);\n     }\n+    if (Array.isArray(match)) {\n+      for (const item of match) {\n+        if (item != null && item.$where) {\n+          throw new MongooseError('Cannot use $where filter with populate() match');\n+        }\n+      }\n+    } else if (match != null && match.$where != null) {\n+      throw new MongooseError('Cannot use $where filter with populate() match');\n+    }\n     data.match = match;\n     data.hasMatchFunction = hasMatchFunction;\n     data.isRefPath = isRefPath;\n@@ -460,6 +469,16 @@ function _virtualPopulate(model, docs, options, _virtualRes) {\n     data.match = match;\n     data.hasMatchFunction = hasMatchFunction;\n \n+    if (Array.isArray(match)) {\n+      for (const item of match) {\n+        if (item != null && item.$where) {\n+          throw new MongooseError('Cannot use $where filter with populate() match');\n+        }\n+      }\n+    } else if (match != null && match.$where != null) {\n+      throw new MongooseError('Cannot use $where filter with populate() match');\n+    }\n+\n     // Get local fields\n     const ret = _getLocalFieldValues(doc, localField, model, options, virtual);\n "
            },
            {
                "sha": "42be868b641295cceca7df6b406f79b42a6f3cee",
                "filename": "test/model.populate.test.js",
                "status": "modified",
                "additions": 46,
                "deletions": 0,
                "changes": 46,
                "blob_url": "https://github.com/Automattic/mongoose/blob/33679bcf8ca43d74e3e8ecd4cc224826772d805b/test%2Fmodel.populate.test.js",
                "raw_url": "https://github.com/Automattic/mongoose/raw/33679bcf8ca43d74e3e8ecd4cc224826772d805b/test%2Fmodel.populate.test.js",
                "contents_url": "https://api.github.com/repos/Automattic/mongoose/contents/test%2Fmodel.populate.test.js?ref=33679bcf8ca43d74e3e8ecd4cc224826772d805b",
                "patch": "@@ -4166,6 +4166,52 @@ describe('model: populate:', function() {\n         assert.deepEqual(band.members.map(b => b.name).sort(), ['AA', 'AB']);\n       });\n \n+      it('match prevents using $where', async function() {\n+        const ParentSchema = new Schema({\n+          name: String,\n+          child: {\n+            type: mongoose.Schema.Types.ObjectId,\n+            ref: 'Child'\n+          },\n+          children: [{\n+            type: mongoose.Schema.Types.ObjectId,\n+            ref: 'Child'\n+          }]\n+        });\n+\n+        const ChildSchema = new Schema({\n+          name: String\n+        });\n+        ChildSchema.virtual('parent', {\n+          ref: 'Parent',\n+          localField: '_id',\n+          foreignField: 'parent'\n+        });\n+\n+        const Parent = db.model('Parent', ParentSchema);\n+        const Child = db.model('Child', ChildSchema);\n+\n+        const child = await Child.create({ name: 'Luke' });\n+        const parent = await Parent.create({ name: 'Anakin', child: child._id });\n+\n+        await assert.rejects(\n+          () => Parent.findOne().populate({ path: 'child', match: { $where: 'console.log(\"oops!\");' } }),\n+          /Cannot use \\$where filter with populate\\(\\) match/\n+        );\n+        await assert.rejects(\n+          () => Parent.find().populate({ path: 'child', match: { $where: 'console.log(\"oops!\");' } }),\n+          /Cannot use \\$where filter with populate\\(\\) match/\n+        );\n+        await assert.rejects(\n+          () => parent.populate({ path: 'child', match: { $where: 'console.log(\"oops!\");' } }),\n+          /Cannot use \\$where filter with populate\\(\\) match/\n+        );\n+        await assert.rejects(\n+          () => Child.find().populate({ path: 'parent', match: { $where: 'console.log(\"oops!\");' } }),\n+          /Cannot use \\$where filter with populate\\(\\) match/\n+        );\n+      });\n+\n       it('multiple source docs', function(done) {\n         const PersonSchema = new Schema({\n           name: String,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Automattic/mongoose/commits/c9e86bff7eef477da75a29af62a06d41a835a156",
        "url": "https://api.github.com/repos/Automattic/mongoose/commits/c9e86bff7eef477da75a29af62a06d41a835a156",
        "html_url": "https://github.com/Automattic/mongoose/commit/c9e86bff7eef477da75a29af62a06d41a835a156",
        "message": "fix: disallow using $where in match\n\nFix CVE-2024-53900",
        "files": [
            {
                "sha": "62b3863b583f1075699a3813930b2cc4aa3be7fe",
                "filename": "lib/helpers/populate/assignVals.js",
                "status": "modified",
                "additions": 1,
                "deletions": 5,
                "changes": 6,
                "blob_url": "https://github.com/Automattic/mongoose/blob/c9e86bff7eef477da75a29af62a06d41a835a156/lib%2Fhelpers%2Fpopulate%2FassignVals.js",
                "raw_url": "https://github.com/Automattic/mongoose/raw/c9e86bff7eef477da75a29af62a06d41a835a156/lib%2Fhelpers%2Fpopulate%2FassignVals.js",
                "contents_url": "https://api.github.com/repos/Automattic/mongoose/contents/lib%2Fhelpers%2Fpopulate%2FassignVals.js?ref=c9e86bff7eef477da75a29af62a06d41a835a156",
                "patch": "@@ -249,7 +249,7 @@ function numDocs(v) {\n \n function valueFilter(val, assignmentOpts, populateOptions, allIds) {\n   const userSpecifiedTransform = typeof populateOptions.transform === 'function';\n-  const transform = userSpecifiedTransform ? populateOptions.transform : noop;\n+  const transform = userSpecifiedTransform ? populateOptions.transform : v => v;\n   if (Array.isArray(val)) {\n     // find logic\n     const ret = [];\n@@ -341,7 +341,3 @@ function isPopulatedObject(obj) {\n     obj.$__ != null ||\n     leanPopulateMap.has(obj);\n }\n-\n-function noop(v) {\n-  return v;\n-}"
            },
            {
                "sha": "bd748ed072276f4ccb9cfeeef4ce6db592200c68",
                "filename": "lib/helpers/populate/getModelsMapForPopulate.js",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/Automattic/mongoose/blob/c9e86bff7eef477da75a29af62a06d41a835a156/lib%2Fhelpers%2Fpopulate%2FgetModelsMapForPopulate.js",
                "raw_url": "https://github.com/Automattic/mongoose/raw/c9e86bff7eef477da75a29af62a06d41a835a156/lib%2Fhelpers%2Fpopulate%2FgetModelsMapForPopulate.js",
                "contents_url": "https://api.github.com/repos/Automattic/mongoose/contents/lib%2Fhelpers%2Fpopulate%2FgetModelsMapForPopulate.js?ref=c9e86bff7eef477da75a29af62a06d41a835a156",
                "patch": "@@ -184,6 +184,15 @@ module.exports = function getModelsMapForPopulate(model, docs, options) {\n     if (hasMatchFunction) {\n       match = match.call(doc, doc);\n     }\n+    if (Array.isArray(match)) {\n+      for (const item of match) {\n+        if (item != null && item.$where) {\n+          throw new MongooseError('Cannot use $where filter with populate() match');\n+        }\n+      }\n+    } else if (match != null && match.$where != null) {\n+      throw new MongooseError('Cannot use $where filter with populate() match');\n+    }\n     data.match = match;\n     data.hasMatchFunction = hasMatchFunction;\n     data.isRefPath = isRefPath;\n@@ -447,6 +456,16 @@ function _virtualPopulate(model, docs, options, _virtualRes) {\n     data.match = match;\n     data.hasMatchFunction = hasMatchFunction;\n \n+    if (Array.isArray(match)) {\n+      for (const item of match) {\n+        if (item != null && item.$where) {\n+          throw new MongooseError('Cannot use $where filter with populate() match');\n+        }\n+      }\n+    } else if (match != null && match.$where != null) {\n+      throw new MongooseError('Cannot use $where filter with populate() match');\n+    }\n+\n     // Get local fields\n     const ret = _getLocalFieldValues(doc, localField, model, options, virtual);\n "
            },
            {
                "sha": "f62e5886c9e3bf7a3af52ac237941ecc978a0a9e",
                "filename": "test/model.populate.test.js",
                "status": "modified",
                "additions": 46,
                "deletions": 0,
                "changes": 46,
                "blob_url": "https://github.com/Automattic/mongoose/blob/c9e86bff7eef477da75a29af62a06d41a835a156/test%2Fmodel.populate.test.js",
                "raw_url": "https://github.com/Automattic/mongoose/raw/c9e86bff7eef477da75a29af62a06d41a835a156/test%2Fmodel.populate.test.js",
                "contents_url": "https://api.github.com/repos/Automattic/mongoose/contents/test%2Fmodel.populate.test.js?ref=c9e86bff7eef477da75a29af62a06d41a835a156",
                "patch": "@@ -3641,6 +3641,52 @@ describe('model: populate:', function() {\n         assert.deepEqual(band.members.map(b => b.name).sort(), ['AA', 'AB']);\n       });\n \n+      it('match prevents using $where', async function() {\n+        const ParentSchema = new Schema({\n+          name: String,\n+          child: {\n+            type: mongoose.Schema.Types.ObjectId,\n+            ref: 'Child'\n+          },\n+          children: [{\n+            type: mongoose.Schema.Types.ObjectId,\n+            ref: 'Child'\n+          }]\n+        });\n+\n+        const ChildSchema = new Schema({\n+          name: String\n+        });\n+        ChildSchema.virtual('parent', {\n+          ref: 'Parent',\n+          localField: '_id',\n+          foreignField: 'parent'\n+        });\n+\n+        const Parent = db.model('Parent', ParentSchema);\n+        const Child = db.model('Child', ChildSchema);\n+\n+        const child = await Child.create({ name: 'Luke' });\n+        const parent = await Parent.create({ name: 'Anakin', child: child._id });\n+\n+        await assert.rejects(\n+          () => Parent.findOne().populate({ path: 'child', match: { $where: 'console.log(\"oops!\");' } }),\n+          /Cannot use \\$where filter with populate\\(\\) match/\n+        );\n+        await assert.rejects(\n+          () => Parent.find().populate({ path: 'child', match: { $where: 'console.log(\"oops!\");' } }),\n+          /Cannot use \\$where filter with populate\\(\\) match/\n+        );\n+        await assert.rejects(\n+          () => parent.populate({ path: 'child', match: { $where: 'console.log(\"oops!\");' } }),\n+          /Cannot use \\$where filter with populate\\(\\) match/\n+        );\n+        await assert.rejects(\n+          () => Child.find().populate({ path: 'parent', match: { $where: 'console.log(\"oops!\");' } }),\n+          /Cannot use \\$where filter with populate\\(\\) match/\n+        );\n+      });\n+\n       it('multiple source docs', async function() {\n         const PersonSchema = new Schema({\n           name: String,"
            }
        ]
    }
]
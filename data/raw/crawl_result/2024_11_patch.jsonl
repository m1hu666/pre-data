[
    {
        "query_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/commits/ad32781e782d0f604c6da4680fce48e4cc1f4433",
        "url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/commits/ad32781e782d0f604c6da4680fce48e4cc1f4433",
        "html_url": "https://github.com/zhmcclient/python-zhmcclient/commit/ad32781e782d0f604c6da4680fce48e4cc1f4433",
        "message": "Fixed clear-text logging of all password-like properties in API/HMC log\n\nDetails:\n\n* Reworked the @logged_api_call decorator to get optional parameters\n  for specifying properties ot be blanked out in the API logging.\n  This required significant reimplementation of that decorator and\n  the functions it calls.\n\n* Fixed the clear-text logging of all password-like properties in the API\n  logging by using this new capability of the @logged_api_call decorator.\n\n* Fixed the clear-text logging of all password-like properties in the HMC\n  logging by blanking them out in the Session.post() method.\n\n* Added unit test cases for the blanked-out API logging, in the\n  test_logging.py module.\n\n* Added unit test cases for the blanked-out API logging, in all test\n  modules for those resources that have blanked-out properties.\n\n* Improved the checking in the unit test cases for API logging, to check\n  the function name, args, kwargs and return value in the log messages.\n\nSigned-off-by: Andreas Maier <maiera@de.ibm.com>",
        "files": [
            {
                "sha": "a017e655ec32237a8b704f15ac9fe557d00d98ce",
                "filename": "changes/noissue.1.feature.rst",
                "status": "added",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/changes%2Fnoissue.1.feature.rst",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/changes%2Fnoissue.1.feature.rst",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/changes%2Fnoissue.1.feature.rst?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -0,0 +1,3 @@\n+Dev: Enhanced the zhmcclient API logging code so that in the debugger,\n+zhmcclient API functions now have less logging steps to go through until the\n+actual API function is reached."
            },
            {
                "sha": "1aecb5a57ad04447d77f8e459800be90c81fbffd",
                "filename": "changes/noissue.4.fix.rst",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/changes%2Fnoissue.4.fix.rst",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/changes%2Fnoissue.4.fix.rst",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/changes%2Fnoissue.4.fix.rst?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -0,0 +1,4 @@\n+Fixed that all password-like properties are no longer written in clear text to\n+the Python loggers \"zhmcclient.api\" and \"zhmcclient.hmc\", but are now blanked\n+out. Previously, that was done only for the \"zhmcclient.hmc\" logger for creation\n+and update of HMC users."
            },
            {
                "sha": "70d5ad50e345c4af289e4bc9eab92a06aa0e5db4",
                "filename": "tests/unit/zhmcclient/test_activation_profile.py",
                "status": "modified",
                "additions": 18,
                "deletions": 2,
                "changes": 20,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_activation_profile.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_activation_profile.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/tests%2Funit%2Fzhmcclient%2Ftest_activation_profile.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -19,9 +19,10 @@\n \n import copy\n import re\n+import logging\n import pytest\n \n-from zhmcclient import Client, ActivationProfile\n+from zhmcclient import Client, ActivationProfile, BLANKED_OUT_STRING\n from zhmcclient_mock import FakedSession\n from tests.common.utils import assert_resources\n \n@@ -338,11 +339,15 @@ def test_profile_repr(self):\n             }},\n             {'group-profile-uri': None},\n             {'zaware-gateway-info': None},\n+            {'ssc-master-pw': 'bla', 'zaware-master-pw': 'bla'},\n         ]\n     )\n-    def test_profile_update_properties(self, input_props, profile_type):\n+    def test_profile_update_properties(self, caplog, input_props, profile_type):\n         \"\"\"Test ActivationProfile.update_properties().\"\"\"\n \n+        logger_name = \"zhmcclient.api\"\n+        caplog.set_level(logging.DEBUG, logger=logger_name)\n+\n         mgr_attr = profile_type + '_activation_profiles'\n         profile_mgr = getattr(self.cpc, mgr_attr)\n \n@@ -354,6 +359,9 @@ def test_profile_update_properties(self, input_props, profile_type):\n         # Execute the code to be tested\n         profile.update_properties(properties=input_props)\n \n+        # Get its API call log record\n+        call_record = caplog.records[-2]\n+\n         # Verify that the resource object already reflects the property\n         # updates.\n         for prop_name in saved_properties:\n@@ -376,3 +384,11 @@ def test_profile_update_properties(self, input_props, profile_type):\n             assert prop_name in profile.properties\n             prop_value = profile.properties[prop_name]\n             assert prop_value == exp_prop_value\n+\n+        # Verify the API call log record for blanked-out properties.\n+        if 'ssc-master-pw' in input_props:\n+            exp_str = f\"'ssc-master-pw': '{BLANKED_OUT_STRING}'\"\n+            assert call_record.message.find(exp_str) > 0\n+        if 'zaware-master-pw' in input_props:\n+            exp_str = f\"'zaware-master-pw': '{BLANKED_OUT_STRING}'\"\n+            assert call_record.message.find(exp_str) > 0"
            },
            {
                "sha": "afecff4af42711bc25b6436f592d8f1d04be27e2",
                "filename": "tests/unit/zhmcclient/test_ldap_server_definition.py",
                "status": "modified",
                "additions": 34,
                "deletions": 3,
                "changes": 37,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_ldap_server_definition.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_ldap_server_definition.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/tests%2Funit%2Fzhmcclient%2Ftest_ldap_server_definition.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -19,9 +19,11 @@\n \n import re\n import copy\n+import logging\n import pytest\n \n-from zhmcclient import Client, HTTPError, NotFound, LdapServerDefinition\n+from zhmcclient import Client, HTTPError, NotFound, LdapServerDefinition, \\\n+    BLANKED_OUT_STRING\n from zhmcclient_mock import FakedSession\n from tests.common.utils import assert_resources\n \n@@ -149,12 +151,21 @@ def test_ldap_srv_def_manager_list(\n               'search-distinguished-name': 'test{0}'},\n              ['element-uri', 'name', 'description'],\n              None),\n+            ({'name': 'a',\n+              'primary-hostname-ipaddr': '10.11.12.13',\n+              'search-distinguished-name': 'test{0}',\n+              'bind-password': 'bla'},\n+             ['element-uri', 'name', 'bind-password'],\n+             None),\n         ]\n     )\n     def test_ldap_srv_def_manager_create(\n-            self, input_props, exp_prop_names, exp_exc):\n+            self, caplog, input_props, exp_prop_names, exp_exc):\n         \"\"\"Test LdapServerDefinitionManager.create().\"\"\"\n \n+        logger_name = \"zhmcclient.api\"\n+        caplog.set_level(logging.DEBUG, logger=logger_name)\n+\n         ldap_srv_def_mgr = self.console.ldap_server_definitions\n \n         if exp_exc is not None:\n@@ -174,6 +185,9 @@ def test_ldap_srv_def_manager_create(\n             # Execute the code to be tested.\n             ldap_srv_def = ldap_srv_def_mgr.create(properties=input_props)\n \n+            # Get its API call log record\n+            call_record = caplog.records[-2]\n+\n             # Check the resource for consistency within itself\n             assert isinstance(ldap_srv_def, LdapServerDefinition)\n             ldap_srv_def_name = ldap_srv_def.name\n@@ -191,6 +205,11 @@ def test_ldap_srv_def_manager_create(\n                     exp_value = input_props[prop_name]\n                     assert value == exp_value\n \n+            # Verify the API call log record for blanked-out properties.\n+            if 'bind-password' in input_props:\n+                exp_str = f\"'bind-password': '{BLANKED_OUT_STRING}'\"\n+                assert call_record.message.find(exp_str) > 0\n+\n     def test_ldap_srv_def_repr(self):\n         \"\"\"Test LdapServerDefinition.__repr__().\"\"\"\n \n@@ -287,11 +306,15 @@ def test_ldap_delete_create_same(self):\n         \"input_props\", [\n             {},\n             {'description': 'New LDAP Server Definition description'},\n+            {'bind-password': 'bla'},\n         ]\n     )\n-    def test_ldap_srv_def_update_properties(self, input_props):\n+    def test_ldap_srv_def_update_properties(self, caplog, input_props):\n         \"\"\"Test LdapServerDefinition.update_properties().\"\"\"\n \n+        logger_name = \"zhmcclient.api\"\n+        caplog.set_level(logging.DEBUG, logger=logger_name)\n+\n         ldap_srv_def_name = 'faked_a'\n \n         # Add the LDAP Server Definition to be tested\n@@ -306,6 +329,9 @@ def test_ldap_srv_def_update_properties(self, input_props):\n         # Execute the code to be tested\n         ldap_srv_def.update_properties(properties=input_props)\n \n+        # Get its API call log record\n+        call_record = caplog.records[-2]\n+\n         # Verify that the resource object already reflects the property\n         # updates.\n         for prop_name in saved_properties:\n@@ -329,3 +355,8 @@ def test_ldap_srv_def_update_properties(self, input_props):\n             assert prop_name in ldap_srv_def.properties\n             prop_value = ldap_srv_def.properties[prop_name]\n             assert prop_value == exp_prop_value\n+\n+        # Verify the API call log record for blanked-out properties.\n+        if 'bind-password' in input_props:\n+            exp_str = f\"'bind-password': '{BLANKED_OUT_STRING}'\"\n+            assert call_record.message.find(exp_str) > 0"
            },
            {
                "sha": "7784a2b7f3cb4b77ac274c69d0994b3aeecdaecd",
                "filename": "tests/unit/zhmcclient/test_logging.py",
                "status": "modified",
                "additions": 78,
                "deletions": 18,
                "changes": 96,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_logging.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_logging.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/tests%2Funit%2Fzhmcclient%2Ftest_logging.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -23,18 +23,26 @@\n from testfixtures import LogCapture\n \n from zhmcclient._logging import logged_api_call, get_logger\n-\n+from zhmcclient._constants import BLANKED_OUT_STRING\n \n #\n # Various uses of the @logged_api_call decorator\n #\n \n+\n @logged_api_call\n def decorated_global_function():\n     \"\"\"A decorated function at the global (module) level.\"\"\"\n     pass\n \n \n+@logged_api_call(blanked_properties=['hideme'], properties_pos=0)\n+def decorated_global_props_function(properties):\n+    \"\"\"A decorated function with properties at the global (module) level,\n+    where the 'hideme' property is blanked out in the API log.\"\"\"\n+    return properties\n+\n+\n def global1_function():\n     \"\"\"An undecorated function at the global (module) level.\"\"\"\n \n@@ -136,8 +144,8 @@ def call_from_global(func, *args, **kwargs):\n # Some expected values that are constant\n _EXP_LOGGER_NAME = 'zhmcclient.api'\n _EXP_LOG_LEVEL = 'DEBUG'\n-_EXP_LOG_MSG_ENTER_PATTERN = \"Called: .*, args: .*, kwargs: .*\"\n-_EXP_LOG_MSG_LEAVE_PATTERN = \"Return: .*, result: .*\"\n+_EXP_LOG_MSG_ENTER_PATTERN = \"Called: (.*), args: (.*), kwargs: (.*)\"\n+_EXP_LOG_MSG_LEAVE_PATTERN = \"Return: (.*), result: (.*)\"\n \n \n @pytest.fixture()\n@@ -155,9 +163,9 @@ def capture():\n # Test cases\n #\n \n-def assert_log_capture(log_capture, exp_apifunc):\n-    # pylint: disable=unused-argument\n-    # Note: exp_apifunc is shown when pytest displays a traceback.\n+def assert_log_capture(\n+        log_capture, *, func_pattern=None, args_pattern=None,\n+        kwargs_pattern=None, return_pattern=None):\n     \"\"\"\n     Assert that the log capture is as expected.\n     \"\"\"\n@@ -167,13 +175,23 @@ def assert_log_capture(log_capture, exp_apifunc):\n     assert enter_record.name == _EXP_LOGGER_NAME\n     assert enter_record.levelname == _EXP_LOG_LEVEL\n     assert re.match(_EXP_LOG_MSG_ENTER_PATTERN, enter_record.msg)\n-    # We don't check the function name and its pos and kw args\n+    func_str, args_str, kwargs_str = enter_record.args\n+    if func_pattern:\n+        assert re.search(func_pattern, func_str)\n+    if args_pattern:\n+        assert re.search(args_pattern, args_str)\n+    if kwargs_pattern:\n+        assert re.search(kwargs_pattern, kwargs_str)\n \n     leave_record = log_capture.records[1]\n     assert leave_record.name == _EXP_LOGGER_NAME\n     assert leave_record.levelname == _EXP_LOG_LEVEL\n     assert re.match(_EXP_LOG_MSG_LEAVE_PATTERN, leave_record.msg)\n-    # We don't check the function name and its pos and kw args\n+    func_str, return_str = leave_record.args\n+    if func_pattern:\n+        assert re.search(func_pattern, func_str)\n+    if return_pattern:\n+        assert re.search(return_pattern, return_str)\n \n \n def test_1a_global_from_global(capture):\n@@ -183,7 +201,8 @@ def test_1a_global_from_global(capture):\n \n     call_from_global(decorated_global_function)\n \n-    assert_log_capture(capture, 'decorated_global_function()')\n+    assert_log_capture(\n+        capture, func_pattern='decorated_global_function')\n \n \n def test_1b_global_from_method(capture):\n@@ -192,7 +211,40 @@ def test_1b_global_from_method(capture):\n \n     CallerClass().call_from_method(decorated_global_function)\n \n-    assert_log_capture(capture, 'decorated_global_function()')\n+    assert_log_capture(\n+        capture, func_pattern='decorated_global_function')\n+\n+\n+def test_1c_global_props_args_from_global(capture):\n+    # pylint: disable=redefined-outer-name\n+    \"\"\"Simple test calling a decorated global function with properties as args,\n+    from a global function.\"\"\"\n+    props = {\n+        'prop1': 'value1',\n+        'hideme': 'secret',\n+    }\n+    blanked_props = {\n+        'prop1': 'value1',\n+        'hideme': BLANKED_OUT_STRING,\n+    }\n+    call_from_global(decorated_global_props_function, props)\n+\n+    assert_log_capture(\n+        capture, func_pattern='decorated_global_props_function',\n+        args_pattern=re.escape(str(blanked_props)),\n+        return_pattern=re.escape(str(props)))\n+\n+\n+def test_1c_global_props_kwargs_from_global(capture):\n+    # pylint: disable=redefined-outer-name\n+    \"\"\"Simple test calling a decorated global function with properties as\n+    kwargs, from a global function.\"\"\"\n+\n+    call_from_global(decorated_global_props_function,\n+                     properties={'prop1': 'value1'})\n+\n+    assert_log_capture(\n+        capture, func_pattern='decorated_global_props_function')\n \n \n def test_2a_global_inner1_from_global(capture):\n@@ -204,7 +256,8 @@ def test_2a_global_inner1_from_global(capture):\n \n     call_from_global(decorated_inner1_function)\n \n-    assert_log_capture(capture, 'global1_function.decorated_inner1_function()')\n+    assert_log_capture(\n+        capture, func_pattern='global1_function.decorated_inner1_function')\n \n \n def test_2b_global_inner1_from_method(capture):\n@@ -216,7 +269,8 @@ def test_2b_global_inner1_from_method(capture):\n \n     CallerClass().call_from_method(decorated_inner1_function)\n \n-    assert_log_capture(capture, 'global1_function.decorated_inner1_function()')\n+    assert_log_capture(\n+        capture, func_pattern='global1_function.decorated_inner1_function')\n \n \n def test_3a_global_inner2_from_global(capture):\n@@ -228,7 +282,8 @@ def test_3a_global_inner2_from_global(capture):\n \n     call_from_global(decorated_inner2_function)\n \n-    assert_log_capture(capture, 'inner1_function.decorated_inner2_function()')\n+    assert_log_capture(\n+        capture, func_pattern='inner1_function.decorated_inner2_function')\n \n \n def test_3b_global_inner1_from_method(capture):\n@@ -240,7 +295,8 @@ def test_3b_global_inner1_from_method(capture):\n \n     CallerClass().call_from_method(decorated_inner2_function)\n \n-    assert_log_capture(capture, 'inner1_function.decorated_inner2_function()')\n+    assert_log_capture(\n+        capture, func_pattern='inner1_function.decorated_inner2_function')\n \n \n def test_4a_method_from_global(capture):\n@@ -252,7 +308,8 @@ def test_4a_method_from_global(capture):\n \n     call_from_global(decorated_method, d)\n \n-    assert_log_capture(capture, 'Decorator1Class.decorated_method()')\n+    assert_log_capture(\n+        capture, func_pattern='Decorator1Class.decorated_method')\n \n \n def test_4b_method_from_method(capture):\n@@ -264,7 +321,8 @@ def test_4b_method_from_method(capture):\n \n     CallerClass().call_from_method(decorated_method, d)\n \n-    assert_log_capture(capture, 'Decorator1Class.decorated_method()')\n+    assert_log_capture(\n+        capture, func_pattern='Decorator1Class.decorated_method')\n \n \n def test_5a_method_from_global(capture):\n@@ -277,7 +335,8 @@ def test_5a_method_from_global(capture):\n \n     call_from_global(decorated_inner_function)\n \n-    assert_log_capture(capture, 'method.decorated_inner_function()')\n+    assert_log_capture(\n+        capture, func_pattern='method.decorated_inner_function')\n \n \n def test_5b_method_from_method(capture):\n@@ -290,7 +349,8 @@ def test_5b_method_from_method(capture):\n \n     CallerClass().call_from_method(decorated_inner_function)\n \n-    assert_log_capture(capture, 'method.decorated_inner_function()')\n+    assert_log_capture(\n+        capture, func_pattern='method.decorated_inner_function')\n \n \n def test_decorated_class():"
            },
            {
                "sha": "b173b6ea8f4333a7e2923c19229e5bc49d1e82a6",
                "filename": "tests/unit/zhmcclient/test_lpar.py",
                "status": "modified",
                "additions": 22,
                "deletions": 4,
                "changes": 26,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_lpar.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_lpar.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/tests%2Funit%2Fzhmcclient%2Ftest_lpar.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -19,11 +19,13 @@\n \n import re\n import copy\n+import logging\n from unittest import mock\n import pytest\n import requests_mock\n \n-from zhmcclient import Client, Lpar, HTTPError, StatusTimeout, Job\n+from zhmcclient import Client, Lpar, HTTPError, StatusTimeout, Job, \\\n+    BLANKED_OUT_STRING\n from zhmcclient_mock import FakedSession, LparActivateHandler, \\\n     LparDeactivateHandler, LparLoadHandler\n from tests.common.utils import assert_resources\n@@ -319,13 +321,18 @@ def test_lpar_repr(self):\n             {'description': 'New lpar description'},\n             {'acceptable-status': ['operating', 'not-operating'],\n              'description': 'New lpar description'},\n-            {'ssc-master-userid': None,\n-             'ssc-master-pw': None},\n+            {'ssc-master-userid': 'user',\n+             'ssc-master-pw': 'bla'},\n+            {'zaware-master-userid': 'user',\n+             'zaware-master-pw': 'bla'},\n         ]\n     )\n-    def test_lpar_update_properties(self, input_props, lpar_name):\n+    def test_lpar_update_properties(self, caplog, input_props, lpar_name):\n         \"\"\"Test Lpar.update_properties().\"\"\"\n \n+        logger_name = \"zhmcclient.api\"\n+        caplog.set_level(logging.DEBUG, logger=logger_name)\n+\n         # Add faked lpars\n         self.add_lpar1()\n         self.add_lpar2()\n@@ -339,6 +346,9 @@ def test_lpar_update_properties(self, input_props, lpar_name):\n         # Execute the code to be tested\n         lpar.update_properties(properties=input_props)\n \n+        # Get its API call log record\n+        call_record = caplog.records[-2]\n+\n         # Verify that the resource object already reflects the property\n         # updates.\n         for prop_name in saved_properties:\n@@ -362,6 +372,14 @@ def test_lpar_update_properties(self, input_props, lpar_name):\n             prop_value = lpar.properties[prop_name]\n             assert prop_value == exp_prop_value\n \n+        # Verify the API call log record for blanked-out properties.\n+        if 'ssc-master-pw' in input_props:\n+            exp_str = f\"'ssc-master-pw': '{BLANKED_OUT_STRING}'\"\n+            assert call_record.message.find(exp_str) > 0\n+        if 'zaware-master-pw' in input_props:\n+            exp_str = f\"'zaware-master-pw': '{BLANKED_OUT_STRING}'\"\n+            assert call_record.message.find(exp_str) > 0\n+\n     @pytest.mark.parametrize(\n         \"initial_profile, profile_kwargs, exp_profile, exp_profile_exc\", [\n             ('', {},"
            },
            {
                "sha": "c4bfdd652a8de8e206e780056354f45e8de46eff",
                "filename": "tests/unit/zhmcclient/test_partition.py",
                "status": "modified",
                "additions": 55,
                "deletions": 7,
                "changes": 62,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_partition.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_partition.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/tests%2Funit%2Fzhmcclient%2Ftest_partition.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -19,9 +19,11 @@\n \n import re\n import copy\n+import logging\n import pytest\n \n-from zhmcclient import Client, Partition, HTTPError, NotFound\n+from zhmcclient import Client, Partition, HTTPError, NotFound, \\\n+    BLANKED_OUT_STRING\n from zhmcclient_mock import FakedSession\n from tests.common.utils import assert_resources\n \n@@ -307,23 +309,43 @@ def test_pm_list_add_props(\n             ({'name': 'fake-part-x',\n               'ifl-processors': 2,\n               'initial-memory': 4096,\n-              'maximum-memory': 4096},\n+              'maximum-memory': 4096,\n+              'description': 'fake description X'},\n              ['object-uri', 'name', 'initial-memory', 'maximum-memory',\n-              'ifl-processors'],\n+              'ifl-processors', 'description'],\n              None),\n             ({'name': 'fake-part-x',\n               'ifl-processors': 2,\n               'initial-memory': 4096,\n               'maximum-memory': 4096,\n-              'description': 'fake description X'},\n+              'boot-device': 'ftp',\n+              'boot-ftp-host': 'host',\n+              'boot-ftp-username': 'user',\n+              'boot-ftp-password': 'bla',\n+              'boot-ftp-insfile': 'ins'},\n              ['object-uri', 'name', 'initial-memory', 'maximum-memory',\n-              'ifl-processors', 'description'],\n+              'ifl-processors', 'boot-device', 'boot-ftp-host',\n+              'boot-ftp-username', 'boot-ftp-insfile'],\n+             None),\n+            ({'name': 'fake-part-x',\n+              'ifl-processors': 2,\n+              'initial-memory': 4096,\n+              'maximum-memory': 4096,\n+              'type': 'ssc',\n+              'ssc-host-name': 'host',\n+              'ssc-master-userid': 'user',\n+              'ssc-master-pw': 'bla'},\n+             ['object-uri', 'name', 'initial-memory', 'maximum-memory',\n+              'ifl-processors', 'type', 'ssc-host-name', 'ssc-master-userid'],\n              None),\n         ]\n     )\n-    def test_pm_create(self, input_props, exp_prop_names, exp_exc):\n+    def test_pm_create(self, caplog, input_props, exp_prop_names, exp_exc):\n         \"\"\"Test PartitionManager.create().\"\"\"\n \n+        logger_name = \"zhmcclient.api\"\n+        caplog.set_level(logging.DEBUG, logger=logger_name)\n+\n         partition_mgr = self.cpc.partitions\n \n         if exp_exc is not None:\n@@ -345,6 +367,9 @@ def test_pm_create(self, input_props, exp_prop_names, exp_exc):\n             # the input properties plus 'object-uri'.\n             partition = partition_mgr.create(properties=input_props)\n \n+            # Get its API call log record\n+            call_record = caplog.records[-2]\n+\n             # Check the resource for consistency within itself\n             assert isinstance(partition, Partition)\n             partition_name = partition.name\n@@ -362,6 +387,14 @@ def test_pm_create(self, input_props, exp_prop_names, exp_exc):\n                     exp_value = input_props[prop_name]\n                     assert value == exp_value\n \n+            # Verify the API call log record for blanked-out properties.\n+            if 'boot-ftp-password' in input_props:\n+                exp_str = f\"'boot-ftp-password': '{BLANKED_OUT_STRING}'\"\n+                assert call_record.message.find(exp_str) > 0\n+            if 'ssc-master-pw' in input_props:\n+                exp_str = f\"'ssc-master-pw': '{BLANKED_OUT_STRING}'\"\n+                assert call_record.message.find(exp_str) > 0\n+\n     def test_pm_resource_object(self):\n         \"\"\"\n         Test PartitionManager.resource_object().\n@@ -673,9 +706,13 @@ def test_partition_feature_info(\n              'ssc-master-pw': None},\n         ]\n     )\n-    def test_partition_update_properties(self, input_props, partition_name):\n+    def test_partition_update_properties(\n+            self, caplog, input_props, partition_name):\n         \"\"\"Test Partition.update_properties().\"\"\"\n \n+        logger_name = \"zhmcclient.api\"\n+        caplog.set_level(logging.DEBUG, logger=logger_name)\n+\n         # Add faked partitions\n         self.add_partition1()\n         self.add_partition2()\n@@ -689,6 +726,9 @@ def test_partition_update_properties(self, input_props, partition_name):\n         # Execute the code to be tested\n         partition.update_properties(properties=input_props)\n \n+        # Get its API call log record\n+        call_record = caplog.records[-2]\n+\n         # Verify that the resource object already reflects the property\n         # updates.\n         for prop_name in saved_properties:\n@@ -712,6 +752,14 @@ def test_partition_update_properties(self, input_props, partition_name):\n             prop_value = partition.properties[prop_name]\n             assert prop_value == exp_prop_value\n \n+        # Verify the API call log record for blanked-out properties.\n+        if 'boot-ftp-password' in input_props:\n+            exp_str = f\"'boot-ftp-password': '{BLANKED_OUT_STRING}'\"\n+            assert call_record.message.find(exp_str) > 0\n+        if 'ssc-master-pw' in input_props:\n+            exp_str = f\"'ssc-master-pw': '{BLANKED_OUT_STRING}'\"\n+            assert call_record.message.find(exp_str) > 0\n+\n     def test_partition_update_name(self):\n         \"\"\"\n         Test Partition.update_properties() with 'name' property."
            },
            {
                "sha": "2e8f59f09410d81a4086600e1d4e2fb5c620e77b",
                "filename": "tests/unit/zhmcclient/test_user.py",
                "status": "modified",
                "additions": 15,
                "deletions": 2,
                "changes": 17,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_user.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/tests%2Funit%2Fzhmcclient%2Ftest_user.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/tests%2Funit%2Fzhmcclient%2Ftest_user.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -19,9 +19,10 @@\n \n import re\n import copy\n+import logging\n import pytest\n \n-from zhmcclient import Client, HTTPError, NotFound, User\n+from zhmcclient import Client, HTTPError, NotFound, User, BLANKED_OUT_STRING\n from zhmcclient_mock import FakedSession\n from tests.common.utils import assert_resources\n \n@@ -180,9 +181,13 @@ def test_user_manager_list(\n              None),\n         ]\n     )\n-    def test_user_manager_create(self, input_props, exp_prop_names, exp_exc):\n+    def test_user_manager_create(\n+            self, caplog, input_props, exp_prop_names, exp_exc):\n         \"\"\"Test UserManager.create().\"\"\"\n \n+        logger_name = \"zhmcclient.api\"\n+        caplog.set_level(logging.DEBUG, logger=logger_name)\n+\n         user_mgr = self.console.users\n \n         if exp_exc is not None:\n@@ -202,6 +207,9 @@ def test_user_manager_create(self, input_props, exp_prop_names, exp_exc):\n             # Execute the code to be tested.\n             user = user_mgr.create(properties=input_props)\n \n+            # Get its API call log record\n+            call_record = caplog.records[-2]\n+\n             # Check the resource for consistency within itself\n             assert isinstance(user, User)\n             user_name = user.name\n@@ -219,6 +227,11 @@ def test_user_manager_create(self, input_props, exp_prop_names, exp_exc):\n                     exp_value = input_props[prop_name]\n                     assert value == exp_value\n \n+            # Verify the API call log record for blanked-out properties.\n+            if 'password' in input_props:\n+                exp_str = f\"'password': '{BLANKED_OUT_STRING}'\"\n+                assert call_record.message.find(exp_str) > 0\n+\n     def test_user_repr(self):\n         \"\"\"Test User.__repr__().\"\"\"\n "
            },
            {
                "sha": "b59799e3a4323fd4bdc035008f844c4599b9ded0",
                "filename": "zhmcclient/_activation_profile.py",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_activation_profile.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_activation_profile.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/zhmcclient%2F_activation_profile.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -224,7 +224,8 @@ def list(self, full_properties=False, filter_args=None,\n             list_uri, result_prop, full_properties, filter_args,\n             additional_properties)\n \n-    @logged_api_call\n+    @logged_api_call(blanked_properties=['ssc-master-pw', 'zaware-master-pw'],\n+                     properties_pos=1)\n     def create(self, properties):\n         \"\"\"\n         Create and configure an Activation Profiles on this CPC, of the profile\n@@ -344,7 +345,8 @@ def delete(self):\n             self.get_properties_local(self.manager._name_prop, None))\n         self.cease_existence_local()\n \n-    @logged_api_call\n+    @logged_api_call(blanked_properties=['ssc-master-pw', 'zaware-master-pw'],\n+                     properties_pos=1)\n     def update_properties(self, properties):\n         \"\"\"\n         Update writeable properties of this Activation Profile."
            },
            {
                "sha": "9ec51cfc4d60e4f83ef9d847306b2f89a570eb8a",
                "filename": "zhmcclient/_constants.py",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_constants.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_constants.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/zhmcclient%2F_constants.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -50,7 +50,8 @@\n            'HTML_REASON_WEB_SERVICES_DISABLED',\n            'HTML_REASON_OTHER',\n            'STOMP_MIN_CONNECTION_CHECK_TIME',\n-           'DEFAULT_WS_TIMEOUT']\n+           'DEFAULT_WS_TIMEOUT',\n+           'BLANKED_OUT_STRING']\n \n \n #: Default HTTP connect timeout in seconds,\n@@ -187,3 +188,7 @@\n #: Default WebSocket connect and receive timeout in seconds, for interacting\n #: with the :class:`zhmcclient.OSConsole` class.\n DEFAULT_WS_TIMEOUT = 5\n+\n+#: Replacement string for blanked out sensitive values in log entries, such as\n+#: passwords or session tokens.\n+BLANKED_OUT_STRING = '********'"
            },
            {
                "sha": "6f24cd885159470dce4415931a3905862c1f37b9",
                "filename": "zhmcclient/_ldap_server_definition.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_ldap_server_definition.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_ldap_server_definition.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/zhmcclient%2F_ldap_server_definition.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -151,7 +151,7 @@ def list(self, full_properties=False, filter_args=None):\n         return self._list_with_operation(\n             list_uri, result_prop, full_properties, filter_args, None)\n \n-    @logged_api_call\n+    @logged_api_call(blanked_properties=['bind-password'], properties_pos=1)\n     def create(self, properties):\n         \"\"\"\n         Create a new LDAP Server Definition in this HMC.\n@@ -257,7 +257,7 @@ def delete(self):\n             self.get_properties_local(self.manager._name_prop, None))\n         self.cease_existence_local()\n \n-    @logged_api_call\n+    @logged_api_call(blanked_properties=['bind-password'], properties_pos=1)\n     def update_properties(self, properties):\n         \"\"\"\n         Update writeable properties of this LDAP Server Definitions."
            },
            {
                "sha": "80ed92c348176bf7500308d5727c421c006a0e51",
                "filename": "zhmcclient/_logging.py",
                "status": "modified",
                "additions": 187,
                "deletions": 81,
                "changes": 268,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_logging.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_logging.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/zhmcclient%2F_logging.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -75,9 +75,10 @@\n \n import logging\n import inspect\n-from decorator import decorate  # requires decorator>=4.0\n+import functools\n+from collections.abc import Mapping, Sequence\n \n-from ._constants import API_LOGGER_NAME\n+from ._constants import API_LOGGER_NAME, BLANKED_OUT_STRING\n \n __all__ = []\n \n@@ -105,7 +106,8 @@ def get_logger(name):\n     return logger\n \n \n-def logged_api_call(func):\n+def logged_api_call(\n+        org_func=None, *, blanked_properties=None, properties_pos=None):\n     \"\"\"\n     Function decorator that causes the decorated API function or method to log\n     calls to itself to a logger.\n@@ -115,7 +117,24 @@ def logged_api_call(func):\n \n     Parameters:\n \n-      func (function object): The original function being decorated.\n+      org_func (function object): The original function being decorated.\n+        Will be `None` if the decorator is specified with its optional\n+        argument 'blanked_properties'.\n+\n+      blanked_properties (list of str): Optional: List of properties in the\n+        'properties' argument of the decorated API function that should be\n+        blanked out before being logged. Can be used to hide password\n+        properties.\n+        This parameter is required when 'properties_pos' is used.\n+        This parameter must be specified as a keyword argument.\n+\n+      properties_pos (int): Optional: 0-based index of the 'properties'\n+        parameter in the argument list of the decorated API function.\n+        For methods, the 'self' or 'cls' parameter is included in the position.\n+        This parameter is needed in case the properties are passed as a\n+        positional argument by the caller of the API function.\n+        This parameter is required when 'blanked_properties' is used.\n+        This parameter must be specified as a keyword argument.\n \n     Returns:\n \n@@ -128,109 +147,196 @@ def logged_api_call(func):\n         method (and not on top of the @property decorator).\n     \"\"\"\n \n-    # Note that in this decorator function, we are in a module loading context,\n-    # where the decorated functions are being defined. When this decorator\n-    # function is called, its call stack represents the definition of the\n-    # decorated functions. Not all global definitions in the module have been\n-    # defined yet, and methods of classes that are decorated with this\n-    # decorator are still functions at this point (and not yet methods).\n+    if blanked_properties is not None and properties_pos is None:\n+        raise TypeError(\n+            \"If the @logged_api_call decorator is specified with \"\n+            \"'blanked_properties', 'properties_pos' must also be specified.\")\n \n-    module = inspect.getmodule(func)\n-    if not inspect.isfunction(func) or not hasattr(module, '__name__'):\n-        raise TypeError(\"The @logged_api_call decorator must be used on a \"\n-                        \"function or method (and not on top of the @property \"\n-                        \"decorator)\")\n+    if properties_pos is not None and blanked_properties is None:\n+        raise TypeError(\n+            \"If the @logged_api_call decorator is specified with \"\n+            \"'properties_pos', 'blanked_properties' must also be specified.\")\n \n-    try:\n-        # We avoid the use of inspect.getouterframes() because it is slow,\n-        # and use the pointers up the stack frame, instead.\n+    if blanked_properties is not None and (\n+            not isinstance(blanked_properties, Sequence) or  # noqa: W504\n+            isinstance(blanked_properties, str)):\n+        raise TypeError(\n+            \"The 'blanked_properties' parameter of the @logged_api_call \"\n+            \"decorator must be a list of strings.\")\n \n-        this_frame = inspect.currentframe()  # this decorator function here\n-        apifunc_frame = this_frame.f_back  # the decorated API function\n-\n-        apifunc_owner = inspect.getframeinfo(apifunc_frame)[2]\n+    def _decorate(func):\n+        \"\"\"\n+        The actual decorator function that always gets the original decorated\n+        function, independent of whether the 'logged_api_call' decorator was\n+        specified with or without its optional arguments.\n \n-    finally:\n-        # Recommended way to deal with frame objects to avoid ref cycles\n-        del this_frame\n-        del apifunc_frame\n+        Parameters:\n \n-    # TODO: For inner functions, show all outer levels instead of just one.\n+          func (function object): The original function being decorated.\n+        \"\"\"\n \n-    if apifunc_owner == '<module>':\n-        # The decorated API function is defined globally (at module level)\n-        apifunc_str = f'{func.__name__}()'\n-    else:\n-        # The decorated API function is defined in a class or in a function\n-        apifunc_str = f'{apifunc_owner}.{func.__name__}()'\n+        # Note that in this decorator function, we are in a module loading\n+        # context, where the decorated functions are being defined. When this\n+        # decorator function is called, its call stack represents the\n+        # definition of the decorated functions. Not all global definitions in\n+        # the module have been defined yet, and methods of classes that are\n+        # decorated with this decorator are still functions at this point (and\n+        # not yet methods).\n \n-    logger = get_logger(API_LOGGER_NAME)\n+        if not inspect.isfunction(func):\n+            raise TypeError(\"The @logged_api_call decorator must be used on a \"\n+                            \"function or method (and not on top of the \"\n+                            \"@property decorator)\")\n \n-    def is_external_call():\n-        \"\"\"\n-        Return a boolean indicating whether the call to the decorated API\n-        function is an external call (vs. b eing an internal call).\n-        \"\"\"\n         try:\n             # We avoid the use of inspect.getouterframes() because it is slow,\n             # and use the pointers up the stack frame, instead.\n \n-            log_it_frame = inspect.currentframe()  # this log_it() function\n-            log_api_call_frame = log_it_frame.f_back  # the log_api_call() func\n-            apifunc_frame = log_api_call_frame.f_back  # the decorated API func\n-            apicaller_frame = apifunc_frame.f_back  # caller of API function\n-            apicaller_module = inspect.getmodule(apicaller_frame)\n-            if apicaller_module is None:\n-                apicaller_module_name = \"<unknown>\"\n-            else:\n-                apicaller_module_name = apicaller_module.__name__\n+            this_frame = inspect.currentframe()  # this function\n+            apifunc_frame = this_frame.f_back  # the decorated API function\n+            if org_func:\n+                # In this case, there is one more decorator function nesting\n+                apifunc_frame = apifunc_frame.f_back\n+            apifunc_owner = inspect.getframeinfo(apifunc_frame)[2]\n+\n         finally:\n             # Recommended way to deal with frame objects to avoid ref cycles\n-            del log_it_frame\n-            del log_api_call_frame\n+            del this_frame\n             del apifunc_frame\n-            del apicaller_frame\n-            del apicaller_module\n \n-        # Log only if the caller is not from the zhmcclient package\n-        return apicaller_module_name.split('.')[0] != 'zhmcclient'\n+        # TODO: For inner functions, show all outer levels instead of just one.\n+\n+        func_name = getattr(func, '__name__', '<unknown>')\n+        if apifunc_owner == '<module>':\n+            # The decorated API function is defined globally (at module level)\n+            apifunc_str = f'{func_name}()'\n+        else:\n+            # The decorated API function is defined in a class or in a function\n+            apifunc_str = f'{apifunc_owner}.{func_name}()'\n+\n+        logger = get_logger(API_LOGGER_NAME)\n+\n+        def is_external_call():\n+            \"\"\"\n+            Return a boolean indicating whether the call to the decorated API\n+            function is made from outside of the zhmcclient package.\n+            \"\"\"\n+            try:\n+                # We avoid the use of inspect.getouterframes() because it is\n+                # slow, and use the pointers up the stack frame, instead.\n+\n+                this_frame = inspect.currentframe()  # this function\n+                log_api_call_frame = this_frame.f_back  # log_api_call()\n+                apifunc_frame = log_api_call_frame.f_back  # the decorated func\n+                apicaller_frame = apifunc_frame.f_back  # caller of API func\n+                apicaller_module = inspect.getmodule(apicaller_frame)\n+                if apicaller_module is None:\n+                    apicaller_module_name = \"<unknown>\"\n+                else:\n+                    apicaller_module_name = apicaller_module.__name__\n+            finally:\n+                # Recommended way to deal with frame objects to avoid ref\n+                # cycles\n+                del this_frame\n+                del log_api_call_frame\n+                del apifunc_frame\n+                del apicaller_frame\n+                del apicaller_module\n+\n+            # Log only if the caller is not from the zhmcclient package\n+            return apicaller_module_name.split('.')[0] != 'zhmcclient'\n+\n+        def blanked_dict(properties):\n+            \"\"\"\n+            Return a copy of the properties dict, with blanked out values\n+            according to the 'blanked_properties' and 'properties_pos'\n+            arguments of the 'logged_api_call' decorator.\n+            \"\"\"\n+            # properties may also be a DictView (subclass of Mapping)\n+            assert isinstance(properties, Mapping)\n+            copied_properties = dict(properties)\n+            for pn in blanked_properties:\n+                try:\n+                    copied_properties[pn] = BLANKED_OUT_STRING\n+                except KeyError:\n+                    pass\n+            return copied_properties\n+\n+        def blanked_args(args, kwargs):\n+            \"\"\"\n+            Return a copy of args and kwargs, whereby the 'properties' argument\n+            has items blanked out according to the 'blanked_properties' and\n+            'properties_pos' arguments of the 'logged_api_call' decorator.\n+            \"\"\"\n+            logged_kwargs = dict(kwargs)\n+            logged_args = list(args)\n+            if blanked_properties is not None:\n+                if 'properties' in kwargs:\n+                    logged_kwargs['properties'] = \\\n+                        blanked_dict(kwargs['properties'])\n+                else:\n+                    logged_args[properties_pos] = \\\n+                        blanked_dict(args[properties_pos])\n+            return tuple(logged_args), logged_kwargs\n+\n+        def log_call(args, kwargs):\n+            \"\"\"\n+            Log the call to the API function.\n+            \"\"\"\n+            logged_args, logged_kwargs = blanked_args(args, kwargs)\n+            logger.debug(\"Called: %s, args: %.500s, kwargs: %.500s\",\n+                         apifunc_str,\n+                         log_escaped(repr(logged_args)),\n+                         log_escaped(repr(logged_kwargs)))\n+\n+        def log_return(result):\n+            \"\"\"\n+            Log the return from the API function.\n+            \"\"\"\n+            logger.debug(\"Return: %s, result: %.1000s\",\n+                         apifunc_str, log_escaped(repr(result)))\n \n-    def log_api_call(func, *args, **kwargs):\n-        \"\"\"\n-        Log entry to and exit from the decorated function, at the debug level.\n+        @functools.wraps(func)\n+        def log_api_call(*args, **kwargs):\n+            \"\"\"\n+            Log entry to and exit from the decorated function, at the debug\n+            level.\n \n-        Note that this wrapper function is called every time the decorated\n-        function/method is called, but that the log message only needs to be\n-        constructed when logging for this logger and for this log level is\n-        turned on. Therefore, we do as much as possible in the decorator\n-        function, plus we use %-formatting and lazy interpolation provided by\n-        the log functions, in order to save resources in this function here.\n+            Note that this wrapper function is called every time the decorated\n+            function/method is called, but that the log message only needs to\n+            be constructed when logging for this logger and for this log level\n+            is turned on. Therefore, we do as much as possible in the decorator\n+            function, plus we use %-formatting and lazy interpolation provided\n+            by the log functions, in order to save resources in this function\n+            here.\n \n-        Parameters:\n+            Parameters:\n \n-          func (function object): The decorated function.\n+              func (function object): The decorated function.\n \n-          *args: Any positional arguments for the decorated function.\n+              *args: Any positional arguments for the decorated function.\n \n-          **kwargs: Any keyword arguments for the decorated function.\n-        \"\"\"\n+              **kwargs: Any keyword arguments for the decorated function.\n+            \"\"\"\n \n-        # Note that in this function, we are in the context where the\n-        # decorated function is actually called.\n+            # Note that in this function, we are in the context where the\n+            # decorated function is actually called.\n+            _log_it = is_external_call() and logger.isEnabledFor(logging.DEBUG)\n \n-        _log_it = is_external_call() and logger.isEnabledFor(logging.DEBUG)\n+            if _log_it:\n+                log_call(args, kwargs)\n \n-        if _log_it:\n-            logger.debug(\"Called: %s, args: %.500s, kwargs: %.500s\",\n-                         apifunc_str, log_escaped(repr(args)),\n-                         log_escaped(repr(kwargs)))\n+            result = func(*args, **kwargs)  # The zhmcclient function\n \n-        result = func(*args, **kwargs)\n+            if _log_it:\n+                log_return(result)\n \n-        if _log_it:\n-            logger.debug(\"Return: %s, result: %.1000s\",\n-                         apifunc_str, log_escaped(repr(result)))\n+            return result\n \n-        return result\n+        return log_api_call\n \n-    return decorate(func, log_api_call)\n+    # When the logged_api_call decorator is specified with its optional\n+    # arguments, org_func is None\n+    if org_func:\n+        return _decorate(org_func)\n+    return _decorate"
            },
            {
                "sha": "4376b3762ec2b2e8e1eeedb61b3afbd0b7f008c7",
                "filename": "zhmcclient/_lpar.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_lpar.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_lpar.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/zhmcclient%2F_lpar.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -187,7 +187,8 @@ def __init__(self, manager, uri, name=None, properties=None):\n             f\"got {type(manager)}\")\n         super().__init__(manager, uri, name, properties)\n \n-    @logged_api_call\n+    @logged_api_call(blanked_properties=['ssc-master-pw', 'zaware-master-pw'],\n+                     properties_pos=1)\n     def update_properties(self, properties):\n         \"\"\"\n         Update writeable properties of this LPAR."
            },
            {
                "sha": "1ecc91fb6fac8d4a289e67dbb7f3f2830daa076b",
                "filename": "zhmcclient/_partition.py",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_partition.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_partition.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/zhmcclient%2F_partition.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -176,7 +176,8 @@ def list(self, full_properties=False, filter_args=None,\n             list_uri, result_prop, full_properties, filter_args,\n             additional_properties)\n \n-    @logged_api_call\n+    @logged_api_call(blanked_properties=['boot-ftp-password', 'ssc-master-pw'],\n+                     properties_pos=1)\n     def create(self, properties):\n         \"\"\"\n         Create and configure a Partition in this CPC.\n@@ -591,7 +592,8 @@ def delete(self):\n             self.get_properties_local(self.manager._name_prop, None))\n         self.cease_existence_local()\n \n-    @logged_api_call\n+    @logged_api_call(blanked_properties=['boot-ftp-password', 'ssc-master-pw'],\n+                     properties_pos=1)\n     def update_properties(self, properties):\n         \"\"\"\n         Update writeable properties of this Partition."
            },
            {
                "sha": "500d569f4109daf3067d366c6016ad8eb9ebece7",
                "filename": "zhmcclient/_session.py",
                "status": "modified",
                "additions": 19,
                "deletions": 9,
                "changes": 28,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_session.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_session.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/zhmcclient%2F_session.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -39,7 +39,7 @@\n     DEFAULT_OPERATION_TIMEOUT, DEFAULT_STATUS_TIMEOUT, \\\n     DEFAULT_NAME_URI_CACHE_TIMETOLIVE, HMC_LOGGER_NAME, \\\n     HTML_REASON_WEB_SERVICES_DISABLED, HTML_REASON_OTHER, \\\n-    DEFAULT_HMC_PORT\n+    DEFAULT_HMC_PORT, BLANKED_OUT_STRING\n from ._utils import repr_obj_id\n from ._version import __version__\n \n@@ -54,7 +54,14 @@\n     'Accept': '*/*'\n }\n \n-BLANKED_OUT = '********'  # Replacement for blanked out sensitive values\n+# Properties whose values are always blanked out in the HMC log entries\n+BLANKED_OUT_PROPERTIES = [\n+    'boot-ftp-password',    # partition create/update\n+    'bind-password',        # LDAP server def. create/update\n+    'ssc-master-pw',        # image profile cr/upd, part. cr/upd, LPAR upd\n+    'password',             # user create/update\n+    'zaware-master-pw',     # image profile create/update, LPAR update\n+]\n \n \n def _handle_request_exc(exc, retry_timeout_config):\n@@ -263,7 +270,7 @@ def _headers_for_logging(headers):\n     \"\"\"\n     if headers and 'X-API-Session' in headers:\n         headers = headers.copy()\n-        headers['X-API-Session'] = BLANKED_OUT\n+        headers['X-API-Session'] = BLANKED_OUT_STRING\n     return headers\n \n \n@@ -465,7 +472,7 @@ def __repr__(self):\n             f\"  _actual_host={self._actual_host!r},\\n\"\n             f\"  _base_url={self._base_url!r},\\n\"\n             f\"  _headers={headers!r},\\n\"\n-            f\"  _session_id={BLANKED_OUT!r},\\n\"\n+            f\"  _session_id={BLANKED_OUT_STRING!r},\\n\"\n             f\"  _session={self._session!r}\\n\"\n             f\"  _object_topic={self._object_topic!r}\\n\"\n             f\"  _job_topic={self._job_topic!r}\\n\"\n@@ -960,8 +967,11 @@ def _log_http_request(\n                 # structured data such as a password or session IDs.\n                 pass\n             else:\n-                if 'password' in content_dict:\n-                    content_dict['password'] = BLANKED_OUT\n+                for prop in BLANKED_OUT_PROPERTIES:\n+                    try:\n+                        content_dict[prop] = BLANKED_OUT_STRING\n+                    except KeyError:\n+                        pass\n                 content = dict2json(content_dict)\n             trunc = 30000\n             if content_len > trunc:\n@@ -1029,11 +1039,11 @@ def _log_http_response(\n                 if 'request-headers' in content_dict:\n                     headers_dict = content_dict['request-headers']\n                     if 'x-api-session' in headers_dict:\n-                        headers_dict['x-api-session'] = BLANKED_OUT\n+                        headers_dict['x-api-session'] = BLANKED_OUT_STRING\n                 if 'api-session' in content_dict:\n-                    content_dict['api-session'] = BLANKED_OUT\n+                    content_dict['api-session'] = BLANKED_OUT_STRING\n                 if 'session-credential' in content_dict:\n-                    content_dict['session-credential'] = BLANKED_OUT\n+                    content_dict['session-credential'] = BLANKED_OUT_STRING\n                 content = dict2json(content_dict)\n             if status >= 400:\n                 content_label = 'content'"
            },
            {
                "sha": "202333f82c30a0d8f80fb94f1ebac086c4e5b84e",
                "filename": "zhmcclient/_user.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/zhmcclient/python-zhmcclient/blob/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_user.py",
                "raw_url": "https://github.com/zhmcclient/python-zhmcclient/raw/ad32781e782d0f604c6da4680fce48e4cc1f4433/zhmcclient%2F_user.py",
                "contents_url": "https://api.github.com/repos/zhmcclient/python-zhmcclient/contents/zhmcclient%2F_user.py?ref=ad32781e782d0f604c6da4680fce48e4cc1f4433",
                "patch": "@@ -149,7 +149,7 @@ def list(self, full_properties=False, filter_args=None):\n         return self._list_with_operation(\n             list_uri, result_prop, full_properties, filter_args, None)\n \n-    @logged_api_call\n+    @logged_api_call(blanked_properties=['password'], properties_pos=1)\n     def create(self, properties):\n         \"\"\"\n         Create a new User in this HMC.\n@@ -256,7 +256,7 @@ def delete(self):\n             self.get_properties_local(self.manager._name_prop, None))\n         self.cease_existence_local()\n \n-    @logged_api_call\n+    @logged_api_call(blanked_properties=['password'], properties_pos=1)\n     def update_properties(self, properties):\n         \"\"\"\n         Update writeable properties of this User."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ibexa/admin-ui/commits/8ec824a8cf06c566ed88e4c21cc66f7ed42649fc",
        "url": "https://api.github.com/repos/ibexa/admin-ui/commits/8ec824a8cf06c566ed88e4c21cc66f7ed42649fc",
        "html_url": "https://github.com/ibexa/admin-ui/commit/8ec824a8cf06c566ed88e4c21cc66f7ed42649fc",
        "message": "IBX-9181: Changed innerHTML to innerText",
        "files": [
            {
                "sha": "a5a6bd0c1e198efe5e39789315cfc50745d66550",
                "filename": "src/bundle/Resources/public/js/scripts/helpers/tooltips.helper.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/ibexa/admin-ui/blob/8ec824a8cf06c566ed88e4c21cc66f7ed42649fc/src%2Fbundle%2FResources%2Fpublic%2Fjs%2Fscripts%2Fhelpers%2Ftooltips.helper.js",
                "raw_url": "https://github.com/ibexa/admin-ui/raw/8ec824a8cf06c566ed88e4c21cc66f7ed42649fc/src%2Fbundle%2FResources%2Fpublic%2Fjs%2Fscripts%2Fhelpers%2Ftooltips.helper.js",
                "contents_url": "https://api.github.com/repos/ibexa/admin-ui/contents/src%2Fbundle%2FResources%2Fpublic%2Fjs%2Fscripts%2Fhelpers%2Ftooltips.helper.js?ref=8ec824a8cf06c566ed88e4c21cc66f7ed42649fc",
                "patch": "@@ -82,7 +82,7 @@ const modifyPopperConfig = (iframe, defaultBsPopperConfig) => {\n const getTextHeight = (text, styles) => {\n     const tag = doc.createElement('div');\n \n-    tag.innerHTML = text;\n+    tag.innerText = text;\n \n     for (const key in styles) {\n         tag.style[key] = styles[key];"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/jpadilla/pyjwt/commits/1570e708672aa9036bc772476beae8bfa48f4131#diff-6893ad4a1c5a36b8af3028db8c8bc3b62418149843fc382faf901eaab008e380R366",
        "url": "https://api.github.com/repos/jpadilla/pyjwt/commits/1570e708672aa9036bc772476beae8bfa48f4131",
        "html_url": "https://github.com/jpadilla/pyjwt/commit/1570e708672aa9036bc772476beae8bfa48f4131",
        "message": "chore: use sequence for typing rather than list (#970)\n\n* chore: use sequence for typing rather than list\r\n\r\nthere's no reason we need to use `List` for the typing of issuers & other parameters - the `Sequence` type allows us to accept more types such as `tuple` and `set` which still support the behavior we need\r\n\r\n* chore: use sequence rather than list for parameters in jws\r\n\r\nloosens up the typing on `api_jws` so we accept sequences rather than just lists\r\n\r\n* chore: undo return type change\r\n\r\n* chore: update changelog",
        "files": [
            {
                "sha": "3a22594d3f86891e2f7b6c8ee318d8b30994b89e",
                "filename": "CHANGELOG.rst",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/jpadilla/pyjwt/blob/1570e708672aa9036bc772476beae8bfa48f4131/CHANGELOG.rst",
                "raw_url": "https://github.com/jpadilla/pyjwt/raw/1570e708672aa9036bc772476beae8bfa48f4131/CHANGELOG.rst",
                "contents_url": "https://api.github.com/repos/jpadilla/pyjwt/contents/CHANGELOG.rst?ref=1570e708672aa9036bc772476beae8bfa48f4131",
                "patch": "@@ -10,6 +10,8 @@ This project adheres to `Semantic Versioning <https://semver.org/>`__.\n Changed\n ~~~~~~~\n \n+- Use ``Sequence`` for parameter types rather than ``List`` where applicable by @imnotjames in `#970 <https://github.com/jpadilla/pyjwt/pull/970>`__\n+\n Fixed\n ~~~~~\n "
            },
            {
                "sha": "20515433f8c84caacca42a833d53ed7a51b41bd9",
                "filename": "jwt/api_jws.py",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/jpadilla/pyjwt/blob/1570e708672aa9036bc772476beae8bfa48f4131/jwt%2Fapi_jws.py",
                "raw_url": "https://github.com/jpadilla/pyjwt/raw/1570e708672aa9036bc772476beae8bfa48f4131/jwt%2Fapi_jws.py",
                "contents_url": "https://api.github.com/repos/jpadilla/pyjwt/contents/jwt%2Fapi_jws.py?ref=1570e708672aa9036bc772476beae8bfa48f4131",
                "patch": "@@ -3,6 +3,7 @@\n import binascii\n import json\n import warnings\n+from collections.abc import Sequence\n from typing import TYPE_CHECKING, Any\n \n from .algorithms import (\n@@ -30,7 +31,7 @@ class PyJWS:\n \n     def __init__(\n         self,\n-        algorithms: list[str] | None = None,\n+        algorithms: Sequence[str] | None = None,\n         options: dict[str, Any] | None = None,\n     ) -> None:\n         self._algorithms = get_default_algorithms()\n@@ -174,7 +175,7 @@ def decode_complete(\n         self,\n         jwt: str | bytes,\n         key: AllowedPublicKeys | PyJWK | str | bytes = \"\",\n-        algorithms: list[str] | None = None,\n+        algorithms: Sequence[str] | None = None,\n         options: dict[str, Any] | None = None,\n         detached_payload: bytes | None = None,\n         **kwargs,\n@@ -219,7 +220,7 @@ def decode(\n         self,\n         jwt: str | bytes,\n         key: AllowedPublicKeys | PyJWK | str | bytes = \"\",\n-        algorithms: list[str] | None = None,\n+        algorithms: Sequence[str] | None = None,\n         options: dict[str, Any] | None = None,\n         detached_payload: bytes | None = None,\n         **kwargs,\n@@ -291,7 +292,7 @@ def _verify_signature(\n         header: dict[str, Any],\n         signature: bytes,\n         key: AllowedPublicKeys | PyJWK | str | bytes = \"\",\n-        algorithms: list[str] | None = None,\n+        algorithms: Sequence[str] | None = None,\n     ) -> None:\n         if algorithms is None and isinstance(key, PyJWK):\n             algorithms = [key.algorithm_name]"
            },
            {
                "sha": "e162623c03712f1a84d8127c45458a7890fe15e9",
                "filename": "jwt/api_jwt.py",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/jpadilla/pyjwt/blob/1570e708672aa9036bc772476beae8bfa48f4131/jwt%2Fapi_jwt.py",
                "raw_url": "https://github.com/jpadilla/pyjwt/raw/1570e708672aa9036bc772476beae8bfa48f4131/jwt%2Fapi_jwt.py",
                "contents_url": "https://api.github.com/repos/jpadilla/pyjwt/contents/jwt%2Fapi_jwt.py?ref=1570e708672aa9036bc772476beae8bfa48f4131",
                "patch": "@@ -3,9 +3,9 @@\n import json\n import warnings\n from calendar import timegm\n-from collections.abc import Iterable\n+from collections.abc import Iterable, Sequence\n from datetime import datetime, timedelta, timezone\n-from typing import TYPE_CHECKING, Any, List\n+from typing import TYPE_CHECKING, Any\n \n from . import api_jws\n from .exceptions import (\n@@ -102,7 +102,7 @@ def decode_complete(\n         self,\n         jwt: str | bytes,\n         key: AllowedPublicKeys | PyJWK | str | bytes = \"\",\n-        algorithms: list[str] | None = None,\n+        algorithms: Sequence[str] | None = None,\n         options: dict[str, Any] | None = None,\n         # deprecated arg, remove in pyjwt3\n         verify: bool | None = None,\n@@ -111,7 +111,7 @@ def decode_complete(\n         # passthrough arguments to _validate_claims\n         # consider putting in options\n         audience: str | Iterable[str] | None = None,\n-        issuer: str | List[str] | None = None,\n+        issuer: str | Sequence[str] | None = None,\n         leeway: float | timedelta = 0,\n         # kwargs\n         **kwargs: Any,\n@@ -187,7 +187,7 @@ def decode(\n         self,\n         jwt: str | bytes,\n         key: AllowedPublicKeys | PyJWK | str | bytes = \"\",\n-        algorithms: list[str] | None = None,\n+        algorithms: Sequence[str] | None = None,\n         options: dict[str, Any] | None = None,\n         # deprecated arg, remove in pyjwt3\n         verify: bool | None = None,\n@@ -196,7 +196,7 @@ def decode(\n         # passthrough arguments to _validate_claims\n         # consider putting in options\n         audience: str | Iterable[str] | None = None,\n-        issuer: str | List[str] | None = None,\n+        issuer: str | Sequence[str] | None = None,\n         leeway: float | timedelta = 0,\n         # kwargs\n         **kwargs: Any,\n@@ -363,7 +363,7 @@ def _validate_iss(self, payload: dict[str, Any], issuer: Any) -> None:\n         if \"iss\" not in payload:\n             raise MissingRequiredClaimError(\"iss\")\n \n-        if isinstance(issuer, list):\n+        if isinstance(issuer, Sequence):\n             if payload[\"iss\"] not in issuer:\n                 raise InvalidIssuerError(\"Invalid issuer\")\n         else:"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/jpadilla/pyjwt/commits/33022c25525c1020869c71ce2a4109e44ae4ced1",
        "url": "https://api.github.com/repos/jpadilla/pyjwt/commits/33022c25525c1020869c71ce2a4109e44ae4ced1",
        "html_url": "https://github.com/jpadilla/pyjwt/commit/33022c25525c1020869c71ce2a4109e44ae4ced1",
        "message": "Merge commit from fork\n\nThis is a bug introduced in version 2.10.0: checking the \"iss\" claim\nchanged from `isinstance(issuer, list)` to `isinstance(issuer,\nSequence)`.\n\n```diff\n-        if isinstance(issuer, list):\n+        if isinstance(issuer, Sequence):\n            if payload[\"iss\"] not in issuer:\n                raise InvalidIssuerError(\"Invalid issuer\")\n        else:\n```\n\nSince str is a Sequnce, but not a list, `in` is also used for string\ncomparison. This results in `if \"abc\" not in \"__abcd__\":` being\nchecked instead of `if \"abc\" != \"__abc__\":`.\n\nCo-authored-by: Fabian Badoi <fabian.badoi@gmail.com>",
        "files": [
            {
                "sha": "3a201436c5b5064c32f117f6a1590a8af2af3b84",
                "filename": "jwt/api_jwt.py",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/jpadilla/pyjwt/blob/33022c25525c1020869c71ce2a4109e44ae4ced1/jwt%2Fapi_jwt.py",
                "raw_url": "https://github.com/jpadilla/pyjwt/raw/33022c25525c1020869c71ce2a4109e44ae4ced1/jwt%2Fapi_jwt.py",
                "contents_url": "https://api.github.com/repos/jpadilla/pyjwt/contents/jwt%2Fapi_jwt.py?ref=33022c25525c1020869c71ce2a4109e44ae4ced1",
                "patch": "@@ -419,11 +419,11 @@ def _validate_iss(self, payload: dict[str, Any], issuer: Any) -> None:\n         if \"iss\" not in payload:\n             raise MissingRequiredClaimError(\"iss\")\n \n-        if isinstance(issuer, Sequence):\n-            if payload[\"iss\"] not in issuer:\n+        if isinstance(issuer, str):\n+            if payload[\"iss\"] != issuer:\n                 raise InvalidIssuerError(\"Invalid issuer\")\n         else:\n-            if payload[\"iss\"] != issuer:\n+            if payload[\"iss\"] not in issuer:\n                 raise InvalidIssuerError(\"Invalid issuer\")\n \n "
            },
            {
                "sha": "ec68a079b50730ae34eaf9a869ceace0ef096003",
                "filename": "tests/test_api_jwt.py",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/jpadilla/pyjwt/blob/33022c25525c1020869c71ce2a4109e44ae4ced1/tests%2Ftest_api_jwt.py",
                "raw_url": "https://github.com/jpadilla/pyjwt/raw/33022c25525c1020869c71ce2a4109e44ae4ced1/tests%2Ftest_api_jwt.py",
                "contents_url": "https://api.github.com/repos/jpadilla/pyjwt/contents/tests%2Ftest_api_jwt.py?ref=33022c25525c1020869c71ce2a4109e44ae4ced1",
                "patch": "@@ -464,6 +464,16 @@ def test_raise_exception_token_without_issuer(self, jwt):\n \n         assert exc.value.claim == \"iss\"\n \n+    def test_rasise_exception_on_partial_issuer_match(self, jwt):\n+        issuer = \"urn:expected\"\n+\n+        payload = {\"iss\": \"urn:\"}\n+\n+        token = jwt.encode(payload, \"secret\")\n+\n+        with pytest.raises(InvalidIssuerError):\n+            jwt.decode(token, \"secret\", issuer=issuer, algorithms=[\"HS256\"])\n+        \n     def test_raise_exception_token_without_audience(self, jwt):\n         payload = {\"some\": \"payload\"}\n         token = jwt.encode(payload, \"secret\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/commits/c52714b85e6725b1b24516fbdedacb333b939152",
        "url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/commits/c52714b85e6725b1b24516fbdedacb333b939152",
        "html_url": "https://github.com/python-jsonschema/check-jsonschema/commit/c52714b85e6725b1b24516fbdedacb333b939152",
        "message": "Merge pull request #503 from python-jsonschema/fix-caching\n\nFix caching behavior to always use hashed URLs for the cache filenames",
        "files": [
            {
                "sha": "56a5bb12a209f13c1a25fcadd9e24c63f23c03cc",
                "filename": "docs/usage.rst",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/docs%2Fusage.rst",
                "raw_url": "https://github.com/python-jsonschema/check-jsonschema/raw/c52714b85e6725b1b24516fbdedacb333b939152/docs%2Fusage.rst",
                "contents_url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/contents/docs%2Fusage.rst?ref=c52714b85e6725b1b24516fbdedacb333b939152",
                "patch": "@@ -118,6 +118,10 @@ Downloading and Caching\n By default, when ``--schemafile`` is used to refer to an ``http://`` or\n ``https://`` location, the schema is downloaded and cached based on the\n schema's Last-Modified time.\n+\n+Additionally, when ``$ref``\\s are looked up during schema resolution, they are\n+similarly cached.\n+\n The following options control caching behaviors.\n \n .. list-table:: Caching Options\n@@ -128,9 +132,6 @@ The following options control caching behaviors.\n      - Description\n    * - ``--no-cache``\n      - Disable caching.\n-   * - ``--cache-filename``\n-     - The name to use for caching a remote schema.\n-       Defaults to using the last slash-delimited part of the URI.\n \n \"format\" Validation Options\n ---------------------------"
            },
            {
                "sha": "41cf2aae3e05a4b7681853018d4b5b504d163a6c",
                "filename": "src/check_jsonschema/cachedownloader.py",
                "status": "modified",
                "additions": 26,
                "deletions": 11,
                "changes": 37,
                "blob_url": "https://github.com/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fcachedownloader.py",
                "raw_url": "https://github.com/python-jsonschema/check-jsonschema/raw/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fcachedownloader.py",
                "contents_url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/contents/src%2Fcheck_jsonschema%2Fcachedownloader.py?ref=c52714b85e6725b1b24516fbdedacb333b939152",
                "patch": "@@ -1,6 +1,7 @@\n from __future__ import annotations\n \n import contextlib\n+import hashlib\n import io\n import os\n import platform\n@@ -33,7 +34,7 @@ def _base_cache_dir() -> str | None:\n     return cache_dir\n \n \n-def _resolve_cache_dir(dirname: str = \"downloads\") -> str | None:\n+def _resolve_cache_dir(dirname: str) -> str | None:\n     cache_dir = _base_cache_dir()\n     if cache_dir:\n         cache_dir = os.path.join(cache_dir, \"check_jsonschema\", dirname)\n@@ -95,18 +96,32 @@ def _cache_hit(cachefile: str, response: requests.Response) -> bool:\n     return local_mtime >= remote_mtime\n \n \n+def url_to_cache_filename(ref_url: str) -> str:\n+    \"\"\"\n+    Given a schema URL, convert it to a filename for caching in a cache dir.\n+\n+    Rules are as follows:\n+    - the base filename is an sha256 hash of the URL\n+    - if the filename ends in an extension (.json, .yaml, etc) that extension\n+      is appended to the hash\n+\n+    Preserving file extensions preserves the extension-based logic used for parsing, and\n+    it also helps a local editor (browsing the cache) identify filetypes.\n+    \"\"\"\n+    filename = hashlib.sha256(ref_url.encode()).hexdigest()\n+    if \".\" in (last_part := ref_url.rpartition(\"/\")[-1]):\n+        _, _, extension = last_part.rpartition(\".\")\n+        filename = f\"{filename}.{extension}\"\n+    return filename\n+\n+\n class FailedDownloadError(Exception):\n     pass\n \n \n class CacheDownloader:\n-    def __init__(\n-        self, cache_dir: str | None = None, disable_cache: bool = False\n-    ) -> None:\n-        if cache_dir is None:\n-            self._cache_dir = _resolve_cache_dir()\n-        else:\n-            self._cache_dir = _resolve_cache_dir(cache_dir)\n+    def __init__(self, cache_dir: str, *, disable_cache: bool = False) -> None:\n+        self._cache_dir = _resolve_cache_dir(cache_dir)\n         self._disable_cache = disable_cache\n \n     def _download(\n@@ -160,21 +175,21 @@ def bind(\n         validation_callback: t.Callable[[bytes], t.Any] | None = None,\n     ) -> BoundCacheDownloader:\n         return BoundCacheDownloader(\n-            file_url, filename, self, validation_callback=validation_callback\n+            file_url, self, filename=filename, validation_callback=validation_callback\n         )\n \n \n class BoundCacheDownloader:\n     def __init__(\n         self,\n         file_url: str,\n-        filename: str | None,\n         downloader: CacheDownloader,\n         *,\n+        filename: str | None = None,\n         validation_callback: t.Callable[[bytes], t.Any] | None = None,\n     ) -> None:\n         self._file_url = file_url\n-        self._filename = filename or file_url.split(\"/\")[-1]\n+        self._filename = filename or url_to_cache_filename(file_url)\n         self._downloader = downloader\n         self._validation_callback = validation_callback\n "
            },
            {
                "sha": "3a7aae643a737a3f50837ecc3658eb0431004715",
                "filename": "src/check_jsonschema/cli/main_command.py",
                "status": "modified",
                "additions": 1,
                "deletions": 8,
                "changes": 9,
                "blob_url": "https://github.com/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fcli%2Fmain_command.py",
                "raw_url": "https://github.com/python-jsonschema/check-jsonschema/raw/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fcli%2Fmain_command.py",
                "contents_url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/contents/src%2Fcheck_jsonschema%2Fcli%2Fmain_command.py?ref=c52714b85e6725b1b24516fbdedacb333b939152",
                "patch": "@@ -130,11 +130,7 @@ def pretty_helptext_list(values: list[str] | tuple[str, ...]) -> str:\n     help=\"Disable schema caching. Always download remote schemas.\",\n )\n @click.option(\n-    \"--cache-filename\",\n-    help=(\n-        \"The name to use for caching a remote schema. \"\n-        \"Defaults to the last slash-delimited part of the URI.\"\n-    ),\n+    \"--cache-filename\", help=\"Deprecated. This option no longer has any effect.\"\n )\n @click.option(\n     \"--disable-formats\",\n@@ -271,8 +267,6 @@ def main(\n     args.disable_cache = no_cache\n     args.default_filetype = default_filetype\n     args.fill_defaults = fill_defaults\n-    if cache_filename is not None:\n-        args.cache_filename = cache_filename\n     if data_transform is not None:\n         args.data_transform = TRANSFORM_LIBRARY[data_transform]\n \n@@ -300,7 +294,6 @@ def build_schema_loader(args: ParseResult) -> SchemaLoaderBase:\n         assert args.schema_path is not None\n         return SchemaLoader(\n             args.schema_path,\n-            cache_filename=args.cache_filename,\n             disable_cache=args.disable_cache,\n             base_uri=args.base_uri,\n             validator_class=args.validator_class,"
            },
            {
                "sha": "09910745586bc6f05fd0e28c2a17f6c2827e05b4",
                "filename": "src/check_jsonschema/schema_loader/main.py",
                "status": "modified",
                "additions": 1,
                "deletions": 7,
                "changes": 8,
                "blob_url": "https://github.com/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fschema_loader%2Fmain.py",
                "raw_url": "https://github.com/python-jsonschema/check-jsonschema/raw/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fschema_loader%2Fmain.py",
                "contents_url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/contents/src%2Fcheck_jsonschema%2Fschema_loader%2Fmain.py?ref=c52714b85e6725b1b24516fbdedacb333b939152",
                "patch": "@@ -64,14 +64,12 @@ def __init__(\n         self,\n         schemafile: str,\n         *,\n-        cache_filename: str | None = None,\n         base_uri: str | None = None,\n         validator_class: type[jsonschema.protocols.Validator] | None = None,\n         disable_cache: bool = True,\n     ) -> None:\n         # record input parameters (these are not to be modified)\n         self.schemafile = schemafile\n-        self.cache_filename = cache_filename\n         self.disable_cache = disable_cache\n         self.base_uri = base_uri\n         self.validator_class = validator_class\n@@ -105,11 +103,7 @@ def _get_schema_reader(\n             return LocalSchemaReader(self.schemafile)\n \n         if self.url_info.scheme in (\"http\", \"https\"):\n-            return HttpSchemaReader(\n-                self.schemafile,\n-                self.cache_filename,\n-                self.disable_cache,\n-            )\n+            return HttpSchemaReader(self.schemafile, self.disable_cache)\n         else:\n             raise UnsupportedUrlScheme(\n                 \"check-jsonschema only supports http, https, and local files. \""
            },
            {
                "sha": "61299350a34d18f87eec56c743e786bca319d6f6",
                "filename": "src/check_jsonschema/schema_loader/readers.py",
                "status": "modified",
                "additions": 3,
                "deletions": 4,
                "changes": 7,
                "blob_url": "https://github.com/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fschema_loader%2Freaders.py",
                "raw_url": "https://github.com/python-jsonschema/check-jsonschema/raw/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fschema_loader%2Freaders.py",
                "contents_url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/contents/src%2Fcheck_jsonschema%2Fschema_loader%2Freaders.py?ref=c52714b85e6725b1b24516fbdedacb333b939152",
                "patch": "@@ -73,14 +73,13 @@ class HttpSchemaReader:\n     def __init__(\n         self,\n         url: str,\n-        cache_filename: str | None,\n         disable_cache: bool,\n     ) -> None:\n         self.url = url\n         self.parsers = ParserSet()\n-        self.downloader = CacheDownloader(\n-            disable_cache=disable_cache,\n-        ).bind(url, cache_filename, validation_callback=self._parse)\n+        self.downloader = CacheDownloader(\"schemas\", disable_cache=disable_cache).bind(\n+            url, validation_callback=self._parse\n+        )\n         self._parsed_schema: dict | _UnsetType = _UNSET\n \n     def _parse(self, schema_bytes: bytes) -> t.Any:"
            },
            {
                "sha": "15344d6bdb3fc4a36e8c7fdae139c23b3d3d624a",
                "filename": "src/check_jsonschema/schema_loader/resolver.py",
                "status": "modified",
                "additions": 2,
                "deletions": 20,
                "changes": 22,
                "blob_url": "https://github.com/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fschema_loader%2Fresolver.py",
                "raw_url": "https://github.com/python-jsonschema/check-jsonschema/raw/c52714b85e6725b1b24516fbdedacb333b939152/src%2Fcheck_jsonschema%2Fschema_loader%2Fresolver.py",
                "contents_url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/contents/src%2Fcheck_jsonschema%2Fschema_loader%2Fresolver.py?ref=c52714b85e6725b1b24516fbdedacb333b939152",
                "patch": "@@ -1,6 +1,5 @@\n from __future__ import annotations\n \n-import hashlib\n import typing as t\n import urllib.parse\n \n@@ -12,21 +11,6 @@\n from ..utils import filename2path\n \n \n-def ref_url_to_cache_filename(ref_url: str) -> str:\n-    \"\"\"\n-    Given a $ref URL, convert it to the filename in the refs/ cache dir.\n-    Rules are as follows:\n-    - the base filename is an md5 hash of the URL\n-    - if the filename ends in an extension (.json, .yaml, etc) that extension\n-      is appended to the hash\n-    \"\"\"\n-    filename = hashlib.md5(ref_url.encode()).hexdigest()\n-    if \".\" in (last_part := ref_url.rpartition(\"/\")[-1]):\n-        _, _, extension = last_part.rpartition(\".\")\n-        filename = f\"{filename}.{extension}\"\n-    return filename\n-\n-\n def make_reference_registry(\n     parsers: ParserSet, retrieval_uri: str | None, schema: dict, disable_cache: bool\n ) -> referencing.Registry:\n@@ -66,7 +50,7 @@ def create_retrieve_callable(\n         base_uri = retrieval_uri\n \n     cache = ResourceCache()\n-    downloader = CacheDownloader(\"refs\", disable_cache)\n+    downloader = CacheDownloader(\"refs\", disable_cache=disable_cache)\n \n     def get_local_file(uri: str) -> t.Any:\n         path = filename2path(uri)\n@@ -89,9 +73,7 @@ def validation_callback(content: bytes) -> None:\n                 parser_set.parse_data_with_path(content, full_uri, \"json\")\n \n             bound_downloader = downloader.bind(\n-                full_uri,\n-                ref_url_to_cache_filename(full_uri),\n-                validation_callback,\n+                full_uri, validation_callback=validation_callback\n             )\n             with bound_downloader.open() as fp:\n                 data = fp.read()"
            },
            {
                "sha": "b0022a8d3587cba69c38aef09a3311fbb3373c24",
                "filename": "tests/conftest.py",
                "status": "modified",
                "additions": 16,
                "deletions": 8,
                "changes": 24,
                "blob_url": "https://github.com/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/tests%2Fconftest.py",
                "raw_url": "https://github.com/python-jsonschema/check-jsonschema/raw/c52714b85e6725b1b24516fbdedacb333b939152/tests%2Fconftest.py",
                "contents_url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/contents/tests%2Fconftest.py?ref=c52714b85e6725b1b24516fbdedacb333b939152",
                "patch": "@@ -62,15 +62,25 @@ def patch_cache_dir(monkeypatch, cache_dir):\n         yield m\n \n \n+@pytest.fixture\n+def url2cachepath():\n+    from check_jsonschema.cachedownloader import url_to_cache_filename\n+\n+    def _get(cache_dir, url):\n+        return cache_dir / url_to_cache_filename(url)\n+\n+    return _get\n+\n+\n @pytest.fixture\n def downloads_cache_dir(tmp_path):\n     return tmp_path / \".cache\" / \"check_jsonschema\" / \"downloads\"\n \n \n @pytest.fixture\n-def get_download_cache_loc(downloads_cache_dir):\n-    def _get(uri):\n-        return downloads_cache_dir / uri.split(\"/\")[-1]\n+def get_download_cache_loc(downloads_cache_dir, url2cachepath):\n+    def _get(url):\n+        return url2cachepath(downloads_cache_dir, url)\n \n     return _get\n \n@@ -94,11 +104,9 @@ def refs_cache_dir(tmp_path):\n \n \n @pytest.fixture\n-def get_ref_cache_loc(refs_cache_dir):\n-    from check_jsonschema.schema_loader.resolver import ref_url_to_cache_filename\n-\n-    def _get(uri):\n-        return refs_cache_dir / ref_url_to_cache_filename(uri)\n+def get_ref_cache_loc(refs_cache_dir, url2cachepath):\n+    def _get(url):\n+        return url2cachepath(refs_cache_dir, url)\n \n     return _get\n "
            },
            {
                "sha": "1a0949aed71be84bdb3b34258a76f3611367b563",
                "filename": "tests/unit/test_cachedownloader.py",
                "status": "modified",
                "additions": 48,
                "deletions": 43,
                "changes": 91,
                "blob_url": "https://github.com/python-jsonschema/check-jsonschema/blob/c52714b85e6725b1b24516fbdedacb333b939152/tests%2Funit%2Ftest_cachedownloader.py",
                "raw_url": "https://github.com/python-jsonschema/check-jsonschema/raw/c52714b85e6725b1b24516fbdedacb333b939152/tests%2Funit%2Ftest_cachedownloader.py",
                "contents_url": "https://api.github.com/repos/python-jsonschema/check-jsonschema/contents/tests%2Funit%2Ftest_cachedownloader.py?ref=c52714b85e6725b1b24516fbdedacb333b939152",
                "patch": "@@ -11,13 +11,16 @@\n     CacheDownloader,\n     FailedDownloadError,\n     _cache_hit,\n+    url_to_cache_filename,\n )\n \n+DEFAULT_RESPONSE_URL = \"https://example.com/schema1.json\"\n+\n \n def add_default_response():\n     responses.add(\n         \"GET\",\n-        \"https://example.com/schema1.json\",\n+        DEFAULT_RESPONSE_URL,\n         headers={\"Last-Modified\": \"Sun, 01 Jan 2000 00:00:01 GMT\"},\n         json={},\n         match_querystring=None,\n@@ -30,8 +33,8 @@ def default_response():\n \n \n def test_default_filename_from_uri(default_response):\n-    cd = CacheDownloader().bind(\"https://example.com/schema1.json\")\n-    assert cd._filename == \"schema1.json\"\n+    cd = CacheDownloader(\"downloads\").bind(DEFAULT_RESPONSE_URL)\n+    assert cd._filename == url_to_cache_filename(DEFAULT_RESPONSE_URL)\n \n \n @pytest.mark.parametrize(\n@@ -76,7 +79,7 @@ def fake_expanduser(path):\n     monkeypatch.setattr(platform, \"system\", fakesystem)\n     monkeypatch.setattr(os.path, \"expanduser\", fake_expanduser)\n \n-    cd = CacheDownloader()\n+    cd = CacheDownloader(\"downloads\")\n     assert cd._cache_dir == expect_value\n \n     if sysname == \"Darwin\":\n@@ -94,15 +97,15 @@ def test_cache_hit_by_mtime(monkeypatch, default_response):\n     monkeypatch.setattr(os.path, \"getmtime\", lambda x: time.time())\n     assert _cache_hit(\n         \"/tmp/schema1.json\",\n-        requests.get(\"https://example.com/schema1.json\", stream=True),\n+        requests.get(DEFAULT_RESPONSE_URL, stream=True),\n     )\n \n     # local mtime = 0, cache miss\n     monkeypatch.setattr(os.path, \"getmtime\", lambda x: 0)\n     assert (\n         _cache_hit(\n             \"/tmp/schema1.json\",\n-            requests.get(\"https://example.com/schema1.json\", stream=True),\n+            requests.get(DEFAULT_RESPONSE_URL, stream=True),\n         )\n         is False\n     )\n@@ -114,7 +117,7 @@ def test_cachedownloader_cached_file(tmp_path, monkeypatch, default_response):\n     f.write_text(\"{}\")\n \n     # set the cache_dir to the tmp dir (so that cache_dir will always be set)\n-    cd = CacheDownloader(cache_dir=tmp_path).bind(str(f))\n+    cd = CacheDownloader(tmp_path).bind(str(f), filename=\"foo.json\")\n     # patch the downloader to skip any download \"work\"\n     monkeypatch.setattr(\n         cd._downloader, \"_download\", lambda file_uri, filename, response_ok: str(f)\n@@ -125,11 +128,12 @@ def test_cachedownloader_cached_file(tmp_path, monkeypatch, default_response):\n \n \n @pytest.mark.parametrize(\"disable_cache\", (True, False))\n-def test_cachedownloader_on_success(get_download_cache_loc, disable_cache):\n-    add_default_response()\n-    f = get_download_cache_loc(\"schema1.json\")\n-    cd = CacheDownloader(disable_cache=disable_cache).bind(\n-        \"https://example.com/schema1.json\"\n+def test_cachedownloader_on_success(\n+    get_download_cache_loc, disable_cache, default_response\n+):\n+    f = get_download_cache_loc(DEFAULT_RESPONSE_URL)\n+    cd = CacheDownloader(\"downloads\", disable_cache=disable_cache).bind(\n+        DEFAULT_RESPONSE_URL\n     )\n \n     with cd.open() as fp:\n@@ -140,10 +144,12 @@ def test_cachedownloader_on_success(get_download_cache_loc, disable_cache):\n         assert f.exists()\n \n \n-def test_cachedownloader_using_alternate_target_dir(cache_dir):\n-    add_default_response()\n-    f = cache_dir / \"check_jsonschema\" / \"otherdir\" / \"schema1.json\"\n-    cd = CacheDownloader(\"otherdir\").bind(\"https://example.com/schema1.json\")\n+def test_cachedownloader_using_alternate_target_dir(\n+    cache_dir, default_response, url2cachepath\n+):\n+    cache_dir = cache_dir / \"check_jsonschema\" / \"otherdir\"\n+    f = url2cachepath(cache_dir, DEFAULT_RESPONSE_URL)\n+    cd = CacheDownloader(\"otherdir\").bind(DEFAULT_RESPONSE_URL)\n     with cd.open() as fp:\n         assert fp.read() == b\"{}\"\n     assert f.exists()\n@@ -158,21 +164,21 @@ def test_cachedownloader_succeeds_after_few_errors(\n         for _i in range(failures):\n             responses.add(\n                 \"GET\",\n-                \"https://example.com/schema1.json\",\n+                DEFAULT_RESPONSE_URL,\n                 status=500,\n                 match_querystring=None,\n             )\n     else:\n         responses.add(\n             \"GET\",\n-            \"https://example.com/schema1.json\",\n+            DEFAULT_RESPONSE_URL,\n             body=failures(),\n             match_querystring=None,\n         )\n     add_default_response()\n-    f = get_download_cache_loc(\"schema1.json\")\n-    cd = CacheDownloader(disable_cache=disable_cache).bind(\n-        \"https://example.com/schema1.json\"\n+    f = get_download_cache_loc(DEFAULT_RESPONSE_URL)\n+    cd = CacheDownloader(\"downloads\", disable_cache=disable_cache).bind(\n+        DEFAULT_RESPONSE_URL\n     )\n \n     with cd.open() as fp:\n@@ -192,21 +198,21 @@ def test_cachedownloader_fails_after_many_errors(\n         if connection_error:\n             responses.add(\n                 \"GET\",\n-                \"https://example.com/schema1.json\",\n+                DEFAULT_RESPONSE_URL,\n                 body=requests.ConnectionError(),\n                 match_querystring=None,\n             )\n         else:\n             responses.add(\n                 \"GET\",\n-                \"https://example.com/schema1.json\",\n+                DEFAULT_RESPONSE_URL,\n                 status=500,\n                 match_querystring=None,\n             )\n     add_default_response()  # never reached, the 11th response\n-    f = get_download_cache_loc(\"schema1.json\")\n-    cd = CacheDownloader(disable_cache=disable_cache).bind(\n-        \"https://example.com/schema1.json\"\n+    f = get_download_cache_loc(DEFAULT_RESPONSE_URL)\n+    cd = CacheDownloader(\"downloads\", disable_cache=disable_cache).bind(\n+        DEFAULT_RESPONSE_URL\n     )\n     with pytest.raises(FailedDownloadError):\n         with cd.open():\n@@ -218,18 +224,18 @@ def test_cachedownloader_fails_after_many_errors(\n def test_cachedownloader_retries_on_bad_data(get_download_cache_loc, disable_cache):\n     responses.add(\n         \"GET\",\n-        \"https://example.com/schema1.json\",\n+        DEFAULT_RESPONSE_URL,\n         status=200,\n         body=\"{\",\n         match_querystring=None,\n     )\n     add_default_response()\n-    f = get_download_cache_loc(\"schema1.json\")\n+    f = get_download_cache_loc(DEFAULT_RESPONSE_URL)\n     cd = CacheDownloader(\n+        \"downloads\",\n         disable_cache=disable_cache,\n     ).bind(\n-        \"https://example.com/schema1.json\",\n-        filename=str(f),\n+        DEFAULT_RESPONSE_URL,\n         validation_callback=json.loads,\n     )\n \n@@ -253,13 +259,14 @@ def test_cachedownloader_handles_bad_lastmod_header(\n     file_exists,\n     failure_mode,\n ):\n-    uri = \"https://example.com/schema1.json\"\n     if failure_mode == \"header_missing\":\n-        responses.add(\"GET\", uri, headers={}, json={}, match_querystring=None)\n+        responses.add(\n+            \"GET\", DEFAULT_RESPONSE_URL, headers={}, json={}, match_querystring=None\n+        )\n     elif failure_mode == \"header_malformed\":\n         responses.add(\n             \"GET\",\n-            uri,\n+            DEFAULT_RESPONSE_URL,\n             headers={\"Last-Modified\": \"Jan 2000 00:00:01\"},\n             json={},\n             match_querystring=None,\n@@ -275,13 +282,13 @@ def fake_mktime(*args):\n         raise NotImplementedError\n \n     original_file_contents = b'{\"foo\": \"bar\"}'\n-    file_path = get_download_cache_loc(uri)\n+    file_path = get_download_cache_loc(DEFAULT_RESPONSE_URL)\n \n     assert not file_path.exists()\n     if file_exists:\n-        inject_cached_download(uri, original_file_contents)\n+        inject_cached_download(DEFAULT_RESPONSE_URL, original_file_contents)\n \n-    cd = CacheDownloader().bind(uri)\n+    cd = CacheDownloader(\"downloads\").bind(DEFAULT_RESPONSE_URL)\n \n     # if the file already existed, it will not be overwritten by the cachedownloader\n     # so the returned value for both the downloader and a direct file read should be the\n@@ -302,20 +309,18 @@ def fake_mktime(*args):\n \n \n def test_cachedownloader_validation_is_not_invoked_on_hit(\n-    monkeypatch, inject_cached_download\n+    monkeypatch, default_response, inject_cached_download\n ):\n     \"\"\"\n     Regression test for https://github.com/python-jsonschema/check-jsonschema/issues/453\n \n     This was a bug in which the validation callback was invoked eagerly, even on a cache\n     hit. As a result, cache hits did not demonstrate their expected performance gain.\n     \"\"\"\n-    uri = \"https://example.com/schema1.json\"\n-\n     # 1: construct some perfectly good data (it doesn't really matter what it is)\n-    add_default_response()\n+    #    <<default_response fixture>>\n     # 2: put equivalent data on disk\n-    inject_cached_download(uri, \"{}\")\n+    inject_cached_download(DEFAULT_RESPONSE_URL, \"{}\")\n \n     # 3: construct a validator which marks that it ran in a variable\n     validator_ran = False\n@@ -326,8 +331,8 @@ def dummy_validate_bytes(data):\n \n     # construct a downloader pointed at the schema and file, expecting a cache hit\n     # and use the above validation method\n-    cd = CacheDownloader().bind(\n-        \"https://example.com/schema1.json\",\n+    cd = CacheDownloader(\"downloads\").bind(\n+        DEFAULT_RESPONSE_URL,\n         validation_callback=dummy_validate_bytes,\n     )\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/intlify/vue-i18n/commits/9f20909ef8c9232a1072d7818e12ed6d6451024d",
        "url": "https://api.github.com/repos/intlify/vue-i18n/commits/9f20909ef8c9232a1072d7818e12ed6d6451024d",
        "html_url": "https://github.com/intlify/vue-i18n/commit/9f20909ef8c9232a1072d7818e12ed6d6451024d",
        "message": "Merge commit from fork\n\n* fix: XSS vulnerability with prototype pollution on AST\n\n* test: add e2e test for scurity fix\n\n* fix: prototype pollusion on deepCopy\n\n* fix: update e2e\n\n* fix: filename\n\n* fix: change type name\n\n* fix: more test case\n\n* fix: change to `Object.create(null)` from object literal for more safety",
        "files": [
            {
                "sha": "b7594c94cf926cf9618e55d47abd0c89e7e67f4b",
                "filename": "packages/core-base/src/compilation.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fcompilation.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fcompilation.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fcompilation.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -4,6 +4,7 @@ import {\n   detectHtmlTag\n } from '@intlify/message-compiler'\n import {\n+  create,\n   format,\n   hasOwn,\n   isBoolean,\n@@ -32,10 +33,10 @@ function checkHtmlMessage(source: string, warnHtmlMessage?: boolean): void {\n }\n \n const defaultOnCacheKey = (message: string): string => message\n-let compileCache: unknown = Object.create(null)\n+let compileCache: unknown = create()\n \n export function clearCompileCache(): void {\n-  compileCache = Object.create(null)\n+  compileCache = create()\n }\n \n export function isMessageAST(val: unknown): val is ResourceNode {"
            },
            {
                "sha": "dcfe923f3d5d4b2041e2a5bdc16c752187f1e1f4",
                "filename": "packages/core-base/src/context.ts",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fcontext.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fcontext.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fcontext.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -2,6 +2,7 @@\n \n import {\n   assign,\n+  create,\n   isArray,\n   isBoolean,\n   isFunction,\n@@ -507,23 +508,23 @@ export function createCoreContext<Message = string>(options: any = {}): any {\n       : _locale\n   const messages = isPlainObject(options.messages)\n     ? options.messages\n-    : { [_locale]: {} }\n+    : createResources(_locale)\n   const datetimeFormats = !__LITE__\n     ? isPlainObject(options.datetimeFormats)\n       ? options.datetimeFormats\n-      : { [_locale]: {} }\n-    : { [_locale]: {} }\n+      : createResources(_locale)\n+    : createResources(_locale)\n   const numberFormats = !__LITE__\n     ? isPlainObject(options.numberFormats)\n       ? options.numberFormats\n-      : { [_locale]: {} }\n-    : { [_locale]: {} }\n+      : createResources(_locale)\n+    : createResources(_locale)\n   const modifiers = assign(\n-    {},\n-    options.modifiers || {},\n+    create(),\n+    options.modifiers,\n     getDefaultLinkedModifiers<Message>()\n   )\n-  const pluralRules = options.pluralRules || {}\n+  const pluralRules = options.pluralRules || create()\n   const missing = isFunction(options.missing) ? options.missing : null\n   const missingWarn =\n     isBoolean(options.missingWarn) || isRegExp(options.missingWarn)\n@@ -628,6 +629,8 @@ export function createCoreContext<Message = string>(options: any = {}): any {\n   return context\n }\n \n+const createResources = (locale: Locale) => ({ [locale]: create() })\n+\n /** @internal */\n export function isTranslateFallbackWarn(\n   fallback: boolean | RegExp,"
            },
            {
                "sha": "9bd98f4c469f48b2ca3f19ff8552a23f123ee21c",
                "filename": "packages/core-base/src/datetime.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fdatetime.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fdatetime.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fdatetime.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,6 @@\n import {\n   assign,\n+  create,\n   isBoolean,\n   isDate,\n   isEmptyObject,\n@@ -322,8 +323,8 @@ export function parseDateTimeArgs(\n   ...args: unknown[]\n ): [string, number | Date, DateTimeOptions, Intl.DateTimeFormatOptions] {\n   const [arg1, arg2, arg3, arg4] = args\n-  const options = {} as DateTimeOptions\n-  let overrides = {} as Intl.DateTimeFormatOptions\n+  const options = create() as DateTimeOptions\n+  let overrides = create() as Intl.DateTimeFormatOptions\n \n   let value: number | Date\n   if (isString(arg1)) {"
            },
            {
                "sha": "fb70d60b848804a1bbb3387211f95ee845687924",
                "filename": "packages/core-base/src/number.ts",
                "status": "modified",
                "additions": 15,
                "deletions": 14,
                "changes": 29,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fnumber.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fnumber.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fnumber.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,31 +1,32 @@\n import {\n-  isString,\n+  assign,\n+  create,\n   isBoolean,\n-  isPlainObject,\n-  isNumber,\n   isEmptyObject,\n-  assign\n+  isNumber,\n+  isPlainObject,\n+  isString\n } from '@intlify/shared'\n import {\n   handleMissing,\n   isTranslateFallbackWarn,\n-  NOT_REOSLVED,\n-  MISSING_RESOLVE_VALUE\n+  MISSING_RESOLVE_VALUE,\n+  NOT_REOSLVED\n } from './context'\n-import { CoreWarnCodes, getWarnMessage } from './warnings'\n import { CoreErrorCodes, createCoreError } from './errors'\n-import { Availabilities } from './intl'\n import { getLocale } from './fallbacker'\n+import { Availabilities } from './intl'\n+import { CoreWarnCodes, getWarnMessage } from './warnings'\n \n-import type { Locale, FallbackLocale } from './runtime'\n+import type { CoreContext, CoreInternalContext } from './context'\n+import type { LocaleOptions } from './fallbacker'\n+import type { FallbackLocale, Locale } from './runtime'\n import type {\n   NumberFormat,\n-  NumberFormats as NumberFormatsType,\n   NumberFormatOptions,\n+  NumberFormats as NumberFormatsType,\n   PickupFormatKeys\n } from './types'\n-import type { LocaleOptions } from './fallbacker'\n-import type { CoreContext, CoreInternalContext } from './context'\n \n /**\n  *  # number\n@@ -317,8 +318,8 @@ export function parseNumberArgs(\n   ...args: unknown[]\n ): [string, number, NumberOptions, Intl.NumberFormatOptions] {\n   const [arg1, arg2, arg3, arg4] = args\n-  const options = {} as NumberOptions\n-  let overrides = {} as Intl.NumberFormatOptions\n+  const options = create() as NumberOptions\n+  let overrides = create() as Intl.NumberFormatOptions\n \n   if (!isNumber(arg1)) {\n     throw createCoreError(CoreErrorCodes.INVALID_ARGUMENT)"
            },
            {
                "sha": "47a2c93a6c334cffde0bb4faf9b34cab35440ba3",
                "filename": "packages/core-base/src/runtime.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fruntime.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fruntime.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fruntime.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,6 +1,7 @@\n import { HelperNameMap } from '@intlify/message-compiler'\n import {\n   assign,\n+  create,\n   isArray,\n   isFunction,\n   isNumber,\n@@ -360,7 +361,7 @@ export function createMessageContext<T = string, N = {}>(\n   const list = (index: number): unknown => _list[index]\n \n   // eslint-disable-next-line @typescript-eslint/no-explicit-any\n-  const _named = options.named || ({} as any)\n+  const _named = options.named || (create() as any)\n \n   isNumber(options.pluralIndex) && normalizeNamed(pluralIndex, _named)\n   const named = (key: string): unknown => _named[key]\n@@ -437,7 +438,7 @@ export function createMessageContext<T = string, N = {}>(\n     [HelperNameMap.TYPE]: type,\n     [HelperNameMap.INTERPOLATE]: interpolate,\n     [HelperNameMap.NORMALIZE]: normalize,\n-    [HelperNameMap.VALUES]: assign({}, _list, _named)\n+    [HelperNameMap.VALUES]: assign(create(), _list, _named)\n   }\n \n   return ctx"
            },
            {
                "sha": "4880d10b9289a0b6888746491007469437f95a69",
                "filename": "packages/core-base/src/translate.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Ftranslate.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Ftranslate.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Ftranslate.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,6 @@\n import {\n   assign,\n+  create,\n   escapeHtml,\n   generateCodeFrame,\n   generateFormatCacheKey,\n@@ -677,7 +678,7 @@ export function translate<\n     : [\n         key,\n         locale,\n-        (messages as unknown as LocaleMessages<Message>)[locale] || {}\n+        (messages as unknown as LocaleMessages<Message>)[locale] || create()\n       ]\n   // NOTE:\n   //  Fix to work around `ssrTransfrom` bug in Vite.\n@@ -830,7 +831,7 @@ function resolveMessageFormat<Messages, Message>(\n   } = context\n   const locales = localeFallbacker(context as any, fallbackLocale, locale) // eslint-disable-line @typescript-eslint/no-explicit-any\n \n-  let message: LocaleMessageValue<Message> = {}\n+  let message: LocaleMessageValue<Message> = create()\n   let targetLocale: Locale | undefined\n   let format: PathValue = null\n   let from: Locale = locale\n@@ -869,7 +870,7 @@ function resolveMessageFormat<Messages, Message>(\n     }\n \n     message =\n-      (messages as unknown as LocaleMessages<Message>)[targetLocale] || {}\n+      (messages as unknown as LocaleMessages<Message>)[targetLocale] || create()\n \n     // for vue-devtools timeline event\n     let start: number | null = null\n@@ -1044,7 +1045,7 @@ export function parseTranslateArgs<Message = string>(\n   ...args: unknown[]\n ): [Path | MessageFunction<Message> | ResourceNode, TranslateOptions] {\n   const [arg1, arg2, arg3] = args\n-  const options = {} as TranslateOptions\n+  const options = create() as TranslateOptions\n \n   if (\n     !isString(arg1) &&"
            },
            {
                "sha": "59128b94f701b1a1373456582ae5f0ea83484f43",
                "filename": "packages/message-compiler/src/tokenizer.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fmessage-compiler%2Fsrc%2Ftokenizer.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fmessage-compiler%2Fsrc%2Ftokenizer.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fmessage-compiler%2Fsrc%2Ftokenizer.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,10 +1,10 @@\n-import { createScanner, CHAR_SP as SPACE, CHAR_LF as NEW_LINE } from './scanner'\n+import { CompileErrorCodes, createCompileError } from './errors'\n import { createLocation, createPosition } from './location'\n-import { createCompileError, CompileErrorCodes } from './errors'\n+import { createScanner, CHAR_LF as NEW_LINE, CHAR_SP as SPACE } from './scanner'\n \n-import type { Scanner } from './scanner'\n-import type { SourceLocation, Position } from './location'\n+import type { Position, SourceLocation } from './location'\n import type { TokenizeOptions } from './options'\n+import type { Scanner } from './scanner'\n \n export const enum TokenTypes {\n   Text, // 0\n@@ -447,6 +447,7 @@ export function createTokenizer(\n   function readText(scnr: Scanner): string {\n     let buf = ''\n \n+     \n     while (true) {\n       const ch = scnr.currentChar()\n       if ("
            },
            {
                "sha": "43ef02502dcc431d2d0273b8633aa267d3c02c18",
                "filename": "packages/shared/src/messages.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Fsrc%2Fmessages.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Fsrc%2Fmessages.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fshared%2Fsrc%2Fmessages.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,4 +1,4 @@\n-import { isArray, isObject } from './utils'\n+import { create, isArray, isObject } from './utils'\n \n const isNotObjectOrIsArray = (val: unknown) => !isObject(val) || isArray(val)\n // eslint-disable-next-line @typescript-eslint/no-explicit-any\n@@ -14,10 +14,13 @@ export function deepCopy(src: any, des: any): void {\n \n     // using `Object.keys` which skips prototype properties\n     Object.keys(src).forEach(key => {\n+      if (key === '__proto__') {\n+        return\n+      }\n       // if src[key] is an object/array, set des[key]\n       // to empty object/array to prevent setting by reference\n       if (isObject(src[key]) && !isObject(des[key])) {\n-        des[key] = Array.isArray(src[key]) ? [] : {}\n+        des[key] = Array.isArray(src[key]) ? [] : create()\n       }\n \n       if (isNotObjectOrIsArray(des[key]) || isNotObjectOrIsArray(src[key])) {"
            },
            {
                "sha": "f967df0cf566e65ddbcb769a737c07dde1e12e85",
                "filename": "packages/shared/src/utils.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Fsrc%2Futils.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Fsrc%2Futils.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fshared%2Fsrc%2Futils.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -81,6 +81,9 @@ export const isEmptyObject = (val: unknown): val is boolean =>\n \n export const assign = Object.assign\n \n+const _create = Object.create\n+export const create = (obj: object | null = null): object => _create(obj)\n+\n let _globalThis: any\n export const getGlobalThis = (): any => {\n   // prettier-ignore\n@@ -95,7 +98,7 @@ export const getGlobalThis = (): any => {\n             ? window\n             : typeof global !== 'undefined'\n               ? global\n-              : {})\n+              : create())\n   )\n }\n "
            },
            {
                "sha": "cbec88395a81de71ac8349d74ad001a7aec86bdc",
                "filename": "packages/shared/test/messages.test.ts",
                "status": "modified",
                "additions": 31,
                "deletions": 0,
                "changes": 31,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Ftest%2Fmessages.test.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Ftest%2Fmessages.test.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fshared%2Ftest%2Fmessages.test.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -48,3 +48,34 @@ test('deepCopy merges without mutating src argument', () => {\n   // should not mutate source object\n   expect(msg1).toStrictEqual(copy1)\n })\n+\n+describe('CVE-2024-52810', () => {\n+  test('__proto__', () => {\n+    const source = '{ \"__proto__\": { \"pollutedKey\": 123 } }'\n+    const dest = {}\n+\n+    deepCopy(JSON.parse(source), dest)\n+    expect(dest).toEqual({})\n+    // @ts-ignore -- initialize polluted property\n+    expect(JSON.parse(JSON.stringify({}.__proto__))).toEqual({})\n+  })\n+\n+  test('nest __proto__', () => {\n+    const source = '{ \"foo\": { \"__proto__\": { \"pollutedKey\": 123 } } }'\n+    const dest = {}\n+\n+    deepCopy(JSON.parse(source), dest)\n+    expect(dest).toEqual({ foo: {} })\n+    // @ts-ignore -- initialize polluted property\n+    expect(JSON.parse(JSON.stringify({}.__proto__))).toEqual({})\n+  })\n+\n+  test('constructor prototype', () => {\n+    const source = '{ \"constructor\": { \"prototype\": { \"polluted\": 1 } } }'\n+    const dest = {}\n+\n+    deepCopy(JSON.parse(source), dest)\n+    // @ts-ignore -- initialize polluted property\n+    expect({}.polluted).toBeUndefined()\n+  })\n+})"
            },
            {
                "sha": "04618565f1acd819fc23599ccbfb2536cf2d62d7",
                "filename": "packages/vue-i18n-core/src/components/DatetimeFormat.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FDatetimeFormat.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FDatetimeFormat.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FDatetimeFormat.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,16 +1,16 @@\n-import { defineComponent } from 'vue'\n-import { assign } from '@intlify/shared'\n import { DATETIME_FORMAT_OPTIONS_KEYS } from '@intlify/core-base'\n+import { assign } from '@intlify/shared'\n+import { defineComponent } from 'vue'\n import { useI18n } from '../i18n'\n import { DatetimePartsSymbol } from '../symbols'\n-import { renderFormatter } from './formatRenderer'\n import { baseFormatProps } from './base'\n+import { renderFormatter } from './formatRenderer'\n \n-import type { VNodeProps } from 'vue'\n import type { DateTimeOptions } from '@intlify/core-base'\n+import type { VNodeProps } from 'vue'\n import type { Composer, ComposerInternal } from '../composer'\n-import type { FormattableProps } from './formatRenderer'\n import type { BaseFormatProps } from './base'\n+import type { FormattableProps } from './formatRenderer'\n \n /**\n  * DatetimeFormat Component Props"
            },
            {
                "sha": "71d747ae62d75d12acd03adda6e038a8b4fa020c",
                "filename": "packages/vue-i18n-core/src/components/NumberFormat.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FNumberFormat.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FNumberFormat.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FNumberFormat.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,16 +1,16 @@\n-import { defineComponent } from 'vue'\n-import { assign } from '@intlify/shared'\n import { NUMBER_FORMAT_OPTIONS_KEYS } from '@intlify/core-base'\n+import { assign } from '@intlify/shared'\n+import { defineComponent } from 'vue'\n import { useI18n } from '../i18n'\n import { NumberPartsSymbol } from '../symbols'\n-import { renderFormatter } from './formatRenderer'\n import { baseFormatProps } from './base'\n+import { renderFormatter } from './formatRenderer'\n \n-import type { VNodeProps } from 'vue'\n import type { NumberOptions } from '@intlify/core-base'\n+import type { VNodeProps } from 'vue'\n import type { Composer, ComposerInternal } from '../composer'\n-import type { FormattableProps } from './formatRenderer'\n import type { BaseFormatProps } from './base'\n+import type { FormattableProps } from './formatRenderer'\n \n /**\n  * NumberFormat Component Props"
            },
            {
                "sha": "d91c7e85291a8336ebe964896916a5798935b25d",
                "filename": "packages/vue-i18n-core/src/components/Translation.ts",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FTranslation.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FTranslation.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FTranslation.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,12 +1,12 @@\n-import { h, defineComponent } from 'vue'\n-import { isNumber, isString, isObject, assign } from '@intlify/shared'\n-import { TranslateVNodeSymbol } from '../symbols'\n+import { assign, create, isNumber, isObject, isString } from '@intlify/shared'\n+import { defineComponent, h } from 'vue'\n import { useI18n } from '../i18n'\n+import { TranslateVNodeSymbol } from '../symbols'\n import { baseFormatProps } from './base'\n-import { getInterpolateArg, getFragmentableTag } from './utils'\n+import { getFragmentableTag, getInterpolateArg } from './utils'\n \n-import type { VNodeChild, VNodeProps } from 'vue'\n import type { TranslateOptions } from '@intlify/core-base'\n+import type { VNodeChild, VNodeProps } from 'vue'\n import type { Composer, ComposerInternal } from '../composer'\n import type { BaseFormatProps } from './base'\n \n@@ -59,7 +59,7 @@ export const TranslationImpl = /*#__PURE__*/ defineComponent({\n \n     return (): VNodeChild => {\n       const keys = Object.keys(slots).filter(key => key !== '_')\n-      const options = {} as TranslateOptions\n+      const options = create() as TranslateOptions\n       if (props.locale) {\n         options.locale = props.locale\n       }\n@@ -73,7 +73,7 @@ export const TranslationImpl = /*#__PURE__*/ defineComponent({\n         arg,\n         options\n       )\n-      const assignedAttrs = assign({}, attrs)\n+      const assignedAttrs = assign(create(), attrs)\n       const tag =\n         isString(props.tag) || isObject(props.tag)\n           ? props.tag"
            },
            {
                "sha": "40ed4c40f99b61b532a1a215137074be49d965fe",
                "filename": "packages/vue-i18n-core/src/components/base.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Fbase.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Fbase.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Fbase.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,7 +1,7 @@\n import { Composer } from '../composer'\n \n-import type { I18nScope } from '../i18n'\n import type { Locale } from '@intlify/core-base'\n+import type { I18nScope } from '../i18n'\n \n export type ComponentI18nScope = Exclude<I18nScope, 'local'>\n "
            },
            {
                "sha": "f23a7c11626c69d8811bf1391012fa8b72f8c3e0",
                "filename": "packages/vue-i18n-core/src/components/formatRenderer.ts",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FformatRenderer.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FformatRenderer.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FformatRenderer.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,15 +1,15 @@\n+import { assign, create, isArray, isObject, isString } from '@intlify/shared'\n import { h } from 'vue'\n import { getFragmentableTag } from './utils'\n-import { isString, isObject, isArray, assign } from '@intlify/shared'\n \n+import type { DateTimeOptions, NumberOptions } from '@intlify/core-base'\n import type {\n   RenderFunction,\n   SetupContext,\n   VNode,\n-  VNodeChild,\n-  VNodeArrayChildren\n+  VNodeArrayChildren,\n+  VNodeChild\n } from 'vue'\n-import type { NumberOptions, DateTimeOptions } from '@intlify/core-base'\n import type { BaseFormatProps } from './base'\n \n /**\n@@ -61,7 +61,7 @@ export function renderFormatter<\n \n   return (): VNodeChild => {\n     const options = { part: true } as Arg\n-    let overrides = {} as FormatOverrideOptions\n+    let overrides = create() as FormatOverrideOptions\n \n     if (props.locale) {\n       options.locale = props.locale\n@@ -78,9 +78,9 @@ export function renderFormatter<\n       // Filter out number format options only\n       overrides = Object.keys(props.format).reduce((options, prop) => {\n         return slotKeys.includes(prop)\n-          ? assign({}, options, { [prop]: (props.format as any)[prop] }) // eslint-disable-line @typescript-eslint/no-explicit-any\n+          ? assign(create(), options, { [prop]: (props.format as any)[prop] }) // eslint-disable-line @typescript-eslint/no-explicit-any\n           : options\n-      }, {})\n+      }, create())\n     }\n \n     const parts = partFormatter(...[props.value, options, overrides])\n@@ -100,7 +100,7 @@ export function renderFormatter<\n       children = [parts]\n     }\n \n-    const assignedAttrs = assign({}, attrs)\n+    const assignedAttrs = assign(create(), attrs)\n     const tag =\n       isString(props.tag) || isObject(props.tag)\n         ? props.tag"
            },
            {
                "sha": "824c7ca857c5b77c5a1979a44617a39181eaabdb",
                "filename": "packages/vue-i18n-core/src/components/index.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Findex.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Findex.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Findex.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,5 @@\n-export { ComponentI18nScope, BaseFormatProps } from './base'\n+export { BaseFormatProps, ComponentI18nScope } from './base'\n+export { DatetimeFormat, DatetimeFormatProps, I18nD } from './DatetimeFormat'\n export { FormattableProps } from './formatRenderer'\n-export { Translation, I18nT, TranslationProps } from './Translation'\n-export { NumberFormat, I18nN, NumberFormatProps } from './NumberFormat'\n-export { DatetimeFormat, I18nD, DatetimeFormatProps } from './DatetimeFormat'\n+export { I18nN, NumberFormat, NumberFormatProps } from './NumberFormat'\n+export { I18nT, Translation, TranslationProps } from './Translation'"
            },
            {
                "sha": "e9759492f2efbca9a86554cd265d5d703b63b3d6",
                "filename": "packages/vue-i18n-core/src/components/utils.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Futils.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Futils.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Futils.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,3 +1,4 @@\n+import { create } from '@intlify/shared'\n import { Fragment } from 'vue'\n \n import type { NamedValue } from '@intlify/core-base'\n@@ -27,7 +28,7 @@ export function getInterpolateArg(\n         arg[key] = slot()\n       }\n       return arg\n-    }, {} as NamedValue)\n+    }, create() as NamedValue)\n   }\n }\n "
            },
            {
                "sha": "9f2dd524b9bc8cc55c0c23c2e90f9d040d9764e5",
                "filename": "packages/vue-i18n-core/src/index.ts",
                "status": "modified",
                "additions": 83,
                "deletions": 83,
                "changes": 166,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Findex.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Findex.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Findex.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,120 +1,120 @@\n-import { getGlobalThis } from '@intlify/shared'\n import { setDevToolsHook } from '@intlify/core-base'\n+import { getGlobalThis } from '@intlify/shared'\n import { initDev, initFeatureFlags } from './misc'\n \n export {\n-  SchemaParams,\n-  LocaleParams,\n-  Path,\n-  PathValue,\n-  NamedValue,\n-  Locale,\n+  CompileError,\n+  DateTimeOptions,\n   FallbackLocale,\n-  LocaleMessageValue,\n-  LocaleMessageDictionary,\n-  LocaleMessageType,\n-  LocaleMessages,\n-  LocaleMessage,\n-  NumberFormat as IntlNumberFormat,\n   DateTimeFormat as IntlDateTimeFormat,\n   DateTimeFormats as IntlDateTimeFormats,\n-  NumberFormats as IntlNumberFormats,\n-  LocaleMatcher as IntlLocaleMatcher,\n   FormatMatcher as IntlFormatMatcher,\n-  MessageFunction,\n-  MessageFunctions,\n-  PluralizationRule,\n+  LocaleMatcher as IntlLocaleMatcher,\n+  NumberFormat as IntlNumberFormat,\n+  NumberFormats as IntlNumberFormats,\n   LinkedModifiers,\n-  TranslateOptions,\n-  DateTimeOptions,\n-  NumberOptions,\n-  PostTranslationHandler,\n-  MessageResolver,\n+  Locale,\n+  LocaleMessage,\n+  LocaleMessageDictionary,\n+  LocaleMessages,\n+  LocaleMessageType,\n+  LocaleMessageValue,\n+  LocaleParams,\n   MessageCompiler,\n   MessageCompilerContext,\n-  CompileError,\n   MessageContext,\n-  RemovedIndexResources\n+  MessageFunction,\n+  MessageFunctions,\n+  MessageResolver,\n+  NamedValue,\n+  NumberOptions,\n+  Path,\n+  PathValue,\n+  PluralizationRule,\n+  PostTranslationHandler,\n+  RemovedIndexResources,\n+  SchemaParams,\n+  TranslateOptions\n } from '@intlify/core-base'\n export {\n-  VueMessageType,\n-  DefineLocaleMessage,\n-  DefaultLocaleMessageSchema,\n-  DefineDateTimeFormat,\n-  DefaultDateTimeFormatSchema,\n-  DefineNumberFormat,\n-  DefaultNumberFormatSchema,\n-  MissingHandler,\n-  ComposerOptions,\n+  BaseFormatProps,\n+  ComponentI18nScope,\n+  DatetimeFormat,\n+  DatetimeFormatProps,\n+  FormattableProps,\n+  I18nD,\n+  I18nN,\n+  I18nT,\n+  NumberFormat,\n+  NumberFormatProps,\n+  Translation,\n+  TranslationProps\n+} from './components'\n+export {\n   Composer,\n   ComposerCustom,\n-  CustomBlock,\n-  CustomBlocks,\n-  ComposerTranslation,\n   ComposerDateTimeFormatting,\n   ComposerNumberFormatting,\n-  ComposerResolveLocaleMessageTranslation\n+  ComposerOptions,\n+  ComposerResolveLocaleMessageTranslation,\n+  ComposerTranslation,\n+  CustomBlock,\n+  CustomBlocks,\n+  DefaultDateTimeFormatSchema,\n+  DefaultLocaleMessageSchema,\n+  DefaultNumberFormatSchema,\n+  DefineDateTimeFormat,\n+  DefineLocaleMessage,\n+  DefineNumberFormat,\n+  MissingHandler,\n+  VueMessageType\n } from './composer'\n export {\n-  TranslateResult,\n+  TranslationDirective,\n+  vTDirective,\n+  VTDirectiveValue\n+} from './directive'\n+export {\n+  ComposerAdditionalOptions,\n+  ComposerExtender,\n+  createI18n,\n+  ExportedGlobalComposer,\n+  I18n,\n+  I18nAdditionalOptions,\n+  I18nInjectionKey,\n+  I18nMode,\n+  I18nOptions,\n+  I18nScope,\n+  useI18n,\n+  UseI18nOptions\n+} from './i18n'\n+export {\n   Choice,\n-  LocaleMessageObject,\n-  PluralizationRulesMap,\n-  WarnHtmlInMessageLevel,\n   DateTimeFormatResult,\n+  LocaleMessageObject,\n   NumberFormatResult,\n-  VueI18nOptions,\n+  PluralizationRulesMap,\n+  TranslateResult,\n   VueI18n,\n-  VueI18nTranslation,\n-  VueI18nTranslationChoice,\n   VueI18nDateTimeFormatting,\n+  VueI18nExtender,\n   VueI18nNumberFormatting,\n+  VueI18nOptions,\n   VueI18nResolveLocaleMessageTranslation,\n-  VueI18nExtender\n+  VueI18nTranslation,\n+  VueI18nTranslationChoice,\n+  WarnHtmlInMessageLevel\n } from './legacy'\n-export {\n-  createI18n,\n-  useI18n,\n-  I18nInjectionKey,\n-  I18nOptions,\n-  I18nAdditionalOptions,\n-  I18n,\n-  I18nMode,\n-  I18nScope,\n-  ComposerAdditionalOptions,\n-  UseI18nOptions,\n-  ExportedGlobalComposer,\n-  ComposerExtender\n-} from './i18n'\n-export {\n-  Translation,\n-  I18nT,\n-  NumberFormat,\n-  I18nN,\n-  DatetimeFormat,\n-  I18nD,\n-  TranslationProps,\n-  NumberFormatProps,\n-  DatetimeFormatProps,\n-  FormattableProps,\n-  BaseFormatProps,\n-  ComponentI18nScope\n-} from './components'\n-export {\n-  vTDirective,\n-  VTDirectiveValue,\n-  TranslationDirective\n-} from './directive'\n-export { I18nPluginOptions } from './plugin'\n export { VERSION } from './misc'\n+export { I18nPluginOptions } from './plugin'\n export { Disposer } from './types'\n \n export type {\n-  IsNever,\n   IsEmptyObject,\n-  PickupPaths,\n+  IsNever,\n+  PickupFormatPathKeys,\n   PickupKeys,\n-  PickupFormatPathKeys\n+  PickupPaths\n } from '@intlify/core-base'\n \n if (__ESM_BUNDLER__ && !__TEST__) {"
            },
            {
                "sha": "509ad4c9ca0b854333f3914180f3c728753c5058",
                "filename": "packages/vue-i18n-core/src/utils.ts",
                "status": "modified",
                "additions": 9,
                "deletions": 5,
                "changes": 14,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Futils.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Futils.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Futils.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,6 @@\n /* eslint-disable @typescript-eslint/no-explicit-any */\n import {\n+  create,\n   deepCopy,\n   hasOwn,\n   isArray,\n@@ -69,7 +70,7 @@ export function handleFlatJson(obj: unknown): unknown {\n       let hasStringValue = false\n       for (let i = 0; i < lastIndex; i++) {\n         if (!(subKeys[i] in currentObj)) {\n-          currentObj[subKeys[i]] = {}\n+          currentObj[subKeys[i]] = create()\n         }\n         if (!isObject(currentObj[subKeys[i]])) {\n           __DEV__ &&\n@@ -108,16 +109,16 @@ export function getLocaleMessages<Messages = {}>(\n   const ret = (isPlainObject(messages)\n     ? messages\n     : isArray(__i18n)\n-      ? {}\n-      : { [locale]: {} }) as Record<string, any>\n+      ? create()\n+      : { [locale]: create() }) as Record<string, any>\n \n   // merge locale messages of i18n custom block\n   if (isArray(__i18n)) {\n     __i18n.forEach(custom => {\n       if ('locale' in custom && 'resource' in custom) {\n         const { locale, resource } = custom\n         if (locale) {\n-          ret[locale] = ret[locale] || {}\n+          ret[locale] = ret[locale] || create()\n           deepCopy(resource, ret[locale])\n         } else {\n           deepCopy(resource, ret)\n@@ -149,7 +150,10 @@ export function adjustI18nResources(\n   options: ComposerOptions,\n   componentOptions: any\n ): void {\n-  let messages = isObject(options.messages) ? options.messages : {}\n+  // prettier-ignore\n+  let messages = isObject(options.messages)\n+    ? options.messages\n+    : create() as NonNullable<ComposerOptions['messages']>\n   if ('__i18nGlobal' in componentOptions) {\n     messages = getLocaleMessages(gl.locale.value as Locale, {\n       messages,"
            },
            {
                "sha": "0c63e3ec27b7fa71f64d62437710f71519eae436",
                "filename": "packages/vue-i18n-core/src/warnings.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fwarnings.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fwarnings.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fwarnings.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,5 @@\n-import { format } from '@intlify/shared'\n import { CORE_WARN_CODES_EXTEND_POINT } from '@intlify/core-base'\n+import { format } from '@intlify/shared'\n \n export const I18nWarnCodes = {\n   FALLBACK_TO_ROOT: CORE_WARN_CODES_EXTEND_POINT, // 8"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/intlify/vue-i18n/commits/9f20909ef8c9232a1072d7818e12ed6d6451024d",
        "url": "https://api.github.com/repos/intlify/vue-i18n/commits/9f20909ef8c9232a1072d7818e12ed6d6451024d",
        "html_url": "https://github.com/intlify/vue-i18n/commit/9f20909ef8c9232a1072d7818e12ed6d6451024d",
        "message": "Merge commit from fork\n\n* fix: XSS vulnerability with prototype pollution on AST\n\n* test: add e2e test for scurity fix\n\n* fix: prototype pollusion on deepCopy\n\n* fix: update e2e\n\n* fix: filename\n\n* fix: change type name\n\n* fix: more test case\n\n* fix: change to `Object.create(null)` from object literal for more safety",
        "files": [
            {
                "sha": "b7594c94cf926cf9618e55d47abd0c89e7e67f4b",
                "filename": "packages/core-base/src/compilation.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fcompilation.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fcompilation.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fcompilation.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -4,6 +4,7 @@ import {\n   detectHtmlTag\n } from '@intlify/message-compiler'\n import {\n+  create,\n   format,\n   hasOwn,\n   isBoolean,\n@@ -32,10 +33,10 @@ function checkHtmlMessage(source: string, warnHtmlMessage?: boolean): void {\n }\n \n const defaultOnCacheKey = (message: string): string => message\n-let compileCache: unknown = Object.create(null)\n+let compileCache: unknown = create()\n \n export function clearCompileCache(): void {\n-  compileCache = Object.create(null)\n+  compileCache = create()\n }\n \n export function isMessageAST(val: unknown): val is ResourceNode {"
            },
            {
                "sha": "dcfe923f3d5d4b2041e2a5bdc16c752187f1e1f4",
                "filename": "packages/core-base/src/context.ts",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fcontext.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fcontext.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fcontext.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -2,6 +2,7 @@\n \n import {\n   assign,\n+  create,\n   isArray,\n   isBoolean,\n   isFunction,\n@@ -507,23 +508,23 @@ export function createCoreContext<Message = string>(options: any = {}): any {\n       : _locale\n   const messages = isPlainObject(options.messages)\n     ? options.messages\n-    : { [_locale]: {} }\n+    : createResources(_locale)\n   const datetimeFormats = !__LITE__\n     ? isPlainObject(options.datetimeFormats)\n       ? options.datetimeFormats\n-      : { [_locale]: {} }\n-    : { [_locale]: {} }\n+      : createResources(_locale)\n+    : createResources(_locale)\n   const numberFormats = !__LITE__\n     ? isPlainObject(options.numberFormats)\n       ? options.numberFormats\n-      : { [_locale]: {} }\n-    : { [_locale]: {} }\n+      : createResources(_locale)\n+    : createResources(_locale)\n   const modifiers = assign(\n-    {},\n-    options.modifiers || {},\n+    create(),\n+    options.modifiers,\n     getDefaultLinkedModifiers<Message>()\n   )\n-  const pluralRules = options.pluralRules || {}\n+  const pluralRules = options.pluralRules || create()\n   const missing = isFunction(options.missing) ? options.missing : null\n   const missingWarn =\n     isBoolean(options.missingWarn) || isRegExp(options.missingWarn)\n@@ -628,6 +629,8 @@ export function createCoreContext<Message = string>(options: any = {}): any {\n   return context\n }\n \n+const createResources = (locale: Locale) => ({ [locale]: create() })\n+\n /** @internal */\n export function isTranslateFallbackWarn(\n   fallback: boolean | RegExp,"
            },
            {
                "sha": "9bd98f4c469f48b2ca3f19ff8552a23f123ee21c",
                "filename": "packages/core-base/src/datetime.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fdatetime.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fdatetime.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fdatetime.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,6 @@\n import {\n   assign,\n+  create,\n   isBoolean,\n   isDate,\n   isEmptyObject,\n@@ -322,8 +323,8 @@ export function parseDateTimeArgs(\n   ...args: unknown[]\n ): [string, number | Date, DateTimeOptions, Intl.DateTimeFormatOptions] {\n   const [arg1, arg2, arg3, arg4] = args\n-  const options = {} as DateTimeOptions\n-  let overrides = {} as Intl.DateTimeFormatOptions\n+  const options = create() as DateTimeOptions\n+  let overrides = create() as Intl.DateTimeFormatOptions\n \n   let value: number | Date\n   if (isString(arg1)) {"
            },
            {
                "sha": "fb70d60b848804a1bbb3387211f95ee845687924",
                "filename": "packages/core-base/src/number.ts",
                "status": "modified",
                "additions": 15,
                "deletions": 14,
                "changes": 29,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fnumber.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fnumber.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fnumber.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,31 +1,32 @@\n import {\n-  isString,\n+  assign,\n+  create,\n   isBoolean,\n-  isPlainObject,\n-  isNumber,\n   isEmptyObject,\n-  assign\n+  isNumber,\n+  isPlainObject,\n+  isString\n } from '@intlify/shared'\n import {\n   handleMissing,\n   isTranslateFallbackWarn,\n-  NOT_REOSLVED,\n-  MISSING_RESOLVE_VALUE\n+  MISSING_RESOLVE_VALUE,\n+  NOT_REOSLVED\n } from './context'\n-import { CoreWarnCodes, getWarnMessage } from './warnings'\n import { CoreErrorCodes, createCoreError } from './errors'\n-import { Availabilities } from './intl'\n import { getLocale } from './fallbacker'\n+import { Availabilities } from './intl'\n+import { CoreWarnCodes, getWarnMessage } from './warnings'\n \n-import type { Locale, FallbackLocale } from './runtime'\n+import type { CoreContext, CoreInternalContext } from './context'\n+import type { LocaleOptions } from './fallbacker'\n+import type { FallbackLocale, Locale } from './runtime'\n import type {\n   NumberFormat,\n-  NumberFormats as NumberFormatsType,\n   NumberFormatOptions,\n+  NumberFormats as NumberFormatsType,\n   PickupFormatKeys\n } from './types'\n-import type { LocaleOptions } from './fallbacker'\n-import type { CoreContext, CoreInternalContext } from './context'\n \n /**\n  *  # number\n@@ -317,8 +318,8 @@ export function parseNumberArgs(\n   ...args: unknown[]\n ): [string, number, NumberOptions, Intl.NumberFormatOptions] {\n   const [arg1, arg2, arg3, arg4] = args\n-  const options = {} as NumberOptions\n-  let overrides = {} as Intl.NumberFormatOptions\n+  const options = create() as NumberOptions\n+  let overrides = create() as Intl.NumberFormatOptions\n \n   if (!isNumber(arg1)) {\n     throw createCoreError(CoreErrorCodes.INVALID_ARGUMENT)"
            },
            {
                "sha": "47a2c93a6c334cffde0bb4faf9b34cab35440ba3",
                "filename": "packages/core-base/src/runtime.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fruntime.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Fruntime.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fruntime.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,6 +1,7 @@\n import { HelperNameMap } from '@intlify/message-compiler'\n import {\n   assign,\n+  create,\n   isArray,\n   isFunction,\n   isNumber,\n@@ -360,7 +361,7 @@ export function createMessageContext<T = string, N = {}>(\n   const list = (index: number): unknown => _list[index]\n \n   // eslint-disable-next-line @typescript-eslint/no-explicit-any\n-  const _named = options.named || ({} as any)\n+  const _named = options.named || (create() as any)\n \n   isNumber(options.pluralIndex) && normalizeNamed(pluralIndex, _named)\n   const named = (key: string): unknown => _named[key]\n@@ -437,7 +438,7 @@ export function createMessageContext<T = string, N = {}>(\n     [HelperNameMap.TYPE]: type,\n     [HelperNameMap.INTERPOLATE]: interpolate,\n     [HelperNameMap.NORMALIZE]: normalize,\n-    [HelperNameMap.VALUES]: assign({}, _list, _named)\n+    [HelperNameMap.VALUES]: assign(create(), _list, _named)\n   }\n \n   return ctx"
            },
            {
                "sha": "4880d10b9289a0b6888746491007469437f95a69",
                "filename": "packages/core-base/src/translate.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Ftranslate.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fcore-base%2Fsrc%2Ftranslate.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Ftranslate.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,6 @@\n import {\n   assign,\n+  create,\n   escapeHtml,\n   generateCodeFrame,\n   generateFormatCacheKey,\n@@ -677,7 +678,7 @@ export function translate<\n     : [\n         key,\n         locale,\n-        (messages as unknown as LocaleMessages<Message>)[locale] || {}\n+        (messages as unknown as LocaleMessages<Message>)[locale] || create()\n       ]\n   // NOTE:\n   //  Fix to work around `ssrTransfrom` bug in Vite.\n@@ -830,7 +831,7 @@ function resolveMessageFormat<Messages, Message>(\n   } = context\n   const locales = localeFallbacker(context as any, fallbackLocale, locale) // eslint-disable-line @typescript-eslint/no-explicit-any\n \n-  let message: LocaleMessageValue<Message> = {}\n+  let message: LocaleMessageValue<Message> = create()\n   let targetLocale: Locale | undefined\n   let format: PathValue = null\n   let from: Locale = locale\n@@ -869,7 +870,7 @@ function resolveMessageFormat<Messages, Message>(\n     }\n \n     message =\n-      (messages as unknown as LocaleMessages<Message>)[targetLocale] || {}\n+      (messages as unknown as LocaleMessages<Message>)[targetLocale] || create()\n \n     // for vue-devtools timeline event\n     let start: number | null = null\n@@ -1044,7 +1045,7 @@ export function parseTranslateArgs<Message = string>(\n   ...args: unknown[]\n ): [Path | MessageFunction<Message> | ResourceNode, TranslateOptions] {\n   const [arg1, arg2, arg3] = args\n-  const options = {} as TranslateOptions\n+  const options = create() as TranslateOptions\n \n   if (\n     !isString(arg1) &&"
            },
            {
                "sha": "59128b94f701b1a1373456582ae5f0ea83484f43",
                "filename": "packages/message-compiler/src/tokenizer.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fmessage-compiler%2Fsrc%2Ftokenizer.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fmessage-compiler%2Fsrc%2Ftokenizer.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fmessage-compiler%2Fsrc%2Ftokenizer.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,10 +1,10 @@\n-import { createScanner, CHAR_SP as SPACE, CHAR_LF as NEW_LINE } from './scanner'\n+import { CompileErrorCodes, createCompileError } from './errors'\n import { createLocation, createPosition } from './location'\n-import { createCompileError, CompileErrorCodes } from './errors'\n+import { createScanner, CHAR_LF as NEW_LINE, CHAR_SP as SPACE } from './scanner'\n \n-import type { Scanner } from './scanner'\n-import type { SourceLocation, Position } from './location'\n+import type { Position, SourceLocation } from './location'\n import type { TokenizeOptions } from './options'\n+import type { Scanner } from './scanner'\n \n export const enum TokenTypes {\n   Text, // 0\n@@ -447,6 +447,7 @@ export function createTokenizer(\n   function readText(scnr: Scanner): string {\n     let buf = ''\n \n+     \n     while (true) {\n       const ch = scnr.currentChar()\n       if ("
            },
            {
                "sha": "43ef02502dcc431d2d0273b8633aa267d3c02c18",
                "filename": "packages/shared/src/messages.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Fsrc%2Fmessages.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Fsrc%2Fmessages.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fshared%2Fsrc%2Fmessages.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,4 +1,4 @@\n-import { isArray, isObject } from './utils'\n+import { create, isArray, isObject } from './utils'\n \n const isNotObjectOrIsArray = (val: unknown) => !isObject(val) || isArray(val)\n // eslint-disable-next-line @typescript-eslint/no-explicit-any\n@@ -14,10 +14,13 @@ export function deepCopy(src: any, des: any): void {\n \n     // using `Object.keys` which skips prototype properties\n     Object.keys(src).forEach(key => {\n+      if (key === '__proto__') {\n+        return\n+      }\n       // if src[key] is an object/array, set des[key]\n       // to empty object/array to prevent setting by reference\n       if (isObject(src[key]) && !isObject(des[key])) {\n-        des[key] = Array.isArray(src[key]) ? [] : {}\n+        des[key] = Array.isArray(src[key]) ? [] : create()\n       }\n \n       if (isNotObjectOrIsArray(des[key]) || isNotObjectOrIsArray(src[key])) {"
            },
            {
                "sha": "f967df0cf566e65ddbcb769a737c07dde1e12e85",
                "filename": "packages/shared/src/utils.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Fsrc%2Futils.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Fsrc%2Futils.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fshared%2Fsrc%2Futils.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -81,6 +81,9 @@ export const isEmptyObject = (val: unknown): val is boolean =>\n \n export const assign = Object.assign\n \n+const _create = Object.create\n+export const create = (obj: object | null = null): object => _create(obj)\n+\n let _globalThis: any\n export const getGlobalThis = (): any => {\n   // prettier-ignore\n@@ -95,7 +98,7 @@ export const getGlobalThis = (): any => {\n             ? window\n             : typeof global !== 'undefined'\n               ? global\n-              : {})\n+              : create())\n   )\n }\n "
            },
            {
                "sha": "cbec88395a81de71ac8349d74ad001a7aec86bdc",
                "filename": "packages/shared/test/messages.test.ts",
                "status": "modified",
                "additions": 31,
                "deletions": 0,
                "changes": 31,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Ftest%2Fmessages.test.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fshared%2Ftest%2Fmessages.test.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fshared%2Ftest%2Fmessages.test.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -48,3 +48,34 @@ test('deepCopy merges without mutating src argument', () => {\n   // should not mutate source object\n   expect(msg1).toStrictEqual(copy1)\n })\n+\n+describe('CVE-2024-52810', () => {\n+  test('__proto__', () => {\n+    const source = '{ \"__proto__\": { \"pollutedKey\": 123 } }'\n+    const dest = {}\n+\n+    deepCopy(JSON.parse(source), dest)\n+    expect(dest).toEqual({})\n+    // @ts-ignore -- initialize polluted property\n+    expect(JSON.parse(JSON.stringify({}.__proto__))).toEqual({})\n+  })\n+\n+  test('nest __proto__', () => {\n+    const source = '{ \"foo\": { \"__proto__\": { \"pollutedKey\": 123 } } }'\n+    const dest = {}\n+\n+    deepCopy(JSON.parse(source), dest)\n+    expect(dest).toEqual({ foo: {} })\n+    // @ts-ignore -- initialize polluted property\n+    expect(JSON.parse(JSON.stringify({}.__proto__))).toEqual({})\n+  })\n+\n+  test('constructor prototype', () => {\n+    const source = '{ \"constructor\": { \"prototype\": { \"polluted\": 1 } } }'\n+    const dest = {}\n+\n+    deepCopy(JSON.parse(source), dest)\n+    // @ts-ignore -- initialize polluted property\n+    expect({}.polluted).toBeUndefined()\n+  })\n+})"
            },
            {
                "sha": "04618565f1acd819fc23599ccbfb2536cf2d62d7",
                "filename": "packages/vue-i18n-core/src/components/DatetimeFormat.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FDatetimeFormat.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FDatetimeFormat.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FDatetimeFormat.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,16 +1,16 @@\n-import { defineComponent } from 'vue'\n-import { assign } from '@intlify/shared'\n import { DATETIME_FORMAT_OPTIONS_KEYS } from '@intlify/core-base'\n+import { assign } from '@intlify/shared'\n+import { defineComponent } from 'vue'\n import { useI18n } from '../i18n'\n import { DatetimePartsSymbol } from '../symbols'\n-import { renderFormatter } from './formatRenderer'\n import { baseFormatProps } from './base'\n+import { renderFormatter } from './formatRenderer'\n \n-import type { VNodeProps } from 'vue'\n import type { DateTimeOptions } from '@intlify/core-base'\n+import type { VNodeProps } from 'vue'\n import type { Composer, ComposerInternal } from '../composer'\n-import type { FormattableProps } from './formatRenderer'\n import type { BaseFormatProps } from './base'\n+import type { FormattableProps } from './formatRenderer'\n \n /**\n  * DatetimeFormat Component Props"
            },
            {
                "sha": "71d747ae62d75d12acd03adda6e038a8b4fa020c",
                "filename": "packages/vue-i18n-core/src/components/NumberFormat.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FNumberFormat.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FNumberFormat.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FNumberFormat.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,16 +1,16 @@\n-import { defineComponent } from 'vue'\n-import { assign } from '@intlify/shared'\n import { NUMBER_FORMAT_OPTIONS_KEYS } from '@intlify/core-base'\n+import { assign } from '@intlify/shared'\n+import { defineComponent } from 'vue'\n import { useI18n } from '../i18n'\n import { NumberPartsSymbol } from '../symbols'\n-import { renderFormatter } from './formatRenderer'\n import { baseFormatProps } from './base'\n+import { renderFormatter } from './formatRenderer'\n \n-import type { VNodeProps } from 'vue'\n import type { NumberOptions } from '@intlify/core-base'\n+import type { VNodeProps } from 'vue'\n import type { Composer, ComposerInternal } from '../composer'\n-import type { FormattableProps } from './formatRenderer'\n import type { BaseFormatProps } from './base'\n+import type { FormattableProps } from './formatRenderer'\n \n /**\n  * NumberFormat Component Props"
            },
            {
                "sha": "d91c7e85291a8336ebe964896916a5798935b25d",
                "filename": "packages/vue-i18n-core/src/components/Translation.ts",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FTranslation.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FTranslation.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FTranslation.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,12 +1,12 @@\n-import { h, defineComponent } from 'vue'\n-import { isNumber, isString, isObject, assign } from '@intlify/shared'\n-import { TranslateVNodeSymbol } from '../symbols'\n+import { assign, create, isNumber, isObject, isString } from '@intlify/shared'\n+import { defineComponent, h } from 'vue'\n import { useI18n } from '../i18n'\n+import { TranslateVNodeSymbol } from '../symbols'\n import { baseFormatProps } from './base'\n-import { getInterpolateArg, getFragmentableTag } from './utils'\n+import { getFragmentableTag, getInterpolateArg } from './utils'\n \n-import type { VNodeChild, VNodeProps } from 'vue'\n import type { TranslateOptions } from '@intlify/core-base'\n+import type { VNodeChild, VNodeProps } from 'vue'\n import type { Composer, ComposerInternal } from '../composer'\n import type { BaseFormatProps } from './base'\n \n@@ -59,7 +59,7 @@ export const TranslationImpl = /*#__PURE__*/ defineComponent({\n \n     return (): VNodeChild => {\n       const keys = Object.keys(slots).filter(key => key !== '_')\n-      const options = {} as TranslateOptions\n+      const options = create() as TranslateOptions\n       if (props.locale) {\n         options.locale = props.locale\n       }\n@@ -73,7 +73,7 @@ export const TranslationImpl = /*#__PURE__*/ defineComponent({\n         arg,\n         options\n       )\n-      const assignedAttrs = assign({}, attrs)\n+      const assignedAttrs = assign(create(), attrs)\n       const tag =\n         isString(props.tag) || isObject(props.tag)\n           ? props.tag"
            },
            {
                "sha": "40ed4c40f99b61b532a1a215137074be49d965fe",
                "filename": "packages/vue-i18n-core/src/components/base.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Fbase.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Fbase.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Fbase.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,7 +1,7 @@\n import { Composer } from '../composer'\n \n-import type { I18nScope } from '../i18n'\n import type { Locale } from '@intlify/core-base'\n+import type { I18nScope } from '../i18n'\n \n export type ComponentI18nScope = Exclude<I18nScope, 'local'>\n "
            },
            {
                "sha": "f23a7c11626c69d8811bf1391012fa8b72f8c3e0",
                "filename": "packages/vue-i18n-core/src/components/formatRenderer.ts",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FformatRenderer.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FformatRenderer.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2FformatRenderer.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,15 +1,15 @@\n+import { assign, create, isArray, isObject, isString } from '@intlify/shared'\n import { h } from 'vue'\n import { getFragmentableTag } from './utils'\n-import { isString, isObject, isArray, assign } from '@intlify/shared'\n \n+import type { DateTimeOptions, NumberOptions } from '@intlify/core-base'\n import type {\n   RenderFunction,\n   SetupContext,\n   VNode,\n-  VNodeChild,\n-  VNodeArrayChildren\n+  VNodeArrayChildren,\n+  VNodeChild\n } from 'vue'\n-import type { NumberOptions, DateTimeOptions } from '@intlify/core-base'\n import type { BaseFormatProps } from './base'\n \n /**\n@@ -61,7 +61,7 @@ export function renderFormatter<\n \n   return (): VNodeChild => {\n     const options = { part: true } as Arg\n-    let overrides = {} as FormatOverrideOptions\n+    let overrides = create() as FormatOverrideOptions\n \n     if (props.locale) {\n       options.locale = props.locale\n@@ -78,9 +78,9 @@ export function renderFormatter<\n       // Filter out number format options only\n       overrides = Object.keys(props.format).reduce((options, prop) => {\n         return slotKeys.includes(prop)\n-          ? assign({}, options, { [prop]: (props.format as any)[prop] }) // eslint-disable-line @typescript-eslint/no-explicit-any\n+          ? assign(create(), options, { [prop]: (props.format as any)[prop] }) // eslint-disable-line @typescript-eslint/no-explicit-any\n           : options\n-      }, {})\n+      }, create())\n     }\n \n     const parts = partFormatter(...[props.value, options, overrides])\n@@ -100,7 +100,7 @@ export function renderFormatter<\n       children = [parts]\n     }\n \n-    const assignedAttrs = assign({}, attrs)\n+    const assignedAttrs = assign(create(), attrs)\n     const tag =\n       isString(props.tag) || isObject(props.tag)\n         ? props.tag"
            },
            {
                "sha": "824c7ca857c5b77c5a1979a44617a39181eaabdb",
                "filename": "packages/vue-i18n-core/src/components/index.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Findex.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Findex.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Findex.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,5 @@\n-export { ComponentI18nScope, BaseFormatProps } from './base'\n+export { BaseFormatProps, ComponentI18nScope } from './base'\n+export { DatetimeFormat, DatetimeFormatProps, I18nD } from './DatetimeFormat'\n export { FormattableProps } from './formatRenderer'\n-export { Translation, I18nT, TranslationProps } from './Translation'\n-export { NumberFormat, I18nN, NumberFormatProps } from './NumberFormat'\n-export { DatetimeFormat, I18nD, DatetimeFormatProps } from './DatetimeFormat'\n+export { I18nN, NumberFormat, NumberFormatProps } from './NumberFormat'\n+export { I18nT, Translation, TranslationProps } from './Translation'"
            },
            {
                "sha": "e9759492f2efbca9a86554cd265d5d703b63b3d6",
                "filename": "packages/vue-i18n-core/src/components/utils.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Futils.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Futils.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fcomponents%2Futils.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,3 +1,4 @@\n+import { create } from '@intlify/shared'\n import { Fragment } from 'vue'\n \n import type { NamedValue } from '@intlify/core-base'\n@@ -27,7 +28,7 @@ export function getInterpolateArg(\n         arg[key] = slot()\n       }\n       return arg\n-    }, {} as NamedValue)\n+    }, create() as NamedValue)\n   }\n }\n "
            },
            {
                "sha": "9f2dd524b9bc8cc55c0c23c2e90f9d040d9764e5",
                "filename": "packages/vue-i18n-core/src/index.ts",
                "status": "modified",
                "additions": 83,
                "deletions": 83,
                "changes": 166,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Findex.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Findex.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Findex.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,120 +1,120 @@\n-import { getGlobalThis } from '@intlify/shared'\n import { setDevToolsHook } from '@intlify/core-base'\n+import { getGlobalThis } from '@intlify/shared'\n import { initDev, initFeatureFlags } from './misc'\n \n export {\n-  SchemaParams,\n-  LocaleParams,\n-  Path,\n-  PathValue,\n-  NamedValue,\n-  Locale,\n+  CompileError,\n+  DateTimeOptions,\n   FallbackLocale,\n-  LocaleMessageValue,\n-  LocaleMessageDictionary,\n-  LocaleMessageType,\n-  LocaleMessages,\n-  LocaleMessage,\n-  NumberFormat as IntlNumberFormat,\n   DateTimeFormat as IntlDateTimeFormat,\n   DateTimeFormats as IntlDateTimeFormats,\n-  NumberFormats as IntlNumberFormats,\n-  LocaleMatcher as IntlLocaleMatcher,\n   FormatMatcher as IntlFormatMatcher,\n-  MessageFunction,\n-  MessageFunctions,\n-  PluralizationRule,\n+  LocaleMatcher as IntlLocaleMatcher,\n+  NumberFormat as IntlNumberFormat,\n+  NumberFormats as IntlNumberFormats,\n   LinkedModifiers,\n-  TranslateOptions,\n-  DateTimeOptions,\n-  NumberOptions,\n-  PostTranslationHandler,\n-  MessageResolver,\n+  Locale,\n+  LocaleMessage,\n+  LocaleMessageDictionary,\n+  LocaleMessages,\n+  LocaleMessageType,\n+  LocaleMessageValue,\n+  LocaleParams,\n   MessageCompiler,\n   MessageCompilerContext,\n-  CompileError,\n   MessageContext,\n-  RemovedIndexResources\n+  MessageFunction,\n+  MessageFunctions,\n+  MessageResolver,\n+  NamedValue,\n+  NumberOptions,\n+  Path,\n+  PathValue,\n+  PluralizationRule,\n+  PostTranslationHandler,\n+  RemovedIndexResources,\n+  SchemaParams,\n+  TranslateOptions\n } from '@intlify/core-base'\n export {\n-  VueMessageType,\n-  DefineLocaleMessage,\n-  DefaultLocaleMessageSchema,\n-  DefineDateTimeFormat,\n-  DefaultDateTimeFormatSchema,\n-  DefineNumberFormat,\n-  DefaultNumberFormatSchema,\n-  MissingHandler,\n-  ComposerOptions,\n+  BaseFormatProps,\n+  ComponentI18nScope,\n+  DatetimeFormat,\n+  DatetimeFormatProps,\n+  FormattableProps,\n+  I18nD,\n+  I18nN,\n+  I18nT,\n+  NumberFormat,\n+  NumberFormatProps,\n+  Translation,\n+  TranslationProps\n+} from './components'\n+export {\n   Composer,\n   ComposerCustom,\n-  CustomBlock,\n-  CustomBlocks,\n-  ComposerTranslation,\n   ComposerDateTimeFormatting,\n   ComposerNumberFormatting,\n-  ComposerResolveLocaleMessageTranslation\n+  ComposerOptions,\n+  ComposerResolveLocaleMessageTranslation,\n+  ComposerTranslation,\n+  CustomBlock,\n+  CustomBlocks,\n+  DefaultDateTimeFormatSchema,\n+  DefaultLocaleMessageSchema,\n+  DefaultNumberFormatSchema,\n+  DefineDateTimeFormat,\n+  DefineLocaleMessage,\n+  DefineNumberFormat,\n+  MissingHandler,\n+  VueMessageType\n } from './composer'\n export {\n-  TranslateResult,\n+  TranslationDirective,\n+  vTDirective,\n+  VTDirectiveValue\n+} from './directive'\n+export {\n+  ComposerAdditionalOptions,\n+  ComposerExtender,\n+  createI18n,\n+  ExportedGlobalComposer,\n+  I18n,\n+  I18nAdditionalOptions,\n+  I18nInjectionKey,\n+  I18nMode,\n+  I18nOptions,\n+  I18nScope,\n+  useI18n,\n+  UseI18nOptions\n+} from './i18n'\n+export {\n   Choice,\n-  LocaleMessageObject,\n-  PluralizationRulesMap,\n-  WarnHtmlInMessageLevel,\n   DateTimeFormatResult,\n+  LocaleMessageObject,\n   NumberFormatResult,\n-  VueI18nOptions,\n+  PluralizationRulesMap,\n+  TranslateResult,\n   VueI18n,\n-  VueI18nTranslation,\n-  VueI18nTranslationChoice,\n   VueI18nDateTimeFormatting,\n+  VueI18nExtender,\n   VueI18nNumberFormatting,\n+  VueI18nOptions,\n   VueI18nResolveLocaleMessageTranslation,\n-  VueI18nExtender\n+  VueI18nTranslation,\n+  VueI18nTranslationChoice,\n+  WarnHtmlInMessageLevel\n } from './legacy'\n-export {\n-  createI18n,\n-  useI18n,\n-  I18nInjectionKey,\n-  I18nOptions,\n-  I18nAdditionalOptions,\n-  I18n,\n-  I18nMode,\n-  I18nScope,\n-  ComposerAdditionalOptions,\n-  UseI18nOptions,\n-  ExportedGlobalComposer,\n-  ComposerExtender\n-} from './i18n'\n-export {\n-  Translation,\n-  I18nT,\n-  NumberFormat,\n-  I18nN,\n-  DatetimeFormat,\n-  I18nD,\n-  TranslationProps,\n-  NumberFormatProps,\n-  DatetimeFormatProps,\n-  FormattableProps,\n-  BaseFormatProps,\n-  ComponentI18nScope\n-} from './components'\n-export {\n-  vTDirective,\n-  VTDirectiveValue,\n-  TranslationDirective\n-} from './directive'\n-export { I18nPluginOptions } from './plugin'\n export { VERSION } from './misc'\n+export { I18nPluginOptions } from './plugin'\n export { Disposer } from './types'\n \n export type {\n-  IsNever,\n   IsEmptyObject,\n-  PickupPaths,\n+  IsNever,\n+  PickupFormatPathKeys,\n   PickupKeys,\n-  PickupFormatPathKeys\n+  PickupPaths\n } from '@intlify/core-base'\n \n if (__ESM_BUNDLER__ && !__TEST__) {"
            },
            {
                "sha": "509ad4c9ca0b854333f3914180f3c728753c5058",
                "filename": "packages/vue-i18n-core/src/utils.ts",
                "status": "modified",
                "additions": 9,
                "deletions": 5,
                "changes": 14,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Futils.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Futils.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Futils.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,6 @@\n /* eslint-disable @typescript-eslint/no-explicit-any */\n import {\n+  create,\n   deepCopy,\n   hasOwn,\n   isArray,\n@@ -69,7 +70,7 @@ export function handleFlatJson(obj: unknown): unknown {\n       let hasStringValue = false\n       for (let i = 0; i < lastIndex; i++) {\n         if (!(subKeys[i] in currentObj)) {\n-          currentObj[subKeys[i]] = {}\n+          currentObj[subKeys[i]] = create()\n         }\n         if (!isObject(currentObj[subKeys[i]])) {\n           __DEV__ &&\n@@ -108,16 +109,16 @@ export function getLocaleMessages<Messages = {}>(\n   const ret = (isPlainObject(messages)\n     ? messages\n     : isArray(__i18n)\n-      ? {}\n-      : { [locale]: {} }) as Record<string, any>\n+      ? create()\n+      : { [locale]: create() }) as Record<string, any>\n \n   // merge locale messages of i18n custom block\n   if (isArray(__i18n)) {\n     __i18n.forEach(custom => {\n       if ('locale' in custom && 'resource' in custom) {\n         const { locale, resource } = custom\n         if (locale) {\n-          ret[locale] = ret[locale] || {}\n+          ret[locale] = ret[locale] || create()\n           deepCopy(resource, ret[locale])\n         } else {\n           deepCopy(resource, ret)\n@@ -149,7 +150,10 @@ export function adjustI18nResources(\n   options: ComposerOptions,\n   componentOptions: any\n ): void {\n-  let messages = isObject(options.messages) ? options.messages : {}\n+  // prettier-ignore\n+  let messages = isObject(options.messages)\n+    ? options.messages\n+    : create() as NonNullable<ComposerOptions['messages']>\n   if ('__i18nGlobal' in componentOptions) {\n     messages = getLocaleMessages(gl.locale.value as Locale, {\n       messages,"
            },
            {
                "sha": "0c63e3ec27b7fa71f64d62437710f71519eae436",
                "filename": "packages/vue-i18n-core/src/warnings.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fwarnings.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/9f20909ef8c9232a1072d7818e12ed6d6451024d/packages%2Fvue-i18n-core%2Fsrc%2Fwarnings.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Fsrc%2Fwarnings.ts?ref=9f20909ef8c9232a1072d7818e12ed6d6451024d",
                "patch": "@@ -1,5 +1,5 @@\n-import { format } from '@intlify/shared'\n import { CORE_WARN_CODES_EXTEND_POINT } from '@intlify/core-base'\n+import { format } from '@intlify/shared'\n \n export const I18nWarnCodes = {\n   FALLBACK_TO_ROOT: CORE_WARN_CODES_EXTEND_POINT, // 8"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/intlify/vue-i18n/commits/72f0d323006fc7363b18cab62d4522dadd874411",
        "url": "https://api.github.com/repos/intlify/vue-i18n/commits/72f0d323006fc7363b18cab62d4522dadd874411",
        "html_url": "https://github.com/intlify/vue-i18n/commit/72f0d323006fc7363b18cab62d4522dadd874411",
        "message": "Merge commit from fork\n\n* fix: XSS vulnerability with prototype pollution on AST\n\n* test: add e2e test for scurity fix\n\n* fix: update e2e\n\n* fix: filename\n\n* fix: change type name",
        "files": [
            {
                "sha": "b1468076472483ce288fe8926f39d7d3535abe4d",
                "filename": "e2e/hotfix.spec.ts",
                "status": "added",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/72f0d323006fc7363b18cab62d4522dadd874411/e2e%2Fhotfix.spec.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/72f0d323006fc7363b18cab62d4522dadd874411/e2e%2Fhotfix.spec.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/e2e%2Fhotfix.spec.ts?ref=72f0d323006fc7363b18cab62d4522dadd874411",
                "patch": "@@ -0,0 +1,11 @@\n+import { getText } from './helper'\n+\n+describe('CVE-2024-52809', () => {\n+  beforeAll(async () => {\n+    await page.goto(`http://localhost:8080/e2e/hotfix/CVE-2024-52809.html`)\n+  })\n+\n+  test('fix', async () => {\n+    expect(await getText(page, 'p')).toMatch('hello world!')\n+  })\n+})"
            },
            {
                "sha": "c2e6c3cbf55a92072d78cbd26ea08f74ae8124c8",
                "filename": "e2e/hotfix/CVE-2024-52809.html",
                "status": "added",
                "additions": 69,
                "deletions": 0,
                "changes": 69,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/72f0d323006fc7363b18cab62d4522dadd874411/e2e%2Fhotfix%2FCVE-2024-52809.html",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/72f0d323006fc7363b18cab62d4522dadd874411/e2e%2Fhotfix%2FCVE-2024-52809.html",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/e2e%2Fhotfix%2FCVE-2024-52809.html?ref=72f0d323006fc7363b18cab62d4522dadd874411",
                "patch": "@@ -0,0 +1,69 @@\n+<!doctype html>\n+<html>\n+  <head>\n+    <meta charset=\"utf-8\" />\n+    <title>vue-i18n XSS</title>\n+    <script src=\"../../node_modules/vue/dist/vue.global.js\"></script>\n+    <script src=\"../../packages/vue-i18n/dist/vue-i18n.global.js\"></script>\n+    <!-- Scripts that perform prototype contamination, such as being distributed from malicious hosting sites or injected through supply chain attacks, etc. -->\n+    <script>\n+      /**\n+       * Prototype pollution vulnerability with `Object.prototype`.\n+       * The 'static' property is part of the optimized AST generated by the vue-i18n message compiler.\n+       * About details of special properties, see https://github.com/intlify/vue-i18n/blob/master/packages/message-compiler/src/nodes.ts\n+       *\n+       * In general, the locale messages of vue-i18n are optimized during production builds using `@intlify/unplugin-vue-i18n`,\n+       * so there is always a property that is attached during optimization like this time.\n+       * But if you are using a locale message AST in development or your own, there is a possibility of XSS if a third party injects prototype pollution code.\n+       */\n+      Object.defineProperty(Object.prototype, 'static', {\n+        configurable: true,\n+        get() {\n+          alert('prototype polluted!')\n+          return 'prototype pollution'\n+        }\n+      })\n+    </script>\n+  </head>\n+  <body>\n+    <div id=\"app\">\n+      <p>{{ t('hello') }}</p>\n+    </div>\n+    <script>\n+      const { createApp } = Vue\n+      const { createI18n, useI18n } = VueI18n\n+\n+      // AST style locale message, which build by `@intlify/unplugin-vue-i18n`\n+      const en = {\n+        hello: {\n+          type: 0,\n+          body: {\n+            items: [\n+              {\n+                type: 3,\n+                value: 'hello world!'\n+              }\n+            ]\n+          }\n+        }\n+      }\n+\n+      const i18n = createI18n({\n+        legacy: false,\n+        locale: 'en',\n+        messages: {\n+          en\n+        }\n+      })\n+\n+      const app = createApp({\n+        setup() {\n+          const { t } = useI18n()\n+          return { t }\n+        }\n+      })\n+      app.use(i18n)\n+      app.mount('#app')\n+    </script>\n+  </body>\n+</html>"
            },
            {
                "sha": "9b809e1f3b6967060d7456720b90de3342b5b41f",
                "filename": "packages/core-base/src/compilation.ts",
                "status": "modified",
                "additions": 17,
                "deletions": 6,
                "changes": 23,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Fsrc%2Fcompilation.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Fsrc%2Fcompilation.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fcompilation.ts?ref=72f0d323006fc7363b18cab62d4522dadd874411",
                "patch": "@@ -3,13 +3,21 @@ import {\n   defaultOnError,\n   detectHtmlTag\n } from '@intlify/message-compiler'\n-import { format, isBoolean, isObject, isString, warn } from '@intlify/shared'\n-import { format as formatMessage } from './format'\n+import {\n+  format,\n+  hasOwn,\n+  isBoolean,\n+  isObject,\n+  isString,\n+  warn\n+} from '@intlify/shared'\n+import { format as formatMessage, resolveType } from './format'\n \n import type {\n   CompileError,\n   CompileOptions,\n   CompilerResult,\n+  Node,\n   ResourceNode\n } from '@intlify/message-compiler'\n import type { MessageCompilerContext } from './context'\n@@ -30,10 +38,13 @@ export function clearCompileCache(): void {\n   compileCache = Object.create(null)\n }\n \n-export const isMessageAST = (val: unknown): val is ResourceNode =>\n-  isObject(val) &&\n-  (val.t === 0 || val.type === 0) &&\n-  ('b' in val || 'body' in val)\n+export function isMessageAST(val: unknown): val is ResourceNode {\n+  return (\n+    isObject(val) &&\n+    resolveType(val as Node) === 0 &&\n+    (hasOwn(val, 'b') || hasOwn(val, 'body'))\n+  )\n+}\n \n function baseCompile(\n   message: string,"
            },
            {
                "sha": "d63ed43f93e6867cb0754f8a5cfcfdc6b9a4d3a6",
                "filename": "packages/core-base/src/errors.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Fsrc%2Ferrors.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Fsrc%2Ferrors.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Ferrors.ts?ref=72f0d323006fc7363b18cab62d4522dadd874411",
                "patch": "@@ -1,6 +1,6 @@\n import {\n-  createCompileError,\n-  COMPILE_ERROR_CODES_EXTEND_POINT\n+  COMPILE_ERROR_CODES_EXTEND_POINT,\n+  createCompileError\n } from '@intlify/message-compiler'\n \n import type { BaseError } from '@intlify/shared'"
            },
            {
                "sha": "0c2804620d8e46ee188f01601d557d6bcf943a7c",
                "filename": "packages/core-base/src/format.ts",
                "status": "modified",
                "additions": 141,
                "deletions": 33,
                "changes": 174,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Fsrc%2Fformat.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Fsrc%2Fformat.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Fsrc%2Fformat.ts?ref=72f0d323006fc7363b18cab62d4522dadd874411",
                "patch": "@@ -1,23 +1,21 @@\n import { NodeTypes } from '@intlify/message-compiler'\n+import { hasOwn, isNumber } from '@intlify/shared'\n \n import type {\n-  Node,\n-  TextNode,\n-  LiteralNode,\n+  LinkedModifierNode,\n+  LinkedNode,\n   ListNode,\n   MessageNode,\n   NamedNode,\n-  LinkedNode,\n-  LinkedKeyNode,\n-  LinkedModifierNode,\n+  Node,\n   PluralNode,\n   ResourceNode\n } from '@intlify/message-compiler'\n import type {\n   MessageContext,\n   MessageFunction,\n-  MessageType,\n-  MessageFunctionReturn\n+  MessageFunctionReturn,\n+  MessageType\n } from './runtime'\n \n export function format<Message = string>(\n@@ -28,14 +26,18 @@ export function format<Message = string>(\n   return msg\n }\n \n-function formatParts<Message = string>(\n+export function formatParts<Message = string>(\n   ctx: MessageContext<Message>,\n   ast: ResourceNode\n ): MessageFunctionReturn<Message> {\n-  const body = ast.b || ast.body\n-  if ((body.t || body.type) === NodeTypes.Plural) {\n+  const body = resolveBody(ast)\n+  if (body == null) {\n+    throw createUnhandleNodeError(NodeTypes.Resource)\n+  }\n+  const type = resolveType(body)\n+  if (type === NodeTypes.Plural) {\n     const plural = body as PluralNode\n-    const cases = plural.c || plural.cases\n+    const cases = resolveCases(plural)\n     return ctx.plural(\n       cases.reduce(\n         (messages, c) =>\n@@ -51,64 +53,170 @@ function formatParts<Message = string>(\n   }\n }\n \n-function formatMessageParts<Message = string>(\n+const PROPS_BODY = ['b', 'body']\n+\n+function resolveBody(node: ResourceNode) {\n+  return resolveProps<MessageNode | PluralNode>(node, PROPS_BODY)\n+}\n+\n+const PROPS_CASES = ['c', 'cases']\n+\n+function resolveCases(node: PluralNode) {\n+  return resolveProps<PluralNode['cases'], PluralNode['cases']>(\n+    node,\n+    PROPS_CASES,\n+    []\n+  )\n+}\n+\n+export function formatMessageParts<Message = string>(\n   ctx: MessageContext<Message>,\n   node: MessageNode\n ): MessageFunctionReturn<Message> {\n-  const _static = node.s || node.static\n-  if (_static != null) {\n+  const static_ = resolveStatic(node)\n+  if (static_ != null) {\n     return ctx.type === 'text'\n-      ? (_static as MessageFunctionReturn<Message>)\n-      : ctx.normalize([_static] as MessageType<Message>[])\n+      ? (static_ as MessageFunctionReturn<Message>)\n+      : ctx.normalize([static_] as MessageType<Message>[])\n   } else {\n-    const messages = (node.i || node.items).reduce(\n+    const messages = resolveItems(node).reduce(\n       (acm, c) => [...acm, formatMessagePart(ctx, c)],\n       [] as MessageType<Message>[]\n     )\n     return ctx.normalize(messages) as MessageFunctionReturn<Message>\n   }\n }\n \n-function formatMessagePart<Message = string>(\n+const PROPS_STATIC = ['s', 'static']\n+\n+function resolveStatic(node: MessageNode) {\n+  return resolveProps(node, PROPS_STATIC)\n+}\n+\n+const PROPS_ITEMS = ['i', 'items']\n+\n+function resolveItems(node: MessageNode) {\n+  return resolveProps<MessageNode['items'], MessageNode['items']>(\n+    node,\n+    PROPS_ITEMS,\n+    []\n+  )\n+}\n+\n+type NodeValue<Message> = {\n+  v?: MessageType<Message>\n+  value?: MessageType<Message>\n+}\n+\n+export function formatMessagePart<Message = string>(\n   ctx: MessageContext<Message>,\n   node: Node\n ): MessageType<Message> {\n-  const type = node.t || node.type\n+  const type = resolveType(node)\n   switch (type) {\n     case NodeTypes.Text: {\n-      const text = node as TextNode\n-      return (text.v || text.value) as MessageType<Message>\n+      return resolveValue<Message>(node as NodeValue<Message>, type)\n     }\n     case NodeTypes.Literal: {\n-      const literal = node as LiteralNode\n-      return (literal.v || literal.value) as MessageType<Message>\n+      return resolveValue<Message>(node as NodeValue<Message>, type)\n     }\n     case NodeTypes.Named: {\n       const named = node as NamedNode\n-      return ctx.interpolate(ctx.named(named.k || named.key))\n+      if (hasOwn(named, 'k') && named.k) {\n+        return ctx.interpolate(ctx.named(named.k))\n+      }\n+      if (hasOwn(named, 'key') && named.key) {\n+        return ctx.interpolate(ctx.named(named.key))\n+      }\n+      throw createUnhandleNodeError(type)\n     }\n     case NodeTypes.List: {\n       const list = node as ListNode\n-      return ctx.interpolate(ctx.list(list.i != null ? list.i : list.index))\n+      if (hasOwn(list, 'i') && isNumber(list.i)) {\n+        return ctx.interpolate(ctx.list(list.i))\n+      }\n+      if (hasOwn(list, 'index') && isNumber(list.index)) {\n+        return ctx.interpolate(ctx.list(list.index))\n+      }\n+      throw createUnhandleNodeError(type)\n     }\n     case NodeTypes.Linked: {\n       const linked = node as LinkedNode\n-      const modifier = linked.m || linked.modifier\n+      const modifier = resolveLinkedModifier(linked)\n+      const key = resolveLinkedKey(linked)\n       return ctx.linked(\n-        formatMessagePart(ctx, linked.k || linked.key) as string,\n+        formatMessagePart(ctx, key!) as string,\n         modifier ? (formatMessagePart(ctx, modifier) as string) : undefined,\n         ctx.type\n       )\n     }\n     case NodeTypes.LinkedKey: {\n-      const linkedKey = node as LinkedKeyNode\n-      return (linkedKey.v || linkedKey.value) as MessageType<Message>\n+      return resolveValue<Message>(node as NodeValue<Message>, type)\n     }\n     case NodeTypes.LinkedModifier: {\n-      const linkedModifier = node as LinkedModifierNode\n-      return (linkedModifier.v || linkedModifier.value) as MessageType<Message>\n+      return resolveValue<Message>(node as NodeValue<Message>, type)\n     }\n     default:\n-      throw new Error(`unhandled node type on format message part: ${type}`)\n+      throw new Error(`unhandled node on format message part: ${type}`)\n+  }\n+}\n+\n+const PROPS_TYPE = ['t', 'type']\n+\n+export function resolveType(node: Node) {\n+  return resolveProps<NodeTypes>(node, PROPS_TYPE)\n+}\n+\n+const PROPS_VALUE = ['v', 'value']\n+\n+function resolveValue<Message = string>(\n+  node: { v?: MessageType<Message>; value?: MessageType<Message> },\n+  type: NodeTypes\n+): MessageType<Message> {\n+  const resolved = resolveProps<Message>(\n+    node as Node,\n+    PROPS_VALUE\n+  ) as MessageType<Message>\n+  if (resolved) {\n+    return resolved\n+  } else {\n+    throw createUnhandleNodeError(type)\n+  }\n+}\n+\n+const PROPS_MODIFIER = ['m', 'modifier']\n+\n+function resolveLinkedModifier(node: LinkedNode) {\n+  return resolveProps<LinkedModifierNode>(node, PROPS_MODIFIER)\n+}\n+\n+const PROPS_KEY = ['k', 'key']\n+\n+function resolveLinkedKey(node: LinkedNode) {\n+  const resolved = resolveProps<LinkedNode['key']>(node, PROPS_KEY)\n+  if (resolved) {\n+    return resolved\n+  } else {\n+    throw createUnhandleNodeError(NodeTypes.Linked)\n   }\n }\n+\n+function resolveProps<T = string, Default = undefined>(\n+  node: Node,\n+  props: string[],\n+  defaultValue?: Default\n+): T | Default {\n+  for (let i = 0; i < props.length; i++) {\n+    const prop = props[i]\n+    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n+    if (hasOwn(node, prop) && (node as any)[prop] != null) {\n+      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n+      return (node as any)[prop] as T\n+    }\n+  }\n+  return defaultValue as Default\n+}\n+\n+function createUnhandleNodeError(type: NodeTypes) {\n+  return new Error(`unhandled node type: ${type}`)\n+}"
            },
            {
                "sha": "3709a12820fce54e1193a28114c0ffa4f1cede1b",
                "filename": "packages/core-base/test/format.test.ts",
                "status": "modified",
                "additions": 472,
                "deletions": 2,
                "changes": 474,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Ftest%2Fformat.test.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Ftest%2Fformat.test.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Ftest%2Fformat.test.ts?ref=72f0d323006fc7363b18cab62d4522dadd874411",
                "patch": "@@ -1,7 +1,24 @@\n-import { baseCompile as compile } from '@intlify/message-compiler'\n-import { format } from '../src/format'\n+import { baseCompile as compile, NodeTypes } from '@intlify/message-compiler'\n+import {\n+  format,\n+  formatMessagePart,\n+  formatMessageParts,\n+  formatParts\n+} from '../src/format'\n import { createMessageContext as context } from '../src/runtime'\n \n+import type {\n+  LinkedKeyNode,\n+  LinkedModifierNode,\n+  LinkedNode,\n+  ListNode,\n+  LiteralNode,\n+  MessageNode,\n+  NamedNode,\n+  ResourceNode,\n+  TextNode\n+} from '@intlify/message-compiler'\n+\n describe('features', () => {\n   test('text: hello world', () => {\n     const { ast } = compile('hello world', { jit: true })\n@@ -143,3 +160,456 @@ describe('edge cases', () => {\n     expect(msg(ctx)).toBe('')\n   })\n })\n+\n+describe('formatParts', () => {\n+  test('prop: body', () => {\n+    const node: ResourceNode = {\n+      type: NodeTypes.Resource,\n+      body: {\n+        type: NodeTypes.Message,\n+        items: [\n+          {\n+            type: NodeTypes.Text,\n+            value: 'hello world'\n+          }\n+        ]\n+      }\n+    }\n+\n+    const ctx = context()\n+    expect(formatParts(ctx, node)).toBe('hello world')\n+  })\n+\n+  test('prop: b', () => {\n+    const node: ResourceNode = {\n+      type: NodeTypes.Resource,\n+      body: {\n+        type: NodeTypes.Message,\n+        items: [\n+          {\n+            type: NodeTypes.Text,\n+            value: 'hello world'\n+          }\n+        ]\n+      }\n+    }\n+\n+    const ctx = context()\n+    expect(formatParts(ctx, node)).toBe('hello world')\n+  })\n+\n+  test(`body has plural prop cases`, () => {\n+    const node: ResourceNode = {\n+      type: NodeTypes.Resource,\n+      body: {\n+        type: NodeTypes.Plural,\n+        cases: [\n+          {\n+            type: NodeTypes.Message,\n+            items: [\n+              {\n+                type: NodeTypes.Text,\n+                value: 'hello'\n+              }\n+            ]\n+          },\n+          {\n+            type: NodeTypes.Message,\n+            items: [\n+              {\n+                type: NodeTypes.Text,\n+                value: 'world'\n+              }\n+            ]\n+          }\n+        ]\n+      }\n+    }\n+\n+    const ctx = context({\n+      pluralIndex: 2\n+    })\n+    expect(formatParts(ctx, node)).toBe('world')\n+  })\n+\n+  test(`body has plural prop c`, () => {\n+    const node: ResourceNode = {\n+      type: NodeTypes.Resource,\n+      // @ts-ignore\n+      body: {\n+        type: NodeTypes.Plural,\n+        c: [\n+          {\n+            type: NodeTypes.Message,\n+            items: [\n+              {\n+                type: NodeTypes.Text,\n+                value: 'hello'\n+              }\n+            ]\n+          },\n+          {\n+            type: NodeTypes.Message,\n+            items: [\n+              {\n+                type: NodeTypes.Text,\n+                value: 'world'\n+              }\n+            ]\n+          }\n+        ]\n+      }\n+    }\n+\n+    const ctx = context({\n+      pluralIndex: 1\n+    })\n+    expect(formatParts(ctx, node)).toBe('hello')\n+  })\n+\n+  test('not found prop body', () => {\n+    // @ts-ignore\n+    const node: ResourceNode = {\n+      type: NodeTypes.Resource\n+    }\n+\n+    const ctx = context()\n+    expect(() => formatParts(ctx, node)).toThrow(\n+      `unhandled node type: ${NodeTypes.Resource}`\n+    )\n+  })\n+})\n+\n+describe('formatMessageParts', () => {\n+  test('prop: static', () => {\n+    const node: MessageNode = {\n+      type: NodeTypes.Message,\n+      static: 'hello world',\n+      items: []\n+    }\n+    const ctx = context()\n+    expect(formatMessageParts(ctx, node)).toBe('hello world')\n+  })\n+\n+  test('prop: s', () => {\n+    const node: MessageNode = {\n+      type: NodeTypes.Message,\n+      s: 'hello world',\n+      items: []\n+    }\n+    const ctx = context()\n+    expect(formatMessageParts(ctx, node)).toBe('hello world')\n+  })\n+\n+  test('prop: items', () => {\n+    const node: MessageNode = {\n+      type: NodeTypes.Message,\n+      items: [\n+        {\n+          type: NodeTypes.Text,\n+          value: 'hello'\n+        },\n+        {\n+          type: NodeTypes.Text,\n+          value: 'world'\n+        }\n+      ]\n+    }\n+    const ctx = context()\n+    expect(formatMessageParts(ctx, node)).toEqual('helloworld')\n+  })\n+\n+  test('prop: i', () => {\n+    // @ts-ignore\n+    const node: MessageNode = {\n+      type: NodeTypes.Message,\n+      i: [\n+        {\n+          type: NodeTypes.Text,\n+          value: 'hello'\n+        },\n+        {\n+          type: NodeTypes.Text,\n+          value: 'world'\n+        }\n+      ]\n+    }\n+    const ctx = context()\n+    expect(formatMessageParts(ctx, node)).toEqual('helloworld')\n+  })\n+})\n+\n+describe('formatMessagePart', () => {\n+  describe('text node', () => {\n+    test('prop: value', () => {\n+      const node: TextNode = {\n+        type: NodeTypes.Text,\n+        value: 'hello world'\n+      }\n+      const ctx = context()\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test('prop: v', () => {\n+      const node: TextNode = {\n+        type: NodeTypes.Text,\n+        v: 'hello world'\n+      }\n+      const ctx = context()\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test(`prop 'value' and 'v' not found`, () => {\n+      const node: TextNode = {\n+        type: NodeTypes.Text\n+      }\n+      const ctx = context()\n+      expect(() => formatMessagePart(ctx, node)).toThrow(\n+        `unhandled node type: ${NodeTypes.Text}`\n+      )\n+    })\n+  })\n+\n+  describe('literal node', () => {\n+    test('prop: value', () => {\n+      const node: LiteralNode = {\n+        type: NodeTypes.Literal,\n+        value: 'hello world'\n+      }\n+      const ctx = context()\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test('prop: v', () => {\n+      const node: LiteralNode = {\n+        type: NodeTypes.Literal,\n+        v: 'hello world'\n+      }\n+      const ctx = context()\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test(`prop 'value' and 'v' not found`, () => {\n+      const node: LiteralNode = {\n+        type: NodeTypes.Literal\n+      }\n+      const ctx = context()\n+      expect(() => formatMessagePart(ctx, node)).toThrow(\n+        `unhandled node type: ${NodeTypes.Literal}`\n+      )\n+    })\n+  })\n+\n+  describe('named node', () => {\n+    test('prop: key', () => {\n+      const node: NamedNode = {\n+        type: NodeTypes.Named,\n+        key: 'key'\n+      }\n+      const ctx = context({\n+        named: { key: 'hello world' }\n+      })\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test('prop: k', () => {\n+      // @ts-ignore\n+      const node: NamedNode = {\n+        type: NodeTypes.Named,\n+        k: 'key'\n+      }\n+      const ctx = context({\n+        named: { key: 'hello world' }\n+      })\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test(`prop 'key' and 'k' not found`, () => {\n+      // @ts-ignore\n+      const node: NamedNode = {\n+        type: NodeTypes.Named\n+      }\n+      const ctx = context()\n+      expect(() => formatMessagePart(ctx, node)).toThrow(\n+        `unhandled node type: ${NodeTypes.Named}`\n+      )\n+    })\n+  })\n+\n+  describe('list node', () => {\n+    test('prop: index', () => {\n+      const node: ListNode = {\n+        type: NodeTypes.List,\n+        index: 0\n+      }\n+      const ctx = context({\n+        list: ['hello world']\n+      })\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test('prop: i', () => {\n+      // @ts-ignore\n+      const node: ListNode = {\n+        type: NodeTypes.List,\n+        i: 0\n+      }\n+      const ctx = context({\n+        list: ['hello world']\n+      })\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test(`prop 'index' and 'i' not found`, () => {\n+      // @ts-ignore\n+      const node: ListNode = {\n+        type: NodeTypes.List\n+      }\n+      const ctx = context()\n+      expect(() => formatMessagePart(ctx, node)).toThrow(\n+        `unhandled node type: ${NodeTypes.List}`\n+      )\n+    })\n+  })\n+\n+  describe('linked key node', () => {\n+    test('prop: value', () => {\n+      const node: LinkedKeyNode = {\n+        type: NodeTypes.LinkedKey,\n+        value: 'hello world'\n+      }\n+      const ctx = context()\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test('prop: v', () => {\n+      // @ts-ignore\n+      const node: LinkedKeyNode = {\n+        type: NodeTypes.LinkedKey,\n+        v: 'hello world'\n+      }\n+      const ctx = context()\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test(`prop 'value' and 'v' not found`, () => {\n+      // @ts-ignore\n+      const node: LinkedKeyNode = {\n+        type: NodeTypes.LinkedKey\n+      }\n+      const ctx = context()\n+      expect(() => formatMessagePart(ctx, node)).toThrow(\n+        `unhandled node type: ${NodeTypes.LinkedKey}`\n+      )\n+    })\n+  })\n+\n+  describe('linked modifier node', () => {\n+    test('prop: value', () => {\n+      const node: LinkedModifierNode = {\n+        type: NodeTypes.LinkedModifier,\n+        value: 'hello world'\n+      }\n+      const ctx = context()\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test('prop: v', () => {\n+      // @ts-ignore\n+      const node: LinkedModifierNode = {\n+        type: NodeTypes.LinkedModifier,\n+        v: 'hello world'\n+      }\n+      const ctx = context()\n+      expect(formatMessagePart(ctx, node)).toBe('hello world')\n+    })\n+\n+    test(`prop 'value' and 'v' not found`, () => {\n+      // @ts-ignore\n+      const node: LinkedModifierNode = {\n+        type: NodeTypes.LinkedModifier\n+      }\n+      const ctx = context()\n+      expect(() => formatMessagePart(ctx, node)).toThrow(\n+        `unhandled node type: ${NodeTypes.LinkedModifier}`\n+      )\n+    })\n+  })\n+\n+  describe('linked node', () => {\n+    test('prop: modifier, key', () => {\n+      const node: LinkedNode = {\n+        type: NodeTypes.Linked,\n+        modifier: {\n+          type: NodeTypes.LinkedModifier,\n+          value: 'upper'\n+        },\n+        key: {\n+          type: NodeTypes.LinkedKey,\n+          value: 'name'\n+        }\n+      }\n+      const ctx = context({\n+        modifiers: {\n+          upper: (val: string) => val.toUpperCase()\n+        },\n+        messages: {\n+          name: () => 'kazupon'\n+        }\n+      })\n+      expect(formatMessagePart(ctx, node)).toBe('KAZUPON')\n+    })\n+\n+    test('prop: m, k', () => {\n+      // @ts-ignore\n+      const node: LinkedNode = {\n+        type: NodeTypes.Linked,\n+        m: {\n+          type: NodeTypes.LinkedModifier,\n+          value: 'upper'\n+        },\n+        k: {\n+          type: NodeTypes.LinkedKey,\n+          value: 'name'\n+        }\n+      }\n+      const ctx = context({\n+        modifiers: {\n+          upper: (val: string) => val.toUpperCase()\n+        },\n+        messages: {\n+          name: () => 'kazupon'\n+        }\n+      })\n+      expect(formatMessagePart(ctx, node)).toBe('KAZUPON')\n+    })\n+\n+    test(`prop 'key' not found`, () => {\n+      // @ts-ignore\n+      const node: LinkedNode = {\n+        type: NodeTypes.Linked\n+      }\n+      const ctx = context({\n+        modifiers: {\n+          upper: (val: string) => val.toUpperCase()\n+        },\n+        messages: {\n+          name: () => 'kazupon'\n+        }\n+      })\n+      expect(() => formatMessagePart(ctx, node)).toThrow(\n+        `unhandled node type: ${NodeTypes.Linked}`\n+      )\n+    })\n+  })\n+\n+  test('unhandled node', () => {\n+    const node = {\n+      type: -1\n+    }\n+    const ctx = context()\n+    expect(() => formatMessagePart(ctx, node)).toThrow(\n+      `unhandled node on format message part: -1`\n+    )\n+  })\n+})"
            },
            {
                "sha": "1a39aa0f5cfbae7f3d647f460a41858d3ff380c0",
                "filename": "packages/core-base/test/issues.test.ts",
                "status": "added",
                "additions": 58,
                "deletions": 0,
                "changes": 58,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Ftest%2Fissues.test.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fcore-base%2Ftest%2Fissues.test.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fcore-base%2Ftest%2Fissues.test.ts?ref=72f0d323006fc7363b18cab62d4522dadd874411",
                "patch": "@@ -0,0 +1,58 @@\n+import { format } from '../src/format'\n+import { createMessageContext as context } from '../src/runtime'\n+\n+import { NodeTypes, ResourceNode } from '@intlify/message-compiler'\n+\n+describe('CVE-2024-52809', () => {\n+  function attackGetter() {\n+    return 'polluted'\n+  }\n+\n+  afterEach(() => {\n+    // @ts-ignore -- initialize polluted property\n+    delete Object.prototype.static\n+  })\n+\n+  test('success', () => {\n+    Object.defineProperty(Object.prototype, 'static', {\n+      configurable: true,\n+      get: attackGetter\n+    })\n+    const ast: ResourceNode = {\n+      type: NodeTypes.Resource,\n+      body: {\n+        type: NodeTypes.Message,\n+        static: 'hello world',\n+        items: [\n+          {\n+            type: NodeTypes.Text\n+          }\n+        ]\n+      }\n+    }\n+    const msg = format(ast)\n+    const ctx = context()\n+    expect(msg(ctx)).toEqual('hello world')\n+  })\n+\n+  test('error', () => {\n+    Object.defineProperty(Object.prototype, 'static', {\n+      configurable: true,\n+      get: attackGetter\n+    })\n+    const ast: ResourceNode = {\n+      type: NodeTypes.Resource,\n+      body: {\n+        type: NodeTypes.Message,\n+        items: [\n+          {\n+            type: NodeTypes.Text\n+          }\n+        ]\n+      }\n+    }\n+    const msg = format(ast)\n+    const ctx = context()\n+    expect(() => msg(ctx)).toThrow(`unhandled node type: ${NodeTypes.Text}`)\n+  })\n+})"
            },
            {
                "sha": "8ca2c22d19a73d1b447e1cd3e73aa9936ac15e10",
                "filename": "packages/vue-i18n-core/test/issues.test.ts",
                "status": "modified",
                "additions": 69,
                "deletions": 1,
                "changes": 70,
                "blob_url": "https://github.com/intlify/vue-i18n/blob/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fvue-i18n-core%2Ftest%2Fissues.test.ts",
                "raw_url": "https://github.com/intlify/vue-i18n/raw/72f0d323006fc7363b18cab62d4522dadd874411/packages%2Fvue-i18n-core%2Ftest%2Fissues.test.ts",
                "contents_url": "https://api.github.com/repos/intlify/vue-i18n/contents/packages%2Fvue-i18n-core%2Ftest%2Fissues.test.ts?ref=72f0d323006fc7363b18cab62d4522dadd874411",
                "patch": "@@ -1406,7 +1406,7 @@ test('#1912', async () => {\n   expect(el?.innerHTML).include(`No apples found`)\n })\n \n-test('#1972', async () => {\n+test('#1972', () => {\n   const i18n = createI18n({\n     legacy: false,\n     locale: 'en',\n@@ -1418,3 +1418,71 @@ test('#1972', async () => {\n   })\n   expect(i18n.global.t('test', 0)).toEqual('')\n })\n+\n+describe('CVE-2024-52809', () => {\n+  function attackGetter() {\n+    return 'polluted'\n+  }\n+\n+  afterEach(() => {\n+    // @ts-ignore -- initialize polluted property\n+    delete Object.prototype.static\n+  })\n+\n+  test('success', () => {\n+    Object.defineProperty(Object.prototype, 'static', {\n+      configurable: true,\n+      get: attackGetter\n+    })\n+    const en = {\n+      hello: {\n+        type: 0,\n+        body: {\n+          type: 2,\n+          static: 'hello world',\n+          items: [\n+            {\n+              type: 3\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    const i18n = createI18n({\n+      legacy: false,\n+      locale: 'en',\n+      messages: {\n+        en\n+      }\n+    })\n+    expect(i18n.global.t('hello')).toEqual('hello world')\n+  })\n+\n+  test('error', () => {\n+    Object.defineProperty(Object.prototype, 'static', {\n+      configurable: true,\n+      get: attackGetter\n+    })\n+    const en = {\n+      hello: {\n+        type: 0,\n+        body: {\n+          type: 2,\n+          items: [\n+            {\n+              type: 3\n+            }\n+          ]\n+        }\n+      }\n+    }\n+    const i18n = createI18n({\n+      legacy: false,\n+      locale: 'en',\n+      messages: {\n+        en\n+      }\n+    })\n+    expect(() => i18n.global.t('hello')).toThrow(`unhandled node type: 3`)\n+  })\n+})"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/drakkan/sftpgo/commits/f30a9a2095bf90c0661b04fe038e3b7efc788bc6",
        "url": "https://api.github.com/repos/drakkan/sftpgo/commits/f30a9a2095bf90c0661b04fe038e3b7efc788bc6",
        "html_url": "https://github.com/drakkan/sftpgo/commit/f30a9a2095bf90c0661b04fe038e3b7efc788bc6",
        "message": "OIDC cookie: use a cryptographically secure random string\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
        "files": [
            {
                "sha": "88a599d377c76bcb1b57f3d67195d5801145d1d7",
                "filename": "internal/httpd/oauth2.go",
                "status": "modified",
                "additions": 1,
                "deletions": 5,
                "changes": 6,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/f30a9a2095bf90c0661b04fe038e3b7efc788bc6/internal%2Fhttpd%2Foauth2.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/f30a9a2095bf90c0661b04fe038e3b7efc788bc6/internal%2Fhttpd%2Foauth2.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fhttpd%2Foauth2.go?ref=f30a9a2095bf90c0661b04fe038e3b7efc788bc6",
                "patch": "@@ -15,8 +15,6 @@\n package httpd\n \n import (\n-\t\"crypto/sha256\"\n-\t\"encoding/hex\"\n \t\"encoding/json\"\n \t\"errors\"\n \t\"sync\"\n@@ -53,10 +51,8 @@ type oauth2PendingAuth struct {\n }\n \n func newOAuth2PendingAuth(provider int, redirectURL, clientID string, clientSecret *kms.Secret) oauth2PendingAuth {\n-\tstate := sha256.Sum256(util.GenerateRandomBytes(32))\n-\n \treturn oauth2PendingAuth{\n-\t\tState:        hex.EncodeToString(state[:]),\n+\t\tState:        util.GenerateOpaqueString(),\n \t\tProvider:     provider,\n \t\tClientID:     clientID,\n \t\tClientSecret: clientSecret,"
            },
            {
                "sha": "1bdaccab528b8fab5d32bf2b2bc2bcc5737fb94c",
                "filename": "internal/httpd/oidc.go",
                "status": "modified",
                "additions": 3,
                "deletions": 8,
                "changes": 11,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/f30a9a2095bf90c0661b04fe038e3b7efc788bc6/internal%2Fhttpd%2Foidc.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/f30a9a2095bf90c0661b04fe038e3b7efc788bc6/internal%2Fhttpd%2Foidc.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fhttpd%2Foidc.go?ref=f30a9a2095bf90c0661b04fe038e3b7efc788bc6",
                "patch": "@@ -16,8 +16,6 @@ package httpd\n \n import (\n \t\"context\"\n-\t\"crypto/sha256\"\n-\t\"encoding/hex\"\n \t\"errors\"\n \t\"fmt\"\n \t\"net/http\"\n@@ -204,12 +202,9 @@ type oidcPendingAuth struct {\n }\n \n func newOIDCPendingAuth(audience tokenAudience) oidcPendingAuth {\n-\tstate := sha256.Sum256(util.GenerateRandomBytes(32))\n-\tnonce := util.GenerateUniqueID()\n-\n \treturn oidcPendingAuth{\n-\t\tState:    hex.EncodeToString(state[:]),\n-\t\tNonce:    nonce,\n+\t\tState:    util.GenerateOpaqueString(),\n+\t\tNonce:    util.GenerateOpaqueString(),\n \t\tAudience: audience,\n \t\tIssuedAt: util.GetTimeAsMsSinceEpoch(time.Now()),\n \t}\n@@ -684,7 +679,7 @@ func (s *httpdServer) handleOIDCRedirect(w http.ResponseWriter, r *http.Request)\n \t\tRefreshToken: oauth2Token.RefreshToken,\n \t\tIDToken:      rawIDToken,\n \t\tNonce:        idToken.Nonce,\n-\t\tCookie:       xid.New().String(),\n+\t\tCookie:       util.GenerateOpaqueString(),\n \t}\n \tif !oauth2Token.Expiry.IsZero() {\n \t\ttoken.ExpiresAt = util.GetTimeAsMsSinceEpoch(oauth2Token.Expiry)"
            },
            {
                "sha": "9a098b361989d130b2a84c261af89347049d96a0",
                "filename": "internal/httpd/oidc_test.go",
                "status": "modified",
                "additions": 11,
                "deletions": 11,
                "changes": 22,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/f30a9a2095bf90c0661b04fe038e3b7efc788bc6/internal%2Fhttpd%2Foidc_test.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/f30a9a2095bf90c0661b04fe038e3b7efc788bc6/internal%2Fhttpd%2Foidc_test.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fhttpd%2Foidc_test.go?ref=f30a9a2095bf90c0661b04fe038e3b7efc788bc6",
                "patch": "@@ -152,8 +152,8 @@ func TestOIDCLoginLogout(t *testing.T) {\n \tassert.Contains(t, rr.Body.String(), util.I18nInvalidAuth)\n \n \texpiredAuthReq := oidcPendingAuth{\n-\t\tState:    xid.New().String(),\n-\t\tNonce:    xid.New().String(),\n+\t\tState:    util.GenerateOpaqueString(),\n+\t\tNonce:    util.GenerateOpaqueString(),\n \t\tAudience: tokenAudienceWebClient,\n \t\tIssuedAt: util.GetTimeAsMsSinceEpoch(time.Now().Add(-10 * time.Minute)),\n \t}\n@@ -564,7 +564,7 @@ func TestOIDCRefreshToken(t *testing.T) {\n \tr, err := http.NewRequest(http.MethodGet, webUsersPath, nil)\n \tassert.NoError(t, err)\n \ttoken := oidcToken{\n-\t\tCookie:      xid.New().String(),\n+\t\tCookie:      util.GenerateOpaqueString(),\n \t\tAccessToken: xid.New().String(),\n \t\tTokenType:   \"Bearer\",\n \t\tExpiresAt:   util.GetTimeAsMsSinceEpoch(time.Now().Add(-1 * time.Minute)),\n@@ -668,7 +668,7 @@ func TestOIDCRefreshToken(t *testing.T) {\n \n func TestOIDCRefreshUser(t *testing.T) {\n \ttoken := oidcToken{\n-\t\tCookie:      xid.New().String(),\n+\t\tCookie:      util.GenerateOpaqueString(),\n \t\tAccessToken: xid.New().String(),\n \t\tTokenType:   \"Bearer\",\n \t\tExpiresAt:   util.GetTimeAsMsSinceEpoch(time.Now().Add(1 * time.Minute)),\n@@ -782,7 +782,7 @@ func TestValidateOIDCToken(t *testing.T) {\n \t\t},\n \t}\n \ttoken := oidcToken{\n-\t\tCookie:      xid.New().String(),\n+\t\tCookie:      util.GenerateOpaqueString(),\n \t\tAccessToken: xid.New().String(),\n \t\tExpiresAt:   util.GetTimeAsMsSinceEpoch(time.Now().Add(-2 * time.Minute)),\n \t}\n@@ -798,8 +798,8 @@ func TestValidateOIDCToken(t *testing.T) {\n \n \tserver.tokenAuth = jwtauth.New(\"PS256\", util.GenerateRandomBytes(32), nil)\n \ttoken = oidcToken{\n-\t\tCookie:      xid.New().String(),\n-\t\tAccessToken: xid.New().String(),\n+\t\tCookie:      util.GenerateOpaqueString(),\n+\t\tAccessToken: util.GenerateUniqueID(),\n \t}\n \toidcMgr.addToken(token)\n \trr = httptest.NewRecorder()\n@@ -813,7 +813,7 @@ func TestValidateOIDCToken(t *testing.T) {\n \tassert.Len(t, oidcMgr.tokens, 0)\n \n \ttoken = oidcToken{\n-\t\tCookie:      xid.New().String(),\n+\t\tCookie:      util.GenerateOpaqueString(),\n \t\tAccessToken: xid.New().String(),\n \t\tRole:        \"admin\",\n \t}\n@@ -1107,7 +1107,7 @@ func TestMemoryOIDCManager(t *testing.T) {\n \t\tAccessToken: xid.New().String(),\n \t\tNonce:       xid.New().String(),\n \t\tSessionID:   xid.New().String(),\n-\t\tCookie:      xid.New().String(),\n+\t\tCookie:      util.GenerateOpaqueString(),\n \t\tUsername:    xid.New().String(),\n \t\tRole:        \"admin\",\n \t\tPermissions: []string{dataprovider.PermAdminAny},\n@@ -1157,7 +1157,7 @@ func TestMemoryOIDCManager(t *testing.T) {\n \ttoken.UsedAt = usedAt\n \toidcMgr.tokens[token.Cookie] = token\n \tnewToken := oidcToken{\n-\t\tCookie: xid.New().String(),\n+\t\tCookie: util.GenerateOpaqueString(),\n \t}\n \toidcMgr.addToken(newToken)\n \toidcMgr.cleanup()\n@@ -1663,7 +1663,7 @@ func TestDbOIDCManager(t *testing.T) {\n \t}\n \n \ttoken := oidcToken{\n-\t\tCookie:       xid.New().String(),\n+\t\tCookie:       util.GenerateOpaqueString(),\n \t\tAccessToken:  xid.New().String(),\n \t\tTokenType:    \"Bearer\",\n \t\tRefreshToken: xid.New().String(),"
            },
            {
                "sha": "9f4f14dca48e52d8483b1e5eed57804444abe65f",
                "filename": "internal/util/util.go",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/f30a9a2095bf90c0661b04fe038e3b7efc788bc6/internal%2Futil%2Futil.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/f30a9a2095bf90c0661b04fe038e3b7efc788bc6/internal%2Futil%2Futil.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Futil%2Futil.go?ref=f30a9a2095bf90c0661b04fe038e3b7efc788bc6",
                "patch": "@@ -22,8 +22,10 @@ import (\n \t\"crypto/elliptic\"\n \t\"crypto/rand\"\n \t\"crypto/rsa\"\n+\t\"crypto/sha256\"\n \t\"crypto/tls\"\n \t\"crypto/x509\"\n+\t\"encoding/hex\"\n \t\"encoding/json\"\n \t\"encoding/pem\"\n \t\"errors\"\n@@ -550,7 +552,7 @@ func createDirPathIfMissing(file string, perm os.FileMode) error {\n \treturn nil\n }\n \n-// GenerateRandomBytes generates the secret to use for JWT auth\n+// GenerateRandomBytes generates random bytes with the specified length\n func GenerateRandomBytes(length int) []byte {\n \tb := make([]byte, length)\n \t_, err := io.ReadFull(rand.Reader, b)\n@@ -560,6 +562,12 @@ func GenerateRandomBytes(length int) []byte {\n \treturn b\n }\n \n+// GenerateOpaqueString generates a cryptographically secure opaque string\n+func GenerateOpaqueString() string {\n+\trandomBytes := sha256.Sum256(GenerateRandomBytes(32))\n+\treturn hex.EncodeToString(randomBytes[:])\n+}\n+\n // GenerateUniqueID returns an unique ID\n func GenerateUniqueID() string {\n \tu, err := uuid.NewRandom()"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ffmpeg/ffmpeg/commits/0895ef0d6d6406ee6cd158fc4d47d80f201b8e9c",
        "url": "https://api.github.com/repos/FFmpeg/FFmpeg/commits/0895ef0d6d6406ee6cd158fc4d47d80f201b8e9c",
        "html_url": "https://github.com/FFmpeg/FFmpeg/commit/0895ef0d6d6406ee6cd158fc4d47d80f201b8e9c",
        "message": "avcodec/speexdec: further check for sane frame_size values\n\nPrevent potential integer overflows.\n\nSigned-off-by: James Almer <jamrial@gmail.com>",
        "files": [
            {
                "sha": "ba0df687de367011ae8287daf7e43642cc790ea8",
                "filename": "libavcodec/speexdec.c",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/FFmpeg/FFmpeg/blob/0895ef0d6d6406ee6cd158fc4d47d80f201b8e9c/libavcodec%2Fspeexdec.c",
                "raw_url": "https://github.com/FFmpeg/FFmpeg/raw/0895ef0d6d6406ee6cd158fc4d47d80f201b8e9c/libavcodec%2Fspeexdec.c",
                "contents_url": "https://api.github.com/repos/FFmpeg/FFmpeg/contents/libavcodec%2Fspeexdec.c?ref=0895ef0d6d6406ee6cd158fc4d47d80f201b8e9c",
                "patch": "@@ -1421,9 +1421,10 @@ static int parse_speex_extradata(AVCodecContext *avctx,\n         return AVERROR_INVALIDDATA;\n     s->bitrate = bytestream_get_le32(&buf);\n     s->frame_size = bytestream_get_le32(&buf);\n-    if (s->frame_size < NB_FRAME_SIZE << (s->mode > 0))\n+    if (s->frame_size < NB_FRAME_SIZE << (s->mode > 0) ||\n+        s->frame_size >     INT32_MAX >> (s->mode > 0))\n         return AVERROR_INVALIDDATA;\n-    s->frame_size *= 1 + (s->mode > 0);\n+    s->frame_size <<= (s->mode > 0);\n     s->vbr = bytestream_get_le32(&buf);\n     s->frames_per_packet = bytestream_get_le32(&buf);\n     if (s->frames_per_packet <= 0 ||"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ffmpeg/ffmpeg/commits/4513300989502090c4fd6560544dce399a8cd53c",
        "url": "https://api.github.com/repos/FFmpeg/FFmpeg/commits/4513300989502090c4fd6560544dce399a8cd53c",
        "html_url": "https://github.com/FFmpeg/FFmpeg/commit/4513300989502090c4fd6560544dce399a8cd53c",
        "message": "avcodec/rkmppdec: Fix double-free on error\n\nAfter having created the AVBuffer that is put into frame->buf[0],\nownership of several objects (namely an AVDRMFrameDescriptor,\nan MppFrame and some AVBufferRefs framecontextref and decoder_ref)\nhas passed to the AVBuffer and therefore to the frame.\nYet it has nevertheless been freed manually on error\nafterwards, which would lead to a double-free as soon\nas the AVFrame is unreferenced.\n\nSigned-off-by: Andreas Rheinhardt <andreas.rheinhardt@outlook.com>",
        "files": [
            {
                "sha": "6889545b2042d5c56857a758e2d3b69965c9c54a",
                "filename": "libavcodec/rkmppdec.c",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/FFmpeg/FFmpeg/blob/4513300989502090c4fd6560544dce399a8cd53c/libavcodec%2Frkmppdec.c",
                "raw_url": "https://github.com/FFmpeg/FFmpeg/raw/4513300989502090c4fd6560544dce399a8cd53c/libavcodec%2Frkmppdec.c",
                "contents_url": "https://api.github.com/repos/FFmpeg/FFmpeg/contents/libavcodec%2Frkmppdec.c?ref=4513300989502090c4fd6560544dce399a8cd53c",
                "patch": "@@ -463,8 +463,8 @@ static int rkmpp_retrieve_frame(AVCodecContext *avctx, AVFrame *frame)\n \n             frame->hw_frames_ctx = av_buffer_ref(decoder->frames_ref);\n             if (!frame->hw_frames_ctx) {\n-                ret = AVERROR(ENOMEM);\n-                goto fail;\n+                av_frame_unref(frame);\n+                return AVERROR(ENOMEM);\n             }\n \n             return 0;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ffmpeg/ffmpeg/commits/09e6840cf7a3ee07a73c3ae88a020bf27ca1a667",
        "url": "https://api.github.com/repos/FFmpeg/FFmpeg/commits/09e6840cf7a3ee07a73c3ae88a020bf27ca1a667",
        "html_url": "https://github.com/FFmpeg/FFmpeg/commit/09e6840cf7a3ee07a73c3ae88a020bf27ca1a667",
        "message": "avcodec/ppc/vp8dsp_altivec: Fix out-of-bounds access\n\nh_subpel_filters_inner[i] and h_subpel_filters_outer[i / 2]\nbelong together and the former allows the range 0..6,\nso the latter needs to support 0..3. But it has only three\nelements. Add another one.\nThe value for the last element has been guesstimated\nfrom subpel_filters in libavcodec/vp8dsp.c.\n\nThis is also intended to fix FATE-failures with UBSan here:\nhttps://fate.ffmpeg.org/report.cgi?time=20240312011016&slot=ppc-linux-gcc-13.2-ubsan-altivec-qemu\n\nTested-by: Sean McGovern <gseanmcg@gmail.com>\nSigned-off-by: Andreas Rheinhardt <andreas.rheinhardt@outlook.com>",
        "files": [
            {
                "sha": "061914fc385033ef21f7d2766e5e9a32d40846a9",
                "filename": "libavcodec/ppc/vp8dsp_altivec.c",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/FFmpeg/FFmpeg/blob/09e6840cf7a3ee07a73c3ae88a020bf27ca1a667/libavcodec%2Fppc%2Fvp8dsp_altivec.c",
                "raw_url": "https://github.com/FFmpeg/FFmpeg/raw/09e6840cf7a3ee07a73c3ae88a020bf27ca1a667/libavcodec%2Fppc%2Fvp8dsp_altivec.c",
                "contents_url": "https://api.github.com/repos/FFmpeg/FFmpeg/contents/libavcodec%2Fppc%2Fvp8dsp_altivec.c?ref=09e6840cf7a3ee07a73c3ae88a020bf27ca1a667",
                "patch": "@@ -50,11 +50,12 @@ static const vec_s8 h_subpel_filters_inner[7] =\n // for 6tap filters, these are the outer two taps\n // The zeros mask off pixels 4-7 when filtering 0-3\n // and vice-versa\n-static const vec_s8 h_subpel_filters_outer[3] =\n+static const vec_s8 h_subpel_filters_outer[4] =\n {\n     REPT4(0, 0, 2, 1),\n     REPT4(0, 0, 3, 3),\n     REPT4(0, 0, 1, 2),\n+    REPT4(0, 0, 0, 0),\n };\n \n #define LOAD_H_SUBPEL_FILTER(i) \\"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ffmpeg/ffmpeg/commits/0bed22d597b78999151e3bde0768b7fe763fc2a6",
        "url": "https://api.github.com/repos/FFmpeg/FFmpeg/commits/0bed22d597b78999151e3bde0768b7fe763fc2a6",
        "html_url": "https://github.com/FFmpeg/FFmpeg/commit/0bed22d597b78999151e3bde0768b7fe763fc2a6",
        "message": "avformat/sbgdec: Check for negative duration\n\nFixes: signed integer overflow: 9223372036854775807 - -8000000 cannot be represented in type 'long'\nFixes: 62276/clusterfuzz-testcase-minimized-ffmpeg_dem_SBG_fuzzer-5133181743136768\n\nFound-by: continuous fuzzing process https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "files": [
            {
                "sha": "e60eb1481ea3521d5df971ad6b01bc02c488460c",
                "filename": "libavformat/sbgdec.c",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FFmpeg/FFmpeg/blob/0bed22d597b78999151e3bde0768b7fe763fc2a6/libavformat%2Fsbgdec.c",
                "raw_url": "https://github.com/FFmpeg/FFmpeg/raw/0bed22d597b78999151e3bde0768b7fe763fc2a6/libavformat%2Fsbgdec.c",
                "contents_url": "https://api.github.com/repos/FFmpeg/FFmpeg/contents/libavformat%2Fsbgdec.c?ref=0bed22d597b78999151e3bde0768b7fe763fc2a6",
                "patch": "@@ -387,7 +387,7 @@ static int parse_options(struct sbg_parser *p)\n                 case 'L':\n                     FORWARD_ERROR(parse_optarg(p, opt, &oarg));\n                     r = str_to_time(oarg.s, &p->scs.opt_duration);\n-                    if (oarg.e != oarg.s + r) {\n+                    if (oarg.e != oarg.s + r || p->scs.opt_duration < 0) {\n                         snprintf(p->err_msg, sizeof(p->err_msg),\n                                  \"syntax error for option -L\");\n                         return AVERROR_INVALIDDATA;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nodemcu/nodemcu-firmware/commits/193fe3593eb1537667179089535cdb7457327887#diff-5c3fa597431eda03ac3339ae6bf7f05e1a50d6fc7333679ec38e21b337cb6721",
        "url": "https://api.github.com/repos/nodemcu/nodemcu-firmware/commits/193fe3593eb1537667179089535cdb7457327887",
        "html_url": "https://github.com/nodemcu/nodemcu-firmware/commit/193fe3593eb1537667179089535cdb7457327887",
        "message": "Fix some bugs and problems in gossip (#3527)\n\n* Allow configuration of debugOutput to be performed\r\n\r\n* don't send to own IP or update own data\r\n\r\n* Use same socket to send and receive. Avoid problems in many opened and closed sockets to send\r\n\r\n* Add callback for REMOVEed hosts\r\n\r\n* Send broascast messages if seedList is empty\r\n\r\n* Adapt yeelink to new luacheck rules\r\n\r\n* Fix building of luac.cross for win to win2019 and VS 2019",
        "files": [
            {
                "sha": "7ff0eaf5d8e461f45a9bfbc66251bfb42e3d95e9",
                "filename": ".github/workflows/build.yml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/nodemcu/nodemcu-firmware/blob/193fe3593eb1537667179089535cdb7457327887/.github%2Fworkflows%2Fbuild.yml",
                "raw_url": "https://github.com/nodemcu/nodemcu-firmware/raw/193fe3593eb1537667179089535cdb7457327887/.github%2Fworkflows%2Fbuild.yml",
                "contents_url": "https://api.github.com/repos/nodemcu/nodemcu-firmware/contents/.github%2Fworkflows%2Fbuild.yml?ref=193fe3593eb1537667179089535cdb7457327887",
                "patch": "@@ -58,7 +58,7 @@ jobs:\n \n   build_luac_cross_win:\n \n-    runs-on: windows-latest\n+    runs-on: windows-2019\n \n     steps:\n     - uses: actions/checkout@v2"
            },
            {
                "sha": "80a6cb963af8c53cb59f4f8e4db2dcbaec09d452",
                "filename": ".gitignore",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/nodemcu/nodemcu-firmware/blob/193fe3593eb1537667179089535cdb7457327887/.gitignore",
                "raw_url": "https://github.com/nodemcu/nodemcu-firmware/raw/193fe3593eb1537667179089535cdb7457327887/.gitignore",
                "contents_url": "https://api.github.com/repos/nodemcu/nodemcu-firmware/contents/.gitignore?ref=193fe3593eb1537667179089535cdb7457327887",
                "patch": "@@ -28,6 +28,8 @@ uz_zip\n \n # ignore VS Code files\n .vscode/**\n+# ignore VS files\n+.vs/**\n \n # ignore IDEA files\n .idea"
            },
            {
                "sha": "da8cf133394e9aa5f6ce25ecc275b40a2394761e",
                "filename": "docs/lua-modules/gossip.md",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/nodemcu/nodemcu-firmware/blob/193fe3593eb1537667179089535cdb7457327887/docs%2Flua-modules%2Fgossip.md",
                "raw_url": "https://github.com/nodemcu/nodemcu-firmware/raw/193fe3593eb1537667179089535cdb7457327887/docs%2Flua-modules%2Fgossip.md",
                "contents_url": "https://api.github.com/repos/nodemcu/nodemcu-firmware/contents/docs%2Flua-modules%2Fgossip.md?ref=193fe3593eb1537667179089535cdb7457327887",
                "patch": "@@ -68,7 +68,7 @@ gossip.setConfig(config)\n \n Sets the configuration for gossip. The available options are:\n \n-`seedList` : the list of seeds gossip will start with; this will be updated as new nodes are discovered. Note that it's enough for all nodes to start with the same IP in the seedList, as once they have one seed in common, the data will propagate\n+`seedList` : the list of seeds gossip will start with; this will be updated as new nodes are discovered. Note that it's enough for all nodes to start with the same IP in the seedList, as once they have one seed in common, the data will propagate. If the seedList is empty a broadcast is sent, so this can be used for automatic discovery of nodes.\n \n `roundInterval`: interval in milliseconds at which gossip will pick a random node from the seed list and send a `SYN` request\n "
            },
            {
                "sha": "a236fba55283912673d3013bce3bf6adfaad8667",
                "filename": "lua_modules/gossip/gossip.lua",
                "status": "modified",
                "additions": 34,
                "deletions": 19,
                "changes": 53,
                "blob_url": "https://github.com/nodemcu/nodemcu-firmware/blob/193fe3593eb1537667179089535cdb7457327887/lua_modules%2Fgossip%2Fgossip.lua",
                "raw_url": "https://github.com/nodemcu/nodemcu-firmware/raw/193fe3593eb1537667179089535cdb7457327887/lua_modules%2Fgossip%2Fgossip.lua",
                "contents_url": "https://api.github.com/repos/nodemcu/nodemcu-firmware/contents/lua_modules%2Fgossip%2Fgossip.lua?ref=193fe3593eb1537667179089535cdb7457327887",
                "patch": "@@ -15,11 +15,7 @@ end\n \n utils.debug = function(message)\n   if gossip.config.debug then\n-    if gossip.config.debugOutput then\n-      gossip.config.debugOutput(message);\n-    else\n-      print(message);\n-    end\n+    gossip.config.debugOutput(message);\n   end\n end\n \n@@ -105,15 +101,23 @@ state.start = function()\n     return;\n   end\n \n+  -- sending to own IP makes no sense\n+  for index, value in ipairs(gossip.config.seedList) do\n+      if value == gossip.ip then\n+          table.remove(gossip.config.seedList, index)\n+          utils.debug('removing own ip from seed list')\n+      end\n+  end\n+\n   gossip.networkState[gossip.ip] = {};\n   local localState = gossip.networkState[gossip.ip];\n   localState.revision = state.setRev();\n   localState.heartbeat = tmr.time();\n   localState.state = constants.nodeState.UP;\n \n-  gossip.inboundSocket = net.createUDPSocket();\n-  gossip.inboundSocket:listen(gossip.config.comPort);\n-  gossip.inboundSocket:on('receive', network.receiveData);\n+  gossip.socket = net.createUDPSocket();\n+  gossip.socket:listen(gossip.config.comPort);\n+  gossip.socket:on('receive', network.receiveData);\n \n   gossip.started = true;\n \n@@ -128,27 +132,38 @@ end\n state.tickNodeState = function(ip)\n   if gossip.networkState[ip] then\n     local nodeState = gossip.networkState[ip].state;\n+    local oldNodeState = nodeState;\n     if nodeState < constants.nodeState.REMOVE then\n       nodeState = nodeState + constants.nodeState.TICK;\n       gossip.networkState[ip].state = nodeState;\n     end\n+    if oldNodeState == constants.nodeState.DOWN then\n+      if gossip.updateCallback then gossip.updateCallback(gossip.networkState[ip]); end\n+    end\n   end\n end\n \n -- Network\n+network.broadcastIp = \"255.255.255.255\"\n \n network.pushGossip = function(data, ip)\n+  if not gossip.started then\n+    utils.debug('Gossip not started.');\n+    return;\n+  end\n   gossip.networkState[gossip.ip].data = data;\n   network.sendSyn(nil, ip);\n end\n \n network.updateNetworkState = function(updateData)\n   if gossip.updateCallback then gossip.updateCallback(updateData); end\n   for ip, data in pairs(updateData) do\n-    if not utils.contains(gossip.config.seedList, ip) then\n+    if not utils.contains(gossip.config.seedList, ip) and ip ~= network.broadcastIp and ip ~= gossip.ip then\n       table.insert(gossip.config.seedList, ip);\n     end\n-    gossip.networkState[ip] = data;\n+    if ip ~= gossip.ip then\n+      gossip.networkState[ip] = data;\n+    end\n   end\n end\n \n@@ -170,17 +185,16 @@ network.pickRandomNode = function()\n     return gossip.config.seedList[randomListPick];\n   end\n   utils.debug(\n-      'Seedlist is empty. Please provide one or wait for node to be contacted.');\n-  return nil;\n+      'Seedlist is empty. Using broadcast IP '..network.broadcastIp..' to discover.');\n+  return network.broadcastIp;\n end\n \n network.sendData = function(ip, data, sendType)\n-  local outboundSocket = net.createUDPSocket();\n-  data.type = sendType;\n-  local dataToSend = sjson.encode(data);\n-  data.type = nil;\n-  outboundSocket:send(gossip.config.comPort, ip, dataToSend);\n-  outboundSocket:close();\n+  data.type = sendType\n+  local dataToSend = sjson.encode(data)\n+  data.type = nil\n+  gossip.socket:send(gossip.config.comPort, ip, dataToSend)\n+  utils.debug(\"Sent \"..#dataToSend..\" bytes\")\n end\n \n network.receiveSyn = function(ip, synData)\n@@ -235,7 +249,8 @@ constants.defaultConfig = {\n   seedList = {},\n   roundInterval = 15000,\n   comPort = 5000,\n-  debug = false\n+  debug = false,\n+  debugOutput = print\n };\n \n constants.comparisonFields = {'revision', 'heartbeat', 'state'};"
            },
            {
                "sha": "0ecc55ec464af27ef42c4c78ea4d59c85b32e2e3",
                "filename": "lua_modules/gossip/gossip_tests.lua",
                "status": "modified",
                "additions": 13,
                "deletions": 7,
                "changes": 20,
                "blob_url": "https://github.com/nodemcu/nodemcu-firmware/blob/193fe3593eb1537667179089535cdb7457327887/lua_modules%2Fgossip%2Fgossip_tests.lua",
                "raw_url": "https://github.com/nodemcu/nodemcu-firmware/raw/193fe3593eb1537667179089535cdb7457327887/lua_modules%2Fgossip%2Fgossip_tests.lua",
                "contents_url": "https://api.github.com/repos/nodemcu/nodemcu-firmware/contents/lua_modules%2Fgossip%2Fgossip_tests.lua?ref=193fe3593eb1537667179089535cdb7457327887",
                "patch": "@@ -24,6 +24,7 @@ file.putcontents = dummy\n \n local Ip_1 = '192.168.0.1';\n local Ip_2 = '192.168.0.2';\n+local Ip_own = '192.168.0.3';\n \n -- test runner\n \n@@ -186,20 +187,19 @@ function Test.utils_getMinus()\n     state = constants.nodeState.SUSPECT;\n   };\n \n-  --local diff1 = utils.getMinus(data1, data2);\n+  local diff1 = utils.getMinus(data1, data2);\n   local diff2 = utils.getMinus(data2, data1);\n \n-  --assert(diff1[Ip_1] ~= nil and diff1[Ip_2] == nil);\n+  assert(diff1[Ip_1] ~= nil and diff1[Ip_2] == nil);\n   assert(diff2[Ip_1] == nil and diff2[Ip_2] ~= nil);\n-\n end\n \n -- state\n \n function Test.state_setRev()\n-  gossip.ip = Ip_1;\n-  gossip.networkState[Ip_1] = {};\n-  gossip.networkState[Ip_1].revision = -1;\n+  gossip.ip = Ip_own;\n+  gossip.networkState[Ip_own] = {};\n+  gossip.networkState[Ip_own].revision = -1;\n   assert(state.setRev() == 0, 'Revision not initialized to 0.');\n end\n \n@@ -223,6 +223,7 @@ end\n -- network\n \n function Test.network_updateNetworkState_no_callback()\n+  gossip.ip = Ip_own;\n   local updateData = {}\n   updateData[Ip_1] = {\n     revision = 1,\n@@ -232,7 +233,12 @@ function Test.network_updateNetworkState_no_callback()\n   updateData[Ip_2] = {\n     revision = 1,\n     heartbeat = 700,\n-    state = constants.nodeState.UP\n+    state = constants.nodeState.DOWN\n+  };\n+  updateData[Ip_own] = {\n+    revision = 1,\n+    heartbeat = 800,\n+    state = constants.nodeState.DOWN\n   };\n   network.updateNetworkState(updateData);\n   -- send duplicate data"
            },
            {
                "sha": "9e6a1cfc15821a779172542bf51d7c4653632188",
                "filename": "lua_modules/yeelink/yeelink_lib.lua",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/nodemcu/nodemcu-firmware/blob/193fe3593eb1537667179089535cdb7457327887/lua_modules%2Fyeelink%2Fyeelink_lib.lua",
                "raw_url": "https://github.com/nodemcu/nodemcu-firmware/raw/193fe3593eb1537667179089535cdb7457327887/lua_modules%2Fyeelink%2Fyeelink_lib.lua",
                "contents_url": "https://api.github.com/repos/nodemcu/nodemcu-firmware/contents/lua_modules%2Fyeelink%2Fyeelink_lib.lua?ref=193fe3593eb1537667179089535cdb7457327887",
                "patch": "@@ -54,10 +54,10 @@ end)\n -- apikey must be -> string <-\n -- e.g. xxx.init(00000,00000,\"123j12b3jkb12k4b23bv54i2b5b3o4\")\n --========================================\n-function M.init(_device, _sensor, _apikey)\n-    device = tostring(_device)\n-    sensor = tostring(_sensor)\n-    apikey = _apikey\n+function M.init(device_, sensor_, apikey_)\n+    device = tostring(device_)\n+    sensor = tostring(sensor_)\n+    apikey = apikey_\n     if dns == \"0.0.0.0\" then\n       tmr.create():alarm(5000,tmr.ALARM_AUTO,function ()\n         if dns == \"0.0.0.0\" then\n@@ -90,9 +90,9 @@ end\n --\n --e.g. xxx.update(233.333)\n --============================================================\n-function M.update(_datapoint)\n+function M.update(datapoint_)\n \n-    datapoint = tostring(_datapoint)\n+    datapoint = tostring(datapoint_)\n \n     sk:on(\"connection\", function()\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/prestashop/prestashop/commits/20fa542294da2cfa034a48041e292acaed0c2a7f",
        "url": "https://api.github.com/repos/PrestaShop/PrestaShop/commits/20fa542294da2cfa034a48041e292acaed0c2a7f",
        "html_url": "https://github.com/PrestaShop/PrestaShop/commit/20fa542294da2cfa034a48041e292acaed0c2a7f",
        "message": "check not null before calling round function",
        "files": [
            {
                "sha": "570afb46d7e9d75f52114889bc85666fee4b119a",
                "filename": "classes/Tools.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/PrestaShop/PrestaShop/blob/20fa542294da2cfa034a48041e292acaed0c2a7f/classes%2FTools.php",
                "raw_url": "https://github.com/PrestaShop/PrestaShop/raw/20fa542294da2cfa034a48041e292acaed0c2a7f/classes%2FTools.php",
                "contents_url": "https://api.github.com/repos/PrestaShop/PrestaShop/contents/classes%2FTools.php?ref=20fa542294da2cfa034a48041e292acaed0c2a7f",
                "patch": "@@ -1771,7 +1771,7 @@ public static function math_round($value, $places, $mode = PS_ROUND_HALF_UP)\n     {\n         //If PHP_ROUND_HALF_UP exist (PHP 5.3) use it and pass correct mode value (PrestaShop define - 1)\n         if (defined('PHP_ROUND_HALF_UP')) {\n-            return round($value, $places, $mode - 1);\n+            return round($value ?? 0.0, $places, $mode - 1);\n         }\n \n         $precision_places = 14 - floor(log10(abs($value)));"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/zulip/zulip/commits/191345f9d61f5b15762fe3ce19bf635bf885176a",
        "url": "https://api.github.com/repos/zulip/zulip/commits/191345f9d61f5b15762fe3ce19bf635bf885176a",
        "html_url": "https://github.com/zulip/zulip/commit/191345f9d61f5b15762fe3ce19bf635bf885176a",
        "message": "ui_util: Fix HTML injection bug in replace_emoji_with_text.\n\nSigned-off-by: Anders Kaseorg <anders@zulip.com>",
        "files": [
            {
                "sha": "52b2b8520f788e52c3340008e3a455fadbca20f9",
                "filename": "web/src/ui_util.ts",
                "status": "modified",
                "additions": 10,
                "deletions": 6,
                "changes": 16,
                "blob_url": "https://github.com/zulip/zulip/blob/191345f9d61f5b15762fe3ce19bf635bf885176a/web%2Fsrc%2Fui_util.ts",
                "raw_url": "https://github.com/zulip/zulip/raw/191345f9d61f5b15762fe3ce19bf635bf885176a/web%2Fsrc%2Fui_util.ts",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fui_util.ts?ref=191345f9d61f5b15762fe3ce19bf635bf885176a",
                "patch": "@@ -23,12 +23,16 @@ export function place_caret_at_end(el: HTMLElement): void {\n }\n \n export function replace_emoji_with_text($element: JQuery): void {\n-    $element.find(\".emoji\").replaceWith(function () {\n-        if ($(this).is(\"img\")) {\n-            return $(this).attr(\"alt\") ?? \"\";\n-        }\n-        return $(this).text();\n-    });\n+    $element\n+        .find(\".emoji\")\n+        .text(function () {\n+            if ($(this).is(\"img\")) {\n+                return $(this).attr(\"alt\") ?? \"\";\n+            }\n+            return $(this).text();\n+        })\n+        .contents()\n+        .unwrap();\n }\n \n export function change_katex_to_raw_latex($element: JQuery): void {"
            },
            {
                "sha": "27c853c411dccb718ae73eaecd8725074d75393d",
                "filename": "web/tests/notifications.test.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zulip/zulip/blob/191345f9d61f5b15762fe3ce19bf635bf885176a/web%2Ftests%2Fnotifications.test.js",
                "raw_url": "https://github.com/zulip/zulip/raw/191345f9d61f5b15762fe3ce19bf635bf885176a/web%2Ftests%2Fnotifications.test.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Ftests%2Fnotifications.test.js?ref=191345f9d61f5b15762fe3ce19bf635bf885176a",
                "patch": "@@ -341,7 +341,7 @@ test(\"message_is_notifiable\", () => {\n });\n \n test(\"basic_notifications\", () => {\n-    $(\"<div>\").set_find_results(\".emoji\", {replaceWith() {}});\n+    $(\"<div>\").set_find_results(\".emoji\", {text: () => ({contents: () => ({unwrap() {}})})});\n     $(\"<div>\").set_find_results(\"span.katex\", {each() {}});\n     $(\"<div>\").children = () => [];\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/zulip/zulip/commits/e1029b59ede0c4f314c367ffa1ba2904ffaf6768",
        "url": "https://api.github.com/repos/zulip/zulip/commits/e1029b59ede0c4f314c367ffa1ba2904ffaf6768",
        "html_url": "https://github.com/zulip/zulip/commit/e1029b59ede0c4f314c367ffa1ba2904ffaf6768",
        "message": "copy_and_paste: Fix HTML injection bug in construct_copy_div.\n\nSigned-off-by: Anders Kaseorg <anders@zulip.com>",
        "files": [
            {
                "sha": "e67cb8ba725f1c4a85cc22082b1426f004a0d484",
                "filename": "web/src/copy_and_paste.js",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/zulip/zulip/blob/e1029b59ede0c4f314c367ffa1ba2904ffaf6768/web%2Fsrc%2Fcopy_and_paste.js",
                "raw_url": "https://github.com/zulip/zulip/raw/e1029b59ede0c4f314c367ffa1ba2904ffaf6768/web%2Fsrc%2Fcopy_and_paste.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fcopy_and_paste.js?ref=e1029b59ede0c4f314c367ffa1ba2904ffaf6768",
                "patch": "@@ -90,7 +90,11 @@ function construct_copy_div($div, start_id, end_id) {\n         }\n         const message = message_lists.current.get(rows.id($row));\n         const $content = $(message.content);\n-        $content.first().prepend(message.sender_full_name + \": \");\n+        $content.first().prepend(\n+            $(\"<span>\")\n+                .text(message.sender_full_name + \": \")\n+                .contents(),\n+        );\n         $div.append($content);\n     }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ffmpeg/ffmpeg/commits/28c7094b25b689185155a6833caf2747b94774a4",
        "url": "https://api.github.com/repos/FFmpeg/FFmpeg/commits/28c7094b25b689185155a6833caf2747b94774a4",
        "html_url": "https://github.com/FFmpeg/FFmpeg/commit/28c7094b25b689185155a6833caf2747b94774a4",
        "message": "avcodec/wavarc: fix signed integer overflow in block type 6/19\n\nFixes: signed integer overflow: -2088796289 + -91276551 cannot be represented in type 'int'\nFixes: 67772/clusterfuzz-testcase-minimized-ffmpeg_AV_CODEC_ID_WAVARC_fuzzer-6533568953122816\n\nFound-by: continuous fuzzing process https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "files": [
            {
                "sha": "b4b26958e6fb50e90e75c4779605b123745df49e",
                "filename": "libavcodec/wavarc.c",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FFmpeg/FFmpeg/blob/28c7094b25b689185155a6833caf2747b94774a4/libavcodec%2Fwavarc.c",
                "raw_url": "https://github.com/FFmpeg/FFmpeg/raw/28c7094b25b689185155a6833caf2747b94774a4/libavcodec%2Fwavarc.c",
                "contents_url": "https://api.github.com/repos/FFmpeg/FFmpeg/contents/libavcodec%2Fwavarc.c?ref=28c7094b25b689185155a6833caf2747b94774a4",
                "patch": "@@ -647,7 +647,7 @@ static int decode_5elp(AVCodecContext *avctx,\n                 for (int o = 0; o < order; o++)\n                     sum += s->filter[ch][o] * (unsigned)samples[n + 70 - o - 1];\n \n-                samples[n + 70] += ac_out[n] + (sum >> 4);\n+                samples[n + 70] += ac_out[n] + (unsigned)(sum >> 4);\n             }\n \n             for (int n = 0; n < 70; n++)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ffmpeg/ffmpeg/commits/7a089ed8e049e3bfcb22de1250b86f2106060857",
        "url": "https://api.github.com/repos/FFmpeg/FFmpeg/commits/7a089ed8e049e3bfcb22de1250b86f2106060857",
        "html_url": "https://github.com/FFmpeg/FFmpeg/commit/7a089ed8e049e3bfcb22de1250b86f2106060857",
        "message": "avformat/avidec: Fix integer overflow iff ULONG_MAX < INT64_MAX\n\nAffects many FATE-tests, see\nhttps://fate.ffmpeg.org/report.cgi?time=20240312011016&slot=ppc-linux-gcc-13.2-ubsan-altivec-qemu\n\nReviewed-by: James Almer <jamrial@gmail.com>\nSigned-off-by: Andreas Rheinhardt <andreas.rheinhardt@outlook.com>",
        "files": [
            {
                "sha": "985a9bf022beacfd47b663404e0cd936e50e2bd5",
                "filename": "libavformat/avidec.c",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FFmpeg/FFmpeg/blob/7a089ed8e049e3bfcb22de1250b86f2106060857/libavformat%2Favidec.c",
                "raw_url": "https://github.com/FFmpeg/FFmpeg/raw/7a089ed8e049e3bfcb22de1250b86f2106060857/libavformat%2Favidec.c",
                "contents_url": "https://api.github.com/repos/FFmpeg/FFmpeg/contents/libavformat%2Favidec.c?ref=7a089ed8e049e3bfcb22de1250b86f2106060857",
                "patch": "@@ -1696,7 +1696,7 @@ static int check_stream_max_drift(AVFormatContext *s)\n     int *idx = av_calloc(s->nb_streams, sizeof(*idx));\n     if (!idx)\n         return AVERROR(ENOMEM);\n-    for (min_pos = pos = 0; min_pos != INT64_MAX; pos = min_pos + 1LU) {\n+    for (min_pos = pos = 0; min_pos != INT64_MAX; pos = min_pos + 1ULL) {\n         int64_t max_dts = INT64_MIN / 2;\n         int64_t min_dts = INT64_MAX / 2;\n         int64_t max_buffer = 0;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ffmpeg/ffmpeg/commits/d973fcbcc2f944752ff10e6a76b0b2d9329937a7",
        "url": "https://api.github.com/repos/FFmpeg/FFmpeg/commits/d973fcbcc2f944752ff10e6a76b0b2d9329937a7",
        "html_url": "https://github.com/FFmpeg/FFmpeg/commit/d973fcbcc2f944752ff10e6a76b0b2d9329937a7",
        "message": "avformat/cafdec: dont seek beyond 64bit\n\nFixes: signed integer overflow: 64 + 9223372036854775807 cannot be represented in type 'long long'\nFixes: 51896/clusterfuzz-testcase-minimized-ffmpeg_dem_CAF_fuzzer-6418242730328064\nFixes: 62276/clusterfuzz-testcase-minimized-ffmpeg_dem_CAF_fuzzer-6418242730328064\n\nFound-by: continuous fuzzing process https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "files": [
            {
                "sha": "72809fd1de29a7ca14c5673097fad33affa3be1f",
                "filename": "libavformat/cafdec.c",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FFmpeg/FFmpeg/blob/d973fcbcc2f944752ff10e6a76b0b2d9329937a7/libavformat%2Fcafdec.c",
                "raw_url": "https://github.com/FFmpeg/FFmpeg/raw/d973fcbcc2f944752ff10e6a76b0b2d9329937a7/libavformat%2Fcafdec.c",
                "contents_url": "https://api.github.com/repos/FFmpeg/FFmpeg/contents/libavformat%2Fcafdec.c?ref=d973fcbcc2f944752ff10e6a76b0b2d9329937a7",
                "patch": "@@ -271,7 +271,7 @@ static int read_pakt_chunk(AVFormatContext *s, int64_t size)\n         }\n     }\n \n-    if (avio_tell(pb) - ccount > size) {\n+    if (avio_tell(pb) - ccount > size || size > INT64_MAX - ccount) {\n         av_log(s, AV_LOG_ERROR, \"error reading packet table\\n\");\n         return AVERROR_INVALIDDATA;\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ffmpeg/ffmpeg/commits/86f73277bf014e2ce36dd2594f1e0fb8b3bd6661",
        "url": "https://api.github.com/repos/FFmpeg/FFmpeg/commits/86f73277bf014e2ce36dd2594f1e0fb8b3bd6661",
        "html_url": "https://github.com/FFmpeg/FFmpeg/commit/86f73277bf014e2ce36dd2594f1e0fb8b3bd6661",
        "message": "avformat/westwood_vqa: Fix 2g packets\n\nFixes: signed integer overflow: 2147483424 * 2 cannot be represented in type 'int'\nFixes: 62276/clusterfuzz-testcase-minimized-ffmpeg_dem_WSVQA_fuzzer-4576211411795968\n\nFound-by: continuous fuzzing process https://github.com/google/oss-fuzz/tree/master/projects/ffmpeg\nSigned-off-by: Michael Niedermayer <michael@niedermayer.cc>",
        "files": [
            {
                "sha": "3a31e3f5e8e22aaedb55805523a3ccf212edf442",
                "filename": "libavformat/westwood_vqa.c",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/FFmpeg/FFmpeg/blob/86f73277bf014e2ce36dd2594f1e0fb8b3bd6661/libavformat%2Fwestwood_vqa.c",
                "raw_url": "https://github.com/FFmpeg/FFmpeg/raw/86f73277bf014e2ce36dd2594f1e0fb8b3bd6661/libavformat%2Fwestwood_vqa.c",
                "contents_url": "https://api.github.com/repos/FFmpeg/FFmpeg/contents/libavformat%2Fwestwood_vqa.c?ref=86f73277bf014e2ce36dd2594f1e0fb8b3bd6661",
                "patch": "@@ -262,7 +262,7 @@ static int wsvqa_read_packet(AVFormatContext *s,\n                     break;\n                 case SND2_TAG:\n                     /* 2 samples/byte, 1 or 2 samples per frame depending on stereo */\n-                    pkt->duration = (chunk_size * 2) / wsvqa->channels;\n+                    pkt->duration = (chunk_size * 2LL) / wsvqa->channels;\n                     break;\n                 }\n                 break;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ffmpeg/ffmpeg/commits/0ba058579f332b3060d8470a04ddd3fbf305be61",
        "url": "https://api.github.com/repos/FFmpeg/FFmpeg/commits/0ba058579f332b3060d8470a04ddd3fbf305be61",
        "html_url": "https://github.com/FFmpeg/FFmpeg/commit/0ba058579f332b3060d8470a04ddd3fbf305be61",
        "message": "avcodec/vp9: Fix race when attaching side-data for show-existing frame\n\nWhen outputting a show-existing frame, the VP9 decoder simply\ncreated a reference to said frame and returned it immediately to\nthe caller, without waiting for it to have finished decoding.\nIn case of frame-threading it is possible for the frame to\nonly be decoded while it was waiting to be output.\nThis is normally benign.\n\nBut there is one case where it is not: If the user wants\nvideo encoding parameters to be exported, said side data\nwill only be attached to the src AVFrame at the end of\ndecoding the frame that is actually being shown. Without\nsynchronisation adding said side data in the decoder thread\nand the reads in av_frame_ref() in the output thread\nconstitute a data race. This happens e.g. when using the\nvenc_data_dump tool with vp90-2-10-show-existing-frame.webm\nfrom the FATE-suite.\n\nFix this by actually waiting for the frame to be output.\n\nSigned-off-by: Andreas Rheinhardt <andreas.rheinhardt@outlook.com>",
        "files": [
            {
                "sha": "e0bc313301eba07efc861897e78ba741bb94b033",
                "filename": "libavcodec/vp9.c",
                "status": "modified",
                "additions": 11,
                "deletions": 7,
                "changes": 18,
                "blob_url": "https://github.com/FFmpeg/FFmpeg/blob/0ba058579f332b3060d8470a04ddd3fbf305be61/libavcodec%2Fvp9.c",
                "raw_url": "https://github.com/FFmpeg/FFmpeg/raw/0ba058579f332b3060d8470a04ddd3fbf305be61/libavcodec%2Fvp9.c",
                "contents_url": "https://api.github.com/repos/FFmpeg/FFmpeg/contents/libavcodec%2Fvp9.c?ref=0ba058579f332b3060d8470a04ddd3fbf305be61",
                "patch": "@@ -1569,6 +1569,8 @@ static int vp9_decode_frame(AVCodecContext *avctx, AVFrame *frame,\n             av_log(avctx, AV_LOG_ERROR, \"Requested reference %d not available\\n\", ref);\n             return AVERROR_INVALIDDATA;\n         }\n+        ff_progress_frame_await(&s->s.refs[ref], INT_MAX);\n+\n         if ((ret = av_frame_ref(frame, s->s.refs[ref].f)) < 0)\n             return ret;\n         frame->pts     = pkt->pts;\n@@ -1715,10 +1717,8 @@ static int vp9_decode_frame(AVCodecContext *avctx, AVFrame *frame,\n #endif\n         {\n             ret = decode_tiles(avctx, data, size);\n-            if (ret < 0) {\n-                ff_progress_frame_report(&s->s.frames[CUR_FRAME].tf, INT_MAX);\n-                return ret;\n-            }\n+            if (ret < 0)\n+                goto fail;\n         }\n \n         // Sum all counts fields into td[0].counts for tile threading\n@@ -1732,18 +1732,19 @@ static int vp9_decode_frame(AVCodecContext *avctx, AVFrame *frame,\n             ff_thread_finish_setup(avctx);\n         }\n     } while (s->pass++ == 1);\n-    ff_progress_frame_report(&s->s.frames[CUR_FRAME].tf, INT_MAX);\n \n     if (s->td->error_info < 0) {\n         av_log(avctx, AV_LOG_ERROR, \"Failed to decode tile data\\n\");\n         s->td->error_info = 0;\n-        return AVERROR_INVALIDDATA;\n+        ret = AVERROR_INVALIDDATA;\n+        goto fail;\n     }\n     if (avctx->export_side_data & AV_CODEC_EXPORT_DATA_VIDEO_ENC_PARAMS) {\n         ret = vp9_export_enc_params(s, &s->s.frames[CUR_FRAME]);\n         if (ret < 0)\n-            return ret;\n+            goto fail;\n     }\n+    ff_progress_frame_report(&s->s.frames[CUR_FRAME].tf, INT_MAX);\n \n finish:\n     // ref frame setup\n@@ -1757,6 +1758,9 @@ static int vp9_decode_frame(AVCodecContext *avctx, AVFrame *frame,\n     }\n \n     return pkt->size;\n+fail:\n+    ff_progress_frame_report(&s->s.frames[CUR_FRAME].tf, INT_MAX);\n+    return ret;\n }\n \n static void vp9_decode_flush(AVCodecContext *avctx)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/zulip/zulip/commits/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
        "url": "https://api.github.com/repos/zulip/zulip/commits/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
        "html_url": "https://github.com/zulip/zulip/commit/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
        "message": "popover_menus: Fix event handler trying to hide a hidden popover.\n\nWhen user is trying to open a modal after clicking on a button\nin a popover, we call popovers.hide_all() before opening the modal\nwhich hides the popover but since the event handler call isn't\nfinished running yet, we call instance.hide() again resulting in\ntippy throwing errors that this could be a memory leak.\n\nWe introduce a wrapper function for `instance.hide` which if\nthe popover/tooltip is visible before hiding it to fix it.",
        "files": [
            {
                "sha": "59aaf029bf7c728b30e4a52c31854b0fbbfb66e6",
                "filename": "web/src/click_handlers.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fclick_handlers.js",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fclick_handlers.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fclick_handlers.js?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -25,6 +25,7 @@ import * as narrow_state from \"./narrow_state\";\n import * as navigate from \"./navigate\";\n import {page_params} from \"./page_params\";\n import * as pm_list from \"./pm_list\";\n+import * as popover_menus from \"./popover_menus\";\n import * as reactions from \"./reactions\";\n import * as recent_view_ui from \"./recent_view_ui\";\n import * as rows from \"./rows\";\n@@ -542,7 +543,7 @@ export function initialize() {\n                     for (const mutation of mutationsList) {\n                         // Hide instance if reference is in the removed node list.\n                         if (check_reference_removed(mutation, instance)) {\n-                            instance.hide();\n+                            popover_menus.hide_current_popover_if_visible(instance);\n                         }\n                     }\n                 };"
            },
            {
                "sha": "c74f47ec6593a519c6162228e59dd0ecac8f491c",
                "filename": "web/src/compose_popovers.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fcompose_popovers.js",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fcompose_popovers.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fcompose_popovers.js?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -41,12 +41,12 @@ export function initialize() {\n             $popper.one(\"click\", \".compose_mobile_stream_button\", (e) => {\n                 compose_actions.start(\"stream\", {trigger: \"clear topic button\"});\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n             $popper.one(\"click\", \".compose_mobile_direct_message_button\", (e) => {\n                 compose_actions.start(\"private\");\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n         },\n         onHidden(instance) {"
            },
            {
                "sha": "adfa0e361a088581ffa7ac840aedb22a20dc6c93",
                "filename": "web/src/dropdown_widget.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fdropdown_widget.ts",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fdropdown_widget.ts",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fdropdown_widget.ts?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -12,7 +12,7 @@ import * as blueslip from \"./blueslip\";\n import * as ListWidget from \"./list_widget\";\n import type {ListWidget as ListWidgetType} from \"./list_widget\";\n import {page_params} from \"./page_params\";\n-import {default_popover_props} from \"./popover_menus\";\n+import * as popover_menus from \"./popover_menus\";\n import type {StreamSubscription} from \"./sub_store\";\n import {parse_html} from \"./ui_util\";\n \n@@ -180,7 +180,7 @@ export class DropdownWidget {\n             return;\n         }\n         this.instance = tippy.delegate(delegate_container, {\n-            ...default_popover_props,\n+            ...popover_menus.default_popover_props,\n             target: this.widget_selector,\n             // Custom theme defined in popovers.css\n             theme: \"dropdown-widget\",\n@@ -286,7 +286,7 @@ export class DropdownWidget {\n                             break;\n \n                         case \"Escape\":\n-                            instance.hide();\n+                            popover_menus.hide_current_popover_if_visible(instance);\n                             this.on_exit_with_escape_callback();\n                             e.stopPropagation();\n                             e.preventDefault();"
            },
            {
                "sha": "1bd4c0e5d10456618e0538c52a9550e13a67ae42",
                "filename": "web/src/gear_menu.js",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fgear_menu.js",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fgear_menu.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fgear_menu.js?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -145,13 +145,13 @@ export function initialize() {\n                         });\n                     },\n                 );\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n                 e.preventDefault();\n                 e.stopPropagation();\n             });\n \n             $popper.on(\"click\", \".change-language-spectator\", (e) => {\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n                 e.preventDefault();\n                 e.stopPropagation();\n                 settings_preferences.launch_default_language_setting_modal();\n@@ -162,7 +162,7 @@ export function initialize() {\n             // Also, since these buttons are only visible for spectators which doesn't have events,\n             // if theme is changed in a different tab, the theme of this tab remains the same.\n             $popper.on(\"click\", \"#gear-menu-dropdown .gear-menu-select-dark-theme\", (e) => {\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n                 e.preventDefault();\n                 e.stopPropagation();\n                 requestAnimationFrame(() => {\n@@ -172,7 +172,7 @@ export function initialize() {\n             });\n \n             $popper.on(\"click\", \"#gear-menu-dropdown .gear-menu-select-light-theme\", (e) => {\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n                 e.preventDefault();\n                 e.stopPropagation();\n                 requestAnimationFrame(() => {"
            },
            {
                "sha": "8dafc4e47b844d85643116fcf54140955d0a1d80",
                "filename": "web/src/left_sidebar_navigation_area_popovers.js",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fleft_sidebar_navigation_area_popovers.js",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fleft_sidebar_navigation_area_popovers.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fleft_sidebar_navigation_area_popovers.js?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -38,7 +38,7 @@ function common_click_handlers() {\n function register_mark_all_read_handler(event) {\n     const {instance} = event.data;\n     unread_ops.confirm_mark_all_as_read();\n-    instance.hide();\n+    popover_menus.hide_current_popover_if_visible(instance);\n }\n \n export function initialize() {\n@@ -52,7 +52,7 @@ export function initialize() {\n \n             $popper.one(\"click\", \"#unstar_all_messages\", () => {\n                 starred_messages_ui.confirm_unstar_all_messages();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n             $popper.one(\"click\", \"#toggle_display_starred_msg_count\", () => {\n                 const data = {};\n@@ -63,7 +63,7 @@ export function initialize() {\n                     url: \"/json/settings\",\n                     data,\n                 });\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n         },\n         onShow(instance) {\n@@ -97,7 +97,7 @@ export function initialize() {\n \n             $popper.one(\"click\", \"#delete_all_drafts_sidebar\", () => {\n                 drafts.confirm_delete_all_drafts();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n         },\n         onShow(instance) {"
            },
            {
                "sha": "33fbdbaab594589bf0ba0bfb5ec3eeede2466228",
                "filename": "web/src/message_actions_popover.js",
                "status": "modified",
                "additions": 10,
                "deletions": 10,
                "changes": 20,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fmessage_actions_popover.js",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fmessage_actions_popover.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fmessage_actions_popover.js?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -123,7 +123,7 @@ export function initialize() {\n                 });\n                 e.preventDefault();\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n \n             $popper.one(\"click\", \".popover_edit_message, .popover_view_source\", (e) => {\n@@ -133,7 +133,7 @@ export function initialize() {\n                 message_edit.start($row);\n                 e.preventDefault();\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n \n             $popper.one(\"click\", \".popover_move_message\", (e) => {\n@@ -149,15 +149,15 @@ export function initialize() {\n                 );\n                 e.preventDefault();\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n \n             $popper.one(\"click\", \".mark_as_unread\", (e) => {\n                 const message_id = $(e.currentTarget).data(\"message-id\");\n                 unread_ops.mark_as_unread_from_here(message_id);\n                 e.preventDefault();\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n \n             $popper.one(\"click\", \".popover_toggle_collapse\", (e) => {\n@@ -172,7 +172,7 @@ export function initialize() {\n                 }\n                 e.preventDefault();\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n \n             $popper.one(\"click\", \".rehide_muted_user_message\", (e) => {\n@@ -188,23 +188,23 @@ export function initialize() {\n                 }\n                 e.preventDefault();\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n \n             $popper.one(\"click\", \".view_read_receipts\", (e) => {\n                 const message_id = $(e.currentTarget).data(\"message-id\");\n                 read_receipts.show_user_list(message_id);\n                 e.preventDefault();\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n \n             $popper.one(\"click\", \".delete_message\", (e) => {\n                 const message_id = $(e.currentTarget).data(\"message-id\");\n                 message_edit.delete_message(message_id);\n                 e.preventDefault();\n                 e.stopPropagation();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n \n             $popper.one(\"click\", \".reaction_button\", (e) => {\n@@ -216,7 +216,7 @@ export function initialize() {\n                 emoji_picker.toggle_emoji_popover(instance.reference.parentElement, message_id, {\n                     placement: \"bottom\",\n                 });\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n \n             new ClipboardJS($popper.find(\".copy_link\")[0]).on(\"success\", () => {\n@@ -226,7 +226,7 @@ export function initialize() {\n                     // We unfocus this so keyboard shortcuts, etc., will work again.\n                     $(\":focus\").trigger(\"blur\");\n                 }, 0);\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n         },\n         onHidden(instance) {"
            },
            {
                "sha": "550c0b51693377dfec7ad5f4fa97fdd8b8fec22f",
                "filename": "web/src/message_list_tooltips.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fmessage_list_tooltips.ts",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fmessage_list_tooltips.ts",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fmessage_list_tooltips.ts?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -10,6 +10,7 @@ import render_narrow_tooltip from \"../templates/narrow_tooltip.hbs\";\n \n import {$t} from \"./i18n\";\n import * as message_lists from \"./message_lists\";\n+import * as popover_menus from \"./popover_menus\";\n import * as reactions from \"./reactions\";\n import * as rows from \"./rows\";\n import {realm} from \"./state_data\";\n@@ -83,7 +84,7 @@ function hide_tooltip_if_reference_removed(\n         // We have to be smart about hiding the instance, so we hide it as soon\n         // as it is displayed.\n         setTimeout(() => {\n-            instance.hide();\n+            popover_menus.hide_current_popover_if_visible(instance);\n         }, 0);\n         return;\n     }\n@@ -92,11 +93,11 @@ function hide_tooltip_if_reference_removed(\n             for (const node of nodes_to_check_for_removal) {\n                 // Hide instance if reference's class changes.\n                 if (mutation.type === \"attributes\" && mutation.attributeName === \"class\") {\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 }\n                 // Hide instance if reference is in the removed node list.\n                 if (Array.prototype.includes.call(mutation.removedNodes, node)) {\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 }\n             }\n         }"
            },
            {
                "sha": "b995302f5adc2c06e394c00a954ec90785c34466",
                "filename": "web/src/personal_menu_popover.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fpersonal_menu_popover.js",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fpersonal_menu_popover.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fpersonal_menu_popover.js?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -71,7 +71,7 @@ export function initialize() {\n                     emoji_name: \"\",\n                     emoji_code: \"\",\n                     success() {\n-                        instance.hide();\n+                        popover_menus.hide_current_popover_if_visible(instance);\n                     },\n                 });\n             });"
            },
            {
                "sha": "fb53d749c01cce267df6191578bbc82333cbaed4",
                "filename": "web/src/popover_menus.ts",
                "status": "modified",
                "additions": 14,
                "deletions": 5,
                "changes": 19,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fpopover_menus.ts",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fpopover_menus.ts",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fpopover_menus.ts?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -149,6 +149,15 @@ function get_popover_items_for_instance(instance: PopoverInstance): JQuery | und\n     return $current_elem.find(\"a, [tabindex='0']\").filter(\":visible\");\n }\n \n+export function hide_current_popover_if_visible(instance: PopoverInstance | null): void {\n+    // Call this function instead of `instance.hide` to avoid tippy\n+    // logging about the possibility of already hidden instances,\n+    // which can occur when a click handler does a hide_all().\n+    if (instance?.state.isVisible) {\n+        instance.hide();\n+    }\n+}\n+\n export const default_popover_props: Partial<PopoverProps> = {\n     delay: 0,\n     appendTo: () => document.body,\n@@ -191,7 +200,7 @@ export const default_popover_props: Partial<PopoverProps> = {\n                         \"referenceHidden\",\n                     );\n                     if (is_reference_outside_window) {\n-                        instance.hide();\n+                        hide_current_popover_if_visible(instance);\n                         return;\n                     }\n \n@@ -250,7 +259,7 @@ export const default_popover_props: Partial<PopoverProps> = {\n                                 element.classList.contains(\"sticky_header\"),\n                         )\n                     ) {\n-                        instance.hide();\n+                        hide_current_popover_if_visible(instance);\n                     }\n                 },\n             },\n@@ -283,7 +292,7 @@ export function on_show_prep(instance: PopoverInstance): void {\n     $(instance.popper).one(\"click\", \".navigate_and_close_popover\", (e) => {\n         // Handler for links inside popover which don't need a special click handler.\n         e.stopPropagation();\n-        instance.hide();\n+        hide_current_popover_if_visible(instance);\n     });\n }\n \n@@ -361,7 +370,7 @@ export function toggle_popover_menu(\n ): PopoverInstance {\n     const instance = target._tippy;\n     if (instance) {\n-        instance.hide();\n+        hide_current_popover_if_visible(instance);\n         return instance;\n     }\n \n@@ -415,7 +424,7 @@ export function register_popover_menu(target: string, popover_props: Partial<Pop\n         const instance = toggle_popover_menu(e.currentTarget, popover_props);\n         const $popper = $(instance.popper);\n         $popper.on(\"click\", \"a[href]\", () => {\n-            instance.hide();\n+            hide_current_popover_if_visible(instance);\n         });\n     });\n }"
            },
            {
                "sha": "68b151cf2d2c93d98536df58c6d809b729743e63",
                "filename": "web/src/scheduled_messages_popover.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fscheduled_messages_popover.js",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fscheduled_messages_popover.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fscheduled_messages_popover.js?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -173,7 +173,7 @@ export function initialize() {\n             $popper.one(\"click\", \".send_later_selected_send_later_time\", () => {\n                 const send_at_timestamp = scheduled_messages.get_selected_send_later_timestamp();\n                 do_schedule_message(send_at_timestamp);\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n             // Handle clicks on Enter-to-send settings\n             $popper.one(\"click\", \".enter_sends_choice\", (e) => {\n@@ -195,13 +195,13 @@ export function initialize() {\n                 });\n                 e.stopPropagation();\n                 setTimeout(() => {\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 }, ENTER_SENDS_SELECTION_DELAY);\n             });\n             // Handle Send later clicks\n             $popper.one(\"click\", \".open_send_later_modal\", () => {\n                 open_send_later_menu();\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n         },\n         onHidden(instance) {"
            },
            {
                "sha": "cd526af874fe18999a5e61f083f616b3a8523308",
                "filename": "web/src/topic_popover.js",
                "status": "modified",
                "additions": 13,
                "deletions": 13,
                "changes": 26,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Ftopic_popover.js",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Ftopic_popover.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Ftopic_popover.js?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -58,7 +58,7 @@ export function initialize() {\n                 const {stream_id, topic_name} = instance.context;\n \n                 if (!stream_id) {\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                     return;\n                 }\n \n@@ -80,7 +80,7 @@ export function initialize() {\n                         topic_name,\n                         user_topics.all_visibility_policies.UNMUTED,\n                     );\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-remove-unmute\", () => {\n@@ -89,7 +89,7 @@ export function initialize() {\n                         topic_name,\n                         user_topics.all_visibility_policies.INHERIT,\n                     );\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-mute-topic\", () => {\n@@ -98,7 +98,7 @@ export function initialize() {\n                         topic_name,\n                         user_topics.all_visibility_policies.MUTED,\n                     );\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-remove-mute\", () => {\n@@ -107,25 +107,25 @@ export function initialize() {\n                         topic_name,\n                         user_topics.all_visibility_policies.INHERIT,\n                     );\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-unstar-all-in-topic\", () => {\n                     starred_messages_ui.confirm_unstar_all_messages_in_topic(\n                         Number.parseInt(stream_id, 10),\n                         topic_name,\n                     );\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-mark-topic-read\", () => {\n                     unread_ops.mark_topic_as_read(stream_id, topic_name);\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-mark-topic-unread\", () => {\n                     unread_ops.mark_topic_as_unread(stream_id, topic_name);\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-delete-topic-messages\", () => {\n@@ -140,31 +140,31 @@ export function initialize() {\n                         },\n                     });\n \n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-toggle-resolved\", () => {\n                     message_edit.with_first_message_id(stream_id, topic_name, (message_id) => {\n                         message_edit.toggle_resolve_topic(message_id, topic_name, true);\n                     });\n \n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-move-topic-messages\", () => {\n                     stream_popover.build_move_topic_to_stream_popover(stream_id, topic_name, false);\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 $popper.one(\"click\", \".sidebar-popover-rename-topic-messages\", () => {\n                     stream_popover.build_move_topic_to_stream_popover(stream_id, topic_name, true);\n-                    instance.hide();\n+                    popover_menus.hide_current_popover_if_visible(instance);\n                 });\n \n                 new ClipboardJS($popper.find(\".sidebar-popover-copy-link-to-topic\")[0]).on(\n                     \"success\",\n                     () => {\n-                        instance.hide();\n+                        popover_menus.hide_current_popover_if_visible(instance);\n                     },\n                 );\n             },"
            },
            {
                "sha": "7ccd0b0c8d97a61e74b3a724cd18dd138f292d91",
                "filename": "web/src/user_topic_popover.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/zulip/zulip/blob/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fuser_topic_popover.js",
                "raw_url": "https://github.com/zulip/zulip/raw/0a90a13becbf0338a8fc1ad37946e51c2c25b0a5/web%2Fsrc%2Fuser_topic_popover.js",
                "contents_url": "https://api.github.com/repos/zulip/zulip/contents/web%2Fsrc%2Fuser_topic_popover.js?ref=0a90a13becbf0338a8fc1ad37946e51c2c25b0a5",
                "patch": "@@ -43,7 +43,7 @@ export function initialize() {\n             const {stream_id, topic_name} = instance.context;\n \n             if (!stream_id) {\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n                 return;\n             }\n \n@@ -58,7 +58,7 @@ export function initialize() {\n                     topic_name,\n                     visibility_policy,\n                 );\n-                instance.hide();\n+                popover_menus.hide_current_popover_if_visible(instance);\n             });\n         },\n         onHidden(instance) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/symfony/symfony/commits/a804ca15fcad279d7727b91d12a667fd5b925995",
        "url": "https://api.github.com/repos/symfony/symfony/commits/a804ca15fcad279d7727b91d12a667fd5b925995",
        "html_url": "https://github.com/symfony/symfony/commit/a804ca15fcad279d7727b91d12a667fd5b925995",
        "message": "[Security] Ignore empty username or password login attempts",
        "files": [
            {
                "sha": "9d638b7fd649487bb7c06cd13c5c57a0902a7f07",
                "filename": "src/Symfony/Component/Security/Http/Authenticator/FormLoginAuthenticator.php",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/symfony/symfony/blob/a804ca15fcad279d7727b91d12a667fd5b925995/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FAuthenticator%2FFormLoginAuthenticator.php",
                "raw_url": "https://github.com/symfony/symfony/raw/a804ca15fcad279d7727b91d12a667fd5b925995/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FAuthenticator%2FFormLoginAuthenticator.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FAuthenticator%2FFormLoginAuthenticator.php?ref=a804ca15fcad279d7727b91d12a667fd5b925995",
                "patch": "@@ -129,12 +129,20 @@ private function getCredentials(Request $request): array\n \n         $credentials['username'] = trim($credentials['username']);\n \n+        if ('' === $credentials['username']) {\n+            throw new BadRequestHttpException(sprintf('The key \"%s\" must be a non-empty string.', $this->options['username_parameter']));\n+        }\n+\n         $request->getSession()->set(SecurityRequestAttributes::LAST_USERNAME, $credentials['username']);\n \n         if (!\\is_string($credentials['password']) && (!\\is_object($credentials['password']) || !method_exists($credentials['password'], '__toString'))) {\n             throw new BadRequestHttpException(sprintf('The key \"%s\" must be a string, \"%s\" given.', $this->options['password_parameter'], \\gettype($credentials['password'])));\n         }\n \n+        if ('' === (string) $credentials['password']) {\n+            throw new BadRequestHttpException(sprintf('The key \"%s\" must be a non-empty string.', $this->options['password_parameter']));\n+        }\n+\n         return $credentials;\n     }\n "
            },
            {
                "sha": "a8e710597a989f2e5470db1f39401ff5757c7a3d",
                "filename": "src/Symfony/Component/Security/Http/CHANGELOG.md",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/symfony/symfony/blob/a804ca15fcad279d7727b91d12a667fd5b925995/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FCHANGELOG.md",
                "raw_url": "https://github.com/symfony/symfony/raw/a804ca15fcad279d7727b91d12a667fd5b925995/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FCHANGELOG.md",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FCHANGELOG.md?ref=a804ca15fcad279d7727b91d12a667fd5b925995",
                "patch": "@@ -6,6 +6,7 @@ CHANGELOG\n \n  * Add `#[IsCsrfTokenValid]` attribute\n  * Add CAS 2.0 access token handler\n+ * Make empty username or empty password on form login attempts return Bad Request (400)\n \n 7.0\n ---"
            },
            {
                "sha": "bc8c49b2b3d147911ee4bb15f8fd96be613c6085",
                "filename": "src/Symfony/Component/Security/Http/Tests/Authenticator/FormLoginAuthenticatorTest.php",
                "status": "modified",
                "additions": 24,
                "deletions": 0,
                "changes": 24,
                "blob_url": "https://github.com/symfony/symfony/blob/a804ca15fcad279d7727b91d12a667fd5b925995/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FTests%2FAuthenticator%2FFormLoginAuthenticatorTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/a804ca15fcad279d7727b91d12a667fd5b925995/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FTests%2FAuthenticator%2FFormLoginAuthenticatorTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FTests%2FAuthenticator%2FFormLoginAuthenticatorTest.php?ref=a804ca15fcad279d7727b91d12a667fd5b925995",
                "patch": "@@ -42,6 +42,30 @@ protected function setUp(): void\n         $this->failureHandler = $this->createMock(AuthenticationFailureHandlerInterface::class);\n     }\n \n+    public function testHandleWhenUsernameEmpty()\n+    {\n+        $this->expectException(BadRequestHttpException::class);\n+        $this->expectExceptionMessage('The key \"_username\" must be a non-empty string.');\n+\n+        $request = Request::create('/login_check', 'POST', ['_username' => '', '_password' => 's$cr$t']);\n+        $request->setSession($this->createSession());\n+\n+        $this->setUpAuthenticator();\n+        $this->authenticator->authenticate($request);\n+    }\n+\n+    public function testHandleWhenPasswordEmpty()\n+    {\n+        $this->expectException(BadRequestHttpException::class);\n+        $this->expectExceptionMessage('The key \"_password\" must be a non-empty string.');\n+\n+        $request = Request::create('/login_check', 'POST', ['_username' => 'foo', '_password' => '']);\n+        $request->setSession($this->createSession());\n+\n+        $this->setUpAuthenticator();\n+        $this->authenticator->authenticate($request);\n+    }\n+\n     /**\n      * @dataProvider provideUsernamesForLength\n      */"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/proftpd/proftpd/commits/cec01cc0a2523453e5da5a486bc6d977c3768db1",
        "url": "https://api.github.com/repos/proftpd/proftpd/commits/cec01cc0a2523453e5da5a486bc6d977c3768db1",
        "html_url": "https://github.com/proftpd/proftpd/commit/cec01cc0a2523453e5da5a486bc6d977c3768db1",
        "message": "Issue #1830: When no supplemental groups are provided by the underlying authentication providers, fall back to using the primary group/GID. (#1835)\n\nThis prevents surprise due to inheritance of the parent processes' supplemental group membership, which might inadvertently provided undesired access.",
        "files": [
            {
                "sha": "cf3edc43771bdb2c79dd406e8bed1f7de5dabc97",
                "filename": "NEWS",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/proftpd/proftpd/blob/cec01cc0a2523453e5da5a486bc6d977c3768db1/NEWS",
                "raw_url": "https://github.com/proftpd/proftpd/raw/cec01cc0a2523453e5da5a486bc6d977c3768db1/NEWS",
                "contents_url": "https://api.github.com/repos/proftpd/proftpd/contents/NEWS?ref=cec01cc0a2523453e5da5a486bc6d977c3768db1",
                "patch": "@@ -35,6 +35,8 @@\n   configuring appropriate key.\n - Issue 1840 - RADIUS Message-Authenticator verification failed with ProFTPD\n   mod_radius.\n+- Issue 1830 - Supplemental group inheritance grants unintended access to\n+  GID 0 due to lack of supplemental groups from mod_sql.\n \n 1.3.9rc2 - Released 19-Dec-2023\n --------------------------------"
            },
            {
                "sha": "8db46c4e9d7b0a577669dca09c787a7909e55b41",
                "filename": "contrib/mod_sftp/auth.c",
                "status": "modified",
                "additions": 13,
                "deletions": 1,
                "changes": 14,
                "blob_url": "https://github.com/proftpd/proftpd/blob/cec01cc0a2523453e5da5a486bc6d977c3768db1/contrib%2Fmod_sftp%2Fauth.c",
                "raw_url": "https://github.com/proftpd/proftpd/raw/cec01cc0a2523453e5da5a486bc6d977c3768db1/contrib%2Fmod_sftp%2Fauth.c",
                "contents_url": "https://api.github.com/repos/proftpd/proftpd/contents/contrib%2Fmod_sftp%2Fauth.c?ref=cec01cc0a2523453e5da5a486bc6d977c3768db1",
                "patch": "@@ -418,8 +418,20 @@ static int setup_env(pool *p, const char *user) {\n       session.groups == NULL) {\n     res = pr_auth_getgroups(p, pw->pw_name, &session.gids, &session.groups);\n     if (res < 1) {\n+      /* If no supplemental groups are provided, default to using the process\n+       * primary GID as the supplemental group.  This prevents access\n+       * regressions as seen in Issue #1830.\n+       */\n       (void) pr_log_writefile(sftp_logfd, MOD_SFTP_VERSION,\n-        \"no supplemental groups found for user '%s'\", pw->pw_name);\n+        \"no supplemental groups found for user '%s', \"\n+        \"using primary group %s (GID %lu)\", pw->pw_name, session.group,\n+        (unsigned long) session.login_gid);\n+\n+      session.gids = make_array(p, 2, sizeof(gid_t));\n+      session.groups = make_array(p, 2, sizeof(char *));\n+\n+      *((gid_t *) push_array(session.gids)) = session.login_gid;\n+      *((char **) push_array(session.groups)) = pstrdup(p, session.group);\n     }\n   }\n "
            },
            {
                "sha": "2c8e9d6a3c6b080f89d745e49ced70061c7922f2",
                "filename": "modules/mod_auth.c",
                "status": "modified",
                "additions": 16,
                "deletions": 5,
                "changes": 21,
                "blob_url": "https://github.com/proftpd/proftpd/blob/cec01cc0a2523453e5da5a486bc6d977c3768db1/modules%2Fmod_auth.c",
                "raw_url": "https://github.com/proftpd/proftpd/raw/cec01cc0a2523453e5da5a486bc6d977c3768db1/modules%2Fmod_auth.c",
                "contents_url": "https://api.github.com/repos/proftpd/proftpd/contents/modules%2Fmod_auth.c?ref=cec01cc0a2523453e5da5a486bc6d977c3768db1",
                "patch": "@@ -2,7 +2,7 @@\n  * ProFTPD - FTP server daemon\n  * Copyright (c) 1997, 1998 Public Flood Software\n  * Copyright (c) 1999, 2000 MacGyver aka Habeeb J. Dihu <macgyver@tos.net>\n- * Copyright (c) 2001-2023 The ProFTPD Project team\n+ * Copyright (c) 2001-2024 The ProFTPD Project team\n  *\n  * This program is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -1140,8 +1140,8 @@ static int setup_env(pool *p, cmd_rec *cmd, const char *user, char *pass) {\n     session.groups = NULL;\n   }\n \n-  if (!session.gids &&\n-      !session.groups) {\n+  if (session.gids == NULL &&\n+      session.groups == NULL) {\n     /* Get the supplemental groups.  Note that we only look up the\n      * supplemental group credentials if we have not cached the group\n      * credentials before, in session.gids and session.groups.\n@@ -1151,8 +1151,19 @@ static int setup_env(pool *p, cmd_rec *cmd, const char *user, char *pass) {\n      */\n      res = pr_auth_getgroups(p, pw->pw_name, &session.gids, &session.groups);\n      if (res < 1) {\n-       pr_log_debug(DEBUG5, \"no supplemental groups found for user '%s'\",\n-         pw->pw_name);\n+       /* If no supplemental groups are provided, default to using the process\n+        * primary GID as the supplemental group.  This prevents access\n+        * regressions as seen in Issue #1830.\n+        */\n+       pr_log_debug(DEBUG5, \"no supplemental groups found for user '%s', \"\n+         \"using primary group %s (GID %lu)\", pw->pw_name, session.group,\n+         (unsigned long) session.login_gid);\n+\n+       session.gids = make_array(p, 2, sizeof(gid_t));\n+       session.groups = make_array(p, 2, sizeof(char *));\n+\n+       *((gid_t *) push_array(session.gids)) = session.login_gid;\n+       *((char **) push_array(session.groups)) = pstrdup(p, session.group);\n      }\n   }\n "
            },
            {
                "sha": "7961ca6866622fcbf64c1b40181a6c65436f1e80",
                "filename": "src/auth.c",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/proftpd/proftpd/blob/cec01cc0a2523453e5da5a486bc6d977c3768db1/src%2Fauth.c",
                "raw_url": "https://github.com/proftpd/proftpd/raw/cec01cc0a2523453e5da5a486bc6d977c3768db1/src%2Fauth.c",
                "contents_url": "https://api.github.com/repos/proftpd/proftpd/contents/src%2Fauth.c?ref=cec01cc0a2523453e5da5a486bc6d977c3768db1",
                "patch": "@@ -2,7 +2,7 @@\n  * ProFTPD - FTP server daemon\n  * Copyright (c) 1997, 1998 Public Flood Software\n  * Copyright (c) 1999, 2000 MacGyver aka Habeeb J. Dihu <macgyver@tos.net>\n- * Copyright (c) 2001-2022 The ProFTPD Project team\n+ * Copyright (c) 2001-2024 The ProFTPD Project team\n  *\n  * This program is free software; you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as published by\n@@ -1471,12 +1471,12 @@ int pr_auth_getgroups(pool *p, const char *name, array_header **group_ids,\n   }\n \n   /* Allocate memory for the array_headers of GIDs and group names. */\n-  if (group_ids) {\n-    *group_ids = make_array(permanent_pool, 2, sizeof(gid_t));\n+  if (group_ids != NULL) {\n+    *group_ids = make_array(p, 2, sizeof(gid_t));\n   }\n \n-  if (group_names) {\n-    *group_names = make_array(permanent_pool, 2, sizeof(char *));\n+  if (group_names != NULL) {\n+    *group_names = make_array(p, 2, sizeof(char *));\n   }\n \n   cmd = make_cmd(p, 3, name, group_ids ? *group_ids : NULL,\n@@ -1495,7 +1495,7 @@ int pr_auth_getgroups(pool *p, const char *name, array_header **group_ids,\n      * for the benefit of auth_getgroup() implementors.\n      */\n \n-    if (group_ids) {\n+    if (group_ids != NULL) {\n       register unsigned int i;\n       char *strgids = \"\";\n       gid_t *gids = (*group_ids)->elts;\n@@ -1511,7 +1511,7 @@ int pr_auth_getgroups(pool *p, const char *name, array_header **group_ids,\n         *strgids ? strgids : \"(None; corrupted group file?)\");\n     }\n \n-    if (group_names) {\n+    if (group_names != NULL) {\n       register unsigned int i;\n       char *strgroups = \"\";\n       char **groups = (*group_names)->elts;\n@@ -1527,7 +1527,7 @@ int pr_auth_getgroups(pool *p, const char *name, array_header **group_ids,\n     }\n   }\n \n-  if (cmd->tmp_pool) {\n+  if (cmd->tmp_pool != NULL) {\n     destroy_pool(cmd->tmp_pool);\n     cmd->tmp_pool = NULL;\n   }"
            },
            {
                "sha": "dbdcfdde58962cecf35cfae61afa69440d1baae5",
                "filename": "tests/t/lib/ProFTPD/Tests/Modules/mod_sql_sqlite.pm",
                "status": "modified",
                "additions": 174,
                "deletions": 0,
                "changes": 174,
                "blob_url": "https://github.com/proftpd/proftpd/blob/cec01cc0a2523453e5da5a486bc6d977c3768db1/tests%2Ft%2Flib%2FProFTPD%2FTests%2FModules%2Fmod_sql_sqlite.pm",
                "raw_url": "https://github.com/proftpd/proftpd/raw/cec01cc0a2523453e5da5a486bc6d977c3768db1/tests%2Ft%2Flib%2FProFTPD%2FTests%2FModules%2Fmod_sql_sqlite.pm",
                "contents_url": "https://api.github.com/repos/proftpd/proftpd/contents/tests%2Ft%2Flib%2FProFTPD%2FTests%2FModules%2Fmod_sql_sqlite.pm?ref=cec01cc0a2523453e5da5a486bc6d977c3768db1",
                "patch": "@@ -467,6 +467,11 @@ my $TESTS = {\n     order => ++$order,\n     test_class => [qw(forking bug mod_tls)],\n   },\n+\n+  sql_user_info_no_suppl_groups_issue1830 => {\n+    order => ++$order,\n+    test_class => [qw(forking bug rootprivs)],\n+  },\n };\n \n sub new {\n@@ -15764,4 +15769,173 @@ EOC\n   test_cleanup($setup->{log_file}, $ex);\n }\n \n+sub sql_user_info_no_suppl_groups_issue1830 {\n+  my $self = shift;\n+  my $tmpdir = $self->{tmpdir};\n+  my $setup = test_setup($tmpdir, 'sqlite');\n+\n+  my $db_file = File::Spec->rel2abs(\"$tmpdir/proftpd.db\");\n+\n+  # Build up sqlite3 command to create users, groups tables and populate them\n+  my $db_script = File::Spec->rel2abs(\"$tmpdir/proftpd.sql\");\n+\n+  if (open(my $fh, \"> $db_script\")) {\n+    print $fh <<EOS;\n+CREATE TABLE users (\n+  userid TEXT,\n+  passwd TEXT,\n+  uid INTEGER,\n+  gid INTEGER,\n+  homedir TEXT,\n+  shell TEXT\n+);\n+INSERT INTO users (userid, passwd, uid, gid, homedir, shell) VALUES ('$setup->{user}', '$setup->{passwd}', $setup->{uid}, $setup->{gid}, '$setup->{home_dir}', '/bin/bash');\n+\n+CREATE TABLE groups (\n+  groupname TEXT,\n+  gid INTEGER,\n+  members TEXT\n+);\n+INSERT INTO groups (groupname, gid, members) VALUES ('$setup->{group}', $setup->{gid}, '$setup->{user}');\n+EOS\n+\n+    unless (close($fh)) {\n+      die(\"Can't write $db_script: $!\");\n+    }\n+\n+  } else {\n+    die(\"Can't open $db_script: $!\");\n+  }\n+\n+  my $cmd = \"sqlite3 $db_file < $db_script\";\n+  build_db($cmd, $db_script);\n+\n+  # Make sure that, if we're running as root, the database file has\n+  # the permissions/privs set for use by proftpd\n+  if ($< == 0) {\n+    unless (chmod(0666, $db_file)) {\n+      die(\"Can't set perms on $db_file to 0666: $!\");\n+    }\n+  }\n+\n+  my $config = {\n+    PidFile => $setup->{pid_file},\n+    ScoreboardFile => $setup->{scoreboard_file},\n+    SystemLog => $setup->{log_file},\n+    TraceLog => $setup->{log_file},\n+    Trace => 'auth:20 sql:20',\n+\n+    # Required for logging the expected message\n+    DebugLevel => 5,\n+\n+    IfModules => {\n+      'mod_delay.c' => {\n+        DelayEngine => 'off',\n+      },\n+\n+      'mod_sql.c' => {\n+        AuthOrder => 'mod_sql.c',\n+\n+        SQLAuthenticate => 'users',\n+        SQLAuthTypes => 'plaintext',\n+        SQLBackend => 'sqlite3',\n+        SQLConnectInfo => $db_file,\n+        SQLLogFile => $setup->{log_file},\n+\n+        # Set these, so that our lower UID/GID will be used\n+        SQLMinUserUID => 100,\n+        SQLMinUserGID => 100,\n+      },\n+    },\n+  };\n+\n+  my ($port, $config_user, $config_group) = config_write($setup->{config_file},\n+    $config);\n+\n+  # Open pipes, for use between the parent and child processes.  Specifically,\n+  # the child will indicate when it's done with its test by writing a message\n+  # to the parent.\n+  my ($rfh, $wfh);\n+  unless (pipe($rfh, $wfh)) {\n+    die(\"Can't open pipe: $!\");\n+  }\n+\n+  my $ex;\n+\n+  # Fork child\n+  $self->handle_sigchld();\n+  defined(my $pid = fork()) or die(\"Can't fork: $!\");\n+  if ($pid) {\n+    eval {\n+      sleep(2);\n+\n+      my $client = ProFTPD::TestSuite::FTP->new('127.0.0.1', $port);\n+      $client->login($setup->{user}, $setup->{passwd});\n+\n+      my $resp_msgs = $client->response_msgs();\n+      my $nmsgs = scalar(@$resp_msgs);\n+\n+      my $expected = 1;\n+      $self->assert($expected == $nmsgs,\n+        test_msg(\"Expected $expected, got $nmsgs\"));\n+\n+      $expected = \"User $setup->{user} logged in\";\n+      $self->assert($expected eq $resp_msgs->[0],\n+        test_msg(\"Expected response '$expected', got '$resp_msgs->[0]'\"));\n+\n+      $client->quit();\n+    };\n+    if ($@) {\n+      $ex = $@;\n+    }\n+\n+    $wfh->print(\"done\\n\");\n+    $wfh->flush();\n+\n+  } else {\n+    eval { server_wait($setup->{config_file}, $rfh) };\n+    if ($@) {\n+      warn($@);\n+      exit 1;\n+    }\n+\n+    exit 0;\n+  }\n+\n+  # Stop server\n+  server_stop($setup->{pid_file});\n+  $self->assert_child_ok($pid);\n+\n+  eval {\n+    if (open(my $fh, \"< $setup->{log_file}\")) {\n+      my $ok = 0;\n+\n+      while (my $line = <$fh>) {\n+        chomp($line);\n+\n+        if ($ENV{TEST_VERBOSE}) {\n+          print STDERR \"# $line\\n\";\n+        }\n+\n+        if ($line =~ /no supplemental groups found for user '$setup->{user}', using primary group/) {\n+          $ok = 1;\n+          last;\n+        }\n+      }\n+\n+      close($fh);\n+\n+      $self->assert($ok, test_msg(\"Did not see expected log message\"));\n+\n+    } else {\n+      die(\"Can't read $setup->{log_file}: $!\");\n+    }\n+  };\n+  if ($@) {\n+    $ex = $@ unless $ex;\n+  }\n+\n+  test_cleanup($setup->{log_file}, $ex);\n+}\n+\n 1;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moby/moby/commits/8e3bcf19748838b30e34d612832d1dc9d90363b8",
        "url": "https://api.github.com/repos/moby/moby/commits/8e3bcf19748838b30e34d612832d1dc9d90363b8",
        "html_url": "https://github.com/moby/moby/commit/8e3bcf19748838b30e34d612832d1dc9d90363b8",
        "message": "pkg/streamformatter: Make `progressOutput` concurrency safe\n\nSync access to the underlying `io.Writer` with a mutex.\n\nSigned-off-by: Pawe\u0142 Gronowski <pawel.gronowski@docker.com>\n(cherry picked from commit 5689dabfb357b673abdb4391eef426f297d7d1bb)\nSigned-off-by: Albin Kerouanton <albinker@gmail.com>",
        "files": [
            {
                "sha": "098df6b5236b940a6f5d0cf47a6cddb6852e5635",
                "filename": "pkg/streamformatter/streamformatter.go",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/moby/moby/blob/8e3bcf19748838b30e34d612832d1dc9d90363b8/pkg%2Fstreamformatter%2Fstreamformatter.go",
                "raw_url": "https://github.com/moby/moby/raw/8e3bcf19748838b30e34d612832d1dc9d90363b8/pkg%2Fstreamformatter%2Fstreamformatter.go",
                "contents_url": "https://api.github.com/repos/moby/moby/contents/pkg%2Fstreamformatter%2Fstreamformatter.go?ref=8e3bcf19748838b30e34d612832d1dc9d90363b8",
                "patch": "@@ -5,6 +5,7 @@ import (\n \t\"encoding/json\"\n \t\"fmt\"\n \t\"io\"\n+\t\"sync\"\n \n \t\"github.com/docker/docker/pkg/jsonmessage\"\n \t\"github.com/docker/docker/pkg/progress\"\n@@ -109,6 +110,7 @@ type progressOutput struct {\n \tsf       formatProgress\n \tout      io.Writer\n \tnewLines bool\n+\tmu       sync.Mutex\n }\n \n // WriteProgress formats progress information from a ProgressReader.\n@@ -120,6 +122,9 @@ func (out *progressOutput) WriteProgress(prog progress.Progress) error {\n \t\tjsonProgress := jsonmessage.JSONProgress{Current: prog.Current, Total: prog.Total, HideCounts: prog.HideCounts, Units: prog.Units}\n \t\tformatted = out.sf.formatProgress(prog.ID, prog.Action, &jsonProgress, prog.Aux)\n \t}\n+\n+\tout.mu.Lock()\n+\tdefer out.mu.Unlock()\n \t_, err := out.out.Write(formatted)\n \tif err != nil {\n \t\treturn err"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moby/moby/commits/5689dabfb357b673abdb4391eef426f297d7d1bb",
        "url": "https://api.github.com/repos/moby/moby/commits/5689dabfb357b673abdb4391eef426f297d7d1bb",
        "html_url": "https://github.com/moby/moby/commit/5689dabfb357b673abdb4391eef426f297d7d1bb",
        "message": "pkg/streamformatter: Make `progressOutput` concurrency safe\n\nSync access to the underlying `io.Writer` with a mutex.\n\nSigned-off-by: Pawe\u0142 Gronowski <pawel.gronowski@docker.com>",
        "files": [
            {
                "sha": "098df6b5236b940a6f5d0cf47a6cddb6852e5635",
                "filename": "pkg/streamformatter/streamformatter.go",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/moby/moby/blob/5689dabfb357b673abdb4391eef426f297d7d1bb/pkg%2Fstreamformatter%2Fstreamformatter.go",
                "raw_url": "https://github.com/moby/moby/raw/5689dabfb357b673abdb4391eef426f297d7d1bb/pkg%2Fstreamformatter%2Fstreamformatter.go",
                "contents_url": "https://api.github.com/repos/moby/moby/contents/pkg%2Fstreamformatter%2Fstreamformatter.go?ref=5689dabfb357b673abdb4391eef426f297d7d1bb",
                "patch": "@@ -5,6 +5,7 @@ import (\n \t\"encoding/json\"\n \t\"fmt\"\n \t\"io\"\n+\t\"sync\"\n \n \t\"github.com/docker/docker/pkg/jsonmessage\"\n \t\"github.com/docker/docker/pkg/progress\"\n@@ -109,6 +110,7 @@ type progressOutput struct {\n \tsf       formatProgress\n \tout      io.Writer\n \tnewLines bool\n+\tmu       sync.Mutex\n }\n \n // WriteProgress formats progress information from a ProgressReader.\n@@ -120,6 +122,9 @@ func (out *progressOutput) WriteProgress(prog progress.Progress) error {\n \t\tjsonProgress := jsonmessage.JSONProgress{Current: prog.Current, Total: prog.Total, HideCounts: prog.HideCounts, Units: prog.Units}\n \t\tformatted = out.sf.formatProgress(prog.ID, prog.Action, &jsonProgress, prog.Aux)\n \t}\n+\n+\tout.mu.Lock()\n+\tdefer out.mu.Unlock()\n \t_, err := out.out.Write(formatted)\n \tif err != nil {\n \t\treturn err"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moby/moby/commits/37545cc644344dcb576cba67eb7b6f51a463d31e",
        "url": "https://api.github.com/repos/moby/moby/commits/37545cc644344dcb576cba67eb7b6f51a463d31e",
        "html_url": "https://github.com/moby/moby/commit/37545cc644344dcb576cba67eb7b6f51a463d31e",
        "message": "builder-next: fix missing lock in ensurelayer\n\nWhen this was called concurrently from the moby image\nexporter there could be a data race where a layer was\nwritten to the refs map when it was already there.\n\nIn that case the reference count got mixed up and on\nrelease only one of these layers was actually released.\n\nSigned-off-by: Tonis Tiigi <tonistiigi@gmail.com>",
        "files": [
            {
                "sha": "fc83058339c7b32449bddb2fa8bc355b79574edc",
                "filename": "builder/builder-next/adapters/snapshot/layer.go",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/moby/moby/blob/37545cc644344dcb576cba67eb7b6f51a463d31e/builder%2Fbuilder-next%2Fadapters%2Fsnapshot%2Flayer.go",
                "raw_url": "https://github.com/moby/moby/raw/37545cc644344dcb576cba67eb7b6f51a463d31e/builder%2Fbuilder-next%2Fadapters%2Fsnapshot%2Flayer.go",
                "contents_url": "https://api.github.com/repos/moby/moby/contents/builder%2Fbuilder-next%2Fadapters%2Fsnapshot%2Flayer.go?ref=37545cc644344dcb576cba67eb7b6f51a463d31e",
                "patch": "@@ -22,6 +22,9 @@ func (s *snapshotter) GetDiffIDs(ctx context.Context, key string) ([]layer.DiffI\n }\n \n func (s *snapshotter) EnsureLayer(ctx context.Context, key string) ([]layer.DiffID, error) {\n+\ts.layerCreateLocker.Lock(key)\n+\tdefer s.layerCreateLocker.Unlock(key)\n+\n \tdiffIDs, err := s.GetDiffIDs(ctx, key)\n \tif err != nil {\n \t\treturn nil, err"
            },
            {
                "sha": "510ffefb4940655682a32a94b006c6d44ab14e6b",
                "filename": "builder/builder-next/adapters/snapshot/snapshot.go",
                "status": "modified",
                "additions": 11,
                "deletions": 8,
                "changes": 19,
                "blob_url": "https://github.com/moby/moby/blob/37545cc644344dcb576cba67eb7b6f51a463d31e/builder%2Fbuilder-next%2Fadapters%2Fsnapshot%2Fsnapshot.go",
                "raw_url": "https://github.com/moby/moby/raw/37545cc644344dcb576cba67eb7b6f51a463d31e/builder%2Fbuilder-next%2Fadapters%2Fsnapshot%2Fsnapshot.go",
                "contents_url": "https://api.github.com/repos/moby/moby/contents/builder%2Fbuilder-next%2Fadapters%2Fsnapshot%2Fsnapshot.go?ref=37545cc644344dcb576cba67eb7b6f51a463d31e",
                "patch": "@@ -17,6 +17,7 @@ import (\n \t\"github.com/moby/buildkit/identity\"\n \t\"github.com/moby/buildkit/snapshot\"\n \t\"github.com/moby/buildkit/util/leaseutil\"\n+\t\"github.com/moby/locker\"\n \t\"github.com/opencontainers/go-digest\"\n \t\"github.com/pkg/errors\"\n \tbolt \"go.etcd.io/bbolt\"\n@@ -51,10 +52,11 @@ type checksumCalculator interface {\n type snapshotter struct {\n \topt Opt\n \n-\trefs map[string]layer.Layer\n-\tdb   *bolt.DB\n-\tmu   sync.Mutex\n-\treg  graphIDRegistrar\n+\trefs              map[string]layer.Layer\n+\tdb                *bolt.DB\n+\tmu                sync.Mutex\n+\treg               graphIDRegistrar\n+\tlayerCreateLocker *locker.Locker\n }\n \n // NewSnapshotter creates a new snapshotter\n@@ -71,10 +73,11 @@ func NewSnapshotter(opt Opt, prevLM leases.Manager, ns string) (snapshot.Snapsho\n \t}\n \n \ts := &snapshotter{\n-\t\topt:  opt,\n-\t\tdb:   db,\n-\t\trefs: map[string]layer.Layer{},\n-\t\treg:  reg,\n+\t\topt:               opt,\n+\t\tdb:                db,\n+\t\trefs:              map[string]layer.Layer{},\n+\t\treg:               reg,\n+\t\tlayerCreateLocker: locker.New(),\n \t}\n \n \tslm := newLeaseManager(s, prevLM)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moby/moby/commits/ab570ab3d62038b3d26f96a9bb585d0b6095b9b4",
        "url": "https://api.github.com/repos/moby/moby/commits/ab570ab3d62038b3d26f96a9bb585d0b6095b9b4",
        "html_url": "https://github.com/moby/moby/commit/ab570ab3d62038b3d26f96a9bb585d0b6095b9b4",
        "message": "nil dereference fix on image history Created value\n\nIssue was caused by the changes here https://github.com/moby/moby/pull/45504\nFirst released in v25.0.0-beta.1\n\nSigned-off-by: Christopher Petito <47751006+krissetto@users.noreply.github.com>",
        "files": [
            {
                "sha": "f621ceae13bc689b4d075d1005d454be577dfb1f",
                "filename": "daemon/images/image_history.go",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/moby/moby/blob/ab570ab3d62038b3d26f96a9bb585d0b6095b9b4/daemon%2Fimages%2Fimage_history.go",
                "raw_url": "https://github.com/moby/moby/raw/ab570ab3d62038b3d26f96a9bb585d0b6095b9b4/daemon%2Fimages%2Fimage_history.go",
                "contents_url": "https://api.github.com/repos/moby/moby/contents/daemon%2Fimages%2Fimage_history.go?ref=ab570ab3d62038b3d26f96a9bb585d0b6095b9b4",
                "patch": "@@ -43,9 +43,14 @@ func (i *ImageService) ImageHistory(ctx context.Context, name string) ([]*image.\n \t\t\tlayerCounter++\n \t\t}\n \n+\t\tvar created int64\n+\t\tif h.Created != nil {\n+\t\t\tcreated = h.Created.Unix()\n+\t\t}\n+\n \t\thistory = append([]*image.HistoryResponseItem{{\n \t\t\tID:        \"<missing>\",\n-\t\t\tCreated:   h.Created.Unix(),\n+\t\t\tCreated:   created,\n \t\t\tCreatedBy: h.CreatedBy,\n \t\t\tComment:   h.Comment,\n \t\t\tSize:      layerSize,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/arrow/commits/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b",
        "url": "https://api.github.com/repos/apache/arrow/commits/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b",
        "html_url": "https://github.com/apache/arrow/commit/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b",
        "message": "GH-42143: [R] Sanitize R metadata (#41969)\n\n### Rationale for this change\r\n\r\n`arrow` uses R `serialize()`/`unserialize()` to store additional\r\nmetadata in the Arrow schema. This PR adds some extra checking and\r\nsanitizing in order to make the reading of this metadata robust to data\r\nof unknown provenance.\r\n\r\n### What changes are included in this PR?\r\n\r\n* When writing metadata, we strip out all but simple types: strings,\r\nnumbers, boolean, lists, etc. Objects of other types, such as\r\nenvironments, external pointers, and other language types, are removed.\r\n* When reading metadata, the same filter is applied. If there are types\r\nthat are not in the allowlist, one of two things happen. By default,\r\nthey are removed with a warning. If you set\r\n`options(arrow.unsafe_metadata = TRUE)`, the full metadata including\r\ndisallowed types is returned, also with a warning. This option is an\r\nescape hatch in case we are too strict with dropping types when reading\r\nfiles produced by older versions of the package that did not filter them\r\nout.\r\n* `unserialize()` is called in a way that prevents promises contained in\r\nthe data from being automatically invoked. This technique works on all\r\nversions of R: it is not dependent on the patch for RDS reading that was\r\nincluded in 4.4.\r\n* Other sanity checking to be stricter about only reading back in\r\nsomething of the form we wrote out: assert that the data is\r\nASCII-serialized, and if it is compressed, it is gzip, the same way we\r\ndo on serialization. It's not clear that it's necessary, but it's not\r\nbad to be extra strict here.\r\n\r\n### Are these changes tested?\r\n\r\nYes\r\n\r\n### Are there any user-facing changes?\r\n\r\nFor most, no. But:\r\n\r\n**This PR contains a \"Critical Fix\".** \r\n\r\nWithout this patch, it is possible to construct an Arrow or Parquet file\r\nthat would contain code that would execute when the R metadata is\r\napplied when converting to a data.frame. If you are using an older\r\nversion of the package and are reading data from a source you do not\r\ntrust, you can read into a `Table` and use its internal\r\n`$to_data_frame()` method, like `read_parquet(..., as_data_frame =\r\nFALSE)$to_data_frame()`. This should skip the reading of the R metadata.\r\n* GitHub Issue: #42143",
        "files": [
            {
                "sha": "317e546a1b70f1cd98aba2e9e20988232bd69f6b",
                "filename": "r/NEWS.md",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/apache/arrow/blob/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b/r%2FNEWS.md",
                "raw_url": "https://github.com/apache/arrow/raw/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b/r%2FNEWS.md",
                "contents_url": "https://api.github.com/repos/apache/arrow/contents/r%2FNEWS.md?ref=801de2fbcf5bcbce0c019ed4b35ff3fc863b141b",
                "patch": "@@ -19,11 +19,10 @@\n \n # arrow 16.1.0.9000\n \n-# arrow 16.1.0\n-\n * R functions that users write that use functions that Arrow supports in dataset queries now can be used in queries too. Previously, only functions that used arithmetic operators worked. For example, `time_hours <- function(mins) mins / 60` worked, but `time_hours_rounded <- function(mins) round(mins / 60)` did not; now both work. These are automatic translations rather than true user-defined functions (UDFs); for UDFs, see `register_scalar_function()`. (#41223)\n * `summarize()` supports more complex expressions, and correctly handles cases where column names are reused in expressions. \n * The `na_matches` argument to the `dplyr::*_join()` functions is now supported. This argument controls whether `NA` values are considered equal when joining. (#41358)\n+* R metadata, stored in the Arrow schema to support round-tripping data between R and Arrow/Parquet, is now serialized and deserialized more strictly. This makes it safer to load data from files from unknown sources into R data.frames. (#41969)\n \n # arrow 16.1.0\n "
            },
            {
                "sha": "3529144e115004e6194a5970ef68bdfffcb3342d",
                "filename": "r/R/extension.R",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/arrow/blob/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b/r%2FR%2Fextension.R",
                "raw_url": "https://github.com/apache/arrow/raw/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b/r%2FR%2Fextension.R",
                "contents_url": "https://api.github.com/repos/apache/arrow/contents/r%2FR%2Fextension.R?ref=801de2fbcf5bcbce0c019ed4b35ff3fc863b141b",
                "patch": "@@ -429,7 +429,7 @@ VctrsExtensionType <- R6Class(\"VctrsExtensionType\",\n       paste0(capture.output(print(self$ptype())), collapse = \"\\n\")\n     },\n     deserialize_instance = function() {\n-      private$.ptype <- unserialize(self$extension_metadata())\n+      private$.ptype <- safe_r_metadata(safe_unserialize(self$extension_metadata()))\n     },\n     ExtensionEquals = function(other) {\n       inherits(other, \"VctrsExtensionType\") && identical(self$ptype(), other$ptype())"
            },
            {
                "sha": "ba73f0857881debb5f2c99c1e8ea66f7762ce1f4",
                "filename": "r/R/metadata.R",
                "status": "modified",
                "additions": 98,
                "deletions": 11,
                "changes": 109,
                "blob_url": "https://github.com/apache/arrow/blob/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b/r%2FR%2Fmetadata.R",
                "raw_url": "https://github.com/apache/arrow/raw/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b/r%2FR%2Fmetadata.R",
                "contents_url": "https://api.github.com/repos/apache/arrow/contents/r%2FR%2Fmetadata.R?ref=801de2fbcf5bcbce0c019ed4b35ff3fc863b141b",
                "patch": "@@ -30,7 +30,7 @@\n     }\n   }\n \n-  out <- serialize(x, NULL, ascii = TRUE)\n+  out <- serialize(safe_r_metadata(x, on_save = TRUE), NULL, ascii = TRUE)\n \n   # if the metadata is over 100 kB, compress\n   if (option_compress_metadata() && object.size(out) > 100000) {\n@@ -44,23 +44,110 @@\n }\n \n .deserialize_arrow_r_metadata <- function(x) {\n-  tryCatch(\n-    expr = {\n-      out <- unserialize(charToRaw(x))\n-\n-      # if this is still raw, try decompressing\n-      if (is.raw(out)) {\n-        out <- unserialize(memDecompress(out, type = \"gzip\"))\n-      }\n-      out\n-    },\n+  tryCatch(unserialize_r_metadata(x),\n     error = function(e) {\n+      if (getOption(\"arrow.debug\", FALSE)) {\n+        print(conditionMessage(e))\n+      }\n       warning(\"Invalid metadata$r\", call. = FALSE)\n       NULL\n     }\n   )\n }\n \n+unserialize_r_metadata <- function(x) {\n+  # Check that this is ASCII serialized data (as in, what we wrote)\n+  if (!identical(substr(unclass(x), 1, 1), \"A\")) {\n+    stop(\"Invalid serialized data\")\n+  }\n+  out <- safe_unserialize(charToRaw(x))\n+  # If it's still raw, decompress and unserialize again\n+  if (is.raw(out)) {\n+    decompressed <- memDecompress(out, type = \"gzip\")\n+    if (!identical(rawToChar(decompressed[1]), \"A\")) {\n+      stop(\"Invalid serialized compressed data\")\n+    }\n+    out <- safe_unserialize(decompressed)\n+  }\n+  if (!is.list(out)) {\n+    stop(\"Invalid serialized data: must be a list\")\n+  }\n+  safe_r_metadata(out)\n+}\n+\n+safe_unserialize <- function(x) {\n+  # By capturing the data in a list, we can inspect it for promises without\n+  # triggering their evaluation.\n+  out <- list(unserialize(x))\n+  if (typeof(out[[1]]) == \"promise\") {\n+    stop(\"Serialized data contains a promise object\")\n+  }\n+  out[[1]]\n+}\n+\n+safe_r_metadata <- function(metadata, on_save = FALSE) {\n+  # This function recurses through the metadata list and checks that all\n+  # elements are of types that are allowed in R metadata.\n+  # If it finds an element that is not allowed, it removes it.\n+  #\n+  # This function is used both when saving and loading metadata.\n+  # @param on_save: If TRUE, the function will not warn if it removes elements:\n+  # we're just cleaning up the metadata for saving. If FALSE, it means we're\n+  # loading the metadata, and we'll warn if we find invalid elements.\n+  #\n+  # When loading metadata, you can optionally keep the invalid elements by\n+  # setting `options(arrow.unsafe_metadata = TRUE)`. It will still check\n+  # for invalid elements and warn if any are found, though.\n+\n+  # This variable will be used to store the types of elements that were removed,\n+  # if any, so we can give an informative warning if needed.\n+  types_removed <- c()\n+\n+  # Internal function that we'll recursively apply,\n+  # and mutate the `types_removed` variable outside of it.\n+  check_r_metadata_types_recursive <- function(x) {\n+    allowed_types <- c(\"character\", \"double\", \"integer\", \"logical\", \"complex\", \"list\", \"NULL\")\n+    if (is.list(x)) {\n+      types <- map_chr(x, typeof)\n+      x[types == \"list\"] <- map(x[types == \"list\"], check_r_metadata_types_recursive)\n+      ok <- types %in% allowed_types\n+      if (!all(ok)) {\n+        # Record the invalid types, then remove the offending elements\n+        types_removed <<- c(types_removed, setdiff(types, allowed_types))\n+        x <- x[ok]\n+      }\n+    }\n+    x\n+  }\n+  new <- check_r_metadata_types_recursive(metadata)\n+\n+  # On save: don't warn, just save the filtered metadata\n+  if (on_save) {\n+    return(new)\n+  }\n+  # On load: warn if any elements were removed\n+  if (length(types_removed)) {\n+    types_msg <- paste(\"Type:\", oxford_paste(unique(types_removed)))\n+    if (getOption(\"arrow.unsafe_metadata\", FALSE)) {\n+      # We've opted-in to unsafe metadata, so warn but return the original metadata\n+      rlang::warn(\n+        \"R metadata may have unsafe or invalid elements\",\n+        body = c(\"i\" = types_msg)\n+      )\n+      new <- metadata\n+    } else {\n+      rlang::warn(\n+        \"Potentially unsafe or invalid elements have been discarded from R metadata.\",\n+        body = c(\n+          \"i\" = types_msg,\n+          \">\" = \"If you trust the source, you can set `options(arrow.unsafe_metadata = TRUE)` to preserve them.\"\n+        )\n+      )\n+    }\n+  }\n+  new\n+}\n+\n #' @importFrom rlang trace_back\n apply_arrow_r_metadata <- function(x, r_metadata) {\n   if (is.null(r_metadata)) {"
            },
            {
                "sha": "175e7ef3b6b73caa6854e317a6b445cd84fa90d0",
                "filename": "r/tests/testthat/test-metadata.R",
                "status": "modified",
                "additions": 69,
                "deletions": 0,
                "changes": 69,
                "blob_url": "https://github.com/apache/arrow/blob/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b/r%2Ftests%2Ftestthat%2Ftest-metadata.R",
                "raw_url": "https://github.com/apache/arrow/raw/801de2fbcf5bcbce0c019ed4b35ff3fc863b141b/r%2Ftests%2Ftestthat%2Ftest-metadata.R",
                "contents_url": "https://api.github.com/repos/apache/arrow/contents/r%2Ftests%2Ftestthat%2Ftest-metadata.R?ref=801de2fbcf5bcbce0c019ed4b35ff3fc863b141b",
                "patch": "@@ -107,6 +107,73 @@ test_that(\"Garbage R metadata doesn't break things\", {\n     \"Invalid metadata$r\",\n     fixed = TRUE\n   )\n+\n+  bad <- new.env(parent = emptyenv())\n+  makeActiveBinding(\"columns\", function() stop(\"This should not run\"), bad)\n+  tab$metadata <- list(r = rawToChar(serialize(bad, NULL, ascii = TRUE)))\n+  expect_warning(\n+    as.data.frame(tab),\n+    \"Invalid metadata$r\",\n+    fixed = TRUE\n+  )\n+\n+  # https://hiddenlayer.com/research/r-bitrary-code-execution/\n+  tab$metadata <- list(r = \"A\n+3\n+262913\n+197888\n+5\n+UTF-8\n+5\n+252\n+6\n+1\n+262153\n+7\n+message\n+2\n+16\n+1\n+262153\n+32\n+arbitrary\\040code\\040was\\040just\\040executed\n+254\n+\")\n+  expect_message(\n+    expect_warning(\n+      as.data.frame(tab),\n+      \"Invalid metadata$r\",\n+      fixed = TRUE\n+    ),\n+    NA\n+  )\n+})\n+\n+test_that(\"Complex or unsafe attributes are pruned from R metadata, if they exist\", {\n+  tab <- Table$create(example_data[1:6])\n+  bad <- new.env()\n+  makeActiveBinding(\"class\", function() stop(\"This should not run\"), bad)\n+  tab$metadata <- list(r = rawToChar(serialize(list(attributes = bad), NULL, ascii = TRUE)))\n+  expect_warning(\n+    as.data.frame(tab),\n+    \"Potentially unsafe or invalid elements have been discarded from R metadata.\n+i Type: \\\"environment\\\"\n+> If you trust the source, you can set `options(arrow.unsafe_metadata = TRUE)` to preserve them.\",\n+    fixed = TRUE\n+  )\n+  # You can set an option to allow them through.\n+  # It still warns, just differently, and it doesn't prune the attributes\n+  withr::local_options(list(\"arrow.unsafe_metadata\" = TRUE))\n+  expect_warning(\n+    expect_warning(\n+      as.data.frame(tab),\n+      \"R metadata may have unsafe or invalid elements\n+i Type: \\\"environment\\\"\"\n+    ),\n+    # This particular example ultimately fails because it's not a list\n+    \"Invalid metadata$r\",\n+    fixed = TRUE\n+  )\n })\n \n test_that(\"Metadata serialization compression\", {\n@@ -254,6 +321,8 @@ test_that(\"Row-level metadata (does not) roundtrip in datasets\", {\n   skip_if_not_available(\"dataset\")\n   skip_if_not_available(\"parquet\")\n \n+  library(dplyr, warn.conflicts = FALSE)\n+\n   df <- tibble::tibble(\n     metadata = list(\n       structure(1, my_value_as_attr = 1),"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Spencer14420/SPEmailHandler-PHP/commits/6f00dd0d44ff27889aed2980a5ba06e60d83549d",
        "url": "https://api.github.com/repos/Spencer14420/SPEmailHandler-PHP/commits/6f00dd0d44ff27889aed2980a5ba06e60d83549d",
        "html_url": "https://github.com/Spencer14420/SPEmailHandler-PHP/commit/6f00dd0d44ff27889aed2980a5ba06e60d83549d",
        "message": "Do not include any user input in confirmation emails (#12)",
        "files": [
            {
                "sha": "09892bb3d0b3c9d06a64e8e600acd7f1fbfc1e76",
                "filename": "src/EmailHandler.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Spencer14420/SPEmailHandler-PHP/blob/6f00dd0d44ff27889aed2980a5ba06e60d83549d/src%2FEmailHandler.php",
                "raw_url": "https://github.com/Spencer14420/SPEmailHandler-PHP/raw/6f00dd0d44ff27889aed2980a5ba06e60d83549d/src%2FEmailHandler.php",
                "contents_url": "https://api.github.com/repos/Spencer14420/SPEmailHandler-PHP/contents/src%2FEmailHandler.php?ref=6f00dd0d44ff27889aed2980a5ba06e60d83549d",
                "patch": "@@ -158,7 +158,7 @@ public function handleRequest(): void\n             $this->fromEmail,\n             $email,\n             \"Your message to $this->siteName has been received\",\n-            \"Dear $name ($email),\\n\\nYour message (shown below) has been received. We will get back to you as soon as possible.\\n\\nSincerely,\\n$this->siteName\\n\\nPlease note: This message was sent to the email address provided in our contact form. If you did not enter your email, please disregard this message.\\n\\nYour message:\\n$message\",\n+            \"Your message has been received. We will get back to you as soon as possible.\\n\\nSincerely,\\n$this->siteName\\n\\nPlease note: This message was sent to the email address provided in our contact form. If you did not enter your email, please disregard this message.\",\n             $this->replyToEmail\n         );\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/autolab/Autolab/commits/fe44b53815d37c63e751032205b692ccd5737620",
        "url": "https://api.github.com/repos/autolab/Autolab/commits/fe44b53815d37c63e751032205b692ccd5737620",
        "html_url": "https://github.com/autolab/Autolab/commit/fe44b53815d37c63e751032205b692ccd5737620",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "45367d90166abb9b8d4a429a9c92b08617399541",
                "filename": "Gemfile",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/autolab/Autolab/blob/fe44b53815d37c63e751032205b692ccd5737620/Gemfile",
                "raw_url": "https://github.com/autolab/Autolab/raw/fe44b53815d37c63e751032205b692ccd5737620/Gemfile",
                "contents_url": "https://api.github.com/repos/autolab/Autolab/contents/Gemfile?ref=fe44b53815d37c63e751032205b692ccd5737620",
                "patch": "@@ -177,3 +177,6 @@ gem 'uri', '0.10.3'\n \n # To generate slugged urls\n gem 'friendly_id', '~> 5.5.0'\n+\n+# to sanitize CSV files\n+gem 'csv-safe'\n\\ No newline at end of file"
            },
            {
                "sha": "57eb6cdf56108615ee9fd7a3f51bbac8ff974bc9",
                "filename": "Gemfile.lock",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/autolab/Autolab/blob/fe44b53815d37c63e751032205b692ccd5737620/Gemfile.lock",
                "raw_url": "https://github.com/autolab/Autolab/raw/fe44b53815d37c63e751032205b692ccd5737620/Gemfile.lock",
                "contents_url": "https://api.github.com/repos/autolab/Autolab/contents/Gemfile.lock?ref=fe44b53815d37c63e751032205b692ccd5737620",
                "patch": "@@ -115,6 +115,9 @@ GEM\n     crack (0.4.5)\n       rexml\n     crass (1.0.6)\n+    csv (3.3.0)\n+    csv-safe (3.3.1)\n+      csv (~> 3.0)\n     daemons (1.4.1)\n     database_cleaner (2.0.2)\n       database_cleaner-active_record (>= 2, < 3)\n@@ -482,6 +485,7 @@ DEPENDENCIES\n   capybara\n   codeclimate-test-reporter\n   coffee-rails (>= 4.0.0)\n+  csv-safe\n   database_cleaner\n   devise (>= 4.5.0)\n   diffy"
            },
            {
                "sha": "2b4473397fd00465c210ec18d7b5f43e019537b2",
                "filename": "app/controllers/courses_controller.rb",
                "status": "modified",
                "additions": 9,
                "deletions": 8,
                "changes": 17,
                "blob_url": "https://github.com/autolab/Autolab/blob/fe44b53815d37c63e751032205b692ccd5737620/app%2Fcontrollers%2Fcourses_controller.rb",
                "raw_url": "https://github.com/autolab/Autolab/raw/fe44b53815d37c63e751032205b692ccd5737620/app%2Fcontrollers%2Fcourses_controller.rb",
                "contents_url": "https://api.github.com/repos/autolab/Autolab/contents/app%2Fcontrollers%2Fcourses_controller.rb?ref=fe44b53815d37c63e751032205b692ccd5737620",
                "patch": "@@ -570,15 +570,16 @@ def download_roster\n     @cuds = @course.course_user_data.where(instructor: false,\n                                            course_assistant: false,\n                                            dropped: false)\n-    output = \"\"\n-    @cuds.each do |cud|\n-      user = cud.user\n-      # to_csv avoids issues with commas\n-      output += [@course.semester, cud.user.email, user.last_name, user.first_name,\n-                 cud.school, cud.major, cud.year, cud.grade_policy,\n-                 cud.course_number, cud.lecture, cud.section].to_csv\n+    csv_content = CSVSafe.generate do |csv|\n+      @cuds.each do |cud|\n+        user = cud.user\n+        # to_csv avoids issues with commas\n+        csv << [@course.semester, cud.user.email, user.last_name, user.first_name,\n+                cud.school, cud.major, cud.year, cud.grade_policy,\n+                cud.course_number, cud.lecture, cud.section]\n+      end\n     end\n-    send_data output, filename: \"roster.csv\", type: \"text/csv\", disposition: \"inline\"\n+    send_data csv_content, filename: \"roster.csv\", type: \"text/csv\", disposition: \"inline\"\n   end\n \n   # email - The email action allows instructors to email the entire course, or"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Devolutions/XTS.NET/commits/fb349d5bfb587218e8603b38ea37f03f036b57fd",
        "url": "https://api.github.com/repos/Devolutions/XTS.NET/commits/fb349d5bfb587218e8603b38ea37f03f036b57fd",
        "html_url": "https://github.com/Devolutions/XTS.NET/commit/fb349d5bfb587218e8603b38ea37f03f036b57fd",
        "message": "Make GF operations constant-time (#2)",
        "files": [
            {
                "sha": "3daeec330130b0b0fdd0f80ada602f3e265111fb",
                "filename": "XTS.NET.Benchmarks/XTS.NET.Benchmark.cs",
                "status": "modified",
                "additions": 1063,
                "deletions": 139,
                "changes": 1202,
                "blob_url": "https://github.com/Devolutions/XTS.NET/blob/fb349d5bfb587218e8603b38ea37f03f036b57fd/XTS.NET.Benchmarks%2FXTS.NET.Benchmark.cs",
                "raw_url": "https://github.com/Devolutions/XTS.NET/raw/fb349d5bfb587218e8603b38ea37f03f036b57fd/XTS.NET.Benchmarks%2FXTS.NET.Benchmark.cs",
                "contents_url": "https://api.github.com/repos/Devolutions/XTS.NET/contents/XTS.NET.Benchmarks%2FXTS.NET.Benchmark.cs?ref=fb349d5bfb587218e8603b38ea37f03f036b57fd",
                "patch": "@@ -5,149 +5,1073 @@ namespace XTS.NET.Benchmark;\n \n public class XtsNetBenchmark\n {\n-        byte[] key = [\n-            0xe0, 0xe1, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7,\n-            0xe8, 0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef,\n-            0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7,\n-            0xc8, 0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf\n-        ];\n-\n-        ulong sector = 0xa987654321;\n+    byte[] key = [\n+        0xe0,\n+        0xe1,\n+        0xe2,\n+        0xe3,\n+        0xe4,\n+        0xe5,\n+        0xe6,\n+        0xe7,\n+        0xe8,\n+        0xe9,\n+        0xea,\n+        0xeb,\n+        0xec,\n+        0xed,\n+        0xee,\n+        0xef,\n+        0xc0,\n+        0xc1,\n+        0xc2,\n+        0xc3,\n+        0xc4,\n+        0xc5,\n+        0xc6,\n+        0xc7,\n+        0xc8,\n+        0xc9,\n+        0xca,\n+        0xcb,\n+        0xcc,\n+        0xcd,\n+        0xce,\n+        0xcf\n+    ];\n \n-        byte[] expectedPlaintext = [\n-            0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,\n-            0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,\n-            0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,\n-            0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f,\n-            0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27,\n-            0x28, 0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x2e, 0x2f,\n-            0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37,\n-            0x38, 0x39, 0x3a, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f,\n-            0x40, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47,\n-            0x48, 0x49, 0x4a, 0x4b, 0x4c, 0x4d, 0x4e, 0x4f,\n-            0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57,\n-            0x58, 0x59, 0x5a, 0x5b, 0x5c, 0x5d, 0x5e, 0x5f,\n-            0x60, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67,\n-            0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e, 0x6f,\n-            0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77,\n-            0x78, 0x79, 0x7a, 0x7b, 0x7c, 0x7d, 0x7e, 0x7f,\n-            0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87,\n-            0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e, 0x8f,\n-            0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97,\n-            0x98, 0x99, 0x9a, 0x9b, 0x9c, 0x9d, 0x9e, 0x9f,\n-            0xa0, 0xa1, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7,\n-            0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae, 0xaf,\n-            0xb0, 0xb1, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7,\n-            0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe, 0xbf,\n-            0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7,\n-            0xc8, 0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf,\n-            0xd0, 0xd1, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7,\n-            0xd8, 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xde, 0xdf,\n-            0xe0, 0xe1, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7,\n-            0xe8, 0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef,\n-            0xf0, 0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7,\n-            0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xff,\n-            0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,\n-            0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,\n-            0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,\n-            0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f,\n-            0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27,\n-            0x28, 0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x2e, 0x2f,\n-            0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37,\n-            0x38, 0x39, 0x3a, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f,\n-            0x40, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47,\n-            0x48, 0x49, 0x4a, 0x4b, 0x4c, 0x4d, 0x4e, 0x4f,\n-            0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57,\n-            0x58, 0x59, 0x5a, 0x5b, 0x5c, 0x5d, 0x5e, 0x5f,\n-            0x60, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67,\n-            0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e, 0x6f,\n-            0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77,\n-            0x78, 0x79, 0x7a, 0x7b, 0x7c, 0x7d, 0x7e, 0x7f,\n-            0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87,\n-            0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e, 0x8f,\n-            0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97,\n-            0x98, 0x99, 0x9a, 0x9b, 0x9c, 0x9d, 0x9e, 0x9f,\n-            0xa0, 0xa1, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7,\n-            0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae, 0xaf,\n-            0xb0, 0xb1, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7,\n-            0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe, 0xbf,\n-            0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7,\n-            0xc8, 0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf,\n-            0xd0, 0xd1, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7,\n-            0xd8, 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xde, 0xdf,\n-            0xe0, 0xe1, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7,\n-            0xe8, 0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef,\n-            0xf0, 0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7,\n-            0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xff\n-        ];\n+    ulong sector = 0xa987654321;\n \n-        byte[] expectedCiphertext = [\n-            0x38, 0xb4, 0x58, 0x12, 0xef, 0x43, 0xa0, 0x5b,\n-            0xd9, 0x57, 0xe5, 0x45, 0x90, 0x7e, 0x22, 0x3b,\n-            0x95, 0x4a, 0xb4, 0xaa, 0xf0, 0x88, 0x30, 0x3a,\n-            0xd9, 0x10, 0xea, 0xdf, 0x14, 0xb4, 0x2b, 0xe6,\n-            0x8b, 0x24, 0x61, 0x14, 0x9d, 0x8c, 0x8b, 0xa8,\n-            0x5f, 0x99, 0x2b, 0xe9, 0x70, 0xbc, 0x62, 0x1f,\n-            0x1b, 0x06, 0x57, 0x3f, 0x63, 0xe8, 0x67, 0xbf,\n-            0x58, 0x75, 0xac, 0xaf, 0xa0, 0x4e, 0x42, 0xcc,\n-            0xbd, 0x7b, 0xd3, 0xc2, 0xa0, 0xfb, 0x1f, 0xff,\n-            0x79, 0x1e, 0xc5, 0xec, 0x36, 0xc6, 0x6a, 0xe4,\n-            0xac, 0x1e, 0x80, 0x6d, 0x81, 0xfb, 0xf7, 0x09,\n-            0xdb, 0xe2, 0x9e, 0x47, 0x1f, 0xad, 0x38, 0x54,\n-            0x9c, 0x8e, 0x66, 0xf5, 0x34, 0x5d, 0x7c, 0x1e,\n-            0xb9, 0x4f, 0x40, 0x5d, 0x1e, 0xc7, 0x85, 0xcc,\n-            0x6f, 0x6a, 0x68, 0xf6, 0x25, 0x4d, 0xd8, 0x33,\n-            0x9f, 0x9d, 0x84, 0x05, 0x7e, 0x01, 0xa1, 0x77,\n-            0x41, 0x99, 0x04, 0x82, 0x99, 0x95, 0x16, 0xb5,\n-            0x61, 0x1a, 0x38, 0xf4, 0x1b, 0xb6, 0x47, 0x8e,\n-            0x6f, 0x17, 0x3f, 0x32, 0x08, 0x05, 0xdd, 0x71,\n-            0xb1, 0x93, 0x2f, 0xc3, 0x33, 0xcb, 0x9e, 0xe3,\n-            0x99, 0x36, 0xbe, 0xea, 0x9a, 0xd9, 0x6f, 0xa1,\n-            0x0f, 0xb4, 0x11, 0x2b, 0x90, 0x17, 0x34, 0xdd,\n-            0xad, 0x40, 0xbc, 0x18, 0x78, 0x99, 0x5f, 0x8e,\n-            0x11, 0xae, 0xe7, 0xd1, 0x41, 0xa2, 0xf5, 0xd4,\n-            0x8b, 0x7a, 0x4e, 0x1e, 0x7f, 0x0b, 0x2c, 0x04,\n-            0x83, 0x0e, 0x69, 0xa4, 0xfd, 0x13, 0x78, 0x41,\n-            0x1c, 0x2f, 0x28, 0x7e, 0xdf, 0x48, 0xc6, 0xc4,\n-            0xe5, 0xc2, 0x47, 0xa1, 0x96, 0x80, 0xf7, 0xfe,\n-            0x41, 0xce, 0xfb, 0xd4, 0x9b, 0x58, 0x21, 0x06,\n-            0xe3, 0x61, 0x6c, 0xbb, 0xe4, 0xdf, 0xb2, 0x34,\n-            0x4b, 0x2a, 0xe9, 0x51, 0x93, 0x91, 0xf3, 0xe0,\n-            0xfb, 0x49, 0x22, 0x25, 0x4b, 0x1d, 0x6d, 0x2d,\n-            0x19, 0xc6, 0xd4, 0xd5, 0x37, 0xb3, 0xa2, 0x6f,\n-            0x3b, 0xcc, 0x51, 0x58, 0x8b, 0x32, 0xf3, 0xec,\n-            0xa0, 0x82, 0x9b, 0x6a, 0x5a, 0xc7, 0x25, 0x78,\n-            0xfb, 0x81, 0x4f, 0xb4, 0x3c, 0xf8, 0x0d, 0x64,\n-            0xa2, 0x33, 0xe3, 0xf9, 0x97, 0xa3, 0xf0, 0x26,\n-            0x83, 0x34, 0x2f, 0x2b, 0x33, 0xd2, 0x5b, 0x49,\n-            0x25, 0x36, 0xb9, 0x3b, 0xec, 0xb2, 0xf5, 0xe1,\n-            0xa8, 0xb8, 0x2f, 0x5b, 0x88, 0x33, 0x42, 0x72,\n-            0x9e, 0x8a, 0xe0, 0x9d, 0x16, 0x93, 0x88, 0x41,\n-            0xa2, 0x1a, 0x97, 0xfb, 0x54, 0x3e, 0xea, 0x3b,\n-            0xbf, 0xf5, 0x9f, 0x13, 0xc1, 0xa1, 0x84, 0x49,\n-            0xe3, 0x98, 0x70, 0x1c, 0x1a, 0xd5, 0x16, 0x48,\n-            0x34, 0x6c, 0xbc, 0x04, 0xc2, 0x7b, 0xb2, 0xda,\n-            0x3b, 0x93, 0xa1, 0x37, 0x2c, 0xca, 0xe5, 0x48,\n-            0xfb, 0x53, 0xbe, 0xe4, 0x76, 0xf9, 0xe9, 0xc9,\n-            0x17, 0x73, 0xb1, 0xbb, 0x19, 0x82, 0x83, 0x94,\n-            0xd5, 0x5d, 0x3e, 0x1a, 0x20, 0xed, 0x69, 0x11,\n-            0x3a, 0x86, 0x0b, 0x68, 0x29, 0xff, 0xa8, 0x47,\n-            0x22, 0x46, 0x04, 0x43, 0x50, 0x70, 0x22, 0x1b,\n-            0x25, 0x7e, 0x8d, 0xff, 0x78, 0x36, 0x15, 0xd2,\n-            0xca, 0xe4, 0x80, 0x3a, 0x93, 0xaa, 0x43, 0x34,\n-            0xab, 0x48, 0x2a, 0x0a, 0xfa, 0xc9, 0xc0, 0xae,\n-            0xda, 0x70, 0xb4, 0x5a, 0x48, 0x1d, 0xf5, 0xde,\n-            0xc5, 0xdf, 0x8c, 0xc0, 0xf4, 0x23, 0xc7, 0x7a,\n-            0x5f, 0xd4, 0x6c, 0xd3, 0x12, 0x02, 0x1d, 0x4b,\n-            0x43, 0x88, 0x62, 0x41, 0x9a, 0x79, 0x1b, 0xe0,\n-            0x3b, 0xb4, 0xd9, 0x7c, 0x0e, 0x59, 0x57, 0x85,\n-            0x42, 0x53, 0x1b, 0xa4, 0x66, 0xa8, 0x3b, 0xaf,\n-            0x92, 0xce, 0xfc, 0x15, 0x1b, 0x5c, 0xc1, 0x61,\n-            0x1a, 0x16, 0x78, 0x93, 0x81, 0x9b, 0x63, 0xfb,\n-            0x8a, 0x6b, 0x18, 0xe8, 0x6d, 0xe6, 0x02, 0x90,\n-            0xfa, 0x72, 0xb7, 0x97, 0xb0, 0xce, 0x59, 0xf3\n+    byte[] expectedPlaintext = [\n+        0x00,\n+        0x01,\n+        0x02,\n+        0x03,\n+        0x04,\n+        0x05,\n+        0x06,\n+        0x07,\n+        0x08,\n+        0x09,\n+        0x0a,\n+        0x0b,\n+        0x0c,\n+        0x0d,\n+        0x0e,\n+        0x0f,\n+        0x10,\n+        0x11,\n+        0x12,\n+        0x13,\n+        0x14,\n+        0x15,\n+        0x16,\n+        0x17,\n+        0x18,\n+        0x19,\n+        0x1a,\n+        0x1b,\n+        0x1c,\n+        0x1d,\n+        0x1e,\n+        0x1f,\n+        0x20,\n+        0x21,\n+        0x22,\n+        0x23,\n+        0x24,\n+        0x25,\n+        0x26,\n+        0x27,\n+        0x28,\n+        0x29,\n+        0x2a,\n+        0x2b,\n+        0x2c,\n+        0x2d,\n+        0x2e,\n+        0x2f,\n+        0x30,\n+        0x31,\n+        0x32,\n+        0x33,\n+        0x34,\n+        0x35,\n+        0x36,\n+        0x37,\n+        0x38,\n+        0x39,\n+        0x3a,\n+        0x3b,\n+        0x3c,\n+        0x3d,\n+        0x3e,\n+        0x3f,\n+        0x40,\n+        0x41,\n+        0x42,\n+        0x43,\n+        0x44,\n+        0x45,\n+        0x46,\n+        0x47,\n+        0x48,\n+        0x49,\n+        0x4a,\n+        0x4b,\n+        0x4c,\n+        0x4d,\n+        0x4e,\n+        0x4f,\n+        0x50,\n+        0x51,\n+        0x52,\n+        0x53,\n+        0x54,\n+        0x55,\n+        0x56,\n+        0x57,\n+        0x58,\n+        0x59,\n+        0x5a,\n+        0x5b,\n+        0x5c,\n+        0x5d,\n+        0x5e,\n+        0x5f,\n+        0x60,\n+        0x61,\n+        0x62,\n+        0x63,\n+        0x64,\n+        0x65,\n+        0x66,\n+        0x67,\n+        0x68,\n+        0x69,\n+        0x6a,\n+        0x6b,\n+        0x6c,\n+        0x6d,\n+        0x6e,\n+        0x6f,\n+        0x70,\n+        0x71,\n+        0x72,\n+        0x73,\n+        0x74,\n+        0x75,\n+        0x76,\n+        0x77,\n+        0x78,\n+        0x79,\n+        0x7a,\n+        0x7b,\n+        0x7c,\n+        0x7d,\n+        0x7e,\n+        0x7f,\n+        0x80,\n+        0x81,\n+        0x82,\n+        0x83,\n+        0x84,\n+        0x85,\n+        0x86,\n+        0x87,\n+        0x88,\n+        0x89,\n+        0x8a,\n+        0x8b,\n+        0x8c,\n+        0x8d,\n+        0x8e,\n+        0x8f,\n+        0x90,\n+        0x91,\n+        0x92,\n+        0x93,\n+        0x94,\n+        0x95,\n+        0x96,\n+        0x97,\n+        0x98,\n+        0x99,\n+        0x9a,\n+        0x9b,\n+        0x9c,\n+        0x9d,\n+        0x9e,\n+        0x9f,\n+        0xa0,\n+        0xa1,\n+        0xa2,\n+        0xa3,\n+        0xa4,\n+        0xa5,\n+        0xa6,\n+        0xa7,\n+        0xa8,\n+        0xa9,\n+        0xaa,\n+        0xab,\n+        0xac,\n+        0xad,\n+        0xae,\n+        0xaf,\n+        0xb0,\n+        0xb1,\n+        0xb2,\n+        0xb3,\n+        0xb4,\n+        0xb5,\n+        0xb6,\n+        0xb7,\n+        0xb8,\n+        0xb9,\n+        0xba,\n+        0xbb,\n+        0xbc,\n+        0xbd,\n+        0xbe,\n+        0xbf,\n+        0xc0,\n+        0xc1,\n+        0xc2,\n+        0xc3,\n+        0xc4,\n+        0xc5,\n+        0xc6,\n+        0xc7,\n+        0xc8,\n+        0xc9,\n+        0xca,\n+        0xcb,\n+        0xcc,\n+        0xcd,\n+        0xce,\n+        0xcf,\n+        0xd0,\n+        0xd1,\n+        0xd2,\n+        0xd3,\n+        0xd4,\n+        0xd5,\n+        0xd6,\n+        0xd7,\n+        0xd8,\n+        0xd9,\n+        0xda,\n+        0xdb,\n+        0xdc,\n+        0xdd,\n+        0xde,\n+        0xdf,\n+        0xe0,\n+        0xe1,\n+        0xe2,\n+        0xe3,\n+        0xe4,\n+        0xe5,\n+        0xe6,\n+        0xe7,\n+        0xe8,\n+        0xe9,\n+        0xea,\n+        0xeb,\n+        0xec,\n+        0xed,\n+        0xee,\n+        0xef,\n+        0xf0,\n+        0xf1,\n+        0xf2,\n+        0xf3,\n+        0xf4,\n+        0xf5,\n+        0xf6,\n+        0xf7,\n+        0xf8,\n+        0xf9,\n+        0xfa,\n+        0xfb,\n+        0xfc,\n+        0xfd,\n+        0xfe,\n+        0xff,\n+        0x00,\n+        0x01,\n+        0x02,\n+        0x03,\n+        0x04,\n+        0x05,\n+        0x06,\n+        0x07,\n+        0x08,\n+        0x09,\n+        0x0a,\n+        0x0b,\n+        0x0c,\n+        0x0d,\n+        0x0e,\n+        0x0f,\n+        0x10,\n+        0x11,\n+        0x12,\n+        0x13,\n+        0x14,\n+        0x15,\n+        0x16,\n+        0x17,\n+        0x18,\n+        0x19,\n+        0x1a,\n+        0x1b,\n+        0x1c,\n+        0x1d,\n+        0x1e,\n+        0x1f,\n+        0x20,\n+        0x21,\n+        0x22,\n+        0x23,\n+        0x24,\n+        0x25,\n+        0x26,\n+        0x27,\n+        0x28,\n+        0x29,\n+        0x2a,\n+        0x2b,\n+        0x2c,\n+        0x2d,\n+        0x2e,\n+        0x2f,\n+        0x30,\n+        0x31,\n+        0x32,\n+        0x33,\n+        0x34,\n+        0x35,\n+        0x36,\n+        0x37,\n+        0x38,\n+        0x39,\n+        0x3a,\n+        0x3b,\n+        0x3c,\n+        0x3d,\n+        0x3e,\n+        0x3f,\n+        0x40,\n+        0x41,\n+        0x42,\n+        0x43,\n+        0x44,\n+        0x45,\n+        0x46,\n+        0x47,\n+        0x48,\n+        0x49,\n+        0x4a,\n+        0x4b,\n+        0x4c,\n+        0x4d,\n+        0x4e,\n+        0x4f,\n+        0x50,\n+        0x51,\n+        0x52,\n+        0x53,\n+        0x54,\n+        0x55,\n+        0x56,\n+        0x57,\n+        0x58,\n+        0x59,\n+        0x5a,\n+        0x5b,\n+        0x5c,\n+        0x5d,\n+        0x5e,\n+        0x5f,\n+        0x60,\n+        0x61,\n+        0x62,\n+        0x63,\n+        0x64,\n+        0x65,\n+        0x66,\n+        0x67,\n+        0x68,\n+        0x69,\n+        0x6a,\n+        0x6b,\n+        0x6c,\n+        0x6d,\n+        0x6e,\n+        0x6f,\n+        0x70,\n+        0x71,\n+        0x72,\n+        0x73,\n+        0x74,\n+        0x75,\n+        0x76,\n+        0x77,\n+        0x78,\n+        0x79,\n+        0x7a,\n+        0x7b,\n+        0x7c,\n+        0x7d,\n+        0x7e,\n+        0x7f,\n+        0x80,\n+        0x81,\n+        0x82,\n+        0x83,\n+        0x84,\n+        0x85,\n+        0x86,\n+        0x87,\n+        0x88,\n+        0x89,\n+        0x8a,\n+        0x8b,\n+        0x8c,\n+        0x8d,\n+        0x8e,\n+        0x8f,\n+        0x90,\n+        0x91,\n+        0x92,\n+        0x93,\n+        0x94,\n+        0x95,\n+        0x96,\n+        0x97,\n+        0x98,\n+        0x99,\n+        0x9a,\n+        0x9b,\n+        0x9c,\n+        0x9d,\n+        0x9e,\n+        0x9f,\n+        0xa0,\n+        0xa1,\n+        0xa2,\n+        0xa3,\n+        0xa4,\n+        0xa5,\n+        0xa6,\n+        0xa7,\n+        0xa8,\n+        0xa9,\n+        0xaa,\n+        0xab,\n+        0xac,\n+        0xad,\n+        0xae,\n+        0xaf,\n+        0xb0,\n+        0xb1,\n+        0xb2,\n+        0xb3,\n+        0xb4,\n+        0xb5,\n+        0xb6,\n+        0xb7,\n+        0xb8,\n+        0xb9,\n+        0xba,\n+        0xbb,\n+        0xbc,\n+        0xbd,\n+        0xbe,\n+        0xbf,\n+        0xc0,\n+        0xc1,\n+        0xc2,\n+        0xc3,\n+        0xc4,\n+        0xc5,\n+        0xc6,\n+        0xc7,\n+        0xc8,\n+        0xc9,\n+        0xca,\n+        0xcb,\n+        0xcc,\n+        0xcd,\n+        0xce,\n+        0xcf,\n+        0xd0,\n+        0xd1,\n+        0xd2,\n+        0xd3,\n+        0xd4,\n+        0xd5,\n+        0xd6,\n+        0xd7,\n+        0xd8,\n+        0xd9,\n+        0xda,\n+        0xdb,\n+        0xdc,\n+        0xdd,\n+        0xde,\n+        0xdf,\n+        0xe0,\n+        0xe1,\n+        0xe2,\n+        0xe3,\n+        0xe4,\n+        0xe5,\n+        0xe6,\n+        0xe7,\n+        0xe8,\n+        0xe9,\n+        0xea,\n+        0xeb,\n+        0xec,\n+        0xed,\n+        0xee,\n+        0xef,\n+        0xf0,\n+        0xf1,\n+        0xf2,\n+        0xf3,\n+        0xf4,\n+        0xf5,\n+        0xf6,\n+        0xf7,\n+        0xf8,\n+        0xf9,\n+        0xfa,\n+        0xfb,\n+        0xfc,\n+        0xfd,\n+        0xfe,\n+        0xff\n     ];\n \n+    byte[] expectedCiphertext = [\n+        0x38,\n+        0xb4,\n+        0x58,\n+        0x12,\n+        0xef,\n+        0x43,\n+        0xa0,\n+        0x5b,\n+        0xd9,\n+        0x57,\n+        0xe5,\n+        0x45,\n+        0x90,\n+        0x7e,\n+        0x22,\n+        0x3b,\n+        0x95,\n+        0x4a,\n+        0xb4,\n+        0xaa,\n+        0xf0,\n+        0x88,\n+        0x30,\n+        0x3a,\n+        0xd9,\n+        0x10,\n+        0xea,\n+        0xdf,\n+        0x14,\n+        0xb4,\n+        0x2b,\n+        0xe6,\n+        0x8b,\n+        0x24,\n+        0x61,\n+        0x14,\n+        0x9d,\n+        0x8c,\n+        0x8b,\n+        0xa8,\n+        0x5f,\n+        0x99,\n+        0x2b,\n+        0xe9,\n+        0x70,\n+        0xbc,\n+        0x62,\n+        0x1f,\n+        0x1b,\n+        0x06,\n+        0x57,\n+        0x3f,\n+        0x63,\n+        0xe8,\n+        0x67,\n+        0xbf,\n+        0x58,\n+        0x75,\n+        0xac,\n+        0xaf,\n+        0xa0,\n+        0x4e,\n+        0x42,\n+        0xcc,\n+        0xbd,\n+        0x7b,\n+        0xd3,\n+        0xc2,\n+        0xa0,\n+        0xfb,\n+        0x1f,\n+        0xff,\n+        0x79,\n+        0x1e,\n+        0xc5,\n+        0xec,\n+        0x36,\n+        0xc6,\n+        0x6a,\n+        0xe4,\n+        0xac,\n+        0x1e,\n+        0x80,\n+        0x6d,\n+        0x81,\n+        0xfb,\n+        0xf7,\n+        0x09,\n+        0xdb,\n+        0xe2,\n+        0x9e,\n+        0x47,\n+        0x1f,\n+        0xad,\n+        0x38,\n+        0x54,\n+        0x9c,\n+        0x8e,\n+        0x66,\n+        0xf5,\n+        0x34,\n+        0x5d,\n+        0x7c,\n+        0x1e,\n+        0xb9,\n+        0x4f,\n+        0x40,\n+        0x5d,\n+        0x1e,\n+        0xc7,\n+        0x85,\n+        0xcc,\n+        0x6f,\n+        0x6a,\n+        0x68,\n+        0xf6,\n+        0x25,\n+        0x4d,\n+        0xd8,\n+        0x33,\n+        0x9f,\n+        0x9d,\n+        0x84,\n+        0x05,\n+        0x7e,\n+        0x01,\n+        0xa1,\n+        0x77,\n+        0x41,\n+        0x99,\n+        0x04,\n+        0x82,\n+        0x99,\n+        0x95,\n+        0x16,\n+        0xb5,\n+        0x61,\n+        0x1a,\n+        0x38,\n+        0xf4,\n+        0x1b,\n+        0xb6,\n+        0x47,\n+        0x8e,\n+        0x6f,\n+        0x17,\n+        0x3f,\n+        0x32,\n+        0x08,\n+        0x05,\n+        0xdd,\n+        0x71,\n+        0xb1,\n+        0x93,\n+        0x2f,\n+        0xc3,\n+        0x33,\n+        0xcb,\n+        0x9e,\n+        0xe3,\n+        0x99,\n+        0x36,\n+        0xbe,\n+        0xea,\n+        0x9a,\n+        0xd9,\n+        0x6f,\n+        0xa1,\n+        0x0f,\n+        0xb4,\n+        0x11,\n+        0x2b,\n+        0x90,\n+        0x17,\n+        0x34,\n+        0xdd,\n+        0xad,\n+        0x40,\n+        0xbc,\n+        0x18,\n+        0x78,\n+        0x99,\n+        0x5f,\n+        0x8e,\n+        0x11,\n+        0xae,\n+        0xe7,\n+        0xd1,\n+        0x41,\n+        0xa2,\n+        0xf5,\n+        0xd4,\n+        0x8b,\n+        0x7a,\n+        0x4e,\n+        0x1e,\n+        0x7f,\n+        0x0b,\n+        0x2c,\n+        0x04,\n+        0x83,\n+        0x0e,\n+        0x69,\n+        0xa4,\n+        0xfd,\n+        0x13,\n+        0x78,\n+        0x41,\n+        0x1c,\n+        0x2f,\n+        0x28,\n+        0x7e,\n+        0xdf,\n+        0x48,\n+        0xc6,\n+        0xc4,\n+        0xe5,\n+        0xc2,\n+        0x47,\n+        0xa1,\n+        0x96,\n+        0x80,\n+        0xf7,\n+        0xfe,\n+        0x41,\n+        0xce,\n+        0xfb,\n+        0xd4,\n+        0x9b,\n+        0x58,\n+        0x21,\n+        0x06,\n+        0xe3,\n+        0x61,\n+        0x6c,\n+        0xbb,\n+        0xe4,\n+        0xdf,\n+        0xb2,\n+        0x34,\n+        0x4b,\n+        0x2a,\n+        0xe9,\n+        0x51,\n+        0x93,\n+        0x91,\n+        0xf3,\n+        0xe0,\n+        0xfb,\n+        0x49,\n+        0x22,\n+        0x25,\n+        0x4b,\n+        0x1d,\n+        0x6d,\n+        0x2d,\n+        0x19,\n+        0xc6,\n+        0xd4,\n+        0xd5,\n+        0x37,\n+        0xb3,\n+        0xa2,\n+        0x6f,\n+        0x3b,\n+        0xcc,\n+        0x51,\n+        0x58,\n+        0x8b,\n+        0x32,\n+        0xf3,\n+        0xec,\n+        0xa0,\n+        0x82,\n+        0x9b,\n+        0x6a,\n+        0x5a,\n+        0xc7,\n+        0x25,\n+        0x78,\n+        0xfb,\n+        0x81,\n+        0x4f,\n+        0xb4,\n+        0x3c,\n+        0xf8,\n+        0x0d,\n+        0x64,\n+        0xa2,\n+        0x33,\n+        0xe3,\n+        0xf9,\n+        0x97,\n+        0xa3,\n+        0xf0,\n+        0x26,\n+        0x83,\n+        0x34,\n+        0x2f,\n+        0x2b,\n+        0x33,\n+        0xd2,\n+        0x5b,\n+        0x49,\n+        0x25,\n+        0x36,\n+        0xb9,\n+        0x3b,\n+        0xec,\n+        0xb2,\n+        0xf5,\n+        0xe1,\n+        0xa8,\n+        0xb8,\n+        0x2f,\n+        0x5b,\n+        0x88,\n+        0x33,\n+        0x42,\n+        0x72,\n+        0x9e,\n+        0x8a,\n+        0xe0,\n+        0x9d,\n+        0x16,\n+        0x93,\n+        0x88,\n+        0x41,\n+        0xa2,\n+        0x1a,\n+        0x97,\n+        0xfb,\n+        0x54,\n+        0x3e,\n+        0xea,\n+        0x3b,\n+        0xbf,\n+        0xf5,\n+        0x9f,\n+        0x13,\n+        0xc1,\n+        0xa1,\n+        0x84,\n+        0x49,\n+        0xe3,\n+        0x98,\n+        0x70,\n+        0x1c,\n+        0x1a,\n+        0xd5,\n+        0x16,\n+        0x48,\n+        0x34,\n+        0x6c,\n+        0xbc,\n+        0x04,\n+        0xc2,\n+        0x7b,\n+        0xb2,\n+        0xda,\n+        0x3b,\n+        0x93,\n+        0xa1,\n+        0x37,\n+        0x2c,\n+        0xca,\n+        0xe5,\n+        0x48,\n+        0xfb,\n+        0x53,\n+        0xbe,\n+        0xe4,\n+        0x76,\n+        0xf9,\n+        0xe9,\n+        0xc9,\n+        0x17,\n+        0x73,\n+        0xb1,\n+        0xbb,\n+        0x19,\n+        0x82,\n+        0x83,\n+        0x94,\n+        0xd5,\n+        0x5d,\n+        0x3e,\n+        0x1a,\n+        0x20,\n+        0xed,\n+        0x69,\n+        0x11,\n+        0x3a,\n+        0x86,\n+        0x0b,\n+        0x68,\n+        0x29,\n+        0xff,\n+        0xa8,\n+        0x47,\n+        0x22,\n+        0x46,\n+        0x04,\n+        0x43,\n+        0x50,\n+        0x70,\n+        0x22,\n+        0x1b,\n+        0x25,\n+        0x7e,\n+        0x8d,\n+        0xff,\n+        0x78,\n+        0x36,\n+        0x15,\n+        0xd2,\n+        0xca,\n+        0xe4,\n+        0x80,\n+        0x3a,\n+        0x93,\n+        0xaa,\n+        0x43,\n+        0x34,\n+        0xab,\n+        0x48,\n+        0x2a,\n+        0x0a,\n+        0xfa,\n+        0xc9,\n+        0xc0,\n+        0xae,\n+        0xda,\n+        0x70,\n+        0xb4,\n+        0x5a,\n+        0x48,\n+        0x1d,\n+        0xf5,\n+        0xde,\n+        0xc5,\n+        0xdf,\n+        0x8c,\n+        0xc0,\n+        0xf4,\n+        0x23,\n+        0xc7,\n+        0x7a,\n+        0x5f,\n+        0xd4,\n+        0x6c,\n+        0xd3,\n+        0x12,\n+        0x02,\n+        0x1d,\n+        0x4b,\n+        0x43,\n+        0x88,\n+        0x62,\n+        0x41,\n+        0x9a,\n+        0x79,\n+        0x1b,\n+        0xe0,\n+        0x3b,\n+        0xb4,\n+        0xd9,\n+        0x7c,\n+        0x0e,\n+        0x59,\n+        0x57,\n+        0x85,\n+        0x42,\n+        0x53,\n+        0x1b,\n+        0xa4,\n+        0x66,\n+        0xa8,\n+        0x3b,\n+        0xaf,\n+        0x92,\n+        0xce,\n+        0xfc,\n+        0x15,\n+        0x1b,\n+        0x5c,\n+        0xc1,\n+        0x61,\n+        0x1a,\n+        0x16,\n+        0x78,\n+        0x93,\n+        0x81,\n+        0x9b,\n+        0x63,\n+        0xfb,\n+        0x8a,\n+        0x6b,\n+        0x18,\n+        0xe8,\n+        0x6d,\n+        0xe6,\n+        0x02,\n+        0x90,\n+        0xfa,\n+        0x72,\n+        0xb7,\n+        0x97,\n+        0xb0,\n+        0xce,\n+        0x59,\n+        0xf3\n+];\n+\n     [Benchmark]\n     public void Encrypt()\n     {"
            },
            {
                "sha": "45c9c5ddcebaa72af021b6876c936031b4c7727e",
                "filename": "src/XTS.cs",
                "status": "modified",
                "additions": 13,
                "deletions": 21,
                "changes": 34,
                "blob_url": "https://github.com/Devolutions/XTS.NET/blob/fb349d5bfb587218e8603b38ea37f03f036b57fd/src%2FXTS.cs",
                "raw_url": "https://github.com/Devolutions/XTS.NET/raw/fb349d5bfb587218e8603b38ea37f03f036b57fd/src%2FXTS.cs",
                "contents_url": "https://api.github.com/repos/Devolutions/XTS.NET/contents/src%2FXTS.cs?ref=fb349d5bfb587218e8603b38ea37f03f036b57fd",
                "patch": "@@ -229,7 +229,7 @@ private static void ProcessXtsSector(ICryptoTransform alg, byte[] buffer, int bu\n             if (decrypt && needsCiphertextStealing)\n             {\n                 // We fast forward the multiplication here\n-                bool carry = GaloisMultiplyByTwo(tweak);\n+                byte carry = GaloisMultiplyByTwo(tweak);\n \n                 int blockStart = bufferOffset + (nFullBlocks - 1) * blockSize;\n                 TransformBlock(alg, buffer, blockStart, tweak);\n@@ -346,9 +346,7 @@ private static void SwapSpan(Span<byte> x, Span<byte> y)\n         {\n             for (int i = 0; i < x.Length; i++)\n             {\n-                byte tmp = x[i];\n-                x[i] = y[i];\n-                y[i] = tmp;\n+                (x[i], y[i]) = (y[i], x[i]);\n             }\n         }\n \n@@ -357,16 +355,16 @@ private static void SwapSpan(Span<byte> x, Span<byte> y)\n         /// </summary>\n         /// <param name=\"tweak\"></param>\n         /// <returns></returns>\n-        private static bool GaloisMultiplyByTwo(Span<byte> tweak)\n+        private static byte GaloisMultiplyByTwo(Span<byte> tweak)\n         {\n-            bool carry = false;\n+            byte carry = 0;\n             for (int i = 0; i < tweak.Length; i++)\n             {\n                 // Save carry from previous byte\n-                byte oldCarry = (byte)(carry ? 1 : 0);\n+                byte oldCarry = carry;\n \n                 // Check if there is a carry for this shift\n-                carry = (tweak[i] & 0x80) > 0;\n+                carry = (byte)(tweak[i] >> 7);\n \n                 // Shift left\n                 tweak[i] <<= 1;\n@@ -375,10 +373,8 @@ private static bool GaloisMultiplyByTwo(Span<byte> tweak)\n                 tweak[i] |= oldCarry;\n             }\n \n-            if (carry)\n-            {\n-                tweak[0] ^= GF_MOD;\n-            }\n+            // Binary logic, equivalent to XORing by GF_MOD if there's a carry, but constant-time\n+            tweak[0] ^= (byte)((byte)-carry & GF_MOD);\n \n             return carry;\n         }\n@@ -389,12 +385,10 @@ private static bool GaloisMultiplyByTwo(Span<byte> tweak)\n         /// <param name=\"tweak\">The tweak to reverse</param>\n         /// <param name=\"carry\">The carry flag of the last multiplication</param>\n         /// <returns></returns>\n-        private static void GaloisUnmultiplyByTwo(Span<byte> tweak, bool carry)\n+        private static void GaloisUnmultiplyByTwo(Span<byte> tweak, byte carry)\n         {\n-            if (carry)\n-            {\n-                tweak[0] ^= GF_MOD;\n-            }\n+            // Binary logic, equivalent to XORing by GF_MOD if there's a carry, but constant-time\n+            tweak[0] ^= (byte)((byte)-carry & GF_MOD);\n \n             int newCarry = 0;\n             for (int i = tweak.Length - 1; i >= 0; i--)\n@@ -411,10 +405,8 @@ private static void GaloisUnmultiplyByTwo(Span<byte> tweak, bool carry)\n                 tweak[i] |= (byte)(oldCarry << 7);\n             }\n \n-            if (carry)\n-            {\n-                tweak[tweak.Length - 1] |= 0x80;\n-            }\n+            // Insert back the carry\n+            tweak[^1] |= (byte)(carry << 7);\n         }\n     }\n }"
            },
            {
                "sha": "52def8707fc6dfa1091ccaa1faf9a51a90676e2a",
                "filename": "tests/IeeeVectorsTests.cs",
                "status": "modified",
                "additions": 13414,
                "deletions": 1698,
                "changes": 15112,
                "blob_url": "https://github.com/Devolutions/XTS.NET/blob/fb349d5bfb587218e8603b38ea37f03f036b57fd/tests%2FIeeeVectorsTests.cs",
                "raw_url": "https://github.com/Devolutions/XTS.NET/raw/fb349d5bfb587218e8603b38ea37f03f036b57fd/tests%2FIeeeVectorsTests.cs",
                "contents_url": "https://api.github.com/repos/Devolutions/XTS.NET/contents/tests%2FIeeeVectorsTests.cs?ref=fb349d5bfb587218e8603b38ea37f03f036b57fd"
            },
            {
                "sha": "8ef46bc8cd9ecbaef28d1ba3c300db08415a2310",
                "filename": "tests/Tests.cs",
                "status": "modified",
                "additions": 161,
                "deletions": 21,
                "changes": 182,
                "blob_url": "https://github.com/Devolutions/XTS.NET/blob/fb349d5bfb587218e8603b38ea37f03f036b57fd/tests%2FTests.cs",
                "raw_url": "https://github.com/Devolutions/XTS.NET/raw/fb349d5bfb587218e8603b38ea37f03f036b57fd/tests%2FTests.cs",
                "contents_url": "https://api.github.com/repos/Devolutions/XTS.NET/contents/tests%2FTests.cs?ref=fb349d5bfb587218e8603b38ea37f03f036b57fd",
                "patch": "@@ -15,10 +15,38 @@ public void EncryptDecryptTest()\n         // Text generated with ChatGPT\n         byte[] expectedPlaintext = Encoding.UTF8.GetBytes(\"In the serene dawn of a hidden valley, golden sunlight began filtering through the mist, painting the landscape in hues of orange and pink. Each leaf sparkled with a delicate sheen of dew, reminiscent of a thousand scattered jewels upon the gentle sway of early autumn trees. A distant river whispered a soft, calming lullaby, threading its way through a bed of smooth stones. Birds, waking from their slumber, chirped a subtle yet beautiful symphony that harmonized with the flowing water, creating a tranquil yet powerful soundscape. Amidst this quiet paradise, a lone figure walked, footprints left on the soft earth, exploring with reverent curiosity.\\r\\n\\r\\nAs the figure ventured deeper into the valley, an old stone bridge appeared over the river, its stones worn by countless seasons, yet resilient, standing as a testament to the artisans of old. Crossing the bridge, they were greeted by a vibrant grove, filled with the earthy scent of damp soil and the faint fragrance of blooming wildflowers. In this magical solitude, time seemed to slow, each step a moment to breathe, to feel, and to simply exist in harmony with the world around.\\r\\n\\r\\nThis should provide around 520 bytes for a few blocks but not perfectly divisible by 520, as requested. Let me know if you'd like more text or a different style.\");\n         byte[] key = [\n-            0xE1, 0x33, 0xCB, 0xCB, 0x9B, 0xA4, 0x9E, 0xCC,\n-            0x27, 0x40, 0xD6, 0xF9, 0x71, 0x22, 0xA9, 0x5A,\n-            0x0F, 0x70, 0x77, 0xAA, 0x20, 0x2E, 0xA9, 0xAE,\n-            0xB6, 0x4B, 0x3B, 0xDA, 0x87, 0xED, 0xE8, 0xC7\n+            0xE1,\n+            0x33,\n+            0xCB,\n+            0xCB,\n+            0x9B,\n+            0xA4,\n+            0x9E,\n+            0xCC,\n+            0x27,\n+            0x40,\n+            0xD6,\n+            0xF9,\n+            0x71,\n+            0x22,\n+            0xA9,\n+            0x5A,\n+            0x0F,\n+            0x70,\n+            0x77,\n+            0xAA,\n+            0x20,\n+            0x2E,\n+            0xA9,\n+            0xAE,\n+            0xB6,\n+            0x4B,\n+            0x3B,\n+            0xDA,\n+            0x87,\n+            0xED,\n+            0xE8,\n+            0xC7\n         ];\n \n         Aes cipher = Aes.Create();\n@@ -40,15 +68,71 @@ public void EncryptDecrypt256Test()\n         // Text generated with ChatGPT\n         byte[] expectedPlaintext = Encoding.UTF8.GetBytes(\"In the serene dawn of a hidden valley, golden sunlight began filtering through the mist, painting the landscape in hues of orange and pink. Each leaf sparkled with a delicate sheen of dew, reminiscent of a thousand scattered jewels upon the gentle sway of early autumn trees. A distant river whispered a soft, calming lullaby, threading its way through a bed of smooth stones. Birds, waking from their slumber, chirped a subtle yet beautiful symphony that harmonized with the flowing water, creating a tranquil yet powerful soundscape. Amidst this quiet paradise, a lone figure walked, footprints left on the soft earth, exploring with reverent curiosity.\\r\\n\\r\\nAs the figure ventured deeper into the valley, an old stone bridge appeared over the river, its stones worn by countless seasons, yet resilient, standing as a testament to the artisans of old. Crossing the bridge, they were greeted by a vibrant grove, filled with the earthy scent of damp soil and the faint fragrance of blooming wildflowers. In this magical solitude, time seemed to slow, each step a moment to breathe, to feel, and to simply exist in harmony with the world around.\\r\\n\\r\\nThis should provide around 520 bytes for a few blocks but not perfectly divisible by 520, as requested. Let me know if you'd like more text or a different style.\");\n         byte[] key = [\n-            0xE1, 0x33, 0xCB, 0xCB, 0x9B, 0xA4, 0x9E, 0xCC,\n-            0x27, 0x40, 0xD6, 0xF9, 0x71, 0x22, 0xA9, 0x5A,\n-            0x0F, 0x70, 0x77, 0xAA, 0x20, 0x2E, 0xA9, 0xAE,\n-            0xB6, 0x4B, 0x3B, 0xDA, 0x87, 0xED, 0xE8, 0xC7,\n-            0xE9, 0xC2, 0x5D, 0xC4, 0x14, 0xF2, 0xB4, 0xAD,\n-            0xC0, 0xF5, 0x80, 0x41, 0xA0, 0xCA, 0x16, 0x6F,\n-            0xB4, 0x11, 0x66, 0x21, 0x61, 0x8F, 0x24, 0xF5,\n-            0xED, 0xD3, 0x95, 0xD1, 0xB1, 0xA6, 0x19, 0x39\n-            \n+            0xE1,\n+            0x33,\n+            0xCB,\n+            0xCB,\n+            0x9B,\n+            0xA4,\n+            0x9E,\n+            0xCC,\n+            0x27,\n+            0x40,\n+            0xD6,\n+            0xF9,\n+            0x71,\n+            0x22,\n+            0xA9,\n+            0x5A,\n+            0x0F,\n+            0x70,\n+            0x77,\n+            0xAA,\n+            0x20,\n+            0x2E,\n+            0xA9,\n+            0xAE,\n+            0xB6,\n+            0x4B,\n+            0x3B,\n+            0xDA,\n+            0x87,\n+            0xED,\n+            0xE8,\n+            0xC7,\n+            0xE9,\n+            0xC2,\n+            0x5D,\n+            0xC4,\n+            0x14,\n+            0xF2,\n+            0xB4,\n+            0xAD,\n+            0xC0,\n+            0xF5,\n+            0x80,\n+            0x41,\n+            0xA0,\n+            0xCA,\n+            0x16,\n+            0x6F,\n+            0xB4,\n+            0x11,\n+            0x66,\n+            0x21,\n+            0x61,\n+            0x8F,\n+            0x24,\n+            0xF5,\n+            0xED,\n+            0xD3,\n+            0x95,\n+            0xD1,\n+            0xB1,\n+            0xA6,\n+            0x19,\n+            0x39\n+\n         ];\n \n         Aes cipher = Aes.Create();\n@@ -70,10 +154,38 @@ public void NoStealingTestCase()\n         // Text generated with ChatGPT\n         byte[] expectedPlaintext = Encoding.UTF8.GetBytes(\"ABCDEFGHIJKLMNOPQRSTUVWXYZ123456\");\n         byte[] key = [\n-            0xE1, 0x33, 0xCB, 0xCB, 0x9B, 0xA4, 0x9E, 0xCC,\n-            0x27, 0x40, 0xD6, 0xF9, 0x71, 0x22, 0xA9, 0x5A,\n-            0x0F, 0x70, 0x77, 0xAA, 0x20, 0x2E, 0xA9, 0xAE,\n-            0xB6, 0x4B, 0x3B, 0xDA, 0x87, 0xED, 0xE8, 0xC7\n+            0xE1,\n+            0x33,\n+            0xCB,\n+            0xCB,\n+            0x9B,\n+            0xA4,\n+            0x9E,\n+            0xCC,\n+            0x27,\n+            0x40,\n+            0xD6,\n+            0xF9,\n+            0x71,\n+            0x22,\n+            0xA9,\n+            0x5A,\n+            0x0F,\n+            0x70,\n+            0x77,\n+            0xAA,\n+            0x20,\n+            0x2E,\n+            0xA9,\n+            0xAE,\n+            0xB6,\n+            0x4B,\n+            0x3B,\n+            0xDA,\n+            0x87,\n+            0xED,\n+            0xE8,\n+            0xC7\n         ];\n \n         Aes cipher = Aes.Create();\n@@ -96,10 +208,38 @@ public void ExactSectorTestCase()\n         // Text generated with ChatGPT\n         byte[] expectedPlaintext = Encoding.UTF8.GetBytes(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\");\n         byte[] key = [\n-            0xE1, 0x33, 0xCB, 0xCB, 0x9B, 0xA4, 0x9E, 0xCC,\n-            0x27, 0x40, 0xD6, 0xF9, 0x71, 0x22, 0xA9, 0x5A,\n-            0x0F, 0x70, 0x77, 0xAA, 0x20, 0x2E, 0xA9, 0xAE,\n-            0xB6, 0x4B, 0x3B, 0xDA, 0x87, 0xED, 0xE8, 0xC7\n+            0xE1,\n+            0x33,\n+            0xCB,\n+            0xCB,\n+            0x9B,\n+            0xA4,\n+            0x9E,\n+            0xCC,\n+            0x27,\n+            0x40,\n+            0xD6,\n+            0xF9,\n+            0x71,\n+            0x22,\n+            0xA9,\n+            0x5A,\n+            0x0F,\n+            0x70,\n+            0x77,\n+            0xAA,\n+            0x20,\n+            0x2E,\n+            0xA9,\n+            0xAE,\n+            0xB6,\n+            0x4B,\n+            0x3B,\n+            0xDA,\n+            0x87,\n+            0xED,\n+            0xE8,\n+            0xC7\n         ];\n \n         Aes cipher = Aes.Create();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/editorconfig/editorconfig-core-c/commits/a8dd5312e08abeab95ff5656d32ed3cb85fba70b",
        "url": "https://api.github.com/repos/editorconfig/editorconfig-core-c/commits/a8dd5312e08abeab95ff5656d32ed3cb85fba70b",
        "html_url": "https://github.com/editorconfig/editorconfig-core-c/commit/a8dd5312e08abeab95ff5656d32ed3cb85fba70b",
        "message": "Fix a few more stack buffer overflows\n\nSeveral overflows may occur in switch case '[' when the input pattern\ncontains many escaped characters. The added backslashes leave too little\nspace in the output pattern when processing nested brackets such that\nthe remaining input length exceeds the output capacity. Therefore all\nthese concatenations must also be checked.\n\nThe ADD_CHAR was missed in 41281ea (#87). The switch can exit exactly at\ncapacity, leaving no room for the finishing '$', causing an overflow.\n\nThese overflows were discovered through fuzz testing with afl.",
        "files": [
            {
                "sha": "e62af1f8412326722b13fad1ff2d2b411e34d8b2",
                "filename": "src/lib/ec_glob.c",
                "status": "modified",
                "additions": 7,
                "deletions": 3,
                "changes": 10,
                "blob_url": "https://github.com/editorconfig/editorconfig-core-c/blob/a8dd5312e08abeab95ff5656d32ed3cb85fba70b/src%2Flib%2Fec_glob.c",
                "raw_url": "https://github.com/editorconfig/editorconfig-core-c/raw/a8dd5312e08abeab95ff5656d32ed3cb85fba70b/src%2Flib%2Fec_glob.c",
                "contents_url": "https://api.github.com/repos/editorconfig/editorconfig-core-c/contents/src%2Flib%2Fec_glob.c?ref=a8dd5312e08abeab95ff5656d32ed3cb85fba70b",
                "patch": "@@ -192,10 +192,14 @@ int ec_glob(const char *pattern, const char *string)\n                     if (!right_bracket)  /* The right bracket may not exist */\n                         right_bracket = c + strlen(c);\n \n-                    strcat(p_pcre, \"\\\\\");\n+                    STRING_CAT(p_pcre, \"\\\\\", pcre_str_end);\n+                    /* Boundary check for strncat below. */\n+                    if (pcre_str_end - p_pcre <= right_bracket - c) {\n+                        return -1;\n+                    }\n                     strncat(p_pcre, c, right_bracket - c);\n                     if (*right_bracket)  /* right_bracket is a bracket */\n-                        strcat(p_pcre, \"\\\\]\");\n+                        STRING_CAT(p_pcre, \"\\\\]\", pcre_str_end);\n                     p_pcre += strlen(p_pcre);\n                     c = right_bracket;\n                     if (!*c)\n@@ -339,7 +343,7 @@ int ec_glob(const char *pattern, const char *string)\n         }\n     }\n \n-    *(p_pcre ++) = '$';\n+    ADD_CHAR(p_pcre, '$', pcre_str_end);\n \n     pcre2_code_free(re); /* ^\\\\d+\\\\.\\\\.\\\\d+$ */\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/editorconfig/editorconfig-core-c/commits/4d5518a0a4e4910c37281ab13a048d0d86999782",
        "url": "https://api.github.com/repos/editorconfig/editorconfig-core-c/commits/4d5518a0a4e4910c37281ab13a048d0d86999782",
        "html_url": "https://github.com/editorconfig/editorconfig-core-c/commit/4d5518a0a4e4910c37281ab13a048d0d86999782",
        "message": "Fix pointer overflow in STRING_CAT\n\nThe end pointer is positioned one past the end of the destination, and\nit is undefined behavior to compute an address beyond the end pointer,\nincluding for comparisons, even temporarily. The UB occurs exactly when\nbuffer overflow would have occurred, so the buffer overflow check could\nbe optimized away by compilers. Even if this wasn't the case, the check\ncould produce a false negative if the computed address overflowed the\naddress space, which is, after all, why the C standard doesn't define\nbehavior in the first place.\n\nThe fix is simple: Check using sizes, not addresses. The explicit cast\nsuppresses warnings about signed-unsigned comparisons, and the assertion\nchecks the cast.",
        "files": [
            {
                "sha": "c2b83cfe72628c1f163673cb3f3b657cb82fbed5",
                "filename": "src/lib/ec_glob.c",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/editorconfig/editorconfig-core-c/blob/4d5518a0a4e4910c37281ab13a048d0d86999782/src%2Flib%2Fec_glob.c",
                "raw_url": "https://github.com/editorconfig/editorconfig-core-c/raw/4d5518a0a4e4910c37281ab13a048d0d86999782/src%2Flib%2Fec_glob.c",
                "contents_url": "https://api.github.com/repos/editorconfig/editorconfig-core-c/contents/src%2Flib%2Fec_glob.c?ref=4d5518a0a4e4910c37281ab13a048d0d86999782",
                "patch": "@@ -27,6 +27,7 @@\n \n #include \"global.h\"\n \n+#include <assert.h>\n #include <ctype.h>\n #include <string.h>\n #include <pcre2.h>\n@@ -51,7 +52,8 @@ static const UT_icd ut_int_pair_icd = {sizeof(int_pair),NULL,NULL,NULL};\n /* concatenate the string then move the pointer to the end */\n #define STRING_CAT(p, string, end)  do {    \\\n     size_t string_len = strlen(string); \\\n-    if (p + string_len >= end) \\\n+    assert(end > p); \\\n+    if (string_len >= (size_t)(end - p)) \\\n         return -1; \\\n     strcat(p, string); \\\n     p += string_len; \\"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cri-o/cri-o/commits/e8e7dcb7838d11b5157976bf3e31a5840bb77de7",
        "url": "https://api.github.com/repos/cri-o/cri-o/commits/e8e7dcb7838d11b5157976bf3e31a5840bb77de7",
        "html_url": "https://github.com/cri-o/cri-o/commit/e8e7dcb7838d11b5157976bf3e31a5840bb77de7",
        "message": "Merge commit from fork\n\nOnly restore container if all bind mounts are defined",
        "files": [
            {
                "sha": "74c8a2c1658198292c478421386b986f2df6be0e",
                "filename": "server/container_restore.go",
                "status": "modified",
                "additions": 50,
                "deletions": 82,
                "changes": 132,
                "blob_url": "https://github.com/cri-o/cri-o/blob/e8e7dcb7838d11b5157976bf3e31a5840bb77de7/server%2Fcontainer_restore.go",
                "raw_url": "https://github.com/cri-o/cri-o/raw/e8e7dcb7838d11b5157976bf3e31a5840bb77de7/server%2Fcontainer_restore.go",
                "contents_url": "https://api.github.com/repos/cri-o/cri-o/contents/server%2Fcontainer_restore.go?ref=e8e7dcb7838d11b5157976bf3e31a5840bb77de7",
                "patch": "@@ -6,6 +6,7 @@ import (\n \t\"errors\"\n \t\"fmt\"\n \t\"os\"\n+\t\"strings\"\n \n \tmetadata \"github.com/checkpoint-restore/checkpointctl/lib\"\n \t\"github.com/containers/storage/pkg/archive\"\n@@ -63,6 +64,10 @@ func (s *Server) CRImportCheckpoint(\n \t\treturn \"\", errors.New(`attribute \"image\" missing from container definition`)\n \t}\n \n+\tif createConfig.Metadata == nil && createConfig.Metadata.Name == \"\" {\n+\t\treturn \"\", errors.New(`attribute \"metadata\" missing from container definition`)\n+\t}\n+\n \tinputImage := createConfig.Image.Image\n \tcreateMounts := createConfig.Mounts\n \tcreateAnnotations := createConfig.Annotations\n@@ -154,69 +159,25 @@ func (s *Server) CRImportCheckpoint(\n \t\treturn \"\", fmt.Errorf(\"failed to read %q: %w\", metadata.ConfigDumpFile, err)\n \t}\n \n-\tctrMetadata := types.ContainerMetadata{}\n \toriginalAnnotations := make(map[string]string)\n-\toriginalLabels := make(map[string]string)\n-\n-\tif dumpSpec.Annotations[annotations.ContainerManager] == \"libpod\" {\n-\t\t// This is an import from Podman\n-\t\tctrMetadata.Name = config.Name\n-\t\tctrMetadata.Attempt = 0\n-\t} else {\n-\t\tif err := json.Unmarshal([]byte(dumpSpec.Annotations[annotations.Metadata]), &ctrMetadata); err != nil {\n-\t\t\treturn \"\", fmt.Errorf(\"failed to read %q: %w\", annotations.Metadata, err)\n-\t\t}\n-\t\tif createConfig.Metadata != nil && createConfig.Metadata.Name != \"\" {\n-\t\t\tctrMetadata.Name = createConfig.Metadata.Name\n-\t\t}\n-\t\tif err := json.Unmarshal([]byte(dumpSpec.Annotations[annotations.Annotations]), &originalAnnotations); err != nil {\n-\t\t\treturn \"\", fmt.Errorf(\"failed to read %q: %w\", annotations.Annotations, err)\n-\t\t}\n-\n-\t\tif err := json.Unmarshal([]byte(dumpSpec.Annotations[annotations.Labels]), &originalLabels); err != nil {\n-\t\t\treturn \"\", fmt.Errorf(\"failed to read %q: %w\", annotations.Labels, err)\n-\t\t}\n-\t\tif sandboxUID != \"\" {\n-\t\t\tif _, ok := originalLabels[kubetypes.KubernetesPodUIDLabel]; ok {\n-\t\t\t\toriginalLabels[kubetypes.KubernetesPodUIDLabel] = sandboxUID\n-\t\t\t}\n-\t\t\tif _, ok := originalAnnotations[kubetypes.KubernetesPodUIDLabel]; ok {\n-\t\t\t\toriginalAnnotations[kubetypes.KubernetesPodUIDLabel] = sandboxUID\n-\t\t\t}\n-\t\t}\n-\n-\t\tif createLabels != nil {\n-\t\t\tfixupLabels := []string{\n-\t\t\t\t// Update the container name. It has already been update in metadata.Name.\n-\t\t\t\t// It also needs to be updated in the container labels.\n-\t\t\t\tkubetypes.KubernetesContainerNameLabel,\n-\t\t\t\t// Update pod name in the labels.\n-\t\t\t\tkubetypes.KubernetesPodNameLabel,\n-\t\t\t\t// Also update namespace.\n-\t\t\t\tkubetypes.KubernetesPodNamespaceLabel,\n-\t\t\t}\n \n-\t\t\tfor _, annotation := range fixupLabels {\n-\t\t\t\t_, ok1 := createLabels[annotation]\n-\t\t\t\t_, ok2 := originalLabels[annotation]\n+\tif err := json.Unmarshal([]byte(dumpSpec.Annotations[annotations.Annotations]), &originalAnnotations); err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to read %q: %w\", annotations.Annotations, err)\n+\t}\n \n-\t\t\t\t// If the value is not set in the original container or\n-\t\t\t\t// if it is not set in the new container, just skip\n-\t\t\t\t// the step of updating metadata.\n-\t\t\t\tif ok1 && ok2 {\n-\t\t\t\t\toriginalLabels[annotation] = createLabels[annotation]\n-\t\t\t\t}\n-\t\t\t}\n+\tif sandboxUID != \"\" {\n+\t\tif _, ok := originalAnnotations[kubetypes.KubernetesPodUIDLabel]; ok {\n+\t\t\toriginalAnnotations[kubetypes.KubernetesPodUIDLabel] = sandboxUID\n \t\t}\n+\t}\n \n-\t\tif createAnnotations != nil {\n-\t\t\t// The hash also needs to be update or Kubernetes thinks the container needs to be restarted\n-\t\t\t_, ok1 := createAnnotations[\"io.kubernetes.container.hash\"]\n-\t\t\t_, ok2 := originalAnnotations[\"io.kubernetes.container.hash\"]\n+\tif createAnnotations != nil {\n+\t\t// The hash also needs to be update or Kubernetes thinks the container needs to be restarted\n+\t\t_, ok1 := createAnnotations[\"io.kubernetes.container.hash\"]\n+\t\t_, ok2 := originalAnnotations[\"io.kubernetes.container.hash\"]\n \n-\t\t\tif ok1 && ok2 {\n-\t\t\t\toriginalAnnotations[\"io.kubernetes.container.hash\"] = createAnnotations[\"io.kubernetes.container.hash\"]\n-\t\t\t}\n+\t\tif ok1 && ok2 {\n+\t\t\toriginalAnnotations[\"io.kubernetes.container.hash\"] = createAnnotations[\"io.kubernetes.container.hash\"]\n \t\t}\n \t}\n \n@@ -256,8 +217,8 @@ func (s *Server) CRImportCheckpoint(\n \t}\n \tcontainerConfig := &types.ContainerConfig{\n \t\tMetadata: &types.ContainerMetadata{\n-\t\t\tName:    ctrMetadata.Name,\n-\t\t\tAttempt: ctrMetadata.Attempt,\n+\t\t\tName:    createConfig.Metadata.Name,\n+\t\t\tAttempt: createConfig.Metadata.Attempt,\n \t\t},\n \t\tImage: &types.ImageSpec{\n \t\t\tImage: rootFSImage,\n@@ -267,7 +228,9 @@ func (s *Server) CRImportCheckpoint(\n \t\t\tSecurityContext: &types.LinuxContainerSecurityContext{},\n \t\t},\n \t\tAnnotations: originalAnnotations,\n-\t\tLabels:      originalLabels,\n+\t\t// The labels are nod changed or adapted. They are just taken from the CRI\n+\t\t// request without any modification (in contrast to the annotations).\n+\t\tLabels: createLabels,\n \t}\n \n \tif createConfig.Linux != nil {\n@@ -304,6 +267,13 @@ func (s *Server) CRImportCheckpoint(\n \t\t\"/run/.containerenv\": true,\n \t}\n \n+\t// It is necessary to ensure that all bind mounts in the checkpoint archive are defined\n+\t// in the create container requested coming in via the CRI. If this check would not\n+\t// be here it would be possible to create a checkpoint archive that mounts some random\n+\t// file/directory on the host with the user knowing as it will happen without specifying\n+\t// it in the container definition.\n+\tmissingMount := []string{}\n+\n \tfor _, m := range dumpSpec.Mounts {\n \t\t// Following mounts are ignored as they might point to the\n \t\t// wrong location and if ignored the mounts will correctly\n@@ -313,40 +283,38 @@ func (s *Server) CRImportCheckpoint(\n \t\t}\n \t\tmount := &types.Mount{\n \t\t\tContainerPath: m.Destination,\n-\t\t\tHostPath:      m.Source,\n \t\t}\n \n+\t\tbindMountFound := false\n \t\tfor _, createMount := range createMounts {\n \t\t\tif createMount.ContainerPath == m.Destination {\n \t\t\t\tmount.HostPath = createMount.HostPath\n+\t\t\t\tmount.Readonly = createMount.Readonly\n+\t\t\t\tmount.RecursiveReadOnly = createMount.RecursiveReadOnly\n+\t\t\t\tmount.Propagation = createMount.Propagation\n+\t\t\t\tmount.RecursiveReadOnly = createMount.RecursiveReadOnly\n+\t\t\t\tbindMountFound = true\n \t\t\t}\n \t\t}\n-\n-\t\tfor _, opt := range m.Options {\n-\t\t\tswitch opt {\n-\t\t\tcase \"ro\":\n-\t\t\t\tmount.Readonly = true\n-\t\t\tcase \"rro\":\n-\t\t\t\tmount.RecursiveReadOnly = true\n-\t\t\tcase \"rprivate\":\n-\t\t\t\tmount.Propagation = types.MountPropagation_PROPAGATION_PRIVATE\n-\t\t\tcase \"rshared\":\n-\t\t\t\tmount.Propagation = types.MountPropagation_PROPAGATION_BIDIRECTIONAL\n-\t\t\tcase \"rslaved\":\n-\t\t\t\tmount.Propagation = types.MountPropagation_PROPAGATION_HOST_TO_CONTAINER\n-\t\t\t}\n-\t\t}\n-\n-\t\t// Recursive Read-only (RRO) support requires the mount to be\n-\t\t// read-only and the mount propagation set to private.\n-\t\tif mount.RecursiveReadOnly {\n-\t\t\tmount.Readonly = true\n-\t\t\tmount.Propagation = types.MountPropagation_PROPAGATION_PRIVATE\n+\t\tif !bindMountFound {\n+\t\t\tmissingMount = append(missingMount, m.Destination)\n+\t\t\t// If one mount is missing we can skip over any further code as we have\n+\t\t\t// to abort the restore process anyway. Not using break to get all missing\n+\t\t\t// mountpoints in one error message.\n+\t\t\tcontinue\n \t\t}\n \n \t\tlog.Debugf(ctx, \"Adding mounts %#v\", mount)\n \t\tcontainerConfig.Mounts = append(containerConfig.Mounts, mount)\n \t}\n+\tif len(missingMount) > 0 {\n+\t\treturn \"\", fmt.Errorf(\n+\t\t\t\"restoring %q expects following bind mounts defined (%s)\",\n+\t\t\tinputImage,\n+\t\t\tstrings.Join(missingMount, \",\"),\n+\t\t)\n+\t}\n+\n \tsandboxConfig := &types.PodSandboxConfig{\n \t\tMetadata: &types.PodSandboxMetadata{\n \t\t\tName:      sb.Metadata().Name,"
            },
            {
                "sha": "bb5caaacb86b1d7457ccff01e454ab0cb5b76c7d",
                "filename": "test/checkpoint.bats",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/cri-o/cri-o/blob/e8e7dcb7838d11b5157976bf3e31a5840bb77de7/test%2Fcheckpoint.bats",
                "raw_url": "https://github.com/cri-o/cri-o/raw/e8e7dcb7838d11b5157976bf3e31a5840bb77de7/test%2Fcheckpoint.bats",
                "contents_url": "https://api.github.com/repos/cri-o/cri-o/contents/test%2Fcheckpoint.bats?ref=e8e7dcb7838d11b5157976bf3e31a5840bb77de7",
                "patch": "@@ -36,9 +36,15 @@ function teardown() {\n \tpod_id=$(crictl runp \"$TESTDATA\"/sandbox_config.json)\n \t# Replace original container with checkpoint image\n \tRESTORE_JSON=$(mktemp)\n+\tRESTORE2_JSON=$(mktemp)\n \tjq \".image.image=\\\"$TESTDIR/cp.tar\\\"\" \"$TESTDATA\"/container_sleep.json > \"$RESTORE_JSON\"\n-\tctr_id=$(crictl create \"$pod_id\" \"$RESTORE_JSON\" \"$TESTDATA\"/sandbox_config.json)\n+\t# This should fail because the bind mounts are not part of the create request\n+\trun crictl create \"$pod_id\" \"$RESTORE_JSON\" \"$TESTDATA\"/sandbox_config.json\n+\t[ \"$status\" -eq 1 ]\n+\tjq \". +{mounts:[{\\\"container_path\\\":\\\"/etc/issue\\\",\\\"host_path\\\":\\\"$BIND_MOUNT_FILE\\\"},{\\\"container_path\\\":\\\"/data\\\",\\\"host_path\\\":\\\"$BIND_MOUNT_DIR\\\"}]}\" \"$RESTORE_JSON\" > \"$RESTORE2_JSON\"\n+\tctr_id=$(crictl create \"$pod_id\" \"$RESTORE2_JSON\" \"$TESTDATA\"/sandbox_config.json)\n \trm -f \"$RESTORE_JSON\"\n+\trm -f \"$RESTORE2_JSON\"\n \trm -f \"$TESTDATA\"/checkpoint.json\n \tcrictl start \"$ctr_id\"\n \trestored=$(crictl inspect --output go-template --template \"{{(index .info.restored)}}\" \"$ctr_id\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ethyca/fides/commits/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2",
        "url": "https://api.github.com/repos/ethyca/fides/commits/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2",
        "html_url": "https://github.com/ethyca/fides/commit/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2",
        "message": "Merge commit from fork\n\n* HJ-172 - Password Policy is now Enforced in Accept Invite API\n\n* Update changelog\n\n* HJ-172 - Password Policy is now Enforced in Accept Invite API\n\n* QA",
        "files": [
            {
                "sha": "02e738a806c3a36fae20250ed839f3b161aaa2ce",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/ethyca/fides/blob/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2/CHANGELOG.md",
                "raw_url": "https://github.com/ethyca/fides/raw/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/CHANGELOG.md?ref=ce664da46ab7f86d29583ebc34f2ff776f0aa6c2",
                "patch": "@@ -41,6 +41,9 @@ The types of changes are:\n ### Docs\n - Added docs for PrivacyNoticeRegion type [#5488](https://github.com/ethyca/fides/pull/5488)\n \n+### Security\n+ - Password Policy is now Enforced in Accept Invite API [CVE-2024-52008](https://github.com/ethyca/fides/security/advisories/GHSA-v7vm-rhmg-8j2r)\n+\n ## [2.49.1](https://github.com/ethyca/fidesplus/compare/2.49.0...2.49.1)\n \n ### Added"
            },
            {
                "sha": "ab6b491a42da4467e9f50b0853af80398d7246fd",
                "filename": "src/fides/api/api/v1/endpoints/user_endpoints.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/ethyca/fides/blob/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2/src%2Ffides%2Fapi%2Fapi%2Fv1%2Fendpoints%2Fuser_endpoints.py",
                "raw_url": "https://github.com/ethyca/fides/raw/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2/src%2Ffides%2Fapi%2Fapi%2Fv1%2Fendpoints%2Fuser_endpoints.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/src%2Ffides%2Fapi%2Fapi%2Fv1%2Fendpoints%2Fuser_endpoints.py?ref=ce664da46ab7f86d29583ebc34f2ff776f0aa6c2",
                "patch": "@@ -173,7 +173,7 @@ def update_user_password(\n             status_code=HTTP_401_UNAUTHORIZED, detail=\"Incorrect password.\"\n         )\n \n-    current_user.update_password(db=db, new_password=b64_str_to_str(data.new_password))\n+    current_user.update_password(db=db, new_password=data.new_password)\n \n     logger.info(\"Updated user with id: '{}'.\", current_user.id)\n     return current_user\n@@ -202,7 +202,7 @@ def force_update_password(\n             detail=f\"User with ID {user_id} does not exist.\",\n         )\n \n-    user.update_password(db=db, new_password=b64_str_to_str(data.new_password))\n+    user.update_password(db=db, new_password=data.new_password)\n     logger.info(\"Updated user with id: '{}'.\", user.id)\n     return user\n "
            },
            {
                "sha": "c1c538dfa5b41ac235fc58348b9cfa76e8139a4b",
                "filename": "src/fides/api/schemas/user.py",
                "status": "modified",
                "additions": 32,
                "deletions": 7,
                "changes": 39,
                "blob_url": "https://github.com/ethyca/fides/blob/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2/src%2Ffides%2Fapi%2Fschemas%2Fuser.py",
                "raw_url": "https://github.com/ethyca/fides/raw/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2/src%2Ffides%2Fapi%2Fschemas%2Fuser.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/src%2Ffides%2Fapi%2Fschemas%2Fuser.py?ref=ce664da46ab7f86d29583ebc34f2ff776f0aa6c2",
                "patch": "@@ -10,6 +10,7 @@\n from fides.api.schemas.oauth import AccessToken\n \n \n+\n class PrivacyRequestReviewer(FidesSchema):\n     \"\"\"Data we can expose via the PrivacyRequest.reviewer relation\"\"\"\n \n@@ -40,19 +41,29 @@ def validate_username(cls, username: str) -> str:\n     def validate_password(cls, password: str) -> str:\n         \"\"\"Add some password requirements\"\"\"\n         decoded_password = decode_password(password)\n-\n-        if len(decoded_password) < 8:\n+        return UserCreate._validate_password(decoded_password)\n+\n+    @staticmethod\n+    def _validate_password(password: str) -> str:\n+        \"\"\"\n+        Validate password requirements.\n+            Raises:\n+                ValueError: If password does not meet requirements\n+            Returns:\n+                str: password\n+        \"\"\"\n+        if len(password) < 8:\n             raise ValueError(\"Password must have at least eight characters.\")\n-        if re.search(\"[0-9]\", decoded_password) is None:\n+        if re.search(\"[\\d]\", password) is None:\n             raise ValueError(\"Password must have at least one number.\")\n-        if re.search(\"[A-Z]\", decoded_password) is None:\n+        if re.search(\"[A-Z]\", password) is None:\n             raise ValueError(\"Password must have at least one capital letter.\")\n-        if re.search(\"[a-z]\", decoded_password) is None:\n+        if re.search(\"[a-z]\", password) is None:\n             raise ValueError(\"Password must have at least one lowercase letter.\")\n-        if re.search(r\"[\\W_]\", decoded_password) is None:\n+        if re.search(r\"[\\W_]\", password) is None:\n             raise ValueError(\"Password must have at least one symbol.\")\n \n-        return decoded_password\n+        return password\n \n \n class UserCreateResponse(FidesSchema):\n@@ -102,12 +113,26 @@ class UserPasswordReset(FidesSchema):\n     old_password: str\n     new_password: str\n \n+    @field_validator(\"new_password\")\n+    @classmethod\n+    def validate_new_password(cls, password: str) -> str:\n+        \"\"\"Add some password requirements\"\"\"\n+        decoded_password = decode_password(password)\n+        return UserCreate._validate_password(decoded_password)\n+\n \n class UserForcePasswordReset(FidesSchema):\n     \"\"\"Only a new password, for the case where the user does not remember their password\"\"\"\n \n     new_password: str\n \n+    @field_validator(\"new_password\")\n+    @classmethod\n+    def validate_new_password(cls, password: str) -> str:\n+        \"\"\"Add some password requirements\"\"\"\n+        decoded_password = decode_password(password)\n+        return UserCreate._validate_password(decoded_password)\n+\n \n class UserUpdate(FidesSchema):\n     \"\"\"Data required to update a FidesUser\"\"\""
            },
            {
                "sha": "7d1f16078db467636d660495667350e98b49c6c2",
                "filename": "tests/ops/api/v1/endpoints/test_user_endpoints.py",
                "status": "modified",
                "additions": 51,
                "deletions": 11,
                "changes": 62,
                "blob_url": "https://github.com/ethyca/fides/blob/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2/tests%2Fops%2Fapi%2Fv1%2Fendpoints%2Ftest_user_endpoints.py",
                "raw_url": "https://github.com/ethyca/fides/raw/ce664da46ab7f86d29583ebc34f2ff776f0aa6c2/tests%2Fops%2Fapi%2Fv1%2Fendpoints%2Ftest_user_endpoints.py",
                "contents_url": "https://api.github.com/repos/ethyca/fides/contents/tests%2Fops%2Fapi%2Fv1%2Fendpoints%2Ftest_user_endpoints.py?ref=ce664da46ab7f86d29583ebc34f2ff776f0aa6c2",
                "patch": "@@ -852,7 +852,7 @@ def test_update_different_user_password(\n         application_user,\n     ) -> None:\n         OLD_PASSWORD = \"oldpassword\"\n-        NEW_PASSWORD = \"newpassword\"\n+        NEW_PASSWORD = \"Newpassword1!\"\n         application_user.update_password(db=db, new_password=OLD_PASSWORD)\n \n         auth_header = generate_auth_header_for_user(user=application_user, scopes=[])\n@@ -874,15 +874,15 @@ def test_update_different_user_password(\n         application_user = application_user.refresh_from_db(db=db)\n         assert application_user.credentials_valid(password=OLD_PASSWORD)\n \n-    def test_update_user_password_invalid(\n+    def test_update_user_password_invalid_old_password(\n         self,\n         api_client,\n         db,\n         url_no_id,\n         application_user,\n     ) -> None:\n         OLD_PASSWORD = \"oldpassword\"\n-        NEW_PASSWORD = \"newpassword\"\n+        NEW_PASSWORD = \"Newpassword1!\"\n         application_user.update_password(db=db, new_password=OLD_PASSWORD)\n \n         auth_header = generate_auth_header_for_user(user=application_user, scopes=[])\n@@ -909,7 +909,7 @@ def test_update_user_password(\n         application_user,\n     ) -> None:\n         OLD_PASSWORD = \"oldpassword\"\n-        NEW_PASSWORD = \"newpassword\"\n+        NEW_PASSWORD = \"Newpassword1!\"\n         application_user.update_password(db=db, new_password=OLD_PASSWORD)\n         auth_header = generate_auth_header_for_user(user=application_user, scopes=[])\n         resp = api_client.post(\n@@ -934,7 +934,7 @@ def test_force_update_different_user_password_without_scope(\n         application_user,\n     ) -> None:\n         \"\"\"A user without the proper scope cannot change another user's password\"\"\"\n-        NEW_PASSWORD = \"newpassword\"\n+        NEW_PASSWORD = \"Newpassword1!\"\n         old_hashed_password = user.hashed_password\n \n         auth_header = generate_auth_header_for_user(user=application_user, scopes=[])\n@@ -965,7 +965,7 @@ def test_force_update_different_user_password(\n         A user with the right scope should be able to set a new password\n         for another user.\n         \"\"\"\n-        NEW_PASSWORD = \"newpassword\"\n+        NEW_PASSWORD = \"Newpassword1!\"\n         auth_header = generate_auth_header_for_user(\n             user=application_user, scopes=[USER_PASSWORD_RESET]\n         )\n@@ -982,6 +982,46 @@ def test_force_update_different_user_password(\n         user = user.refresh_from_db(db=db)\n         assert user.credentials_valid(password=NEW_PASSWORD)\n \n+    @pytest.mark.parametrize(\n+        \"new_password, expected_error\",\n+        [\n+            (\"short\", \"Value error, Password must have at least eight characters.\"),\n+            (\"longerpassword\", \"Value error, Password must have at least one number.\"),\n+            (\"longer55password\", \"Value error, Password must have at least one capital letter.\"),\n+            (\"LONGER55PASSWORD\", \"Value error, Password must have at least one lowercase letter.\"),\n+            (\"LoNgEr55paSSworD\", \"Value error, Password must have at least one symbol.\"),\n+        ],\n+    )\n+    def test_force_update_bad_password(\n+        self,\n+        api_client,\n+        db,\n+        url_no_id,\n+        user,\n+        application_user,\n+        new_password,\n+        expected_error,\n+    ) -> None:\n+        \"\"\"\n+        A user with the right scope should be able to set a new password\n+        for another user.\n+        \"\"\"\n+        auth_header = generate_auth_header_for_user(\n+            user=application_user, scopes=[USER_PASSWORD_RESET]\n+        )\n+\n+        resp = api_client.post(\n+            f\"{url_no_id}/{user.id}/force-reset-password\",\n+            headers=auth_header,\n+            json={\n+                \"new_password\": str_to_b64_str(new_password),\n+            },\n+        )\n+\n+        assert resp.status_code == HTTP_422_UNPROCESSABLE_ENTITY\n+        assert expected_error in resp.json()[\"detail\"][0][\"msg\"]\n+        db.expunge(user)\n+\n     def test_force_update_non_existent_user(\n         self,\n         api_client,\n@@ -991,7 +1031,7 @@ def test_force_update_non_existent_user(\n         \"\"\"\n         Resetting on a user that does not exist should 404\n         \"\"\"\n-        NEW_PASSWORD = \"newpassword\"\n+        NEW_PASSWORD = \"Newpassword1!\"\n         auth_header = generate_auth_header_for_user(\n             user=application_user, scopes=[USER_PASSWORD_RESET]\n         )\n@@ -1902,7 +1942,7 @@ def test_accept_invite_valid(\n         response = api_client.post(\n             url,\n             params={\"username\": \"valid_user\", \"invite_code\": \"valid_code\"},\n-            json={\"username\": \"valid_user\", \"new_password\": \"pass\"},\n+            json={\"username\": \"valid_user\", \"new_password\": \"Testpassword1!\"},\n         )\n \n         assert response.status_code == HTTP_200_OK\n@@ -1925,7 +1965,7 @@ def test_accept_invite_invalid_code(self, db, api_client, url):\n         response = api_client.post(\n             url,\n             params={\"username\": \"valid_user\", \"invite_code\": \"invalid_code\"},\n-            json={\"username\": \"valid_user\", \"new_password\": \"pass\"},\n+            json={\"username\": \"valid_user\", \"new_password\": \"Testpassword1!\"},\n         )\n         assert response.status_code == HTTP_400_BAD_REQUEST\n         assert response.json()[\"detail\"] == \"Invite code is invalid.\"\n@@ -1943,7 +1983,7 @@ def test_accept_invite_expired_code(self, mock_get_by, api_client: TestClient, u\n         response = api_client.post(\n             url,\n             params={\"username\": \"valid_user\", \"invite_code\": \"expired_code\"},\n-            json={\"username\": \"valid_user\", \"new_password\": \"pass\"},\n+            json={\"username\": \"valid_user\", \"new_password\": \"Testpassword1!\"},\n         )\n         assert response.status_code == HTTP_400_BAD_REQUEST\n         assert response.json()[\"detail\"] == \"Invite code has expired.\"\n@@ -1954,7 +1994,7 @@ def test_accept_invite_nonexistent_user(self, api_client, url):\n             params={\"username\": \"nonexistent_user\", \"invite_code\": \"some_code\"},\n             json={\n                 \"username\": \"nonexistent_user\",\n-                \"new_password\": \"pass\",\n+                \"new_password\": \"Testpassword1!\",\n             },\n         )\n         assert response.status_code == HTTP_404_NOT_FOUND"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/lobehub/lobe-chat/commits/e960a23b0c69a5762eb27d776d33dac443058faf",
        "url": "https://api.github.com/repos/lobehub/lobe-chat/commits/e960a23b0c69a5762eb27d776d33dac443058faf",
        "html_url": "https://github.com/lobehub/lobe-chat/commit/e960a23b0c69a5762eb27d776d33dac443058faf",
        "message": "\ud83d\udc1b fix: try to implement better ssrf-protect (#4044)\n\n* \ud83d\udc1b fix: try to implement better ssrf-protect\r\n\r\n* \ud83d\udc1b fix: fix error\r\n\r\n* \ud83d\udc84 style: improve pwa",
        "files": [
            {
                "sha": "83e944a9fdb675d4262d8ca666e217b4ad42e365",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/package.json",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/package.json",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/package.json?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -203,6 +203,7 @@\n     \"remark\": \"^14.0.3\",\n     \"remark-gfm\": \"^3.0.1\",\n     \"remark-html\": \"^15.0.2\",\n+    \"request-filtering-agent\": \"^2.0.1\",\n     \"resolve-accept-language\": \"^3.1.5\",\n     \"rtl-detect\": \"^1.1.2\",\n     \"semver\": \"^7.6.3\","
            },
            {
                "sha": "67277ac7989a0a4c79f6e4ebd8129b93674cd06a",
                "filename": "src/app/api/proxy/route.ts",
                "status": "removed",
                "additions": 0,
                "deletions": 34,
                "changes": 34,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/4e3b71b85b8b4cbf816a0a90ea491df3cb20c619/src%2Fapp%2Fapi%2Fproxy%2Froute.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/4e3b71b85b8b4cbf816a0a90ea491df3cb20c619/src%2Fapp%2Fapi%2Fproxy%2Froute.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fapp%2Fapi%2Fproxy%2Froute.ts?ref=4e3b71b85b8b4cbf816a0a90ea491df3cb20c619",
                "patch": "@@ -1,34 +0,0 @@\n-import { isPrivate } from 'ip';\n-import { NextResponse } from 'next/server';\n-import dns from 'node:dns';\n-import { promisify } from 'node:util';\n-\n-const lookupAsync = promisify(dns.lookup);\n-\n-export const runtime = 'nodejs';\n-\n-/**\n- * just for a proxy\n- */\n-export const POST = async (req: Request) => {\n-  const url = new URL(await req.text());\n-  let address;\n-\n-  try {\n-    const lookupResult = await lookupAsync(url.hostname);\n-    address = lookupResult.address;\n-  } catch (err) {\n-    console.error(`${url.hostname} DNS parser error:`, err);\n-\n-    return NextResponse.json({ error: 'DNS parser error' }, { status: 504 });\n-  }\n-\n-  const isInternalHost = isPrivate(address);\n-\n-  if (isInternalHost)\n-    return NextResponse.json({ error: 'Not support internal host proxy' }, { status: 400 });\n-\n-  const res = await fetch(url.toString());\n-\n-  return new Response(res.body, { headers: res.headers });\n-};"
            },
            {
                "sha": "da81e4ae8c2bc5292423770cdb3fa68dc34116ef",
                "filename": "src/app/webapi/proxy/route.ts",
                "status": "added",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fapp%2Fwebapi%2Fproxy%2Froute.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fapp%2Fwebapi%2Fproxy%2Froute.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fapp%2Fwebapi%2Fproxy%2Froute.ts?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -0,0 +1,19 @@\n+import { NextResponse } from 'next/server';\n+import fetch from 'node-fetch';\n+import { useAgent as ssrfAgent } from 'request-filtering-agent';\n+\n+/**\n+ * just for a proxy\n+ */\n+export const POST = async (req: Request) => {\n+  const url = await req.text();\n+\n+  try {\n+    const res = await fetch(url, { agent: ssrfAgent(url) });\n+\n+    return new Response(await res.arrayBuffer(), { headers: { ...res.headers } });\n+  } catch (err) {\n+    console.error(err); // DNS lookup 127.0.0.1(family:4, host:127.0.0.1.nip.io) is not allowed. Because, It is private IP address.\n+    return NextResponse.json({ error: 'Not support internal host proxy' }, { status: 400 });\n+  }\n+};"
            },
            {
                "sha": "9660a955e691e49d39899be19de12feb6d6532d0",
                "filename": "src/server/routers/lambda/user.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fserver%2Frouters%2Flambda%2Fuser.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fserver%2Frouters%2Flambda%2Fuser.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fserver%2Frouters%2Flambda%2Fuser.ts?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -63,7 +63,7 @@ export const userRouter = router({\n     const sessionCount = await sessionModel.count();\n \n     return {\n-      canEnablePWAGuide: messageCount >= 2,\n+      canEnablePWAGuide: messageCount >= 4,\n       canEnableTrace: messageCount >= 4,\n       // \u6709\u6d88\u606f\uff0c\u6216\u8005\u521b\u5efa\u8fc7\u52a9\u624b\uff0c\u5219\u8ba4\u4e3a\u6709 conversation\n       hasConversation: messageCount > 0 || sessionCount > 1,"
            },
            {
                "sha": "5b110bef7062e0ecf51cd48ed45af0a8995fe1d7",
                "filename": "src/services/_url.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fservices%2F_url.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fservices%2F_url.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fservices%2F_url.ts?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -1,4 +1,4 @@\n-// TODO: \u672a\u6765\u8def\u7531\u9700\u8981\u8fc1\u79fb\u5230 trpc or /webapi\n+// TODO: \u672a\u6765\u6240\u6709\u6838\u5fc3\u8def\u7531\u9700\u8981\u8fc1\u79fb\u5230 trpc\uff0c\u90e8\u5206\u4e0d\u9700\u8981\u8fc1\u79fb\u7684\u5219\u8d70 webapi\n \n /* eslint-disable sort-keys-fix/sort-keys-fix */\n import { transform } from 'lodash-es';\n@@ -17,7 +17,7 @@ const mapWithBasePath = <T extends object>(apis: T): T => {\n };\n \n export const API_ENDPOINTS = mapWithBasePath({\n-  proxy: '/api/proxy',\n+  proxy: '/webapi/proxy',\n   oauth: '/api/auth',\n \n   // agent markets"
            },
            {
                "sha": "4554b16fa4be979ed585e3cc2f6b64c5fab08223",
                "filename": "src/services/user/client.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/lobehub/lobe-chat/blob/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fservices%2Fuser%2Fclient.ts",
                "raw_url": "https://github.com/lobehub/lobe-chat/raw/e960a23b0c69a5762eb27d776d33dac443058faf/src%2Fservices%2Fuser%2Fclient.ts",
                "contents_url": "https://api.github.com/repos/lobehub/lobe-chat/contents/src%2Fservices%2Fuser%2Fclient.ts?ref=e960a23b0c69a5762eb27d776d33dac443058faf",
                "patch": "@@ -23,7 +23,7 @@ export class ClientService implements IUserService {\n \n     return {\n       avatar: user.avatar,\n-      canEnablePWAGuide: messageCount >= 2,\n+      canEnablePWAGuide: messageCount >= 4,\n       canEnableTrace: messageCount >= 4,\n       hasConversation: messageCount > 0 || sessionCount > 0,\n       isOnboard: true,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/grpc/grpc/commits/e9046b2bbebc0cb7f5dc42008f807f6c7e98e791",
        "url": "https://api.github.com/repos/grpc/grpc/commits/e9046b2bbebc0cb7f5dc42008f807f6c7e98e791",
        "html_url": "https://github.com/grpc/grpc/commit/e9046b2bbebc0cb7f5dc42008f807f6c7e98e791",
        "message": "[EventEngine] Fix bug in Tx0cp code path in posix endpoint.\n\nThis fix ensures that the iov_base pointers point to the right address.\n\nPiperOrigin-RevId: 673923651",
        "files": [
            {
                "sha": "c5708db02c57aa75506dd6df3143de2747bc61b3",
                "filename": "src/core/lib/event_engine/posix_engine/posix_endpoint.cc",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/grpc/grpc/blob/e9046b2bbebc0cb7f5dc42008f807f6c7e98e791/src%2Fcore%2Flib%2Fevent_engine%2Fposix_engine%2Fposix_endpoint.cc",
                "raw_url": "https://github.com/grpc/grpc/raw/e9046b2bbebc0cb7f5dc42008f807f6c7e98e791/src%2Fcore%2Flib%2Fevent_engine%2Fposix_engine%2Fposix_endpoint.cc",
                "contents_url": "https://api.github.com/repos/grpc/grpc/contents/src%2Fcore%2Flib%2Fevent_engine%2Fposix_engine%2Fposix_endpoint.cc?ref=e9046b2bbebc0cb7f5dc42008f807f6c7e98e791",
                "patch": "@@ -236,7 +236,7 @@ msg_iovlen_type TcpZerocopySendRecord::PopulateIovs(size_t* unwind_slice_idx,\n        iov_size++) {\n     MutableSlice& slice = internal::SliceCast<MutableSlice>(\n         buf_.MutableSliceAt(out_offset_.slice_idx));\n-    iov[iov_size].iov_base = slice.begin();\n+    iov[iov_size].iov_base = slice.begin() + out_offset_.byte_idx;\n     iov[iov_size].iov_len = slice.length() - out_offset_.byte_idx;\n     *sending_length += iov[iov_size].iov_len;\n     ++(out_offset_.slice_idx);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mozilla/node-convict/commits/fb602fbe1e9f14f2e88ecb8179d0f76466d21ecb",
        "url": "https://api.github.com/repos/mozilla/node-convict/commits/fb602fbe1e9f14f2e88ecb8179d0f76466d21ecb",
        "html_url": "https://github.com/mozilla/node-convict/commit/fb602fbe1e9f14f2e88ecb8179d0f76466d21ecb",
        "message": "fix-imperfect-prototype-pollution-fix (#411)",
        "files": [
            {
                "sha": "2474998464a56a1cbc7a28ab5719c740f447404d",
                "filename": "packages/convict/src/main.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/mozilla/node-convict/blob/fb602fbe1e9f14f2e88ecb8179d0f76466d21ecb/packages%2Fconvict%2Fsrc%2Fmain.js",
                "raw_url": "https://github.com/mozilla/node-convict/raw/fb602fbe1e9f14f2e88ecb8179d0f76466d21ecb/packages%2Fconvict%2Fsrc%2Fmain.js",
                "contents_url": "https://api.github.com/repos/mozilla/node-convict/contents/packages%2Fconvict%2Fsrc%2Fmain.js?ref=fb602fbe1e9f14f2e88ecb8179d0f76466d21ecb",
                "patch": "@@ -12,7 +12,7 @@ const cloneDeep = require('lodash.clonedeep')\n // Forbidden key paths, for protection against prototype pollution\n const FORBIDDEN_KEY_PATHS = [\n   '__proto__.',\n-  'this.constructor.prototype.',\n+  'constructor.prototype.',\n ]\n \n const ALLOWED_OPTION_STRICT = 'strict'"
            },
            {
                "sha": "f3bf11ea47d9f6b93e3bfe47c5261d334f0f56df",
                "filename": "packages/convict/test/prototype_pollution.test.js",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/mozilla/node-convict/blob/fb602fbe1e9f14f2e88ecb8179d0f76466d21ecb/packages%2Fconvict%2Ftest%2Fprototype_pollution.test.js",
                "raw_url": "https://github.com/mozilla/node-convict/raw/fb602fbe1e9f14f2e88ecb8179d0f76466d21ecb/packages%2Fconvict%2Ftest%2Fprototype_pollution.test.js",
                "contents_url": "https://api.github.com/repos/mozilla/node-convict/contents/packages%2Fconvict%2Ftest%2Fprototype_pollution.test.js?ref=fb602fbe1e9f14f2e88ecb8179d0f76466d21ecb",
                "patch": "@@ -30,10 +30,17 @@ describe('Convict prototype pollution resistance', function() {\n     expect({}).not.toHaveProperty('nested.polluted_proto_nested')\n   })\n \n-  test('against this.constructor.prototype', function() {\n+  test('against constructor.prototype', function() {\n     const obj = {}\n     const config = convict(obj)\n \n+    config.set('constructor.prototype.polluted_constructor_prototype_root', 'Polluted!')\n+    expect({}).not.toHaveProperty('polluted_constructor_prototype_root')\n+\n+    config.set('constructor.prototype.nested.polluted_constructor_prototype_nested', 'Polluted!')\n+    expect({}).not.toHaveProperty('nested')\n+    expect({}).not.toHaveProperty('nested.polluted_constructor_prototype_nested')\n+\n     config.set('this.constructor.prototype.polluted_constructor_prototype_root', 'Polluted!')\n     expect({}).not.toHaveProperty('polluted_constructor_prototype_root')\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mozilla/nunjucks/commits/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6",
        "url": "https://api.github.com/repos/mozilla/nunjucks/commits/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6",
        "html_url": "https://github.com/mozilla/nunjucks/commit/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6",
        "message": "fix: html encode backslashes if used with escape filter or autoescape (#1437)\n\nBackslashes should be html encoded when present in expressions that are\r\npassed to the escape filter (including when this happens automatically\r\nwith autoescape)",
        "files": [
            {
                "sha": "14f9299353c8d040921dc584de835f4e07b10796",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/mozilla/nunjucks/blob/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6/CHANGELOG.md",
                "raw_url": "https://github.com/mozilla/nunjucks/raw/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/mozilla/nunjucks/contents/CHANGELOG.md?ref=ec16d210e7e13f862eccdb0bc9af9f60ff6749d6",
                "patch": "@@ -1,6 +1,13 @@\n Changelog\n =========\n \n+3.2.4 (unreleased)\n+------------------\n+\n+* HTML encode backslashes when expressions are passed through the escape\n+  filter (including when this is done automatically with autoescape). Merge\n+  of [#1427](https://github.com/mozilla/nunjucks/pull/1427).\n+\n 3.2.3 (Feb 15 2021)\n -------------------\n "
            },
            {
                "sha": "e99589f7975255891c60b464061f523599e503ae",
                "filename": "nunjucks/src/lib.js",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/mozilla/nunjucks/blob/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6/nunjucks%2Fsrc%2Flib.js",
                "raw_url": "https://github.com/mozilla/nunjucks/raw/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6/nunjucks%2Fsrc%2Flib.js",
                "contents_url": "https://api.github.com/repos/mozilla/nunjucks/contents/nunjucks%2Fsrc%2Flib.js?ref=ec16d210e7e13f862eccdb0bc9af9f60ff6749d6",
                "patch": "@@ -8,10 +8,11 @@ var escapeMap = {\n   '\"': '&quot;',\n   '\\'': '&#39;',\n   '<': '&lt;',\n-  '>': '&gt;'\n+  '>': '&gt;',\n+  '\\\\': '&#92;',\n };\n \n-var escapeRegex = /[&\"'<>]/g;\n+var escapeRegex = /[&\"'<>\\\\]/g;\n \n var exports = module.exports = {};\n "
            },
            {
                "sha": "62f0aa912ca7ccd882c1437ff9550d94a519b35d",
                "filename": "tests/compiler.js",
                "status": "modified",
                "additions": 11,
                "deletions": 1,
                "changes": 12,
                "blob_url": "https://github.com/mozilla/nunjucks/blob/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6/tests%2Fcompiler.js",
                "raw_url": "https://github.com/mozilla/nunjucks/raw/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6/tests%2Fcompiler.js",
                "contents_url": "https://api.github.com/repos/mozilla/nunjucks/contents/tests%2Fcompiler.js?ref=ec16d210e7e13f862eccdb0bc9af9f60ff6749d6",
                "patch": "@@ -1976,6 +1976,16 @@\n       finish(done);\n     });\n \n+    it('should autoescape backslashes', function(done) {\n+      equal(\n+        '{{ foo }}',\n+        { foo: 'foo \\\\\\' bar' },\n+        { autoescape: true },\n+        'foo &#92;&#39; bar');\n+\n+      finish(done);\n+    });\n+\n     it('should not autoescape when extension set false', function(done) {\n       function TestExtension() {\n         // jshint validthis: true\n@@ -2031,7 +2041,7 @@\n     });\n \n     it('should render regexs', function(done) {\n-      equal('{{ r/name [0-9] \\\\// }}',\n+      equal('{{ r/name [0-9] \\\\// }}', {}, { autoescape: false },\n         '/name [0-9] \\\\//');\n \n       equal('{{ r/x/gi }}',"
            },
            {
                "sha": "554c10dd11e951d465023f1aef91d110ca2c0747",
                "filename": "tests/filters.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/mozilla/nunjucks/blob/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6/tests%2Ffilters.js",
                "raw_url": "https://github.com/mozilla/nunjucks/raw/ec16d210e7e13f862eccdb0bc9af9f60ff6749d6/tests%2Ffilters.js",
                "contents_url": "https://api.github.com/repos/mozilla/nunjucks/contents/tests%2Ffilters.js?ref=ec16d210e7e13f862eccdb0bc9af9f60ff6749d6",
                "patch": "@@ -108,9 +108,9 @@\n \n     it('escape', function() {\n       equal(\n-        '{{ \"<html>\" | escape }}', {},\n+        '{{ \"<html>\\\\\\\\\" | escape }}', {},\n         { autoescape: false },\n-        '&lt;html&gt;');\n+        '&lt;html&gt;&#92;');\n     });\n \n     it('escape skip safe', function() {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/mynewt-nimble/commits/4e3ac5b6e7c7df63a594c4ff6839e266b4ccfed9",
        "url": "https://api.github.com/repos/apache/mynewt-nimble/commits/4e3ac5b6e7c7df63a594c4ff6839e266b4ccfed9",
        "html_url": "https://github.com/apache/mynewt-nimble/commit/4e3ac5b6e7c7df63a594c4ff6839e266b4ccfed9",
        "message": "nimble/host: Add Number Complete Packets event validation\n\nValidate if HCI event received from controller has proper sizes before\npassing it to GAP event",
        "files": [
            {
                "sha": "47430423bedb2a4d3df174934843cd64b7ee1125",
                "filename": "nimble/host/src/ble_hs_hci_evt.c",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/apache/mynewt-nimble/blob/4e3ac5b6e7c7df63a594c4ff6839e266b4ccfed9/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c",
                "raw_url": "https://github.com/apache/mynewt-nimble/raw/4e3ac5b6e7c7df63a594c4ff6839e266b4ccfed9/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c",
                "contents_url": "https://api.github.com/repos/apache/mynewt-nimble/contents/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c?ref=4e3ac5b6e7c7df63a594c4ff6839e266b4ccfed9",
                "patch": "@@ -292,6 +292,10 @@ ble_hs_hci_evt_num_completed_pkts(uint8_t event_code, const void *data,\n     uint16_t num_pkts;\n     int i;\n \n+    if (len < sizeof(*ev)) {\n+        return BLE_HS_ECONTROLLER;\n+    }\n+\n     if (len != sizeof(*ev) + (ev->count * sizeof(ev->completed[0]))) {\n         return BLE_HS_ECONTROLLER;\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/mynewt-nimble/commits/23d61150ddae4bc8356356d7ef09d816fb89da45",
        "url": "https://api.github.com/repos/apache/mynewt-nimble/commits/23d61150ddae4bc8356356d7ef09d816fb89da45",
        "html_url": "https://github.com/apache/mynewt-nimble/commit/23d61150ddae4bc8356356d7ef09d816fb89da45",
        "message": "nimble/host: Add extended advertising report event validation\n\nValidate if HCI event received from controller has proper sizes before\npassing it to GAP event.",
        "files": [
            {
                "sha": "37265c016c83f08ccea9259bcd72f70dadaf0909",
                "filename": "nimble/host/src/ble_hs_hci_evt.c",
                "status": "modified",
                "additions": 45,
                "deletions": 8,
                "changes": 53,
                "blob_url": "https://github.com/apache/mynewt-nimble/blob/23d61150ddae4bc8356356d7ef09d816fb89da45/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c",
                "raw_url": "https://github.com/apache/mynewt-nimble/raw/23d61150ddae4bc8356356d7ef09d816fb89da45/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c",
                "contents_url": "https://api.github.com/repos/apache/mynewt-nimble/contents/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c?ref=23d61150ddae4bc8356356d7ef09d816fb89da45",
                "patch": "@@ -597,29 +597,66 @@ ble_hs_hci_decode_legacy_type(uint16_t evt_type)\n         return -1;\n     }\n }\n-#endif\n \n static int\n-ble_hs_hci_evt_le_ext_adv_rpt(uint8_t subevent, const void *data,\n-                              unsigned int len)\n+ble_hs_hci_evt_le_ext_adv_rpt_first_pass(const void *data, unsigned int len)\n {\n-#if MYNEWT_VAL(BLE_EXT_ADV) && NIMBLE_BLE_SCAN\n     const struct ble_hci_ev_le_subev_ext_adv_rpt *ev = data;\n     const struct ext_adv_report *report;\n-    struct ble_gap_ext_disc_desc desc;\n     int i;\n-    int legacy_event_type;\n \n     if (len < sizeof(*ev)) {\n-        return BLE_HS_EBADDATA;\n+        return BLE_HS_ECONTROLLER;\n     }\n \n+    len -= sizeof(*ev);\n+    data += sizeof(*ev);\n+\n     if (ev->num_reports < BLE_HCI_LE_ADV_RPT_NUM_RPTS_MIN ||\n         ev->num_reports > BLE_HCI_LE_ADV_RPT_NUM_RPTS_MAX) {\n         return BLE_HS_EBADDATA;\n     }\n \n-    /* TODO properly validate len of the event */\n+    for (i = 0; i < ev->num_reports; i++) {\n+        if (len < sizeof(*report)) {\n+            return BLE_HS_ECONTROLLER;\n+        }\n+\n+        report = data;\n+\n+        if (report->data_len > len) {\n+            return BLE_HS_ECONTROLLER;\n+        }\n+\n+        len -= sizeof(*report) + report->data_len;\n+        data += sizeof(*report) + report->data_len;\n+    }\n+\n+    /* Make sure length was correct */\n+    if (len) {\n+        return BLE_HS_ECONTROLLER;\n+    }\n+\n+    return 0;\n+}\n+#endif\n+\n+static int\n+ble_hs_hci_evt_le_ext_adv_rpt(uint8_t subevent, const void *data,\n+                              unsigned int len)\n+{\n+#if MYNEWT_VAL(BLE_EXT_ADV) && NIMBLE_BLE_SCAN\n+    const struct ble_hci_ev_le_subev_ext_adv_rpt *ev = data;\n+    const struct ext_adv_report *report;\n+    struct ble_gap_ext_disc_desc desc;\n+    int legacy_event_type;\n+    int rc;\n+    int i;\n+\n+    rc = ble_hs_hci_evt_le_ext_adv_rpt_first_pass(data, len);\n+    if (rc != 0) {\n+        return rc;\n+    }\n \n     report = &ev->reports[0];\n     for (i = 0; i < ev->num_reports; i++) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/mynewt-nimble/commits/3b7a32ea09a3bffaab831ee0ab193a2375fc4df6",
        "url": "https://api.github.com/repos/apache/mynewt-nimble/commits/3b7a32ea09a3bffaab831ee0ab193a2375fc4df6",
        "html_url": "https://github.com/apache/mynewt-nimble/commit/3b7a32ea09a3bffaab831ee0ab193a2375fc4df6",
        "message": "nimble/host: Fix legacy advertising report event validation\n\nIf event contained more than one report it would likely failed\nvalidation due to invalid data comparison.",
        "files": [
            {
                "sha": "181a2fb487b45be118af2bcae15d1f8fce74fd89",
                "filename": "nimble/host/src/ble_hs_hci_evt.c",
                "status": "modified",
                "additions": 3,
                "deletions": 5,
                "changes": 8,
                "blob_url": "https://github.com/apache/mynewt-nimble/blob/3b7a32ea09a3bffaab831ee0ab193a2375fc4df6/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c",
                "raw_url": "https://github.com/apache/mynewt-nimble/raw/3b7a32ea09a3bffaab831ee0ab193a2375fc4df6/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c",
                "contents_url": "https://api.github.com/repos/apache/mynewt-nimble/contents/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c?ref=3b7a32ea09a3bffaab831ee0ab193a2375fc4df6",
                "patch": "@@ -479,15 +479,13 @@ ble_hs_hci_evt_le_adv_rpt_first_pass(const void *data, unsigned int len)\n \n         rpt = data;\n \n-        len -= sizeof(*rpt) + 1;\n-        data += sizeof(rpt) + 1;\n-\n         if (rpt->data_len > len) {\n             return BLE_HS_ECONTROLLER;\n         }\n \n-        len -= rpt->data_len;\n-        data += rpt->data_len;\n+        /* extra byte for RSSI after adv data */\n+        len -= sizeof(*rpt) + 1 + rpt->data_len;\n+        data += sizeof(*rpt) + 1 + rpt->data_len;\n     }\n \n     /* Make sure length was correct */"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/mynewt-nimble/commits/f39330866a85fa4de49246e9d21334bc8d14f0a1",
        "url": "https://api.github.com/repos/apache/mynewt-nimble/commits/f39330866a85fa4de49246e9d21334bc8d14f0a1",
        "html_url": "https://github.com/apache/mynewt-nimble/commit/f39330866a85fa4de49246e9d21334bc8d14f0a1",
        "message": "nimble/host: Validate advertising instance before parsing event\n\nAdvertising instance is used for indexing slave state array. Since\ninstance is provided by host invalid handle in event means there is\nbug in controller.",
        "files": [
            {
                "sha": "3cb5f9858fb8f2e46522c0b928b9579e9ffd69fa",
                "filename": "nimble/host/src/ble_hs_hci_evt.c",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/apache/mynewt-nimble/blob/f39330866a85fa4de49246e9d21334bc8d14f0a1/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c",
                "raw_url": "https://github.com/apache/mynewt-nimble/raw/f39330866a85fa4de49246e9d21334bc8d14f0a1/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c",
                "contents_url": "https://api.github.com/repos/apache/mynewt-nimble/contents/nimble%2Fhost%2Fsrc%2Fble_hs_hci_evt.c?ref=f39330866a85fa4de49246e9d21334bc8d14f0a1",
                "patch": "@@ -879,6 +879,13 @@ ble_hs_hci_evt_le_adv_set_terminated(uint8_t subevent, const void *data,\n         return BLE_HS_ECONTROLLER;\n     }\n \n+    /* this indicates bug in controller as host uses instances from\n+     * 0-BLE_ADV_INSTANCES range only\n+     */\n+    if (ev->adv_handle >= BLE_ADV_INSTANCES) {\n+        return BLE_HS_ECONTROLLER;\n+    }\n+\n     if (ev->status == 0) {\n         /* ignore return code as we need to terminate advertising set anyway */\n         ble_gap_rx_conn_complete(&pend_conn_complete, ev->adv_handle);\n@@ -900,6 +907,13 @@ ble_hs_hci_evt_le_scan_req_rcvd(uint8_t subevent, const void *data,\n         return BLE_HS_ECONTROLLER;\n     }\n \n+    /* this indicates bug in controller as host uses instances from\n+     * 0-BLE_ADV_INSTANCES range only\n+     */\n+    if (ev->adv_handle >= BLE_ADV_INSTANCES) {\n+        return BLE_HS_ECONTROLLER;\n+    }\n+\n     ble_gap_rx_scan_req_rcvd(ev);\n #endif\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/mynewt-nimble/commits/4f75c0b3b466186beff40e8489870c6cee076aaa",
        "url": "https://api.github.com/repos/apache/mynewt-nimble/commits/4f75c0b3b466186beff40e8489870c6cee076aaa",
        "html_url": "https://github.com/apache/mynewt-nimble/commit/4f75c0b3b466186beff40e8489870c6cee076aaa",
        "message": "nimble/mesh: Add check for rx buffer in PB ADV\n\nValidate if Transaction Continuation PDU can fit into buffer before\ncopying data.",
        "files": [
            {
                "sha": "76b96ae365b55051501ecf8eca13e9487d84d221",
                "filename": "nimble/host/mesh/src/pb_adv.c",
                "status": "modified",
                "additions": 10,
                "deletions": 3,
                "changes": 13,
                "blob_url": "https://github.com/apache/mynewt-nimble/blob/4f75c0b3b466186beff40e8489870c6cee076aaa/nimble%2Fhost%2Fmesh%2Fsrc%2Fpb_adv.c",
                "raw_url": "https://github.com/apache/mynewt-nimble/raw/4f75c0b3b466186beff40e8489870c6cee076aaa/nimble%2Fhost%2Fmesh%2Fsrc%2Fpb_adv.c",
                "contents_url": "https://api.github.com/repos/apache/mynewt-nimble/contents/nimble%2Fhost%2Fmesh%2Fsrc%2Fpb_adv.c?ref=4f75c0b3b466186beff40e8489870c6cee076aaa",
                "patch": "@@ -32,6 +32,7 @@\n \n #define START_PAYLOAD_MAX 20\n #define CONT_PAYLOAD_MAX  23\n+#define RX_BUFFER_MAX     65\n \n #define START_LAST_SEG(gpc) (gpc >> 2)\n #define CONT_SEG_INDEX(gpc) (gpc >> 2)\n@@ -41,7 +42,8 @@\n #define LINK_ACK        0x01\n #define LINK_CLOSE      0x02\n \n-#define XACT_SEG_DATA(_seg) (&link.rx.buf->om_data[20 + ((_seg - 1) * 23)])\n+#define XACT_SEG_OFFSET(_seg) (20 + ((_seg - 1) * 23))\n+#define XACT_SEG_DATA(_seg) (&link.rx.buf->om_data[XACT_SEG_OFFSET(_seg)])\n #define XACT_SEG_RECV(_seg) (link.rx.seg &= ~(1 << (_seg)))\n \n #define XACT_ID_MAX  0x7f\n@@ -224,7 +226,7 @@ static void reset_adv_link(void)\n \t}\n \tlink.tx.pending_ack = XACT_ID_NVAL;\n \tif (!rx_buf) {\n-\t\trx_buf = NET_BUF_SIMPLE(65);\n+\t\trx_buf = NET_BUF_SIMPLE(RX_BUFFER_MAX);\n \t}\n \tlink.rx.buf = rx_buf;\n \tnet_buf_simple_reset(link.rx.buf);\n@@ -388,6 +390,11 @@ static void gen_prov_cont(struct prov_rx *rx, struct os_mbuf *buf)\n \t\treturn;\n \t}\n \n+\tif (XACT_SEG_OFFSET(seg) + buf->om_len > RX_BUFFER_MAX) {\n+\t\tBT_WARN(\"Rx buffer overflow. Malformed generic prov frame?\");\n+\t\treturn;\n+\t}\n+\n \tmemcpy(XACT_SEG_DATA(seg), buf->om_data, buf->om_len);\n \tXACT_SEG_RECV(seg);\n \n@@ -892,7 +899,7 @@ void pb_adv_init(void)\n \tk_work_init_delayable(&link.tx.retransmit, prov_retransmit);\n \n     if (!rx_buf) {\n-        rx_buf = NET_BUF_SIMPLE(65);\n+        rx_buf = NET_BUF_SIMPLE(RX_BUFFER_MAX);\n     }\n     link.rx.buf = rx_buf;\n     net_buf_simple_reset(link.rx.buf);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/projectsend/projectsend/commits/193367d937b1a59ed5b68dd4e60bd53317473744",
        "url": "https://api.github.com/repos/projectsend/projectsend/commits/193367d937b1a59ed5b68dd4e60bd53317473744",
        "html_url": "https://github.com/projectsend/projectsend/commit/193367d937b1a59ed5b68dd4e60bd53317473744",
        "message": "Check user session before starting to process data",
        "files": [
            {
                "sha": "53dcf196d322b2839fa82f1b8af4ba847e26cbff",
                "filename": "files-edit.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/files-edit.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/files-edit.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/files-edit.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -6,6 +6,7 @@\n \n $allowed_levels = array(9, 8, 7, 0);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $active_nav = 'files';\n "
            },
            {
                "sha": "a8884b908130f01c6d9879837938fcae7997c0eb",
                "filename": "groups-add.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/groups-add.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/groups-add.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/groups-add.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,6 +4,7 @@\n  */\n $allowed_levels = array(9, 8);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $active_nav = 'groups';\n "
            },
            {
                "sha": "a9c2f1aac88e00a899a403b2467c866f8eb8c740",
                "filename": "groups-edit.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/groups-edit.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/groups-edit.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/groups-edit.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,6 +4,7 @@\n  */\n $allowed_levels = array(9, 8);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $active_nav = 'groups';\n "
            },
            {
                "sha": "d32f3fb7daed7115537afe2526cfe9966a5279eb",
                "filename": "groups.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/groups.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/groups.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/groups.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,6 +4,7 @@\n  */\n $allowed_levels = array(9, 8);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $active_nav = 'groups';\n "
            },
            {
                "sha": "f85b66a4f1afe37b1cdd34a52c67c795622da0dc",
                "filename": "header.php",
                "status": "modified",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/header.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/header.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/header.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -8,12 +8,6 @@\n  */\n if (!defined('VIEW_TYPE')) define('VIEW_TYPE', 'private');\n \n-// Check for an active session\n-redirect_if_not_logged_in();\n-\n-// Check if the current user has permission to view this page.\n-redirect_if_role_not_allowed($allowed_levels);\n-\n global $flash;\n \n /** If no page title is defined, revert to a default one */"
            },
            {
                "sha": "dcb99f0d58081e6b46f22d3393cd1f23170307cc",
                "filename": "import-orphans.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/import-orphans.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/import-orphans.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/import-orphans.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -9,6 +9,7 @@\n  */\n $allowed_levels = array(9, 8, 7);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $active_nav = 'files';\n $this_page = 'import-orphans.php';"
            },
            {
                "sha": "fcacac94ced7badaef85392af11ef98a6c19fbdd",
                "filename": "includes/actions.log.export.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/includes%2Factions.log.export.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/includes%2Factions.log.export.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/includes%2Factions.log.export.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,8 +4,7 @@\n  */\n $allowed_levels = array(9);\n require_once '../bootstrap.php';\n-\n-redirect_if_role_not_allowed($allowed_levels);\n+log_in_required($allowed_levels);\n \n header('Content-Type: text/csv; charset=utf-8');\n header('Content-Disposition: attachment; filename=data.csv');"
            },
            {
                "sha": "7ab0374938a0b3c952b88e612b79ba8b8553f3e4",
                "filename": "includes/cron.log.export.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/includes%2Fcron.log.export.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/includes%2Fcron.log.export.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/includes%2Fcron.log.export.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,8 +4,7 @@\n  */\n $allowed_levels = array(9);\n require_once '../bootstrap.php';\n-\n-redirect_if_role_not_allowed($allowed_levels);\n+log_in_required($allowed_levels);\n \n header('Content-Type: text/csv; charset=utf-8');\n header('Content-Disposition: attachment; filename=cron-log.csv');"
            },
            {
                "sha": "a554490278fb88f40d9db3274b8ca6a98cf8cc8e",
                "filename": "includes/functions.session.permissions.php",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/includes%2Ffunctions.session.permissions.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/includes%2Ffunctions.session.permissions.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/includes%2Ffunctions.session.permissions.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,7 +4,16 @@\n  * client or user.\n  */\n \n- function extend_session()\n+function log_in_required($allowed_levels)\n+{\n+    // Check for an active session\n+    redirect_if_not_logged_in();\n+\n+    // Check if the current user has permission to view this page.\n+    redirect_if_role_not_allowed($allowed_levels);\n+}\n+\n+function extend_session()\n {\n     $_SESSION['last_call'] = time();\n }"
            },
            {
                "sha": "6316c3d9b420457e097343d9b90beb655f218c19",
                "filename": "manage-downloads.php",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/manage-downloads.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/manage-downloads.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/manage-downloads.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -6,6 +6,8 @@\n  */\n $allowed_levels = array(9, 8, 7, 0);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n+\n $active_nav = 'files';\n \n $page_title = __('Manage downloads', 'cftp_admin');"
            },
            {
                "sha": "b76264185a6af0549cb3b320a07fcf9754b3176f",
                "filename": "manage-files.php",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/manage-files.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/manage-files.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/manage-files.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -6,6 +6,8 @@\n  */\n $allowed_levels = array(9, 8, 7, 0);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n+\n $active_nav = 'files';\n \n $page_title = __('Manage files', 'cftp_admin');"
            },
            {
                "sha": "a7e05d319dd1ed7a1524e18a7b191809acfb3c8f",
                "filename": "options.php",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/options.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/options.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/options.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,6 +4,7 @@\n  */\n $allowed_levels = array(9);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $section = (!empty($_GET['section'])) ? $_GET['section'] : $_POST['section'];\n \n@@ -16,6 +17,7 @@\n             'xsendfile_enable',\n             'footer_custom_enable',\n             'files_default_expire',\n+            'files_default_public',\n             'uploads_organize_folders_by_date',\n             'files_descriptions_use_ckeditor',\n             'use_browser_lang',\n@@ -121,6 +123,7 @@\n     /** Values that can be empty */\n     $allowed_empty_values = [\n         'footer_custom_content',\n+        'custom_download_uri',\n         'mail_copy_addresses',\n         'mail_smtp_host',\n         'mail_smtp_port',"
            },
            {
                "sha": "6a52e09dbb8c4948c964d6ded8e2cb1cd262e984",
                "filename": "process.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/process.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/process.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/process.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -6,6 +6,7 @@\n /** Process an action */\n $allowed_levels = array(9, 8, 7, 0);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n global $auth;\n global $logger;"
            },
            {
                "sha": "1a512cef97f5b679980ff1e7e573782d78a5fa2e",
                "filename": "templates.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/templates.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/templates.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/templates.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,6 +4,7 @@\n  */\n $allowed_levels = array(9);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $page_title    = __(\"Templates\", 'cftp_admin');\n "
            },
            {
                "sha": "469efec1b8537589cc88a83da9ec2a4f9693787e",
                "filename": "unblock-ip.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/unblock-ip.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/unblock-ip.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/unblock-ip.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,6 +4,7 @@\n  */\n $allowed_levels = array(9);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $page_title = __('Unblock IP', 'cftp_admin');\n "
            },
            {
                "sha": "1ecd70de33ef9d5daa5712648b5763e75c320153",
                "filename": "upload.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/upload.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/upload.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/upload.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -18,6 +18,7 @@\n if (get_option('clients_can_upload') == 1) {\n     $allowed_levels[] = 0;\n }\n+log_in_required($allowed_levels);\n \n if (LOADED_LANG != 'en') {\n     $plupload_lang_file = 'vendor/moxiecode/plupload/js/i18n/' . LOADED_LANG . '.js';"
            },
            {
                "sha": "a64801a52ca4cdce9d467893132b32778876e686",
                "filename": "users-add.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/users-add.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/users-add.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/users-add.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,6 +4,7 @@\n  */\n $allowed_levels = array(9);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $active_nav = 'users';\n "
            },
            {
                "sha": "9329e1f3c3ec8d1138ba627fadb831167241e0ce",
                "filename": "users-edit.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/users-edit.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/users-edit.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/users-edit.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,6 +4,7 @@\n  */\n $allowed_levels = array(9, 8, 7);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $active_nav = 'users';\n "
            },
            {
                "sha": "59a42ae26b03523d0da775331a3dea242ed728f1",
                "filename": "users.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/projectsend/projectsend/blob/193367d937b1a59ed5b68dd4e60bd53317473744/users.php",
                "raw_url": "https://github.com/projectsend/projectsend/raw/193367d937b1a59ed5b68dd4e60bd53317473744/users.php",
                "contents_url": "https://api.github.com/repos/projectsend/projectsend/contents/users.php?ref=193367d937b1a59ed5b68dd4e60bd53317473744",
                "patch": "@@ -4,6 +4,7 @@\n  */\n $allowed_levels = array(9);\n require_once 'bootstrap.php';\n+log_in_required($allowed_levels);\n \n $active_nav = 'users';\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/tecnickcom/TCPDF/commits/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b",
        "url": "https://api.github.com/repos/tecnickcom/TCPDF/commits/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b",
        "html_url": "https://github.com/tecnickcom/TCPDF/commit/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b",
        "message": "Forbid access to parent folder in HTML images",
        "files": [
            {
                "sha": "2158b941e105152afa319081dc8dc6d9ee9fdb45",
                "filename": "CHANGELOG.TXT",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/tecnickcom/TCPDF/blob/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/CHANGELOG.TXT",
                "raw_url": "https://github.com/tecnickcom/TCPDF/raw/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/CHANGELOG.TXT",
                "contents_url": "https://api.github.com/repos/tecnickcom/TCPDF/contents/CHANGELOG.TXT?ref=bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b",
                "patch": "@@ -1,3 +1,6 @@\n+6.7.6 (2024-10-06)\n+\t- Forbid access to parent folder in HTML images.\n+\n 6.7.5 (2024-04-20)\n \t- Update GitHub actions\n \t- fix: CSV-2024-22640 (#712)"
            },
            {
                "sha": "2ed16f40d637316d6fccd08387c333863cdce2b1",
                "filename": "VERSION",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/tecnickcom/TCPDF/blob/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/VERSION",
                "raw_url": "https://github.com/tecnickcom/TCPDF/raw/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/VERSION",
                "contents_url": "https://api.github.com/repos/tecnickcom/TCPDF/contents/VERSION?ref=bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b",
                "patch": "@@ -1 +1 @@\n-6.7.5\n+6.7.6"
            },
            {
                "sha": "66724a17af7a8f5470a104ba4b71534aad2a69df",
                "filename": "composer.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/tecnickcom/TCPDF/blob/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/composer.json",
                "raw_url": "https://github.com/tecnickcom/TCPDF/raw/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/composer.json",
                "contents_url": "https://api.github.com/repos/tecnickcom/TCPDF/contents/composer.json?ref=bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b",
                "patch": "@@ -12,7 +12,7 @@\n         \"barcodes\"\n     ],\n     \"homepage\": \"http://www.tcpdf.org/\",\n-    \"version\": \"6.7.5\",\n+    \"version\": \"6.7.6\",\n     \"license\": \"LGPL-3.0-or-later\",\n     \"authors\": [\n         {"
            },
            {
                "sha": "b4f7c5f40655f486e1c3c7ecb77a5bc210d60444",
                "filename": "include/tcpdf_static.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/tecnickcom/TCPDF/blob/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/include%2Ftcpdf_static.php",
                "raw_url": "https://github.com/tecnickcom/TCPDF/raw/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/include%2Ftcpdf_static.php",
                "contents_url": "https://api.github.com/repos/tecnickcom/TCPDF/contents/include%2Ftcpdf_static.php?ref=bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b",
                "patch": "@@ -55,7 +55,7 @@ class TCPDF_STATIC {\n \t * Current TCPDF version.\n \t * @private static\n \t */\n-\tprivate static $tcpdf_version = '6.7.5';\n+\tprivate static $tcpdf_version = '6.7.6';\n \n \t/**\n \t * String alias for total number of pages."
            },
            {
                "sha": "c4b66932df787ef5c3f3d857e3dc132502e0f8d2",
                "filename": "tcpdf.php",
                "status": "modified",
                "additions": 28,
                "deletions": 25,
                "changes": 53,
                "blob_url": "https://github.com/tecnickcom/TCPDF/blob/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/tcpdf.php",
                "raw_url": "https://github.com/tecnickcom/TCPDF/raw/bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b/tcpdf.php",
                "contents_url": "https://api.github.com/repos/tecnickcom/TCPDF/contents/tcpdf.php?ref=bfa7d2b6d455ebf72ebe3d48fbd487ee5a1f6f3b",
                "patch": "@@ -1,9 +1,9 @@\n <?php\n //============================================================+\n // File name   : tcpdf.php\n-// Version     : 6.7.5\n+// Version     : 6.7.6\n // Begin       : 2002-08-03\n-// Last Update : 2024-03-18\n+// Last Update : 2024-10-06\n // Author      : Nicola Asuni - Tecnick.com LTD - www.tecnick.com - info@tecnick.com\n // License     : GNU-LGPL v3 (http://www.gnu.org/copyleft/lesser.html)\n // -------------------------------------------------------------------\n@@ -128,7 +128,7 @@\n  * TCPDF project (http://www.tcpdf.org) has been originally derived in 2002 from the Public Domain FPDF class by Olivier Plathey (http://www.fpdf.org), but now is almost entirely rewritten.<br>\n  * @package com.tecnick.tcpdf\n  * @brief PHP class for generating PDF documents without requiring external extensions.\n- * @version 6.7.5\n+ * @version 6.7.6\n  * @author Nicola Asuni - info@tecnick.com\n  * @IgnoreAnnotation(\"protected\")\n  * @IgnoreAnnotation(\"public\")\n@@ -19010,29 +19010,29 @@ protected function openHTMLTagHandler($dom, $key, $cell) {\n \t\t\t\t$this->setLineWidth($hrHeight);\n \n \t\t\t\t$lineStyle = array();\n-                    \t\tif (isset($tag['fgcolor'])) {\n-\t\t                        $lineStyle['color'] = $tag['fgcolor'];\n-                    \t\t}\n+\t\t\t\tif (isset($tag['fgcolor'])) {\n+\t\t\t\t\t$lineStyle['color'] = $tag['fgcolor'];\n+\t\t\t\t}\n \n-                    \t\tif (isset($tag['fgcolor'])) {\n-                        \t\t$lineStyle['color'] = $tag['fgcolor'];\n-                    \t\t}\n+\t\t\t\tif (isset($tag['fgcolor'])) {\n+\t\t\t\t\t$lineStyle['color'] = $tag['fgcolor'];\n+\t\t\t\t}\n \n-                    \t\tif (isset($tag['style']['cap'])) {\n-                        \t\t$lineStyle['cap'] = $tag['style']['cap'];\n-                    \t\t}\n+\t\t\t\tif (isset($tag['style']['cap'])) {\n+\t\t\t\t\t$lineStyle['cap'] = $tag['style']['cap'];\n+\t\t\t\t}\n \n-                    \t\tif (isset($tag['style']['join'])) {\n-                        \t\t$lineStyle['join'] = $tag['style']['join'];\n-                    \t\t}\n+\t\t\t\tif (isset($tag['style']['join'])) {\n+\t\t\t\t\t$lineStyle['join'] = $tag['style']['join'];\n+\t\t\t\t}\n \n-                    \t\tif (isset($tag['style']['dash'])) {\n-                        \t\t$lineStyle['dash'] = $tag['style']['dash'];\n-                    \t\t}\n+\t\t\t\tif (isset($tag['style']['dash'])) {\n+\t\t\t\t\t$lineStyle['dash'] = $tag['style']['dash'];\n+\t\t\t\t}\n \n-                    \t\tif (isset($tag['style']['phase'])) {\n-                        \t\t$lineStyle['phase'] = $tag['style']['phase'];\n-                    \t\t}\n+\t\t\t\tif (isset($tag['style']['phase'])) {\n+\t\t\t\t\t$lineStyle['phase'] = $tag['style']['phase'];\n+\t\t\t\t}\n \n \t\t\t\t$lineStyle = array_filter($lineStyle);\n \n@@ -19059,11 +19059,14 @@ protected function openHTMLTagHandler($dom, $key, $cell) {\n \t\t\t\t} else if (preg_match('@^data:image/([^;]*);base64,(.*)@', $imgsrc, $reg)) {\n \t\t\t\t\t$imgsrc = '@'.base64_decode($reg[2]);\n \t\t\t\t\t$type = $reg[1];\n+\t\t\t\t} elseif (str_contains($imgsrc, '../')) {\n+\t\t\t\t\t// accessing parent folders is not allowed\n+\t\t\t\t\tbreak;\n \t\t\t\t} elseif ( $this->allowLocalFiles && substr($imgsrc, 0, 7) === 'file://') {\n-                    // get image type from a local file path\n-                    $imgsrc = substr($imgsrc, 7);\n-                    $type = TCPDF_IMAGES::getImageFileType($imgsrc);\n-                } else {\n+\t\t\t\t\t// get image type from a local file path\n+\t\t\t\t\t$imgsrc = substr($imgsrc, 7);\n+\t\t\t\t\t$type = TCPDF_IMAGES::getImageFileType($imgsrc);\n+\t\t\t\t} else {\n \t\t\t\t\tif (($imgsrc[0] === '/') AND !empty($_SERVER['DOCUMENT_ROOT']) AND ($_SERVER['DOCUMENT_ROOT'] != '/')) {\n \t\t\t\t\t\t// fix image path\n \t\t\t\t\t\t$findroot = strpos($imgsrc, $_SERVER['DOCUMENT_ROOT']);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/autolab/Autolab/commits/1aa4c7690892fb458d2c61ff86739f368e34769d",
        "url": "https://api.github.com/repos/autolab/Autolab/commits/1aa4c7690892fb458d2c61ff86739f368e34769d",
        "html_url": "https://github.com/autolab/Autolab/commit/1aa4c7690892fb458d2c61ff86739f368e34769d",
        "message": "Merge commit from fork",
        "files": [
            {
                "sha": "e0bc0573991236b9b2adc4c35fb5e2e9bb1419cd",
                "filename": "app/controllers/users_controller.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/autolab/Autolab/blob/1aa4c7690892fb458d2c61ff86739f368e34769d/app%2Fcontrollers%2Fusers_controller.rb",
                "raw_url": "https://github.com/autolab/Autolab/raw/1aa4c7690892fb458d2c61ff86739f368e34769d/app%2Fcontrollers%2Fusers_controller.rb",
                "contents_url": "https://api.github.com/repos/autolab/Autolab/contents/app%2Fcontrollers%2Fusers_controller.rb?ref=1aa4c7690892fb458d2c61ff86739f368e34769d",
                "patch": "@@ -165,6 +165,11 @@ def edit\n   action_auth_level :download_all_submissions, :student\n   def download_all_submissions\n     user = User.find(params[:id])\n+    # user can only download their own submissions\n+    if user != current_user\n+      flash[:error] = \"Permission denied: You are not allowed to download submissions of this user.\"\n+      redirect_to(user_path(current_user)) && return\n+    end\n     submissions = if params[:final]\n                     Submission.latest.where(course_user_datum: CourseUserDatum.where(user_id: user))\n                   else"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/sveltejs/kit/commits/d338d4635a7fd947ba5112df6ee632c4a0979438",
        "url": "https://api.github.com/repos/sveltejs/kit/commits/d338d4635a7fd947ba5112df6ee632c4a0979438",
        "html_url": "https://github.com/sveltejs/kit/commit/d338d4635a7fd947ba5112df6ee632c4a0979438",
        "message": "fix: escape values included in dev 404 page (#13039)",
        "files": [
            {
                "sha": "b4df5751e4f97e76e65db4b4bf610c7d0922db4a",
                "filename": ".changeset/five-maps-yawn.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/sveltejs/kit/blob/d338d4635a7fd947ba5112df6ee632c4a0979438/.changeset%2Ffive-maps-yawn.md",
                "raw_url": "https://github.com/sveltejs/kit/raw/d338d4635a7fd947ba5112df6ee632c4a0979438/.changeset%2Ffive-maps-yawn.md",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/.changeset%2Ffive-maps-yawn.md?ref=d338d4635a7fd947ba5112df6ee632c4a0979438",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@sveltejs/kit': patch\n+---\n+\n+fix: escape values included in dev 404 page"
            },
            {
                "sha": "107448c338ff6905273cfcc924de5a6982be8ca5",
                "filename": "packages/kit/src/core/postbuild/prerender.js",
                "status": "modified",
                "additions": 5,
                "deletions": 4,
                "changes": 9,
                "blob_url": "https://github.com/sveltejs/kit/blob/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Fcore%2Fpostbuild%2Fprerender.js",
                "raw_url": "https://github.com/sveltejs/kit/raw/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Fcore%2Fpostbuild%2Fprerender.js",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/packages%2Fkit%2Fsrc%2Fcore%2Fpostbuild%2Fprerender.js?ref=d338d4635a7fd947ba5112df6ee632c4a0979438",
                "patch": "@@ -4,7 +4,7 @@ import { pathToFileURL } from 'node:url';\n import { installPolyfills } from '../../exports/node/polyfills.js';\n import { mkdirp, posixify, walk } from '../../utils/filesystem.js';\n import { decode_uri, is_root_relative, resolve } from '../../utils/url.js';\n-import { escape_html_attr } from '../../utils/escape.js';\n+import { escape_html } from '../../utils/escape.js';\n import { logger } from '../utils.js';\n import { load_config } from '../config/index.js';\n import { get_route_segments } from '../../utils/routing.js';\n@@ -359,9 +359,10 @@ async function prerender({ out, manifest_path, metadata, verbose, env }) {\n \t\t\t\t\t\tdest,\n \t\t\t\t\t\t`<script>location.href=${devalue.uneval(\n \t\t\t\t\t\t\tlocation\n-\t\t\t\t\t\t)};</script><meta http-equiv=\"refresh\" content=${escape_html_attr(\n-\t\t\t\t\t\t\t`0;url=${location}`\n-\t\t\t\t\t\t)}>`\n+\t\t\t\t\t\t)};</script><meta http-equiv=\"refresh\" content=\"${escape_html(\n+\t\t\t\t\t\t\t`0;url=${location}`,\n+\t\t\t\t\t\t\ttrue\n+\t\t\t\t\t\t)}\">`\n \t\t\t\t\t);\n \n \t\t\t\t\twritten.add(file);"
            },
            {
                "sha": "a4ff95178803c8554096e990f6d6e2ceadd62ddb",
                "filename": "packages/kit/src/exports/vite/utils.js",
                "status": "modified",
                "additions": 9,
                "deletions": 2,
                "changes": 11,
                "blob_url": "https://github.com/sveltejs/kit/blob/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Fexports%2Fvite%2Futils.js",
                "raw_url": "https://github.com/sveltejs/kit/raw/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Fexports%2Fvite%2Futils.js",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/packages%2Fkit%2Fsrc%2Fexports%2Fvite%2Futils.js?ref=d338d4635a7fd947ba5112df6ee632c4a0979438",
                "patch": "@@ -3,6 +3,7 @@ import { loadEnv } from 'vite';\n import { posixify } from '../../utils/filesystem.js';\n import { negotiate } from '../../utils/http.js';\n import { filter_private_env, filter_public_env } from '../../utils/env.js';\n+import { escape_html } from '../../utils/escape.js';\n \n /**\n  * Transforms kit.alias to a valid vite.resolve.alias array.\n@@ -89,11 +90,17 @@ export function not_found(req, res, base) {\n \tif (type === 'text/html') {\n \t\tres.setHeader('Content-Type', 'text/html');\n \t\tres.end(\n-\t\t\t`The server is configured with a public base URL of ${base} - did you mean to visit <a href=\"${prefixed}\">${prefixed}</a> instead?`\n+\t\t\t`The server is configured with a public base URL of ${escape_html(\n+\t\t\t\tbase\n+\t\t\t)} - did you mean to visit <a href=\"${escape_html(prefixed, true)}\">${escape_html(\n+\t\t\t\tprefixed\n+\t\t\t)}</a> instead?`\n \t\t);\n \t} else {\n \t\tres.end(\n-\t\t\t`The server is configured with a public base URL of ${base} - did you mean to visit ${prefixed} instead?`\n+\t\t\t`The server is configured with a public base URL of ${escape_html(\n+\t\t\t\tbase\n+\t\t\t)} - did you mean to visit ${escape_html(prefixed)} instead?`\n \t\t);\n \t}\n }"
            },
            {
                "sha": "7596385ba8a5db50a2788b05e769632d8730b0c3",
                "filename": "packages/kit/src/runtime/server/page/csp.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/sveltejs/kit/blob/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Fruntime%2Fserver%2Fpage%2Fcsp.js",
                "raw_url": "https://github.com/sveltejs/kit/raw/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Fruntime%2Fserver%2Fpage%2Fcsp.js",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/packages%2Fkit%2Fsrc%2Fruntime%2Fserver%2Fpage%2Fcsp.js?ref=d338d4635a7fd947ba5112df6ee632c4a0979438",
                "patch": "@@ -1,4 +1,4 @@\n-import { escape_html_attr } from '../../../utils/escape.js';\n+import { escape_html } from '../../../utils/escape.js';\n import { base64, sha256 } from './crypto.js';\n \n const array = new Uint8Array(16);\n@@ -300,7 +300,7 @@ class CspProvider extends BaseProvider {\n \t\t\treturn;\n \t\t}\n \n-\t\treturn `<meta http-equiv=\"content-security-policy\" content=${escape_html_attr(content)}>`;\n+\t\treturn `<meta http-equiv=\"content-security-policy\" content=\"${escape_html(content, true)}\">`;\n \t}\n }\n "
            },
            {
                "sha": "7c2e552d4fe0f3a5942ca72568bc540940475047",
                "filename": "packages/kit/src/runtime/server/page/serialize_data.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/sveltejs/kit/blob/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Fruntime%2Fserver%2Fpage%2Fserialize_data.js",
                "raw_url": "https://github.com/sveltejs/kit/raw/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Fruntime%2Fserver%2Fpage%2Fserialize_data.js",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/packages%2Fkit%2Fsrc%2Fruntime%2Fserver%2Fpage%2Fserialize_data.js?ref=d338d4635a7fd947ba5112df6ee632c4a0979438",
                "patch": "@@ -1,4 +1,4 @@\n-import { escape_html_attr } from '../../../utils/escape.js';\n+import { escape_html } from '../../../utils/escape.js';\n import { hash } from '../../hash.js';\n \n /**\n@@ -70,7 +70,7 @@ export function serialize_data(fetched, filter, prerendering = false) {\n \tconst attrs = [\n \t\t'type=\"application/json\"',\n \t\t'data-sveltekit-fetched',\n-\t\t`data-url=${escape_html_attr(fetched.url)}`\n+\t\t`data-url=\"${escape_html(fetched.url, true)}\"`\n \t];\n \n \tif (fetched.is_b64) {"
            },
            {
                "sha": "a73fd951daf85f7b4ea5a87546047044ce8080ae",
                "filename": "packages/kit/src/utils/escape.js",
                "status": "modified",
                "additions": 36,
                "deletions": 20,
                "changes": 56,
                "blob_url": "https://github.com/sveltejs/kit/blob/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Futils%2Fescape.js",
                "raw_url": "https://github.com/sveltejs/kit/raw/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Futils%2Fescape.js",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/packages%2Fkit%2Fsrc%2Futils%2Fescape.js?ref=d338d4635a7fd947ba5112df6ee632c4a0979438",
                "patch": "@@ -6,41 +6,57 @@\n const escape_html_attr_dict = {\n \t'&': '&amp;',\n \t'\"': '&quot;'\n+\t// Svelte also escapes < because the escape function could be called inside a `noscript` there\n+\t// https://github.com/sveltejs/svelte/security/advisories/GHSA-8266-84wp-wv5c\n+\t// However, that doesn't apply in SvelteKit\n };\n \n+/**\n+ * @type {Record<string, string>}\n+ */\n+const escape_html_dict = {\n+\t'&': '&amp;',\n+\t'<': '&lt;'\n+};\n+\n+const surrogates = // high surrogate without paired low surrogate\n+\t'[\\\\ud800-\\\\udbff](?![\\\\udc00-\\\\udfff])|' +\n+\t// a valid surrogate pair, the only match with 2 code units\n+\t// we match it so that we can match unpaired low surrogates in the same pass\n+\t// TODO: use lookbehind assertions once they are widely supported: (?<![\\ud800-udbff])[\\udc00-\\udfff]\n+\t'[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]|' +\n+\t// unpaired low surrogate (see previous match)\n+\t'[\\\\udc00-\\\\udfff]';\n+\n const escape_html_attr_regex = new RegExp(\n-\t// special characters\n-\t`[${Object.keys(escape_html_attr_dict).join('')}]|` +\n-\t\t// high surrogate without paired low surrogate\n-\t\t'[\\\\ud800-\\\\udbff](?![\\\\udc00-\\\\udfff])|' +\n-\t\t// a valid surrogate pair, the only match with 2 code units\n-\t\t// we match it so that we can match unpaired low surrogates in the same pass\n-\t\t// TODO: use lookbehind assertions once they are widely supported: (?<![\\ud800-udbff])[\\udc00-\\udfff]\n-\t\t'[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]|' +\n-\t\t// unpaired low surrogate (see previous match)\n-\t\t'[\\\\udc00-\\\\udfff]',\n+\t`[${Object.keys(escape_html_attr_dict).join('')}]|` + surrogates,\n+\t'g'\n+);\n+\n+const escape_html_regex = new RegExp(\n+\t`[${Object.keys(escape_html_dict).join('')}]|` + surrogates,\n \t'g'\n );\n \n /**\n- * Formats a string to be used as an attribute's value in raw HTML.\n- *\n- * It escapes unpaired surrogates (which are allowed in js strings but invalid in HTML), escapes\n- * characters that are special in attributes, and surrounds the whole string in double-quotes.\n+ * Escapes unpaired surrogates (which are allowed in js strings but invalid in HTML) and\n+ * escapes characters that are special.\n  *\n  * @param {string} str\n- * @returns {string} Escaped string surrounded by double-quotes.\n- * @example const html = `<tag data-value=${escape_html_attr('value')}>...</tag>`;\n+ * @param {boolean} [is_attr]\n+ * @returns {string} escaped string\n+ * @example const html = `<tag data-value=\"${escape_html('value', true)}\">...</tag>`;\n  */\n-export function escape_html_attr(str) {\n-\tconst escaped_str = str.replace(escape_html_attr_regex, (match) => {\n+export function escape_html(str, is_attr) {\n+\tconst dict = is_attr ? escape_html_attr_dict : escape_html_dict;\n+\tconst escaped_str = str.replace(is_attr ? escape_html_attr_regex : escape_html_regex, (match) => {\n \t\tif (match.length === 2) {\n \t\t\t// valid surrogate pair\n \t\t\treturn match;\n \t\t}\n \n-\t\treturn escape_html_attr_dict[match] ?? `&#${match.charCodeAt(0)};`;\n+\t\treturn dict[match] ?? `&#${match.charCodeAt(0)};`;\n \t});\n \n-\treturn `\"${escaped_str}\"`;\n+\treturn escaped_str;\n }"
            },
            {
                "sha": "3c4e6a042a863dea36c34bb98c70f004ee8f5dd3",
                "filename": "packages/kit/src/utils/escape.spec.js",
                "status": "modified",
                "additions": 10,
                "deletions": 10,
                "changes": 20,
                "blob_url": "https://github.com/sveltejs/kit/blob/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Futils%2Fescape.spec.js",
                "raw_url": "https://github.com/sveltejs/kit/raw/d338d4635a7fd947ba5112df6ee632c4a0979438/packages%2Fkit%2Fsrc%2Futils%2Fescape.spec.js",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/packages%2Fkit%2Fsrc%2Futils%2Fescape.spec.js?ref=d338d4635a7fd947ba5112df6ee632c4a0979438",
                "patch": "@@ -1,19 +1,19 @@\n import { assert, test } from 'vitest';\n-import { escape_html_attr } from './escape.js';\n+import { escape_html } from './escape.js';\n \n test('escape_html_attr escapes special attribute characters', () => {\n \tassert.equal(\n-\t\tescape_html_attr('some \"values\" are &special here, <others> aren\\'t.'),\n-\t\t'\"some &quot;values&quot; are &amp;special here, <others> aren\\'t.\"'\n+\t\tescape_html('some \"values\" are &special here, <others> aren\\'t.', true),\n+\t\t\"some &quot;values&quot; are &amp;special here, <others> aren't.\"\n \t);\n });\n \n test('escape_html_attr escapes invalid surrogates', () => {\n-\tassert.equal(escape_html_attr('\\ud800\\udc00'), '\"\\ud800\\udc00\"');\n-\tassert.equal(escape_html_attr('\\ud800'), '\"&#55296;\"');\n-\tassert.equal(escape_html_attr('\\udc00'), '\"&#56320;\"');\n-\tassert.equal(escape_html_attr('\\udc00\\ud800'), '\"&#56320;&#55296;\"');\n-\tassert.equal(escape_html_attr('\\ud800\\ud800\\udc00'), '\"&#55296;\\ud800\\udc00\"');\n-\tassert.equal(escape_html_attr('\\ud800\\udc00\\udc00'), '\"\\ud800\\udc00&#56320;\"');\n-\tassert.equal(escape_html_attr('\\ud800\\ud800\\udc00\\udc00'), '\"&#55296;\\ud800\\udc00&#56320;\"');\n+\tassert.equal(escape_html('\\ud800\\udc00', true), '\\ud800\\udc00');\n+\tassert.equal(escape_html('\\ud800', true), '&#55296;');\n+\tassert.equal(escape_html('\\udc00', true), '&#56320;');\n+\tassert.equal(escape_html('\\udc00\\ud800', true), '&#56320;&#55296;');\n+\tassert.equal(escape_html('\\ud800\\ud800\\udc00', true), '&#55296;\\ud800\\udc00');\n+\tassert.equal(escape_html('\\ud800\\udc00\\udc00', true), '\\ud800\\udc00&#56320;');\n+\tassert.equal(escape_html('\\ud800\\ud800\\udc00\\udc00', true), '&#55296;\\ud800\\udc00&#56320;');\n });"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/sveltejs/kit/commits/134e36343ef57ed7e6e2b3bb9e7f05ad37865794",
        "url": "https://api.github.com/repos/sveltejs/kit/commits/134e36343ef57ed7e6e2b3bb9e7f05ad37865794",
        "html_url": "https://github.com/sveltejs/kit/commit/134e36343ef57ed7e6e2b3bb9e7f05ad37865794",
        "message": "fix: ensure error messages are escaped (#13050)",
        "files": [
            {
                "sha": "f20bd74d6924d512e03988d7780f14aa7a922af9",
                "filename": ".changeset/fast-swans-perform.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/sveltejs/kit/blob/134e36343ef57ed7e6e2b3bb9e7f05ad37865794/.changeset%2Ffast-swans-perform.md",
                "raw_url": "https://github.com/sveltejs/kit/raw/134e36343ef57ed7e6e2b3bb9e7f05ad37865794/.changeset%2Ffast-swans-perform.md",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/.changeset%2Ffast-swans-perform.md?ref=134e36343ef57ed7e6e2b3bb9e7f05ad37865794",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@sveltejs/kit': patch\n+---\n+\n+fix: ensure error messages are escaped"
            },
            {
                "sha": "23c0fae2eeb0b5902fad148b6ee64f06b4cae09e",
                "filename": "packages/kit/src/exports/vite/dev/index.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/sveltejs/kit/blob/134e36343ef57ed7e6e2b3bb9e7f05ad37865794/packages%2Fkit%2Fsrc%2Fexports%2Fvite%2Fdev%2Findex.js",
                "raw_url": "https://github.com/sveltejs/kit/raw/134e36343ef57ed7e6e2b3bb9e7f05ad37865794/packages%2Fkit%2Fsrc%2Fexports%2Fvite%2Fdev%2Findex.js",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/packages%2Fkit%2Fsrc%2Fexports%2Fvite%2Fdev%2Findex.js?ref=134e36343ef57ed7e6e2b3bb9e7f05ad37865794",
                "patch": "@@ -18,6 +18,7 @@ import { compact } from '../../../utils/array.js';\n import { not_found } from '../utils.js';\n import { SCHEME } from '../../../utils/url.js';\n import { check_feature } from '../../../utils/features.js';\n+import { escape_html } from '../../../utils/escape.js';\n \n const cwd = process.cwd();\n \n@@ -508,7 +509,7 @@ export async function dev(vite, vite_config, svelte_config) {\n \t\t\t\t\tconst error_template = ({ status, message }) => {\n \t\t\t\t\t\treturn error_page\n \t\t\t\t\t\t\t.replace(/%sveltekit\\.status%/g, String(status))\n-\t\t\t\t\t\t\t.replace(/%sveltekit\\.error\\.message%/g, message);\n+\t\t\t\t\t\t\t.replace(/%sveltekit\\.error\\.message%/g, escape_html(message));\n \t\t\t\t\t};\n \n \t\t\t\t\tres.writeHead(500, {"
            },
            {
                "sha": "473804cf91831e87c9f21eb55689ec7e14da36f8",
                "filename": "packages/kit/src/runtime/server/utils.js",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/sveltejs/kit/blob/134e36343ef57ed7e6e2b3bb9e7f05ad37865794/packages%2Fkit%2Fsrc%2Fruntime%2Fserver%2Futils.js",
                "raw_url": "https://github.com/sveltejs/kit/raw/134e36343ef57ed7e6e2b3bb9e7f05ad37865794/packages%2Fkit%2Fsrc%2Fruntime%2Fserver%2Futils.js",
                "contents_url": "https://api.github.com/repos/sveltejs/kit/contents/packages%2Fkit%2Fsrc%2Fruntime%2Fserver%2Futils.js?ref=134e36343ef57ed7e6e2b3bb9e7f05ad37865794",
                "patch": "@@ -5,6 +5,7 @@ import { negotiate } from '../../utils/http.js';\n import { HttpError } from '../control.js';\n import { fix_stack_trace } from '../shared-server.js';\n import { ENDPOINT_METHODS } from '../../constants.js';\n+import { escape_html } from '../../utils/escape.js';\n \n /** @param {any} body */\n export function is_pojo(body) {\n@@ -50,7 +51,7 @@ export function allowed_methods(mod) {\n  * @param {string} message\n  */\n export function static_error_page(options, status, message) {\n-\tlet page = options.templates.error({ status, message });\n+\tlet page = options.templates.error({ status, message: escape_html(message) });\n \n \tif (DEV) {\n \t\t// inject Vite HMR client, for easier debugging"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/BoidCMS/BoidCMS/commits/42f4d703a87f5199bbd701b3495a26c91b9cfab7",
        "url": "https://api.github.com/repos/BoidCMS/BoidCMS/commits/42f4d703a87f5199bbd701b3495a26c91b9cfab7",
        "html_url": "https://github.com/BoidCMS/BoidCMS/commit/42f4d703a87f5199bbd701b3495a26c91b9cfab7",
        "message": "Merge commit from fork\n\n* 2.1.2\n\n* 2.1.2",
        "files": [
            {
                "sha": "6102ad2e6938e3e121be779defb203c094bba52e",
                "filename": "app/app.php",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/BoidCMS/BoidCMS/blob/42f4d703a87f5199bbd701b3495a26c91b9cfab7/app%2Fapp.php",
                "raw_url": "https://github.com/BoidCMS/BoidCMS/raw/42f4d703a87f5199bbd701b3495a26c91b9cfab7/app%2Fapp.php",
                "contents_url": "https://api.github.com/repos/BoidCMS/BoidCMS/contents/app%2Fapp.php?ref=42f4d703a87f5199bbd701b3495a26c91b9cfab7",
                "patch": "@@ -9,7 +9,7 @@\n  * @package BoidCMS\n  * @author Shuaib Yusuf Shuaib\n  * @link https://boidcms.github.io\n- * @version 2.1.1\n+ * @version 2.1.2\n  * @licence MIT\n  */\n #[AllowDynamicProperties]\n@@ -83,7 +83,7 @@ public function __construct( string $root ) {\n       file_put_contents( $this->root( 'data/database.json' ), $json, LOCK_EX );\n     }\n     $this->actions = array();\n-    $this->version = '2.1.1';\n+    $this->version = '2.1.2';\n     $this->logged_in = ( isset( $_SESSION[ 'logged_in' ], $_SESSION[ 'root' ] ) && $this->root === $_SESSION[ 'root' ] );\n     $this->database = json_decode( file_get_contents( $this->root( 'data/database.json' ) ), true );\n     $this->plugins = array_map( 'basename', glob( $this->root( 'plugins/*' ), GLOB_ONLYDIR ) );\n@@ -840,10 +840,10 @@ public function admin(): void {\n             foreach ( $pages as $page ) {\n               if ( $this->delete_page( $page ) ) {\n                 $this->get_action( 'delete_success', $page );\n-                $this->alert( sprintf( 'Page <b>%s</b> has been deleted successfully.', $page ), 'success' );\n+                $this->alert( sprintf( 'Page <b>%s</b> has been deleted successfully.', $this->esc( $page ) ), 'success' );\n               } else {\n                 $this->get_action( 'delete_error', $page );\n-                $this->alert( sprintf( 'Page <b>%s</b> was not deleted, please try again.', $page ), 'error' );\n+                $this->alert( sprintf( 'Page <b>%s</b> was not deleted, please try again.', $this->esc( $page ) ), 'error' );\n               }\n             }\n             $this->go( $this->admin_url( '?page=delete' ) );\n@@ -989,10 +989,10 @@ public function admin(): void {\n             $this->get_action( 'on_media' );\n             $file = ( $_GET[ 'file' ] ?? '' );\n             if ( $this->delete_media( $file ) ) {\n-              $this->alert( sprintf( 'File <b>%s</b> has been deleted successfully.', $file ), 'success' );\n+              $this->alert( sprintf( 'File <b>%s</b> has been deleted successfully.', $this->esc( $file ) ), 'success' );\n               $this->go( $this->admin_url( '?page=media' ) );\n             }\n-            $this->alert( sprintf( 'File <b>%s</b> was not deleted, please try again.', $file ), 'error' );\n+            $this->alert( sprintf( 'File <b>%s</b> was not deleted, please try again.', $this->esc( $file ) ), 'error' );\n             $this->go( $this->admin_url( '?page=media' ) );\n           } else if ( isset( $_POST[ 'upload' ] ) ) {\n             $this->auth();"
            },
            {
                "sha": "f4002089eaebce9f51b4fe137db21652e2737267",
                "filename": "index.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/BoidCMS/BoidCMS/blob/42f4d703a87f5199bbd701b3495a26c91b9cfab7/index.php",
                "raw_url": "https://github.com/BoidCMS/BoidCMS/raw/42f4d703a87f5199bbd701b3495a26c91b9cfab7/index.php",
                "contents_url": "https://api.github.com/repos/BoidCMS/BoidCMS/contents/index.php?ref=42f4d703a87f5199bbd701b3495a26c91b9cfab7",
                "patch": "@@ -9,7 +9,7 @@\n  * @package BoidCMS\n  * @author Shuaib Yusuf Shuaib\n  * @link https://boidcms.github.io\n- * @version 2.1.1\n+ * @version 2.1.2\n  * @licence MIT\n  */\n session_start();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ngtcp2/ngtcp2/commits/e550c1a414318d0f3f01fca1a621ae0b0428ca15",
        "url": "https://api.github.com/repos/ngtcp2/ngtcp2/commits/e550c1a414318d0f3f01fca1a621ae0b0428ca15",
        "html_url": "https://github.com/ngtcp2/ngtcp2/commit/e550c1a414318d0f3f01fca1a621ae0b0428ca15",
        "message": "Merge pull request #1390 from ngtcp2/ack-per-pkt\n\nLimit the number of ACK frames per packet",
        "files": [
            {
                "sha": "1053a2ced8aca2087bcba382baf3bf635781f7ee",
                "filename": "lib/ngtcp2_conn.c",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/ngtcp2/ngtcp2/blob/e550c1a414318d0f3f01fca1a621ae0b0428ca15/lib%2Fngtcp2_conn.c",
                "raw_url": "https://github.com/ngtcp2/ngtcp2/raw/e550c1a414318d0f3f01fca1a621ae0b0428ca15/lib%2Fngtcp2_conn.c",
                "contents_url": "https://api.github.com/repos/ngtcp2/ngtcp2/contents/lib%2Fngtcp2_conn.c?ref=e550c1a414318d0f3f01fca1a621ae0b0428ca15",
                "patch": "@@ -51,6 +51,10 @@\n /* NGTCP2_MIN_COALESCED_PAYLOADLEN is the minimum length of QUIC\n    packet payload that should be coalesced to a long packet. */\n #define NGTCP2_MIN_COALESCED_PAYLOADLEN 128\n+/* NGTCP2_MAX_ACK_PER_PKT is the maximum number of ACK frame per an\n+   incoming QUIC packet to process.  ACK frames that exceed this limit\n+   are not processed. */\n+#define NGTCP2_MAX_ACK_PER_PKT 1\n \n ngtcp2_objalloc_def(strm, ngtcp2_strm, oplent)\n \n@@ -6109,6 +6113,7 @@ conn_recv_handshake_pkt(ngtcp2_conn *conn, const ngtcp2_path *path,\n   ngtcp2_strm *crypto;\n   ngtcp2_encryption_level encryption_level;\n   int invalid_reserved_bits = 0;\n+  size_t num_ack_processed = 0;\n \n   if (pktlen == 0) {\n     return 0;\n@@ -6561,13 +6566,17 @@ conn_recv_handshake_pkt(ngtcp2_conn *conn, const ngtcp2_path *path,\n     switch (fr->type) {\n     case NGTCP2_FRAME_ACK:\n     case NGTCP2_FRAME_ACK_ECN:\n+      if (num_ack_processed >= NGTCP2_MAX_ACK_PER_PKT) {\n+        break;\n+      }\n       if (!conn->server && hd.type == NGTCP2_PKT_HANDSHAKE) {\n         conn->flags |= NGTCP2_CONN_FLAG_SERVER_ADDR_VERIFIED;\n       }\n       rv = conn_recv_ack(conn, pktns, &fr->ack, pkt_ts, ts);\n       if (rv != 0) {\n         return rv;\n       }\n+      ++num_ack_processed;\n       break;\n     case NGTCP2_FRAME_PADDING:\n       break;\n@@ -8676,6 +8685,7 @@ conn_recv_delayed_handshake_pkt(ngtcp2_conn *conn, const ngtcp2_pkt_info *pi,\n   int rv;\n   int require_ack = 0;\n   ngtcp2_pktns *pktns;\n+  size_t num_ack_processed = 0;\n \n   assert(hd->type == NGTCP2_PKT_HANDSHAKE);\n \n@@ -8710,13 +8720,17 @@ conn_recv_delayed_handshake_pkt(ngtcp2_conn *conn, const ngtcp2_pkt_info *pi,\n     switch (fr->type) {\n     case NGTCP2_FRAME_ACK:\n     case NGTCP2_FRAME_ACK_ECN:\n+      if (num_ack_processed >= NGTCP2_MAX_ACK_PER_PKT) {\n+        break;\n+      }\n       if (!conn->server) {\n         conn->flags |= NGTCP2_CONN_FLAG_SERVER_ADDR_VERIFIED;\n       }\n       rv = conn_recv_ack(conn, pktns, &fr->ack, pkt_ts, ts);\n       if (rv != 0) {\n         return rv;\n       }\n+      ++num_ack_processed;\n       break;\n     case NGTCP2_FRAME_PADDING:\n       break;\n@@ -8878,6 +8892,7 @@ static ngtcp2_ssize conn_recv_pkt(ngtcp2_conn *conn, const ngtcp2_path *path,\n   int recv_ncid = 0;\n   int new_cid_used = 0;\n   int path_challenge_recved = 0;\n+  size_t num_ack_processed = 0;\n \n   if (conn->server && conn->local.transport_params.disable_active_migration &&\n       !ngtcp2_path_eq(&conn->dcid.current.ps.path, path) &&\n@@ -9228,6 +9243,9 @@ static ngtcp2_ssize conn_recv_pkt(ngtcp2_conn *conn, const ngtcp2_path *path,\n     switch (fr->type) {\n     case NGTCP2_FRAME_ACK:\n     case NGTCP2_FRAME_ACK_ECN:\n+      if (num_ack_processed >= NGTCP2_MAX_ACK_PER_PKT) {\n+        break;\n+      }\n       if (!conn->server) {\n         conn->flags |= NGTCP2_CONN_FLAG_SERVER_ADDR_VERIFIED;\n       }\n@@ -9236,6 +9254,7 @@ static ngtcp2_ssize conn_recv_pkt(ngtcp2_conn *conn, const ngtcp2_path *path,\n         return rv;\n       }\n       non_probing_pkt = 1;\n+      ++num_ack_processed;\n       break;\n     case NGTCP2_FRAME_STREAM:\n       rv = conn_recv_stream(conn, &fr->stream);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ngtcp2/ngtcp2/commits/44b662bd139c23fee1703bf256c13349e2e624a1",
        "url": "https://api.github.com/repos/ngtcp2/ngtcp2/commits/44b662bd139c23fee1703bf256c13349e2e624a1",
        "html_url": "https://github.com/ngtcp2/ngtcp2/commit/44b662bd139c23fee1703bf256c13349e2e624a1",
        "message": "Fix heap buffer overflow writing not validated ACK to qlog",
        "files": [
            {
                "sha": "8b60efabe126d02e46b65d0add3434f578cd579b",
                "filename": "lib/ngtcp2_conn.c",
                "status": "modified",
                "additions": 23,
                "deletions": 9,
                "changes": 32,
                "blob_url": "https://github.com/ngtcp2/ngtcp2/blob/44b662bd139c23fee1703bf256c13349e2e624a1/lib%2Fngtcp2_conn.c",
                "raw_url": "https://github.com/ngtcp2/ngtcp2/raw/44b662bd139c23fee1703bf256c13349e2e624a1/lib%2Fngtcp2_conn.c",
                "contents_url": "https://api.github.com/repos/ngtcp2/ngtcp2/contents/lib%2Fngtcp2_conn.c?ref=44b662bd139c23fee1703bf256c13349e2e624a1",
                "patch": "@@ -5322,35 +5322,28 @@ int ngtcp2_conn_detect_lost_pkt(ngtcp2_conn *conn, ngtcp2_pktns *pktns,\n  * conn_recv_ack processes received ACK frame |fr|.  |pkt_ts| is the\n  * timestamp when packet is received.  |ts| should be the current\n  * time.  Usually they are the same, but for buffered packets,\n- * |pkt_ts| would be earlier than |ts|.\n+ * |pkt_ts| would be earlier than |ts|.  This function needs to be\n+ * called after |fr| is validated by ngtcp2_pkt_validate_ack.\n  *\n  * This function returns 0 if it succeeds, or one of the following\n  * negative error codes:\n  *\n  * NGTCP2_ERR_NOMEM\n  *     Out of memory\n- * NGTCP2_ERR_ACK_FRAME\n- *     ACK frame is malformed.\n  * NGTCP2_ERR_PROTO\n  *     |fr| acknowledges a packet this endpoint has not sent.\n  * NGTCP2_ERR_CALLBACK_FAILURE\n  *     User callback failed.\n  */\n static int conn_recv_ack(ngtcp2_conn *conn, ngtcp2_pktns *pktns, ngtcp2_ack *fr,\n                          ngtcp2_tstamp pkt_ts, ngtcp2_tstamp ts) {\n-  int rv;\n   ngtcp2_ssize num_acked;\n   ngtcp2_conn_stat *cstat = &conn->cstat;\n \n   if (pktns->tx.last_pkt_num < fr->largest_ack) {\n     return NGTCP2_ERR_PROTO;\n   }\n \n-  rv = ngtcp2_pkt_validate_ack(fr, conn->local.settings.initial_pkt_num);\n-  if (rv != 0) {\n-    return rv;\n-  }\n-\n   ngtcp2_acktr_recv_ack(&pktns->acktr, fr);\n \n   num_acked =\n@@ -6561,6 +6554,13 @@ conn_recv_handshake_pkt(ngtcp2_conn *conn, const ngtcp2_path *path,\n     case NGTCP2_FRAME_ACK_ECN:\n       fr->ack.ack_delay = 0;\n       fr->ack.ack_delay_unscaled = 0;\n+\n+      rv =\n+        ngtcp2_pkt_validate_ack(&fr->ack, conn->local.settings.initial_pkt_num);\n+      if (rv != 0) {\n+        return rv;\n+      }\n+\n       break;\n     }\n \n@@ -8715,6 +8715,13 @@ conn_recv_delayed_handshake_pkt(ngtcp2_conn *conn, const ngtcp2_pkt_info *pi,\n     case NGTCP2_FRAME_ACK_ECN:\n       fr->ack.ack_delay = 0;\n       fr->ack.ack_delay_unscaled = 0;\n+\n+      rv =\n+        ngtcp2_pkt_validate_ack(&fr->ack, conn->local.settings.initial_pkt_num);\n+      if (rv != 0) {\n+        return rv;\n+      }\n+\n       break;\n     }\n \n@@ -9200,6 +9207,13 @@ static ngtcp2_ssize conn_recv_pkt(ngtcp2_conn *conn, const ngtcp2_path *path,\n       assert(conn->remote.transport_params);\n       assign_recved_ack_delay_unscaled(\n         &fr->ack, conn->remote.transport_params->ack_delay_exponent);\n+\n+      rv =\n+        ngtcp2_pkt_validate_ack(&fr->ack, conn->local.settings.initial_pkt_num);\n+      if (rv != 0) {\n+        return rv;\n+      }\n+\n       break;\n     }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mlflow/mlflow/commits/0b1d995d66a678153e01ed3040f3f4dfc16a0d6b",
        "url": "https://api.github.com/repos/mlflow/mlflow/commits/0b1d995d66a678153e01ed3040f3f4dfc16a0d6b",
        "html_url": "https://github.com/mlflow/mlflow/commit/0b1d995d66a678153e01ed3040f3f4dfc16a0d6b",
        "message": "Fix: Privilege Escalation in MLflow when using spark_udf (#10874)\n\nSigned-off-by: Weichen Xu <weichen.xu@databricks.com>",
        "files": [
            {
                "sha": "578faf0c75fc4ee0cce71cb2b26ce1f3a15a93fd",
                "filename": "mlflow/pyfunc/__init__.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/mlflow/mlflow/blob/0b1d995d66a678153e01ed3040f3f4dfc16a0d6b/mlflow%2Fpyfunc%2F__init__.py",
                "raw_url": "https://github.com/mlflow/mlflow/raw/0b1d995d66a678153e01ed3040f3f4dfc16a0d6b/mlflow%2Fpyfunc%2F__init__.py",
                "contents_url": "https://api.github.com/repos/mlflow/mlflow/contents/mlflow%2Fpyfunc%2F__init__.py?ref=0b1d995d66a678153e01ed3040f3f4dfc16a0d6b",
                "patch": "@@ -1320,8 +1320,8 @@ def _create_model_downloading_tmp_dir(should_use_nfs):\n \n     tmp_model_dir = tempfile.mkdtemp(dir=root_model_cache_dir)\n     # mkdtemp creates a directory with permission 0o700\n-    # change it to be 0o777 to ensure it can be seen in spark UDF\n-    os.chmod(tmp_model_dir, 0o777)\n+    # change it to be 0o770 to ensure it can be seen in spark UDF\n+    os.chmod(tmp_model_dir, 0o770)\n     return tmp_model_dir\n \n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/libjxl/libjxl/commits/9cc451b91b74ba470fd72bd48c121e9f33d24c99",
        "url": "https://api.github.com/repos/libjxl/libjxl/commits/9cc451b91b74ba470fd72bd48c121e9f33d24c99",
        "html_url": "https://github.com/libjxl/libjxl/commit/9cc451b91b74ba470fd72bd48c121e9f33d24c99",
        "message": "Port the Huffman lookup table size fix from brunsli. (#3871)\n\nSee also: https://www.youtube.com/watch?v=_ACCK0AUQ8Q&t=696s",
        "files": [
            {
                "sha": "99549668cffe72dccc7f92fe960c5a28af1cfb26",
                "filename": "lib/jpegli/huffman.h",
                "status": "modified",
                "additions": 12,
                "deletions": 4,
                "changes": 16,
                "blob_url": "https://github.com/libjxl/libjxl/blob/9cc451b91b74ba470fd72bd48c121e9f33d24c99/lib%2Fjpegli%2Fhuffman.h",
                "raw_url": "https://github.com/libjxl/libjxl/raw/9cc451b91b74ba470fd72bd48c121e9f33d24c99/lib%2Fjpegli%2Fhuffman.h",
                "contents_url": "https://api.github.com/repos/libjxl/libjxl/contents/lib%2Fjpegli%2Fhuffman.h?ref=9cc451b91b74ba470fd72bd48c121e9f33d24c99",
                "patch": "@@ -15,10 +15,18 @@ namespace jpegli {\n \n constexpr int kJpegHuffmanRootTableBits = 8;\n // Maximum huffman lookup table size.\n-// According to zlib/examples/enough.c, 758 entries are always enough for\n-// an alphabet of 257 symbols (256 + 1 special symbol for the all 1s code) and\n-// max bit length 16 if the root table has 8 bits.\n-constexpr int kJpegHuffmanLutSize = 758;\n+// Requirements: alphabet of 257 symbols (256 + 1 special symbol for the all 1s\n+// code) and max bit length 16, the root table has 8 bits.\n+// zlib/examples/enough.c works with an assumption that Huffman code is\n+// \"complete\". Input JPEGs might have this assumption broken, hence the\n+// following sum is used as estimate:\n+//  + number of 1-st level cells\n+//  + number of symbols\n+//  + asymptotic amount of repeated 2nd level cells\n+// The third number is 1 + 3 + ... + 255 i.e. it is assumed that sub-table of\n+// each \"size\" might be almost completely be filled with repetitions.\n+// Total sum is slightly less than 1024,...\n+constexpr int kJpegHuffmanLutSize = 1024;\n \n struct HuffmanTableEntry {\n   uint8_t bits;    // number of bits used for this symbol"
            },
            {
                "sha": "fc9bd17baa0b8b1ca1952ea8f9a2a550cbe6f0fd",
                "filename": "lib/jxl/jpeg/enc_jpeg_huffman_decode.h",
                "status": "modified",
                "additions": 12,
                "deletions": 4,
                "changes": 16,
                "blob_url": "https://github.com/libjxl/libjxl/blob/9cc451b91b74ba470fd72bd48c121e9f33d24c99/lib%2Fjxl%2Fjpeg%2Fenc_jpeg_huffman_decode.h",
                "raw_url": "https://github.com/libjxl/libjxl/raw/9cc451b91b74ba470fd72bd48c121e9f33d24c99/lib%2Fjxl%2Fjpeg%2Fenc_jpeg_huffman_decode.h",
                "contents_url": "https://api.github.com/repos/libjxl/libjxl/contents/lib%2Fjxl%2Fjpeg%2Fenc_jpeg_huffman_decode.h?ref=9cc451b91b74ba470fd72bd48c121e9f33d24c99",
                "patch": "@@ -15,10 +15,18 @@ namespace jpeg {\n \n constexpr int kJpegHuffmanRootTableBits = 8;\n // Maximum huffman lookup table size.\n-// According to zlib/examples/enough.c, 758 entries are always enough for\n-// an alphabet of 257 symbols (256 + 1 special symbol for the all 1s code) and\n-// max bit length 16 if the root table has 8 bits.\n-constexpr int kJpegHuffmanLutSize = 758;\n+// Requirements: alphabet of 257 symbols (256 + 1 special symbol for the all 1s\n+// code) and max bit length 16, the root table has 8 bits.\n+// zlib/examples/enough.c works with an assumption that Huffman code is\n+// \"complete\". Input JPEGs might have this assumption broken, hence the\n+// following sum is used as estimate:\n+//  + number of 1-st level cells\n+//  + number of symbols\n+//  + asymptotic amount of repeated 2nd level cells\n+// The third number is 1 + 3 + ... + 255 i.e. it is assumed that sub-table of\n+// each \"size\" might be almost completely be filled with repetitions.\n+// Total sum is slightly less than 1024,...\n+constexpr int kJpegHuffmanLutSize = 1024;\n \n struct HuffmanTableEntry {\n   // Initialize the value to an invalid symbol so that we can recognize it"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/d60cb9aaefc4035d322862edd8f9f252af6da951",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/d60cb9aaefc4035d322862edd8f9f252af6da951",
        "html_url": "https://github.com/keycloak/keycloak/commit/d60cb9aaefc4035d322862edd8f9f252af6da951",
        "message": "fix: prevent inclusion of characters that could lead to FileVault path traversal (#35223)\n\nCloses: #35215\r\n\r\nSigned-off-by: Peter Zaoral <pzaoral@redhat.com>\r\nCo-authored-by: Peter Zaoral <pepo48@gmail.com>",
        "files": [
            {
                "sha": "b6b63404e51d144232456b93144b4b2a434f268f",
                "filename": "docs/documentation/server_admin/topics/vault.adoc",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d60cb9aaefc4035d322862edd8f9f252af6da951/docs%2Fdocumentation%2Fserver_admin%2Ftopics%2Fvault.adoc",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d60cb9aaefc4035d322862edd8f9f252af6da951/docs%2Fdocumentation%2Fserver_admin%2Ftopics%2Fvault.adoc",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/docs%2Fdocumentation%2Fserver_admin%2Ftopics%2Fvault.adoc?ref=d60cb9aaefc4035d322862edd8f9f252af6da951",
                "patch": "@@ -26,6 +26,7 @@ In the <<_ldap,LDAP settings>> of LDAP-based user federation.\n OIDC identity provider secret::\n In the _Client Secret_ inside identity provider <<_identity_broker_oidc,OpenID Connect Config>>\n \n+[[_vault-key-resolvers]]\n === Key resolvers\n \n All built-in providers support the configuration of key resolvers. A key resolver implements the algorithm or strategy for combining the realm name with the key, obtained from the `${vault.key}` expression, into the final entry name used to retrieve the secret from the vault. {project_name} uses the `keyResolvers` property to configure the resolvers that the provider uses. The value is a comma-separated list of resolver names. An example of the configuration for the `files-plaintext` provider follows:\n@@ -45,13 +46,13 @@ A list of the currently available resolvers follows:\n |Name |Description\n \n | KEY_ONLY\n-| {project_name} ignores the realm name and uses the key from the vault expression.\n+| {project_name} ignores the realm name and uses the key from the vault expression. {project_name} escapes occurrences of underscores in the key with another underscore character. For example, if the key is called `my_secret`, {project_name} searches for an entry in the vault named `my++__++secret`. This is to prevent conflicts with the default `REALM_UNDERSCORE_KEY` resolver.\n \n | REALM_UNDERSCORE_KEY\n | {project_name} combines the realm and key by using an underscore character. {project_name} escapes occurrences of underscores in the realm or key with another underscore character. For example, if the realm is called `master_realm` and the key is `smtp_key`, the combined key is `master+++__+++realm_smtp+++__+++key`.\n \n | REALM_FILESEPARATOR_KEY\n-| {project_name} combines the realm and key by using the platform file separator character.\n+| {project_name} combines the realm and key by using the platform file separator character. The vault expression prohibits the use of characters that could cause path traversal, thus preventing access to secrets outside the corresponding realm.\n \n ifeval::[{project_community}==true]\n | FACTORY_PROVIDED\n@@ -60,4 +61,4 @@ endif::[]\n \n |===\n \n-If you have not configured a resolver for the built-in providers, {project_name} selects the `REALM_UNDERSCORE_KEY`.\n\\ No newline at end of file\n+If you have not configured a resolver for the built-in providers, {project_name} selects the `REALM_UNDERSCORE_KEY`."
            },
            {
                "sha": "6436f93c2da11da49aaa82333436ec099dd5cf4a",
                "filename": "docs/documentation/upgrading/topics/changes/changes-26_0_6.adoc",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d60cb9aaefc4035d322862edd8f9f252af6da951/docs%2Fdocumentation%2Fupgrading%2Ftopics%2Fchanges%2Fchanges-26_0_6.adoc",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d60cb9aaefc4035d322862edd8f9f252af6da951/docs%2Fdocumentation%2Fupgrading%2Ftopics%2Fchanges%2Fchanges-26_0_6.adoc",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/docs%2Fdocumentation%2Fupgrading%2Ftopics%2Fchanges%2Fchanges-26_0_6.adoc?ref=d60cb9aaefc4035d322862edd8f9f252af6da951",
                "patch": "@@ -0,0 +1,5 @@\n+= Security improvements for the key resolvers\n+\n+While using the `REALM_FILESEPARATOR_KEY` key resolver, {project_name} now restricts access to FileVault secrets outside of its realm. Characters that could cause path traversal when specifying the expression placeholder in the Administration Console are now prohibited.\n+\n+Additionally, the `KEY_ONLY` key resolver now escapes the `+_+` character to prevent reading secrets that would otherwise be linked to another realm when the `REALM_UNDERSCORE_KEY` resolver is used. The escaping simply replaces `+_+` with `+__+`, so, for example, `${vault.my_secret}` now looks for a file named `my++__++secret`. We recognize that this is a breaking change; therefore, a warning is logged to ease the transition."
            },
            {
                "sha": "91ea96b4740962793e985547d6a95da379760451",
                "filename": "docs/guides/server/vault.adoc",
                "status": "modified",
                "additions": 15,
                "deletions": 13,
                "changes": 28,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d60cb9aaefc4035d322862edd8f9f252af6da951/docs%2Fguides%2Fserver%2Fvault.adoc",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d60cb9aaefc4035d322862edd8f9f252af6da951/docs%2Fguides%2Fserver%2Fvault.adoc",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/docs%2Fguides%2Fserver%2Fvault.adoc?ref=d60cb9aaefc4035d322862edd8f9f252af6da951",
                "patch": "@@ -43,19 +43,6 @@ Kubernetes/OpenShift Secrets are used on a per-realm basis in {project_name}, wh\n ${r\"${vault.<realmname>_<secretname>}\"}\n ----\n \n-=== Using underscores in the Name\n-To process the secret correctly, you double all underscores in the <realmname> or the <secretname>, separated by a single underscore.\n-\n-.Example\n-* Realm Name: `sso_realm`\n-* Desired Name: `ldap_credential`\n-* Resulting file Name:\n-[source, bash]\n-----\n-sso__realm_ldap__credential\n-----\n-Note the doubled underscores between __sso__ and __realm__ and also between __ldap__ and __credential__.\n-\n == Configuring the Java KeyStore-based vault\n \n In order to use the Java KeyStore-based vault, you need to create a KeyStore file first. You can use the following command for doing so:\n@@ -75,6 +62,21 @@ Note that the `--vault-type` parameter is optional and defaults to `PKCS12`.\n \n Secrets stored in the vault can then be accessed in a realm via the following placeholder (assuming using the `REALM_UNDERSCORE_KEY` key resolver): `${r\"${vault.realm-name_alias}\"}`.\n \n+== Using underscores in the secret names\n+To process the secret correctly, you double all underscores in the <secretname>. When `REALM_UNDERSCORE_KEY` key resolver is used, underscores in <realmname> are also doubled and <secretname> and <realmname> is separated by a single underscore.\n+\n+.Example\n+* Realm Name: `sso_realm`\n+* Desired Name: `ldap_credential`\n+* Resulting file name:\n+[source, bash]\n+----\n+sso__realm_ldap__credential\n+----\n+Note the doubled underscores between __sso__ and __realm__ and also between __ldap__ and __credential__.\n+\n+To learn more about key resolvers, see link:{adminguide_link}#_vault-key-resolvers[Key resolvers section in the Server Administration guide].\n+\n == Example: Use an LDAP bind credential secret in the Admin Console\n \n .Example setup"
            },
            {
                "sha": "8f234b1059933a059b2e6a7c58b0f2f59fc88457",
                "filename": "services/src/main/java/org/keycloak/vault/AbstractVaultProvider.java",
                "status": "modified",
                "additions": 43,
                "deletions": 1,
                "changes": 44,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fvault%2FAbstractVaultProvider.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fvault%2FAbstractVaultProvider.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fvault%2FAbstractVaultProvider.java?ref=d60cb9aaefc4035d322862edd8f9f252af6da951",
                "patch": "@@ -17,6 +17,10 @@\n \n package org.keycloak.vault;\n \n+import org.jboss.logging.Logger;\n+\n+import java.io.File;\n+import java.lang.invoke.MethodHandles;\n import java.util.List;\n import java.util.Optional;\n \n@@ -38,6 +42,8 @@\n  */\n public abstract class AbstractVaultProvider implements VaultProvider {\n \n+    private static final Logger logger = Logger.getLogger(MethodHandles.lookup().lookupClass());\n+\n     protected final String realm;\n     protected final List<VaultKeyResolver> resolvers;\n \n@@ -56,14 +62,50 @@ public AbstractVaultProvider(final String realm, final List<VaultKeyResolver> co\n     @Override\n     public VaultRawSecret obtainSecret(String vaultSecretId) {\n         for (VaultKeyResolver resolver : this.resolvers) {\n-            VaultRawSecret secret = this.obtainSecretInternal(resolver.apply(this.realm, vaultSecretId));\n+            String resolvedKey = resolver.apply(this.realm, vaultSecretId);\n+            if (!validate(resolver, vaultSecretId, resolvedKey)) {\n+                logger.warnf(\"Validation failed for secret %s with resolved key %s\", vaultSecretId, resolvedKey);\n+                return DefaultVaultRawSecret.forBuffer(Optional.empty());\n+            }\n+        }\n+\n+        for (VaultKeyResolver resolver : this.resolvers) {\n+            String resolvedKey = resolver.apply(this.realm, vaultSecretId);\n+            VaultRawSecret secret = this.obtainSecretInternal(resolvedKey);\n             if (secret != null && secret.get().isPresent()) {\n                 return secret;\n             }\n+            checkForLegacyKey(resolver, vaultSecretId, resolvedKey);\n         }\n         return DefaultVaultRawSecret.forBuffer(Optional.empty());\n     }\n \n+    private void checkForLegacyKey(VaultKeyResolver resolver, String vaultSecretId, String resolvedKey) {\n+        if (resolver == AbstractVaultProviderFactory.AvailableResolvers.KEY_ONLY.getVaultKeyResolver() && vaultSecretId.contains(\"_\")) {\n+            String legacyKey = vaultSecretId.replaceAll(\"__\", \"_\");\n+            VaultRawSecret legacySecret = this.obtainSecretInternal(legacyKey);\n+            if (legacySecret != null && legacySecret.get().isPresent()) {\n+                logger.warnf(\"Secret was found using legacy key '%s'. Please rename the key to '%s' and repeat the action.\", legacyKey, resolvedKey);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Validates the resolved key to ensure it meets the necessary criteria.\n+     *\n+     * @param resolver the {@link VaultKeyResolver} used to resolve the key.\n+     * @param key the original key provided.\n+     * @param resolvedKey the key after being resolved by the resolver.\n+     * @return a boolean indicating whether the validation passed.\n+     */\n+    protected boolean validate(VaultKeyResolver resolver, String key, String resolvedKey) {\n+        if (key.contains(File.separator)) {\n+            logger.warnf(\"Key %s contains invalid file separator character\", key);\n+            return false;\n+        }\n+        return true;\n+    }\n+\n     /**\n      * Subclasses of {@code AbstractVaultProvider} must implement this method. It is meant to be implemented in the same\n      * way as the {@link #obtainSecret(String)} method from the {@link VaultProvider} interface, but the specified vault"
            },
            {
                "sha": "6d407d34add6509c6d391b83364a2a5e572a91d4",
                "filename": "services/src/main/java/org/keycloak/vault/AbstractVaultProviderFactory.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fvault%2FAbstractVaultProviderFactory.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fvault%2FAbstractVaultProviderFactory.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fvault%2FAbstractVaultProviderFactory.java?ref=d60cb9aaefc4035d322862edd8f9f252af6da951",
                "patch": "@@ -140,7 +140,7 @@ protected enum AvailableResolvers {\n          * all realms to share the secrets, so instead of replicating entries for all existing realms in the vault one can\n          * simply use key directly and all realms will obtain the same secret.\n          */\n-        KEY_ONLY((realm, key) -> key),\n+        KEY_ONLY((realm, key) -> key.replaceAll(\"_\", \"__\")),\n \n         /**\n          * The realm is prepended to the vault key and they are separated by an underscore ({@code '_'}) character. If either"
            },
            {
                "sha": "e45312431871860732ecec9bd7e8e87561919116",
                "filename": "services/src/main/java/org/keycloak/vault/FilesPlainTextVaultProvider.java",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fvault%2FFilesPlainTextVaultProvider.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fvault%2FFilesPlainTextVaultProvider.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fvault%2FFilesPlainTextVaultProvider.java?ref=d60cb9aaefc4035d322862edd8f9f252af6da951",
                "patch": "@@ -63,6 +63,24 @@ protected VaultRawSecret obtainSecretInternal(String vaultSecretId) {\n         }\n     }\n \n+    @Override\n+    protected boolean validate(VaultKeyResolver resolver, String key, String resolvedKey) {\n+        if (!super.validate(resolver, key, resolvedKey)) {\n+            return false;\n+        }\n+        Path secretPath = vaultPath.resolve(resolvedKey);\n+\n+        Path expectedPath = vaultPath;\n+        if (resolver == AbstractVaultProviderFactory.AvailableResolvers.REALM_FILESEPARATOR_KEY.getVaultKeyResolver()) {\n+            expectedPath = expectedPath.resolve(realm);\n+        }\n+        if (!secretPath.getParent().equals(expectedPath)) {\n+            logger.warnf(\"Path traversal attempt detected in secret %s.\", key);\n+            return false;\n+        }\n+        return true;\n+    }\n+\n     @Override\n     public void close() {\n "
            },
            {
                "sha": "dbbe845fef5cc3396936e3ecf39975bf84e8c624",
                "filename": "services/src/test/java/org/keycloak/vault/PlainTextVaultProviderTest.java",
                "status": "modified",
                "additions": 138,
                "deletions": 2,
                "changes": 140,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Fvault%2FPlainTextVaultProviderTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Fvault%2FPlainTextVaultProviderTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Fvault%2FPlainTextVaultProviderTest.java?ref=d60cb9aaefc4035d322862edd8f9f252af6da951",
                "patch": "@@ -1,17 +1,29 @@\n package org.keycloak.vault;\n \n import org.junit.Test;\n+import org.junit.Before;\n+import org.junit.After;\n \n import java.nio.charset.StandardCharsets;\n import java.nio.file.Files;\n import java.nio.file.Path;\n+import java.nio.file.Paths;\n import java.util.Arrays;\n+import java.util.concurrent.BlockingQueue;\n+import java.util.concurrent.LinkedBlockingQueue;\n+import java.util.logging.Handler;\n+import java.util.logging.Level;\n+import java.util.logging.LogRecord;\n+import java.util.logging.Logger;\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n \n import static org.hamcrest.CoreMatchers.not;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertFalse;\n import static org.junit.Assert.assertNotNull;\n import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.junit.Assert.assertTrue;\n import static org.keycloak.vault.SecretContains.secretContains;\n \n /**\n@@ -21,6 +33,38 @@\n  */\n public class PlainTextVaultProviderTest {\n \n+    private static final Logger logger = Logger.getLogger(\"org.keycloak.vault\");\n+    private BlockingQueue<String> logMessages;\n+    private final ByteArrayOutputStream errContent = new ByteArrayOutputStream();\n+    private final PrintStream originalErr = System.err;\n+    private Handler logHandler;\n+\n+    @Before\n+    public void setUp() {\n+        logMessages = new LinkedBlockingQueue<>();\n+        logger.setLevel(Level.WARNING);\n+        logHandler = new Handler() {\n+            @Override\n+            public void publish(LogRecord record) {\n+                logMessages.add(record.getMessage());\n+            }\n+\n+            @Override\n+            public void flush() { }\n+\n+            @Override\n+            public void close() throws SecurityException { }\n+        };\n+        logger.addHandler(logHandler);\n+        System.setErr(new PrintStream(errContent));\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        logger.removeHandler(logHandler);\n+        System.setErr(originalErr);\n+    }\n+\n     @Test\n     public void shouldObtainSecret() throws Exception {\n         //given\n@@ -69,7 +113,7 @@ public void shouldReturnEmptyOptionalOnMissingSecret() throws Exception {\n     public void shouldOperateOnNonExistingVaultDirectory() throws Exception {\n         //given\n         FilesPlainTextVaultProvider provider = new FilesPlainTextVaultProvider(Scenario.NON_EXISTING.getPath(), \"test\",\n-            Arrays.asList(AbstractVaultProviderFactory.AvailableResolvers.REALM_UNDERSCORE_KEY.getVaultKeyResolver()));\n+                Arrays.asList(AbstractVaultProviderFactory.AvailableResolvers.REALM_UNDERSCORE_KEY.getVaultKeyResolver()));\n \n         //when\n         VaultRawSecret secret = provider.obtainSecret(\"non-existing-key\");\n@@ -161,4 +205,96 @@ public void shouldNotOverrideFileWhenDestroyingASecret() throws Exception {\n         assertThat(secretAfterFirstRead, not(secretContains(\"secret\")));\n         assertThat(secretAfterSecondRead, secretContains(\"secret\"));\n     }\n-}\n\\ No newline at end of file\n+\n+    @Test\n+    public void shouldPreventPathFileSeparatorInVaultSecretId() {\n+        // given\n+        FilesPlainTextVaultProvider provider = new FilesPlainTextVaultProvider(\n+                Scenario.EXISTING.getPath(),\n+                \"test\",\n+                Arrays.asList(AbstractVaultProviderFactory.AvailableResolvers.REALM_FILESEPARATOR_KEY.getVaultKeyResolver())\n+        );\n+\n+        // when\n+        VaultRawSecret secret = provider.obtainSecret(\".../key1\");\n+\n+        // then\n+        assertNotNull(secret);\n+        assertFalse(secret.get().isPresent());\n+        assertTrue(\n+                logMessages.stream()\n+                        .anyMatch(msg -> msg.contains(\"Key .../key1 contains invalid file separator character\"))\n+        );\n+    }\n+\n+    @Test\n+    public void shouldNotValidateWithInvalidPath() {\n+        // given\n+        Path vaultPath = Paths.get(\"/vault\");\n+        FilesPlainTextVaultProvider provider = new FilesPlainTextVaultProvider(vaultPath, \"test_realm\",\n+                Arrays.asList(AbstractVaultProviderFactory.AvailableResolvers.REALM_FILESEPARATOR_KEY.getVaultKeyResolver()));\n+        VaultKeyResolver resolver = AbstractVaultProviderFactory.AvailableResolvers.REALM_FILESEPARATOR_KEY.getVaultKeyResolver();\n+        String key = \"key1\";\n+        String resolvedKey = \"../key1\";\n+\n+        // when\n+        boolean isValid = provider.validate(resolver, key, resolvedKey);\n+\n+        // then\n+        assertFalse(isValid);\n+    }\n+\n+    @Test\n+    public void shouldValidateWithDifferentResolver() {\n+        // given\n+        Path vaultPath = Paths.get(\"/vault\");\n+        FilesPlainTextVaultProvider provider = new FilesPlainTextVaultProvider(vaultPath, \"test_realm\",\n+                Arrays.asList(AbstractVaultProviderFactory.AvailableResolvers.KEY_ONLY.getVaultKeyResolver()));\n+        VaultKeyResolver resolver = AbstractVaultProviderFactory.AvailableResolvers.KEY_ONLY.getVaultKeyResolver();\n+        String key = \"key1\";\n+        String resolvedKey = \"key1\";\n+\n+        // when\n+        boolean isValid = provider.validate(resolver, key, resolvedKey);\n+\n+        // then\n+        assertTrue(isValid);\n+    }\n+\n+    @Test\n+    public void shouldSearchForEscapedKeyOnlySecret() throws Exception {\n+        // given\n+        FilesPlainTextVaultProvider provider = new FilesPlainTextVaultProvider(Scenario.EXISTING.getPath(), \"test\",\n+                Arrays.asList(AbstractVaultProviderFactory.AvailableResolvers.KEY_ONLY.getVaultKeyResolver()));\n+\n+        // when\n+        VaultRawSecret secret = provider.obtainSecret(\"keyonly_escaped\");\n+\n+        // then\n+        assertNotNull(secret);\n+        assertNotNull(secret.get().get());\n+        assertThat(secret, secretContains(\"expected_secret_value\"));\n+    }\n+\n+    @Test\n+    public void shouldSearchForKeyOnlyLegacy() throws Exception {\n+        // given\n+        FilesPlainTextVaultProvider provider = new FilesPlainTextVaultProvider(\n+                Scenario.EXISTING.getPath(),\n+                \"test\",\n+                Arrays.asList(AbstractVaultProviderFactory.AvailableResolvers.KEY_ONLY.getVaultKeyResolver())\n+        );\n+\n+        // when\n+        VaultRawSecret secret = provider.obtainSecret(\"keyonly_legacy\");\n+\n+        // then\n+        assertNotNull(secret);\n+        assertFalse(secret.get().isPresent());\n+        assertTrue(\n+                logMessages.stream()\n+                        .anyMatch(msg -> msg.contains(\"Secret was found using legacy key 'keyonly_legacy'. Please rename the key to 'keyonly__legacy' and repeat the action.\"))\n+        );\n+    }\n+\n+}"
            },
            {
                "sha": "d3f5ba6657d33f0693b7e17f4c87a4fa2e10ff5f",
                "filename": "services/src/test/resources/org/keycloak/vault/keyonly__escaped",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Ftest%2Fresources%2Forg%2Fkeycloak%2Fvault%2Fkeyonly__escaped",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Ftest%2Fresources%2Forg%2Fkeycloak%2Fvault%2Fkeyonly__escaped",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Ftest%2Fresources%2Forg%2Fkeycloak%2Fvault%2Fkeyonly__escaped?ref=d60cb9aaefc4035d322862edd8f9f252af6da951",
                "patch": "@@ -0,0 +1 @@\n+expected_secret_value\n\\ No newline at end of file"
            },
            {
                "sha": "32eea160a5dafe8aee3748520b9b8d0704090f8c",
                "filename": "services/src/test/resources/org/keycloak/vault/keyonly_legacy",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/keycloak/keycloak/blob/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Ftest%2Fresources%2Forg%2Fkeycloak%2Fvault%2Fkeyonly_legacy",
                "raw_url": "https://github.com/keycloak/keycloak/raw/d60cb9aaefc4035d322862edd8f9f252af6da951/services%2Fsrc%2Ftest%2Fresources%2Forg%2Fkeycloak%2Fvault%2Fkeyonly_legacy",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Ftest%2Fresources%2Forg%2Fkeycloak%2Fvault%2Fkeyonly_legacy?ref=d60cb9aaefc4035d322862edd8f9f252af6da951",
                "patch": "@@ -0,0 +1 @@\n+should_not_be_retrieved\n\\ No newline at end of file"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/198214310eb45b86707f823ccb5a2d65c814b528",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/198214310eb45b86707f823ccb5a2d65c814b528",
        "html_url": "https://github.com/keycloak/keycloak/commit/198214310eb45b86707f823ccb5a2d65c814b528",
        "message": "fix: ensures that properties are runtime properties are filtered (#35246)\n\ncloses: #CVE-2024-10451\r\n\r\nSigned-off-by: Steve Hawkins <shawkins@redhat.com>",
        "files": [
            {
                "sha": "d5da54e5a115d3ff6684ba15b0034ff1bdba4bef",
                "filename": "quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/configuration/mappers/PropertyMapper.java",
                "status": "modified",
                "additions": 0,
                "deletions": 21,
                "changes": 21,
                "blob_url": "https://github.com/keycloak/keycloak/blob/198214310eb45b86707f823ccb5a2d65c814b528/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fconfiguration%2Fmappers%2FPropertyMapper.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/198214310eb45b86707f823ccb5a2d65c814b528/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fconfiguration%2Fmappers%2FPropertyMapper.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fconfiguration%2Fmappers%2FPropertyMapper.java?ref=198214310eb45b86707f823ccb5a2d65c814b528",
                "patch": "@@ -41,7 +41,6 @@\n \n import org.keycloak.config.DeprecatedMetadata;\n import org.keycloak.config.Option;\n-import org.keycloak.config.OptionBuilder;\n import org.keycloak.config.OptionCategory;\n import org.keycloak.quarkus.runtime.cli.PropertyException;\n import org.keycloak.quarkus.runtime.cli.ShortErrorMessageHandler;\n@@ -55,26 +54,6 @@\n \n public class PropertyMapper<T> {\n \n-    static PropertyMapper<?> IDENTITY = new PropertyMapper<>(\n-            new OptionBuilder<>(null, String.class).build(),\n-            null,\n-            () -> false,\n-            \"\",\n-            null,\n-            null,\n-            null,\n-            null,\n-            false,\n-            null,\n-            null,\n-            () -> false,\n-            \"\") {\n-        @Override\n-        public ConfigValue getConfigValue(String name, ConfigSourceInterceptorContext context) {\n-            return context.proceed(name);\n-        }\n-    };\n-\n     private final Option<T> option;\n     private final String to;\n     private BooleanSupplier enabled;"
            },
            {
                "sha": "d6fdc7981f804cece0019d0885918483c7c420a5",
                "filename": "quarkus/runtime/src/main/java/org/keycloak/quarkus/runtime/configuration/mappers/PropertyMappers.java",
                "status": "modified",
                "additions": 22,
                "deletions": 8,
                "changes": 30,
                "blob_url": "https://github.com/keycloak/keycloak/blob/198214310eb45b86707f823ccb5a2d65c814b528/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fconfiguration%2Fmappers%2FPropertyMappers.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/198214310eb45b86707f823ccb5a2d65c814b528/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fconfiguration%2Fmappers%2FPropertyMappers.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/quarkus%2Fruntime%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fquarkus%2Fruntime%2Fconfiguration%2Fmappers%2FPropertyMappers.java?ref=198214310eb45b86707f823ccb5a2d65c814b528",
                "patch": "@@ -14,6 +14,7 @@\n import org.keycloak.quarkus.runtime.cli.command.Build;\n import org.keycloak.quarkus.runtime.cli.command.ShowConfig;\n import org.keycloak.quarkus.runtime.configuration.DisabledMappersInterceptor;\n+import org.keycloak.quarkus.runtime.configuration.MicroProfileConfigProvider;\n import org.keycloak.quarkus.runtime.configuration.PersistedConfigSource;\n \n import java.util.ArrayList;\n@@ -36,14 +37,14 @@\n import static org.keycloak.quarkus.runtime.configuration.KeycloakConfigSourceProvider.isKeyStoreConfigSource;\n \n public final class PropertyMappers {\n-    \n+\n     public static final String KC_SPI_PREFIX = \"kc.spi\";\n     public static String VALUE_MASK = \"*******\";\n     private static MappersConfig MAPPERS;\n     private static final Logger log = Logger.getLogger(PropertyMappers.class);\n \n     private PropertyMappers(){}\n-    \n+\n     static {\n         reset();\n     }\n@@ -74,13 +75,28 @@ public static void reset() {\n     }\n \n     public static ConfigValue getValue(ConfigSourceInterceptorContext context, String name) {\n-        return getMapperOrDefault(name, PropertyMapper.IDENTITY).getConfigValue(name, context);\n+        PropertyMapper<?> mapper = getMapper(name);\n+        // during re-aug do not resolve the server runtime properties and avoid they included by quarkus in the default value config source\n+        if ((isRebuild() || Environment.isRebuildCheck()) && isKeycloakRuntime(name, mapper)) {\n+            return ConfigValue.builder().withName(name).build();\n+        }\n+        if (mapper == null) {\n+            return context.proceed(name);\n+        }\n+        return mapper.getConfigValue(name, context);\n     }\n \n     public static boolean isSpiBuildTimeProperty(String name) {\n         return name.startsWith(KC_SPI_PREFIX) && (name.endsWith(\"-provider\") || name.endsWith(\"-enabled\") || name.endsWith(\"-provider-default\"));\n     }\n \n+    private static boolean isKeycloakRuntime(String name, PropertyMapper<?> mapper) {\n+        if (mapper == null) {\n+            return name.startsWith(MicroProfileConfigProvider.NS_KEYCLOAK) && !isSpiBuildTimeProperty(name);\n+        }\n+        return mapper.isRunTime();\n+    }\n+\n     public static Map<OptionCategory, List<PropertyMapper<?>>> getRuntimeMappers() {\n         return MAPPERS.getRuntimeMappers();\n     }\n@@ -150,10 +166,6 @@ private static PropertyMapper<?> getMapperOrDefault(String property, PropertyMap\n         };\n     }\n \n-    private static PropertyMapper<?> getMapperOrDefault(String property, PropertyMapper<?> defaultMapper) {\n-        return getMapperOrDefault(property, defaultMapper, null);\n-    }\n-\n     public static PropertyMapper<?> getMapper(String property, OptionCategory category) {\n         return getMapperOrDefault(property, null, category);\n     }\n@@ -172,7 +184,9 @@ public static boolean isSupported(PropertyMapper<?> mapper) {\n     }\n \n     public static Optional<PropertyMapper<?>> getDisabledMapper(String property) {\n-        if (property == null) return Optional.empty();\n+        if (property == null) {\n+            return Optional.empty();\n+        }\n \n         PropertyMapper<?> mapper = getDisabledBuildTimeMappers().get(property);\n         if (mapper == null) {"
            },
            {
                "sha": "c7645f89972fc533478352324a3aa6aaa675ecec",
                "filename": "quarkus/tests/integration/src/test/java/org/keycloak/it/cli/dist/StartCommandDistTest.java",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/keycloak/keycloak/blob/198214310eb45b86707f823ccb5a2d65c814b528/quarkus%2Ftests%2Fintegration%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Fit%2Fcli%2Fdist%2FStartCommandDistTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/198214310eb45b86707f823ccb5a2d65c814b528/quarkus%2Ftests%2Fintegration%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Fit%2Fcli%2Fdist%2FStartCommandDistTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/quarkus%2Ftests%2Fintegration%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Fit%2Fcli%2Fdist%2FStartCommandDistTest.java?ref=198214310eb45b86707f823ccb5a2d65c814b528",
                "patch": "@@ -247,4 +247,24 @@ void testInvalidConfigFileOption(CLIResult cliResult) {\n         cliResult.assertError(\"File specified via '--config-file' or '-cf' option does not exist.\");\n         cliResult.assertError(String.format(\"Try '%s --help' for more information on the available options.\", KeycloakDistribution.SCRIPT_CMD));\n     }\n+\n+    @RawDistOnly(reason = \"Containers are immutable\")\n+    @Test\n+    void testRuntimeValuesAreNotCaptured(KeycloakDistribution dist) {\n+        // confirm that the invalid value prevents startup - if this passes, then we need to use a different\n+        // spi provider\n+        CLIResult cliResult = dist.run(\"start\", \"--spi-events-listener-jboss-logging-success-level=invalid\", \"--http-enabled\", \"true\", \"--hostname-strict\", \"false\");\n+        cliResult.assertError(\"Failed to start quarkus\");\n+\n+        // if there was no auto-build use an explicit build to potentially capture the runtime default\n+        if (!cliResult.getOutput().contains(\"Server configuration updated and persisted\")) {\n+            cliResult = dist.run(\"build\", \"--spi-events-listener-jboss-logging-success-level=invalid\");\n+            cliResult.assertBuild();\n+        }\n+\n+        // the invalid value should not be the default\n+        cliResult = dist.run(\"start\", \"--http-enabled\", \"true\", \"--hostname-strict\", \"false\");\n+        cliResult.assertNoBuild();\n+        cliResult.assertStarted();\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/5d6c91f3309db468b0fe4834e88c3d25649f73e4",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/5d6c91f3309db468b0fe4834e88c3d25649f73e4",
        "html_url": "https://github.com/keycloak/keycloak/commit/5d6c91f3309db468b0fe4834e88c3d25649f73e4",
        "message": "EMBARGOED CVE-2024-10270 org.keycloak/keycloak-services: Keycloak Denial of Service (#35218)\n\nCloses #CVE-2024-10270\r\n\r\nSigned-off-by: Douglas Palmer <dpalmer@redhat.com>",
        "files": [
            {
                "sha": "d3000ed0fe3744ac3c895b7885a98cad3e0558f8",
                "filename": "services/src/main/java/org/keycloak/utils/SearchQueryUtils.java",
                "status": "modified",
                "additions": 68,
                "deletions": 18,
                "changes": 86,
                "blob_url": "https://github.com/keycloak/keycloak/blob/5d6c91f3309db468b0fe4834e88c3d25649f73e4/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Futils%2FSearchQueryUtils.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/5d6c91f3309db468b0fe4834e88c3d25649f73e4/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Futils%2FSearchQueryUtils.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Futils%2FSearchQueryUtils.java?ref=5d6c91f3309db468b0fe4834e88c3d25649f73e4",
                "patch": "@@ -19,36 +19,86 @@\n \n import java.util.HashMap;\n import java.util.Map;\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n \n /**\n  * @author Vaclav Muzikar <vmuzikar@redhat.com>\n  */\n public class SearchQueryUtils {\n-    public static final Pattern queryPattern = Pattern.compile(\"\\\\s*(?:(?<name>[^\\\"][^: ]+|.)|\\\"(?<nameEsc>(?:\\\\\\\\.|[^\\\\\\\\\\\"])+)\\\"):(?:(?<value>[^\\\"][^ ]*)|\\\"(?<valueEsc>(?:\\\\\\\\.|[^\\\\\\\\\\\"])+)\\\")\\\\s*\");\n-    public static final Pattern escapedCharsPattern = Pattern.compile(\"\\\\\\\\(.)\");\n \n     public static Map<String, String> getFields(final String query) {\n-        Matcher matcher = queryPattern.matcher(query);\n         Map<String, String> ret = new HashMap<>();\n-        while (matcher.find()) {\n-            String name = matcher.group(\"name\");\n-            if (name == null) {\n-                name = unescape(matcher.group(\"nameEsc\"));\n+        char[] chars = query.trim().toCharArray();\n+        for (int i = 0; i < chars.length; i++) {\n+            boolean inQuotes = false;\n+            boolean internal = false;\n+            String name = \"\";\n+            while (i < chars.length && chars[i] != ':') {\n+                if (chars[i] == '\\\\') {\n+                    if (chars[i+1] == '\\\"') {\n+                        i++;\n+                    }\n+                    else if (chars[i+1] == '\\\\') {\n+                        i+=2;\n+                        continue;\n+                    }\n+                }\n+                else if (chars[i] == '\\\"') {\n+                        if(!inQuotes && name.length() > 0) {\n+                            internal = true;\n+                        }\n+                        else if(internal) {\n+                            internal = false;\n+                        }\n+                        else {\n+                            inQuotes = !inQuotes;\n+                            i++;\n+                            continue;\n+                        }\n+                }\n+                else if(chars[i] == ' ' && !inQuotes) {\n+                    break;\n+                }\n+                name += chars[i];\n+                i++;\n             }\n-\n-            String value = matcher.group(\"value\");\n-            if (value == null) {\n-                value = unescape(matcher.group(\"valueEsc\"));\n+            if(i == chars.length || chars[i] == ' ') {\n+                continue;\n+            }\n+            i++;\n+            inQuotes = false;\n+            internal = false;\n+            String value = \"\";\n+            while (i < chars.length) {\n+                if (chars[i] == '\\\\') {\n+                    if (chars[i+1] == '\\\"') {\n+                        i++;\n+                    }\n+                    else if (chars[i+1] == '\\\\') {\n+                        i+=2;\n+                        continue;\n+                    }\n+                }\n+                else if (chars[i] == '\\\"') {\n+                    if(!inQuotes && value.length() > 0) {\n+                        internal = true;\n+                    }\n+                    else if(internal) {\n+                        internal = false;\n+                    }\n+                    else {\n+                        inQuotes = !inQuotes;\n+                        i++;\n+                        continue;\n+                    }\n+                }\n+                else if(chars[i] == ' ' && !inQuotes) {\n+                    break;\n+                }\n+                value += chars[i];\n+                i++;\n             }\n-\n             ret.put(name, value);\n         }\n         return ret;\n     }\n-\n-    public static String unescape(final String escaped) {\n-        return escapedCharsPattern.matcher(escaped).replaceAll(\"$1\");\n-    }\n }"
            },
            {
                "sha": "35a03fd6914edeb3400b0c6a747197afbb183d79",
                "filename": "services/src/test/java/org/keycloak/utils/SearchQueryUtilsTest.java",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/keycloak/keycloak/blob/5d6c91f3309db468b0fe4834e88c3d25649f73e4/services%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Futils%2FSearchQueryUtilsTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/5d6c91f3309db468b0fe4834e88c3d25649f73e4/services%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Futils%2FSearchQueryUtilsTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Futils%2FSearchQueryUtilsTest.java?ref=5d6c91f3309db468b0fe4834e88c3d25649f73e4",
                "patch": "@@ -23,6 +23,7 @@\n import java.util.Map;\n \n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n \n /**\n  * @author Vaclav Muzikar <vmuzikar@redhat.com>\n@@ -78,4 +79,15 @@ private void testParseQuery(String query, String... expectedStr) {\n \n         assertEquals(expected, actual);\n     }\n+\n+    @Test\n+    public void testReDoS() {\n+        long start = System.currentTimeMillis();\n+        int count = 50000;\n+        for (int i = 0; i < count; i++) {\n+            SearchQueryUtils.getFields(\" \".repeat(1443) + \"\\n\\n\".repeat(1443) + 0);\n+        }\n+        long end = System.currentTimeMillis() - start;\n+        System.out.println(\"took: \" + end + \" milliseconds\");\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/django-ansible-base/commits/845b3e1838cc0762a7f9f3e0379c5274519d9a44",
        "url": "https://api.github.com/repos/ansible/django-ansible-base/commits/845b3e1838cc0762a7f9f3e0379c5274519d9a44",
        "html_url": "https://github.com/ansible/django-ansible-base/commit/845b3e1838cc0762a7f9f3e0379c5274519d9a44",
        "message": "feat(oauth2_provider): check for OAuth2ScopePermission on all APIViews (#636)\n\nAdd a check for OAuth2ScopePermission on all active views in an\r\napplication.\r\n- ANSIBLE_BASE_OAUTH2_PROVIDER_PERMISSIONS_CHECK_IGNORED_VIEWS django\r\nsetting\r\n  for setting ignores by class path.\r\n- Uses django's check framework, should be compatible with the related\r\n  functionality.\r\n- Set as a deployment check, so it will not block app startup.\r\n\r\nAAP-26507",
        "files": [
            {
                "sha": "1632a4b212900aca57df5f31a57154fedc0b0a51",
                "filename": "ansible_base/authentication/views/authenticator_users.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Fauthentication%2Fviews%2Fauthenticator_users.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Fauthentication%2Fviews%2Fauthenticator_users.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Fauthentication%2Fviews%2Fauthenticator_users.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -7,7 +7,7 @@\n from django.http import Http404\n \n from ansible_base.authentication.models import Authenticator\n-from ansible_base.lib.utils.views.permissions import IsSuperuserOrAuditor\n+from ansible_base.lib.utils.views.permissions import IsSuperuserOrAuditor, try_add_oauth2_scope_permission\n \n logger = logging.getLogger('ansible_base.authentication.views.authenticator_users')\n \n@@ -22,7 +22,7 @@ def get_authenticator_user_view():\n             raise ModuleNotFoundError()\n \n         class AuthenticatorPluginRelatedUsersView(user_viewset_view):\n-            permission_classes = [IsSuperuserOrAuditor]\n+            permission_classes = try_add_oauth2_scope_permission([IsSuperuserOrAuditor])\n \n             def get_queryset(self, **kwargs):\n                 # during unit testing we get the pk from kwargs"
            },
            {
                "sha": "420b6623fdb7baa2ae7228da6d4129b7fbd02358",
                "filename": "ansible_base/lib/dynamic_config/dynamic_urls.py",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Flib%2Fdynamic_config%2Fdynamic_urls.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Flib%2Fdynamic_config%2Fdynamic_urls.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Flib%2Fdynamic_config%2Fdynamic_urls.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -10,12 +10,14 @@\n for url_type in url_types:\n     globals()[url_type] = []\n \n-for app in getattr(settings, 'INSTALLED_APPS', []):\n+installed_apps = getattr(settings, 'INSTALLED_APPS', [])\n+for app in installed_apps:\n     if app.startswith('ansible_base.'):\n         if not importlib.util.find_spec(f'{app}.urls'):\n             logger.debug(f'Module {app} does not specify urls.py')\n             continue\n         url_module = __import__(f'{app}.urls', fromlist=url_types)\n         logger.debug(f'Including URLS from {app}.urls')\n         for url_type in ['api_version_urls', 'root_urls', 'api_urls']:\n-            globals()[url_type].extend(getattr(url_module, url_type, []))\n+            urls = getattr(url_module, url_type, [])\n+            globals()[url_type].extend(urls)"
            },
            {
                "sha": "daaecf788c7cc01dac46d9419b72c5d21d0b3680",
                "filename": "ansible_base/lib/dynamic_config/settings_logic.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Flib%2Fdynamic_config%2Fsettings_logic.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Flib%2Fdynamic_config%2Fsettings_logic.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Flib%2Fdynamic_config%2Fsettings_logic.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -283,6 +283,8 @@ def get_dab_settings(\n \n         dab_data['ALLOW_OAUTH2_FOR_EXTERNAL_USERS'] = False\n \n+        dab_data['ANSIBLE_BASE_OAUTH2_PROVIDER_PERMISSIONS_CHECK_DEFAULT_IGNORED_VIEWS'] = []\n+\n     if caches is not None:\n         dab_data['CACHES'] = copy(caches)\n         # Ensure proper configuration for fallback cache"
            },
            {
                "sha": "e318fd3f7935774306e329ff3662f05ac68af7d6",
                "filename": "ansible_base/lib/utils/views/permissions.py",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Flib%2Futils%2Fviews%2Fpermissions.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Flib%2Futils%2Fviews%2Fpermissions.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Flib%2Futils%2Fviews%2Fpermissions.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -1,5 +1,25 @@\n from rest_framework.permissions import SAFE_METHODS, BasePermission\n \n+from ansible_base.lib.utils.settings import get_setting\n+\n+oauth2_provider_installed = \"ansible_base.oauth2_provider\" in get_setting(\"INSTALLED_APPS\", [])\n+\n+\n+def try_add_oauth2_scope_permission(permission_classes: list):\n+    \"\"\"\n+    Attach OAuth2ScopePermission to the provided permission_classes list\n+\n+    :param permission_classes: list of rest_framework permissions\n+    :return: A list of permission_classes, including OAuth2ScopePermission\n+        if ansible_base.oauth2_provider is installed; otherwise the same\n+        permission_classes list supplied to the function\n+    \"\"\"\n+    if oauth2_provider_installed:\n+        from ansible_base.oauth2_provider.permissions import OAuth2ScopePermission\n+\n+        return [OAuth2ScopePermission] + permission_classes\n+    return permission_classes\n+\n \n class IsSuperuser(BasePermission):\n     \"\"\""
            },
            {
                "sha": "adfcadbda34693e5a9cf147d41693e788f666050",
                "filename": "ansible_base/lib/utils/views/urls.py",
                "status": "added",
                "additions": 24,
                "deletions": 0,
                "changes": 24,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Flib%2Futils%2Fviews%2Furls.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Flib%2Futils%2Fviews%2Furls.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Flib%2Futils%2Fviews%2Furls.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -0,0 +1,24 @@\n+from typing import Type\n+\n+from rest_framework.schemas.generators import EndpointEnumerator\n+from rest_framework.views import APIView\n+\n+\n+def get_api_view_functions(urlpatterns=None) -> set[Type[APIView]]:\n+    \"\"\"\n+    Extract view classes from a urlpatterns list using the show_urls helper functions\n+\n+    :param urlpatterns: django urlpatterns list\n+    :return: set of all view classes used by the urlpatterns list\n+    \"\"\"\n+    views = set()\n+\n+    enumerator = EndpointEnumerator()\n+    # Get all active APIViews from urlconf\n+    endpoints = enumerator.get_api_endpoints(patterns=urlpatterns)\n+    for _, _, func in endpoints:\n+        # ApiView.as_view() breadcrumb\n+        if hasattr(func, 'cls'):\n+            views.add(func.cls)\n+\n+    return views"
            },
            {
                "sha": "44a489ef31d515728c99929d79072aab86b158bf",
                "filename": "ansible_base/oauth2_provider/apps.py",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fapps.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fapps.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Foauth2_provider%2Fapps.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -1,7 +1,14 @@\n from django.apps import AppConfig\n+from django.core.checks import register\n \n \n class Oauth2ProviderConfig(AppConfig):\n     default_auto_field = 'django.db.models.BigAutoField'\n     name = 'ansible_base.oauth2_provider'\n     label = 'dab_oauth2_provider'\n+\n+    def ready(self):\n+        # Load checks\n+        from ansible_base.oauth2_provider.checks.permisssions_check import oauth2_permission_scope_check\n+\n+        register(oauth2_permission_scope_check, \"oauth2_permissions\", deploy=True)"
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "ansible_base/oauth2_provider/checks/__init__.py",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fchecks%2F__init__.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fchecks%2F__init__.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Foauth2_provider%2Fchecks%2F__init__.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44"
            },
            {
                "sha": "495b23163a05f8a776cc39f5015dca95b9d3d52c",
                "filename": "ansible_base/oauth2_provider/checks/permisssions_check.py",
                "status": "added",
                "additions": 153,
                "deletions": 0,
                "changes": 153,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fchecks%2Fpermisssions_check.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fchecks%2Fpermisssions_check.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Foauth2_provider%2Fchecks%2Fpermisssions_check.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -0,0 +1,153 @@\n+from typing import Iterable, Optional, Type, Union\n+\n+from django.apps import AppConfig\n+from django.conf import settings\n+from django.core.checks import CheckMessage, Debug, Error, Warning\n+from rest_framework.permissions import AllowAny, OperandHolder, OperationHolderMixin, SingleOperandHolder\n+from rest_framework.views import APIView\n+\n+from ansible_base.lib.utils.views.urls import get_api_view_functions\n+from ansible_base.oauth2_provider.permissions import OAuth2ScopePermission\n+\n+\n+class OAuth2ScopePermissionCheck:\n+    \"\"\"\n+    Class containing logic for checking view classes for the\n+    OAuth2ScopePermission permission_class, and aggregating\n+    CheckMessage's for django system checks.\n+\n+    :param ignore_list: List of python import path strings for view classes exempt from the check logic.\n+    :type ignore_list: list\n+    \"\"\"\n+\n+    def __init__(self, ignore_list: Iterable[str], generate_check_messages=True):\n+        self.messages: list[CheckMessage] = []\n+        self.current_view: Optional[Type[APIView]] = None\n+        self.ignore_list = ignore_list\n+        self.generate_check_messages = generate_check_messages\n+\n+    def check_message(self, message: CheckMessage):\n+        if self.generate_check_messages:\n+            self.messages.append(message)\n+\n+    # These are all warning or error conditions, this function is mostly saying to not invert OAuth2ScopePermissions\n+    # Returns False.\n+    def process_single_operand_holder(self, operand_holder: SingleOperandHolder) -> bool:\n+        # The only unary operand for permission classes provided by rest_framework is ~ (not)\n+        if self.parse_permission_class(operand_holder.op1_class):\n+            self.check_message(\n+                Warning(\n+                    \"~ (not) operand used on OAuth2ScopePermission, probably a bad idea.\",\n+                    id=\"ansible_base.oauth2_provider.W001\",\n+                    obj=self.current_view,\n+                )\n+            )\n+\n+        return False\n+\n+    def process_operand_holder(self, operand_holder: OperandHolder) -> bool:\n+        return self.parse_permission_class(operand_holder.op1_class) or self.parse_permission_class(operand_holder.op2_class)\n+\n+    # Check if permission class is present in nested operands\n+    # Sort of recursive? Reasonably this should not be an issue, so long as we don't recurse on an unknown OperationHolderMixin type\n+    def parse_permission_class(self, cls: Union[Type[OperationHolderMixin], OperationHolderMixin]) -> bool:\n+        # First, most likely case, we're dealing with a BasePermission subclass.\n+        if cls is OAuth2ScopePermission:\n+            return True\n+        elif isinstance(cls, SingleOperandHolder):\n+            # Warning or Error case: Will not accept OAuth2 permission nested in NOT\n+            return self.process_single_operand_holder(cls)\n+        elif isinstance(cls, OperandHolder):\n+            return self.process_operand_holder(cls)\n+        return False\n+\n+    def check_view(self, view_class: Type[APIView]) -> bool:\n+        \"\"\"\n+        Primary function of the OAuth2ScopePermissionCheck.\n+\n+        Checks if OAuth2ScopePermission is present on the supplied view's\n+        permission_classes; ignores classes that are not APIViews, or that are\n+        in the ignore_list.\n+\n+        Appends CheckMessages to self.messages as a side effect.\n+\n+        :param view_class: django View class or rest_framework ApiView class\n+\n+        :return: True if view_class uses the OAuth2ScopePermission permission\n+            class, or has some mitigating circumstance that prohibits it, such as\n+            view_class not using permission classes, or its import path being in\n+            self.ignore_list; returns False otherwise.\n+        \"\"\"\n+        if f\"{view_class.__module__}.{view_class.__name__}\" in self.ignore_list:\n+            self.check_message(\n+                Debug(\n+                    \"View class in the ignore list. Ignoring.\",\n+                    obj=view_class,\n+                    id=\"ansible_base.oauth2_provider.D03\",\n+                )\n+            )\n+            return True\n+\n+        self.current_view = view_class\n+\n+        for permission_class in getattr(self.current_view, \"permission_classes\", []):\n+            if self.parse_permission_class(permission_class):\n+                self.check_message(\n+                    Debug(\n+                        \"Found OAuth2ScopePermission permission_class\",\n+                        obj=self.current_view,\n+                        id=\"ansible_base.oauth2_provider.D02\",\n+                    )\n+                )\n+                return True\n+\n+        if not self.current_view.permission_classes or AllowAny in self.current_view.permission_classes:\n+            self.check_message(\n+                Debug(\n+                    \"View object is fully permissive, OAuth2ScopePermission is not required\",\n+                    obj=self.current_view,\n+                    id=\"ansible_base.oauth2_provider.D04\",\n+                )\n+            )\n+            return True\n+\n+        # if we went though the whole loop without finding a valid permission_class, raise an error\n+        self.check_message(\n+            Error(\n+                \"View class has no valid usage of OAuth2ScopePermission\",\n+                obj=self.current_view,\n+                id=\"ansible_base.oauth2_provider.E002\",\n+            )\n+        )\n+        return False\n+\n+\n+def view_in_app_configs(view_class: type, app_configs: Optional[list[AppConfig]]) -> bool:\n+    if app_configs:\n+        for app_config in app_configs:\n+            if view_class.__module__.startswith(app_config.name):\n+                return True\n+        return False\n+    return True\n+\n+\n+def oauth2_permission_scope_check(app_configs: Optional[list[AppConfig]], **kwargs) -> list[CheckMessage]:\n+    \"\"\"\n+    Check for OAuth2ScopePermission permission class on all enabled views.\n+\n+    Ignore views in the ANSIBLE_BASE_OAUTH2_PROVIDER_PERMISSIONS_CHECK_IGNORED_VIEWS setting\n+    \"\"\"\n+    ignore_list = set(\n+        getattr(settings, \"ANSIBLE_BASE_OAUTH2_PROVIDER_PERMISSIONS_CHECK_DEFAULT_IGNORED_VIEWS\", [])\n+        + getattr(settings, \"ANSIBLE_BASE_OAUTH2_PROVIDER_PERMISSIONS_CHECK_IGNORED_VIEWS\", [])\n+    )\n+\n+    check = OAuth2ScopePermissionCheck(ignore_list)\n+\n+    view_functions = get_api_view_functions()\n+    for view in view_functions:\n+        # Only run checks on included apps (or all if app_configs is None)\n+        if view_in_app_configs(view, app_configs):\n+            check.check_view(view)\n+\n+    return check.messages"
            },
            {
                "sha": "54265019b3b68cbd6ee75c397ac35e75afef1692",
                "filename": "ansible_base/oauth2_provider/views/application.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fviews%2Fapplication.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fviews%2Fapplication.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Foauth2_provider%2Fviews%2Fapplication.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -3,10 +3,11 @@\n from ansible_base.lib.utils.views.django_app_api import AnsibleBaseDjangoAppApiView\n from ansible_base.lib.utils.views.permissions import IsSuperuserOrAuditor\n from ansible_base.oauth2_provider.models import OAuth2Application\n+from ansible_base.oauth2_provider.permissions import OAuth2ScopePermission\n from ansible_base.oauth2_provider.serializers import OAuth2ApplicationSerializer\n \n \n class OAuth2ApplicationViewSet(AnsibleBaseDjangoAppApiView, ModelViewSet):\n     queryset = OAuth2Application.objects.all()\n     serializer_class = OAuth2ApplicationSerializer\n-    permission_classes = [IsSuperuserOrAuditor]\n+    permission_classes = [OAuth2ScopePermission, IsSuperuserOrAuditor]"
            },
            {
                "sha": "a1801e96a0e0a1614b0488ee383e806facffb519",
                "filename": "ansible_base/oauth2_provider/views/token.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fviews%2Ftoken.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Foauth2_provider%2Fviews%2Ftoken.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Foauth2_provider%2Fviews%2Ftoken.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -10,6 +10,7 @@\n from ansible_base.lib.utils.settings import get_setting\n from ansible_base.lib.utils.views.django_app_api import AnsibleBaseDjangoAppApiView\n from ansible_base.oauth2_provider.models import OAuth2AccessToken, OAuth2RefreshToken\n+from ansible_base.oauth2_provider.permissions import OAuth2ScopePermission\n from ansible_base.oauth2_provider.serializers import OAuth2TokenSerializer\n from ansible_base.oauth2_provider.views.permissions import OAuth2TokenPermission\n \n@@ -73,4 +74,4 @@ def create_token_response(self, request):\n class OAuth2TokenViewSet(ModelViewSet, AnsibleBaseDjangoAppApiView):\n     queryset = OAuth2AccessToken.objects.all()\n     serializer_class = OAuth2TokenSerializer\n-    permission_classes = [OAuth2TokenPermission]\n+    permission_classes = [OAuth2ScopePermission, OAuth2TokenPermission]"
            },
            {
                "sha": "bb840eafebd918f86b920a8ce7618a39a3627d02",
                "filename": "ansible_base/rbac/api/views.py",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Frbac%2Fapi%2Fviews.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Frbac%2Fapi%2Fviews.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Frbac%2Fapi%2Fviews.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -11,6 +11,7 @@\n from rest_framework.viewsets import ModelViewSet\n \n from ansible_base.lib.utils.views.django_app_api import AnsibleBaseDjangoAppApiView\n+from ansible_base.lib.utils.views.permissions import try_add_oauth2_scope_permission\n from ansible_base.rbac.api.permissions import RoleDefinitionPermissions\n from ansible_base.rbac.api.serializers import (\n     RoleDefinitionDetailSerializer,\n@@ -44,7 +45,7 @@ class RoleMetadataView(AnsibleBaseDjangoAppApiView, GenericAPIView):\n     allowed_permissions: Valid permissions for a role of a given content_type\n     \"\"\"\n \n-    permission_classes = [permissions.IsAuthenticated]\n+    permission_classes = try_add_oauth2_scope_permission([permissions.IsAuthenticated])\n     serializer_class = RoleMetadataSerializer\n \n     def get(self, request, format=None):\n@@ -88,7 +89,7 @@ class RoleDefinitionViewSet(AnsibleBaseDjangoAppApiView, ModelViewSet):\n \n     queryset = RoleDefinition.objects.prefetch_related('created_by', 'modified_by', 'content_type', 'permissions')\n     serializer_class = RoleDefinitionSerializer\n-    permission_classes = [RoleDefinitionPermissions]\n+    permission_classes = try_add_oauth2_scope_permission([RoleDefinitionPermissions])\n \n     def get_serializer_class(self):\n         if self.action == 'update':\n@@ -112,7 +113,7 @@ def perform_destroy(self, instance):\n \n \n class BaseAssignmentViewSet(AnsibleBaseDjangoAppApiView, ModelViewSet):\n-    permission_classes = [permissions.IsAuthenticated]\n+    permission_classes = try_add_oauth2_scope_permission([permissions.IsAuthenticated])\n     # PUT and PATCH are not allowed because these are immutable\n     http_method_names = ['get', 'post', 'head', 'options', 'delete']\n     prefetch_related = ()"
            },
            {
                "sha": "29c3342b0d060d0ed110af0a3c5a8684620d3a4c",
                "filename": "ansible_base/resource_registry/views.py",
                "status": "modified",
                "additions": 12,
                "deletions": 7,
                "changes": 19,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Fresource_registry%2Fviews.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/ansible_base%2Fresource_registry%2Fviews.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/ansible_base%2Fresource_registry%2Fviews.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -13,6 +13,7 @@\n \n from ansible_base.lib.utils.response import CSVStreamResponse, get_relative_url\n from ansible_base.lib.utils.views.django_app_api import AnsibleBaseDjangoAppApiView\n+from ansible_base.lib.utils.views.permissions import try_add_oauth2_scope_permission\n from ansible_base.resource_registry.models import Resource, ResourceType, service_id\n from ansible_base.resource_registry.registry import get_registry\n from ansible_base.resource_registry.serializers import ResourceListSerializer, ResourceSerializer, ResourceTypeSerializer, UserAuthenticationSerializer\n@@ -66,9 +67,11 @@ class ResourceAPIMixin:\n     \"\"\"\n \n     filter_backends = (FieldLookupBackend, TypeFilterBackend, OrderByBackend)\n-    permission_classes = [\n-        HasResourceRegistryPermissions,\n-    ]\n+    permission_classes = try_add_oauth2_scope_permission(\n+        [\n+            HasResourceRegistryPermissions,\n+        ]\n+    )\n     pagination_class = ResourcesPagination\n \n \n@@ -153,9 +156,11 @@ def manifest(self, request, name, *args, **kwargs):\n class ServiceMetadataView(\n     AnsibleBaseDjangoAppApiView,\n ):\n-    permission_classes = [\n-        HasResourceRegistryPermissions,\n-    ]\n+    permission_classes = try_add_oauth2_scope_permission(\n+        [\n+            HasResourceRegistryPermissions,\n+        ]\n+    )\n \n     # Corresponds to viewset action but given a different name so schema generators are not messed up\n     custom_action_label = \"service-metadata\"\n@@ -166,7 +171,7 @@ def get(self, request, **kwargs):\n \n \n class ServiceIndexRootView(AnsibleBaseDjangoAppApiView):\n-    permission_classes = [permissions.IsAuthenticated]\n+    permission_classes = try_add_oauth2_scope_permission([permissions.IsAuthenticated])\n \n     def get(self, request, format=None):\n         '''Link other resource registry endpoints'''"
            },
            {
                "sha": "eadeb73cd164ade723000e61626b9207b87f08dd",
                "filename": "docs/apps/oauth2_provider.md",
                "status": "modified",
                "additions": 46,
                "deletions": 0,
                "changes": 46,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/docs%2Fapps%2Foauth2_provider.md",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/docs%2Fapps%2Foauth2_provider.md",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/docs%2Fapps%2Foauth2_provider.md?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -136,6 +136,52 @@ curl -H \"Authorization: Bearer <token-value>\" -X DELETE https://<service>/api/to\n ```\n \n \n+## OAuth2ScopePermission Check\n+\n+ansible_base.oauth2_provider defines a system check that checks all APIView\n+classes for an instance of OAuth2ScopePermission in its permission_classes\n+attribute.\n+\n+### Running the check\n+\n+You can run the check by running the management command:\n+`check --deploy --tag oauth2_permissions`.\n+\n+Examples:\n+```shell\n+# Run check for on all view classes enabled for the application\n+./manage.py check --deploy --tag oauth2_permissions\n+# Using the django-admin executable\n+django-admin check --deploy --tag oauth2_permissions\n+# For only checking views defined by the test app django application\n+django-admin check --deploy --tag oauth2_permissions test_app\n+```\n+\n+### Ignoring Views\n+\n+Some views do not need OAuth2ScopePermission, such as when the AllowAny\n+permission class is used by the APIView class; Adding OAuth2ScopePermission\n+will only break the view in this case.\n+\n+For such cases, a ANSIBLE_BASE_OAUTH2_PROVIDER_PERMISSIONS_CHECK_IGNORED_VIEWS exists\n+to set ignores for views by their module path. For DAB views, these ignores\n+should be set automatically via dynamic settings logic. To add more ignores,\n+you can set the ignore list in your settings.py prior to calling the dynamic\n+settings logic:\n+\n+```python\n+ANSIBLE_BASE_OAUTH2_PROVIDER_PERMISSIONS_CHECK_IGNORED_VIEWS = [\n+    'ansible_base.resource_registry.views.ValidateLocalUserView',\n+    'test_app.views.SomeOtherViewSet',\n+]\n+```\n+\n+To clear ignores, change the default ignores list after calling the dynamic\n+settings logic:\n+```python\n+ANSIBLE_BASE_OAUTH2_PROVIDER_PERMISSIONS_CHECK_DEFAULT_IGNORED_VIEWS = []\n+```\n+\n ## More Information\n \n #### Managing OAuth2 Applications and Tokens"
            },
            {
                "sha": "9b6935496f79351cc56fcb83110fabeb615a82b0",
                "filename": "test_app/settings.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/test_app%2Fsettings.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/test_app%2Fsettings.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/test_app%2Fsettings.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -185,6 +185,7 @@\n ANSIBLE_BASE_JWT_MANAGED_ROLES.append(\"System Auditor\")  # noqa: F821 this is set by dynamic settings for jwt_consumer\n ANSIBLE_BASE_ALLOW_SINGLETON_USER_ROLES = True\n ANSIBLE_BASE_ALLOW_SINGLETON_TEAM_ROLES = True\n+ANSIBLE_BASE_OAUTH2_PROVIDER_PERMISSIONS_CHECK_IGNORED_VIEWS = [\"drf_spectacular.views.SpectacularSwaggerView\"]\n ALLOW_SHARED_RESOURCE_CUSTOM_ROLES = True  # Allow making custom roles with org change permission, for example\n ALLOW_LOCAL_ASSIGNING_JWT_ROLES = False\n "
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "test_app/tests/oauth2_provider/checks/__init__.py",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/test_app%2Ftests%2Foauth2_provider%2Fchecks%2F__init__.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/test_app%2Ftests%2Foauth2_provider%2Fchecks%2F__init__.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/test_app%2Ftests%2Foauth2_provider%2Fchecks%2F__init__.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44"
            },
            {
                "sha": "42af85a17637c64b080562009976635491a43ba6",
                "filename": "test_app/tests/oauth2_provider/checks/test_permissions_check.py",
                "status": "added",
                "additions": 148,
                "deletions": 0,
                "changes": 148,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/test_app%2Ftests%2Foauth2_provider%2Fchecks%2Ftest_permissions_check.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/test_app%2Ftests%2Foauth2_provider%2Fchecks%2Ftest_permissions_check.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/test_app%2Ftests%2Foauth2_provider%2Fchecks%2Ftest_permissions_check.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -0,0 +1,148 @@\n+import copy\n+from typing import Type\n+from unittest import mock\n+\n+import pytest\n+from django.core.checks import Debug, Error, Warning\n+from django.core.management import call_command\n+from django.core.management.base import SystemCheckError\n+from django.urls import path\n+from drf_spectacular.views import SpectacularSwaggerView\n+from rest_framework.permissions import AllowAny\n+from rest_framework.views import APIView\n+\n+from ansible_base.authentication.authenticator_plugins.saml import SAMLMetadataView\n+from ansible_base.authentication.views.authenticator import AuthenticatorViewSet\n+from ansible_base.authentication.views.ui_auth import UIAuth\n+from ansible_base.lib.utils.views.urls import get_api_view_functions\n+from ansible_base.oauth2_provider.checks.permisssions_check import oauth2_permission_scope_check, view_in_app_configs\n+from ansible_base.resource_registry.views import ValidateLocalUserView\n+from test_app import views\n+\n+urlpatterns = [\n+    # APIView without OAuth2ScopePermission (needs patch)\n+    path('api/users/', views.UserViewSet.as_view({\"get\": \"list\"}), name='user-view'),\n+    # APIView with OAuth2ScopePermission (happy path)\n+    path('api/teams/', views.TeamViewSet.as_view({\"get\": \"list\"}), name='team-list'),\n+    # APIView with binary Operands (Needs patch)\n+    path('api/authenticators/', AuthenticatorViewSet.as_view({\"get\": \"list\"}), name=\"authenticator-list\"),\n+    # APIView with inverted OAuth2ScopePermission (need patch)\n+    path('api/organizations/', views.OrganizationViewSet.as_view({\"get\": \"list\"}), name=\"organization-list\"),\n+    # Ignored view (ignored in settings.py)\n+    path('/docs/', SpectacularSwaggerView.as_view()),\n+    # Fully permissive APIView (via empty permission classes)\n+    path('/ui-auth/', UIAuth.as_view()),\n+    # Fully permissive APIView (via AllowAny)\n+    path('/validate-users-view/', ValidateLocalUserView.as_view()),\n+    # Non-ApiView view\n+    path('/non-api-view/', SAMLMetadataView.as_view()),\n+]\n+\n+\n+@pytest.fixture\n+def missing_permissions_view_class():\n+    PatchedUserViewSet = copy.deepcopy(views.UserViewSet)\n+    PatchedUserViewSet.permission_classes = [~AllowAny]\n+    with mock.patch(\"test_app.views.UserViewSet\", PatchedUserViewSet):\n+        yield PatchedUserViewSet\n+\n+\n+@pytest.fixture\n+def inverted_permissions_view_class():\n+    from ansible_base.oauth2_provider.permissions import OAuth2ScopePermission\n+\n+    PatchedOrganizationViewSet = copy.deepcopy(views.OrganizationViewSet)\n+    PatchedOrganizationViewSet.permission_classes = [~OAuth2ScopePermission]\n+    with mock.patch(\"test_app.views.OrganizationViewSet\", PatchedOrganizationViewSet):\n+        yield PatchedOrganizationViewSet\n+\n+\n+@pytest.fixture\n+def nested_permissions_view_class():\n+    from ansible_base.oauth2_provider.permissions import OAuth2ScopePermission\n+\n+    PatchedAuthenticatorViewSet = copy.deepcopy(AuthenticatorViewSet)\n+    PatchedAuthenticatorViewSet.permission_classes = [OAuth2ScopePermission & AllowAny]\n+    with mock.patch(\"ansible_base.authentication.views.authenticator.AuthenticatorViewSet\", PatchedAuthenticatorViewSet):\n+        yield PatchedAuthenticatorViewSet\n+\n+\n+@mock.patch(\"test_app.urls.urlpatterns\", urlpatterns)\n+class TestOAuth2PermissionsCheck:\n+    def test_get_api_view_functions(self):\n+        expected_results = set([views.UserViewSet, views.TeamViewSet, views.OrganizationViewSet, AuthenticatorViewSet, SpectacularSwaggerView])\n+        result = set(get_api_view_functions(urlpatterns))\n+        # Confirm mock works\n+        assert views.TestAppViewSet not in result\n+\n+        # Roundabout way of asserting that the result equals the expected results,\n+        # but tracebacks will show missing results\n+        assert expected_results.intersection(result).difference(expected_results) == set(), \"Missing results from get_api_view_functions\"\n+\n+    # Test the check by calling the check\n+    def test_check_function(\n+        self, inverted_permissions_view_class: Type[APIView], nested_permissions_view_class: Type[APIView], missing_permissions_view_class: Type[APIView]\n+    ):\n+        expected_messages = [\n+            Debug(\n+                \"Found OAuth2ScopePermission permission_class\",\n+                id=\"ansible_base.oauth2_provider.D02\",\n+                obj=nested_permissions_view_class,\n+            ),\n+            Debug(\n+                \"Found OAuth2ScopePermission permission_class\",\n+                id=\"ansible_base.oauth2_provider.D02\",\n+                obj=views.TeamViewSet,\n+            ),\n+            Warning(\n+                \"~ (not) operand used on OAuth2ScopePermission, probably a bad idea.\",\n+                id=\"ansible_base.oauth2_provider.W001\",\n+                obj=inverted_permissions_view_class,\n+            ),\n+            Error(\n+                \"View class has no valid usage of OAuth2ScopePermission\",\n+                id=\"ansible_base.oauth2_provider.E002\",\n+                obj=missing_permissions_view_class,\n+            ),\n+            Debug(\n+                \"View class in the ignore list. Ignoring.\",\n+                id=\"ansible_base.oauth2_provider.D03\",\n+                obj=SpectacularSwaggerView,\n+            ),\n+            Debug(\n+                \"View object is fully permissive, OAuth2ScopePermission is not required\",\n+                obj=ValidateLocalUserView,\n+                id=\"ansible_base.oauth2_provider.D04\",\n+            ),\n+            Debug(\n+                \"View object is fully permissive, OAuth2ScopePermission is not required\",\n+                obj=UIAuth,\n+                id=\"ansible_base.oauth2_provider.D04\",\n+            ),\n+        ]\n+        # Call check function\n+        messages = oauth2_permission_scope_check(None)\n+        # Verify messages\n+        for message in expected_messages:\n+            assert message in messages, \"Missing message in check results\"\n+\n+    # Test the check by running the management command\n+    # I Cannot figure out how to mock the check to assert it is called, so this should suffice.\n+    @pytest.mark.parametrize(\n+        \"call_command_args\",\n+        (\n+            [\"--deploy\", \"--tag\", \"oauth2_permissions\"],\n+            [\"--deploy\", \"--tag\", \"oauth2_permissions\", \"test_app\"],\n+        ),\n+    )\n+    # Need to mock the helper function, since patch cannot find the registered check function itself\n+    @mock.patch(\"ansible_base.oauth2_provider.checks.permisssions_check.view_in_app_configs\", spec=view_in_app_configs)\n+    def test_call_check(self, mocked_helper_function: mock.Mock, call_command_args):\n+        try:\n+            call_command(\"check\", *call_command_args)\n+        except SystemCheckError:\n+            # Should fail with this error with the patched urlconf\n+            pass\n+        finally:\n+            # Assert that view_in_app_config helper called, which would mean the check was most likely called\n+            mocked_helper_function.assert_called()"
            },
            {
                "sha": "9b521d6e1d6e9742c3d27ff7d55d76d4cf3328ac",
                "filename": "test_app/views.py",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/ansible/django-ansible-base/blob/845b3e1838cc0762a7f9f3e0379c5274519d9a44/test_app%2Fviews.py",
                "raw_url": "https://github.com/ansible/django-ansible-base/raw/845b3e1838cc0762a7f9f3e0379c5274519d9a44/test_app%2Fviews.py",
                "contents_url": "https://api.github.com/repos/ansible/django-ansible-base/contents/test_app%2Fviews.py?ref=845b3e1838cc0762a7f9f3e0379c5274519d9a44",
                "patch": "@@ -11,6 +11,7 @@\n \n from ansible_base.lib.utils.response import get_fully_qualified_url\n from ansible_base.lib.utils.views.ansible_base import AnsibleBaseView\n+from ansible_base.oauth2_provider.permissions import OAuth2ScopePermission\n from ansible_base.oauth2_provider.views import DABOAuth2UserViewsetMixin\n from ansible_base.rbac import permission_registry\n from ansible_base.rbac.api.permissions import AnsibleBaseUserPermissions\n@@ -57,7 +58,7 @@ class TeamViewSet(TestAppViewSet):\n \n class UserViewSet(DABOAuth2UserViewsetMixin, TestAppViewSet):\n     queryset = models.User.objects.all()\n-    permission_classes = [AnsibleBaseUserPermissions]\n+    permission_classes = [OAuth2ScopePermission, AnsibleBaseUserPermissions]\n     serializer_class = serializers.UserSerializer\n     prefetch_related = ('created_by', 'modified_by', 'resource', 'resource__content_type')\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Zavy86/WikiDocs/commits/aa264bd046a254522da67600be73791bd4e5dafc",
        "url": "https://api.github.com/repos/Zavy86/WikiDocs/commits/aa264bd046a254522da67600be73791bd4e5dafc",
        "html_url": "https://github.com/Zavy86/WikiDocs/commit/aa264bd046a254522da67600be73791bd4e5dafc",
        "message": "adds multiple security features #211\n- adds security headers\n- adds better session cookies\n- adds session id regeneration to prevent fixation attacks\n- restricts katex options to prevent cross-site scripting attacks\n- adds SecurityFilters class to sanitize katex formulas",
        "files": [
            {
                "sha": "2b4b6cfb25100e7fdb5f6a24acf610e0d9c8113e",
                "filename": "bootstrap.inc.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Zavy86/WikiDocs/blob/aa264bd046a254522da67600be73791bd4e5dafc/bootstrap.inc.php",
                "raw_url": "https://github.com/Zavy86/WikiDocs/raw/aa264bd046a254522da67600be73791bd4e5dafc/bootstrap.inc.php",
                "contents_url": "https://api.github.com/repos/Zavy86/WikiDocs/contents/bootstrap.inc.php?ref=aa264bd046a254522da67600be73791bd4e5dafc",
                "patch": "@@ -20,6 +20,7 @@\n require_once(BASE.'classes/Localization.class.php');\r\n require_once(BASE.'classes/Document.class.php');\r\n require_once(BASE.'classes/Session.class.php');\r\n+require_once(BASE.'classes/SecurityFilters.class.php');\r\n \r\n // require external libraries\r\n require_once(BASE.\"libraries/parsedown-1.8.0-beta-6/Parsedown.php\");\r"
            },
            {
                "sha": "d6375ae4647ae58b1931fa873afca27db4060e40",
                "filename": "classes/SecurityFilters.class.php",
                "status": "added",
                "additions": 68,
                "deletions": 0,
                "changes": 68,
                "blob_url": "https://github.com/Zavy86/WikiDocs/blob/aa264bd046a254522da67600be73791bd4e5dafc/classes%2FSecurityFilters.class.php",
                "raw_url": "https://github.com/Zavy86/WikiDocs/raw/aa264bd046a254522da67600be73791bd4e5dafc/classes%2FSecurityFilters.class.php",
                "contents_url": "https://api.github.com/repos/Zavy86/WikiDocs/contents/classes%2FSecurityFilters.class.php?ref=aa264bd046a254522da67600be73791bd4e5dafc",
                "patch": "@@ -0,0 +1,68 @@\n+<?php\n+/**\n+ * SecurityFilters\n+ *\n+ * Collection of security filters for content sanitization\n+ */\n+class SecurityFilters {\n+    /**\n+     * Main filter method - applies all content filters\n+     *\n+     * @param string $content Content to filter\n+     * @return string Filtered content\n+     */\n+    public static function filterContent($content) {\n+        // apply katex filter\n+        $content = self::filterKaTeX($content);\n+        // add additional filters here as needed\n+        return $content;\n+    }\n+\n+    /**\n+     * KaTeX Filter\n+     */\n+    private static function filterKaTeX($content) {\n+        $blacklistedCommands = [\n+            '\\html',\n+            '\\htmlStyle',\n+            '\\href',\n+            '\\def',\n+            '\\newcommand',\n+            '\\renewcommand',\n+            '\\mathml',\n+            '\\style'\n+        ];\n+\n+        $blacklistedTags = [\n+            '<script',\n+            '<img',\n+            '<iframe',\n+            '<object',\n+            '<embed',\n+            '<math',\n+            '<svg',\n+            'javascript:',\n+            'data:',\n+            'vbscript:'\n+        ];\n+\n+        // extract and filter all katex blocks\n+        $pattern = '/\\$\\$(.*?)\\$\\$|\\$(.*?)\\$/s';\n+        return preg_replace_callback($pattern, function($matches) use ($blacklistedCommands, $blacklistedTags) {\n+            $math = !empty($matches[1]) ? $matches[1] : $matches[2];\n+            $isDisplay = !empty($matches[1]);\n+            // remove blacklisted commands\n+            foreach ($blacklistedCommands as $command) {\n+                $math = str_replace($command, '\\\\text{BLOCKED}', $math);\n+            }\n+            // remove malicious tags\n+            foreach ($blacklistedTags as $tag) {\n+                $math = str_ireplace($tag, '&lt;blocked&gt;', $math);\n+            }\n+            // prevent math mode escaping\n+            $math = preg_replace('/\\\\\\\\(?![\\w\\s{},\\\\\\\\_^])/u', '\\\\\\\\textbackslash', $math);\n+            // return with appropriate delimiters\n+            return $isDisplay ? \"$$\" . $math . \"$$\" : \"$\" . $math . \"$\";\n+        }, $content);\n+    }\n+}"
            },
            {
                "sha": "55c4e670feefbf7a0f742b603dde48639eba90fd",
                "filename": "classes/Session.class.php",
                "status": "modified",
                "additions": 25,
                "deletions": 3,
                "changes": 28,
                "blob_url": "https://github.com/Zavy86/WikiDocs/blob/aa264bd046a254522da67600be73791bd4e5dafc/classes%2FSession.class.php",
                "raw_url": "https://github.com/Zavy86/WikiDocs/raw/aa264bd046a254522da67600be73791bd4e5dafc/classes%2FSession.class.php",
                "contents_url": "https://api.github.com/repos/Zavy86/WikiDocs/contents/classes%2FSession.class.php?ref=aa264bd046a254522da67600be73791bd4e5dafc",
                "patch": "@@ -22,6 +22,14 @@ static function getInstance():Session{\n \t}\n \n \tfunction start(){\n+\t\t// set secure session cookie parameters\n+\t\tsession_set_cookie_params([\n+\t\t\t'lifetime' => 0,\n+\t\t\t'path' => '/',\n+\t\t\t'domain' => $_SERVER['HTTP_HOST'],\n+\t\t\t'httponly' => true,                   // prevent javascript access\n+\t\t\t'samesite' => 'Strict'                // restrict to same-site requests\n+\t\t]);\n \t\t// start php session\n \t\tsession_start();\n \t\t// check for application session array\n@@ -30,6 +38,14 @@ function start(){\n \t\tif(!isset($_SESSION['wikidocs']['debug'])){$this->setDebug(false);}\n \t\t// check for application session alerts array\n \t\tif(!isset($_SESSION['wikidocs']['alerts']) || !is_array($_SESSION['wikidocs']['alerts'])){$_SESSION['wikidocs']['alerts']=array();}\n+\t\t// periodically regenerate session id to prevent fixation attacks\n+\t\tif (!isset($_SESSION['last_regeneration'])) {\n+\t\t\t$_SESSION['last_regeneration'] = time();\n+\t\t}\n+\t\tif (time() - $_SESSION['last_regeneration'] > 300) { // regenerate every 5 minutes\n+\t\t\tsession_regenerate_id(true);\n+\t\t\t$_SESSION['last_regeneration'] = time();\n+\t\t}\n \t}\n \n \tpublic function destroy(){\n@@ -57,9 +73,15 @@ public function isDebug():bool{\n \t\treturn boolval($_SESSION['wikidocs']['debug']);\n \t}\n \n-\tpublic function privacyAgreement(bool $value){\n-\t\tsetcookie('privacy',$value,time()+(60*60*24*30),'/');\n-\t\theader('Location:'.PATH.DOC);\n+\tpublic function privacyAgreement(bool $value) {\n+\t\tsetcookie('privacy', $value, [\n+\t\t\t'expires' => time() + (60 * 60 * 24 * 30),\n+\t\t\t'path' => '/',\n+\t\t\t'domain' => $_SERVER['HTTP_HOST'],\n+\t\t\t'httponly' => true,\n+\t\t\t'samesite' => 'Strict'\n+\t\t]);\n+\t\theader('Location:' . PATH . DOC);\n \t}\n \n \tpublic function privacyAgreeded():bool{"
            },
            {
                "sha": "e4222c1c00a2ff96259af371c8c1be2e895c5da7",
                "filename": "index.php",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/Zavy86/WikiDocs/blob/aa264bd046a254522da67600be73791bd4e5dafc/index.php",
                "raw_url": "https://github.com/Zavy86/WikiDocs/raw/aa264bd046a254522da67600be73791bd4e5dafc/index.php",
                "contents_url": "https://api.github.com/repos/Zavy86/WikiDocs/contents/index.php?ref=aa264bd046a254522da67600be73791bd4e5dafc",
                "patch": "@@ -5,6 +5,10 @@\n  * @package WikiDocs\n  * @repository https://github.com/Zavy86/wikidocs\n  */\n+// additional security headers\n+header(\"X-Content-Type-Options: nosniff\");\n+header(\"X-XSS-Protection: 1; mode=block\");\n+\n require_once('bootstrap.inc.php');\n // mode definition\n $mode='view';\n@@ -27,6 +31,7 @@\n $DOC=new Document(DOC);\n // initialize markdown parser\n $PARSER=new ParsedownPlus([\n+\t'safemode' => true,    // enable parsedown's built-in safe mode\n \t'typographer' => true,\n \t'toc' => true,\n \t'sup' => true,"
            },
            {
                "sha": "71b6108c568aaea3ca0af6f9f09f2a1d538aaca4",
                "filename": "submit.php",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/Zavy86/WikiDocs/blob/aa264bd046a254522da67600be73791bd4e5dafc/submit.php",
                "raw_url": "https://github.com/Zavy86/WikiDocs/raw/aa264bd046a254522da67600be73791bd4e5dafc/submit.php",
                "contents_url": "https://api.github.com/repos/Zavy86/WikiDocs/contents/submit.php?ref=aa264bd046a254522da67600be73791bd4e5dafc",
                "patch": "@@ -98,6 +98,8 @@ function content_save(){\n \t\twdf_alert($TXT->SubmitDocumentContentCannotBeEmpty,\"danger\");\r\n \t\twdf_redirect(PATH.$p_document.\"?edit\");\r\n \t}\r\n+\t// apply security filters\r\n+\t$p_content = SecurityFilters::filterContent($p_content);\r\n \t// initialize document\r\n \t$DOC=new Document($p_document);\r\n \t// debug\r"
            },
            {
                "sha": "54a38e1dd469c742ecceab3df5b1cf0bf02bdfda",
                "filename": "template.inc.php",
                "status": "modified",
                "additions": 8,
                "deletions": 3,
                "changes": 11,
                "blob_url": "https://github.com/Zavy86/WikiDocs/blob/aa264bd046a254522da67600be73791bd4e5dafc/template.inc.php",
                "raw_url": "https://github.com/Zavy86/WikiDocs/raw/aa264bd046a254522da67600be73791bd4e5dafc/template.inc.php",
                "contents_url": "https://api.github.com/repos/Zavy86/WikiDocs/contents/template.inc.php?ref=aa264bd046a254522da67600be73791bd4e5dafc",
                "patch": "@@ -347,11 +347,16 @@ function gtag(){dataLayer.push(arguments);}\n <script>renderMathInElement(document.body, {\r\n     delimiters: [\r\n       {left: '$$', right: '$$', display: true}, // math block using $$math$$\r\n-      {left: '\\\\[', right: '\\\\]', display: true}, // math block using \\[math\\]\r\n       {left: '$', right: '$', display: false}, // math inline using $math$\r\n-      {left: '\\\\(', right: '\\\\)', display: false} // math inline using \\(math\\)\r\n     ],\r\n-    throwOnError : false\r\n+    throwOnError: false,\r\n+    trust: false, // disable html extension\r\n+    strict: true, // strict mode\r\n+    maxSize: 500, // limit size of expressions\r\n+    maxExpand: 100, // limit macro expansion\r\n+    errorCallback: function(msg) {\r\n+        console.warn('KaTeX error:', msg);\r\n+    }\r\n   });</script>\r\n <script>hljs.highlightAll();</script>\r\n <script src=\"<?= $APP->PATH ?>helpers/mermaid-9.4.3/mermaid.min.js\"></script>\r"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/vemonet/libre-chat/commits/dbb8e3400e5258112179783d74c9cc54310cb72b",
        "url": "https://api.github.com/repos/vemonet/libre-chat/commits/dbb8e3400e5258112179783d74c9cc54310cb72b",
        "html_url": "https://github.com/vemonet/libre-chat/commit/dbb8e3400e5258112179783d74c9cc54310cb72b",
        "message": "Merge pull request #9 from jxfzzzt/main\n\nFix Path Traversal issue",
        "files": [
            {
                "sha": "e803f6462f05880bde0aa9127f42218a0c2377cf",
                "filename": "src/libre_chat/router.py",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/vemonet/libre-chat/blob/dbb8e3400e5258112179783d74c9cc54310cb72b/src%2Flibre_chat%2Frouter.py",
                "raw_url": "https://github.com/vemonet/libre-chat/raw/dbb8e3400e5258112179783d74c9cc54310cb72b/src%2Flibre_chat%2Frouter.py",
                "contents_url": "https://api.github.com/repos/vemonet/libre-chat/contents/src%2Flibre_chat%2Frouter.py?ref=dbb8e3400e5258112179783d74c9cc54310cb72b",
                "patch": "@@ -3,6 +3,7 @@\n from dataclasses import dataclass\n from typing import Any, Dict, List, Optional, Union\n \n+import werkzeug\n from fastapi import APIRouter, Body, File, HTTPException, Request, UploadFile, WebSocket\n from fastapi.responses import JSONResponse\n from langchain.callbacks.base import AsyncCallbackHandler\n@@ -123,7 +124,13 @@ def upload_documents(\n                 )\n             for uploaded in files:\n                 if uploaded.filename:  # no cov\n-                    file_path = os.path.join(self.conf.vector.documents_path, uploaded.filename)\n+                    file_path = werkzeug.utils.safe_join(self.conf.vector.documents_path, uploaded.filename)\n+                    if file_path is None:\n+                        raise HTTPException(\n+                            status_code=403,\n+                            detail=f\"Invalid file name: {uploaded.filename}\",\n+                        )\n+\n                     with open(file_path, \"wb\") as file:\n                         file.write(uploaded.file.read())\n                     # Check if the uploaded file is a zip file"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/kubernetes/kubernetes/commits/1ab06efe92d8e898ca1931471c9533ce94aba29b",
        "url": "https://api.github.com/repos/kubernetes/kubernetes/commits/1ab06efe92d8e898ca1931471c9533ce94aba29b",
        "html_url": "https://github.com/kubernetes/kubernetes/commit/1ab06efe92d8e898ca1931471c9533ce94aba29b",
        "message": "Merge pull request #124531 from irsl/master\n\ngitRepo volume: directory must be max 1 level deep",
        "files": [
            {
                "sha": "b3827b92ad0f08a84987684f1177266b81c37503",
                "filename": "pkg/volume/git_repo/git_repo.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/kubernetes/kubernetes/blob/1ab06efe92d8e898ca1931471c9533ce94aba29b/pkg%2Fvolume%2Fgit_repo%2Fgit_repo.go",
                "raw_url": "https://github.com/kubernetes/kubernetes/raw/1ab06efe92d8e898ca1931471c9533ce94aba29b/pkg%2Fvolume%2Fgit_repo%2Fgit_repo.go",
                "contents_url": "https://api.github.com/repos/kubernetes/kubernetes/contents/pkg%2Fvolume%2Fgit_repo%2Fgit_repo.go?ref=1ab06efe92d8e898ca1931471c9533ce94aba29b",
                "patch": "@@ -261,6 +261,12 @@ func validateVolume(src *v1.GitRepoVolumeSource) error {\n \tif err := validateNonFlagArgument(src.Directory, \"directory\"); err != nil {\n \t\treturn err\n \t}\n+\tif (src.Revision != \"\") && (src.Directory != \"\") {\n+\t\tcleanedDir := filepath.Clean(src.Directory)\n+\t\tif strings.Contains(cleanedDir, \"/\") || (strings.Contains(cleanedDir, \"\\\\\")) {\n+\t\t\treturn fmt.Errorf(\"%q is not a valid directory, it must not contain a directory separator\", src.Directory)\n+\t\t}\n+\t}\n \treturn nil\n }\n "
            },
            {
                "sha": "650f765cc4884e15d832b2857edcd98240ab4f7e",
                "filename": "pkg/volume/git_repo/git_repo_test.go",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/kubernetes/kubernetes/blob/1ab06efe92d8e898ca1931471c9533ce94aba29b/pkg%2Fvolume%2Fgit_repo%2Fgit_repo_test.go",
                "raw_url": "https://github.com/kubernetes/kubernetes/raw/1ab06efe92d8e898ca1931471c9533ce94aba29b/pkg%2Fvolume%2Fgit_repo%2Fgit_repo_test.go",
                "contents_url": "https://api.github.com/repos/kubernetes/kubernetes/contents/pkg%2Fvolume%2Fgit_repo%2Fgit_repo_test.go?ref=1ab06efe92d8e898ca1931471c9533ce94aba29b",
                "patch": "@@ -267,6 +267,20 @@ func TestPlugin(t *testing.T) {\n \t\t\t},\n \t\t\tisExpectedFailure: true,\n \t\t},\n+\t\t{\n+\t\t\tname: \"invalid-revision-directory-combo\",\n+\t\t\tvol: &v1.Volume{\n+\t\t\t\tName: \"vol1\",\n+\t\t\t\tVolumeSource: v1.VolumeSource{\n+\t\t\t\t\tGitRepo: &v1.GitRepoVolumeSource{\n+\t\t\t\t\t\tRepository: gitURL,\n+\t\t\t\t\t\tRevision:   \"main\",\n+\t\t\t\t\t\tDirectory:  \"foo/bar\",\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\tisExpectedFailure: true,\n+\t\t},\n \t}\n \n \tfor _, scenario := range scenarios {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/tornadoweb/tornado/commits/d5ba4a1695fbf7c6a3e54313262639b198291533",
        "url": "https://api.github.com/repos/tornadoweb/tornado/commits/d5ba4a1695fbf7c6a3e54313262639b198291533",
        "html_url": "https://github.com/tornadoweb/tornado/commit/d5ba4a1695fbf7c6a3e54313262639b198291533",
        "message": "httputil: Fix quadratic performance of cookie parsing\n\nMaliciously-crafted cookies can cause Tornado to\nspend an unreasonable amount of CPU time and block\nthe event loop.\n\nThis change replaces the quadratic algorithm with\na more efficient one. The implementation is copied\nfrom the Python 3.13 standard library (the\nprevious one was from Python 3.5).\n\nFixes CVE-2024-52804\nSee CVE-2024-7592 for a similar vulnerability in cpython.\n\nThanks to github.com/kexinoh for the report.",
        "files": [
            {
                "sha": "ebdc8059c12f25fdae22fec6abeed3647c6b4e64",
                "filename": "tornado/httputil.py",
                "status": "modified",
                "additions": 10,
                "deletions": 28,
                "changes": 38,
                "blob_url": "https://github.com/tornadoweb/tornado/blob/d5ba4a1695fbf7c6a3e54313262639b198291533/tornado%2Fhttputil.py",
                "raw_url": "https://github.com/tornadoweb/tornado/raw/d5ba4a1695fbf7c6a3e54313262639b198291533/tornado%2Fhttputil.py",
                "contents_url": "https://api.github.com/repos/tornadoweb/tornado/contents/tornado%2Fhttputil.py?ref=d5ba4a1695fbf7c6a3e54313262639b198291533",
                "patch": "@@ -1057,15 +1057,20 @@ def qs_to_qsl(qs: Dict[str, List[AnyStr]]) -> Iterable[Tuple[str, AnyStr]]:\n             yield (k, v)\n \n \n-_OctalPatt = re.compile(r\"\\\\[0-3][0-7][0-7]\")\n-_QuotePatt = re.compile(r\"[\\\\].\")\n-_nulljoin = \"\".join\n+_unquote_sub = re.compile(r\"\\\\(?:([0-3][0-7][0-7])|(.))\").sub\n+\n+\n+def _unquote_replace(m: re.Match) -> str:\n+    if m[1]:\n+        return chr(int(m[1], 8))\n+    else:\n+        return m[2]\n \n \n def _unquote_cookie(s: str) -> str:\n     \"\"\"Handle double quotes and escaping in cookie values.\n \n-    This method is copied verbatim from the Python 3.5 standard\n+    This method is copied verbatim from the Python 3.13 standard\n     library (http.cookies._unquote) so we don't have to depend on\n     non-public interfaces.\n     \"\"\"\n@@ -1086,30 +1091,7 @@ def _unquote_cookie(s: str) -> str:\n     #    \\012 --> \\n\n     #    \\\"   --> \"\n     #\n-    i = 0\n-    n = len(s)\n-    res = []\n-    while 0 <= i < n:\n-        o_match = _OctalPatt.search(s, i)\n-        q_match = _QuotePatt.search(s, i)\n-        if not o_match and not q_match:  # Neither matched\n-            res.append(s[i:])\n-            break\n-        # else:\n-        j = k = -1\n-        if o_match:\n-            j = o_match.start(0)\n-        if q_match:\n-            k = q_match.start(0)\n-        if q_match and (not o_match or k < j):  # QuotePatt matched\n-            res.append(s[i:k])\n-            res.append(s[k + 1])\n-            i = k + 2\n-        else:  # OctalPatt matched\n-            res.append(s[i:j])\n-            res.append(chr(int(s[j + 1 : j + 4], 8)))\n-            i = j + 4\n-    return _nulljoin(res)\n+    return _unquote_sub(_unquote_replace, s)\n \n \n def parse_cookie(cookie: str) -> Dict[str, str]:"
            },
            {
                "sha": "975900aa9cc57d6d0547c3c3479ec642cdb7df7d",
                "filename": "tornado/test/httputil_test.py",
                "status": "modified",
                "additions": 46,
                "deletions": 0,
                "changes": 46,
                "blob_url": "https://github.com/tornadoweb/tornado/blob/d5ba4a1695fbf7c6a3e54313262639b198291533/tornado%2Ftest%2Fhttputil_test.py",
                "raw_url": "https://github.com/tornadoweb/tornado/raw/d5ba4a1695fbf7c6a3e54313262639b198291533/tornado%2Ftest%2Fhttputil_test.py",
                "contents_url": "https://api.github.com/repos/tornadoweb/tornado/contents/tornado%2Ftest%2Fhttputil_test.py?ref=d5ba4a1695fbf7c6a3e54313262639b198291533",
                "patch": "@@ -560,3 +560,49 @@ def test_invalid_cookies(self):\n         self.assertEqual(\n             parse_cookie(\"  =  b  ;  ;  =  ;   c  =  ;  \"), {\"\": \"b\", \"c\": \"\"}\n         )\n+\n+    def test_unquote(self):\n+        # Copied from\n+        # https://github.com/python/cpython/blob/dc7a2b6522ec7af41282bc34f405bee9b306d611/Lib/test/test_http_cookies.py#L62\n+        cases = [\n+            (r'a=\"b=\\\"\"', 'b=\"'),\n+            (r'a=\"b=\\\\\"', \"b=\\\\\"),\n+            (r'a=\"b=\\=\"', \"b==\"),\n+            (r'a=\"b=\\n\"', \"b=n\"),\n+            (r'a=\"b=\\042\"', 'b=\"'),\n+            (r'a=\"b=\\134\"', \"b=\\\\\"),\n+            (r'a=\"b=\\377\"', \"b=\\xff\"),\n+            (r'a=\"b=\\400\"', \"b=400\"),\n+            (r'a=\"b=\\42\"', \"b=42\"),\n+            (r'a=\"b=\\\\042\"', \"b=\\\\042\"),\n+            (r'a=\"b=\\\\134\"', \"b=\\\\134\"),\n+            (r'a=\"b=\\\\\\\"\"', 'b=\\\\\"'),\n+            (r'a=\"b=\\\\\\042\"', 'b=\\\\\"'),\n+            (r'a=\"b=\\134\\\"\"', 'b=\\\\\"'),\n+            (r'a=\"b=\\134\\042\"', 'b=\\\\\"'),\n+        ]\n+        for encoded, decoded in cases:\n+            with self.subTest(encoded):\n+                c = parse_cookie(encoded)\n+                self.assertEqual(c[\"a\"], decoded)\n+\n+    def test_unquote_large(self):\n+        # Adapted from\n+        # https://github.com/python/cpython/blob/dc7a2b6522ec7af41282bc34f405bee9b306d611/Lib/test/test_http_cookies.py#L87\n+        # Modified from that test because we handle semicolons differently from the stdlib.\n+        #\n+        # This is a performance regression test: prior to improvements in Tornado 6.4.2, this test\n+        # would take over a minute with n= 100k. Now it runs in tens of milliseconds.\n+        n = 100000\n+        for encoded in r\"\\\\\", r\"\\134\":\n+            with self.subTest(encoded):\n+                start = time.time()\n+                data = 'a=\"b=' + encoded * n + '\"'\n+                value = parse_cookie(data)[\"a\"]\n+                end = time.time()\n+                self.assertEqual(value[:3], \"b=\\\\\")\n+                self.assertEqual(value[-3:], \"\\\\\\\\\\\\\")\n+                self.assertEqual(len(value), n + 2)\n+\n+                # Very loose performance check to avoid false positives\n+                self.assertLess(end - start, 1, \"Test took too long\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/goauthentik/authentik/commits/e9c29e1644e9199b4ba58d2b10eb8c322138eea2",
        "url": "https://api.github.com/repos/goauthentik/authentik/commits/e9c29e1644e9199b4ba58d2b10eb8c322138eea2",
        "html_url": "https://github.com/goauthentik/authentik/commit/e9c29e1644e9199b4ba58d2b10eb8c322138eea2",
        "message": "security: fix CVE 2024 52287 (#12114)\n\n* security: CVE-2024-52287\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* add tests\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n---------\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>",
        "files": [
            {
                "sha": "a0abf3b7a68d768ad83b89ea076ab3a743cd0636",
                "filename": "authentik/providers/oauth2/tests/test_token_cc_standard.py",
                "status": "modified",
                "additions": 43,
                "deletions": 1,
                "changes": 44,
                "blob_url": "https://github.com/goauthentik/authentik/blob/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_standard.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_standard.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_standard.py?ref=e9c29e1644e9199b4ba58d2b10eb8c322138eea2",
                "patch": "@@ -19,7 +19,7 @@\n     TOKEN_TYPE,\n )\n from authentik.providers.oauth2.errors import TokenError\n-from authentik.providers.oauth2.models import OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import AccessToken, OAuth2Provider, ScopeMapping\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -107,6 +107,48 @@ def test_permission_denied(self):\n             {\"error\": \"invalid_grant\", \"error_description\": TokenError.errors[\"invalid_grant\"]},\n         )\n \n+    def test_incorrect_scopes(self):\n+        \"\"\"test scope that isn't configured\"\"\"\n+        response = self.client.post(\n+            reverse(\"authentik_providers_oauth2:token\"),\n+            {\n+                \"grant_type\": GRANT_TYPE_CLIENT_CREDENTIALS,\n+                \"scope\": f\"{SCOPE_OPENID} {SCOPE_OPENID_EMAIL} {SCOPE_OPENID_PROFILE} extra_scope\",\n+                \"client_id\": self.provider.client_id,\n+                \"client_secret\": self.provider.client_secret,\n+            },\n+        )\n+        self.assertEqual(response.status_code, 200)\n+        body = loads(response.content.decode())\n+        self.assertEqual(body[\"token_type\"], TOKEN_TYPE)\n+        token = AccessToken.objects.filter(\n+            provider=self.provider, token=body[\"access_token\"]\n+        ).first()\n+        self.assertSetEqual(\n+            set(token.scope), {SCOPE_OPENID, SCOPE_OPENID_EMAIL, SCOPE_OPENID_PROFILE}\n+        )\n+        _, alg = self.provider.jwt_key\n+        jwt = decode(\n+            body[\"access_token\"],\n+            key=self.provider.signing_key.public_key,\n+            algorithms=[alg],\n+            audience=self.provider.client_id,\n+        )\n+        self.assertEqual(\n+            jwt[\"given_name\"], \"Autogenerated user from application test (client credentials)\"\n+        )\n+        self.assertEqual(jwt[\"preferred_username\"], \"ak-test-client_credentials\")\n+        jwt = decode(\n+            body[\"id_token\"],\n+            key=self.provider.signing_key.public_key,\n+            algorithms=[alg],\n+            audience=self.provider.client_id,\n+        )\n+        self.assertEqual(\n+            jwt[\"given_name\"], \"Autogenerated user from application test (client credentials)\"\n+        )\n+        self.assertEqual(jwt[\"preferred_username\"], \"ak-test-client_credentials\")\n+\n     def test_successful(self):\n         \"\"\"test successful\"\"\"\n         response = self.client.post("
            },
            {
                "sha": "b1b7aef5f3dc9c841ca4ebef5ad35a927a4e8c55",
                "filename": "authentik/providers/oauth2/tests/test_token_device.py",
                "status": "modified",
                "additions": 31,
                "deletions": 2,
                "changes": 33,
                "blob_url": "https://github.com/goauthentik/authentik/blob/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_device.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_device.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_device.py?ref=e9c29e1644e9199b4ba58d2b10eb8c322138eea2",
                "patch": "@@ -9,8 +9,12 @@\n from authentik.core.models import Application\n from authentik.core.tests.utils import create_test_admin_user, create_test_cert, create_test_flow\n from authentik.lib.generators import generate_code_fixed_length, generate_id\n-from authentik.providers.oauth2.constants import GRANT_TYPE_DEVICE_CODE\n-from authentik.providers.oauth2.models import DeviceToken, OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.constants import (\n+    GRANT_TYPE_DEVICE_CODE,\n+    SCOPE_OPENID,\n+    SCOPE_OPENID_EMAIL,\n+)\n+from authentik.providers.oauth2.models import AccessToken, DeviceToken, OAuth2Provider, ScopeMapping\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -80,3 +84,28 @@ def test_code(self):\n             },\n         )\n         self.assertEqual(res.status_code, 200)\n+\n+    def test_code_mismatched_scope(self):\n+        \"\"\"Test code with user (mismatched scopes)\"\"\"\n+        device_token = DeviceToken.objects.create(\n+            provider=self.provider,\n+            user_code=generate_code_fixed_length(),\n+            device_code=generate_id(),\n+            user=self.user,\n+            scope=[SCOPE_OPENID, SCOPE_OPENID_EMAIL],\n+        )\n+        res = self.client.post(\n+            reverse(\"authentik_providers_oauth2:token\"),\n+            data={\n+                \"client_id\": self.provider.client_id,\n+                \"grant_type\": GRANT_TYPE_DEVICE_CODE,\n+                \"device_code\": device_token.device_code,\n+                \"scope\": f\"{SCOPE_OPENID} {SCOPE_OPENID_EMAIL} invalid\",\n+            },\n+        )\n+        self.assertEqual(res.status_code, 200)\n+        body = loads(res.content)\n+        token = AccessToken.objects.filter(\n+            provider=self.provider, token=body[\"access_token\"]\n+        ).first()\n+        self.assertSetEqual(set(token.scope), {SCOPE_OPENID, SCOPE_OPENID_EMAIL})"
            },
            {
                "sha": "63fbf20a87d2fe1ded27382df1e2fd8e14fa8a18",
                "filename": "authentik/providers/oauth2/views/token.py",
                "status": "modified",
                "additions": 20,
                "deletions": 4,
                "changes": 24,
                "blob_url": "https://github.com/goauthentik/authentik/blob/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/authentik%2Fproviders%2Foauth2%2Fviews%2Ftoken.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/authentik%2Fproviders%2Foauth2%2Fviews%2Ftoken.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Fviews%2Ftoken.py?ref=e9c29e1644e9199b4ba58d2b10eb8c322138eea2",
                "patch": "@@ -59,6 +59,7 @@\n     DeviceToken,\n     OAuth2Provider,\n     RefreshToken,\n+    ScopeMapping,\n )\n from authentik.providers.oauth2.utils import TokenResponse, cors_allow, extract_client_auth\n from authentik.providers.oauth2.views.authorize import FORBIDDEN_URI_SCHEMES\n@@ -77,7 +78,7 @@ class TokenParams:\n     redirect_uri: str\n     grant_type: str\n     state: str\n-    scope: list[str]\n+    scope: set[str]\n \n     provider: OAuth2Provider\n \n@@ -112,11 +113,26 @@ def parse(\n             redirect_uri=request.POST.get(\"redirect_uri\", \"\"),\n             grant_type=request.POST.get(\"grant_type\", \"\"),\n             state=request.POST.get(\"state\", \"\"),\n-            scope=request.POST.get(\"scope\", \"\").split(),\n+            scope=set(request.POST.get(\"scope\", \"\").split()),\n             # PKCE parameter.\n             code_verifier=request.POST.get(\"code_verifier\"),\n         )\n \n+    def __check_scopes(self):\n+        allowed_scope_names = set(\n+            ScopeMapping.objects.filter(provider__in=[self.provider]).values_list(\n+                \"scope_name\", flat=True\n+            )\n+        )\n+        scopes_to_check = self.scope\n+        if not scopes_to_check.issubset(allowed_scope_names):\n+            LOGGER.info(\n+                \"Application requested scopes not configured, setting to overlap\",\n+                scope_allowed=allowed_scope_names,\n+                scope_given=self.scope,\n+            )\n+            self.scope = self.scope.intersection(allowed_scope_names)\n+\n     def __check_policy_access(self, app: Application, request: HttpRequest, **kwargs):\n         with start_span(\n             op=\"authentik.providers.oauth2.token.policy\",\n@@ -149,7 +165,7 @@ def __post_init__(self, raw_code: str, raw_token: str, request: HttpRequest):\n                     client_id=self.provider.client_id,\n                 )\n                 raise TokenError(\"invalid_client\")\n-\n+        self.__check_scopes()\n         if self.grant_type == GRANT_TYPE_AUTHORIZATION_CODE:\n             with start_span(\n                 op=\"authentik.providers.oauth2.post.parse.code\",\n@@ -710,7 +726,7 @@ def create_device_code_response(self) -> dict[str, Any]:\n             \"id_token\": access_token.id_token.to_jwt(self.provider),\n         }\n \n-        if SCOPE_OFFLINE_ACCESS in self.params.scope:\n+        if SCOPE_OFFLINE_ACCESS in self.params.device_code.scope:\n             refresh_token_expiry = now + timedelta_from_string(self.provider.refresh_token_validity)\n             refresh_token = RefreshToken(\n                 user=self.params.device_code.user,"
            },
            {
                "sha": "05852e9f765fd537eee6a889eb355da792c620d8",
                "filename": "website/docs/security/cves/CVE-2024-52287.md",
                "status": "added",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/goauthentik/authentik/blob/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/website%2Fdocs%2Fsecurity%2Fcves%2FCVE-2024-52287.md",
                "raw_url": "https://github.com/goauthentik/authentik/raw/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/website%2Fdocs%2Fsecurity%2Fcves%2FCVE-2024-52287.md",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/website%2Fdocs%2Fsecurity%2Fcves%2FCVE-2024-52287.md?ref=e9c29e1644e9199b4ba58d2b10eb8c322138eea2",
                "patch": "@@ -0,0 +1,27 @@\n+# CVE-2024-52287\n+\n+_Reported by [@matt1097](https://github.com/matt1097)_\n+\n+## Insufficient validation of OAuth scopes for client_credentials and device_code grants\n+\n+### Summary\n+\n+When using the `client_credentials` or `device_code` OAuth grants, it was possible for an attacker to get a token from authentik with scopes that haven't been configured in authentik.\n+\n+### Details\n+\n+With the `device_code` grant, it was possible to have a user authorize a set of permitted scopes, and then acquire a token with a different set of scopes, including scopes not configured. This token could potentially be used to send requests to another system which trusts tokens signed by authentik and execute malicious actions on behalf of the user.\n+\n+With the `client_credentials` grant, because there is no user authorization process, authentik would not validate the scopes requested for the token, allowing tokens to be issued with scopes not configured in authentik. These could similarly be used to execute malicious actions in other systems.\n+\n+There is no workaround for this issue; however this issue could only be exploited if an attacker possesses a valid set of OAuth2 `client_id` and `client_secret` credentials, and has the knowledge of another system that trusts tokens issued by authentik and what scopes it checks for.\n+\n+### Patches\n+\n+authentik 2024.8.5 and 2024.10.3 fix this issue.\n+\n+### For more information\n+\n+If you have any questions or comments about this advisory:\n+\n+-   Email us at [security@goauthentik.io](mailto:security@goauthentik.io)"
            },
            {
                "sha": "026286b64cc5b36aec5c1c4b28d3669d11886f14",
                "filename": "website/sidebars.js",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/goauthentik/authentik/blob/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/website%2Fsidebars.js",
                "raw_url": "https://github.com/goauthentik/authentik/raw/e9c29e1644e9199b4ba58d2b10eb8c322138eea2/website%2Fsidebars.js",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/website%2Fsidebars.js?ref=e9c29e1644e9199b4ba58d2b10eb8c322138eea2",
                "patch": "@@ -658,6 +658,7 @@ export default {\n                             type: \"category\",\n                             label: \"2024\",\n                             items: [\n+                                \"security/cves/CVE-2024-52287\",\n                                 \"security/cves/CVE-2024-47077\",\n                                 \"security/cves/CVE-2024-47070\",\n                                 \"security/cves/CVE-2024-38371\","
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/goauthentik/authentik/commits/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
        "url": "https://api.github.com/repos/goauthentik/authentik/commits/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
        "html_url": "https://github.com/goauthentik/authentik/commit/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
        "message": "security: fix CVE 2024 52289 (#12113)\n\n* initial migration\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* migrate tests\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* fix loading\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* fix\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* start dynamic ui\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* initial ui\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* add serialize\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* add error message handling\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* fix/add tests\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* prepare docs\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* migrate to new input\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* fix tests\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n---------\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>",
        "files": [
            {
                "sha": "192adc458b905ae6c5ab2e70b5ffdf7df479c120",
                "filename": "authentik/core/tests/test_applications_api.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fcore%2Ftests%2Ftest_applications_api.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fcore%2Ftests%2Ftest_applications_api.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fcore%2Ftests%2Ftest_applications_api.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -12,7 +12,7 @@\n from authentik.lib.generators import generate_id\n from authentik.policies.dummy.models import DummyPolicy\n from authentik.policies.models import PolicyBinding\n-from authentik.providers.oauth2.models import OAuth2Provider\n+from authentik.providers.oauth2.models import OAuth2Provider, RedirectURI, RedirectURIMatchingMode\n from authentik.providers.proxy.models import ProxyProvider\n from authentik.providers.saml.models import SAMLProvider\n \n@@ -24,7 +24,7 @@ def setUp(self) -> None:\n         self.user = create_test_admin_user()\n         self.provider = OAuth2Provider.objects.create(\n             name=\"test\",\n-            redirect_uris=\"http://some-other-domain\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://some-other-domain\")],\n             authorization_flow=create_test_flow(),\n         )\n         self.allowed: Application = Application.objects.create("
            },
            {
                "sha": "c6fcfb1946743ec72612192e67455d63dc5a09f6",
                "filename": "authentik/core/tests/test_transactional_applications_api.py",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fcore%2Ftests%2Ftest_transactional_applications_api.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fcore%2Ftests%2Ftest_transactional_applications_api.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fcore%2Ftests%2Ftest_transactional_applications_api.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -35,6 +35,7 @@ def test_create_transactional(self):\n                     \"name\": uid,\n                     \"authorization_flow\": str(create_test_flow().pk),\n                     \"invalidation_flow\": str(create_test_flow().pk),\n+                    \"redirect_uris\": [],\n                 },\n             },\n         )\n@@ -89,6 +90,7 @@ def test_create_transactional_bindings(self):\n                     \"name\": uid,\n                     \"authorization_flow\": str(authorization_flow.pk),\n                     \"invalidation_flow\": str(authorization_flow.pk),\n+                    \"redirect_uris\": [],\n                 },\n                 \"policy_bindings\": [{\"group\": group.pk, \"order\": 0}],\n             },\n@@ -120,6 +122,7 @@ def test_create_transactional_invalid(self):\n                     \"name\": uid,\n                     \"authorization_flow\": \"\",\n                     \"invalidation_flow\": \"\",\n+                    \"redirect_uris\": [],\n                 },\n             },\n         )"
            },
            {
                "sha": "0e3c886d1120f30053f76dce411995e754326aaf",
                "filename": "authentik/crypto/tests.py",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fcrypto%2Ftests.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fcrypto%2Ftests.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fcrypto%2Ftests.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -18,7 +18,7 @@\n from authentik.crypto.tasks import MANAGED_DISCOVERED, certificate_discovery\n from authentik.lib.config import CONFIG\n from authentik.lib.generators import generate_id, generate_key\n-from authentik.providers.oauth2.models import OAuth2Provider\n+from authentik.providers.oauth2.models import OAuth2Provider, RedirectURI, RedirectURIMatchingMode\n \n \n class TestCrypto(APITestCase):\n@@ -274,7 +274,7 @@ def test_used_by(self):\n             client_id=\"test\",\n             client_secret=generate_key(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost\")],\n             signing_key=keypair,\n         )\n         response = self.client.get(\n@@ -306,7 +306,7 @@ def test_used_by_denied(self):\n             client_id=\"test\",\n             client_secret=generate_key(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost\")],\n             signing_key=keypair,\n         )\n         response = self.client.get("
            },
            {
                "sha": "83d1cba2857a077444929b21aecb848c974ee62a",
                "filename": "authentik/providers/oauth2/api/providers.py",
                "status": "modified",
                "additions": 31,
                "deletions": 3,
                "changes": 34,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fapi%2Fproviders.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fapi%2Fproviders.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Fapi%2Fproviders.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -1,15 +1,18 @@\n \"\"\"OAuth2Provider API Views\"\"\"\n \n from copy import copy\n+from re import compile\n+from re import error as RegexError\n \n from django.urls import reverse\n from django.utils import timezone\n+from django.utils.translation import gettext_lazy as _\n from drf_spectacular.types import OpenApiTypes\n from drf_spectacular.utils import OpenApiParameter, OpenApiResponse, extend_schema\n from guardian.shortcuts import get_objects_for_user\n from rest_framework.decorators import action\n from rest_framework.exceptions import ValidationError\n-from rest_framework.fields import CharField\n+from rest_framework.fields import CharField, ChoiceField\n from rest_framework.generics import get_object_or_404\n from rest_framework.request import Request\n from rest_framework.response import Response\n@@ -20,13 +23,39 @@\n from authentik.core.api.utils import PassiveSerializer, PropertyMappingPreviewSerializer\n from authentik.core.models import Provider\n from authentik.providers.oauth2.id_token import IDToken\n-from authentik.providers.oauth2.models import AccessToken, OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    AccessToken,\n+    OAuth2Provider,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from authentik.rbac.decorators import permission_required\n \n \n+class RedirectURISerializer(PassiveSerializer):\n+    \"\"\"A single allowed redirect URI entry\"\"\"\n+\n+    matching_mode = ChoiceField(choices=RedirectURIMatchingMode.choices)\n+    url = CharField()\n+\n+\n class OAuth2ProviderSerializer(ProviderSerializer):\n     \"\"\"OAuth2Provider Serializer\"\"\"\n \n+    redirect_uris = RedirectURISerializer(many=True, source=\"_redirect_uris\")\n+\n+    def validate_redirect_uris(self, data: list) -> list:\n+        for entry in data:\n+            if entry.get(\"matching_mode\") == RedirectURIMatchingMode.REGEX:\n+                url = entry.get(\"url\")\n+                try:\n+                    compile(url)\n+                except RegexError:\n+                    raise ValidationError(\n+                        _(\"Invalid Regex Pattern: {url}\".format(url=url))\n+                    ) from None\n+        return data\n+\n     class Meta:\n         model = OAuth2Provider\n         fields = ProviderSerializer.Meta.fields + [\n@@ -79,7 +108,6 @@ class OAuth2ProviderViewSet(UsedByMixin, ModelViewSet):\n         \"refresh_token_validity\",\n         \"include_claims_in_id_token\",\n         \"signing_key\",\n-        \"redirect_uris\",\n         \"sub_mode\",\n         \"property_mappings\",\n         \"issuer_mode\","
            },
            {
                "sha": "479eae16f2d6cc8956e15c5e769804723f1a707b",
                "filename": "authentik/providers/oauth2/errors.py",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ferrors.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ferrors.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ferrors.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -7,7 +7,7 @@\n from authentik.events.models import Event, EventAction\n from authentik.lib.sentry import SentryIgnoredException\n from authentik.lib.views import bad_request_message\n-from authentik.providers.oauth2.models import GrantTypes\n+from authentik.providers.oauth2.models import GrantTypes, RedirectURI\n \n \n class OAuth2Error(SentryIgnoredException):\n@@ -46,9 +46,9 @@ class RedirectUriError(OAuth2Error):\n     )\n \n     provided_uri: str\n-    allowed_uris: list[str]\n+    allowed_uris: list[RedirectURI]\n \n-    def __init__(self, provided_uri: str, allowed_uris: list[str]) -> None:\n+    def __init__(self, provided_uri: str, allowed_uris: list[RedirectURI]) -> None:\n         super().__init__()\n         self.provided_uri = provided_uri\n         self.allowed_uris = allowed_uris"
            },
            {
                "sha": "0e88ba91c5dac197f682410318be58657f104f2e",
                "filename": "authentik/providers/oauth2/migrations/0024_remove_oauth2provider_redirect_uris_and_more.py",
                "status": "added",
                "additions": 48,
                "deletions": 0,
                "changes": 48,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fmigrations%2F0024_remove_oauth2provider_redirect_uris_and_more.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fmigrations%2F0024_remove_oauth2provider_redirect_uris_and_more.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Fmigrations%2F0024_remove_oauth2provider_redirect_uris_and_more.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -0,0 +1,48 @@\n+# Generated by Django 5.0.9 on 2024-11-04 12:56\n+from django.apps.registry import Apps\n+\n+from django.db.backends.base.schema import BaseDatabaseSchemaEditor\n+\n+from django.db import migrations, models\n+\n+\n+def migrate_redirect_uris(apps: Apps, schema_editor: BaseDatabaseSchemaEditor):\n+    from authentik.providers.oauth2.models import RedirectURI, RedirectURIMatchingMode\n+\n+    OAuth2Provider = apps.get_model(\"authentik_providers_oauth2\", \"oauth2provider\")\n+\n+    db_alias = schema_editor.connection.alias\n+    for provider in OAuth2Provider.objects.using(db_alias).all():\n+        uris = []\n+        for old in provider.old_redirect_uris.split(\"\\n\"):\n+            mode = RedirectURIMatchingMode.STRICT\n+            if old == \"*\" or old == \".*\":\n+                mode = RedirectURIMatchingMode.REGEX\n+            uris.append(RedirectURI(mode, url=old))\n+        provider.redirect_uris = uris\n+        provider.save()\n+\n+\n+class Migration(migrations.Migration):\n+\n+    dependencies = [\n+        (\"authentik_providers_oauth2\", \"0023_alter_accesstoken_refreshtoken_use_hash_index\"),\n+    ]\n+\n+    operations = [\n+        migrations.RenameField(\n+            model_name=\"oauth2provider\",\n+            old_name=\"redirect_uris\",\n+            new_name=\"old_redirect_uris\",\n+        ),\n+        migrations.AddField(\n+            model_name=\"oauth2provider\",\n+            name=\"_redirect_uris\",\n+            field=models.JSONField(default=dict, verbose_name=\"Redirect URIs\"),\n+        ),\n+        migrations.RunPython(migrate_redirect_uris, lambda *args: ...),\n+        migrations.RemoveField(\n+            model_name=\"oauth2provider\",\n+            name=\"old_redirect_uris\",\n+        ),\n+    ]"
            },
            {
                "sha": "7e9ee3276f79fefc11c71feac30e9e1a98750b83",
                "filename": "authentik/providers/oauth2/models.py",
                "status": "modified",
                "additions": 43,
                "deletions": 9,
                "changes": 52,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fmodels.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fmodels.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Fmodels.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -3,7 +3,7 @@\n import base64\n import binascii\n import json\n-from dataclasses import asdict\n+from dataclasses import asdict, dataclass\n from functools import cached_property\n from hashlib import sha256\n from typing import Any\n@@ -12,6 +12,7 @@\n from cryptography.hazmat.primitives.asymmetric.ec import EllipticCurvePrivateKey\n from cryptography.hazmat.primitives.asymmetric.rsa import RSAPrivateKey\n from cryptography.hazmat.primitives.asymmetric.types import PrivateKeyTypes\n+from dacite import Config\n from dacite.core import from_dict\n from django.contrib.postgres.indexes import HashIndex\n from django.db import models\n@@ -77,11 +78,25 @@ class IssuerMode(models.TextChoices):\n     \"\"\"Configure how the `iss` field is created.\"\"\"\n \n     GLOBAL = \"global\", _(\"Same identifier is used for all providers\")\n-    PER_PROVIDER = \"per_provider\", _(\n-        \"Each provider has a different issuer, based on the application slug.\"\n+    PER_PROVIDER = (\n+        \"per_provider\",\n+        _(\"Each provider has a different issuer, based on the application slug.\"),\n     )\n \n \n+class RedirectURIMatchingMode(models.TextChoices):\n+    STRICT = \"strict\", _(\"Strict URL comparison\")\n+    REGEX = \"regex\", _(\"Regular Expression URL matching\")\n+\n+\n+@dataclass\n+class RedirectURI:\n+    \"\"\"A single redirect URI entry\"\"\"\n+\n+    matching_mode: RedirectURIMatchingMode\n+    url: str\n+\n+\n class ResponseTypes(models.TextChoices):\n     \"\"\"Response Type required by the client.\"\"\"\n \n@@ -156,11 +171,9 @@ class OAuth2Provider(WebfingerProvider, Provider):\n         verbose_name=_(\"Client Secret\"),\n         default=generate_client_secret,\n     )\n-    redirect_uris = models.TextField(\n-        default=\"\",\n-        blank=True,\n+    _redirect_uris = models.JSONField(\n+        default=dict,\n         verbose_name=_(\"Redirect URIs\"),\n-        help_text=_(\"Enter each URI on a new line.\"),\n     )\n \n     include_claims_in_id_token = models.BooleanField(\n@@ -271,12 +284,33 @@ def get_issuer(self, request: HttpRequest) -> str | None:\n         except Provider.application.RelatedObjectDoesNotExist:\n             return None\n \n+    @property\n+    def redirect_uris(self) -> list[RedirectURI]:\n+        uris = []\n+        for entry in self._redirect_uris:\n+            uris.append(\n+                from_dict(\n+                    RedirectURI,\n+                    entry,\n+                    config=Config(type_hooks={RedirectURIMatchingMode: RedirectURIMatchingMode}),\n+                )\n+            )\n+        return uris\n+\n+    @redirect_uris.setter\n+    def redirect_uris(self, value: list[RedirectURI]):\n+        cleansed = []\n+        for entry in value:\n+            cleansed.append(asdict(entry))\n+        self._redirect_uris = cleansed\n+\n     @property\n     def launch_url(self) -> str | None:\n         \"\"\"Guess launch_url based on first redirect_uri\"\"\"\n-        if self.redirect_uris == \"\":\n+        redirects = self.redirect_uris\n+        if len(redirects) < 1:\n             return None\n-        main_url = self.redirect_uris.split(\"\\n\", maxsplit=1)[0]\n+        main_url = redirects[0].url\n         try:\n             launch_url = urlparse(main_url)._replace(path=\"\")\n             return urlunparse(launch_url)"
            },
            {
                "sha": "47ea8ac8df1abc7b0b017c8b4b2a9fe71c8cd1d4",
                "filename": "authentik/providers/oauth2/tests/test_api.py",
                "status": "modified",
                "additions": 31,
                "deletions": 5,
                "changes": 36,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_api.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_api.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_api.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -10,7 +10,13 @@\n from authentik.blueprints.tests import apply_blueprint\n from authentik.core.models import Application\n from authentik.core.tests.utils import create_test_admin_user, create_test_flow\n-from authentik.providers.oauth2.models import OAuth2Provider, ScopeMapping\n+from authentik.lib.generators import generate_id\n+from authentik.providers.oauth2.models import (\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n \n \n class TestAPI(APITestCase):\n@@ -21,7 +27,7 @@ def setUp(self) -> None:\n         self.provider: OAuth2Provider = OAuth2Provider.objects.create(\n             name=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://testserver\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://testserver\")],\n         )\n         self.provider.property_mappings.set(ScopeMapping.objects.all())\n         self.app = Application.objects.create(name=\"test\", slug=\"test\", provider=self.provider)\n@@ -50,9 +56,29 @@ def test_setup_urls(self):\n     @skipUnless(version_info >= (3, 11, 4), \"This behaviour is only Python 3.11.4 and up\")\n     def test_launch_url(self):\n         \"\"\"Test launch_url\"\"\"\n-        self.provider.redirect_uris = (\n-            \"https://[\\\\d\\\\w]+.pr.test.goauthentik.io/source/oauth/callback/authentik/\\n\"\n-        )\n+        self.provider.redirect_uris = [\n+            RedirectURI(\n+                RedirectURIMatchingMode.REGEX,\n+                \"https://[\\\\d\\\\w]+.pr.test.goauthentik.io/source/oauth/callback/authentik/\",\n+            ),\n+        ]\n         self.provider.save()\n         self.provider.refresh_from_db()\n         self.assertIsNone(self.provider.launch_url)\n+\n+    def test_validate_redirect_uris(self):\n+        \"\"\"Test redirect_uris API\"\"\"\n+        response = self.client.post(\n+            reverse(\"authentik_api:oauth2provider-list\"),\n+            data={\n+                \"name\": generate_id(),\n+                \"authorization_flow\": create_test_flow().pk,\n+                \"invalidation_flow\": create_test_flow().pk,\n+                \"redirect_uris\": [\n+                    {\"matching_mode\": \"strict\", \"url\": \"http://goauthentik.io\"},\n+                    {\"matching_mode\": \"regex\", \"url\": \"**\"},\n+                ],\n+            },\n+        )\n+        self.assertJSONEqual(response.content, {\"redirect_uris\": [\"Invalid Regex Pattern: **\"]})\n+        self.assertEqual(response.status_code, 400)"
            },
            {
                "sha": "032289c0b10fab489ef3657535f694c0328f1a02",
                "filename": "authentik/providers/oauth2/tests/test_authorize.py",
                "status": "modified",
                "additions": 17,
                "deletions": 15,
                "changes": 32,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_authorize.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_authorize.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_authorize.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -19,6 +19,8 @@\n     AuthorizationCode,\n     GrantTypes,\n     OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n     ScopeMapping,\n )\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n@@ -39,7 +41,7 @@ def test_invalid_grant_type(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid/Foo\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid/Foo\")],\n         )\n         with self.assertRaises(AuthorizeError):\n             request = self.factory.get(\n@@ -64,7 +66,7 @@ def test_request(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid/Foo\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid/Foo\")],\n         )\n         with self.assertRaises(AuthorizeError):\n             request = self.factory.get(\n@@ -84,7 +86,7 @@ def test_invalid_redirect_uri(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n         )\n         with self.assertRaises(RedirectUriError):\n             request = self.factory.get(\"/\", data={\"response_type\": \"code\", \"client_id\": \"test\"})\n@@ -106,7 +108,7 @@ def test_blocked_redirect_uri(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"data:local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"data:local.invalid\")],\n         )\n         with self.assertRaises(RedirectUriError):\n             request = self.factory.get(\n@@ -125,7 +127,7 @@ def test_invalid_redirect_uri_empty(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"\",\n+            redirect_uris=[],\n         )\n         with self.assertRaises(RedirectUriError):\n             request = self.factory.get(\"/\", data={\"response_type\": \"code\", \"client_id\": \"test\"})\n@@ -140,15 +142,15 @@ def test_invalid_redirect_uri_empty(self):\n         )\n         OAuthAuthorizationParams.from_request(request)\n         provider.refresh_from_db()\n-        self.assertEqual(provider.redirect_uris, \"+\")\n+        self.assertEqual(provider.redirect_uris, [RedirectURI(RedirectURIMatchingMode.STRICT, \"+\")])\n \n     def test_invalid_redirect_uri_regex(self):\n         \"\"\"test missing/invalid redirect URI\"\"\"\n         OAuth2Provider.objects.create(\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid?\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid?\")],\n         )\n         with self.assertRaises(RedirectUriError):\n             request = self.factory.get(\"/\", data={\"response_type\": \"code\", \"client_id\": \"test\"})\n@@ -170,7 +172,7 @@ def test_redirect_uri_invalid_regex(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"+\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"+\")],\n         )\n         with self.assertRaises(RedirectUriError):\n             request = self.factory.get(\"/\", data={\"response_type\": \"code\", \"client_id\": \"test\"})\n@@ -213,7 +215,7 @@ def test_response_type(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid/Foo\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid/Foo\")],\n         )\n         provider.property_mappings.set(\n             ScopeMapping.objects.filter(\n@@ -301,7 +303,7 @@ def test_full_code(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=flow,\n-            redirect_uris=\"foo://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"foo://localhost\")],\n             access_code_validity=\"seconds=100\",\n         )\n         Application.objects.create(name=\"app\", slug=\"app\", provider=provider)\n@@ -343,7 +345,7 @@ def test_full_implicit(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=flow,\n-            redirect_uris=\"http://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost\")],\n             signing_key=self.keypair,\n         )\n         provider.property_mappings.set(\n@@ -420,7 +422,7 @@ def test_full_implicit_enc(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=flow,\n-            redirect_uris=\"http://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost\")],\n             signing_key=self.keypair,\n             encryption_key=self.keypair,\n         )\n@@ -486,7 +488,7 @@ def test_full_fragment_code(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=flow,\n-            redirect_uris=\"http://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost\")],\n             signing_key=self.keypair,\n         )\n         Application.objects.create(name=\"app\", slug=\"app\", provider=provider)\n@@ -541,7 +543,7 @@ def test_full_form_post_id_token(self):\n             name=generate_id(),\n             client_id=generate_id(),\n             authorization_flow=flow,\n-            redirect_uris=\"http://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost\")],\n             signing_key=self.keypair,\n         )\n         provider.property_mappings.set(\n@@ -599,7 +601,7 @@ def test_full_form_post_code(self):\n             name=generate_id(),\n             client_id=generate_id(),\n             authorization_flow=flow,\n-            redirect_uris=\"http://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost\")],\n             signing_key=self.keypair,\n         )\n         app = Application.objects.create(name=generate_id(), slug=generate_id(), provider=provider)"
            },
            {
                "sha": "f3f2a0324332d5ed08d949b480da76738381efcf",
                "filename": "authentik/providers/oauth2/tests/test_introspect.py",
                "status": "modified",
                "additions": 10,
                "deletions": 3,
                "changes": 13,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_introspect.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_introspect.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_introspect.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -11,7 +11,14 @@\n from authentik.core.tests.utils import create_test_admin_user, create_test_cert, create_test_flow\n from authentik.lib.generators import generate_id\n from authentik.providers.oauth2.constants import ACR_AUTHENTIK_DEFAULT\n-from authentik.providers.oauth2.models import AccessToken, IDToken, OAuth2Provider, RefreshToken\n+from authentik.providers.oauth2.models import (\n+    AccessToken,\n+    IDToken,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    RefreshToken,\n+)\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -23,7 +30,7 @@ def setUp(self) -> None:\n         self.provider: OAuth2Provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"\")],\n             signing_key=create_test_cert(),\n         )\n         self.app = Application.objects.create(\n@@ -118,7 +125,7 @@ def test_introspect_invalid_provider(self):\n         provider: OAuth2Provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"\")],\n             signing_key=create_test_cert(),\n         )\n         auth = b64encode(f\"{provider.client_id}:{provider.client_secret}\".encode()).decode()"
            },
            {
                "sha": "87723fff9f8009d38761ef999e60c926e537d014",
                "filename": "authentik/providers/oauth2/tests/test_jwks.py",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_jwks.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_jwks.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_jwks.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -13,7 +13,7 @@\n from authentik.crypto.builder import PrivateKeyAlg\n from authentik.crypto.models import CertificateKeyPair\n from authentik.lib.generators import generate_id\n-from authentik.providers.oauth2.models import OAuth2Provider\n+from authentik.providers.oauth2.models import OAuth2Provider, RedirectURI, RedirectURIMatchingMode\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n TEST_CORDS_CERT = \"\"\"\n@@ -49,7 +49,7 @@ def test_rs256(self):\n             name=\"test\",\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n             signing_key=create_test_cert(),\n         )\n         app = Application.objects.create(name=\"test\", slug=\"test\", provider=provider)\n@@ -68,7 +68,7 @@ def test_hs256(self):\n             name=\"test\",\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n         )\n         app = Application.objects.create(name=\"test\", slug=\"test\", provider=provider)\n         response = self.client.get(\n@@ -82,7 +82,7 @@ def test_es256(self):\n             name=\"test\",\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n             signing_key=create_test_cert(PrivateKeyAlg.ECDSA),\n         )\n         app = Application.objects.create(name=\"test\", slug=\"test\", provider=provider)\n@@ -99,7 +99,7 @@ def test_enc(self):\n             name=\"test\",\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n             signing_key=create_test_cert(PrivateKeyAlg.ECDSA),\n             encryption_key=create_test_cert(PrivateKeyAlg.ECDSA),\n         )\n@@ -122,7 +122,7 @@ def test_ecdsa_coords_mismatched(self):\n             name=\"test\",\n             client_id=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n             signing_key=cert,\n         )\n         app = Application.objects.create(name=\"test\", slug=\"test\", provider=provider)"
            },
            {
                "sha": "3b08688d3e257609dc9c7c74a43867d8dbe7242f",
                "filename": "authentik/providers/oauth2/tests/test_revoke.py",
                "status": "modified",
                "additions": 9,
                "deletions": 2,
                "changes": 11,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_revoke.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_revoke.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_revoke.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -10,7 +10,14 @@\n from authentik.core.models import Application\n from authentik.core.tests.utils import create_test_admin_user, create_test_cert, create_test_flow\n from authentik.lib.generators import generate_id\n-from authentik.providers.oauth2.models import AccessToken, IDToken, OAuth2Provider, RefreshToken\n+from authentik.providers.oauth2.models import (\n+    AccessToken,\n+    IDToken,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    RefreshToken,\n+)\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -22,7 +29,7 @@ def setUp(self) -> None:\n         self.provider: OAuth2Provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"\")],\n             signing_key=create_test_cert(),\n         )\n         self.app = Application.objects.create("
            },
            {
                "sha": "c2e897182ab95a6e640ef906d51e29757a58c490",
                "filename": "authentik/providers/oauth2/tests/test_token.py",
                "status": "modified",
                "additions": 10,
                "deletions": 8,
                "changes": 18,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -22,6 +22,8 @@\n     AccessToken,\n     AuthorizationCode,\n     OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n     RefreshToken,\n     ScopeMapping,\n )\n@@ -42,7 +44,7 @@ def test_request_auth_code(self):\n         provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://TestServer\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://TestServer\")],\n             signing_key=self.keypair,\n         )\n         header = b64encode(f\"{provider.client_id}:{provider.client_secret}\".encode()).decode()\n@@ -69,7 +71,7 @@ def test_request_auth_code_invalid(self):\n         provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://testserver\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://testserver\")],\n             signing_key=self.keypair,\n         )\n         header = b64encode(f\"{provider.client_id}:{provider.client_secret}\".encode()).decode()\n@@ -90,7 +92,7 @@ def test_request_refresh_token(self):\n         provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n             signing_key=self.keypair,\n         )\n         header = b64encode(f\"{provider.client_id}:{provider.client_secret}\".encode()).decode()\n@@ -118,7 +120,7 @@ def test_auth_code_view(self):\n         provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n             signing_key=self.keypair,\n         )\n         # Needs to be assigned to an application for iss to be set\n@@ -157,7 +159,7 @@ def test_auth_code_enc(self):\n         provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n             signing_key=self.keypair,\n             encryption_key=self.keypair,\n         )\n@@ -188,7 +190,7 @@ def test_refresh_token_view(self):\n         provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n             signing_key=self.keypair,\n         )\n         provider.property_mappings.set(\n@@ -250,7 +252,7 @@ def test_refresh_token_view_invalid_origin(self):\n         provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://local.invalid\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://local.invalid\")],\n             signing_key=self.keypair,\n         )\n         provider.property_mappings.set(\n@@ -308,7 +310,7 @@ def test_refresh_token_revoke(self):\n         provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://testserver\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://testserver\")],\n             signing_key=self.keypair,\n         )\n         provider.property_mappings.set("
            },
            {
                "sha": "d52a2ed020ded49c56311cf05b07905942504c9e",
                "filename": "authentik/providers/oauth2/tests/test_token_cc_jwt_source.py",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_jwt_source.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_jwt_source.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_jwt_source.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -19,7 +19,12 @@\n     SCOPE_OPENID_PROFILE,\n     TOKEN_TYPE,\n )\n-from authentik.providers.oauth2.models import OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n from authentik.providers.oauth2.views.jwks import JWKSView\n from authentik.sources.oauth.models import OAuthSource\n@@ -54,7 +59,7 @@ def setUp(self) -> None:\n         self.provider: OAuth2Provider = OAuth2Provider.objects.create(\n             name=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://testserver\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://testserver\")],\n             signing_key=self.cert,\n         )\n         self.provider.jwks_sources.add(self.source)"
            },
            {
                "sha": "f917c96617c2b19deb221bad17914049a9a74101",
                "filename": "authentik/providers/oauth2/tests/test_token_cc_standard.py",
                "status": "modified",
                "additions": 8,
                "deletions": 2,
                "changes": 10,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_standard.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_standard.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_standard.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -19,7 +19,13 @@\n     TOKEN_TYPE,\n )\n from authentik.providers.oauth2.errors import TokenError\n-from authentik.providers.oauth2.models import AccessToken, OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    AccessToken,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -33,7 +39,7 @@ def setUp(self) -> None:\n         self.provider = OAuth2Provider.objects.create(\n             name=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://testserver\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://testserver\")],\n             signing_key=create_test_cert(),\n         )\n         self.provider.property_mappings.set(ScopeMapping.objects.all())"
            },
            {
                "sha": "8e4b1bbfe2a1509e1c4200dfdb69456545e5e2b2",
                "filename": "authentik/providers/oauth2/tests/test_token_cc_standard_compat.py",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_standard_compat.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_standard_compat.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_standard_compat.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -20,7 +20,12 @@\n     TOKEN_TYPE,\n )\n from authentik.providers.oauth2.errors import TokenError\n-from authentik.providers.oauth2.models import OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -34,7 +39,7 @@ def setUp(self) -> None:\n         self.provider = OAuth2Provider.objects.create(\n             name=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://testserver\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://testserver\")],\n             signing_key=create_test_cert(),\n         )\n         self.provider.property_mappings.set(ScopeMapping.objects.all())"
            },
            {
                "sha": "bf57eca32b30a2ce3304060e39bb3764caa742fb",
                "filename": "authentik/providers/oauth2/tests/test_token_cc_user_pw.py",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_user_pw.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_user_pw.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_cc_user_pw.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -19,7 +19,12 @@\n     TOKEN_TYPE,\n )\n from authentik.providers.oauth2.errors import TokenError\n-from authentik.providers.oauth2.models import OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -33,7 +38,7 @@ def setUp(self) -> None:\n         self.provider = OAuth2Provider.objects.create(\n             name=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://testserver\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://testserver\")],\n             signing_key=create_test_cert(),\n         )\n         self.provider.property_mappings.set(ScopeMapping.objects.all())"
            },
            {
                "sha": "212828897e7e94b56f68276466eab5420122be91",
                "filename": "authentik/providers/oauth2/tests/test_token_device.py",
                "status": "modified",
                "additions": 9,
                "deletions": 2,
                "changes": 11,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_device.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_device.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_device.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -14,7 +14,14 @@\n     SCOPE_OPENID,\n     SCOPE_OPENID_EMAIL,\n )\n-from authentik.providers.oauth2.models import AccessToken, DeviceToken, OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    AccessToken,\n+    DeviceToken,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -28,7 +35,7 @@ def setUp(self) -> None:\n         self.provider = OAuth2Provider.objects.create(\n             name=\"test\",\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"http://testserver\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://testserver\")],\n             signing_key=create_test_cert(),\n         )\n         self.provider.property_mappings.set(ScopeMapping.objects.all())"
            },
            {
                "sha": "b296eac65e43caa97ef00cce2416202abf8e143d",
                "filename": "authentik/providers/oauth2/tests/test_token_pkce.py",
                "status": "modified",
                "additions": 10,
                "deletions": 5,
                "changes": 15,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_pkce.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_pkce.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_token_pkce.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -10,7 +10,12 @@\n from authentik.core.tests.utils import create_test_admin_user, create_test_flow\n from authentik.lib.generators import generate_id\n from authentik.providers.oauth2.constants import GRANT_TYPE_AUTHORIZATION_CODE\n-from authentik.providers.oauth2.models import AuthorizationCode, OAuth2Provider\n+from authentik.providers.oauth2.models import (\n+    AuthorizationCode,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+)\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -30,7 +35,7 @@ def test_pkce_missing_in_authorize(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=flow,\n-            redirect_uris=\"foo://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"foo://localhost\")],\n             access_code_validity=\"seconds=100\",\n         )\n         Application.objects.create(name=\"app\", slug=\"app\", provider=provider)\n@@ -93,7 +98,7 @@ def test_pkce_missing_in_token(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=flow,\n-            redirect_uris=\"foo://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"foo://localhost\")],\n             access_code_validity=\"seconds=100\",\n         )\n         Application.objects.create(name=\"app\", slug=\"app\", provider=provider)\n@@ -154,7 +159,7 @@ def test_pkce_correct_s256(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=flow,\n-            redirect_uris=\"foo://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"foo://localhost\")],\n             access_code_validity=\"seconds=100\",\n         )\n         Application.objects.create(name=\"app\", slug=\"app\", provider=provider)\n@@ -210,7 +215,7 @@ def test_pkce_correct_plain(self):\n             name=generate_id(),\n             client_id=\"test\",\n             authorization_flow=flow,\n-            redirect_uris=\"foo://localhost\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"foo://localhost\")],\n             access_code_validity=\"seconds=100\",\n         )\n         Application.objects.create(name=\"app\", slug=\"app\", provider=provider)"
            },
            {
                "sha": "e7cd423266592b7d47f74ee87baa1df14f0e4b11",
                "filename": "authentik/providers/oauth2/tests/test_userinfo.py",
                "status": "modified",
                "additions": 9,
                "deletions": 2,
                "changes": 11,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_userinfo.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_userinfo.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Ftests%2Ftest_userinfo.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -11,7 +11,14 @@\n from authentik.core.tests.utils import create_test_admin_user, create_test_cert, create_test_flow\n from authentik.events.models import Event, EventAction\n from authentik.lib.generators import generate_id\n-from authentik.providers.oauth2.models import AccessToken, IDToken, OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    AccessToken,\n+    IDToken,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from authentik.providers.oauth2.tests.utils import OAuthTestCase\n \n \n@@ -25,7 +32,7 @@ def setUp(self) -> None:\n         self.provider: OAuth2Provider = OAuth2Provider.objects.create(\n             name=generate_id(),\n             authorization_flow=create_test_flow(),\n-            redirect_uris=\"\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"\")],\n             signing_key=create_test_cert(),\n         )\n         self.provider.property_mappings.set(ScopeMapping.objects.all())"
            },
            {
                "sha": "156f634f26765cb59e7605d3732efdf63ff383e8",
                "filename": "authentik/providers/oauth2/views/authorize.py",
                "status": "modified",
                "additions": 29,
                "deletions": 28,
                "changes": 57,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fviews%2Fauthorize.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fviews%2Fauthorize.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Fviews%2Fauthorize.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -56,6 +56,8 @@\n     AuthorizationCode,\n     GrantTypes,\n     OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n     ResponseMode,\n     ResponseTypes,\n     ScopeMapping,\n@@ -187,40 +189,39 @@ def check_grant(self):\n \n     def check_redirect_uri(self):\n         \"\"\"Redirect URI validation.\"\"\"\n-        allowed_redirect_urls = self.provider.redirect_uris.split()\n+        allowed_redirect_urls = self.provider.redirect_uris\n         if not self.redirect_uri:\n             LOGGER.warning(\"Missing redirect uri.\")\n             raise RedirectUriError(\"\", allowed_redirect_urls)\n \n-        if self.provider.redirect_uris == \"\":\n+        if len(allowed_redirect_urls) < 1:\n             LOGGER.info(\"Setting redirect for blank redirect_uris\", redirect=self.redirect_uri)\n-            self.provider.redirect_uris = self.redirect_uri\n+            self.provider.redirect_uris = [\n+                RedirectURI(RedirectURIMatchingMode.STRICT, self.redirect_uri)\n+            ]\n             self.provider.save()\n-            allowed_redirect_urls = self.provider.redirect_uris.split()\n-\n-        if self.provider.redirect_uris == \"*\":\n-            LOGGER.info(\"Converting redirect_uris to regex\", redirect=self.redirect_uri)\n-            self.provider.redirect_uris = \".*\"\n-            self.provider.save()\n-            allowed_redirect_urls = self.provider.redirect_uris.split()\n-\n-        try:\n-            if not any(fullmatch(x, self.redirect_uri) for x in allowed_redirect_urls):\n-                LOGGER.warning(\n-                    \"Invalid redirect uri (regex comparison)\",\n-                    redirect_uri_given=self.redirect_uri,\n-                    redirect_uri_expected=allowed_redirect_urls,\n-                )\n-                raise RedirectUriError(self.redirect_uri, allowed_redirect_urls)\n-        except RegexError as exc:\n-            LOGGER.info(\"Failed to parse regular expression, checking directly\", exc=exc)\n-            if not any(x == self.redirect_uri for x in allowed_redirect_urls):\n-                LOGGER.warning(\n-                    \"Invalid redirect uri (strict comparison)\",\n-                    redirect_uri_given=self.redirect_uri,\n-                    redirect_uri_expected=allowed_redirect_urls,\n-                )\n-                raise RedirectUriError(self.redirect_uri, allowed_redirect_urls) from None\n+            allowed_redirect_urls = self.provider.redirect_uris\n+\n+        match_found = False\n+        for allowed in allowed_redirect_urls:\n+            if allowed.matching_mode == RedirectURIMatchingMode.STRICT:\n+                if self.redirect_uri == allowed.url:\n+                    match_found = True\n+                    break\n+            if allowed.matching_mode == RedirectURIMatchingMode.REGEX:\n+                try:\n+                    if fullmatch(allowed.url, self.redirect_uri):\n+                        match_found = True\n+                        break\n+                except RegexError as exc:\n+                    LOGGER.warning(\n+                        \"Failed to parse regular expression\",\n+                        exc=exc,\n+                        url=allowed.url,\n+                        provider=self.provider,\n+                    )\n+        if not match_found:\n+            raise RedirectUriError(self.redirect_uri, allowed_redirect_urls)\n         # Check against forbidden schemes\n         if urlparse(self.redirect_uri).scheme in FORBIDDEN_URI_SCHEMES:\n             raise RedirectUriError(self.redirect_uri, allowed_redirect_urls)"
            },
            {
                "sha": "eab3e62be04a4c922d564f299a8b3870e641baa7",
                "filename": "authentik/providers/oauth2/views/provider.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fviews%2Fprovider.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fviews%2Fprovider.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Fviews%2Fprovider.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -162,5 +162,5 @@ def dispatch(\n             OAuth2Provider, pk=application.provider_id\n         )\n         response = super().dispatch(request, *args, **kwargs)\n-        cors_allow(request, response, *self.provider.redirect_uris.split(\"\\n\"))\n+        cors_allow(request, response, *[x.url for x in self.provider.redirect_uris])\n         return response"
            },
            {
                "sha": "aa3a9fcc26578e9ae08707c7a95ffe204a6dd24d",
                "filename": "authentik/providers/oauth2/views/token.py",
                "status": "modified",
                "additions": 45,
                "deletions": 37,
                "changes": 82,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fviews%2Ftoken.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fviews%2Ftoken.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Fviews%2Ftoken.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -58,6 +58,7 @@\n     ClientTypes,\n     DeviceToken,\n     OAuth2Provider,\n+    RedirectURIMatchingMode,\n     RefreshToken,\n     ScopeMapping,\n )\n@@ -195,42 +196,7 @@ def __post_init_code(self, raw_code: str, request: HttpRequest):\n             LOGGER.warning(\"Missing authorization code\")\n             raise TokenError(\"invalid_grant\")\n \n-        allowed_redirect_urls = self.provider.redirect_uris.split()\n-        # At this point, no provider should have a blank redirect_uri, in case they do\n-        # this will check an empty array and raise an error\n-        try:\n-            if not any(fullmatch(x, self.redirect_uri) for x in allowed_redirect_urls):\n-                LOGGER.warning(\n-                    \"Invalid redirect uri (regex comparison)\",\n-                    redirect_uri=self.redirect_uri,\n-                    expected=allowed_redirect_urls,\n-                )\n-                Event.new(\n-                    EventAction.CONFIGURATION_ERROR,\n-                    message=\"Invalid redirect URI used by provider\",\n-                    provider=self.provider,\n-                    redirect_uri=self.redirect_uri,\n-                    expected=allowed_redirect_urls,\n-                ).from_http(request)\n-                raise TokenError(\"invalid_client\")\n-        except RegexError as exc:\n-            LOGGER.info(\"Failed to parse regular expression, checking directly\", exc=exc)\n-            if not any(x == self.redirect_uri for x in allowed_redirect_urls):\n-                LOGGER.warning(\n-                    \"Invalid redirect uri (strict comparison)\",\n-                    redirect_uri=self.redirect_uri,\n-                    expected=allowed_redirect_urls,\n-                )\n-                Event.new(\n-                    EventAction.CONFIGURATION_ERROR,\n-                    message=\"Invalid redirect_uri configured\",\n-                    provider=self.provider,\n-                ).from_http(request)\n-                raise TokenError(\"invalid_client\") from None\n-\n-        # Check against forbidden schemes\n-        if urlparse(self.redirect_uri).scheme in FORBIDDEN_URI_SCHEMES:\n-            raise TokenError(\"invalid_request\")\n+        self.__check_redirect_uri(request)\n \n         self.authorization_code = AuthorizationCode.objects.filter(code=raw_code).first()\n         if not self.authorization_code:\n@@ -270,6 +236,48 @@ def __post_init_code(self, raw_code: str, request: HttpRequest):\n         if not self.authorization_code.code_challenge and self.code_verifier:\n             raise TokenError(\"invalid_grant\")\n \n+    def __check_redirect_uri(self, request: HttpRequest):\n+        allowed_redirect_urls = self.provider.redirect_uris\n+        # At this point, no provider should have a blank redirect_uri, in case they do\n+        # this will check an empty array and raise an error\n+\n+        match_found = False\n+        for allowed in allowed_redirect_urls:\n+            if allowed.matching_mode == RedirectURIMatchingMode.STRICT:\n+                if self.redirect_uri == allowed.url:\n+                    match_found = True\n+                    break\n+            if allowed.matching_mode == RedirectURIMatchingMode.REGEX:\n+                try:\n+                    if fullmatch(allowed.url, self.redirect_uri):\n+                        match_found = True\n+                        break\n+                except RegexError as exc:\n+                    LOGGER.warning(\n+                        \"Failed to parse regular expression\",\n+                        exc=exc,\n+                        url=allowed.url,\n+                        provider=self.provider,\n+                    )\n+                    Event.new(\n+                        EventAction.CONFIGURATION_ERROR,\n+                        message=\"Invalid redirect_uri configured\",\n+                        provider=self.provider,\n+                    ).from_http(request)\n+        if not match_found:\n+            Event.new(\n+                EventAction.CONFIGURATION_ERROR,\n+                message=\"Invalid redirect URI used by provider\",\n+                provider=self.provider,\n+                redirect_uri=self.redirect_uri,\n+                expected=allowed_redirect_urls,\n+            ).from_http(request)\n+            raise TokenError(\"invalid_client\")\n+\n+        # Check against forbidden schemes\n+        if urlparse(self.redirect_uri).scheme in FORBIDDEN_URI_SCHEMES:\n+            raise TokenError(\"invalid_request\")\n+\n     def __post_init_refresh(self, raw_token: str, request: HttpRequest):\n         if not raw_token:\n             LOGGER.warning(\"Missing refresh token\")\n@@ -513,7 +521,7 @@ def dispatch(self, request: HttpRequest, *args: Any, **kwargs: Any) -> HttpRespo\n         response = super().dispatch(request, *args, **kwargs)\n         allowed_origins = []\n         if self.provider:\n-            allowed_origins = self.provider.redirect_uris.split(\"\\n\")\n+            allowed_origins = [x.url for x in self.provider.redirect_uris]\n         cors_allow(self.request, response, *allowed_origins)\n         return response\n "
            },
            {
                "sha": "cf151cf6d655283badbd0b6c703dbe2bc5b26d34",
                "filename": "authentik/providers/oauth2/views/userinfo.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fviews%2Fuserinfo.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Foauth2%2Fviews%2Fuserinfo.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Foauth2%2Fviews%2Fuserinfo.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -108,7 +108,7 @@ def dispatch(self, request: HttpRequest, *args: Any, **kwargs: Any) -> HttpRespo\n         response = super().dispatch(request, *args, **kwargs)\n         allowed_origins = []\n         if self.token:\n-            allowed_origins = self.token.provider.redirect_uris.split(\"\\n\")\n+            allowed_origins = [x.url for x in self.token.provider.redirect_uris]\n         cors_allow(self.request, response, *allowed_origins)\n         return response\n "
            },
            {
                "sha": "bd52be08d55d8f393219ed182fa7f980a780f934",
                "filename": "authentik/providers/proxy/api.py",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Fproxy%2Fapi.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Fproxy%2Fapi.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Fproxy%2Fapi.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -121,7 +121,6 @@ class ProxyProviderViewSet(UsedByMixin, ModelViewSet):\n         \"basic_auth_password_attribute\": [\"iexact\"],\n         \"basic_auth_user_attribute\": [\"iexact\"],\n         \"mode\": [\"iexact\"],\n-        \"redirect_uris\": [\"iexact\"],\n         \"cookie_domain\": [\"iexact\"],\n     }\n     search_fields = [\"name\"]"
            },
            {
                "sha": "55d6091f629db55217bd6ae992ea1e8cd49a823d",
                "filename": "authentik/providers/proxy/models.py",
                "status": "modified",
                "additions": 14,
                "deletions": 7,
                "changes": 21,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Fproxy%2Fmodels.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/authentik%2Fproviders%2Fproxy%2Fmodels.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Fproviders%2Fproxy%2Fmodels.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -13,7 +13,13 @@\n from authentik.crypto.models import CertificateKeyPair\n from authentik.lib.models import DomainlessURLValidator\n from authentik.outposts.models import OutpostModel\n-from authentik.providers.oauth2.models import ClientTypes, OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    ClientTypes,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n \n SCOPE_AK_PROXY = \"ak_proxy\"\n OUTPOST_CALLBACK_SIGNATURE = \"X-authentik-auth-callback\"\n@@ -24,14 +30,15 @@ def get_cookie_secret():\n     return \"\".join(SystemRandom().choice(string.ascii_uppercase + string.digits) for _ in range(32))\n \n \n-def _get_callback_url(uri: str) -> str:\n-    return \"\\n\".join(\n-        [\n+def _get_callback_url(uri: str) -> list[RedirectURI]:\n+    return [\n+        RedirectURI(\n+            RedirectURIMatchingMode.STRICT,\n             urljoin(uri, \"outpost.goauthentik.io/callback\")\n             + f\"\\\\?{OUTPOST_CALLBACK_SIGNATURE}=true\",\n-            uri + f\"\\\\?{OUTPOST_CALLBACK_SIGNATURE}=true\",\n-        ]\n-    )\n+        ),\n+        RedirectURI(RedirectURIMatchingMode.STRICT, uri + f\"\\\\?{OUTPOST_CALLBACK_SIGNATURE}=true\"),\n+    ]\n \n \n class ProxyMode(models.TextChoices):"
            },
            {
                "sha": "6fe68733b639ee8ec3743ee3fd17b12917b1e453",
                "filename": "blueprints/schema.json",
                "status": "modified",
                "additions": 24,
                "deletions": 3,
                "changes": 27,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/blueprints%2Fschema.json",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/blueprints%2Fschema.json",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/blueprints%2Fschema.json?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -5570,9 +5570,30 @@\n                     \"description\": \"Key used to encrypt the tokens. When set, tokens will be encrypted and returned as JWEs.\"\n                 },\n                 \"redirect_uris\": {\n-                    \"type\": \"string\",\n-                    \"title\": \"Redirect URIs\",\n-                    \"description\": \"Enter each URI on a new line.\"\n+                    \"type\": \"array\",\n+                    \"items\": {\n+                        \"type\": \"object\",\n+                        \"properties\": {\n+                            \"matching_mode\": {\n+                                \"type\": \"string\",\n+                                \"enum\": [\n+                                    \"strict\",\n+                                    \"regex\"\n+                                ],\n+                                \"title\": \"Matching mode\"\n+                            },\n+                            \"url\": {\n+                                \"type\": \"string\",\n+                                \"minLength\": 1,\n+                                \"title\": \"Url\"\n+                            }\n+                        },\n+                        \"required\": [\n+                            \"matching_mode\",\n+                            \"url\"\n+                        ]\n+                    },\n+                    \"title\": \"Redirect uris\"\n                 },\n                 \"sub_mode\": {\n                     \"type\": \"string\","
            },
            {
                "sha": "7f41fd902fca0d4573be7d497700f09efac708ce",
                "filename": "schema.yml",
                "status": "modified",
                "additions": 39,
                "deletions": 14,
                "changes": 53,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/schema.yml",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/schema.yml",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/schema.yml?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -20224,10 +20224,6 @@ paths:\n             format: uuid\n         explode: true\n         style: form\n-      - in: query\n-        name: redirect_uris\n-        schema:\n-          type: string\n       - in: query\n         name: refresh_token_validity\n         schema:\n@@ -20643,10 +20639,6 @@ paths:\n             format: uuid\n         explode: true\n         style: form\n-      - in: query\n-        name: redirect_uris__iexact\n-        schema:\n-          type: string\n       - name: search\n         required: false\n         in: query\n@@ -44074,6 +44066,11 @@ components:\n       required:\n       - challenge\n       - name\n+    MatchingModeEnum:\n+      enum:\n+      - strict\n+      - regex\n+      type: string\n     Metadata:\n       type: object\n       description: Serializer for blueprint metadata\n@@ -44776,8 +44773,9 @@ components:\n           description: Key used to encrypt the tokens. When set, tokens will be encrypted\n             and returned as JWEs.\n         redirect_uris:\n-          type: string\n-          description: Enter each URI on a new line.\n+          type: array\n+          items:\n+            $ref: '#/components/schemas/RedirectURI'\n         sub_mode:\n           allOf:\n           - $ref: '#/components/schemas/SubModeEnum'\n@@ -44806,6 +44804,7 @@ components:\n       - meta_model_name\n       - name\n       - pk\n+      - redirect_uris\n       - verbose_name\n       - verbose_name_plural\n     OAuth2ProviderRequest:\n@@ -44877,8 +44876,9 @@ components:\n           description: Key used to encrypt the tokens. When set, tokens will be encrypted\n             and returned as JWEs.\n         redirect_uris:\n-          type: string\n-          description: Enter each URI on a new line.\n+          type: array\n+          items:\n+            $ref: '#/components/schemas/RedirectURIRequest'\n         sub_mode:\n           allOf:\n           - $ref: '#/components/schemas/SubModeEnum'\n@@ -44900,6 +44900,7 @@ components:\n       - authorization_flow\n       - invalidation_flow\n       - name\n+      - redirect_uris\n     OAuth2ProviderSetupURLs:\n       type: object\n       description: OAuth2 Provider Metadata serializer\n@@ -48898,8 +48899,9 @@ components:\n           description: Key used to encrypt the tokens. When set, tokens will be encrypted\n             and returned as JWEs.\n         redirect_uris:\n-          type: string\n-          description: Enter each URI on a new line.\n+          type: array\n+          items:\n+            $ref: '#/components/schemas/RedirectURIRequest'\n         sub_mode:\n           allOf:\n           - $ref: '#/components/schemas/SubModeEnum'\n@@ -52092,6 +52094,29 @@ components:\n           type: string\n       required:\n       - to\n+    RedirectURI:\n+      type: object\n+      description: A single allowed redirect URI entry\n+      properties:\n+        matching_mode:\n+          $ref: '#/components/schemas/MatchingModeEnum'\n+        url:\n+          type: string\n+      required:\n+      - matching_mode\n+      - url\n+    RedirectURIRequest:\n+      type: object\n+      description: A single allowed redirect URI entry\n+      properties:\n+        matching_mode:\n+          $ref: '#/components/schemas/MatchingModeEnum'\n+        url:\n+          type: string\n+          minLength: 1\n+      required:\n+      - matching_mode\n+      - url\n     Reputation:\n       type: object\n       description: Reputation Serializer"
            },
            {
                "sha": "977308ead1616beb04a19699f5a7eec25ac20d9c",
                "filename": "tests/e2e/test_provider_oauth2_github.py",
                "status": "modified",
                "additions": 15,
                "deletions": 4,
                "changes": 19,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/tests%2Fe2e%2Ftest_provider_oauth2_github.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/tests%2Fe2e%2Ftest_provider_oauth2_github.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/tests%2Fe2e%2Ftest_provider_oauth2_github.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -12,7 +12,12 @@\n from authentik.lib.generators import generate_id, generate_key\n from authentik.policies.expression.models import ExpressionPolicy\n from authentik.policies.models import PolicyBinding\n-from authentik.providers.oauth2.models import ClientTypes, OAuth2Provider\n+from authentik.providers.oauth2.models import (\n+    ClientTypes,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+)\n from tests.e2e.utils import SeleniumTestCase, retry\n \n \n@@ -73,7 +78,9 @@ def test_authorization_consent_implied(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             client_type=ClientTypes.CONFIDENTIAL,\n-            redirect_uris=\"http://localhost:3000/login/github\",\n+            redirect_uris=[\n+                RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:3000/login/github\")\n+            ],\n             authorization_flow=authorization_flow,\n         )\n         Application.objects.create(\n@@ -128,7 +135,9 @@ def test_authorization_consent_explicit(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             client_type=ClientTypes.CONFIDENTIAL,\n-            redirect_uris=\"http://localhost:3000/login/github\",\n+            redirect_uris=[\n+                RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:3000/login/github\")\n+            ],\n             authorization_flow=authorization_flow,\n         )\n         app = Application.objects.create(\n@@ -199,7 +208,9 @@ def test_denied(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             client_type=ClientTypes.CONFIDENTIAL,\n-            redirect_uris=\"http://localhost:3000/login/github\",\n+            redirect_uris=[\n+                RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:3000/login/github\")\n+            ],\n             authorization_flow=authorization_flow,\n         )\n         app = Application.objects.create("
            },
            {
                "sha": "14816abf563542157498c2b2a67178e5bdcb4e8f",
                "filename": "tests/e2e/test_provider_oauth2_grafana.py",
                "status": "modified",
                "additions": 28,
                "deletions": 6,
                "changes": 34,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/tests%2Fe2e%2Ftest_provider_oauth2_grafana.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/tests%2Fe2e%2Ftest_provider_oauth2_grafana.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/tests%2Fe2e%2Ftest_provider_oauth2_grafana.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -19,7 +19,13 @@\n     SCOPE_OPENID_EMAIL,\n     SCOPE_OPENID_PROFILE,\n )\n-from authentik.providers.oauth2.models import ClientTypes, OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    ClientTypes,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from tests.e2e.utils import SeleniumTestCase, retry\n \n \n@@ -82,7 +88,7 @@ def test_redirect_uri_error(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:3000/\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:3000/\")],\n             authorization_flow=authorization_flow,\n         )\n         provider.property_mappings.set(\n@@ -131,7 +137,11 @@ def test_authorization_consent_implied(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:3000/login/generic_oauth\",\n+            redirect_uris=[\n+                RedirectURI(\n+                    RedirectURIMatchingMode.STRICT, \"http://localhost:3000/login/generic_oauth\"\n+                )\n+            ],\n             authorization_flow=authorization_flow,\n         )\n         provider.property_mappings.set(\n@@ -200,7 +210,11 @@ def test_authorization_logout(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:3000/login/generic_oauth\",\n+            redirect_uris=[\n+                RedirectURI(\n+                    RedirectURIMatchingMode.STRICT, \"http://localhost:3000/login/generic_oauth\"\n+                )\n+            ],\n             authorization_flow=authorization_flow,\n             invalidation_flow=invalidation_flow,\n         )\n@@ -275,7 +289,11 @@ def test_authorization_consent_explicit(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:3000/login/generic_oauth\",\n+            redirect_uris=[\n+                RedirectURI(\n+                    RedirectURIMatchingMode.STRICT, \"http://localhost:3000/login/generic_oauth\"\n+                )\n+            ],\n         )\n         provider.property_mappings.set(\n             ScopeMapping.objects.filter(\n@@ -355,7 +373,11 @@ def test_authorization_denied(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:3000/login/generic_oauth\",\n+            redirect_uris=[\n+                RedirectURI(\n+                    RedirectURIMatchingMode.STRICT, \"http://localhost:3000/login/generic_oauth\"\n+                )\n+            ],\n         )\n         provider.property_mappings.set(\n             ScopeMapping.objects.filter("
            },
            {
                "sha": "e8cf11c5b3f79a02375ac269e509af1512a0192c",
                "filename": "tests/e2e/test_provider_oidc.py",
                "status": "modified",
                "additions": 17,
                "deletions": 5,
                "changes": 22,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/tests%2Fe2e%2Ftest_provider_oidc.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/tests%2Fe2e%2Ftest_provider_oidc.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/tests%2Fe2e%2Ftest_provider_oidc.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -19,7 +19,13 @@\n     SCOPE_OPENID_EMAIL,\n     SCOPE_OPENID_PROFILE,\n )\n-from authentik.providers.oauth2.models import ClientTypes, OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    ClientTypes,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from tests.e2e.utils import SeleniumTestCase, retry\n \n \n@@ -67,7 +73,7 @@ def test_redirect_uri_error(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:9009/\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:9009/\")],\n             authorization_flow=authorization_flow,\n         )\n         provider.property_mappings.set(\n@@ -116,7 +122,9 @@ def test_authorization_consent_implied(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:9009/auth/callback\",\n+            redirect_uris=[\n+                RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:9009/auth/callback\")\n+            ],\n             authorization_flow=authorization_flow,\n         )\n         provider.property_mappings.set(\n@@ -188,7 +196,9 @@ def test_authorization_consent_explicit(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:9009/auth/callback\",\n+            redirect_uris=[\n+                RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:9009/auth/callback\")\n+            ],\n         )\n         provider.property_mappings.set(\n             ScopeMapping.objects.filter(\n@@ -259,7 +269,9 @@ def test_authorization_denied(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:9009/auth/callback\",\n+            redirect_uris=[\n+                RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:9009/auth/callback\")\n+            ],\n         )\n         provider.property_mappings.set(\n             ScopeMapping.objects.filter("
            },
            {
                "sha": "8c7cad0c6957bdfe02abb47a1307581f06376894",
                "filename": "tests/e2e/test_provider_oidc_implicit.py",
                "status": "modified",
                "additions": 17,
                "deletions": 5,
                "changes": 22,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/tests%2Fe2e%2Ftest_provider_oidc_implicit.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/tests%2Fe2e%2Ftest_provider_oidc_implicit.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/tests%2Fe2e%2Ftest_provider_oidc_implicit.py?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -19,7 +19,13 @@\n     SCOPE_OPENID_EMAIL,\n     SCOPE_OPENID_PROFILE,\n )\n-from authentik.providers.oauth2.models import ClientTypes, OAuth2Provider, ScopeMapping\n+from authentik.providers.oauth2.models import (\n+    ClientTypes,\n+    OAuth2Provider,\n+    RedirectURI,\n+    RedirectURIMatchingMode,\n+    ScopeMapping,\n+)\n from tests.e2e.utils import SeleniumTestCase, retry\n \n \n@@ -68,7 +74,7 @@ def test_redirect_uri_error(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:9009/\",\n+            redirect_uris=[RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:9009/\")],\n             authorization_flow=authorization_flow,\n         )\n         provider.property_mappings.set(\n@@ -117,7 +123,9 @@ def test_authorization_consent_implied(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:9009/implicit/\",\n+            redirect_uris=[\n+                RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:9009/implicit/\")\n+            ],\n             authorization_flow=authorization_flow,\n         )\n         provider.property_mappings.set(\n@@ -170,7 +178,9 @@ def test_authorization_consent_explicit(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:9009/implicit/\",\n+            redirect_uris=[\n+                RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:9009/implicit/\")\n+            ],\n         )\n         provider.property_mappings.set(\n             ScopeMapping.objects.filter(\n@@ -238,7 +248,9 @@ def test_authorization_denied(self):\n             client_id=self.client_id,\n             client_secret=self.client_secret,\n             signing_key=create_test_cert(),\n-            redirect_uris=\"http://localhost:9009/implicit/\",\n+            redirect_uris=[\n+                RedirectURI(RedirectURIMatchingMode.STRICT, \"http://localhost:9009/implicit/\")\n+            ],\n         )\n         provider.property_mappings.set(\n             ScopeMapping.objects.filter("
            },
            {
                "sha": "fb99d15476e813a3eb208aed63577bd536e5efef",
                "filename": "web/src/admin/providers/oauth2/OAuth2ProviderForm.ts",
                "status": "modified",
                "additions": 37,
                "deletions": 8,
                "changes": 45,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/web%2Fsrc%2Fadmin%2Fproviders%2Foauth2%2FOAuth2ProviderForm.ts",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/web%2Fsrc%2Fadmin%2Fproviders%2Foauth2%2FOAuth2ProviderForm.ts",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/web%2Fsrc%2Fadmin%2Fproviders%2Foauth2%2FOAuth2ProviderForm.ts?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -1,11 +1,16 @@\n import \"@goauthentik/admin/common/ak-crypto-certificate-search\";\n import \"@goauthentik/admin/common/ak-flow-search/ak-flow-search\";\n import { BaseProviderForm } from \"@goauthentik/admin/providers/BaseProviderForm\";\n+import {\n+    IRedirectURIInput,\n+    akOAuthRedirectURIInput,\n+} from \"@goauthentik/admin/providers/oauth2/OAuth2ProviderRedirectURI\";\n import { DEFAULT_CONFIG } from \"@goauthentik/common/api/config\";\n import { ascii_letters, digits, first, randomString } from \"@goauthentik/common/utils\";\n import \"@goauthentik/components/ak-radio-input\";\n import \"@goauthentik/components/ak-text-input\";\n import \"@goauthentik/components/ak-textarea-input\";\n+import \"@goauthentik/elements/ak-array-input.js\";\n import \"@goauthentik/elements/ak-dual-select/ak-dual-select-dynamic-selected-provider.js\";\n import \"@goauthentik/elements/ak-dual-select/ak-dual-select-provider.js\";\n import \"@goauthentik/elements/forms/FormGroup\";\n@@ -15,16 +20,18 @@ import \"@goauthentik/elements/forms/SearchSelect\";\n import \"@goauthentik/elements/utils/TimeDeltaHelp\";\n \n import { msg } from \"@lit/localize\";\n-import { TemplateResult, html } from \"lit\";\n+import { TemplateResult, css, html } from \"lit\";\n import { customElement, state } from \"lit/decorators.js\";\n import { ifDefined } from \"lit/directives/if-defined.js\";\n \n import {\n     ClientTypeEnum,\n     FlowsInstancesListDesignationEnum,\n     IssuerModeEnum,\n+    MatchingModeEnum,\n     OAuth2Provider,\n     ProvidersApi,\n+    RedirectURI,\n     SubModeEnum,\n } from \"@goauthentik/api\";\n \n@@ -98,13 +105,13 @@ export const issuerModeOptions = [\n \n const redirectUriHelpMessages = [\n     msg(\n-        \"Valid redirect URLs after a successful authorization flow. Also specify any origins here for Implicit flows.\",\n+        \"Valid redirect URIs after a successful authorization flow. Also specify any origins here for Implicit flows.\",\n     ),\n     msg(\n         \"If no explicit redirect URIs are specified, the first successfully used redirect URI will be saved.\",\n     ),\n     msg(\n-        'To allow any redirect URI, set this value to \".*\". Be aware of the possible security implications this can have.',\n+        'To allow any redirect URI, set the mode to Regex and the value to \".*\". Be aware of the possible security implications this can have.',\n     ),\n ];\n \n@@ -124,11 +131,23 @@ export class OAuth2ProviderFormPage extends BaseProviderForm<OAuth2Provider> {\n     @state()\n     showClientSecret = true;\n \n+    @state()\n+    redirectUris: RedirectURI[] = [];\n+\n+    static get styles() {\n+        return super.styles.concat(css`\n+            ak-array-input {\n+                width: 100%;\n+            }\n+        `);\n+    }\n+\n     async loadInstance(pk: number): Promise<OAuth2Provider> {\n         const provider = await new ProvidersApi(DEFAULT_CONFIG).providersOauth2Retrieve({\n             id: pk,\n         });\n         this.showClientSecret = provider.clientType === ClientTypeEnum.Confidential;\n+        this.redirectUris = provider.redirectUris;\n         return provider;\n     }\n \n@@ -203,13 +222,23 @@ export class OAuth2ProviderFormPage extends BaseProviderForm<OAuth2Provider> {\n                         ?hidden=${!this.showClientSecret}\n                     >\n                     </ak-text-input>\n-                    <ak-textarea-input\n+                    <ak-form-element-horizontal\n+                        label=${msg(\"Redirect URIs/Origins\")}\n+                        required\n                         name=\"redirectUris\"\n-                        label=${msg(\"Redirect URIs/Origins (RegEx)\")}\n-                        .value=${provider?.redirectUris}\n-                        .bighelp=${redirectUriHelp}\n                     >\n-                    </ak-textarea-input>\n+                        <ak-array-input\n+                            .items=${this.instance?.redirectUris ?? []}\n+                            .newItem=${() => ({ matchingMode: MatchingModeEnum.Strict, url: \"\" })}\n+                            .row=${(f?: RedirectURI) =>\n+                                akOAuthRedirectURIInput({\n+                                    \".redirectURI\": f,\n+                                    \"style\": \"width: 100%\",\n+                                } as unknown as IRedirectURIInput)}\n+                        >\n+                        </ak-array-input>\n+                        ${redirectUriHelp}\n+                    </ak-form-element-horizontal>\n \n                     <ak-form-element-horizontal label=${msg(\"Signing Key\")} name=\"signingKey\">\n                         <!-- NOTE: 'null' cast to 'undefined' on signingKey to satisfy Lit requirements -->"
            },
            {
                "sha": "0420b68b0050ca7eec4bed21ddf0231d6604751c",
                "filename": "web/src/admin/providers/oauth2/OAuth2ProviderRedirectURI.ts",
                "status": "added",
                "additions": 104,
                "deletions": 0,
                "changes": 104,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/web%2Fsrc%2Fadmin%2Fproviders%2Foauth2%2FOAuth2ProviderRedirectURI.ts",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/web%2Fsrc%2Fadmin%2Fproviders%2Foauth2%2FOAuth2ProviderRedirectURI.ts",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/web%2Fsrc%2Fadmin%2Fproviders%2Foauth2%2FOAuth2ProviderRedirectURI.ts?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -0,0 +1,104 @@\n+import \"@goauthentik/admin/providers/oauth2/OAuth2ProviderRedirectURI\";\n+import { AkControlElement } from \"@goauthentik/elements/AkControlElement.js\";\n+import { type Spread } from \"@goauthentik/elements/types\";\n+import { spread } from \"@open-wc/lit-helpers\";\n+\n+import { msg } from \"@lit/localize\";\n+import { css, html } from \"lit\";\n+import { customElement, property, queryAll } from \"lit/decorators.js\";\n+import { ifDefined } from \"lit/directives/if-defined.js\";\n+\n+import PFFormControl from \"@patternfly/patternfly/components/FormControl/form-control.css\";\n+import PFInputGroup from \"@patternfly/patternfly/components/InputGroup/input-group.css\";\n+import PFBase from \"@patternfly/patternfly/patternfly-base.css\";\n+\n+import { MatchingModeEnum, RedirectURI } from \"@goauthentik/api\";\n+\n+export interface IRedirectURIInput {\n+    redirectURI: RedirectURI;\n+}\n+\n+@customElement(\"ak-provider-oauth2-redirect-uri\")\n+export class OAuth2ProviderRedirectURI extends AkControlElement<RedirectURI> {\n+    static get styles() {\n+        return [\n+            PFBase,\n+            PFInputGroup,\n+            PFFormControl,\n+            css`\n+                .pf-c-input-group select {\n+                    width: 10em;\n+                }\n+            `,\n+        ];\n+    }\n+\n+    @property({ type: Object, attribute: false })\n+    redirectURI: RedirectURI = {\n+        matchingMode: MatchingModeEnum.Strict,\n+        url: \"\",\n+    };\n+\n+    @queryAll(\".ak-form-control\")\n+    controls?: HTMLInputElement[];\n+\n+    json() {\n+        return Object.fromEntries(\n+            Array.from(this.controls ?? []).map((control) => [control.name, control.value]),\n+        ) as unknown as RedirectURI;\n+    }\n+\n+    get isValid() {\n+        return true;\n+    }\n+\n+    render() {\n+        const onChange = () => {\n+            this.dispatchEvent(new Event(\"change\", { composed: true, bubbles: true }));\n+        };\n+\n+        return html`<div class=\"pf-c-input-group\">\n+            <select\n+                name=\"matchingMode\"\n+                class=\"pf-c-form-control ak-form-control\"\n+                @change=${onChange}\n+            >\n+                <option\n+                    value=\"${MatchingModeEnum.Strict}\"\n+                    ?selected=${this.redirectURI.matchingMode === MatchingModeEnum.Strict}\n+                >\n+                    ${msg(\"Strict\")}\n+                </option>\n+                <option\n+                    value=\"${MatchingModeEnum.Regex}\"\n+                    ?selected=${this.redirectURI.matchingMode === MatchingModeEnum.Regex}\n+                >\n+                    ${msg(\"Regex\")}\n+                </option>\n+            </select>\n+            <input\n+                type=\"text\"\n+                @change=${onChange}\n+                value=\"${ifDefined(this.redirectURI.url ?? undefined)}\"\n+                class=\"pf-c-form-control ak-form-control\"\n+                required\n+                id=\"url\"\n+                placeholder=${msg(\"URL\")}\n+                name=\"href\"\n+                tabindex=\"1\"\n+            />\n+        </div>`;\n+    }\n+}\n+\n+export function akOAuthRedirectURIInput(properties: IRedirectURIInput) {\n+    return html`<ak-provider-oauth2-redirect-uri\n+        ${spread(properties as unknown as Spread)}\n+    ></ak-provider-oauth2-redirect-uri>`;\n+}\n+\n+declare global {\n+    interface HTMLElementTagNameMap {\n+        \"ak-provider-oauth2-redirect-uri\": OAuth2ProviderRedirectURI;\n+    }\n+}"
            },
            {
                "sha": "8d995a48e75e479251978703fb9a40c82dbc9744",
                "filename": "web/src/elements/forms/HorizontalFormElement.ts",
                "status": "modified",
                "additions": 13,
                "deletions": 3,
                "changes": 16,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/web%2Fsrc%2Felements%2Fforms%2FHorizontalFormElement.ts",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/web%2Fsrc%2Felements%2Fforms%2FHorizontalFormElement.ts",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/web%2Fsrc%2Felements%2Fforms%2FHorizontalFormElement.ts?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -2,7 +2,7 @@ import { convertToSlug } from \"@goauthentik/common/utils\";\n import { AKElement } from \"@goauthentik/elements/Base\";\n import { FormGroup } from \"@goauthentik/elements/forms/FormGroup\";\n \n-import { msg } from \"@lit/localize\";\n+import { msg, str } from \"@lit/localize\";\n import { CSSResult, css } from \"lit\";\n import { TemplateResult, html } from \"lit\";\n import { customElement, property } from \"lit/decorators.js\";\n@@ -33,7 +33,7 @@ import PFBase from \"@patternfly/patternfly/patternfly-base.css\";\n  *    where the field isn't available for the user to view unless they explicitly request to be able\n  *    to see the content; otherwise, a dead password field is shown. There are 10 uses of this\n  *    feature.\n- * \n+ *\n  */\n \n const isAkControl = (el: unknown): boolean =>\n@@ -86,7 +86,7 @@ export class HorizontalFormElement extends AKElement {\n     writeOnlyActivated = false;\n \n     @property({ attribute: false })\n-    errorMessages: string[] = [];\n+    errorMessages: string[] | string[][] = [];\n \n     @property({ type: Boolean })\n     slugMode = false;\n@@ -183,6 +183,16 @@ export class HorizontalFormElement extends AKElement {\n                           </p>`\n                         : html``}\n                     ${this.errorMessages.map((message) => {\n+                        if (message instanceof Object) {\n+                            return html`${Object.entries(message).map(([field, errMsg]) => {\n+                                return html`<p\n+                                    class=\"pf-c-form__helper-text pf-m-error\"\n+                                    aria-live=\"polite\"\n+                                >\n+                                    ${msg(str`${field}: ${errMsg}`)}\n+                                </p>`;\n+                            })}`;\n+                        }\n                         return html`<p class=\"pf-c-form__helper-text pf-m-error\" aria-live=\"polite\">\n                             ${message}\n                         </p>`;"
            },
            {
                "sha": "c9443d64c93ea716bf659cc532a03523b8d4c58e",
                "filename": "website/docs/security/cves/CVE-2024-52289.md",
                "status": "added",
                "additions": 30,
                "deletions": 0,
                "changes": 30,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/website%2Fdocs%2Fsecurity%2Fcves%2FCVE-2024-52289.md",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/website%2Fdocs%2Fsecurity%2Fcves%2FCVE-2024-52289.md",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/website%2Fdocs%2Fsecurity%2Fcves%2FCVE-2024-52289.md?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -0,0 +1,30 @@\n+# CVE-2024-52289\n+\n+_Reported by [@PontusHanssen](https://github.com/PontusHanssen)_\n+\n+## Insecure default configuration for OAuth2 Redirect URIs\n+\n+### Summary\n+\n+Redirect URIs in the OAuth2 provider in authentik are checked by RegEx comparison.\n+When no Redirect URIs are configured in a provider, authentik will automatically use the first `redirect_uri` value received as an allowed redirect URI, without escaping characters that have a special meaning in RegEx. Similarly, the documentation did not take this into consideration either.\n+\n+Given a provider with the Redirect URIs set to `https://foo.example.com`, an attacker can register a domain `fooaexample.com`, and it will correctly pass validation.\n+\n+### Patches\n+\n+authentik 2024.8.5 and 2024.10.3 fix this issue.\n+\n+The patched versions remedy this issue by changing the format that the Redirect URIs are saved in, allowing for the explicit configuration if the URL should be checked strictly or as a RegEx. This means that these patches include a backwards-incompatible database change and API change.\n+\n+Manual action _is required_ if any provider is intended to use RegEx for Redirect URIs because the migration will set the comparison type to strict for every Redirect URI.\n+\n+### Workarounds\n+\n+When configuring OAuth2 providers, make sure to escape any wildcard characters that are not intended to function as a wildcard, for example replace `.` with `\\.`.\n+\n+### For more information\n+\n+If you have any questions or comments about this advisory:\n+\n+-   Email us at [security@goauthentik.io](mailto:security@goauthentik.io)"
            },
            {
                "sha": "7a3f51adc5d4a554998851859b9f772da956691a",
                "filename": "website/sidebars.js",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/goauthentik/authentik/blob/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/website%2Fsidebars.js",
                "raw_url": "https://github.com/goauthentik/authentik/raw/85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54/website%2Fsidebars.js",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/website%2Fsidebars.js?ref=85bb638243c8d7ea42ddd3b15b3f51a90d2b8c54",
                "patch": "@@ -659,6 +659,7 @@ export default {\n                             label: \"2024\",\n                             items: [\n                                 \"security/cves/CVE-2024-52307\",\n+                                \"security/cves/CVE-2024-52289\",\n                                 \"security/cves/CVE-2024-52287\",\n                                 \"security/cves/CVE-2024-47077\",\n                                 \"security/cves/CVE-2024-47070\","
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/goauthentik/authentik/commits/5ea4580884f99369f0ccfe484c04cb03a66e65b8",
        "url": "https://api.github.com/repos/goauthentik/authentik/commits/5ea4580884f99369f0ccfe484c04cb03a66e65b8",
        "html_url": "https://github.com/goauthentik/authentik/commit/5ea4580884f99369f0ccfe484c04cb03a66e65b8",
        "message": "security: fix CVE 2024 52307 (#12115)\n\n* security: fix CVE-2024-52307\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* add docs\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n* fix tests\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>\r\n\r\n---------\r\n\r\nSigned-off-by: Jens Langhammer <jens@goauthentik.io>",
        "files": [
            {
                "sha": "ab6a7153fbb95a50bf8865269a416ad6c24430d5",
                "filename": "authentik/root/monitoring.py",
                "status": "modified",
                "additions": 11,
                "deletions": 10,
                "changes": 21,
                "blob_url": "https://github.com/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/authentik%2Froot%2Fmonitoring.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/5ea4580884f99369f0ccfe484c04cb03a66e65b8/authentik%2Froot%2Fmonitoring.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Froot%2Fmonitoring.py?ref=5ea4580884f99369f0ccfe484c04cb03a66e65b8",
                "patch": "@@ -1,6 +1,8 @@\n \"\"\"Metrics view\"\"\"\n \n-from base64 import b64encode\n+from hmac import compare_digest\n+from pathlib import Path\n+from tempfile import gettempdir\n \n from django.conf import settings\n from django.db import connections\n@@ -16,22 +18,21 @@\n \n \n class MetricsView(View):\n-    \"\"\"Wrapper around ExportToDjangoView, using http-basic auth\"\"\"\n+    \"\"\"Wrapper around ExportToDjangoView with authentication, accessed by the authentik router\"\"\"\n+\n+    def __init__(self, **kwargs):\n+        _tmp = Path(gettempdir())\n+        with open(_tmp / \"authentik-core-metrics.key\") as _f:\n+            self.monitoring_key = _f.read()\n \n     def get(self, request: HttpRequest) -> HttpResponse:\n         \"\"\"Check for HTTP-Basic auth\"\"\"\n         auth_header = request.META.get(\"HTTP_AUTHORIZATION\", \"\")\n         auth_type, _, given_credentials = auth_header.partition(\" \")\n-        credentials = f\"monitor:{settings.SECRET_KEY}\"\n-        expected = b64encode(str.encode(credentials)).decode()\n-        authed = auth_type == \"Basic\" and given_credentials == expected\n+        authed = auth_type == \"Bearer\" and compare_digest(given_credentials, self.monitoring_key)\n         if not authed and not settings.DEBUG:\n-            response = HttpResponse(status=401)\n-            response[\"WWW-Authenticate\"] = 'Basic realm=\"authentik-monitoring\"'\n-            return response\n-\n+            return HttpResponse(status=401)\n         monitoring_set.send_robust(self)\n-\n         return ExportToDjangoView(request)\n \n "
            },
            {
                "sha": "175caa8d994c3fca5e98d5c696ac38462ce05b47",
                "filename": "authentik/root/tests.py",
                "status": "modified",
                "additions": 14,
                "deletions": 4,
                "changes": 18,
                "blob_url": "https://github.com/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/authentik%2Froot%2Ftests.py",
                "raw_url": "https://github.com/goauthentik/authentik/raw/5ea4580884f99369f0ccfe484c04cb03a66e65b8/authentik%2Froot%2Ftests.py",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/authentik%2Froot%2Ftests.py?ref=5ea4580884f99369f0ccfe484c04cb03a66e65b8",
                "patch": "@@ -1,24 +1,34 @@\n \"\"\"root tests\"\"\"\n \n-from base64 import b64encode\n+from pathlib import Path\n+from secrets import token_urlsafe\n+from tempfile import gettempdir\n \n-from django.conf import settings\n from django.test import TestCase\n from django.urls import reverse\n \n \n class TestRoot(TestCase):\n     \"\"\"Test root application\"\"\"\n \n+    def setUp(self):\n+        _tmp = Path(gettempdir())\n+        self.token = token_urlsafe(32)\n+        with open(_tmp / \"authentik-core-metrics.key\", \"w\") as _f:\n+            _f.write(self.token)\n+\n+    def tearDown(self):\n+        _tmp = Path(gettempdir())\n+        (_tmp / \"authentik-core-metrics.key\").unlink()\n+\n     def test_monitoring_error(self):\n         \"\"\"Test monitoring without any credentials\"\"\"\n         response = self.client.get(reverse(\"metrics\"))\n         self.assertEqual(response.status_code, 401)\n \n     def test_monitoring_ok(self):\n         \"\"\"Test monitoring with credentials\"\"\"\n-        creds = \"Basic \" + b64encode(f\"monitor:{settings.SECRET_KEY}\".encode()).decode(\"utf-8\")\n-        auth_headers = {\"HTTP_AUTHORIZATION\": creds}\n+        auth_headers = {\"HTTP_AUTHORIZATION\": f\"Bearer {self.token}\"}\n         response = self.client.get(reverse(\"metrics\"), **auth_headers)\n         self.assertEqual(response.status_code, 200)\n "
            },
            {
                "sha": "40d9671f6e25715b09545045dd2db900800a1836",
                "filename": "internal/web/metrics.go",
                "status": "modified",
                "additions": 22,
                "deletions": 3,
                "changes": 25,
                "blob_url": "https://github.com/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/internal%2Fweb%2Fmetrics.go",
                "raw_url": "https://github.com/goauthentik/authentik/raw/5ea4580884f99369f0ccfe484c04cb03a66e65b8/internal%2Fweb%2Fmetrics.go",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/internal%2Fweb%2Fmetrics.go?ref=5ea4580884f99369f0ccfe484c04cb03a66e65b8",
                "patch": "@@ -1,11 +1,15 @@\n package web\n \n import (\n+\t\"encoding/base64\"\n \t\"fmt\"\n \t\"io\"\n \t\"net/http\"\n+\t\"os\"\n+\t\"path\"\n \n \t\"github.com/gorilla/mux\"\n+\t\"github.com/gorilla/securecookie\"\n \t\"github.com/prometheus/client_golang/prometheus\"\n \t\"github.com/prometheus/client_golang/prometheus/promauto\"\n \t\"github.com/prometheus/client_golang/prometheus/promhttp\"\n@@ -14,14 +18,25 @@ import (\n \t\"goauthentik.io/internal/utils/sentry\"\n )\n \n+const MetricsKeyFile = \"authentik-core-metrics.key\"\n+\n var Requests = promauto.NewHistogramVec(prometheus.HistogramOpts{\n \tName: \"authentik_main_request_duration_seconds\",\n \tHelp: \"API request latencies in seconds\",\n }, []string{\"dest\"})\n \n func (ws *WebServer) runMetricsServer() {\n-\tm := mux.NewRouter()\n \tl := log.WithField(\"logger\", \"authentik.router.metrics\")\n+\ttmp := os.TempDir()\n+\tkey := base64.StdEncoding.EncodeToString(securecookie.GenerateRandomKey(64))\n+\tkeyPath := path.Join(tmp, MetricsKeyFile)\n+\terr := os.WriteFile(keyPath, []byte(key), 0o600)\n+\tif err != nil {\n+\t\tl.WithError(err).Warning(\"failed to save metrics key\")\n+\t\treturn\n+\t}\n+\n+\tm := mux.NewRouter()\n \tm.Use(sentry.SentryNoSampleMiddleware)\n \tm.Path(\"/metrics\").HandlerFunc(func(rw http.ResponseWriter, r *http.Request) {\n \t\tpromhttp.InstrumentMetricHandler(\n@@ -36,7 +51,7 @@ func (ws *WebServer) runMetricsServer() {\n \t\t\tl.WithError(err).Warning(\"failed to get upstream metrics\")\n \t\t\treturn\n \t\t}\n-\t\tre.SetBasicAuth(\"monitor\", config.Get().SecretKey)\n+\t\tre.Header.Set(\"Authorization\", fmt.Sprintf(\"Bearer %s\", key))\n \t\tres, err := ws.upstreamHttpClient().Do(re)\n \t\tif err != nil {\n \t\t\tl.WithError(err).Warning(\"failed to get upstream metrics\")\n@@ -49,9 +64,13 @@ func (ws *WebServer) runMetricsServer() {\n \t\t}\n \t})\n \tl.WithField(\"listen\", config.Get().Listen.Metrics).Info(\"Starting Metrics server\")\n-\terr := http.ListenAndServe(config.Get().Listen.Metrics, m)\n+\terr = http.ListenAndServe(config.Get().Listen.Metrics, m)\n \tif err != nil {\n \t\tl.WithError(err).Warning(\"Failed to start metrics server\")\n \t}\n \tl.WithField(\"listen\", config.Get().Listen.Metrics).Info(\"Stopping Metrics server\")\n+\terr = os.Remove(keyPath)\n+\tif err != nil {\n+\t\tl.WithError(err).Warning(\"failed to remove metrics key file\")\n+\t}\n }"
            },
            {
                "sha": "186dd4ddf018d082eb94bb89e8fe0ffd4ab72538",
                "filename": "internal/web/web.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/internal%2Fweb%2Fweb.go",
                "raw_url": "https://github.com/goauthentik/authentik/raw/5ea4580884f99369f0ccfe484c04cb03a66e65b8/internal%2Fweb%2Fweb.go",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/internal%2Fweb%2Fweb.go?ref=5ea4580884f99369f0ccfe484c04cb03a66e65b8",
                "patch": "@@ -53,7 +53,7 @@ func NewWebServer() *WebServer {\n \tloggingHandler.Use(web.NewLoggingHandler(l, nil))\n \n \ttmp := os.TempDir()\n-\tsocketPath := path.Join(tmp, \"authentik-core.sock\")\n+\tsocketPath := path.Join(tmp, UnixSocketName)\n \n \t// create http client to talk to backend, normal client if we're in debug more\n \t// and a client that connects to our socket when in non debug mode"
            },
            {
                "sha": "8d076af56a66481e10dae91e2ea6c14ba242d9f6",
                "filename": "website/docs/developer-docs/releases/index.md",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/website%2Fdocs%2Fdeveloper-docs%2Freleases%2Findex.md",
                "raw_url": "https://github.com/goauthentik/authentik/raw/5ea4580884f99369f0ccfe484c04cb03a66e65b8/website%2Fdocs%2Fdeveloper-docs%2Freleases%2Findex.md",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/website%2Fdocs%2Fdeveloper-docs%2Freleases%2Findex.md?ref=5ea4580884f99369f0ccfe484c04cb03a66e65b8",
                "patch": "@@ -78,7 +78,7 @@ Short summary of the issue\n \n ### Patches\n \n-authentik x, y and z fix this issue, for other versions the workaround can be used.\n+authentik x, y and z fix this issue, for other versions the workaround below can be used.\n \n ### Impact\n \n@@ -96,7 +96,7 @@ Describe a workaround if possible\n \n If you have any questions or comments about this advisory:\n \n--   Email us at [security@goauthentik.io](mailto:security@goauthentik.io)\n+-   Email us at [security@goauthentik.io](mailto:security@goauthentik.io).\n ```\n \n </details>"
            },
            {
                "sha": "978d7cc015e9458ec3b124b02515a4300a70cd48",
                "filename": "website/docs/security/cves/CVE-2024-52307.md",
                "status": "added",
                "additions": 36,
                "deletions": 0,
                "changes": 36,
                "blob_url": "https://github.com/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/website%2Fdocs%2Fsecurity%2Fcves%2FCVE-2024-52307.md",
                "raw_url": "https://github.com/goauthentik/authentik/raw/5ea4580884f99369f0ccfe484c04cb03a66e65b8/website%2Fdocs%2Fsecurity%2Fcves%2FCVE-2024-52307.md",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/website%2Fdocs%2Fsecurity%2Fcves%2FCVE-2024-52307.md?ref=5ea4580884f99369f0ccfe484c04cb03a66e65b8",
                "patch": "@@ -0,0 +1,36 @@\n+# CVE-2024-52307\n+\n+_Reported by [@mgerstner](https://github.com/mgerstner)_\n+\n+## Timing attack due to a lack of constant time comparison for metrics view\n+\n+### Summary\n+\n+Due to the usage of a non-constant time comparison for the `/-/metrics/` endpoint it was possible to brute-force the `SECRET_KEY`, which is used to authenticate the endpoint. The `/-/metrics/` endpoint returns Prometheus metrics and is not intended to be accessed directly, as the Go proxy running in the authentik server container fetches data from this endpoint and serves it on a separate port (9300 by default), which can be scraped by Prometheus without being exposed publicly.\n+\n+### Patches\n+\n+authentik 2024.8.5 and 2024.10.3 fix this issue, for other versions the workaround below can be used.\n+\n+### Impact\n+\n+With enough attempts the `SECRET_KEY` of the authentik installation can be brute-forced, which can be used to sign new or modify existing cookies.\n+\n+### Workarounds\n+\n+Since the `/-/metrics/` endpoint is not intended to be accessed publicly, requests to the endpoint can be blocked by the reverse proxy/load balancer used in conjunction with authentik.\n+\n+For example for nginx:\n+\n+```\n+location /-/metrics/ {\n+    deny all;\n+    return 404;\n+}\n+```\n+\n+### For more information\n+\n+If you have any questions or comments about this advisory:\n+\n+-   Email us at [security@goauthentik.io](mailto:security@goauthentik.io)."
            },
            {
                "sha": "8a815a800b4d7fb489c3b9e0e43f8928dfab5b09",
                "filename": "website/sidebars.js",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/goauthentik/authentik/blob/5ea4580884f99369f0ccfe484c04cb03a66e65b8/website%2Fsidebars.js",
                "raw_url": "https://github.com/goauthentik/authentik/raw/5ea4580884f99369f0ccfe484c04cb03a66e65b8/website%2Fsidebars.js",
                "contents_url": "https://api.github.com/repos/goauthentik/authentik/contents/website%2Fsidebars.js?ref=5ea4580884f99369f0ccfe484c04cb03a66e65b8",
                "patch": "@@ -658,6 +658,7 @@ export default {\n                             type: \"category\",\n                             label: \"2024\",\n                             items: [\n+                                \"security/cves/CVE-2024-52307\",\n                                 \"security/cves/CVE-2024-52287\",\n                                 \"security/cves/CVE-2024-47077\",\n                                 \"security/cves/CVE-2024-47070\","
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/drakkan/sftpgo/commits/b524da11e9466d05fe03304713ee1c61bb276ec4",
        "url": "https://api.github.com/repos/drakkan/sftpgo/commits/b524da11e9466d05fe03304713ee1c61bb276ec4",
        "html_url": "https://github.com/drakkan/sftpgo/commit/b524da11e9466d05fe03304713ee1c61bb276ec4",
        "message": "EventManager: disable commands by default\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
        "files": [
            {
                "sha": "bce645150ef621891af5b544c32c0d71c54b52cd",
                "filename": "internal/common/protocol_test.go",
                "status": "modified",
                "additions": 21,
                "deletions": 4,
                "changes": 25,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/b524da11e9466d05fe03304713ee1c61bb276ec4/internal%2Fcommon%2Fprotocol_test.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/b524da11e9466d05fe03304713ee1c61bb276ec4/internal%2Fcommon%2Fprotocol_test.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fcommon%2Fprotocol_test.go?ref=b524da11e9466d05fe03304713ee1c61bb276ec4",
                "patch": "@@ -3928,6 +3928,11 @@ func TestEventRule(t *testing.T) {\n \terr = os.WriteFile(uploadScriptPath, getUploadScriptContent(movedPath, \"\", 0), 0755)\n \tassert.NoError(t, err)\n \n+\tdataprovider.EnabledActionCommands = []string{uploadScriptPath}\n+\tdefer func() {\n+\t\tdataprovider.EnabledActionCommands = nil\n+\t}()\n+\n \taction1.Type = dataprovider.ActionTypeCommand\n \taction1.Options = dataprovider.BaseEventActionOptions{\n \t\tCmdConfig: dataprovider.EventActionCommandConfig{\n@@ -4265,6 +4270,10 @@ func TestEventRuleDisabledCommand(t *testing.T) {\n \t\t\t},\n \t\t},\n \t}\n+\t_, _, err = httpdtest.AddEventAction(a1, http.StatusBadRequest)\n+\tassert.NoError(t, err)\n+\t// Enable the command to allow saving\n+\tdataprovider.EnabledActionCommands = []string{a1.Options.CmdConfig.Cmd}\n \taction1, _, err := httpdtest.AddEventAction(a1, http.StatusCreated)\n \tassert.NoError(t, err)\n \taction2, _, err := httpdtest.AddEventAction(a2, http.StatusCreated)\n@@ -4312,8 +4321,8 @@ func TestEventRuleDisabledCommand(t *testing.T) {\n \t}\n \trule, _, err := httpdtest.AddEventRule(r, http.StatusCreated)\n \tassert.NoError(t, err)\n-\t// restrit command execution\n-\tdataprovider.EnabledActionCommands = []string{\"/bin/ls\"}\n+\t// restrict command execution\n+\tdataprovider.EnabledActionCommands = nil\n \n \tlastReceivedEmail.reset()\n \t// create a folder to trigger the rule\n@@ -4335,8 +4344,6 @@ func TestEventRuleDisabledCommand(t *testing.T) {\n \tassert.Contains(t, email.Data, fmt.Sprintf(\"Object name: %s object type: folder\", folder.Name))\n \tlastReceivedEmail.reset()\n \n-\tdataprovider.EnabledActionCommands = nil\n-\n \t_, err = httpdtest.RemoveFolder(folder, http.StatusOK)\n \tassert.NoError(t, err)\n \n@@ -4368,6 +4375,11 @@ func TestEventRuleProviderEvents(t *testing.T) {\n \terr = os.WriteFile(saveObjectScriptPath, getSaveProviderObjectScriptContent(outPath, 0), 0755)\n \tassert.NoError(t, err)\n \n+\tdataprovider.EnabledActionCommands = []string{saveObjectScriptPath}\n+\tdefer func() {\n+\t\tdataprovider.EnabledActionCommands = nil\n+\t}()\n+\n \ta1 := dataprovider.BaseEventAction{\n \t\tName: \"a1\",\n \t\tType: dataprovider.ActionTypeCommand,\n@@ -5231,6 +5243,11 @@ func TestEventActionCommandEnvVars(t *testing.T) {\n \tenvName := \"MY_ENV\"\n \tuploadScriptPath := filepath.Join(os.TempDir(), \"upload.sh\")\n \n+\tdataprovider.EnabledActionCommands = []string{uploadScriptPath}\n+\tdefer func() {\n+\t\tdataprovider.EnabledActionCommands = nil\n+\t}()\n+\n \terr := os.WriteFile(uploadScriptPath, getUploadScriptEnvContent(envName), 0755)\n \tassert.NoError(t, err)\n \ta1 := dataprovider.BaseEventAction{"
            },
            {
                "sha": "82f80746e09dceb1cbbba2c2dadca3c4bb7ca93a",
                "filename": "internal/dataprovider/eventrule.go",
                "status": "modified",
                "additions": 1,
                "deletions": 4,
                "changes": 5,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/b524da11e9466d05fe03304713ee1c61bb276ec4/internal%2Fdataprovider%2Feventrule.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/b524da11e9466d05fe03304713ee1c61bb276ec4/internal%2Fdataprovider%2Feventrule.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fdataprovider%2Feventrule.go?ref=b524da11e9466d05fe03304713ee1c61bb276ec4",
                "patch": "@@ -59,7 +59,7 @@ var (\n \t\tActionTypeDataRetentionCheck, ActionTypePasswordExpirationCheck, ActionTypeUserExpirationCheck,\n \t\tActionTypeUserInactivityCheck, ActionTypeIDPAccountCheck, ActionTypeRotateLogs}\n \t// EnabledActionCommands defines the system commands that can be executed via EventManager,\n-\t// an empty list means that any command is allowed to be executed.\n+\t// an empty list means that no command is allowed to be executed.\n \tEnabledActionCommands []string\n )\n \n@@ -455,9 +455,6 @@ func (c *EventActionHTTPConfig) GetHTTPClient() *http.Client {\n \n // IsActionCommandAllowed returns true if the specified command is allowed\n func IsActionCommandAllowed(cmd string) bool {\n-\tif len(EnabledActionCommands) == 0 {\n-\t\treturn true\n-\t}\n \treturn slices.Contains(EnabledActionCommands, cmd)\n }\n "
            },
            {
                "sha": "9e1dd4c0572c1df5a72caf3781c08c82582ace23",
                "filename": "internal/httpd/httpd_test.go",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/b524da11e9466d05fe03304713ee1c61bb276ec4/internal%2Fhttpd%2Fhttpd_test.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/b524da11e9466d05fe03304713ee1c61bb276ec4/internal%2Fhttpd%2Fhttpd_test.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fhttpd%2Fhttpd_test.go?ref=b524da11e9466d05fe03304713ee1c61bb276ec4",
                "patch": "@@ -1840,6 +1840,10 @@ func TestBasicActionRulesHandling(t *testing.T) {\n \t\t\t},\n \t\t},\n \t}\n+\tdataprovider.EnabledActionCommands = []string{a.Options.CmdConfig.Cmd}\n+\tdefer func() {\n+\t\tdataprovider.EnabledActionCommands = nil\n+\t}()\n \t_, _, err = httpdtest.UpdateEventAction(a, http.StatusOK)\n \tassert.NoError(t, err)\n \t// invalid type\n@@ -2374,13 +2378,24 @@ func TestEventActionValidation(t *testing.T) {\n \tassert.NoError(t, err)\n \tassert.Contains(t, string(resp), \"command is required\")\n \taction.Options.CmdConfig.Cmd = \"relative\"\n+\tdataprovider.EnabledActionCommands = []string{action.Options.CmdConfig.Cmd}\n+\tdefer func() {\n+\t\tdataprovider.EnabledActionCommands = nil\n+\t}()\n+\n \t_, resp, err = httpdtest.AddEventAction(action, http.StatusBadRequest)\n \tassert.NoError(t, err)\n \tassert.Contains(t, string(resp), \"invalid command, it must be an absolute path\")\n \taction.Options.CmdConfig.Cmd = filepath.Join(os.TempDir(), \"cmd\")\n \t_, resp, err = httpdtest.AddEventAction(action, http.StatusBadRequest)\n \tassert.NoError(t, err)\n+\tassert.Contains(t, string(resp), \"is not allowed\")\n+\n+\tdataprovider.EnabledActionCommands = []string{action.Options.CmdConfig.Cmd}\n+\t_, resp, err = httpdtest.AddEventAction(action, http.StatusBadRequest)\n+\tassert.NoError(t, err)\n \tassert.Contains(t, string(resp), \"invalid command action timeout\")\n+\n \taction.Options.CmdConfig.Timeout = 30\n \taction.Options.CmdConfig.EnvVars = []dataprovider.KeyValue{\n \t\t{\n@@ -24027,6 +24042,10 @@ func TestWebEventAction(t *testing.T) {\n \t\t\t},\n \t\t},\n \t}\n+\tdataprovider.EnabledActionCommands = []string{action.Options.CmdConfig.Cmd}\n+\tdefer func() {\n+\t\tdataprovider.EnabledActionCommands = nil\n+\t}()\n \tform.Set(\"type\", fmt.Sprintf(\"%d\", action.Type))\n \treq, err = http.NewRequest(http.MethodPost, path.Join(webAdminEventActionPath, action.Name),\n \t\tbytes.NewBuffer([]byte(form.Encode())))"
            },
            {
                "sha": "75ffb795a4a35f1c0d558d2d5301a5b75a92625c",
                "filename": "templates/webadmin/eventaction.html",
                "status": "modified",
                "additions": 6,
                "deletions": 9,
                "changes": 15,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/b524da11e9466d05fe03304713ee1c61bb276ec4/templates%2Fwebadmin%2Feventaction.html",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/b524da11e9466d05fe03304713ee1c61bb276ec4/templates%2Fwebadmin%2Feventaction.html",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/templates%2Fwebadmin%2Feventaction.html?ref=b524da11e9466d05fe03304713ee1c61bb276ec4",
                "patch": "@@ -44,6 +44,11 @@ <h3 data-i18n=\"{{.Title}}\" class=\"card-title section-title\"></h3>\n                 <div class=\"col-md-9\">\n                     <select id=\"idType\" name=\"type\" class=\"form-select\" data-control=\"i18n-select2\" data-hide-search=\"true\">\n                         {{- range .ActionTypes}}\n+                        {{- if eq .Value 2}}\n+                            {{- if not $.EnabledCommands}}\n+                                {{- continue}}\n+                            {{- end}}\n+                        {{- end}}\n                         <option value=\"{{.Value}}\" {{if eq $.Action.Type .Value }}selected{{end}} data-i18n=\"{{.Name}}\"></option>\n                         {{- end}}\n                     </select>\n@@ -400,21 +405,13 @@ <h3 data-i18n=\"actions.multipart_body\" class=\"card-title section-title-inner\">Mu\n             <div class=\"form-group row action-type action-cmd mt-10\">\n                 <label for=\"idCmdPath\" data-i18n=\"actions.types.command\" class=\"col-md-3 col-form-label\">Command</label>\n                 <div class=\"col-md-9\">\n-                    <select id=\"idCmdPath\" name=\"cmd_path\" class=\"form-select\" data-control=\"i18n-select2\" data-hide-search=\"true\">\n+                    <select id=\"idCmdPath\" name=\"cmd_path\" class=\"form-select\" data-control=\"i18n-select2\" data-hide-search=\"false\">\n                         {{- range .EnabledCommands}}\n                         <option value=\"{{.}}\" {{if eq $.Action.Options.CmdConfig.Cmd . }}selected{{end}}>{{.}}</option>\n                         {{- end}}\n                     </select>\n                 </div>\n             </div>\n-            {{- else}}\n-            <div class=\"form-group row action-type action-cmd mt-10\">\n-                <label for=\"idCmdPath\" data-i18n=\"actions.types.command\" class=\"col-md-3 col-form-label\">Command</label>\n-                <div class=\"col-md-9\">\n-                    <input id=\"idCmdPath\" type=\"text\" class=\"form-control\" name=\"cmd_path\" value=\"{{.Action.Options.CmdConfig.Cmd}}\" aria-describedby=\"idCmdPathHelp\" />\n-                    <div id=\"idCmdPathHelp\" class=\"form-text\" data-i18n=\"actions.command_help\"></div>\n-                </div>\n-            </div>\n             {{- end}}\n \n             <div class=\"form-group row action-type action-cmd mt-10\">"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/drakkan/sftpgo/commits/88b1850b5806eee81150873d4e565144b21021fb",
        "url": "https://api.github.com/repos/drakkan/sftpgo/commits/88b1850b5806eee81150873d4e565144b21021fb",
        "html_url": "https://github.com/drakkan/sftpgo/commit/88b1850b5806eee81150873d4e565144b21021fb",
        "message": "EventManager: allow to define the allowed system commands\n\nSigned-off-by: Nicola Murino <nicola.murino@gmail.com>",
        "files": [
            {
                "sha": "44962f9df804f8cbe709617929f3774a51c2ff9c",
                "filename": "internal/common/common.go",
                "status": "modified",
                "additions": 24,
                "deletions": 1,
                "changes": 25,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fcommon%2Fcommon.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fcommon%2Fcommon.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fcommon%2Fcommon.go?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -239,6 +239,9 @@ func Initialize(c Configuration, isShared int) error {\n \tif err := c.initializeProxyProtocol(); err != nil {\n \t\treturn err\n \t}\n+\tif err := c.EventManager.validate(); err != nil {\n+\t\treturn err\n+\t}\n \tvfs.SetTempPath(c.TempPath)\n \tdataprovider.SetTempPath(c.TempPath)\n \tvfs.SetAllowSelfConnections(c.AllowSelfConnections)\n@@ -247,6 +250,7 @@ func Initialize(c Configuration, isShared int) error {\n \tvfs.SetResumeMaxSize(c.ResumeMaxSize)\n \tvfs.SetUploadMode(c.UploadMode)\n \tdataprovider.SetAllowSelfConnections(c.AllowSelfConnections)\n+\tdataprovider.EnabledActionCommands = c.EventManager.EnabledCommands\n \ttransfersChecker = getTransfersChecker(isShared)\n \treturn nil\n }\n@@ -512,6 +516,23 @@ type ConnectionTransfer struct {\n \tDLSize        int64  `json:\"-\"`\n }\n \n+// EventManagerConfig defines the configuration for the EventManager\n+type EventManagerConfig struct {\n+\t// EnabledCommands defines the system commands that can be executed via EventManager,\n+\t// an empty list means that any command is allowed to be executed.\n+\t// Commands must be set as an absolute path\n+\tEnabledCommands []string `json:\"enabled_commands\" mapstructure:\"enabled_commands\"`\n+}\n+\n+func (c *EventManagerConfig) validate() error {\n+\tfor _, c := range c.EnabledCommands {\n+\t\tif !filepath.IsAbs(c) {\n+\t\t\treturn fmt.Errorf(\"invalid command %q: it must be an absolute path\", c)\n+\t\t}\n+\t}\n+\treturn nil\n+}\n+\n // MetadataConfig defines how to handle metadata for cloud storage backends\n type MetadataConfig struct {\n \t// If not zero the metadata will be read before downloads and will be\n@@ -621,7 +642,9 @@ type Configuration struct {\n \t// server's local time, otherwise UTC will be used.\n \tTZ string `json:\"tz\" mapstructure:\"tz\"`\n \t// Metadata configuration\n-\tMetadata              MetadataConfig `json:\"metadata\" mapstructure:\"metadata\"`\n+\tMetadata MetadataConfig `json:\"metadata\" mapstructure:\"metadata\"`\n+\t// EventManager configuration\n+\tEventManager          EventManagerConfig `json:\"event_manager\" mapstructure:\"event_manager\"`\n \tidleTimeoutAsDuration time.Duration\n \tidleLoginTimeout      time.Duration\n \tdefender              Defender"
            },
            {
                "sha": "8a14af7b9d1750b901973ced2b0872c70ee34e61",
                "filename": "internal/common/common_test.go",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fcommon%2Fcommon_test.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fcommon%2Fcommon_test.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fcommon%2Fcommon_test.go?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -217,6 +217,33 @@ func TestConnections(t *testing.T) {\n \tConnections.RUnlock()\n }\n \n+func TestEventManagerCommandsInitialization(t *testing.T) {\n+\tconfigCopy := Config\n+\n+\tc := Configuration{\n+\t\tEventManager: EventManagerConfig{\n+\t\t\tEnabledCommands: []string{\"ls\"}, // not an absolute path\n+\t\t},\n+\t}\n+\terr := Initialize(c, 0)\n+\tassert.ErrorContains(t, err, \"invalid command\")\n+\n+\tvar commands []string\n+\tif runtime.GOOS == osWindows {\n+\t\tcommands = []string{\"C:\\\\command\"}\n+\t} else {\n+\t\tcommands = []string{\"/bin/ls\"}\n+\t}\n+\n+\tc.EventManager.EnabledCommands = commands\n+\terr = Initialize(c, 0)\n+\tassert.NoError(t, err)\n+\tassert.Equal(t, commands, dataprovider.EnabledActionCommands)\n+\n+\tdataprovider.EnabledActionCommands = configCopy.EventManager.EnabledCommands\n+\tConfig = configCopy\n+}\n+\n func TestInitializationProxyErrors(t *testing.T) {\n \tconfigCopy := Config\n "
            },
            {
                "sha": "89c66bcd0dc4b99447630eabde152c905e532e79",
                "filename": "internal/common/eventmanager.go",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fcommon%2Feventmanager.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fcommon%2Feventmanager.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fcommon%2Feventmanager.go?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -1484,6 +1484,9 @@ func executeHTTPRuleAction(c dataprovider.EventActionHTTPConfig, params *EventPa\n }\n \n func executeCommandRuleAction(c dataprovider.EventActionCommandConfig, params *EventParams) error {\n+\tif !dataprovider.IsActionCommandAllowed(c.Cmd) {\n+\t\treturn fmt.Errorf(\"command %q is not allowed\", c.Cmd)\n+\t}\n \taddObjectData := false\n \tif params.Object != nil {\n \t\tfor _, k := range c.EnvVars {"
            },
            {
                "sha": "0aa5685390176c4c61e22d4bd2827841ba6d7d0e",
                "filename": "internal/common/protocol_test.go",
                "status": "modified",
                "additions": 142,
                "deletions": 0,
                "changes": 142,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fcommon%2Fprotocol_test.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fcommon%2Fprotocol_test.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fcommon%2Fprotocol_test.go?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -4208,6 +4208,148 @@ func TestEventRuleStatues(t *testing.T) {\n \trequire.NoError(t, err)\n }\n \n+func TestEventRuleDisabledCommand(t *testing.T) {\n+\tif runtime.GOOS == osWindows {\n+\t\tt.Skip(\"this test is not available on Windows\")\n+\t}\n+\tsmtpCfg := smtp.Config{\n+\t\tHost:          \"127.0.0.1\",\n+\t\tPort:          2525,\n+\t\tFrom:          \"notification@example.com\",\n+\t\tTemplatesPath: \"templates\",\n+\t}\n+\terr := smtpCfg.Initialize(configDir, true)\n+\trequire.NoError(t, err)\n+\n+\tsaveObjectScriptPath := filepath.Join(os.TempDir(), \"provider.sh\")\n+\toutPath := filepath.Join(os.TempDir(), \"provider_out.json\")\n+\terr = os.WriteFile(saveObjectScriptPath, getSaveProviderObjectScriptContent(outPath, 0), 0755)\n+\tassert.NoError(t, err)\n+\n+\ta1 := dataprovider.BaseEventAction{\n+\t\tName: \"a1\",\n+\t\tType: dataprovider.ActionTypeCommand,\n+\t\tOptions: dataprovider.BaseEventActionOptions{\n+\t\t\tCmdConfig: dataprovider.EventActionCommandConfig{\n+\t\t\t\tCmd:     saveObjectScriptPath,\n+\t\t\t\tTimeout: 10,\n+\t\t\t\tEnvVars: []dataprovider.KeyValue{\n+\t\t\t\t\t{\n+\t\t\t\t\t\tKey:   \"SFTPGO_OBJECT_DATA\",\n+\t\t\t\t\t\tValue: \"{{ObjectData}}\",\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t},\n+\t}\n+\ta2 := dataprovider.BaseEventAction{\n+\t\tName: \"a2\",\n+\t\tType: dataprovider.ActionTypeEmail,\n+\t\tOptions: dataprovider.BaseEventActionOptions{\n+\t\t\tEmailConfig: dataprovider.EventActionEmailConfig{\n+\t\t\t\tRecipients: []string{\"test3@example.com\"},\n+\t\t\t\tSubject:    `New \"{{Event}}\" from \"{{Name}}\"`,\n+\t\t\t\tBody:       \"Object name: {{ObjectName}} object type: {{ObjectType}} Data: {{ObjectData}}\",\n+\t\t\t},\n+\t\t},\n+\t}\n+\n+\ta3 := dataprovider.BaseEventAction{\n+\t\tName: \"a3\",\n+\t\tType: dataprovider.ActionTypeEmail,\n+\t\tOptions: dataprovider.BaseEventActionOptions{\n+\t\t\tEmailConfig: dataprovider.EventActionEmailConfig{\n+\t\t\t\tRecipients: []string{\"failure@example.com\"},\n+\t\t\t\tSubject:    `Failed \"{{Event}}\" from \"{{Name}}\"`,\n+\t\t\t\tBody:       \"Object name: {{ObjectName}} object type: {{ObjectType}}, IP: {{IP}}\",\n+\t\t\t},\n+\t\t},\n+\t}\n+\taction1, _, err := httpdtest.AddEventAction(a1, http.StatusCreated)\n+\tassert.NoError(t, err)\n+\taction2, _, err := httpdtest.AddEventAction(a2, http.StatusCreated)\n+\tassert.NoError(t, err)\n+\taction3, _, err := httpdtest.AddEventAction(a3, http.StatusCreated)\n+\tassert.NoError(t, err)\n+\n+\tr := dataprovider.EventRule{\n+\t\tName:    \"rule\",\n+\t\tStatus:  1,\n+\t\tTrigger: dataprovider.EventTriggerProviderEvent,\n+\t\tConditions: dataprovider.EventConditions{\n+\t\t\tProviderEvents: []string{\"add\"},\n+\t\t\tOptions: dataprovider.ConditionOptions{\n+\t\t\t\tProviderObjects: []string{\"folder\"},\n+\t\t\t},\n+\t\t},\n+\t\tActions: []dataprovider.EventAction{\n+\t\t\t{\n+\t\t\t\tBaseEventAction: dataprovider.BaseEventAction{\n+\t\t\t\t\tName: action1.Name,\n+\t\t\t\t},\n+\t\t\t\tOrder: 1,\n+\t\t\t\tOptions: dataprovider.EventActionOptions{\n+\t\t\t\t\tStopOnFailure: true,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\tBaseEventAction: dataprovider.BaseEventAction{\n+\t\t\t\t\tName: action2.Name,\n+\t\t\t\t},\n+\t\t\t\tOrder: 2,\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\tBaseEventAction: dataprovider.BaseEventAction{\n+\t\t\t\t\tName: action3.Name,\n+\t\t\t\t},\n+\t\t\t\tOrder: 3,\n+\t\t\t\tOptions: dataprovider.EventActionOptions{\n+\t\t\t\t\tIsFailureAction: true,\n+\t\t\t\t\tStopOnFailure:   true,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t},\n+\t}\n+\trule, _, err := httpdtest.AddEventRule(r, http.StatusCreated)\n+\tassert.NoError(t, err)\n+\t// restrit command execution\n+\tdataprovider.EnabledActionCommands = []string{\"/bin/ls\"}\n+\n+\tlastReceivedEmail.reset()\n+\t// create a folder to trigger the rule\n+\tfolder := vfs.BaseVirtualFolder{\n+\t\tName:       \"ftest failed command\",\n+\t\tMappedPath: filepath.Join(os.TempDir(), \"p\"),\n+\t}\n+\tfolder, _, err = httpdtest.AddFolder(folder, http.StatusCreated)\n+\tassert.NoError(t, err)\n+\n+\tassert.NoFileExists(t, outPath)\n+\tassert.Eventually(t, func() bool {\n+\t\treturn lastReceivedEmail.get().From != \"\"\n+\t}, 3000*time.Millisecond, 100*time.Millisecond)\n+\temail := lastReceivedEmail.get()\n+\tassert.Len(t, email.To, 1)\n+\tassert.True(t, slices.Contains(email.To, \"failure@example.com\"))\n+\tassert.Contains(t, email.Data, `Subject: Failed \"add\" from \"admin\"`)\n+\tassert.Contains(t, email.Data, fmt.Sprintf(\"Object name: %s object type: folder\", folder.Name))\n+\tlastReceivedEmail.reset()\n+\n+\tdataprovider.EnabledActionCommands = nil\n+\n+\t_, err = httpdtest.RemoveFolder(folder, http.StatusOK)\n+\tassert.NoError(t, err)\n+\n+\t_, err = httpdtest.RemoveEventRule(rule, http.StatusOK)\n+\tassert.NoError(t, err)\n+\t_, err = httpdtest.RemoveEventAction(action1, http.StatusOK)\n+\tassert.NoError(t, err)\n+\t_, err = httpdtest.RemoveEventAction(action2, http.StatusOK)\n+\tassert.NoError(t, err)\n+\t_, err = httpdtest.RemoveEventAction(action3, http.StatusOK)\n+\tassert.NoError(t, err)\n+}\n+\n func TestEventRuleProviderEvents(t *testing.T) {\n \tif runtime.GOOS == osWindows {\n \t\tt.Skip(\"this test is not available on Windows\")"
            },
            {
                "sha": "81eeff9e26cda750d79ce55637f5967a5eb768f9",
                "filename": "internal/config/config.go",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fconfig%2Fconfig.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fconfig%2Fconfig.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fconfig%2Fconfig.go?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -242,6 +242,9 @@ func Init() {\n \t\t\tMetadata: common.MetadataConfig{\n \t\t\t\tRead: 0,\n \t\t\t},\n+\t\t\tEventManager: common.EventManagerConfig{\n+\t\t\t\tEnabledCommands: []string{},\n+\t\t\t},\n \t\t},\n \t\tACME: acme.Configuration{\n \t\t\tEmail:      \"\",\n@@ -2032,6 +2035,7 @@ func setViperDefaults() {\n \tviper.SetDefault(\"common.server_version\", globalConf.Common.ServerVersion)\n \tviper.SetDefault(\"common.tz\", globalConf.Common.TZ)\n \tviper.SetDefault(\"common.metadata.read\", globalConf.Common.Metadata.Read)\n+\tviper.SetDefault(\"common.event_manager.enabled_commands\", globalConf.Common.EventManager.EnabledCommands)\n \tviper.SetDefault(\"acme.email\", globalConf.ACME.Email)\n \tviper.SetDefault(\"acme.key_type\", globalConf.ACME.KeyType)\n \tviper.SetDefault(\"acme.certs_path\", globalConf.ACME.CertsPath)"
            },
            {
                "sha": "e2309d6944f0b29d47d53754f5bc163aba52f227",
                "filename": "internal/dataprovider/eventrule.go",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fdataprovider%2Feventrule.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fdataprovider%2Feventrule.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fdataprovider%2Feventrule.go?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -58,6 +58,9 @@ var (\n \t\tActionTypeBackup, ActionTypeUserQuotaReset, ActionTypeFolderQuotaReset, ActionTypeTransferQuotaReset,\n \t\tActionTypeDataRetentionCheck, ActionTypePasswordExpirationCheck, ActionTypeUserExpirationCheck,\n \t\tActionTypeUserInactivityCheck, ActionTypeIDPAccountCheck, ActionTypeRotateLogs}\n+\t// EnabledActionCommands defines the system commands that can be executed via EventManager,\n+\t// an empty list means that any command is allowed to be executed.\n+\tEnabledActionCommands []string\n )\n \n func isActionTypeValid(action int) bool {\n@@ -450,6 +453,14 @@ func (c *EventActionHTTPConfig) GetHTTPClient() *http.Client {\n \treturn client\n }\n \n+// IsActionCommandAllowed returns true if the specified command is allowed\n+func IsActionCommandAllowed(cmd string) bool {\n+\tif len(EnabledActionCommands) == 0 {\n+\t\treturn true\n+\t}\n+\treturn slices.Contains(EnabledActionCommands, cmd)\n+}\n+\n // EventActionCommandConfig defines the configuration for a command event target\n type EventActionCommandConfig struct {\n \tCmd     string     `json:\"cmd,omitempty\"`\n@@ -462,6 +473,9 @@ func (c *EventActionCommandConfig) validate() error {\n \tif c.Cmd == \"\" {\n \t\treturn util.NewI18nError(util.NewValidationError(\"command is required\"), util.I18nErrorCommandRequired)\n \t}\n+\tif !IsActionCommandAllowed(c.Cmd) {\n+\t\treturn util.NewValidationError(fmt.Sprintf(\"command %q is not allowed\", c.Cmd))\n+\t}\n \tif !filepath.IsAbs(c.Cmd) {\n \t\treturn util.NewI18nError(\n \t\t\tutil.NewValidationError(\"invalid command, it must be an absolute path\"),"
            },
            {
                "sha": "8e4fe3ae01f4e7680a257f81c393e284fa3f809e",
                "filename": "internal/httpd/httpd_test.go",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fhttpd%2Fhttpd_test.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fhttpd%2Fhttpd_test.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fhttpd%2Fhttpd_test.go?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -2395,6 +2395,17 @@ func TestEventActionValidation(t *testing.T) {\n \t_, resp, err = httpdtest.AddEventAction(action, http.StatusBadRequest)\n \tassert.NoError(t, err)\n \tassert.Contains(t, string(resp), \"invalid command args\")\n+\taction.Options.CmdConfig.Args = nil\n+\t// restrict commands\n+\tif runtime.GOOS == osWindows {\n+\t\tdataprovider.EnabledActionCommands = []string{\"C:\\\\cmd.exe\"}\n+\t} else {\n+\t\tdataprovider.EnabledActionCommands = []string{\"/bin/sh\"}\n+\t}\n+\t_, resp, err = httpdtest.AddEventAction(action, http.StatusBadRequest)\n+\tassert.NoError(t, err)\n+\tassert.Contains(t, string(resp), \"is not allowed\")\n+\tdataprovider.EnabledActionCommands = nil\n \n \taction.Type = dataprovider.ActionTypeEmail\n \t_, resp, err = httpdtest.AddEventAction(action, http.StatusBadRequest)"
            },
            {
                "sha": "e6022764dd17744336bd1c9b6229ed1fe5ace151",
                "filename": "internal/httpd/webadmin.go",
                "status": "modified",
                "additions": 17,
                "deletions": 15,
                "changes": 32,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fhttpd%2Fwebadmin.go",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/internal%2Fhttpd%2Fwebadmin.go",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/internal%2Fhttpd%2Fwebadmin.go?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -297,13 +297,14 @@ type rolePage struct {\n \n type eventActionPage struct {\n \tbasePage\n-\tAction         dataprovider.BaseEventAction\n-\tActionTypes    []dataprovider.EnumMapping\n-\tFsActions      []dataprovider.EnumMapping\n-\tHTTPMethods    []string\n-\tRedactedSecret string\n-\tError          *util.I18nError\n-\tMode           genericPageMode\n+\tAction          dataprovider.BaseEventAction\n+\tActionTypes     []dataprovider.EnumMapping\n+\tFsActions       []dataprovider.EnumMapping\n+\tHTTPMethods     []string\n+\tEnabledCommands []string\n+\tRedactedSecret  string\n+\tError           *util.I18nError\n+\tMode            genericPageMode\n }\n \n type eventRulePage struct {\n@@ -1088,14 +1089,15 @@ func (s *httpdServer) renderEventActionPage(w http.ResponseWriter, r *http.Reque\n \t}\n \n \tdata := eventActionPage{\n-\t\tbasePage:       s.getBasePageData(title, currentURL, w, r),\n-\t\tAction:         action,\n-\t\tActionTypes:    dataprovider.EventActionTypes,\n-\t\tFsActions:      dataprovider.FsActionTypes,\n-\t\tHTTPMethods:    dataprovider.SupportedHTTPActionMethods,\n-\t\tRedactedSecret: redactedSecret,\n-\t\tError:          getI18nError(err),\n-\t\tMode:           mode,\n+\t\tbasePage:        s.getBasePageData(title, currentURL, w, r),\n+\t\tAction:          action,\n+\t\tActionTypes:     dataprovider.EventActionTypes,\n+\t\tFsActions:       dataprovider.FsActionTypes,\n+\t\tHTTPMethods:     dataprovider.SupportedHTTPActionMethods,\n+\t\tEnabledCommands: dataprovider.EnabledActionCommands,\n+\t\tRedactedSecret:  redactedSecret,\n+\t\tError:           getI18nError(err),\n+\t\tMode:            mode,\n \t}\n \trenderAdminTemplate(w, templateEventAction, data)\n }"
            },
            {
                "sha": "fb2508e2bf757f476088576e46f7394cfd23f27d",
                "filename": "sftpgo.json",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/sftpgo.json",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/sftpgo.json",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/sftpgo.json?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -62,7 +62,10 @@\n         \"entries_soft_limit\": 100,\n         \"entries_hard_limit\": 150\n       }\n-    ]\n+    ],\n+    \"event_manager\": {\n+      \"enabled_commands\": []\n+    }\n   },\n   \"acme\": {\n     \"domains\": [],"
            },
            {
                "sha": "84e5b9c5da66b47a50ec79c31f057a820e3f9505",
                "filename": "templates/webadmin/eventaction.html",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/drakkan/sftpgo/blob/88b1850b5806eee81150873d4e565144b21021fb/templates%2Fwebadmin%2Feventaction.html",
                "raw_url": "https://github.com/drakkan/sftpgo/raw/88b1850b5806eee81150873d4e565144b21021fb/templates%2Fwebadmin%2Feventaction.html",
                "contents_url": "https://api.github.com/repos/drakkan/sftpgo/contents/templates%2Fwebadmin%2Feventaction.html?ref=88b1850b5806eee81150873d4e565144b21021fb",
                "patch": "@@ -396,13 +396,26 @@ <h3 data-i18n=\"actions.multipart_body\" class=\"card-title section-title-inner\">Mu\n                 </div>\n             </div>\n \n+            {{ if .EnabledCommands}}\n+            <div class=\"form-group row action-type action-cmd mt-10\">\n+                <label for=\"idCmdPath\" data-i18n=\"actions.types.command\" class=\"col-md-3 col-form-label\">Command</label>\n+                <div class=\"col-md-9\">\n+                    <select id=\"idCmdPath\" name=\"cmd_path\" class=\"form-select\" data-control=\"i18n-select2\" data-hide-search=\"true\">\n+                        {{- range .EnabledCommands}}\n+                        <option value=\"{{.}}\" {{if eq $.Action.Options.CmdConfig.Cmd . }}selected{{end}}>{{.}}</option>\n+                        {{- end}}\n+                    </select>\n+                </div>\n+            </div>\n+            {{- else}}\n             <div class=\"form-group row action-type action-cmd mt-10\">\n                 <label for=\"idCmdPath\" data-i18n=\"actions.types.command\" class=\"col-md-3 col-form-label\">Command</label>\n                 <div class=\"col-md-9\">\n                     <input id=\"idCmdPath\" type=\"text\" class=\"form-control\" name=\"cmd_path\" value=\"{{.Action.Options.CmdConfig.Cmd}}\" aria-describedby=\"idCmdPathHelp\" />\n                     <div id=\"idCmdPathHelp\" class=\"form-text\" data-i18n=\"actions.command_help\"></div>\n                 </div>\n             </div>\n+            {{- end}}\n \n             <div class=\"form-group row action-type action-cmd mt-10\">\n                 <label for=\"idCommandArgs\" data-i18n=\"actions.command_args\" class=\"col-md-3 col-form-label\">Arguments</label>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/hiyouga/LLaMA-Factory/commits/b3aa80d54a67da45e9e237e349486fb9c162b2ac",
        "url": "https://api.github.com/repos/hiyouga/LLaMA-Factory/commits/b3aa80d54a67da45e9e237e349486fb9c162b2ac",
        "html_url": "https://github.com/hiyouga/LLaMA-Factory/commit/b3aa80d54a67da45e9e237e349486fb9c162b2ac",
        "message": "Merge commit from fork\n\n[patch] Patch remote OS command injection vulnerability",
        "files": [
            {
                "sha": "e32035a39903df14aebac127a7dcfbbc5c037d5f",
                "filename": "src/llamafactory/webui/runner.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hiyouga/LLaMA-Factory/blob/b3aa80d54a67da45e9e237e349486fb9c162b2ac/src%2Fllamafactory%2Fwebui%2Frunner.py",
                "raw_url": "https://github.com/hiyouga/LLaMA-Factory/raw/b3aa80d54a67da45e9e237e349486fb9c162b2ac/src%2Fllamafactory%2Fwebui%2Frunner.py",
                "contents_url": "https://api.github.com/repos/hiyouga/LLaMA-Factory/contents/src%2Fllamafactory%2Fwebui%2Frunner.py?ref=b3aa80d54a67da45e9e237e349486fb9c162b2ac",
                "patch": "@@ -320,7 +320,7 @@ def _launch(self, data: Dict[\"Component\", Any], do_train: bool) -> Generator[Dic\n             if args.get(\"deepspeed\", None) is not None:\n                 env[\"FORCE_TORCHRUN\"] = \"1\"\n \n-            self.trainer = Popen(f\"llamafactory-cli train {save_cmd(args)}\", env=env, shell=True)\n+            self.trainer = Popen([\"llamafactory-cli\", \"train\", save_cmd(args)], env=env)\n             yield from self.monitor()\n \n     def _form_config_dict(self, data: Dict[\"Component\", Any]) -> Dict[str, Any]:"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/nifi/commits/c1108365949268631526d5016b1a163a82f8e9df",
        "url": "https://api.github.com/repos/apache/nifi/commits/c1108365949268631526d5016b1a163a82f8e9df",
        "html_url": "https://github.com/apache/nifi/commit/c1108365949268631526d5016b1a163a82f8e9df",
        "message": "NIFI-13971 Removed Parameter Context debug logging in Flow Synchronizer\nThis closes #9489\n\nSigned-off-by: Joseph Witt <joewitt@apache.org>",
        "files": [
            {
                "sha": "f39ccd401cefdb66b2529fddef1b3eb6a6dccab3",
                "filename": "nifi-nar-bundles/nifi-framework-bundle/nifi-framework/nifi-framework-core/src/main/java/org/apache/nifi/controller/serialization/VersionedFlowSynchronizer.java",
                "status": "modified",
                "additions": 0,
                "deletions": 7,
                "changes": 7,
                "blob_url": "https://github.com/apache/nifi/blob/c1108365949268631526d5016b1a163a82f8e9df/nifi-nar-bundles%2Fnifi-framework-bundle%2Fnifi-framework%2Fnifi-framework-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fnifi%2Fcontroller%2Fserialization%2FVersionedFlowSynchronizer.java",
                "raw_url": "https://github.com/apache/nifi/raw/c1108365949268631526d5016b1a163a82f8e9df/nifi-nar-bundles%2Fnifi-framework-bundle%2Fnifi-framework%2Fnifi-framework-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fnifi%2Fcontroller%2Fserialization%2FVersionedFlowSynchronizer.java",
                "contents_url": "https://api.github.com/repos/apache/nifi/contents/nifi-nar-bundles%2Fnifi-framework-bundle%2Fnifi-framework%2Fnifi-framework-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fnifi%2Fcontroller%2Fserialization%2FVersionedFlowSynchronizer.java?ref=c1108365949268631526d5016b1a163a82f8e9df",
                "patch": "@@ -116,7 +116,6 @@\n import java.util.LinkedHashSet;\n import java.util.List;\n import java.util.Map;\n-import java.util.Map.Entry;\n import java.util.Objects;\n import java.util.Optional;\n import java.util.Set;\n@@ -803,12 +802,6 @@ private void updateParameterContext(\n         final Map<String, String> currentValues = new HashMap<>();\n         parameterContext.getParameters().values().forEach(param -> currentValues.put(param.getDescriptor().getName(), param.getValue()));\n \n-        if (logger.isDebugEnabled()) {\n-            final Map<String, String> proposedValues = parameters.entrySet().stream()\n-                    .collect(Collectors.toMap(Entry::getKey, entry -> entry.getValue().getValue()));\n-            logger.debug(\"For Parameter Context {}, current parameters = {}, proposed = {}\", parameterContext.getName(), currentValues, proposedValues);\n-        }\n-\n         final Map<String, Parameter> updatedParameters = new HashMap<>();\n         final Set<String> proposedParameterNames = new HashSet<>();\n         for (final VersionedParameter parameter : versionedParameterContext.getParameters()) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/nifi/commits/5aed878c5d2a193cd2039c2e997bc3025046bc41",
        "url": "https://api.github.com/repos/apache/nifi/commits/5aed878c5d2a193cd2039c2e997bc3025046bc41",
        "html_url": "https://github.com/apache/nifi/commit/5aed878c5d2a193cd2039c2e997bc3025046bc41",
        "message": "NIFI-13971 Removed Parameter Context debug logging in Flow Synchronizer\nThis closes #9489\n\nSigned-off-by: Joseph Witt <joewitt@apache.org>",
        "files": [
            {
                "sha": "f39ccd401cefdb66b2529fddef1b3eb6a6dccab3",
                "filename": "nifi-nar-bundles/nifi-framework-bundle/nifi-framework/nifi-framework-core/src/main/java/org/apache/nifi/controller/serialization/VersionedFlowSynchronizer.java",
                "status": "modified",
                "additions": 0,
                "deletions": 7,
                "changes": 7,
                "blob_url": "https://github.com/apache/nifi/blob/5aed878c5d2a193cd2039c2e997bc3025046bc41/nifi-nar-bundles%2Fnifi-framework-bundle%2Fnifi-framework%2Fnifi-framework-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fnifi%2Fcontroller%2Fserialization%2FVersionedFlowSynchronizer.java",
                "raw_url": "https://github.com/apache/nifi/raw/5aed878c5d2a193cd2039c2e997bc3025046bc41/nifi-nar-bundles%2Fnifi-framework-bundle%2Fnifi-framework%2Fnifi-framework-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fnifi%2Fcontroller%2Fserialization%2FVersionedFlowSynchronizer.java",
                "contents_url": "https://api.github.com/repos/apache/nifi/contents/nifi-nar-bundles%2Fnifi-framework-bundle%2Fnifi-framework%2Fnifi-framework-core%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fnifi%2Fcontroller%2Fserialization%2FVersionedFlowSynchronizer.java?ref=5aed878c5d2a193cd2039c2e997bc3025046bc41",
                "patch": "@@ -116,7 +116,6 @@\n import java.util.LinkedHashSet;\n import java.util.List;\n import java.util.Map;\n-import java.util.Map.Entry;\n import java.util.Objects;\n import java.util.Optional;\n import java.util.Set;\n@@ -803,12 +802,6 @@ private void updateParameterContext(\n         final Map<String, String> currentValues = new HashMap<>();\n         parameterContext.getParameters().values().forEach(param -> currentValues.put(param.getDescriptor().getName(), param.getValue()));\n \n-        if (logger.isDebugEnabled()) {\n-            final Map<String, String> proposedValues = parameters.entrySet().stream()\n-                    .collect(Collectors.toMap(Entry::getKey, entry -> entry.getValue().getValue()));\n-            logger.debug(\"For Parameter Context {}, current parameters = {}, proposed = {}\", parameterContext.getName(), currentValues, proposedValues);\n-        }\n-\n         final Map<String, Parameter> updatedParameters = new HashMap<>();\n         final Set<String> proposedParameterNames = new HashSet<>();\n         for (final VersionedParameter parameter : versionedParameterContext.getParameters()) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/opencast/opencast/commits/3d5ebd163674eb18e070f52b64a18f92188f98c3",
        "url": "https://api.github.com/repos/opencast/opencast/commits/3d5ebd163674eb18e070f52b64a18f92188f98c3",
        "html_url": "https://github.com/opencast/opencast/commit/3d5ebd163674eb18e070f52b64a18f92188f98c3",
        "message": "Merge commit from fork\n\nProper escaping for Elasticsearch/OpenSearch queries",
        "files": [
            {
                "sha": "2ac647c7b18e303a2f32e59db8b9ca1712729d83",
                "filename": "modules/admin-ui/src/main/java/org/opencastproject/adminui/endpoint/AbstractEventEndpoint.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/opencast/opencast/blob/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fadmin-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Fendpoint%2FAbstractEventEndpoint.java",
                "raw_url": "https://github.com/opencast/opencast/raw/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fadmin-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Fendpoint%2FAbstractEventEndpoint.java",
                "contents_url": "https://api.github.com/repos/opencast/opencast/contents/modules%2Fadmin-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Fendpoint%2FAbstractEventEndpoint.java?ref=3d5ebd163674eb18e070f52b64a18f92188f98c3",
                "patch": "@@ -60,7 +60,6 @@\n import org.opencastproject.adminui.exception.JobEndpointException;\n import org.opencastproject.adminui.impl.AdminUIConfiguration;\n import org.opencastproject.adminui.util.BulkUpdateUtil;\n-import org.opencastproject.adminui.util.QueryPreprocessor;\n import org.opencastproject.assetmanager.api.AssetManager;\n import org.opencastproject.authorization.xacml.manager.api.AclService;\n import org.opencastproject.authorization.xacml.manager.api.ManagedAcl;\n@@ -72,6 +71,7 @@\n import org.opencastproject.elasticsearch.api.SearchResult;\n import org.opencastproject.elasticsearch.api.SearchResultItem;\n import org.opencastproject.elasticsearch.index.ElasticsearchIndex;\n+import org.opencastproject.elasticsearch.index.QueryPreprocessor;\n import org.opencastproject.elasticsearch.index.objects.event.Event;\n import org.opencastproject.elasticsearch.index.objects.event.EventIndexSchema;\n import org.opencastproject.elasticsearch.index.objects.event.EventSearchQuery;"
            },
            {
                "sha": "e7c7a9505ce8ad2c80aa0912691ba893d7132327",
                "filename": "modules/admin-ui/src/main/java/org/opencastproject/adminui/endpoint/SeriesEndpoint.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/opencast/opencast/blob/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fadmin-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Fendpoint%2FSeriesEndpoint.java",
                "raw_url": "https://github.com/opencast/opencast/raw/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fadmin-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Fendpoint%2FSeriesEndpoint.java",
                "contents_url": "https://api.github.com/repos/opencast/opencast/contents/modules%2Fadmin-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Fendpoint%2FSeriesEndpoint.java?ref=3d5ebd163674eb18e070f52b64a18f92188f98c3",
                "patch": "@@ -55,7 +55,6 @@\n import org.opencastproject.adminui.impl.AdminUIConfiguration;\n import org.opencastproject.adminui.tobira.TobiraException;\n import org.opencastproject.adminui.tobira.TobiraService;\n-import org.opencastproject.adminui.util.QueryPreprocessor;\n import org.opencastproject.authorization.xacml.manager.api.AclService;\n import org.opencastproject.authorization.xacml.manager.api.AclServiceFactory;\n import org.opencastproject.authorization.xacml.manager.api.ManagedAcl;\n@@ -64,6 +63,7 @@\n import org.opencastproject.elasticsearch.api.SearchResult;\n import org.opencastproject.elasticsearch.api.SearchResultItem;\n import org.opencastproject.elasticsearch.index.ElasticsearchIndex;\n+import org.opencastproject.elasticsearch.index.QueryPreprocessor;\n import org.opencastproject.elasticsearch.index.objects.event.Event;\n import org.opencastproject.elasticsearch.index.objects.event.EventSearchQuery;\n import org.opencastproject.elasticsearch.index.objects.series.Series;"
            },
            {
                "sha": "6d6281d35e87918c0a1f2eb894c0ace0379c1001",
                "filename": "modules/admin-ui/src/main/java/org/opencastproject/adminui/endpoint/ThemesEndpoint.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/opencast/opencast/blob/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fadmin-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Fendpoint%2FThemesEndpoint.java",
                "raw_url": "https://github.com/opencast/opencast/raw/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fadmin-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Fendpoint%2FThemesEndpoint.java",
                "contents_url": "https://api.github.com/repos/opencast/opencast/contents/modules%2Fadmin-ui%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Fendpoint%2FThemesEndpoint.java?ref=3d5ebd163674eb18e070f52b64a18f92188f98c3",
                "patch": "@@ -38,11 +38,11 @@\n import static org.opencastproject.index.service.util.RestUtils.okJsonList;\n import static org.opencastproject.util.doc.rest.RestParameter.Type.STRING;\n \n-import org.opencastproject.adminui.util.QueryPreprocessor;\n import org.opencastproject.elasticsearch.api.SearchIndexException;\n import org.opencastproject.elasticsearch.api.SearchResult;\n import org.opencastproject.elasticsearch.api.SearchResultItem;\n import org.opencastproject.elasticsearch.index.ElasticsearchIndex;\n+import org.opencastproject.elasticsearch.index.QueryPreprocessor;\n import org.opencastproject.elasticsearch.index.objects.series.Series;\n import org.opencastproject.elasticsearch.index.objects.series.SeriesSearchQuery;\n import org.opencastproject.elasticsearch.index.objects.theme.IndexTheme;"
            },
            {
                "sha": "8eef2155d286a57a0fea089a1f2649df531ff480",
                "filename": "modules/admin-ui/src/test/java/org/opencastproject/adminui/util/QueryPreprocessorTest.java",
                "status": "removed",
                "additions": 0,
                "deletions": 146,
                "changes": 146,
                "blob_url": "https://github.com/opencast/opencast/blob/a34d66418f71c259173de554549cc081b36a6a2b/modules%2Fadmin-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Futil%2FQueryPreprocessorTest.java",
                "raw_url": "https://github.com/opencast/opencast/raw/a34d66418f71c259173de554549cc081b36a6a2b/modules%2Fadmin-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Futil%2FQueryPreprocessorTest.java",
                "contents_url": "https://api.github.com/repos/opencast/opencast/contents/modules%2Fadmin-ui%2Fsrc%2Ftest%2Fjava%2Forg%2Fopencastproject%2Fadminui%2Futil%2FQueryPreprocessorTest.java?ref=a34d66418f71c259173de554549cc081b36a6a2b",
                "patch": "@@ -1,146 +0,0 @@\n-/*\n- * Licensed to The Apereo Foundation under one or more contributor license\n- * agreements. See the NOTICE file distributed with this work for additional\n- * information regarding copyright ownership.\n- *\n- *\n- * The Apereo Foundation licenses this file to you under the Educational\n- * Community License, Version 2.0 (the \"License\"); you may not use this file\n- * except in compliance with the License. You may obtain a copy of the License\n- * at:\n- *\n- *   http://opensource.org/licenses/ecl2.txt\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n- * License for the specific language governing permissions and limitations under\n- * the License.\n- *\n- */\n-\n-package org.opencastproject.adminui.util;\n-\n-import static org.junit.Assert.assertEquals;\n-\n-import org.junit.Test;\n-\n-public class QueryPreprocessorTest {\n-\n-  @Test\n-  public void testBlankQueries() {\n-    assertEquals(\"\", QueryPreprocessor.sanitize(\"\"));\n-    assertEquals(\"\", QueryPreprocessor.sanitize(\"   \"));\n-  }\n-\n-  @Test\n-  public void testDoubleQuotes() {\n-    // No partial matching for quoted strings\n-    assertEquals(\"\\\"Hello\\\"\", QueryPreprocessor.sanitize(\"\\\"Hello\\\"\"));\n-    assertEquals(\"*Hello* \\\"World\\\"\", QueryPreprocessor.sanitize(\"Hello \\\"World\\\"\"));\n-\n-    // Auto-completion in case of missing double-quote\n-    assertEquals(\"*Hello* \\\"World\\\"\", QueryPreprocessor.sanitize(\"Hello \\\"World\"));\n-    assertEquals(\"*Hello* \\\"World Again\\\"\", QueryPreprocessor.sanitize(\"Hello \\\"World Again\"));\n-\n-    // Escape double quote within tokens, i.e. ensure whitespace separated tokens\n-    assertEquals(\"*He\\\\\\\"llo* *Wor\\\\\\\"ld*\", QueryPreprocessor.sanitize(\"He\\\"llo Wor\\\"ld\"));\n-  }\n-\n-  @Test\n-  public void testWildcards() {\n-    // Don't escape wildcards occuring as individual tokens\n-    assertEquals(\"*\", QueryPreprocessor.sanitize(\"*\"));\n-    assertEquals(\"*\", QueryPreprocessor.sanitize(\" * \"));\n-    assertEquals(\"*?*\", QueryPreprocessor.sanitize(\"?\"));\n-    assertEquals(\"*?*\", QueryPreprocessor.sanitize(\" ? \"));\n-\n-    // Don't escape wildcards occuring within tokens\n-    assertEquals(\"*H*llo* *Worl*d*\", QueryPreprocessor.sanitize(\"H*llo Worl*d\"));\n-    assertEquals(\"*H?llo* *Worl?d*\", QueryPreprocessor.sanitize(\"H?llo Worl?d\"));\n-  }\n-\n-  @Test\n-  public void testCharacterEscaping() {\n-    // Unsupported special characters are escaped\n-    assertEquals(\"*\\\\(* *\\\\)* *\\\\[* *\\\\]* *\\\\{* *\\\\}* *\\\\~* *\\\\^* *\\\\:* *\\\\\\\\*\", QueryPreprocessor.sanitize(\" ( ) [ ] { } ~ ^ : \\\\\"));\n-\n-    // Unsupported special characters are not escaped in quoted strings\n-    assertEquals(\"\\\" ( ) [ ] { } ~ ^ : \\\\\\\"\", QueryPreprocessor.sanitize(\"\\\" ( ) [ ] { } ~ ^ : \\\\\\\"\"));\n-\n-    // Supported special characters are not escape in quoted strings\n-    assertEquals(\"\\\"|| && + - ! * ?\\\"\", QueryPreprocessor.sanitize(\"\\\"|| && + - ! * ?\\\"\"));\n-  }\n-\n-  @Test\n-  public void testUnaryOperators() {\n-    testUnaryOperator(\"+\");\n-    testUnaryOperator(\"-\");\n-    testUnaryOperator(\"!\");\n-  }\n-\n-  private void testUnaryOperator(String operator) {\n-    // Escape operator if operand is missing\n-    assertEquals(\"\\\\\" + operator, QueryPreprocessor.sanitize(operator));\n-    assertEquals(\"\\\\\" + operator, QueryPreprocessor.sanitize(\" \" + operator + \" \"));\n-\n-    // Escape operator if occuring within a token\n-    assertEquals(\"*test\\\\\" + operator + \"unit*\", QueryPreprocessor.sanitize(\"test\" + operator + \"unit\"));\n-    assertEquals(\"*test\\\\\" + operator + \"unit*\", QueryPreprocessor.sanitize(\"*test\" + operator + \"unit\"));\n-    assertEquals(\"*test\\\\\" + operator + \"unit*\", QueryPreprocessor.sanitize(\"test\" + operator + \"unit*\"));\n-    assertEquals(\"*test\\\\\" + operator + \"unit*\", QueryPreprocessor.sanitize(\"*test\" + operator + \"unit*\"));\n-    assertEquals(\"*test\\\\\" + operator + \"unit\\\\\" + operator + \"*\",\n-                 QueryPreprocessor.sanitize(\"test\" + operator + \"unit\" + operator));\n-    assertEquals(\n-      operator + \"*\\\\\" + operator + \"test\\\\\" + operator + \"unit\\\\\" + operator + \"\\\\\" + operator + \"*\",\n-      QueryPreprocessor.sanitize(operator + operator + \"test\" + operator + \"unit\" + operator + operator));\n-\n-    // Partial matching for operands\n-    assertEquals(operator + \"*test\\\\\" + operator + \"unit*\",\n-      QueryPreprocessor.sanitize(operator + \"test\" + operator + \"unit\"));\n-    assertEquals(operator + \"*test\\\\\" + operator + \"unit*\",\n-      QueryPreprocessor.sanitize(operator + \"*test\" + operator + \"unit\"));\n-    assertEquals(operator + \"*test\\\\\" + operator + \"unit*\",\n-      QueryPreprocessor.sanitize(operator + \"test\" + operator + \"unit*\"));\n-    assertEquals(operator + \"*test\\\\\" + operator + \"unit*\",\n-      QueryPreprocessor.sanitize(operator + \"*test\" + operator + \"unit*\"));\n-\n-    // Binary operators are escaped when appearing as operangs of unary operators\n-    assertEquals(operator + \"*\\\\|\\\\|*\", QueryPreprocessor.sanitize(operator + \"||\"));\n-    assertEquals(operator + \"*\\\\&\\\\&*\", QueryPreprocessor.sanitize(operator + \"&&\"));\n-\n-    // Double quotes can be used in argument\n-    assertEquals(operator + \"\\\"Hello World\\\"\", QueryPreprocessor.sanitize(operator + \"\\\"Hello World\\\"\"));\n-  }\n-\n-  @Test\n-  public void testBinaryOperators() {\n-    testBinaryOperator(\"&&\");\n-    testBinaryOperator(\"||\");\n-  }\n-\n-  private void testBinaryOperator(String operator) {\n-    // Escape operator if operands are missing\n-    assertEquals(\"\\\\\" + operator, QueryPreprocessor.sanitize(operator));\n-    assertEquals(\"\\\\\" + operator, QueryPreprocessor.sanitize(\" \" + operator + \" \"));\n-    assertEquals(\"*Hello* \\\\\" + operator, QueryPreprocessor.sanitize(\"Hello \" + operator));\n-    assertEquals(\"\\\\\" + operator + \" *World*\", QueryPreprocessor.sanitize(operator + \" World\"));\n-\n-    // Don't escape operator if used correctly\n-    assertEquals(\"*Hello* \" + operator + \" *World*\",\n-      QueryPreprocessor.sanitize(\"Hello \" + operator + \" World\"));\n-  }\n-\n-  @Test\n-  public void testPartialMatches() {\n-    assertEquals(\"*Hello*\", QueryPreprocessor.sanitize(\"Hello\"));\n-    assertEquals(\"*Hello*\", QueryPreprocessor.sanitize(\"*Hello\"));\n-    assertEquals(\"*Hello*\", QueryPreprocessor.sanitize(\"Hello*\"));\n-    assertEquals(\"*Hello*\", QueryPreprocessor.sanitize(\"*Hello*\"));\n-    assertEquals(\"*Hello* *World*\", QueryPreprocessor.sanitize(\"Hello World\"));\n-    assertEquals(\"*Hello* *World*\", QueryPreprocessor.sanitize(\"Hello* World\"));\n-    assertEquals(\"*Hello* *World*\", QueryPreprocessor.sanitize(\"Hello *World\"));\n-    assertEquals(\"*Hello* *World*\", QueryPreprocessor.sanitize(\"*Hello* *World*\"));\n-  }\n-\n-}"
            },
            {
                "sha": "75736a10128bb3d70406d7972dd720365ab8d4bb",
                "filename": "modules/elasticsearch-index/src/main/java/org/opencastproject/elasticsearch/index/ElasticsearchIndex.java",
                "status": "modified",
                "additions": 0,
                "deletions": 23,
                "changes": 23,
                "blob_url": "https://github.com/opencast/opencast/blob/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Felasticsearch-index%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Felasticsearch%2Findex%2FElasticsearchIndex.java",
                "raw_url": "https://github.com/opencast/opencast/raw/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Felasticsearch-index%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Felasticsearch%2Findex%2FElasticsearchIndex.java",
                "contents_url": "https://api.github.com/repos/opencast/opencast/contents/modules%2Felasticsearch-index%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Felasticsearch%2Findex%2FElasticsearchIndex.java?ref=3d5ebd163674eb18e070f52b64a18f92188f98c3",
                "patch": "@@ -62,7 +62,6 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n-import java.util.Set;\n import java.util.concurrent.locks.Lock;\n import java.util.function.Function;\n \n@@ -840,26 +839,4 @@ private SearchResult<IndexTheme> getByQuery(ThemeSearchQuery query, int maxRetry\n       throw new SearchIndexException(\"Error querying theme index\", t);\n     }\n   }\n-\n-  /**\n-   * Escapes all reserved Elasticsearch characters in a given string\n-   * Useful for when a given query string does not know about Elasticsearch query syntax\n-   * @param text String to escape reserved characters in\n-   * @return the given string with escaped characters\n-   */\n-  public String escapeQuery(String text) {\n-    Set<Character> specialChars = Set.of('\\\\', '+', '-', '!', '(', ')', ':', '^', '[', ']', '\\\"', '{', '}', '~', '*',\n-            '?', '|', '&', '/');\n-\n-    StringBuilder sb = new StringBuilder(text.length());\n-\n-    for (char c : text.toCharArray()) {\n-      if (specialChars.contains(c)) {\n-        sb.append('\\\\');\n-      }\n-      sb.append(c);\n-    }\n-\n-    return sb.toString();\n-  }\n }"
            },
            {
                "sha": "c9c591a65af03acfd95440292a6bc18fe6e85350",
                "filename": "modules/elasticsearch-index/src/main/java/org/opencastproject/elasticsearch/index/QueryPreprocessor.java",
                "status": "renamed",
                "additions": 21,
                "deletions": 20,
                "changes": 41,
                "blob_url": "https://github.com/opencast/opencast/blob/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Felasticsearch-index%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Felasticsearch%2Findex%2FQueryPreprocessor.java",
                "raw_url": "https://github.com/opencast/opencast/raw/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Felasticsearch-index%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Felasticsearch%2Findex%2FQueryPreprocessor.java",
                "contents_url": "https://api.github.com/repos/opencast/opencast/contents/modules%2Felasticsearch-index%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Felasticsearch%2Findex%2FQueryPreprocessor.java?ref=3d5ebd163674eb18e070f52b64a18f92188f98c3",
                "patch": "@@ -19,7 +19,7 @@\n  *\n  */\n \n-package org.opencastproject.adminui.util;\n+package org.opencastproject.elasticsearch.index;\n \n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n@@ -49,25 +49,25 @@ public final class QueryPreprocessor {\n   private static final char MINUS = '-';\n   private static final char PLUS = '+';\n   private static final char ASTERISK = '*';\n-  private static final char EXPLANATION_MARK = '!';\n+  private static final char EXCLAMATION_MARK = '!';\n   private static final char BACKSLASH = '\\\\';\n   private static final char AMPERSAND = '&';\n   private static final char PIPE = '|';\n \n   private static final Set<Character> ESCAPED_CHARACTERS = new HashSet<Character>(Arrays.asList(\n-    MINUS,\n-    PLUS,\n-    EXPLANATION_MARK,\n-    BACKSLASH,\n-    AMPERSAND,\n-    PIPE,\n-    '(', ')', '{', '}', '[', ']', ':', '^', '~'\n+          MINUS,\n+          PLUS,\n+          EXCLAMATION_MARK,\n+          BACKSLASH,\n+          AMPERSAND,\n+          PIPE,\n+          '(', ')', '{', '}', '[', ']', ':', '^', '~', '\\\"', '/'\n   ));\n \n   private static final Set<Character> UNARY_OPERATORS = new HashSet<Character>(Arrays.asList(\n-    MINUS,\n-    PLUS,\n-    EXPLANATION_MARK\n+          MINUS,\n+          PLUS,\n+          EXCLAMATION_MARK\n   ));\n \n   private static final Set<String> BINARY_OPERATORS = new HashSet<String>(Arrays.asList(\"&&\", \"||\"));\n@@ -95,7 +95,8 @@ public static String sanitize(String query) {\n       if (isUnaryOperator(token)) {\n         sanitizedToken = sanitizeUnaryOperator(token);\n       } else if (isBinaryOperator(token)) {\n-        if ((i == 0) || isBinaryOperator(tokens.get(i - 1)) || (i >= tokens.size() - 1) || isBinaryOperator(tokens.get(i + 1))) {\n+        if ((i == 0) || isBinaryOperator(tokens.get(i - 1))\n+                || (i >= tokens.size() - 1) || isBinaryOperator(tokens.get(i + 1))) {\n           // Escape operator since operands missing\n           sanitizedToken = \"\" + BACKSLASH + token;\n         } else {\n@@ -201,8 +202,8 @@ private static ArrayList<String> tokenize(String query) {\n           tokens.add(currentToken);\n           currentToken = \"\";\n           openDoubleQuote = false;\n-        } else if (currentToken.isEmpty()\n-                   || (isUnaryOperator(\"\" + charAt(i - 1, query)) && Character.isWhitespace(charAt(i - 2, query)))) {\n+        } else if (currentToken.isEmpty()  || (isUnaryOperator(\"\" + charAt(i - 1, query))\n+                && Character.isWhitespace(charAt(i - 2, query)))) {\n           currentToken += DOUBLE_QUOTE;\n           openDoubleQuote = true;\n         } else {\n@@ -216,11 +217,11 @@ private static ArrayList<String> tokenize(String query) {\n         // We only allow unary operators as first character of a token\n         currentToken += ch;\n       } else if (isBinaryOperator(\"\" + ch + charAt(i + 1, query))\n-                 && Character.isWhitespace(charAt(i - 1, query))\n-                 && Character.isWhitespace(charAt(i + 2, query))) {\n-          // Binary operator detected, i.e. whitespace delimited && or ||\n-          tokens.add(\"\" + ch + ch);\n-          i++; // We nastily skip the binary operator, i.e. we are taken two characters in this round\n+                    && Character.isWhitespace(charAt(i - 1, query))\n+                    && Character.isWhitespace(charAt(i + 2, query))) {\n+        // Binary operator detected, i.e. whitespace delimited && or ||\n+        tokens.add(\"\" + ch + ch);\n+        i++; // We nastily skip the binary operator, i.e. we are taken two characters in this round\n       } else if (Character.isWhitespace(ch)) {\n         // Whitespace delimits tokens\n         if (!currentToken.isEmpty()) {",
                "previous_filename": "modules/admin-ui/src/main/java/org/opencastproject/adminui/util/QueryPreprocessor.java"
            },
            {
                "sha": "f7e8d2ffe7498899fccd634a8953daa636f97bcf",
                "filename": "modules/elasticsearch-index/src/test/java/org/opencastproject/elasticsearch/index/QueryPreprocessorTest.java",
                "status": "added",
                "additions": 144,
                "deletions": 0,
                "changes": 144,
                "blob_url": "https://github.com/opencast/opencast/blob/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Felasticsearch-index%2Fsrc%2Ftest%2Fjava%2Forg%2Fopencastproject%2Felasticsearch%2Findex%2FQueryPreprocessorTest.java",
                "raw_url": "https://github.com/opencast/opencast/raw/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Felasticsearch-index%2Fsrc%2Ftest%2Fjava%2Forg%2Fopencastproject%2Felasticsearch%2Findex%2FQueryPreprocessorTest.java",
                "contents_url": "https://api.github.com/repos/opencast/opencast/contents/modules%2Felasticsearch-index%2Fsrc%2Ftest%2Fjava%2Forg%2Fopencastproject%2Felasticsearch%2Findex%2FQueryPreprocessorTest.java?ref=3d5ebd163674eb18e070f52b64a18f92188f98c3",
                "patch": "@@ -0,0 +1,144 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ *\n+ * The Apereo Foundation licenses this file to you under the Educational\n+ * Community License, Version 2.0 (the \"License\"); you may not use this file\n+ * except in compliance with the License. You may obtain a copy of the License\n+ * at:\n+ *\n+ *   http://opensource.org/licenses/ecl2.txt\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n+ * License for the specific language governing permissions and limitations under\n+ * the License.\n+ *\n+ */\n+\n+package org.opencastproject.elasticsearch.index;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class QueryPreprocessorTest {\n+\n+  @Test\n+  public void testBlankQueries() {\n+    Assert.assertEquals(\"\", QueryPreprocessor.sanitize(\"\"));\n+    Assert.assertEquals(\"\", QueryPreprocessor.sanitize(\"   \"));\n+  }\n+\n+  @Test\n+  public void testDoubleQuotes() {\n+    // No partial matching for quoted strings\n+    Assert.assertEquals(\"\\\"Hello\\\"\", QueryPreprocessor.sanitize(\"\\\"Hello\\\"\"));\n+    Assert.assertEquals(\"*Hello* \\\"World\\\"\", QueryPreprocessor.sanitize(\"Hello \\\"World\\\"\"));\n+\n+    // Auto-completion in case of missing double-quote\n+    Assert.assertEquals(\"*Hello* \\\"World\\\"\", QueryPreprocessor.sanitize(\"Hello \\\"World\"));\n+    Assert.assertEquals(\"*Hello* \\\"World Again\\\"\", QueryPreprocessor.sanitize(\"Hello \\\"World Again\"));\n+\n+    // Escape double quote within tokens, i.e. ensure whitespace separated tokens\n+    Assert.assertEquals(\"*He\\\\\\\"llo* *Wor\\\\\\\"ld*\", QueryPreprocessor.sanitize(\"He\\\"llo Wor\\\"ld\"));\n+  }\n+\n+  @Test\n+  public void testWildcards() {\n+    // Don't escape wildcards occuring as individual tokens\n+    Assert.assertEquals(\"*\", QueryPreprocessor.sanitize(\"*\"));\n+    Assert.assertEquals(\"*\", QueryPreprocessor.sanitize(\" * \"));\n+    Assert.assertEquals(\"*?*\", QueryPreprocessor.sanitize(\"?\"));\n+    Assert.assertEquals(\"*?*\", QueryPreprocessor.sanitize(\" ? \"));\n+\n+    // Don't escape wildcards occuring within tokens\n+    Assert.assertEquals(\"*H*llo* *Worl*d*\", QueryPreprocessor.sanitize(\"H*llo Worl*d\"));\n+    Assert.assertEquals(\"*H?llo* *Worl?d*\", QueryPreprocessor.sanitize(\"H?llo Worl?d\"));\n+  }\n+\n+  @Test\n+  public void testCharacterEscaping() {\n+    // Unsupported special characters are escaped\n+    Assert.assertEquals(\"*\\\\(* *\\\\)* *\\\\[* *\\\\]* *\\\\{* *\\\\}* *\\\\~* *\\\\^* *\\\\:* *\\\\\\\\*\",\n+        QueryPreprocessor.sanitize(\" ( ) [ ] { } ~ ^ : \\\\\"));\n+\n+    // Unsupported special characters are not escaped in quoted strings\n+    Assert.assertEquals(\"\\\" ( ) [ ] { } ~ ^ : \\\\\\\"\", QueryPreprocessor.sanitize(\"\\\" ( ) [ ] { } ~ ^ : \\\\\\\"\"));\n+\n+    // Supported special characters are not escape in quoted strings\n+    Assert.assertEquals(\"\\\"|| && + - ! * ?\\\"\", QueryPreprocessor.sanitize(\"\\\"|| && + - ! * ?\\\"\"));\n+  }\n+\n+  @Test\n+  public void testUnaryOperators() {\n+    testUnaryOperator(\"+\");\n+    testUnaryOperator(\"-\");\n+    testUnaryOperator(\"!\");\n+  }\n+\n+  private void testUnaryOperator(String operator) {\n+    // Escape operator if operand is missing\n+    Assert.assertEquals(\"\\\\\" + operator, QueryPreprocessor.sanitize(operator));\n+    Assert.assertEquals(\"\\\\\" + operator, QueryPreprocessor.sanitize(\" \" + operator + \" \"));\n+\n+    // Escape operator if occuring within a token\n+    Assert.assertEquals(\"*test\\\\\" + operator + \"unit*\", QueryPreprocessor.sanitize(\"test\" + operator + \"unit\"));\n+    Assert.assertEquals(\"*test\\\\\" + operator + \"unit*\", QueryPreprocessor.sanitize(\"*test\" + operator + \"unit\"));\n+    Assert.assertEquals(\"*test\\\\\" + operator + \"unit*\", QueryPreprocessor.sanitize(\"test\" + operator + \"unit*\"));\n+    Assert.assertEquals(\"*test\\\\\" + operator + \"unit*\", QueryPreprocessor.sanitize(\"*test\" + operator + \"unit*\"));\n+    Assert.assertEquals(\"*test\\\\\" + operator + \"unit\\\\\" + operator + \"*\",\n+        QueryPreprocessor.sanitize(\"test\" + operator + \"unit\" + operator));\n+    Assert.assertEquals(operator + \"*\\\\\" + operator + \"test\\\\\" + operator + \"unit\\\\\" + operator + \"\\\\\" + operator + \"*\",\n+        QueryPreprocessor.sanitize(operator + operator + \"test\" + operator + \"unit\" + operator + operator));\n+\n+    // Partial matching for operands\n+    Assert.assertEquals(operator + \"*test\\\\\" + operator + \"unit*\",\n+        QueryPreprocessor.sanitize(operator + \"test\" + operator + \"unit\"));\n+    Assert.assertEquals(operator + \"*test\\\\\" + operator + \"unit*\",\n+        QueryPreprocessor.sanitize(operator + \"*test\" + operator + \"unit\"));\n+    Assert.assertEquals(operator + \"*test\\\\\" + operator + \"unit*\",\n+        QueryPreprocessor.sanitize(operator + \"test\" + operator + \"unit*\"));\n+    Assert.assertEquals(operator + \"*test\\\\\" + operator + \"unit*\",\n+        QueryPreprocessor.sanitize(operator + \"*test\" + operator + \"unit*\"));\n+\n+    // Binary operators are escaped when appearing as operangs of unary operators\n+    Assert.assertEquals(operator + \"*\\\\|\\\\|*\", QueryPreprocessor.sanitize(operator + \"||\"));\n+    Assert.assertEquals(operator + \"*\\\\&\\\\&*\", QueryPreprocessor.sanitize(operator + \"&&\"));\n+\n+    // Double quotes can be used in argument\n+    Assert.assertEquals(operator + \"\\\"Hello World\\\"\", QueryPreprocessor.sanitize(operator + \"\\\"Hello World\\\"\"));\n+  }\n+\n+  @Test\n+  public void testBinaryOperators() {\n+    testBinaryOperator(\"&&\");\n+    testBinaryOperator(\"||\");\n+  }\n+\n+  private void testBinaryOperator(String operator) {\n+    // Escape operator if operands are missing\n+    Assert.assertEquals(\"\\\\\" + operator, QueryPreprocessor.sanitize(operator));\n+    Assert.assertEquals(\"\\\\\" + operator, QueryPreprocessor.sanitize(\" \" + operator + \" \"));\n+    Assert.assertEquals(\"*Hello* \\\\\" + operator, QueryPreprocessor.sanitize(\"Hello \" + operator));\n+    Assert.assertEquals(\"\\\\\" + operator + \" *World*\", QueryPreprocessor.sanitize(operator + \" World\"));\n+\n+    // Don't escape operator if used correctly\n+    Assert.assertEquals(\"*Hello* \" + operator + \" *World*\", QueryPreprocessor.sanitize(\"Hello \" + operator + \" World\"));\n+  }\n+\n+  @Test\n+  public void testPartialMatches() {\n+    Assert.assertEquals(\"*Hello*\", QueryPreprocessor.sanitize(\"Hello\"));\n+    Assert.assertEquals(\"*Hello*\", QueryPreprocessor.sanitize(\"*Hello\"));\n+    Assert.assertEquals(\"*Hello*\", QueryPreprocessor.sanitize(\"Hello*\"));\n+    Assert.assertEquals(\"*Hello*\", QueryPreprocessor.sanitize(\"*Hello*\"));\n+    Assert.assertEquals(\"*Hello* *World*\", QueryPreprocessor.sanitize(\"Hello World\"));\n+    Assert.assertEquals(\"*Hello* *World*\", QueryPreprocessor.sanitize(\"Hello* World\"));\n+    Assert.assertEquals(\"*Hello* *World*\", QueryPreprocessor.sanitize(\"Hello *World\"));\n+    Assert.assertEquals(\"*Hello* *World*\", QueryPreprocessor.sanitize(\"*Hello* *World*\"));\n+  }\n+\n+}"
            },
            {
                "sha": "73720e601b96670e6de2059af1c52c0c280d2050",
                "filename": "modules/external-api/src/main/java/org/opencastproject/external/endpoint/EventsEndpoint.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/opencast/opencast/blob/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fexternal-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fexternal%2Fendpoint%2FEventsEndpoint.java",
                "raw_url": "https://github.com/opencast/opencast/raw/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fexternal-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fexternal%2Fendpoint%2FEventsEndpoint.java",
                "contents_url": "https://api.github.com/repos/opencast/opencast/contents/modules%2Fexternal-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fexternal%2Fendpoint%2FEventsEndpoint.java?ref=3d5ebd163674eb18e070f52b64a18f92188f98c3",
                "patch": "@@ -46,6 +46,7 @@\n import org.opencastproject.elasticsearch.api.SearchResult;\n import org.opencastproject.elasticsearch.api.SearchResultItem;\n import org.opencastproject.elasticsearch.index.ElasticsearchIndex;\n+import org.opencastproject.elasticsearch.index.QueryPreprocessor;\n import org.opencastproject.elasticsearch.index.objects.IndexObject;\n import org.opencastproject.elasticsearch.index.objects.event.Event;\n import org.opencastproject.elasticsearch.index.objects.event.EventIndexSchema;\n@@ -794,7 +795,7 @@ public Response getEvents(@HeaderParam(\"Accept\") String acceptHeader, @QueryPara\n           } else if (\"location\".equals(name)) {\n             query.withLocation(value);\n           } else if (\"textFilter\".equals(name)) {\n-            query.withText(\"*\" + elasticsearchIndex.escapeQuery(value) + \"*\");\n+            query.withText(QueryPreprocessor.sanitize(value));\n           } else if (\"series\".equals(name)) {\n             query.withSeriesId(value);\n           } else if (\"subject\".equals(name)) {"
            },
            {
                "sha": "7f081a0d32bcacdfc11cbf4b928e182aba235365",
                "filename": "modules/external-api/src/main/java/org/opencastproject/external/endpoint/SeriesEndpoint.java",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/opencast/opencast/blob/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fexternal-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fexternal%2Fendpoint%2FSeriesEndpoint.java",
                "raw_url": "https://github.com/opencast/opencast/raw/3d5ebd163674eb18e070f52b64a18f92188f98c3/modules%2Fexternal-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fexternal%2Fendpoint%2FSeriesEndpoint.java",
                "contents_url": "https://api.github.com/repos/opencast/opencast/contents/modules%2Fexternal-api%2Fsrc%2Fmain%2Fjava%2Forg%2Fopencastproject%2Fexternal%2Fendpoint%2FSeriesEndpoint.java?ref=3d5ebd163674eb18e070f52b64a18f92188f98c3",
                "patch": "@@ -43,6 +43,7 @@\n import org.opencastproject.elasticsearch.api.SearchResult;\n import org.opencastproject.elasticsearch.api.SearchResultItem;\n import org.opencastproject.elasticsearch.index.ElasticsearchIndex;\n+import org.opencastproject.elasticsearch.index.QueryPreprocessor;\n import org.opencastproject.elasticsearch.index.objects.event.EventIndexSchema;\n import org.opencastproject.elasticsearch.index.objects.series.Series;\n import org.opencastproject.elasticsearch.index.objects.series.SeriesIndexSchema;\n@@ -272,7 +273,7 @@ public Response getSeriesList(@HeaderParam(\"Accept\") String acceptHeader, @Query\n           } else if (\"Creator\".equals(name)) {\n             query.withCreator(value);\n           } else if (\"textFilter\".equals(name)) {\n-            query.withText(\"*\" + elasticsearchIndex.escapeQuery(value) + \"*\");\n+            query.withText(QueryPreprocessor.sanitize(value));\n           } else if (\"language\".equals(name)) {\n             query.withLanguage(value);\n           } else if (\"license\".equals(name)) {\n@@ -1341,7 +1342,7 @@ private SearchResult<Series> getSeries(\n       q.withEdit(edit);\n     }\n     if (StringUtils.isNotEmpty(text)) {\n-      q.withText(fuzzyMatch.booleanValue(), elasticsearchIndex.escapeQuery(text));\n+      q.withText(fuzzyMatch.booleanValue(), QueryPreprocessor.sanitize(text));\n     }\n     if (StringUtils.isNotEmpty(seriesId)) {\n       q.withIdentifier(seriesId);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/litestar-org/litestar/commits/53c1473b5ff7502816a9a339ffc90731bb0c2138",
        "url": "https://api.github.com/repos/litestar-org/litestar/commits/53c1473b5ff7502816a9a339ffc90731bb0c2138",
        "html_url": "https://github.com/litestar-org/litestar/commit/53c1473b5ff7502816a9a339ffc90731bb0c2138",
        "message": "Merge commit from fork\n\nCo-authored-by: Jacob Coffee <jacob@z7x.org>\nCo-authored-by: guacs <126393040+guacs@users.noreply.github.com>",
        "files": [
            {
                "sha": "3dfef974352ae84806248d5e1e28bed9480607e7",
                "filename": "docs/usage/requests.rst",
                "status": "modified",
                "additions": 49,
                "deletions": 0,
                "changes": 49,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/docs%2Fusage%2Frequests.rst",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/docs%2Fusage%2Frequests.rst",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/docs%2Fusage%2Frequests.rst?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -160,3 +160,52 @@ The example below illustrates how to implement custom request class for the whol\n    class on multiple layers, the layer closest to the route handler will take precedence.\n \n    You can read more about this in the :ref:`usage/applications:layered architecture` section\n+\n+\n+Limits\n+-------\n+\n+Body size\n+^^^^^^^^^^\n+\n+A limit for the allowed request body size can be set on all layers via the\n+``request_max_body_size`` parameter and defaults to 10MB. If a request body exceeds this\n+limit, a ``413 - Request Entity Too Large``\n+response will be returned. This limit applies to all methods of consuming the request\n+body, including requesting it via the ``body`` parameter in a route handler and\n+consuming it through a manually constructed :class:`~litestar.connection.Request`\n+instance, e.g. in a middleware.\n+\n+To disable this limit for a specific handler / router / controller, it can be set to\n+:obj:`None`.\n+\n+.. danger::\n+    Setting ``request_max_body_size=None`` is strongly discouraged as it exposes the\n+    application to a denial of service (DoS) attack by sending arbitrarily large\n+    request bodies to the affected endpoint. Because Litestar has to read the whole body\n+    to perform certain actions, such as parsing JSON, it will fill up all the available\n+    memory / swap until the application / server crashes, should no outside limits be\n+    imposed.\n+\n+    This is generally only recommended in environments where the application is running\n+    behind a reverse proxy such as NGINX, where a size limit is already set.\n+\n+\n+.. danger::\n+    Since ``request_max_body_size`` is handled on a per-request basis, it won't affect\n+    middlewares or ASGI handlers when they try to access the request body via the raw\n+    ASGI events. To avoid this, middlewares and ASGI handlers should construct a\n+    :class:`~litestar.connection.Request` instance and use the regular\n+    :meth:`~litestar.connection.Request.stream` /\n+    :meth:`~litestar.connection.Request.body` or content-appropriate method to consume\n+    the request body in a safe manner.\n+\n+\n+.. tip::\n+    For requests that define a ``Content-Length`` header, Litestar will not attempt to\n+    read the request body should the header value exceed the ``request_max_body_size``.\n+\n+    If the header value is within the allowed bounds, Litestar will verify during the\n+    streaming of the request body that it does not exceed the size specified in the\n+    header. Should the request exceed this size, it will abort the request with a\n+    ``400 - Bad Request``."
            },
            {
                "sha": "62983388ec52c38bc9b93e014ee40d8a9c114b12",
                "filename": "litestar/app.py",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fapp.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fapp.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/litestar%2Fapp.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -202,6 +202,7 @@ def __init__(\n         path: str | None = None,\n         plugins: Sequence[PluginProtocol] | None = None,\n         request_class: type[Request] | None = None,\n+        request_max_body_size: int | None = 10_000_000,\n         response_cache_config: ResponseCacheConfig | None = None,\n         response_class: type[Response] | None = None,\n         response_cookies: ResponseCookies | None = None,\n@@ -286,6 +287,8 @@ def __init__(\n             pdb_on_exception: Drop into the PDB when an exception occurs.\n             plugins: Sequence of plugins.\n             request_class: An optional subclass of :class:`Request <.connection.Request>` to use for http connections.\n+            request_max_body_size: Maximum allowed size of the request body in bytes. If this size is exceeded, a\n+                '413 - Request Entity Too Large' error response is returned.\n             response_class: A custom subclass of :class:`Response <.response.Response>` to be used as the app's default\n                 response.\n             response_cookies: A sequence of :class:`Cookie <.datastructures.Cookie>`.\n@@ -361,6 +364,7 @@ def __init__(\n             pdb_on_exception=pdb_on_exception,\n             plugins=self._get_default_plugins(list(plugins or [])),\n             request_class=request_class,\n+            request_max_body_size=request_max_body_size,\n             response_cache_config=response_cache_config or ResponseCacheConfig(),\n             response_class=response_class,\n             response_cookies=response_cookies or [],\n@@ -464,6 +468,7 @@ def __init__(\n             parameters=config.parameters,\n             path=config.path,\n             request_class=self.request_class,\n+            request_max_body_size=request_max_body_size,\n             response_class=config.response_class,\n             response_cookies=config.response_cookies,\n             response_headers=config.response_headers,"
            },
            {
                "sha": "a314b9e9e3546e88b7585e64b136862835c602f1",
                "filename": "litestar/config/app.py",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fconfig%2Fapp.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fconfig%2Fapp.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/litestar%2Fconfig%2Fapp.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -163,6 +163,9 @@ class AppConfig:\n     \"\"\"List of :class:`SerializationPluginProtocol <.plugins.SerializationPluginProtocol>`.\"\"\"\n     request_class: type[Request] | None = field(default=None)\n     \"\"\"An optional subclass of :class:`Request <.connection.Request>` to use for http connections.\"\"\"\n+    request_max_body_size: int | None | EmptyType = Empty\n+    \"\"\"Maximum allowed size of the request body in bytes. If this size is exceeded, a '413 - Request Entity Too Large'\n+    error response is returned.\"\"\"\n     response_class: type[Response] | None = field(default=None)\n     \"\"\"A custom subclass of :class:`Response <.response.Response>` to be used as the app's default response.\"\"\"\n     response_cookies: ResponseCookies = field(default_factory=list)"
            },
            {
                "sha": "e76054b04212265dacf93216f938bfc776699cc6",
                "filename": "litestar/connection/request.py",
                "status": "modified",
                "additions": 61,
                "deletions": 5,
                "changes": 66,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fconnection%2Frequest.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fconnection%2Frequest.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/litestar%2Fconnection%2Frequest.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -1,7 +1,8 @@\n from __future__ import annotations\n \n+import math\n import warnings\n-from typing import TYPE_CHECKING, Any, AsyncGenerator, Generic\n+from typing import TYPE_CHECKING, Any, AsyncGenerator, Generic, cast\n \n from litestar._multipart import parse_content_header, parse_multipart_form\n from litestar._parsers import parse_url_encoded_form_data\n@@ -17,12 +18,14 @@\n from litestar.datastructures.multi_dicts import FormMultiDict\n from litestar.enums import ASGIExtension, RequestEncodingType\n from litestar.exceptions import (\n+    ClientException,\n     InternalServerException,\n     LitestarException,\n     LitestarWarning,\n )\n+from litestar.exceptions.http_exceptions import RequestEntityTooLarge\n from litestar.serialization import decode_json, decode_msgpack\n-from litestar.types import Empty\n+from litestar.types import Empty, HTTPReceiveMessage\n \n __all__ = (\"Request\",)\n \n@@ -52,6 +55,7 @@ class Request(Generic[UserT, AuthT, StateT], ASGIConnection[\"HTTPRouteHandler\",\n         \"_msgpack\",\n         \"_content_type\",\n         \"_accept\",\n+        \"_content_length\",\n         \"is_connected\",\n         \"supports_push_promise\",\n     )\n@@ -79,6 +83,7 @@ def __init__(self, scope: Scope, receive: Receive = empty_receive, send: Send =\n         self._msgpack: Any = Empty\n         self._content_type: tuple[str, dict[str, str]] | EmptyType = Empty\n         self._accept: Accept | EmptyType = Empty\n+        self._content_length: int | None | EmptyType = Empty\n         self.supports_push_promise = ASGIExtension.SERVER_PUSH in self._server_extensions\n \n     @property\n@@ -152,6 +157,21 @@ async def msgpack(self) -> Any:\n                 )\n         return self._msgpack\n \n+    @property\n+    def content_length(self) -> int | None:\n+        cached_content_length = self._content_length\n+        if cached_content_length is not Empty:\n+            return cached_content_length\n+\n+        content_length_header = self.headers.get(\"content-length\")\n+        try:\n+            content_length = self._content_length = (\n+                int(content_length_header) if content_length_header is not None else None\n+            )\n+        except ValueError:\n+            raise ClientException(f\"Invalid content-length: {content_length_header!r}\") from None\n+        return content_length\n+\n     async def stream(self) -> AsyncGenerator[bytes, None]:\n         \"\"\"Return an async generator that streams chunks of bytes.\n \n@@ -164,10 +184,46 @@ async def stream(self) -> AsyncGenerator[bytes, None]:\n         if self._body is Empty:\n             if not self.is_connected:\n                 raise InternalServerException(\"stream consumed\")\n-            while event := await self.receive():\n+\n+            announced_content_length = self.content_length\n+            # setting this to 'math.inf' as a micro-optimisation; Comparing against a\n+            # float is slightly faster than checking if a value is 'None' and then\n+            # comparing it to an int. since we expect a limit to be set most of the\n+            # time, this is a bit more efficient\n+            max_content_length = self.route_handler.resolve_request_max_body_size() or math.inf\n+\n+            # if the 'content-length' header is set, and exceeds the limit, we can bail\n+            # out early before reading anything\n+            if announced_content_length is not None and announced_content_length > max_content_length:\n+                raise RequestEntityTooLarge\n+\n+            total_bytes_streamed: int = 0\n+            while event := cast(\"HTTPReceiveMessage\", await self.receive()):\n                 if event[\"type\"] == \"http.request\":\n-                    if event[\"body\"]:\n-                        yield event[\"body\"]\n+                    body = event[\"body\"]\n+                    if body:\n+                        total_bytes_streamed += len(body)\n+\n+                        # if a 'content-length' header was set, check if we have\n+                        # received more bytes than specified. in most cases this should\n+                        # be caught before it hits the application layer and an ASGI\n+                        # server (e.g. uvicorn) will not allow this, but since it's not\n+                        # forbidden according to the HTTP or ASGI spec, we err on the\n+                        # side of caution and still perform this check.\n+                        #\n+                        # uvicorn documented behaviour for this case:\n+                        # https://github.com/encode/uvicorn/blob/fe3910083e3990695bc19c2ef671dd447262ae18/docs/server-behavior.md?plain=1#L11\n+                        if announced_content_length:\n+                            if total_bytes_streamed > announced_content_length:\n+                                raise ClientException(\"Malformed request\")\n+\n+                        # we don't have a 'content-length' header, likely a chunked\n+                        # transfer. we don't really care and simply check if we have\n+                        # received more bytes than allowed\n+                        elif total_bytes_streamed > max_content_length:\n+                            raise RequestEntityTooLarge\n+\n+                        yield body\n \n                     if not event.get(\"more_body\", False):\n                         break"
            },
            {
                "sha": "7786e023f9321f5c3920886ad62a6c7b877be545",
                "filename": "litestar/controller.py",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fcontroller.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fcontroller.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/litestar%2Fcontroller.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -64,6 +64,7 @@ class Controller:\n         \"parameters\",\n         \"path\",\n         \"request_class\",\n+        \"request_max_body_size\",\n         \"response_class\",\n         \"response_cookies\",\n         \"response_headers\",\n@@ -136,6 +137,11 @@ class Controller:\n     \"\"\"A custom subclass of :class:`Request <.connection.Request>` to be used as the default request for all route\n     handlers under the controller.\n     \"\"\"\n+    request_max_body_size: int | None | EmptyType\n+    \"\"\"\n+    Maximum allowed size of the request body in bytes. If this size is exceeded, a '413 - Request Entity Too Large'\n+    error response is returned.\"\"\"\n+\n     response_class: type[Response] | None\n     \"\"\"A custom subclass of :class:`Response <.response.Response>` to be used as the default response for all route\n     handlers under the controller.\n@@ -191,6 +197,9 @@ def __init__(self, owner: Router) -> None:\n         if not hasattr(self, \"include_in_schema\"):\n             self.include_in_schema = Empty\n \n+        if not hasattr(self, \"request_max_body_size\"):\n+            self.request_max_body_size = Empty\n+\n         self.signature_namespace = add_types_to_signature_namespace(\n             getattr(self, \"signature_types\", []), getattr(self, \"signature_namespace\", {})\n         )\n@@ -235,6 +244,7 @@ def as_router(self) -> Router:\n             type_encoders=self.type_encoders,\n             type_decoders=self.type_decoders,\n             websocket_class=self.websocket_class,\n+            request_max_body_size=self.request_max_body_size,\n         )\n         router.owner = self.owner\n         return router"
            },
            {
                "sha": "f3a34174ebcd46b88bb9d1d5ec667ec9d49c9356",
                "filename": "litestar/exceptions/http_exceptions.py",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fexceptions%2Fhttp_exceptions.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fexceptions%2Fhttp_exceptions.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/litestar%2Fexceptions%2Fhttp_exceptions.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -10,6 +10,7 @@\n     HTTP_403_FORBIDDEN,\n     HTTP_404_NOT_FOUND,\n     HTTP_405_METHOD_NOT_ALLOWED,\n+    HTTP_413_REQUEST_ENTITY_TOO_LARGE,\n     HTTP_429_TOO_MANY_REQUESTS,\n     HTTP_500_INTERNAL_SERVER_ERROR,\n     HTTP_503_SERVICE_UNAVAILABLE,\n@@ -119,6 +120,11 @@ class MethodNotAllowedException(ClientException):\n     status_code = HTTP_405_METHOD_NOT_ALLOWED\n \n \n+class RequestEntityTooLarge(ClientException):\n+    status_code = HTTP_413_REQUEST_ENTITY_TOO_LARGE\n+    detail = \"Request Entity Too Large\"\n+\n+\n class TooManyRequestsException(ClientException):\n     \"\"\"Request limits have been exceeded.\"\"\"\n "
            },
            {
                "sha": "8445d6c6abe12b1da1108dd0ec46732c98a239ee",
                "filename": "litestar/handlers/http_handlers/base.py",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fhandlers%2Fhttp_handlers%2Fbase.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fhandlers%2Fhttp_handlers%2Fbase.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/litestar%2Fhandlers%2Fhttp_handlers%2Fbase.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -82,6 +82,7 @@ class HTTPRouteHandler(BaseRouteHandler):\n         \"_resolved_request_class\",\n         \"_resolved_tags\",\n         \"_resolved_security\",\n+        \"_resolved_request_max_body_size\",\n         \"after_request\",\n         \"after_response\",\n         \"background\",\n@@ -113,6 +114,7 @@ class HTTPRouteHandler(BaseRouteHandler):\n         \"sync_to_thread\",\n         \"tags\",\n         \"template_name\",\n+        \"request_max_body_size\",\n     )\n \n     has_sync_callable: bool\n@@ -139,6 +141,7 @@ def __init__(\n         name: str | None = None,\n         opt: Mapping[str, Any] | None = None,\n         request_class: type[Request] | None = None,\n+        request_max_body_size: int | None | EmptyType = Empty,\n         response_class: type[Response] | None = None,\n         response_cookies: ResponseCookies | None = None,\n         response_headers: ResponseHeaders | None = None,\n@@ -204,6 +207,8 @@ def __init__(\n                 :class:`ASGI Scope <.types.Scope>`.\n             request_class: A custom subclass of :class:`Request <.connection.Request>` to be used as route handler's\n                 default request.\n+            request_max_body_size: Maximum allowed size of the request body in bytes. If this size is exceeded,\n+                a '413 - Request Entity Too Large' error response is returned.\n             response_class: A custom subclass of :class:`Response <.response.Response>` to be used as route handler's\n                 default response.\n             response_cookies: A sequence of :class:`Cookie <.datastructures.Cookie>` instances.\n@@ -272,6 +277,7 @@ def __init__(\n         self.response_class = response_class\n         self.response_cookies: Sequence[Cookie] | None = narrow_response_cookies(response_cookies)\n         self.response_headers: Sequence[ResponseHeader] | None = narrow_response_headers(response_headers)\n+        self.request_max_body_size = request_max_body_size\n \n         self.sync_to_thread = sync_to_thread\n         # OpenAPI related attributes\n@@ -297,6 +303,7 @@ def __init__(\n         self._resolved_request_class: type[Request] | EmptyType = Empty\n         self._resolved_security: list[SecurityRequirement] | EmptyType = Empty\n         self._resolved_tags: list[str] | EmptyType = Empty\n+        self._resolved_request_max_body_size: int | EmptyType | None = Empty\n \n     def __call__(self, fn: AnyCallable) -> HTTPRouteHandler:\n         \"\"\"Replace a function with itself.\"\"\"\n@@ -473,6 +480,25 @@ def resolve_tags(self) -> list[str]:\n \n         return self._resolved_tags\n \n+    def resolve_request_max_body_size(self) -> int | None:\n+        if (resolved_limits := self._resolved_request_max_body_size) is not Empty:\n+            return resolved_limits\n+\n+        max_body_size = self._resolved_request_max_body_size = next(  # pyright: ignore\n+            (\n+                max_body_size\n+                for layer in reversed(self.ownership_layers)\n+                if (max_body_size := layer.request_max_body_size) is not Empty\n+            ),\n+            Empty,\n+        )\n+        if max_body_size is Empty:\n+            raise ImproperlyConfiguredException(\n+                \"'request_max_body_size' set to 'Empty' on all layers. To omit a limit, \"\n+                \"set 'request_max_body_size=None'\"\n+            )\n+        return max_body_size\n+\n     def get_response_handler(self, is_response_type_data: bool = False) -> Callable[[Any], Awaitable[ASGIApp]]:\n         \"\"\"Resolve the response_handler function for the route handler.\n "
            },
            {
                "sha": "fe0b0cd56eebe2d138bcd04c242416f837811cfb",
                "filename": "litestar/handlers/http_handlers/decorators.py",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fhandlers%2Fhttp_handlers%2Fdecorators.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Fhandlers%2Fhttp_handlers%2Fdecorators.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/litestar%2Fhandlers%2Fhttp_handlers%2Fdecorators.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -628,6 +628,7 @@ def __init__(\n         name: str | None = None,\n         opt: Mapping[str, Any] | None = None,\n         request_class: type[Request] | None = None,\n+        request_max_body_size: int | None | EmptyType = Empty,\n         response_class: type[Response] | None = None,\n         response_cookies: ResponseCookies | None = None,\n         response_headers: ResponseHeaders | None = None,\n@@ -692,6 +693,8 @@ def __init__(\n                 wherever you have access to :class:`Request <.connection.Request>` or :class:`ASGI Scope <.types.Scope>`.\n             request_class: A custom subclass of :class:`Request <.connection.Request>` to be used as route handler's\n                 default request.\n+            request_max_body_size: Maximum allowed size of the request body in bytes. If this size is exceeded,\n+                a '413 - Request Entity Too Large' error response is returned.\n             response_class: A custom subclass of :class:`Response <.response.Response>` to be used as route handler's\n                 default response.\n             response_cookies: A sequence of :class:`Cookie <.datastructures.Cookie>` instances.\n@@ -755,6 +758,7 @@ def __init__(\n             path=path,\n             raises=raises,\n             request_class=request_class,\n+            request_max_body_size=request_max_body_size,\n             response_class=response_class,\n             response_cookies=response_cookies,\n             response_description=response_description,\n@@ -803,6 +807,7 @@ def __init__(\n         name: str | None = None,\n         opt: Mapping[str, Any] | None = None,\n         request_class: type[Request] | None = None,\n+        request_max_body_size: int | None | EmptyType = Empty,\n         response_class: type[Response] | None = None,\n         response_cookies: ResponseCookies | None = None,\n         response_headers: ResponseHeaders | None = None,\n@@ -867,6 +872,8 @@ def __init__(\n                 wherever you have access to :class:`Request <.connection.Request>` or :class:`ASGI Scope <.types.Scope>`.\n             request_class: A custom subclass of :class:`Request <.connection.Request>` to be used as route handler's\n                 default request.\n+            request_max_body_size: Maximum allowed size of the request body in bytes. If this size is exceeded,\n+                a '413 - Request Entity Too Large' error response is returned.\n             response_class: A custom subclass of :class:`Response <.response.Response>` to be used as route handler's\n                 default response.\n             response_cookies: A sequence of :class:`Cookie <.datastructures.Cookie>` instances.\n@@ -930,6 +937,7 @@ def __init__(\n             path=path,\n             raises=raises,\n             request_class=request_class,\n+            request_max_body_size=request_max_body_size,\n             response_class=response_class,\n             response_cookies=response_cookies,\n             response_description=response_description,\n@@ -978,6 +986,7 @@ def __init__(\n         name: str | None = None,\n         opt: Mapping[str, Any] | None = None,\n         request_class: type[Request] | None = None,\n+        request_max_body_size: int | None | EmptyType = Empty,\n         response_class: type[Response] | None = None,\n         response_cookies: ResponseCookies | None = None,\n         response_headers: ResponseHeaders | None = None,\n@@ -1042,6 +1051,8 @@ def __init__(\n                 wherever you have access to :class:`Request <.connection.Request>` or :class:`ASGI Scope <.types.Scope>`.\n             request_class: A custom subclass of :class:`Request <.connection.Request>` to be used as route handler's\n                 default request.\n+            request_max_body_size: Maximum allowed size of the request body in bytes. If this size is exceeded,\n+                a '413 - Request Entity Too Large' error response is returned.\n             response_class: A custom subclass of :class:`Response <.response.Response>` to be used as route handler's\n                 default response.\n             response_cookies: A sequence of :class:`Cookie <.datastructures.Cookie>` instances.\n@@ -1105,6 +1116,7 @@ def __init__(\n             path=path,\n             raises=raises,\n             request_class=request_class,\n+            request_max_body_size=request_max_body_size,\n             response_class=response_class,\n             response_cookies=response_cookies,\n             response_description=response_description,"
            },
            {
                "sha": "6b9ca1c953f6aa83a3eb22637c7e5e138df85f8c",
                "filename": "litestar/router.py",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Frouter.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/litestar%2Frouter.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/litestar%2Frouter.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -68,6 +68,7 @@ class Router:\n         \"path\",\n         \"registered_route_handler_ids\",\n         \"request_class\",\n+        \"request_max_body_size\",\n         \"response_class\",\n         \"response_cookies\",\n         \"response_headers\",\n@@ -111,6 +112,7 @@ def __init__(\n         type_decoders: TypeDecodersSequence | None = None,\n         type_encoders: TypeEncodersMap | None = None,\n         websocket_class: type[WebSocket] | None = None,\n+        request_max_body_size: int | None | EmptyType = Empty,\n     ) -> None:\n         \"\"\"Initialize a ``Router``.\n \n@@ -143,6 +145,8 @@ def __init__(\n                 with the router instance.\n             request_class: A custom subclass of :class:`Request <.connection.Request>` to be used as the default for\n                 all route handlers, controllers and other routers associated with the router instance.\n+            request_max_body_size: Maximum allowed size of the request body in bytes. If this size is exceeded,\n+                a '413 - Request Entity Too Large\" error response is returned.\n             response_class: A custom subclass of :class:`Response <.response.Response>` to be used as the default for\n                 all route handlers, controllers and other routers associated with the router instance.\n             response_cookies: A sequence of :class:`Cookie <.datastructures.Cookie>` instances.\n@@ -197,6 +201,7 @@ def __init__(\n         self.type_encoders = dict(type_encoders) if type_encoders is not None else None\n         self.type_decoders = list(type_decoders) if type_decoders is not None else None\n         self.websocket_class = websocket_class\n+        self.request_max_body_size = request_max_body_size\n \n         for route_handler in route_handlers or []:\n             self.register(value=route_handler)"
            },
            {
                "sha": "e4ae950d22d2b43420c1430f319f628ec4bb96bf",
                "filename": "tests/conftest.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/tests%2Fconftest.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/tests%2Fconftest.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/tests%2Fconftest.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -216,6 +216,7 @@ def inner(\n             \"route_handler\": route_handler,\n             \"user\": user,\n             \"session\": session,\n+            \"headers\": [],\n             **kwargs,\n         }\n         return cast(\"Scope\", scope)"
            },
            {
                "sha": "acbf46e706de45f81d1248690c6e4ad1f0f1a734",
                "filename": "tests/unit/test_connection/test_connection_caching.py",
                "status": "modified",
                "additions": 10,
                "deletions": 2,
                "changes": 12,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/tests%2Funit%2Ftest_connection%2Ftest_connection_caching.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/tests%2Funit%2Ftest_connection%2Ftest_connection_caching.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/tests%2Funit%2Ftest_connection%2Ftest_connection_caching.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -5,7 +5,7 @@\n \n import pytest\n \n-from litestar import Request\n+from litestar import Request, post\n from litestar.testing import RequestFactory\n from litestar.types import Empty, HTTPReceiveMessage, Scope\n from litestar.utils.scope.state import ScopeState\n@@ -17,11 +17,15 @@ async def test_multiple_request_object_data_caching(create_scope: Callable[...,\n     https://github.com/litestar-org/litestar/issues/2727\n     \"\"\"\n \n+    @post(\"/\", request_max_body_size=None)\n+    async def handler() -> None:\n+        pass\n+\n     async def test_receive() -> HTTPReceiveMessage:\n         mock()\n         return {\"type\": \"http.request\", \"body\": b\"abc\", \"more_body\": False}\n \n-    scope = create_scope()\n+    scope = create_scope(route_handler=handler)\n     request_1 = Request[Any, Any, Any](scope, test_receive)\n     request_2 = Request[Any, Any, Any](scope, test_receive)\n     assert (await request_1.body()) == b\"abc\"\n@@ -121,6 +125,8 @@ def check_get_mock() -> None:\n             get_mock.assert_has_calls([call(state_key), call(\"headers\")])\n         elif state_key == \"form\":\n             get_mock.assert_has_calls([call(state_key), call(\"content_type\")])\n+        elif state_key == \"body\":\n+            get_mock.assert_has_calls([call(state_key), call(\"headers\")])\n         else:\n             get_mock.assert_called_once_with(state_key)\n \n@@ -136,6 +142,8 @@ def check_set_mock() -> None:\n             set_mock.assert_has_calls([call(\"content_type\", ANY), call(state_key, ANY)])\n         elif state_key in {\"accept\", \"cookies\", \"content_type\"}:\n             set_mock.assert_has_calls([call(\"headers\", ANY), call(state_key, ANY)])\n+        elif state_key == \"body\":\n+            set_mock.assert_has_calls([call(\"headers\", ANY), call(state_key, ANY)])\n         else:\n             set_mock.assert_called_once_with(state_key, ANY)\n "
            },
            {
                "sha": "930df71f344972e48ca2db5be6ca102f044e3e6f",
                "filename": "tests/unit/test_connection/test_request.py",
                "status": "modified",
                "additions": 133,
                "deletions": 60,
                "changes": 193,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/tests%2Funit%2Ftest_connection%2Ftest_request.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/tests%2Funit%2Ftest_connection%2Ftest_request.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/tests%2Funit%2Ftest_connection%2Ftest_request.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -11,7 +11,7 @@\n \n import pytest\n \n-from litestar import MediaType, Request, asgi, get, post\n+from litestar import MediaType, Request, get, post\n from litestar.connection.base import AuthT, StateT, UserT, empty_send\n from litestar.datastructures import Address, Cookie, State\n from litestar.exceptions import (\n@@ -24,6 +24,7 @@\n from litestar.response.base import ASGIResponse\n from litestar.serialization import encode_json, encode_msgpack\n from litestar.static_files.config import StaticFilesConfig\n+from litestar.status_codes import HTTP_400_BAD_REQUEST, HTTP_413_REQUEST_ENTITY_TOO_LARGE\n from litestar.testing import TestClient, create_test_client\n \n if TYPE_CHECKING:\n@@ -32,7 +33,7 @@\n     from litestar.types import ASGIApp, Receive, Scope, Send\n \n \n-@get(\"/\", sync_to_thread=False)\n+@get(\"/\", sync_to_thread=False, request_max_body_size=None)\n def _route_handler() -> None:\n     pass\n \n@@ -230,56 +231,51 @@ def test_request_client(\n \n \n def test_request_body() -> None:\n-    async def app(scope: Scope, receive: Receive, send: Send) -> None:\n-        request = Request[Any, Any, State](scope, receive)\n+    @post(\"/\")\n+    async def handler(request: Request) -> bytes:\n         body = await request.body()\n-        response = ASGIResponse(body=encode_json({\"body\": body.decode()}))\n-        await response(scope, receive, send)\n-\n-    client = TestClient(app)\n+        return encode_json({\"body\": body.decode()})\n \n-    response = client.get(\"/\")\n-    assert response.json() == {\"body\": \"\"}\n+    with create_test_client([handler]) as client:\n+        response = client.post(\"/\")\n+        assert response.json() == {\"body\": \"\"}\n \n-    response = client.post(\"/\", json={\"a\": \"123\"})\n-    assert response.json() == {\"body\": '{\"a\": \"123\"}'}\n+        response = client.post(\"/\", json={\"a\": \"123\"})\n+        assert response.json() == {\"body\": '{\"a\": \"123\"}'}\n \n-    response = client.post(\"/\", content=\"abc\")\n-    assert response.json() == {\"body\": \"abc\"}\n+        response = client.post(\"/\", content=\"abc\")\n+        assert response.json() == {\"body\": \"abc\"}\n \n \n def test_request_stream() -> None:\n-    async def app(scope: Scope, receive: Receive, send: Send) -> None:\n-        request = Request[Any, Any, State](scope, receive)\n+    @post(\"/\")\n+    async def handler(request: Request) -> bytes:\n         body = b\"\"\n         async for chunk in request.stream():\n             body += chunk\n-        response = ASGIResponse(body=encode_json({\"body\": body.decode()}))\n-        await response(scope, receive, send)\n+        return encode_json({\"body\": body.decode()})\n \n-    client = TestClient(app)\n+    with create_test_client([handler]) as client:\n+        response = client.post(\"/\")\n+        assert response.json() == {\"body\": \"\"}\n \n-    response = client.get(\"/\")\n-    assert response.json() == {\"body\": \"\"}\n-\n-    response = client.post(\"/\", json={\"a\": \"123\"})\n-    assert response.json() == {\"body\": '{\"a\": \"123\"}'}\n+        response = client.post(\"/\", json={\"a\": \"123\"})\n+        assert response.json() == {\"body\": '{\"a\": \"123\"}'}\n \n-    response = client.post(\"/\", content=\"abc\")\n-    assert response.json() == {\"body\": \"abc\"}\n+        response = client.post(\"/\", content=\"abc\")\n+        assert response.json() == {\"body\": \"abc\"}\n \n \n def test_request_form_urlencoded() -> None:\n-    async def app(scope: Scope, receive: Receive, send: Send) -> None:\n-        request = Request[Any, Any, State](scope, receive)\n+    @post(\"/\")\n+    async def handler(request: Request) -> bytes:\n         form = await request.form()\n-        response = ASGIResponse(body=encode_json({\"form\": dict(form)}))\n-        await response(scope, receive, send)\n \n-    client = TestClient(app)\n+        return encode_json({\"form\": dict(form)})\n \n-    response = client.post(\"/\", data={\"abc\": \"123 @\"})\n-    assert response.json() == {\"form\": {\"abc\": \"123 @\"}}\n+    with create_test_client([handler]) as client:\n+        response = client.post(\"/\", data={\"abc\": \"123 @\"})\n+        assert response.json() == {\"form\": {\"abc\": \"123 @\"}}\n \n \n def test_request_form_urlencoded_multi_keys() -> None:\n@@ -301,19 +297,17 @@ async def handler(request: Request) -> int:\n \n \n def test_request_body_then_stream() -> None:\n-    async def app(scope: Any, receive: Receive, send: Send) -> None:\n-        request = Request[Any, Any, State](scope, receive)\n+    @post(\"/\")\n+    async def handler(request: Request) -> bytes:\n         body = await request.body()\n         chunks = b\"\"\n         async for chunk in request.stream():\n             chunks += chunk\n-        response = ASGIResponse(body=encode_json({\"body\": body.decode(), \"stream\": chunks.decode()}))\n-        await response(scope, receive, send)\n-\n-    client = TestClient(app)\n+        return encode_json({\"body\": body.decode(), \"stream\": chunks.decode()})\n \n-    response = client.post(\"/\", content=\"abc\")\n-    assert response.json() == {\"body\": \"abc\", \"stream\": \"abc\"}\n+    with create_test_client([handler]) as client:\n+        response = client.post(\"/\", content=\"abc\")\n+        assert response.json() == {\"body\": \"abc\", \"stream\": \"abc\"}\n \n \n def test_request_stream_then_body() -> None:\n@@ -329,19 +323,27 @@ async def app(scope: Scope, receive: Receive, send: Send) -> None:\n         response = ASGIResponse(body=encode_json({\"body\": body.decode(), \"stream\": chunks.decode()}))\n         await response(scope, receive, send)\n \n-    client = TestClient(app)\n+    @post(\"/\")\n+    async def handler(request: Request) -> bytes:\n+        chunks = b\"\"\n+        async for chunk in request.stream():\n+            chunks += chunk\n+        try:\n+            body = await request.body()\n+        except InternalServerException:\n+            body = b\"<stream consumed>\"\n+        return encode_json({\"body\": body.decode(), \"stream\": chunks.decode()})\n \n-    response = client.post(\"/\", content=\"abc\")\n-    assert response.json() == {\"body\": \"<stream consumed>\", \"stream\": \"abc\"}\n+    with create_test_client([handler]) as client:\n+        response = client.post(\"/\", content=\"abc\")\n+        assert response.json() == {\"body\": \"<stream consumed>\", \"stream\": \"abc\"}\n \n \n def test_request_json() -> None:\n-    @asgi(\"/\")\n-    async def handler(scope: Scope, receive: Receive, send: Send) -> None:\n-        request = Request[Any, Any, State](scope, receive)\n+    @post(\"/\")\n+    async def handler(request: Request) -> bytes:\n         data = await request.json()\n-        response = ASGIResponse(body=encode_json({\"json\": data}))\n-        await response(scope, receive, send)\n+        return encode_json({\"json\": data})\n \n     with create_test_client(handler) as client:\n         response = client.post(\"/\", json={\"a\": \"123\"})\n@@ -361,10 +363,11 @@ async def app(scope: Scope, receive: Receive, send: Send) -> None:\n     assert response.text == \"/he/llo, b'/he%2Fllo'\"\n \n \n-def test_request_without_setting_receive() -> None:\n+def test_request_without_setting_receive(create_scope: Callable[..., Scope]) -> None:\n     \"\"\"If Request is instantiated without the 'receive' channel, then .body() is not available.\"\"\"\n \n     async def app(scope: Scope, receive: Receive, send: Send) -> None:\n+        scope.update(create_scope(route_handler=_route_handler))  # type: ignore[typeddict-item]\n         request = Request[Any, Any, State](scope)\n         try:\n             data = await request.json()\n@@ -431,20 +434,19 @@ async def app(scope: Scope, receive: Receive, send: Send) -> None:\n \n \n def test_chunked_encoding() -> None:\n-    async def app(scope: Scope, receive: Receive, send: Send) -> None:\n-        request = Request[Any, Any, State](scope, receive)\n+    @post(\"/\")\n+    async def handler(request: Request) -> bytes:\n         body = await request.body()\n-        response = ASGIResponse(body=encode_json({\"body\": body.decode()}))\n-        await response(scope, receive, send)\n+        return encode_json({\"body\": body.decode()})\n \n-    client = TestClient(app)\n+    with create_test_client([handler]) as client:\n \n-    def post_body() -> Generator[bytes, None, None]:\n-        yield b\"foo\"\n-        yield b\"bar\"\n+        def post_body() -> Generator[bytes, None, None]:\n+            yield b\"foo\"\n+            yield b\"bar\"\n \n-    response = client.post(\"/\", content=post_body())\n-    assert response.json() == {\"body\": \"foobar\"}\n+        response = client.post(\"/\", content=post_body())\n+        assert response.json() == {\"body\": \"foobar\"}\n \n \n def test_request_send_push_promise() -> None:\n@@ -548,3 +550,74 @@ async def get_state(request: Request[Any, Any, State]) -> dict[str, str]:\n     ) as client:\n         response = client.get(\"/\")\n         assert response.json() == {\"state\": 2}\n+\n+\n+def test_request_body_exceeds_content_length() -> None:\n+    @post(\"/\")\n+    def handler(body: bytes) -> None:\n+        pass\n+\n+    with create_test_client([handler]) as client:\n+        response = client.post(\"/\", headers={\"content-length\": \"1\"}, content=b\"ab\")\n+        assert response.status_code == HTTP_400_BAD_REQUEST\n+        assert response.json() == {\"status_code\": 400, \"detail\": \"Malformed request\"}\n+\n+\n+def test_request_body_exceeds_max_request_body_size() -> None:\n+    @post(\"/one\", request_max_body_size=1)\n+    async def handler_one(request: Request) -> None:\n+        await request.body()\n+\n+    @post(\"/two\", request_max_body_size=1)\n+    async def handler_two(body: bytes) -> None:\n+        pass\n+\n+    with create_test_client([handler_one, handler_two]) as client:\n+        response = client.post(\"/one\", headers={\"content-length\": \"2\"}, content=b\"ab\")\n+        assert response.status_code == HTTP_413_REQUEST_ENTITY_TOO_LARGE\n+\n+        response = client.post(\"/two\", headers={\"content-length\": \"2\"}, content=b\"ab\")\n+        assert response.status_code == HTTP_413_REQUEST_ENTITY_TOO_LARGE\n+\n+\n+def test_request_body_exceeds_max_request_body_size_chunked() -> None:\n+    @post(\"/one\", request_max_body_size=1)\n+    async def handler_one(request: Request) -> None:\n+        assert request.headers[\"transfer-encoding\"] == \"chunked\"\n+        await request.body()\n+\n+    @post(\"/two\", request_max_body_size=1)\n+    async def handler_two(body: bytes, request: Request) -> None:\n+        assert request.headers[\"transfer-encoding\"] == \"chunked\"\n+        await request.body()\n+\n+    def generator() -> Generator[bytes, None, None]:\n+        yield b\"1\"\n+        yield b\"2\"\n+\n+    with create_test_client([handler_one, handler_two]) as client:\n+        response = client.post(\"/one\", content=generator())\n+        assert response.status_code == HTTP_413_REQUEST_ENTITY_TOO_LARGE\n+\n+        response = client.post(\"/two\", content=generator())\n+        assert response.status_code == HTTP_413_REQUEST_ENTITY_TOO_LARGE\n+\n+\n+def test_request_content_length() -> None:\n+    @post(\"/\")\n+    def handler(request: Request) -> dict:\n+        return {\"content-length\": request.content_length}\n+\n+    with create_test_client([handler]) as client:\n+        assert client.post(\"/\", content=b\"1\").json() == {\"content-length\": 1}\n+\n+\n+def test_request_invalid_content_length() -> None:\n+    @post(\"/\")\n+    def handler(request: Request) -> dict:\n+        return {\"content-length\": request.content_length}\n+\n+    with create_test_client([handler]) as client:\n+        response = client.post(\"/\", content=b\"1\", headers={\"content-length\": \"a\"})\n+        assert response.status_code == HTTP_400_BAD_REQUEST\n+        assert response.json() == {\"detail\": \"Invalid content-length: 'a'\", \"status_code\": 400}"
            },
            {
                "sha": "2f328005ea318b75ed8725faf5571135e62a48a4",
                "filename": "tests/unit/test_handlers/test_http_handlers/test_resolution.py",
                "status": "added",
                "additions": 66,
                "deletions": 0,
                "changes": 66,
                "blob_url": "https://github.com/litestar-org/litestar/blob/53c1473b5ff7502816a9a339ffc90731bb0c2138/tests%2Funit%2Ftest_handlers%2Ftest_http_handlers%2Ftest_resolution.py",
                "raw_url": "https://github.com/litestar-org/litestar/raw/53c1473b5ff7502816a9a339ffc90731bb0c2138/tests%2Funit%2Ftest_handlers%2Ftest_http_handlers%2Ftest_resolution.py",
                "contents_url": "https://api.github.com/repos/litestar-org/litestar/contents/tests%2Funit%2Ftest_handlers%2Ftest_http_handlers%2Ftest_resolution.py?ref=53c1473b5ff7502816a9a339ffc90731bb0c2138",
                "patch": "@@ -0,0 +1,66 @@\n+import pytest\n+\n+from litestar import Controller, Litestar, Router, post\n+from litestar.exceptions import ImproperlyConfiguredException\n+from litestar.types import Empty\n+\n+\n+def test_resolve_request_max_body_size() -> None:\n+    @post(\"/1\")\n+    def router_handler() -> None:\n+        pass\n+\n+    @post(\"/2\")\n+    def app_handler() -> None:\n+        pass\n+\n+    class MyController(Controller):\n+        request_max_body_size = 2\n+\n+        @post(\"/3\")\n+        def controller_handler(self) -> None:\n+            pass\n+\n+    router = Router(\"/\", route_handlers=[router_handler], request_max_body_size=1)\n+    app = Litestar(route_handlers=[app_handler, router, MyController], request_max_body_size=3)\n+    assert router_handler.resolve_request_max_body_size() == 1\n+    assert app_handler.resolve_request_max_body_size() == 3\n+    assert (\n+        next(r for r in app.routes if r.path == \"/3\").route_handler_map[\"POST\"][0].resolve_request_max_body_size() == 2  # type: ignore[union-attr]\n+    )\n+\n+\n+def test_resolve_request_max_body_size_none() -> None:\n+    @post(\"/1\", request_max_body_size=None)\n+    def router_handler() -> None:\n+        pass\n+\n+    Litestar([router_handler])\n+    assert router_handler.resolve_request_max_body_size() is None\n+\n+\n+def test_resolve_request_max_body_size_app_default() -> None:\n+    @post(\"/\")\n+    def router_handler() -> None:\n+        pass\n+\n+    app = Litestar(route_handlers=[router_handler])\n+\n+    assert router_handler.resolve_request_max_body_size() == app.request_max_body_size == 10_000_000\n+\n+\n+def test_resolve_request_max_body_size_empty_on_all_layers_raises() -> None:\n+    @post(\"/\")\n+    def handler_one() -> None:\n+        pass\n+\n+    Litestar([handler_one], request_max_body_size=Empty)  # type: ignore[arg-type]\n+    with pytest.raises(ImproperlyConfiguredException):\n+        handler_one.resolve_request_max_body_size()\n+\n+    @post(\"/\")\n+    def handler_two() -> None:\n+        pass\n+\n+    with pytest.raises(ImproperlyConfiguredException):\n+        handler_two.resolve_request_max_body_size()"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Bubka/2FAuth/commits/93c508e118f483f3c93ac36e1f91face95af642d",
        "url": "https://api.github.com/repos/Bubka/2FAuth/commits/93c508e118f483f3c93ac36e1f91face95af642d",
        "html_url": "https://github.com/Bubka/2FAuth/commit/93c508e118f483f3c93ac36e1f91face95af642d",
        "message": "Sanitize svg icons before storing them",
        "files": [
            {
                "sha": "b6ca21e6a256c36b33eac281c9a3b89ee466ef21",
                "filename": "app/Providers/TwoFAuthServiceProvider.php",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/Bubka/2FAuth/blob/93c508e118f483f3c93ac36e1f91face95af642d/app%2FProviders%2FTwoFAuthServiceProvider.php",
                "raw_url": "https://github.com/Bubka/2FAuth/raw/93c508e118f483f3c93ac36e1f91face95af642d/app%2FProviders%2FTwoFAuthServiceProvider.php",
                "contents_url": "https://api.github.com/repos/Bubka/2FAuth/contents/app%2FProviders%2FTwoFAuthServiceProvider.php?ref=93c508e118f483f3c93ac36e1f91face95af642d",
                "patch": "@@ -9,6 +9,7 @@\n use App\\Services\\ReleaseRadarService;\n use App\\Services\\SettingService;\n use App\\Services\\TwoFAccountService;\n+use enshrined\\svgSanitize\\Sanitizer;\n use Illuminate\\Contracts\\Support\\DeferrableProvider;\n use Illuminate\\Support\\ServiceProvider;\n use Zxing\\QrReader;\n@@ -30,8 +31,8 @@ public function register()\n             return new SettingService;\n         });\n \n-        $this->app->singleton(IconStoreService::class, function () {\n-            return new IconStoreService;\n+        $this->app->singleton(IconStoreService::class, function ($app) {\n+            return new IconStoreService($app->make(Sanitizer::class));\n         });\n \n         $this->app->singleton(LogoService::class, function ($app) {"
            },
            {
                "sha": "64b888ca99dda9912bd50611c4f4eb75aa8085f5",
                "filename": "app/Services/IconStoreService.php",
                "status": "modified",
                "additions": 33,
                "deletions": 1,
                "changes": 34,
                "blob_url": "https://github.com/Bubka/2FAuth/blob/93c508e118f483f3c93ac36e1f91face95af642d/app%2FServices%2FIconStoreService.php",
                "raw_url": "https://github.com/Bubka/2FAuth/raw/93c508e118f483f3c93ac36e1f91face95af642d/app%2FServices%2FIconStoreService.php",
                "contents_url": "https://api.github.com/repos/Bubka/2FAuth/contents/app%2FServices%2FIconStoreService.php?ref=93c508e118f483f3c93ac36e1f91face95af642d",
                "patch": "@@ -6,6 +6,7 @@\n use App\\Facades\\Settings;\n use App\\Models\\Icon;\n use App\\Models\\TwoFAccount;\n+use enshrined\\svgSanitize\\Sanitizer;\n use Illuminate\\Contracts\\Filesystem\\Filesystem;\n use Illuminate\\Support\\Arr;\n use Illuminate\\Support\\Collection;\n@@ -26,13 +27,21 @@ class IconStoreService\n      */\n     protected bool $usesDatabase;\n \n+    /**\n+     * The SVG sanitizer\n+     */\n+    protected Sanitizer $svgSanitizer;\n+\n     /**\n      * \n      */\n-    public function __construct()\n+    public function __construct(Sanitizer $svgSanitizer)\n     {\n         $this->usesDatabase = Settings::get('storeIconsInDatabase');\n         $this->setDisk();\n+\n+        $this->svgSanitizer = $svgSanitizer;\n+        $this->svgSanitizer->removeRemoteReferences(true);\n     }\n \n     /**\n@@ -207,13 +216,36 @@ public function store(string $name, string $content) : bool\n     {\n         $storedToDisk = $this->storeToDisk($name, $content);\n \n+        if ($this->mimeType($name) == 'image/svg+xml') {\n+            $sanitized = $this->sanitize($content);\n+\n+            if (! $sanitized) {\n+                $this->delete($name);\n+\n+                return false;\n+            }\n+\n+            if ($content != $sanitized) {\n+                $content = $sanitized;\n+                $storedToDisk = $this->storeToDisk($name, $content);\n+            }\n+        }\n+\n         if ($this->usesDatabase) {\n             return $this->storeToDatabase($name, $content);\n         }\n \n         return $storedToDisk;\n     }\n \n+    /**\n+     * Sanitize the given content (when icon is an svg image)\n+     */\n+    protected function sanitize(string $content) : string\n+    {\n+        return $this->svgSanitizer->sanitize($content);\n+    }\n+\n     /**\n      * Create the given icon in the disk\n      */"
            },
            {
                "sha": "7d238369c6353b533dc59d8f31b45f00a39ed202",
                "filename": "composer.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Bubka/2FAuth/blob/93c508e118f483f3c93ac36e1f91face95af642d/composer.json",
                "raw_url": "https://github.com/Bubka/2FAuth/raw/93c508e118f483f3c93ac36e1f91face95af642d/composer.json",
                "contents_url": "https://api.github.com/repos/Bubka/2FAuth/contents/composer.json?ref=93c508e118f483f3c93ac36e1f91face95af642d",
                "patch": "@@ -28,6 +28,7 @@\n         \"ext-xml\": \"*\",\n         \"chillerlan/php-qrcode\": \"^5.0\",\n         \"doctormckay/steam-totp\": \"^1.0\",\n+        \"enshrined/svg-sanitize\": \"^0.20.0\",\n         \"google/protobuf\": \"^4.26\",\n         \"jackiedo/dotenv-editor\": \"dev-master\",\n         \"jenssegers/agent\": \"^2.6\","
            },
            {
                "sha": "cb9123a3c0b1df490870f1ccbde046318bb1b7bb",
                "filename": "composer.lock",
                "status": "modified",
                "additions": 46,
                "deletions": 1,
                "changes": 47,
                "blob_url": "https://github.com/Bubka/2FAuth/blob/93c508e118f483f3c93ac36e1f91face95af642d/composer.lock",
                "raw_url": "https://github.com/Bubka/2FAuth/raw/93c508e118f483f3c93ac36e1f91face95af642d/composer.lock",
                "contents_url": "https://api.github.com/repos/Bubka/2FAuth/contents/composer.lock?ref=93c508e118f483f3c93ac36e1f91face95af642d",
                "patch": "@@ -4,7 +4,7 @@\n         \"Read more about it at https://getcomposer.org/doc/01-basic-usage.md#installing-dependencies\",\n         \"This file is @generated automatically\"\n     ],\n-    \"content-hash\": \"bff445ed39877e4dfccfb5b451e0d96a\",\n+    \"content-hash\": \"da7b7e586a5f017685b05bf7189d8c5e\",\n     \"packages\": [\n         {\n             \"name\": \"brick/math\",\n@@ -770,6 +770,51 @@\n             ],\n             \"time\": \"2023-10-06T06:47:41+00:00\"\n         },\n+        {\n+            \"name\": \"enshrined/svg-sanitize\",\n+            \"version\": \"0.20.0\",\n+            \"source\": {\n+                \"type\": \"git\",\n+                \"url\": \"https://github.com/darylldoyle/svg-sanitizer.git\",\n+                \"reference\": \"068d9fcf912c88a0471d101d95a2caa87c50aee7\"\n+            },\n+            \"dist\": {\n+                \"type\": \"zip\",\n+                \"url\": \"https://api.github.com/repos/darylldoyle/svg-sanitizer/zipball/068d9fcf912c88a0471d101d95a2caa87c50aee7\",\n+                \"reference\": \"068d9fcf912c88a0471d101d95a2caa87c50aee7\",\n+                \"shasum\": \"\"\n+            },\n+            \"require\": {\n+                \"ext-dom\": \"*\",\n+                \"ext-libxml\": \"*\",\n+                \"php\": \"^7.1 || ^8.0\"\n+            },\n+            \"require-dev\": {\n+                \"phpunit/phpunit\": \"^6.5 || ^8.5\"\n+            },\n+            \"type\": \"library\",\n+            \"autoload\": {\n+                \"psr-4\": {\n+                    \"enshrined\\\\svgSanitize\\\\\": \"src\"\n+                }\n+            },\n+            \"notification-url\": \"https://packagist.org/downloads/\",\n+            \"license\": [\n+                \"GPL-2.0-or-later\"\n+            ],\n+            \"authors\": [\n+                {\n+                    \"name\": \"Daryll Doyle\",\n+                    \"email\": \"daryll@enshrined.co.uk\"\n+                }\n+            ],\n+            \"description\": \"An SVG sanitizer for PHP\",\n+            \"support\": {\n+                \"issues\": \"https://github.com/darylldoyle/svg-sanitizer/issues\",\n+                \"source\": \"https://github.com/darylldoyle/svg-sanitizer/tree/0.20.0\"\n+            },\n+            \"time\": \"2024-09-05T10:18:12+00:00\"\n+        },\n         {\n             \"name\": \"firebase/php-jwt\",\n             \"version\": \"v6.10.1\","
            },
            {
                "sha": "b0e1188ffdba4a72153cfba61b846ff19e246543",
                "filename": "tests/Api/v1/Controllers/IconControllerTest.php",
                "status": "modified",
                "additions": 33,
                "deletions": 1,
                "changes": 34,
                "blob_url": "https://github.com/Bubka/2FAuth/blob/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FApi%2Fv1%2FControllers%2FIconControllerTest.php",
                "raw_url": "https://github.com/Bubka/2FAuth/raw/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FApi%2Fv1%2FControllers%2FIconControllerTest.php",
                "contents_url": "https://api.github.com/repos/Bubka/2FAuth/contents/tests%2FApi%2Fv1%2FControllers%2FIconControllerTest.php?ref=93c508e118f483f3c93ac36e1f91face95af642d",
                "patch": "@@ -13,6 +13,7 @@\n use Illuminate\\Support\\Facades\\Storage;\n use PHPUnit\\Framework\\Attributes\\CoversClass;\n use PHPUnit\\Framework\\Attributes\\Test;\n+use Tests\\Classes\\LocalFile;\n use Tests\\Data\\HttpRequestTestData;\n use Tests\\Data\\OtpTestData;\n use Tests\\FeatureTestCase;\n@@ -41,7 +42,7 @@ public function setUp() : void\n             LogoService::TFA_URL           => Http::response(HttpRequestTestData::TFA_JSON_BODY, 200),\n         ]);\n         Http::fake([\n-            OtpTestData::EXTERNAL_IMAGE_URL_DECODED => Http::response((new FileFactory)->image('file.png', 10, 10)->tempFile, 200),\n+            OtpTestData::EXTERNAL_IMAGE_URL_DECODED          => Http::response((new FileFactory)->image('file.png', 10, 10)->tempFile, 200),\n         ]);\n \n         $this->user = User::factory()->create();\n@@ -84,6 +85,21 @@ public function test_upload_with_invalid_data_returns_validation_error()\n             ->assertStatus(422);\n     }\n \n+    #[Test]\n+    public function test_upload_infected_svg_data_stores_stores_sanitized_svg_content()\n+    {\n+        $file = LocalFile::fake()->infectedSvgIconFile();\n+\n+        $response = $this->actingAs($this->user, 'api-guard')\n+            ->json('POST', '/api/v1/icons', [\n+                'icon' => $file,\n+            ])\n+            ->assertCreated();\n+\n+        $svgContent = IconStore::get($response->getData()->filename);\n+        $this->assertStringNotContainsString(OtpTestData::ICON_SVG_MALICIOUS_CODE, $svgContent);\n+    }\n+\n     #[Test]\n     public function test_fetch_logo_returns_filename()\n     {\n@@ -97,6 +113,22 @@ public function test_fetch_logo_returns_filename()\n             ]);\n     }\n \n+    #[Test]\n+    public function test_fetch_logo_with_infected_svg_data_stores_sanitized_svg_content()\n+    {\n+        $response = $this->actingAs($this->user, 'api-guard')\n+            ->json('POST', '/api/v1/icons/default', [\n+                'service' => 'service',\n+            ])\n+            ->assertStatus(201)\n+            ->assertJsonStructure([\n+                'filename',\n+            ]);\n+\n+        $svgContent = IconStore::get($response->getData()->filename);\n+        $this->assertStringNotContainsString(OtpTestData::ICON_SVG_MALICIOUS_CODE, $svgContent);\n+    }\n+\n     #[Test]\n     public function test_fetch_unknown_logo_returns_nothing()\n     {"
            },
            {
                "sha": "39a93edd11787bb3676e7b1eae16fea5561d8776",
                "filename": "tests/Api/v1/Controllers/TwoFAccountControllerTest.php",
                "status": "modified",
                "additions": 17,
                "deletions": 4,
                "changes": 21,
                "blob_url": "https://github.com/Bubka/2FAuth/blob/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FApi%2Fv1%2FControllers%2FTwoFAccountControllerTest.php",
                "raw_url": "https://github.com/Bubka/2FAuth/raw/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FApi%2Fv1%2FControllers%2FTwoFAccountControllerTest.php",
                "contents_url": "https://api.github.com/repos/Bubka/2FAuth/contents/tests%2FApi%2Fv1%2FControllers%2FTwoFAccountControllerTest.php?ref=93c508e118f483f3c93ac36e1f91face95af642d",
                "patch": "@@ -8,6 +8,7 @@\n use App\\Api\\v1\\Resources\\TwoFAccountExportResource;\n use App\\Api\\v1\\Resources\\TwoFAccountReadResource;\n use App\\Api\\v1\\Resources\\TwoFAccountStoreResource;\n+use App\\Facades\\IconStore;\n use App\\Facades\\Settings;\n use App\\Models\\Group;\n use App\\Models\\TwoFAccount;\n@@ -242,11 +243,8 @@ public function setUp() : void\n         Http::fake([\n             LogoService::TFA_IMG_URL . '*' => Http::response(HttpRequestTestData::SVG_LOGO_BODY, 200),\n             LogoService::TFA_URL           => Http::response(HttpRequestTestData::TFA_JSON_BODY, 200),\n-        ]);\n-        Http::fake([\n             OtpTestData::EXTERNAL_IMAGE_URL_DECODED => Http::response((new FileFactory)->image('file.png', 10, 10)->tempFile, 200),\n-        ]);\n-        Http::fake([\n+            OtpTestData::EXTERNAL_INFECTED_IMAGE_URL_DECODED => Http::response((new FileFactory)->createWithContent('infected.svg', OtpTestData::ICON_SVG_DATA_INFECTED)->tempFile, 200),\n             'example.com/*' => Http::response(null, 400),\n         ]);\n \n@@ -1218,6 +1216,21 @@ public function test_preview_with_unreachable_image_returns_success_with_no_icon\n             ]);\n     }\n \n+    #[Test]\n+    public function test_preview_with_infected_svg_image_stores_sanitized_image()\n+    {\n+        $this->user['preferences->getOfficialIcons'] = true;\n+\n+        $response = $this->actingAs($this->user, 'api-guard')\n+            ->json('POST', '/api/v1/twofaccounts/preview', [\n+                'uri' => OtpTestData::TOTP_URI_WITH_INFECTED_SVG_IMAGE,\n+            ])\n+            ->assertOk();\n+\n+        $svgContent = IconStore::get($response->getData()->icon);\n+        $this->assertStringNotContainsString(OtpTestData::ICON_SVG_MALICIOUS_CODE, $svgContent);\n+    }\n+\n     #[Test]\n     public function test_export_returns_json_migration_resource()\n     {"
            },
            {
                "sha": "67cd8a89c680dbc634df3c9a790697d2fb5345f3",
                "filename": "tests/Classes/LocalFileFactory.php",
                "status": "modified",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/Bubka/2FAuth/blob/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FClasses%2FLocalFileFactory.php",
                "raw_url": "https://github.com/Bubka/2FAuth/raw/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FClasses%2FLocalFileFactory.php",
                "contents_url": "https://api.github.com/repos/Bubka/2FAuth/contents/tests%2FClasses%2FLocalFileFactory.php?ref=93c508e118f483f3c93ac36e1f91face95af642d",
                "patch": "@@ -215,4 +215,20 @@ public function invalidPlainTextFileEmpty()\n             fwrite($temp, ob_get_clean());\n         }));\n     }\n+\n+    /**\n+     * Create a new local infected SVG file.\n+     *\n+     * @return \\Illuminate\\Http\\Testing\\File\n+     */\n+    public function infectedSvgIconFile()\n+    {\n+        return new File('infectedSvgIcon.svg', tap(tmpfile(), function ($temp) {\n+            ob_start();\n+\n+            echo OtpTestData::ICON_SVG_DATA_INFECTED;\n+\n+            fwrite($temp, ob_get_clean());\n+        }));\n+    }\n }"
            },
            {
                "sha": "81c83fce1370e047549186bb9e09c567f4d04289",
                "filename": "tests/Data/OtpTestData.php",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/Bubka/2FAuth/blob/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FData%2FOtpTestData.php",
                "raw_url": "https://github.com/Bubka/2FAuth/raw/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FData%2FOtpTestData.php",
                "contents_url": "https://api.github.com/repos/Bubka/2FAuth/contents/tests%2FData%2FOtpTestData.php?ref=93c508e118f483f3c93ac36e1f91face95af642d",
                "patch": "@@ -36,6 +36,10 @@ class OtpTestData\n \n     const EXTERNAL_IMAGE_URL_ENCODED = 'https%3A%2F%2Fen.opensuse.org%2Fimages%2F4%2F44%2FButton-filled-colour.png';\n \n+    const EXTERNAL_INFECTED_IMAGE_URL_DECODED = 'https://image.com/infected.svg';\n+\n+    const EXTERNAL_INFECTED_IMAGE_URL_ENCODED = 'https%3A%2F%2Fimage.com%2Finfected.svg';\n+\n     const ICON_PNG = 'test.png';\n \n     const ICON_PNG_DATA = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAC0lEQVQImWP4DwQACfsD/eNV8pwAAAAASUVORK5CYII=';\n@@ -58,6 +62,10 @@ class OtpTestData\n \n     const ICON_SVG_DATA_ENCODED = 'PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPg0KICAgPGNpcmNsZSBjeD0iNTEyIiBjeT0iNTEyIiByPSI1MTIiIHN0eWxlPSJmaWxsOiMwMDBlOWMiLz4NCiAgIDxwYXRoIGQ9Im03MDAuMiA0NjYuNSA2MS4yLTEwNi4zYzIzLjYgNDEuNiAzNy4yIDg5LjggMzcuMiAxNDEuMSAwIDY4LjgtMjQuMyAxMzEuOS02NC43IDE4MS40SDU3NS44bDQ4LjctODQuNmgtNjQuNGw3NS44LTEzMS43IDY0LjMuMXptLTU1LjQtMTI1LjJMNDQ4LjMgNjgyLjVsLjEuMkgyOTAuMWMtNDAuNS00OS41LTY0LjctMTEyLjYtNjQuNy0xODEuNCAwLTUxLjQgMTMuNi05OS42IDM3LjMtMTQxLjNsMTAyLjUgMTc4LjIgMTEzLjMtMTk3aDE2Ni4zeiIgc3R5bGU9ImZpbGw6I2ZmZiIvPg0KPC9zdmc+DQo=';\n \n+    const ICON_SVG_MALICIOUS_CODE = '<script>alert(\"XSS\");</script>';\n+\n+    const ICON_SVG_DATA_INFECTED = '<?xml version=\"1.0\" standalone=\"no\"?><!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"><svg width=\"100\" height=\"100\" version=\"1.1\" xmlns=\"http://www..w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">' . self::ICON_SVG_MALICIOUS_CODE . '</svg>';\n+\n     const ICON_GIF = 'test.gif';\n \n     const ICON_GIF_DATA = 'R0lGODlhAQACAPcAAAAAAAAAMwAAZgAAmQAAzAAA/wArAAArMwArZgArmQArzAAr/wBVAABVMwBVZgBVmQBVzABV/wCAAACAMwCAZgCAmQCAzACA/wCqAACqMwCqZgCqmQCqzACq/wDVAADVMwDVZgDVmQDVzADV/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMrADMrMzMrZjMrmTMrzDMr/zNVADNVMzNVZjNVmTNVzDNV/zOAADOAMzOAZjOAmTOAzDOA/zOqADOqMzOqZjOqmTOqzDOq/zPVADPVMzPVZjPVmTPVzDPV/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YrAGYrM2YrZmYrmWYrzGYr/2ZVAGZVM2ZVZmZVmWZVzGZV/2aAAGaAM2aAZmaAmWaAzGaA/2aqAGaqM2aqZmaqmWaqzGaq/2bVAGbVM2bVZmbVmWbVzGbV/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5krAJkrM5krZpkrmZkrzJkr/5lVAJlVM5lVZplVmZlVzJlV/5mAAJmAM5mAZpmAmZmAzJmA/5mqAJmqM5mqZpmqmZmqzJmq/5nVAJnVM5nVZpnVmZnVzJnV/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wrAMwrM8wrZswrmcwrzMwr/8xVAMxVM8xVZsxVmcxVzMxV/8yAAMyAM8yAZsyAmcyAzMyA/8yqAMyqM8yqZsyqmcyqzMyq/8zVAMzVM8zVZszVmczVzMzV/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8rAP8rM/8rZv8rmf8rzP8r//9VAP9VM/9VZv9Vmf9VzP9V//+AAP+AM/+AZv+Amf+AzP+A//+qAP+qM/+qZv+qmf+qzP+q///VAP/VM//VZv/Vmf/VzP/V////AP//M///Zv//mf//zP///wAAAAAAAAAAAAAAACH5BAEAAPwALAAAAAABAAIAAAgFAPftCwgAOw==';\n@@ -86,6 +94,8 @@ class OtpTestData\n \n     const TOTP_URI_WITH_UNREACHABLE_IMAGE = 'otpauth://totp/service:account?secret=A4GRFHVVRBGY7UIW&image=' . self::UNREACHABLE_IMAGE_URL;\n \n+    const TOTP_URI_WITH_INFECTED_SVG_IMAGE = 'otpauth://totp/service:account?secret=A4GRFHVVRBGY7UIW&image=' . self::EXTERNAL_INFECTED_IMAGE_URL_ENCODED;\n+\n     const INVALID_OTPAUTH_URI = 'otpauth://Xotp/' . self::ACCOUNT . '?secret=' . self::SECRET;\n \n     const INVALID_OTPAUTH_URI_MISMATCHING_ISSUER = 'otpauth://totp/' . self::MICROSOFT . ':' . self::ACCOUNT . '?secret=' . self::SECRET . '&issuer=' . self::SERVICE;"
            },
            {
                "sha": "7f33abdba4ea764c6f60e64bbfbdbbd65b973b01",
                "filename": "tests/Feature/Services/IconStoreServiceTest.php",
                "status": "modified",
                "additions": 47,
                "deletions": 0,
                "changes": 47,
                "blob_url": "https://github.com/Bubka/2FAuth/blob/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FFeature%2FServices%2FIconStoreServiceTest.php",
                "raw_url": "https://github.com/Bubka/2FAuth/raw/93c508e118f483f3c93ac36e1f91face95af642d/tests%2FFeature%2FServices%2FIconStoreServiceTest.php",
                "contents_url": "https://api.github.com/repos/Bubka/2FAuth/contents/tests%2FFeature%2FServices%2FIconStoreServiceTest.php?ref=93c508e118f483f3c93ac36e1f91face95af642d",
                "patch": "@@ -482,11 +482,58 @@ public function test_store_returns_false_when_it_fails()\n             ->with($iconName, $iconContent)\n             ->andReturn(false);\n \n+        Storage::shouldReceive('disk->mimeType')\n+            ->with($iconName)\n+            ->andReturn('image/png');\n+\n         $result = $this->iconStore->store($iconName, $iconContent);\n \n         $this->assertFalse($result);\n     }\n \n+    #[Test]\n+    public function test_store_stores_sanitized_svg_content()\n+    {\n+        Settings::set('storeIconsInDatabase', true);\n+        \n+        $result = $this->iconStore->store(OtpTestData::ICON_SVG, OtpTestData::ICON_SVG_DATA_INFECTED);\n+\n+        $this->assertTrue($result);\n+\n+        $this->assertStringNotContainsString(\n+            OtpTestData::ICON_SVG_MALICIOUS_CODE,\n+            Storage::disk('icons')->get(OtpTestData::ICON_SVG)\n+        );\n+        \n+        $dbRecord = DB::table('icons')->where('name', OtpTestData::ICON_SVG)->first();\n+        \n+        $this->assertStringNotContainsString(\n+            OtpTestData::ICON_SVG_MALICIOUS_CODE,\n+            $dbRecord->content,\n+        );\n+    }\n+\n+    #[Test]\n+    public function test_store_returns_false_when_svg_sanitize_failed()\n+    {\n+        $result = $this->iconStore->store(OtpTestData::ICON_SVG, 'this_will_make_svg_data_invalid' . OtpTestData::ICON_SVG_DATA);\n+\n+        $this->assertFalse($result);\n+    }\n+\n+    #[Test]\n+    public function test_store_deletes_svg_icon_that_cannot_be_sanitized()\n+    {\n+        Settings::set('storeIconsInDatabase', true);\n+        \n+        $result = $this->iconStore->store(OtpTestData::ICON_SVG, 'this_will_make_svg_data_invalid' . OtpTestData::ICON_SVG_DATA);\n+\n+        Storage::disk('icons')->assertMissing(OtpTestData::ICON_SVG);\n+        $this->assertDatabaseMissing('icons', [\n+            'name' => OtpTestData::ICON_SVG,\n+        ]);\n+    }\n+\n     #[Test]\n     public function test_exists_returns_true()\n     {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/commits/fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
        "url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/commits/fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
        "html_url": "https://github.com/django-cms/djangocms-attributes-field/commit/fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
        "message": "feat: Add form field validation from model field (#56)\n\n* Add pypi actions\r\n\r\n* bump version\r\n\r\n* feat: Move field validation to form field\r\n\r\n* Bump version\r\n\r\n* Fix syntax error in test action\r\n\r\n* For action fixes\r\n\r\n* Update pypi actions",
        "files": [
            {
                "sha": "3812bb2e328bd24e0d59b86fcab0f5889e3c7196",
                "filename": ".github/workflows/lint.yml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/.github%2Fworkflows%2Flint.yml",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/.github%2Fworkflows%2Flint.yml",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/.github%2Fworkflows%2Flint.yml?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -22,4 +22,4 @@ jobs:\n           python -m pip install --upgrade pip\n           pip install ruff\n       - name: Run Ruff\n-        run: ruff djangocms_attributes_field tests\n+        run: ruff check djangocms_attributes_field tests"
            },
            {
                "sha": "ec1abc5c23ce05cb3aab08738853b52004ae3ded",
                "filename": ".github/workflows/publish-to-live-pypi.yml",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/.github%2Fworkflows%2Fpublish-to-live-pypi.yml",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/.github%2Fworkflows%2Fpublish-to-live-pypi.yml",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/.github%2Fworkflows%2Fpublish-to-live-pypi.yml?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -9,14 +9,17 @@ jobs:\n   build-n-publish:\n     name: Build and publish Python \ud83d\udc0d distributions \ud83d\udce6 to pypi\n     runs-on: ubuntu-latest\n+    environment:\n+      name: pypi\n+      url: https://pypi.org/p/djangocms-attributes_field\n     permissions:\n       id-token: write\n     steps:\n     - uses: actions/checkout@v3\n     - name: Set up Python 3.10\n-      uses: actions/setup-python@v4\n+      uses: actions/setup-python@v5\n       with:\n-        python-version: '3.10'\n+        python-version: '3.12'\n \n     - name: Install pypa/build\n       run: >-\n@@ -36,6 +39,3 @@ jobs:\n     - name: Publish distribution \ud83d\udce6 to PyPI\n       if: startsWith(github.ref, 'refs/tags')\n       uses: pypa/gh-action-pypi-publish@release/v1\n-      with:\n-        user: __token__\n-        password: ${{ secrets.PYPI_API_TOKEN }}"
            },
            {
                "sha": "5b2a16a91cf8ea0d15198910a288e016837e3adb",
                "filename": ".github/workflows/publish-to-test-pypi.yml",
                "status": "modified",
                "additions": 7,
                "deletions": 4,
                "changes": 11,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/.github%2Fworkflows%2Fpublish-to-test-pypi.yml",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/.github%2Fworkflows%2Fpublish-to-test-pypi.yml",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/.github%2Fworkflows%2Fpublish-to-test-pypi.yml?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -9,12 +9,17 @@ jobs:\n   build-n-publish:\n     name: Build and publish Python \ud83d\udc0d distributions \ud83d\udce6 to TestPyPI\n     runs-on: ubuntu-latest\n+    environment:\n+      name: pypi\n+      url: https://test.pypi.org/p/djangocms-attributes_field\n+    permissions:\n+      id-token: write\n     steps:\n     - uses: actions/checkout@v3\n     - name: Set up Python 3.10\n-      uses: actions/setup-python@v4\n+      uses: actions/setup-python@v5\n       with:\n-        python-version: '3.10'\n+        python-version: '3.12'\n \n     - name: Install pypa/build\n       run: >-\n@@ -34,7 +39,5 @@ jobs:\n     - name: Publish distribution \ud83d\udce6 to Test PyPI\n       uses: pypa/gh-action-pypi-publish@release/v1\n       with:\n-        user: __token__\n-        password: ${{ secrets.TEST_PYPI_API_TOKEN }}\n         repository_url: https://test.pypi.org/legacy/\n         skip_existing: true"
            },
            {
                "sha": "739c044a90c00807dcaac481e31102bfb2f16ea5",
                "filename": ".github/workflows/test.yml",
                "status": "modified",
                "additions": 10,
                "deletions": 6,
                "changes": 16,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/.github%2Fworkflows%2Ftest.yml",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/.github%2Fworkflows%2Ftest.yml",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/.github%2Fworkflows%2Ftest.yml?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -8,17 +8,21 @@ jobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        python-version: [ 3.9, \"3.10\", \"3.11\"]  # latest release minus two\n+        python-version: [ \"3.9\", \"3.10\", \"3.11\", \"3.12\"]  # latest release minus two\n         requirements-file: [\n-          dj32_cms311.txt,\n-          dj40_cms311.txt,\n-          dj41_cms311.txt,\n           dj42_cms311.txt,\n-          dj42_cms41.txt\n+          dj42_cms41.txt,\n+          dj50_cms41.txt,\n+          dj51_cms41.txt\n         ]\n         os: [\n           ubuntu-20.04,\n         ]\n+        exclude:\n+            - python-version: \"3.9\"\n+              requirements-file: dj50_cms41.txt\n+            - python-version: \"3.9\"\n+              requirements-file: dj51_cms41.txt\n \n     steps:\n     - uses: actions/checkout@v1\n@@ -34,7 +38,7 @@ jobs:\n         python setup.py install\n \n     - name: Run coverage\n-      run: coverage run setup.py test\n+      run: coverage run tests/settings.py\n \n     - name: Upload Coverage to Codecov\n       uses: codecov/codecov-action@v1"
            },
            {
                "sha": "dbba421c1d567fd6a9c1a40195b9b935866247f2",
                "filename": "CHANGELOG.rst",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/CHANGELOG.rst",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/CHANGELOG.rst",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/CHANGELOG.rst?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -2,6 +2,16 @@\n Changelog\n =========\n \n+4.0.0 (2024-11-19)\n+==================\n+\n+* Moved validation to from AttributeField to AttributeFormField\n+* Added djangocms_attributes_fields.fields.default_excluded_keys to include\n+  keys that can execute javascript\n+* Added tests for Django 5.0, 5.1\n+* Dropped support for Django 3.2, 4.0, 4.1\n+* Dropped support for Python 3.6, 3.7, 3.8\n+\n 3.0.0 (2023-05-24)\n ==================\n "
            },
            {
                "sha": "b322e16fc5ddf3a689837e97984afc8d9ee02dc7",
                "filename": "README.rst",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/README.rst",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/README.rst",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/README.rst?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -91,6 +91,13 @@ There is an optional parameter that can be used when declaring the field: ::\n     ``excluded_keys`` : This is a list of strings that will not be accepted as\n                         valid keys\n \n+Since version 4, the following keys are always excluded (see\n+``djangocms_attributes_fields.fields.default_excluded_keys``) to avoid\n+unwanted execution of javascript: ::\n+\n+    [\"src\", \"href\", \"data\", \"action\", \"on*\"]\n+\n+``'on*'`` represents any key that starts with ``'on'``.\n \n property: [field_name]_str\n ++++++++++++++++++++++++++\n@@ -160,7 +167,7 @@ You can run tests by executing::\n     virtualenv env\n     source env/bin/activate\n     pip install -r tests/requirements.txt\n-    python setup.py test\n+    python tests/settings.py\n \n \n .. |pypi| image:: https://badge.fury.io/py/djangocms-attributes-field.svg"
            },
            {
                "sha": "d6497a814c169fcedb9c339f376d752466f22481",
                "filename": "djangocms_attributes_field/__init__.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/djangocms_attributes_field%2F__init__.py",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/djangocms_attributes_field%2F__init__.py",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/djangocms_attributes_field%2F__init__.py?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -1 +1 @@\n-__version__ = '3.0.0'\n+__version__ = '4.0.0'"
            },
            {
                "sha": "a30b52b80e6de218dcfbf1dba4686fb4532db820",
                "filename": "djangocms_attributes_field/fields.py",
                "status": "modified",
                "additions": 49,
                "deletions": 43,
                "changes": 92,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/djangocms_attributes_field%2Ffields.py",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/djangocms_attributes_field%2Ffields.py",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/djangocms_attributes_field%2Ffields.py?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -14,12 +14,16 @@\n regex_key_validator = RegexValidator(regex=r'^[a-z][-a-z0-9_:]*\\Z',\n                                      flags=re.IGNORECASE, code='invalid')\n \n+default_excluded_keys = [\n+    \"src\", \"href\", \"data\", \"action\", \"on*\",\n+]\n \n class AttributesFormField(forms.CharField):\n     empty_values = [None, '']\n \n     def __init__(self, *args, **kwargs):\n         kwargs.setdefault('widget', AttributesWidget)\n+        self.excluded_keys = kwargs.pop('excluded_keys', []) + default_excluded_keys\n         super().__init__(*args, **kwargs)\n \n     def to_python(self, value):\n@@ -37,6 +41,49 @@ def validate(self, value):\n         # This is required in older django versions.\n         if value in self.empty_values and self.required:\n             raise forms.ValidationError(self.error_messages['required'], code='required')\n+        if isinstance(value, dict):\n+            for key, val in value.items():\n+                self.validate_key(key)\n+                self.validate_value(key, val)\n+\n+    def validate_key(self, key):\n+        \"\"\"\n+        A key must start with a letter, but can otherwise contain letters,\n+        numbers, dashes, colons or underscores. It must not also be part of\n+        `excluded_keys` as configured in the field.\n+\n+        :param key: (str) The key to validate\n+        \"\"\"\n+        # Verify the key is not one of `excluded_keys`.\n+        for excluded_key in self.excluded_keys:\n+            if key.lower() == excluded_key or excluded_key.endswith(\"*\") and key.lower().startswith(excluded_key[:-1]):\n+                raise ValidationError(\n+                    _('\"{key}\" is excluded by configuration and cannot be used as '\n+                      'a key.').format(key=key))\n+        # Also check that it fits our permitted syntax\n+        try:\n+            regex_key_validator(key)\n+        except ValidationError:\n+            # Seems silly to catch one then raise another ValidationError, but\n+            # the RegExValidator doesn't use placeholders in its error message.\n+            raise ValidationError(\n+                _('\"{key}\" is not a valid key. Keys must start with at least '\n+                  'one letter and consist only of the letters, numbers, '\n+                  'underscores or hyphens.').format(key=key))\n+\n+    def validate_value(self, key, value):\n+        \"\"\"\n+        A value can be anything that can be JSON-ified.\n+\n+        :param key: (str) The key of the value\n+        :param value: (str) The value to validate\n+        \"\"\"\n+        try:\n+            json.dumps(value)\n+        except (TypeError, ValueError):\n+            raise ValidationError(\n+                _('The value for the key \"{key}\" is invalid. Please enter a '\n+                  'value that can be represented in JSON.').format(key=key))\n \n \n class AttributesField(models.Field):\n@@ -64,7 +111,7 @@ def __init__(self, *args, **kwargs):\n             kwargs['default'] = kwargs.get('default', dict)\n         excluded_keys = kwargs.pop('excluded_keys', [])\n         # Note we accept uppercase letters in the param, but the comparison\n-        # is not case sensitive. So, we coerce the input to lowercase here.\n+        # is not case-sensitive. So, we coerce the input to lowercase here.\n         self.excluded_keys = [key.lower() for key in excluded_keys]\n         super().__init__(*args, **kwargs)\n         self.validate(self.get_default(), None)\n@@ -75,6 +122,7 @@ def formfield(self, **kwargs):\n             'widget': AttributesWidget\n         }\n         defaults.update(**kwargs)\n+        defaults[\"excluded_keys\"] = self.excluded_keys\n         return super().formfield(**defaults)\n \n     def from_db_value(self, value,\n@@ -134,48 +182,6 @@ def validate(self, value, model_instance):\n         except ValueError:\n             raise ValidationError(self.error_messages['invalid'] % value)\n \n-        for key, val in value.items():\n-            self.validate_key(key)\n-            self.validate_value(key, val)\n-\n-    def validate_key(self, key):\n-        \"\"\"\n-        A key must start with a letter, but can otherwise contain letters,\n-        numbers, dashes, colons or underscores. It must not also be part of\n-        `excluded_keys` as configured in the field.\n-\n-        :param key: (str) The key to validate\n-        \"\"\"\n-        # Verify the key is not one of `excluded_keys`.\n-        if key.lower() in self.excluded_keys:\n-            raise ValidationError(\n-                _('\"{key}\" is excluded by configuration and cannot be used as '\n-                  'a key.').format(key=key))\n-        # Also check that it fits our permitted syntax\n-        try:\n-            regex_key_validator(key)\n-        except ValidationError:\n-            # Seems silly to catch one then raise another ValidationError, but\n-            # the RegExValidator doesn't use placeholders in its error message.\n-            raise ValidationError(\n-                _('\"{key}\" is not a valid key. Keys must start with at least '\n-                  'one letter and consist only of the letters, numbers, '\n-                  'underscores or hyphens.').format(key=key))\n-\n-    def validate_value(self, key, value):\n-        \"\"\"\n-        A value can be anything that can be JSON-ified.\n-\n-        :param key: (str) The key of the value\n-        :param value: (str) The value to validate\n-        \"\"\"\n-        try:\n-            json.dumps(value)\n-        except (TypeError, ValueError):\n-            raise ValidationError(\n-                _('The value for the key \"{key}\" is invalid. Please enter a '\n-                  'value that can be represented in JSON.').format(key=key))\n-\n     def value_to_string(self, obj):\n         return self.value_from_object(obj)\n "
            },
            {
                "sha": "76b64d769b19ddd5c40c074fa6d3c152f8e459e2",
                "filename": "tests/requirements/dj32_cms310.txt",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj32_cms310.txt",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj32_cms310.txt",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/tests%2Frequirements%2Fdj32_cms310.txt?ref=73007ebc59a4386cc1d4057e16a42d59d90525bd",
                "patch": "@@ -1,4 +0,0 @@\n--r base.txt\n-\n-Django>=3.2,<4.0\n-django-cms>=3.10,<3.11"
            },
            {
                "sha": "be39e9b8b83df187e271c48d95b290cbb3f5904d",
                "filename": "tests/requirements/dj32_cms311.txt",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj32_cms311.txt",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj32_cms311.txt",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/tests%2Frequirements%2Fdj32_cms311.txt?ref=73007ebc59a4386cc1d4057e16a42d59d90525bd",
                "patch": "@@ -1,4 +0,0 @@\n--r base.txt\n-\n-Django>=3.2,<4\n-django-cms>=3.11,<4"
            },
            {
                "sha": "e5b970ab67ed2be3465d3276cf6f8e49329f8a59",
                "filename": "tests/requirements/dj32_cms39.txt",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj32_cms39.txt",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj32_cms39.txt",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/tests%2Frequirements%2Fdj32_cms39.txt?ref=73007ebc59a4386cc1d4057e16a42d59d90525bd",
                "patch": "@@ -1,4 +0,0 @@\n--r base.txt\n-\n-Django>=3.2,<4.0\n-django-cms>=3.9,<3.10"
            },
            {
                "sha": "953d7154aa29e8af1eb7a45d6ca85721128924c0",
                "filename": "tests/requirements/dj40_cms311.txt",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj40_cms311.txt",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj40_cms311.txt",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/tests%2Frequirements%2Fdj40_cms311.txt?ref=73007ebc59a4386cc1d4057e16a42d59d90525bd",
                "patch": "@@ -1,4 +0,0 @@\n--r base.txt\n-\n-Django>=4.0,<4.1\n-django-cms>=3.11.1,<4"
            },
            {
                "sha": "e30f0ae50c6de7e9edb5b4ecba902432cf44a579",
                "filename": "tests/requirements/dj41_cms311.txt",
                "status": "removed",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj41_cms311.txt",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/73007ebc59a4386cc1d4057e16a42d59d90525bd/tests%2Frequirements%2Fdj41_cms311.txt",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/tests%2Frequirements%2Fdj41_cms311.txt?ref=73007ebc59a4386cc1d4057e16a42d59d90525bd",
                "patch": "@@ -1,4 +0,0 @@\n--r base.txt\n-\n-Django>=4.1,<4.2\n-django-cms>=3.11.1,<4"
            },
            {
                "sha": "1c578f2c5e60531106b1446e39b6f76e0db84566",
                "filename": "tests/requirements/dj50_cms41.txt",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/tests%2Frequirements%2Fdj50_cms41.txt",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/tests%2Frequirements%2Fdj50_cms41.txt",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/tests%2Frequirements%2Fdj50_cms41.txt?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -0,0 +1,4 @@\n+-r base.txt\n+\n+Django>=5.0,<5.1\n+django-cms>=4.1,<4.2"
            },
            {
                "sha": "3e2807c1c3f3026e0995fbe06b7622f2b367ec82",
                "filename": "tests/requirements/dj51_cms41.txt",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/tests%2Frequirements%2Fdj51_cms41.txt",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/tests%2Frequirements%2Fdj51_cms41.txt",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/tests%2Frequirements%2Fdj51_cms41.txt?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -0,0 +1,4 @@\n+-r base.txt\n+\n+Django>=5.1,<5.2\n+django-cms>=4.1,<4.2"
            },
            {
                "sha": "888041260bab85ad4cde521053460329393432b3",
                "filename": "tests/test_fields.py",
                "status": "modified",
                "additions": 20,
                "deletions": 6,
                "changes": 26,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/tests%2Ftest_fields.py",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/tests%2Ftest_fields.py",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/tests%2Ftest_fields.py?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -15,7 +15,7 @@ class Noop:\n class KeyValidationTests(TestCase):\n \n     def test_validate_key(self):\n-        field = AttributesField()\n+        field = AttributesFormField()\n         # Normal, expected patterns\n         try:\n             field.validate_key('target')\n@@ -48,21 +48,35 @@ def test_validate_key(self):\n \n     def test_excluded_keys(self):\n         # First prove that the keys we're about to test would normally pass\n-        field = AttributesField()\n+        field = AttributesFormField()\n         try:\n-            field.validate_key('href')\n-            field.validate_key('src')\n+\n+            field.validate_key('title')\n+            field.validate_key('data-test')\n         except ValidationError:\n             self.fail('Keys that pass have failed.')\n \n         # Now show that they no longer pass if explicitly exclude\n-        field = AttributesField(excluded_keys=['href', 'src', ])\n+        field = AttributesFormField(excluded_keys=['title', 'data-test', ])\n \n         with self.assertRaises(ValidationError):\n-            field.validate_key('href')\n+            field.validate_key('title')\n         with self.assertRaises(ValidationError):\n             field.validate_key('src')\n \n+    def test_default_excluded_keys(self):\n+        from djangocms_attributes_field.fields import default_excluded_keys\n+\n+        field = AttributesFormField()\n+        for key in default_excluded_keys:\n+            with self.subTest(key=key):\n+                with self.assertRaises(ValidationError):\n+                    field.validate_key(key)\n+\n+        with self.subTest(key=\"onsomething\"):\n+            with self.assertRaises(ValidationError):\n+                field.validate_key(key)\n+\n \n class AttributesFieldsTestCase(TestCase):\n "
            },
            {
                "sha": "1ebcf1c3073b5039ae8515f790d27b0f95029ca5",
                "filename": "tox.ini",
                "status": "modified",
                "additions": 8,
                "deletions": 11,
                "changes": 19,
                "blob_url": "https://github.com/django-cms/djangocms-attributes-field/blob/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/tox.ini",
                "raw_url": "https://github.com/django-cms/djangocms-attributes-field/raw/fe68d29ab78db5885bc31b67cf0537f1f02b33ad/tox.ini",
                "contents_url": "https://api.github.com/repos/django-cms/djangocms-attributes-field/contents/tox.ini?ref=fe68d29ab78db5885bc31b67cf0537f1f02b33ad",
                "patch": "@@ -1,10 +1,7 @@\n [tox]\n envlist =\n-    flake8\n-    isort\n-    py{35,36,37,38}-dj{22}-cms{37,38}\n-    py{36,37,38}-dj{30}-cms{37,38}\n-    py{36,37,38}-dj{31}-cms{38}\n+    py{39,310,311}-dj{42}-cms{311,41}\n+    py{310,311,312}-dj{50,51}-cms{41}\n \n skip_missing_interpreters=True\n \n@@ -40,15 +37,15 @@ known_django = django\n [testenv]\n deps =\n     -r{toxinidir}/tests/requirements/base.txt\n-    dj22: Django>=2.2,<3.0\n-    dj30: Django>=3.0,<3.1\n-    dj31: Django>=3.1,<3.2\n-    cms37: django-cms>=3.7,<3.8\n-    cms38: django-cms>=3.8,<3.9\n+    dj42: Django>=4.2,<5.0\n+    dj50: Django>=5.0,<5.1\n+    dj51: Django>=5.1,<5.2\n+    cms311: django-cms>=3.11,<4\n+    cms41: django-cms>=4.1,<4.2\n commands =\n     {envpython} --version\n     {env:COMMAND:coverage} erase\n-    {env:COMMAND:coverage} run setup.py test\n+    {env:COMMAND:coverage} run tests/settings.py\n     {env:COMMAND:coverage} report\n \n [testenv:flake8]"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/django-cms/django-filer/commits/f8209a6507680661bd134cd30878993b79ef3344",
        "url": "https://api.github.com/repos/django-cms/django-filer/commits/f8209a6507680661bd134cd30878993b79ef3344",
        "html_url": "https://github.com/django-cms/django-filer/commit/f8209a6507680661bd134cd30878993b79ef3344",
        "message": "fix: Restrict upload of binary or unknown file types by default (#1507)\n\n* Fix #1377\r\n\r\n* Bump to 3.2.0\r\n\r\n* fix: Deny upload of binary or unknown file types\r\n\r\n* Update tests\r\n\r\n* Update validation.rst\r\n\r\n* Update docs/validation.rst\r\n\r\nCo-authored-by: sourcery-ai[bot] <58596630+sourcery-ai[bot]@users.noreply.github.com>\r\n\r\n* Add test that binary uploads fail by default\r\n\r\n* Add migration info\r\n\r\n---------\r\n\r\nCo-authored-by: sourcery-ai[bot] <58596630+sourcery-ai[bot]@users.noreply.github.com>",
        "files": [
            {
                "sha": "e2fc56391a5d15f36955fa5e0acf8e17cf493959",
                "filename": "CHANGELOG.rst",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/django-cms/django-filer/blob/f8209a6507680661bd134cd30878993b79ef3344/CHANGELOG.rst",
                "raw_url": "https://github.com/django-cms/django-filer/raw/f8209a6507680661bd134cd30878993b79ef3344/CHANGELOG.rst",
                "contents_url": "https://api.github.com/repos/django-cms/django-filer/contents/CHANGELOG.rst?ref=f8209a6507680661bd134cd30878993b79ef3344",
                "patch": "@@ -754,7 +754,7 @@ CHANGELOG\n \n \n 0.5.4a1\n-=======\n+========\n \n * Adds description field.\n "
            },
            {
                "sha": "c00a44c17e4e5dac0ba2e30b95d14eed0b89f160",
                "filename": "README.rst",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/django-cms/django-filer/blob/f8209a6507680661bd134cd30878993b79ef3344/README.rst",
                "raw_url": "https://github.com/django-cms/django-filer/raw/f8209a6507680661bd134cd30878993b79ef3344/README.rst",
                "contents_url": "https://api.github.com/repos/django-cms/django-filer/contents/README.rst?ref=f8209a6507680661bd134cd30878993b79ef3344",
                "patch": "@@ -49,6 +49,26 @@ Documentation\n Please head over to the separate `documentation <https://django-filer.readthedocs.io/en/latest/index.html>`_\n for all the details on how to install, configure and use django-filer.\n \n+Upgrading\n+=========\n+\n+Version 3.3\n+-----------\n+\n+django-filer version 3 contains a change in security policy for file uploads.\n+**By default, binary file or files of unknown type are not allowed to be uploaded.**\n+To allow upload of binary files in your project, add\n+\n+.. code-block:: python\n+\n+    FILER_REMOVE_FILE_VALIDATORS = [\n+        \"application/octet-stream\",\n+    ]\n+\n+to your project's settings. Be aware that binary files always are a security risk.\n+See the documentation for more information on how to configure file upload validators,\n+e.g., running files through a virus checker.\n+\n \n .. |pypi| image:: https://badge.fury.io/py/django-filer.svg\n     :target: http://badge.fury.io/py/django-filer"
            },
            {
                "sha": "3d43cde4893337a3ee9f05419f734de059b318a1",
                "filename": "docs/validation.rst",
                "status": "modified",
                "additions": 43,
                "deletions": 5,
                "changes": 48,
                "blob_url": "https://github.com/django-cms/django-filer/blob/f8209a6507680661bd134cd30878993b79ef3344/docs%2Fvalidation.rst",
                "raw_url": "https://github.com/django-cms/django-filer/raw/f8209a6507680661bd134cd30878993b79ef3344/docs%2Fvalidation.rst",
                "contents_url": "https://api.github.com/repos/django-cms/django-filer/contents/docs%2Fvalidation.rst?ref=f8209a6507680661bd134cd30878993b79ef3344",
                "patch": "@@ -54,9 +54,9 @@ files with the mime type ``image/svg+xml``. Those files are dangerous since\n they are executed by a browser without any warnings.\n \n Validation hooks do not restrict the upload of other executable files\n-(like ``*.exe`` or shell scripts). Those are not automatically executed\n+(like ``*.exe`` or shell scripts). **Those are not automatically executed\n by the browser but still present a point of attack, if a user saves them\n-to disk and executes them locally.\n+to disk and executes them locally.**\n \n You can release validation restrictions by setting\n ``FILER_REMOVE_FILE_VALIDATORS`` to a list of mime types to be removed from\n@@ -111,7 +111,7 @@ This just rejects any file for upload. By default this happens for HTML files\n \n This validator rejects any SVG file that contains the bytes ``<script`` or\n ``javascript:``. This probably is a too strict criteria, since those bytes\n-might be part of a legitimate say string. The above code is a simplification\n+might be part of a legitimate string. The above code is a simplification\n the actual code also checks for occurrences of event attribute like\n ``onclick=\"...\"``.\n \n@@ -144,10 +144,11 @@ a malicious file unknowingly.\n     FILER_REMOVE_FILE_VALIDATORS = [\n         \"text/html\",\n         \"image/svg+xml\",\n+        \"application/octet-stream\",\n     ]\n \n-No HTML upload and restricted SVG upload\n-........................................\n+No HTML upload and restricted SVG upload, no binary or unknown file upload\n+...........................................................................\n \n This is the default setting. It will deny any SVG file that might contain\n Javascript. It is prone to false positives (i.e. files being rejected that\n@@ -176,6 +177,8 @@ in the user's browser.\n         \"image/svg+xml\": [\"filer.validation.deny\"],\n     }\n \n+(Still not binary or unknown file upload)\n+\n Experimental SVG sanitization\n .............................\n \n@@ -259,3 +262,38 @@ You can use it to distinguish validation for certain user groups if needed.\n \n If you distinguish validation by the mime type, remember to register the\n validator function for all relevant mime types.\n+\n+\n+Checking uploads for viruses using ClamAV\n+-----------------------------------------\n+\n+If you have ClamAV installed and use `django-clamd <https://github.com/vstoykov/django-clamd>`_\n+you can add a validator that checks for viruses in uploaded files.\n+\n+.. code-block:: python\n+\n+    FILER_REMOVE_FILE_VALIDATORS = [\"application/octet-stream\"]\n+    FILER_ADD_FILE_VALIDATORS = {\n+        \"application/octet-stream\": [\"my_validator_app.validators.validate_octet_stream\"],\n+    }\n+\n+\n+.. code-block:: python\n+\n+    def validate_octet_stream(file_name: str, file: typing.IO, owner: User, mime_type: str) -> None:\n+        \"\"\"Octet streams are binary files without a specific mime type. They are run through\n+        a virus check.\"\"\"\n+        try:\n+            from django_clamd.validators import validate_file_infection\n+\n+            validate_file_infection(file)\n+        except (ModuleNotFoundError, ImportError):\n+            raise FileValidationError(\n+                _('File \"{file_name}\": Virus check for binary/unknown file not available').format(file_name=file_name)\n+            )\n+\n+.. note::\n+\n+    Virus-checked files still might contain executable code. While the code is not\n+    executed by the browser, a user might still download the file and execute it\n+    manually."
            },
            {
                "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
                "filename": "filer/contrib/clamav/__init__.py",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/django-cms/django-filer/blob/f8209a6507680661bd134cd30878993b79ef3344/filer%2Fcontrib%2Fclamav%2F__init__.py",
                "raw_url": "https://github.com/django-cms/django-filer/raw/f8209a6507680661bd134cd30878993b79ef3344/filer%2Fcontrib%2Fclamav%2F__init__.py",
                "contents_url": "https://api.github.com/repos/django-cms/django-filer/contents/filer%2Fcontrib%2Fclamav%2F__init__.py?ref=f8209a6507680661bd134cd30878993b79ef3344"
            },
            {
                "sha": "d6ec392b1f308bae699f52bc31ed60c078858329",
                "filename": "filer/settings.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/django-cms/django-filer/blob/f8209a6507680661bd134cd30878993b79ef3344/filer%2Fsettings.py",
                "raw_url": "https://github.com/django-cms/django-filer/raw/f8209a6507680661bd134cd30878993b79ef3344/filer%2Fsettings.py",
                "contents_url": "https://api.github.com/repos/django-cms/django-filer/contents/filer%2Fsettings.py?ref=f8209a6507680661bd134cd30878993b79ef3344",
                "patch": "@@ -292,6 +292,7 @@ def update_server_settings(settings, defaults, s, t):\n FILE_VALIDATORS = {\n     \"text/html\": [\"filer.validation.deny_html\"],\n     \"image/svg+xml\": [\"filer.validation.validate_svg\"],\n+    \"application/octet-stream\": [\"filer.validation.deny\"],\n }\n \n remove_mime_types = getattr(settings, \"FILER_REMOVE_FILE_VALIDATORS\", [])"
            },
            {
                "sha": "b10fb49db7de47ed4428cc045aab7b2a7158f7b3",
                "filename": "tests/test_admin.py",
                "status": "modified",
                "additions": 22,
                "deletions": 0,
                "changes": 22,
                "blob_url": "https://github.com/django-cms/django-filer/blob/f8209a6507680661bd134cd30878993b79ef3344/tests%2Ftest_admin.py",
                "raw_url": "https://github.com/django-cms/django-filer/raw/f8209a6507680661bd134cd30878993b79ef3344/tests%2Ftest_admin.py",
                "contents_url": "https://api.github.com/repos/django-cms/django-filer/contents/tests%2Ftest_admin.py?ref=f8209a6507680661bd134cd30878993b79ef3344",
                "patch": "@@ -3,6 +3,7 @@\n \n import django\n import django.core.files\n+from django.apps import apps\n from django.conf import settings\n from django.contrib import admin\n from django.contrib.admin import helpers\n@@ -484,6 +485,10 @@ def test_filer_upload_file_no_folder(self, extra_headers={}):\n             self.assertEqual(stored_image.mime_type, 'image/jpeg')\n \n     def test_filer_upload_binary_data(self, extra_headers={}):\n+        config = apps.get_app_config(\"filer\")\n+\n+        validators = config.FILE_VALIDATORS  # Remember the validators\n+        config.FILE_VALIDATORS = {}  # Remove deny for application/octet-stream\n         self.assertEqual(File.objects.count(), 0)\n         with open(self.binary_filename, 'rb') as fh:\n             file_obj = django.core.files.File(fh)\n@@ -494,12 +499,29 @@ def test_filer_upload_binary_data(self, extra_headers={}):\n                 'jsessionid': self.client.session.session_key\n             }\n             self.client.post(url, post_data, **extra_headers)\n+            config.FILE_VALIDATORS = validators  # Reset validators\n+\n             self.assertEqual(Image.objects.count(), 0)\n             self.assertEqual(File.objects.count(), 1)\n             stored_file = File.objects.first()\n             self.assertEqual(stored_file.original_filename, self.binary_name)\n             self.assertEqual(stored_file.mime_type, 'application/octet-stream')\n \n+    def test_filer_upload_binary_data_fails_by_default(self, extra_headers={}):\n+        self.assertEqual(File.objects.count(), 0)\n+        with open(self.binary_filename, 'rb') as fh:\n+            file_obj = django.core.files.File(fh)\n+            url = reverse('admin:filer-ajax_upload')\n+            post_data = {\n+                'Filename': self.binary_name,\n+                'Filedata': file_obj,\n+                'jsessionid': self.client.session.session_key\n+            }\n+            self.client.post(url, post_data, **extra_headers)\n+\n+            self.assertEqual(Image.objects.count(), 0)\n+            self.assertEqual(File.objects.count(), 0)\n+\n     def test_filer_ajax_upload_file(self):\n         self.assertEqual(Image.objects.count(), 0)\n         folder = Folder.objects.create(name='foo')"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moodle/moodle/commits/07ad4b8ebc715056056e01f2175820bfce6b290f",
        "url": "https://api.github.com/repos/moodle/moodle/commits/07ad4b8ebc715056056e01f2175820bfce6b290f",
        "html_url": "https://github.com/moodle/moodle/commit/07ad4b8ebc715056056e01f2175820bfce6b290f",
        "message": "MDL-83179 badges: Get type and courseid from context instead of params",
        "files": [
            {
                "sha": "0f42cd53ecd5b668cb44099d5882f1906586f8a5",
                "filename": "badges/classes/reportbuilder/local/systemreports/course_badges.php",
                "status": "modified",
                "additions": 15,
                "deletions": 6,
                "changes": 21,
                "blob_url": "https://github.com/moodle/moodle/blob/07ad4b8ebc715056056e01f2175820bfce6b290f/badges%2Fclasses%2Freportbuilder%2Flocal%2Fsystemreports%2Fcourse_badges.php",
                "raw_url": "https://github.com/moodle/moodle/raw/07ad4b8ebc715056056e01f2175820bfce6b290f/badges%2Fclasses%2Freportbuilder%2Flocal%2Fsystemreports%2Fcourse_badges.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/badges%2Fclasses%2Freportbuilder%2Flocal%2Fsystemreports%2Fcourse_badges.php?ref=07ad4b8ebc715056056e01f2175820bfce6b290f",
                "patch": "@@ -18,8 +18,10 @@\n \n namespace core_badges\\reportbuilder\\local\\systemreports;\n \n+use core\\context\\system;\n use core_badges\\reportbuilder\\local\\entities\\badge;\n use core_badges\\reportbuilder\\local\\entities\\badge_issued;\n+use core_reportbuilder\\local\\helpers\\database;\n use core_reportbuilder\\system_report;\n use lang_string;\n use moodle_url;\n@@ -58,12 +60,19 @@ protected function initialise(): void {\n         $this->set_main_table('badge', $entityalias);\n         $this->add_entity($badgeentity);\n \n-        $type = $this->get_parameter('type', 0, PARAM_INT);\n-        $courseid = $this->get_parameter('courseid', 0, PARAM_INT);\n-\n-        $this->add_base_condition_simple('type', $type);\n-        $this->add_base_condition_simple('courseid', $courseid);\n-        $this->add_base_condition_sql(\"({$entityalias}.status = \" . BADGE_STATUS_ACTIVE .\n+        $paramtype = database::generate_param_name();\n+        $context = $this->get_context();\n+        if ($context instanceof system) {\n+            $type = BADGE_TYPE_SITE;\n+            $this->add_base_condition_sql(\"{$entityalias}.type = :$paramtype\", [$paramtype => $type]);\n+        } else {\n+            $type = BADGE_TYPE_COURSE;\n+            $paramcourseid = database::generate_param_name();\n+            $this->add_base_condition_sql(\"{$entityalias}.type = :$paramtype AND {$entityalias}.courseid = :$paramcourseid\",\n+                [$paramtype => $type, $paramcourseid => $context->instanceid]);\n+        }\n+\n+         $this->add_base_condition_sql(\"({$entityalias}.status = \" . BADGE_STATUS_ACTIVE .\n             \" OR {$entityalias}.status = \" . BADGE_STATUS_ACTIVE_LOCKED . \")\");\n \n         $badgeissuedentity = new badge_issued();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moodle/moodle/commits/3fc1073d304f660d2552b591c5fb92547ed01e92",
        "url": "https://api.github.com/repos/moodle/moodle/commits/3fc1073d304f660d2552b591c5fb92547ed01e92",
        "html_url": "https://github.com/moodle/moodle/commit/3fc1073d304f660d2552b591c5fb92547ed01e92",
        "message": "MDL-82365 mod_lesson: stricter equality checks of activity password.",
        "files": [
            {
                "sha": "1f0ae12095bdb9ed63b94f4d9cb5d07d579bf133",
                "filename": "mod/lesson/locallib.php",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/moodle/moodle/blob/3fc1073d304f660d2552b591c5fb92547ed01e92/mod%2Flesson%2Flocallib.php",
                "raw_url": "https://github.com/moodle/moodle/raw/3fc1073d304f660d2552b591c5fb92547ed01e92/mod%2Flesson%2Flocallib.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/mod%2Flesson%2Flocallib.php?ref=3fc1073d304f660d2552b591c5fb92547ed01e92",
                "patch": "@@ -2864,15 +2864,17 @@ public function get_password_restriction_status($userpassword) {\n \n         if ($this->properties->usepassword && empty($USER->lessonloggedin[$this->id])) {\n             $correctpass = false;\n-            if (!empty($userpassword) &&\n-                    (($this->properties->password == md5(trim($userpassword))) || ($this->properties->password == trim($userpassword)))) {\n+\n+            $userpassword = trim((string) $userpassword);\n+            if ($userpassword !== '' &&\n+                    ($this->properties->password === md5($userpassword) || $this->properties->password === $userpassword)) {\n                 // With or without md5 for backward compatibility (MDL-11090).\n                 $correctpass = true;\n                 $USER->lessonloggedin[$this->id] = true;\n             } else if (isset($this->properties->extrapasswords)) {\n                 // Group overrides may have additional passwords.\n                 foreach ($this->properties->extrapasswords as $password) {\n-                    if (strcmp($password, md5(trim($userpassword))) === 0 || strcmp($password, trim($userpassword)) === 0) {\n+                    if ($password === md5($userpassword) || $password === $userpassword) {\n                         $correctpass = true;\n                         $USER->lessonloggedin[$this->id] = true;\n                     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moodle/moodle/commits/809629e5afcd5be087e65668fe6cf67f2f4f5145",
        "url": "https://api.github.com/repos/moodle/moodle/commits/809629e5afcd5be087e65668fe6cf67f2f4f5145",
        "html_url": "https://github.com/moodle/moodle/commit/809629e5afcd5be087e65668fe6cf67f2f4f5145",
        "message": "MDL-76962 auth_oauth2: users can only delete their own linked logins.",
        "files": [
            {
                "sha": "5bf053cfcf5408b843c59b677e75b39df0f6afcb",
                "filename": "auth/oauth2/classes/api.php",
                "status": "modified",
                "additions": 9,
                "deletions": 4,
                "changes": 13,
                "blob_url": "https://github.com/moodle/moodle/blob/809629e5afcd5be087e65668fe6cf67f2f4f5145/auth%2Foauth2%2Fclasses%2Fapi.php",
                "raw_url": "https://github.com/moodle/moodle/raw/809629e5afcd5be087e65668fe6cf67f2f4f5145/auth%2Foauth2%2Fclasses%2Fapi.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/auth%2Foauth2%2Fclasses%2Fapi.php?ref=809629e5afcd5be087e65668fe6cf67f2f4f5145",
                "patch": "@@ -351,22 +351,27 @@ public static function send_confirm_account_email($userinfo, $issuer) {\n     }\n \n     /**\n-     * Delete linked login\n+     * Delete a users own linked login\n      *\n      * Requires auth/oauth2:managelinkedlogins capability at the user context.\n      *\n      * @param int $linkedloginid\n      * @return boolean\n      */\n     public static function delete_linked_login($linkedloginid) {\n-        $login = new linked_login($linkedloginid);\n-        $userid = $login->get('userid');\n+        global $USER;\n \n         if (\\core\\session\\manager::is_loggedinas()) {\n             throw new moodle_exception('notwhileloggedinas', 'auth_oauth2');\n         }\n \n-        $context = context_user::instance($userid);\n+        $login = linked_login::get_record([\n+            'id' => $linkedloginid,\n+            'userid' => $USER->id,\n+            'confirmtoken' => '',\n+        ], MUST_EXIST);\n+\n+        $context = context_user::instance($login->get('userid'));\n         require_capability('auth/oauth2:managelinkedlogins', $context);\n \n         $login->delete();"
            },
            {
                "sha": "abf1ba626e2f3fb50990ec1f3a60a8d275531b2e",
                "filename": "auth/oauth2/tests/api_test.php",
                "status": "modified",
                "additions": 25,
                "deletions": 0,
                "changes": 25,
                "blob_url": "https://github.com/moodle/moodle/blob/809629e5afcd5be087e65668fe6cf67f2f4f5145/auth%2Foauth2%2Ftests%2Fapi_test.php",
                "raw_url": "https://github.com/moodle/moodle/raw/809629e5afcd5be087e65668fe6cf67f2f4f5145/auth%2Foauth2%2Ftests%2Fapi_test.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/auth%2Foauth2%2Ftests%2Fapi_test.php?ref=809629e5afcd5be087e65668fe6cf67f2f4f5145",
                "patch": "@@ -139,6 +139,7 @@ public function test_linked_logins(): void {\n         $issuer = \\core\\oauth2\\api::create_standard_issuer('google');\n \n         $user = $this->getDataGenerator()->create_user();\n+        $this->setUser($user);\n \n         $info = [];\n         $info['username'] = 'banana';\n@@ -171,6 +172,30 @@ public function test_linked_logins(): void {\n         $this->assertEquals($newuser->id, $match->get('userid'));\n     }\n \n+    /**\n+     * Test that we cannot deleted a linked login for another user\n+     */\n+    public function test_delete_linked_login_other_user(): void {\n+        $this->resetAfterTest();\n+\n+        $this->setAdminUser();\n+        $issuer = \\core\\oauth2\\api::create_standard_issuer('google');\n+\n+        $user = $this->getDataGenerator()->create_user();\n+\n+        api::link_login([\n+            'username' => 'banana',\n+            'email' => 'banana@example.com',\n+        ], $issuer, $user->id);\n+\n+        /** @var linked_login $linkedlogin */\n+        $linkedlogin = api::get_linked_logins($user->id)[0];\n+\n+        // We are logged in as a different user, so cannot delete this.\n+        $this->expectException(\\dml_missing_record_exception::class);\n+        api::delete_linked_login($linkedlogin->get('id'));\n+    }\n+\n     /**\n      * Test that is_enabled correctly identifies when the plugin is enabled.\n      */"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moodle/moodle/commits/bb466df202a4b4a692006298f93cbba20566949c",
        "url": "https://api.github.com/repos/moodle/moodle/commits/bb466df202a4b4a692006298f93cbba20566949c",
        "html_url": "https://github.com/moodle/moodle/commit/bb466df202a4b4a692006298f93cbba20566949c",
        "message": "MDL-82567 core: Add has_capability method\n\nCo-authored-by: David Woloszyn <david.woloszyn@moodle.com>\nCo-authored-by: Jun Pataleta <jun@moodle.com>",
        "files": [
            {
                "sha": "5f35274750a912f43da84d3fe5e30c5d262ec94c",
                "filename": ".upgradenotes/MDL-82567-2024080804140215.yml",
                "status": "added",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/moodle/moodle/blob/bb466df202a4b4a692006298f93cbba20566949c/.upgradenotes%2FMDL-82567-2024080804140215.yml",
                "raw_url": "https://github.com/moodle/moodle/raw/bb466df202a4b4a692006298f93cbba20566949c/.upgradenotes%2FMDL-82567-2024080804140215.yml",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/.upgradenotes%2FMDL-82567-2024080804140215.yml?ref=bb466df202a4b4a692006298f93cbba20566949c",
                "patch": "@@ -0,0 +1,9 @@\n+issueNumber: MDL-82567\n+notes:\n+  core_table:\n+    - message: >-\n+        `core_table\\dynamic` declares a new method `::has_capability()` to\n+        allow classes implementing this interface to perform access checks\n+        on the dynamic table. This is a breaking change that all dynamic table\n+        implementations must implement for continued functionality.\n+      type: changed"
            },
            {
                "sha": "6b143ae7d3512c891f7954d52023bdc19aec0e69",
                "filename": "admin/classes/table/plugin_management_table.php",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/moodle/moodle/blob/bb466df202a4b4a692006298f93cbba20566949c/admin%2Fclasses%2Ftable%2Fplugin_management_table.php",
                "raw_url": "https://github.com/moodle/moodle/raw/bb466df202a4b4a692006298f93cbba20566949c/admin%2Fclasses%2Ftable%2Fplugin_management_table.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/admin%2Fclasses%2Ftable%2Fplugin_management_table.php?ref=bb466df202a4b4a692006298f93cbba20566949c",
                "patch": "@@ -501,4 +501,15 @@ protected function supports_disabling(): bool {\n     protected function supports_ordering(): bool {\n         return $this->plugininfoclass::plugintype_supports_ordering();\n     }\n+\n+    /**\n+     * Check if the user has the capability to access this table.\n+     *\n+     * Default implementation for plugin management tables is to require 'moodle/site:config' capability\n+     *\n+     * @return bool Return true if capability check passed.\n+     */\n+    public function has_capability(): bool {\n+        return has_capability('moodle/site:config', $this->get_context());\n+    }\n }"
            },
            {
                "sha": "285e0aae4c22cf5fb2bd6906f0f8a628e0b09b55",
                "filename": "lib/table/classes/dynamic.php",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/moodle/moodle/blob/bb466df202a4b4a692006298f93cbba20566949c/lib%2Ftable%2Fclasses%2Fdynamic.php",
                "raw_url": "https://github.com/moodle/moodle/raw/bb466df202a4b4a692006298f93cbba20566949c/lib%2Ftable%2Fclasses%2Fdynamic.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/lib%2Ftable%2Fclasses%2Fdynamic.php?ref=bb466df202a4b4a692006298f93cbba20566949c",
                "patch": "@@ -41,4 +41,11 @@\n  * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n  */\n interface dynamic {\n+\n+    /**\n+     * Check capability for users accessing the dynamic table.\n+     *\n+     * @return bool\n+     */\n+    public function has_capability(): bool;\n }"
            },
            {
                "sha": "3d42631a667a8203f3f6020d296d09da363c8432",
                "filename": "lib/table/classes/external/dynamic/get.php",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/moodle/moodle/blob/bb466df202a4b4a692006298f93cbba20566949c/lib%2Ftable%2Fclasses%2Fexternal%2Fdynamic%2Fget.php",
                "raw_url": "https://github.com/moodle/moodle/raw/bb466df202a4b4a692006298f93cbba20566949c/lib%2Ftable%2Fclasses%2Fexternal%2Fdynamic%2Fget.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/lib%2Ftable%2Fclasses%2Fexternal%2Fdynamic%2Fget.php?ref=bb466df202a4b4a692006298f93cbba20566949c",
                "patch": "@@ -224,9 +224,13 @@ public static function execute(\n             );\n         }\n \n+        /** @var \\core_table\\dynamic $instance */\n         $instance = new $tableclass($uniqueid);\n         $instance->set_filterset($filterset);\n         self::validate_context($instance->get_context());\n+        if (!$instance->has_capability()) {\n+            throw new \\moodle_exception('nopermissiontoaccesspage');\n+        }\n \n         $instance->set_sortdata($sortdata);\n         $alphabet = get_string('alphabet', 'langconfig');"
            },
            {
                "sha": "9ac51c8395f1df083fa4f2f53af7a7cf9e75cfea",
                "filename": "reportbuilder/classes/table/custom_report_table.php",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/moodle/moodle/blob/bb466df202a4b4a692006298f93cbba20566949c/reportbuilder%2Fclasses%2Ftable%2Fcustom_report_table.php",
                "raw_url": "https://github.com/moodle/moodle/raw/bb466df202a4b4a692006298f93cbba20566949c/reportbuilder%2Fclasses%2Ftable%2Fcustom_report_table.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/reportbuilder%2Fclasses%2Ftable%2Fcustom_report_table.php?ref=bb466df202a4b4a692006298f93cbba20566949c",
                "patch": "@@ -389,4 +389,13 @@ private static function show_live_editing(): bool {\n \n         return !empty($CFG->customreportsliveediting);\n     }\n+\n+    /**\n+     * Check if the user has the capability to access this table.\n+     *\n+     * @return bool Return true if capability check passed.\n+     */\n+    public function has_capability(): bool {\n+        return \\core_reportbuilder\\permission::can_edit_report($this->persistent);\n+    }\n }"
            },
            {
                "sha": "0533aa4b006641ca04a1e8b74a19842b26745acb",
                "filename": "reportbuilder/classes/table/custom_report_table_view.php",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/moodle/moodle/blob/bb466df202a4b4a692006298f93cbba20566949c/reportbuilder%2Fclasses%2Ftable%2Fcustom_report_table_view.php",
                "raw_url": "https://github.com/moodle/moodle/raw/bb466df202a4b4a692006298f93cbba20566949c/reportbuilder%2Fclasses%2Ftable%2Fcustom_report_table_view.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/reportbuilder%2Fclasses%2Ftable%2Fcustom_report_table_view.php?ref=bb466df202a4b4a692006298f93cbba20566949c",
                "patch": "@@ -74,4 +74,13 @@ public function download_buttons(): string {\n \n         return '';\n     }\n+\n+    /**\n+     * Check if the user has the capability to access this table.\n+     *\n+     * @return bool Return true if capability check passed.\n+     */\n+    public function has_capability(): bool {\n+        return \\core_reportbuilder\\permission::can_view_report($this->persistent);\n+    }\n }"
            },
            {
                "sha": "a05e4ff1c2e9215d5340df07ab3f36eb7b12c40e",
                "filename": "reportbuilder/classes/table/system_report_table.php",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/moodle/moodle/blob/bb466df202a4b4a692006298f93cbba20566949c/reportbuilder%2Fclasses%2Ftable%2Fsystem_report_table.php",
                "raw_url": "https://github.com/moodle/moodle/raw/bb466df202a4b4a692006298f93cbba20566949c/reportbuilder%2Fclasses%2Ftable%2Fsystem_report_table.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/reportbuilder%2Fclasses%2Ftable%2Fsystem_report_table.php?ref=bb466df202a4b4a692006298f93cbba20566949c",
                "patch": "@@ -316,4 +316,18 @@ public function download_buttons(): string {\n \n         return '';\n     }\n+\n+    /**\n+     * Check if the user has the capability to access this table.\n+     *\n+     * @return bool Return true if capability check passed.\n+     */\n+    public function has_capability(): bool {\n+        try {\n+            $this->report->require_can_view();\n+            return true;\n+        } catch (\\core_reportbuilder\\exception\\report_access_exception $e) {\n+            return false;\n+        }\n+    }\n }"
            },
            {
                "sha": "ef132ada1fe3eae61d013ce171f8906424bef2d5",
                "filename": "user/classes/table/participants.php",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/moodle/moodle/blob/bb466df202a4b4a692006298f93cbba20566949c/user%2Fclasses%2Ftable%2Fparticipants.php",
                "raw_url": "https://github.com/moodle/moodle/raw/bb466df202a4b4a692006298f93cbba20566949c/user%2Fclasses%2Ftable%2Fparticipants.php",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/user%2Fclasses%2Ftable%2Fparticipants.php?ref=bb466df202a4b4a692006298f93cbba20566949c",
                "patch": "@@ -481,4 +481,17 @@ public function guess_base_url(): void {\n     public function get_context(): context {\n         return $this->context;\n     }\n+\n+    /**\n+     * Check if the user has the capability to access this table.\n+     *\n+     * @return bool Return true if capability check passed.\n+     */\n+    public function has_capability(): bool {\n+        global $CFG;\n+        require_once($CFG->dirroot . '/course/lib.php');\n+\n+        $context = $this->course->id == SITEID ? \\context_system::instance() : $this->get_context();\n+        return course_can_view_participants($context);\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/fedora-python/lxml_html_clean/commits/c5d816f86eb3707d72a8ecf5f3823e0daa1b3808",
        "url": "https://api.github.com/repos/fedora-python/lxml_html_clean/commits/c5d816f86eb3707d72a8ecf5f3823e0daa1b3808",
        "html_url": "https://github.com/fedora-python/lxml_html_clean/commit/c5d816f86eb3707d72a8ecf5f3823e0daa1b3808",
        "message": "Scan for JS code also in CSS comments\n\nThe `Cleaner()` now scans for hidden JavaScript code embedded\nwithin CSS comments. In certain contexts, such as within `<svg>`\nor `<math>` tags, `<style>` tags may lose their intended function,\nallowing comments like `/* foo */` to potentially be executed by\nthe browser.",
        "files": [
            {
                "sha": "36205e97a0530d08178db797f74af475cdbdf60f",
                "filename": "lxml_html_clean/clean.py",
                "status": "modified",
                "additions": 19,
                "deletions": 14,
                "changes": 33,
                "blob_url": "https://github.com/fedora-python/lxml_html_clean/blob/c5d816f86eb3707d72a8ecf5f3823e0daa1b3808/lxml_html_clean%2Fclean.py",
                "raw_url": "https://github.com/fedora-python/lxml_html_clean/raw/c5d816f86eb3707d72a8ecf5f3823e0daa1b3808/lxml_html_clean%2Fclean.py",
                "contents_url": "https://api.github.com/repos/fedora-python/lxml_html_clean/contents/lxml_html_clean%2Fclean.py?ref=c5d816f86eb3707d72a8ecf5f3823e0daa1b3808",
                "patch": "@@ -581,22 +581,27 @@ def _has_sneaky_javascript(self, style):\n         that and remove only the Javascript from the style; this catches\n         more sneaky attempts.\n         \"\"\"\n-        style = self._substitute_comments('', style)\n-        style = style.replace('\\\\', '')\n         style = _substitute_whitespace('', style)\n         style = style.lower()\n-        if _has_javascript_scheme(style):\n-            return True\n-        if 'expression(' in style:\n-            return True\n-        if '@import' in style:\n-            return True\n-        if '</noscript' in style:\n-            # e.g. '<noscript><style><a title=\"</noscript><img src=x onerror=alert(1)>\">'\n-            return True\n-        if _looks_like_tag_content(style):\n-            # e.g. '<math><style><img src=x onerror=alert(1)></style></math>'\n-            return True\n+\n+        for with_comments in True, False:\n+            if not with_comments:\n+                style = self._substitute_comments('', style)\n+\n+            style = style.replace('\\\\', '')\n+\n+            if _has_javascript_scheme(style):\n+                return True\n+            if 'expression(' in style:\n+                return True\n+            if '@import' in style:\n+                return True\n+            if '</noscript' in style:\n+                # e.g. '<noscript><style><a title=\"</noscript><img src=x onerror=alert(1)>\">'\n+                return True\n+            if _looks_like_tag_content(style):\n+                # e.g. '<math><style><img src=x onerror=alert(1)></style></math>'\n+                return True\n         return False\n \n     def clean_html(self, html):"
            },
            {
                "sha": "5e844b9c909a11c936cb339c7aa6f40a28c3a6d4",
                "filename": "tests/test_clean.py",
                "status": "modified",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/fedora-python/lxml_html_clean/blob/c5d816f86eb3707d72a8ecf5f3823e0daa1b3808/tests%2Ftest_clean.py",
                "raw_url": "https://github.com/fedora-python/lxml_html_clean/raw/c5d816f86eb3707d72a8ecf5f3823e0daa1b3808/tests%2Ftest_clean.py",
                "contents_url": "https://api.github.com/repos/fedora-python/lxml_html_clean/contents/tests%2Ftest_clean.py?ref=c5d816f86eb3707d72a8ecf5f3823e0daa1b3808",
                "patch": "@@ -127,6 +127,23 @@ def test_sneaky_js_in_math_style(self):\n             b'<math><style>/* deleted */</style></math>',\n             lxml.html.tostring(clean_html(s)))\n \n+    def test_sneaky_js_in_style_comment_math_svg(self):\n+        for tag in \"svg\", \"math\":\n+            html = f'<{tag}><style>/*<img src onerror=alert(origin)>*/'\n+            s = lxml.html.fragment_fromstring(html)\n+\n+            self.assertEqual(\n+                f'<{tag}><style>/* deleted */</style></{tag}>'.encode(),\n+                lxml.html.tostring(clean_html(s)))\n+\n+    def test_sneaky_js_in_style_comment_noscript(self):\n+        html = '<noscript><style>/*</noscript><img src onerror=alert(origin)>*/'\n+        s = lxml.html.fragment_fromstring(html)\n+\n+        self.assertEqual(\n+            b'<noscript><style>/* deleted */</style></noscript>',\n+            lxml.html.tostring(clean_html(s)))\n+\n     def test_sneaky_import_in_style(self):\n         # Prevent \"@@importimport\" -> \"@import\" replacement etc.\n         style_codes = ["
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/liske/needrestart/commits/b5f25f6ec6e7dd0c5be249e4e45de4ee9ffe594f",
        "url": "https://api.github.com/repos/liske/needrestart/commits/b5f25f6ec6e7dd0c5be249e4e45de4ee9ffe594f",
        "html_url": "https://github.com/liske/needrestart/commit/b5f25f6ec6e7dd0c5be249e4e45de4ee9ffe594f",
        "message": "interp: do not set RUBYLIB environment variable to prevent a LPE",
        "files": [
            {
                "sha": "37826ff6c9b9c524debf4af3680583f7d517eb47",
                "filename": "perl/lib/NeedRestart/Interp/Ruby.pm",
                "status": "modified",
                "additions": 19,
                "deletions": 6,
                "changes": 25,
                "blob_url": "https://github.com/liske/needrestart/blob/b5f25f6ec6e7dd0c5be249e4e45de4ee9ffe594f/perl%2Flib%2FNeedRestart%2FInterp%2FRuby.pm",
                "raw_url": "https://github.com/liske/needrestart/raw/b5f25f6ec6e7dd0c5be249e4e45de4ee9ffe594f/perl%2Flib%2FNeedRestart%2FInterp%2FRuby.pm",
                "contents_url": "https://api.github.com/repos/liske/needrestart/contents/perl%2Flib%2FNeedRestart%2FInterp%2FRuby.pm?ref=b5f25f6ec6e7dd0c5be249e4e45de4ee9ffe594f",
                "patch": "@@ -29,11 +29,13 @@ use warnings;\n \n use parent qw(NeedRestart::Interp);\n use Cwd qw(abs_path getcwd);\n+use File::Temp qw(tempdir);\n use Getopt::Std;\n use NeedRestart qw(:interp);\n use NeedRestart::Utils;\n \n my $LOGPREF = '[Ruby]';\n+my $empty_dir;\n \n needrestart_interp_register(__PACKAGE__, \"ruby\");\n \n@@ -76,6 +78,14 @@ sub _scan($$$$$) {\n     }\n }\n \n+# chdir into empty directory to prevent ruby parsing arbitrary files\n+sub chdir_empty() {\n+    unless(defined($empty_dir)) {\n+        $empty_dir = tempdir(CLEANUP => 1);\n+    }\n+    chdir($empty_dir);\n+}\n+\n sub source {\n     my $self = shift;\n     my $pid = shift;\n@@ -182,25 +192,28 @@ sub files {\n \n     # use cached data if avail\n     if(exists($cache->{files}->{(__PACKAGE__)}->{$src})) {\n+\tchdir($cwd);\n \tprint STDERR \"$LOGPREF #$pid: use cached file list\\n\" if($self->{debug});\n \treturn %{ $cache->{files}->{(__PACKAGE__)}->{$src} };\n     }\n \n     # prepare include path environment variable\n-    my %e = nr_parse_env($pid);\n+    my @path;\n     local %ENV;\n+\n+    # get include path from env\n+    my %e = nr_parse_env($pid);\n     if(exists($e{RUBYLIB})) {\n-\t$ENV{RUBYLIB} = $e{RUBYLIB};\n-    }\n-    elsif(exists($ENV{RUBYLIB})) {\n-\tdelete($ENV{RUBYLIB});\n+\t@path = map { \"/proc/$pid/root/$_\"; } split(':', $e{RUBYLIB});\n     }\n \n     # get include path\n+    chdir_empty();\n     my $rbread = nr_fork_pipe($self->{debug}, $ptable->{exec}, '-e', 'puts $:');\n-    my @path = map { \"/proc/$pid/root/$_\"; } <$rbread>;\n+    push(@path, map { \"/proc/$pid/root/$_\"; } <$rbread>);\n     close($rbread);\n     chomp(@path);\n+    chdir(\"/proc/$pid/root/$ptable->{cwd}\");\n \n     my %files;\n     _scan($self->{debug}, $pid, $src, \\%files, \\@path);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/liske/needrestart/commits/fcc9a4401392231bef4ef5ed026a0d7a275149ab",
        "url": "https://api.github.com/repos/liske/needrestart/commits/fcc9a4401392231bef4ef5ed026a0d7a275149ab",
        "html_url": "https://github.com/liske/needrestart/commit/fcc9a4401392231bef4ef5ed026a0d7a275149ab",
        "message": "interp: do not set PYTHONPATH environment variable to prevent a LPE",
        "files": [
            {
                "sha": "7a7002ed9d5683dd3d0e352103a4cf8e62fbff54",
                "filename": "perl/lib/NeedRestart/Interp/Python.pm",
                "status": "modified",
                "additions": 7,
                "deletions": 8,
                "changes": 15,
                "blob_url": "https://github.com/liske/needrestart/blob/fcc9a4401392231bef4ef5ed026a0d7a275149ab/perl%2Flib%2FNeedRestart%2FInterp%2FPython.pm",
                "raw_url": "https://github.com/liske/needrestart/raw/fcc9a4401392231bef4ef5ed026a0d7a275149ab/perl%2Flib%2FNeedRestart%2FInterp%2FPython.pm",
                "contents_url": "https://api.github.com/repos/liske/needrestart/contents/perl%2Flib%2FNeedRestart%2FInterp%2FPython.pm?ref=fcc9a4401392231bef4ef5ed026a0d7a275149ab",
                "patch": "@@ -190,29 +190,28 @@ sub files {\n     }\n \n     # prepare include path environment variable\n-    my %e = nr_parse_env($pid);\n+    my @path;\n     local %ENV;\n+\n+    # get include path from env\n+    my %e = nr_parse_env($pid);\n     if(exists($e{PYTHONPATH})) {\n-\t$ENV{PYTHONPATH} = $e{PYTHONPATH};\n-    }\n-    elsif(exists($ENV{PYTHONPATH})) {\n-\tdelete($ENV{PYTHONPATH});\n+\t@path = map { \"/proc/$pid/root/$_\"; } split(':', $e{PYTHONPATH});\n     }\n \n-    # get include path\n+    # get include path from sys.path\n     my ($pyread, $pywrite) = nr_fork_pipe2($self->{debug}, $ptable->{exec}, '-');\n     print $pywrite \"import sys\\nprint(sys.path)\\n\";\n     close($pywrite);\n     my ($path) = <$pyread>;\n     close($pyread);\n \n     # look for module source files\n-    my @path;\n     if(defined($path)) {\n \tchomp($path);\n \t$path =~ s/^\\['//;\n \t$path =~ s/'\\$//;\n-\t@path = map { \"/proc/$pid/root/$_\"; } split(\"', '\", $path);\n+\tpush(@path, map { \"/proc/$pid/root/$_\"; } split(\"', '\", $path));\n     }\n     else {\n \tprint STDERR \"$LOGPREF #$pid: failed to retrieve include path\\n\" if($self->{debug});"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/liske/needrestart/commits/0f80a348883f72279a859ee655f58da34babefb0",
        "url": "https://api.github.com/repos/liske/needrestart/commits/0f80a348883f72279a859ee655f58da34babefb0",
        "html_url": "https://github.com/liske/needrestart/commit/0f80a348883f72279a859ee655f58da34babefb0",
        "message": "interp: drop usage of Module::ScanDeps to prevent LPE",
        "files": [
            {
                "sha": "fb3ae532d2843f7fcf2d52fc187b1e847dfc5ae5",
                "filename": "INSTALL.md",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/liske/needrestart/blob/0f80a348883f72279a859ee655f58da34babefb0/INSTALL.md",
                "raw_url": "https://github.com/liske/needrestart/raw/0f80a348883f72279a859ee655f58da34babefb0/INSTALL.md",
                "contents_url": "https://api.github.com/repos/liske/needrestart/contents/INSTALL.md?ref=0f80a348883f72279a859ee655f58da34babefb0",
                "patch": "@@ -5,7 +5,6 @@ Perl\n ----\n \n - Module::Find\n-- Module::ScanDeps\n - Locale::TextDomain\n - Proc::ProcessTable\n - Sort::Naturally"
            },
            {
                "sha": "68f8683973505ef715a548b9f6c4724bc4d0e8f1",
                "filename": "README.Interp.md",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/liske/needrestart/blob/0f80a348883f72279a859ee655f58da34babefb0/README.Interp.md",
                "raw_url": "https://github.com/liske/needrestart/raw/0f80a348883f72279a859ee655f58da34babefb0/README.Interp.md",
                "contents_url": "https://api.github.com/repos/liske/needrestart/contents/README.Interp.md?ref=0f80a348883f72279a859ee655f58da34babefb0",
                "patch": "@@ -35,8 +35,13 @@ NeedRestart::Interp::Perl\n Recognized binaries:\t/usr/(local/)?bin/perl\n Find source file by:\tcommand line interpretation\n \n-We are using `Module::ScanDeps` to find used packages. This should work on\n-any static loaded packages, dynamic stuff will fail.\n+The source file is scanned only for 'use' lines, other module loading\n+mechanisms will not be recognized.\n+\n+*This function used the Module::ScanDeps package to get the used Perl packages\n+until needrestart 3.7. Module::ScanDeps is not used any more as it seems not\n+to be designed to work with untrustworthy perl sources which would allow an\n+attacker to use needrestart for local privilege escalation.*\n \n \n NeedRestart::Interp::Python"
            },
            {
                "sha": "e4e274d0c5ce6138b6cd88a5c4643cebbcb6a58b",
                "filename": "perl/Makefile.PL",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/liske/needrestart/blob/0f80a348883f72279a859ee655f58da34babefb0/perl%2FMakefile.PL",
                "raw_url": "https://github.com/liske/needrestart/raw/0f80a348883f72279a859ee655f58da34babefb0/perl%2FMakefile.PL",
                "contents_url": "https://api.github.com/repos/liske/needrestart/contents/perl%2FMakefile.PL?ref=0f80a348883f72279a859ee655f58da34babefb0",
                "patch": "@@ -6,7 +6,6 @@ WriteMakefile(\n     'NAME'\t\t=> 'NeedRestart',\n     'PREREQ_PM'\t\t=> {\n \tModule::Find => 0,\n-\tModule::ScanDeps => 0,\n \tProc::ProcessTable => 0,\n \tSort::Naturally => 0,\n \tTerm::ReadKey => 0."
            },
            {
                "sha": "012098b5f661602b9529d6e5ff1d1ef49220b103",
                "filename": "perl/lib/NeedRestart/Interp/Perl.pm",
                "status": "modified",
                "additions": 50,
                "deletions": 20,
                "changes": 70,
                "blob_url": "https://github.com/liske/needrestart/blob/0f80a348883f72279a859ee655f58da34babefb0/perl%2Flib%2FNeedRestart%2FInterp%2FPerl.pm",
                "raw_url": "https://github.com/liske/needrestart/raw/0f80a348883f72279a859ee655f58da34babefb0/perl%2Flib%2FNeedRestart%2FInterp%2FPerl.pm",
                "contents_url": "https://api.github.com/repos/liske/needrestart/contents/perl%2Flib%2FNeedRestart%2FInterp%2FPerl.pm?ref=0f80a348883f72279a859ee655f58da34babefb0",
                "patch": "@@ -32,7 +32,6 @@ use Cwd qw(abs_path getcwd);\n use Getopt::Std;\n use NeedRestart qw(:interp);\n use NeedRestart::Utils;\n-use Module::ScanDeps;\n \n my $LOGPREF = '[Perl]';\n \n@@ -48,6 +47,41 @@ sub isa {\n     return 0;\n }\n \n+sub _scan($$$$$) {\n+    my $debug = shift;\n+    my $pid = shift;\n+    my $src = shift;\n+    my $files = shift;\n+    my $path = shift;\n+\n+    my $fh;\n+    open($fh, '<', $src) || return;\n+    # find used modules\n+    my %modules = map {\n+\t(/^\\s*use\\s+([a-zA-Z][\\w:]+)/ ? ($1 => 1) : ())\n+    } <$fh>;\n+    close($fh);\n+\n+    # track file\n+    $files->{$src}++;\n+\n+    # scan module files\n+    if(scalar keys %modules) {\n+\tforeach my $module (keys %modules) {\n+        # skip some well-known Perl pragmas\n+        next if ($module =~ /^(constant|strict|vars|v5(\\.\\d+)?|warnings)$/);\n+\n+\t    $module =~ s@::@/@g;\n+\t    $module .= '.pm';\n+\n+\t    foreach my $p (@$path) {\n+\t\tmy $fn = ($p ne '' ? \"$p/\" : '').$module;\n+\t\t&_scan($debug, $pid, $fn, $files, $path) if(!exists($files->{$fn}) && -r $fn && -f $fn);\n+\t    }\n+\t}\n+    }\n+}\n+\n sub source {\n     my $self = shift;\n     my $pid = shift;\n@@ -160,32 +194,28 @@ sub files {\n     }\n \n     # prepare include path environment variable\n-    my %e = nr_parse_env($pid);\n+    my @path;\n     local %ENV;\n+\n+    # get include path from env\n+    my %e = nr_parse_env($pid);\n     if(exists($e{PERL5LIB})) {\n-\t$ENV{PERL5LIB} = $e{PERL5LIB};\n-    }\n-    elsif(exists($ENV{PERL5LIB})) {\n-\tdelete($ENV{PERL5LIB});\n+\t@path = map { \"/proc/$pid/root/$_\"; } split(':', $e{PERL5LIB});\n     }\n \n-    @Module::ScanDeps::IncludeLibs = (exists($opts{I}) ? ($opts{I}) : ());\n-    my $href;\n-    {\n-\t# Silence warnings of Module::ScanDeps for dynamic loaded modules (github issue #41)\n-\tlocal $SIG{__WARN__} = sub { };\n+    # get include path from @INC\n+    my $plread = nr_fork_pipe($self->{debug}, $ptable->{exec}, '-e', 'print(join(\"\\n\", @INC));');\n+    push(@path, map { \"/proc/$pid/root/$_\"; } <$plread>);\n+    close($plread);\n+    chomp(@path);\n \n-\t$href = scan_deps(\n-\t    files => [$src],\n-\t    recurse => 1,\n-            cache_file => $self->{conf}->{cache_file},\n-\t    );\n-    }\n+    my %files;\n+    _scan($self->{debug}, $pid, $src, \\%files, \\@path);\n \n     my %ret = map {\n-\tmy $stat = nr_stat(\"/proc/$pid/root/$href->{$_}->{file}\");\n-\t$href->{$_}->{file} => ( defined($stat) ? $stat->{ctime} : undef );\n-    } keys %$href;\n+\tmy $stat = nr_stat(\"/proc/$pid/root/$_\");\n+\t$_ => ( defined($stat) ? $stat->{ctime} : undef );\n+    } keys %files;\n \n     chdir($cwd);\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/statamic/cms/commits/400875b20f40e1343699d536a432a6fc284346da",
        "url": "https://api.github.com/repos/statamic/cms/commits/400875b20f40e1343699d536a432a6fc284346da",
        "html_url": "https://github.com/statamic/cms/commit/400875b20f40e1343699d536a432a6fc284346da",
        "message": "[5.x] More path traversal fixes (#11140)",
        "files": [
            {
                "sha": "c700ed7d7d1942e8ef2f8e5ff1a30763b4906477",
                "filename": "src/Assets/Asset.php",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/statamic/cms/blob/400875b20f40e1343699d536a432a6fc284346da/src%2FAssets%2FAsset.php",
                "raw_url": "https://github.com/statamic/cms/raw/400875b20f40e1343699d536a432a6fc284346da/src%2FAssets%2FAsset.php",
                "contents_url": "https://api.github.com/repos/statamic/cms/contents/src%2FAssets%2FAsset.php?ref=400875b20f40e1343699d536a432a6fc284346da",
                "patch": "@@ -7,6 +7,7 @@\n use Illuminate\\Contracts\\Support\\Arrayable;\n use Illuminate\\Support\\Carbon;\n use Illuminate\\Support\\Facades\\Cache;\n+use League\\Flysystem\\PathTraversalDetected;\n use Statamic\\Assets\\AssetUploader as Uploader;\n use Statamic\\Contracts\\Assets\\Asset as AssetContract;\n use Statamic\\Contracts\\Assets\\AssetContainer as AssetContainerContract;\n@@ -367,6 +368,13 @@ public function path($path = null)\n     {\n         return $this\n             ->fluentlyGetOrSet('path')\n+            ->setter(function ($path) {\n+                if (str_contains($path, '../')) {\n+                    throw PathTraversalDetected::forPath($path);\n+                }\n+\n+                return $path;\n+            })\n             ->getter(function ($path) {\n                 return $path ? ltrim($path, '/') : null;\n             })"
            },
            {
                "sha": "507c7358792de7195303b2fe0407a4d7c5a42233",
                "filename": "tests/Assets/AssetContainerTest.php",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/statamic/cms/blob/400875b20f40e1343699d536a432a6fc284346da/tests%2FAssets%2FAssetContainerTest.php",
                "raw_url": "https://github.com/statamic/cms/raw/400875b20f40e1343699d536a432a6fc284346da/tests%2FAssets%2FAssetContainerTest.php",
                "contents_url": "https://api.github.com/repos/statamic/cms/contents/tests%2FAssets%2FAssetContainerTest.php?ref=400875b20f40e1343699d536a432a6fc284346da",
                "patch": "@@ -14,6 +14,7 @@\n use League\\Flysystem\\DirectoryAttributes;\n use League\\Flysystem\\DirectoryListing;\n use League\\Flysystem\\FileAttributes;\n+use League\\Flysystem\\PathTraversalDetected;\n use PHPUnit\\Framework\\Attributes\\DataProvider;\n use PHPUnit\\Framework\\Attributes\\Test;\n use Statamic\\Assets\\Asset;\n@@ -811,6 +812,16 @@ public function it_makes_an_asset_at_given_path()\n         $this->assertEquals('path/to/test.txt', $asset->path());\n     }\n \n+    #[Test]\n+    public function it_cannot_make_an_asset_using_path_traversal()\n+    {\n+        $this->expectException(PathTraversalDetected::class);\n+        $this->expectExceptionMessage('Path traversal detected: foo/../test.txt');\n+\n+        $container = $this->containerWithDisk();\n+        $container->makeAsset('foo/../test.txt');\n+    }\n+\n     #[Test]\n     public function it_gets_all_assets_by_default()\n     {"
            },
            {
                "sha": "24a868a49e7cf2798049c473d6072bd3885595ba",
                "filename": "tests/Assets/AssetFolderTest.php",
                "status": "modified",
                "additions": 14,
                "deletions": 4,
                "changes": 18,
                "blob_url": "https://github.com/statamic/cms/blob/400875b20f40e1343699d536a432a6fc284346da/tests%2FAssets%2FAssetFolderTest.php",
                "raw_url": "https://github.com/statamic/cms/raw/400875b20f40e1343699d536a432a6fc284346da/tests%2FAssets%2FAssetFolderTest.php",
                "contents_url": "https://api.github.com/repos/statamic/cms/contents/tests%2FAssets%2FAssetFolderTest.php?ref=400875b20f40e1343699d536a432a6fc284346da",
                "patch": "@@ -57,12 +57,22 @@ public function it_gets_and_sets_the_path()\n     }\n \n     #[Test]\n-    public function path_traversal_not_allowed()\n+    public function it_cannot_use_traversal_in_path()\n     {\n-        $this->expectException(PathTraversalDetected::class);\n-        $this->expectExceptionMessage('Path traversal detected: path/to/../folder');\n+        $folder = (new Folder)->path('path/to/folder');\n \n-        (new Folder)->path('path/to/../folder');\n+        try {\n+            $folder->path('path/to/../folder');\n+        } catch (PathTraversalDetected $e) {\n+            $this->assertEquals('Path traversal detected: path/to/../folder', $e->getMessage());\n+\n+            // Even if exception was thrown, make sure that the path didn't somehow get updated.\n+            $this->assertEquals('path/to/folder', $folder->path());\n+\n+            return;\n+        }\n+\n+        $this->fail('Exception was not thrown.');\n     }\n \n     #[Test]"
            },
            {
                "sha": "06fc356c6229d16782ed7c1f1db7353755f604b4",
                "filename": "tests/Assets/AssetTest.php",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/statamic/cms/blob/400875b20f40e1343699d536a432a6fc284346da/tests%2FAssets%2FAssetTest.php",
                "raw_url": "https://github.com/statamic/cms/raw/400875b20f40e1343699d536a432a6fc284346da/tests%2FAssets%2FAssetTest.php",
                "contents_url": "https://api.github.com/repos/statamic/cms/contents/tests%2FAssets%2FAssetTest.php?ref=400875b20f40e1343699d536a432a6fc284346da",
                "patch": "@@ -11,6 +11,7 @@\n use Illuminate\\Support\\Facades\\Cache;\n use Illuminate\\Support\\Facades\\Event;\n use Illuminate\\Support\\Facades\\Storage;\n+use League\\Flysystem\\PathTraversalDetected;\n use Mockery;\n use PHPUnit\\Framework\\Attributes\\DataProvider;\n use PHPUnit\\Framework\\Attributes\\Test;\n@@ -482,6 +483,25 @@ public function it_gets_and_sets_the_path()\n         $this->assertEquals('asset.jpg', $asset->path('asset.jpg')->path());\n     }\n \n+    #[Test]\n+    public function it_cannot_use_traversal_in_path()\n+    {\n+        $asset = (new Asset)->path('path/to/asset.jpg');\n+\n+        try {\n+            $asset->path('foo/../test.jpg');\n+        } catch (PathTraversalDetected $e) {\n+            $this->assertEquals('Path traversal detected: foo/../test.jpg', $e->getMessage());\n+\n+            // Even if exception was thrown, make sure that the path didn't somehow get updated.\n+            $this->assertEquals('path/to/asset.jpg', $asset->path());\n+\n+            return;\n+        }\n+\n+        $this->fail('Exception was not thrown.');\n+    }\n+\n     #[Test]\n     public function it_gets_the_id_from_the_container_and_path()\n     {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/statamic/cms/commits/0c07c10009a2439c8ee56c8faefd1319dc6e388d",
        "url": "https://api.github.com/repos/statamic/cms/commits/0c07c10009a2439c8ee56c8faefd1319dc6e388d",
        "html_url": "https://github.com/statamic/cms/commit/0c07c10009a2439c8ee56c8faefd1319dc6e388d",
        "message": "[5.x] Add upload path traversal tests (#11139)",
        "files": [
            {
                "sha": "c417a6d0776ad54a09fa8abe53a676cfeabdd27d",
                "filename": "tests/Feature/Assets/StoreAssetTest.php",
                "status": "modified",
                "additions": 44,
                "deletions": 15,
                "changes": 59,
                "blob_url": "https://github.com/statamic/cms/blob/0c07c10009a2439c8ee56c8faefd1319dc6e388d/tests%2FFeature%2FAssets%2FStoreAssetTest.php",
                "raw_url": "https://github.com/statamic/cms/raw/0c07c10009a2439c8ee56c8faefd1319dc6e388d/tests%2FFeature%2FAssets%2FStoreAssetTest.php",
                "contents_url": "https://api.github.com/repos/statamic/cms/contents/tests%2FFeature%2FAssets%2FStoreAssetTest.php?ref=0c07c10009a2439c8ee56c8faefd1319dc6e388d",
                "patch": "@@ -5,6 +5,7 @@\n use Illuminate\\Http\\UploadedFile;\n use Illuminate\\Support\\Carbon;\n use Illuminate\\Support\\Facades\\Storage;\n+use PHPUnit\\Framework\\Attributes\\DataProvider;\n use PHPUnit\\Framework\\Attributes\\Test;\n use Statamic\\Assets\\AssetContainer;\n use Statamic\\Facades;\n@@ -37,22 +38,35 @@ public function setUp(): void\n     }\n \n     #[Test]\n-    public function it_uploads_an_asset()\n+    #[DataProvider('uploadProvider')]\n+    public function it_uploads_an_asset($filename, $expected)\n     {\n-        Storage::disk('test')->assertMissing('path/to/test.jpg');\n+        Storage::disk('test')->assertMissing($expected);\n \n         $this\n             ->actingAs($this->userWithPermission())\n-            ->submit()\n-            ->assertOk()\n+            ->submit([\n+                'file' => UploadedFile::fake()->image($filename),\n+            ])\n             ->assertJson([\n                 'data' => [\n-                    'id' => 'test_container::path/to/test.jpg',\n-                    'path' => 'path/to/test.jpg',\n+                    'id' => 'test_container::'.$expected,\n+                    'path' => $expected,\n                 ],\n             ]);\n \n-        Storage::disk('test')->assertExists('path/to/test.jpg');\n+        Storage::disk('test')->assertExists($expected);\n+    }\n+\n+    public static function uploadProvider()\n+    {\n+        return [\n+            'test.jpg' => ['test.jpg', 'path/to/test.jpg'],\n+\n+            // path traversal naughtiness\n+            '../test.jpg urlencoded' => ['%2e%2e%2ftest.jpg', 'path/to/..-test.jpg'],\n+            'foo/../test.jpg urlencoded' => ['foo%2f%2e%2e%2ftest.jpg', 'path/to/foo-..-test.jpg'],\n+        ];\n     }\n \n     #[Test]\n@@ -187,24 +201,39 @@ public function it_can_upload_with_different_filename()\n     }\n \n     #[Test]\n-    public function it_can_upload_to_relative_path()\n+    #[DataProvider('relativePathProvider')]\n+    public function it_can_upload_to_relative_path($filename, $expected)\n     {\n-        Storage::disk('test')->assertMissing('path/to/test.jpg');\n-        Storage::disk('test')->assertMissing('path/to/sub/folder/test.jpg');\n+        Storage::disk('test')->assertMissing('path/to/'.$filename);\n+        Storage::disk('test')->assertMissing($expected);\n \n         $this\n             ->actingAs($this->userWithPermission())\n-            ->submit(['relativePath' => 'sub/folder'])\n+            ->submit([\n+                'relativePath' => 'sub/folder',\n+                'file' => UploadedFile::fake()->image($filename),\n+            ])\n             ->assertOk()\n             ->assertJson([\n                 'data' => [\n-                    'id' => 'test_container::path/to/sub/folder/test.jpg',\n-                    'path' => 'path/to/sub/folder/test.jpg',\n+                    'id' => 'test_container::'.$expected,\n+                    'path' => $expected,\n                 ],\n             ]);\n \n-        Storage::disk('test')->assertMissing('path/to/test.jpg');\n-        Storage::disk('test')->assertExists('path/to/sub/folder/test.jpg');\n+        Storage::disk('test')->assertMissing('path/to/'.$filename);\n+        Storage::disk('test')->assertExists($expected);\n+    }\n+\n+    public static function relativePathProvider()\n+    {\n+        return [\n+            'test.jpg' => ['test.jpg', 'path/to/sub/folder/test.jpg'],\n+\n+            // path traversal naughtiness\n+            '../test.jpg urlencoded' => ['%2e%2e%2ftest.jpg', 'path/to/sub/folder/..-test.jpg'],\n+            'foo/../test.jpg urlencoded' => ['foo%2f%2e%2e%2ftest.jpg', 'path/to/sub/folder/foo-..-test.jpg'],\n+        ];\n     }\n \n     #[Test]"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/statamic/cms/commits/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d",
        "url": "https://api.github.com/repos/statamic/cms/commits/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d",
        "html_url": "https://github.com/statamic/cms/commit/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d",
        "message": "[5.x] Prevent asset folder path traversal (#11136)",
        "files": [
            {
                "sha": "794c9f720857f71562f850b49c21b2bf8fd1dab2",
                "filename": "src/Assets/AssetFolder.php",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/statamic/cms/blob/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d/src%2FAssets%2FAssetFolder.php",
                "raw_url": "https://github.com/statamic/cms/raw/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d/src%2FAssets%2FAssetFolder.php",
                "contents_url": "https://api.github.com/repos/statamic/cms/contents/src%2FAssets%2FAssetFolder.php?ref=4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d",
                "patch": "@@ -3,6 +3,7 @@\n namespace Statamic\\Assets;\n \n use Illuminate\\Contracts\\Support\\Arrayable;\n+use League\\Flysystem\\PathTraversalDetected;\n use Statamic\\Assets\\AssetUploader as Uploader;\n use Statamic\\Contracts\\Assets\\AssetFolder as Contract;\n use Statamic\\Events\\AssetFolderDeleted;\n@@ -35,7 +36,15 @@ public function container($container = null)\n \n     public function path($path = null)\n     {\n-        return $this->fluentlyGetOrSet('path')->args(func_get_args());\n+        return $this->fluentlyGetOrSet('path')\n+            ->setter(function ($path) {\n+                if (str_contains($path, '..')) {\n+                    throw PathTraversalDetected::forPath($path);\n+                }\n+\n+                return $path;\n+            })\n+            ->args(func_get_args());\n     }\n \n     public function basename()"
            },
            {
                "sha": "0095cf10a6857303f3383837acef6c558904ddc7",
                "filename": "src/Http/Controllers/CP/Assets/FolderActionController.php",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/statamic/cms/blob/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d/src%2FHttp%2FControllers%2FCP%2FAssets%2FFolderActionController.php",
                "raw_url": "https://github.com/statamic/cms/raw/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d/src%2FHttp%2FControllers%2FCP%2FAssets%2FFolderActionController.php",
                "contents_url": "https://api.github.com/repos/statamic/cms/contents/src%2FHttp%2FControllers%2FCP%2FAssets%2FFolderActionController.php?ref=4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d",
                "patch": "@@ -2,7 +2,9 @@\n \n namespace Statamic\\Http\\Controllers\\CP\\Assets;\n \n+use League\\Flysystem\\PathTraversalDetected;\n use Statamic\\Assets\\AssetFolder;\n+use Statamic\\Exceptions\\ValidationException;\n use Statamic\\Http\\Controllers\\CP\\ActionController as Controller;\n \n class FolderActionController extends Controller\n@@ -12,7 +14,11 @@ class FolderActionController extends Controller\n     protected function getSelectedItems($items, $context)\n     {\n         return $items->map(function ($path) use ($context) {\n-            return AssetFolder::find(\"{$context['container']}::{$path}\");\n+            try {\n+                return AssetFolder::find(\"{$context['container']}::{$path}\");\n+            } catch (PathTraversalDetected $e) {\n+                throw ValidationException::withMessages(['selections' => $e->getMessage()]);\n+            }\n         });\n     }\n }"
            },
            {
                "sha": "ce7b52a48c54d56d7f749a6c0747d0e92c70a6b1",
                "filename": "tests/Actions/DeleteAssetFolderTest.php",
                "status": "added",
                "additions": 101,
                "deletions": 0,
                "changes": 101,
                "blob_url": "https://github.com/statamic/cms/blob/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d/tests%2FActions%2FDeleteAssetFolderTest.php",
                "raw_url": "https://github.com/statamic/cms/raw/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d/tests%2FActions%2FDeleteAssetFolderTest.php",
                "contents_url": "https://api.github.com/repos/statamic/cms/contents/tests%2FActions%2FDeleteAssetFolderTest.php?ref=4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d",
                "patch": "@@ -0,0 +1,101 @@\n+<?php\n+\n+namespace Tests\\Actions;\n+\n+use Illuminate\\Http\\UploadedFile;\n+use Illuminate\\Support\\Facades\\Storage;\n+use PHPUnit\\Framework\\Attributes\\Test;\n+use Statamic\\Assets\\AssetContainer;\n+use Statamic\\Facades\\User;\n+use Tests\\FakesRoles;\n+use Tests\\PreventSavingStacheItemsToDisk;\n+use Tests\\TestCase;\n+\n+class DeleteAssetFolderTest extends TestCase\n+{\n+    use FakesRoles;\n+    use PreventSavingStacheItemsToDisk;\n+\n+    private $container;\n+\n+    public function setUp(): void\n+    {\n+        parent::setUp();\n+\n+        Storage::fake('test');\n+\n+        $this->container = tap(\n+            (new AssetContainer)->handle('test_container')->disk('test')\n+        )->save();\n+    }\n+\n+    private function createAsset($filename)\n+    {\n+        $file = UploadedFile::fake()->image($filename, 30, 60);\n+        Storage::disk('test')->putFileAs($file, $filename);\n+    }\n+\n+    private function assertAssetExists($file)\n+    {\n+        Storage::disk('test')->assertExists($file);\n+        $this->assertNotNull($this->container->asset($file));\n+    }\n+\n+    private function assertAssetDoesNotExist($file)\n+    {\n+        Storage::disk('test')->assertMissing($file);\n+        $this->assertNull($this->container->asset($file));\n+    }\n+\n+    private function deleteFolder($folder)\n+    {\n+        return $this->post(cp_route('assets.folders.actions.run', ['asset_container' => 'test_container']), [\n+            'action' => 'delete',\n+            'context' => ['container' => 'test_container'],\n+            'selections' => [$folder],\n+            'values' => [],\n+        ]);\n+    }\n+\n+    #[Test]\n+    public function it_deletes()\n+    {\n+        $this->createAsset('foo/alfa.jpg');\n+        $this->createAsset('foo/bravo.jpg');\n+        $this->createAsset('bar/charlie.jpg');\n+        $this->createAsset('delta.jpg');\n+        Storage::disk('test')->assertExists('foo');\n+\n+        $this\n+            ->actingAs(tap(User::make()->makeSuper())->save())\n+            ->deleteFolder('foo')\n+            ->assertOk();\n+\n+        Storage::disk('test')->assertMissing('foo');\n+        $this->assertAssetDoesNotExist('foo/alfa.jpg');\n+        $this->assertAssetDoesNotExist('foo/bravo.jpg');\n+        $this->assertAssetExists('bar/charlie.jpg');\n+        $this->assertAssetExists('delta.jpg');\n+    }\n+\n+    #[Test]\n+    public function no_path_traversal()\n+    {\n+        $this->createAsset('foo/alfa.jpg');\n+        $this->createAsset('foo/bravo.jpg');\n+        $this->createAsset('bar/charlie.jpg');\n+        $this->createAsset('delta.jpg');\n+        Storage::disk('test')->assertExists('foo');\n+\n+        $this\n+            ->actingAs(tap(User::make()->makeSuper())->save())\n+            ->deleteFolder('foo/..')\n+            ->assertSessionHasErrors(['selections' => 'Path traversal detected: foo/..']);\n+\n+        Storage::disk('test')->assertExists('foo');\n+        $this->assertAssetExists('foo/alfa.jpg');\n+        $this->assertAssetExists('foo/bravo.jpg');\n+        $this->assertAssetExists('bar/charlie.jpg');\n+        $this->assertAssetExists('delta.jpg');\n+    }\n+}"
            },
            {
                "sha": "55b10155d66c18581a5c6afbf9953f3beaf234df",
                "filename": "tests/Assets/AssetFolderTest.php",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/statamic/cms/blob/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d/tests%2FAssets%2FAssetFolderTest.php",
                "raw_url": "https://github.com/statamic/cms/raw/4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d/tests%2FAssets%2FAssetFolderTest.php",
                "contents_url": "https://api.github.com/repos/statamic/cms/contents/tests%2FAssets%2FAssetFolderTest.php?ref=4cc2c9bd0f39a93b3fc7e9ef0f12792576fd380d",
                "patch": "@@ -8,6 +8,7 @@\n use Illuminate\\Support\\Facades\\Event;\n use Illuminate\\Support\\Facades\\Storage;\n use Illuminate\\Support\\Str;\n+use League\\Flysystem\\PathTraversalDetected;\n use PHPUnit\\Framework\\Attributes\\Test;\n use Statamic\\Assets\\Asset;\n use Statamic\\Assets\\AssetContainerContents;\n@@ -55,6 +56,15 @@ public function it_gets_and_sets_the_path()\n         $this->assertEquals('folder', $folder->basename());\n     }\n \n+    #[Test]\n+    public function path_traversal_not_allowed()\n+    {\n+        $this->expectException(PathTraversalDetected::class);\n+        $this->expectExceptionMessage('Path traversal detected: path/to/../folder');\n+\n+        (new Folder)->path('path/to/../folder');\n+    }\n+\n     #[Test]\n     public function it_gets_the_disk_from_the_container()\n     {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/containerbuildsystem/cachi2/commits/d6638e5e14474061a1ab1ba5d0ee72f58b9a11a9",
        "url": "https://api.github.com/repos/hermetoproject/hermeto/commits/d6638e5e14474061a1ab1ba5d0ee72f58b9a11a9",
        "html_url": "https://github.com/hermetoproject/hermeto/commit/d6638e5e14474061a1ab1ba5d0ee72f58b9a11a9",
        "message": "fix(typer): do not log locals\n\nDo not log locals as they may expose secrets, which is a security risk.\n\nSigned-off-by: Martin Basti <mbasti@redhat.com>",
        "files": [
            {
                "sha": "4a84dca6d25f2458c4b10d967422ab3614f2e354",
                "filename": "cachi2/interface/cli.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hermetoproject/hermeto/blob/d6638e5e14474061a1ab1ba5d0ee72f58b9a11a9/cachi2%2Finterface%2Fcli.py",
                "raw_url": "https://github.com/hermetoproject/hermeto/raw/d6638e5e14474061a1ab1ba5d0ee72f58b9a11a9/cachi2%2Finterface%2Fcli.py",
                "contents_url": "https://api.github.com/repos/hermetoproject/hermeto/contents/cachi2%2Finterface%2Fcli.py?ref=d6638e5e14474061a1ab1ba5d0ee72f58b9a11a9",
                "patch": "@@ -22,7 +22,7 @@\n from cachi2.core.rooted_path import RootedPath\n from cachi2.interface.logging import LogLevel, setup_logging\n \n-app = typer.Typer(no_args_is_help=True)\n+app = typer.Typer(no_args_is_help=True, pretty_exceptions_show_locals=False)\n log = logging.getLogger(__name__)\n \n DEFAULT_SOURCE = \".\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/eslint/rewrite/commits/071be842f0bd58de4863cdf2ab86d60f49912abf",
        "url": "https://api.github.com/repos/eslint/rewrite/commits/071be842f0bd58de4863cdf2ab86d60f49912abf",
        "html_url": "https://github.com/eslint/rewrite/commit/071be842f0bd58de4863cdf2ab86d60f49912abf",
        "message": "Merge commit from fork\n\n* Fix runaway regex whitespace matching\n\n* Include negative lookbehind\n\n* Update packages/plugin-kit/tests/config-comment-parser.test.js\n\nCo-authored-by: Milos Djermanovic <milos.djermanovic@gmail.com>\n\n* Update packages/plugin-kit/tests/config-comment-parser.test.js\n\nCo-authored-by: Milos Djermanovic <milos.djermanovic@gmail.com>\n\n* Update packages/plugin-kit/tests/config-comment-parser.test.js\n\nCo-authored-by: Milos Djermanovic <milos.djermanovic@gmail.com>\n\n* Update packages/plugin-kit/tests/config-comment-parser.test.js\n\nCo-authored-by: Milos Djermanovic <milos.djermanovic@gmail.com>\n\n* Update packages/plugin-kit/src/config-comment-parser.js\n\nCo-authored-by: Milos Djermanovic <milos.djermanovic@gmail.com>\n\n---------\n\nCo-authored-by: Milos Djermanovic <milos.djermanovic@gmail.com>",
        "files": [
            {
                "sha": "f9a28223945fdf004332b85a162198b03081f671",
                "filename": "packages/plugin-kit/src/config-comment-parser.js",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/eslint/rewrite/blob/071be842f0bd58de4863cdf2ab86d60f49912abf/packages%2Fplugin-kit%2Fsrc%2Fconfig-comment-parser.js",
                "raw_url": "https://github.com/eslint/rewrite/raw/071be842f0bd58de4863cdf2ab86d60f49912abf/packages%2Fplugin-kit%2Fsrc%2Fconfig-comment-parser.js",
                "contents_url": "https://api.github.com/repos/eslint/rewrite/contents/packages%2Fplugin-kit%2Fsrc%2Fconfig-comment-parser.js?ref=071be842f0bd58de4863cdf2ab86d60f49912abf",
                "patch": "@@ -99,7 +99,9 @@ export class ConfigCommentParser {\n \t\tconst items = /** @type {StringConfig} */ ({});\n \n \t\t// Collapse whitespace around `:` and `,` to make parsing easier\n-\t\tconst trimmedString = string.replace(/\\s*([:,])\\s*/gu, \"$1\");\n+\t\tconst trimmedString = string\n+\t\t\t.trim()\n+\t\t\t.replace(/(?<!\\s)\\s*([:,])\\s*/gu, \"$1\");\n \n \t\ttrimmedString.split(/\\s|,+/u).forEach(name => {\n \t\t\tif (!name) {"
            },
            {
                "sha": "549ee8acd928b1906a6a2db33cf0bf4c67b225a9",
                "filename": "packages/plugin-kit/tests/config-comment-parser.test.js",
                "status": "modified",
                "additions": 49,
                "deletions": 0,
                "changes": 49,
                "blob_url": "https://github.com/eslint/rewrite/blob/071be842f0bd58de4863cdf2ab86d60f49912abf/packages%2Fplugin-kit%2Ftests%2Fconfig-comment-parser.test.js",
                "raw_url": "https://github.com/eslint/rewrite/raw/071be842f0bd58de4863cdf2ab86d60f49912abf/packages%2Fplugin-kit%2Ftests%2Fconfig-comment-parser.test.js",
                "contents_url": "https://api.github.com/repos/eslint/rewrite/contents/packages%2Fplugin-kit%2Ftests%2Fconfig-comment-parser.test.js?ref=071be842f0bd58de4863cdf2ab86d60f49912abf",
                "patch": "@@ -74,6 +74,55 @@ describe(\"ConfigCommentParser\", () => {\n \t\t\t\tb: null,\n \t\t\t});\n \t\t});\n+\n+\t\tit(\"should return an empty object for an empty string\", () => {\n+\t\t\tconst code = \"\";\n+\t\t\tconst result = commentParser.parseStringConfig(code, comment);\n+\n+\t\t\tassert.deepStrictEqual(result, {});\n+\t\t});\n+\n+\t\tit(\"should parse string config with one item, no value, and leading whitespace\", () => {\n+\t\t\tconst code = `${\" \".repeat(100000)}a`;\n+\t\t\tconst result = commentParser.parseStringConfig(code, comment);\n+\n+\t\t\tassert.deepStrictEqual(result, {\n+\t\t\t\ta: null,\n+\t\t\t});\n+\t\t});\n+\n+\t\tit(\"should parse string config with one item, no value, and trailing whitespace\", () => {\n+\t\t\tconst code = `a${\" \".repeat(100000)}`;\n+\t\t\tconst result = commentParser.parseStringConfig(code, comment);\n+\n+\t\t\tassert.deepStrictEqual(result, {\n+\t\t\t\ta: null,\n+\t\t\t});\n+\t\t});\n+\n+\t\tit(\"should parse string config with two items, no values, and whitespace in the middle\", () => {\n+\t\t\tconst code = `a${\" \".repeat(100000)}b`;\n+\t\t\tconst result = commentParser.parseStringConfig(code, comment);\n+\n+\t\t\tassert.deepStrictEqual(result, {\n+\t\t\t\ta: null,\n+\t\t\t\tb: null,\n+\t\t\t});\n+\t\t});\n+\n+\t\tit(\"should parse string config with multiple items with values separated by commas and lots of whitespace\", () => {\n+\t\t\tconst whitespace = \" \".repeat(100000);\n+\t\t\tconst code = `a: 1${whitespace},${whitespace}b: 2${whitespace},${whitespace}c: 3${whitespace},${whitespace}d: 4`;\n+\t\t\tconst result = commentParser.parseStringConfig(code, comment);\n+\n+\t\t\tassert.deepStrictEqual(result, {\n+\t\t\t\ta: \"1\",\n+\t\t\t\tb: \"2\",\n+\t\t\t\tc: \"3\",\n+\t\t\t\td: \"4\",\n+\t\t\t});\n+\t\t});\n+\n \t});\n \n \tdescribe(\"parseListConfig\", () => {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/step-security/harden-runner/commits/0080882f6c36860b6ba35c610c98ce87d4e2f26f",
        "url": "https://api.github.com/repos/step-security/harden-runner/commits/0080882f6c36860b6ba35c610c98ce87d4e2f26f",
        "html_url": "https://github.com/step-security/harden-runner/commit/0080882f6c36860b6ba35c610c98ce87d4e2f26f",
        "message": "Merge pull request #476 from step-security/rc-16\n\nRelease v2.10.2",
        "files": [
            {
                "sha": "ad9eca58628e1a45880dac69a72de7b39743f06e",
                "filename": "dist/index.js",
                "status": "modified",
                "additions": 46,
                "deletions": 2,
                "changes": 48,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Findex.js",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Findex.js",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/dist%2Findex.js?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f",
                "patch": "@@ -2838,7 +2838,7 @@ var lib_core = __nccwpck_require__(186);\n var external_fs_ = __nccwpck_require__(747);\n ;// CONCATENATED MODULE: ./src/configs.ts\n const STEPSECURITY_ENV = \"agent\"; // agent or int\n-const STEPSECURITY_API_URL = `https://${STEPSECURITY_ENV}.api.stepsecurity.io/v1`;\n+const configs_STEPSECURITY_API_URL = `https://${STEPSECURITY_ENV}.api.stepsecurity.io/v1`;\n const configs_STEPSECURITY_WEB_URL = \"https://app.stepsecurity.io\";\n \n ;// CONCATENATED MODULE: ./src/common.ts\n@@ -3014,6 +3014,49 @@ function isDocker() {\n \treturn isDockerCached;\n }\n \n+// EXTERNAL MODULE: ./node_modules/@actions/http-client/lib/index.js\n+var lib = __nccwpck_require__(255);\n+;// CONCATENATED MODULE: ./src/tls-inspect.ts\n+var tls_inspect_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n+    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n+    return new (P || (P = Promise))(function (resolve, reject) {\n+        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n+        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n+        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n+        step((generator = generator.apply(thisArg, _arguments || [])).next());\n+    });\n+};\n+\n+\n+\n+function isTLSEnabled(owner) {\n+    return tls_inspect_awaiter(this, void 0, void 0, function* () {\n+        let tlsStatusEndpoint = `${STEPSECURITY_API_URL}/github/${owner}/actions/tls-inspection-status`;\n+        let httpClient = new HttpClient();\n+        httpClient.requestOptions = { socketTimeout: 3 * 1000 };\n+        core.info(`[!] Checking TLS_STATUS: ${owner}`);\n+        let isEnabled = false;\n+        try {\n+            let resp = yield httpClient.get(tlsStatusEndpoint);\n+            if (resp.message.statusCode === 200) {\n+                isEnabled = true;\n+                core.info(`[!] TLS_ENABLED: ${owner}`);\n+            }\n+            else {\n+                core.info(`[!] TLS_NOT_ENABLED: ${owner}`);\n+            }\n+        }\n+        catch (e) {\n+            core.info(`[!] Unable to check TLS_STATUS`);\n+        }\n+        return isEnabled;\n+    });\n+}\n+function isGithubHosted() {\n+    const runnerEnvironment = process.env.RUNNER_ENVIRONMENT || \"\";\n+    return runnerEnvironment === \"github-hosted\";\n+}\n+\n ;// CONCATENATED MODULE: ./src/index.ts\n var src_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n     function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n@@ -3028,13 +3071,14 @@ var src_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _argu\n \n \n \n+\n (() => src_awaiter(void 0, void 0, void 0, function* () {\n     console.log(\"[harden-runner] main-step\");\n     if (process.platform !== \"linux\") {\n         console.log(UBUNTU_MESSAGE);\n         return;\n     }\n-    if (isDocker()) {\n+    if (isGithubHosted() && isDocker()) {\n         console.log(CONTAINER_MESSAGE);\n         return;\n     }"
            },
            {
                "sha": "df7076b97638c24956e5d0a6c3fd6e2f787a2718",
                "filename": "dist/index.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Findex.js.map",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Findex.js.map",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/dist%2Findex.js.map?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f"
            },
            {
                "sha": "9716b33baab5485da5cc566c0fc895ade9f03035",
                "filename": "dist/post/index.js",
                "status": "modified",
                "additions": 61,
                "deletions": 28,
                "changes": 89,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Fpost%2Findex.js",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Fpost%2Findex.js",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/dist%2Fpost%2Findex.js?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f",
                "patch": "@@ -139,7 +139,7 @@ const command_1 = __nccwpck_require__(351);\n const file_command_1 = __nccwpck_require__(717);\n const utils_1 = __nccwpck_require__(278);\n const os = __importStar(__nccwpck_require__(87));\n-const path = __importStar(__nccwpck_require__(277));\n+const path = __importStar(__nccwpck_require__(622));\n const oidc_utils_1 = __nccwpck_require__(41);\n /**\n  * The code to exit an action\n@@ -618,7 +618,7 @@ var __importStar = (this && this.__importStar) || function (mod) {\n };\n Object.defineProperty(exports, \"__esModule\", ({ value: true }));\n exports.toPlatformPath = exports.toWin32Path = exports.toPosixPath = void 0;\n-const path = __importStar(__nccwpck_require__(277));\n+const path = __importStar(__nccwpck_require__(622));\n /**\n  * toPosixPath converts the given path to the posix form. On Windows, \\\\ will be\n  * replaced with /.\n@@ -2752,7 +2752,7 @@ module.exports = require(\"os\");\n \n /***/ }),\n \n-/***/ 277:\n+/***/ 622:\n /***/ ((module) => {\n \n \"use strict\";\n@@ -2837,10 +2837,10 @@ var external_fs_ = __nccwpck_require__(747);\n ;// CONCATENATED MODULE: external \"child_process\"\n const external_child_process_namespaceObject = require(\"child_process\");\n // EXTERNAL MODULE: ./node_modules/@actions/core/lib/core.js\n-var core = __nccwpck_require__(186);\n+var lib_core = __nccwpck_require__(186);\n ;// CONCATENATED MODULE: ./src/configs.ts\n const STEPSECURITY_ENV = \"agent\"; // agent or int\n-const STEPSECURITY_API_URL = `https://${STEPSECURITY_ENV}.api.stepsecurity.io/v1`;\n+const configs_STEPSECURITY_API_URL = `https://${STEPSECURITY_ENV}.api.stepsecurity.io/v1`;\n const STEPSECURITY_WEB_URL = \"https://app.stepsecurity.io\";\n \n ;// CONCATENATED MODULE: ./src/common.ts\n@@ -2905,9 +2905,9 @@ function addSummary() {\n             //console.error(err);\n         }\n         if (needsSubscription) {\n-            yield core.summary.addSeparator()\n+            yield lib_core.summary.addSeparator()\n                 .addRaw(`<h2>\u26a0\ufe0f Your GitHub Actions Runtime Security is currently disabled!</h2>`);\n-            yield core.summary.addRaw(`\n+            yield lib_core.summary.addRaw(`\n <p>It appears that you're using the <a href=\"https://github.com/step-security/harden-runner\">Harden-Runner GitHub Action</a> by StepSecurity within a private repository. However, runtime security is not enabled as your organization hasn't signed up for a free trial or a paid subscription yet.</p>\n <p>To enable runtime security, start a free trial today by installing the <a href=\"https://github.com/apps/stepsecurity-actions-security\">StepSecurity Actions Security GitHub App</a>. For more information or assistance, feel free to reach out to us through our <a href=\"https://www.stepsecurity.io/contact\">contact form</a>.</p>\n `)\n@@ -2925,7 +2925,7 @@ function addSummary() {\n             return;\n         }\n         const insightsRow = `<p><b><a href=\"${insights_url}\">\ud83d\udcc4 View Full Report</a></b></p>`;\n-        yield core.summary.addSeparator().addRaw(`<h2>\ud83d\udee1 StepSecurity Report</h2>`);\n+        yield lib_core.summary.addSeparator().addRaw(`<h2>\ud83d\udee1 StepSecurity Report</h2>`);\n         tableEntries.sort((a, b) => {\n             if (a.status === \"\u274c Blocked\" && b.status !== \"\u274c Blocked\") {\n                 return -1;\n@@ -2938,7 +2938,7 @@ function addSummary() {\n             }\n         });\n         tableEntries = tableEntries.slice(0, 3);\n-        yield core.summary.addRaw(`\n+        yield lib_core.summary.addRaw(`\n   <blockquote>\n   <p>Preview of the outbound network calls during this workflow run.</p></blockquote>\n   <h3>Network Calls</h3>\n@@ -2967,7 +2967,7 @@ function addSummary() {\n   </table>\n   ${insightsRow}\n `);\n-        yield core.summary.addRaw(`<p><i>Markdown generated by the <a href=\"https://github.com/step-security/harden-runner\">Harden-Runner GitHub Action</a>.</i></p>`)\n+        yield lib_core.summary.addRaw(`<p><i>Markdown generated by the <a href=\"https://github.com/step-security/harden-runner\">Harden-Runner GitHub Action</a>.</i></p>`)\n             .addSeparator()\n             .write();\n     });\n@@ -3031,34 +3031,68 @@ function isSecondaryPod() {\n     const workDir = \"/__w\";\n     return external_fs_.existsSync(workDir);\n }\n-function getRunnerTempDir() {\n-    const isTest = process.env[\"isTest\"];\n-    if (isTest === \"1\") {\n-        return \"/tmp\";\n-    }\n-    return process.env[\"RUNNER_TEMP\"] || \"/tmp\";\n-}\n function sendAllowedEndpoints(endpoints) {\n     const allowedEndpoints = endpoints.split(\" \"); // endpoints are space separated\n     for (const endpoint of allowedEndpoints) {\n         if (endpoint) {\n-            const encodedEndpoint = Buffer.from(endpoint).toString(\"base64\");\n-            cp.execSync(`echo \"${endpoint}\" > \"${getRunnerTempDir()}/step_policy_endpoint_${encodedEndpoint}\"`);\n+            let encodedEndpoint = Buffer.from(endpoint).toString(\"base64\");\n+            let endpointPolicyStr = `step_policy_endpoint_${encodedEndpoint}`;\n+            echo(endpointPolicyStr);\n         }\n     }\n     if (allowedEndpoints.length > 0) {\n         applyPolicy(allowedEndpoints.length);\n     }\n }\n function applyPolicy(count) {\n-    const fileName = `step_policy_apply_${count}`;\n-    cp.execSync(`echo \"${fileName}\" > \"${getRunnerTempDir()}/${fileName}\"`);\n+    let applyPolicyStr = `step_policy_apply_${count}`;\n+    echo(applyPolicyStr);\n }\n-function removeStepPolicyFiles() {\n-    external_child_process_namespaceObject.execSync(`rm ${getRunnerTempDir()}/step_policy_*`);\n+function echo(content) {\n+    cp.execFileSync(\"echo\", [content]);\n }\n-function arcCleanUp() {\n-    external_child_process_namespaceObject.execSync(`echo \"cleanup\" > \"${getRunnerTempDir()}/step_policy_cleanup\"`);\n+\n+// EXTERNAL MODULE: ./node_modules/@actions/http-client/lib/index.js\n+var lib = __nccwpck_require__(255);\n+;// CONCATENATED MODULE: ./src/tls-inspect.ts\n+var tls_inspect_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {\n+    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n+    return new (P || (P = Promise))(function (resolve, reject) {\n+        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n+        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n+        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n+        step((generator = generator.apply(thisArg, _arguments || [])).next());\n+    });\n+};\n+\n+\n+\n+function isTLSEnabled(owner) {\n+    return tls_inspect_awaiter(this, void 0, void 0, function* () {\n+        let tlsStatusEndpoint = `${STEPSECURITY_API_URL}/github/${owner}/actions/tls-inspection-status`;\n+        let httpClient = new HttpClient();\n+        httpClient.requestOptions = { socketTimeout: 3 * 1000 };\n+        core.info(`[!] Checking TLS_STATUS: ${owner}`);\n+        let isEnabled = false;\n+        try {\n+            let resp = yield httpClient.get(tlsStatusEndpoint);\n+            if (resp.message.statusCode === 200) {\n+                isEnabled = true;\n+                core.info(`[!] TLS_ENABLED: ${owner}`);\n+            }\n+            else {\n+                core.info(`[!] TLS_NOT_ENABLED: ${owner}`);\n+            }\n+        }\n+        catch (e) {\n+            core.info(`[!] Unable to check TLS_STATUS`);\n+        }\n+        return isEnabled;\n+    });\n+}\n+function isGithubHosted() {\n+    const runnerEnvironment = process.env.RUNNER_ENVIRONMENT || \"\";\n+    return runnerEnvironment === \"github-hosted\";\n }\n \n ;// CONCATENATED MODULE: ./src/cleanup.ts\n@@ -3076,20 +3110,19 @@ var cleanup_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _\n \n \n \n+\n (() => cleanup_awaiter(void 0, void 0, void 0, function* () {\n     console.log(\"[harden-runner] post-step\");\n     if (process.platform !== \"linux\") {\n         console.log(UBUNTU_MESSAGE);\n         return;\n     }\n-    if (isDocker()) {\n+    if (isGithubHosted() && isDocker()) {\n         console.log(CONTAINER_MESSAGE);\n         return;\n     }\n     if (isArcRunner()) {\n         console.log(`[!] ${ARC_RUNNER_MESSAGE}`);\n-        arcCleanUp();\n-        removeStepPolicyFiles();\n         return;\n     }\n     if (process.env.STATE_selfHosted === \"true\") {"
            },
            {
                "sha": "3bf06ea39c3c940bd876041d3606caa8a5703940",
                "filename": "dist/post/index.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Fpost%2Findex.js.map",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Fpost%2Findex.js.map",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/dist%2Fpost%2Findex.js.map?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f"
            },
            {
                "sha": "be047a08858daacf50f93a06c961621e581251a7",
                "filename": "dist/pre/index.js",
                "status": "modified",
                "additions": 15,
                "deletions": 19,
                "changes": 34,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Fpre%2Findex.js",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Fpre%2Findex.js",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/dist%2Fpre%2Findex.js?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f",
                "patch": "@@ -71535,34 +71535,25 @@ function isSecondaryPod() {\n     const workDir = \"/__w\";\n     return external_fs_.existsSync(workDir);\n }\n-function getRunnerTempDir() {\n-    const isTest = process.env[\"isTest\"];\n-    if (isTest === \"1\") {\n-        return \"/tmp\";\n-    }\n-    return process.env[\"RUNNER_TEMP\"] || \"/tmp\";\n-}\n function sendAllowedEndpoints(endpoints) {\n     const allowedEndpoints = endpoints.split(\" \"); // endpoints are space separated\n     for (const endpoint of allowedEndpoints) {\n         if (endpoint) {\n-            const encodedEndpoint = Buffer.from(endpoint).toString(\"base64\");\n-            external_child_process_.execSync(`echo \"${endpoint}\" > \"${getRunnerTempDir()}/step_policy_endpoint_${encodedEndpoint}\"`);\n+            let encodedEndpoint = Buffer.from(endpoint).toString(\"base64\");\n+            let endpointPolicyStr = `step_policy_endpoint_${encodedEndpoint}`;\n+            echo(endpointPolicyStr);\n         }\n     }\n     if (allowedEndpoints.length > 0) {\n         applyPolicy(allowedEndpoints.length);\n     }\n }\n function applyPolicy(count) {\n-    const fileName = `step_policy_apply_${count}`;\n-    external_child_process_.execSync(`echo \"${fileName}\" > \"${getRunnerTempDir()}/${fileName}\"`);\n+    let applyPolicyStr = `step_policy_apply_${count}`;\n+    echo(applyPolicyStr);\n }\n-function removeStepPolicyFiles() {\n-    cp.execSync(`rm ${getRunnerTempDir()}/step_policy_*`);\n-}\n-function arcCleanUp() {\n-    cp.execSync(`echo \"cleanup\" > \"${getRunnerTempDir()}/step_policy_cleanup\"`);\n+function echo(content) {\n+    external_child_process_.execFileSync(\"echo\", [content]);\n }\n \n ;// CONCATENATED MODULE: ./src/tls-inspect.ts\n@@ -71735,7 +71726,7 @@ var setup_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _ar\n             console.log(UBUNTU_MESSAGE);\n             return;\n         }\n-        if (isDocker()) {\n+        if (isGithubHosted() && isDocker()) {\n             console.log(CONTAINER_MESSAGE);\n             return;\n         }\n@@ -71836,7 +71827,7 @@ var setup_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _ar\n             if (confg.egress_policy === \"block\") {\n                 try {\n                     if (process.env.USER) {\n-                        external_child_process_.execSync(`sudo chown -R ${process.env.USER} /home/agent`);\n+                        chownForFolder(process.env.USER, \"/home/agent\");\n                     }\n                     const confgStr = JSON.stringify(confg);\n                     external_fs_.writeFileSync(\"/home/agent/block_event.json\", confgStr);\n@@ -71882,7 +71873,7 @@ var setup_awaiter = (undefined && undefined.__awaiter) || function (thisArg, _ar\n         }\n         const confgStr = JSON.stringify(confg);\n         external_child_process_.execSync(\"sudo mkdir -p /home/agent\");\n-        external_child_process_.execSync(\"sudo chown -R $USER /home/agent\");\n+        chownForFolder(process.env.USER, \"/home/agent\");\n         let isTLS = yield isTLSEnabled(github.context.repo.owner);\n         const agentInstalled = yield installAgent(isTLS, confgStr);\n         if (agentInstalled) {\n@@ -71923,6 +71914,11 @@ function setup_sleep(ms) {\n         setTimeout(resolve, ms);\n     });\n }\n+function chownForFolder(newOwner, target) {\n+    let cmd = \"sudo\";\n+    let args = [\"chown\", \"-R\", newOwner, target];\n+    external_child_process_.execFileSync(cmd, args);\n+}\n \n })();\n "
            },
            {
                "sha": "4219a158255f5786a37626ad7654e953f58bedb2",
                "filename": "dist/pre/index.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Fpre%2Findex.js.map",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/dist%2Fpre%2Findex.js.map",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/dist%2Fpre%2Findex.js.map?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f"
            },
            {
                "sha": "8345d0e003941b8dd66beb4c12d855eb3d3a749a",
                "filename": "src/arc-runner.test.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 12,
                "changes": 13,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Farc-runner.test.ts",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Farc-runner.test.ts",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/src%2Farc-runner.test.ts?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f",
                "patch": "@@ -1,20 +1,9 @@\n import { isArcRunner, sendAllowedEndpoints } from \"./arc-runner\";\n \n-\n it(\"should correctly recognize arc based runner\", async () => {\n   process.env[\"GITHUB_ACTIONS_RUNNER_EXTRA_USER_AGENT\"] =\n     \"actions-runner-controller/2.0.1\";\n \n-  let isArc: boolean =  await isArcRunner();\n+  let isArc: boolean = await isArcRunner();\n   expect(isArc).toBe(true);\n-\n });\n-\n-\n-it(\"should write endpoint files\", ()=>{\n-  process.env[\"isTest\"] = \"1\"\n-\n-  let allowed_endpoints = [\"github.com:443\", \"*.google.com:443\", \"youtube.com\"].join(\" \");\n-  sendAllowedEndpoints(allowed_endpoints);\n-\n-})"
            },
            {
                "sha": "d2bd5f6bf97759f6bd5c009f33fde365cd4ad7a5",
                "filename": "src/arc-runner.ts",
                "status": "modified",
                "additions": 8,
                "deletions": 23,
                "changes": 31,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Farc-runner.ts",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Farc-runner.ts",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/src%2Farc-runner.ts?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f",
                "patch": "@@ -1,6 +1,6 @@\n import * as cp from \"child_process\";\n import * as fs from \"fs\";\n-import { sleep } from \"./setup\";\n+import path from \"path\";\n \n export function isArcRunner(): boolean {\n   const runnerUserAgent = process.env[\"GITHUB_ACTIONS_RUNNER_EXTRA_USER_AGENT\"];\n@@ -21,25 +21,14 @@ function isSecondaryPod(): boolean {\n   return fs.existsSync(workDir);\n }\n \n-function getRunnerTempDir(): string {\n-  const isTest = process.env[\"isTest\"];\n-\n-  if (isTest === \"1\") {\n-    return \"/tmp\";\n-  }\n-\n-  return process.env[\"RUNNER_TEMP\"] || \"/tmp\";\n-}\n-\n export function sendAllowedEndpoints(endpoints: string): void {\n   const allowedEndpoints = endpoints.split(\" \"); // endpoints are space separated\n \n   for (const endpoint of allowedEndpoints) {\n     if (endpoint) {\n-      const encodedEndpoint = Buffer.from(endpoint).toString(\"base64\");\n-      cp.execSync(\n-        `echo \"${endpoint}\" > \"${getRunnerTempDir()}/step_policy_endpoint_${encodedEndpoint}\"`\n-      );\n+      let encodedEndpoint = Buffer.from(endpoint).toString(\"base64\");\n+      let endpointPolicyStr = `step_policy_endpoint_${encodedEndpoint}`;\n+      echo(endpointPolicyStr);\n     }\n   }\n \n@@ -49,14 +38,10 @@ export function sendAllowedEndpoints(endpoints: string): void {\n }\n \n function applyPolicy(count: number): void {\n-  const fileName = `step_policy_apply_${count}`;\n-  cp.execSync(`echo \"${fileName}\" > \"${getRunnerTempDir()}/${fileName}\"`);\n-}\n-\n-export function removeStepPolicyFiles() {\n-  cp.execSync(`rm ${getRunnerTempDir()}/step_policy_*`);\n+  let applyPolicyStr = `step_policy_apply_${count}`;\n+  echo(applyPolicyStr);\n }\n \n-export function arcCleanUp() {\n-  cp.execSync(`echo \"cleanup\" > \"${getRunnerTempDir()}/step_policy_cleanup\"`);\n+function echo(content: string) {\n+  cp.execFileSync(\"echo\", [content]);\n }"
            },
            {
                "sha": "38551db904c10381fa52370c960049a869139f11",
                "filename": "src/cleanup.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 5,
                "changes": 8,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Fcleanup.ts",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Fcleanup.ts",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/src%2Fcleanup.ts?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f",
                "patch": "@@ -2,24 +2,22 @@ import * as fs from \"fs\";\n import * as cp from \"child_process\";\n import * as common from \"./common\";\n import isDocker from \"is-docker\";\n-import { arcCleanUp, isArcRunner, removeStepPolicyFiles } from \"./arc-runner\";\n-\n+import { isArcRunner } from \"./arc-runner\";\n+import { isGithubHosted } from \"./tls-inspect\";\n (async () => {\n   console.log(\"[harden-runner] post-step\");\n \n   if (process.platform !== \"linux\") {\n     console.log(common.UBUNTU_MESSAGE);\n     return;\n   }\n-  if (isDocker()) {\n+  if (isGithubHosted() && isDocker()) {\n     console.log(common.CONTAINER_MESSAGE);\n     return;\n   }\n \n   if (isArcRunner()) {\n     console.log(`[!] ${common.ARC_RUNNER_MESSAGE}`);\n-    arcCleanUp();\n-    removeStepPolicyFiles();\n     return;\n   }\n "
            },
            {
                "sha": "114b284b7e17668e3825eb279262f388c69b956d",
                "filename": "src/index.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Findex.ts",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Findex.ts",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/src%2Findex.ts?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f",
                "patch": "@@ -2,15 +2,15 @@ import * as common from \"./common\";\n import * as core from \"@actions/core\";\n import isDocker from \"is-docker\";\n import { STEPSECURITY_WEB_URL } from \"./configs\";\n-\n+import { isGithubHosted } from \"./tls-inspect\";\n (async () => {\n   console.log(\"[harden-runner] main-step\");\n \n   if (process.platform !== \"linux\") {\n     console.log(common.UBUNTU_MESSAGE);\n     return;\n   }\n-  if (isDocker()) {\n+  if (isGithubHosted() && isDocker()) {\n     console.log(common.CONTAINER_MESSAGE);\n     return;\n   }"
            },
            {
                "sha": "fb0d0351cc7331ffcc31def0d9e59db222edf34b",
                "filename": "src/setup.ts",
                "status": "modified",
                "additions": 10,
                "deletions": 3,
                "changes": 13,
                "blob_url": "https://github.com/step-security/harden-runner/blob/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Fsetup.ts",
                "raw_url": "https://github.com/step-security/harden-runner/raw/0080882f6c36860b6ba35c610c98ce87d4e2f26f/src%2Fsetup.ts",
                "contents_url": "https://api.github.com/repos/step-security/harden-runner/contents/src%2Fsetup.ts?ref=0080882f6c36860b6ba35c610c98ce87d4e2f26f",
                "patch": "@@ -39,7 +39,7 @@ interface MonitorResponse {\n       console.log(common.UBUNTU_MESSAGE);\n       return;\n     }\n-    if (isDocker()) {\n+    if (isGithubHosted() && isDocker()) {\n       console.log(common.CONTAINER_MESSAGE);\n       return;\n     }\n@@ -165,8 +165,9 @@ interface MonitorResponse {\n       if (confg.egress_policy === \"block\") {\n         try {\n           if (process.env.USER) {\n-            cp.execSync(`sudo chown -R ${process.env.USER} /home/agent`);\n+            chownForFolder(process.env.USER, \"/home/agent\");\n           }\n+\n           const confgStr = JSON.stringify(confg);\n           fs.writeFileSync(\"/home/agent/block_event.json\", confgStr);\n           await sleep(5000);\n@@ -225,7 +226,7 @@ interface MonitorResponse {\n \n     const confgStr = JSON.stringify(confg);\n     cp.execSync(\"sudo mkdir -p /home/agent\");\n-    cp.execSync(\"sudo chown -R $USER /home/agent\");\n+    chownForFolder(process.env.USER, \"/home/agent\");\n \n     let isTLS = await isTLSEnabled(context.repo.owner);\n \n@@ -269,3 +270,9 @@ export function sleep(ms) {\n     setTimeout(resolve, ms);\n   });\n }\n+\n+function chownForFolder(newOwner: string, target: string) {\n+  let cmd = \"sudo\";\n+  let args = [\"chown\", \"-R\", newOwner, target];\n+  cp.execFileSync(cmd, args);\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/autolab/Autolab/commits/2429983b6caa245fea1b37f0dc236ccbcad9554c",
        "url": "https://api.github.com/repos/autolab/Autolab/commits/2429983b6caa245fea1b37f0dc236ccbcad9554c",
        "html_url": "https://github.com/autolab/Autolab/commit/2429983b6caa245fea1b37f0dc236ccbcad9554c",
        "message": "Merge commit from fork\n\n(cherry picked from commit ce3e44f508224172cad44f7d99951a2ad8bb7f3c)\n\nCo-authored-by: Nicholas Myers <32116122+NicholasMy@users.noreply.github.com>",
        "files": [
            {
                "sha": "8efac3891be1d1b941ec78f957ce98a7bf62f74a",
                "filename": "app/assets/javascripts/gradesheet.js.erb",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/autolab/Autolab/blob/2429983b6caa245fea1b37f0dc236ccbcad9554c/app%2Fassets%2Fjavascripts%2Fgradesheet.js.erb",
                "raw_url": "https://github.com/autolab/Autolab/raw/2429983b6caa245fea1b37f0dc236ccbcad9554c/app%2Fassets%2Fjavascripts%2Fgradesheet.js.erb",
                "contents_url": "https://api.github.com/repos/autolab/Autolab/contents/app%2Fassets%2Fjavascripts%2Fgradesheet.js.erb?ref=2429983b6caa245fea1b37f0dc236ccbcad9554c",
                "patch": "@@ -586,7 +586,7 @@ jQuery(function() {\n       var cache_feedback = cache_get_item(sub_id, prob_id, 'feedback');\n       if (cache_feedback != null) {\n         // cache hit\n-        $feedback_textarea.html(cache_feedback);\n+        $feedback_textarea.text(cache_feedback);\n       } else {\n         // cache miss\n         // lazy load grader and feedback\n@@ -621,7 +621,7 @@ jQuery(function() {\n               if (grader != \" \") {\n                 $score_details_tbody.prepend(\"<div class='grader-name'>Grader: \" + grader + \"</div>\")\n               }\n-              $feedback_textarea.html(feedback);\n+              $feedback_textarea.text(feedback);\n               $feedback_textarea.prop('disabled', false);\n             }\n           });"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/autolab/Autolab/commits/96006d532a392eeca2d350d1811f8e8ab9625bda",
        "url": "https://api.github.com/repos/autolab/Autolab/commits/96006d532a392eeca2d350d1811f8e8ab9625bda",
        "html_url": "https://github.com/autolab/Autolab/commit/96006d532a392eeca2d350d1811f8e8ab9625bda",
        "message": "Merge commit from fork\n\n(cherry picked from commit 3894ff0a3ecc45161ce62fd2c08939efa5581054)\n\nCo-authored-by: Nicholas Myers <32116122+NicholasMy@users.noreply.github.com>",
        "files": [
            {
                "sha": "f429215f1fc051d0110fb5f7b32267b5c7642df2",
                "filename": "app/controllers/assessment/grading.rb",
                "status": "modified",
                "additions": 16,
                "deletions": 1,
                "changes": 17,
                "blob_url": "https://github.com/autolab/Autolab/blob/96006d532a392eeca2d350d1811f8e8ab9625bda/app%2Fcontrollers%2Fassessment%2Fgrading.rb",
                "raw_url": "https://github.com/autolab/Autolab/raw/96006d532a392eeca2d350d1811f8e8ab9625bda/app%2Fcontrollers%2Fassessment%2Fgrading.rb",
                "contents_url": "https://api.github.com/repos/autolab/Autolab/contents/app%2Fcontrollers%2Fassessment%2Fgrading.rb?ref=96006d532a392eeca2d350d1811f8e8ab9625bda",
                "patch": "@@ -237,6 +237,7 @@ def quickSetScore\n     # find existing score for this problem, if there's one\n     # otherwise, create it\n     score = Score.find_or_initialize_by_submission_id_and_problem_id(sub_id, prob_id)\n+    return head :forbidden unless submission_belongs_to_current_course(score.submission)\n \n     score.grader_id = @cud.id\n     score.score = params[:score].to_f\n@@ -266,6 +267,7 @@ def quickSetScoreDetails\n     # find existing score for this problem, if there's one\n     # otherwise, create it\n     score = Score.find_or_initialize_by_submission_id_and_problem_id(sub_id, prob_id)\n+    return head :forbidden unless submission_belongs_to_current_course(score.submission)\n \n     score.grader_id = @cud.id\n     score.feedback = params[:feedback]\n@@ -286,6 +288,7 @@ def quickSetScoreDetails\n \n   def submission_popover\n     submission = Submission.find_by(id: params[:submission_id].to_i)\n+    return head :forbidden unless submission_belongs_to_current_course(submission)\n     if submission\n       render partial: \"popover\", locals: { s: submission }\n     else\n@@ -300,6 +303,7 @@ def score_grader_info\n       redirect_to action: :show\n       return\n     end\n+    return head :forbidden unless submission_belongs_to_current_course(score.submission)\n \n     grader = (if score then score.grader else nil end)\n     grader_info = \"\"\n@@ -321,8 +325,10 @@ def quickGetTotal\n \n     # get submission and problem IDs\n     sub_id = params[:submission_id].to_i\n+    submission = Submission.find(sub_id)\n+    return head :forbidden unless submission_belongs_to_current_course(submission)\n \n-    render plain: Submission.find(sub_id).final_score(@cud)\n+    render plain: submission.final_score(@cud)\n   end\n \n   def statistics\n@@ -538,4 +544,13 @@ def load_gradesheet_data\n     @submissions = cache.latest_submissions.values\n     @section_filter = params[:section]\n   end\n+\n+  def submission_belongs_to_current_course(submission)\n+    # Returns true if the provided submission belongs to the current @course, false otherwise.\n+    # This is used to ensure a user can only view or modify scores in courses where they have\n+    # permission, since the  `action_auth_level ***, :course_assistant` only verifies that they're\n+    # a CA for the course in the URL. It doesn't verify that the score they're trying to modify\n+    # is in a course they're a CA in.\n+    submission.course_user_datum.course == @course\n+  end\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aio-libs/aiohttp/commits/259edc369075de63e6f3a4eaade058c62af0df71",
        "url": "https://api.github.com/repos/aio-libs/aiohttp/commits/259edc369075de63e6f3a4eaade058c62af0df71",
        "html_url": "https://github.com/aio-libs/aiohttp/commit/259edc369075de63e6f3a4eaade058c62af0df71",
        "message": "[PR #9851/541d86d backport][3.10] Fix incorrect parsing of chunk extensions with the pure Python parser (#9853)",
        "files": [
            {
                "sha": "02541a92dd42936a02cb32c0aa377b0e29d88316",
                "filename": "CHANGES/9851.bugfix.rst",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/aio-libs/aiohttp/blob/259edc369075de63e6f3a4eaade058c62af0df71/CHANGES%2F9851.bugfix.rst",
                "raw_url": "https://github.com/aio-libs/aiohttp/raw/259edc369075de63e6f3a4eaade058c62af0df71/CHANGES%2F9851.bugfix.rst",
                "contents_url": "https://api.github.com/repos/aio-libs/aiohttp/contents/CHANGES%2F9851.bugfix.rst?ref=259edc369075de63e6f3a4eaade058c62af0df71",
                "patch": "@@ -0,0 +1 @@\n+Fixed incorrect parsing of chunk extensions with the pure Python parser -- by :user:`bdraco`."
            },
            {
                "sha": "9fc7e8a2c8b30c31f2db44a44d753c69957e6bb6",
                "filename": "aiohttp/http_parser.py",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/aio-libs/aiohttp/blob/259edc369075de63e6f3a4eaade058c62af0df71/aiohttp%2Fhttp_parser.py",
                "raw_url": "https://github.com/aio-libs/aiohttp/raw/259edc369075de63e6f3a4eaade058c62af0df71/aiohttp%2Fhttp_parser.py",
                "contents_url": "https://api.github.com/repos/aio-libs/aiohttp/contents/aiohttp%2Fhttp_parser.py?ref=259edc369075de63e6f3a4eaade058c62af0df71",
                "patch": "@@ -845,6 +845,13 @@ def feed_data(\n                         i = chunk.find(CHUNK_EXT, 0, pos)\n                         if i >= 0:\n                             size_b = chunk[:i]  # strip chunk-extensions\n+                            # Verify no LF in the chunk-extension\n+                            if b\"\\n\" in (ext := chunk[i:pos]):\n+                                exc = BadHttpMessage(\n+                                    f\"Unexpected LF in chunk-extension: {ext!r}\"\n+                                )\n+                                set_exception(self.payload, exc)\n+                                raise exc\n                         else:\n                             size_b = chunk[:pos]\n "
            },
            {
                "sha": "c74c1697e65962ba545862db3875b1935201c33a",
                "filename": "tests/test_http_parser.py",
                "status": "modified",
                "additions": 50,
                "deletions": 1,
                "changes": 51,
                "blob_url": "https://github.com/aio-libs/aiohttp/blob/259edc369075de63e6f3a4eaade058c62af0df71/tests%2Ftest_http_parser.py",
                "raw_url": "https://github.com/aio-libs/aiohttp/raw/259edc369075de63e6f3a4eaade058c62af0df71/tests%2Ftest_http_parser.py",
                "contents_url": "https://api.github.com/repos/aio-libs/aiohttp/contents/tests%2Ftest_http_parser.py?ref=259edc369075de63e6f3a4eaade058c62af0df71",
                "patch": "@@ -13,6 +13,7 @@\n \n import aiohttp\n from aiohttp import http_exceptions, streams\n+from aiohttp.base_protocol import BaseProtocol\n from aiohttp.http_parser import (\n     NO_EXTENSIONS,\n     DeflateBuffer,\n@@ -1477,7 +1478,55 @@ async def test_parse_chunked_payload_split_chunks(response: Any) -> None:\n     assert await reader.read() == b\"firstsecond\"\n \n \n-def test_partial_url(parser: Any) -> None:\n+@pytest.mark.skipif(NO_EXTENSIONS, reason=\"Only tests C parser.\")\n+async def test_parse_chunked_payload_with_lf_in_extensions_c_parser(\n+    loop: asyncio.AbstractEventLoop, protocol: BaseProtocol\n+) -> None:\n+    \"\"\"Test the C-parser with a chunked payload that has a LF in the chunk extensions.\"\"\"\n+    # The C parser will raise a BadHttpMessage from feed_data\n+    parser = HttpRequestParserC(\n+        protocol,\n+        loop,\n+        2**16,\n+        max_line_size=8190,\n+        max_field_size=8190,\n+    )\n+    payload = (\n+        b\"GET / HTTP/1.1\\r\\nHost: localhost:5001\\r\\n\"\n+        b\"Transfer-Encoding: chunked\\r\\n\\r\\n2;\\nxx\\r\\n4c\\r\\n0\\r\\n\\r\\n\"\n+        b\"GET /admin HTTP/1.1\\r\\nHost: localhost:5001\\r\\n\"\n+        b\"Transfer-Encoding: chunked\\r\\n\\r\\n0\\r\\n\\r\\n\"\n+    )\n+    with pytest.raises(http_exceptions.BadHttpMessage, match=\"\\\\\\\\nxx\"):\n+        parser.feed_data(payload)\n+\n+\n+async def test_parse_chunked_payload_with_lf_in_extensions_py_parser(\n+    loop: asyncio.AbstractEventLoop, protocol: BaseProtocol\n+) -> None:\n+    \"\"\"Test the py-parser with a chunked payload that has a LF in the chunk extensions.\"\"\"\n+    # The py parser will not raise the BadHttpMessage directly, but instead\n+    # it will set the exception on the StreamReader.\n+    parser = HttpRequestParserPy(\n+        protocol,\n+        loop,\n+        2**16,\n+        max_line_size=8190,\n+        max_field_size=8190,\n+    )\n+    payload = (\n+        b\"GET / HTTP/1.1\\r\\nHost: localhost:5001\\r\\n\"\n+        b\"Transfer-Encoding: chunked\\r\\n\\r\\n2;\\nxx\\r\\n4c\\r\\n0\\r\\n\\r\\n\"\n+        b\"GET /admin HTTP/1.1\\r\\nHost: localhost:5001\\r\\n\"\n+        b\"Transfer-Encoding: chunked\\r\\n\\r\\n0\\r\\n\\r\\n\"\n+    )\n+    messages, _, _ = parser.feed_data(payload)\n+    reader = messages[0][1]\n+    assert isinstance(reader.exception(), http_exceptions.BadHttpMessage)\n+    assert \"\\\\nxx\" in str(reader.exception())\n+\n+\n+def test_partial_url(parser: HttpRequestParser) -> None:\n     messages, upgrade, tail = parser.feed_data(b\"GET /te\")\n     assert len(messages) == 0\n     messages, upgrade, tail = parser.feed_data(b\"st HTTP/1.1\\r\\n\\r\\n\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/aio-libs/aiohttp/commits/bc15db61615079d1b6327ba42c682f758fa96936",
        "url": "https://api.github.com/repos/aio-libs/aiohttp/commits/bc15db61615079d1b6327ba42c682f758fa96936",
        "html_url": "https://github.com/aio-libs/aiohttp/commit/bc15db61615079d1b6327ba42c682f758fa96936",
        "message": "[PR #9852/249855a backport][3.10] Fix system routes polluting the middleware cache (#9855)",
        "files": [
            {
                "sha": "b459d08478bff234f8260d3adf3b217cf1b621d8",
                "filename": "CHANGES/9852.bugfix.rst",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/aio-libs/aiohttp/blob/bc15db61615079d1b6327ba42c682f758fa96936/CHANGES%2F9852.bugfix.rst",
                "raw_url": "https://github.com/aio-libs/aiohttp/raw/bc15db61615079d1b6327ba42c682f758fa96936/CHANGES%2F9852.bugfix.rst",
                "contents_url": "https://api.github.com/repos/aio-libs/aiohttp/contents/CHANGES%2F9852.bugfix.rst?ref=bc15db61615079d1b6327ba42c682f758fa96936",
                "patch": "@@ -0,0 +1 @@\n+Fixed system routes polluting the middleware cache -- by :user:`bdraco`."
            },
            {
                "sha": "81a848335320c8e95c3e47a6539e77cd114d4296",
                "filename": "aiohttp/web_app.py",
                "status": "modified",
                "additions": 11,
                "deletions": 3,
                "changes": 14,
                "blob_url": "https://github.com/aio-libs/aiohttp/blob/bc15db61615079d1b6327ba42c682f758fa96936/aiohttp%2Fweb_app.py",
                "raw_url": "https://github.com/aio-libs/aiohttp/raw/bc15db61615079d1b6327ba42c682f758fa96936/aiohttp%2Fweb_app.py",
                "contents_url": "https://api.github.com/repos/aio-libs/aiohttp/contents/aiohttp%2Fweb_app.py?ref=bc15db61615079d1b6327ba42c682f758fa96936",
                "patch": "@@ -54,6 +54,7 @@\n     MaskDomain,\n     MatchedSubAppResource,\n     PrefixedSubAppResource,\n+    SystemRoute,\n     UrlDispatcher,\n )\n \n@@ -79,7 +80,6 @@\n _Resource = TypeVar(\"_Resource\", bound=AbstractResource)\n \n \n-@lru_cache(None)\n def _build_middlewares(\n     handler: Handler, apps: Tuple[\"Application\", ...]\n ) -> Callable[[Request], Awaitable[StreamResponse]]:\n@@ -90,6 +90,9 @@ def _build_middlewares(\n     return handler\n \n \n+_cached_build_middleware = lru_cache(maxsize=1024)(_build_middlewares)\n+\n+\n class Application(MutableMapping[Union[str, AppKey[Any]], Any]):\n     ATTRS = frozenset(\n         [\n@@ -544,8 +547,13 @@ async def _handle(self, request: Request) -> StreamResponse:\n         handler = match_info.handler\n \n         if self._run_middlewares:\n-            if not self._has_legacy_middlewares:\n-                handler = _build_middlewares(handler, match_info.apps)\n+            # If its a SystemRoute, don't cache building the middlewares since\n+            # they are constructed for every MatchInfoError as a new handler\n+            # is made each time.\n+            if not self._has_legacy_middlewares and not isinstance(\n+                match_info.route, SystemRoute\n+            ):\n+                handler = _cached_build_middleware(handler, match_info.apps)\n             else:\n                 for app in match_info.apps[::-1]:\n                     for m, new_style in app._middlewares_handlers:  # type: ignore[union-attr]"
            },
            {
                "sha": "13acc589da97328781efd43c56e61a51f529026a",
                "filename": "tests/test_web_middleware.py",
                "status": "modified",
                "additions": 27,
                "deletions": 2,
                "changes": 29,
                "blob_url": "https://github.com/aio-libs/aiohttp/blob/bc15db61615079d1b6327ba42c682f758fa96936/tests%2Ftest_web_middleware.py",
                "raw_url": "https://github.com/aio-libs/aiohttp/raw/bc15db61615079d1b6327ba42c682f758fa96936/tests%2Ftest_web_middleware.py",
                "contents_url": "https://api.github.com/repos/aio-libs/aiohttp/contents/tests%2Ftest_web_middleware.py?ref=bc15db61615079d1b6327ba42c682f758fa96936",
                "patch": "@@ -1,10 +1,11 @@\n import re\n-from typing import Any\n+from typing import Any, NoReturn\n \n import pytest\n from yarl import URL\n \n-from aiohttp import web\n+from aiohttp import web, web_app\n+from aiohttp.pytest_plugin import AiohttpClient\n from aiohttp.typedefs import Handler\n \n \n@@ -520,3 +521,27 @@ async def call(self, request, handler: Handler):\n     assert 201 == resp.status\n     txt = await resp.text()\n     assert \"OK[new style middleware]\" == txt\n+\n+\n+async def test_middleware_does_not_leak(aiohttp_client: AiohttpClient) -> None:\n+    async def any_handler(request: web.Request) -> NoReturn:\n+        assert False\n+\n+    class Middleware:\n+        @web.middleware\n+        async def call(\n+            self, request: web.Request, handler: Handler\n+        ) -> web.StreamResponse:\n+            return await handler(request)\n+\n+    app = web.Application()\n+    app.router.add_route(\"POST\", \"/any\", any_handler)\n+    app.middlewares.append(Middleware().call)\n+\n+    client = await aiohttp_client(app)\n+\n+    web_app._cached_build_middleware.cache_clear()\n+    for _ in range(10):\n+        resp = await client.get(\"/any\")\n+        assert resp.status == 405\n+    assert web_app._cached_build_middleware.cache_info().currsize < 10"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cobbler/cobbler/commits/e19717623c10b29e7466ed4ab23515a94beb2dda",
        "url": "https://api.github.com/repos/cobbler/cobbler/commits/e19717623c10b29e7466ed4ab23515a94beb2dda",
        "html_url": "https://github.com/cobbler/cobbler/commit/e19717623c10b29e7466ed4ab23515a94beb2dda",
        "message": "Merge commit from fork\n\nXML-RPC: Prevent privilege escalation from none to admin",
        "files": [
            {
                "sha": "7882d80b9e18d41358a7a8427b9b4137afee4ac8",
                "filename": "cobbler/cobblerd.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/cobbler/cobbler/blob/e19717623c10b29e7466ed4ab23515a94beb2dda/cobbler%2Fcobblerd.py",
                "raw_url": "https://github.com/cobbler/cobbler/raw/e19717623c10b29e7466ed4ab23515a94beb2dda/cobbler%2Fcobblerd.py",
                "contents_url": "https://api.github.com/repos/cobbler/cobbler/contents/cobbler%2Fcobblerd.py?ref=e19717623c10b29e7466ed4ab23515a94beb2dda",
                "patch": "@@ -46,8 +46,8 @@ def regen_ss_file() -> None:\n     ssfile = \"/var/lib/cobbler/web.ss\"\n     data = os.urandom(512)\n \n-    with open(ssfile, \"wb\", 0o660) as ss_file_fd:\n-        ss_file_fd.write(binascii.hexlify(data))\n+    with open(ssfile, \"w\", 0o660, encoding=\"UTF-8\") as ss_file_fd:\n+        ss_file_fd.write(str(binascii.hexlify(data)))\n \n     http_user = \"apache\"\n     family = utils.get_family()"
            },
            {
                "sha": "b4e50511e310b8ca577083882122346459db7ef8",
                "filename": "cobbler/remote.py",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/cobbler/cobbler/blob/e19717623c10b29e7466ed4ab23515a94beb2dda/cobbler%2Fremote.py",
                "raw_url": "https://github.com/cobbler/cobbler/raw/e19717623c10b29e7466ed4ab23515a94beb2dda/cobbler%2Fremote.py",
                "contents_url": "https://api.github.com/repos/cobbler/cobbler/contents/cobbler%2Fremote.py?ref=e19717623c10b29e7466ed4ab23515a94beb2dda",
                "patch": "@@ -3661,6 +3661,8 @@ def login(self, login_user: str, login_password: str) -> str:\n         \"\"\"\n         # if shared secret access is requested, don't bother hitting the auth plugin\n         if login_user == \"\":\n+            if self.shared_secret == -1:\n+                raise ValueError(\"login failed(<DIRECT>)\")\n             if login_password == self.shared_secret:\n                 return self.__make_token(\"<DIRECT>\")\n             raise ValueError(\"login failed due to missing username!\")"
            },
            {
                "sha": "830c39d2d16b9161694adb68f8f58807975435f1",
                "filename": "cobbler/utils/__init__.py",
                "status": "modified",
                "additions": 2,
                "deletions": 3,
                "changes": 5,
                "blob_url": "https://github.com/cobbler/cobbler/blob/e19717623c10b29e7466ed4ab23515a94beb2dda/cobbler%2Futils%2F__init__.py",
                "raw_url": "https://github.com/cobbler/cobbler/raw/e19717623c10b29e7466ed4ab23515a94beb2dda/cobbler%2Futils%2F__init__.py",
                "contents_url": "https://api.github.com/repos/cobbler/cobbler/contents/cobbler%2Futils%2F__init__.py?ref=e19717623c10b29e7466ed4ab23515a94beb2dda",
                "patch": "@@ -1026,13 +1026,12 @@ def get_shared_secret() -> Union[str, int]:\n \n     :return: The Cobbler secret which enables full access to Cobbler.\n     \"\"\"\n-\n     try:\n-        with open(\"/var/lib/cobbler/web.ss\", \"rb\", encoding=\"utf-8\") as web_secret_fd:\n+        with open(\"/var/lib/cobbler/web.ss\", \"r\", encoding=\"UTF-8\") as web_secret_fd:\n             data = web_secret_fd.read()\n     except Exception:\n         return -1\n-    return str(data).strip()\n+    return data\n \n \n def local_get_cobbler_api_url() -> str:"
            },
            {
                "sha": "cd5c834aa49a61d059773852d90fde15d76cb9f7",
                "filename": "tests/utils/utils_test.py",
                "status": "modified",
                "additions": 24,
                "deletions": 3,
                "changes": 27,
                "blob_url": "https://github.com/cobbler/cobbler/blob/e19717623c10b29e7466ed4ab23515a94beb2dda/tests%2Futils%2Futils_test.py",
                "raw_url": "https://github.com/cobbler/cobbler/raw/e19717623c10b29e7466ed4ab23515a94beb2dda/tests%2Futils%2Futils_test.py",
                "contents_url": "https://api.github.com/repos/cobbler/cobbler/contents/tests%2Futils%2Futils_test.py?ref=e19717623c10b29e7466ed4ab23515a94beb2dda",
                "patch": "@@ -1,9 +1,11 @@\n+import binascii\n import datetime\n import os\n import re\n import time\n from pathlib import Path\n from threading import Thread\n+from typing import TYPE_CHECKING, Any\n \n import pytest\n from netaddr.ip import IPAddress\n@@ -13,6 +15,9 @@\n \n from tests.conftest import does_not_raise\n \n+if TYPE_CHECKING:\n+    from pytest_mock import MockerFixture\n+\n \n def test_pretty_hex():\n     # Arrange\n@@ -411,15 +416,31 @@ def test_get_supported_system_boot_loaders():\n     assert result == [\"grub\", \"pxe\", \"ipxe\"]\n \n \n-def test_get_shared_secret():\n+@pytest.mark.parametrize(\"web_ss_exists\", [True, False])\n+def test_get_shared_secret(mocker: \"MockerFixture\", web_ss_exists: bool):\n     # Arrange\n-    # TODO: Test the case where the file is there.\n+    open_mock = mocker.mock_open()\n+    random_data = binascii.hexlify(os.urandom(512)).decode()\n+    mock_web_ss = mocker.mock_open(read_data=random_data)\n+\n+    def mock_open(*args: Any, **kwargs: Any):\n+        if not web_ss_exists:\n+            open_mock.side_effect = FileNotFoundError\n+            return open_mock(*args, **kwargs)\n+        if args[0] == \"/var/lib/cobbler/web.ss\":\n+            return mock_web_ss(*args, **kwargs)\n+        return open_mock(*args, **kwargs)\n+\n+    mocker.patch(\"builtins.open\", mock_open)\n \n     # Act\n     result = utils.get_shared_secret()\n \n     # Assert\n-    assert result == -1\n+    if web_ss_exists:\n+        assert result == random_data\n+    else:\n+        assert result == -1\n \n \n def test_local_get_cobbler_api_url():"
            },
            {
                "sha": "225179c3a19b1a9e4bd8f8effb5c6553924068ff",
                "filename": "tests/xmlrpcapi/miscellaneous_test.py",
                "status": "modified",
                "additions": 37,
                "deletions": 1,
                "changes": 38,
                "blob_url": "https://github.com/cobbler/cobbler/blob/e19717623c10b29e7466ed4ab23515a94beb2dda/tests%2Fxmlrpcapi%2Fmiscellaneous_test.py",
                "raw_url": "https://github.com/cobbler/cobbler/raw/e19717623c10b29e7466ed4ab23515a94beb2dda/tests%2Fxmlrpcapi%2Fmiscellaneous_test.py",
                "contents_url": "https://api.github.com/repos/cobbler/cobbler/contents/tests%2Fxmlrpcapi%2Fmiscellaneous_test.py?ref=e19717623c10b29e7466ed4ab23515a94beb2dda",
                "patch": "@@ -6,12 +6,13 @@\n import os\n import pathlib\n import time\n-from typing import Any, Callable, Dict, List, Union\n+from typing import Any, Callable, Dict, List, Union, TYPE_CHECKING\n \n import pytest\n \n from cobbler.remote import CobblerXMLRPCInterface\n from cobbler.utils import get_shared_secret\n+from tests.conftest import does_not_raise\n \n \n def test_clear_system_logs(\n@@ -442,6 +443,41 @@ def test_is_autoinstall_in_use(\n     assert not result\n \n \n+@pytest.mark.parametrize(\n+    \"input_username,input_password,expected_result,expected_exception,web_ss_exists\",\n+    [\n+        (\"cobbler\", \"cobbler\", True, does_not_raise(), True),\n+        (\"cobbler\", \"incorrect-password\", True, pytest.raises(ValueError), True),\n+        (\"\", \"doesnt-matter\", True, pytest.raises(ValueError), True),\n+        (\"\", \"my-random-web-ss\", True, does_not_raise(), True),\n+        (\"\", \"my-random-web-ss\", True, pytest.raises(ValueError), False),\n+    ],\n+)\n+def test_login(\n+    remote: CobblerXMLRPCInterface,\n+    input_username: str,\n+    input_password: str,\n+    expected_result: Any,\n+    expected_exception: Any,\n+    web_ss_exists: bool\n+):\n+    \"\"\"\n+    Assert that the login is working successfully with correct and incorrect credentials.\n+    \"\"\"\n+    # Arrange\n+    if web_ss_exists:\n+        remote.shared_secret = \"my-random-web-ss\"\n+    else:\n+        remote.shared_secret = -1\n+\n+    # Act\n+    with expected_exception:\n+        token = remote.login(input_username, input_password)\n+\n+        # Assert\n+        assert remote.token_check(token) == expected_result\n+\n+\n def test_logout(remote: CobblerXMLRPCInterface):\n     \"\"\"\n     Assert that any action with a token is not successful after using the \"logout\" method to invalidate the token."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/cobbler/cobbler/commits/32c5cada013dc8daa7320a8eda9932c2814742b0",
        "url": "https://api.github.com/repos/cobbler/cobbler/commits/32c5cada013dc8daa7320a8eda9932c2814742b0",
        "html_url": "https://github.com/cobbler/cobbler/commit/32c5cada013dc8daa7320a8eda9932c2814742b0",
        "message": "Use utf-8 encoding for md5 handling and web.ss data.",
        "files": [
            {
                "sha": "6833559a88d7e2388fb2f55c270f8b8152c50c65",
                "filename": "cobbler/modules/authn_configfile.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/cobbler/cobbler/blob/32c5cada013dc8daa7320a8eda9932c2814742b0/cobbler%2Fmodules%2Fauthn_configfile.py",
                "raw_url": "https://github.com/cobbler/cobbler/raw/32c5cada013dc8daa7320a8eda9932c2814742b0/cobbler%2Fmodules%2Fauthn_configfile.py",
                "contents_url": "https://api.github.com/repos/cobbler/cobbler/contents/cobbler%2Fmodules%2Fauthn_configfile.py?ref=32c5cada013dc8daa7320a8eda9932c2814742b0",
                "patch": "@@ -37,7 +37,7 @@ def __parse_storage():\n \n     if not os.path.exists(\"/etc/cobbler/users.digest\"):\n         return []\n-    fd = open(\"/etc/cobbler/users.digest\")\n+    fd = open(\"/etc/cobbler/users.digest\", encoding='utf-8')\n     data = fd.read()\n     fd.close()\n     results = []"
            },
            {
                "sha": "c78b69faaae86a09700a5fcfa61dc67832b82e59",
                "filename": "cobbler/utils.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/cobbler/cobbler/blob/32c5cada013dc8daa7320a8eda9932c2814742b0/cobbler%2Futils.py",
                "raw_url": "https://github.com/cobbler/cobbler/raw/32c5cada013dc8daa7320a8eda9932c2814742b0/cobbler%2Futils.py",
                "contents_url": "https://api.github.com/repos/cobbler/cobbler/contents/cobbler%2Futils.py?ref=32c5cada013dc8daa7320a8eda9932c2814742b0",
                "patch": "@@ -55,7 +55,7 @@\n \n \n def md5(key):\n-    return hashlib.md5(key)\n+    return hashlib.md5(key.encode('utf-8'))\n \n \n CHEETAH_ERROR_DISCLAIMER = \"\"\"\n@@ -1836,7 +1836,7 @@ def get_shared_secret():\n     \"\"\"\n \n     try:\n-        fd = open(\"/var/lib/cobbler/web.ss\", 'rb')\n+        fd = open(\"/var/lib/cobbler/web.ss\", 'rb', encoding='utf-8')\n         data = fd.read()\n     except:\n         return -1"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/glpi-project/glpi/commits/9be1466053f829680db318f7e7e5880d2d789c6d",
        "url": "https://api.github.com/repos/glpi-project/glpi/commits/9be1466053f829680db318f7e7e5880d2d789c6d",
        "html_url": "https://github.com/glpi-project/glpi/commit/9be1466053f829680db318f7e7e5880d2d789c6d",
        "message": "Complexify emails enumeration from the forgot password feature",
        "files": [
            {
                "sha": "aecb2830308a02df8ec222b4f49465a8ec1f442a",
                "filename": "src/User.php",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/glpi-project/glpi/blob/9be1466053f829680db318f7e7e5880d2d789c6d/src%2FUser.php",
                "raw_url": "https://github.com/glpi-project/glpi/raw/9be1466053f829680db318f7e7e5880d2d789c6d/src%2FUser.php",
                "contents_url": "https://api.github.com/repos/glpi-project/glpi/contents/src%2FUser.php?ref=9be1466053f829680db318f7e7e5880d2d789c6d",
                "patch": "@@ -5728,6 +5728,10 @@ public function forgetPassword(string $email): bool\n             ]\n         ];\n \n+        // Randomly increase the response time to prevent an attacker to be able to detect whether\n+        // a notification was sent (a longer response time could correspond to a SMTP operation).\n+        sleep(rand(1, 3));\n+\n         // Try to find a single user matching the given email\n         if (!$this->getFromDBbyEmail($email, $condition)) {\n             $count = self::countUsersByEmail($email, $condition);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/OpenCTI-Platform/opencti/commits/f87d96918c63b0c3d3ebfbea6c789d48e2f56ad5",
        "url": "https://api.github.com/repos/OpenCTI-Platform/opencti/commits/f87d96918c63b0c3d3ebfbea6c789d48e2f56ad5",
        "html_url": "https://github.com/OpenCTI-Platform/opencti/commit/f87d96918c63b0c3d3ebfbea6c789d48e2f56ad5",
        "message": "[backend] Improve control of graphql schema introspection",
        "files": [
            {
                "sha": "5af2e8dfeb90868bcdf8b87c9ac3f32701a738cf",
                "filename": "opencti-platform/opencti-graphql/src/graphql/graphql.js",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/OpenCTI-Platform/opencti/blob/f87d96918c63b0c3d3ebfbea6c789d48e2f56ad5/opencti-platform%2Fopencti-graphql%2Fsrc%2Fgraphql%2Fgraphql.js",
                "raw_url": "https://github.com/OpenCTI-Platform/opencti/raw/f87d96918c63b0c3d3ebfbea6c789d48e2f56ad5/opencti-platform%2Fopencti-graphql%2Fsrc%2Fgraphql%2Fgraphql.js",
                "contents_url": "https://api.github.com/repos/OpenCTI-Platform/opencti/contents/opencti-platform%2Fopencti-graphql%2Fsrc%2Fgraphql%2Fgraphql.js?ref=f87d96918c63b0c3d3ebfbea6c789d48e2f56ad5",
                "patch": "@@ -1,5 +1,5 @@\n import { ApolloServer, UserInputError } from 'apollo-server-express';\n-import { ApolloServerPluginLandingPageGraphQLPlayground, ApolloServerPluginLandingPageDisabled } from 'apollo-server-core';\n+import { ApolloServerPluginLandingPageDisabled, ApolloServerPluginLandingPageGraphQLPlayground } from 'apollo-server-core';\n import { formatError as apolloFormatError } from 'apollo-errors';\n import { ApolloArmor } from '@escape.tech/graphql-armor';\n import { dissocPath } from 'ramda';\n@@ -8,7 +8,7 @@ import ConstraintDirectiveError from 'graphql-constraint-directive/lib/error';\n import { constraintDirectiveDocumentation, createApolloQueryValidationPlugin } from 'graphql-constraint-directive';\n import { GraphQLError } from 'graphql/error';\n import createSchema from './schema';\n-import conf, { basePath, DEV_MODE, PLAYGROUND_INTROSPECTION_DISABLED, ENABLED_TRACING, PLAYGROUND_ENABLED, GRAPHQL_ARMOR_ENABLED, logApp } from '../config/conf';\n+import conf, { basePath, DEV_MODE, ENABLED_TRACING, GRAPHQL_ARMOR_ENABLED, logApp, PLAYGROUND_ENABLED, PLAYGROUND_INTROSPECTION_DISABLED } from '../config/conf';\n import { authenticateUserFromRequest, userWithOrigin } from '../domain/user';\n import { ForbiddenAccess, ValidationError } from '../config/errors';\n import loggerPlugin from './loggerPlugin';\n@@ -80,11 +80,10 @@ const createApolloServer = () => {\n   const playgroundPlugin = ApolloServerPluginLandingPageGraphQLPlayground(playgroundOptions);\n   apolloPlugins.push(PLAYGROUND_ENABLED ? playgroundPlugin : ApolloServerPluginLandingPageDisabled());\n   // Schema introspection must be accessible only for auth users.\n-  const introspectionPatterns = ['__schema {', '__schema(', '__type {', '__type('];\n   const secureIntrospectionPlugin = {\n     requestDidStart: ({ request, context }) => {\n-      // Is schema introspection request\n-      if (introspectionPatterns.some((pattern) => request.query.includes(pattern))) {\n+      // Is schema have introspection request\n+      if (['__schema', '__type'].some((pattern) => request.query.includes(pattern))) {\n         // If introspection explicitly disabled or user is not authenticated\n         if (!PLAYGROUND_ENABLED || PLAYGROUND_INTROSPECTION_DISABLED || !context.user) {\n           throw ForbiddenAccess('GraphQL introspection not authorized!');"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38",
        "url": "https://api.github.com/repos/apache/tomcat/commits/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38",
        "html_url": "https://github.com/apache/tomcat/commit/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38",
        "message": "Fix JSP tag release\n\nBZ 69399: Fix regression caused by the improvement 69333 which caused\nthe tag release() to be called  when using tag pooling, and to be\nskipped when not using it.\nPatch submitted by Michal Sobkiewicz.",
        "files": [
            {
                "sha": "4798ffe4b7cf08ee3412679a31300c0d027c21f8",
                "filename": "java/org/apache/jasper/compiler/Generator.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/java%2Forg%2Fapache%2Fjasper%2Fcompiler%2FGenerator.java",
                "raw_url": "https://github.com/apache/tomcat/raw/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/java%2Forg%2Fapache%2Fjasper%2Fcompiler%2FGenerator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fjasper%2Fcompiler%2FGenerator.java?ref=8d1fc4733a06d1a03b9d644c57010f2ec5f0df38",
                "patch": "@@ -2352,7 +2352,7 @@ private void generateCustomEnd(Node.CustomTag n, String tagHandlerVar,\n                 out.print(\".reuse(\");\n                 out.print(tagHandlerVar);\n                 out.println(\");\");\n-\n+            } else {\n                 // Clean-up\n                 out.printin(\"org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(\");\n                 out.print(tagHandlerVar);"
            },
            {
                "sha": "892e398660b3be357316fc216d9c370954e2eb93",
                "filename": "test/org/apache/jasper/compiler/TestGenerator.java",
                "status": "modified",
                "additions": 51,
                "deletions": 0,
                "changes": 51,
                "blob_url": "https://github.com/apache/tomcat/blob/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/test%2Forg%2Fapache%2Fjasper%2Fcompiler%2FTestGenerator.java",
                "raw_url": "https://github.com/apache/tomcat/raw/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/test%2Forg%2Fapache%2Fjasper%2Fcompiler%2FTestGenerator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/test%2Forg%2Fapache%2Fjasper%2Fcompiler%2FTestGenerator.java?ref=8d1fc4733a06d1a03b9d644c57010f2ec5f0df38",
                "patch": "@@ -545,6 +545,25 @@ public void setData(String data) {\n         }\n     }\n \n+    private static boolean tagTesterTagReleaseReleased = false;\n+\n+    public static class TesterTagRelease extends TesterTag {\n+        private String data;\n+\n+        public String getData() {\n+            return data;\n+        }\n+\n+        public void setData(String data) {\n+            this.data = data;\n+        }\n+\n+        @Override\n+        public void release() {\n+            tagTesterTagReleaseReleased = true;\n+        }\n+    }\n+\n     public static class DataPropertyEditor extends PropertyEditorSupport {\n     }\n \n@@ -952,6 +971,38 @@ public void testBug65390() throws Exception {\n         Assert.assertEquals(body.toString(), HttpServletResponse.SC_OK, rc);\n     }\n \n+    @Test\n+    public void testTagReleaseWithPooling() throws Exception {\n+        doTestTagRelease(true);\n+    }\n+\n+    @Test\n+    public void testTagReleaseWithoutPooling() throws Exception {\n+        doTestTagRelease(false);\n+    }\n+\n+    public void doTestTagRelease(boolean enablePooling) throws Exception {\n+        tagTesterTagReleaseReleased = false;\n+        Tomcat tomcat = getTomcatInstance();\n+\n+        File appDir = new File(\"test/webapp\");\n+        Context ctxt = tomcat.addContext(\"\", appDir.getAbsolutePath());\n+        ctxt.addServletContainerInitializer(new JasperInitializer(), null);\n+\n+        Tomcat.initWebappDefaults(ctxt);\n+        Wrapper w = (Wrapper) ctxt.findChild(\"jsp\");\n+        w.addInitParameter(\"enablePooling\", String.valueOf(enablePooling));\n+\n+        tomcat.start();\n+\n+        getUrl(\"http://localhost:\" + getPort() + \"/jsp/generator/release.jsp\");\n+        if (enablePooling) {\n+            Assert.assertFalse(tagTesterTagReleaseReleased);\n+        } else {\n+            Assert.assertTrue(tagTesterTagReleaseReleased);\n+        }\n+    }\n+\n     private void doTestJsp(String jspName) throws Exception {\n         doTestJsp(jspName, HttpServletResponse.SC_OK);\n     }"
            },
            {
                "sha": "99b5f18f8cda717e03517be8356d96df7c235424",
                "filename": "test/webapp/WEB-INF/bugs.tld",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/tomcat/blob/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/test%2Fwebapp%2FWEB-INF%2Fbugs.tld",
                "raw_url": "https://github.com/apache/tomcat/raw/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/test%2Fwebapp%2FWEB-INF%2Fbugs.tld",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/test%2Fwebapp%2FWEB-INF%2Fbugs.tld?ref=8d1fc4733a06d1a03b9d644c57010f2ec5f0df38",
                "patch": "@@ -113,6 +113,11 @@\n     <tag-class>org.apache.jasper.compiler.TestGenerator$TesterTagA</tag-class>\n     <body-content>JSP</body-content>\n   </tag>\n+  <tag>\n+    <name>TesterTagRelease</name>\n+    <tag-class>org.apache.jasper.compiler.TestGenerator$TesterTagRelease</tag-class>\n+    <body-content>JSP</body-content>\n+  </tag>\n   <tag>\n     <name>TesterScriptingTag</name>\n     <tag-class>org.apache.jasper.compiler.TestGenerator$TesterScriptingTag</tag-class>"
            },
            {
                "sha": "ae2d1d19f09a41775d47585f0a5fc9931e02eb2b",
                "filename": "test/webapp/jsp/generator/release.jsp",
                "status": "added",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/apache/tomcat/blob/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/test%2Fwebapp%2Fjsp%2Fgenerator%2Frelease.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/test%2Fwebapp%2Fjsp%2Fgenerator%2Frelease.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/test%2Fwebapp%2Fjsp%2Fgenerator%2Frelease.jsp?ref=8d1fc4733a06d1a03b9d644c57010f2ec5f0df38",
                "patch": "@@ -0,0 +1,18 @@\n+<%--\n+ Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+--%>\n+<%@ taglib uri=\"http://tomcat.apache.org/bugs\" prefix=\"bugs\" %>\n+<bugs:TesterTagRelease/>\n\\ No newline at end of file"
            },
            {
                "sha": "6e5a27ba435306717afe6c6e4e12ca2f7638160d",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/apache/tomcat/blob/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/8d1fc4733a06d1a03b9d644c57010f2ec5f0df38/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=8d1fc4733a06d1a03b9d644c57010f2ec5f0df38",
                "patch": "@@ -169,6 +169,16 @@\n       </update>\n     </changelog>\n   </subsection>\n+  <subsection name=\"Jasper\">\n+    <changelog>\n+      <fix>\n+        <bug>69399</bug>: Fix regression caused by the improvement\n+        <bug>69333</bug> which caused the tag <code>release</code> to be called\n+        when using tag pooling, and to be skipped when not using it.\n+        Patch submitted by Michal Sobkiewicz. (remm)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Other\">\n     <changelog>\n       <update>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/9813c5dd3259183f659bbb83312a5cf673cc1ebf",
        "url": "https://api.github.com/repos/apache/tomcat/commits/9813c5dd3259183f659bbb83312a5cf673cc1ebf",
        "html_url": "https://github.com/apache/tomcat/commit/9813c5dd3259183f659bbb83312a5cf673cc1ebf",
        "message": "Fix JSP tag release\n\nBZ 69399: Fix regression caused by the improvement 69333 which caused\nthe tag release() to be called  when using tag pooling, and to be\nskipped when not using it.\nPatch submitted by Michal Sobkiewicz.",
        "files": [
            {
                "sha": "5df52c3d7adce8ed61a2601385cc3edea57b284a",
                "filename": "java/org/apache/jasper/compiler/Generator.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/9813c5dd3259183f659bbb83312a5cf673cc1ebf/java%2Forg%2Fapache%2Fjasper%2Fcompiler%2FGenerator.java",
                "raw_url": "https://github.com/apache/tomcat/raw/9813c5dd3259183f659bbb83312a5cf673cc1ebf/java%2Forg%2Fapache%2Fjasper%2Fcompiler%2FGenerator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fjasper%2Fcompiler%2FGenerator.java?ref=9813c5dd3259183f659bbb83312a5cf673cc1ebf",
                "patch": "@@ -2603,7 +2603,7 @@ private void generateCustomEnd(Node.CustomTag n, String tagHandlerVar,\n                 out.print(\".reuse(\");\n                 out.print(tagHandlerVar);\n                 out.println(\");\");\n-\n+            } else {\n                 // Clean-up\n                 out.printin(\"org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(\");\n                 out.print(tagHandlerVar);"
            },
            {
                "sha": "087936cd6eb2f1a2af4a67a84b14fa6627e8c58c",
                "filename": "test/org/apache/jasper/compiler/TestGenerator.java",
                "status": "modified",
                "additions": 51,
                "deletions": 0,
                "changes": 51,
                "blob_url": "https://github.com/apache/tomcat/blob/9813c5dd3259183f659bbb83312a5cf673cc1ebf/test%2Forg%2Fapache%2Fjasper%2Fcompiler%2FTestGenerator.java",
                "raw_url": "https://github.com/apache/tomcat/raw/9813c5dd3259183f659bbb83312a5cf673cc1ebf/test%2Forg%2Fapache%2Fjasper%2Fcompiler%2FTestGenerator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/test%2Forg%2Fapache%2Fjasper%2Fcompiler%2FTestGenerator.java?ref=9813c5dd3259183f659bbb83312a5cf673cc1ebf",
                "patch": "@@ -526,6 +526,25 @@ public void setData(String data) {\n         }\n     }\n \n+    private static boolean tagTesterTagReleaseReleased = false;\n+\n+    public static class TesterTagRelease extends TesterTag {\n+        private String data;\n+\n+        public String getData() {\n+            return data;\n+        }\n+\n+        public void setData(String data) {\n+            this.data = data;\n+        }\n+\n+        @Override\n+        public void release() {\n+            tagTesterTagReleaseReleased = true;\n+        }\n+    }\n+\n     public static class DataPropertyEditor extends PropertyEditorSupport {\n     }\n \n@@ -947,6 +966,38 @@ public void testBug65390() throws Exception {\n         Assert.assertEquals(body.toString(), HttpServletResponse.SC_OK, rc);\n     }\n \n+    @Test\n+    public void testTagReleaseWithPooling() throws Exception {\n+        doTestTagRelease(true);\n+    }\n+\n+    @Test\n+    public void testTagReleaseWithoutPooling() throws Exception {\n+        doTestTagRelease(false);\n+    }\n+\n+    public void doTestTagRelease(boolean enablePooling) throws Exception {\n+        tagTesterTagReleaseReleased = false;\n+        Tomcat tomcat = getTomcatInstance();\n+\n+        File appDir = new File(\"test/webapp\");\n+        Context ctxt = tomcat.addContext(\"\", appDir.getAbsolutePath());\n+        ctxt.addServletContainerInitializer(new JasperInitializer(), null);\n+\n+        Tomcat.initWebappDefaults(ctxt);\n+        Wrapper w = (Wrapper) ctxt.findChild(\"jsp\");\n+        w.addInitParameter(\"enablePooling\", String.valueOf(enablePooling));\n+\n+        tomcat.start();\n+\n+        getUrl(\"http://localhost:\" + getPort() + \"/jsp/generator/release.jsp\");\n+        if (enablePooling) {\n+            Assert.assertFalse(tagTesterTagReleaseReleased);\n+        } else {\n+            Assert.assertTrue(tagTesterTagReleaseReleased);\n+        }\n+    }\n+\n     private void doTestJsp(String jspName) throws Exception {\n         doTestJsp(jspName, HttpServletResponse.SC_OK);\n     }"
            },
            {
                "sha": "a4e496a833577e8461af9bcae803ae251851d3fc",
                "filename": "test/webapp/WEB-INF/bugs.tld",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/tomcat/blob/9813c5dd3259183f659bbb83312a5cf673cc1ebf/test%2Fwebapp%2FWEB-INF%2Fbugs.tld",
                "raw_url": "https://github.com/apache/tomcat/raw/9813c5dd3259183f659bbb83312a5cf673cc1ebf/test%2Fwebapp%2FWEB-INF%2Fbugs.tld",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/test%2Fwebapp%2FWEB-INF%2Fbugs.tld?ref=9813c5dd3259183f659bbb83312a5cf673cc1ebf",
                "patch": "@@ -108,6 +108,11 @@\n     <tag-class>org.apache.jasper.compiler.TestGenerator$TesterTagA</tag-class>\n     <body-content>JSP</body-content>\n   </tag>\n+  <tag>\n+    <name>TesterTagRelease</name>\n+    <tag-class>org.apache.jasper.compiler.TestGenerator$TesterTagRelease</tag-class>\n+    <body-content>JSP</body-content>\n+  </tag>\n   <tag>\n     <name>TesterScriptingTag</name>\n     <tag-class>org.apache.jasper.compiler.TestGenerator$TesterScriptingTag</tag-class>"
            },
            {
                "sha": "ae2d1d19f09a41775d47585f0a5fc9931e02eb2b",
                "filename": "test/webapp/jsp/generator/release.jsp",
                "status": "added",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/apache/tomcat/blob/9813c5dd3259183f659bbb83312a5cf673cc1ebf/test%2Fwebapp%2Fjsp%2Fgenerator%2Frelease.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/9813c5dd3259183f659bbb83312a5cf673cc1ebf/test%2Fwebapp%2Fjsp%2Fgenerator%2Frelease.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/test%2Fwebapp%2Fjsp%2Fgenerator%2Frelease.jsp?ref=9813c5dd3259183f659bbb83312a5cf673cc1ebf",
                "patch": "@@ -0,0 +1,18 @@\n+<%--\n+ Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+--%>\n+<%@ taglib uri=\"http://tomcat.apache.org/bugs\" prefix=\"bugs\" %>\n+<bugs:TesterTagRelease/>\n\\ No newline at end of file"
            },
            {
                "sha": "4d34ec5008b5e333967b5a232373945c78bca388",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/apache/tomcat/blob/9813c5dd3259183f659bbb83312a5cf673cc1ebf/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/9813c5dd3259183f659bbb83312a5cf673cc1ebf/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=9813c5dd3259183f659bbb83312a5cf673cc1ebf",
                "patch": "@@ -173,6 +173,16 @@\n       </fix>\n     </changelog>\n   </subsection>\n+  <subsection name=\"Jasper\">\n+    <changelog>\n+      <fix>\n+        <bug>69399</bug>: Fix regression caused by the improvement\n+        <bug>69333</bug> which caused the tag <code>release</code> to be called\n+        when using tag pooling, and to be skipped when not using it.\n+        Patch submitted by Michal Sobkiewicz. (remm)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Other\">\n     <changelog>\n       <update>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f",
        "url": "https://api.github.com/repos/apache/tomcat/commits/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f",
        "html_url": "https://github.com/apache/tomcat/commit/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f",
        "message": "Fix JSP tag release\n\nBZ 69399: Fix regression caused by the improvement 69333 which caused\nthe tag release() to be called  when using tag pooling, and to be\nskipped when not using it.\nPatch submitted by Michal Sobkiewicz.",
        "files": [
            {
                "sha": "57c3bcbfcb0d3868e4c4c300c5d4c595673cc4f2",
                "filename": "java/org/apache/jasper/compiler/Generator.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/java%2Forg%2Fapache%2Fjasper%2Fcompiler%2FGenerator.java",
                "raw_url": "https://github.com/apache/tomcat/raw/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/java%2Forg%2Fapache%2Fjasper%2Fcompiler%2FGenerator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fjasper%2Fcompiler%2FGenerator.java?ref=be8e32143a3159e78fe5463d09bb8e1b33bf2b1f",
                "patch": "@@ -2371,7 +2371,7 @@ private void generateCustomEnd(Node.CustomTag n, String tagHandlerVar,\n                 out.print(\".reuse(\");\n                 out.print(tagHandlerVar);\n                 out.println(\");\");\n-\n+            } else {\n                 // Clean-up\n                 out.printin(\"org.apache.jasper.runtime.JspRuntimeLibrary.releaseTag(\");\n                 out.print(tagHandlerVar);"
            },
            {
                "sha": "5dc746135b81b01b66a52daaa36cb5cea9af6e04",
                "filename": "test/org/apache/jasper/compiler/TestGenerator.java",
                "status": "modified",
                "additions": 51,
                "deletions": 0,
                "changes": 51,
                "blob_url": "https://github.com/apache/tomcat/blob/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/test%2Forg%2Fapache%2Fjasper%2Fcompiler%2FTestGenerator.java",
                "raw_url": "https://github.com/apache/tomcat/raw/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/test%2Forg%2Fapache%2Fjasper%2Fcompiler%2FTestGenerator.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/test%2Forg%2Fapache%2Fjasper%2Fcompiler%2FTestGenerator.java?ref=be8e32143a3159e78fe5463d09bb8e1b33bf2b1f",
                "patch": "@@ -546,6 +546,25 @@ public void setData(String data) {\n         }\n     }\n \n+    private static boolean tagTesterTagReleaseReleased = false;\n+\n+    public static class TesterTagRelease extends TesterTag {\n+        private String data;\n+\n+        public String getData() {\n+            return data;\n+        }\n+\n+        public void setData(String data) {\n+            this.data = data;\n+        }\n+\n+        @Override\n+        public void release() {\n+            tagTesterTagReleaseReleased = true;\n+        }\n+    }\n+\n     public static class DataPropertyEditor extends PropertyEditorSupport {\n     }\n \n@@ -967,6 +986,38 @@ public void testBug65390() throws Exception {\n         Assert.assertEquals(body.toString(), HttpServletResponse.SC_OK, rc);\n     }\n \n+    @Test\n+    public void testTagReleaseWithPooling() throws Exception {\n+        doTestTagRelease(true);\n+    }\n+\n+    @Test\n+    public void testTagReleaseWithoutPooling() throws Exception {\n+        doTestTagRelease(false);\n+    }\n+\n+    public void doTestTagRelease(boolean enablePooling) throws Exception {\n+        tagTesterTagReleaseReleased = false;\n+        Tomcat tomcat = getTomcatInstance();\n+\n+        File appDir = new File(\"test/webapp\");\n+        Context ctxt = tomcat.addContext(\"\", appDir.getAbsolutePath());\n+        ctxt.addServletContainerInitializer(new JasperInitializer(), null);\n+\n+        Tomcat.initWebappDefaults(ctxt);\n+        Wrapper w = (Wrapper) ctxt.findChild(\"jsp\");\n+        w.addInitParameter(\"enablePooling\", String.valueOf(enablePooling));\n+\n+        tomcat.start();\n+\n+        getUrl(\"http://localhost:\" + getPort() + \"/jsp/generator/release.jsp\");\n+        if (enablePooling) {\n+            Assert.assertFalse(tagTesterTagReleaseReleased);\n+        } else {\n+            Assert.assertTrue(tagTesterTagReleaseReleased);\n+        }\n+    }\n+\n     private void doTestJsp(String jspName) throws Exception {\n         doTestJsp(jspName, HttpServletResponse.SC_OK);\n     }"
            },
            {
                "sha": "99b5f18f8cda717e03517be8356d96df7c235424",
                "filename": "test/webapp/WEB-INF/bugs.tld",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/tomcat/blob/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/test%2Fwebapp%2FWEB-INF%2Fbugs.tld",
                "raw_url": "https://github.com/apache/tomcat/raw/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/test%2Fwebapp%2FWEB-INF%2Fbugs.tld",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/test%2Fwebapp%2FWEB-INF%2Fbugs.tld?ref=be8e32143a3159e78fe5463d09bb8e1b33bf2b1f",
                "patch": "@@ -113,6 +113,11 @@\n     <tag-class>org.apache.jasper.compiler.TestGenerator$TesterTagA</tag-class>\n     <body-content>JSP</body-content>\n   </tag>\n+  <tag>\n+    <name>TesterTagRelease</name>\n+    <tag-class>org.apache.jasper.compiler.TestGenerator$TesterTagRelease</tag-class>\n+    <body-content>JSP</body-content>\n+  </tag>\n   <tag>\n     <name>TesterScriptingTag</name>\n     <tag-class>org.apache.jasper.compiler.TestGenerator$TesterScriptingTag</tag-class>"
            },
            {
                "sha": "ae2d1d19f09a41775d47585f0a5fc9931e02eb2b",
                "filename": "test/webapp/jsp/generator/release.jsp",
                "status": "added",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/apache/tomcat/blob/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/test%2Fwebapp%2Fjsp%2Fgenerator%2Frelease.jsp",
                "raw_url": "https://github.com/apache/tomcat/raw/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/test%2Fwebapp%2Fjsp%2Fgenerator%2Frelease.jsp",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/test%2Fwebapp%2Fjsp%2Fgenerator%2Frelease.jsp?ref=be8e32143a3159e78fe5463d09bb8e1b33bf2b1f",
                "patch": "@@ -0,0 +1,18 @@\n+<%--\n+ Licensed to the Apache Software Foundation (ASF) under one or more\n+  contributor license agreements.  See the NOTICE file distributed with\n+  this work for additional information regarding copyright ownership.\n+  The ASF licenses this file to You under the Apache License, Version 2.0\n+  (the \"License\"); you may not use this file except in compliance with\n+  the License.  You may obtain a copy of the License at\n+\n+      http://www.apache.org/licenses/LICENSE-2.0\n+\n+  Unless required by applicable law or agreed to in writing, software\n+  distributed under the License is distributed on an \"AS IS\" BASIS,\n+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+  See the License for the specific language governing permissions and\n+  limitations under the License.\n+--%>\n+<%@ taglib uri=\"http://tomcat.apache.org/bugs\" prefix=\"bugs\" %>\n+<bugs:TesterTagRelease/>\n\\ No newline at end of file"
            },
            {
                "sha": "aeb6ba1e14209933c0ce5f6d52d07e8b8e5e731b",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/apache/tomcat/blob/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/be8e32143a3159e78fe5463d09bb8e1b33bf2b1f/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=be8e32143a3159e78fe5463d09bb8e1b33bf2b1f",
                "patch": "@@ -173,6 +173,16 @@\n       </fix>\n     </changelog>\n   </subsection>\n+  <subsection name=\"Jasper\">\n+    <changelog>\n+      <fix>\n+        <bug>69399</bug>: Fix regression caused by the improvement\n+        <bug>69333</bug> which caused the tag <code>release</code> to be called\n+        when using tag pooling, and to be skipped when not using it.\n+        Patch submitted by Michal Sobkiewicz. (remm)\n+      </fix>\n+    </changelog>\n+  </subsection>\n   <subsection name=\"Other\">\n     <changelog>\n       <update>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/django-cms/django-cms/commits/241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3",
        "url": "https://api.github.com/repos/django-cms/django-cms/commits/241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3",
        "html_url": "https://github.com/django-cms/django-cms/commit/241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3",
        "message": "fix: XSS vulnerability for page title (#8075)\n\n* Fix: XSS vulnerability for page title\r\n\r\n* fix linting\r\n\r\n---------\r\n\r\nCo-authored-by: Github Release Action <info@django-cms.org>",
        "files": [
            {
                "sha": "207a3d7950f1de1bdcef3d65018d27432668e89b",
                "filename": "cms/api.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/django-cms/django-cms/blob/241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3/cms%2Fapi.py",
                "raw_url": "https://github.com/django-cms/django-cms/raw/241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3/cms%2Fapi.py",
                "contents_url": "https://api.github.com/repos/django-cms/django-cms/contents/cms%2Fapi.py?ref=241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3",
                "patch": "@@ -136,7 +136,7 @@ def create_page(title, template, language, menu_title=None, slug=None,\n                 xframe_options=constants.X_FRAME_OPTIONS_INHERIT):\n     \"\"\"\n     Creates a :class:`cms.models.Page` instance and returns it. Also\n-    creates a :class:`cms.models.Title` instance for the specified\n+    creates a :class:`cms.models.PageContent` instance for the specified\n     language.\n \n     .. warning::"
            },
            {
                "sha": "675c4353cb6c561eb832929dfefbec8b338145ef",
                "filename": "cms/templatetags/cms_tags.py",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/django-cms/django-cms/blob/241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3/cms%2Ftemplatetags%2Fcms_tags.py",
                "raw_url": "https://github.com/django-cms/django-cms/raw/241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3/cms%2Ftemplatetags%2Fcms_tags.py",
                "contents_url": "https://api.github.com/repos/django-cms/django-cms/contents/cms%2Ftemplatetags%2Fcms_tags.py?ref=241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3",
                "patch": "@@ -441,9 +441,7 @@ def get_value(self, context, name, page_lookup):\n         if page and name in self.valid_attributes:\n             func = getattr(page, \"get_%s\" % name)\n             ret_val = func(language=lang, fallback=True)\n-            if name == 'page_title':\n-                 ret_val = strip_tags(ret_val)\n-            elif not isinstance(ret_val, datetime):\n+            if not isinstance(ret_val, datetime):\n                 ret_val = escape(ret_val)\n             return ret_val\n         return ''"
            },
            {
                "sha": "0f7ef16a696d7b30c73cffcee4713629f2ad1de1",
                "filename": "cms/tests/test_templatetags.py",
                "status": "modified",
                "additions": 8,
                "deletions": 5,
                "changes": 13,
                "blob_url": "https://github.com/django-cms/django-cms/blob/241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3/cms%2Ftests%2Ftest_templatetags.py",
                "raw_url": "https://github.com/django-cms/django-cms/raw/241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3/cms%2Ftests%2Ftest_templatetags.py",
                "contents_url": "https://api.github.com/repos/django-cms/django-cms/contents/cms%2Ftests%2Ftest_templatetags.py?ref=241d1cbe47a68f5d271ce4d27ad5e32e2c360ec3",
                "patch": "@@ -11,11 +11,10 @@\n from django.test import RequestFactory\n from django.test.utils import override_settings\n from django.utils.encoding import force_str\n-from django.utils.html import strip_tags\n+from django.utils.html import escape\n from django.utils.timezone import now\n from django.utils.translation import override as force_language\n from djangocms_text_ckeditor.cms_plugins import TextPlugin\n-from djangocms_text_ckeditor.models import Text\n from sekizai.context import SekizaiContext\n \n import cms\n@@ -139,6 +138,7 @@ def test_unicode_placeholder_name_fails_fast(self):\n     def test_page_attribute_tag_escapes_content(self):\n         script = '<script>alert(\"XSS\");</script>'\n         ampersand = 'Q&A page'\n+        partial = '\"><img src=x onerror=alert(1) \"'\n \n         class FakePage:\n             def __init__(self, title):\n@@ -159,11 +159,14 @@ def __init__(self, page):\n         template = '{% load cms_tags %}{% page_attribute page_title %}'\n         output_script = self.render_template_obj(template, {}, request_script)\n         output_ampersand = self.render_template_obj(template, {}, request_ampersand)\n+        output_partial = self.render_template_obj(template, {}, FakeRequest(FakePage(partial)))\n \n         self.assertNotEqual(script, output_script)\n-        self.assertEqual(ampersand, output_ampersand)\n-        self.assertEqual(strip_tags(script), output_script)\n-        self.assertEqual(strip_tags(ampersand), output_ampersand)\n+        self.assertNotEqual(ampersand, output_ampersand)\n+        self.assertNotEqual(partial, output_partial)\n+        self.assertEqual(escape(script), output_script)\n+        self.assertEqual(escape(ampersand), output_ampersand)\n+        self.assertEqual(escape(partial), output_partial)\n \n     def test_json_encoder(self):\n         self.assertEqual(json_filter(True), 'true')"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/9e840ccacb40881c03a03b1e0746bfba7369b3bd",
        "url": "https://api.github.com/repos/apache/tomcat/commits/9e840ccacb40881c03a03b1e0746bfba7369b3bd",
        "html_url": "https://github.com/apache/tomcat/commit/9e840ccacb40881c03a03b1e0746bfba7369b3bd",
        "message": "Split Stream.recycle() into replace() and recycle()\n\nEnsures recycle() is called no more than once.\n\nThere are some error conditions that now no longer call recycle() to\navoid the risk of duplicate calls to recycle if a Stream is being\nprocessed by a StreamProcessor at the same time Http2UpgradeHandler\ndetects a Stream level error.",
        "files": [
            {
                "sha": "a25ead24a7c0e8044eb63995886939189552dbe4",
                "filename": "java/org/apache/coyote/http2/LocalStrings.properties",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/tomcat/blob/9e840ccacb40881c03a03b1e0746bfba7369b3bd/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FLocalStrings.properties",
                "raw_url": "https://github.com/apache/tomcat/raw/9e840ccacb40881c03a03b1e0746bfba7369b3bd/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FLocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FLocalStrings.properties?ref=9e840ccacb40881c03a03b1e0746bfba7369b3bd",
                "patch": "@@ -109,7 +109,8 @@ stream.inputBuffer.signal=Data added to inBuffer when read thread is waiting. Si\n stream.inputBuffer.swallowUnread=Swallowing [{0}] bytes previously read into input stream buffer\n stream.notWritable=Connection [{0}], Stream [{1}], This stream is not writable\n stream.outputBuffer.flush.debug=Connection [{0}], Stream [{1}], flushing output with buffer at position [{2}], writeInProgress [{3}] and closed [{4}]\n-stream.recycle=Connection [{0}], Stream [{1}] has been recycled\n+stream.recycle.duplicate=Connection [{0}], Stream [{1}] Duplicate request to recycle the associated request and response has been ignored\n+stream.recycle.first=Connection [{0}], Stream [{1}] The associated request and response have been recycled\n stream.reset.fail=Connection [{0}], Stream [{1}], Failed to reset stream\n stream.reset.receive=Connection [{0}], Stream [{1}], Reset received due to [{2}]\n stream.reset.send=Connection [{0}], Stream [{1}], Reset sent due to [{2}]"
            },
            {
                "sha": "d0257ab17ee94e3708fcd9464be7233ef972cbc9",
                "filename": "java/org/apache/coyote/http2/Stream.java",
                "status": "modified",
                "additions": 41,
                "deletions": 9,
                "changes": 50,
                "blob_url": "https://github.com/apache/tomcat/blob/9e840ccacb40881c03a03b1e0746bfba7369b3bd/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStream.java",
                "raw_url": "https://github.com/apache/tomcat/raw/9e840ccacb40881c03a03b1e0746bfba7369b3bd/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStream.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStream.java?ref=9e840ccacb40881c03a03b1e0746bfba7369b3bd",
                "patch": "@@ -106,6 +106,9 @@ class Stream extends AbstractNonZeroStream implements HeaderEmitter {\n     private volatile int urgency = Priority.DEFAULT_URGENCY;\n     private volatile boolean incremental = Priority.DEFAULT_INCREMENTAL;\n \n+    private final Object recycledLock = new Object();\n+    private volatile boolean recycled = false;\n+\n \n     Stream(Integer identifier, Http2UpgradeHandler handler) {\n         this(identifier, handler, null);\n@@ -772,20 +775,15 @@ final void close(Http2Exception http2Exception) {\n         } else {\n             handler.closeConnection(http2Exception);\n         }\n-        recycle();\n+        replace();\n     }\n \n \n     /*\n-     * This method is called recycle for consistency with the rest of the Tomcat code base. Currently, it calls the\n-     * handler to replace this stream with an implementation that uses less memory. It does not fully recycle the Stream\n-     * ready for re-use since Stream objects are not re-used. This is useful because Stream instances are retained for a\n-     * period after the Stream closes.\n+     * This method calls the handler to replace this stream with an implementation that uses less memory. This is useful\n+     * because Stream instances are retained for a period after the Stream closes.\n      */\n-    final void recycle() {\n-        if (log.isTraceEnabled()) {\n-            log.trace(sm.getString(\"stream.recycle\", getConnectionId(), getIdAsString()));\n-        }\n+    final void replace() {\n         int remaining;\n         // May be null if stream was closed before any DATA frames were processed.\n         ByteBuffer inputByteBuffer = getInputByteBuffer(false);\n@@ -795,6 +793,40 @@ final void recycle() {\n             remaining = inputByteBuffer.remaining();\n         }\n         handler.replaceStream(this, new RecycledStream(getConnectionId(), getIdentifier(), state, remaining));\n+    }\n+\n+\n+    /*\n+     * This method is called recycle for consistency with the rest of the Tomcat code base. It does not recycle the\n+     * Stream since Stream objects are not re-used. It does recycle the request and response objects and ensures that\n+     * this is only done once.\n+     *\n+     * replace() should have been called before calling this method.\n+     *\n+     * It is important that this method is not called until any concurrent processing for the stream has completed. This\n+     * is currently achieved by:\n+     * - only the StreamProcessor calls this method\n+     * - the Http2UpgradeHandler does not call this method\n+     * - this method is called once the StreamProcessor considers the Stream closed\n+     *\n+     * In theory, the protection against duplicate calls is not required in this method (the code in StreamProcessor\n+     * should be sufficient) but it is implemented as precaution along with the WARN level logging.\n+     */\n+    final void recycle() {\n+        if (recycled) {\n+            log.warn(sm.getString(\"stream.recycle.duplicate\", getConnectionId(), getIdAsString()));\n+            return;\n+        }\n+        synchronized (recycledLock) {\n+            if (recycled) {\n+                log.warn(sm.getString(\"stream.recycle.duplicate\", getConnectionId(), getIdAsString()));\n+                return;\n+            }\n+            recycled = true;\n+        }\n+        if (log.isTraceEnabled()) {\n+            log.trace(sm.getString(\"stream.recycle.first\", getConnectionId(), getIdAsString()));\n+        }\n         coyoteRequest.recycle();\n         coyoteResponse.recycle();\n         handler.getProtocol().pushRequestAndResponse(coyoteRequest);"
            },
            {
                "sha": "daac6059b6d8a12ec17592e8edc6266669701599",
                "filename": "java/org/apache/coyote/http2/StreamProcessor.java",
                "status": "modified",
                "additions": 6,
                "deletions": 5,
                "changes": 11,
                "blob_url": "https://github.com/apache/tomcat/blob/9e840ccacb40881c03a03b1e0746bfba7369b3bd/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStreamProcessor.java",
                "raw_url": "https://github.com/apache/tomcat/raw/9e840ccacb40881c03a03b1e0746bfba7369b3bd/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStreamProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStreamProcessor.java?ref=9e840ccacb40881c03a03b1e0746bfba7369b3bd",
                "patch": "@@ -87,9 +87,9 @@ final void process(SocketEvent event) {\n             try {\n                 /*\n                  * In some scenarios, error handling may trigger multiple ERROR events for the same stream. The first\n-                 * ERROR event process will close the stream and recycle it. Once the stream has been recycled it should\n-                 * not be used for processing any further events. The check below ensures that this is the case. In\n-                 * particular, Stream.recycle() should not be called more than once per Stream.\n+                 * ERROR event processed will close the stream, replace it and recycle it. Once the stream has been\n+                 * replaced it should not be used for processing any further events. When it is known that processing is\n+                 * going to be a NO-OP, exit early.\n                  */\n                 if (!stream.equals(handler.getStream(stream.getIdAsInt()))) {\n                     return;\n@@ -130,8 +130,8 @@ final void process(SocketEvent event) {\n                             stream.close(se);\n                         } else {\n                             if (!stream.isActive()) {\n-                                // stream.close() will call recycle so only need it here\n-                                stream.recycle();\n+                                // Close calls replace() so need the same call here\n+                                stream.replace();\n                             }\n                         }\n                     }\n@@ -146,6 +146,7 @@ final void process(SocketEvent event) {\n                     state = SocketState.CLOSED;\n                 } finally {\n                     if (state == SocketState.CLOSED) {\n+                        stream.recycle();\n                         recycle();\n                     }\n                 }"
            },
            {
                "sha": "8b2c40f792532a599543a4e70be791ca4982a9dc",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/apache/tomcat/blob/9e840ccacb40881c03a03b1e0746bfba7369b3bd/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/9e840ccacb40881c03a03b1e0746bfba7369b3bd/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=9e840ccacb40881c03a03b1e0746bfba7369b3bd",
                "patch": "@@ -173,6 +173,12 @@\n         stream nor are trailer fields for an in progress stream swallowed if the\n         Connector is paused before the trailer fields are received. (markt)\n       </fix>\n+      <fix>\n+        Ensure the request and response are not recycled too soon for an HTTP/2\n+        stream when a stream level error is detected during the processing of\n+        incoming HTTP/2 frames. This could lead to incorrect processing times\n+        appearing in the access log. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Jasper\">"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/47307ee27abcdea2ee40e33897aca760083de46a",
        "url": "https://api.github.com/repos/apache/tomcat/commits/47307ee27abcdea2ee40e33897aca760083de46a",
        "html_url": "https://github.com/apache/tomcat/commit/47307ee27abcdea2ee40e33897aca760083de46a",
        "message": "Split Stream.recycle() into replace() and recycle()\n\nEnsures recycle() is called no more than once.\n\nThere are some error conditions that now no longer call recycle() to\navoid the risk of duplicate calls to recycle if a Stream is being\nprocessed by a StreamProcessor at the same time Http2UpgradeHandler\ndetects a Stream level error.",
        "files": [
            {
                "sha": "e1fd3528787f087df59e7a15e6cf6d1da34542ce",
                "filename": "java/org/apache/coyote/http2/LocalStrings.properties",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/tomcat/blob/47307ee27abcdea2ee40e33897aca760083de46a/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FLocalStrings.properties",
                "raw_url": "https://github.com/apache/tomcat/raw/47307ee27abcdea2ee40e33897aca760083de46a/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FLocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FLocalStrings.properties?ref=47307ee27abcdea2ee40e33897aca760083de46a",
                "patch": "@@ -109,7 +109,8 @@ stream.inputBuffer.signal=Data added to inBuffer when read thread is waiting. Si\n stream.inputBuffer.swallowUnread=Swallowing [{0}] bytes previously read into input stream buffer\n stream.notWritable=Connection [{0}], Stream [{1}], This stream is not writable\n stream.outputBuffer.flush.debug=Connection [{0}], Stream [{1}], flushing output with buffer at position [{2}], writeInProgress [{3}] and closed [{4}]\n-stream.recycle=Connection [{0}], Stream [{1}] has been recycled\n+stream.recycle.duplicate=Connection [{0}], Stream [{1}] Duplicate request to recycle the associated request and response has been ignored\n+stream.recycle.first=Connection [{0}], Stream [{1}] The associated request and response have been recycled\n stream.reset.fail=Connection [{0}], Stream [{1}], Failed to reset stream\n stream.reset.receive=Connection [{0}], Stream [{1}], Reset received due to [{2}]\n stream.reset.send=Connection [{0}], Stream [{1}], Reset sent due to [{2}]"
            },
            {
                "sha": "0384c513fe71e0d75001bab333ff755220fb5cab",
                "filename": "java/org/apache/coyote/http2/Stream.java",
                "status": "modified",
                "additions": 41,
                "deletions": 9,
                "changes": 50,
                "blob_url": "https://github.com/apache/tomcat/blob/47307ee27abcdea2ee40e33897aca760083de46a/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStream.java",
                "raw_url": "https://github.com/apache/tomcat/raw/47307ee27abcdea2ee40e33897aca760083de46a/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStream.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStream.java?ref=47307ee27abcdea2ee40e33897aca760083de46a",
                "patch": "@@ -110,6 +110,9 @@ class Stream extends AbstractNonZeroStream implements HeaderEmitter {\n     private volatile int urgency = Priority.DEFAULT_URGENCY;\n     private volatile boolean incremental = Priority.DEFAULT_INCREMENTAL;\n \n+    private final Object recycledLock = new Object();\n+    private volatile boolean recycled = false;\n+\n \n     Stream(Integer identifier, Http2UpgradeHandler handler) {\n         this(identifier, handler, null);\n@@ -784,20 +787,15 @@ final void close(Http2Exception http2Exception) {\n         } else {\n             handler.closeConnection(http2Exception);\n         }\n-        recycle();\n+        replace();\n     }\n \n \n     /*\n-     * This method is called recycle for consistency with the rest of the Tomcat code base. Currently, it calls the\n-     * handler to replace this stream with an implementation that uses less memory. It does not fully recycle the Stream\n-     * ready for re-use since Stream objects are not re-used. This is useful because Stream instances are retained for a\n-     * period after the Stream closes.\n+     * This method calls the handler to replace this stream with an implementation that uses less memory. This is useful\n+     * because Stream instances are retained for a period after the Stream closes.\n      */\n-    final void recycle() {\n-        if (log.isTraceEnabled()) {\n-            log.trace(sm.getString(\"stream.recycle\", getConnectionId(), getIdAsString()));\n-        }\n+    final void replace() {\n         int remaining;\n         // May be null if stream was closed before any DATA frames were processed.\n         ByteBuffer inputByteBuffer = getInputByteBuffer(false);\n@@ -807,6 +805,40 @@ final void recycle() {\n             remaining = inputByteBuffer.remaining();\n         }\n         handler.replaceStream(this, new RecycledStream(getConnectionId(), getIdentifier(), state, remaining));\n+    }\n+\n+\n+    /*\n+     * This method is called recycle for consistency with the rest of the Tomcat code base. It does not recycle the\n+     * Stream since Stream objects are not re-used. It does recycle the request and response objects and ensures that\n+     * this is only done once.\n+     *\n+     * replace() should have been called before calling this method.\n+     *\n+     * It is important that this method is not called until any concurrent processing for the stream has completed. This\n+     * is currently achieved by:\n+     * - only the StreamProcessor calls this method\n+     * - the Http2UpgradeHandler does not call this method\n+     * - this method is called once the StreamProcessor considers the Stream closed\n+     *\n+     * In theory, the protection against duplicate calls is not required in this method (the code in StreamProcessor\n+     * should be sufficient) but it is implemented as precaution along with the WARN level logging.\n+     */\n+    final void recycle() {\n+        if (recycled) {\n+            log.warn(sm.getString(\"stream.recycle.duplicate\", getConnectionId(), getIdAsString()));\n+            return;\n+        }\n+        synchronized (recycledLock) {\n+            if (recycled) {\n+                log.warn(sm.getString(\"stream.recycle.duplicate\", getConnectionId(), getIdAsString()));\n+                return;\n+            }\n+            recycled = true;\n+        }\n+        if (log.isTraceEnabled()) {\n+            log.trace(sm.getString(\"stream.recycle.first\", getConnectionId(), getIdAsString()));\n+        }\n         coyoteRequest.recycle();\n         coyoteResponse.recycle();\n         handler.getProtocol().pushRequestAndResponse(coyoteRequest);"
            },
            {
                "sha": "cf33d5ba9a2a4b48d477dd862e7fe9b6672be0dc",
                "filename": "java/org/apache/coyote/http2/StreamProcessor.java",
                "status": "modified",
                "additions": 6,
                "deletions": 5,
                "changes": 11,
                "blob_url": "https://github.com/apache/tomcat/blob/47307ee27abcdea2ee40e33897aca760083de46a/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStreamProcessor.java",
                "raw_url": "https://github.com/apache/tomcat/raw/47307ee27abcdea2ee40e33897aca760083de46a/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStreamProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStreamProcessor.java?ref=47307ee27abcdea2ee40e33897aca760083de46a",
                "patch": "@@ -87,9 +87,9 @@ final void process(SocketEvent event) {\n             try {\n                 /*\n                  * In some scenarios, error handling may trigger multiple ERROR events for the same stream. The first\n-                 * ERROR event process will close the stream and recycle it. Once the stream has been recycled it should\n-                 * not be used for processing any further events. The check below ensures that this is the case. In\n-                 * particular, Stream.recycle() should not be called more than once per Stream.\n+                 * ERROR event processed will close the stream, replace it and recycle it. Once the stream has been\n+                 * replaced it should not be used for processing any further events. When it is known that processing is\n+                 * going to be a NO-OP, exit early.\n                  */\n                 if (!stream.equals(handler.getStream(stream.getIdAsInt()))) {\n                     return;\n@@ -130,8 +130,8 @@ final void process(SocketEvent event) {\n                             stream.close(se);\n                         } else {\n                             if (!stream.isActive()) {\n-                                // stream.close() will call recycle so only need it here\n-                                stream.recycle();\n+                                // Close calls replace() so need the same call here\n+                                stream.replace();\n                             }\n                         }\n                     }\n@@ -146,6 +146,7 @@ final void process(SocketEvent event) {\n                     state = SocketState.CLOSED;\n                 } finally {\n                     if (state == SocketState.CLOSED) {\n+                        stream.recycle();\n                         recycle();\n                     }\n                 }"
            },
            {
                "sha": "5e72d13411e34397884b4dcc0ff332198300b367",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/apache/tomcat/blob/47307ee27abcdea2ee40e33897aca760083de46a/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/47307ee27abcdea2ee40e33897aca760083de46a/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=47307ee27abcdea2ee40e33897aca760083de46a",
                "patch": "@@ -164,6 +164,12 @@\n         stream nor are trailer fields for an in progress stream swallowed if the\n         Connector is paused before the trailer fields are received. (markt)\n       </fix>\n+      <fix>\n+        Ensure the request and response are not recycled too soon for an HTTP/2\n+        stream when a stream level error is detected during the processing of\n+        incoming HTTP/2 frames. This could lead to incorrect processing times\n+        appearing in the access log. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Jasper\">"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/146f94f87ea398fb592c7a20a5ccbef95e9dd72b",
        "url": "https://api.github.com/repos/apache/tomcat/commits/146f94f87ea398fb592c7a20a5ccbef95e9dd72b",
        "html_url": "https://github.com/apache/tomcat/commit/146f94f87ea398fb592c7a20a5ccbef95e9dd72b",
        "message": "Split Stream.recycle() into replace() and recycle()\n\nEnsures recycle() is called no more than once.\n\nThere are some error conditions that now no longer call recycle() to\navoid the risk of duplicate calls to recycle if a Stream is being\nprocessed by a StreamProcessor at the same time Http2UpgradeHandler\ndetects a Stream level error.",
        "files": [
            {
                "sha": "e1fd3528787f087df59e7a15e6cf6d1da34542ce",
                "filename": "java/org/apache/coyote/http2/LocalStrings.properties",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/apache/tomcat/blob/146f94f87ea398fb592c7a20a5ccbef95e9dd72b/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FLocalStrings.properties",
                "raw_url": "https://github.com/apache/tomcat/raw/146f94f87ea398fb592c7a20a5ccbef95e9dd72b/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FLocalStrings.properties",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FLocalStrings.properties?ref=146f94f87ea398fb592c7a20a5ccbef95e9dd72b",
                "patch": "@@ -109,7 +109,8 @@ stream.inputBuffer.signal=Data added to inBuffer when read thread is waiting. Si\n stream.inputBuffer.swallowUnread=Swallowing [{0}] bytes previously read into input stream buffer\n stream.notWritable=Connection [{0}], Stream [{1}], This stream is not writable\n stream.outputBuffer.flush.debug=Connection [{0}], Stream [{1}], flushing output with buffer at position [{2}], writeInProgress [{3}] and closed [{4}]\n-stream.recycle=Connection [{0}], Stream [{1}] has been recycled\n+stream.recycle.duplicate=Connection [{0}], Stream [{1}] Duplicate request to recycle the associated request and response has been ignored\n+stream.recycle.first=Connection [{0}], Stream [{1}] The associated request and response have been recycled\n stream.reset.fail=Connection [{0}], Stream [{1}], Failed to reset stream\n stream.reset.receive=Connection [{0}], Stream [{1}], Reset received due to [{2}]\n stream.reset.send=Connection [{0}], Stream [{1}], Reset sent due to [{2}]"
            },
            {
                "sha": "c8596933be0160548b5328b9219f6763e9bad6c2",
                "filename": "java/org/apache/coyote/http2/Stream.java",
                "status": "modified",
                "additions": 41,
                "deletions": 9,
                "changes": 50,
                "blob_url": "https://github.com/apache/tomcat/blob/146f94f87ea398fb592c7a20a5ccbef95e9dd72b/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStream.java",
                "raw_url": "https://github.com/apache/tomcat/raw/146f94f87ea398fb592c7a20a5ccbef95e9dd72b/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStream.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStream.java?ref=146f94f87ea398fb592c7a20a5ccbef95e9dd72b",
                "patch": "@@ -109,6 +109,9 @@ class Stream extends AbstractNonZeroStream implements HeaderEmitter {\n     private volatile int urgency = Priority.DEFAULT_URGENCY;\n     private volatile boolean incremental = Priority.DEFAULT_INCREMENTAL;\n \n+    private final Object recycledLock = new Object();\n+    private volatile boolean recycled = false;\n+\n \n     Stream(Integer identifier, Http2UpgradeHandler handler) {\n         this(identifier, handler, null);\n@@ -784,20 +787,15 @@ final void close(Http2Exception http2Exception) {\n         } else {\n             handler.closeConnection(http2Exception);\n         }\n-        recycle();\n+        replace();\n     }\n \n \n     /*\n-     * This method is called recycle for consistency with the rest of the Tomcat code base. Currently, it calls the\n-     * handler to replace this stream with an implementation that uses less memory. It does not fully recycle the Stream\n-     * ready for re-use since Stream objects are not re-used. This is useful because Stream instances are retained for a\n-     * period after the Stream closes.\n+     * This method calls the handler to replace this stream with an implementation that uses less memory. This is useful\n+     * because Stream instances are retained for a period after the Stream closes.\n      */\n-    final void recycle() {\n-        if (log.isTraceEnabled()) {\n-            log.trace(sm.getString(\"stream.recycle\", getConnectionId(), getIdAsString()));\n-        }\n+    final void replace() {\n         int remaining;\n         // May be null if stream was closed before any DATA frames were processed.\n         ByteBuffer inputByteBuffer = getInputByteBuffer(false);\n@@ -807,6 +805,40 @@ final void recycle() {\n             remaining = inputByteBuffer.remaining();\n         }\n         handler.replaceStream(this, new RecycledStream(getConnectionId(), getIdentifier(), state, remaining));\n+    }\n+\n+\n+    /*\n+     * This method is called recycle for consistency with the rest of the Tomcat code base. It does not recycle the\n+     * Stream since Stream objects are not re-used. It does recycle the request and response objects and ensures that\n+     * this is only done once.\n+     *\n+     * replace() should have been called before calling this method.\n+     *\n+     * It is important that this method is not called until any concurrent processing for the stream has completed. This\n+     * is currently achieved by:\n+     * - only the StreamProcessor calls this method\n+     * - the Http2UpgradeHandler does not call this method\n+     * - this method is called once the StreamProcessor considers the Stream closed\n+     *\n+     * In theory, the protection against duplicate calls is not required in this method (the code in StreamProcessor\n+     * should be sufficient) but it is implemented as precaution along with the WARN level logging.\n+     */\n+    final void recycle() {\n+        if (recycled) {\n+            log.warn(sm.getString(\"stream.recycle.duplicate\", getConnectionId(), getIdAsString()));\n+            return;\n+        }\n+        synchronized (recycledLock) {\n+            if (recycled) {\n+                log.warn(sm.getString(\"stream.recycle.duplicate\", getConnectionId(), getIdAsString()));\n+                return;\n+            }\n+            recycled = true;\n+        }\n+        if (log.isTraceEnabled()) {\n+            log.trace(sm.getString(\"stream.recycle.first\", getConnectionId(), getIdAsString()));\n+        }\n         coyoteRequest.recycle();\n         coyoteResponse.recycle();\n         handler.getProtocol().pushRequestAndResponse(coyoteRequest);"
            },
            {
                "sha": "caa3debea35ab43450af4f0f1ff3b7eb7d9387c7",
                "filename": "java/org/apache/coyote/http2/StreamProcessor.java",
                "status": "modified",
                "additions": 6,
                "deletions": 5,
                "changes": 11,
                "blob_url": "https://github.com/apache/tomcat/blob/146f94f87ea398fb592c7a20a5ccbef95e9dd72b/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStreamProcessor.java",
                "raw_url": "https://github.com/apache/tomcat/raw/146f94f87ea398fb592c7a20a5ccbef95e9dd72b/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStreamProcessor.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcoyote%2Fhttp2%2FStreamProcessor.java?ref=146f94f87ea398fb592c7a20a5ccbef95e9dd72b",
                "patch": "@@ -87,9 +87,9 @@ final void process(SocketEvent event) {\n             try {\n                 /*\n                  * In some scenarios, error handling may trigger multiple ERROR events for the same stream. The first\n-                 * ERROR event process will close the stream and recycle it. Once the stream has been recycled it should\n-                 * not be used for processing any further events. The check below ensures that this is the case. In\n-                 * particular, Stream.recycle() should not be called more than once per Stream.\n+                 * ERROR event processed will close the stream, replace it and recycle it. Once the stream has been\n+                 * replaced it should not be used for processing any further events. When it is known that processing is\n+                 * going to be a NO-OP, exit early.\n                  */\n                 if (!stream.equals(handler.getStream(stream.getIdAsInt()))) {\n                     return;\n@@ -130,8 +130,8 @@ final void process(SocketEvent event) {\n                             stream.close(se);\n                         } else {\n                             if (!stream.isActive()) {\n-                                // stream.close() will call recycle so only need it here\n-                                stream.recycle();\n+                                // Close calls replace() so need the same call here\n+                                stream.replace();\n                             }\n                         }\n                     }\n@@ -146,6 +146,7 @@ final void process(SocketEvent event) {\n                     state = SocketState.CLOSED;\n                 } finally {\n                     if (state == SocketState.CLOSED) {\n+                        stream.recycle();\n                         recycle();\n                     }\n                 }"
            },
            {
                "sha": "a2b6ee452f002c67d323b2fa11c102d0a940eb17",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/apache/tomcat/blob/146f94f87ea398fb592c7a20a5ccbef95e9dd72b/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/146f94f87ea398fb592c7a20a5ccbef95e9dd72b/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=146f94f87ea398fb592c7a20a5ccbef95e9dd72b",
                "patch": "@@ -173,6 +173,12 @@\n         stream nor are trailer fields for an in progress stream swallowed if the\n         Connector is paused before the trailer fields are received. (markt)\n       </fix>\n+      <fix>\n+        Ensure the request and response are not recycled too soon for an HTTP/2\n+        stream when a stream level error is detected during the processing of\n+        incoming HTTP/2 frames. This could lead to incorrect processing times\n+        appearing in the access log. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n   <subsection name=\"Jasper\">"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/7532f9dc4a8c37ec958f79dc82c4924a6c539223",
        "url": "https://api.github.com/repos/apache/tomcat/commits/7532f9dc4a8c37ec958f79dc82c4924a6c539223",
        "html_url": "https://github.com/apache/tomcat/commit/7532f9dc4a8c37ec958f79dc82c4924a6c539223",
        "message": "If the Jakarta Authentication fails with an exception, set a 500 status\n\nDepending on what fails where, the status may not be set or may be set\nincorrectly.",
        "files": [
            {
                "sha": "4388cd2e9e7a172f13fbc99339e5ef811d59f97c",
                "filename": "java/org/apache/catalina/authenticator/AuthenticatorBase.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/7532f9dc4a8c37ec958f79dc82c4924a6c539223/java%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FAuthenticatorBase.java",
                "raw_url": "https://github.com/apache/tomcat/raw/7532f9dc4a8c37ec958f79dc82c4924a6c539223/java%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FAuthenticatorBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FAuthenticatorBase.java?ref=7532f9dc4a8c37ec958f79dc82c4924a6c539223",
                "patch": "@@ -802,6 +802,8 @@ private boolean authenticateJaspic(Request request, Response response, JaspicSta\n             authStatus = state.serverAuthContext.validateRequest(state.messageInfo, client, null);\n         } catch (AuthException e) {\n             log.debug(sm.getString(\"authenticator.loginFail\"), e);\n+            // Need to explicitly set the return code as the ServerAuthContext may not have done.\n+            response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n             return false;\n         }\n "
            },
            {
                "sha": "3f9d8095f30e3dff22fa2925c3fe0b16c79bf878",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/tomcat/blob/7532f9dc4a8c37ec958f79dc82c4924a6c539223/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/7532f9dc4a8c37ec958f79dc82c4924a6c539223/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=7532f9dc4a8c37ec958f79dc82c4924a6c539223",
                "patch": "@@ -112,6 +112,11 @@\n         creates one <code>GenericPrincipal</code> in the <code>Subject</code>.\n         (markt)\n       </fix>\n+      <fix>\n+        If the Jakarta Authentication process fails with an Exception,\n+        explicitly set the HTTP response status to 500 as the\n+        <code>ServerAuthContext</code> may not have set it. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n </section>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/acc2f01395f895980f5d8a64573fcc1bade13369",
        "url": "https://api.github.com/repos/apache/tomcat/commits/acc2f01395f895980f5d8a64573fcc1bade13369",
        "html_url": "https://github.com/apache/tomcat/commit/acc2f01395f895980f5d8a64573fcc1bade13369",
        "message": "If the Jakarta Authentication fails with an exception, set a 500 status\n\nDepending on what fails where, the status may not be set or may be set\nincorrectly.",
        "files": [
            {
                "sha": "db467ba4e959e952afa6fb2da46d03ee666ae332",
                "filename": "java/org/apache/catalina/authenticator/AuthenticatorBase.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/acc2f01395f895980f5d8a64573fcc1bade13369/java%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FAuthenticatorBase.java",
                "raw_url": "https://github.com/apache/tomcat/raw/acc2f01395f895980f5d8a64573fcc1bade13369/java%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FAuthenticatorBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FAuthenticatorBase.java?ref=acc2f01395f895980f5d8a64573fcc1bade13369",
                "patch": "@@ -803,6 +803,8 @@ private boolean authenticateJaspic(Request request, Response response, JaspicSta\n             authStatus = state.serverAuthContext.validateRequest(state.messageInfo, client, null);\n         } catch (AuthException e) {\n             log.debug(sm.getString(\"authenticator.loginFail\"), e);\n+            // Need to explicitly set the return code as the ServerAuthContext may not have done.\n+            response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n             return false;\n         }\n "
            },
            {
                "sha": "310f6fd0415919ced04504e5754e15c92c725cd5",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/tomcat/blob/acc2f01395f895980f5d8a64573fcc1bade13369/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/acc2f01395f895980f5d8a64573fcc1bade13369/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=acc2f01395f895980f5d8a64573fcc1bade13369",
                "patch": "@@ -117,6 +117,11 @@\n         creates one <code>GenericPrincipal</code> in the <code>Subject</code>.\n         (markt)\n       </fix>\n+      <fix>\n+        If the Jakarta Authentication process fails with an Exception,\n+        explicitly set the HTTP response status to 500 as the\n+        <code>ServerAuthContext</code> may not have set it. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n </section>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/tomcat/commits/6d097a66746635df6880fe7662a792156b0eca14",
        "url": "https://api.github.com/repos/apache/tomcat/commits/6d097a66746635df6880fe7662a792156b0eca14",
        "html_url": "https://github.com/apache/tomcat/commit/6d097a66746635df6880fe7662a792156b0eca14",
        "message": "If the Jakarta Authentication fails with an exception, set a 500 status\n\nDepending on what fails where, the status may not be set or may be set\nincorrectly.",
        "files": [
            {
                "sha": "db467ba4e959e952afa6fb2da46d03ee666ae332",
                "filename": "java/org/apache/catalina/authenticator/AuthenticatorBase.java",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/apache/tomcat/blob/6d097a66746635df6880fe7662a792156b0eca14/java%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FAuthenticatorBase.java",
                "raw_url": "https://github.com/apache/tomcat/raw/6d097a66746635df6880fe7662a792156b0eca14/java%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FAuthenticatorBase.java",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/java%2Forg%2Fapache%2Fcatalina%2Fauthenticator%2FAuthenticatorBase.java?ref=6d097a66746635df6880fe7662a792156b0eca14",
                "patch": "@@ -803,6 +803,8 @@ private boolean authenticateJaspic(Request request, Response response, JaspicSta\n             authStatus = state.serverAuthContext.validateRequest(state.messageInfo, client, null);\n         } catch (AuthException e) {\n             log.debug(sm.getString(\"authenticator.loginFail\"), e);\n+            // Need to explicitly set the return code as the ServerAuthContext may not have done.\n+            response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);\n             return false;\n         }\n "
            },
            {
                "sha": "10958df67ce5de720811d6dc088087e8a3f16776",
                "filename": "webapps/docs/changelog.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/apache/tomcat/blob/6d097a66746635df6880fe7662a792156b0eca14/webapps%2Fdocs%2Fchangelog.xml",
                "raw_url": "https://github.com/apache/tomcat/raw/6d097a66746635df6880fe7662a792156b0eca14/webapps%2Fdocs%2Fchangelog.xml",
                "contents_url": "https://api.github.com/repos/apache/tomcat/contents/webapps%2Fdocs%2Fchangelog.xml?ref=6d097a66746635df6880fe7662a792156b0eca14",
                "patch": "@@ -117,6 +117,11 @@\n         creates one <code>GenericPrincipal</code> in the <code>Subject</code>.\n         (markt)\n       </fix>\n+      <fix>\n+        If the Jakarta Authentication process fails with an Exception,\n+        explicitly set the HTTP response status to 500 as the\n+        <code>ServerAuthContext</code> may not have set it. (markt)\n+      </fix>\n     </changelog>\n   </subsection>\n </section>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/firebase/firebase-js-sdk/commits/245dd26e19b6c16aca7e1b7e597ed5784c2984ba",
        "url": "https://api.github.com/repos/firebase/firebase-js-sdk/commits/245dd26e19b6c16aca7e1b7e597ed5784c2984ba",
        "html_url": "https://github.com/firebase/firebase-js-sdk/commit/245dd26e19b6c16aca7e1b7e597ed5784c2984ba",
        "message": "Enforce authTokenSyncURL being a path and not a url. (#8056)",
        "files": [
            {
                "sha": "6dd0c7e00591f93663943c59ecbcd16da1912604",
                "filename": ".changeset/thirty-otters-hug.md",
                "status": "added",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/firebase/firebase-js-sdk/blob/245dd26e19b6c16aca7e1b7e597ed5784c2984ba/.changeset%2Fthirty-otters-hug.md",
                "raw_url": "https://github.com/firebase/firebase-js-sdk/raw/245dd26e19b6c16aca7e1b7e597ed5784c2984ba/.changeset%2Fthirty-otters-hug.md",
                "contents_url": "https://api.github.com/repos/firebase/firebase-js-sdk/contents/.changeset%2Fthirty-otters-hug.md?ref=245dd26e19b6c16aca7e1b7e597ed5784c2984ba",
                "patch": "@@ -0,0 +1,5 @@\n+---\n+'@firebase/auth': patch\n+---\n+\n+Fix possible XSS vulnerability through **FIREBASE_DEFAULTS** settings."
            },
            {
                "sha": "2d21c768454748841360f1b7d6f4ddb4f1651c48",
                "filename": "packages/auth/src/platform_browser/index.ts",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/firebase/firebase-js-sdk/blob/245dd26e19b6c16aca7e1b7e597ed5784c2984ba/packages%2Fauth%2Fsrc%2Fplatform_browser%2Findex.ts",
                "raw_url": "https://github.com/firebase/firebase-js-sdk/raw/245dd26e19b6c16aca7e1b7e597ed5784c2984ba/packages%2Fauth%2Fsrc%2Fplatform_browser%2Findex.ts",
                "contents_url": "https://api.github.com/repos/firebase/firebase-js-sdk/contents/packages%2Fauth%2Fsrc%2Fplatform_browser%2Findex.ts?ref=245dd26e19b6c16aca7e1b7e597ed5784c2984ba",
                "patch": "@@ -89,9 +89,11 @@ export function getAuth(app: FirebaseApp = getApp()): Auth {\n     ]\n   });\n \n-  const authTokenSyncUrl = getExperimentalSetting('authTokenSyncURL');\n-  if (authTokenSyncUrl) {\n-    const mintCookie = mintCookieFactory(authTokenSyncUrl);\n+  const authTokenSyncPath = getExperimentalSetting('authTokenSyncURL');\n+  // Don't allow urls (XSS possibility), only paths on the same domain\n+  // (starting with '/')\n+  if (authTokenSyncPath && authTokenSyncPath.startsWith('/')) {\n+    const mintCookie = mintCookieFactory(authTokenSyncPath);\n     beforeAuthStateChanged(auth, mintCookie, () =>\n       mintCookie(auth.currentUser)\n     );"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/miniupnp/miniupnp/commits/4c90b87ce3d2517097880279e8c3daa7731100e6",
        "url": "https://api.github.com/repos/miniupnp/miniupnp/commits/4c90b87ce3d2517097880279e8c3daa7731100e6",
        "html_url": "https://github.com/miniupnp/miniupnp/commit/4c90b87ce3d2517097880279e8c3daa7731100e6",
        "message": "Check snprintf result\n\nVerify that the buffer size was large enough to write the output,\nraise an error condition if not.",
        "files": [
            {
                "sha": "d9e4358f0df03bdb11e8956d8686d9c1eb0cb302",
                "filename": "miniupnpc/minisoap.c",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/miniupnp/miniupnp/blob/4c90b87ce3d2517097880279e8c3daa7731100e6/miniupnpc%2Fminisoap.c",
                "raw_url": "https://github.com/miniupnp/miniupnp/raw/4c90b87ce3d2517097880279e8c3daa7731100e6/miniupnpc%2Fminisoap.c",
                "contents_url": "https://api.github.com/repos/miniupnp/miniupnp/contents/miniupnpc%2Fminisoap.c?ref=4c90b87ce3d2517097880279e8c3daa7731100e6",
                "patch": "@@ -105,6 +105,8 @@ int soapPostSubmit(int fd,\n \t\t\t\t\t   \"Pragma: no-cache\\r\\n\"\n \t\t\t\t\t   \"\\r\\n\",\n \t\t\t\t\t   url, httpversion, host, portstr, bodysize, action);\n+\tif ((unsigned int)headerssize >= sizeof(headerbuf))\n+\t\treturn 0;\n #ifdef DEBUG\n \t/*printf(\"SOAP request : headersize=%d bodysize=%d\\n\",\n \t       headerssize, bodysize);"
            },
            {
                "sha": "da5e869590f782040c2d161f1732da0ee583babb",
                "filename": "miniupnpc/minissdpc.c",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/miniupnp/miniupnp/blob/4c90b87ce3d2517097880279e8c3daa7731100e6/miniupnpc%2Fminissdpc.c",
                "raw_url": "https://github.com/miniupnp/miniupnp/raw/4c90b87ce3d2517097880279e8c3daa7731100e6/miniupnpc%2Fminissdpc.c",
                "contents_url": "https://api.github.com/repos/miniupnp/miniupnp/contents/miniupnpc%2Fminissdpc.c?ref=4c90b87ce3d2517097880279e8c3daa7731100e6",
                "patch": "@@ -685,6 +685,11 @@ ssdpDiscoverDevices(const char * const deviceTypes[],\n \t\t             (linklocal ? \"[\" UPNP_MCAST_LL_ADDR \"]\" :  \"[\" UPNP_MCAST_SL_ADDR \"]\")\n \t\t             : UPNP_MCAST_ADDR,\n \t\t             deviceTypes[deviceIndex], mx);\n+\t\tif ((unsigned int)n >= sizeof(bufr))\n+\t\t{\n+\t\t\tclosesocket(sudp);\n+\t\t\treturn NULL;\n+\t\t}\n #ifdef DEBUG\n \t\t/*printf(\"Sending %s\", bufr);*/\n \t\tprintf(\"Sending M-SEARCH request to %s with ST: %s\\n\","
            },
            {
                "sha": "ef613d50a891a757fee7e41e300c2ab0618b07e8",
                "filename": "miniupnpc/miniupnpc.c",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/miniupnp/miniupnp/blob/4c90b87ce3d2517097880279e8c3daa7731100e6/miniupnpc%2Fminiupnpc.c",
                "raw_url": "https://github.com/miniupnp/miniupnp/raw/4c90b87ce3d2517097880279e8c3daa7731100e6/miniupnpc%2Fminiupnpc.c",
                "contents_url": "https://api.github.com/repos/miniupnp/miniupnp/contents/miniupnpc%2Fminiupnpc.c?ref=4c90b87ce3d2517097880279e8c3daa7731100e6",
                "patch": "@@ -110,7 +110,8 @@ char * simpleUPnPcommand2(int s, const char * url, const char * service,\n \tsnprintf(soapact, sizeof(soapact), \"%s#%s\", service, action);\n \tif(args==NULL)\n \t{\n-\t\t/*soapbodylen = */snprintf(soapbody, sizeof(soapbody),\n+\t\tint soapbodylen;\n+\t\tsoapbodylen = snprintf(soapbody, sizeof(soapbody),\n \t\t\t\t\t\t\"<?xml version=\\\"1.0\\\"?>\\r\\n\"\n \t    \t              \"<\" SOAPPREFIX \":Envelope \"\n \t\t\t\t\t\t  \"xmlns:\" SOAPPREFIX \"=\\\"http://schemas.xmlsoap.org/soap/envelope/\\\" \"\n@@ -120,6 +121,8 @@ char * simpleUPnPcommand2(int s, const char * url, const char * service,\n \t\t\t\t\t\t  \"</\" SERVICEPREFIX \":%s>\"\n \t\t\t\t\t\t  \"</\" SOAPPREFIX \":Body></\" SOAPPREFIX \":Envelope>\"\n \t\t\t\t\t \t  \"\\r\\n\", action, service, action);\n+\t\tif ((unsigned int)soapbodylen >= sizeof(soapbody))\n+\t\t\treturn NULL;\n \t}\n \telse\n \t{\n@@ -134,6 +137,8 @@ char * simpleUPnPcommand2(int s, const char * url, const char * service,\n \t\t\t\t\t\t\"<\" SOAPPREFIX \":Body>\"\n \t\t\t\t\t\t\"<\" SERVICEPREFIX \":%s xmlns:\" SERVICEPREFIX \"=\\\"%s\\\">\",\n \t\t\t\t\t\taction, service);\n+\t\tif ((unsigned int)soapbodylen >= sizeof(soapbody))\n+\t\t\treturn NULL;\n \t\tp = soapbody + soapbodylen;\n \t\twhile(args->elt)\n \t\t{"
            },
            {
                "sha": "bc6e19bea7522112e9e681713647504e7b0d56e5",
                "filename": "miniupnpc/miniwget.c",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/miniupnp/miniupnp/blob/4c90b87ce3d2517097880279e8c3daa7731100e6/miniupnpc%2Fminiwget.c",
                "raw_url": "https://github.com/miniupnp/miniupnp/raw/4c90b87ce3d2517097880279e8c3daa7731100e6/miniupnpc%2Fminiwget.c",
                "contents_url": "https://api.github.com/repos/miniupnp/miniupnp/contents/miniupnpc%2Fminiwget.c?ref=4c90b87ce3d2517097880279e8c3daa7731100e6",
                "patch": "@@ -414,6 +414,11 @@ miniwget3(const char * host,\n \n \t\t\t\t \"\\r\\n\",\n \t\t\t   path, httpversion, host, port);\n+\tif ((unsigned int)len >= sizeof(buf))\n+\t{\n+\t\tclosesocket(s);\n+\t\treturn NULL;\n+\t}\n \tsent = 0;\n \t/* sending the HTTP request */\n \twhile(sent < len)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/GNOME/gnome-maps/commits/d26cd774d524404ef7784e6808f551de83de4bea",
        "url": "https://api.github.com/repos/GNOME/gnome-maps/commits/d26cd774d524404ef7784e6808f551de83de4bea",
        "html_url": "https://github.com/GNOME/gnome-maps/commit/d26cd774d524404ef7784e6808f551de83de4bea",
        "message": "transitRouter: Add allowlist for transit plugins\n\nSigned-off-by: Marcus Lundblad <ml@dfupdate.se>",
        "files": [
            {
                "sha": "ee606022111bb82a696e5528878754df0a750c14",
                "filename": "src/transitRouter.js",
                "status": "modified",
                "additions": 11,
                "deletions": 5,
                "changes": 16,
                "blob_url": "https://github.com/GNOME/gnome-maps/blob/d26cd774d524404ef7784e6808f551de83de4bea/src%2FtransitRouter.js",
                "raw_url": "https://github.com/GNOME/gnome-maps/raw/d26cd774d524404ef7784e6808f551de83de4bea/src%2FtransitRouter.js",
                "contents_url": "https://api.github.com/repos/GNOME/gnome-maps/contents/src%2FtransitRouter.js?ref=d26cd774d524404ef7784e6808f551de83de4bea",
                "patch": "@@ -32,6 +32,7 @@ import {OpendataCH} from './transitplugins/opendataCH.js';\n import {OpenTripPlanner} from './transitplugins/openTripPlanner.js';\n import {Resrobot} from './transitplugins/resrobot.js';\n \n+const ALL_PLUGINS = [\"GoMetro\", \"OpendataCH\", \"OpenTripPlanner\", \"Resrobot\"];\n \n /**\n  * Class responsible for delegating requests to perform routing in transit\n@@ -67,8 +68,7 @@ export class TransitRouter {\n             // override plugin was specified, try instanciating if not done yet\n             if (!this._currPluginInstance) {\n                 try {\n-                    this._currentPluginInstance =\n-                        eval(`new ${pluginOverride}()`);\n+                    this._currentPluginInstance = this._instantiatePlugin(pluginOverride);\n                 } catch (e) {\n                     Utils.debug('Unable to instanciate plugin: ' + pluginOverride);\n                     throw e;\n@@ -230,9 +230,7 @@ export class TransitRouter {\n \n             try {\n                 let params = provider.params;\n-                let instance =\n-                    params ? eval(`new ${plugin}(params)`):\n-                             eval(`new ${plugin}()`);\n+                let instance = this._instantiatePlugin(plugin, params);\n \n                 this._providerCache[provider.name] = instance;\n \n@@ -263,4 +261,12 @@ export class TransitRouter {\n         else\n             return 0;\n     }\n+\n+    _instantiatePlugin(plugin, params) {\n+        if (!ALL_PLUGINS.includes(plugin))\n+            throw 'Unknown plugin: ' + plugin;\n+        return params\n+            ? eval(`new ${plugin}(params)`)\n+            : eval(`new ${plugin}()`);\n+    }\n };"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openstack/python-openstackclient/commits/bc60e3bb908a7f10c87993d791184bfe46784d6c",
        "url": "https://api.github.com/repos/openstack/python-openstackclient/commits/bc60e3bb908a7f10c87993d791184bfe46784d6c",
        "html_url": "https://github.com/openstack/python-openstackclient/commit/bc60e3bb908a7f10c87993d791184bfe46784d6c",
        "message": "Fix \"access rule\" commands to only use ID\n\nThis patch modifies the access rule commands to use only the resource\nID.  The previous logic incorrectly assumed that access rules have a\n\"name\" property, which resulted in unexpected behaviors.\n\nFor example, \"access rule delete {non-existent-id}\" now results in a\n\"not found\" error instead of sometimes deleting an unrelated rule.\n\nStory: 2010775\nTask: 48163\nChange-Id: Ib5c3b7f86acf1dfe7cc76dfa99fa4c118388bd71",
        "files": [
            {
                "sha": "a9d8afa6f51079dbc58ff8df62dd3bc8a7f7914a",
                "filename": "openstackclient/identity/common.py",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/openstack/python-openstackclient/blob/bc60e3bb908a7f10c87993d791184bfe46784d6c/openstackclient%2Fidentity%2Fcommon.py",
                "raw_url": "https://github.com/openstack/python-openstackclient/raw/bc60e3bb908a7f10c87993d791184bfe46784d6c/openstackclient%2Fidentity%2Fcommon.py",
                "contents_url": "https://api.github.com/repos/openstack/python-openstackclient/contents/openstackclient%2Fidentity%2Fcommon.py?ref=bc60e3bb908a7f10c87993d791184bfe46784d6c",
                "patch": "@@ -92,6 +92,18 @@ def get_resource(manager, name_type_or_id):\n         raise exceptions.CommandError(msg % name_type_or_id)\n \n \n+def get_resource_by_id(manager, resource_id):\n+    \"\"\"Get resource by ID\n+\n+    Raises CommandError if the resource is not found\n+    \"\"\"\n+    try:\n+        return manager.get(resource_id)\n+    except identity_exc.NotFound:\n+        msg = _(\"Resource with id {} not found\")\n+        raise exceptions.CommandError(msg.format(resource_id))\n+\n+\n def _get_token_resource(client, resource, parsed_name, parsed_domain=None):\n     \"\"\"Peek into the user's auth token to get resource IDs\n "
            },
            {
                "sha": "b9a66e9a5d4d73949d71ffa4bd72cc9d280795c0",
                "filename": "openstackclient/identity/v3/access_rule.py",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/openstack/python-openstackclient/blob/bc60e3bb908a7f10c87993d791184bfe46784d6c/openstackclient%2Fidentity%2Fv3%2Faccess_rule.py",
                "raw_url": "https://github.com/openstack/python-openstackclient/raw/bc60e3bb908a7f10c87993d791184bfe46784d6c/openstackclient%2Fidentity%2Fv3%2Faccess_rule.py",
                "contents_url": "https://api.github.com/repos/openstack/python-openstackclient/contents/openstackclient%2Fidentity%2Fv3%2Faccess_rule.py?ref=bc60e3bb908a7f10c87993d791184bfe46784d6c",
                "patch": "@@ -37,7 +37,7 @@ def get_parser(self, prog_name):\n             'access_rule',\n             metavar='<access-rule>',\n             nargs=\"+\",\n-            help=_('Access rule(s) to delete (name or ID)'),\n+            help=_('Access rule ID(s) to delete'),\n         )\n         return parser\n \n@@ -47,7 +47,7 @@ def take_action(self, parsed_args):\n         errors = 0\n         for ac in parsed_args.access_rule:\n             try:\n-                access_rule = utils.find_resource(\n+                access_rule = common.get_resource_by_id(\n                     identity_client.access_rules, ac\n                 )\n                 identity_client.access_rules.delete(access_rule.id)\n@@ -114,13 +114,13 @@ def get_parser(self, prog_name):\n         parser.add_argument(\n             'access_rule',\n             metavar='<access-rule>',\n-            help=_('Access rule to display (name or ID)'),\n+            help=_('Access rule ID to display'),\n         )\n         return parser\n \n     def take_action(self, parsed_args):\n         identity_client = self.app.client_manager.identity\n-        access_rule = utils.find_resource(\n+        access_rule = common.get_resource_by_id(\n             identity_client.access_rules, parsed_args.access_rule\n         )\n "
            },
            {
                "sha": "b62f283f3034ecbe50cc2145e9f15e930e3de770",
                "filename": "openstackclient/tests/unit/identity/v3/test_access_rule.py",
                "status": "modified",
                "additions": 10,
                "deletions": 14,
                "changes": 24,
                "blob_url": "https://github.com/openstack/python-openstackclient/blob/bc60e3bb908a7f10c87993d791184bfe46784d6c/openstackclient%2Ftests%2Funit%2Fidentity%2Fv3%2Ftest_access_rule.py",
                "raw_url": "https://github.com/openstack/python-openstackclient/raw/bc60e3bb908a7f10c87993d791184bfe46784d6c/openstackclient%2Ftests%2Funit%2Fidentity%2Fv3%2Ftest_access_rule.py",
                "contents_url": "https://api.github.com/repos/openstack/python-openstackclient/contents/openstackclient%2Ftests%2Funit%2Fidentity%2Fv3%2Ftest_access_rule.py?ref=bc60e3bb908a7f10c87993d791184bfe46784d6c",
                "patch": "@@ -14,10 +14,9 @@\n #\n \n import copy\n-from unittest import mock\n \n+from keystoneclient import exceptions as identity_exc\n from osc_lib import exceptions\n-from osc_lib import utils\n \n from openstackclient.identity.v3 import access_rule\n from openstackclient.tests.unit import fakes\n@@ -64,11 +63,12 @@ def test_access_rule_delete(self):\n         )\n         self.assertIsNone(result)\n \n-    @mock.patch.object(utils, 'find_resource')\n-    def test_delete_multi_access_rules_with_exception(self, find_mock):\n-        find_mock.side_effect = [\n-            self.access_rules_mock.get.return_value,\n-            exceptions.CommandError,\n+    def test_delete_multi_access_rules_with_exception(self):\n+        # mock returns for common.get_resource_by_id\n+        mock_get = self.access_rules_mock.get\n+        mock_get.side_effect = [\n+            mock_get.return_value,\n+            identity_exc.NotFound,\n         ]\n         arglist = [\n             identity_fakes.access_rule_id,\n@@ -87,14 +87,10 @@ def test_delete_multi_access_rules_with_exception(self, find_mock):\n                 '1 of 2 access rules failed to' ' delete.', str(e)\n             )\n \n-        find_mock.assert_any_call(\n-            self.access_rules_mock, identity_fakes.access_rule_id\n-        )\n-        find_mock.assert_any_call(\n-            self.access_rules_mock, 'nonexistent_access_rule'\n-        )\n+        mock_get.assert_any_call(identity_fakes.access_rule_id)\n+        mock_get.assert_any_call('nonexistent_access_rule')\n \n-        self.assertEqual(2, find_mock.call_count)\n+        self.assertEqual(2, mock_get.call_count)\n         self.access_rules_mock.delete.assert_called_once_with(\n             identity_fakes.access_rule_id\n         )"
            },
            {
                "sha": "e4c98b74438e2b3013a0f8b0b6a98cd62d9caa7d",
                "filename": "releasenotes/notes/fix-story-2010775-953dbdf03b2b6746.yaml",
                "status": "added",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/openstack/python-openstackclient/blob/bc60e3bb908a7f10c87993d791184bfe46784d6c/releasenotes%2Fnotes%2Ffix-story-2010775-953dbdf03b2b6746.yaml",
                "raw_url": "https://github.com/openstack/python-openstackclient/raw/bc60e3bb908a7f10c87993d791184bfe46784d6c/releasenotes%2Fnotes%2Ffix-story-2010775-953dbdf03b2b6746.yaml",
                "contents_url": "https://api.github.com/repos/openstack/python-openstackclient/contents/releasenotes%2Fnotes%2Ffix-story-2010775-953dbdf03b2b6746.yaml?ref=bc60e3bb908a7f10c87993d791184bfe46784d6c",
                "patch": "@@ -0,0 +1,8 @@\n+---\n+fixes:\n+  - |\n+    Fixed a bug in \"access rule\" subcommands where the client logic incorrectly\n+    assumed that access rules have a \"name\" property which resulted in\n+    unpredictable behaviors.  e.g. \"access rule delete {non-existent-id}\" now\n+    results in a not-found error instead of sometimes deleting an unrelated\n+    rule."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/undertow-io/undertow/commits/1f93a979d2ac264798e5779b5b7172dfafe0066f",
        "url": "https://api.github.com/repos/undertow-io/undertow/commits/1f93a979d2ac264798e5779b5b7172dfafe0066f",
        "html_url": "https://github.com/undertow-io/undertow/commit/1f93a979d2ac264798e5779b5b7172dfafe0066f",
        "message": "[UNDERTOW-2342] CVE-2023-4639 ignore cookie with improper quotes\n\nSigned-off-by: Flavia Rainone <frainone@redhat.com>",
        "files": [
            {
                "sha": "5a7b465204435800bfff62b1a77ea4202500c2fd",
                "filename": "core/src/main/java/io/undertow/util/Cookies.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/undertow-io/undertow/blob/1f93a979d2ac264798e5779b5b7172dfafe0066f/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Futil%2FCookies.java",
                "raw_url": "https://github.com/undertow-io/undertow/raw/1f93a979d2ac264798e5779b5b7172dfafe0066f/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Futil%2FCookies.java",
                "contents_url": "https://api.github.com/repos/undertow-io/undertow/contents/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Futil%2FCookies.java?ref=1f93a979d2ac264798e5779b5b7172dfafe0066f",
                "patch": "@@ -318,6 +318,9 @@ private static void parseCookie(final String cookie, final Set<Cookie> parsedCoo\n                         cookieCount = createCookie(name, containsEscapedQuotes ? unescapeDoubleQuotes(cookie.substring(start, i)) : cookie.substring(start, i), maxCookies, cookieCount, cookies, additional);\n                         state = 0;\n                         start = i + 1;\n+                    } else if (c == ';' || (commaIsSeperator && c == ',')) {\n+                        state = 0;\n+                        start = i + 1;\n                     }\n                     // Skip the next double quote char '\"' when it is escaped by backslash '\\' (i.e. \\\") inside the quoted value\n                     if (c == '\\\\' && (i + 1 < cookie.length()) && cookie.charAt(i + 1) == '\"') {"
            },
            {
                "sha": "3b4f2f2e5f1e7a73898c510b8903e1e0a964dbbd",
                "filename": "core/src/test/java/io/undertow/util/CookiesTestCase.java",
                "status": "modified",
                "additions": 15,
                "deletions": 0,
                "changes": 15,
                "blob_url": "https://github.com/undertow-io/undertow/blob/1f93a979d2ac264798e5779b5b7172dfafe0066f/core%2Fsrc%2Ftest%2Fjava%2Fio%2Fundertow%2Futil%2FCookiesTestCase.java",
                "raw_url": "https://github.com/undertow-io/undertow/raw/1f93a979d2ac264798e5779b5b7172dfafe0066f/core%2Fsrc%2Ftest%2Fjava%2Fio%2Fundertow%2Futil%2FCookiesTestCase.java",
                "contents_url": "https://api.github.com/repos/undertow-io/undertow/contents/core%2Fsrc%2Ftest%2Fjava%2Fio%2Fundertow%2Futil%2FCookiesTestCase.java?ref=1f93a979d2ac264798e5779b5b7172dfafe0066f",
                "patch": "@@ -450,6 +450,21 @@ public void testSameSiteCookie() {\n         Assert.assertNull(cookie.getSameSiteMode());\n     }\n \n+    @Test\n+    public void testNoDoubleQuoteTermination() {\n+        Map<String, Cookie> cookies = Cookies.parseRequestCookies(4, false, Arrays.asList(\"CUSTOMER=\\\"WILE_E_COYOTE\\\"; BAD=\\\"X; SHIPPING=FEDEX\"), true);\n+        Assert.assertEquals(2, cookies.size());\n+        Cookie cookie = cookies.get(\"CUSTOMER\");\n+        Assert.assertEquals(\"CUSTOMER\", cookie.getName());\n+        Assert.assertEquals(\"WILE_E_COYOTE\", cookie.getValue());\n+        cookie = cookies.get(\"BAD\");\n+        Assert.assertNull(cookie);\n+        cookie = cookies.get(\"SHIPPING\");\n+        Assert.assertEquals(\"SHIPPING\", cookie.getName());\n+        Assert.assertEquals(\"FEDEX\", cookie.getValue());\n+        Assert.assertNotNull(cookie);\n+    }\n+\n     // RFC6265 allows US-ASCII characters excluding CTLs, whitespace,\n     // double quote, comma, semicolon and backslash as cookie value.\n     // This does not change even if value is quoted."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/samba-team/samba/commits/cc64ea24daa649dc8de4a212c7abfbe111095655",
        "url": "https://api.github.com/repos/samba-team/samba/commits/cc64ea24daa649dc8de4a212c7abfbe111095655",
        "html_url": "https://github.com/samba-team/samba/commit/cc64ea24daa649dc8de4a212c7abfbe111095655",
        "message": "CVE-2020-25720 s4:dsdb/descriptor: explain lack of dSHeuristics check\n\nIt is strange that sDRightsEffective pays no attention to the\ndSHeuristics flags.\n\nBUG: https://bugzilla.samba.org/show_bug.cgi?id=14810\n\nReviewed-by: Joseph Sutton <josephsutton@catalyst.net.nz>\nSigned-off-by: Andrew Bartlett <abartlet@samba.org>\n\nAutobuild-User(master): Andrew Bartlett <abartlet@samba.org>\nAutobuild-Date(master): Fri Sep 16 03:31:42 UTC 2022 on sn-devel-184",
        "files": [
            {
                "sha": "dd15dddfb5054bffac88c9b2ba05060b7eb304f5",
                "filename": "source4/dsdb/samdb/ldb_modules/acl.c",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/samba-team/samba/blob/cc64ea24daa649dc8de4a212c7abfbe111095655/source4%2Fdsdb%2Fsamdb%2Fldb_modules%2Facl.c",
                "raw_url": "https://github.com/samba-team/samba/raw/cc64ea24daa649dc8de4a212c7abfbe111095655/source4%2Fdsdb%2Fsamdb%2Fldb_modules%2Facl.c",
                "contents_url": "https://api.github.com/repos/samba-team/samba/contents/source4%2Fdsdb%2Fsamdb%2Fldb_modules%2Facl.c?ref=cc64ea24daa649dc8de4a212c7abfbe111095655",
                "patch": "@@ -502,6 +502,15 @@ static int acl_sDRightsEffective(struct ldb_module *module,\n \t\tif (ret == LDB_SUCCESS) {\n \t\t\tflags |= SECINFO_OWNER | SECINFO_GROUP;\n \t\t}\n+\n+\t\t/*\n+\t\t * This call is made with\n+\t\t * IMPLICIT_OWNER_READ_CONTROL_AND_WRITE_DAC_RIGHTS\n+\t\t * and without reference to the dSHeuristics via\n+\t\t * dsdb_block_owner_implicit_rights().  This is\n+\t\t * probably a Windows bug but for now we match\n+\t\t * exactly.\n+\t\t */\n \t\tret = acl_check_access_on_attribute_implicit_owner(\n \t\t\tmodule,\n \t\t\tmsg,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/mail/commits/8d44f1ce44684022aa4e62a3e0462fdadcde6c8b",
        "url": "https://api.github.com/repos/nextcloud/mail/commits/8d44f1ce44684022aa4e62a3e0462fdadcde6c8b",
        "html_url": "https://github.com/nextcloud/mail/commit/8d44f1ce44684022aa4e62a3e0462fdadcde6c8b",
        "message": "Merge pull request #9592 from nextcloud/enh/backend-check-for-download-permission\n\nenh: add backend check for download permission for cloud attachements",
        "files": [
            {
                "sha": "f073a2f8fbc9ca1a742bcdb738a7ae608fbe400e",
                "filename": "lib/Service/Attachment/AttachmentService.php",
                "status": "modified",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/nextcloud/mail/blob/8d44f1ce44684022aa4e62a3e0462fdadcde6c8b/lib%2FService%2FAttachment%2FAttachmentService.php",
                "raw_url": "https://github.com/nextcloud/mail/raw/8d44f1ce44684022aa4e62a3e0462fdadcde6c8b/lib%2FService%2FAttachment%2FAttachmentService.php",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/lib%2FService%2FAttachment%2FAttachmentService.php?ref=8d44f1ce44684022aa4e62a3e0462fdadcde6c8b",
                "patch": "@@ -27,6 +27,7 @@\n \n use finfo;\n use InvalidArgumentException;\n+use OCA\\Files_Sharing\\SharedStorage;\n use OCA\\Mail\\Account;\n use OCA\\Mail\\Contracts\\IAttachmentService;\n use OCA\\Mail\\Contracts\\IMailManager;\n@@ -343,6 +344,23 @@ private function handleForwardedAttachment(Account $account, array $attachment,\n \t\treturn $localAttachment->getId();\n \t}\n \n+\tprivate function hasDownloadPermissions(File $file, string $fileName): bool {\n+\t\t$storage = $file->getStorage();\n+\t\tif ($storage->instanceOfStorage(SharedStorage::class)) {\n+\n+\t\t\t/** @var SharedStorage $storage */\n+\t\t\t$share = $storage->getShare();\n+\t\t\t$attributes = $share->getAttributes();\n+\n+\t\t\tif($attributes->getAttribute('permissions', 'download') === false) {\n+\t\t\t\t$this->logger->warning(\"Could not create attachment, no download permission for file: \".$fileName);\n+\t\t\t\treturn false;\n+\n+\t\t\t}\n+\t\t}\n+\t\treturn true;\n+\t}\n+\n \t/**\n \t * @param Account $account\n \t * @param array $attachment\n@@ -362,6 +380,9 @@ private function handleCloudAttachment(Account $account, array $attachment): ?in\n \t\tif (!$file instanceof File) {\n \t\t\treturn null;\n \t\t}\n+\t\tif(!$this->hasDownloadPermissions($file, $fileName)) {\n+\t\t\treturn null;\n+\t\t}\n \n \t\ttry {\n \t\t\t$localAttachment = $this->addFileFromString($account->getUserId(), $file->getName(), $file->getMimeType(), $file->getContent());"
            },
            {
                "sha": "01f63483ebdd62eb594ffd1a0c9e7ee6adc2365a",
                "filename": "tests/Unit/Service/Attachment/AttachmentServiceTest.php",
                "status": "modified",
                "additions": 55,
                "deletions": 1,
                "changes": 56,
                "blob_url": "https://github.com/nextcloud/mail/blob/8d44f1ce44684022aa4e62a3e0462fdadcde6c8b/tests%2FUnit%2FService%2FAttachment%2FAttachmentServiceTest.php",
                "raw_url": "https://github.com/nextcloud/mail/raw/8d44f1ce44684022aa4e62a3e0462fdadcde6c8b/tests%2FUnit%2FService%2FAttachment%2FAttachmentServiceTest.php",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/tests%2FUnit%2FService%2FAttachment%2FAttachmentServiceTest.php?ref=8d44f1ce44684022aa4e62a3e0462fdadcde6c8b",
                "patch": "@@ -25,6 +25,7 @@\n use ChristophWurst\\Nextcloud\\Testing\\TestCase;\n use Horde_Imap_Client_Socket;\n use OC\\Files\\Node\\File;\n+use OCA\\Files_Sharing\\SharedStorage;\n use OCA\\Mail\\Account;\n use OCA\\Mail\\Contracts\\IMailManager;\n use OCA\\Mail\\Db\\LocalAttachment;\n@@ -40,6 +41,8 @@\n use OCP\\AppFramework\\Db\\DoesNotExistException;\n use OCP\\Files\\Folder;\n use OCP\\Files\\NotPermittedException;\n+use OCP\\Share\\IAttributes;\n+use OCP\\Share\\IShare;\n use PHPUnit\\Framework\\MockObject\\MockObject;\n use Psr\\Log\\LoggerInterface;\n \n@@ -389,12 +392,63 @@ public function testHandleAttachmentsForwardedAttachment(): void {\n \t\t$this->service->handleAttachments($account, [$attachments], $client);\n \t}\n \n+\tpublic function testHandleAttachmentsCloudAttachmentNoDownloadPermission(): void {\n+\t\t$userId = 'linus';\n+\t\t$storage = $this->createMock(SharedStorage::class);\n+\t\t$storage->expects(self::once())\n+\t\t\t->method('instanceOfStorage')\n+\t\t\t->with(SharedStorage::class)\n+\t\t\t->willReturn(true);\n+\t\t$share = $this->createMock(IShare::class);\n+\t\t$attributes = $this->createMock(IAttributes::class);\n+\t\t$attributes->expects(self::once())\n+\t\t\t->method('getAttribute')\n+\t\t\t->with('permissions', 'download')\n+\t\t\t->willReturn(false);\n+\t\t$share->expects(self::once())\n+\t\t\t->method('getAttributes')\n+\t\t\t->willReturn($attributes);\n+\t\t$storage->expects(self::once())\n+\t\t\t->method('getShare')\n+\t\t\t->willReturn($share);\n+\t\t\n+\t\t$file = $this->createConfiguredMock(File::class, [\n+\t\t\t'getName' => 'cat.jpg',\n+\t\t\t'getMimeType' => 'text/plain',\n+\t\t\t'getContent' => 'sjdhfkjsdhfkjsdhfkjdshfjhdskfjhds',\n+\t\t\t'getStorage' => $storage\n+\t\t]);\n+\t\t$account = $this->createConfiguredMock(Account::class, [\n+\t\t\t'getUserId' => $userId\n+\t\t]);\n+\t\t$client = $this->createMock(Horde_Imap_Client_Socket::class);\n+\t\t$attachments = [\n+\t\t\t'type' => 'cloud',\n+\t\t\t'messageId' => 999,\n+\t\t\t'fileName' => 'cat.jpg',\n+\t\t\t'mimeType' => 'text/plain',\n+\t\t];\n+\t\t$this->userFolder->expects(self::once())\n+\t\t\t->method('nodeExists')\n+\t\t\t->with('cat.jpg')\n+\t\t\t->willReturn(true);\n+\t\t$this->userFolder->expects(self::once())\n+\t\t\t->method('get')\n+\t\t\t->with('cat.jpg')\n+\t\t\t->willReturn($file);\n+\n+\t\t$result = $this->service->handleAttachments($account, [$attachments], $client);\n+\t\t$this->assertEquals([], $result);\n+\n+\t}\n+\n \tpublic function testHandleAttachmentsCloudAttachment(): void {\n \t\t$userId = 'linus';\n \t\t$file = $this->createConfiguredMock(File::class, [\n \t\t\t'getName' => 'cat.jpg',\n \t\t\t'getMimeType' => 'text/plain',\n-\t\t\t'getContent' => 'sjdhfkjsdhfkjsdhfkjdshfjhdskfjhds'\n+\t\t\t'getContent' => 'sjdhfkjsdhfkjsdhfkjdshfjhdskfjhds',\n+\t\t\t'getStorage' => $this->createMock(SharedStorage::class)\n \t\t]);\n \t\t$account = $this->createConfiguredMock(Account::class, [\n \t\t\t'getUserId' => $userId"
            },
            {
                "sha": "9c373d1676b3452aec6eb41d5ca6c4707071bcd5",
                "filename": "tests/psalm-baseline.xml",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/nextcloud/mail/blob/8d44f1ce44684022aa4e62a3e0462fdadcde6c8b/tests%2Fpsalm-baseline.xml",
                "raw_url": "https://github.com/nextcloud/mail/raw/8d44f1ce44684022aa4e62a3e0462fdadcde6c8b/tests%2Fpsalm-baseline.xml",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/tests%2Fpsalm-baseline.xml?ref=8d44f1ce44684022aa4e62a3e0462fdadcde6c8b",
                "patch": "@@ -41,6 +41,14 @@\n       <code>IAPIWidgetV2</code>\n     </UndefinedClass>\n   </file>\n+  <file src=\"lib/Service/Attachment/AttachmentService.php\">\n+    <UndefinedDocblockClass occurrences=\"2\">\n+      <code>OCA\\Files_Sharing\\SharedStorage</code>\n+    </UndefinedDocblockClass>\n+    <UndefinedClass occurrences=\"1\">\n+      <code>SharedStorage</code>\n+    </UndefinedClass>\n+  </file>\n   <file src=\"lib/Dashboard/UnreadMailWidgetV2.php\">\n     <MissingDependency>\n       <code>MailWidgetV2</code>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/mail/commits/a84c70e15d814dab6f0e8eda71bbaaf48152079b",
        "url": "https://api.github.com/repos/nextcloud/mail/commits/a84c70e15d814dab6f0e8eda71bbaaf48152079b",
        "html_url": "https://github.com/nextcloud/mail/commit/a84c70e15d814dab6f0e8eda71bbaaf48152079b",
        "message": "Merge pull request #9964 from nextcloud/fix/autoconfig/testable-dns-resolver\n\nfix(autoconfig): Refactor DNS query for testing",
        "files": [
            {
                "sha": "51e63c242994ef8476302e096d273179907d476c",
                "filename": ".github/workflows/update-public-suffix-list.yml",
                "status": "added",
                "additions": 45,
                "deletions": 0,
                "changes": 45,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/.github%2Fworkflows%2Fupdate-public-suffix-list.yml",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/.github%2Fworkflows%2Fupdate-public-suffix-list.yml",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/.github%2Fworkflows%2Fupdate-public-suffix-list.yml?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b",
                "patch": "@@ -0,0 +1,45 @@\n+# SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n+# SPDX-License-Identifier: MIT\n+name: Update public suffix list\n+\n+on:\n+  workflow_dispatch:\n+  schedule:\n+    - cron: \"5 2 * * *\"\n+\n+jobs:\n+  update-public-suffix-list:\n+    runs-on: ubuntu-latest\n+\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        branches: ['main', 'stable3.7']\n+\n+    name: update-public-suffix-list-${{ matrix.branches }}\n+\n+    steps:\n+      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332\n+        with:\n+          ref: ${{ matrix.branches }}\n+          submodules: true\n+\n+      - name: Download public suffix list\n+        run: curl --output resources/resources/public_suffix_list.dat https://publicsuffix.org/list/public_suffix_list.dat\n+\n+      - name: Create Pull Request\n+        uses: peter-evans/create-pull-request@c5a7806660adbe173f04e3e038b0ccdcd758773c\n+        with:\n+          token: ${{ secrets.COMMAND_BOT_PAT }}\n+          commit-message: 'fix(dns): Update public suffix list'\n+          committer: GitHub <noreply@github.com>\n+          author: nextcloud-command <nextcloud-command@users.noreply.github.com>\n+          signoff: true\n+          branch: 'fix/dns/update-public-suffix-list-${{ matrix.branches }}'\n+          title: '[${{ matrix.branches }}] fix(dns): Update public suffix list'\n+          body: |\n+            Auto-generated update of https://publicsuffix.org/\n+          labels: |\n+            dependencies\n+            3. to review\n+          reviewers: ChristophWurst"
            },
            {
                "sha": "ee6256cdb62a765749a71aae3abea32884301cd1",
                "filename": "LICENSES/MPL-2.0.txt",
                "status": "added",
                "additions": 373,
                "deletions": 0,
                "changes": 373,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/LICENSES%2FMPL-2.0.txt",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/LICENSES%2FMPL-2.0.txt",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/LICENSES%2FMPL-2.0.txt?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b",
                "patch": "@@ -0,0 +1,373 @@\n+Mozilla Public License Version 2.0\n+==================================\n+\n+1. Definitions\n+--------------\n+\n+1.1. \"Contributor\"\n+    means each individual or legal entity that creates, contributes to\n+    the creation of, or owns Covered Software.\n+\n+1.2. \"Contributor Version\"\n+    means the combination of the Contributions of others (if any) used\n+    by a Contributor and that particular Contributor's Contribution.\n+\n+1.3. \"Contribution\"\n+    means Covered Software of a particular Contributor.\n+\n+1.4. \"Covered Software\"\n+    means Source Code Form to which the initial Contributor has attached\n+    the notice in Exhibit A, the Executable Form of such Source Code\n+    Form, and Modifications of such Source Code Form, in each case\n+    including portions thereof.\n+\n+1.5. \"Incompatible With Secondary Licenses\"\n+    means\n+\n+    (a) that the initial Contributor has attached the notice described\n+        in Exhibit B to the Covered Software; or\n+\n+    (b) that the Covered Software was made available under the terms of\n+        version 1.1 or earlier of the License, but not also under the\n+        terms of a Secondary License.\n+\n+1.6. \"Executable Form\"\n+    means any form of the work other than Source Code Form.\n+\n+1.7. \"Larger Work\"\n+    means a work that combines Covered Software with other material, in \n+    a separate file or files, that is not Covered Software.\n+\n+1.8. \"License\"\n+    means this document.\n+\n+1.9. \"Licensable\"\n+    means having the right to grant, to the maximum extent possible,\n+    whether at the time of the initial grant or subsequently, any and\n+    all of the rights conveyed by this License.\n+\n+1.10. \"Modifications\"\n+    means any of the following:\n+\n+    (a) any file in Source Code Form that results from an addition to,\n+        deletion from, or modification of the contents of Covered\n+        Software; or\n+\n+    (b) any new file in Source Code Form that contains any Covered\n+        Software.\n+\n+1.11. \"Patent Claims\" of a Contributor\n+    means any patent claim(s), including without limitation, method,\n+    process, and apparatus claims, in any patent Licensable by such\n+    Contributor that would be infringed, but for the grant of the\n+    License, by the making, using, selling, offering for sale, having\n+    made, import, or transfer of either its Contributions or its\n+    Contributor Version.\n+\n+1.12. \"Secondary License\"\n+    means either the GNU General Public License, Version 2.0, the GNU\n+    Lesser General Public License, Version 2.1, the GNU Affero General\n+    Public License, Version 3.0, or any later versions of those\n+    licenses.\n+\n+1.13. \"Source Code Form\"\n+    means the form of the work preferred for making modifications.\n+\n+1.14. \"You\" (or \"Your\")\n+    means an individual or a legal entity exercising rights under this\n+    License. For legal entities, \"You\" includes any entity that\n+    controls, is controlled by, or is under common control with You. For\n+    purposes of this definition, \"control\" means (a) the power, direct\n+    or indirect, to cause the direction or management of such entity,\n+    whether by contract or otherwise, or (b) ownership of more than\n+    fifty percent (50%) of the outstanding shares or beneficial\n+    ownership of such entity.\n+\n+2. License Grants and Conditions\n+--------------------------------\n+\n+2.1. Grants\n+\n+Each Contributor hereby grants You a world-wide, royalty-free,\n+non-exclusive license:\n+\n+(a) under intellectual property rights (other than patent or trademark)\n+    Licensable by such Contributor to use, reproduce, make available,\n+    modify, display, perform, distribute, and otherwise exploit its\n+    Contributions, either on an unmodified basis, with Modifications, or\n+    as part of a Larger Work; and\n+\n+(b) under Patent Claims of such Contributor to make, use, sell, offer\n+    for sale, have made, import, and otherwise transfer either its\n+    Contributions or its Contributor Version.\n+\n+2.2. Effective Date\n+\n+The licenses granted in Section 2.1 with respect to any Contribution\n+become effective for each Contribution on the date the Contributor first\n+distributes such Contribution.\n+\n+2.3. Limitations on Grant Scope\n+\n+The licenses granted in this Section 2 are the only rights granted under\n+this License. No additional rights or licenses will be implied from the\n+distribution or licensing of Covered Software under this License.\n+Notwithstanding Section 2.1(b) above, no patent license is granted by a\n+Contributor:\n+\n+(a) for any code that a Contributor has removed from Covered Software;\n+    or\n+\n+(b) for infringements caused by: (i) Your and any other third party's\n+    modifications of Covered Software, or (ii) the combination of its\n+    Contributions with other software (except as part of its Contributor\n+    Version); or\n+\n+(c) under Patent Claims infringed by Covered Software in the absence of\n+    its Contributions.\n+\n+This License does not grant any rights in the trademarks, service marks,\n+or logos of any Contributor (except as may be necessary to comply with\n+the notice requirements in Section 3.4).\n+\n+2.4. Subsequent Licenses\n+\n+No Contributor makes additional grants as a result of Your choice to\n+distribute the Covered Software under a subsequent version of this\n+License (see Section 10.2) or under the terms of a Secondary License (if\n+permitted under the terms of Section 3.3).\n+\n+2.5. Representation\n+\n+Each Contributor represents that the Contributor believes its\n+Contributions are its original creation(s) or it has sufficient rights\n+to grant the rights to its Contributions conveyed by this License.\n+\n+2.6. Fair Use\n+\n+This License is not intended to limit any rights You have under\n+applicable copyright doctrines of fair use, fair dealing, or other\n+equivalents.\n+\n+2.7. Conditions\n+\n+Sections 3.1, 3.2, 3.3, and 3.4 are conditions of the licenses granted\n+in Section 2.1.\n+\n+3. Responsibilities\n+-------------------\n+\n+3.1. Distribution of Source Form\n+\n+All distribution of Covered Software in Source Code Form, including any\n+Modifications that You create or to which You contribute, must be under\n+the terms of this License. You must inform recipients that the Source\n+Code Form of the Covered Software is governed by the terms of this\n+License, and how they can obtain a copy of this License. You may not\n+attempt to alter or restrict the recipients' rights in the Source Code\n+Form.\n+\n+3.2. Distribution of Executable Form\n+\n+If You distribute Covered Software in Executable Form then:\n+\n+(a) such Covered Software must also be made available in Source Code\n+    Form, as described in Section 3.1, and You must inform recipients of\n+    the Executable Form how they can obtain a copy of such Source Code\n+    Form by reasonable means in a timely manner, at a charge no more\n+    than the cost of distribution to the recipient; and\n+\n+(b) You may distribute such Executable Form under the terms of this\n+    License, or sublicense it under different terms, provided that the\n+    license for the Executable Form does not attempt to limit or alter\n+    the recipients' rights in the Source Code Form under this License.\n+\n+3.3. Distribution of a Larger Work\n+\n+You may create and distribute a Larger Work under terms of Your choice,\n+provided that You also comply with the requirements of this License for\n+the Covered Software. If the Larger Work is a combination of Covered\n+Software with a work governed by one or more Secondary Licenses, and the\n+Covered Software is not Incompatible With Secondary Licenses, this\n+License permits You to additionally distribute such Covered Software\n+under the terms of such Secondary License(s), so that the recipient of\n+the Larger Work may, at their option, further distribute the Covered\n+Software under the terms of either this License or such Secondary\n+License(s).\n+\n+3.4. Notices\n+\n+You may not remove or alter the substance of any license notices\n+(including copyright notices, patent notices, disclaimers of warranty,\n+or limitations of liability) contained within the Source Code Form of\n+the Covered Software, except that You may alter any license notices to\n+the extent required to remedy known factual inaccuracies.\n+\n+3.5. Application of Additional Terms\n+\n+You may choose to offer, and to charge a fee for, warranty, support,\n+indemnity or liability obligations to one or more recipients of Covered\n+Software. However, You may do so only on Your own behalf, and not on\n+behalf of any Contributor. You must make it absolutely clear that any\n+such warranty, support, indemnity, or liability obligation is offered by\n+You alone, and You hereby agree to indemnify every Contributor for any\n+liability incurred by such Contributor as a result of warranty, support,\n+indemnity or liability terms You offer. You may include additional\n+disclaimers of warranty and limitations of liability specific to any\n+jurisdiction.\n+\n+4. Inability to Comply Due to Statute or Regulation\n+---------------------------------------------------\n+\n+If it is impossible for You to comply with any of the terms of this\n+License with respect to some or all of the Covered Software due to\n+statute, judicial order, or regulation then You must: (a) comply with\n+the terms of this License to the maximum extent possible; and (b)\n+describe the limitations and the code they affect. Such description must\n+be placed in a text file included with all distributions of the Covered\n+Software under this License. Except to the extent prohibited by statute\n+or regulation, such description must be sufficiently detailed for a\n+recipient of ordinary skill to be able to understand it.\n+\n+5. Termination\n+--------------\n+\n+5.1. The rights granted under this License will terminate automatically\n+if You fail to comply with any of its terms. However, if You become\n+compliant, then the rights granted under this License from a particular\n+Contributor are reinstated (a) provisionally, unless and until such\n+Contributor explicitly and finally terminates Your grants, and (b) on an\n+ongoing basis, if such Contributor fails to notify You of the\n+non-compliance by some reasonable means prior to 60 days after You have\n+come back into compliance. Moreover, Your grants from a particular\n+Contributor are reinstated on an ongoing basis if such Contributor\n+notifies You of the non-compliance by some reasonable means, this is the\n+first time You have received notice of non-compliance with this License\n+from such Contributor, and You become compliant prior to 30 days after\n+Your receipt of the notice.\n+\n+5.2. If You initiate litigation against any entity by asserting a patent\n+infringement claim (excluding declaratory judgment actions,\n+counter-claims, and cross-claims) alleging that a Contributor Version\n+directly or indirectly infringes any patent, then the rights granted to\n+You by any and all Contributors for the Covered Software under Section\n+2.1 of this License shall terminate.\n+\n+5.3. In the event of termination under Sections 5.1 or 5.2 above, all\n+end user license agreements (excluding distributors and resellers) which\n+have been validly granted by You or Your distributors under this License\n+prior to termination shall survive termination.\n+\n+************************************************************************\n+*                                                                      *\n+*  6. Disclaimer of Warranty                                           *\n+*  -------------------------                                           *\n+*                                                                      *\n+*  Covered Software is provided under this License on an \"as is\"       *\n+*  basis, without warranty of any kind, either expressed, implied, or  *\n+*  statutory, including, without limitation, warranties that the       *\n+*  Covered Software is free of defects, merchantable, fit for a        *\n+*  particular purpose or non-infringing. The entire risk as to the     *\n+*  quality and performance of the Covered Software is with You.        *\n+*  Should any Covered Software prove defective in any respect, You     *\n+*  (not any Contributor) assume the cost of any necessary servicing,   *\n+*  repair, or correction. This disclaimer of warranty constitutes an   *\n+*  essential part of this License. No use of any Covered Software is   *\n+*  authorized under this License except under this disclaimer.         *\n+*                                                                      *\n+************************************************************************\n+\n+************************************************************************\n+*                                                                      *\n+*  7. Limitation of Liability                                          *\n+*  --------------------------                                          *\n+*                                                                      *\n+*  Under no circumstances and under no legal theory, whether tort      *\n+*  (including negligence), contract, or otherwise, shall any           *\n+*  Contributor, or anyone who distributes Covered Software as          *\n+*  permitted above, be liable to You for any direct, indirect,         *\n+*  special, incidental, or consequential damages of any character      *\n+*  including, without limitation, damages for lost profits, loss of    *\n+*  goodwill, work stoppage, computer failure or malfunction, or any    *\n+*  and all other commercial damages or losses, even if such party      *\n+*  shall have been informed of the possibility of such damages. This   *\n+*  limitation of liability shall not apply to liability for death or   *\n+*  personal injury resulting from such party's negligence to the       *\n+*  extent applicable law prohibits such limitation. Some               *\n+*  jurisdictions do not allow the exclusion or limitation of           *\n+*  incidental or consequential damages, so this exclusion and          *\n+*  limitation may not apply to You.                                    *\n+*                                                                      *\n+************************************************************************\n+\n+8. Litigation\n+-------------\n+\n+Any litigation relating to this License may be brought only in the\n+courts of a jurisdiction where the defendant maintains its principal\n+place of business and such litigation shall be governed by laws of that\n+jurisdiction, without reference to its conflict-of-law provisions.\n+Nothing in this Section shall prevent a party's ability to bring\n+cross-claims or counter-claims.\n+\n+9. Miscellaneous\n+----------------\n+\n+This License represents the complete agreement concerning the subject\n+matter hereof. If any provision of this License is held to be\n+unenforceable, such provision shall be reformed only to the extent\n+necessary to make it enforceable. Any law or regulation which provides\n+that the language of a contract shall be construed against the drafter\n+shall not be used to construe this License against a Contributor.\n+\n+10. Versions of the License\n+---------------------------\n+\n+10.1. New Versions\n+\n+Mozilla Foundation is the license steward. Except as provided in Section\n+10.3, no one other than the license steward has the right to modify or\n+publish new versions of this License. Each version will be given a\n+distinguishing version number.\n+\n+10.2. Effect of New Versions\n+\n+You may distribute the Covered Software under the terms of the version\n+of the License under which You originally received the Covered Software,\n+or under the terms of any subsequent version published by the license\n+steward.\n+\n+10.3. Modified Versions\n+\n+If you create software not governed by this License, and you want to\n+create a new license for such software, you may create and use a\n+modified version of this License if you rename the license and remove\n+any references to the name of the license steward (except to note that\n+such modified license differs from this License).\n+\n+10.4. Distributing Source Code Form that is Incompatible With Secondary\n+Licenses\n+\n+If You choose to distribute Source Code Form that is Incompatible With\n+Secondary Licenses under the terms of this version of the License, the\n+notice described in Exhibit B of this License must be attached.\n+\n+Exhibit A - Source Code Form License Notice\n+-------------------------------------------\n+\n+  This Source Code Form is subject to the terms of the Mozilla Public\n+  License, v. 2.0. If a copy of the MPL was not distributed with this\n+  file, You can obtain one at https://mozilla.org/MPL/2.0/.\n+\n+If it is not possible or desirable to put the notice in a particular\n+file, then You may include the notice in a location (such as a LICENSE\n+file in a relevant directory) where a recipient would be likely to look\n+for such a notice.\n+\n+You may add additional accurate notices of copyright ownership.\n+\n+Exhibit B - \"Incompatible With Secondary Licenses\" Notice\n+---------------------------------------------------------\n+\n+  This Source Code Form is \"Incompatible With Secondary Licenses\", as\n+  defined by the Mozilla Public License, v. 2.0."
            },
            {
                "sha": "f07522f399259b845295cf572be7dab9d77183a6",
                "filename": "composer.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/composer.json",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/composer.json",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/composer.json?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b",
                "patch": "@@ -29,6 +29,7 @@\n \t\t\"ezyang/htmlpurifier\": \"4.17.0\",\n \t\t\"gravatarphp/gravatar\": \"dev-master#6b9f6a45477ce48285738d9d0c3f0dbf97abe263\",\n \t\t\"hamza221/html2text\": \"^1.0\",\n+\t\t\"jeremykendall/php-domain-parser\": \"^6.3\",\n \t\t\"nextcloud/horde-managesieve\": \"^1.0\",\n \t\t\"nextcloud/horde-smtp\": \"^1.0.2\",\n \t\t\"nextcloud/kitinerary\": \"^1.0\","
            },
            {
                "sha": "383422a8a8778ed7d2a553787cc7744c34b7a2ae",
                "filename": "composer.lock",
                "status": "modified",
                "additions": 94,
                "deletions": 1,
                "changes": 95,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/composer.lock",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/composer.lock",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/composer.lock?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b",
                "patch": "@@ -4,7 +4,7 @@\n         \"Read more about it at https://getcomposer.org/doc/01-basic-usage.md#installing-dependencies\",\n         \"This file is @generated automatically\"\n     ],\n-    \"content-hash\": \"f724c81587861889c21f7a967a7a7770\",\n+    \"content-hash\": \"57e45be160ba915d482665125e585c4e\",\n     \"packages\": [\n         {\n             \"name\": \"amphp/amp\",\n@@ -1809,6 +1809,99 @@\n             },\n             \"time\": \"2023-08-16T11:30:50+00:00\"\n         },\n+        {\n+            \"name\": \"jeremykendall/php-domain-parser\",\n+            \"version\": \"6.3.0\",\n+            \"source\": {\n+                \"type\": \"git\",\n+                \"url\": \"https://github.com/jeremykendall/php-domain-parser.git\",\n+                \"reference\": \"34c7177cf322771fc241b9dcc8eda89f41a0149c\"\n+            },\n+            \"dist\": {\n+                \"type\": \"zip\",\n+                \"url\": \"https://api.github.com/repos/jeremykendall/php-domain-parser/zipball/34c7177cf322771fc241b9dcc8eda89f41a0149c\",\n+                \"reference\": \"34c7177cf322771fc241b9dcc8eda89f41a0149c\",\n+                \"shasum\": \"\"\n+            },\n+            \"require\": {\n+                \"ext-filter\": \"*\",\n+                \"ext-intl\": \"*\",\n+                \"ext-json\": \"*\",\n+                \"php\": \"^8.1\"\n+            },\n+            \"require-dev\": {\n+                \"friendsofphp/php-cs-fixer\": \"^v3.13.2\",\n+                \"guzzlehttp/guzzle\": \"^7.5\",\n+                \"guzzlehttp/psr7\": \"^1.6 || ^2.4.3\",\n+                \"phpstan/phpstan\": \"^1.10.3\",\n+                \"phpstan/phpstan-phpunit\": \"^1.3.8\",\n+                \"phpstan/phpstan-strict-rules\": \"^1.5.0\",\n+                \"phpunit/phpunit\": \"^10.0.12\",\n+                \"psr/http-factory\": \"^1.0.1\",\n+                \"psr/simple-cache\": \"^1.0.1\",\n+                \"symfony/cache\": \"^v5.0.0 || ^v6.0.0\"\n+            },\n+            \"suggest\": {\n+                \"league/uri\": \"To parse URL and validate host\",\n+                \"psr/http-client-implementation\": \"To use the storage functionnality which depends on PSR-18\",\n+                \"psr/http-factory-implementation\": \"To use the storage functionnality which depends on PSR-17\",\n+                \"psr/simple-cache-implementation\": \"To use the storage functionnality which depends on PSR-16\"\n+            },\n+            \"type\": \"library\",\n+            \"extra\": {\n+                \"branch-alias\": {\n+                    \"dev-master\": \"6.x-dev\"\n+                }\n+            },\n+            \"autoload\": {\n+                \"psr-4\": {\n+                    \"Pdp\\\\\": \"src/\"\n+                }\n+            },\n+            \"notification-url\": \"https://packagist.org/downloads/\",\n+            \"license\": [\n+                \"MIT\"\n+            ],\n+            \"authors\": [\n+                {\n+                    \"name\": \"Jeremy Kendall\",\n+                    \"homepage\": \"https://about.me/jeremykendall\",\n+                    \"role\": \"Developer\"\n+                },\n+                {\n+                    \"name\": \"Ignace Nyamagana Butera\",\n+                    \"homepage\": \"https://nyamsprod.com\",\n+                    \"role\": \"Developer\"\n+                },\n+                {\n+                    \"name\": \"Contributors\",\n+                    \"homepage\": \"https://github.com/jeremykendall/php-domain-parser/graphs/contributors\"\n+                }\n+            ],\n+            \"description\": \"Public Suffix List and IANA Root Zone Database based Domain parsing implemented in PHP.\",\n+            \"homepage\": \"https://github.com/jeremykendall/php-domain-parser\",\n+            \"keywords\": [\n+                \"PSL\",\n+                \"Public Suffix List\",\n+                \"Top Level Domains\",\n+                \"domain parsing\",\n+                \"iana\",\n+                \"icann\",\n+                \"idn\",\n+                \"tld\"\n+            ],\n+            \"support\": {\n+                \"issues\": \"https://github.com/jeremykendall/php-domain-parser/issues\",\n+                \"source\": \"https://github.com/jeremykendall/php-domain-parser\"\n+            },\n+            \"funding\": [\n+                {\n+                    \"url\": \"https://github.com/sponsors/nyamsprod\",\n+                    \"type\": \"github\"\n+                }\n+            ],\n+            \"time\": \"2023-02-25T16:31:15+00:00\"\n+        },\n         {\n             \"name\": \"nextcloud/horde-managesieve\",\n             \"version\": \"v1.0.0\","
            },
            {
                "sha": "8bca78b80f1a6048e2794a467320543b3a0245ea",
                "filename": "lib/Dns/Resolver.php",
                "status": "added",
                "additions": 31,
                "deletions": 0,
                "changes": 31,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/lib%2FDns%2FResolver.php",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/lib%2FDns%2FResolver.php",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/lib%2FDns%2FResolver.php?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b",
                "patch": "@@ -0,0 +1,31 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+/**\n+ * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n+ * SPDX-License-Identifier: AGPL-3.0-or-later\n+ */\n+\n+namespace OCA\\Mail\\Dns;\n+\n+use Pdp\\Domain;\n+use Pdp\\Rules;\n+use function dns_get_record;\n+\n+class Resolver {\n+\n+\tpublic function resolve(string $hostname, int $type): array|false {\n+\t\treturn dns_get_record($hostname, $type);\n+\t}\n+\n+\tpublic function isSuffix(string $hostname): bool {\n+\t\t$publicSuffixList = Rules::fromPath(__DIR__ . '/../../resources/public_suffix_list.dat');\n+\t\t$domain = Domain::fromIDNA2008($hostname);\n+\n+\t\t$result = $publicSuffixList->resolve($domain);\n+\n+\t\treturn $result->secondLevelDomain()->toString() === '';\n+\t}\n+\n+}"
            },
            {
                "sha": "6168aa6e0e0be4b8ecc49a905e6890a65ca91237",
                "filename": "lib/Service/AutoConfig/IspDb.php",
                "status": "modified",
                "additions": 12,
                "deletions": 3,
                "changes": 15,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/lib%2FService%2FAutoConfig%2FIspDb.php",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/lib%2FService%2FAutoConfig%2FIspDb.php",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/lib%2FService%2FAutoConfig%2FIspDb.php?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b",
                "patch": "@@ -12,10 +12,12 @@\n \n use Exception;\n use Horde_Mail_Rfc822_Address;\n+use OCA\\Mail\\Dns\\Resolver;\n use OCP\\Http\\Client\\IClient;\n use OCP\\Http\\Client\\IClientService;\n use Psr\\Log\\LoggerInterface;\n use SimpleXMLElement;\n+use function explode;\n use function str_replace;\n use function strtolower;\n \n@@ -25,6 +27,7 @@ class IspDb {\n \n \t/** @var LoggerInterface */\n \tprivate $logger;\n+\tprivate Resolver $dnsResolver;\n \n \t/** @returns string[] */\n \tpublic function getUrls(): array {\n@@ -37,8 +40,11 @@ public function getUrls(): array {\n \t\t];\n \t}\n \n-\tpublic function __construct(IClientService $clientService, LoggerInterface $logger) {\n+\tpublic function __construct(IClientService $clientService,\n+\t\tResolver $dnsResolver,\n+\t\tLoggerInterface $logger) {\n \t\t$this->client = $clientService->newClient();\n+\t\t$this->dnsResolver = $dnsResolver;\n \t\t$this->logger = $logger;\n \t}\n \n@@ -145,11 +151,14 @@ public function query(string $domain, Horde_Mail_Rfc822_Address $email, bool $tr\n \t\t\t}\n \t\t}\n \n-\t\tif ($tryMx && ($dns = dns_get_record($domain, DNS_MX))) {\n+\t\tif ($tryMx && ($dns = $this->dnsResolver->resolve($domain, DNS_MX))) {\n \t\t\t$domain = $dns[0]['target'];\n \t\t\tif (!($config = $this->query($domain, $email, false))) {\n \t\t\t\t[, $domain] = explode('.', $domain, 2);\n-\t\t\t\t$config = $this->query($domain, $email, false);\n+\t\t\t\t// Only try second-level domains and deeper\n+\t\t\t\tif (!$this->dnsResolver->isSuffix($domain)) {\n+\t\t\t\t\t$config = $this->query($domain, $email, false);\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \t\treturn $config;"
            },
            {
                "sha": "10c967a0c8c906415816d4b7a1fd62d4bd5d0ce2",
                "filename": "resources/public_suffix_list.dat",
                "status": "added",
                "additions": 15837,
                "deletions": 0,
                "changes": 15837,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/resources%2Fpublic_suffix_list.dat",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/resources%2Fpublic_suffix_list.dat",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/resources%2Fpublic_suffix_list.dat?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b"
            },
            {
                "sha": "634a95d205a99581914568fca7851cafbe707592",
                "filename": "resources/public_suffix_list.dat.license",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/resources%2Fpublic_suffix_list.dat.license",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/resources%2Fpublic_suffix_list.dat.license",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/resources%2Fpublic_suffix_list.dat.license?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b",
                "patch": "@@ -0,0 +1,2 @@\n+SPDX-FileCopyrightText: Mozilla Foundation\n+SPDX-License-Identifier: MPL-2.0"
            },
            {
                "sha": "9b10ff3f874ca1262923ca9ef3bed6e3fc0aff49",
                "filename": "tests/Unit/Dns/ResolverTest.php",
                "status": "added",
                "additions": 40,
                "deletions": 0,
                "changes": 40,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/tests%2FUnit%2FDns%2FResolverTest.php",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/tests%2FUnit%2FDns%2FResolverTest.php",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/tests%2FUnit%2FDns%2FResolverTest.php?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b",
                "patch": "@@ -0,0 +1,40 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+/**\n+ * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n+ * SPDX-License-Identifier: AGPL-3.0-or-later\n+ */\n+\n+namespace OCA\\Mail\\Tests\\Unit\\Dns;\n+\n+use ChristophWurst\\Nextcloud\\Testing\\TestCase;\n+use OCA\\Mail\\Dns\\Resolver;\n+\n+class ResolverTest extends TestCase {\n+\tprivate Resolver $resolver;\n+\n+\tprotected function setUp(): void {\n+\t\tparent::setUp();\n+\n+\t\t$this->resolver = new Resolver();\n+\t}\n+\n+\tpublic function domainSplitData(): array {\n+\t\treturn [\n+\t\t\t['nextcloud.com', false],\n+\t\t\t['test.ac.at', false],\n+\t\t\t['ac.at', true],\n+\t\t];\n+\t}\n+\n+\t/**\n+\t * @dataProvider domainSplitData\n+\t */\n+\tpublic function testGetSecondLevelDomain(string $hostname, bool $expectedResult): void {\n+\t\t$result = $this->resolver->isSuffix($hostname);\n+\n+\t\tself::assertSame($expectedResult, $result);\n+\t}\n+}"
            },
            {
                "sha": "924c059e6f56badb7efe71f988fe9cbb82040e61",
                "filename": "tests/Unit/Service/Autoconfig/IspDbTest.php",
                "status": "modified",
                "additions": 80,
                "deletions": 9,
                "changes": 89,
                "blob_url": "https://github.com/nextcloud/mail/blob/a84c70e15d814dab6f0e8eda71bbaaf48152079b/tests%2FUnit%2FService%2FAutoconfig%2FIspDbTest.php",
                "raw_url": "https://github.com/nextcloud/mail/raw/a84c70e15d814dab6f0e8eda71bbaaf48152079b/tests%2FUnit%2FService%2FAutoconfig%2FIspDbTest.php",
                "contents_url": "https://api.github.com/repos/nextcloud/mail/contents/tests%2FUnit%2FService%2FAutoconfig%2FIspDbTest.php?ref=a84c70e15d814dab6f0e8eda71bbaaf48152079b",
                "patch": "@@ -11,13 +11,18 @@\n namespace OCA\\Mail\\Tests\\Unit\\Service\\Autoconfig;\n \n use ChristophWurst\\Nextcloud\\Testing\\TestCase;\n+use Exception;\n use Horde_Mail_Rfc822_Address;\n+use InvalidArgumentException;\n+use OCA\\Mail\\Dns\\Resolver;\n use OCA\\Mail\\Service\\AutoConfig\\IspDb;\n use OCP\\Http\\Client\\IClient;\n use OCP\\Http\\Client\\IClientService;\n use OCP\\Http\\Client\\IResponse;\n use PHPUnit\\Framework\\MockObject\\MockObject;\n use Psr\\Log\\LoggerInterface;\n+use function file_get_contents;\n+use function str_starts_with;\n \n class IspDbTest extends TestCase {\n \t/** @var IClientService|MockObject */\n@@ -26,18 +31,30 @@ class IspDbTest extends TestCase {\n \t/** @var IClient|MockObject */\n \tprivate $client;\n \n+\t/** @var MockObject|Resolver */\n+\tprivate MockObject|Resolver $dnsResolver;\n+\n \t/** @var LoggerInterface|MockObject */\n \tprivate $logger;\n \n+\tprivate IspDb $ispDb;\n+\n \tprotected function setUp(): void {\n \t\tparent::setUp();\n \n \t\t$this->clientService = $this->createMock(IClientService::class);\n \t\t$this->client = $this->createMock(IClient::class);\n+\t\t$this->dnsResolver = $this->createMock(Resolver::class);\n \t\t$this->logger = $this->createMock(LoggerInterface::class);\n \n \t\t$this->clientService->method('newClient')\n \t\t\t->willReturn($this->client);\n+\n+\t\t$this->ispDb = new IspDb(\n+\t\t\t$this->clientService,\n+\t\t\t$this->dnsResolver,\n+\t\t\t$this->logger,\n+\t\t);\n \t}\n \n \tpublic function fakeAutoconfigData() {\n@@ -61,13 +78,13 @@ public function testQueryGmx(): void {\n \t\t\t\t\t\t$response = $this->createMock(IResponse::class);\n \t\t\t\t\t\t$response->method('getBody')->willReturn(file_get_contents(__DIR__ . '/../../../resources/autoconfig-gmx.xml'));\n \t\t\t\t\t\treturn $response;\n+\t\t\t\t\tdefault:\n+\t\t\t\t\t\tthrow new InvalidArgumentException();\n \t\t\t\t}\n \t\t\t});\n \n-\t\t$ispDb = new IspDb($this->clientService, $this->logger);\n-\n \t\t$email = new Horde_Mail_Rfc822_Address('test@gmx.com');\n-\t\t$configuration = $ispDb->query('gmx.com', $email);\n+\t\t$configuration = $this->ispDb->query('gmx.com', $email);\n \n \t\tself::assertNotNull($configuration);\n \t\tself::assertNotNull($configuration->getImapConfig());\n@@ -91,10 +108,8 @@ public function testQueryOutlook(): void {\n \t\t\t\t}\n \t\t\t});\n \n-\t\t$ispDb = new IspDb($this->clientService, $this->logger);\n-\n \t\t$email = new Horde_Mail_Rfc822_Address('test@outlook.com');\n-\t\t$configuration = $ispDb->query('outlook.com', $email);\n+\t\t$configuration = $this->ispDb->query('outlook.com', $email);\n \n \t\tself::assertNotNull($configuration);\n \t\tself::assertNotNull($configuration->getImapConfig());\n@@ -109,13 +124,69 @@ public function testQueryPosteo(): void {\n \t\t\t\treturn $response;\n \t\t\t});\n \n-\t\t$ispDb = new IspDb($this->clientService, $this->logger);\n-\n \t\t$email = new Horde_Mail_Rfc822_Address('test@postdeo.org');\n-\t\t$configuration = $ispDb->query('posteo.org', $email);\n+\t\t$configuration = $this->ispDb->query('posteo.org', $email);\n \n \t\tself::assertNotNull($configuration);\n \t\tself::assertNotNull($configuration->getImapConfig());\n \t\tself::assertNotNull($configuration->getSmtpConfig());\n \t}\n+\n+\tpublic function testQueryByMx(): void {\n+\t\t$this->dnsResolver->expects(self::once())\n+\t\t\t->method('resolve')\n+\t\t\t->with('company.org', DNS_MX)\n+\t\t\t->willReturn([\n+\t\t\t\t[\n+\t\t\t\t\t'target' => 'mx.company.org',\n+\t\t\t\t]\n+\t\t\t]);\n+\t\t$this->dnsResolver->expects(self::once())\n+\t\t\t->method('isSuffix')\n+\t\t\t->with('company.org')\n+\t\t\t->willReturn(false);\n+\t\t$contactedServer = false;\n+\t\t$this->client->method('get')\n+\t\t\t->willReturnCallback(function ($url) use (&$contactedServer) {\n+\t\t\t\tif (str_starts_with($url, 'https://autoconfig.company.org')) {\n+\t\t\t\t\t$contactedServer = true;\n+\t\t\t\t}\n+\t\t\t\tthrow new Exception('Random error');\n+\t\t\t});\n+\n+\t\t$email = new Horde_Mail_Rfc822_Address('test@company.org');\n+\t\t$configuration = $this->ispDb->query('company.org', $email);\n+\n+\t\tself::assertTrue($contactedServer, 'Should have contacted the server');\n+\t\tself::assertNull($configuration);\n+\t}\n+\n+\tpublic function testQueryByMxSameDomain(): void {\n+\t\t$this->dnsResolver->expects(self::once())\n+\t\t\t->method('resolve')\n+\t\t\t->with('company.org', DNS_MX)\n+\t\t\t->willReturn([\n+\t\t\t\t[\n+\t\t\t\t\t'target' => 'company.org',\n+\t\t\t\t]\n+\t\t\t]);\n+\t\t$this->dnsResolver->expects(self::once())\n+\t\t\t->method('isSuffix')\n+\t\t\t->with('org')\n+\t\t\t->willReturn(true);\n+\t\t$contactedServer = false;\n+\t\t$this->client->method('get')\n+\t\t\t->willReturnCallback(function ($url) use (&$contactedServer) {\n+\t\t\t\tif (str_starts_with($url, 'https://autoconfig.org')) {\n+\t\t\t\t\t$contactedServer = true;\n+\t\t\t\t}\n+\t\t\t\tthrow new Exception('Random error');\n+\t\t\t});\n+\n+\t\t$email = new Horde_Mail_Rfc822_Address('test@company.org');\n+\t\t$configuration = $this->ispDb->query('company.org', $email);\n+\n+\t\tself::assertFalse($contactedServer, 'Should not have contacted the server');\n+\t\tself::assertNull($configuration);\n+\t}\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/desktop/commits/97539218e6f63c3a3fd1694cb7d8aef27c5910d7",
        "url": "https://api.github.com/repos/nextcloud/desktop/commits/97539218e6f63c3a3fd1694cb7d8aef27c5910d7",
        "html_url": "https://github.com/nextcloud/desktop/commit/97539218e6f63c3a3fd1694cb7d8aef27c5910d7",
        "message": "Merge pull request #7333 from nextcloud/bugfix/signature\n\nBugfix/signature",
        "files": [
            {
                "sha": "38e4a424c5a736cc59ee04238e6cb269d6c5e4e7",
                "filename": "src/libsync/discoveryphase.cpp",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/nextcloud/desktop/blob/97539218e6f63c3a3fd1694cb7d8aef27c5910d7/src%2Flibsync%2Fdiscoveryphase.cpp",
                "raw_url": "https://github.com/nextcloud/desktop/raw/97539218e6f63c3a3fd1694cb7d8aef27c5910d7/src%2Flibsync%2Fdiscoveryphase.cpp",
                "contents_url": "https://api.github.com/repos/nextcloud/desktop/contents/src%2Flibsync%2Fdiscoveryphase.cpp?ref=97539218e6f63c3a3fd1694cb7d8aef27c5910d7",
                "patch": "@@ -696,6 +696,14 @@ void DiscoverySingleDirectoryJob::metadataReceived(const QJsonDocument &json, in\n         }\n     }\n \n+    if (job->signature().isEmpty()) {\n+        qCDebug(lcDiscovery) << \"Initial signature is empty.\";\n+        _account->reportClientStatus(OCC::ClientStatusReportingStatus::E2EeError_GeneralError);\n+        emit finished(HttpError{0, tr(\"Encrypted metadata setup error: initial signature from server is empty.\")});\n+        deleteLater();\n+        return;\n+    }\n+\n     const auto e2EeFolderMetadata = new FolderMetadata(_account,\n                                                  _remoteRootFolderPath,\n                                                  statusCode == 404 ? QByteArray{} : json.toJson(QJsonDocument::Compact),"
            },
            {
                "sha": "f3a21953d341df034c49714272020dec6899338c",
                "filename": "src/libsync/foldermetadata.cpp",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/nextcloud/desktop/blob/97539218e6f63c3a3fd1694cb7d8aef27c5910d7/src%2Flibsync%2Ffoldermetadata.cpp",
                "raw_url": "https://github.com/nextcloud/desktop/raw/97539218e6f63c3a3fd1694cb7d8aef27c5910d7/src%2Flibsync%2Ffoldermetadata.cpp",
                "contents_url": "https://api.github.com/repos/nextcloud/desktop/contents/src%2Flibsync%2Ffoldermetadata.cpp?ref=97539218e6f63c3a3fd1694cb7d8aef27c5910d7",
                "patch": "@@ -181,6 +181,12 @@ void FolderMetadata::setupExistingMetadata(const QByteArray &metadata)\n         }\n     }\n \n+    if (_initialSignature.isEmpty()) {\n+        qCDebug(lcCseMetadata()) << \"Signature is empty\";\n+        _account->reportClientStatus(OCC::ClientStatusReportingStatus::E2EeError_GeneralError);\n+        return;\n+    }\n+\n     if (!parseFileDropPart(metaDataDoc)) {\n         qCDebug(lcCseMetadata()) << \"Could not parse filedrop part\";\n         return;"
            },
            {
                "sha": "9b2304d0251b623152292d0e949472d88d7a6e98",
                "filename": "test/testclientsideencryptionv2.cpp",
                "status": "modified",
                "additions": 35,
                "deletions": 0,
                "changes": 35,
                "blob_url": "https://github.com/nextcloud/desktop/blob/97539218e6f63c3a3fd1694cb7d8aef27c5910d7/test%2Ftestclientsideencryptionv2.cpp",
                "raw_url": "https://github.com/nextcloud/desktop/raw/97539218e6f63c3a3fd1694cb7d8aef27c5910d7/test%2Ftestclientsideencryptionv2.cpp",
                "contents_url": "https://api.github.com/repos/nextcloud/desktop/contents/test%2Ftestclientsideencryptionv2.cpp?ref=97539218e6f63c3a3fd1694cb7d8aef27c5910d7",
                "patch": "@@ -192,6 +192,41 @@ private slots:\n         QVERIFY(metadataFromJson->isValid());\n     }\n \n+    void testFolderMetadataWithEmptySignatureDecryptFails()\n+    {\n+        QScopedPointer<FolderMetadata> metadata(new FolderMetadata(_account, \"/\", FolderMetadata::FolderType::Root));\n+        QSignalSpy metadataSetupCompleteSpy(metadata.data(), &FolderMetadata::setupComplete);\n+        metadataSetupCompleteSpy.wait();\n+        QCOMPARE(metadataSetupCompleteSpy.count(), 1);\n+        QVERIFY(metadata->isValid());\n+\n+        const auto encryptedMetadata = metadata->encryptedMetadata();\n+        QVERIFY(!encryptedMetadata.isEmpty());\n+\n+        const auto signature = metadata->metadataSignature();\n+        QVERIFY(!signature.isEmpty());\n+\n+        auto encryptedMetadataCopy = encryptedMetadata;\n+        encryptedMetadataCopy.replace(\"\\\"\", \"\\\\\\\"\");\n+\n+        const QJsonDocument ocsDoc = QJsonDocument::fromJson(QStringLiteral(\"{\\\"ocs\\\": {\\\"data\\\": {\\\"meta-data\\\": \\\"%1\\\"}}}\")\n+                                                           .arg(QString::fromUtf8(encryptedMetadataCopy)).toUtf8());\n+\n+        const QByteArray emptySignature = {};\n+        QScopedPointer<FolderMetadata> metadataFromJson(new FolderMetadata(_account, \"/\",\n+                                                                           ocsDoc.toJson(),\n+                                                                           RootEncryptedFolderInfo::makeDefault(),\n+                                                                           emptySignature));\n+\n+        QSignalSpy metadataSetupExistingCompleteSpy(metadataFromJson.data(), &FolderMetadata::setupComplete);\n+        metadataSetupExistingCompleteSpy.wait();\n+        QCOMPARE(metadataSetupExistingCompleteSpy.count(), 1);\n+\n+        QVERIFY(metadataFromJson->metadataSignature().isEmpty());\n+        QVERIFY(metadataFromJson->metadataKeyForDecryption().isEmpty());\n+        QVERIFY(!metadataFromJson->isValid());\n+    }\n+\n     void testE2EeFolderMetadataSharing()\n     {\n         // instantiate empty metadata, add a file, and share with a second user \"sharee\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/tables/commits/13ca45f1b9f70f694aea81b78bc7416ec840c332",
        "url": "https://api.github.com/repos/nextcloud/tables/commits/13ca45f1b9f70f694aea81b78bc7416ec840c332",
        "html_url": "https://github.com/nextcloud/tables/commit/13ca45f1b9f70f694aea81b78bc7416ec840c332",
        "message": "Merge pull request #1406 from nextcloud/enh/noid/perm-mw-read\n\nrefactor: Extend Permission Middleware usage and replace deprecated annotations with attributes",
        "files": [
            {
                "sha": "8d86aef18d05b506c047bc231132f805a853795d",
                "filename": "lib/Controller/Api1Controller.php",
                "status": "modified",
                "additions": 128,
                "deletions": 149,
                "changes": 277,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApi1Controller.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApi1Controller.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FApi1Controller.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -30,6 +30,9 @@\n use OCP\\AppFramework\\Db\\DoesNotExistException;\n use OCP\\AppFramework\\Db\\MultipleObjectsReturnedException;\n use OCP\\AppFramework\\Http;\n+use OCP\\AppFramework\\Http\\Attribute\\CORS;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n+use OCP\\AppFramework\\Http\\Attribute\\NoCSRFRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IL10N;\n use OCP\\IRequest;\n@@ -96,14 +99,13 @@ public function __construct(\n \t/**\n \t * Returns all Tables\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @return DataResponse<Http::STATUS_OK, TablesTable[], array{}>|DataResponse<Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n \t *\n \t * 200: Tables returned\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function index(): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->tableService->formatTables($this->tableService->findAll($this->userId)));\n@@ -117,10 +119,6 @@ public function index(): DataResponse {\n \t/**\n \t * Create a new table and return it\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param string $title Title of the table\n \t * @param string|null $emoji Emoji for the table\n \t * @param string $template Template to use if wanted\n@@ -129,6 +127,9 @@ public function index(): DataResponse {\n \t *\n \t * 200: Tables returned\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function createTable(string $title, ?string $emoji, string $template = 'custom'): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->tableService->create($title, $template, $emoji)->jsonSerialize());\n@@ -142,17 +143,17 @@ public function createTable(string $title, ?string $emoji, string $template = 'c\n \t/**\n \t * returns table scheme\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @return DataResponse<Http::STATUS_OK, TablesTable, array{'Content-Disposition'?:string,'Content-Type'?:string}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Table returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function showScheme(int $tableId): DataResponse {\n \t\ttry {\n \t\t\t$scheme = $this->tableService->getScheme($tableId);\n@@ -175,17 +176,17 @@ public function showScheme(int $tableId): DataResponse {\n \t/**\n \t * Get a table object\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @return DataResponse<Http::STATUS_OK, TablesTable, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Table returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function getTable(int $tableId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->tableService->find($tableId)->jsonSerialize());\n@@ -207,10 +208,6 @@ public function getTable(int $tableId): DataResponse {\n \t/**\n \t * Update tables properties\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @param string|null $title New table title\n \t * @param string|null $emoji New table emoji\n@@ -221,6 +218,10 @@ public function getTable(int $tableId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function updateTable(int $tableId, ?string $title = null, ?string $emoji = null, ?bool $archived = false): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->tableService->update($tableId, $title, $emoji, null, $archived, $this->userId)->jsonSerialize());\n@@ -242,17 +243,17 @@ public function updateTable(int $tableId, ?string $title = null, ?string $emoji\n \t/**\n \t * Delete a table\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @return DataResponse<Http::STATUS_OK, TablesTable, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Deleted table returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function deleteTable(int $tableId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->tableService->delete($tableId)->jsonSerialize());\n@@ -276,17 +277,17 @@ public function deleteTable(int $tableId): DataResponse {\n \t/**\n \t * Get all views for a table\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @return DataResponse<Http::STATUS_OK, TablesView[], array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Views returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function indexViews(int $tableId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->viewService->formatViews($this->viewService->findAll($this->tableService->find($tableId))));\n@@ -308,10 +309,6 @@ public function indexViews(int $tableId): DataResponse {\n \t/**\n \t * Create a new view for a table\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID that will hold the view\n \t * @param string $title Title for the view\n \t * @param string|null $emoji Emoji for the view\n@@ -322,6 +319,10 @@ public function indexViews(int $tableId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function createView(int $tableId, string $title, ?string $emoji): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->viewService->create($title, $emoji, $this->tableService->find($tableId))->jsonSerialize());\n@@ -339,17 +340,17 @@ public function createView(int $tableId, string $title, ?string $emoji): DataRes\n \t/**\n \t * Get a view object\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $viewId View ID\n \t * @return DataResponse<Http::STATUS_OK, TablesView, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: View returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function getView(int $viewId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->viewService->find($viewId)->jsonSerialize());\n@@ -371,10 +372,6 @@ public function getView(int $viewId): DataResponse {\n \t/**\n \t * Update a view via key-value sets\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $viewId View ID\n \t * @param array{key: 'title'|'emoji'|'description', value: string}|array{key: 'columns', value: int[]}|array{key: 'sort', value: array{columnId: int, mode: 'ASC'|'DESC'}}|array{key: 'filter', value: array{columnId: int, operator: 'begins-with'|'ends-with'|'contains'|'is-equal'|'is-greater-than'|'is-greater-than-or-equal'|'is-lower-than'|'is-lower-than-or-equal'|'is-empty', value: string|int|float}} $data key-value pairs\n \t * @return DataResponse<Http::STATUS_OK, TablesView, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_BAD_REQUEST|Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n@@ -384,6 +381,10 @@ public function getView(int $viewId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function updateView(int $viewId, array $data): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->viewService->update($viewId, $data)->jsonSerialize());\n@@ -405,17 +406,17 @@ public function updateView(int $viewId, array $data): DataResponse {\n \t/**\n \t * Delete a view\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $viewId View ID\n \t * @return DataResponse<Http::STATUS_OK, TablesView, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: View deleted\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function deleteView(int $viewId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->viewService->delete($viewId)->jsonSerialize());\n@@ -439,17 +440,16 @@ public function deleteView(int $viewId): DataResponse {\n \t/**\n \t * Get a share object\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $shareId Share ID\n \t * @return DataResponse<Http::STATUS_OK, TablesShare, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Share returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function getShare(int $shareId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->shareService->find($shareId)->jsonSerialize());\n@@ -472,15 +472,14 @@ public function getShare(int $shareId): DataResponse {\n \t * Get all shares for a view\n \t * Will be empty if view does not exist\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $viewId View ID\n \t * @return DataResponse<Http::STATUS_OK, TablesShare[], array{}>|DataResponse<Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n \t *\n \t * 200: Shares returned\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function indexViewShares(int $viewId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->shareService->formatShares($this->shareService->findAll('view', $viewId)));\n@@ -495,15 +494,14 @@ public function indexViewShares(int $viewId): DataResponse {\n \t * Get all shares for a table\n \t * Will be empty if table does not exist\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @return DataResponse<Http::STATUS_OK, TablesShare[], array{}>|DataResponse<Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n \t *\n \t * 200: Shares returned\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function indexTableShares(int $tableId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->shareService->formatShares($this->shareService->findAll('table', $tableId)));\n@@ -517,10 +515,6 @@ public function indexTableShares(int $tableId): DataResponse {\n \t/**\n \t * Create a new share\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $nodeId Node ID\n \t * @param 'table'|'view'|'context' $nodeType Node type\n \t * @param string $receiver Receiver ID\n@@ -537,6 +531,9 @@ public function indexTableShares(int $tableId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \t#[RequirePermission(permission: Application::PERMISSION_MANAGE)]\n \tpublic function createShare(\n \t\tint $nodeId,\n@@ -570,17 +567,16 @@ public function createShare(\n \t/**\n \t * Delete a share\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $shareId Share ID\n \t * @return DataResponse<Http::STATUS_OK, TablesShare, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: View deleted\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function deleteShare(int $shareId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->shareService->delete($shareId)->jsonSerialize());\n@@ -602,10 +598,6 @@ public function deleteShare(int $shareId): DataResponse {\n \t/**\n \t * Update a share permission\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $shareId Share ID\n \t * @param string $permissionType Permission type that should be changed\n \t * @param bool $permissionValue New permission value\n@@ -615,6 +607,9 @@ public function deleteShare(int $shareId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function updateSharePermissions(int $shareId, string $permissionType, bool $permissionValue): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->shareService->updatePermission($shareId, $permissionType, $permissionValue)->jsonSerialize());\n@@ -636,10 +631,6 @@ public function updateSharePermissions(int $shareId, string $permissionType, boo\n \t/**\n \t * Updates the display mode of a context share\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $shareId Share ID\n \t * @param int $displayMode The new value for the display mode of the nav bar icon. 0: hidden, 1: visible for recipients, 2: visible for all\n \t * @param string $target \"default\" to set the default, \"self\" to set an override for the authenticated user\n@@ -653,6 +644,9 @@ public function updateSharePermissions(int $shareId, string $permissionType, boo\n \t * @psalm-param int<0, 2> $displayMode\n \t * @psalm-param (\"default\"|\"self\") $target\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function updateShareDisplayMode(int $shareId, int $displayMode, string $target = 'default'): DataResponse {\n \t\tif ($target === 'default') {\n \t\t\t$userId = '';\n@@ -688,10 +682,6 @@ public function updateShareDisplayMode(int $shareId, int $displayMode, string $t\n \t * Get all columns for a table or a underlying view\n \t * Return an empty array if no columns were found\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @param int|null $viewId View ID\n \t * @return DataResponse<Http::STATUS_OK, TablesColumn[], array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n@@ -700,6 +690,9 @@ public function updateShareDisplayMode(int $shareId, int $displayMode, string $t\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function indexTableColumns(int $tableId, ?int $viewId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->columnService->formatColumns($this->columnService->findAllByTable($tableId, $viewId)));\n@@ -718,17 +711,17 @@ public function indexTableColumns(int $tableId, ?int $viewId): DataResponse {\n \t * Get all columns for a view\n \t * Return an empty array if no columns were found\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $viewId View ID\n \t * @return DataResponse<Http::STATUS_OK, TablesColumn[], array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: View deleted\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function indexViewColumns(int $viewId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->columnService->formatColumns($this->columnService->findAllByView($viewId)));\n@@ -750,10 +743,6 @@ public function indexViewColumns(int $viewId): DataResponse {\n \t/**\n \t * Create a column\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int|null $tableId Table ID\n \t * @param int|null $viewId View ID\n \t * @param string $title Title\n@@ -786,6 +775,9 @@ public function indexViewColumns(int $viewId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function createColumn(\n \t\t?int $tableId,\n \t\t?int $viewId,\n@@ -867,10 +859,6 @@ public function createColumn(\n \t/**\n \t * Update a column\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $columnId Column ID that will be updated\n \t * @param string|null $title Title\n \t * @param string|null $subtype Column sub type\n@@ -898,6 +886,9 @@ public function createColumn(\n \t *\n \t * 200: Updated column\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function updateColumn(\n \t\tint $columnId,\n \t\t?string $title,\n@@ -968,17 +959,16 @@ public function updateColumn(\n \t/**\n \t * Returns a column object\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $columnId Wanted Column ID\n \t * @return DataResponse<Http::STATUS_OK, TablesColumn, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Column returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function getColumn(int $columnId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->columnService->find($columnId)->jsonSerialize());\n@@ -1000,17 +990,16 @@ public function getColumn(int $columnId): DataResponse {\n \t/**\n \t * Delete a column\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $columnId Wanted Column ID\n \t * @return DataResponse<Http::STATUS_OK, TablesColumn, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Deleted column returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function deleteColumn(int $columnId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->columnService->delete($columnId)->jsonSerialize());\n@@ -1032,10 +1021,6 @@ public function deleteColumn(int $columnId): DataResponse {\n \t/**\n \t * List all rows values for a table, first row are the column titles\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @param int|null $limit Limit\n \t * @param int|null $offset Offset\n@@ -1045,6 +1030,10 @@ public function deleteColumn(int $columnId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function indexTableRowsSimple(int $tableId, ?int $limit, ?int $offset): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->v1Api->getData($tableId, $limit, $offset, $this->userId));\n@@ -1062,10 +1051,6 @@ public function indexTableRowsSimple(int $tableId, ?int $limit, ?int $offset): D\n \t/**\n \t * List all rows for a table\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @param int|null $limit Limit\n \t * @param int|null $offset Offset\n@@ -1075,6 +1060,10 @@ public function indexTableRowsSimple(int $tableId, ?int $limit, ?int $offset): D\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function indexTableRows(int $tableId, ?int $limit, ?int $offset): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->rowService->formatRows($this->rowService->findAllByTable($tableId, $this->userId, $limit, $offset)));\n@@ -1092,10 +1081,6 @@ public function indexTableRows(int $tableId, ?int $limit, ?int $offset): DataRes\n \t/**\n \t * List all rows for a view\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $viewId View ID\n \t * @param int|null $limit Limit\n \t * @param int|null $offset Offset\n@@ -1105,6 +1090,10 @@ public function indexTableRows(int $tableId, ?int $limit, ?int $offset): DataRes\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function indexViewRows(int $viewId, ?int $limit, ?int $offset): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->rowService->formatRows($this->rowService->findAllByView($viewId, $this->userId, $limit, $offset)));\n@@ -1122,17 +1111,16 @@ public function indexViewRows(int $viewId, ?int $limit, ?int $offset): DataRespo\n \t/**\n \t * Create a row within a view\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $viewId View ID\n \t * @param string|array<string, mixed> $data Data as key - value store\n \t * @return DataResponse<Http::STATUS_OK, TablesRow, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n \t *\n \t * 200: Row returned\n \t * 403: No permissions\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function createRowInView(int $viewId, $data): DataResponse {\n \t\tif(is_string($data)) {\n@@ -1168,10 +1156,6 @@ public function createRowInView(int $viewId, $data): DataResponse {\n \t/**\n \t * Create a row within a table\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @param string|array<string, mixed> $data Data as key - value store\n \t * @return DataResponse<Http::STATUS_OK, TablesRow, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n@@ -1180,6 +1164,9 @@ public function createRowInView(int $viewId, $data): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function createRowInTable(int $tableId, $data): DataResponse {\n \t\tif(is_string($data)) {\n@@ -1215,17 +1202,16 @@ public function createRowInTable(int $tableId, $data): DataResponse {\n \t/**\n \t * Get a row\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $rowId Row ID\n \t * @return DataResponse<Http::STATUS_OK, TablesRow, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Row returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function getRow(int $rowId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->rowService->find($rowId)->jsonSerialize());\n@@ -1247,10 +1233,6 @@ public function getRow(int $rowId): DataResponse {\n \t/**\n \t * Update a row\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $rowId Row ID\n \t * @param int|null $viewId View ID\n \t * @param string|array<string, mixed> $data Data as key - value store\n@@ -1261,6 +1243,9 @@ public function getRow(int $rowId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function updateRow(int $rowId, ?int $viewId, $data): DataResponse {\n \t\tif(is_string($data)) {\n \t\t\t$data = json_decode($data, true);\n@@ -1290,10 +1275,6 @@ public function updateRow(int $rowId, ?int $viewId, $data): DataResponse {\n \t/**\n \t * Delete a row\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $rowId Row ID\n \t *\n \t * @return DataResponse<Http::STATUS_OK, TablesRow, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n@@ -1302,6 +1283,9 @@ public function updateRow(int $rowId, ?int $viewId, $data): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function deleteRow(int $rowId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->rowService->delete($rowId, null, $this->userId)->jsonSerialize());\n@@ -1323,10 +1307,6 @@ public function deleteRow(int $rowId): DataResponse {\n \t/**\n \t * Delete a row within a view\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $rowId Row ID\n \t * @param int $viewId View ID\n \t * @return DataResponse<Http::STATUS_OK, TablesRow, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n@@ -1335,6 +1315,9 @@ public function deleteRow(int $rowId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \tpublic function deleteRowByView(int $rowId, int $viewId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->rowService->delete($rowId, $viewId, $this->userId)->jsonSerialize());\n@@ -1356,9 +1339,6 @@ public function deleteRowByView(int $rowId, int $viewId): DataResponse {\n \t/**\n \t * Import from file in to a table\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n \t * @param int $tableId Table ID\n \t * @param string $path Path to file\n \t * @param bool $createMissingColumns Create missing columns\n@@ -1368,6 +1348,9 @@ public function deleteRowByView(int $rowId, int $viewId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function importInTable(int $tableId, string $path, bool $createMissingColumns = true): DataResponse {\n \t\ttry {\n@@ -1391,9 +1374,6 @@ public function importInTable(int $tableId, string $path, bool $createMissingCol\n \t/**\n \t * Import from file in to a table\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n \t * @param int $viewId View ID\n \t * @param string $path Path to file\n \t * @param bool $createMissingColumns Create missing columns\n@@ -1403,6 +1383,9 @@ public function importInTable(int $tableId, string $path, bool $createMissingCol\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function importInView(int $viewId, string $path, bool $createMissingColumns = true): DataResponse {\n \t\ttry {\n@@ -1428,10 +1411,6 @@ public function importInView(int $viewId, string $path, bool $createMissingColum\n \t/**\n \t * Create a share for a table\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @param string $receiver Receiver ID\n \t * @param 'user'|'group' $receiverType Receiver type\n@@ -1446,6 +1425,9 @@ public function importInView(int $viewId, string $path, bool $createMissingColum\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n \t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function createTableShare(int $tableId, string $receiver, string $receiverType, bool $permissionRead, bool $permissionCreate, bool $permissionUpdate, bool $permissionDelete, bool $permissionManage): DataResponse {\n \t\ttry {\n@@ -1468,10 +1450,6 @@ public function createTableShare(int $tableId, string $receiver, string $receive\n \t/**\n \t * Create a new column for a table\n \t *\n-\t * @NoAdminRequired\n-\t * @CORS\n-\t * @NoCSRFRequired\n-\t *\n \t * @param int $tableId Table ID\n \t * @param string $title Title\n \t * @param 'text'|'number'|'datetime'|'select'|'usergroup' $type Column main type\n@@ -1503,6 +1481,10 @@ public function createTableShare(int $tableId, string $receiver, string $receive\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[CORS]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function createTableColumn(\n \t\tint $tableId,\n \t\tstring $title,\n@@ -1579,8 +1561,5 @@ public function createTableColumn(\n \t\t\t$message = ['message' => $e->getMessage()];\n \t\t\treturn new DataResponse($message, Http::STATUS_NOT_FOUND);\n \t\t}\n-\n-\n-\n \t}\n }"
            },
            {
                "sha": "9560dbd26c67b69160279904661032ff43b436a1",
                "filename": "lib/Controller/ApiColumnsController.php",
                "status": "modified",
                "additions": 16,
                "deletions": 14,
                "changes": 30,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApiColumnsController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApiColumnsController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FApiColumnsController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -6,13 +6,16 @@\n  */\n namespace OCA\\Tables\\Controller;\n \n+use OCA\\Tables\\AppInfo\\Application;\n use OCA\\Tables\\Dto\\Column as ColumnDto;\n use OCA\\Tables\\Errors\\InternalError;\n use OCA\\Tables\\Errors\\NotFoundError;\n use OCA\\Tables\\Errors\\PermissionError;\n+use OCA\\Tables\\Middleware\\Attribute\\RequirePermission;\n use OCA\\Tables\\ResponseDefinitions;\n use OCA\\Tables\\Service\\ColumnService;\n use OCP\\AppFramework\\Http;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IL10N;\n use OCP\\IRequest;\n@@ -39,8 +42,6 @@ public function __construct(\n \t *\n \t * Return an empty array if no columns were found\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $nodeId Node ID\n \t * @param 'table'|'view' $nodeType Node type\n \t * @return DataResponse<Http::STATUS_OK, TablesColumn[], array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n@@ -49,6 +50,8 @@ public function __construct(\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ)]\n \tpublic function index(int $nodeId, string $nodeType): DataResponse {\n \t\ttry {\n \t\t\tif($nodeType === 'table') {\n@@ -71,15 +74,14 @@ public function index(int $nodeId, string $nodeType): DataResponse {\n \t/**\n \t * [api v2] Get a column object\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $id Column ID\n \t * @return DataResponse<Http::STATUS_OK, TablesColumn, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Column returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n \tpublic function show(int $id): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->service->find($id)->jsonSerialize());\n@@ -97,8 +99,6 @@ public function show(int $id): DataResponse {\n \t *\n \t * Specify a subtype to use any special numbered column\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $baseNodeId Context of the column creation\n \t * @param string $title Title\n \t * @param boolean $mandatory Is mandatory\n@@ -121,6 +121,8 @@ public function show(int $id): DataResponse {\n \t * @throws NotFoundError\n \t * @throws PermissionError\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, typeParam: 'baseNodeType', idParam: 'baseNodeId')]\n \tpublic function createNumberColumn(int $baseNodeId, string $title, ?float $numberDefault, ?int $numberDecimals, ?string $numberPrefix, ?string $numberSuffix, ?float $numberMin, ?float $numberMax, ?string $subtype = null, ?string $description = null, ?array $selectedViewIds = [], bool $mandatory = false, string $baseNodeType = 'table'): DataResponse {\n \t\t$tableId = $baseNodeType === 'table' ? $baseNodeId : null;\n \t\t$viewId = $baseNodeType === 'view' ? $baseNodeId : null;\n@@ -151,8 +153,6 @@ public function createNumberColumn(int $baseNodeId, string $title, ?float $numbe\n \t *\n \t * Specify a subtype to use any special text column\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $baseNodeId Context of the column creation\n \t * @param string $title Title\n \t * @param string|null $textDefault Default\n@@ -172,6 +172,8 @@ public function createNumberColumn(int $baseNodeId, string $title, ?float $numbe\n \t * @throws NotFoundError\n \t * @throws PermissionError\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, typeParam: 'baseNodeType', idParam: 'baseNodeId')]\n \tpublic function createTextColumn(int $baseNodeId, string $title, ?string $textDefault, ?string $textAllowedPattern, ?int $textMaxLength, ?string $subtype = null, ?string $description = null, ?array $selectedViewIds = [], bool $mandatory = false, string $baseNodeType = 'table'): DataResponse {\n \t\t$tableId = $baseNodeType === 'table' ? $baseNodeId : null;\n \t\t$viewId = $baseNodeType === 'view' ? $baseNodeId : null;\n@@ -199,8 +201,6 @@ public function createTextColumn(int $baseNodeId, string $title, ?string $textDe\n \t *\n \t * Specify a subtype to use any special selection column\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $baseNodeId Context of the column creation\n \t * @param string $title Title\n \t * @param string $selectionOptions Json array{id: int, label: string} with options that can be selected, eg [{\"id\": 1, \"label\": \"first\"},{\"id\": 2, \"label\": \"second\"}]\n@@ -219,6 +219,8 @@ public function createTextColumn(int $baseNodeId, string $title, ?string $textDe\n \t * @throws NotFoundError\n \t * @throws PermissionError\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, typeParam: 'baseNodeType', idParam: 'baseNodeId')]\n \tpublic function createSelectionColumn(int $baseNodeId, string $title, string $selectionOptions, ?string $selectionDefault, ?string $subtype = null, ?string $description = null, ?array $selectedViewIds = [], bool $mandatory = false, string $baseNodeType = 'table'): DataResponse {\n \t\t$tableId = $baseNodeType === 'table' ? $baseNodeId : null;\n \t\t$viewId = $baseNodeType === 'view' ? $baseNodeId : null;\n@@ -245,8 +247,6 @@ public function createSelectionColumn(int $baseNodeId, string $title, string $se\n \t *\n \t * Specify a subtype to use any special datetime column\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $baseNodeId Context of the column creation\n \t * @param string $title Title\n \t * @param 'today'|'now'|null $datetimeDefault For a subtype 'date' you can set 'today'. For a main type or subtype 'time' you can set to 'now'.\n@@ -264,6 +264,8 @@ public function createSelectionColumn(int $baseNodeId, string $title, string $se\n \t * @throws NotFoundError\n \t * @throws PermissionError\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, typeParam: 'baseNodeType', idParam: 'baseNodeId')]\n \tpublic function createDatetimeColumn(int $baseNodeId, string $title, ?string $datetimeDefault, ?string $subtype = null, ?string $description = null, ?array $selectedViewIds = [], bool $mandatory = false, string $baseNodeType = 'table'): DataResponse {\n \t\t$tableId = $baseNodeType === 'table' ? $baseNodeId : null;\n \t\t$viewId = $baseNodeType === 'view' ? $baseNodeId : null;\n@@ -287,8 +289,6 @@ public function createDatetimeColumn(int $baseNodeId, string $title, ?string $da\n \t/**\n \t * [api v2] Create new usergroup column\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $baseNodeId Context of the column creation\n \t * @param string $title Title\n \t * @param string|null $usergroupDefault Json array{id: string, type: int}, eg [{\"id\": \"admin\", \"type\": 0}, {\"id\": \"user1\", \"type\": 0}]\n@@ -309,6 +309,8 @@ public function createDatetimeColumn(int $baseNodeId, string $title, ?string $da\n \t * @throws NotFoundError\n \t * @throws PermissionError\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, typeParam: 'baseNodeType', idParam: 'baseNodeId')]\n \tpublic function createUsergroupColumn(int $baseNodeId, string $title, ?string $usergroupDefault, bool $usergroupMultipleItems = null, bool $usergroupSelectUsers = null, bool $usergroupSelectGroups = null, bool $showUserStatus = null, string $description = null, ?array $selectedViewIds = [], bool $mandatory = false, string $baseNodeType = 'table'): DataResponse {\n \t\t$tableId = $baseNodeType === 'table' ? $baseNodeId : null;\n \t\t$viewId = $baseNodeType === 'view' ? $baseNodeId : null;"
            },
            {
                "sha": "05271b4cb76d5ce6bd6a984279d627381fe87c26",
                "filename": "lib/Controller/ApiFavoriteController.php",
                "status": "modified",
                "additions": 7,
                "deletions": 4,
                "changes": 11,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApiFavoriteController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApiFavoriteController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FApiFavoriteController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -8,12 +8,15 @@\n namespace OCA\\Tables\\Controller;\n \n use Exception;\n+use OCA\\Tables\\AppInfo\\Application;\n use OCA\\Tables\\Errors\\InternalError;\n use OCA\\Tables\\Errors\\NotFoundError;\n use OCA\\Tables\\Errors\\PermissionError;\n+use OCA\\Tables\\Middleware\\Attribute\\RequirePermission;\n use OCA\\Tables\\ResponseDefinitions;\n use OCA\\Tables\\Service\\FavoritesService;\n use OCP\\AppFramework\\Http;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\DB\\Exception as DBException;\n use OCP\\IL10N;\n@@ -39,8 +42,6 @@ public function __construct(\n \t/**\n \t * [api v2] Add a node (table or view) to user favorites\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $nodeType any Application::NODE_TYPE_* constant\n \t * @param int $nodeId identifier of the node\n \t * @return DataResponse<Http::STATUS_OK, array{}, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n@@ -49,6 +50,8 @@ public function __construct(\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ)]\n \tpublic function create(int $nodeType, int $nodeId): DataResponse {\n \t\ttry {\n \t\t\t$this->service->addFavorite($nodeType, $nodeId);\n@@ -66,8 +69,6 @@ public function create(int $nodeType, int $nodeId): DataResponse {\n \t/**\n \t * [api v2] Remove a node (table or view) to from favorites\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $nodeType any Application::NODE_TYPE_* constant\n \t * @param int $nodeId identifier of the node\n \t * @return DataResponse<Http::STATUS_OK, array{}, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n@@ -76,6 +77,8 @@ public function create(int $nodeType, int $nodeId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ)]\n \tpublic function destroy(int $nodeType, int $nodeId): DataResponse {\n \t\ttry {\n \t\t\t$this->service->removeFavorite($nodeType, $nodeId);"
            },
            {
                "sha": "5d387d935f386de40ae4ebbb0d0b0db904dcec26",
                "filename": "lib/Controller/ApiGeneralController.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApiGeneralController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApiGeneralController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FApiGeneralController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -15,6 +15,7 @@\n use OCA\\Tables\\Service\\TableService;\n use OCA\\Tables\\Service\\ViewService;\n use OCP\\AppFramework\\Http;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IL10N;\n use OCP\\IRequest;\n@@ -46,12 +47,11 @@ public function __construct(\n \t *\n \t * Tables and views incl. shares\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @return DataResponse<Http::STATUS_OK, TablesIndex, array{}>|DataResponse<Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n \t *\n \t * 200: Index returned\n \t */\n+\t#[NoAdminRequired]\n \tpublic function index(): DataResponse {\n \t\ttry {\n \t\t\t$tables = $this->tableService->formatTables($this->tableService->findAll($this->userId));"
            },
            {
                "sha": "9c5ed7ed08d9653c178408bcd47a631a44e29767",
                "filename": "lib/Controller/ApiTablesController.php",
                "status": "modified",
                "additions": 15,
                "deletions": 16,
                "changes": 31,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApiTablesController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FApiTablesController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FApiTablesController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -8,16 +8,19 @@\n namespace OCA\\Tables\\Controller;\n \n use Exception;\n+use OCA\\Tables\\AppInfo\\Application;\n use OCA\\Tables\\Dto\\Column as ColumnDto;\n use OCA\\Tables\\Errors\\InternalError;\n use OCA\\Tables\\Errors\\NotFoundError;\n use OCA\\Tables\\Errors\\PermissionError;\n+use OCA\\Tables\\Middleware\\Attribute\\RequirePermission;\n use OCA\\Tables\\ResponseDefinitions;\n use OCA\\Tables\\Service\\ColumnService;\n use OCA\\Tables\\Service\\TableService;\n use OCA\\Tables\\Service\\ViewService;\n use OCP\\App\\IAppManager;\n use OCP\\AppFramework\\Http;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IDBConnection;\n use OCP\\IL10N;\n@@ -57,12 +60,11 @@ public function __construct(\n \t/**\n \t * [api v2] Returns all Tables\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @return DataResponse<Http::STATUS_OK, TablesTable[], array{}>|DataResponse<Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n \t *\n \t * 200: Tables returned\n \t */\n+\t#[NoAdminRequired]\n \tpublic function index(): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->service->formatTables($this->service->findAll($this->userId)));\n@@ -74,15 +76,15 @@ public function index(): DataResponse {\n \t/**\n \t * [api v2] Get a table object\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $id Table ID\n \t * @return DataResponse<Http::STATUS_OK, TablesTable, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Table returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'id')]\n \tpublic function show(int $id): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->service->find($id)->jsonSerialize());\n@@ -98,15 +100,15 @@ public function show(int $id): DataResponse {\n \t/**\n \t * [api v2] Get a table Scheme\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $id Table ID\n \t * @return DataResponse<Http::STATUS_OK, TablesTable, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Scheme returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'id')]\n \tpublic function showScheme(int $id): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->service->getScheme($id)->jsonSerialize());\n@@ -120,8 +122,6 @@ public function showScheme(int $id): DataResponse {\n \t}\n \n \t/**\n-\t * @NoAdminRequired\n-\t *\n \t * creates table from scheme\n \t *\n \t * @param string $title title of new table\n@@ -133,6 +133,7 @@ public function showScheme(int $id): DataResponse {\n \t *\n \t * 200: Tables returned\n \t */\n+\t#[NoAdminRequired]\n \tpublic function createFromScheme(string $title, string $emoji, string $description, array $columns, array $views): DataResponse {\n \t\ttry {\n \t\t\t$this->db->beginTransaction();\n@@ -191,8 +192,6 @@ public function createFromScheme(string $title, string $emoji, string $descripti\n \t/**\n \t * [api v2] Create a new table and return it\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param string $title Title of the table\n \t * @param string|null $emoji Emoji for the table\n \t * @param string|null $description Description for the table\n@@ -202,6 +201,7 @@ public function createFromScheme(string $title, string $emoji, string $descripti\n \t *\n \t * 200: Tables returned\n \t */\n+\t#[NoAdminRequired]\n \tpublic function create(string $title, ?string $emoji, ?string $description, string $template = 'custom'): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->service->create($title, $template, $emoji, $description)->jsonSerialize());\n@@ -213,8 +213,6 @@ public function create(string $title, ?string $emoji, ?string $description, stri\n \t/**\n \t * [api v2] Update tables properties\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $id Table ID\n \t * @param string|null $title New table title\n \t * @param string|null $emoji New table emoji\n@@ -226,6 +224,8 @@ public function create(string $title, ?string $emoji, ?string $description, stri\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'id')]\n \tpublic function update(int $id, ?string $title = null, ?string $emoji = null, ?string $description = null, ?bool $archived = null): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->service->update($id, $title, $emoji, $description, $archived, $this->userId)->jsonSerialize());\n@@ -241,15 +241,15 @@ public function update(int $id, ?string $title = null, ?string $emoji = null, ?s\n \t/**\n \t * [api v2] Delete a table\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $id Table ID\n \t * @return DataResponse<Http::STATUS_OK, TablesTable, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND, array{message: string}, array{}>\n \t *\n \t * 200: Deleted table returned\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'id')]\n \tpublic function destroy(int $id): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->service->delete($id)->jsonSerialize());\n@@ -267,8 +267,6 @@ public function destroy(int $id): DataResponse {\n \t *\n \t * Transfer table from one user to another\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param int $id Table ID\n \t * @param string $newOwnerUserId New user ID\n \t *\n@@ -278,6 +276,7 @@ public function destroy(int $id): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n \tpublic function transfer(int $id, string $newOwnerUserId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->service->setOwner($id, $newOwnerUserId)->jsonSerialize());"
            },
            {
                "sha": "df1a9509d7e3167841939da661e48effd792ef43",
                "filename": "lib/Controller/ColumnController.php",
                "status": "modified",
                "additions": 10,
                "deletions": 21,
                "changes": 31,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FColumnController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FColumnController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FColumnController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -9,8 +9,10 @@\n \n use OCA\\Tables\\AppInfo\\Application;\n use OCA\\Tables\\Dto\\Column as ColumnDto;\n+use OCA\\Tables\\Middleware\\Attribute\\RequirePermission;\n use OCA\\Tables\\Service\\ColumnService;\n use OCP\\AppFramework\\Controller;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IRequest;\n use Psr\\Log\\LoggerInterface;\n@@ -35,45 +37,36 @@ public function __construct(\n \t\t$this->userId = $userId;\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function index(int $tableId, ?int $viewId): DataResponse {\n \t\treturn $this->handleError(function () use ($tableId, $viewId) {\n \t\t\treturn $this->service->findAllByTable($tableId, $viewId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function indexTableByView(int $tableId, ?int $viewId): DataResponse {\n \t\treturn $this->handleError(function () use ($tableId, $viewId) {\n \t\t\treturn $this->service->findAllByTable($tableId, $viewId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function indexView(int $viewId): DataResponse {\n \t\treturn $this->handleError(function () use ($viewId) {\n \t\t\treturn $this->service->findAllByView($viewId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function show(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->find($id);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function create(\n \t\t?int $tableId,\n \t\t?int $viewId,\n@@ -172,9 +165,7 @@ public function create(\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function update(\n \t\tint $id,\n \t\t?int $tableId,\n@@ -269,9 +260,7 @@ public function update(\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function destroy(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->delete($id, false, $this->userId);"
            },
            {
                "sha": "4a2e60a7519dec5d2067df65cc51a5b579ff8495",
                "filename": "lib/Controller/ContextController.php",
                "status": "modified",
                "additions": 8,
                "deletions": 9,
                "changes": 17,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FContextController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FContextController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FContextController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -18,6 +18,7 @@\n use OCP\\AppFramework\\Db\\DoesNotExistException;\n use OCP\\AppFramework\\Db\\MultipleObjectsReturnedException;\n use OCP\\AppFramework\\Http;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\DB\\Exception;\n use OCP\\IL10N;\n@@ -51,9 +52,8 @@ public function __construct(\n \t * @return DataResponse<Http::STATUS_OK, TablesContext[], array{}>|DataResponse<Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n \t *\n \t * 200: reporting in available contexts\n-\t *\n-\t * @NoAdminRequired\n \t */\n+\t#[NoAdminRequired]\n \tpublic function index(): DataResponse {\n \t\ttry {\n \t\t\t$contexts = $this->contextService->findAll($this->userId);\n@@ -72,8 +72,8 @@ public function index(): DataResponse {\n \t * 200: returning the full context information\n \t * 404: context not found or not available anymore\n \t *\n-\t * @NoAdminRequired\n \t */\n+\t#[NoAdminRequired]\n \tpublic function show(int $contextId): DataResponse {\n \t\ttry {\n \t\t\t$context = $this->contextService->findById($contextId, $this->userId);\n@@ -88,8 +88,6 @@ public function show(int $contextId): DataResponse {\n \t/**\n \t * [api v2] Create a new context and return it\n \t *\n-\t * @NoAdminRequired\n-\t *\n \t * @param string $name Name of the context\n \t * @param string $iconName Material design icon name of the context\n \t * @param string $description Descriptive text of the context\n@@ -101,6 +99,7 @@ public function show(int $contextId): DataResponse {\n \t * 400: invalid parameters were supplied\n \t * 403: lacking permissions on a resource\n \t */\n+\t#[NoAdminRequired]\n \tpublic function create(string $name, string $iconName, string $description = '', array $nodes = []): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->contextService->create(\n@@ -135,9 +134,9 @@ public function create(string $name, string $iconName, string $description = '',\n \t * 403: No permissions\n \t * 404: Not found\n \t *\n-\t * @NoAdminRequired\n \t * @CanManageContext\n \t */\n+\t#[NoAdminRequired]\n \tpublic function update(int $contextId, ?string $name, ?string $iconName, ?string $description, ?array $nodes): DataResponse {\n \t\ttry {\n \t\t\t$nodes = $nodes !== null ? $this->sanitizeInputNodes($nodes) : null;\n@@ -195,9 +194,9 @@ protected function sanitizeInputNodes(array $nodes): array {\n \t * 403: No permissions\n \t * 404: Not found\n \t *\n-\t * @NoAdminRequired\n \t * @CanManageContext\n \t */\n+\t#[NoAdminRequired]\n \tpublic function destroy(int $contextId): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->contextService->delete($contextId, $this->userId)->jsonSerialize());\n@@ -222,12 +221,12 @@ public function destroy(int $contextId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t *\n-\t * @NoAdminRequired\n \t * @CanManageContext\n \t *\n \t * @psalm-param int<0, max> $contextId\n \t * @psalm-param int<0, 0> $newOwnerType\n \t */\n+\t#[NoAdminRequired]\n \tpublic function transfer(int $contextId, string $newOwnerId, int $newOwnerType = 0): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->contextService->transfer($contextId, $newOwnerId, $newOwnerType)->jsonSerialize());\n@@ -249,14 +248,14 @@ public function transfer(int $contextId, string $newOwnerId, int $newOwnerType =\n \t *\n \t * @return DataResponse<Http::STATUS_OK, TablesContext, array{}>|DataResponse<Http::STATUS_INTERNAL_SERVER_ERROR|Http::STATUS_NOT_FOUND|Http::STATUS_BAD_REQUEST, array{message: string}, array{}>\n \t *\n-\t * @NoAdminRequired\n \t * @CanManageContext\n \t *\n \t * 200: content updated successfully\n \t * 400: Invalid request\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[NoAdminRequired]\n \tpublic function updateContentOrder(int $contextId, int $pageId, array $content): DataResponse {\n \t\ttry {\n \t\t\t$context = $this->contextService->findById($contextId, $this->userId);"
            },
            {
                "sha": "5cf53a37738041462b6430be34cb181744651fed",
                "filename": "lib/Controller/ImportController.php",
                "status": "modified",
                "additions": 13,
                "deletions": 24,
                "changes": 37,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FImportController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FImportController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FImportController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -13,6 +13,7 @@\n use OCA\\Tables\\UploadException;\n use OCP\\AppFramework\\Controller;\n use OCP\\AppFramework\\Http;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\Files\\NotPermittedException;\n use OCP\\IL10N;\n@@ -54,18 +55,15 @@ public function __construct(\n \t\t$this->l10n = $l10n;\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function previewImportTable(int $tableId, String $path): DataResponse {\n \t\treturn $this->handleError(function () use ($tableId, $path) {\n \t\t\treturn $this->service->previewImport($tableId, null, $path);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function importInTable(int $tableId, String $path, bool $createMissingColumns = true, array $columnsConfig = []): DataResponse {\n \t\treturn $this->handleError(function () use ($tableId, $path, $createMissingColumns, $columnsConfig) {\n@@ -74,18 +72,15 @@ public function importInTable(int $tableId, String $path, bool $createMissingCol\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function previewImportView(int $viewId, String $path): DataResponse {\n \t\treturn $this->handleError(function () use ($viewId, $path) {\n \t\t\treturn $this->service->previewImport(null, $viewId, $path);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function importInView(int $viewId, String $path, bool $createMissingColumns = true, array $columnsConfig = []): DataResponse {\n \t\treturn $this->handleError(function () use ($viewId, $path, $createMissingColumns, $columnsConfig) {\n@@ -94,9 +89,8 @@ public function importInView(int $viewId, String $path, bool $createMissingColum\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function previewUploadImportTable(int $tableId): DataResponse {\n \t\ttry {\n \t\t\t$file = $this->getUploadedFile('uploadfile');\n@@ -109,9 +103,7 @@ public function previewUploadImportTable(int $tableId): DataResponse {\n \t\t}\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function importUploadInTable(int $tableId, bool $createMissingColumns = true, string $columnsConfig = ''): DataResponse {\n \t\ttry {\n@@ -127,9 +119,8 @@ public function importUploadInTable(int $tableId, bool $createMissingColumns = t\n \t\t}\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function previewUploadImportView(int $viewId): DataResponse {\n \t\ttry {\n \t\t\t$file = $this->getUploadedFile('uploadfile');\n@@ -142,9 +133,7 @@ public function previewUploadImportView(int $viewId): DataResponse {\n \t\t}\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function importUploadInView(int $viewId, bool $createMissingColumns = true, string $columnsConfig = ''): DataResponse {\n \t\ttry {"
            },
            {
                "sha": "5643d1b264e17b8cd9f6e0878d80804e34e97bfd",
                "filename": "lib/Controller/PageController.php",
                "status": "modified",
                "additions": 9,
                "deletions": 8,
                "changes": 17,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FPageController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FPageController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FPageController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -10,6 +10,9 @@\n use OCA\\Tables\\AppInfo\\Application;\n use OCA\\Text\\Event\\LoadEditor;\n use OCP\\AppFramework\\Controller;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n+use OCP\\AppFramework\\Http\\Attribute\\NoCSRFRequired;\n+use OCP\\AppFramework\\Http\\Attribute\\OpenAPI;\n use OCP\\AppFramework\\Http\\TemplateResponse;\n use OCP\\AppFramework\\Services\\IInitialState;\n use OCP\\EventDispatcher\\IEventDispatcher;\n@@ -29,12 +32,11 @@ public function __construct(\n \t}\n \n \t/**\n-\t * @NoAdminRequired\n-\t * @NoCSRFRequired\n-\t * @IgnoreOpenAPI\n-\t *\n \t * Render default template\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[OpenAPI(scope: OpenAPI::SCOPE_IGNORE)]\n \tpublic function index(): TemplateResponse {\n \t\tUtil::addScript(Application::APP_ID, 'tables-main');\n \t\tUtil::addStyle(Application::APP_ID, 'grid');\n@@ -49,14 +51,13 @@ public function index(): TemplateResponse {\n \t}\n \n \t/**\n-\t * @NoAdminRequired\n-\t * @NoCSRFRequired\n-\t * @IgnoreOpenAPI\n-\t *\n \t * Render default template\n \t *\n \t * @psalm-param int<0, max> $appId\n \t */\n+\t#[NoAdminRequired]\n+\t#[NoCSRFRequired]\n+\t#[OpenAPI(scope: OpenAPI::SCOPE_IGNORE)]\n \tpublic function context(int $contextId): TemplateResponse {\n \t\t$navId = Application::APP_ID . '_application_' . $contextId;\n \t\t$this->navigationManager->setActiveEntry($navId);"
            },
            {
                "sha": "27dd9a5cf648318baefa03b5a607321ce2ed34e8",
                "filename": "lib/Controller/RowController.php",
                "status": "modified",
                "additions": 11,
                "deletions": 21,
                "changes": 32,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FRowController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FRowController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FRowController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -8,8 +8,10 @@\n namespace OCA\\Tables\\Controller;\n \n use OCA\\Tables\\AppInfo\\Application;\n+use OCA\\Tables\\Middleware\\Attribute\\RequirePermission;\n use OCA\\Tables\\Service\\RowService;\n use OCP\\AppFramework\\Controller;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IRequest;\n use Psr\\Log\\LoggerInterface;\n@@ -36,36 +38,30 @@ public function __construct(\n \t\t$this->userId = $userId;\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function index(int $tableId): DataResponse {\n \t\treturn $this->handleError(function () use ($tableId) {\n \t\t\treturn $this->service->findAllByTable($tableId, $this->userId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function indexView(int $viewId): DataResponse {\n \t\treturn $this->handleError(function () use ($viewId) {\n \t\t\treturn $this->service->findAllByView($viewId, $this->userId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function show(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->find($id);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function update(\n \t\tint $id,\n \t\tint $columnId,\n@@ -84,9 +80,7 @@ public function update(\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function updateSet(\n \t\tint $id,\n \t\t?int $viewId,\n@@ -106,17 +100,13 @@ public function updateSet(\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function destroy(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->delete($id, null, $this->userId);\n \t\t});\n \t}\n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function destroyByView(int $id, int $viewId): DataResponse {\n \t\treturn $this->handleError(function () use ($id, $viewId) {\n \t\t\treturn $this->service->delete($id, $viewId, $this->userId);"
            },
            {
                "sha": "297e4d13349f2af6d51be51c31e1ea6a2437bdff",
                "filename": "lib/Controller/SearchController.php",
                "status": "modified",
                "additions": 2,
                "deletions": 3,
                "changes": 5,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FSearchController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FSearchController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FSearchController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -10,6 +10,7 @@\n use OCA\\Tables\\AppInfo\\Application;\n use OCA\\Tables\\Service\\SearchService;\n use OCP\\AppFramework\\Controller;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IRequest;\n use Psr\\Log\\LoggerInterface;\n@@ -34,9 +35,7 @@ public function __construct(\n \t}\n \n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function all(string $term = ''): DataResponse {\n \t\treturn $this->handleError(function () use ($term) {\n \t\t\treturn $this->service->all($term);"
            },
            {
                "sha": "40475a030b5dbeae617ba3651ee4853ca953a18f",
                "filename": "lib/Controller/ShareController.php",
                "status": "modified",
                "additions": 10,
                "deletions": 19,
                "changes": 29,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FShareController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FShareController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FShareController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -11,6 +11,7 @@\n use OCA\\Tables\\Middleware\\Attribute\\RequirePermission;\n use OCA\\Tables\\Service\\ShareService;\n use OCP\\AppFramework\\Controller;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IRequest;\n use Psr\\Log\\LoggerInterface;\n@@ -37,36 +38,30 @@ public function __construct(\n \t}\n \n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function index(int $tableId): DataResponse {\n \t\treturn $this->handleError(function () use ($tableId) {\n \t\t\treturn $this->service->findAll('table', $tableId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function indexView(int $viewId): DataResponse {\n \t\treturn $this->handleError(function () use ($viewId) {\n \t\t\treturn $this->service->findAll('view', $viewId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function show(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->find($id);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \t#[RequirePermission(permission: Application::PERMISSION_MANAGE)]\n \tpublic function create(\n \t\tint $nodeId,\n@@ -85,20 +80,18 @@ public function create(\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function updatePermission(int $id, string $permission, bool $value): DataResponse {\n \t\treturn $this->handleError(function () use ($id, $permission, $value) {\n \t\t\treturn $this->service->updatePermission($id, $permission, $value);\n \t\t});\n \t}\n \n \t/**\n-\t * @NoAdminRequired\n \t * @psalm-param int<0, 2> $displayMode\n \t * @psalm-param (\"default\"|\"self\") $target\n \t */\n+\t#[NoAdminRequired]\n \tpublic function updateDisplayMode(int $id, int $displayMode, string $target = 'default') {\n \t\treturn $this->handleError(function () use ($id, $displayMode, $target) {\n \t\t\tif ($target === 'default') {\n@@ -113,9 +106,7 @@ public function updateDisplayMode(int $id, int $displayMode, string $target = 'd\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function destroy(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->delete($id);"
            },
            {
                "sha": "e22057d6581137afa8e3cdb6e5ef8952b79830d5",
                "filename": "lib/Controller/TableController.php",
                "status": "modified",
                "additions": 10,
                "deletions": 15,
                "changes": 25,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FTableController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FTableController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FTableController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -8,8 +8,10 @@\n namespace OCA\\Tables\\Controller;\n \n use OCA\\Tables\\AppInfo\\Application;\n+use OCA\\Tables\\Middleware\\Attribute\\RequirePermission;\n use OCA\\Tables\\Service\\TableService;\n use OCP\\AppFramework\\Controller;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IRequest;\n use Psr\\Log\\LoggerInterface;\n@@ -36,45 +38,38 @@ public function __construct(\n \t}\n \n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function index(): DataResponse {\n \t\treturn $this->handleError(function () {\n \t\t\treturn $this->service->findAll($this->userId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'id')]\n \tpublic function show(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->find($id);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function create(string $title, string $template, string $emoji): DataResponse {\n \t\treturn $this->handleError(function () use ($title, $template, $emoji) {\n \t\t\treturn $this->service->create($title, $template, $emoji);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'id')]\n \tpublic function destroy(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->delete($id);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'id')]\n \tpublic function update(int $id, ?string $title = null, ?string $emoji = null, ?bool $archived = null): DataResponse {\n \t\treturn $this->handleError(function () use ($id, $title, $emoji, $archived) {\n \t\t\treturn $this->service->update($id, $title, $emoji, null, $archived, $this->userId);"
            },
            {
                "sha": "52bfc295a93efd6e73e618c0351956d02858dea0",
                "filename": "lib/Controller/TableTemplateController.php",
                "status": "modified",
                "additions": 2,
                "deletions": 3,
                "changes": 5,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FTableTemplateController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FTableTemplateController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FTableTemplateController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -10,6 +10,7 @@\n use OCA\\Tables\\AppInfo\\Application;\n use OCA\\Tables\\Service\\TableTemplateService;\n use OCP\\AppFramework\\Controller;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IRequest;\n use Psr\\Log\\LoggerInterface;\n@@ -30,9 +31,7 @@ public function __construct(\n \t\t$this->service = $service;\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function list(): DataResponse {\n \t\treturn $this->handleError(function () {\n \t\t\treturn $this->service->getTemplateList();"
            },
            {
                "sha": "65f460503e70c8016ce4fb1badc2b1706baac043",
                "filename": "lib/Controller/ViewController.php",
                "status": "modified",
                "additions": 13,
                "deletions": 19,
                "changes": 32,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FViewController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FController%2FViewController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FViewController.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -13,9 +13,11 @@\n use OCA\\Tables\\Errors\\InternalError;\n use OCA\\Tables\\Errors\\NotFoundError;\n use OCA\\Tables\\Errors\\PermissionError;\n+use OCA\\Tables\\Middleware\\Attribute\\RequirePermission;\n use OCA\\Tables\\Service\\TableService;\n use OCA\\Tables\\Service\\ViewService;\n use OCP\\AppFramework\\Controller;\n+use OCP\\AppFramework\\Http\\Attribute\\NoAdminRequired;\n use OCP\\AppFramework\\Http\\DataResponse;\n use OCP\\IRequest;\n use Psr\\Log\\LoggerInterface;\n@@ -50,61 +52,53 @@ public function __construct(\n \t}\n \n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function index(int $tableId): DataResponse {\n \t\treturn $this->handleError(function () use ($tableId) {\n \t\t\treturn $this->service->findAll($this->getTable($tableId), $this->userId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n \tpublic function indexSharedWithMe(): DataResponse {\n \t\treturn $this->handleError(function () {\n \t\t\treturn $this->service->findSharedViewsWithMe($this->userId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_READ, type: Application::NODE_TYPE_VIEW, idParam: 'id')]\n \tpublic function show(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->find($id);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function create(int $tableId, string $title, ?string $emoji): DataResponse {\n \t\treturn $this->handleError(function () use ($tableId, $title, $emoji) {\n \t\t\treturn $this->service->create($title, $emoji, $this->getTable($tableId, true));\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_VIEW, idParam: 'id')]\n \tpublic function update(int $id, array $data): DataResponse {\n \t\treturn $this->handleError(function () use ($id, $data) {\n \t\t\treturn $this->service->update($id, $data, $this->userId);\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n+\t#[NoAdminRequired]\n+\t#[RequirePermission(permission: Application::PERMISSION_MANAGE, type: Application::NODE_TYPE_VIEW, idParam: 'id')]\n \tpublic function destroy(int $id): DataResponse {\n \t\treturn $this->handleError(function () use ($id) {\n \t\t\treturn $this->service->delete($id);\n \t\t});\n \t}\n \n-\n \t/**\n \t * @param int $tableId\n \t * @param bool $skipTableEnhancement"
            },
            {
                "sha": "c16d958cc66f27a309030d15bf16fbcd730b25ff",
                "filename": "lib/Middleware/PermissionMiddleware.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FMiddleware%2FPermissionMiddleware.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/lib%2FMiddleware%2FPermissionMiddleware.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FMiddleware%2FPermissionMiddleware.php?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -106,6 +106,7 @@ protected function checkPermission(RequirePermission $attribute): void {\n \t\t}\n \n \t\tmatch ($attribute->getPermission()) {\n+\t\t\tApplication::PERMISSION_READ => true, // this is guaranteed in the pre-test ^\n \t\t\tApplication::PERMISSION_MANAGE => $this->assertManagePermission($isContext, $nodeType, $nodeId),\n \t\t\tApplication::PERMISSION_CREATE => $this->assertCreatePermissions($nodeType, $nodeId),\n \t\t\tApplication::PERMISSION_UPDATE => $this->assertUpdatePermissions($nodeType, $nodeId),"
            },
            {
                "sha": "bc43fc76b213654b082b3fc24a098590f95e0814",
                "filename": "tests/integration/features/APIv2.feature",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/nextcloud/tables/blob/13ca45f1b9f70f694aea81b78bc7416ec840c332/tests%2Fintegration%2Ffeatures%2FAPIv2.feature",
                "raw_url": "https://github.com/nextcloud/tables/raw/13ca45f1b9f70f694aea81b78bc7416ec840c332/tests%2Fintegration%2Ffeatures%2FAPIv2.feature",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/tests%2Fintegration%2Ffeatures%2FAPIv2.feature?ref=13ca45f1b9f70f694aea81b78bc7416ec840c332",
                "patch": "@@ -45,9 +45,7 @@ Feature: APIv2\n     And user \"participant1-v2\" sees the following table attributes on table \"t1\"\n       | favorite | 0 |\n     When user \"participant3-v2\" adds the table \"t1\" to favorites\n-    Then the last response should have a \"403\" status code\n-\n-\n+    Then the last response should have a \"404\" status code\n \n   @api2\n   Scenario: Basic column actions"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/tables/commits/52846ad81fe192ee977f14c82a229b0d9cdc406c",
        "url": "https://api.github.com/repos/nextcloud/tables/commits/52846ad81fe192ee977f14c82a229b0d9cdc406c",
        "html_url": "https://github.com/nextcloud/tables/commit/52846ad81fe192ee977f14c82a229b0d9cdc406c",
        "message": "Merge pull request #1351 from nextcloud/fix/use-ocs-row-create\n\nrefactor(Rows): switch front-end to use Row OCS API",
        "files": [
            {
                "sha": "488a0f849ce1d60dc096dc06c9eafc8a86e19823",
                "filename": "appinfo/routes.php",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/appinfo%2Froutes.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/appinfo%2Froutes.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/appinfo%2Froutes.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -93,7 +93,6 @@\n \t\t['name' => 'row#index', 'url' => '/row/table/{tableId}', 'verb' => 'GET'],\n \t\t['name' => 'row#show', 'url' => '/row/{id}', 'verb' => 'GET'],\n \t\t['name' => 'row#indexView', 'url' => '/row/view/{viewId}', 'verb' => 'GET'],\n-\t\t['name' => 'row#create', 'url' => '/row', 'verb' => 'POST'],\n \t\t['name' => 'row#update', 'url' => '/row/{id}/column/{columnId}', 'verb' => 'PUT'],\n \t\t['name' => 'row#updateSet', 'url' => '/row/{id}', 'verb' => 'PUT'],\n \t\t['name' => 'row#destroyByView', 'url' => '/view/{viewId}/row/{id}', 'verb' => 'DELETE'],"
            },
            {
                "sha": "9e1276d065898218a8706eb947f8df42de1f6eda",
                "filename": "lib/Controller/Api1Controller.php",
                "status": "modified",
                "additions": 14,
                "deletions": 2,
                "changes": 16,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FController%2FApi1Controller.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FController%2FApi1Controller.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FApi1Controller.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -10,6 +10,7 @@\n namespace OCA\\Tables\\Controller;\n \n use Exception;\n+use InvalidArgumentException;\n use OCA\\Tables\\Api\\V1Api;\n use OCA\\Tables\\AppInfo\\Application;\n use OCA\\Tables\\Db\\ViewMapper;\n@@ -376,19 +377,24 @@ public function getView(int $viewId): DataResponse {\n \t *\n \t * @param int $viewId View ID\n \t * @param array{key: 'title'|'emoji'|'description', value: string}|array{key: 'columns', value: int[]}|array{key: 'sort', value: array{columnId: int, mode: 'ASC'|'DESC'}}|array{key: 'filter', value: array{columnId: int, operator: 'begins-with'|'ends-with'|'contains'|'is-equal'|'is-greater-than'|'is-greater-than-or-equal'|'is-lower-than'|'is-lower-than-or-equal'|'is-empty', value: string|int|float}} $data key-value pairs\n-\t * @return DataResponse<Http::STATUS_OK, TablesView, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n+\t * @return DataResponse<Http::STATUS_OK, TablesView, array{}>|DataResponse<Http::STATUS_FORBIDDEN|Http::STATUS_BAD_REQUEST|Http::STATUS_INTERNAL_SERVER_ERROR, array{message: string}, array{}>\n \t *\n \t * 200: View updated\n+\t * 400: Invalid data\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n \tpublic function updateView(int $viewId, array $data): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($this->viewService->update($viewId, $data)->jsonSerialize());\n \t\t} catch (PermissionError $e) {\n-\t\t\t$this->logger->warning('A permission error occurred: '.$e->getMessage(), ['exception' => $e]);\n+\t\t\t$this->logger->warning('A permission error occurred: ' . $e->getMessage(), ['exception' => $e]);\n \t\t\t$message = ['message' => $e->getMessage()];\n \t\t\treturn new DataResponse($message, Http::STATUS_FORBIDDEN);\n+\t\t} catch (InvalidArgumentException $e) {\n+\t\t\t$this->logger->warning('An invalid request occurred: ' . $e->getMessage(), ['exception' => $e]);\n+\t\t\t$message = ['message' => $e->getMessage()];\n+\t\t\treturn new DataResponse($message, Http::STATUS_BAD_REQUEST);\n \t\t} catch (InternalError|Exception $e) {\n \t\t\t$this->logger->error('An internal error or exception occurred: '.$e->getMessage(), ['exception' => $e]);\n \t\t\t$message = ['message' => $e->getMessage()];\n@@ -1127,6 +1133,7 @@ public function indexViewRows(int $viewId, ?int $limit, ?int $offset): DataRespo\n \t * 200: Row returned\n \t * 403: No permissions\n \t */\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function createRowInView(int $viewId, $data): DataResponse {\n \t\tif(is_string($data)) {\n \t\t\t$data = json_decode($data, true);\n@@ -1173,6 +1180,7 @@ public function createRowInView(int $viewId, $data): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function createRowInTable(int $tableId, $data): DataResponse {\n \t\tif(is_string($data)) {\n \t\t\t$data = json_decode($data, true);\n@@ -1360,8 +1368,10 @@ public function deleteRowByView(int $rowId, int $viewId): DataResponse {\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function importInTable(int $tableId, string $path, bool $createMissingColumns = true): DataResponse {\n \t\ttry {\n+\t\t\t// minimal permission is checked, creating columns requires MANAGE permissions - currently tested on service layer\n \t\t\treturn new DataResponse($this->importService->import($tableId, null, $path, $createMissingColumns));\n \t\t} catch (PermissionError $e) {\n \t\t\t$this->logger->warning('A permission error occurred: ' . $e->getMessage(), ['exception' => $e]);\n@@ -1393,8 +1403,10 @@ public function importInTable(int $tableId, string $path, bool $createMissingCol\n \t * 403: No permissions\n \t * 404: Not found\n \t */\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function importInView(int $viewId, string $path, bool $createMissingColumns = true): DataResponse {\n \t\ttry {\n+\t\t\t// minimal permission is checked, creating columns requires MANAGE permissions - currently tested on service layer\n \t\t\treturn new DataResponse($this->importService->import(null, $viewId, $path, $createMissingColumns));\n \t\t} catch (PermissionError $e) {\n \t\t\t$this->logger->warning('A permission error occurred: ' . $e->getMessage(), ['exception' => $e]);"
            },
            {
                "sha": "c0acb01dedc95b2d534dec99f0f7046516d43d07",
                "filename": "lib/Controller/Errors.php",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FController%2FErrors.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FController%2FErrors.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FErrors.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -8,6 +8,7 @@\n namespace OCA\\Tables\\Controller;\n \n use Closure;\n+use InvalidArgumentException;\n use OCA\\Tables\\Errors\\InternalError;\n use OCA\\Tables\\Errors\\NotFoundError;\n use OCA\\Tables\\Errors\\PermissionError;\n@@ -20,13 +21,17 @@ protected function handleError(Closure $callback): DataResponse {\n \t\ttry {\n \t\t\treturn new DataResponse($callback());\n \t\t} catch (PermissionError $e) {\n-\t\t\t$this->logger->warning('A permission error accured: '.$e->getMessage(), ['exception' => $e]);\n+\t\t\t$this->logger->warning('A permission error occurred: '.$e->getMessage(), ['exception' => $e]);\n \t\t\t$message = ['message' => $e->getMessage()];\n \t\t\treturn new DataResponse($message, Http::STATUS_FORBIDDEN);\n \t\t} catch (NotFoundError $e) {\n-\t\t\t$this->logger->warning('A not found error accured: '.$e->getMessage(), ['exception' => $e]);\n+\t\t\t$this->logger->warning('A not found error occurred: ' . $e->getMessage(), ['exception' => $e]);\n \t\t\t$message = ['message' => $e->getMessage()];\n \t\t\treturn new DataResponse($message, Http::STATUS_NOT_FOUND);\n+\t\t} catch (InvalidArgumentException $e) {\n+\t\t\t$this->logger->warning('An invalid request occurred: ' . $e->getMessage(), ['exception' => $e]);\n+\t\t\t$message = ['message' => $e->getMessage()];\n+\t\t\treturn new DataResponse($message, Http::STATUS_BAD_REQUEST);\n \t\t} catch (InternalError|\\Exception $e) {\n \t\t\t$this->logger->error('An internal error or exception occurred: '.$e->getMessage(), ['exception' => $e]);\n \t\t\t$message = ['message' => $e->getMessage()];"
            },
            {
                "sha": "2fd1ffe213b5356e4dbaf4736ecb657eff5d677b",
                "filename": "lib/Controller/ImportController.php",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FController%2FImportController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FController%2FImportController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FImportController.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -8,6 +8,7 @@\n namespace OCA\\Tables\\Controller;\n \n use OCA\\Tables\\AppInfo\\Application;\n+use OCA\\Tables\\Middleware\\Attribute\\RequirePermission;\n use OCA\\Tables\\Service\\ImportService;\n use OCA\\Tables\\UploadException;\n use OCP\\AppFramework\\Controller;\n@@ -65,8 +66,10 @@ public function previewImportTable(int $tableId, String $path): DataResponse {\n \t/**\n \t * @NoAdminRequired\n \t */\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function importInTable(int $tableId, String $path, bool $createMissingColumns = true, array $columnsConfig = []): DataResponse {\n \t\treturn $this->handleError(function () use ($tableId, $path, $createMissingColumns, $columnsConfig) {\n+\t\t\t// minimal permission is checked, creating columns requires MANAGE permissions - currently tested on service layer\n \t\t\treturn $this->service->import($tableId, null, $path, $createMissingColumns, $columnsConfig);\n \t\t});\n \t}\n@@ -83,8 +86,10 @@ public function previewImportView(int $viewId, String $path): DataResponse {\n \t/**\n \t * @NoAdminRequired\n \t */\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function importInView(int $viewId, String $path, bool $createMissingColumns = true, array $columnsConfig = []): DataResponse {\n \t\treturn $this->handleError(function () use ($viewId, $path, $createMissingColumns, $columnsConfig) {\n+\t\t\t// minimal permission is checked, creating columns requires MANAGE permissions - currently tested on service layer\n \t\t\treturn $this->service->import(null, $viewId, $path, $createMissingColumns, $columnsConfig);\n \t\t});\n \t}\n@@ -107,11 +112,13 @@ public function previewUploadImportTable(int $tableId): DataResponse {\n \t/**\n \t * @NoAdminRequired\n \t */\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_TABLE, idParam: 'tableId')]\n \tpublic function importUploadInTable(int $tableId, bool $createMissingColumns = true, string $columnsConfig = ''): DataResponse {\n \t\ttry {\n \t\t\t$columnsConfigArray = json_decode($columnsConfig, true);\n \t\t\t$file = $this->getUploadedFile('uploadfile');\n \t\t\treturn $this->handleError(function () use ($tableId, $file, $createMissingColumns, $columnsConfigArray) {\n+\t\t\t\t// minimal permission is checked, creating columns requires MANAGE permissions - currently tested on service layer\n \t\t\t\treturn $this->service->import($tableId, null, $file['tmp_name'], $createMissingColumns, $columnsConfigArray);\n \t\t\t});\n \t\t} catch (UploadException | NotPermittedException $e) {\n@@ -138,11 +145,13 @@ public function previewUploadImportView(int $viewId): DataResponse {\n \t/**\n \t * @NoAdminRequired\n \t */\n+\t#[RequirePermission(permission: Application::PERMISSION_CREATE, type: Application::NODE_TYPE_VIEW, idParam: 'viewId')]\n \tpublic function importUploadInView(int $viewId, bool $createMissingColumns = true, string $columnsConfig = ''): DataResponse {\n \t\ttry {\n \t\t\t$columnsConfigArray = json_decode($columnsConfig, true);\n \t\t\t$file = $this->getUploadedFile('uploadfile');\n \t\t\treturn $this->handleError(function () use ($viewId, $file, $createMissingColumns, $columnsConfigArray) {\n+\t\t\t\t// minimal permission is checked, creating columns requires MANAGE permissions - currently tested on service layer\n \t\t\t\treturn $this->service->import(null, $viewId, $file['tmp_name'], $createMissingColumns, $columnsConfigArray);\n \t\t\t});\n \t\t} catch (UploadException | NotPermittedException $e) {"
            },
            {
                "sha": "64084f8bb15b432868833212099a1956375638a3",
                "filename": "lib/Controller/RowController.php",
                "status": "modified",
                "additions": 0,
                "deletions": 16,
                "changes": 16,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FController%2FRowController.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FController%2FRowController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FController%2FRowController.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -63,22 +63,6 @@ public function show(int $id): DataResponse {\n \t\t});\n \t}\n \n-\t/**\n-\t * @NoAdminRequired\n-\t */\n-\tpublic function create(\n-\t\t?int $tableId,\n-\t\t?int $viewId,\n-\t\tarray $data\n-\t): DataResponse {\n-\t\treturn $this->handleError(function () use ($tableId, $viewId, $data) {\n-\t\t\treturn $this->service->create(\n-\t\t\t\t$tableId,\n-\t\t\t\t$viewId,\n-\t\t\t\t$data);\n-\t\t});\n-\t}\n-\n \t/**\n \t * @NoAdminRequired\n \t */"
            },
            {
                "sha": "137bf3e2acf98f6d8c300c56f7dc271bae9c5321",
                "filename": "lib/Model/RowDataInput.php",
                "status": "modified",
                "additions": 28,
                "deletions": 2,
                "changes": 30,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FModel%2FRowDataInput.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FModel%2FRowDataInput.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FModel%2FRowDataInput.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -8,17 +8,23 @@\n namespace OCA\\Tables\\Model;\n \n use ArrayAccess;\n+use Iterator;\n+use function current;\n+use function key;\n+use function next;\n+use function reset;\n \n /**\n  * @template-implements ArrayAccess<mixed, array{'columnId': int, 'value': mixed}>\n+ * @template-implements Iterator<mixed, array{'columnId': int, 'value': mixed}>\n  */\n-class RowDataInput implements ArrayAccess {\n+class RowDataInput implements ArrayAccess, Iterator {\n \tprotected const DATA_KEY = 'columnId';\n \tprotected const DATA_VAL = 'value';\n \t/** @psalm-var array<array{'columnId': int, 'value': mixed}> */\n \tprotected array $data = [];\n \n-\tpublic function add(int $columnId, string $value): self {\n+\tpublic function add(int $columnId, string|array $value): self {\n \t\t$this->data[] = [self::DATA_KEY => $columnId, self::DATA_VAL => $value];\n \t\treturn $this;\n \t}\n@@ -45,4 +51,24 @@ public function offsetUnset(mixed $offset): void {\n \t\t\tunset($this->data[$offset]);\n \t\t}\n \t}\n+\n+\tpublic function current(): mixed {\n+\t\treturn current($this->data);\n+\t}\n+\n+\tpublic function next(): void {\n+\t\tnext($this->data);\n+\t}\n+\n+\tpublic function key(): mixed {\n+\t\treturn key($this->data);\n+\t}\n+\n+\tpublic function valid(): bool {\n+\t\treturn $this->key() !== null;\n+\t}\n+\n+\tpublic function rewind(): void {\n+\t\treset($this->data);\n+\t}\n }"
            },
            {
                "sha": "a30725019c1f230f6c9a74f5a7bb46564cf5618f",
                "filename": "lib/Service/ImportService.php",
                "status": "modified",
                "additions": 11,
                "deletions": 4,
                "changes": 15,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FService%2FImportService.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FService%2FImportService.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FService%2FImportService.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -187,8 +187,8 @@ private function getPreviewData(Worksheet $worksheet): array {\n \t}\n \n \t/**\n-\t * @param int|null $tableId\n-\t * @param int|null $viewId\n+\t * @param ?int $tableId\n+\t * @param ?int $viewId\n \t * @param string $path\n \t * @param bool $createMissingColumns\n \t * @return array\n@@ -208,7 +208,8 @@ public function import(?int $tableId, ?int $viewId, string $path, bool $createMi\n \t\t\t\tthrow new PermissionError('create columns at the view id = '.$viewId.' is not allowed.');\n \t\t\t}\n \t\t\t$this->viewId = $viewId;\n-\t\t} elseif ($tableId) {\n+\t\t}\n+\t\tif ($tableId) {\n \t\t\t$table = $this->tableService->find($tableId);\n \t\t\tif (!$this->permissionsService->canCreateRows($table, 'table')) {\n \t\t\t\tthrow new PermissionError('create row at the view id = '. (string) $viewId .' is not allowed.');\n@@ -217,11 +218,17 @@ public function import(?int $tableId, ?int $viewId, string $path, bool $createMi\n \t\t\t\tthrow new PermissionError('create columns at the view id = '. (string) $viewId .' is not allowed.');\n \t\t\t}\n \t\t\t$this->tableId = $tableId;\n-\t\t} else {\n+\t\t}\n+\t\tif (!$this->tableId && !$this->viewId) {\n \t\t\t$e = new \\Exception('Neither tableId nor viewId is given.');\n \t\t\t$this->logger->error($e->getMessage(), ['exception' => $e]);\n \t\t\tthrow new InternalError(get_class($this) . ' - ' . __FUNCTION__ . ': '.$e->getMessage());\n \t\t}\n+\t\tif ($this->tableId && $this->viewId) {\n+\t\t\t$e = new \\LogicException('Both table ID and view ID are provided, but only one of them is allowed');\n+\t\t\t$this->logger->error($e->getMessage(), ['exception' => $e]);\n+\t\t\tthrow new InternalError(get_class($this) . ' - ' . __FUNCTION__ . ': '.$e->getMessage());\n+\t\t}\n \n \t\tif ($this->userId === null || $this->userManager->get($this->userId) === null) {\n \t\t\t$error = 'No user in context, can not import data. Cancel.';"
            },
            {
                "sha": "18eeafeef245162e2a134697fc5c27f8987daa1c",
                "filename": "lib/Service/RowService.php",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FService%2FRowService.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FService%2FRowService.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FService%2FRowService.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -11,7 +11,6 @@\n use OCA\\Tables\\Db\\ColumnMapper;\n use OCA\\Tables\\Db\\Row2;\n use OCA\\Tables\\Db\\Row2Mapper;\n-use OCA\\Tables\\Db\\Table;\n use OCA\\Tables\\Db\\TableMapper;\n use OCA\\Tables\\Db\\View;\n use OCA\\Tables\\Db\\ViewMapper;\n@@ -192,7 +191,8 @@ public function create(?int $tableId, ?int $viewId, RowDataInput|array $data): R\n \t\t\t}\n \n \t\t\t$columns = $this->columnMapper->findMultiple($view->getColumnsArray());\n-\t\t} elseif ($tableId) {\n+\t\t}\n+\t\tif ($tableId) {\n \t\t\ttry {\n \t\t\t\t$table = $this->tableMapper->find($tableId);\n \t\t\t} catch (DoesNotExistException $e) {\n@@ -209,7 +209,9 @@ public function create(?int $tableId, ?int $viewId, RowDataInput|array $data): R\n \t\t\t}\n \n \t\t\t$columns = $this->columnMapper->findAllByTable($tableId);\n-\t\t} else {\n+\t\t}\n+\n+\t\tif (!$viewId && !$tableId) {\n \t\t\tthrow new InternalError('Cannot create row without table or view in context');\n \t\t}\n "
            },
            {
                "sha": "bd7e98bc0624ccc4721b9fd0d1ba8f2066d7896b",
                "filename": "lib/Service/ViewService.php",
                "status": "modified",
                "additions": 23,
                "deletions": 8,
                "changes": 31,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FService%2FViewService.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/lib%2FService%2FViewService.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/lib%2FService%2FViewService.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -11,13 +11,12 @@\n \n use DateTime;\n use Exception;\n-\n+use InvalidArgumentException;\n use OCA\\Tables\\AppInfo\\Application;\n+use OCA\\Tables\\Db\\Column;\n use OCA\\Tables\\Db\\Table;\n use OCA\\Tables\\Db\\View;\n use OCA\\Tables\\Db\\ViewMapper;\n-\n-\n use OCA\\Tables\\Errors\\InternalError;\n use OCA\\Tables\\Errors\\NotFoundError;\n use OCA\\Tables\\Errors\\PermissionError;\n@@ -74,7 +73,6 @@ public function __construct(\n \t\t$this->contextService = $contextService;\n \t}\n \n-\n \t/**\n \t * @param Table $table\n \t * @param string|null $userId\n@@ -246,6 +244,7 @@ public function updateSingle(int $id, string $key, ?string $value, ?string $user\n \t * @return View\n \t * @throws InternalError\n \t * @throws PermissionError\n+\t * @throws InvalidArgumentException\n \t */\n \tpublic function update(int $id, array $data, ?string $userId = null, bool $skipTableEnhancement = false): View {\n \t\t$userId = $this->permissionsService->preCheckUserId($userId);\n@@ -255,26 +254,42 @@ public function update(int $id, array $data, ?string $userId = null, bool $skipT\n \n \t\t\t// security\n \t\t\tif (!$this->permissionsService->canManageView($view, $userId)) {\n-\t\t\t\tthrow new PermissionError('PermissionError: can not update view with id '.$id);\n+\t\t\t\tthrow new PermissionError('PermissionError: can not update view with id ' . $id);\n \t\t\t}\n \n \t\t\t$updatableParameter = ['title', 'emoji', 'description', 'columns', 'sort', 'filter'];\n \n \t\t\tforeach ($data as $key => $value) {\n \t\t\t\tif (!in_array($key, $updatableParameter)) {\n-\t\t\t\t\tthrow new InternalError('View parameter '.$key.' can not be updated.');\n+\t\t\t\t\tthrow new InternalError('View parameter ' . $key . ' can not be updated.');\n \t\t\t\t}\n-\t\t\t\t$setterMethod = 'set'.ucfirst($key);\n+\n+\t\t\t\tif ($key === 'columns') {\n+\t\t\t\t\t// we have to fetch the service here as ColumnService already depends on the ViewService, i.e. no DI\n+\t\t\t\t\t$columnService = \\OCP\\Server::get(ColumnService::class);\n+\t\t\t\t\t$columnIds = \\json_decode($value, true);\n+\t\t\t\t\t$availableColumns = $columnService->findAllByTable($view->getTableId(), $view->getId(), $this->userId);\n+\t\t\t\t\t$availableColumns = array_map(static fn (Column $column) => $column->getId(), $availableColumns);\n+\t\t\t\t\tforeach ($columnIds as $columnId) {\n+\t\t\t\t\t\tif (!in_array($columnId, $availableColumns, true)) {\n+\t\t\t\t\t\t\tthrow new InvalidArgumentException('Invalid column ID provided');\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n+\t\t\t\t$setterMethod = 'set' . ucfirst($key);\n \t\t\t\t$view->$setterMethod($value);\n \t\t\t}\n \t\t\t$time = new DateTime();\n \t\t\t$view->setLastEditBy($userId);\n \t\t\t$view->setLastEditAt($time->format('Y-m-d H:i:s'));\n \t\t\t$view = $this->mapper->update($view);\n-\t\t\tif(!$skipTableEnhancement) {\n+\t\t\tif (!$skipTableEnhancement) {\n \t\t\t\t$this->enhanceView($view, $userId);\n \t\t\t}\n \t\t\treturn $view;\n+\t\t} catch (InvalidArgumentException $e) {\n+\t\t\tthrow $e;\n \t\t} catch (Exception $e) {\n \t\t\t$this->logger->error($e->getMessage(), ['exception' => $e]);\n \t\t\tthrow new InternalError($e->getMessage());"
            },
            {
                "sha": "fddafc0651992f9979be6b7ee03928f668715357",
                "filename": "openapi.json",
                "status": "modified",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/openapi.json",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/openapi.json",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/openapi.json?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -1769,6 +1769,24 @@\n                             }\n                         }\n                     },\n+                    \"400\": {\n+                        \"description\": \"Invalid data\",\n+                        \"content\": {\n+                            \"application/json\": {\n+                                \"schema\": {\n+                                    \"type\": \"object\",\n+                                    \"required\": [\n+                                        \"message\"\n+                                    ],\n+                                    \"properties\": {\n+                                        \"message\": {\n+                                            \"type\": \"string\"\n+                                        }\n+                                    }\n+                                }\n+                            }\n+                        }\n+                    },\n                     \"500\": {\n                         \"description\": \"\",\n                         \"content\": {"
            },
            {
                "sha": "7fa4ac831770ef1cf9c378bc3c56d93a770005ff",
                "filename": "src/modules/modals/CreateRow.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 5,
                "changes": 7,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/src%2Fmodules%2Fmodals%2FCreateRow.vue",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/src%2Fmodules%2Fmodals%2FCreateRow.vue",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/src%2Fmodules%2Fmodals%2FCreateRow.vue?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -118,12 +118,9 @@ export default {\n \t\t\t}\n \n \t\t\ttry {\n-\t\t\t\tconst data = []\n+\t\t\t\tconst data = {}\n \t\t\t\tfor (const [key, value] of Object.entries(this.row)) {\n-\t\t\t\t\tdata.push({\n-\t\t\t\t\t\tcolumnId: key,\n-\t\t\t\t\t\tvalue,\n-\t\t\t\t\t})\n+\t\t\t\t\tdata[key] = value\n \t\t\t\t}\n \t\t\t\tawait this.$store.dispatch('insertNewRow', {\n \t\t\t\t\tviewId: this.isView ? this.elementId : null,"
            },
            {
                "sha": "6229b079fbde1823e8450f98823ea72e75267891",
                "filename": "src/store/data.js",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/src%2Fstore%2Fdata.js",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/src%2Fstore%2Fdata.js",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/src%2Fstore%2Fdata.js?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -3,7 +3,7 @@\n  * SPDX-License-Identifier: AGPL-3.0-or-later\n  */\n import axios from '@nextcloud/axios'\n-import { generateUrl } from '@nextcloud/router'\n+import { generateUrl, generateOcsUrl } from '@nextcloud/router'\n import displayError from '../shared/utils/displayError.js'\n import { parseCol } from '../shared/components/ncTable/mixins/columnParser.js'\n import { MetaColumns } from '../shared/components/ncTable/mixins/metaColumns.js'\n@@ -209,15 +209,17 @@ export default {\n \t\t\tlet res = null\n \n \t\t\ttry {\n-\t\t\t\tres = await axios.post(generateUrl('/apps/tables/row'), { viewId, tableId, data })\n+\t\t\t\tconst collection = viewId == null ? 'tables' : 'views'\n+\t\t\t\tconst nodeId = viewId == null ? tableId : viewId\n+\t\t\t\tres = await axios.post(generateOcsUrl('/apps/tables/api/2/' + collection + '/' + nodeId + '/rows'), { data })\n \t\t\t} catch (e) {\n \t\t\t\tdisplayError(e, t('tables', 'Could not insert row.'))\n \t\t\t\treturn false\n \t\t\t}\n \n \t\t\tconst stateId = genStateKey(!!(viewId), viewId ?? tableId)\n \t\t\tif (stateId) {\n-\t\t\t\tconst row = res.data\n+\t\t\t\tconst row = res?.data?.ocs?.data\n \t\t\t\tconst rows = state.rows[stateId]\n \t\t\t\trows.push(row)\n \t\t\t\tcommit('setRows', { stateId, rows: [...rows] })"
            },
            {
                "sha": "5e1f859bff97e29dd1f1fa1ea8b9457641c15aa0",
                "filename": "src/types/openapi/openapi.ts",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/src%2Ftypes%2Fopenapi%2Fopenapi.ts",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/src%2Ftypes%2Fopenapi%2Fopenapi.ts",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/src%2Ftypes%2Fopenapi%2Fopenapi.ts?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -1476,6 +1476,17 @@ export interface operations {\n                     readonly \"application/json\": components[\"schemas\"][\"View\"];\n                 };\n             };\n+            /** @description Invalid data */\n+            readonly 400: {\n+                headers: {\n+                    readonly [name: string]: unknown;\n+                };\n+                content: {\n+                    readonly \"application/json\": {\n+                        readonly message: string;\n+                    };\n+                };\n+            };\n             /** @description No permissions */\n             readonly 403: {\n                 headers: {"
            },
            {
                "sha": "b70fc3c981356f4852280dbcac078b275962ed21",
                "filename": "tests/integration/features/APIv1.feature",
                "status": "modified",
                "additions": 25,
                "deletions": 0,
                "changes": 25,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/tests%2Fintegration%2Ffeatures%2FAPIv1.feature",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/tests%2Fintegration%2Ffeatures%2FAPIv1.feature",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/tests%2Fintegration%2Ffeatures%2FAPIv1.feature?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -229,6 +229,31 @@ Feature: APIv1\n     When user \"participant1\" deletes view \"first-view\"\n     Then table \"view-test\" has the following views for user \"participant1\"\n \n+  @api1 @views\n+  Scenario: Column can be added to a view\n+    Given table \"Private One\" with emoji \"\ud83e\udd2b\" exists for user \"participant1\" as \"table_p1\"\n+    Then column \"Volatile Notes\" exists with following properties\n+      | type          | text            |\n+      | subtype       | line            |\n+      | mandatory     | 0               |\n+      | description   | Note me a thing |\n+    And user \"participant1\" create view \"Simple View\" with emoji \"\ud83d\ude43\" for \"table_p1\" as \"simple-view\"\n+    When user \"participant1\" sets columns \"Volatile Notes\" to view \"simple-view\"\n+    Then the reported status is \"200\"\n+\n+  @api1 @views\n+  Scenario: Foreign or nonexistent columns cannot be added to a view\n+    Given table \"Private One\" with emoji \"\ud83e\udd2b\" exists for user \"participant1\" as \"table_p1\"\n+    Then column \"Volatile Notes\" exists with following properties\n+      | type          | text            |\n+      | subtype       | line            |\n+      | mandatory     | 0               |\n+      | description   | Note me a thing |\n+    And table \"Private Two\" with emoji \"\ud83e\udd76\" exists for user \"participant2\" as \"table_p2\"\n+    And user \"participant2\" create view \"Sneaky View\" with emoji \"\ud83e\udee3\" for \"table_p2\" as \"sneaky-view\"\n+    When user \"participant2\" sets columns \"Volatile Notes\" to view \"sneaky-view\"\n+    Then the reported status is \"400\"\n+\n   @api1 @contexts @contexts-sharing\n   Scenario: Share an owned context\n     Given table \"Table 1 via api v2\" with emoji \"\ud83d\udc4b\" exists for user \"participant1\" as \"t1\" via v2"
            },
            {
                "sha": "62ff7f1ae5f9e5f3c06397412139069a05f122ca",
                "filename": "tests/integration/features/APIv2.feature",
                "status": "modified",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/tests%2Fintegration%2Ffeatures%2FAPIv2.feature",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/tests%2Fintegration%2Ffeatures%2FAPIv2.feature",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/tests%2Fintegration%2Ffeatures%2FAPIv2.feature?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -786,13 +786,20 @@ Feature: APIv2\n       | usergroupSelectUsers    | true          |\n       | usergroupSelectGroups   | false         |\n     And user \"participant1-v2\" create view \"v1\" with emoji \"\u26a1\ufe0f\" for \"t1\" as \"v1\"\n+    And user \"participant1-v2\" sets columns \"one,two,three,four,five\" to view \"v1\"\n     When user \"participant1-v2\" tries to create a row using v2 on \"view\" \"v1\" with following values\n       | one           | AHA                     |\n       | two           | 161                     |\n       | three         | true                    |\n       | four          | 2023-12-24              |\n       | five          | [{\"id\": \"admin\", \"type\": 0}] |\n     Then the reported status is 200\n+    And the inserted row has the following values\n+      | one           | AHA                     |\n+      | two           | 161                     |\n+      | three         | true                    |\n+      | four          | 2023-12-24              |\n+      | five          | [{\"id\": \"admin\", \"type\": 0}] |\n \n   @api2 @rows @views\n   Scenario: Create rows on a view via v2 with permissions\n@@ -825,6 +832,7 @@ Feature: APIv2\n       | usergroupSelectUsers    | true          |\n       | usergroupSelectGroups   | false         |\n     And user \"participant1-v2\" create view \"v1\" with emoji \"\u26a1\ufe0f\" for \"t1\" as \"v1\"\n+    And user \"participant1-v2\" sets columns \"one,two,three,four,five\" to view \"v1\"\n     And user \"participant1-v2\" shares view \"v1\" with \"participant2-v2\"\n     When user \"participant2-v2\" tries to create a row using v2 on \"view\" \"v1\" with following values\n       | one           | AHA                     |\n@@ -833,6 +841,12 @@ Feature: APIv2\n       | four          | 2023-12-24              |\n       | five          | [{\"id\": \"admin\", \"type\": 0}] |\n     Then the reported status is 200\n+    And the inserted row has the following values\n+      | one           | AHA                     |\n+      | two           | 161                     |\n+      | three         | true                    |\n+      | four          | 2023-12-24              |\n+      | five          | [{\"id\": \"admin\", \"type\": 0}] |\n \n   @api2 @rows @views\n   Scenario: Create rows on a view via v2 without permissions\n@@ -865,6 +879,7 @@ Feature: APIv2\n       | usergroupSelectUsers    | true          |\n       | usergroupSelectGroups   | false         |\n     And user \"participant1-v2\" create view \"v1\" with emoji \"\u26a1\ufe0f\" for \"t1\" as \"v1\"\n+    And user \"participant1-v2\" sets columns \"one,two,three,four,five\" to view \"v1\"\n     And user \"participant1-v2\" shares view \"v1\" with \"participant2-v2\"\n     And user \"participant1-v2\" sets permission \"create\" to 0\n     When user \"participant2-v2\" tries to create a row using v2 on \"view\" \"v1\" with following values\n@@ -906,6 +921,7 @@ Feature: APIv2\n       | usergroupSelectUsers    | true          |\n       | usergroupSelectGroups   | false         |\n     And user \"participant1-v2\" create view \"v1\" with emoji \"\u26a1\ufe0f\" for \"t1\" as \"v1\"\n+    And user \"participant1-v2\" sets columns \"one,two,three,four,five\" to view \"v1\"\n     When user \"participant2-v2\" tries to create a row using v2 on \"view\" \"v1\" with following values\n       | one           | AHA                     |\n       | two           | 161                     |"
            },
            {
                "sha": "5d7891d79dfbf34ee0769c3566f2c892d6ad29b5",
                "filename": "tests/integration/features/bootstrap/FeatureContext.php",
                "status": "modified",
                "additions": 52,
                "deletions": 0,
                "changes": 52,
                "blob_url": "https://github.com/nextcloud/tables/blob/52846ad81fe192ee977f14c82a229b0d9cdc406c/tests%2Fintegration%2Ffeatures%2Fbootstrap%2FFeatureContext.php",
                "raw_url": "https://github.com/nextcloud/tables/raw/52846ad81fe192ee977f14c82a229b0d9cdc406c/tests%2Fintegration%2Ffeatures%2Fbootstrap%2FFeatureContext.php",
                "contents_url": "https://api.github.com/repos/nextcloud/tables/contents/tests%2Fintegration%2Ffeatures%2Fbootstrap%2FFeatureContext.php?ref=52846ad81fe192ee977f14c82a229b0d9cdc406c",
                "patch": "@@ -832,6 +832,27 @@ public function updateView(string $user, string $viewName, string $title, ?strin\n \t\tAssert::assertEquals($itemToVerify['emoji'], $emoji);\n \t}\n \n+\t/**\n+\t * @When user :user sets columns :columnList to view :viewAlias\n+\t */\n+\tpublic function applyColumnsToView(string $user, string $columnList, string $viewAlias) {\n+\t\t$this->setCurrentUser($user);\n+\n+\t\t$columns = explode(',', $columnList);\n+\t\t$columns = array_map(function (string $columnAlias) {\n+\t\t\t$col = $this->collectionManager->getByAlias('column', $columnAlias);\n+\t\t\treturn $col['id'];\n+\t\t}, $columns);\n+\n+\t\t$view = $this->collectionManager->getByAlias('view', $viewAlias);\n+\n+\t\t$this->sendRequest(\n+\t\t\t'PUT',\n+\t\t\t'/apps/tables/api/1/views/' . $view['id'],\n+\t\t\t[ 'data' => ['columns' => json_encode($columns)] ]\n+\t\t);\n+\t}\n+\n \t/**\n \t * @When user :user deletes view :viewName\n \t *\n@@ -1120,6 +1141,8 @@ public function createColumn(string $title, ?TableNode $properties = null): void\n \t\t$columnToVerify = $this->getDataFromResponse($this->response);\n \t\tAssert::assertEquals(200, $this->response->getStatusCode());\n \t\tAssert::assertEquals($columnToVerify['title'], $title);\n+\n+\t\t$this->collectionManager->register($newColumn, 'column', $newColumn['id'], $title);\n \t}\n \n \t/**\n@@ -2368,4 +2391,33 @@ public function shareViewWithUser(string $initiator, string $viewAlias, string $\n \t\t\t$this->shareId = $share['id'];\n \t\t}\n \t}\n+\n+\t/**\n+\t * @Given the inserted row has the following values\n+\t */\n+\tpublic function theInsertedRowHasTheFollowingValues(TableNode $columnValues) {\n+\t\t$jsonBody = json_decode($this->response->getBody()->getContents(), true);\n+\t\t$insertedRow = $jsonBody['ocs']['data'];\n+\n+\t\t$expected = [];\n+\t\tforeach ($columnValues->getRows() as $row) {\n+\t\t\t$columnId = $this->tableColumns[$row[0]];\n+\t\t\t$expected[$columnId] = $row[1];\n+\t\t}\n+\n+\t\tforeach ($insertedRow['data'] as $entry) {\n+\t\t\tif (!isset($expected[$entry['columnId']])) {\n+\t\t\t\tthrow new \\Exception(sprintf('Unexpected column with ID %d was returned', $entry['columnId']));\n+\t\t\t}\n+\t\t\t// intentional weak comparison\n+\t\t\tif ($expected[$entry['columnId']] != $entry['value']) {\n+\t\t\t\tthrow new \\Exception(sprintf('Unexpected value %s for column with ID %d was returned', $entry['value'], $entry['columnId']));\n+\t\t\t}\n+\t\t\tunset($expected[$entry['columnId']]);\n+\t\t}\n+\n+\t\tif (!empty($expected)) {\n+\t\t\tthrow new \\Exception(sprintf('Some expected columns were not returned: %s ', print_r($expected, true)));\n+\t\t}\n+\t}\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/user_oidc/commits/c923428d51972f6d04636c6accbecdec0c1b88e9",
        "url": "https://api.github.com/repos/nextcloud/user_oidc/commits/c923428d51972f6d04636c6accbecdec0c1b88e9",
        "html_url": "https://github.com/nextcloud/user_oidc/commit/c923428d51972f6d04636c6accbecdec0c1b88e9",
        "message": "Merge pull request #961 from nextcloud/fix/noid/absolute-redirect-url\n\nPrevent redirecting to an absolute URL after login",
        "files": [
            {
                "sha": "8ee5fa2a41acaa283daf3c4c341ba678665b6aaa",
                "filename": "lib/Controller/LoginController.php",
                "status": "modified",
                "additions": 17,
                "deletions": 2,
                "changes": 19,
                "blob_url": "https://github.com/nextcloud/user_oidc/blob/c923428d51972f6d04636c6accbecdec0c1b88e9/lib%2FController%2FLoginController.php",
                "raw_url": "https://github.com/nextcloud/user_oidc/raw/c923428d51972f6d04636c6accbecdec0c1b88e9/lib%2FController%2FLoginController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/user_oidc/contents/lib%2FController%2FLoginController.php?ref=c923428d51972f6d04636c6accbecdec0c1b88e9",
                "patch": "@@ -198,6 +198,21 @@ private function buildProtocolErrorResponse(?bool $throttle = null): TemplateRes\n \t\treturn $this->buildFailureTemplateResponse('', 'error', $params, Http::STATUS_NOT_FOUND, $throttleMetadata, $throttle);\n \t}\n \n+\t/**\n+\t * @param string|null $redirectUrl\n+\t * @return RedirectResponse\n+\t */\n+\tprivate function getRedirectResponse(?string $redirectUrl = null): RedirectResponse {\n+\t\t// this could also be done with\n+\t\t// preg_replace('/^https?:\\/\\//', '', $redirectUrl)\n+\t\t// or even: if (preg_match('/https?:\\/\\//', $redirectUrl) === 1) return new RedirectResponse('/');\n+\t\treturn new RedirectResponse(\n+\t\t\t$redirectUrl === null\n+\t\t\t\t? null\n+\t\t\t\t: parse_url($redirectUrl, PHP_URL_PATH)\n+\t\t);\n+\t}\n+\n \t/**\n \t * @PublicPage\n \t * @NoCSRFRequired\n@@ -210,7 +225,7 @@ private function buildProtocolErrorResponse(?bool $throttle = null): TemplateRes\n \t */\n \tpublic function login(int $providerId, ?string $redirectUrl = null) {\n \t\tif ($this->userSession->isLoggedIn()) {\n-\t\t\treturn new RedirectResponse($redirectUrl);\n+\t\t\treturn $this->getRedirectResponse($redirectUrl);\n \t\t}\n \t\tif (!$this->isSecure()) {\n \t\t\treturn $this->buildProtocolErrorResponse();\n@@ -602,7 +617,7 @@ public function code(string $state = '', string $code = '', string $scope = '',\n \n \t\t$redirectUrl = $this->session->get(self::REDIRECT_AFTER_LOGIN);\n \t\tif ($redirectUrl) {\n-\t\t\treturn new RedirectResponse($redirectUrl);\n+\t\t\treturn $this->getRedirectResponse($redirectUrl);\n \t\t}\n \n \t\treturn new RedirectResponse(\\OC_Util::getDefaultPageUrl());"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/rclone/rclone/commits/01ccf204f42b4f68541b16843292439090a2dcf0",
        "url": "https://api.github.com/repos/rclone/rclone/commits/01ccf204f42b4f68541b16843292439090a2dcf0",
        "html_url": "https://github.com/rclone/rclone/commit/01ccf204f42b4f68541b16843292439090a2dcf0",
        "message": "local: fix permission and ownership on symlinks with --links and --metadata\n\nBefore this change, if writing to a local backend with --metadata and\n--links, if the incoming metadata contained mode or ownership\ninformation then rclone would apply the mode/ownership to the\ndestination of the link not the link itself.\n\nThis fixes the problem by using the link safe sycall variants\nlchown/fchmodat when --links and --metadata is in use. Note that Linux\ndoes not support setting permissions on symlinks, so rclone emits a\ndebug message in this case.\n\nThis also fixes setting times on symlinks on Windows which wasn't\nimplemented for atime, mtime and was incorrectly setting the target of\nthe symlink for btime.\n\nSee: https://github.com/rclone/rclone/security/advisories/GHSA-hrxh-9w67-g4cv",
        "files": [
            {
                "sha": "823718dfe969cb8f521229c71e82764117506cbd",
                "filename": "backend/local/lchmod.go",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/rclone/rclone/blob/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flchmod.go",
                "raw_url": "https://github.com/rclone/rclone/raw/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flchmod.go",
                "contents_url": "https://api.github.com/repos/rclone/rclone/contents/backend%2Flocal%2Flchmod.go?ref=01ccf204f42b4f68541b16843292439090a2dcf0",
                "patch": "@@ -0,0 +1,16 @@\n+//go:build windows || plan9 || js || linux\n+\n+package local\n+\n+import \"os\"\n+\n+const haveLChmod = false\n+\n+// lChmod changes the mode of the named file to mode. If the file is a symbolic\n+// link, it changes the link, not the target. If there is an error,\n+// it will be of type *PathError.\n+func lChmod(name string, mode os.FileMode) error {\n+\t// Can't do this safely on this OS - chmoding a symlink always\n+\t// changes the destination.\n+\treturn nil\n+}"
            },
            {
                "sha": "f1fdc474507fc9a44e58f5154f33fabd68c4a9c1",
                "filename": "backend/local/lchmod_unix.go",
                "status": "added",
                "additions": 41,
                "deletions": 0,
                "changes": 41,
                "blob_url": "https://github.com/rclone/rclone/blob/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flchmod_unix.go",
                "raw_url": "https://github.com/rclone/rclone/raw/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flchmod_unix.go",
                "contents_url": "https://api.github.com/repos/rclone/rclone/contents/backend%2Flocal%2Flchmod_unix.go?ref=01ccf204f42b4f68541b16843292439090a2dcf0",
                "patch": "@@ -0,0 +1,41 @@\n+//go:build !windows && !plan9 && !js && !linux\n+\n+package local\n+\n+import (\n+\t\"os\"\n+\t\"syscall\"\n+\n+\t\"golang.org/x/sys/unix\"\n+)\n+\n+const haveLChmod = true\n+\n+// syscallMode returns the syscall-specific mode bits from Go's portable mode bits.\n+//\n+// Borrowed from the syscall source since it isn't public.\n+func syscallMode(i os.FileMode) (o uint32) {\n+\to |= uint32(i.Perm())\n+\tif i&os.ModeSetuid != 0 {\n+\t\to |= syscall.S_ISUID\n+\t}\n+\tif i&os.ModeSetgid != 0 {\n+\t\to |= syscall.S_ISGID\n+\t}\n+\tif i&os.ModeSticky != 0 {\n+\t\to |= syscall.S_ISVTX\n+\t}\n+\treturn o\n+}\n+\n+// lChmod changes the mode of the named file to mode. If the file is a symbolic\n+// link, it changes the link, not the target. If there is an error,\n+// it will be of type *PathError.\n+func lChmod(name string, mode os.FileMode) error {\n+\t// NB linux does not support AT_SYMLINK_NOFOLLOW as a parameter to fchmodat\n+\t// and returns ENOTSUP if you try, so we don't support this on linux\n+\tif e := unix.Fchmodat(unix.AT_FDCWD, name, syscallMode(mode), unix.AT_SYMLINK_NOFOLLOW); e != nil {\n+\t\treturn &os.PathError{Op: \"lChmod\", Path: name, Err: e}\n+\t}\n+\treturn nil\n+}"
            },
            {
                "sha": "fcabdcc34b7773aed65e57c9af9220ef2b1cf56c",
                "filename": "backend/local/lchtimes.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/rclone/rclone/blob/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flchtimes.go",
                "raw_url": "https://github.com/rclone/rclone/raw/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flchtimes.go",
                "contents_url": "https://api.github.com/repos/rclone/rclone/contents/backend%2Flocal%2Flchtimes.go?ref=01ccf204f42b4f68541b16843292439090a2dcf0",
                "patch": "@@ -1,4 +1,4 @@\n-//go:build windows || plan9 || js\n+//go:build plan9 || js\n \n package local\n "
            },
            {
                "sha": "a6dec9a121212e0ba502208c89736b9472a5e56d",
                "filename": "backend/local/lchtimes_windows.go",
                "status": "added",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/rclone/rclone/blob/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flchtimes_windows.go",
                "raw_url": "https://github.com/rclone/rclone/raw/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flchtimes_windows.go",
                "contents_url": "https://api.github.com/repos/rclone/rclone/contents/backend%2Flocal%2Flchtimes_windows.go?ref=01ccf204f42b4f68541b16843292439090a2dcf0",
                "patch": "@@ -0,0 +1,19 @@\n+//go:build windows\n+\n+package local\n+\n+import (\n+\t\"time\"\n+)\n+\n+const haveLChtimes = true\n+\n+// lChtimes changes the access and modification times of the named\n+// link, similar to the Unix utime() or utimes() functions.\n+//\n+// The underlying filesystem may truncate or round the values to a\n+// less precise time unit.\n+// If there is an error, it will be of type *PathError.\n+func lChtimes(name string, atime time.Time, mtime time.Time) error {\n+\treturn setTimes(name, atime, mtime, time.Time{}, true)\n+}"
            },
            {
                "sha": "b3b9b8ba161452ec5de866e8bb84c44c577d67f5",
                "filename": "backend/local/local_internal_test.go",
                "status": "modified",
                "additions": 67,
                "deletions": 9,
                "changes": 76,
                "blob_url": "https://github.com/rclone/rclone/blob/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flocal_internal_test.go",
                "raw_url": "https://github.com/rclone/rclone/raw/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Flocal_internal_test.go",
                "contents_url": "https://api.github.com/repos/rclone/rclone/contents/backend%2Flocal%2Flocal_internal_test.go?ref=01ccf204f42b4f68541b16843292439090a2dcf0",
                "patch": "@@ -268,22 +268,66 @@ func TestMetadata(t *testing.T) {\n \tr := fstest.NewRun(t)\n \tconst filePath = \"metafile.txt\"\n \twhen := time.Now()\n-\tconst dayLength = len(\"2001-01-01\")\n-\twhenRFC := when.Format(time.RFC3339Nano)\n \tr.WriteFile(filePath, \"metadata file contents\", when)\n \tf := r.Flocal.(*Fs)\n \n+\t// Set fs into \"-l\" / \"--links\" mode\n+\tf.opt.TranslateSymlinks = true\n+\n+\t// Write a symlink to the file\n+\tsymlinkPath := \"metafile-link.txt\"\n+\tosSymlinkPath := filepath.Join(f.root, symlinkPath)\n+\tsymlinkPath += linkSuffix\n+\trequire.NoError(t, os.Symlink(filePath, osSymlinkPath))\n+\tsymlinkModTime := fstest.Time(\"2002-02-03T04:05:10.123123123Z\")\n+\trequire.NoError(t, lChtimes(osSymlinkPath, symlinkModTime, symlinkModTime))\n+\n \t// Get the object\n \tobj, err := f.NewObject(ctx, filePath)\n \trequire.NoError(t, err)\n \to := obj.(*Object)\n \n+\t// Get the symlink object\n+\tsymlinkObj, err := f.NewObject(ctx, symlinkPath)\n+\trequire.NoError(t, err)\n+\tsymlinkO := symlinkObj.(*Object)\n+\n+\t// Record metadata for o\n+\toMeta, err := o.Metadata(ctx)\n+\trequire.NoError(t, err)\n+\n+\t// Test symlink first to check it doesn't mess up file\n+\tt.Run(\"Symlink\", func(t *testing.T) {\n+\t\ttestMetadata(t, r, symlinkO, symlinkModTime)\n+\t})\n+\n+\t// Read it again\n+\toMetaNew, err := o.Metadata(ctx)\n+\trequire.NoError(t, err)\n+\n+\t// Check that operating on the symlink didn't change the file it was pointing to\n+\t// See: https://github.com/rclone/rclone/security/advisories/GHSA-hrxh-9w67-g4cv\n+\tassert.Equal(t, oMeta, oMetaNew, \"metadata setting on symlink messed up file\")\n+\n+\t// Now run the same tests on the file\n+\tt.Run(\"File\", func(t *testing.T) {\n+\t\ttestMetadata(t, r, o, when)\n+\t})\n+}\n+\n+func testMetadata(t *testing.T, r *fstest.Run, o *Object, when time.Time) {\n+\tctx := context.Background()\n+\twhenRFC := when.Format(time.RFC3339Nano)\n+\tconst dayLength = len(\"2001-01-01\")\n+\n+\tf := r.Flocal.(*Fs)\n \tfeatures := f.Features()\n \n-\tvar hasXID, hasAtime, hasBtime bool\n+\tvar hasXID, hasAtime, hasBtime, canSetXattrOnLinks bool\n \tswitch runtime.GOOS {\n \tcase \"darwin\", \"freebsd\", \"netbsd\", \"linux\":\n \t\thasXID, hasAtime, hasBtime = true, true, true\n+\t\tcanSetXattrOnLinks = runtime.GOOS != \"linux\"\n \tcase \"openbsd\", \"solaris\":\n \t\thasXID, hasAtime = true, true\n \tcase \"windows\":\n@@ -306,6 +350,10 @@ func TestMetadata(t *testing.T) {\n \t\trequire.NoError(t, err)\n \t\tassert.Nil(t, m)\n \n+\t\tif !canSetXattrOnLinks && o.translatedLink {\n+\t\t\tt.Skip(\"Skip remainder of test as can't set xattr on symlinks on this OS\")\n+\t\t}\n+\n \t\tinM := fs.Metadata{\n \t\t\t\"potato\":  \"chips\",\n \t\t\t\"cabbage\": \"soup\",\n@@ -320,18 +368,21 @@ func TestMetadata(t *testing.T) {\n \t})\n \n \tcheckTime := func(m fs.Metadata, key string, when time.Time) {\n+\t\tt.Helper()\n \t\tmt, ok := o.parseMetadataTime(m, key)\n \t\tassert.True(t, ok)\n \t\tdt := mt.Sub(when)\n \t\tprecision := time.Second\n-\t\tassert.True(t, dt >= -precision && dt <= precision, fmt.Sprintf(\"%s: dt %v outside +/- precision %v\", key, dt, precision))\n+\t\tassert.True(t, dt >= -precision && dt <= precision, fmt.Sprintf(\"%s: dt %v outside +/- precision %v want %v got %v\", key, dt, precision, mt, when))\n \t}\n \n \tcheckInt := func(m fs.Metadata, key string, base int) int {\n+\t\tt.Helper()\n \t\tvalue, ok := o.parseMetadataInt(m, key, base)\n \t\tassert.True(t, ok)\n \t\treturn value\n \t}\n+\n \tt.Run(\"Read\", func(t *testing.T) {\n \t\tm, err := o.Metadata(ctx)\n \t\trequire.NoError(t, err)\n@@ -341,13 +392,12 @@ func TestMetadata(t *testing.T) {\n \t\tcheckInt(m, \"mode\", 8)\n \t\tcheckTime(m, \"mtime\", when)\n \n-\t\tassert.Equal(t, len(whenRFC), len(m[\"mtime\"]))\n \t\tassert.Equal(t, whenRFC[:dayLength], m[\"mtime\"][:dayLength])\n \n-\t\tif hasAtime {\n+\t\tif hasAtime && !o.translatedLink { // symlinks generally don't record atime\n \t\t\tcheckTime(m, \"atime\", when)\n \t\t}\n-\t\tif hasBtime {\n+\t\tif hasBtime && !o.translatedLink { // symlinks generally don't record btime\n \t\t\tcheckTime(m, \"btime\", when)\n \t\t}\n \t\tif hasXID {\n@@ -371,6 +421,10 @@ func TestMetadata(t *testing.T) {\n \t\t\t\"mode\":   \"0767\",\n \t\t\t\"potato\": \"wedges\",\n \t\t}\n+\t\tif !canSetXattrOnLinks && o.translatedLink {\n+\t\t\t// Don't change xattr if not supported on symlinks\n+\t\t\tdelete(newM, \"potato\")\n+\t\t}\n \t\terr := o.writeMetadata(newM)\n \t\trequire.NoError(t, err)\n \n@@ -380,7 +434,11 @@ func TestMetadata(t *testing.T) {\n \n \t\tmode := checkInt(m, \"mode\", 8)\n \t\tif runtime.GOOS != \"windows\" {\n-\t\t\tassert.Equal(t, 0767, mode&0777, fmt.Sprintf(\"mode wrong - expecting 0767 got 0%o\", mode&0777))\n+\t\t\texpectedMode := 0767\n+\t\t\tif o.translatedLink && runtime.GOOS == \"linux\" {\n+\t\t\t\texpectedMode = 0777 // perms of symlinks always read as 0777 on linux\n+\t\t\t}\n+\t\t\tassert.Equal(t, expectedMode, mode&0777, fmt.Sprintf(\"mode wrong - expecting 0%o got 0%o\", expectedMode, mode&0777))\n \t\t}\n \n \t\tcheckTime(m, \"mtime\", newMtime)\n@@ -390,7 +448,7 @@ func TestMetadata(t *testing.T) {\n \t\tif haveSetBTime {\n \t\t\tcheckTime(m, \"btime\", newBtime)\n \t\t}\n-\t\tif xattrSupported {\n+\t\tif xattrSupported && (canSetXattrOnLinks || !o.translatedLink) {\n \t\t\tassert.Equal(t, \"wedges\", m[\"potato\"])\n \t\t}\n \t})"
            },
            {
                "sha": "75b195e64049ed35a99f28a0ebaa828833475a54",
                "filename": "backend/local/metadata.go",
                "status": "modified",
                "additions": 20,
                "deletions": 3,
                "changes": 23,
                "blob_url": "https://github.com/rclone/rclone/blob/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Fmetadata.go",
                "raw_url": "https://github.com/rclone/rclone/raw/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Fmetadata.go",
                "contents_url": "https://api.github.com/repos/rclone/rclone/contents/backend%2Flocal%2Fmetadata.go?ref=01ccf204f42b4f68541b16843292439090a2dcf0",
                "patch": "@@ -105,7 +105,11 @@ func (o *Object) writeMetadataToFile(m fs.Metadata) (outErr error) {\n \t}\n \tif haveSetBTime {\n \t\tif btimeOK {\n-\t\t\terr = setBTime(o.path, btime)\n+\t\t\tif o.translatedLink {\n+\t\t\t\terr = lsetBTime(o.path, btime)\n+\t\t\t} else {\n+\t\t\t\terr = setBTime(o.path, btime)\n+\t\t\t}\n \t\t\tif err != nil {\n \t\t\t\toutErr = fmt.Errorf(\"failed to set birth (creation) time: %w\", err)\n \t\t\t}\n@@ -121,7 +125,11 @@ func (o *Object) writeMetadataToFile(m fs.Metadata) (outErr error) {\n \t\tif runtime.GOOS == \"windows\" || runtime.GOOS == \"plan9\" {\n \t\t\tfs.Debugf(o, \"Ignoring request to set ownership %o.%o on this OS\", gid, uid)\n \t\t} else {\n-\t\t\terr = os.Chown(o.path, uid, gid)\n+\t\t\tif o.translatedLink {\n+\t\t\t\terr = os.Lchown(o.path, uid, gid)\n+\t\t\t} else {\n+\t\t\t\terr = os.Chown(o.path, uid, gid)\n+\t\t\t}\n \t\t\tif err != nil {\n \t\t\t\toutErr = fmt.Errorf(\"failed to change ownership: %w\", err)\n \t\t\t}\n@@ -132,7 +140,16 @@ func (o *Object) writeMetadataToFile(m fs.Metadata) (outErr error) {\n \t\tif mode >= 0 {\n \t\t\tumode := uint(mode)\n \t\t\tif umode <= math.MaxUint32 {\n-\t\t\t\terr = os.Chmod(o.path, os.FileMode(umode))\n+\t\t\t\tif o.translatedLink {\n+\t\t\t\t\tif haveLChmod {\n+\t\t\t\t\t\terr = lChmod(o.path, os.FileMode(umode))\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tfs.Debugf(o, \"Unable to set mode %v on a symlink on this OS\", os.FileMode(umode))\n+\t\t\t\t\t\terr = nil\n+\t\t\t\t\t}\n+\t\t\t\t} else {\n+\t\t\t\t\terr = os.Chmod(o.path, os.FileMode(umode))\n+\t\t\t\t}\n \t\t\t\tif err != nil {\n \t\t\t\t\toutErr = fmt.Errorf(\"failed to change permissions: %w\", err)\n \t\t\t\t}"
            },
            {
                "sha": "bb37b173511cb84e9d2a4435da11a2b65a877d27",
                "filename": "backend/local/setbtime.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/rclone/rclone/blob/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Fsetbtime.go",
                "raw_url": "https://github.com/rclone/rclone/raw/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Fsetbtime.go",
                "contents_url": "https://api.github.com/repos/rclone/rclone/contents/backend%2Flocal%2Fsetbtime.go?ref=01ccf204f42b4f68541b16843292439090a2dcf0",
                "patch": "@@ -13,3 +13,9 @@ func setBTime(name string, btime time.Time) error {\n \t// Does nothing\n \treturn nil\n }\n+\n+// lsetBTime changes the birth time of the link passed in\n+func lsetBTime(name string, btime time.Time) error {\n+\t// Does nothing\n+\treturn nil\n+}"
            },
            {
                "sha": "8ae4998268ee3153db4fc59d544c8939d026a6c0",
                "filename": "backend/local/setbtime_windows.go",
                "status": "modified",
                "additions": 32,
                "deletions": 5,
                "changes": 37,
                "blob_url": "https://github.com/rclone/rclone/blob/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Fsetbtime_windows.go",
                "raw_url": "https://github.com/rclone/rclone/raw/01ccf204f42b4f68541b16843292439090a2dcf0/backend%2Flocal%2Fsetbtime_windows.go",
                "contents_url": "https://api.github.com/repos/rclone/rclone/contents/backend%2Flocal%2Fsetbtime_windows.go?ref=01ccf204f42b4f68541b16843292439090a2dcf0",
                "patch": "@@ -9,15 +9,20 @@ import (\n \n const haveSetBTime = true\n \n-// setBTime sets the birth time of the file passed in\n-func setBTime(name string, btime time.Time) (err error) {\n+// setTimes sets any of atime, mtime or btime\n+// if link is set it sets a link rather than the target\n+func setTimes(name string, atime, mtime, btime time.Time, link bool) (err error) {\n \tpathp, err := syscall.UTF16PtrFromString(name)\n \tif err != nil {\n \t\treturn err\n \t}\n+\tfileFlag := uint32(syscall.FILE_FLAG_BACKUP_SEMANTICS)\n+\tif link {\n+\t\tfileFlag |= syscall.FILE_FLAG_OPEN_REPARSE_POINT\n+\t}\n \th, err := syscall.CreateFile(pathp,\n \t\tsyscall.FILE_WRITE_ATTRIBUTES, syscall.FILE_SHARE_WRITE, nil,\n-\t\tsyscall.OPEN_EXISTING, syscall.FILE_FLAG_BACKUP_SEMANTICS, 0)\n+\t\tsyscall.OPEN_EXISTING, fileFlag, 0)\n \tif err != nil {\n \t\treturn err\n \t}\n@@ -27,6 +32,28 @@ func setBTime(name string, btime time.Time) (err error) {\n \t\t\terr = closeErr\n \t\t}\n \t}()\n-\tbFileTime := syscall.NsecToFiletime(btime.UnixNano())\n-\treturn syscall.SetFileTime(h, &bFileTime, nil, nil)\n+\tvar patime, pmtime, pbtime *syscall.Filetime\n+\tif !atime.IsZero() {\n+\t\tt := syscall.NsecToFiletime(atime.UnixNano())\n+\t\tpatime = &t\n+\t}\n+\tif !mtime.IsZero() {\n+\t\tt := syscall.NsecToFiletime(mtime.UnixNano())\n+\t\tpmtime = &t\n+\t}\n+\tif !btime.IsZero() {\n+\t\tt := syscall.NsecToFiletime(btime.UnixNano())\n+\t\tpbtime = &t\n+\t}\n+\treturn syscall.SetFileTime(h, pbtime, patime, pmtime)\n+}\n+\n+// setBTime sets the birth time of the file passed in\n+func setBTime(name string, btime time.Time) (err error) {\n+\treturn setTimes(name, time.Time{}, time.Time{}, btime, false)\n+}\n+\n+// lsetBTime changes the birth time of the link passed in\n+func lsetBTime(name string, btime time.Time) error {\n+\treturn setTimes(name, time.Time{}, time.Time{}, btime, true)\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/text/commits/ca24b25c93b81626b4e457c260243edeab5f1548",
        "url": "https://api.github.com/repos/nextcloud/text/commits/ca24b25c93b81626b4e457c260243edeab5f1548",
        "html_url": "https://github.com/nextcloud/text/commit/ca24b25c93b81626b4e457c260243edeab5f1548",
        "message": "Merge pull request #6485 from nextcloud/fix/middleware-check-share-details\n\nfix: Apply checks on shares in the middleware",
        "files": [
            {
                "sha": "6ed807ce4bc70bea0a6c314f69ee3074687a298b",
                "filename": "lib/Middleware/SessionMiddleware.php",
                "status": "modified",
                "additions": 22,
                "deletions": 2,
                "changes": 24,
                "blob_url": "https://github.com/nextcloud/text/blob/ca24b25c93b81626b4e457c260243edeab5f1548/lib%2FMiddleware%2FSessionMiddleware.php",
                "raw_url": "https://github.com/nextcloud/text/raw/ca24b25c93b81626b4e457c260243edeab5f1548/lib%2FMiddleware%2FSessionMiddleware.php",
                "contents_url": "https://api.github.com/repos/nextcloud/text/contents/lib%2FMiddleware%2FSessionMiddleware.php?ref=ca24b25c93b81626b4e457c260243edeab5f1548",
                "patch": "@@ -21,10 +21,12 @@\n use OCP\\AppFramework\\Http\\JSONResponse;\n use OCP\\AppFramework\\Http\\Response;\n use OCP\\AppFramework\\Middleware;\n+use OCP\\Constants;\n use OCP\\Files\\IRootFolder;\n use OCP\\Files\\NotPermittedException;\n use OCP\\IL10N;\n use OCP\\IRequest;\n+use OCP\\ISession;\n use OCP\\IUserSession;\n use OCP\\Share\\Exceptions\\ShareNotFound;\n use OCP\\Share\\IManager as ShareManager;\n@@ -36,6 +38,7 @@ public function __construct(\n \t\tprivate IRequest $request,\n \t\tprivate SessionService $sessionService,\n \t\tprivate DocumentService $documentService,\n+\t\tprivate ISession $session,\n \t\tprivate IUserSession $userSession,\n \t\tprivate IRootFolder $rootFolder,\n \t\tprivate ShareManager $shareManager,\n@@ -131,8 +134,25 @@ private function assertUserOrShareToken(ISessionAwareController $controller): vo\n \t\t\t} catch (ShareNotFound) {\n \t\t\t\tthrow new InvalidSessionException();\n \t\t\t}\n-\t\t\t// Check if shareToken has access to document\n-\t\t\tif ($this->rootFolder->getUserFolder($share->getShareOwner())->getFirstNodeById($documentId) === null) {\n+\n+\t\t\t$node = $this->rootFolder->getUserFolder($share->getShareOwner())->getFirstNodeById($documentId);\n+\t\t\tif ($node === null) {\n+\t\t\t\tthrow new InvalidSessionException();\n+\t\t\t}\n+\n+\t\t\tif ($share->getPassword() !== null) {\n+\t\t\t\t$shareId = $this->session->get('public_link_authenticated');\n+\t\t\t\tif ($share->getId() !== $shareId) {\n+\t\t\t\t\tthrow new InvalidSessionException();\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tif (($share->getPermissions() & Constants::PERMISSION_READ) !== Constants::PERMISSION_READ) {\n+\t\t\t\tthrow new InvalidSessionException();\n+\t\t\t}\n+\n+\t\t\t$attributes = $share->getAttributes();\n+\t\t\tif ($attributes !== null && $attributes->getAttribute('permissions', 'download') === false) {\n \t\t\t\tthrow new InvalidSessionException();\n \t\t\t}\n \t\t} else {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/server/commits/5fffbcfe8650eab75b00e8d188fbc95b0e43f3a8",
        "url": "https://api.github.com/repos/nextcloud/server/commits/5fffbcfe8650eab75b00e8d188fbc95b0e43f3a8",
        "html_url": "https://github.com/nextcloud/server/commit/5fffbcfe8650eab75b00e8d188fbc95b0e43f3a8",
        "message": "Merge pull request #44889 from nextcloud/bugfix/noid/skip-cross-storage-move-with-ac\n\nfix(files): Also skip cross storage move with access control",
        "files": [
            {
                "sha": "2c90a28fe3b0afb6daf1d2572c5de74870252aa8",
                "filename": "lib/private/Files/Storage/Local.php",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/nextcloud/server/blob/5fffbcfe8650eab75b00e8d188fbc95b0e43f3a8/lib%2Fprivate%2FFiles%2FStorage%2FLocal.php",
                "raw_url": "https://github.com/nextcloud/server/raw/5fffbcfe8650eab75b00e8d188fbc95b0e43f3a8/lib%2Fprivate%2FFiles%2FStorage%2FLocal.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fprivate%2FFiles%2FStorage%2FLocal.php?ref=5fffbcfe8650eab75b00e8d188fbc95b0e43f3a8",
                "patch": "@@ -584,11 +584,14 @@ private function calculateEtag(string $path, array $stat): string {\n \t}\n \n \tprivate function canDoCrossStorageMove(IStorage $sourceStorage) {\n+\t\t/** @psalm-suppress UndefinedClass */\n \t\treturn $sourceStorage->instanceOfStorage(Local::class)\n \t\t\t// Don't treat ACLStorageWrapper like local storage where copy can be done directly.\n \t\t\t// Instead, use the slower recursive copying in php from Common::copyFromStorage with\n \t\t\t// more permissions checks.\n \t\t\t&& !$sourceStorage->instanceOfStorage('OCA\\GroupFolders\\ACL\\ACLStorageWrapper')\n+\t\t\t// Same for access control\n+\t\t\t&& !$sourceStorage->instanceOfStorage(\\OCA\\FilesAccessControl\\StorageWrapper::class)\n \t\t\t// when moving encrypted files we have to handle keys and the target might not be encrypted\n \t\t\t&& !$sourceStorage->instanceOfStorage(Encryption::class);\n \t}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/server/commits/7e1c30f82a63fbea8c269e0eec38291377f32604",
        "url": "https://api.github.com/repos/nextcloud/server/commits/7e1c30f82a63fbea8c269e0eec38291377f32604",
        "html_url": "https://github.com/nextcloud/server/commit/7e1c30f82a63fbea8c269e0eec38291377f32604",
        "message": "Merge pull request #45340 from nextcloud/bugfix/noid/widen-svg-block\n\nfix: Extend SVG reference check",
        "files": [
            {
                "sha": "0400038d9802c6b0b8c5164168d20b63922125bd",
                "filename": "lib/private/Preview/SVG.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/nextcloud/server/blob/7e1c30f82a63fbea8c269e0eec38291377f32604/lib%2Fprivate%2FPreview%2FSVG.php",
                "raw_url": "https://github.com/nextcloud/server/raw/7e1c30f82a63fbea8c269e0eec38291377f32604/lib%2Fprivate%2FPreview%2FSVG.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fprivate%2FPreview%2FSVG.php?ref=7e1c30f82a63fbea8c269e0eec38291377f32604",
                "patch": "@@ -50,7 +50,7 @@ public function getThumbnail(File $file, int $maxX, int $maxY): ?IImage {\n \t\t\t}\n \n \t\t\t// Do not parse SVG files with references\n-\t\t\tif (stripos($content, 'xlink:href') !== false) {\n+\t\t\tif (preg_match('/[\"\\s](xlink:)?href\\s*=/i', $content)) {\n \t\t\t\treturn null;\n \t\t\t}\n "
            },
            {
                "sha": "6a0e93e5f7942ff4e90e72c3300d252e0fabd458",
                "filename": "tests/lib/Preview/SVGTest.php",
                "status": "modified",
                "additions": 29,
                "deletions": 0,
                "changes": 29,
                "blob_url": "https://github.com/nextcloud/server/blob/7e1c30f82a63fbea8c269e0eec38291377f32604/tests%2Flib%2FPreview%2FSVGTest.php",
                "raw_url": "https://github.com/nextcloud/server/raw/7e1c30f82a63fbea8c269e0eec38291377f32604/tests%2Flib%2FPreview%2FSVGTest.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/tests%2Flib%2FPreview%2FSVGTest.php?ref=7e1c30f82a63fbea8c269e0eec38291377f32604",
                "patch": "@@ -29,4 +29,33 @@ protected function setUp(): void {\n \t\t\t$this->markTestSkipped('No SVG provider present');\n \t\t}\n \t}\n+\n+\tpublic function dataGetThumbnailSVGHref(): array {\n+\t\treturn [\n+\t\t\t['href'],\n+\t\t\t[' href'],\n+\t\t\t[\"\\nhref\"],\n+\t\t\t['xlink:href'],\n+\t\t\t[' xlink:href'],\n+\t\t\t[\"\\nxlink:href\"],\n+\t\t];\n+\t}\n+\n+\t/**\n+\t * @dataProvider dataGetThumbnailSVGHref\n+\t * @requires extension imagick\n+\t */\n+\tpublic function testGetThumbnailSVGHref(string $content): void {\n+\t\t$handle = fopen('php://temp', 'w+');\n+\t\tfwrite($handle, '<svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\">\n+  <image x=\"0\" y=\"0\"' . $content . '=\"fxlogo.png\" height=\"100\" width=\"100\" />\n+</svg>');\n+\t\trewind($handle);\n+\n+\t\t$file = $this->createMock(\\OCP\\Files\\File::class);\n+\t\t$file->method('fopen')\n+\t\t\t->willReturn($handle);\n+\n+\t\tself::assertNull($this->provider->getThumbnail($file, 512, 512));\n+\t}\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/server/commits/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34",
        "url": "https://api.github.com/repos/nextcloud/server/commits/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34",
        "html_url": "https://github.com/nextcloud/server/commit/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34",
        "message": "Merge pull request #47180 from nextcloud/fix/apply-group-limit-on-remove-from-group\n\nApply group limit on remove from group",
        "files": [
            {
                "sha": "c95efa089ff6f8883050e3ca3e7c986b0f9c8f76",
                "filename": "cypress/e2e/files_sharing/limit_to_same_group.cy.ts",
                "status": "added",
                "additions": 107,
                "deletions": 0,
                "changes": 107,
                "blob_url": "https://github.com/nextcloud/server/blob/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34/cypress%2Fe2e%2Ffiles_sharing%2Flimit_to_same_group.cy.ts",
                "raw_url": "https://github.com/nextcloud/server/raw/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34/cypress%2Fe2e%2Ffiles_sharing%2Flimit_to_same_group.cy.ts",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/cypress%2Fe2e%2Ffiles_sharing%2Flimit_to_same_group.cy.ts?ref=142b6e313ffa9d3b950bcd23cb58850d3ae7cf34",
                "patch": "@@ -0,0 +1,107 @@\n+/**\n+ * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n+ * SPDX-License-Identifier: AGPL-3.0-or-later\n+ */\n+\n+import { User } from \"@nextcloud/cypress\"\n+import { createShare } from \"./FilesSharingUtils.ts\"\n+\n+describe('Limit to sharing to people in the same group', () => {\n+\tlet alice: User\n+\tlet bob: User\n+\tlet randomFileName1 = ''\n+\tlet randomFileName2 = ''\n+\tlet randomGroupName = ''\n+\tlet randomGroupName2 = ''\n+\tlet randomGroupName3 = ''\n+\n+\tbefore(() => {\n+\t\trandomFileName1 = Math.random().toString(36).replace(/[^a-z]+/g, '').substring(0, 10) + '.txt'\n+\t\trandomFileName2 = Math.random().toString(36).replace(/[^a-z]+/g, '').substring(0, 10) + '.txt'\n+\t\trandomGroupName = Math.random().toString(36).replace(/[^a-z]+/g, '').substring(0, 10)\n+\t\trandomGroupName2 = Math.random().toString(36).replace(/[^a-z]+/g, '').substring(0, 10)\n+\t\trandomGroupName3 = Math.random().toString(36).replace(/[^a-z]+/g, '').substring(0, 10)\n+\n+\t\tcy.runOccCommand('config:app:set core shareapi_only_share_with_group_members --value yes')\n+\n+\t\tcy.createRandomUser()\n+\t\t\t.then(user => {\n+\t\t\t\talice = user\n+\t\t\t\tcy.createRandomUser()\n+\t\t\t})\n+\t\t\t.then(user => {\n+\t\t\t\tbob = user\n+\n+\t\t\t\tcy.runOccCommand(`group:add ${randomGroupName}`)\n+\t\t\t\tcy.runOccCommand(`group:add ${randomGroupName2}`)\n+\t\t\t\tcy.runOccCommand(`group:add ${randomGroupName3}`)\n+\t\t\t\tcy.runOccCommand(`group:adduser ${randomGroupName} ${alice.userId}`)\n+\t\t\t\tcy.runOccCommand(`group:adduser ${randomGroupName} ${bob.userId}`)\n+\t\t\t\tcy.runOccCommand(`group:adduser ${randomGroupName2} ${alice.userId}`)\n+\t\t\t\tcy.runOccCommand(`group:adduser ${randomGroupName2} ${bob.userId}`)\n+\t\t\t\tcy.runOccCommand(`group:adduser ${randomGroupName3} ${bob.userId}`)\n+\n+\t\t\t\tcy.uploadContent(alice, new Blob(['share to bob'], { type: 'text/plain' }), 'text/plain', `/${randomFileName1}`)\n+\t\t\t\tcy.uploadContent(bob, new Blob(['share by bob'], { type: 'text/plain' }), 'text/plain', `/${randomFileName2}`)\n+\n+\t\t\t\tcy.login(alice)\n+\t\t\t\tcy.visit('/apps/files')\n+\t\t\t\tcreateShare(randomFileName1, bob.userId)\n+\t\t\t\tcy.login(bob)\n+\t\t\t\tcy.visit('/apps/files')\n+\t\t\t\tcreateShare(randomFileName2, alice.userId)\n+\t\t\t})\n+\t})\n+\n+\tafter(() => {\n+\t\tcy.runOccCommand('config:app:set core shareapi_only_share_with_group_members --value no')\n+\t})\n+\n+\tit('Alice can see the shared file', () => {\n+\t\tcy.login(alice)\n+\t\tcy.visit('/apps/files')\n+\t\tcy.get(`[data-cy-files-list] [data-cy-files-list-row-name=\"${randomFileName2}\"]`).should('exist')\n+\t})\n+\n+\tit('Bob can see the shared file', () => {\n+\t\tcy.login(alice)\n+\t\tcy.visit('/apps/files')\n+\t\tcy.get(`[data-cy-files-list] [data-cy-files-list-row-name=\"${randomFileName1}\"]`).should('exist')\n+\t})\n+\n+\tcontext('Bob is removed from the first group', () => {\n+\t\tbefore(() => {\n+\t\t\tcy.runOccCommand(`group:removeuser ${randomGroupName} ${bob.userId}`)\n+\t\t})\n+\n+\t\tit('Alice can see the shared file', () => {\n+\t\t\tcy.login(alice)\n+\t\t\tcy.visit('/apps/files')\n+\t\t\tcy.get(`[data-cy-files-list] [data-cy-files-list-row-name=\"${randomFileName2}\"]`).should('exist')\n+\t\t})\n+\n+\t\tit('Bob can see the shared file', () => {\n+\t\t\tcy.login(alice)\n+\t\t\tcy.visit('/apps/files')\n+\t\t\tcy.get(`[data-cy-files-list] [data-cy-files-list-row-name=\"${randomFileName1}\"]`).should('exist')\n+\t\t})\n+\t})\n+\n+\tcontext('Bob is removed from the second group', () => {\n+\t\tbefore(() => {\n+\t\t\tcy.runOccCommand(`group:removeuser ${randomGroupName2} ${bob.userId}`)\n+\t\t})\n+\n+\t\tit('Alice cannot see the shared file', () => {\n+\t\t\tcy.login(alice)\n+\t\t\tcy.visit('/apps/files')\n+\t\tcy.get(`[data-cy-files-list] [data-cy-files-list-row-name=\"${randomFileName2}\"]`).should('not.exist')\n+\t\t})\n+\n+\t\tit('Bob cannot see the shared file', () => {\n+\t\t\tcy.login(alice)\n+\t\t\tcy.visit('/apps/files')\n+\t\tcy.get(`[data-cy-files-list] [data-cy-files-list-row-name=\"${randomFileName1}\"]`).should('not.exist')\n+\t\t})\n+\t})\n+})"
            },
            {
                "sha": "6d1d04d3c0bb2cbd7c34ebb5004908f7dedb7263",
                "filename": "lib/private/Share20/DefaultShareProvider.php",
                "status": "modified",
                "additions": 44,
                "deletions": 2,
                "changes": 46,
                "blob_url": "https://github.com/nextcloud/server/blob/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34/lib%2Fprivate%2FShare20%2FDefaultShareProvider.php",
                "raw_url": "https://github.com/nextcloud/server/raw/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34/lib%2Fprivate%2FShare20%2FDefaultShareProvider.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fprivate%2FShare20%2FDefaultShareProvider.php?ref=142b6e313ffa9d3b950bcd23cb58850d3ae7cf34",
                "patch": "@@ -28,6 +28,7 @@\n use OCP\\Mail\\IMailer;\n use OCP\\Share\\Exceptions\\ShareNotFound;\n use OCP\\Share\\IAttributes;\n+use OCP\\Share\\IManager;\n use OCP\\Share\\IShare;\n use OCP\\Share\\IShareProviderSupportsAccept;\n use OCP\\Share\\IShareProviderWithNotification;\n@@ -54,6 +55,7 @@ public function __construct(\n \t\tprivate IURLGenerator $urlGenerator,\n \t\tprivate ITimeFactory $timeFactory,\n \t\tprivate LoggerInterface $logger,\n+\t\tprivate IManager $shareManager,\n \t) {\n \t}\n \n@@ -1223,6 +1225,7 @@ public function groupDeleted($gid) {\n \t *\n \t * @param string $uid\n \t * @param string $gid\n+\t * @return void\n \t */\n \tpublic function userDeletedFromGroup($uid, $gid) {\n \t\t/*\n@@ -1234,7 +1237,7 @@ public function userDeletedFromGroup($uid, $gid) {\n \t\t\t->where($qb->expr()->eq('share_type', $qb->createNamedParameter(IShare::TYPE_GROUP)))\n \t\t\t->andWhere($qb->expr()->eq('share_with', $qb->createNamedParameter($gid)));\n \n-\t\t$cursor = $qb->execute();\n+\t\t$cursor = $qb->executeQuery();\n \t\t$ids = [];\n \t\twhile ($row = $cursor->fetch()) {\n \t\t\t$ids[] = (int)$row['id'];\n@@ -1251,7 +1254,46 @@ public function userDeletedFromGroup($uid, $gid) {\n \t\t\t\t\t->where($qb->expr()->eq('share_type', $qb->createNamedParameter(IShare::TYPE_USERGROUP)))\n \t\t\t\t\t->andWhere($qb->expr()->eq('share_with', $qb->createNamedParameter($uid)))\n \t\t\t\t\t->andWhere($qb->expr()->in('parent', $qb->createNamedParameter($chunk, IQueryBuilder::PARAM_INT_ARRAY)));\n-\t\t\t\t$qb->execute();\n+\t\t\t\t$qb->executeStatement();\n+\t\t\t}\n+\t\t}\n+\n+\t\tif ($this->shareManager->shareWithGroupMembersOnly()) {\n+\t\t\t$user = $this->userManager->get($uid);\n+\t\t\tif ($user === null) {\n+\t\t\t\treturn;\n+\t\t\t}\n+\t\t\t$userGroups = $this->groupManager->getUserGroupIds($user);\n+\t\t\t$userGroups = array_diff($userGroups, $this->shareManager->shareWithGroupMembersOnlyExcludeGroupsList());\n+\n+\t\t\t// Delete user shares received by the user from users in the group.\n+\t\t\t$userReceivedShares = $this->shareManager->getSharedWith($uid, IShare::TYPE_USER, null, -1);\n+\t\t\tforeach ($userReceivedShares as $share) {\n+\t\t\t\t$owner = $this->userManager->get($share->getSharedBy());\n+\t\t\t\tif ($owner === null) {\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\t$ownerGroups = $this->groupManager->getUserGroupIds($owner);\n+\t\t\t\t$mutualGroups = array_intersect($userGroups, $ownerGroups);\n+\n+\t\t\t\tif (count($mutualGroups) === 0) {\n+\t\t\t\t\t$this->shareManager->deleteShare($share);\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\t// Delete user shares from the user to users in the group.\n+\t\t\t$userEmittedShares = $this->shareManager->getSharesBy($uid, IShare::TYPE_USER, null, true, -1);\n+\t\t\tforeach ($userEmittedShares as $share) {\n+\t\t\t\t$recipient = $this->userManager->get($share->getSharedWith());\n+\t\t\t\tif ($recipient === null) {\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n+\t\t\t\t$recipientGroups = $this->groupManager->getUserGroupIds($recipient);\n+\t\t\t\t$mutualGroups = array_intersect($userGroups, $recipientGroups);\n+\n+\t\t\t\tif (count($mutualGroups) === 0) {\n+\t\t\t\t\t$this->shareManager->deleteShare($share);\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \t}"
            },
            {
                "sha": "37af048283841b716e821d85a7f6c97a38229137",
                "filename": "lib/private/Share20/ProviderFactory.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/nextcloud/server/blob/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34/lib%2Fprivate%2FShare20%2FProviderFactory.php",
                "raw_url": "https://github.com/nextcloud/server/raw/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34/lib%2Fprivate%2FShare20%2FProviderFactory.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fprivate%2FShare20%2FProviderFactory.php?ref=142b6e313ffa9d3b950bcd23cb58850d3ae7cf34",
                "patch": "@@ -88,6 +88,7 @@ protected function defaultShareProvider() {\n \t\t\t\t$this->serverContainer->getURLGenerator(),\n \t\t\t\t$this->serverContainer->query(ITimeFactory::class),\n \t\t\t\t$this->serverContainer->get(LoggerInterface::class),\n+\t\t\t\t$this->serverContainer->get(IManager::class),\n \t\t\t);\n \t\t}\n "
            },
            {
                "sha": "017deeef114b010abc95d9ec0cb7327f946d18d2",
                "filename": "tests/lib/Share20/DefaultShareProviderTest.php",
                "status": "modified",
                "additions": 15,
                "deletions": 6,
                "changes": 21,
                "blob_url": "https://github.com/nextcloud/server/blob/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34/tests%2Flib%2FShare20%2FDefaultShareProviderTest.php",
                "raw_url": "https://github.com/nextcloud/server/raw/142b6e313ffa9d3b950bcd23cb58850d3ae7cf34/tests%2Flib%2FShare20%2FDefaultShareProviderTest.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/tests%2Flib%2FShare20%2FDefaultShareProviderTest.php?ref=142b6e313ffa9d3b950bcd23cb58850d3ae7cf34",
                "patch": "@@ -72,6 +72,8 @@ class DefaultShareProviderTest extends \\Test\\TestCase {\n \t/** @var LoggerInterface|MockObject */\n \tprotected $logger;\n \n+\tprotected IShareManager&MockObject $shareManager;\n+\n \tprotected function setUp(): void {\n \t\t$this->dbConn = \\OC::$server->getDatabaseConnection();\n \t\t$this->userManager = $this->createMock(IUserManager::class);\n@@ -84,6 +86,7 @@ protected function setUp(): void {\n \t\t$this->urlGenerator = $this->createMock(IURLGenerator::class);\n \t\t$this->timeFactory = $this->createMock(ITimeFactory::class);\n \t\t$this->logger = $this->createMock(LoggerInterface::class);\n+\t\t$this->shareManager = $this->createMock(IShareManager::class);\n \n \t\t$this->userManager->expects($this->any())->method('userExists')->willReturn(true);\n \t\t$this->timeFactory->expects($this->any())->method('now')->willReturn(new \\DateTimeImmutable(\"2023-05-04 00:00 Europe/Berlin\"));\n@@ -101,7 +104,8 @@ protected function setUp(): void {\n \t\t\t$this->l10nFactory,\n \t\t\t$this->urlGenerator,\n \t\t\t$this->timeFactory,\n-\t\t\t$this->logger\n+\t\t\t$this->logger,\n+\t\t\t$this->shareManager,\n \t\t);\n \t}\n \n@@ -464,7 +468,8 @@ public function testDeleteSingleShare() {\n \t\t\t\t$this->l10nFactory,\n \t\t\t\t$this->urlGenerator,\n \t\t\t\t$this->timeFactory,\n-\t\t\t\t$this->logger\n+\t\t\t\t$this->logger,\n+\t\t\t\t$this->shareManager,\n \t\t\t])\n \t\t\t->setMethods(['getShareById'])\n \t\t\t->getMock();\n@@ -560,7 +565,8 @@ public function testDeleteGroupShareWithUserGroupShares() {\n \t\t\t\t$this->l10nFactory,\n \t\t\t\t$this->urlGenerator,\n \t\t\t\t$this->timeFactory,\n-\t\t\t\t$this->logger\n+\t\t\t\t$this->logger,\n+\t\t\t\t$this->shareManager,\n \t\t\t])\n \t\t\t->setMethods(['getShareById'])\n \t\t\t->getMock();\n@@ -2529,7 +2535,8 @@ public function testGetSharesInFolder() {\n \t\t\t$this->l10nFactory,\n \t\t\t$this->urlGenerator,\n \t\t\t$this->timeFactory,\n-\t\t\t$this->logger\n+\t\t\t$this->logger,\n+\t\t\t$this->shareManager,\n \t\t);\n \n \t\t$password = md5(time());\n@@ -2628,7 +2635,8 @@ public function testGetAccessListNoCurrentAccessRequired() {\n \t\t\t$this->l10nFactory,\n \t\t\t$this->urlGenerator,\n \t\t\t$this->timeFactory,\n-\t\t\t$this->logger\n+\t\t\t$this->logger,\n+\t\t\t$this->shareManager,\n \t\t);\n \n \t\t$u1 = $userManager->createUser('testShare1', 'test');\n@@ -2725,7 +2733,8 @@ public function testGetAccessListCurrentAccessRequired() {\n \t\t\t$this->l10nFactory,\n \t\t\t$this->urlGenerator,\n \t\t\t$this->timeFactory,\n-\t\t\t$this->logger\n+\t\t\t$this->logger,\n+\t\t\t$this->shareManager,\n \t\t);\n \n \t\t$u1 = $userManager->createUser('testShare1', 'test');"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/server/commits/c45ed55f959ff54f3ea23dd2ae1a5868a075c9fe",
        "url": "https://api.github.com/repos/nextcloud/server/commits/c45ed55f959ff54f3ea23dd2ae1a5868a075c9fe",
        "html_url": "https://github.com/nextcloud/server/commit/c45ed55f959ff54f3ea23dd2ae1a5868a075c9fe",
        "message": "Merge pull request #48359 from nextcloud/artonge/feat/compare_hashed_password_when_updating_global_cred_in_files_external\n\nfix: Use placeholder for external storage password",
        "files": [
            {
                "sha": "f11dab2785f3b9f912c9e1d8c0bcc7f0ed3ff5c1",
                "filename": "apps/files_external/lib/Lib/Auth/Password/GlobalAuth.php",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/nextcloud/server/blob/c45ed55f959ff54f3ea23dd2ae1a5868a075c9fe/apps%2Ffiles_external%2Flib%2FLib%2FAuth%2FPassword%2FGlobalAuth.php",
                "raw_url": "https://github.com/nextcloud/server/raw/c45ed55f959ff54f3ea23dd2ae1a5868a075c9fe/apps%2Ffiles_external%2Flib%2FLib%2FAuth%2FPassword%2FGlobalAuth.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Ffiles_external%2Flib%2FLib%2FAuth%2FPassword%2FGlobalAuth.php?ref=c45ed55f959ff54f3ea23dd2ae1a5868a075c9fe",
                "patch": "@@ -19,6 +19,7 @@\n  */\n class GlobalAuth extends AuthMechanism {\n \tpublic const CREDENTIALS_IDENTIFIER = 'password::global';\n+\tprivate const PWD_PLACEHOLDER = '************************';\n \n \t/** @var ICredentialsManager */\n \tprotected $credentialsManager;\n@@ -41,11 +42,18 @@ public function getAuth($uid) {\n \t\t\t\t'password' => ''\n \t\t\t];\n \t\t} else {\n+\t\t\t$auth['password'] = self::PWD_PLACEHOLDER;\n \t\t\treturn $auth;\n \t\t}\n \t}\n \n \tpublic function saveAuth($uid, $user, $password) {\n+\t\t// Use old password if it has not changed.\n+\t\tif ($password === self::PWD_PLACEHOLDER) {\n+\t\t\t$auth = $this->credentialsManager->retrieve($uid, self::CREDENTIALS_IDENTIFIER);\n+\t\t\t$password = $auth['password'];\n+\t\t}\n+\n \t\t$this->credentialsManager->store($uid, self::CREDENTIALS_IDENTIFIER, [\n \t\t\t'user' => $user,\n \t\t\t'password' => $password"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/server/commits/09b8aea8f6783514bffe00df6abbf9fa542faac5",
        "url": "https://api.github.com/repos/nextcloud/server/commits/09b8aea8f6783514bffe00df6abbf9fa542faac5",
        "html_url": "https://github.com/nextcloud/server/commit/09b8aea8f6783514bffe00df6abbf9fa542faac5",
        "message": "Merge pull request #47635 from nextcloud/fix/noid/oauth2-store-secret-hash\n\n[oauth2] Store hashed secret instead of encrypted",
        "files": [
            {
                "sha": "b6f14720de1bbbab34db8b7cfee2a2115f68fff9",
                "filename": "apps/oauth2/appinfo/info.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fappinfo%2Finfo.xml",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fappinfo%2Finfo.xml",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Fappinfo%2Finfo.xml?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -9,7 +9,7 @@\n \t<name>OAuth 2.0</name>\n \t<summary>Allows OAuth2 compatible authentication from other web applications.</summary>\n \t<description>The OAuth2 app allows administrators to configure the built-in authentication workflow to also allow OAuth2 compatible authentication from other web applications.</description>\n-\t<version>1.19.0</version>\n+\t<version>1.19.1</version>\n \t<licence>agpl</licence>\n \t<author>Lukas Reschke</author>\n \t<namespace>OAuth2</namespace>"
            },
            {
                "sha": "cba0ef43dfc2ad6618a798bceb7045273a688d12",
                "filename": "apps/oauth2/composer/composer/autoload_classmap.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fcomposer%2Fcomposer%2Fautoload_classmap.php",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fcomposer%2Fcomposer%2Fautoload_classmap.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Fcomposer%2Fcomposer%2Fautoload_classmap.php?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -23,5 +23,6 @@\n     'OCA\\\\OAuth2\\\\Migration\\\\Version011601Date20230522143227' => $baseDir . '/../lib/Migration/Version011601Date20230522143227.php',\n     'OCA\\\\OAuth2\\\\Migration\\\\Version011602Date20230613160650' => $baseDir . '/../lib/Migration/Version011602Date20230613160650.php',\n     'OCA\\\\OAuth2\\\\Migration\\\\Version011603Date20230620111039' => $baseDir . '/../lib/Migration/Version011603Date20230620111039.php',\n+    'OCA\\\\OAuth2\\\\Migration\\\\Version011901Date20240829164356' => $baseDir . '/../lib/Migration/Version011901Date20240829164356.php',\n     'OCA\\\\OAuth2\\\\Settings\\\\Admin' => $baseDir . '/../lib/Settings/Admin.php',\n );"
            },
            {
                "sha": "c4905bc96c477ded891376e77f3d8164dc45d66b",
                "filename": "apps/oauth2/composer/composer/autoload_static.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fcomposer%2Fcomposer%2Fautoload_static.php",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fcomposer%2Fcomposer%2Fautoload_static.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Fcomposer%2Fcomposer%2Fautoload_static.php?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -38,6 +38,7 @@ class ComposerStaticInitOAuth2\n         'OCA\\\\OAuth2\\\\Migration\\\\Version011601Date20230522143227' => __DIR__ . '/..' . '/../lib/Migration/Version011601Date20230522143227.php',\n         'OCA\\\\OAuth2\\\\Migration\\\\Version011602Date20230613160650' => __DIR__ . '/..' . '/../lib/Migration/Version011602Date20230613160650.php',\n         'OCA\\\\OAuth2\\\\Migration\\\\Version011603Date20230620111039' => __DIR__ . '/..' . '/../lib/Migration/Version011603Date20230620111039.php',\n+        'OCA\\\\OAuth2\\\\Migration\\\\Version011901Date20240829164356' => __DIR__ . '/..' . '/../lib/Migration/Version011901Date20240829164356.php',\n         'OCA\\\\OAuth2\\\\Settings\\\\Admin' => __DIR__ . '/..' . '/../lib/Settings/Admin.php',\n     );\n "
            },
            {
                "sha": "d763779053a35a302f5d9339faabfe765ac39666",
                "filename": "apps/oauth2/lib/Controller/OauthApiController.php",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Flib%2FController%2FOauthApiController.php",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Flib%2FController%2FOauthApiController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Flib%2FController%2FOauthApiController.php?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -138,7 +138,8 @@ public function getToken(\n \t\t}\n \n \t\ttry {\n-\t\t\t$storedClientSecret = $this->crypto->decrypt($client->getSecret());\n+\t\t\t$storedClientSecretHash = $client->getSecret();\n+\t\t\t$clientSecretHash = bin2hex($this->crypto->calculateHMAC($client_secret));\n \t\t} catch (\\Exception $e) {\n \t\t\t$this->logger->error('OAuth client secret decryption error', ['exception' => $e]);\n \t\t\t// we don't throttle here because it might not be a bruteforce attack\n@@ -147,7 +148,7 @@ public function getToken(\n \t\t\t], Http::STATUS_BAD_REQUEST);\n \t\t}\n \t\t// The client id and secret must match. Else we don't provide an access token!\n-\t\tif ($client->getClientIdentifier() !== $client_id || $storedClientSecret !== $client_secret) {\n+\t\tif ($client->getClientIdentifier() !== $client_id || $storedClientSecretHash !== $clientSecretHash) {\n \t\t\t$response = new JSONResponse([\n \t\t\t\t'error' => 'invalid_client',\n \t\t\t], Http::STATUS_BAD_REQUEST);"
            },
            {
                "sha": "f16b26696c4ab5e915a771a39728ec5b96ae2656",
                "filename": "apps/oauth2/lib/Controller/SettingsController.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Flib%2FController%2FSettingsController.php",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Flib%2FController%2FSettingsController.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Flib%2FController%2FSettingsController.php?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -50,8 +50,8 @@ public function addClient(string $name,\n \t\t$client->setName($name);\n \t\t$client->setRedirectUri($redirectUri);\n \t\t$secret = $this->secureRandom->generate(64, self::validChars);\n-\t\t$encryptedSecret = $this->crypto->encrypt($secret);\n-\t\t$client->setSecret($encryptedSecret);\n+\t\t$hashedSecret = bin2hex($this->crypto->calculateHMAC($secret));\n+\t\t$client->setSecret($hashedSecret);\n \t\t$client->setClientIdentifier($this->secureRandom->generate(64, self::validChars));\n \t\t$client = $this->clientMapper->insert($client);\n "
            },
            {
                "sha": "20f5754bf11381bcd0373f94b3739ff87f46e0ea",
                "filename": "apps/oauth2/lib/Migration/Version011901Date20240829164356.php",
                "status": "added",
                "additions": 49,
                "deletions": 0,
                "changes": 49,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Flib%2FMigration%2FVersion011901Date20240829164356.php",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Flib%2FMigration%2FVersion011901Date20240829164356.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Flib%2FMigration%2FVersion011901Date20240829164356.php?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -0,0 +1,49 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+/**\n+ * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n+ * SPDX-License-Identifier: AGPL-3.0-or-later\n+ */\n+namespace OCA\\OAuth2\\Migration;\n+\n+use Closure;\n+use OCP\\DB\\QueryBuilder\\IQueryBuilder;\n+use OCP\\IDBConnection;\n+use OCP\\Migration\\IOutput;\n+use OCP\\Migration\\SimpleMigrationStep;\n+use OCP\\Security\\ICrypto;\n+\n+class Version011901Date20240829164356 extends SimpleMigrationStep {\n+\n+\tpublic function __construct(\n+\t\tprivate IDBConnection $connection,\n+\t\tprivate ICrypto $crypto,\n+\t) {\n+\t}\n+\n+\tpublic function postSchemaChange(IOutput $output, Closure $schemaClosure, array $options): void {\n+\t\t$qbUpdate = $this->connection->getQueryBuilder();\n+\t\t$qbUpdate->update('oauth2_clients')\n+\t\t\t->set('secret', $qbUpdate->createParameter('updateSecret'))\n+\t\t\t->where(\n+\t\t\t\t$qbUpdate->expr()->eq('id', $qbUpdate->createParameter('updateId'))\n+\t\t\t);\n+\n+\t\t$qbSelect = $this->connection->getQueryBuilder();\n+\t\t$qbSelect->select('id', 'secret')\n+\t\t\t->from('oauth2_clients');\n+\t\t$req = $qbSelect->executeQuery();\n+\t\twhile ($row = $req->fetch()) {\n+\t\t\t$id = $row['id'];\n+\t\t\t$storedEncryptedSecret = $row['secret'];\n+\t\t\t$secret = $this->crypto->decrypt($storedEncryptedSecret);\n+\t\t\t$hashedSecret = bin2hex($this->crypto->calculateHMAC($secret));\n+\t\t\t$qbUpdate->setParameter('updateSecret', $hashedSecret, IQueryBuilder::PARAM_STR);\n+\t\t\t$qbUpdate->setParameter('updateId', $id, IQueryBuilder::PARAM_INT);\n+\t\t\t$qbUpdate->executeStatement();\n+\t\t}\n+\t\t$req->closeCursor();\n+\t}\n+}"
            },
            {
                "sha": "93b6b7bcc3fda73764fe8b895fe093c23edc8a2a",
                "filename": "apps/oauth2/lib/Settings/Admin.php",
                "status": "modified",
                "additions": 1,
                "deletions": 4,
                "changes": 5,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Flib%2FSettings%2FAdmin.php",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Flib%2FSettings%2FAdmin.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Flib%2FSettings%2FAdmin.php?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -12,7 +12,6 @@\n use OCP\\AppFramework\\Http\\TemplateResponse;\n use OCP\\AppFramework\\Services\\IInitialState;\n use OCP\\IURLGenerator;\n-use OCP\\Security\\ICrypto;\n use OCP\\Settings\\ISettings;\n use Psr\\Log\\LoggerInterface;\n \n@@ -22,7 +21,6 @@ public function __construct(\n \t\tprivate IInitialState $initialState,\n \t\tprivate ClientMapper $clientMapper,\n \t\tprivate IURLGenerator $urlGenerator,\n-\t\tprivate ICrypto $crypto,\n \t\tprivate LoggerInterface $logger,\n \t) {\n \t}\n@@ -33,13 +31,12 @@ public function getForm(): TemplateResponse {\n \n \t\tforeach ($clients as $client) {\n \t\t\ttry {\n-\t\t\t\t$secret = $this->crypto->decrypt($client->getSecret());\n \t\t\t\t$result[] = [\n \t\t\t\t\t'id' => $client->getId(),\n \t\t\t\t\t'name' => $client->getName(),\n \t\t\t\t\t'redirectUri' => $client->getRedirectUri(),\n \t\t\t\t\t'clientId' => $client->getClientIdentifier(),\n-\t\t\t\t\t'clientSecret' => $secret,\n+\t\t\t\t\t'clientSecret' => '',\n \t\t\t\t];\n \t\t\t} catch (\\Exception $e) {\n \t\t\t\t$this->logger->error('[Settings] OAuth client secret decryption error', ['exception' => $e]);"
            },
            {
                "sha": "255da9a094341368f4e7a1fa4160752d3546fc8c",
                "filename": "apps/oauth2/src/App.vue",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fsrc%2FApp.vue",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fsrc%2FApp.vue",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Fsrc%2FApp.vue?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -33,6 +33,10 @@\n \t\t\t\t\t@delete=\"deleteClient\" />\n \t\t\t</tbody>\n \t\t</table>\n+\t\t<NcNoteCard v-if=\"showSecretWarning\"\n+\t\t\ttype=\"warning\">\n+\t\t\t{{ t('oauth2', 'Make sure you store the secret key, it cannot be recovered.') }}\n+\t\t</NcNoteCard>\n \n \t\t<br>\n \t\t<h3>{{ t('oauth2', 'Add client') }}</h3>\n@@ -66,6 +70,7 @@ import { generateUrl } from '@nextcloud/router'\n import { getCapabilities } from '@nextcloud/capabilities'\n import NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\n import NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\n+import NcNoteCard from '@nextcloud/vue/dist/Components/NcNoteCard.js'\n import { loadState } from '@nextcloud/initial-state'\n import NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\n \n@@ -76,6 +81,7 @@ export default {\n \t\tNcSettingsSection,\n \t\tNcButton,\n \t\tNcTextField,\n+\t\tNcNoteCard,\n \t},\n \tprops: {\n \t\tclients: {\n@@ -92,6 +98,7 @@ export default {\n \t\t\t\terror: false,\n \t\t\t},\n \t\t\toauthDocLink: loadState('oauth2', 'oauth2-doc-link'),\n+\t\t\tshowSecretWarning: false,\n \t\t}\n \t},\n \tcomputed: {\n@@ -119,6 +126,7 @@ export default {\n \t\t\t).then(response => {\n \t\t\t\t// eslint-disable-next-line vue/no-mutating-props\n \t\t\t\tthis.clients.push(response.data)\n+\t\t\t\tthis.showSecretWarning = true\n \n \t\t\t\tthis.newClient.name = ''\n \t\t\t\tthis.newClient.redirectUri = ''"
            },
            {
                "sha": "567cf88b63c94f711c1514ce386a541aafb00f2d",
                "filename": "apps/oauth2/src/components/OAuthItem.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fsrc%2Fcomponents%2FOAuthItem.vue",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Fsrc%2Fcomponents%2FOAuthItem.vue",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Fsrc%2Fcomponents%2FOAuthItem.vue?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -10,7 +10,8 @@\n \t\t<td>\n \t\t\t<div class=\"action-secret\">\n \t\t\t\t<code>{{ renderedSecret }}</code>\n-\t\t\t\t<NcButton type=\"tertiary-no-background\"\n+\t\t\t\t<NcButton v-if=\"clientSecret !== ''\"\n+\t\t\t\t\ttype=\"tertiary-no-background\"\n \t\t\t\t\t:aria-label=\"toggleAriaLabel\"\n \t\t\t\t\t@click=\"toggleSecret\">\n \t\t\t\t\t<template #icon>"
            },
            {
                "sha": "803bdce16b11147c0b1b000e254435eda1c0cd2a",
                "filename": "apps/oauth2/tests/Controller/OauthApiControllerTest.php",
                "status": "modified",
                "additions": 44,
                "deletions": 37,
                "changes": 81,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Ftests%2FController%2FOauthApiControllerTest.php",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Ftests%2FController%2FOauthApiControllerTest.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Ftests%2FController%2FOauthApiControllerTest.php?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -249,9 +249,20 @@ public function testRefreshTokenInvalidClient($clientId, $clientSecret) {\n \t\t\t->with('validrefresh')\n \t\t\t->willReturn($accessToken);\n \n+\t\t$this->crypto\n+\t\t\t->method('calculateHMAC')\n+\t\t\t->with($this->callback(function (string $text) {\n+\t\t\t\treturn $text === 'clientSecret' || $text === 'invalidClientSecret';\n+\t\t\t}))\n+\t\t\t->willReturnCallback(function (string $text) {\n+\t\t\t\treturn $text === 'clientSecret'\n+\t\t\t\t\t? 'hashedClientSecret'\n+\t\t\t\t\t: 'hashedInvalidClientSecret';\n+\t\t\t});\n+\n \t\t$client = new Client();\n \t\t$client->setClientIdentifier('clientId');\n-\t\t$client->setSecret('clientSecret');\n+\t\t$client->setSecret(bin2hex('hashedClientSecret'));\n \t\t$this->clientMapper->method('getByUid')\n \t\t\t->with(42)\n \t\t\t->willReturn($client);\n@@ -276,21 +287,20 @@ public function testRefreshTokenInvalidAppToken() {\n \n \t\t$client = new Client();\n \t\t$client->setClientIdentifier('clientId');\n-\t\t$client->setSecret('encryptedClientSecret');\n+\t\t$client->setSecret(bin2hex('hashedClientSecret'));\n \t\t$this->clientMapper->method('getByUid')\n \t\t\t->with(42)\n \t\t\t->willReturn($client);\n \n \t\t$this->crypto\n \t\t\t->method('decrypt')\n-\t\t\t->with($this->callback(function (string $text) {\n-\t\t\t\treturn $text === 'encryptedClientSecret' || $text === 'encryptedToken';\n-\t\t\t}))\n-\t\t\t->willReturnCallback(function (string $text) {\n-\t\t\t\treturn $text === 'encryptedClientSecret'\n-\t\t\t\t\t? 'clientSecret'\n-\t\t\t\t\t: ($text === 'encryptedToken' ? 'decryptedToken' : '');\n-\t\t\t});\n+\t\t\t->with('encryptedToken')\n+\t\t\t->willReturn('decryptedToken');\n+\n+\t\t$this->crypto\n+\t\t\t->method('calculateHMAC')\n+\t\t\t->with('clientSecret')\n+\t\t\t->willReturn('hashedClientSecret');\n \n \t\t$this->tokenProvider->method('getTokenById')\n \t\t\t->with(1337)\n@@ -315,21 +325,20 @@ public function testRefreshTokenValidAppToken() {\n \n \t\t$client = new Client();\n \t\t$client->setClientIdentifier('clientId');\n-\t\t$client->setSecret('encryptedClientSecret');\n+\t\t$client->setSecret(bin2hex('hashedClientSecret'));\n \t\t$this->clientMapper->method('getByUid')\n \t\t\t->with(42)\n \t\t\t->willReturn($client);\n \n \t\t$this->crypto\n \t\t\t->method('decrypt')\n-\t\t\t->with($this->callback(function (string $text) {\n-\t\t\t\treturn $text === 'encryptedClientSecret' || $text === 'encryptedToken';\n-\t\t\t}))\n-\t\t\t->willReturnCallback(function (string $text) {\n-\t\t\t\treturn $text === 'encryptedClientSecret'\n-\t\t\t\t\t? 'clientSecret'\n-\t\t\t\t\t: ($text === 'encryptedToken' ? 'decryptedToken' : '');\n-\t\t\t});\n+\t\t\t->with('encryptedToken')\n+\t\t\t->willReturn('decryptedToken');\n+\n+\t\t$this->crypto\n+\t\t\t->method('calculateHMAC')\n+\t\t\t->with('clientSecret')\n+\t\t\t->willReturn('hashedClientSecret');\n \n \t\t$appToken = new PublicKeyToken();\n \t\t$appToken->setUid('userId');\n@@ -412,21 +421,20 @@ public function testRefreshTokenValidAppTokenBasicAuth() {\n \n \t\t$client = new Client();\n \t\t$client->setClientIdentifier('clientId');\n-\t\t$client->setSecret('encryptedClientSecret');\n+\t\t$client->setSecret(bin2hex('hashedClientSecret'));\n \t\t$this->clientMapper->method('getByUid')\n \t\t\t->with(42)\n \t\t\t->willReturn($client);\n \n \t\t$this->crypto\n \t\t\t->method('decrypt')\n-\t\t\t->with($this->callback(function (string $text) {\n-\t\t\t\treturn $text === 'encryptedClientSecret' || $text === 'encryptedToken';\n-\t\t\t}))\n-\t\t\t->willReturnCallback(function (string $text) {\n-\t\t\t\treturn $text === 'encryptedClientSecret'\n-\t\t\t\t\t? 'clientSecret'\n-\t\t\t\t\t: ($text === 'encryptedToken' ? 'decryptedToken' : '');\n-\t\t\t});\n+\t\t\t->with('encryptedToken')\n+\t\t\t->willReturn('decryptedToken');\n+\n+\t\t$this->crypto\n+\t\t\t->method('calculateHMAC')\n+\t\t\t->with('clientSecret')\n+\t\t\t->willReturn('hashedClientSecret');\n \n \t\t$appToken = new PublicKeyToken();\n \t\t$appToken->setUid('userId');\n@@ -512,21 +520,20 @@ public function testRefreshTokenExpiredAppToken() {\n \n \t\t$client = new Client();\n \t\t$client->setClientIdentifier('clientId');\n-\t\t$client->setSecret('encryptedClientSecret');\n+\t\t$client->setSecret(bin2hex('hashedClientSecret'));\n \t\t$this->clientMapper->method('getByUid')\n \t\t\t->with(42)\n \t\t\t->willReturn($client);\n \n \t\t$this->crypto\n \t\t\t->method('decrypt')\n-\t\t\t->with($this->callback(function (string $text) {\n-\t\t\t\treturn $text === 'encryptedClientSecret' || $text === 'encryptedToken';\n-\t\t\t}))\n-\t\t\t->willReturnCallback(function (string $text) {\n-\t\t\t\treturn $text === 'encryptedClientSecret'\n-\t\t\t\t\t? 'clientSecret'\n-\t\t\t\t\t: ($text === 'encryptedToken' ? 'decryptedToken' : '');\n-\t\t\t});\n+\t\t\t->with('encryptedToken')\n+\t\t\t->willReturn('decryptedToken');\n+\n+\t\t$this->crypto\n+\t\t\t->method('calculateHMAC')\n+\t\t\t->with('clientSecret')\n+\t\t\t->willReturn('hashedClientSecret');\n \n \t\t$appToken = new PublicKeyToken();\n \t\t$appToken->setUid('userId');"
            },
            {
                "sha": "1f93a272ee7d410991b2468ba1c7aa9ab387ecdb",
                "filename": "apps/oauth2/tests/Controller/SettingsControllerTest.php",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Ftests%2FController%2FSettingsControllerTest.php",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Ftests%2FController%2FSettingsControllerTest.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Ftests%2FController%2FSettingsControllerTest.php?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -81,13 +81,13 @@ public function testAddClient() {\n \n \t\t$this->crypto\n \t\t\t->expects($this->once())\n-\t\t\t->method('encrypt')\n-\t\t\t->willReturn('MyEncryptedSecret');\n+\t\t\t->method('calculateHMAC')\n+\t\t\t->willReturn('MyHashedSecret');\n \n \t\t$client = new Client();\n \t\t$client->setName('My Client Name');\n \t\t$client->setRedirectUri('https://example.com/');\n-\t\t$client->setSecret('MySecret');\n+\t\t$client->setSecret(bin2hex('MyHashedSecret'));\n \t\t$client->setClientIdentifier('MyClientIdentifier');\n \n \t\t$this->clientMapper\n@@ -96,7 +96,7 @@ public function testAddClient() {\n \t\t\t->with($this->callback(function (Client $c) {\n \t\t\t\treturn $c->getName() === 'My Client Name' &&\n \t\t\t\t\t$c->getRedirectUri() === 'https://example.com/' &&\n-\t\t\t\t\t$c->getSecret() === 'MyEncryptedSecret' &&\n+\t\t\t\t\t$c->getSecret() === bin2hex('MyHashedSecret') &&\n \t\t\t\t\t$c->getClientIdentifier() === 'MyClientIdentifier';\n \t\t\t}))->willReturnCallback(function (Client $c) {\n \t\t\t\t$c->setId(42);\n@@ -142,7 +142,7 @@ public function testDeleteClient() {\n \t\t$client->setId(123);\n \t\t$client->setName('My Client Name');\n \t\t$client->setRedirectUri('https://example.com/');\n-\t\t$client->setSecret('MySecret');\n+\t\t$client->setSecret(bin2hex('MyHashedSecret'));\n \t\t$client->setClientIdentifier('MyClientIdentifier');\n \n \t\t$this->clientMapper"
            },
            {
                "sha": "9cbefb74671773821545a59325d4d3a87281afa2",
                "filename": "apps/oauth2/tests/Settings/AdminTest.php",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Ftests%2FSettings%2FAdminTest.php",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/apps%2Foauth2%2Ftests%2FSettings%2FAdminTest.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Foauth2%2Ftests%2FSettings%2FAdminTest.php?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -10,7 +10,6 @@\n use OCP\\AppFramework\\Http\\TemplateResponse;\n use OCP\\AppFramework\\Services\\IInitialState;\n use OCP\\IURLGenerator;\n-use OCP\\Security\\ICrypto;\n use PHPUnit\\Framework\\MockObject\\MockObject;\n use Psr\\Log\\LoggerInterface;\n use Test\\TestCase;\n@@ -20,7 +19,7 @@ class AdminTest extends TestCase {\n \t/** @var Admin|MockObject */\n \tprivate $admin;\n \n-\t/** @var IInitialStateService|MockObject */\n+\t/** @var IInitialState|MockObject */\n \tprivate $initialState;\n \n \t/** @var ClientMapper|MockObject */\n@@ -36,7 +35,6 @@ protected function setUp(): void {\n \t\t\t$this->initialState,\n \t\t\t$this->clientMapper,\n \t\t\t$this->createMock(IURLGenerator::class),\n-\t\t\t$this->createMock(ICrypto::class),\n \t\t\t$this->createMock(LoggerInterface::class)\n \t\t);\n \t}"
            },
            {
                "sha": "9dedec58361bcf8f01a1e91ffbfba39da504f8a4",
                "filename": "dist/core-common.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/dist%2Fcore-common.js",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/dist%2Fcore-common.js",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/dist%2Fcore-common.js?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5"
            },
            {
                "sha": "aa8517b844cda5991e5184e5e2b30407dfd0158e",
                "filename": "dist/core-common.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/dist%2Fcore-common.js.map",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/dist%2Fcore-common.js.map",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/dist%2Fcore-common.js.map?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5"
            },
            {
                "sha": "8dba49d7dc1c0d72d76bbe94dcbc4ff22e7e8e7e",
                "filename": "dist/oauth2-oauth2.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/dist%2Foauth2-oauth2.js",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/dist%2Foauth2-oauth2.js",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/dist%2Foauth2-oauth2.js?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -1,2 +1,2 @@\n-(()=>{\"use strict\";var e,n={85584:(e,n,i)=>{var r=i(85471),a=i(65043),o=i(11037);const l={name:\"EyeOutlineIcon\",emits:[\"click\"],props:{title:{type:String},fillColor:{type:String,default:\"currentColor\"},size:{type:Number,default:24}}};var s=i(14486);const c=(0,s.A)(l,(function(){var t=this,e=t._self._c;return e(\"span\",t._b({staticClass:\"material-design-icon eye-outline-icon\",attrs:{\"aria-hidden\":!t.title||null,\"aria-label\":t.title,role:\"img\"},on:{click:function(e){return t.$emit(\"click\",e)}}},\"span\",t.$attrs,!1),[e(\"svg\",{staticClass:\"material-design-icon__svg\",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:\"0 0 24 24\"}},[e(\"path\",{attrs:{d:\"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z\"}},[t.title?e(\"title\",[t._v(t._s(t.title))]):t._e()])])])}),[],!1,null,null,null).exports;var d=i(18740);const u={name:\"OAuthItem\",components:{Delete:o.A,NcButton:d.A,EyeOutline:c},props:{client:{type:Object,required:!0}},data(){return{id:this.client.id,name:this.client.name,redirectUri:this.client.redirectUri,clientId:this.client.clientId,clientSecret:this.client.clientSecret,renderSecret:!1}},computed:{renderedSecret(){return this.renderSecret?this.clientSecret:\"****\"},toggleAriaLabel(){return this.renderSecret?t(\"oauth2\",\"Hide client secret\"):t(\"oauth2\",\"Show client secret\")}},methods:{toggleSecret(){this.renderSecret=!this.renderSecret}}};var p=i(85072),h=i.n(p),A=i(97825),m=i.n(A),C=i(77659),v=i.n(C),f=i(55056),b=i.n(f),g=i(10540),y=i.n(g),x=i(41113),_=i.n(x),S=i(25922),w={};w.styleTagTransform=_(),w.setAttributes=b(),w.insert=v().bind(null,\"head\"),w.domAPI=m(),w.insertStyleElement=y(),h()(S.A,w),S.A&&S.A.locals&&S.A.locals;const N=(0,s.A)(u,(function(){var t=this,e=t._self._c;return e(\"tr\",[e(\"td\",[t._v(t._s(t.name))]),t._v(\" \"),e(\"td\",[t._v(t._s(t.redirectUri))]),t._v(\" \"),e(\"td\",[e(\"code\",[t._v(t._s(t.clientId))])]),t._v(\" \"),e(\"td\",[e(\"div\",{staticClass:\"action-secret\"},[e(\"code\",[t._v(t._s(t.renderedSecret))]),t._v(\" \"),e(\"NcButton\",{attrs:{type:\"tertiary-no-background\",\"aria-label\":t.toggleAriaLabel},on:{click:t.toggleSecret},scopedSlots:t._u([{key:\"icon\",fn:function(){return[e(\"EyeOutline\",{attrs:{size:20}})]},proxy:!0}])})],1)]),t._v(\" \"),e(\"td\",{staticClass:\"action-column\"},[e(\"NcButton\",{attrs:{type:\"tertiary-no-background\",\"aria-label\":t.t(\"oauth2\",\"Delete\")},on:{click:function(e){return t.$emit(\"delete\",t.id)}},scopedSlots:t._u([{key:\"icon\",fn:function(){return[e(\"Delete\",{attrs:{size:20,title:t.t(\"oauth2\",\"Delete\")}})]},proxy:!0}])})],1)])}),[],!1,null,\"cfb38ebe\",null).exports;var O=i(63814),k=i(87485),U=i(88837),B=i(32981),I=i(82182);const D={name:\"App\",components:{OAuthItem:N,NcSettingsSection:U.A,NcButton:d.A,NcTextField:I.A},props:{clients:{type:Array,required:!0}},data:()=>({newClient:{name:\"\",redirectUri:\"\",errorMsg:\"\",error:!1},oauthDocLink:(0,B.C)(\"oauth2\",\"oauth2-doc-link\")}),computed:{instanceName:()=>(0,k.F)().theming.name},methods:{deleteClient(t){a.Ay.delete((0,O.Jv)(\"apps/oauth2/clients/{id}\",{id:t})).then((()=>{this.clients=this.clients.filter((e=>e.id!==t))}))},addClient(){this.newClient.error=!1,a.Ay.post((0,O.Jv)(\"apps/oauth2/clients\"),{name:this.newClient.name,redirectUri:this.newClient.redirectUri}).then((t=>{this.clients.push(t.data),this.newClient.name=\"\",this.newClient.redirectUri=\"\"})).catch((t=>{this.newClient.error=!0,this.newClient.errorMsg=t.response.data.message}))}}};var T=i(39842),j={};j.styleTagTransform=_(),j.setAttributes=b(),j.insert=v().bind(null,\"head\"),j.domAPI=m(),j.insertStyleElement=y(),h()(T.A,j),T.A&&T.A.locals&&T.A.locals;const R=(0,s.A)(D,(function(){var t=this,e=t._self._c;return e(\"NcSettingsSection\",{attrs:{name:t.t(\"oauth2\",\"OAuth 2.0 clients\"),description:t.t(\"oauth2\",\"OAuth 2.0 allows external services to request access to {instanceName}.\",{instanceName:t.instanceName}),\"doc-url\":t.oauthDocLink}},[t.clients.length>0?e(\"table\",{staticClass:\"grid\"},[e(\"thead\",[e(\"tr\",[e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Name\"))+\"\\n\\t\\t\\t\\t\")]),t._v(\" \"),e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Redirection URI\"))+\"\\n\\t\\t\\t\\t\")]),t._v(\" \"),e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Client Identifier\"))+\"\\n\\t\\t\\t\\t\")]),t._v(\" \"),e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Secret key\"))+\"\\n\\t\\t\\t\\t\")]),t._v(\" \"),e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Delete client\"))+\"\\n\\t\\t\\t\\t\")])])]),t._v(\" \"),e(\"tbody\",t._l(t.clients,(function(n){return e(\"OAuthItem\",{key:n.id,attrs:{client:n},on:{delete:t.deleteClient}})})),1)]):t._e(),t._v(\" \"),e(\"br\"),t._v(\" \"),e(\"h3\",[t._v(t._s(t.t(\"oauth2\",\"Add client\")))]),t._v(\" \"),t.newClient.error?e(\"span\",{staticClass:\"msg error\"},[t._v(t._s(t.newClient.errorMsg))]):t._e(),t._v(\" \"),e(\"form\",{staticClass:\"oauth2-form\",on:{submit:function(e){return e.preventDefault(),t.addClient.apply(null,arguments)}}},[e(\"NcTextField\",{staticClass:\"oauth2-form--input\",attrs:{id:\"name\",value:t.newClient.name,type:\"text\",name:\"name\",label:t.t(\"oauth2\",\"Name\"),placeholder:t.t(\"oauth2\",\"Name\")},on:{\"update:value\":function(e){return t.$set(t.newClient,\"name\",e)}}}),t._v(\" \"),e(\"NcTextField\",{staticClass:\"oauth2-form--input\",attrs:{id:\"redirectUri\",value:t.newClient.redirectUri,type:\"url\",name:\"redirectUri\",label:t.t(\"oauth2\",\"Redirection URI\"),placeholder:t.t(\"oauth2\",\"Redirection URI\")},on:{\"update:value\":function(e){return t.$set(t.newClient,\"redirectUri\",e)}}}),t._v(\" \"),e(\"NcButton\",{staticClass:\"inline-button\",attrs:{\"native-type\":\"submit\"}},[t._v(\"\\n\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Add\"))+\"\\n\\t\\t\")])],1)])}),[],!1,null,\"4edab9ab\",null).exports;r.Ay.prototype.t=t,r.Ay.prototype.OC=OC;const E=(0,B.C)(\"oauth2\",\"clients\");new(r.Ay.extend(R))({propsData:{clients:E}}).$mount(\"#oauth2\")},39842:(t,e,n)=>{n.d(e,{A:()=>l});var i=n(71354),r=n.n(i),a=n(76314),o=n.n(a)()(r());o.push([t.id,\"\\ntable[data-v-4edab9ab] {\\n\\tmax-width: 800px;\\n}\\n\\n/** Overwrite button height and position to be aligned with the text input */\\n.inline-button[data-v-4edab9ab] {\\n\\tmin-height: 34px !important;\\n\\tdisplay: inline-flex !important;\\n}\\n.oauth2-form[data-v-4edab9ab] {\\n\\tdisplay: flex;\\n\\tflex-direction: row;\\n}\\n.oauth2-form--input[data-v-4edab9ab] {\\n\\tmax-width: 200px;\\n\\tmargin-inline-end: 10px;\\n}\\n\",\"\",{version:3,sources:[\"webpack://./apps/oauth2/src/App.vue\"],names:[],mappings:\";AAwJA;CACA,gBAAA;AACA;;AAEA,4EAAA;AACA;CACA,2BAAA;CACA,+BAAA;AACA;AACA;CACA,aAAA;CACA,mBAAA;AACA;AACA;CACA,gBAAA;CACA,uBAAA;AACA\",sourcesContent:[\"\\x3c!--\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\n--\\x3e\\n<template>\\n\\t<NcSettingsSection :name=\\\"t('oauth2', 'OAuth 2.0 clients')\\\"\\n\\t\\t:description=\\\"t('oauth2', 'OAuth 2.0 allows external services to request access to {instanceName}.', { instanceName })\\\"\\n\\t\\t:doc-url=\\\"oauthDocLink\\\">\\n\\t\\t<table v-if=\\\"clients.length > 0\\\" class=\\\"grid\\\">\\n\\t\\t\\t<thead>\\n\\t\\t\\t\\t<tr>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Name') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Redirection URI') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Client Identifier') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Secret key') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Delete client') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t</tr>\\n\\t\\t\\t</thead>\\n\\t\\t\\t<tbody>\\n\\t\\t\\t\\t<OAuthItem v-for=\\\"client in clients\\\"\\n\\t\\t\\t\\t\\t:key=\\\"client.id\\\"\\n\\t\\t\\t\\t\\t:client=\\\"client\\\"\\n\\t\\t\\t\\t\\t@delete=\\\"deleteClient\\\" />\\n\\t\\t\\t</tbody>\\n\\t\\t</table>\\n\\n\\t\\t<br>\\n\\t\\t<h3>{{ t('oauth2', 'Add client') }}</h3>\\n\\t\\t<span v-if=\\\"newClient.error\\\" class=\\\"msg error\\\">{{ newClient.errorMsg }}</span>\\n\\t\\t<form class=\\\"oauth2-form\\\" @submit.prevent=\\\"addClient\\\">\\n\\t\\t\\t<NcTextField id=\\\"name\\\"\\n\\t\\t\\t\\t:value.sync=\\\"newClient.name\\\"\\n\\t\\t\\t\\ttype=\\\"text\\\"\\n\\t\\t\\t\\tclass=\\\"oauth2-form--input\\\"\\n\\t\\t\\t\\tname=\\\"name\\\"\\n\\t\\t\\t\\t:label=\\\"t('oauth2', 'Name')\\\"\\n\\t\\t\\t\\t:placeholder=\\\"t('oauth2', 'Name')\\\" />\\n\\t\\t\\t<NcTextField id=\\\"redirectUri\\\"\\n\\t\\t\\t\\t:value.sync=\\\"newClient.redirectUri\\\"\\n\\t\\t\\t\\ttype=\\\"url\\\"\\n\\t\\t\\t\\tclass=\\\"oauth2-form--input\\\"\\n\\t\\t\\t\\tname=\\\"redirectUri\\\"\\n\\t\\t\\t\\t:label=\\\"t('oauth2', 'Redirection URI')\\\"\\n\\t\\t\\t\\t:placeholder=\\\"t('oauth2', 'Redirection URI')\\\" />\\n\\t\\t\\t<NcButton native-type=\\\"submit\\\" class=\\\"inline-button\\\">\\n\\t\\t\\t\\t{{ t('oauth2', 'Add') }}\\n\\t\\t\\t</NcButton>\\n\\t\\t</form>\\n\\t</NcSettingsSection>\\n</template>\\n\\n<script>\\nimport axios from '@nextcloud/axios'\\nimport OAuthItem from './components/OAuthItem.vue'\\nimport { generateUrl } from '@nextcloud/router'\\nimport { getCapabilities } from '@nextcloud/capabilities'\\nimport NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\nimport { loadState } from '@nextcloud/initial-state'\\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\\n\\nexport default {\\n\\tname: 'App',\\n\\tcomponents: {\\n\\t\\tOAuthItem,\\n\\t\\tNcSettingsSection,\\n\\t\\tNcButton,\\n\\t\\tNcTextField,\\n\\t},\\n\\tprops: {\\n\\t\\tclients: {\\n\\t\\t\\ttype: Array,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tnewClient: {\\n\\t\\t\\t\\tname: '',\\n\\t\\t\\t\\tredirectUri: '',\\n\\t\\t\\t\\terrorMsg: '',\\n\\t\\t\\t\\terror: false,\\n\\t\\t\\t},\\n\\t\\t\\toauthDocLink: loadState('oauth2', 'oauth2-doc-link'),\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\tinstanceName() {\\n\\t\\t\\treturn getCapabilities().theming.name\\n\\t\\t},\\n\\t},\\n\\tmethods: {\\n\\t\\tdeleteClient(id) {\\n\\t\\t\\taxios.delete(generateUrl('apps/oauth2/clients/{id}', { id }))\\n\\t\\t\\t\\t.then(() => {\\n\\t\\t\\t\\t\\t// eslint-disable-next-line vue/no-mutating-props\\n\\t\\t\\t\\t\\tthis.clients = this.clients.filter(client => client.id !== id)\\n\\t\\t\\t\\t})\\n\\t\\t},\\n\\t\\taddClient() {\\n\\t\\t\\tthis.newClient.error = false\\n\\n\\t\\t\\taxios.post(\\n\\t\\t\\t\\tgenerateUrl('apps/oauth2/clients'),\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tname: this.newClient.name,\\n\\t\\t\\t\\t\\tredirectUri: this.newClient.redirectUri,\\n\\t\\t\\t\\t},\\n\\t\\t\\t).then(response => {\\n\\t\\t\\t\\t// eslint-disable-next-line vue/no-mutating-props\\n\\t\\t\\t\\tthis.clients.push(response.data)\\n\\n\\t\\t\\t\\tthis.newClient.name = ''\\n\\t\\t\\t\\tthis.newClient.redirectUri = ''\\n\\t\\t\\t}).catch(reason => {\\n\\t\\t\\t\\tthis.newClient.error = true\\n\\t\\t\\t\\tthis.newClient.errorMsg = reason.response.data.message\\n\\t\\t\\t})\\n\\t\\t},\\n\\t},\\n}\\n<\\/script>\\n<style scoped>\\n\\ttable {\\n\\t\\tmax-width: 800px;\\n\\t}\\n\\n\\t/** Overwrite button height and position to be aligned with the text input */\\n\\t.inline-button {\\n\\t\\tmin-height: 34px !important;\\n\\t\\tdisplay: inline-flex !important;\\n\\t}\\n\\t.oauth2-form {\\n\\t\\tdisplay: flex;\\n\\t\\tflex-direction: row;\\n\\t}\\n\\t.oauth2-form--input {\\n\\t\\tmax-width: 200px;\\n\\t\\tmargin-inline-end: 10px;\\n\\t}\\n</style>\\n\"],sourceRoot:\"\"}]);const l=o},25922:(t,e,n)=>{n.d(e,{A:()=>l});var i=n(71354),r=n.n(i),a=n(76314),o=n.n(a)()(r());o.push([t.id,\"\\n.action-secret[data-v-cfb38ebe] {\\n\\tdisplay: flex;\\n\\talign-items: center;\\n}\\n.action-secret code[data-v-cfb38ebe] {\\n\\tpadding-top: 5px;\\n}\\ntd code[data-v-cfb38ebe] {\\n\\tdisplay: inline-block;\\n\\tvertical-align: middle;\\n}\\ntable.inline td[data-v-cfb38ebe] {\\n\\tborder: none;\\n\\tpadding: 5px;\\n}\\n.action-column[data-v-cfb38ebe] {\\n\\tdisplay: flex;\\n\\tjustify-content: flex-end;\\n\\tpadding-inline-end: 0;\\n}\\n\",\"\",{version:3,sources:[\"webpack://./apps/oauth2/src/components/OAuthItem.vue\"],names:[],mappings:\";AA8GA;CACA,aAAA;CACA,mBAAA;AACA;AACA;CACA,gBAAA;AACA;AACA;CACA,qBAAA;CACA,sBAAA;AACA;AACA;CACA,YAAA;CACA,YAAA;AACA;AAEA;CACA,aAAA;CACA,yBAAA;CACA,qBAAA;AACA\",sourcesContent:[\"\\x3c!--\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\n--\\x3e\\n<template>\\n\\t<tr>\\n\\t\\t<td>{{ name }}</td>\\n\\t\\t<td>{{ redirectUri }}</td>\\n\\t\\t<td><code>{{ clientId }}</code></td>\\n\\t\\t<td>\\n\\t\\t\\t<div class=\\\"action-secret\\\">\\n\\t\\t\\t\\t<code>{{ renderedSecret }}</code>\\n\\t\\t\\t\\t<NcButton type=\\\"tertiary-no-background\\\"\\n\\t\\t\\t\\t\\t:aria-label=\\\"toggleAriaLabel\\\"\\n\\t\\t\\t\\t\\t@click=\\\"toggleSecret\\\">\\n\\t\\t\\t\\t\\t<template #icon>\\n\\t\\t\\t\\t\\t\\t<EyeOutline :size=\\\"20\\\" />\\n\\t\\t\\t\\t\\t</template>\\n\\t\\t\\t\\t</NcButton>\\n\\t\\t\\t</div>\\n\\t\\t</td>\\n\\t\\t<td class=\\\"action-column\\\">\\n\\t\\t\\t<NcButton type=\\\"tertiary-no-background\\\"\\n\\t\\t\\t\\t:aria-label=\\\"t('oauth2', 'Delete')\\\"\\n\\t\\t\\t\\t@click=\\\"$emit('delete', id)\\\">\\n\\t\\t\\t\\t<template #icon>\\n\\t\\t\\t\\t\\t<Delete :size=\\\"20\\\"\\n\\t\\t\\t\\t\\t\\t:title=\\\"t('oauth2', 'Delete')\\\" />\\n\\t\\t\\t\\t</template>\\n\\t\\t\\t</NcButton>\\n\\t\\t</td>\\n\\t</tr>\\n</template>\\n\\n<script>\\n\\nimport Delete from 'vue-material-design-icons/Delete.vue'\\nimport EyeOutline from 'vue-material-design-icons/EyeOutline.vue'\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\n\\nexport default {\\n\\tname: 'OAuthItem',\\n\\tcomponents: {\\n\\t\\tDelete,\\n\\t\\tNcButton,\\n\\t\\tEyeOutline,\\n\\t},\\n\\tprops: {\\n\\t\\tclient: {\\n\\t\\t\\ttype: Object,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tid: this.client.id,\\n\\t\\t\\tname: this.client.name,\\n\\t\\t\\tredirectUri: this.client.redirectUri,\\n\\t\\t\\tclientId: this.client.clientId,\\n\\t\\t\\tclientSecret: this.client.clientSecret,\\n\\t\\t\\trenderSecret: false,\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\trenderedSecret() {\\n\\t\\t\\tif (this.renderSecret) {\\n\\t\\t\\t\\treturn this.clientSecret\\n\\t\\t\\t} else {\\n\\t\\t\\t\\treturn '****'\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\ttoggleAriaLabel() {\\n\\t\\t\\tif (!this.renderSecret) {\\n\\t\\t\\t\\treturn t('oauth2', 'Show client secret')\\n\\t\\t\\t}\\n\\t\\t\\treturn t('oauth2', 'Hide client secret')\\n\\t\\t},\\n\\t},\\n\\tmethods: {\\n\\t\\ttoggleSecret() {\\n\\t\\t\\tthis.renderSecret = !this.renderSecret\\n\\t\\t},\\n\\t},\\n}\\n<\\/script>\\n\\n<style scoped>\\n\\t.action-secret {\\n\\t\\tdisplay: flex;\\n\\t\\talign-items: center;\\n\\t}\\n\\t.action-secret code {\\n\\t\\tpadding-top: 5px;\\n\\t}\\n\\ttd code {\\n\\t\\tdisplay: inline-block;\\n\\t\\tvertical-align: middle;\\n\\t}\\n\\ttable.inline td {\\n\\t\\tborder: none;\\n\\t\\tpadding: 5px;\\n\\t}\\n\\n\\t.action-column {\\n\\t\\tdisplay: flex;\\n\\t\\tjustify-content: flex-end;\\n\\t\\tpadding-inline-end: 0;\\n\\t}\\n</style>\\n\"],sourceRoot:\"\"}]);const l=o}},i={};function r(t){var e=i[t];if(void 0!==e)return e.exports;var a=i[t]={id:t,loaded:!1,exports:{}};return n[t].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}r.m=n,e=[],r.O=(t,n,i,a)=>{if(!n){var o=1/0;for(d=0;d<e.length;d++){n=e[d][0],i=e[d][1],a=e[d][2];for(var l=!0,s=0;s<n.length;s++)(!1&a||o>=a)&&Object.keys(r.O).every((t=>r.O[t](n[s])))?n.splice(s--,1):(l=!1,a<o&&(o=a));if(l){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,i,a]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.e=()=>Promise.resolve(),r.g=function(){if(\"object\"==typeof globalThis)return globalThis;try{return this||new Function(\"return this\")()}catch(t){if(\"object\"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),r.j=6174,(()=>{r.b=document.baseURI||self.location.href;var t={6174:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var i,a,o=n[0],l=n[1],s=n[2],c=0;if(o.some((e=>0!==t[e]))){for(i in l)r.o(l,i)&&(r.m[i]=l[i]);if(s)var d=s(r)}for(e&&e(n);c<o.length;c++)a=o[c],r.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return r.O(d)},n=self.webpackChunknextcloud=self.webpackChunknextcloud||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),r.nc=void 0;var a=r.O(void 0,[4208],(()=>r(85584)));a=r.O(a)})();\n-//# sourceMappingURL=oauth2-oauth2.js.map?v=14be3bd736d990a0e63e\n\\ No newline at end of file\n+(()=>{\"use strict\";var e,n={99747:(e,n,i)=>{var r=i(85471),o=i(65043),a=i(11037);const l={name:\"EyeOutlineIcon\",emits:[\"click\"],props:{title:{type:String},fillColor:{type:String,default:\"currentColor\"},size:{type:Number,default:24}}};var s=i(14486);const c=(0,s.A)(l,(function(){var t=this,e=t._self._c;return e(\"span\",t._b({staticClass:\"material-design-icon eye-outline-icon\",attrs:{\"aria-hidden\":!t.title||null,\"aria-label\":t.title,role:\"img\"},on:{click:function(e){return t.$emit(\"click\",e)}}},\"span\",t.$attrs,!1),[e(\"svg\",{staticClass:\"material-design-icon__svg\",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:\"0 0 24 24\"}},[e(\"path\",{attrs:{d:\"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z\"}},[t.title?e(\"title\",[t._v(t._s(t.title))]):t._e()])])])}),[],!1,null,null,null).exports;var d=i(18740);const u={name:\"OAuthItem\",components:{Delete:a.A,NcButton:d.A,EyeOutline:c},props:{client:{type:Object,required:!0}},data(){return{id:this.client.id,name:this.client.name,redirectUri:this.client.redirectUri,clientId:this.client.clientId,clientSecret:this.client.clientSecret,renderSecret:!1}},computed:{renderedSecret(){return this.renderSecret?this.clientSecret:\"****\"},toggleAriaLabel(){return this.renderSecret?t(\"oauth2\",\"Hide client secret\"):t(\"oauth2\",\"Show client secret\")}},methods:{toggleSecret(){this.renderSecret=!this.renderSecret}}};var h=i(85072),p=i.n(h),A=i(97825),m=i.n(A),C=i(77659),v=i.n(C),f=i(55056),g=i.n(f),y=i(10540),b=i.n(y),x=i(41113),S=i.n(x),_=i(30677),N={};N.styleTagTransform=S(),N.setAttributes=g(),N.insert=v().bind(null,\"head\"),N.domAPI=m(),N.insertStyleElement=b(),p()(_.A,N),_.A&&_.A.locals&&_.A.locals;const w=(0,s.A)(u,(function(){var t=this,e=t._self._c;return e(\"tr\",[e(\"td\",[t._v(t._s(t.name))]),t._v(\" \"),e(\"td\",[t._v(t._s(t.redirectUri))]),t._v(\" \"),e(\"td\",[e(\"code\",[t._v(t._s(t.clientId))])]),t._v(\" \"),e(\"td\",[e(\"div\",{staticClass:\"action-secret\"},[e(\"code\",[t._v(t._s(t.renderedSecret))]),t._v(\" \"),\"\"!==t.clientSecret?e(\"NcButton\",{attrs:{type:\"tertiary-no-background\",\"aria-label\":t.toggleAriaLabel},on:{click:t.toggleSecret},scopedSlots:t._u([{key:\"icon\",fn:function(){return[e(\"EyeOutline\",{attrs:{size:20}})]},proxy:!0}],null,!1,2687940113)}):t._e()],1)]),t._v(\" \"),e(\"td\",{staticClass:\"action-column\"},[e(\"NcButton\",{attrs:{type:\"tertiary-no-background\",\"aria-label\":t.t(\"oauth2\",\"Delete\")},on:{click:function(e){return t.$emit(\"delete\",t.id)}},scopedSlots:t._u([{key:\"icon\",fn:function(){return[e(\"Delete\",{attrs:{size:20,title:t.t(\"oauth2\",\"Delete\")}})]},proxy:!0}])})],1)])}),[],!1,null,\"39c6252a\",null).exports;var O=i(63814),k=i(87485),U=i(88837),B=i(80910),I=i(32981),D=i(82182);const j={name:\"App\",components:{OAuthItem:w,NcSettingsSection:U.A,NcButton:d.A,NcTextField:D.A,NcNoteCard:B.A},props:{clients:{type:Array,required:!0}},data:()=>({newClient:{name:\"\",redirectUri:\"\",errorMsg:\"\",error:!1},oauthDocLink:(0,I.C)(\"oauth2\",\"oauth2-doc-link\"),showSecretWarning:!1}),computed:{instanceName:()=>(0,k.F)().theming.name},methods:{deleteClient(t){o.Ay.delete((0,O.Jv)(\"apps/oauth2/clients/{id}\",{id:t})).then((()=>{this.clients=this.clients.filter((e=>e.id!==t))}))},addClient(){this.newClient.error=!1,o.Ay.post((0,O.Jv)(\"apps/oauth2/clients\"),{name:this.newClient.name,redirectUri:this.newClient.redirectUri}).then((t=>{this.clients.push(t.data),this.showSecretWarning=!0,this.newClient.name=\"\",this.newClient.redirectUri=\"\"})).catch((t=>{this.newClient.error=!0,this.newClient.errorMsg=t.response.data.message}))}}};var T=i(75052),R={};R.styleTagTransform=S(),R.setAttributes=g(),R.insert=v().bind(null,\"head\"),R.domAPI=m(),R.insertStyleElement=b(),p()(T.A,R),T.A&&T.A.locals&&T.A.locals;const M=(0,s.A)(j,(function(){var t=this,e=t._self._c;return e(\"NcSettingsSection\",{attrs:{name:t.t(\"oauth2\",\"OAuth 2.0 clients\"),description:t.t(\"oauth2\",\"OAuth 2.0 allows external services to request access to {instanceName}.\",{instanceName:t.instanceName}),\"doc-url\":t.oauthDocLink}},[t.clients.length>0?e(\"table\",{staticClass:\"grid\"},[e(\"thead\",[e(\"tr\",[e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Name\"))+\"\\n\\t\\t\\t\\t\")]),t._v(\" \"),e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Redirection URI\"))+\"\\n\\t\\t\\t\\t\")]),t._v(\" \"),e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Client Identifier\"))+\"\\n\\t\\t\\t\\t\")]),t._v(\" \"),e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Secret key\"))+\"\\n\\t\\t\\t\\t\")]),t._v(\" \"),e(\"th\",[t._v(\"\\n\\t\\t\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Delete client\"))+\"\\n\\t\\t\\t\\t\")])])]),t._v(\" \"),e(\"tbody\",t._l(t.clients,(function(n){return e(\"OAuthItem\",{key:n.id,attrs:{client:n},on:{delete:t.deleteClient}})})),1)]):t._e(),t._v(\" \"),t.showSecretWarning?e(\"NcNoteCard\",{attrs:{type:\"warning\"}},[t._v(\"\\n\\t\\t\"+t._s(t.t(\"oauth2\",\"Make sure you store the secret key, it cannot be recovered.\"))+\"\\n\\t\")]):t._e(),t._v(\" \"),e(\"br\"),t._v(\" \"),e(\"h3\",[t._v(t._s(t.t(\"oauth2\",\"Add client\")))]),t._v(\" \"),t.newClient.error?e(\"span\",{staticClass:\"msg error\"},[t._v(t._s(t.newClient.errorMsg))]):t._e(),t._v(\" \"),e(\"form\",{staticClass:\"oauth2-form\",on:{submit:function(e){return e.preventDefault(),t.addClient.apply(null,arguments)}}},[e(\"NcTextField\",{staticClass:\"oauth2-form--input\",attrs:{id:\"name\",value:t.newClient.name,type:\"text\",name:\"name\",label:t.t(\"oauth2\",\"Name\"),placeholder:t.t(\"oauth2\",\"Name\")},on:{\"update:value\":function(e){return t.$set(t.newClient,\"name\",e)}}}),t._v(\" \"),e(\"NcTextField\",{staticClass:\"oauth2-form--input\",attrs:{id:\"redirectUri\",value:t.newClient.redirectUri,type:\"url\",name:\"redirectUri\",label:t.t(\"oauth2\",\"Redirection URI\"),placeholder:t.t(\"oauth2\",\"Redirection URI\")},on:{\"update:value\":function(e){return t.$set(t.newClient,\"redirectUri\",e)}}}),t._v(\" \"),e(\"NcButton\",{staticClass:\"inline-button\",attrs:{\"native-type\":\"submit\"}},[t._v(\"\\n\\t\\t\\t\"+t._s(t.t(\"oauth2\",\"Add\"))+\"\\n\\t\\t\")])],1)],1)}),[],!1,null,\"597479ba\",null).exports;r.Ay.prototype.t=t,r.Ay.prototype.OC=OC;const E=(0,I.C)(\"oauth2\",\"clients\");new(r.Ay.extend(M))({propsData:{clients:E}}).$mount(\"#oauth2\")},75052:(t,e,n)=>{n.d(e,{A:()=>l});var i=n(71354),r=n.n(i),o=n(76314),a=n.n(o)()(r());a.push([t.id,\"\\ntable[data-v-597479ba] {\\n\\tmax-width: 800px;\\n}\\n\\n/** Overwrite button height and position to be aligned with the text input */\\n.inline-button[data-v-597479ba] {\\n\\tmin-height: 34px !important;\\n\\tdisplay: inline-flex !important;\\n}\\n.oauth2-form[data-v-597479ba] {\\n\\tdisplay: flex;\\n\\tflex-direction: row;\\n}\\n.oauth2-form--input[data-v-597479ba] {\\n\\tmax-width: 200px;\\n\\tmargin-inline-end: 10px;\\n}\\n\",\"\",{version:3,sources:[\"webpack://./apps/oauth2/src/App.vue\"],names:[],mappings:\";AAgKA;CACA,gBAAA;AACA;;AAEA,4EAAA;AACA;CACA,2BAAA;CACA,+BAAA;AACA;AACA;CACA,aAAA;CACA,mBAAA;AACA;AACA;CACA,gBAAA;CACA,uBAAA;AACA\",sourcesContent:[\"\\x3c!--\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\n--\\x3e\\n<template>\\n\\t<NcSettingsSection :name=\\\"t('oauth2', 'OAuth 2.0 clients')\\\"\\n\\t\\t:description=\\\"t('oauth2', 'OAuth 2.0 allows external services to request access to {instanceName}.', { instanceName })\\\"\\n\\t\\t:doc-url=\\\"oauthDocLink\\\">\\n\\t\\t<table v-if=\\\"clients.length > 0\\\" class=\\\"grid\\\">\\n\\t\\t\\t<thead>\\n\\t\\t\\t\\t<tr>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Name') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Redirection URI') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Client Identifier') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Secret key') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Delete client') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t</tr>\\n\\t\\t\\t</thead>\\n\\t\\t\\t<tbody>\\n\\t\\t\\t\\t<OAuthItem v-for=\\\"client in clients\\\"\\n\\t\\t\\t\\t\\t:key=\\\"client.id\\\"\\n\\t\\t\\t\\t\\t:client=\\\"client\\\"\\n\\t\\t\\t\\t\\t@delete=\\\"deleteClient\\\" />\\n\\t\\t\\t</tbody>\\n\\t\\t</table>\\n\\t\\t<NcNoteCard v-if=\\\"showSecretWarning\\\"\\n\\t\\t\\ttype=\\\"warning\\\">\\n\\t\\t\\t{{ t('oauth2', 'Make sure you store the secret key, it cannot be recovered.') }}\\n\\t\\t</NcNoteCard>\\n\\n\\t\\t<br>\\n\\t\\t<h3>{{ t('oauth2', 'Add client') }}</h3>\\n\\t\\t<span v-if=\\\"newClient.error\\\" class=\\\"msg error\\\">{{ newClient.errorMsg }}</span>\\n\\t\\t<form class=\\\"oauth2-form\\\" @submit.prevent=\\\"addClient\\\">\\n\\t\\t\\t<NcTextField id=\\\"name\\\"\\n\\t\\t\\t\\t:value.sync=\\\"newClient.name\\\"\\n\\t\\t\\t\\ttype=\\\"text\\\"\\n\\t\\t\\t\\tclass=\\\"oauth2-form--input\\\"\\n\\t\\t\\t\\tname=\\\"name\\\"\\n\\t\\t\\t\\t:label=\\\"t('oauth2', 'Name')\\\"\\n\\t\\t\\t\\t:placeholder=\\\"t('oauth2', 'Name')\\\" />\\n\\t\\t\\t<NcTextField id=\\\"redirectUri\\\"\\n\\t\\t\\t\\t:value.sync=\\\"newClient.redirectUri\\\"\\n\\t\\t\\t\\ttype=\\\"url\\\"\\n\\t\\t\\t\\tclass=\\\"oauth2-form--input\\\"\\n\\t\\t\\t\\tname=\\\"redirectUri\\\"\\n\\t\\t\\t\\t:label=\\\"t('oauth2', 'Redirection URI')\\\"\\n\\t\\t\\t\\t:placeholder=\\\"t('oauth2', 'Redirection URI')\\\" />\\n\\t\\t\\t<NcButton native-type=\\\"submit\\\" class=\\\"inline-button\\\">\\n\\t\\t\\t\\t{{ t('oauth2', 'Add') }}\\n\\t\\t\\t</NcButton>\\n\\t\\t</form>\\n\\t</NcSettingsSection>\\n</template>\\n\\n<script>\\nimport axios from '@nextcloud/axios'\\nimport OAuthItem from './components/OAuthItem.vue'\\nimport { generateUrl } from '@nextcloud/router'\\nimport { getCapabilities } from '@nextcloud/capabilities'\\nimport NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\nimport NcNoteCard from '@nextcloud/vue/dist/Components/NcNoteCard.js'\\nimport { loadState } from '@nextcloud/initial-state'\\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\\n\\nexport default {\\n\\tname: 'App',\\n\\tcomponents: {\\n\\t\\tOAuthItem,\\n\\t\\tNcSettingsSection,\\n\\t\\tNcButton,\\n\\t\\tNcTextField,\\n\\t\\tNcNoteCard,\\n\\t},\\n\\tprops: {\\n\\t\\tclients: {\\n\\t\\t\\ttype: Array,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tnewClient: {\\n\\t\\t\\t\\tname: '',\\n\\t\\t\\t\\tredirectUri: '',\\n\\t\\t\\t\\terrorMsg: '',\\n\\t\\t\\t\\terror: false,\\n\\t\\t\\t},\\n\\t\\t\\toauthDocLink: loadState('oauth2', 'oauth2-doc-link'),\\n\\t\\t\\tshowSecretWarning: false,\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\tinstanceName() {\\n\\t\\t\\treturn getCapabilities().theming.name\\n\\t\\t},\\n\\t},\\n\\tmethods: {\\n\\t\\tdeleteClient(id) {\\n\\t\\t\\taxios.delete(generateUrl('apps/oauth2/clients/{id}', { id }))\\n\\t\\t\\t\\t.then(() => {\\n\\t\\t\\t\\t\\t// eslint-disable-next-line vue/no-mutating-props\\n\\t\\t\\t\\t\\tthis.clients = this.clients.filter(client => client.id !== id)\\n\\t\\t\\t\\t})\\n\\t\\t},\\n\\t\\taddClient() {\\n\\t\\t\\tthis.newClient.error = false\\n\\n\\t\\t\\taxios.post(\\n\\t\\t\\t\\tgenerateUrl('apps/oauth2/clients'),\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tname: this.newClient.name,\\n\\t\\t\\t\\t\\tredirectUri: this.newClient.redirectUri,\\n\\t\\t\\t\\t},\\n\\t\\t\\t).then(response => {\\n\\t\\t\\t\\t// eslint-disable-next-line vue/no-mutating-props\\n\\t\\t\\t\\tthis.clients.push(response.data)\\n\\t\\t\\t\\tthis.showSecretWarning = true\\n\\n\\t\\t\\t\\tthis.newClient.name = ''\\n\\t\\t\\t\\tthis.newClient.redirectUri = ''\\n\\t\\t\\t}).catch(reason => {\\n\\t\\t\\t\\tthis.newClient.error = true\\n\\t\\t\\t\\tthis.newClient.errorMsg = reason.response.data.message\\n\\t\\t\\t})\\n\\t\\t},\\n\\t},\\n}\\n<\\/script>\\n<style scoped>\\n\\ttable {\\n\\t\\tmax-width: 800px;\\n\\t}\\n\\n\\t/** Overwrite button height and position to be aligned with the text input */\\n\\t.inline-button {\\n\\t\\tmin-height: 34px !important;\\n\\t\\tdisplay: inline-flex !important;\\n\\t}\\n\\t.oauth2-form {\\n\\t\\tdisplay: flex;\\n\\t\\tflex-direction: row;\\n\\t}\\n\\t.oauth2-form--input {\\n\\t\\tmax-width: 200px;\\n\\t\\tmargin-inline-end: 10px;\\n\\t}\\n</style>\\n\"],sourceRoot:\"\"}]);const l=a},30677:(t,e,n)=>{n.d(e,{A:()=>l});var i=n(71354),r=n.n(i),o=n(76314),a=n.n(o)()(r());a.push([t.id,\"\\n.action-secret[data-v-39c6252a] {\\n\\tdisplay: flex;\\n\\talign-items: center;\\n}\\n.action-secret code[data-v-39c6252a] {\\n\\tpadding-top: 5px;\\n}\\ntd code[data-v-39c6252a] {\\n\\tdisplay: inline-block;\\n\\tvertical-align: middle;\\n}\\ntable.inline td[data-v-39c6252a] {\\n\\tborder: none;\\n\\tpadding: 5px;\\n}\\n.action-column[data-v-39c6252a] {\\n\\tdisplay: flex;\\n\\tjustify-content: flex-end;\\n\\tpadding-inline-end: 0;\\n}\\n\",\"\",{version:3,sources:[\"webpack://./apps/oauth2/src/components/OAuthItem.vue\"],names:[],mappings:\";AA+GA;CACA,aAAA;CACA,mBAAA;AACA;AACA;CACA,gBAAA;AACA;AACA;CACA,qBAAA;CACA,sBAAA;AACA;AACA;CACA,YAAA;CACA,YAAA;AACA;AAEA;CACA,aAAA;CACA,yBAAA;CACA,qBAAA;AACA\",sourcesContent:[\"\\x3c!--\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\n--\\x3e\\n<template>\\n\\t<tr>\\n\\t\\t<td>{{ name }}</td>\\n\\t\\t<td>{{ redirectUri }}</td>\\n\\t\\t<td><code>{{ clientId }}</code></td>\\n\\t\\t<td>\\n\\t\\t\\t<div class=\\\"action-secret\\\">\\n\\t\\t\\t\\t<code>{{ renderedSecret }}</code>\\n\\t\\t\\t\\t<NcButton v-if=\\\"clientSecret !== ''\\\"\\n\\t\\t\\t\\t\\ttype=\\\"tertiary-no-background\\\"\\n\\t\\t\\t\\t\\t:aria-label=\\\"toggleAriaLabel\\\"\\n\\t\\t\\t\\t\\t@click=\\\"toggleSecret\\\">\\n\\t\\t\\t\\t\\t<template #icon>\\n\\t\\t\\t\\t\\t\\t<EyeOutline :size=\\\"20\\\" />\\n\\t\\t\\t\\t\\t</template>\\n\\t\\t\\t\\t</NcButton>\\n\\t\\t\\t</div>\\n\\t\\t</td>\\n\\t\\t<td class=\\\"action-column\\\">\\n\\t\\t\\t<NcButton type=\\\"tertiary-no-background\\\"\\n\\t\\t\\t\\t:aria-label=\\\"t('oauth2', 'Delete')\\\"\\n\\t\\t\\t\\t@click=\\\"$emit('delete', id)\\\">\\n\\t\\t\\t\\t<template #icon>\\n\\t\\t\\t\\t\\t<Delete :size=\\\"20\\\"\\n\\t\\t\\t\\t\\t\\t:title=\\\"t('oauth2', 'Delete')\\\" />\\n\\t\\t\\t\\t</template>\\n\\t\\t\\t</NcButton>\\n\\t\\t</td>\\n\\t</tr>\\n</template>\\n\\n<script>\\n\\nimport Delete from 'vue-material-design-icons/Delete.vue'\\nimport EyeOutline from 'vue-material-design-icons/EyeOutline.vue'\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\n\\nexport default {\\n\\tname: 'OAuthItem',\\n\\tcomponents: {\\n\\t\\tDelete,\\n\\t\\tNcButton,\\n\\t\\tEyeOutline,\\n\\t},\\n\\tprops: {\\n\\t\\tclient: {\\n\\t\\t\\ttype: Object,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tid: this.client.id,\\n\\t\\t\\tname: this.client.name,\\n\\t\\t\\tredirectUri: this.client.redirectUri,\\n\\t\\t\\tclientId: this.client.clientId,\\n\\t\\t\\tclientSecret: this.client.clientSecret,\\n\\t\\t\\trenderSecret: false,\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\trenderedSecret() {\\n\\t\\t\\tif (this.renderSecret) {\\n\\t\\t\\t\\treturn this.clientSecret\\n\\t\\t\\t} else {\\n\\t\\t\\t\\treturn '****'\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\ttoggleAriaLabel() {\\n\\t\\t\\tif (!this.renderSecret) {\\n\\t\\t\\t\\treturn t('oauth2', 'Show client secret')\\n\\t\\t\\t}\\n\\t\\t\\treturn t('oauth2', 'Hide client secret')\\n\\t\\t},\\n\\t},\\n\\tmethods: {\\n\\t\\ttoggleSecret() {\\n\\t\\t\\tthis.renderSecret = !this.renderSecret\\n\\t\\t},\\n\\t},\\n}\\n<\\/script>\\n\\n<style scoped>\\n\\t.action-secret {\\n\\t\\tdisplay: flex;\\n\\t\\talign-items: center;\\n\\t}\\n\\t.action-secret code {\\n\\t\\tpadding-top: 5px;\\n\\t}\\n\\ttd code {\\n\\t\\tdisplay: inline-block;\\n\\t\\tvertical-align: middle;\\n\\t}\\n\\ttable.inline td {\\n\\t\\tborder: none;\\n\\t\\tpadding: 5px;\\n\\t}\\n\\n\\t.action-column {\\n\\t\\tdisplay: flex;\\n\\t\\tjustify-content: flex-end;\\n\\t\\tpadding-inline-end: 0;\\n\\t}\\n</style>\\n\"],sourceRoot:\"\"}]);const l=a}},i={};function r(t){var e=i[t];if(void 0!==e)return e.exports;var o=i[t]={id:t,loaded:!1,exports:{}};return n[t].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.m=n,e=[],r.O=(t,n,i,o)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){n=e[d][0],i=e[d][1],o=e[d][2];for(var l=!0,s=0;s<n.length;s++)(!1&o||a>=o)&&Object.keys(r.O).every((t=>r.O[t](n[s])))?n.splice(s--,1):(l=!1,o<a&&(a=o));if(l){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,i,o]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.e=()=>Promise.resolve(),r.g=function(){if(\"object\"==typeof globalThis)return globalThis;try{return this||new Function(\"return this\")()}catch(t){if(\"object\"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},r.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),r.j=6174,(()=>{r.b=document.baseURI||self.location.href;var t={6174:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var i,o,a=n[0],l=n[1],s=n[2],c=0;if(a.some((e=>0!==t[e]))){for(i in l)r.o(l,i)&&(r.m[i]=l[i]);if(s)var d=s(r)}for(e&&e(n);c<a.length;c++)o=a[c],r.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return r.O(d)},n=self.webpackChunknextcloud=self.webpackChunknextcloud||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),r.nc=void 0;var o=r.O(void 0,[4208],(()=>r(99747)));o=r.O(o)})();\n+//# sourceMappingURL=oauth2-oauth2.js.map?v=516002dd0d2ee3ebfd7d\n\\ No newline at end of file"
            },
            {
                "sha": "49b93ac53b2212e10d8dbf9de26b15c884485714",
                "filename": "dist/oauth2-oauth2.js.map",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/nextcloud/server/blob/09b8aea8f6783514bffe00df6abbf9fa542faac5/dist%2Foauth2-oauth2.js.map",
                "raw_url": "https://github.com/nextcloud/server/raw/09b8aea8f6783514bffe00df6abbf9fa542faac5/dist%2Foauth2-oauth2.js.map",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/dist%2Foauth2-oauth2.js.map?ref=09b8aea8f6783514bffe00df6abbf9fa542faac5",
                "patch": "@@ -1 +1 @@\n-{\"version\":3,\"file\":\"oauth2-oauth2.js?v=14be3bd736d990a0e63e\",\"mappings\":\"uBAAIA,E,wDCoBJ,MCpB6G,EDoB7G,CACEC,KAAM,iBACNC,MAAO,CAAC,SACRC,MAAO,CACLC,MAAO,CACLC,KAAMC,QAERC,UAAW,CACTF,KAAMC,OACNE,QAAS,gBAEXC,KAAM,CACJJ,KAAMK,OACNF,QAAS,M,eEff,SAXgB,OACd,GCRW,WAAkB,IAAIG,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,OAAOF,EAAII,GAAG,CAACC,YAAY,wCAAwCC,MAAM,CAAC,eAAcN,EAAIP,OAAQ,KAAY,aAAaO,EAAIP,MAAM,KAAO,OAAOc,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOR,EAAIS,MAAM,QAASD,EAAO,IAAI,OAAOR,EAAIU,QAAO,GAAO,CAACR,EAAG,MAAM,CAACG,YAAY,4BAA4BC,MAAM,CAAC,KAAON,EAAIJ,UAAU,MAAQI,EAAIF,KAAK,OAASE,EAAIF,KAAK,QAAU,cAAc,CAACI,EAAG,OAAO,CAACI,MAAM,CAAC,EAAI,8SAA8S,CAAEN,EAAS,MAAEE,EAAG,QAAQ,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIP,UAAUO,EAAIa,UAC9zB,GACsB,IDSpB,EACA,KACA,KACA,MAI8B,Q,eEsBhC,MCxCqL,EDwCrL,CACAvB,KAAA,YACAwB,WAAA,CACAC,OAAA,IACAC,SAAA,IACAC,WAAAA,GAEAzB,MAAA,CACA0B,OAAA,CACAxB,KAAAyB,OACAC,UAAA,IAGAC,IAAAA,GACA,OACAC,GAAA,KAAAJ,OAAAI,GACAhC,KAAA,KAAA4B,OAAA5B,KACAiC,YAAA,KAAAL,OAAAK,YACAC,SAAA,KAAAN,OAAAM,SACAC,aAAA,KAAAP,OAAAO,aACAC,cAAA,EAEA,EACAC,SAAA,CACAC,cAAAA,GACA,YAAAF,aACA,KAAAD,aAEA,MAEA,EACAI,eAAAA,GACA,YAAAH,aAGAI,EAAA,+BAFAA,EAAA,8BAGA,GAEAC,QAAA,CACAC,YAAAA,GACA,KAAAN,cAAA,KAAAA,YACA,I,uIEtEIO,EAAU,CAAC,EAEfA,EAAQC,kBAAoB,IAC5BD,EAAQE,cAAgB,IAElBF,EAAQG,OAAS,SAAc,KAAM,QAE3CH,EAAQI,OAAS,IACjBJ,EAAQK,mBAAqB,IAEhB,IAAI,IAASL,GAKJ,KAAW,IAAQM,QAAS,IAAQA,OCP1D,SAXgB,OACd,GCTW,WAAkB,IAAIvC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,KAAK,CAACA,EAAG,KAAK,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIV,SAASU,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIuB,gBAAgBvB,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACA,EAAG,OAAO,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIwB,eAAexB,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACA,EAAG,MAAM,CAACG,YAAY,iBAAiB,CAACH,EAAG,OAAO,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAI4B,mBAAmB5B,EAAIW,GAAG,KAAKT,EAAG,WAAW,CAACI,MAAM,CAAC,KAAO,yBAAyB,aAAaN,EAAI6B,iBAAiBtB,GAAG,CAAC,MAAQP,EAAIgC,cAAcQ,YAAYxC,EAAIyC,GAAG,CAAC,CAACC,IAAI,OAAOC,GAAG,WAAW,MAAO,CAACzC,EAAG,aAAa,CAACI,MAAM,CAAC,KAAO,MAAM,EAAEsC,OAAM,QAAW,KAAK5C,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACG,YAAY,iBAAiB,CAACH,EAAG,WAAW,CAACI,MAAM,CAAC,KAAO,yBAAyB,aAAaN,EAAI8B,EAAE,SAAU,WAAWvB,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOR,EAAIS,MAAM,SAAUT,EAAIsB,GAAG,GAAGkB,YAAYxC,EAAIyC,GAAG,CAAC,CAACC,IAAI,OAAOC,GAAG,WAAW,MAAO,CAACzC,EAAG,SAAS,CAACI,MAAM,CAAC,KAAO,GAAG,MAAQN,EAAI8B,EAAE,SAAU,aAAa,EAAEc,OAAM,QAAW,IACz6B,GACsB,IDUpB,EACA,KACA,WACA,MAI8B,Q,2DEoDhC,MCvEyK,EDuEzK,CACAtD,KAAA,MACAwB,WAAA,CACA+B,UAAA,EACAC,kBAAA,IACA9B,SAAA,IACA+B,YAAAA,EAAAA,GAEAvD,MAAA,CACAwD,QAAA,CACAtD,KAAAuD,MACA7B,UAAA,IAGAC,KAAAA,KACA,CACA6B,UAAA,CACA5D,KAAA,GACAiC,YAAA,GACA4B,SAAA,GACAC,OAAA,GAEAC,cAAAC,EAAAA,EAAAA,GAAA,8BAGA3B,SAAA,CACA4B,aAAAA,KACAC,EAAAA,EAAAA,KAAAC,QAAAnE,MAGAyC,QAAA,CACA2B,YAAAA,CAAApC,GACAqC,EAAAA,GAAAC,QAAAC,EAAAA,EAAAA,IAAA,4BAAAvC,QACAwC,MAAA,KAEA,KAAAd,QAAA,KAAAA,QAAAe,QAAA7C,GAAAA,EAAAI,KAAAA,GAAA,GAEA,EACA0C,SAAAA,GACA,KAAAd,UAAAE,OAAA,EAEAO,EAAAA,GAAAM,MACAJ,EAAAA,EAAAA,IAAA,uBACA,CACAvE,KAAA,KAAA4D,UAAA5D,KACAiC,YAAA,KAAA2B,UAAA3B,cAEAuC,MAAAI,IAEA,KAAAlB,QAAAmB,KAAAD,EAAA7C,MAEA,KAAA6B,UAAA5D,KAAA,GACA,KAAA4D,UAAA3B,YAAA,MACA6C,OAAAC,IACA,KAAAnB,UAAAE,OAAA,EACA,KAAAF,UAAAC,SAAAkB,EAAAH,SAAA7C,KAAAiD,OAAA,GAEA,I,eErHI,EAAU,CAAC,EAEf,EAAQpC,kBAAoB,IAC5B,EAAQC,cAAgB,IAElB,EAAQC,OAAS,SAAc,KAAM,QAE3C,EAAQC,OAAS,IACjB,EAAQC,mBAAqB,IAEhB,IAAI,IAAS,GAKJ,KAAW,IAAQC,QAAS,IAAQA,OCP1D,SAXgB,OACd,GCTW,WAAkB,IAAIvC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,oBAAoB,CAACI,MAAM,CAAC,KAAON,EAAI8B,EAAE,SAAU,qBAAqB,YAAc9B,EAAI8B,EAAE,SAAU,0EAA2E,CAAEyB,aAAcvD,EAAIuD,eAAgB,UAAUvD,EAAIqD,eAAe,CAAErD,EAAIgD,QAAQuB,OAAS,EAAGrE,EAAG,QAAQ,CAACG,YAAY,QAAQ,CAACH,EAAG,QAAQ,CAACA,EAAG,KAAK,CAACA,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,SAAS,gBAAgB9B,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,oBAAoB,gBAAgB9B,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,sBAAsB,gBAAgB9B,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,eAAe,gBAAgB9B,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,kBAAkB,oBAAoB9B,EAAIW,GAAG,KAAKT,EAAG,QAAQF,EAAIwE,GAAIxE,EAAIgD,SAAS,SAAS9B,GAAQ,OAAOhB,EAAG,YAAY,CAACwC,IAAIxB,EAAOI,GAAGhB,MAAM,CAAC,OAASY,GAAQX,GAAG,CAAC,OAASP,EAAI0D,eAAe,IAAG,KAAK1D,EAAIa,KAAKb,EAAIW,GAAG,KAAKT,EAAG,MAAMF,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,kBAAkB9B,EAAIW,GAAG,KAAMX,EAAIkD,UAAUE,MAAOlD,EAAG,OAAO,CAACG,YAAY,aAAa,CAACL,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIkD,UAAUC,aAAanD,EAAIa,KAAKb,EAAIW,GAAG,KAAKT,EAAG,OAAO,CAACG,YAAY,cAAcE,GAAG,CAAC,OAAS,SAASC,GAAgC,OAAxBA,EAAOiE,iBAAwBzE,EAAIgE,UAAUU,MAAM,KAAMC,UAAU,IAAI,CAACzE,EAAG,cAAc,CAACG,YAAY,qBAAqBC,MAAM,CAAC,GAAK,OAAO,MAAQN,EAAIkD,UAAU5D,KAAK,KAAO,OAAO,KAAO,OAAO,MAAQU,EAAI8B,EAAE,SAAU,QAAQ,YAAc9B,EAAI8B,EAAE,SAAU,SAASvB,GAAG,CAAC,eAAe,SAASC,GAAQ,OAAOR,EAAI4E,KAAK5E,EAAIkD,UAAW,OAAQ1C,EAAO,KAAKR,EAAIW,GAAG,KAAKT,EAAG,cAAc,CAACG,YAAY,qBAAqBC,MAAM,CAAC,GAAK,cAAc,MAAQN,EAAIkD,UAAU3B,YAAY,KAAO,MAAM,KAAO,cAAc,MAAQvB,EAAI8B,EAAE,SAAU,mBAAmB,YAAc9B,EAAI8B,EAAE,SAAU,oBAAoBvB,GAAG,CAAC,eAAe,SAASC,GAAQ,OAAOR,EAAI4E,KAAK5E,EAAIkD,UAAW,cAAe1C,EAAO,KAAKR,EAAIW,GAAG,KAAKT,EAAG,WAAW,CAACG,YAAY,gBAAgBC,MAAM,CAAC,cAAc,WAAW,CAACN,EAAIW,GAAG,WAAWX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,QAAQ,aAAa,IAC5oE,GACsB,IDUpB,EACA,KACA,WACA,MAI8B,QEVhC+C,EAAAA,GAAIC,UAAUhD,EAAIA,EAClB+C,EAAAA,GAAIC,UAAUC,GAAKA,GAEnB,MAAM/B,GAAUM,EAAAA,EAAAA,GAAU,SAAU,WAGtB,IADDuB,EAAAA,GAAIG,OAAOC,GACV,CAAS,CACtBC,UAAW,CACVlC,aAGImC,OAAO,U,sECjBTC,E,MAA0B,GAA4B,KAE1DA,EAAwBjB,KAAK,CAACkB,EAAO/D,GAAI,4ZAkBtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,uCAAuC,MAAQ,GAAG,SAAW,oIAAoI,eAAiB,CAAC,utIAAgtI,WAAa,MAE98I,S,sECtBI8D,E,MAA0B,GAA4B,KAE1DA,EAAwBjB,KAAK,CAACkB,EAAO/D,GAAI,kaAqBtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,wDAAwD,MAAQ,GAAG,SAAW,gKAAgK,eAAiB,CAAC,g7EAAy6E,WAAa,MAEptF,S,GC3BIgE,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaE,QAGrB,IAAIN,EAASC,EAAyBE,GAAY,CACjDlE,GAAIkE,EACJI,QAAQ,EACRD,QAAS,CAAC,GAUX,OANAE,EAAoBL,GAAUM,KAAKT,EAAOM,QAASN,EAAQA,EAAOM,QAASJ,GAG3EF,EAAOO,QAAS,EAGTP,EAAOM,OACf,CAGAJ,EAAoBQ,EAAIF,ElB5BpBxG,EAAW,GACfkG,EAAoBS,EAAI,CAACC,EAAQC,EAAUvD,EAAIwD,KAC9C,IAAGD,EAAH,CAMA,IAAIE,EAAeC,IACnB,IAASC,EAAI,EAAGA,EAAIjH,EAASkF,OAAQ+B,IAAK,CACrCJ,EAAW7G,EAASiH,GAAG,GACvB3D,EAAKtD,EAASiH,GAAG,GACjBH,EAAW9G,EAASiH,GAAG,GAE3B,IAJA,IAGIC,GAAY,EACPC,EAAI,EAAGA,EAAIN,EAAS3B,OAAQiC,MACpB,EAAXL,GAAsBC,GAAgBD,IAAahF,OAAOsF,KAAKlB,EAAoBS,GAAGU,OAAOhE,GAAS6C,EAAoBS,EAAEtD,GAAKwD,EAASM,MAC9IN,EAASS,OAAOH,IAAK,IAErBD,GAAY,EACTJ,EAAWC,IAAcA,EAAeD,IAG7C,GAAGI,EAAW,CACblH,EAASsH,OAAOL,IAAK,GACrB,IAAIM,EAAIjE,SACE+C,IAANkB,IAAiBX,EAASW,EAC/B,CACD,CACA,OAAOX,CArBP,CAJCE,EAAWA,GAAY,EACvB,IAAI,IAAIG,EAAIjH,EAASkF,OAAQ+B,EAAI,GAAKjH,EAASiH,EAAI,GAAG,GAAKH,EAAUG,IAAKjH,EAASiH,GAAKjH,EAASiH,EAAI,GACrGjH,EAASiH,GAAK,CAACJ,EAAUvD,EAAIwD,EAuBjB,EmB3BdZ,EAAoBsB,EAAKxB,IACxB,IAAIyB,EAASzB,GAAUA,EAAO0B,WAC7B,IAAO1B,EAAiB,QACxB,IAAM,EAEP,OADAE,EAAoByB,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,CAAM,ECLdvB,EAAoByB,EAAI,CAACrB,EAASuB,KACjC,IAAI,IAAIxE,KAAOwE,EACX3B,EAAoB4B,EAAED,EAAYxE,KAAS6C,EAAoB4B,EAAExB,EAASjD,IAC5EvB,OAAOiG,eAAezB,EAASjD,EAAK,CAAE2E,YAAY,EAAMC,IAAKJ,EAAWxE,IAE1E,ECHD6C,EAAoBgC,EAAI,IAAOC,QAAQC,UCHvClC,EAAoBmC,EAAI,WACvB,GAA0B,iBAAfC,WAAyB,OAAOA,WAC3C,IACC,OAAO1H,MAAQ,IAAI2H,SAAS,cAAb,EAChB,CAAE,MAAOL,GACR,GAAsB,iBAAXM,OAAqB,OAAOA,MACxC,CACA,CAPuB,GCAxBtC,EAAoB4B,EAAI,CAACW,EAAKC,IAAU5G,OAAO2D,UAAUkD,eAAelC,KAAKgC,EAAKC,GCClFxC,EAAoBqB,EAAKjB,IACH,oBAAXsC,QAA0BA,OAAOC,aAC1C/G,OAAOiG,eAAezB,EAASsC,OAAOC,YAAa,CAAEC,MAAO,WAE7DhH,OAAOiG,eAAezB,EAAS,aAAc,CAAEwC,OAAO,GAAO,ECL9D5C,EAAoB6C,IAAO/C,IAC1BA,EAAOgD,MAAQ,GACVhD,EAAOiD,WAAUjD,EAAOiD,SAAW,IACjCjD,GCHRE,EAAoBiB,EAAI,K,MCAxBjB,EAAoBgD,EAAIC,SAASC,SAAWC,KAAKC,SAASC,KAK1D,IAAIC,EAAkB,CACrB,KAAM,GAaPtD,EAAoBS,EAAEQ,EAAKsC,GAA0C,IAA7BD,EAAgBC,GAGxD,IAAIC,EAAuB,CAACC,EAA4B3H,KACvD,IAKImE,EAAUsD,EALV5C,EAAW7E,EAAK,GAChB4H,EAAc5H,EAAK,GACnB6H,EAAU7H,EAAK,GAGIiF,EAAI,EAC3B,GAAGJ,EAASiD,MAAM7H,GAAgC,IAAxBuH,EAAgBvH,KAAa,CACtD,IAAIkE,KAAYyD,EACZ1D,EAAoB4B,EAAE8B,EAAazD,KACrCD,EAAoBQ,EAAEP,GAAYyD,EAAYzD,IAGhD,GAAG0D,EAAS,IAAIjD,EAASiD,EAAQ3D,EAClC,CAEA,IADGyD,GAA4BA,EAA2B3H,GACrDiF,EAAIJ,EAAS3B,OAAQ+B,IACzBwC,EAAU5C,EAASI,GAChBf,EAAoB4B,EAAE0B,EAAiBC,IAAYD,EAAgBC,IACrED,EAAgBC,GAAS,KAE1BD,EAAgBC,GAAW,EAE5B,OAAOvD,EAAoBS,EAAEC,EAAO,EAGjCmD,EAAqBV,KAA4B,sBAAIA,KAA4B,uBAAK,GAC1FU,EAAmBC,QAAQN,EAAqBO,KAAK,KAAM,IAC3DF,EAAmBjF,KAAO4E,EAAqBO,KAAK,KAAMF,EAAmBjF,KAAKmF,KAAKF,G,KClDvF7D,EAAoBgE,QAAK7D,ECGzB,IAAI8D,EAAsBjE,EAAoBS,OAAEN,EAAW,CAAC,OAAO,IAAOH,EAAoB,SAC9FiE,EAAsBjE,EAAoBS,EAAEwD,E\",\"sources\":[\"webpack:///nextcloud/webpack/runtime/chunk loaded\",\"webpack:///nextcloud/node_modules/vue-material-design-icons/EyeOutline.vue\",\"webpack:///nextcloud/node_modules/vue-material-design-icons/EyeOutline.vue?vue&type=script&lang=js\",\"webpack://nextcloud/./node_modules/vue-material-design-icons/EyeOutline.vue?9ce8\",\"webpack:///nextcloud/node_modules/vue-material-design-icons/EyeOutline.vue?vue&type=template&id=30219a41\",\"webpack:///nextcloud/apps/oauth2/src/components/OAuthItem.vue\",\"webpack:///nextcloud/apps/oauth2/src/components/OAuthItem.vue?vue&type=script&lang=js\",\"webpack://nextcloud/./apps/oauth2/src/components/OAuthItem.vue?f371\",\"webpack://nextcloud/./apps/oauth2/src/components/OAuthItem.vue?7546\",\"webpack://nextcloud/./apps/oauth2/src/components/OAuthItem.vue?098f\",\"webpack:///nextcloud/apps/oauth2/src/App.vue\",\"webpack:///nextcloud/apps/oauth2/src/App.vue?vue&type=script&lang=js\",\"webpack://nextcloud/./apps/oauth2/src/App.vue?cf69\",\"webpack://nextcloud/./apps/oauth2/src/App.vue?8831\",\"webpack://nextcloud/./apps/oauth2/src/App.vue?40c9\",\"webpack:///nextcloud/apps/oauth2/src/main.js\",\"webpack:///nextcloud/apps/oauth2/src/App.vue?vue&type=style&index=0&id=4edab9ab&prod&scoped=true&lang=css\",\"webpack:///nextcloud/apps/oauth2/src/components/OAuthItem.vue?vue&type=style&index=0&id=cfb38ebe&prod&scoped=true&lang=css\",\"webpack:///nextcloud/webpack/bootstrap\",\"webpack:///nextcloud/webpack/runtime/compat get default export\",\"webpack:///nextcloud/webpack/runtime/define property getters\",\"webpack:///nextcloud/webpack/runtime/ensure chunk\",\"webpack:///nextcloud/webpack/runtime/global\",\"webpack:///nextcloud/webpack/runtime/hasOwnProperty shorthand\",\"webpack:///nextcloud/webpack/runtime/make namespace object\",\"webpack:///nextcloud/webpack/runtime/node module decorator\",\"webpack:///nextcloud/webpack/runtime/runtimeId\",\"webpack:///nextcloud/webpack/runtime/jsonp chunk loading\",\"webpack:///nextcloud/webpack/runtime/nonce\",\"webpack:///nextcloud/webpack/startup\"],\"sourcesContent\":[\"var deferred = [];\\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\\n\\tif(chunkIds) {\\n\\t\\tpriority = priority || 0;\\n\\t\\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\\n\\t\\tdeferred[i] = [chunkIds, fn, priority];\\n\\t\\treturn;\\n\\t}\\n\\tvar notFulfilled = Infinity;\\n\\tfor (var i = 0; i < deferred.length; i++) {\\n\\t\\tvar chunkIds = deferred[i][0];\\n\\t\\tvar fn = deferred[i][1];\\n\\t\\tvar priority = deferred[i][2];\\n\\t\\tvar fulfilled = true;\\n\\t\\tfor (var j = 0; j < chunkIds.length; j++) {\\n\\t\\t\\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\\n\\t\\t\\t\\tchunkIds.splice(j--, 1);\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tfulfilled = false;\\n\\t\\t\\t\\tif(priority < notFulfilled) notFulfilled = priority;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif(fulfilled) {\\n\\t\\t\\tdeferred.splice(i--, 1)\\n\\t\\t\\tvar r = fn();\\n\\t\\t\\tif (r !== undefined) result = r;\\n\\t\\t}\\n\\t}\\n\\treturn result;\\n};\",\"<template>\\n  <span v-bind=\\\"$attrs\\\"\\n        :aria-hidden=\\\"title ? null : true\\\"\\n        :aria-label=\\\"title\\\"\\n        class=\\\"material-design-icon eye-outline-icon\\\"\\n        role=\\\"img\\\"\\n        @click=\\\"$emit('click', $event)\\\">\\n    <svg :fill=\\\"fillColor\\\"\\n         class=\\\"material-design-icon__svg\\\"\\n         :width=\\\"size\\\"\\n         :height=\\\"size\\\"\\n         viewBox=\\\"0 0 24 24\\\">\\n      <path d=\\\"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z\\\">\\n        <title v-if=\\\"title\\\">{{ title }}</title>\\n      </path>\\n    </svg>\\n  </span>\\n</template>\\n\\n<script>\\nexport default {\\n  name: \\\"EyeOutlineIcon\\\",\\n  emits: ['click'],\\n  props: {\\n    title: {\\n      type: String,\\n    },\\n    fillColor: {\\n      type: String,\\n      default: \\\"currentColor\\\"\\n    },\\n    size: {\\n      type: Number,\\n      default: 24\\n    }\\n  }\\n}\\n</script>\",\"import mod from \\\"-!../vue-loader/lib/index.js??vue-loader-options!./EyeOutline.vue?vue&type=script&lang=js\\\"; export default mod; export * from \\\"-!../vue-loader/lib/index.js??vue-loader-options!./EyeOutline.vue?vue&type=script&lang=js\\\"\",\"import { render, staticRenderFns } from \\\"./EyeOutline.vue?vue&type=template&id=30219a41\\\"\\nimport script from \\\"./EyeOutline.vue?vue&type=script&lang=js\\\"\\nexport * from \\\"./EyeOutline.vue?vue&type=script&lang=js\\\"\\n\\n\\n/* normalize component */\\nimport normalizer from \\\"!../vue-loader/lib/runtime/componentNormalizer.js\\\"\\nvar component = normalizer(\\n  script,\\n  render,\\n  staticRenderFns,\\n  false,\\n  null,\\n  null,\\n  null\\n  \\n)\\n\\nexport default component.exports\",\"var render = function render(){var _vm=this,_c=_vm._self._c;return _c('span',_vm._b({staticClass:\\\"material-design-icon eye-outline-icon\\\",attrs:{\\\"aria-hidden\\\":_vm.title ? null : true,\\\"aria-label\\\":_vm.title,\\\"role\\\":\\\"img\\\"},on:{\\\"click\\\":function($event){return _vm.$emit('click', $event)}}},'span',_vm.$attrs,false),[_c('svg',{staticClass:\\\"material-design-icon__svg\\\",attrs:{\\\"fill\\\":_vm.fillColor,\\\"width\\\":_vm.size,\\\"height\\\":_vm.size,\\\"viewBox\\\":\\\"0 0 24 24\\\"}},[_c('path',{attrs:{\\\"d\\\":\\\"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z\\\"}},[(_vm.title)?_c('title',[_vm._v(_vm._s(_vm.title))]):_vm._e()])])])\\n}\\nvar staticRenderFns = []\\n\\nexport { render, staticRenderFns }\",\"<!--\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\n-->\\n<template>\\n\\t<tr>\\n\\t\\t<td>{{ name }}</td>\\n\\t\\t<td>{{ redirectUri }}</td>\\n\\t\\t<td><code>{{ clientId }}</code></td>\\n\\t\\t<td>\\n\\t\\t\\t<div class=\\\"action-secret\\\">\\n\\t\\t\\t\\t<code>{{ renderedSecret }}</code>\\n\\t\\t\\t\\t<NcButton type=\\\"tertiary-no-background\\\"\\n\\t\\t\\t\\t\\t:aria-label=\\\"toggleAriaLabel\\\"\\n\\t\\t\\t\\t\\t@click=\\\"toggleSecret\\\">\\n\\t\\t\\t\\t\\t<template #icon>\\n\\t\\t\\t\\t\\t\\t<EyeOutline :size=\\\"20\\\" />\\n\\t\\t\\t\\t\\t</template>\\n\\t\\t\\t\\t</NcButton>\\n\\t\\t\\t</div>\\n\\t\\t</td>\\n\\t\\t<td class=\\\"action-column\\\">\\n\\t\\t\\t<NcButton type=\\\"tertiary-no-background\\\"\\n\\t\\t\\t\\t:aria-label=\\\"t('oauth2', 'Delete')\\\"\\n\\t\\t\\t\\t@click=\\\"$emit('delete', id)\\\">\\n\\t\\t\\t\\t<template #icon>\\n\\t\\t\\t\\t\\t<Delete :size=\\\"20\\\"\\n\\t\\t\\t\\t\\t\\t:title=\\\"t('oauth2', 'Delete')\\\" />\\n\\t\\t\\t\\t</template>\\n\\t\\t\\t</NcButton>\\n\\t\\t</td>\\n\\t</tr>\\n</template>\\n\\n<script>\\n\\nimport Delete from 'vue-material-design-icons/Delete.vue'\\nimport EyeOutline from 'vue-material-design-icons/EyeOutline.vue'\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\n\\nexport default {\\n\\tname: 'OAuthItem',\\n\\tcomponents: {\\n\\t\\tDelete,\\n\\t\\tNcButton,\\n\\t\\tEyeOutline,\\n\\t},\\n\\tprops: {\\n\\t\\tclient: {\\n\\t\\t\\ttype: Object,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tid: this.client.id,\\n\\t\\t\\tname: this.client.name,\\n\\t\\t\\tredirectUri: this.client.redirectUri,\\n\\t\\t\\tclientId: this.client.clientId,\\n\\t\\t\\tclientSecret: this.client.clientSecret,\\n\\t\\t\\trenderSecret: false,\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\trenderedSecret() {\\n\\t\\t\\tif (this.renderSecret) {\\n\\t\\t\\t\\treturn this.clientSecret\\n\\t\\t\\t} else {\\n\\t\\t\\t\\treturn '****'\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\ttoggleAriaLabel() {\\n\\t\\t\\tif (!this.renderSecret) {\\n\\t\\t\\t\\treturn t('oauth2', 'Show client secret')\\n\\t\\t\\t}\\n\\t\\t\\treturn t('oauth2', 'Hide client secret')\\n\\t\\t},\\n\\t},\\n\\tmethods: {\\n\\t\\ttoggleSecret() {\\n\\t\\t\\tthis.renderSecret = !this.renderSecret\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n\\n<style scoped>\\n\\t.action-secret {\\n\\t\\tdisplay: flex;\\n\\t\\talign-items: center;\\n\\t}\\n\\t.action-secret code {\\n\\t\\tpadding-top: 5px;\\n\\t}\\n\\ttd code {\\n\\t\\tdisplay: inline-block;\\n\\t\\tvertical-align: middle;\\n\\t}\\n\\ttable.inline td {\\n\\t\\tborder: none;\\n\\t\\tpadding: 5px;\\n\\t}\\n\\n\\t.action-column {\\n\\t\\tdisplay: flex;\\n\\t\\tjustify-content: flex-end;\\n\\t\\tpadding-inline-end: 0;\\n\\t}\\n</style>\\n\",\"import mod from \\\"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OAuthItem.vue?vue&type=script&lang=js\\\"; export default mod; export * from \\\"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OAuthItem.vue?vue&type=script&lang=js\\\"\",\"\\n      import API from \\\"!../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\\\";\\n      import domAPI from \\\"!../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\\\";\\n      import insertFn from \\\"!../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\\\";\\n      import setAttributes from \\\"!../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\\\";\\n      import insertStyleElement from \\\"!../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\\\";\\n      import styleTagTransformFn from \\\"!../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\\\";\\n      import content, * as namedExport from \\\"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OAuthItem.vue?vue&type=style&index=0&id=cfb38ebe&prod&scoped=true&lang=css\\\";\\n      \\n      \\n\\nvar options = {};\\n\\noptions.styleTagTransform = styleTagTransformFn;\\noptions.setAttributes = setAttributes;\\n\\n      options.insert = insertFn.bind(null, \\\"head\\\");\\n    \\noptions.domAPI = domAPI;\\noptions.insertStyleElement = insertStyleElement;\\n\\nvar update = API(content, options);\\n\\n\\n\\nexport * from \\\"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OAuthItem.vue?vue&type=style&index=0&id=cfb38ebe&prod&scoped=true&lang=css\\\";\\n       export default content && content.locals ? content.locals : undefined;\\n\",\"import { render, staticRenderFns } from \\\"./OAuthItem.vue?vue&type=template&id=cfb38ebe&scoped=true\\\"\\nimport script from \\\"./OAuthItem.vue?vue&type=script&lang=js\\\"\\nexport * from \\\"./OAuthItem.vue?vue&type=script&lang=js\\\"\\nimport style0 from \\\"./OAuthItem.vue?vue&type=style&index=0&id=cfb38ebe&prod&scoped=true&lang=css\\\"\\n\\n\\n/* normalize component */\\nimport normalizer from \\\"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\\\"\\nvar component = normalizer(\\n  script,\\n  render,\\n  staticRenderFns,\\n  false,\\n  null,\\n  \\\"cfb38ebe\\\",\\n  null\\n  \\n)\\n\\nexport default component.exports\",\"var render = function render(){var _vm=this,_c=_vm._self._c;return _c('tr',[_c('td',[_vm._v(_vm._s(_vm.name))]),_vm._v(\\\" \\\"),_c('td',[_vm._v(_vm._s(_vm.redirectUri))]),_vm._v(\\\" \\\"),_c('td',[_c('code',[_vm._v(_vm._s(_vm.clientId))])]),_vm._v(\\\" \\\"),_c('td',[_c('div',{staticClass:\\\"action-secret\\\"},[_c('code',[_vm._v(_vm._s(_vm.renderedSecret))]),_vm._v(\\\" \\\"),_c('NcButton',{attrs:{\\\"type\\\":\\\"tertiary-no-background\\\",\\\"aria-label\\\":_vm.toggleAriaLabel},on:{\\\"click\\\":_vm.toggleSecret},scopedSlots:_vm._u([{key:\\\"icon\\\",fn:function(){return [_c('EyeOutline',{attrs:{\\\"size\\\":20}})]},proxy:true}])})],1)]),_vm._v(\\\" \\\"),_c('td',{staticClass:\\\"action-column\\\"},[_c('NcButton',{attrs:{\\\"type\\\":\\\"tertiary-no-background\\\",\\\"aria-label\\\":_vm.t('oauth2', 'Delete')},on:{\\\"click\\\":function($event){return _vm.$emit('delete', _vm.id)}},scopedSlots:_vm._u([{key:\\\"icon\\\",fn:function(){return [_c('Delete',{attrs:{\\\"size\\\":20,\\\"title\\\":_vm.t('oauth2', 'Delete')}})]},proxy:true}])})],1)])\\n}\\nvar staticRenderFns = []\\n\\nexport { render, staticRenderFns }\",\"<!--\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\n-->\\n<template>\\n\\t<NcSettingsSection :name=\\\"t('oauth2', 'OAuth 2.0 clients')\\\"\\n\\t\\t:description=\\\"t('oauth2', 'OAuth 2.0 allows external services to request access to {instanceName}.', { instanceName })\\\"\\n\\t\\t:doc-url=\\\"oauthDocLink\\\">\\n\\t\\t<table v-if=\\\"clients.length > 0\\\" class=\\\"grid\\\">\\n\\t\\t\\t<thead>\\n\\t\\t\\t\\t<tr>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Name') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Redirection URI') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Client Identifier') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Secret key') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Delete client') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t</tr>\\n\\t\\t\\t</thead>\\n\\t\\t\\t<tbody>\\n\\t\\t\\t\\t<OAuthItem v-for=\\\"client in clients\\\"\\n\\t\\t\\t\\t\\t:key=\\\"client.id\\\"\\n\\t\\t\\t\\t\\t:client=\\\"client\\\"\\n\\t\\t\\t\\t\\t@delete=\\\"deleteClient\\\" />\\n\\t\\t\\t</tbody>\\n\\t\\t</table>\\n\\n\\t\\t<br>\\n\\t\\t<h3>{{ t('oauth2', 'Add client') }}</h3>\\n\\t\\t<span v-if=\\\"newClient.error\\\" class=\\\"msg error\\\">{{ newClient.errorMsg }}</span>\\n\\t\\t<form class=\\\"oauth2-form\\\" @submit.prevent=\\\"addClient\\\">\\n\\t\\t\\t<NcTextField id=\\\"name\\\"\\n\\t\\t\\t\\t:value.sync=\\\"newClient.name\\\"\\n\\t\\t\\t\\ttype=\\\"text\\\"\\n\\t\\t\\t\\tclass=\\\"oauth2-form--input\\\"\\n\\t\\t\\t\\tname=\\\"name\\\"\\n\\t\\t\\t\\t:label=\\\"t('oauth2', 'Name')\\\"\\n\\t\\t\\t\\t:placeholder=\\\"t('oauth2', 'Name')\\\" />\\n\\t\\t\\t<NcTextField id=\\\"redirectUri\\\"\\n\\t\\t\\t\\t:value.sync=\\\"newClient.redirectUri\\\"\\n\\t\\t\\t\\ttype=\\\"url\\\"\\n\\t\\t\\t\\tclass=\\\"oauth2-form--input\\\"\\n\\t\\t\\t\\tname=\\\"redirectUri\\\"\\n\\t\\t\\t\\t:label=\\\"t('oauth2', 'Redirection URI')\\\"\\n\\t\\t\\t\\t:placeholder=\\\"t('oauth2', 'Redirection URI')\\\" />\\n\\t\\t\\t<NcButton native-type=\\\"submit\\\" class=\\\"inline-button\\\">\\n\\t\\t\\t\\t{{ t('oauth2', 'Add') }}\\n\\t\\t\\t</NcButton>\\n\\t\\t</form>\\n\\t</NcSettingsSection>\\n</template>\\n\\n<script>\\nimport axios from '@nextcloud/axios'\\nimport OAuthItem from './components/OAuthItem.vue'\\nimport { generateUrl } from '@nextcloud/router'\\nimport { getCapabilities } from '@nextcloud/capabilities'\\nimport NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\nimport { loadState } from '@nextcloud/initial-state'\\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\\n\\nexport default {\\n\\tname: 'App',\\n\\tcomponents: {\\n\\t\\tOAuthItem,\\n\\t\\tNcSettingsSection,\\n\\t\\tNcButton,\\n\\t\\tNcTextField,\\n\\t},\\n\\tprops: {\\n\\t\\tclients: {\\n\\t\\t\\ttype: Array,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tnewClient: {\\n\\t\\t\\t\\tname: '',\\n\\t\\t\\t\\tredirectUri: '',\\n\\t\\t\\t\\terrorMsg: '',\\n\\t\\t\\t\\terror: false,\\n\\t\\t\\t},\\n\\t\\t\\toauthDocLink: loadState('oauth2', 'oauth2-doc-link'),\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\tinstanceName() {\\n\\t\\t\\treturn getCapabilities().theming.name\\n\\t\\t},\\n\\t},\\n\\tmethods: {\\n\\t\\tdeleteClient(id) {\\n\\t\\t\\taxios.delete(generateUrl('apps/oauth2/clients/{id}', { id }))\\n\\t\\t\\t\\t.then(() => {\\n\\t\\t\\t\\t\\t// eslint-disable-next-line vue/no-mutating-props\\n\\t\\t\\t\\t\\tthis.clients = this.clients.filter(client => client.id !== id)\\n\\t\\t\\t\\t})\\n\\t\\t},\\n\\t\\taddClient() {\\n\\t\\t\\tthis.newClient.error = false\\n\\n\\t\\t\\taxios.post(\\n\\t\\t\\t\\tgenerateUrl('apps/oauth2/clients'),\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tname: this.newClient.name,\\n\\t\\t\\t\\t\\tredirectUri: this.newClient.redirectUri,\\n\\t\\t\\t\\t},\\n\\t\\t\\t).then(response => {\\n\\t\\t\\t\\t// eslint-disable-next-line vue/no-mutating-props\\n\\t\\t\\t\\tthis.clients.push(response.data)\\n\\n\\t\\t\\t\\tthis.newClient.name = ''\\n\\t\\t\\t\\tthis.newClient.redirectUri = ''\\n\\t\\t\\t}).catch(reason => {\\n\\t\\t\\t\\tthis.newClient.error = true\\n\\t\\t\\t\\tthis.newClient.errorMsg = reason.response.data.message\\n\\t\\t\\t})\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n<style scoped>\\n\\ttable {\\n\\t\\tmax-width: 800px;\\n\\t}\\n\\n\\t/** Overwrite button height and position to be aligned with the text input */\\n\\t.inline-button {\\n\\t\\tmin-height: 34px !important;\\n\\t\\tdisplay: inline-flex !important;\\n\\t}\\n\\t.oauth2-form {\\n\\t\\tdisplay: flex;\\n\\t\\tflex-direction: row;\\n\\t}\\n\\t.oauth2-form--input {\\n\\t\\tmax-width: 200px;\\n\\t\\tmargin-inline-end: 10px;\\n\\t}\\n</style>\\n\",\"import mod from \\\"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js\\\"; export default mod; export * from \\\"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js\\\"\",\"\\n      import API from \\\"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\\\";\\n      import domAPI from \\\"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\\\";\\n      import insertFn from \\\"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\\\";\\n      import setAttributes from \\\"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\\\";\\n      import insertStyleElement from \\\"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\\\";\\n      import styleTagTransformFn from \\\"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\\\";\\n      import content, * as namedExport from \\\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&id=4edab9ab&prod&scoped=true&lang=css\\\";\\n      \\n      \\n\\nvar options = {};\\n\\noptions.styleTagTransform = styleTagTransformFn;\\noptions.setAttributes = setAttributes;\\n\\n      options.insert = insertFn.bind(null, \\\"head\\\");\\n    \\noptions.domAPI = domAPI;\\noptions.insertStyleElement = insertStyleElement;\\n\\nvar update = API(content, options);\\n\\n\\n\\nexport * from \\\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&id=4edab9ab&prod&scoped=true&lang=css\\\";\\n       export default content && content.locals ? content.locals : undefined;\\n\",\"import { render, staticRenderFns } from \\\"./App.vue?vue&type=template&id=4edab9ab&scoped=true\\\"\\nimport script from \\\"./App.vue?vue&type=script&lang=js\\\"\\nexport * from \\\"./App.vue?vue&type=script&lang=js\\\"\\nimport style0 from \\\"./App.vue?vue&type=style&index=0&id=4edab9ab&prod&scoped=true&lang=css\\\"\\n\\n\\n/* normalize component */\\nimport normalizer from \\\"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\\\"\\nvar component = normalizer(\\n  script,\\n  render,\\n  staticRenderFns,\\n  false,\\n  null,\\n  \\\"4edab9ab\\\",\\n  null\\n  \\n)\\n\\nexport default component.exports\",\"var render = function render(){var _vm=this,_c=_vm._self._c;return _c('NcSettingsSection',{attrs:{\\\"name\\\":_vm.t('oauth2', 'OAuth 2.0 clients'),\\\"description\\\":_vm.t('oauth2', 'OAuth 2.0 allows external services to request access to {instanceName}.', { instanceName: _vm.instanceName }),\\\"doc-url\\\":_vm.oauthDocLink}},[(_vm.clients.length > 0)?_c('table',{staticClass:\\\"grid\\\"},[_c('thead',[_c('tr',[_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Name'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")]),_vm._v(\\\" \\\"),_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Redirection URI'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")]),_vm._v(\\\" \\\"),_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Client Identifier'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")]),_vm._v(\\\" \\\"),_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Secret key'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")]),_vm._v(\\\" \\\"),_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Delete client'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")])])]),_vm._v(\\\" \\\"),_c('tbody',_vm._l((_vm.clients),function(client){return _c('OAuthItem',{key:client.id,attrs:{\\\"client\\\":client},on:{\\\"delete\\\":_vm.deleteClient}})}),1)]):_vm._e(),_vm._v(\\\" \\\"),_c('br'),_vm._v(\\\" \\\"),_c('h3',[_vm._v(_vm._s(_vm.t('oauth2', 'Add client')))]),_vm._v(\\\" \\\"),(_vm.newClient.error)?_c('span',{staticClass:\\\"msg error\\\"},[_vm._v(_vm._s(_vm.newClient.errorMsg))]):_vm._e(),_vm._v(\\\" \\\"),_c('form',{staticClass:\\\"oauth2-form\\\",on:{\\\"submit\\\":function($event){$event.preventDefault();return _vm.addClient.apply(null, arguments)}}},[_c('NcTextField',{staticClass:\\\"oauth2-form--input\\\",attrs:{\\\"id\\\":\\\"name\\\",\\\"value\\\":_vm.newClient.name,\\\"type\\\":\\\"text\\\",\\\"name\\\":\\\"name\\\",\\\"label\\\":_vm.t('oauth2', 'Name'),\\\"placeholder\\\":_vm.t('oauth2', 'Name')},on:{\\\"update:value\\\":function($event){return _vm.$set(_vm.newClient, \\\"name\\\", $event)}}}),_vm._v(\\\" \\\"),_c('NcTextField',{staticClass:\\\"oauth2-form--input\\\",attrs:{\\\"id\\\":\\\"redirectUri\\\",\\\"value\\\":_vm.newClient.redirectUri,\\\"type\\\":\\\"url\\\",\\\"name\\\":\\\"redirectUri\\\",\\\"label\\\":_vm.t('oauth2', 'Redirection URI'),\\\"placeholder\\\":_vm.t('oauth2', 'Redirection URI')},on:{\\\"update:value\\\":function($event){return _vm.$set(_vm.newClient, \\\"redirectUri\\\", $event)}}}),_vm._v(\\\" \\\"),_c('NcButton',{staticClass:\\\"inline-button\\\",attrs:{\\\"native-type\\\":\\\"submit\\\"}},[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Add'))+\\\"\\\\n\\\\t\\\\t\\\")])],1)])\\n}\\nvar staticRenderFns = []\\n\\nexport { render, staticRenderFns }\",\"/**\\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n * SPDX-License-Identifier: AGPL-3.0-or-later\\n */\\n\\nimport Vue from 'vue'\\nimport App from './App.vue'\\nimport { loadState } from '@nextcloud/initial-state'\\n\\nVue.prototype.t = t\\nVue.prototype.OC = OC\\n\\nconst clients = loadState('oauth2', 'clients')\\n\\nconst View = Vue.extend(App)\\nconst oauth = new View({\\n\\tpropsData: {\\n\\t\\tclients,\\n\\t},\\n})\\noauth.$mount('#oauth2')\\n\",\"// Imports\\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \\\"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\\\";\\nimport ___CSS_LOADER_API_IMPORT___ from \\\"../../../node_modules/css-loader/dist/runtime/api.js\\\";\\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\\n// Module\\n___CSS_LOADER_EXPORT___.push([module.id, `\\ntable[data-v-4edab9ab] {\\n\\tmax-width: 800px;\\n}\\n\\n/** Overwrite button height and position to be aligned with the text input */\\n.inline-button[data-v-4edab9ab] {\\n\\tmin-height: 34px !important;\\n\\tdisplay: inline-flex !important;\\n}\\n.oauth2-form[data-v-4edab9ab] {\\n\\tdisplay: flex;\\n\\tflex-direction: row;\\n}\\n.oauth2-form--input[data-v-4edab9ab] {\\n\\tmax-width: 200px;\\n\\tmargin-inline-end: 10px;\\n}\\n`, \\\"\\\",{\\\"version\\\":3,\\\"sources\\\":[\\\"webpack://./apps/oauth2/src/App.vue\\\"],\\\"names\\\":[],\\\"mappings\\\":\\\";AAwJA;CACA,gBAAA;AACA;;AAEA,4EAAA;AACA;CACA,2BAAA;CACA,+BAAA;AACA;AACA;CACA,aAAA;CACA,mBAAA;AACA;AACA;CACA,gBAAA;CACA,uBAAA;AACA\\\",\\\"sourcesContent\\\":[\\\"<!--\\\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\\\n-->\\\\n<template>\\\\n\\\\t<NcSettingsSection :name=\\\\\\\"t('oauth2', 'OAuth 2.0 clients')\\\\\\\"\\\\n\\\\t\\\\t:description=\\\\\\\"t('oauth2', 'OAuth 2.0 allows external services to request access to {instanceName}.', { instanceName })\\\\\\\"\\\\n\\\\t\\\\t:doc-url=\\\\\\\"oauthDocLink\\\\\\\">\\\\n\\\\t\\\\t<table v-if=\\\\\\\"clients.length > 0\\\\\\\" class=\\\\\\\"grid\\\\\\\">\\\\n\\\\t\\\\t\\\\t<thead>\\\\n\\\\t\\\\t\\\\t\\\\t<tr>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Name') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Redirection URI') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Client Identifier') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Secret key') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Delete client') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t</tr>\\\\n\\\\t\\\\t\\\\t</thead>\\\\n\\\\t\\\\t\\\\t<tbody>\\\\n\\\\t\\\\t\\\\t\\\\t<OAuthItem v-for=\\\\\\\"client in clients\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t:key=\\\\\\\"client.id\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t:client=\\\\\\\"client\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t@delete=\\\\\\\"deleteClient\\\\\\\" />\\\\n\\\\t\\\\t\\\\t</tbody>\\\\n\\\\t\\\\t</table>\\\\n\\\\n\\\\t\\\\t<br>\\\\n\\\\t\\\\t<h3>{{ t('oauth2', 'Add client') }}</h3>\\\\n\\\\t\\\\t<span v-if=\\\\\\\"newClient.error\\\\\\\" class=\\\\\\\"msg error\\\\\\\">{{ newClient.errorMsg }}</span>\\\\n\\\\t\\\\t<form class=\\\\\\\"oauth2-form\\\\\\\" @submit.prevent=\\\\\\\"addClient\\\\\\\">\\\\n\\\\t\\\\t\\\\t<NcTextField id=\\\\\\\"name\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:value.sync=\\\\\\\"newClient.name\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\ttype=\\\\\\\"text\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\tclass=\\\\\\\"oauth2-form--input\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\tname=\\\\\\\"name\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:label=\\\\\\\"t('oauth2', 'Name')\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:placeholder=\\\\\\\"t('oauth2', 'Name')\\\\\\\" />\\\\n\\\\t\\\\t\\\\t<NcTextField id=\\\\\\\"redirectUri\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:value.sync=\\\\\\\"newClient.redirectUri\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\ttype=\\\\\\\"url\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\tclass=\\\\\\\"oauth2-form--input\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\tname=\\\\\\\"redirectUri\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:label=\\\\\\\"t('oauth2', 'Redirection URI')\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:placeholder=\\\\\\\"t('oauth2', 'Redirection URI')\\\\\\\" />\\\\n\\\\t\\\\t\\\\t<NcButton native-type=\\\\\\\"submit\\\\\\\" class=\\\\\\\"inline-button\\\\\\\">\\\\n\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Add') }}\\\\n\\\\t\\\\t\\\\t</NcButton>\\\\n\\\\t\\\\t</form>\\\\n\\\\t</NcSettingsSection>\\\\n</template>\\\\n\\\\n<script>\\\\nimport axios from '@nextcloud/axios'\\\\nimport OAuthItem from './components/OAuthItem.vue'\\\\nimport { generateUrl } from '@nextcloud/router'\\\\nimport { getCapabilities } from '@nextcloud/capabilities'\\\\nimport NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\\\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\\\nimport { loadState } from '@nextcloud/initial-state'\\\\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\\\\n\\\\nexport default {\\\\n\\\\tname: 'App',\\\\n\\\\tcomponents: {\\\\n\\\\t\\\\tOAuthItem,\\\\n\\\\t\\\\tNcSettingsSection,\\\\n\\\\t\\\\tNcButton,\\\\n\\\\t\\\\tNcTextField,\\\\n\\\\t},\\\\n\\\\tprops: {\\\\n\\\\t\\\\tclients: {\\\\n\\\\t\\\\t\\\\ttype: Array,\\\\n\\\\t\\\\t\\\\trequired: true,\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n\\\\tdata() {\\\\n\\\\t\\\\treturn {\\\\n\\\\t\\\\t\\\\tnewClient: {\\\\n\\\\t\\\\t\\\\t\\\\tname: '',\\\\n\\\\t\\\\t\\\\t\\\\tredirectUri: '',\\\\n\\\\t\\\\t\\\\t\\\\terrorMsg: '',\\\\n\\\\t\\\\t\\\\t\\\\terror: false,\\\\n\\\\t\\\\t\\\\t},\\\\n\\\\t\\\\t\\\\toauthDocLink: loadState('oauth2', 'oauth2-doc-link'),\\\\n\\\\t\\\\t}\\\\n\\\\t},\\\\n\\\\tcomputed: {\\\\n\\\\t\\\\tinstanceName() {\\\\n\\\\t\\\\t\\\\treturn getCapabilities().theming.name\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n\\\\tmethods: {\\\\n\\\\t\\\\tdeleteClient(id) {\\\\n\\\\t\\\\t\\\\taxios.delete(generateUrl('apps/oauth2/clients/{id}', { id }))\\\\n\\\\t\\\\t\\\\t\\\\t.then(() => {\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t// eslint-disable-next-line vue/no-mutating-props\\\\n\\\\t\\\\t\\\\t\\\\t\\\\tthis.clients = this.clients.filter(client => client.id !== id)\\\\n\\\\t\\\\t\\\\t\\\\t})\\\\n\\\\t\\\\t},\\\\n\\\\t\\\\taddClient() {\\\\n\\\\t\\\\t\\\\tthis.newClient.error = false\\\\n\\\\n\\\\t\\\\t\\\\taxios.post(\\\\n\\\\t\\\\t\\\\t\\\\tgenerateUrl('apps/oauth2/clients'),\\\\n\\\\t\\\\t\\\\t\\\\t{\\\\n\\\\t\\\\t\\\\t\\\\t\\\\tname: this.newClient.name,\\\\n\\\\t\\\\t\\\\t\\\\t\\\\tredirectUri: this.newClient.redirectUri,\\\\n\\\\t\\\\t\\\\t\\\\t},\\\\n\\\\t\\\\t\\\\t).then(response => {\\\\n\\\\t\\\\t\\\\t\\\\t// eslint-disable-next-line vue/no-mutating-props\\\\n\\\\t\\\\t\\\\t\\\\tthis.clients.push(response.data)\\\\n\\\\n\\\\t\\\\t\\\\t\\\\tthis.newClient.name = ''\\\\n\\\\t\\\\t\\\\t\\\\tthis.newClient.redirectUri = ''\\\\n\\\\t\\\\t\\\\t}).catch(reason => {\\\\n\\\\t\\\\t\\\\t\\\\tthis.newClient.error = true\\\\n\\\\t\\\\t\\\\t\\\\tthis.newClient.errorMsg = reason.response.data.message\\\\n\\\\t\\\\t\\\\t})\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n}\\\\n</script>\\\\n<style scoped>\\\\n\\\\ttable {\\\\n\\\\t\\\\tmax-width: 800px;\\\\n\\\\t}\\\\n\\\\n\\\\t/** Overwrite button height and position to be aligned with the text input */\\\\n\\\\t.inline-button {\\\\n\\\\t\\\\tmin-height: 34px !important;\\\\n\\\\t\\\\tdisplay: inline-flex !important;\\\\n\\\\t}\\\\n\\\\t.oauth2-form {\\\\n\\\\t\\\\tdisplay: flex;\\\\n\\\\t\\\\tflex-direction: row;\\\\n\\\\t}\\\\n\\\\t.oauth2-form--input {\\\\n\\\\t\\\\tmax-width: 200px;\\\\n\\\\t\\\\tmargin-inline-end: 10px;\\\\n\\\\t}\\\\n</style>\\\\n\\\"],\\\"sourceRoot\\\":\\\"\\\"}]);\\n// Exports\\nexport default ___CSS_LOADER_EXPORT___;\\n\",\"// Imports\\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \\\"../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\\\";\\nimport ___CSS_LOADER_API_IMPORT___ from \\\"../../../../node_modules/css-loader/dist/runtime/api.js\\\";\\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\\n// Module\\n___CSS_LOADER_EXPORT___.push([module.id, `\\n.action-secret[data-v-cfb38ebe] {\\n\\tdisplay: flex;\\n\\talign-items: center;\\n}\\n.action-secret code[data-v-cfb38ebe] {\\n\\tpadding-top: 5px;\\n}\\ntd code[data-v-cfb38ebe] {\\n\\tdisplay: inline-block;\\n\\tvertical-align: middle;\\n}\\ntable.inline td[data-v-cfb38ebe] {\\n\\tborder: none;\\n\\tpadding: 5px;\\n}\\n.action-column[data-v-cfb38ebe] {\\n\\tdisplay: flex;\\n\\tjustify-content: flex-end;\\n\\tpadding-inline-end: 0;\\n}\\n`, \\\"\\\",{\\\"version\\\":3,\\\"sources\\\":[\\\"webpack://./apps/oauth2/src/components/OAuthItem.vue\\\"],\\\"names\\\":[],\\\"mappings\\\":\\\";AA8GA;CACA,aAAA;CACA,mBAAA;AACA;AACA;CACA,gBAAA;AACA;AACA;CACA,qBAAA;CACA,sBAAA;AACA;AACA;CACA,YAAA;CACA,YAAA;AACA;AAEA;CACA,aAAA;CACA,yBAAA;CACA,qBAAA;AACA\\\",\\\"sourcesContent\\\":[\\\"<!--\\\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\\\n-->\\\\n<template>\\\\n\\\\t<tr>\\\\n\\\\t\\\\t<td>{{ name }}</td>\\\\n\\\\t\\\\t<td>{{ redirectUri }}</td>\\\\n\\\\t\\\\t<td><code>{{ clientId }}</code></td>\\\\n\\\\t\\\\t<td>\\\\n\\\\t\\\\t\\\\t<div class=\\\\\\\"action-secret\\\\\\\">\\\\n\\\\t\\\\t\\\\t\\\\t<code>{{ renderedSecret }}</code>\\\\n\\\\t\\\\t\\\\t\\\\t<NcButton type=\\\\\\\"tertiary-no-background\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t:aria-label=\\\\\\\"toggleAriaLabel\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t@click=\\\\\\\"toggleSecret\\\\\\\">\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<template #icon>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t<EyeOutline :size=\\\\\\\"20\\\\\\\" />\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</template>\\\\n\\\\t\\\\t\\\\t\\\\t</NcButton>\\\\n\\\\t\\\\t\\\\t</div>\\\\n\\\\t\\\\t</td>\\\\n\\\\t\\\\t<td class=\\\\\\\"action-column\\\\\\\">\\\\n\\\\t\\\\t\\\\t<NcButton type=\\\\\\\"tertiary-no-background\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:aria-label=\\\\\\\"t('oauth2', 'Delete')\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t@click=\\\\\\\"$emit('delete', id)\\\\\\\">\\\\n\\\\t\\\\t\\\\t\\\\t<template #icon>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<Delete :size=\\\\\\\"20\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t:title=\\\\\\\"t('oauth2', 'Delete')\\\\\\\" />\\\\n\\\\t\\\\t\\\\t\\\\t</template>\\\\n\\\\t\\\\t\\\\t</NcButton>\\\\n\\\\t\\\\t</td>\\\\n\\\\t</tr>\\\\n</template>\\\\n\\\\n<script>\\\\n\\\\nimport Delete from 'vue-material-design-icons/Delete.vue'\\\\nimport EyeOutline from 'vue-material-design-icons/EyeOutline.vue'\\\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\\\n\\\\nexport default {\\\\n\\\\tname: 'OAuthItem',\\\\n\\\\tcomponents: {\\\\n\\\\t\\\\tDelete,\\\\n\\\\t\\\\tNcButton,\\\\n\\\\t\\\\tEyeOutline,\\\\n\\\\t},\\\\n\\\\tprops: {\\\\n\\\\t\\\\tclient: {\\\\n\\\\t\\\\t\\\\ttype: Object,\\\\n\\\\t\\\\t\\\\trequired: true,\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n\\\\tdata() {\\\\n\\\\t\\\\treturn {\\\\n\\\\t\\\\t\\\\tid: this.client.id,\\\\n\\\\t\\\\t\\\\tname: this.client.name,\\\\n\\\\t\\\\t\\\\tredirectUri: this.client.redirectUri,\\\\n\\\\t\\\\t\\\\tclientId: this.client.clientId,\\\\n\\\\t\\\\t\\\\tclientSecret: this.client.clientSecret,\\\\n\\\\t\\\\t\\\\trenderSecret: false,\\\\n\\\\t\\\\t}\\\\n\\\\t},\\\\n\\\\tcomputed: {\\\\n\\\\t\\\\trenderedSecret() {\\\\n\\\\t\\\\t\\\\tif (this.renderSecret) {\\\\n\\\\t\\\\t\\\\t\\\\treturn this.clientSecret\\\\n\\\\t\\\\t\\\\t} else {\\\\n\\\\t\\\\t\\\\t\\\\treturn '****'\\\\n\\\\t\\\\t\\\\t}\\\\n\\\\t\\\\t},\\\\n\\\\t\\\\ttoggleAriaLabel() {\\\\n\\\\t\\\\t\\\\tif (!this.renderSecret) {\\\\n\\\\t\\\\t\\\\t\\\\treturn t('oauth2', 'Show client secret')\\\\n\\\\t\\\\t\\\\t}\\\\n\\\\t\\\\t\\\\treturn t('oauth2', 'Hide client secret')\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n\\\\tmethods: {\\\\n\\\\t\\\\ttoggleSecret() {\\\\n\\\\t\\\\t\\\\tthis.renderSecret = !this.renderSecret\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n}\\\\n</script>\\\\n\\\\n<style scoped>\\\\n\\\\t.action-secret {\\\\n\\\\t\\\\tdisplay: flex;\\\\n\\\\t\\\\talign-items: center;\\\\n\\\\t}\\\\n\\\\t.action-secret code {\\\\n\\\\t\\\\tpadding-top: 5px;\\\\n\\\\t}\\\\n\\\\ttd code {\\\\n\\\\t\\\\tdisplay: inline-block;\\\\n\\\\t\\\\tvertical-align: middle;\\\\n\\\\t}\\\\n\\\\ttable.inline td {\\\\n\\\\t\\\\tborder: none;\\\\n\\\\t\\\\tpadding: 5px;\\\\n\\\\t}\\\\n\\\\n\\\\t.action-column {\\\\n\\\\t\\\\tdisplay: flex;\\\\n\\\\t\\\\tjustify-content: flex-end;\\\\n\\\\t\\\\tpadding-inline-end: 0;\\\\n\\\\t}\\\\n</style>\\\\n\\\"],\\\"sourceRoot\\\":\\\"\\\"}]);\\n// Exports\\nexport default ___CSS_LOADER_EXPORT___;\\n\",\"// The module cache\\nvar __webpack_module_cache__ = {};\\n\\n// The require function\\nfunction __webpack_require__(moduleId) {\\n\\t// Check if module is in cache\\n\\tvar cachedModule = __webpack_module_cache__[moduleId];\\n\\tif (cachedModule !== undefined) {\\n\\t\\treturn cachedModule.exports;\\n\\t}\\n\\t// Create a new module (and put it into the cache)\\n\\tvar module = __webpack_module_cache__[moduleId] = {\\n\\t\\tid: moduleId,\\n\\t\\tloaded: false,\\n\\t\\texports: {}\\n\\t};\\n\\n\\t// Execute the module function\\n\\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n\\n\\t// Flag the module as loaded\\n\\tmodule.loaded = true;\\n\\n\\t// Return the exports of the module\\n\\treturn module.exports;\\n}\\n\\n// expose the modules object (__webpack_modules__)\\n__webpack_require__.m = __webpack_modules__;\\n\\n\",\"// getDefaultExport function for compatibility with non-harmony modules\\n__webpack_require__.n = (module) => {\\n\\tvar getter = module && module.__esModule ?\\n\\t\\t() => (module['default']) :\\n\\t\\t() => (module);\\n\\t__webpack_require__.d(getter, { a: getter });\\n\\treturn getter;\\n};\",\"// define getter functions for harmony exports\\n__webpack_require__.d = (exports, definition) => {\\n\\tfor(var key in definition) {\\n\\t\\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\\n\\t\\t\\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\\n\\t\\t}\\n\\t}\\n};\",\"// The chunk loading function for additional chunks\\n// Since all referenced chunks are already included\\n// in this file, this function is empty here.\\n__webpack_require__.e = () => (Promise.resolve());\",\"__webpack_require__.g = (function() {\\n\\tif (typeof globalThis === 'object') return globalThis;\\n\\ttry {\\n\\t\\treturn this || new Function('return this')();\\n\\t} catch (e) {\\n\\t\\tif (typeof window === 'object') return window;\\n\\t}\\n})();\",\"__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\",\"// define __esModule on exports\\n__webpack_require__.r = (exports) => {\\n\\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\\n\\t\\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\\n\\t}\\n\\tObject.defineProperty(exports, '__esModule', { value: true });\\n};\",\"__webpack_require__.nmd = (module) => {\\n\\tmodule.paths = [];\\n\\tif (!module.children) module.children = [];\\n\\treturn module;\\n};\",\"__webpack_require__.j = 6174;\",\"__webpack_require__.b = document.baseURI || self.location.href;\\n\\n// object to store loaded and loading chunks\\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\\nvar installedChunks = {\\n\\t6174: 0\\n};\\n\\n// no chunk on demand loading\\n\\n// no prefetching\\n\\n// no preloaded\\n\\n// no HMR\\n\\n// no HMR manifest\\n\\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\\n\\n// install a JSONP callback for chunk loading\\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\\n\\tvar chunkIds = data[0];\\n\\tvar moreModules = data[1];\\n\\tvar runtime = data[2];\\n\\t// add \\\"moreModules\\\" to the modules object,\\n\\t// then flag all \\\"chunkIds\\\" as loaded and fire callback\\n\\tvar moduleId, chunkId, i = 0;\\n\\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\\n\\t\\tfor(moduleId in moreModules) {\\n\\t\\t\\tif(__webpack_require__.o(moreModules, moduleId)) {\\n\\t\\t\\t\\t__webpack_require__.m[moduleId] = moreModules[moduleId];\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif(runtime) var result = runtime(__webpack_require__);\\n\\t}\\n\\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\\n\\tfor(;i < chunkIds.length; i++) {\\n\\t\\tchunkId = chunkIds[i];\\n\\t\\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\\n\\t\\t\\tinstalledChunks[chunkId][0]();\\n\\t\\t}\\n\\t\\tinstalledChunks[chunkId] = 0;\\n\\t}\\n\\treturn __webpack_require__.O(result);\\n}\\n\\nvar chunkLoadingGlobal = self[\\\"webpackChunknextcloud\\\"] = self[\\\"webpackChunknextcloud\\\"] || [];\\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\",\"__webpack_require__.nc = undefined;\",\"// startup\\n// Load entry module and return exports\\n// This entry module depends on other loaded chunks and execution need to be delayed\\nvar __webpack_exports__ = __webpack_require__.O(undefined, [4208], () => (__webpack_require__(85584)))\\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\\n\"],\"names\":[\"deferred\",\"name\",\"emits\",\"props\",\"title\",\"type\",\"String\",\"fillColor\",\"default\",\"size\",\"Number\",\"_vm\",\"this\",\"_c\",\"_self\",\"_b\",\"staticClass\",\"attrs\",\"on\",\"$event\",\"$emit\",\"$attrs\",\"_v\",\"_s\",\"_e\",\"components\",\"Delete\",\"NcButton\",\"EyeOutline\",\"client\",\"Object\",\"required\",\"data\",\"id\",\"redirectUri\",\"clientId\",\"clientSecret\",\"renderSecret\",\"computed\",\"renderedSecret\",\"toggleAriaLabel\",\"t\",\"methods\",\"toggleSecret\",\"options\",\"styleTagTransform\",\"setAttributes\",\"insert\",\"domAPI\",\"insertStyleElement\",\"locals\",\"scopedSlots\",\"_u\",\"key\",\"fn\",\"proxy\",\"OAuthItem\",\"NcSettingsSection\",\"NcTextField\",\"clients\",\"Array\",\"newClient\",\"errorMsg\",\"error\",\"oauthDocLink\",\"loadState\",\"instanceName\",\"getCapabilities\",\"theming\",\"deleteClient\",\"axios\",\"delete\",\"generateUrl\",\"then\",\"filter\",\"addClient\",\"post\",\"response\",\"push\",\"catch\",\"reason\",\"message\",\"length\",\"_l\",\"preventDefault\",\"apply\",\"arguments\",\"$set\",\"Vue\",\"prototype\",\"OC\",\"extend\",\"App\",\"propsData\",\"$mount\",\"___CSS_LOADER_EXPORT___\",\"module\",\"__webpack_module_cache__\",\"__webpack_require__\",\"moduleId\",\"cachedModule\",\"undefined\",\"exports\",\"loaded\",\"__webpack_modules__\",\"call\",\"m\",\"O\",\"result\",\"chunkIds\",\"priority\",\"notFulfilled\",\"Infinity\",\"i\",\"fulfilled\",\"j\",\"keys\",\"every\",\"splice\",\"r\",\"n\",\"getter\",\"__esModule\",\"d\",\"a\",\"definition\",\"o\",\"defineProperty\",\"enumerable\",\"get\",\"e\",\"Promise\",\"resolve\",\"g\",\"globalThis\",\"Function\",\"window\",\"obj\",\"prop\",\"hasOwnProperty\",\"Symbol\",\"toStringTag\",\"value\",\"nmd\",\"paths\",\"children\",\"b\",\"document\",\"baseURI\",\"self\",\"location\",\"href\",\"installedChunks\",\"chunkId\",\"webpackJsonpCallback\",\"parentChunkLoadingFunction\",\"moreModules\",\"runtime\",\"some\",\"chunkLoadingGlobal\",\"forEach\",\"bind\",\"nc\",\"__webpack_exports__\"],\"sourceRoot\":\"\"}\n\\ No newline at end of file\n+{\"version\":3,\"file\":\"oauth2-oauth2.js?v=516002dd0d2ee3ebfd7d\",\"mappings\":\"uBAAIA,E,wDCoBJ,MCpB6G,EDoB7G,CACEC,KAAM,iBACNC,MAAO,CAAC,SACRC,MAAO,CACLC,MAAO,CACLC,KAAMC,QAERC,UAAW,CACTF,KAAMC,OACNE,QAAS,gBAEXC,KAAM,CACJJ,KAAMK,OACNF,QAAS,M,eEff,SAXgB,OACd,GCRW,WAAkB,IAAIG,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,OAAOF,EAAII,GAAG,CAACC,YAAY,wCAAwCC,MAAM,CAAC,eAAcN,EAAIP,OAAQ,KAAY,aAAaO,EAAIP,MAAM,KAAO,OAAOc,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOR,EAAIS,MAAM,QAASD,EAAO,IAAI,OAAOR,EAAIU,QAAO,GAAO,CAACR,EAAG,MAAM,CAACG,YAAY,4BAA4BC,MAAM,CAAC,KAAON,EAAIJ,UAAU,MAAQI,EAAIF,KAAK,OAASE,EAAIF,KAAK,QAAU,cAAc,CAACI,EAAG,OAAO,CAACI,MAAM,CAAC,EAAI,8SAA8S,CAAEN,EAAS,MAAEE,EAAG,QAAQ,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIP,UAAUO,EAAIa,UAC9zB,GACsB,IDSpB,EACA,KACA,KACA,MAI8B,Q,eEuBhC,MCzCqL,EDyCrL,CACAvB,KAAA,YACAwB,WAAA,CACAC,OAAA,IACAC,SAAA,IACAC,WAAAA,GAEAzB,MAAA,CACA0B,OAAA,CACAxB,KAAAyB,OACAC,UAAA,IAGAC,IAAAA,GACA,OACAC,GAAA,KAAAJ,OAAAI,GACAhC,KAAA,KAAA4B,OAAA5B,KACAiC,YAAA,KAAAL,OAAAK,YACAC,SAAA,KAAAN,OAAAM,SACAC,aAAA,KAAAP,OAAAO,aACAC,cAAA,EAEA,EACAC,SAAA,CACAC,cAAAA,GACA,YAAAF,aACA,KAAAD,aAEA,MAEA,EACAI,eAAAA,GACA,YAAAH,aAGAI,EAAA,+BAFAA,EAAA,8BAGA,GAEAC,QAAA,CACAC,YAAAA,GACA,KAAAN,cAAA,KAAAA,YACA,I,uIEvEIO,EAAU,CAAC,EAEfA,EAAQC,kBAAoB,IAC5BD,EAAQE,cAAgB,IAElBF,EAAQG,OAAS,SAAc,KAAM,QAE3CH,EAAQI,OAAS,IACjBJ,EAAQK,mBAAqB,IAEhB,IAAI,IAASL,GAKJ,KAAW,IAAQM,QAAS,IAAQA,OCP1D,SAXgB,OACd,GCTW,WAAkB,IAAIvC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,KAAK,CAACA,EAAG,KAAK,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIV,SAASU,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIuB,gBAAgBvB,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACA,EAAG,OAAO,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAIwB,eAAexB,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACA,EAAG,MAAM,CAACG,YAAY,iBAAiB,CAACH,EAAG,OAAO,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAI4B,mBAAmB5B,EAAIW,GAAG,KAA2B,KAArBX,EAAIyB,aAAqBvB,EAAG,WAAW,CAACI,MAAM,CAAC,KAAO,yBAAyB,aAAaN,EAAI6B,iBAAiBtB,GAAG,CAAC,MAAQP,EAAIgC,cAAcQ,YAAYxC,EAAIyC,GAAG,CAAC,CAACC,IAAI,OAAOC,GAAG,WAAW,MAAO,CAACzC,EAAG,aAAa,CAACI,MAAM,CAAC,KAAO,MAAM,EAAEsC,OAAM,IAAO,MAAK,EAAM,cAAc5C,EAAIa,MAAM,KAAKb,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACG,YAAY,iBAAiB,CAACH,EAAG,WAAW,CAACI,MAAM,CAAC,KAAO,yBAAyB,aAAaN,EAAI8B,EAAE,SAAU,WAAWvB,GAAG,CAAC,MAAQ,SAASC,GAAQ,OAAOR,EAAIS,MAAM,SAAUT,EAAIsB,GAAG,GAAGkB,YAAYxC,EAAIyC,GAAG,CAAC,CAACC,IAAI,OAAOC,GAAG,WAAW,MAAO,CAACzC,EAAG,SAAS,CAACI,MAAM,CAAC,KAAO,GAAG,MAAQN,EAAI8B,EAAE,SAAU,aAAa,EAAEc,OAAM,QAAW,IACl+B,GACsB,IDUpB,EACA,KACA,WACA,MAI8B,Q,sEEyDhC,MC5EyK,ED4EzK,CACAtD,KAAA,MACAwB,WAAA,CACA+B,UAAA,EACAC,kBAAA,IACA9B,SAAA,IACA+B,YAAA,IACAC,WAAAA,EAAAA,GAEAxD,MAAA,CACAyD,QAAA,CACAvD,KAAAwD,MACA9B,UAAA,IAGAC,KAAAA,KACA,CACA8B,UAAA,CACA7D,KAAA,GACAiC,YAAA,GACA6B,SAAA,GACAC,OAAA,GAEAC,cAAAC,EAAAA,EAAAA,GAAA,4BACAC,mBAAA,IAGA7B,SAAA,CACA8B,aAAAA,KACAC,EAAAA,EAAAA,KAAAC,QAAArE,MAGAyC,QAAA,CACA6B,YAAAA,CAAAtC,GACAuC,EAAAA,GAAAC,QAAAC,EAAAA,EAAAA,IAAA,4BAAAzC,QACA0C,MAAA,KAEA,KAAAf,QAAA,KAAAA,QAAAgB,QAAA/C,GAAAA,EAAAI,KAAAA,GAAA,GAEA,EACA4C,SAAAA,GACA,KAAAf,UAAAE,OAAA,EAEAQ,EAAAA,GAAAM,MACAJ,EAAAA,EAAAA,IAAA,uBACA,CACAzE,KAAA,KAAA6D,UAAA7D,KACAiC,YAAA,KAAA4B,UAAA5B,cAEAyC,MAAAI,IAEA,KAAAnB,QAAAoB,KAAAD,EAAA/C,MACA,KAAAmC,mBAAA,EAEA,KAAAL,UAAA7D,KAAA,GACA,KAAA6D,UAAA5B,YAAA,MACA+C,OAAAC,IACA,KAAApB,UAAAE,OAAA,EACA,KAAAF,UAAAC,SAAAmB,EAAAH,SAAA/C,KAAAmD,OAAA,GAEA,I,eE7HI,EAAU,CAAC,EAEf,EAAQtC,kBAAoB,IAC5B,EAAQC,cAAgB,IAElB,EAAQC,OAAS,SAAc,KAAM,QAE3C,EAAQC,OAAS,IACjB,EAAQC,mBAAqB,IAEhB,IAAI,IAAS,GAKJ,KAAW,IAAQC,QAAS,IAAQA,OCP1D,SAXgB,OACd,GCTW,WAAkB,IAAIvC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,oBAAoB,CAACI,MAAM,CAAC,KAAON,EAAI8B,EAAE,SAAU,qBAAqB,YAAc9B,EAAI8B,EAAE,SAAU,0EAA2E,CAAE2B,aAAczD,EAAIyD,eAAgB,UAAUzD,EAAIsD,eAAe,CAAEtD,EAAIiD,QAAQwB,OAAS,EAAGvE,EAAG,QAAQ,CAACG,YAAY,QAAQ,CAACH,EAAG,QAAQ,CAACA,EAAG,KAAK,CAACA,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,SAAS,gBAAgB9B,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,oBAAoB,gBAAgB9B,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,sBAAsB,gBAAgB9B,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,eAAe,gBAAgB9B,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAG,eAAeX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,kBAAkB,oBAAoB9B,EAAIW,GAAG,KAAKT,EAAG,QAAQF,EAAI0E,GAAI1E,EAAIiD,SAAS,SAAS/B,GAAQ,OAAOhB,EAAG,YAAY,CAACwC,IAAIxB,EAAOI,GAAGhB,MAAM,CAAC,OAASY,GAAQX,GAAG,CAAC,OAASP,EAAI4D,eAAe,IAAG,KAAK5D,EAAIa,KAAKb,EAAIW,GAAG,KAAMX,EAAIwD,kBAAmBtD,EAAG,aAAa,CAACI,MAAM,CAAC,KAAO,YAAY,CAACN,EAAIW,GAAG,SAASX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,gEAAgE,UAAU9B,EAAIa,KAAKb,EAAIW,GAAG,KAAKT,EAAG,MAAMF,EAAIW,GAAG,KAAKT,EAAG,KAAK,CAACF,EAAIW,GAAGX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,kBAAkB9B,EAAIW,GAAG,KAAMX,EAAImD,UAAUE,MAAOnD,EAAG,OAAO,CAACG,YAAY,aAAa,CAACL,EAAIW,GAAGX,EAAIY,GAAGZ,EAAImD,UAAUC,aAAapD,EAAIa,KAAKb,EAAIW,GAAG,KAAKT,EAAG,OAAO,CAACG,YAAY,cAAcE,GAAG,CAAC,OAAS,SAASC,GAAgC,OAAxBA,EAAOmE,iBAAwB3E,EAAIkE,UAAUU,MAAM,KAAMC,UAAU,IAAI,CAAC3E,EAAG,cAAc,CAACG,YAAY,qBAAqBC,MAAM,CAAC,GAAK,OAAO,MAAQN,EAAImD,UAAU7D,KAAK,KAAO,OAAO,KAAO,OAAO,MAAQU,EAAI8B,EAAE,SAAU,QAAQ,YAAc9B,EAAI8B,EAAE,SAAU,SAASvB,GAAG,CAAC,eAAe,SAASC,GAAQ,OAAOR,EAAI8E,KAAK9E,EAAImD,UAAW,OAAQ3C,EAAO,KAAKR,EAAIW,GAAG,KAAKT,EAAG,cAAc,CAACG,YAAY,qBAAqBC,MAAM,CAAC,GAAK,cAAc,MAAQN,EAAImD,UAAU5B,YAAY,KAAO,MAAM,KAAO,cAAc,MAAQvB,EAAI8B,EAAE,SAAU,mBAAmB,YAAc9B,EAAI8B,EAAE,SAAU,oBAAoBvB,GAAG,CAAC,eAAe,SAASC,GAAQ,OAAOR,EAAI8E,KAAK9E,EAAImD,UAAW,cAAe3C,EAAO,KAAKR,EAAIW,GAAG,KAAKT,EAAG,WAAW,CAACG,YAAY,gBAAgBC,MAAM,CAAC,cAAc,WAAW,CAACN,EAAIW,GAAG,WAAWX,EAAIY,GAAGZ,EAAI8B,EAAE,SAAU,QAAQ,aAAa,IAAI,EAC11E,GACsB,IDUpB,EACA,KACA,WACA,MAI8B,QEVhCiD,EAAAA,GAAIC,UAAUlD,EAAIA,EAClBiD,EAAAA,GAAIC,UAAUC,GAAKA,GAEnB,MAAMhC,GAAUM,EAAAA,EAAAA,GAAU,SAAU,WAGtB,IADDwB,EAAAA,GAAIG,OAAOC,GACV,CAAS,CACtBC,UAAW,CACVnC,aAGIoC,OAAO,U,sECjBTC,E,MAA0B,GAA4B,KAE1DA,EAAwBjB,KAAK,CAACkB,EAAOjE,GAAI,4ZAkBtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,uCAAuC,MAAQ,GAAG,SAAW,oIAAoI,eAAiB,CAAC,uiJAAgiJ,WAAa,MAE9xJ,S,sECtBIgE,E,MAA0B,GAA4B,KAE1DA,EAAwBjB,KAAK,CAACkB,EAAOjE,GAAI,kaAqBtC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,wDAAwD,MAAQ,GAAG,SAAW,gKAAgK,eAAiB,CAAC,w9EAAi9E,WAAa,MAE5vF,S,GC3BIkE,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaE,QAGrB,IAAIN,EAASC,EAAyBE,GAAY,CACjDpE,GAAIoE,EACJI,QAAQ,EACRD,QAAS,CAAC,GAUX,OANAE,EAAoBL,GAAUM,KAAKT,EAAOM,QAASN,EAAQA,EAAOM,QAASJ,GAG3EF,EAAOO,QAAS,EAGTP,EAAOM,OACf,CAGAJ,EAAoBQ,EAAIF,ElB5BpB1G,EAAW,GACfoG,EAAoBS,EAAI,CAACC,EAAQC,EAAUzD,EAAI0D,KAC9C,IAAGD,EAAH,CAMA,IAAIE,EAAeC,IACnB,IAASC,EAAI,EAAGA,EAAInH,EAASoF,OAAQ+B,IAAK,CACrCJ,EAAW/G,EAASmH,GAAG,GACvB7D,EAAKtD,EAASmH,GAAG,GACjBH,EAAWhH,EAASmH,GAAG,GAE3B,IAJA,IAGIC,GAAY,EACPC,EAAI,EAAGA,EAAIN,EAAS3B,OAAQiC,MACpB,EAAXL,GAAsBC,GAAgBD,IAAalF,OAAOwF,KAAKlB,EAAoBS,GAAGU,OAAOlE,GAAS+C,EAAoBS,EAAExD,GAAK0D,EAASM,MAC9IN,EAASS,OAAOH,IAAK,IAErBD,GAAY,EACTJ,EAAWC,IAAcA,EAAeD,IAG7C,GAAGI,EAAW,CACbpH,EAASwH,OAAOL,IAAK,GACrB,IAAIM,EAAInE,SACEiD,IAANkB,IAAiBX,EAASW,EAC/B,CACD,CACA,OAAOX,CArBP,CAJCE,EAAWA,GAAY,EACvB,IAAI,IAAIG,EAAInH,EAASoF,OAAQ+B,EAAI,GAAKnH,EAASmH,EAAI,GAAG,GAAKH,EAAUG,IAAKnH,EAASmH,GAAKnH,EAASmH,EAAI,GACrGnH,EAASmH,GAAK,CAACJ,EAAUzD,EAAI0D,EAuBjB,EmB3BdZ,EAAoBsB,EAAKxB,IACxB,IAAIyB,EAASzB,GAAUA,EAAO0B,WAC7B,IAAO1B,EAAiB,QACxB,IAAM,EAEP,OADAE,EAAoByB,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,CAAM,ECLdvB,EAAoByB,EAAI,CAACrB,EAASuB,KACjC,IAAI,IAAI1E,KAAO0E,EACX3B,EAAoB4B,EAAED,EAAY1E,KAAS+C,EAAoB4B,EAAExB,EAASnD,IAC5EvB,OAAOmG,eAAezB,EAASnD,EAAK,CAAE6E,YAAY,EAAMC,IAAKJ,EAAW1E,IAE1E,ECHD+C,EAAoBgC,EAAI,IAAOC,QAAQC,UCHvClC,EAAoBmC,EAAI,WACvB,GAA0B,iBAAfC,WAAyB,OAAOA,WAC3C,IACC,OAAO5H,MAAQ,IAAI6H,SAAS,cAAb,EAChB,CAAE,MAAOL,GACR,GAAsB,iBAAXM,OAAqB,OAAOA,MACxC,CACA,CAPuB,GCAxBtC,EAAoB4B,EAAI,CAACW,EAAKC,IAAU9G,OAAO6D,UAAUkD,eAAelC,KAAKgC,EAAKC,GCClFxC,EAAoBqB,EAAKjB,IACH,oBAAXsC,QAA0BA,OAAOC,aAC1CjH,OAAOmG,eAAezB,EAASsC,OAAOC,YAAa,CAAEC,MAAO,WAE7DlH,OAAOmG,eAAezB,EAAS,aAAc,CAAEwC,OAAO,GAAO,ECL9D5C,EAAoB6C,IAAO/C,IAC1BA,EAAOgD,MAAQ,GACVhD,EAAOiD,WAAUjD,EAAOiD,SAAW,IACjCjD,GCHRE,EAAoBiB,EAAI,K,MCAxBjB,EAAoBgD,EAAIC,SAASC,SAAWC,KAAKC,SAASC,KAK1D,IAAIC,EAAkB,CACrB,KAAM,GAaPtD,EAAoBS,EAAEQ,EAAKsC,GAA0C,IAA7BD,EAAgBC,GAGxD,IAAIC,EAAuB,CAACC,EAA4B7H,KACvD,IAKIqE,EAAUsD,EALV5C,EAAW/E,EAAK,GAChB8H,EAAc9H,EAAK,GACnB+H,EAAU/H,EAAK,GAGImF,EAAI,EAC3B,GAAGJ,EAASiD,MAAM/H,GAAgC,IAAxByH,EAAgBzH,KAAa,CACtD,IAAIoE,KAAYyD,EACZ1D,EAAoB4B,EAAE8B,EAAazD,KACrCD,EAAoBQ,EAAEP,GAAYyD,EAAYzD,IAGhD,GAAG0D,EAAS,IAAIjD,EAASiD,EAAQ3D,EAClC,CAEA,IADGyD,GAA4BA,EAA2B7H,GACrDmF,EAAIJ,EAAS3B,OAAQ+B,IACzBwC,EAAU5C,EAASI,GAChBf,EAAoB4B,EAAE0B,EAAiBC,IAAYD,EAAgBC,IACrED,EAAgBC,GAAS,KAE1BD,EAAgBC,GAAW,EAE5B,OAAOvD,EAAoBS,EAAEC,EAAO,EAGjCmD,EAAqBV,KAA4B,sBAAIA,KAA4B,uBAAK,GAC1FU,EAAmBC,QAAQN,EAAqBO,KAAK,KAAM,IAC3DF,EAAmBjF,KAAO4E,EAAqBO,KAAK,KAAMF,EAAmBjF,KAAKmF,KAAKF,G,KClDvF7D,EAAoBgE,QAAK7D,ECGzB,IAAI8D,EAAsBjE,EAAoBS,OAAEN,EAAW,CAAC,OAAO,IAAOH,EAAoB,SAC9FiE,EAAsBjE,EAAoBS,EAAEwD,E\",\"sources\":[\"webpack:///nextcloud/webpack/runtime/chunk loaded\",\"webpack:///nextcloud/node_modules/vue-material-design-icons/EyeOutline.vue\",\"webpack:///nextcloud/node_modules/vue-material-design-icons/EyeOutline.vue?vue&type=script&lang=js\",\"webpack://nextcloud/./node_modules/vue-material-design-icons/EyeOutline.vue?9ce8\",\"webpack:///nextcloud/node_modules/vue-material-design-icons/EyeOutline.vue?vue&type=template&id=30219a41\",\"webpack:///nextcloud/apps/oauth2/src/components/OAuthItem.vue\",\"webpack:///nextcloud/apps/oauth2/src/components/OAuthItem.vue?vue&type=script&lang=js\",\"webpack://nextcloud/./apps/oauth2/src/components/OAuthItem.vue?d625\",\"webpack://nextcloud/./apps/oauth2/src/components/OAuthItem.vue?7546\",\"webpack://nextcloud/./apps/oauth2/src/components/OAuthItem.vue?098f\",\"webpack:///nextcloud/apps/oauth2/src/App.vue\",\"webpack:///nextcloud/apps/oauth2/src/App.vue?vue&type=script&lang=js\",\"webpack://nextcloud/./apps/oauth2/src/App.vue?3408\",\"webpack://nextcloud/./apps/oauth2/src/App.vue?8831\",\"webpack://nextcloud/./apps/oauth2/src/App.vue?40c9\",\"webpack:///nextcloud/apps/oauth2/src/main.js\",\"webpack:///nextcloud/apps/oauth2/src/App.vue?vue&type=style&index=0&id=597479ba&prod&scoped=true&lang=css\",\"webpack:///nextcloud/apps/oauth2/src/components/OAuthItem.vue?vue&type=style&index=0&id=39c6252a&prod&scoped=true&lang=css\",\"webpack:///nextcloud/webpack/bootstrap\",\"webpack:///nextcloud/webpack/runtime/compat get default export\",\"webpack:///nextcloud/webpack/runtime/define property getters\",\"webpack:///nextcloud/webpack/runtime/ensure chunk\",\"webpack:///nextcloud/webpack/runtime/global\",\"webpack:///nextcloud/webpack/runtime/hasOwnProperty shorthand\",\"webpack:///nextcloud/webpack/runtime/make namespace object\",\"webpack:///nextcloud/webpack/runtime/node module decorator\",\"webpack:///nextcloud/webpack/runtime/runtimeId\",\"webpack:///nextcloud/webpack/runtime/jsonp chunk loading\",\"webpack:///nextcloud/webpack/runtime/nonce\",\"webpack:///nextcloud/webpack/startup\"],\"sourcesContent\":[\"var deferred = [];\\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\\n\\tif(chunkIds) {\\n\\t\\tpriority = priority || 0;\\n\\t\\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\\n\\t\\tdeferred[i] = [chunkIds, fn, priority];\\n\\t\\treturn;\\n\\t}\\n\\tvar notFulfilled = Infinity;\\n\\tfor (var i = 0; i < deferred.length; i++) {\\n\\t\\tvar chunkIds = deferred[i][0];\\n\\t\\tvar fn = deferred[i][1];\\n\\t\\tvar priority = deferred[i][2];\\n\\t\\tvar fulfilled = true;\\n\\t\\tfor (var j = 0; j < chunkIds.length; j++) {\\n\\t\\t\\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\\n\\t\\t\\t\\tchunkIds.splice(j--, 1);\\n\\t\\t\\t} else {\\n\\t\\t\\t\\tfulfilled = false;\\n\\t\\t\\t\\tif(priority < notFulfilled) notFulfilled = priority;\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif(fulfilled) {\\n\\t\\t\\tdeferred.splice(i--, 1)\\n\\t\\t\\tvar r = fn();\\n\\t\\t\\tif (r !== undefined) result = r;\\n\\t\\t}\\n\\t}\\n\\treturn result;\\n};\",\"<template>\\n  <span v-bind=\\\"$attrs\\\"\\n        :aria-hidden=\\\"title ? null : true\\\"\\n        :aria-label=\\\"title\\\"\\n        class=\\\"material-design-icon eye-outline-icon\\\"\\n        role=\\\"img\\\"\\n        @click=\\\"$emit('click', $event)\\\">\\n    <svg :fill=\\\"fillColor\\\"\\n         class=\\\"material-design-icon__svg\\\"\\n         :width=\\\"size\\\"\\n         :height=\\\"size\\\"\\n         viewBox=\\\"0 0 24 24\\\">\\n      <path d=\\\"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z\\\">\\n        <title v-if=\\\"title\\\">{{ title }}</title>\\n      </path>\\n    </svg>\\n  </span>\\n</template>\\n\\n<script>\\nexport default {\\n  name: \\\"EyeOutlineIcon\\\",\\n  emits: ['click'],\\n  props: {\\n    title: {\\n      type: String,\\n    },\\n    fillColor: {\\n      type: String,\\n      default: \\\"currentColor\\\"\\n    },\\n    size: {\\n      type: Number,\\n      default: 24\\n    }\\n  }\\n}\\n</script>\",\"import mod from \\\"-!../vue-loader/lib/index.js??vue-loader-options!./EyeOutline.vue?vue&type=script&lang=js\\\"; export default mod; export * from \\\"-!../vue-loader/lib/index.js??vue-loader-options!./EyeOutline.vue?vue&type=script&lang=js\\\"\",\"import { render, staticRenderFns } from \\\"./EyeOutline.vue?vue&type=template&id=30219a41\\\"\\nimport script from \\\"./EyeOutline.vue?vue&type=script&lang=js\\\"\\nexport * from \\\"./EyeOutline.vue?vue&type=script&lang=js\\\"\\n\\n\\n/* normalize component */\\nimport normalizer from \\\"!../vue-loader/lib/runtime/componentNormalizer.js\\\"\\nvar component = normalizer(\\n  script,\\n  render,\\n  staticRenderFns,\\n  false,\\n  null,\\n  null,\\n  null\\n  \\n)\\n\\nexport default component.exports\",\"var render = function render(){var _vm=this,_c=_vm._self._c;return _c('span',_vm._b({staticClass:\\\"material-design-icon eye-outline-icon\\\",attrs:{\\\"aria-hidden\\\":_vm.title ? null : true,\\\"aria-label\\\":_vm.title,\\\"role\\\":\\\"img\\\"},on:{\\\"click\\\":function($event){return _vm.$emit('click', $event)}}},'span',_vm.$attrs,false),[_c('svg',{staticClass:\\\"material-design-icon__svg\\\",attrs:{\\\"fill\\\":_vm.fillColor,\\\"width\\\":_vm.size,\\\"height\\\":_vm.size,\\\"viewBox\\\":\\\"0 0 24 24\\\"}},[_c('path',{attrs:{\\\"d\\\":\\\"M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9M12,4.5C17,4.5 21.27,7.61 23,12C21.27,16.39 17,19.5 12,19.5C7,19.5 2.73,16.39 1,12C2.73,7.61 7,4.5 12,4.5M3.18,12C4.83,15.36 8.24,17.5 12,17.5C15.76,17.5 19.17,15.36 20.82,12C19.17,8.64 15.76,6.5 12,6.5C8.24,6.5 4.83,8.64 3.18,12Z\\\"}},[(_vm.title)?_c('title',[_vm._v(_vm._s(_vm.title))]):_vm._e()])])])\\n}\\nvar staticRenderFns = []\\n\\nexport { render, staticRenderFns }\",\"<!--\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\n-->\\n<template>\\n\\t<tr>\\n\\t\\t<td>{{ name }}</td>\\n\\t\\t<td>{{ redirectUri }}</td>\\n\\t\\t<td><code>{{ clientId }}</code></td>\\n\\t\\t<td>\\n\\t\\t\\t<div class=\\\"action-secret\\\">\\n\\t\\t\\t\\t<code>{{ renderedSecret }}</code>\\n\\t\\t\\t\\t<NcButton v-if=\\\"clientSecret !== ''\\\"\\n\\t\\t\\t\\t\\ttype=\\\"tertiary-no-background\\\"\\n\\t\\t\\t\\t\\t:aria-label=\\\"toggleAriaLabel\\\"\\n\\t\\t\\t\\t\\t@click=\\\"toggleSecret\\\">\\n\\t\\t\\t\\t\\t<template #icon>\\n\\t\\t\\t\\t\\t\\t<EyeOutline :size=\\\"20\\\" />\\n\\t\\t\\t\\t\\t</template>\\n\\t\\t\\t\\t</NcButton>\\n\\t\\t\\t</div>\\n\\t\\t</td>\\n\\t\\t<td class=\\\"action-column\\\">\\n\\t\\t\\t<NcButton type=\\\"tertiary-no-background\\\"\\n\\t\\t\\t\\t:aria-label=\\\"t('oauth2', 'Delete')\\\"\\n\\t\\t\\t\\t@click=\\\"$emit('delete', id)\\\">\\n\\t\\t\\t\\t<template #icon>\\n\\t\\t\\t\\t\\t<Delete :size=\\\"20\\\"\\n\\t\\t\\t\\t\\t\\t:title=\\\"t('oauth2', 'Delete')\\\" />\\n\\t\\t\\t\\t</template>\\n\\t\\t\\t</NcButton>\\n\\t\\t</td>\\n\\t</tr>\\n</template>\\n\\n<script>\\n\\nimport Delete from 'vue-material-design-icons/Delete.vue'\\nimport EyeOutline from 'vue-material-design-icons/EyeOutline.vue'\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\n\\nexport default {\\n\\tname: 'OAuthItem',\\n\\tcomponents: {\\n\\t\\tDelete,\\n\\t\\tNcButton,\\n\\t\\tEyeOutline,\\n\\t},\\n\\tprops: {\\n\\t\\tclient: {\\n\\t\\t\\ttype: Object,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tid: this.client.id,\\n\\t\\t\\tname: this.client.name,\\n\\t\\t\\tredirectUri: this.client.redirectUri,\\n\\t\\t\\tclientId: this.client.clientId,\\n\\t\\t\\tclientSecret: this.client.clientSecret,\\n\\t\\t\\trenderSecret: false,\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\trenderedSecret() {\\n\\t\\t\\tif (this.renderSecret) {\\n\\t\\t\\t\\treturn this.clientSecret\\n\\t\\t\\t} else {\\n\\t\\t\\t\\treturn '****'\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\ttoggleAriaLabel() {\\n\\t\\t\\tif (!this.renderSecret) {\\n\\t\\t\\t\\treturn t('oauth2', 'Show client secret')\\n\\t\\t\\t}\\n\\t\\t\\treturn t('oauth2', 'Hide client secret')\\n\\t\\t},\\n\\t},\\n\\tmethods: {\\n\\t\\ttoggleSecret() {\\n\\t\\t\\tthis.renderSecret = !this.renderSecret\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n\\n<style scoped>\\n\\t.action-secret {\\n\\t\\tdisplay: flex;\\n\\t\\talign-items: center;\\n\\t}\\n\\t.action-secret code {\\n\\t\\tpadding-top: 5px;\\n\\t}\\n\\ttd code {\\n\\t\\tdisplay: inline-block;\\n\\t\\tvertical-align: middle;\\n\\t}\\n\\ttable.inline td {\\n\\t\\tborder: none;\\n\\t\\tpadding: 5px;\\n\\t}\\n\\n\\t.action-column {\\n\\t\\tdisplay: flex;\\n\\t\\tjustify-content: flex-end;\\n\\t\\tpadding-inline-end: 0;\\n\\t}\\n</style>\\n\",\"import mod from \\\"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OAuthItem.vue?vue&type=script&lang=js\\\"; export default mod; export * from \\\"-!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OAuthItem.vue?vue&type=script&lang=js\\\"\",\"\\n      import API from \\\"!../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\\\";\\n      import domAPI from \\\"!../../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\\\";\\n      import insertFn from \\\"!../../../../node_modules/style-loader/dist/runtime/insertBySelector.js\\\";\\n      import setAttributes from \\\"!../../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\\\";\\n      import insertStyleElement from \\\"!../../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\\\";\\n      import styleTagTransformFn from \\\"!../../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\\\";\\n      import content, * as namedExport from \\\"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OAuthItem.vue?vue&type=style&index=0&id=39c6252a&prod&scoped=true&lang=css\\\";\\n      \\n      \\n\\nvar options = {};\\n\\noptions.styleTagTransform = styleTagTransformFn;\\noptions.setAttributes = setAttributes;\\n\\n      options.insert = insertFn.bind(null, \\\"head\\\");\\n    \\noptions.domAPI = domAPI;\\noptions.insertStyleElement = insertStyleElement;\\n\\nvar update = API(content, options);\\n\\n\\n\\nexport * from \\\"!!../../../../node_modules/css-loader/dist/cjs.js!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OAuthItem.vue?vue&type=style&index=0&id=39c6252a&prod&scoped=true&lang=css\\\";\\n       export default content && content.locals ? content.locals : undefined;\\n\",\"import { render, staticRenderFns } from \\\"./OAuthItem.vue?vue&type=template&id=39c6252a&scoped=true\\\"\\nimport script from \\\"./OAuthItem.vue?vue&type=script&lang=js\\\"\\nexport * from \\\"./OAuthItem.vue?vue&type=script&lang=js\\\"\\nimport style0 from \\\"./OAuthItem.vue?vue&type=style&index=0&id=39c6252a&prod&scoped=true&lang=css\\\"\\n\\n\\n/* normalize component */\\nimport normalizer from \\\"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\\\"\\nvar component = normalizer(\\n  script,\\n  render,\\n  staticRenderFns,\\n  false,\\n  null,\\n  \\\"39c6252a\\\",\\n  null\\n  \\n)\\n\\nexport default component.exports\",\"var render = function render(){var _vm=this,_c=_vm._self._c;return _c('tr',[_c('td',[_vm._v(_vm._s(_vm.name))]),_vm._v(\\\" \\\"),_c('td',[_vm._v(_vm._s(_vm.redirectUri))]),_vm._v(\\\" \\\"),_c('td',[_c('code',[_vm._v(_vm._s(_vm.clientId))])]),_vm._v(\\\" \\\"),_c('td',[_c('div',{staticClass:\\\"action-secret\\\"},[_c('code',[_vm._v(_vm._s(_vm.renderedSecret))]),_vm._v(\\\" \\\"),(_vm.clientSecret !== '')?_c('NcButton',{attrs:{\\\"type\\\":\\\"tertiary-no-background\\\",\\\"aria-label\\\":_vm.toggleAriaLabel},on:{\\\"click\\\":_vm.toggleSecret},scopedSlots:_vm._u([{key:\\\"icon\\\",fn:function(){return [_c('EyeOutline',{attrs:{\\\"size\\\":20}})]},proxy:true}],null,false,2687940113)}):_vm._e()],1)]),_vm._v(\\\" \\\"),_c('td',{staticClass:\\\"action-column\\\"},[_c('NcButton',{attrs:{\\\"type\\\":\\\"tertiary-no-background\\\",\\\"aria-label\\\":_vm.t('oauth2', 'Delete')},on:{\\\"click\\\":function($event){return _vm.$emit('delete', _vm.id)}},scopedSlots:_vm._u([{key:\\\"icon\\\",fn:function(){return [_c('Delete',{attrs:{\\\"size\\\":20,\\\"title\\\":_vm.t('oauth2', 'Delete')}})]},proxy:true}])})],1)])\\n}\\nvar staticRenderFns = []\\n\\nexport { render, staticRenderFns }\",\"<!--\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\n-->\\n<template>\\n\\t<NcSettingsSection :name=\\\"t('oauth2', 'OAuth 2.0 clients')\\\"\\n\\t\\t:description=\\\"t('oauth2', 'OAuth 2.0 allows external services to request access to {instanceName}.', { instanceName })\\\"\\n\\t\\t:doc-url=\\\"oauthDocLink\\\">\\n\\t\\t<table v-if=\\\"clients.length > 0\\\" class=\\\"grid\\\">\\n\\t\\t\\t<thead>\\n\\t\\t\\t\\t<tr>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Name') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Redirection URI') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Client Identifier') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Secret key') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t\\t<th>\\n\\t\\t\\t\\t\\t\\t{{ t('oauth2', 'Delete client') }}\\n\\t\\t\\t\\t\\t</th>\\n\\t\\t\\t\\t</tr>\\n\\t\\t\\t</thead>\\n\\t\\t\\t<tbody>\\n\\t\\t\\t\\t<OAuthItem v-for=\\\"client in clients\\\"\\n\\t\\t\\t\\t\\t:key=\\\"client.id\\\"\\n\\t\\t\\t\\t\\t:client=\\\"client\\\"\\n\\t\\t\\t\\t\\t@delete=\\\"deleteClient\\\" />\\n\\t\\t\\t</tbody>\\n\\t\\t</table>\\n\\t\\t<NcNoteCard v-if=\\\"showSecretWarning\\\"\\n\\t\\t\\ttype=\\\"warning\\\">\\n\\t\\t\\t{{ t('oauth2', 'Make sure you store the secret key, it cannot be recovered.') }}\\n\\t\\t</NcNoteCard>\\n\\n\\t\\t<br>\\n\\t\\t<h3>{{ t('oauth2', 'Add client') }}</h3>\\n\\t\\t<span v-if=\\\"newClient.error\\\" class=\\\"msg error\\\">{{ newClient.errorMsg }}</span>\\n\\t\\t<form class=\\\"oauth2-form\\\" @submit.prevent=\\\"addClient\\\">\\n\\t\\t\\t<NcTextField id=\\\"name\\\"\\n\\t\\t\\t\\t:value.sync=\\\"newClient.name\\\"\\n\\t\\t\\t\\ttype=\\\"text\\\"\\n\\t\\t\\t\\tclass=\\\"oauth2-form--input\\\"\\n\\t\\t\\t\\tname=\\\"name\\\"\\n\\t\\t\\t\\t:label=\\\"t('oauth2', 'Name')\\\"\\n\\t\\t\\t\\t:placeholder=\\\"t('oauth2', 'Name')\\\" />\\n\\t\\t\\t<NcTextField id=\\\"redirectUri\\\"\\n\\t\\t\\t\\t:value.sync=\\\"newClient.redirectUri\\\"\\n\\t\\t\\t\\ttype=\\\"url\\\"\\n\\t\\t\\t\\tclass=\\\"oauth2-form--input\\\"\\n\\t\\t\\t\\tname=\\\"redirectUri\\\"\\n\\t\\t\\t\\t:label=\\\"t('oauth2', 'Redirection URI')\\\"\\n\\t\\t\\t\\t:placeholder=\\\"t('oauth2', 'Redirection URI')\\\" />\\n\\t\\t\\t<NcButton native-type=\\\"submit\\\" class=\\\"inline-button\\\">\\n\\t\\t\\t\\t{{ t('oauth2', 'Add') }}\\n\\t\\t\\t</NcButton>\\n\\t\\t</form>\\n\\t</NcSettingsSection>\\n</template>\\n\\n<script>\\nimport axios from '@nextcloud/axios'\\nimport OAuthItem from './components/OAuthItem.vue'\\nimport { generateUrl } from '@nextcloud/router'\\nimport { getCapabilities } from '@nextcloud/capabilities'\\nimport NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\nimport NcNoteCard from '@nextcloud/vue/dist/Components/NcNoteCard.js'\\nimport { loadState } from '@nextcloud/initial-state'\\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\\n\\nexport default {\\n\\tname: 'App',\\n\\tcomponents: {\\n\\t\\tOAuthItem,\\n\\t\\tNcSettingsSection,\\n\\t\\tNcButton,\\n\\t\\tNcTextField,\\n\\t\\tNcNoteCard,\\n\\t},\\n\\tprops: {\\n\\t\\tclients: {\\n\\t\\t\\ttype: Array,\\n\\t\\t\\trequired: true,\\n\\t\\t},\\n\\t},\\n\\tdata() {\\n\\t\\treturn {\\n\\t\\t\\tnewClient: {\\n\\t\\t\\t\\tname: '',\\n\\t\\t\\t\\tredirectUri: '',\\n\\t\\t\\t\\terrorMsg: '',\\n\\t\\t\\t\\terror: false,\\n\\t\\t\\t},\\n\\t\\t\\toauthDocLink: loadState('oauth2', 'oauth2-doc-link'),\\n\\t\\t\\tshowSecretWarning: false,\\n\\t\\t}\\n\\t},\\n\\tcomputed: {\\n\\t\\tinstanceName() {\\n\\t\\t\\treturn getCapabilities().theming.name\\n\\t\\t},\\n\\t},\\n\\tmethods: {\\n\\t\\tdeleteClient(id) {\\n\\t\\t\\taxios.delete(generateUrl('apps/oauth2/clients/{id}', { id }))\\n\\t\\t\\t\\t.then(() => {\\n\\t\\t\\t\\t\\t// eslint-disable-next-line vue/no-mutating-props\\n\\t\\t\\t\\t\\tthis.clients = this.clients.filter(client => client.id !== id)\\n\\t\\t\\t\\t})\\n\\t\\t},\\n\\t\\taddClient() {\\n\\t\\t\\tthis.newClient.error = false\\n\\n\\t\\t\\taxios.post(\\n\\t\\t\\t\\tgenerateUrl('apps/oauth2/clients'),\\n\\t\\t\\t\\t{\\n\\t\\t\\t\\t\\tname: this.newClient.name,\\n\\t\\t\\t\\t\\tredirectUri: this.newClient.redirectUri,\\n\\t\\t\\t\\t},\\n\\t\\t\\t).then(response => {\\n\\t\\t\\t\\t// eslint-disable-next-line vue/no-mutating-props\\n\\t\\t\\t\\tthis.clients.push(response.data)\\n\\t\\t\\t\\tthis.showSecretWarning = true\\n\\n\\t\\t\\t\\tthis.newClient.name = ''\\n\\t\\t\\t\\tthis.newClient.redirectUri = ''\\n\\t\\t\\t}).catch(reason => {\\n\\t\\t\\t\\tthis.newClient.error = true\\n\\t\\t\\t\\tthis.newClient.errorMsg = reason.response.data.message\\n\\t\\t\\t})\\n\\t\\t},\\n\\t},\\n}\\n</script>\\n<style scoped>\\n\\ttable {\\n\\t\\tmax-width: 800px;\\n\\t}\\n\\n\\t/** Overwrite button height and position to be aligned with the text input */\\n\\t.inline-button {\\n\\t\\tmin-height: 34px !important;\\n\\t\\tdisplay: inline-flex !important;\\n\\t}\\n\\t.oauth2-form {\\n\\t\\tdisplay: flex;\\n\\t\\tflex-direction: row;\\n\\t}\\n\\t.oauth2-form--input {\\n\\t\\tmax-width: 200px;\\n\\t\\tmargin-inline-end: 10px;\\n\\t}\\n</style>\\n\",\"import mod from \\\"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js\\\"; export default mod; export * from \\\"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js\\\"\",\"\\n      import API from \\\"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\\\";\\n      import domAPI from \\\"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\\\";\\n      import insertFn from \\\"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\\\";\\n      import setAttributes from \\\"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\\\";\\n      import insertStyleElement from \\\"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\\\";\\n      import styleTagTransformFn from \\\"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\\\";\\n      import content, * as namedExport from \\\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&id=597479ba&prod&scoped=true&lang=css\\\";\\n      \\n      \\n\\nvar options = {};\\n\\noptions.styleTagTransform = styleTagTransformFn;\\noptions.setAttributes = setAttributes;\\n\\n      options.insert = insertFn.bind(null, \\\"head\\\");\\n    \\noptions.domAPI = domAPI;\\noptions.insertStyleElement = insertStyleElement;\\n\\nvar update = API(content, options);\\n\\n\\n\\nexport * from \\\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&id=597479ba&prod&scoped=true&lang=css\\\";\\n       export default content && content.locals ? content.locals : undefined;\\n\",\"import { render, staticRenderFns } from \\\"./App.vue?vue&type=template&id=597479ba&scoped=true\\\"\\nimport script from \\\"./App.vue?vue&type=script&lang=js\\\"\\nexport * from \\\"./App.vue?vue&type=script&lang=js\\\"\\nimport style0 from \\\"./App.vue?vue&type=style&index=0&id=597479ba&prod&scoped=true&lang=css\\\"\\n\\n\\n/* normalize component */\\nimport normalizer from \\\"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\\\"\\nvar component = normalizer(\\n  script,\\n  render,\\n  staticRenderFns,\\n  false,\\n  null,\\n  \\\"597479ba\\\",\\n  null\\n  \\n)\\n\\nexport default component.exports\",\"var render = function render(){var _vm=this,_c=_vm._self._c;return _c('NcSettingsSection',{attrs:{\\\"name\\\":_vm.t('oauth2', 'OAuth 2.0 clients'),\\\"description\\\":_vm.t('oauth2', 'OAuth 2.0 allows external services to request access to {instanceName}.', { instanceName: _vm.instanceName }),\\\"doc-url\\\":_vm.oauthDocLink}},[(_vm.clients.length > 0)?_c('table',{staticClass:\\\"grid\\\"},[_c('thead',[_c('tr',[_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Name'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")]),_vm._v(\\\" \\\"),_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Redirection URI'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")]),_vm._v(\\\" \\\"),_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Client Identifier'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")]),_vm._v(\\\" \\\"),_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Secret key'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")]),_vm._v(\\\" \\\"),_c('th',[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Delete client'))+\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\")])])]),_vm._v(\\\" \\\"),_c('tbody',_vm._l((_vm.clients),function(client){return _c('OAuthItem',{key:client.id,attrs:{\\\"client\\\":client},on:{\\\"delete\\\":_vm.deleteClient}})}),1)]):_vm._e(),_vm._v(\\\" \\\"),(_vm.showSecretWarning)?_c('NcNoteCard',{attrs:{\\\"type\\\":\\\"warning\\\"}},[_vm._v(\\\"\\\\n\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Make sure you store the secret key, it cannot be recovered.'))+\\\"\\\\n\\\\t\\\")]):_vm._e(),_vm._v(\\\" \\\"),_c('br'),_vm._v(\\\" \\\"),_c('h3',[_vm._v(_vm._s(_vm.t('oauth2', 'Add client')))]),_vm._v(\\\" \\\"),(_vm.newClient.error)?_c('span',{staticClass:\\\"msg error\\\"},[_vm._v(_vm._s(_vm.newClient.errorMsg))]):_vm._e(),_vm._v(\\\" \\\"),_c('form',{staticClass:\\\"oauth2-form\\\",on:{\\\"submit\\\":function($event){$event.preventDefault();return _vm.addClient.apply(null, arguments)}}},[_c('NcTextField',{staticClass:\\\"oauth2-form--input\\\",attrs:{\\\"id\\\":\\\"name\\\",\\\"value\\\":_vm.newClient.name,\\\"type\\\":\\\"text\\\",\\\"name\\\":\\\"name\\\",\\\"label\\\":_vm.t('oauth2', 'Name'),\\\"placeholder\\\":_vm.t('oauth2', 'Name')},on:{\\\"update:value\\\":function($event){return _vm.$set(_vm.newClient, \\\"name\\\", $event)}}}),_vm._v(\\\" \\\"),_c('NcTextField',{staticClass:\\\"oauth2-form--input\\\",attrs:{\\\"id\\\":\\\"redirectUri\\\",\\\"value\\\":_vm.newClient.redirectUri,\\\"type\\\":\\\"url\\\",\\\"name\\\":\\\"redirectUri\\\",\\\"label\\\":_vm.t('oauth2', 'Redirection URI'),\\\"placeholder\\\":_vm.t('oauth2', 'Redirection URI')},on:{\\\"update:value\\\":function($event){return _vm.$set(_vm.newClient, \\\"redirectUri\\\", $event)}}}),_vm._v(\\\" \\\"),_c('NcButton',{staticClass:\\\"inline-button\\\",attrs:{\\\"native-type\\\":\\\"submit\\\"}},[_vm._v(\\\"\\\\n\\\\t\\\\t\\\\t\\\"+_vm._s(_vm.t('oauth2', 'Add'))+\\\"\\\\n\\\\t\\\\t\\\")])],1)],1)\\n}\\nvar staticRenderFns = []\\n\\nexport { render, staticRenderFns }\",\"/**\\n * SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\n * SPDX-License-Identifier: AGPL-3.0-or-later\\n */\\n\\nimport Vue from 'vue'\\nimport App from './App.vue'\\nimport { loadState } from '@nextcloud/initial-state'\\n\\nVue.prototype.t = t\\nVue.prototype.OC = OC\\n\\nconst clients = loadState('oauth2', 'clients')\\n\\nconst View = Vue.extend(App)\\nconst oauth = new View({\\n\\tpropsData: {\\n\\t\\tclients,\\n\\t},\\n})\\noauth.$mount('#oauth2')\\n\",\"// Imports\\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \\\"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\\\";\\nimport ___CSS_LOADER_API_IMPORT___ from \\\"../../../node_modules/css-loader/dist/runtime/api.js\\\";\\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\\n// Module\\n___CSS_LOADER_EXPORT___.push([module.id, `\\ntable[data-v-597479ba] {\\n\\tmax-width: 800px;\\n}\\n\\n/** Overwrite button height and position to be aligned with the text input */\\n.inline-button[data-v-597479ba] {\\n\\tmin-height: 34px !important;\\n\\tdisplay: inline-flex !important;\\n}\\n.oauth2-form[data-v-597479ba] {\\n\\tdisplay: flex;\\n\\tflex-direction: row;\\n}\\n.oauth2-form--input[data-v-597479ba] {\\n\\tmax-width: 200px;\\n\\tmargin-inline-end: 10px;\\n}\\n`, \\\"\\\",{\\\"version\\\":3,\\\"sources\\\":[\\\"webpack://./apps/oauth2/src/App.vue\\\"],\\\"names\\\":[],\\\"mappings\\\":\\\";AAgKA;CACA,gBAAA;AACA;;AAEA,4EAAA;AACA;CACA,2BAAA;CACA,+BAAA;AACA;AACA;CACA,aAAA;CACA,mBAAA;AACA;AACA;CACA,gBAAA;CACA,uBAAA;AACA\\\",\\\"sourcesContent\\\":[\\\"<!--\\\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\\\n-->\\\\n<template>\\\\n\\\\t<NcSettingsSection :name=\\\\\\\"t('oauth2', 'OAuth 2.0 clients')\\\\\\\"\\\\n\\\\t\\\\t:description=\\\\\\\"t('oauth2', 'OAuth 2.0 allows external services to request access to {instanceName}.', { instanceName })\\\\\\\"\\\\n\\\\t\\\\t:doc-url=\\\\\\\"oauthDocLink\\\\\\\">\\\\n\\\\t\\\\t<table v-if=\\\\\\\"clients.length > 0\\\\\\\" class=\\\\\\\"grid\\\\\\\">\\\\n\\\\t\\\\t\\\\t<thead>\\\\n\\\\t\\\\t\\\\t\\\\t<tr>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Name') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Redirection URI') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Client Identifier') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Secret key') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<th>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Delete client') }}\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</th>\\\\n\\\\t\\\\t\\\\t\\\\t</tr>\\\\n\\\\t\\\\t\\\\t</thead>\\\\n\\\\t\\\\t\\\\t<tbody>\\\\n\\\\t\\\\t\\\\t\\\\t<OAuthItem v-for=\\\\\\\"client in clients\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t:key=\\\\\\\"client.id\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t:client=\\\\\\\"client\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t@delete=\\\\\\\"deleteClient\\\\\\\" />\\\\n\\\\t\\\\t\\\\t</tbody>\\\\n\\\\t\\\\t</table>\\\\n\\\\t\\\\t<NcNoteCard v-if=\\\\\\\"showSecretWarning\\\\\\\"\\\\n\\\\t\\\\t\\\\ttype=\\\\\\\"warning\\\\\\\">\\\\n\\\\t\\\\t\\\\t{{ t('oauth2', 'Make sure you store the secret key, it cannot be recovered.') }}\\\\n\\\\t\\\\t</NcNoteCard>\\\\n\\\\n\\\\t\\\\t<br>\\\\n\\\\t\\\\t<h3>{{ t('oauth2', 'Add client') }}</h3>\\\\n\\\\t\\\\t<span v-if=\\\\\\\"newClient.error\\\\\\\" class=\\\\\\\"msg error\\\\\\\">{{ newClient.errorMsg }}</span>\\\\n\\\\t\\\\t<form class=\\\\\\\"oauth2-form\\\\\\\" @submit.prevent=\\\\\\\"addClient\\\\\\\">\\\\n\\\\t\\\\t\\\\t<NcTextField id=\\\\\\\"name\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:value.sync=\\\\\\\"newClient.name\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\ttype=\\\\\\\"text\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\tclass=\\\\\\\"oauth2-form--input\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\tname=\\\\\\\"name\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:label=\\\\\\\"t('oauth2', 'Name')\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:placeholder=\\\\\\\"t('oauth2', 'Name')\\\\\\\" />\\\\n\\\\t\\\\t\\\\t<NcTextField id=\\\\\\\"redirectUri\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:value.sync=\\\\\\\"newClient.redirectUri\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\ttype=\\\\\\\"url\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\tclass=\\\\\\\"oauth2-form--input\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\tname=\\\\\\\"redirectUri\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:label=\\\\\\\"t('oauth2', 'Redirection URI')\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:placeholder=\\\\\\\"t('oauth2', 'Redirection URI')\\\\\\\" />\\\\n\\\\t\\\\t\\\\t<NcButton native-type=\\\\\\\"submit\\\\\\\" class=\\\\\\\"inline-button\\\\\\\">\\\\n\\\\t\\\\t\\\\t\\\\t{{ t('oauth2', 'Add') }}\\\\n\\\\t\\\\t\\\\t</NcButton>\\\\n\\\\t\\\\t</form>\\\\n\\\\t</NcSettingsSection>\\\\n</template>\\\\n\\\\n<script>\\\\nimport axios from '@nextcloud/axios'\\\\nimport OAuthItem from './components/OAuthItem.vue'\\\\nimport { generateUrl } from '@nextcloud/router'\\\\nimport { getCapabilities } from '@nextcloud/capabilities'\\\\nimport NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\\\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\\\nimport NcNoteCard from '@nextcloud/vue/dist/Components/NcNoteCard.js'\\\\nimport { loadState } from '@nextcloud/initial-state'\\\\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\\\\n\\\\nexport default {\\\\n\\\\tname: 'App',\\\\n\\\\tcomponents: {\\\\n\\\\t\\\\tOAuthItem,\\\\n\\\\t\\\\tNcSettingsSection,\\\\n\\\\t\\\\tNcButton,\\\\n\\\\t\\\\tNcTextField,\\\\n\\\\t\\\\tNcNoteCard,\\\\n\\\\t},\\\\n\\\\tprops: {\\\\n\\\\t\\\\tclients: {\\\\n\\\\t\\\\t\\\\ttype: Array,\\\\n\\\\t\\\\t\\\\trequired: true,\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n\\\\tdata() {\\\\n\\\\t\\\\treturn {\\\\n\\\\t\\\\t\\\\tnewClient: {\\\\n\\\\t\\\\t\\\\t\\\\tname: '',\\\\n\\\\t\\\\t\\\\t\\\\tredirectUri: '',\\\\n\\\\t\\\\t\\\\t\\\\terrorMsg: '',\\\\n\\\\t\\\\t\\\\t\\\\terror: false,\\\\n\\\\t\\\\t\\\\t},\\\\n\\\\t\\\\t\\\\toauthDocLink: loadState('oauth2', 'oauth2-doc-link'),\\\\n\\\\t\\\\t\\\\tshowSecretWarning: false,\\\\n\\\\t\\\\t}\\\\n\\\\t},\\\\n\\\\tcomputed: {\\\\n\\\\t\\\\tinstanceName() {\\\\n\\\\t\\\\t\\\\treturn getCapabilities().theming.name\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n\\\\tmethods: {\\\\n\\\\t\\\\tdeleteClient(id) {\\\\n\\\\t\\\\t\\\\taxios.delete(generateUrl('apps/oauth2/clients/{id}', { id }))\\\\n\\\\t\\\\t\\\\t\\\\t.then(() => {\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t// eslint-disable-next-line vue/no-mutating-props\\\\n\\\\t\\\\t\\\\t\\\\t\\\\tthis.clients = this.clients.filter(client => client.id !== id)\\\\n\\\\t\\\\t\\\\t\\\\t})\\\\n\\\\t\\\\t},\\\\n\\\\t\\\\taddClient() {\\\\n\\\\t\\\\t\\\\tthis.newClient.error = false\\\\n\\\\n\\\\t\\\\t\\\\taxios.post(\\\\n\\\\t\\\\t\\\\t\\\\tgenerateUrl('apps/oauth2/clients'),\\\\n\\\\t\\\\t\\\\t\\\\t{\\\\n\\\\t\\\\t\\\\t\\\\t\\\\tname: this.newClient.name,\\\\n\\\\t\\\\t\\\\t\\\\t\\\\tredirectUri: this.newClient.redirectUri,\\\\n\\\\t\\\\t\\\\t\\\\t},\\\\n\\\\t\\\\t\\\\t).then(response => {\\\\n\\\\t\\\\t\\\\t\\\\t// eslint-disable-next-line vue/no-mutating-props\\\\n\\\\t\\\\t\\\\t\\\\tthis.clients.push(response.data)\\\\n\\\\t\\\\t\\\\t\\\\tthis.showSecretWarning = true\\\\n\\\\n\\\\t\\\\t\\\\t\\\\tthis.newClient.name = ''\\\\n\\\\t\\\\t\\\\t\\\\tthis.newClient.redirectUri = ''\\\\n\\\\t\\\\t\\\\t}).catch(reason => {\\\\n\\\\t\\\\t\\\\t\\\\tthis.newClient.error = true\\\\n\\\\t\\\\t\\\\t\\\\tthis.newClient.errorMsg = reason.response.data.message\\\\n\\\\t\\\\t\\\\t})\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n}\\\\n</script>\\\\n<style scoped>\\\\n\\\\ttable {\\\\n\\\\t\\\\tmax-width: 800px;\\\\n\\\\t}\\\\n\\\\n\\\\t/** Overwrite button height and position to be aligned with the text input */\\\\n\\\\t.inline-button {\\\\n\\\\t\\\\tmin-height: 34px !important;\\\\n\\\\t\\\\tdisplay: inline-flex !important;\\\\n\\\\t}\\\\n\\\\t.oauth2-form {\\\\n\\\\t\\\\tdisplay: flex;\\\\n\\\\t\\\\tflex-direction: row;\\\\n\\\\t}\\\\n\\\\t.oauth2-form--input {\\\\n\\\\t\\\\tmax-width: 200px;\\\\n\\\\t\\\\tmargin-inline-end: 10px;\\\\n\\\\t}\\\\n</style>\\\\n\\\"],\\\"sourceRoot\\\":\\\"\\\"}]);\\n// Exports\\nexport default ___CSS_LOADER_EXPORT___;\\n\",\"// Imports\\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \\\"../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\\\";\\nimport ___CSS_LOADER_API_IMPORT___ from \\\"../../../../node_modules/css-loader/dist/runtime/api.js\\\";\\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\\n// Module\\n___CSS_LOADER_EXPORT___.push([module.id, `\\n.action-secret[data-v-39c6252a] {\\n\\tdisplay: flex;\\n\\talign-items: center;\\n}\\n.action-secret code[data-v-39c6252a] {\\n\\tpadding-top: 5px;\\n}\\ntd code[data-v-39c6252a] {\\n\\tdisplay: inline-block;\\n\\tvertical-align: middle;\\n}\\ntable.inline td[data-v-39c6252a] {\\n\\tborder: none;\\n\\tpadding: 5px;\\n}\\n.action-column[data-v-39c6252a] {\\n\\tdisplay: flex;\\n\\tjustify-content: flex-end;\\n\\tpadding-inline-end: 0;\\n}\\n`, \\\"\\\",{\\\"version\\\":3,\\\"sources\\\":[\\\"webpack://./apps/oauth2/src/components/OAuthItem.vue\\\"],\\\"names\\\":[],\\\"mappings\\\":\\\";AA+GA;CACA,aAAA;CACA,mBAAA;AACA;AACA;CACA,gBAAA;AACA;AACA;CACA,qBAAA;CACA,sBAAA;AACA;AACA;CACA,YAAA;CACA,YAAA;AACA;AAEA;CACA,aAAA;CACA,yBAAA;CACA,qBAAA;AACA\\\",\\\"sourcesContent\\\":[\\\"<!--\\\\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\\\\n  - SPDX-License-Identifier: AGPL-3.0-or-later\\\\n-->\\\\n<template>\\\\n\\\\t<tr>\\\\n\\\\t\\\\t<td>{{ name }}</td>\\\\n\\\\t\\\\t<td>{{ redirectUri }}</td>\\\\n\\\\t\\\\t<td><code>{{ clientId }}</code></td>\\\\n\\\\t\\\\t<td>\\\\n\\\\t\\\\t\\\\t<div class=\\\\\\\"action-secret\\\\\\\">\\\\n\\\\t\\\\t\\\\t\\\\t<code>{{ renderedSecret }}</code>\\\\n\\\\t\\\\t\\\\t\\\\t<NcButton v-if=\\\\\\\"clientSecret !== ''\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\ttype=\\\\\\\"tertiary-no-background\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t:aria-label=\\\\\\\"toggleAriaLabel\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t@click=\\\\\\\"toggleSecret\\\\\\\">\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<template #icon>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t<EyeOutline :size=\\\\\\\"20\\\\\\\" />\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t</template>\\\\n\\\\t\\\\t\\\\t\\\\t</NcButton>\\\\n\\\\t\\\\t\\\\t</div>\\\\n\\\\t\\\\t</td>\\\\n\\\\t\\\\t<td class=\\\\\\\"action-column\\\\\\\">\\\\n\\\\t\\\\t\\\\t<NcButton type=\\\\\\\"tertiary-no-background\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t:aria-label=\\\\\\\"t('oauth2', 'Delete')\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t@click=\\\\\\\"$emit('delete', id)\\\\\\\">\\\\n\\\\t\\\\t\\\\t\\\\t<template #icon>\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t<Delete :size=\\\\\\\"20\\\\\\\"\\\\n\\\\t\\\\t\\\\t\\\\t\\\\t\\\\t:title=\\\\\\\"t('oauth2', 'Delete')\\\\\\\" />\\\\n\\\\t\\\\t\\\\t\\\\t</template>\\\\n\\\\t\\\\t\\\\t</NcButton>\\\\n\\\\t\\\\t</td>\\\\n\\\\t</tr>\\\\n</template>\\\\n\\\\n<script>\\\\n\\\\nimport Delete from 'vue-material-design-icons/Delete.vue'\\\\nimport EyeOutline from 'vue-material-design-icons/EyeOutline.vue'\\\\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\\\\n\\\\nexport default {\\\\n\\\\tname: 'OAuthItem',\\\\n\\\\tcomponents: {\\\\n\\\\t\\\\tDelete,\\\\n\\\\t\\\\tNcButton,\\\\n\\\\t\\\\tEyeOutline,\\\\n\\\\t},\\\\n\\\\tprops: {\\\\n\\\\t\\\\tclient: {\\\\n\\\\t\\\\t\\\\ttype: Object,\\\\n\\\\t\\\\t\\\\trequired: true,\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n\\\\tdata() {\\\\n\\\\t\\\\treturn {\\\\n\\\\t\\\\t\\\\tid: this.client.id,\\\\n\\\\t\\\\t\\\\tname: this.client.name,\\\\n\\\\t\\\\t\\\\tredirectUri: this.client.redirectUri,\\\\n\\\\t\\\\t\\\\tclientId: this.client.clientId,\\\\n\\\\t\\\\t\\\\tclientSecret: this.client.clientSecret,\\\\n\\\\t\\\\t\\\\trenderSecret: false,\\\\n\\\\t\\\\t}\\\\n\\\\t},\\\\n\\\\tcomputed: {\\\\n\\\\t\\\\trenderedSecret() {\\\\n\\\\t\\\\t\\\\tif (this.renderSecret) {\\\\n\\\\t\\\\t\\\\t\\\\treturn this.clientSecret\\\\n\\\\t\\\\t\\\\t} else {\\\\n\\\\t\\\\t\\\\t\\\\treturn '****'\\\\n\\\\t\\\\t\\\\t}\\\\n\\\\t\\\\t},\\\\n\\\\t\\\\ttoggleAriaLabel() {\\\\n\\\\t\\\\t\\\\tif (!this.renderSecret) {\\\\n\\\\t\\\\t\\\\t\\\\treturn t('oauth2', 'Show client secret')\\\\n\\\\t\\\\t\\\\t}\\\\n\\\\t\\\\t\\\\treturn t('oauth2', 'Hide client secret')\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n\\\\tmethods: {\\\\n\\\\t\\\\ttoggleSecret() {\\\\n\\\\t\\\\t\\\\tthis.renderSecret = !this.renderSecret\\\\n\\\\t\\\\t},\\\\n\\\\t},\\\\n}\\\\n</script>\\\\n\\\\n<style scoped>\\\\n\\\\t.action-secret {\\\\n\\\\t\\\\tdisplay: flex;\\\\n\\\\t\\\\talign-items: center;\\\\n\\\\t}\\\\n\\\\t.action-secret code {\\\\n\\\\t\\\\tpadding-top: 5px;\\\\n\\\\t}\\\\n\\\\ttd code {\\\\n\\\\t\\\\tdisplay: inline-block;\\\\n\\\\t\\\\tvertical-align: middle;\\\\n\\\\t}\\\\n\\\\ttable.inline td {\\\\n\\\\t\\\\tborder: none;\\\\n\\\\t\\\\tpadding: 5px;\\\\n\\\\t}\\\\n\\\\n\\\\t.action-column {\\\\n\\\\t\\\\tdisplay: flex;\\\\n\\\\t\\\\tjustify-content: flex-end;\\\\n\\\\t\\\\tpadding-inline-end: 0;\\\\n\\\\t}\\\\n</style>\\\\n\\\"],\\\"sourceRoot\\\":\\\"\\\"}]);\\n// Exports\\nexport default ___CSS_LOADER_EXPORT___;\\n\",\"// The module cache\\nvar __webpack_module_cache__ = {};\\n\\n// The require function\\nfunction __webpack_require__(moduleId) {\\n\\t// Check if module is in cache\\n\\tvar cachedModule = __webpack_module_cache__[moduleId];\\n\\tif (cachedModule !== undefined) {\\n\\t\\treturn cachedModule.exports;\\n\\t}\\n\\t// Create a new module (and put it into the cache)\\n\\tvar module = __webpack_module_cache__[moduleId] = {\\n\\t\\tid: moduleId,\\n\\t\\tloaded: false,\\n\\t\\texports: {}\\n\\t};\\n\\n\\t// Execute the module function\\n\\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\\n\\n\\t// Flag the module as loaded\\n\\tmodule.loaded = true;\\n\\n\\t// Return the exports of the module\\n\\treturn module.exports;\\n}\\n\\n// expose the modules object (__webpack_modules__)\\n__webpack_require__.m = __webpack_modules__;\\n\\n\",\"// getDefaultExport function for compatibility with non-harmony modules\\n__webpack_require__.n = (module) => {\\n\\tvar getter = module && module.__esModule ?\\n\\t\\t() => (module['default']) :\\n\\t\\t() => (module);\\n\\t__webpack_require__.d(getter, { a: getter });\\n\\treturn getter;\\n};\",\"// define getter functions for harmony exports\\n__webpack_require__.d = (exports, definition) => {\\n\\tfor(var key in definition) {\\n\\t\\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\\n\\t\\t\\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\\n\\t\\t}\\n\\t}\\n};\",\"// The chunk loading function for additional chunks\\n// Since all referenced chunks are already included\\n// in this file, this function is empty here.\\n__webpack_require__.e = () => (Promise.resolve());\",\"__webpack_require__.g = (function() {\\n\\tif (typeof globalThis === 'object') return globalThis;\\n\\ttry {\\n\\t\\treturn this || new Function('return this')();\\n\\t} catch (e) {\\n\\t\\tif (typeof window === 'object') return window;\\n\\t}\\n})();\",\"__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))\",\"// define __esModule on exports\\n__webpack_require__.r = (exports) => {\\n\\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\\n\\t\\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\\n\\t}\\n\\tObject.defineProperty(exports, '__esModule', { value: true });\\n};\",\"__webpack_require__.nmd = (module) => {\\n\\tmodule.paths = [];\\n\\tif (!module.children) module.children = [];\\n\\treturn module;\\n};\",\"__webpack_require__.j = 6174;\",\"__webpack_require__.b = document.baseURI || self.location.href;\\n\\n// object to store loaded and loading chunks\\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\\nvar installedChunks = {\\n\\t6174: 0\\n};\\n\\n// no chunk on demand loading\\n\\n// no prefetching\\n\\n// no preloaded\\n\\n// no HMR\\n\\n// no HMR manifest\\n\\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\\n\\n// install a JSONP callback for chunk loading\\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\\n\\tvar chunkIds = data[0];\\n\\tvar moreModules = data[1];\\n\\tvar runtime = data[2];\\n\\t// add \\\"moreModules\\\" to the modules object,\\n\\t// then flag all \\\"chunkIds\\\" as loaded and fire callback\\n\\tvar moduleId, chunkId, i = 0;\\n\\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\\n\\t\\tfor(moduleId in moreModules) {\\n\\t\\t\\tif(__webpack_require__.o(moreModules, moduleId)) {\\n\\t\\t\\t\\t__webpack_require__.m[moduleId] = moreModules[moduleId];\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\tif(runtime) var result = runtime(__webpack_require__);\\n\\t}\\n\\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\\n\\tfor(;i < chunkIds.length; i++) {\\n\\t\\tchunkId = chunkIds[i];\\n\\t\\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\\n\\t\\t\\tinstalledChunks[chunkId][0]();\\n\\t\\t}\\n\\t\\tinstalledChunks[chunkId] = 0;\\n\\t}\\n\\treturn __webpack_require__.O(result);\\n}\\n\\nvar chunkLoadingGlobal = self[\\\"webpackChunknextcloud\\\"] = self[\\\"webpackChunknextcloud\\\"] || [];\\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\",\"__webpack_require__.nc = undefined;\",\"// startup\\n// Load entry module and return exports\\n// This entry module depends on other loaded chunks and execution need to be delayed\\nvar __webpack_exports__ = __webpack_require__.O(undefined, [4208], () => (__webpack_require__(99747)))\\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\\n\"],\"names\":[\"deferred\",\"name\",\"emits\",\"props\",\"title\",\"type\",\"String\",\"fillColor\",\"default\",\"size\",\"Number\",\"_vm\",\"this\",\"_c\",\"_self\",\"_b\",\"staticClass\",\"attrs\",\"on\",\"$event\",\"$emit\",\"$attrs\",\"_v\",\"_s\",\"_e\",\"components\",\"Delete\",\"NcButton\",\"EyeOutline\",\"client\",\"Object\",\"required\",\"data\",\"id\",\"redirectUri\",\"clientId\",\"clientSecret\",\"renderSecret\",\"computed\",\"renderedSecret\",\"toggleAriaLabel\",\"t\",\"methods\",\"toggleSecret\",\"options\",\"styleTagTransform\",\"setAttributes\",\"insert\",\"domAPI\",\"insertStyleElement\",\"locals\",\"scopedSlots\",\"_u\",\"key\",\"fn\",\"proxy\",\"OAuthItem\",\"NcSettingsSection\",\"NcTextField\",\"NcNoteCard\",\"clients\",\"Array\",\"newClient\",\"errorMsg\",\"error\",\"oauthDocLink\",\"loadState\",\"showSecretWarning\",\"instanceName\",\"getCapabilities\",\"theming\",\"deleteClient\",\"axios\",\"delete\",\"generateUrl\",\"then\",\"filter\",\"addClient\",\"post\",\"response\",\"push\",\"catch\",\"reason\",\"message\",\"length\",\"_l\",\"preventDefault\",\"apply\",\"arguments\",\"$set\",\"Vue\",\"prototype\",\"OC\",\"extend\",\"App\",\"propsData\",\"$mount\",\"___CSS_LOADER_EXPORT___\",\"module\",\"__webpack_module_cache__\",\"__webpack_require__\",\"moduleId\",\"cachedModule\",\"undefined\",\"exports\",\"loaded\",\"__webpack_modules__\",\"call\",\"m\",\"O\",\"result\",\"chunkIds\",\"priority\",\"notFulfilled\",\"Infinity\",\"i\",\"fulfilled\",\"j\",\"keys\",\"every\",\"splice\",\"r\",\"n\",\"getter\",\"__esModule\",\"d\",\"a\",\"definition\",\"o\",\"defineProperty\",\"enumerable\",\"get\",\"e\",\"Promise\",\"resolve\",\"g\",\"globalThis\",\"Function\",\"window\",\"obj\",\"prop\",\"hasOwnProperty\",\"Symbol\",\"toStringTag\",\"value\",\"nmd\",\"paths\",\"children\",\"b\",\"document\",\"baseURI\",\"self\",\"location\",\"href\",\"installedChunks\",\"chunkId\",\"webpackJsonpCallback\",\"parentChunkLoadingFunction\",\"moreModules\",\"runtime\",\"some\",\"chunkLoadingGlobal\",\"forEach\",\"bind\",\"nc\",\"__webpack_exports__\"],\"sourceRoot\":\"\"}\n\\ No newline at end of file"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/server/commits/873c42b0f1383d5b6f2b7a481e1d9620ed30f44a",
        "url": "https://api.github.com/repos/nextcloud/server/commits/873c42b0f1383d5b6f2b7a481e1d9620ed30f44a",
        "html_url": "https://github.com/nextcloud/server/commit/873c42b0f1383d5b6f2b7a481e1d9620ed30f44a",
        "message": "Merge pull request #47627 from nextcloud/fix/noid/link-ref-provider-size-check\n\n[LinkReferenceProvider] Better size check",
        "files": [
            {
                "sha": "86d2c03918c33f2fc71c5c3cfebcdcab049206dc",
                "filename": "lib/public/Collaboration/Reference/LinkReferenceProvider.php",
                "status": "modified",
                "additions": 14,
                "deletions": 4,
                "changes": 18,
                "blob_url": "https://github.com/nextcloud/server/blob/873c42b0f1383d5b6f2b7a481e1d9620ed30f44a/lib%2Fpublic%2FCollaboration%2FReference%2FLinkReferenceProvider.php",
                "raw_url": "https://github.com/nextcloud/server/raw/873c42b0f1383d5b6f2b7a481e1d9620ed30f44a/lib%2Fpublic%2FCollaboration%2FReference%2FLinkReferenceProvider.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fpublic%2FCollaboration%2FReference%2FLinkReferenceProvider.php?ref=873c42b0f1383d5b6f2b7a481e1d9620ed30f44a",
                "patch": "@@ -122,7 +122,7 @@ private function fetchReference(Reference $reference): void {\n \n \t\t$linkContentLength = $headResponse->getHeader('Content-Length');\n \t\tif (is_numeric($linkContentLength) && (int)$linkContentLength > self::MAX_CONTENT_LENGTH) {\n-\t\t\t$this->logger->debug('Skip resolving links pointing to content length > 5 MiB');\n+\t\t\t$this->logger->debug('[Head] Skip resolving links pointing to content length > 5 MiB');\n \t\t\treturn;\n \t\t}\n \n@@ -136,18 +136,28 @@ private function fetchReference(Reference $reference): void {\n \t\t}\n \n \t\ttry {\n-\t\t\t$response = $client->get($reference->getId(), [ 'timeout' => 10 ]);\n+\t\t\t$response = $client->get($reference->getId(), [ 'timeout' => 10, 'stream' => true ]);\n \t\t} catch (\\Exception $e) {\n \t\t\t$this->logger->debug('Failed to fetch link for obtaining open graph data', ['exception' => $e]);\n \t\t\treturn;\n \t\t}\n \n-\t\t$responseBody = (string)$response->getBody();\n+\t\t$body = $response->getBody();\n+\t\tif (is_resource($body)) {\n+\t\t\t$responseContent = fread($body, self::MAX_CONTENT_LENGTH);\n+\t\t\tif (!feof($body)) {\n+\t\t\t\t$this->logger->debug('[Get] Skip resolving links pointing to content length > 5 MiB');\n+\t\t\t\treturn;\n+\t\t\t}\n+\t\t} else {\n+\t\t\t$this->logger->error('[Get] Impossible to check content length');\n+\t\t\treturn;\n+\t\t}\n \n \t\t// OpenGraph handling\n \t\t$consumer = new Consumer();\n \t\t$consumer->useFallbackMode = true;\n-\t\t$object = $consumer->loadHtml($responseBody);\n+\t\t$object = $consumer->loadHtml($responseContent);\n \n \t\t$reference->setUrl($reference->getId());\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/server/commits/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d",
        "url": "https://api.github.com/repos/nextcloud/server/commits/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d",
        "html_url": "https://github.com/nextcloud/server/commit/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d",
        "message": "Merge pull request #47769 from nextcloud/artonge/fix/use_sha256_for_arguments_hash_forbg_jobs\n\nfix: Use sha256 to hash arguments of background jobs",
        "files": [
            {
                "sha": "e36c27add1c64d8790d885b79179c09fcc8a90b7",
                "filename": "core/Migrations/Version28000Date20240828142927.php",
                "status": "added",
                "additions": 83,
                "deletions": 0,
                "changes": 83,
                "blob_url": "https://github.com/nextcloud/server/blob/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d/core%2FMigrations%2FVersion28000Date20240828142927.php",
                "raw_url": "https://github.com/nextcloud/server/raw/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d/core%2FMigrations%2FVersion28000Date20240828142927.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/core%2FMigrations%2FVersion28000Date20240828142927.php?ref=a933ba1fdba77e7d8c6b8ff400e082cf853ea46d",
                "patch": "@@ -0,0 +1,83 @@\n+<?php\n+\n+declare(strict_types=1);\n+\n+/**\n+ * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n+ * SPDX-License-Identifier: AGPL-3.0-or-later\n+ */\n+\n+namespace OC\\Core\\Migrations;\n+\n+use Closure;\n+use OCP\\DB\\ISchemaWrapper;\n+use OCP\\DB\\QueryBuilder\\IQueryBuilder;\n+use OCP\\IDBConnection;\n+use OCP\\Migration\\Attributes\\ColumnType;\n+use OCP\\Migration\\Attributes\\ModifyColumn;\n+use OCP\\Migration\\IOutput;\n+use OCP\\Migration\\SimpleMigrationStep;\n+\n+/**\n+ * Migrate the argument_hash column of oc_jobs to use sha256 instead of md5.\n+ */\n+#[ModifyColumn(table: 'jobs', name: 'argument_hash', type: ColumnType::STRING, description: 'Increase the column size from 32 to 64')]\n+#[ModifyColumn(table: 'jobs', name: 'argument_hash', type: ColumnType::STRING, description: 'Rehash the argument_hash column using sha256')]\n+class Version28000Date20240828142927 extends SimpleMigrationStep {\n+\tpublic function __construct(\n+\t\tprotected IDBConnection $connection,\n+\t) {\n+\t}\n+\n+\tpublic function changeSchema(IOutput $output, Closure $schemaClosure, array $options): ?ISchemaWrapper {\n+\t\t/** @var ISchemaWrapper $schema */\n+\t\t$schema = $schemaClosure();\n+\n+\t\t// Increase the column size from 32 to 64\n+\t\t$table = $schema->getTable('jobs');\n+\t\t$table->modifyColumn('argument_hash', [\n+\t\t\t'notnull' => false,\n+\t\t\t'length' => 64,\n+\t\t]);\n+\n+\t\treturn $schema;\n+\t}\n+\n+\tpublic function postSchemaChange(IOutput $output, Closure $schemaClosure, array $options): void {\n+\t\t$chunkSize = 1000;\n+\t\t$offset = 0;\n+\t\t$nullHash = hash('sha256', 'null');\n+\n+\t\t$selectQuery = $this->connection->getQueryBuilder()\n+\t\t\t->select('*')\n+\t\t\t->from('jobs')\n+\t\t\t->setMaxResults($chunkSize);\n+\n+\t\t$insertQuery = $this->connection->getQueryBuilder();\n+\t\t$insertQuery->update('jobs')\n+\t\t\t->set('argument_hash', $insertQuery->createParameter('argument_hash'))\n+\t\t\t->where($insertQuery->expr()->eq('id', $insertQuery->createParameter('id')));\n+\n+\t\tdo {\n+\t\t\t$result = $selectQuery\n+\t\t\t\t->setFirstResult($offset)\n+\t\t\t\t->executeQuery();\n+\n+\t\t\t$jobs = $result->fetchAll();\n+\t\t\t$count = count($jobs);\n+\n+\t\t\tforeach ($jobs as $jobRow) {\n+\t\t\t\tif ($jobRow['argument'] === 'null') {\n+\t\t\t\t\t$hash = $nullHash;\n+\t\t\t\t} else {\n+\t\t\t\t\t$hash = hash('sha256', $jobRow['argument']);\n+\t\t\t\t}\n+\t\t\t\t$insertQuery->setParameter('id', (string)$jobRow['id'], IQueryBuilder::PARAM_INT);\n+\t\t\t\t$insertQuery->setParameter('argument_hash', $hash);\n+\t\t\t\t$insertQuery->executeStatement();\n+\t\t\t}\n+\n+\t\t\t$offset += $chunkSize;\n+\t\t} while ($count === $chunkSize);\n+\t}\n+}"
            },
            {
                "sha": "9710ff7dbd5ec5b1f8c9ae22e06fb6074fe847ac",
                "filename": "lib/composer/composer/autoload_classmap.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/nextcloud/server/blob/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d/lib%2Fcomposer%2Fcomposer%2Fautoload_classmap.php",
                "raw_url": "https://github.com/nextcloud/server/raw/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d/lib%2Fcomposer%2Fcomposer%2Fautoload_classmap.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fcomposer%2Fcomposer%2Fautoload_classmap.php?ref=a933ba1fdba77e7d8c6b8ff400e082cf853ea46d",
                "patch": "@@ -1364,6 +1364,7 @@\n     'OC\\\\Core\\\\Migrations\\\\Version28000Date20231004103301' => $baseDir . '/core/Migrations/Version28000Date20231004103301.php',\n     'OC\\\\Core\\\\Migrations\\\\Version28000Date20231103104802' => $baseDir . '/core/Migrations/Version28000Date20231103104802.php',\n     'OC\\\\Core\\\\Migrations\\\\Version28000Date20231126110901' => $baseDir . '/core/Migrations/Version28000Date20231126110901.php',\n+    'OC\\\\Core\\\\Migrations\\\\Version28000Date20240828142927' => $baseDir . '/core/Migrations/Version28000Date20240828142927.php',\n     'OC\\\\Core\\\\Migrations\\\\Version29000Date20231126110901' => $baseDir . '/core/Migrations/Version29000Date20231126110901.php',\n     'OC\\\\Core\\\\Migrations\\\\Version29000Date20231213104850' => $baseDir . '/core/Migrations/Version29000Date20231213104850.php',\n     'OC\\\\Core\\\\Migrations\\\\Version29000Date20240124132201' => $baseDir . '/core/Migrations/Version29000Date20240124132201.php',"
            },
            {
                "sha": "a681b10aa5116934766461be64fafcc1615700e1",
                "filename": "lib/composer/composer/autoload_static.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/nextcloud/server/blob/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d/lib%2Fcomposer%2Fcomposer%2Fautoload_static.php",
                "raw_url": "https://github.com/nextcloud/server/raw/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d/lib%2Fcomposer%2Fcomposer%2Fautoload_static.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fcomposer%2Fcomposer%2Fautoload_static.php?ref=a933ba1fdba77e7d8c6b8ff400e082cf853ea46d",
                "patch": "@@ -1397,6 +1397,7 @@ class ComposerStaticInit749170dad3f5e7f9ca158f5a9f04f6a2\n         'OC\\\\Core\\\\Migrations\\\\Version28000Date20231004103301' => __DIR__ . '/../../..' . '/core/Migrations/Version28000Date20231004103301.php',\n         'OC\\\\Core\\\\Migrations\\\\Version28000Date20231103104802' => __DIR__ . '/../../..' . '/core/Migrations/Version28000Date20231103104802.php',\n         'OC\\\\Core\\\\Migrations\\\\Version28000Date20231126110901' => __DIR__ . '/../../..' . '/core/Migrations/Version28000Date20231126110901.php',\n+        'OC\\\\Core\\\\Migrations\\\\Version28000Date20240828142927' => __DIR__ . '/../../..' . '/core/Migrations/Version28000Date20240828142927.php',\n         'OC\\\\Core\\\\Migrations\\\\Version29000Date20231126110901' => __DIR__ . '/../../..' . '/core/Migrations/Version29000Date20231126110901.php',\n         'OC\\\\Core\\\\Migrations\\\\Version29000Date20231213104850' => __DIR__ . '/../../..' . '/core/Migrations/Version29000Date20231213104850.php',\n         'OC\\\\Core\\\\Migrations\\\\Version29000Date20240124132201' => __DIR__ . '/../../..' . '/core/Migrations/Version29000Date20240124132201.php',"
            },
            {
                "sha": "dc8e33c743c0f0a87c3351b4528b398a38bf32e6",
                "filename": "lib/private/BackgroundJob/JobList.php",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/nextcloud/server/blob/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d/lib%2Fprivate%2FBackgroundJob%2FJobList.php",
                "raw_url": "https://github.com/nextcloud/server/raw/a933ba1fdba77e7d8c6b8ff400e082cf853ea46d/lib%2Fprivate%2FBackgroundJob%2FJobList.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fprivate%2FBackgroundJob%2FJobList.php?ref=a933ba1fdba77e7d8c6b8ff400e082cf853ea46d",
                "patch": "@@ -20,7 +20,6 @@\n use Psr\\Log\\LoggerInterface;\n use function get_class;\n use function json_encode;\n-use function md5;\n use function strlen;\n \n class JobList implements IJobList {\n@@ -50,7 +49,7 @@ public function add($job, $argument = null, ?int $firstCheck = null): void {\n \t\t\t\t->values([\n \t\t\t\t\t'class' => $query->createNamedParameter($class),\n \t\t\t\t\t'argument' => $query->createNamedParameter($argumentJson),\n-\t\t\t\t\t'argument_hash' => $query->createNamedParameter(md5($argumentJson)),\n+\t\t\t\t\t'argument_hash' => $query->createNamedParameter(hash('sha256', $argumentJson)),\n \t\t\t\t\t'last_run' => $query->createNamedParameter(0, IQueryBuilder::PARAM_INT),\n \t\t\t\t\t'last_checked' => $query->createNamedParameter($firstCheck, IQueryBuilder::PARAM_INT),\n \t\t\t\t]);\n@@ -60,7 +59,7 @@ public function add($job, $argument = null, ?int $firstCheck = null): void {\n \t\t\t\t->set('last_checked', $query->createNamedParameter($firstCheck, IQueryBuilder::PARAM_INT))\n \t\t\t\t->set('last_run', $query->createNamedParameter(0, IQueryBuilder::PARAM_INT))\n \t\t\t\t->where($query->expr()->eq('class', $query->createNamedParameter($class)))\n-\t\t\t\t->andWhere($query->expr()->eq('argument_hash', $query->createNamedParameter(md5($argumentJson))));\n+\t\t\t\t->andWhere($query->expr()->eq('argument_hash', $query->createNamedParameter(hash('sha256', $argumentJson))));\n \t\t}\n \t\t$query->executeStatement();\n \t}\n@@ -81,7 +80,7 @@ public function remove($job, $argument = null): void {\n \t\t\t->where($query->expr()->eq('class', $query->createNamedParameter($class)));\n \t\tif (!is_null($argument)) {\n \t\t\t$argumentJson = json_encode($argument);\n-\t\t\t$query->andWhere($query->expr()->eq('argument_hash', $query->createNamedParameter(md5($argumentJson))));\n+\t\t\t$query->andWhere($query->expr()->eq('argument_hash', $query->createNamedParameter(hash('sha256', $argumentJson))));\n \t\t}\n \n \t\t// Add galera safe delete chunking if using mysql\n@@ -122,7 +121,7 @@ public function has($job, $argument): bool {\n \t\t$query->select('id')\n \t\t\t->from('jobs')\n \t\t\t->where($query->expr()->eq('class', $query->createNamedParameter($class)))\n-\t\t\t->andWhere($query->expr()->eq('argument_hash', $query->createNamedParameter(md5($argument))))\n+\t\t\t->andWhere($query->expr()->eq('argument_hash', $query->createNamedParameter(hash('sha256', $argument))))\n \t\t\t->setMaxResults(1);\n \n \t\t$result = $query->executeQuery();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/server/commits/8a13f284765bd4606984e7d925c32ae6e82b8a27",
        "url": "https://api.github.com/repos/nextcloud/server/commits/8a13f284765bd4606984e7d925c32ae6e82b8a27",
        "html_url": "https://github.com/nextcloud/server/commit/8a13f284765bd4606984e7d925c32ae6e82b8a27",
        "message": "Merge pull request #49009 from nextcloud/fix/noid/set-ext-pwd-as-sensitive",
        "files": [
            {
                "sha": "c3e16dd5404c57773727d1f1687f89115a9b7deb",
                "filename": "apps/files_external/lib/Lib/Backend/OwnCloud.php",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/nextcloud/server/blob/8a13f284765bd4606984e7d925c32ae6e82b8a27/apps%2Ffiles_external%2Flib%2FLib%2FBackend%2FOwnCloud.php",
                "raw_url": "https://github.com/nextcloud/server/raw/8a13f284765bd4606984e7d925c32ae6e82b8a27/apps%2Ffiles_external%2Flib%2FLib%2FBackend%2FOwnCloud.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/apps%2Ffiles_external%2Flib%2FLib%2FBackend%2FOwnCloud.php?ref=8a13f284765bd4606984e7d925c32ae6e82b8a27",
                "patch": "@@ -25,6 +25,9 @@ public function __construct(IL10N $l, Password $legacyAuth) {\n \t\t\t\t(new DefinitionParameter('secure', $l->t('Secure https://')))\n \t\t\t\t\t->setType(DefinitionParameter::VALUE_BOOLEAN)\n \t\t\t\t\t->setDefaultValue(true),\n+\t\t\t\t(new DefinitionParameter('password', $l->t('Password')))\n+\t\t\t\t\t->setFlag(DefinitionParameter::FLAG_OPTIONAL)\n+\t\t\t\t\t->setType(DefinitionParameter::VALUE_PASSWORD),\n \t\t\t])\n \t\t\t->addAuthScheme(AuthMechanism::SCHEME_PASSWORD)\n \t\t\t->setLegacyAuthMechanism($legacyAuth)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/nextcloud/server/commits/d25a0a2896a2a981939cacb8ee0d555feef22b3b",
        "url": "https://api.github.com/repos/nextcloud/server/commits/d25a0a2896a2a981939cacb8ee0d555feef22b3b",
        "html_url": "https://github.com/nextcloud/server/commit/d25a0a2896a2a981939cacb8ee0d555feef22b3b",
        "message": "Merge pull request #48915 from nextcloud/fix/encrypt-decrypt-password",
        "files": [
            {
                "sha": "b6f22ce345f5018282984e3e28cab42449cf5f01",
                "filename": "lib/private/Authentication/LoginCredentials/Store.php",
                "status": "modified",
                "additions": 13,
                "deletions": 2,
                "changes": 15,
                "blob_url": "https://github.com/nextcloud/server/blob/d25a0a2896a2a981939cacb8ee0d555feef22b3b/lib%2Fprivate%2FAuthentication%2FLoginCredentials%2FStore.php",
                "raw_url": "https://github.com/nextcloud/server/raw/d25a0a2896a2a981939cacb8ee0d555feef22b3b/lib%2Fprivate%2FAuthentication%2FLoginCredentials%2FStore.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fprivate%2FAuthentication%2FLoginCredentials%2FStore.php?ref=d25a0a2896a2a981939cacb8ee0d555feef22b3b",
                "patch": "@@ -8,13 +8,15 @@\n  */\n namespace OC\\Authentication\\LoginCredentials;\n \n+use Exception;\n use OC\\Authentication\\Exceptions\\PasswordlessTokenException;\n use OC\\Authentication\\Token\\IProvider;\n use OCP\\Authentication\\Exceptions\\CredentialsUnavailableException;\n use OCP\\Authentication\\Exceptions\\InvalidTokenException;\n use OCP\\Authentication\\LoginCredentials\\ICredentials;\n use OCP\\Authentication\\LoginCredentials\\IStore;\n use OCP\\ISession;\n+use OCP\\Security\\ICrypto;\n use OCP\\Session\\Exceptions\\SessionNotAvailableException;\n use OCP\\Util;\n use Psr\\Log\\LoggerInterface;\n@@ -29,9 +31,12 @@ class Store implements IStore {\n \t/** @var IProvider|null */\n \tprivate $tokenProvider;\n \n-\tpublic function __construct(ISession $session,\n+\tpublic function __construct(\n+\t\tISession $session,\n \t\tLoggerInterface $logger,\n-\t\t?IProvider $tokenProvider = null) {\n+\t\tprivate readonly ICrypto $crypto,\n+\t\t?IProvider $tokenProvider = null,\n+\t) {\n \t\t$this->session = $session;\n \t\t$this->logger = $logger;\n \t\t$this->tokenProvider = $tokenProvider;\n@@ -45,6 +50,7 @@ public function __construct(ISession $session,\n \t * @param array $params\n \t */\n \tpublic function authenticate(array $params) {\n+\t\t$params['password'] = $this->crypto->encrypt((string)$params['password']);\n \t\t$this->session->set('login_credentials', json_encode($params));\n \t}\n \n@@ -91,6 +97,11 @@ public function getLoginCredentials(): ICredentials {\n \t\tif ($trySession && $this->session->exists('login_credentials')) {\n \t\t\t/** @var array $creds */\n \t\t\t$creds = json_decode($this->session->get('login_credentials'), true);\n+\t\t\ttry {\n+\t\t\t\t$creds['password'] = $this->crypto->decrypt($creds['password']);\n+\t\t\t} catch (Exception $e) {\n+\t\t\t\t//decryption failed, continue with old password as it is\n+\t\t\t}\n \t\t\treturn new Credentials(\n \t\t\t\t$creds['uid'],\n \t\t\t\t$creds['loginName'] ?? $this->session->get('loginname') ?? $creds['uid'], // Pre 20 didn't have a loginName property, hence fall back to the session value and then to the UID"
            },
            {
                "sha": "27a5f2662f822ac43296a10dba50af6ff044294c",
                "filename": "lib/private/Server.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/nextcloud/server/blob/d25a0a2896a2a981939cacb8ee0d555feef22b3b/lib%2Fprivate%2FServer.php",
                "raw_url": "https://github.com/nextcloud/server/raw/d25a0a2896a2a981939cacb8ee0d555feef22b3b/lib%2Fprivate%2FServer.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/lib%2Fprivate%2FServer.php?ref=d25a0a2896a2a981939cacb8ee0d555feef22b3b",
                "patch": "@@ -451,7 +451,8 @@ public function __construct($webRoot, \\OC\\Config $config) {\n \t\t\t\t$tokenProvider = null;\n \t\t\t}\n \t\t\t$logger = $c->get(LoggerInterface::class);\n-\t\t\treturn new Store($session, $logger, $tokenProvider);\n+\t\t\t$crypto = $c->get(ICrypto::class);\n+\t\t\treturn new Store($session, $logger, $crypto, $tokenProvider);\n \t\t});\n \t\t$this->registerAlias(IStore::class, Store::class);\n \t\t$this->registerAlias(IProvider::class, Authentication\\Token\\Manager::class);"
            },
            {
                "sha": "c58bb09faaa1c491132e7e6691ab2edef0bd23ae",
                "filename": "tests/lib/Authentication/LoginCredentials/StoreTest.php",
                "status": "modified",
                "additions": 19,
                "deletions": 3,
                "changes": 22,
                "blob_url": "https://github.com/nextcloud/server/blob/d25a0a2896a2a981939cacb8ee0d555feef22b3b/tests%2Flib%2FAuthentication%2FLoginCredentials%2FStoreTest.php",
                "raw_url": "https://github.com/nextcloud/server/raw/d25a0a2896a2a981939cacb8ee0d555feef22b3b/tests%2Flib%2FAuthentication%2FLoginCredentials%2FStoreTest.php",
                "contents_url": "https://api.github.com/repos/nextcloud/server/contents/tests%2Flib%2FAuthentication%2FLoginCredentials%2FStoreTest.php?ref=d25a0a2896a2a981939cacb8ee0d555feef22b3b",
                "patch": "@@ -15,6 +15,7 @@\n use OC\\Authentication\\Token\\IToken;\n use OCP\\Authentication\\Exceptions\\CredentialsUnavailableException;\n use OCP\\ISession;\n+use OCP\\Security\\ICrypto;\n use OCP\\Session\\Exceptions\\SessionNotAvailableException;\n use Psr\\Log\\LoggerInterface;\n use Test\\TestCase;\n@@ -29,6 +30,8 @@ class StoreTest extends TestCase {\n \n \t/** @var LoggerInterface|\\PHPUnit\\Framework\\MockObject\\MockObject */\n \tprivate $logger;\n+\t/** @var ICrypto|\\PHPUnit\\Framework\\MockObject\\MockObject */\n+\tprivate $crypto;\n \n \t/** @var Store */\n \tprivate $store;\n@@ -39,20 +42,24 @@ protected function setUp(): void {\n \t\t$this->session = $this->createMock(ISession::class);\n \t\t$this->tokenProvider = $this->createMock(IProvider::class);\n \t\t$this->logger = $this->createMock(LoggerInterface::class);\n+\t\t$this->crypto = $this->createMock(ICrypto::class);\n \n-\t\t$this->store = new Store($this->session, $this->logger, $this->tokenProvider);\n+\t\t$this->store = new Store($this->session, $this->logger, $this->crypto, $this->tokenProvider);\n \t}\n \n \tpublic function testAuthenticate(): void {\n \t\t$params = [\n \t\t\t'run' => true,\n \t\t\t'uid' => 'user123',\n-\t\t\t'password' => 123456,\n+\t\t\t'password' => '123456',\n \t\t];\n \n \t\t$this->session->expects($this->once())\n \t\t\t->method('set')\n \t\t\t->with($this->equalTo('login_credentials'), $this->equalTo(json_encode($params)));\n+\t\t$this->crypto->expects($this->once())\n+\t\t\t->method('encrypt')\n+\t\t\t->willReturn('123456');\n \n \t\t$this->store->authenticate($params);\n \t}\n@@ -65,7 +72,7 @@ public function testSetSession(): void {\n \t}\n \n \tpublic function testGetLoginCredentialsNoTokenProvider(): void {\n-\t\t$this->store = new Store($this->session, $this->logger, null);\n+\t\t$this->store = new Store($this->session, $this->logger, $this->crypto, null);\n \n \t\t$this->expectException(CredentialsUnavailableException::class);\n \n@@ -139,6 +146,9 @@ public function testGetLoginCredentialsPartialCredentialsAndSessionName(): void\n \t\t\t->method('exists')\n \t\t\t->with($this->equalTo('login_credentials'))\n \t\t\t->willReturn(true);\n+\t\t$this->crypto->expects($this->once())\n+\t\t\t->method('decrypt')\n+\t\t\t->willReturn($password);\n \t\t$this->session->expects($this->exactly(2))\n \t\t\t->method('get')\n \t\t\t->willReturnMap([\n@@ -176,6 +186,9 @@ public function testGetLoginCredentialsPartialCredentials(): void {\n \t\t\t->method('exists')\n \t\t\t->with($this->equalTo('login_credentials'))\n \t\t\t->willReturn(true);\n+\t\t$this->crypto->expects($this->once())\n+\t\t\t->method('decrypt')\n+\t\t\t->willReturn($password);\n \t\t$this->session->expects($this->exactly(2))\n \t\t\t->method('get')\n \t\t\t->willReturnMap([\n@@ -214,6 +227,9 @@ public function testGetLoginCredentialsInvalidTokenLoginCredentials(): void {\n \t\t\t->method('exists')\n \t\t\t->with($this->equalTo('login_credentials'))\n \t\t\t->willReturn(true);\n+\t\t$this->crypto->expects($this->once())\n+\t\t\t->method('decrypt')\n+\t\t\t->willReturn($password);\n \t\t$this->session->expects($this->once())\n \t\t\t->method('get')\n \t\t\t->with($this->equalTo('login_credentials'))"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/30e522c29bbb1f9b72951025e7049a26c7e1d76e",
        "url": "https://api.github.com/repos/librenms/librenms/commits/30e522c29bbb1f9b72951025e7049a26c7e1d76e",
        "html_url": "https://github.com/librenms/librenms/commit/30e522c29bbb1f9b72951025e7049a26c7e1d76e",
        "message": "Fix services page xss (#16576)",
        "files": [
            {
                "sha": "a92b01ca2569e0429d5936b00e0e24d4dfbcaaf7",
                "filename": "includes/html/pages/device/services.inc.php",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/librenms/librenms/blob/30e522c29bbb1f9b72951025e7049a26c7e1d76e/includes%2Fhtml%2Fpages%2Fdevice%2Fservices.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/30e522c29bbb1f9b72951025e7049a26c7e1d76e/includes%2Fhtml%2Fpages%2Fdevice%2Fservices.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fdevice%2Fservices.inc.php?ref=30e522c29bbb1f9b72951025e7049a26c7e1d76e",
                "patch": "@@ -71,21 +71,21 @@\n     foreach ($services as $service) {\n         $service['service_ds'] = htmlspecialchars_decode($service['service_ds']);\n         if ($service['service_status'] == '2') {\n-            $status = '<span class=\"alert-status label-danger\"><span class=\"device-services-page\">' . $service['service_type'] . '</span></span>';\n+            $status = '<span class=\"alert-status label-danger\"><span class=\"device-services-page\">' . htmlentities($service['service_type']) . '</span></span>';\n         } elseif ($service['service_status'] == '1') {\n-            $status = '<span class=\"alert-status label-warning\"><span class=\"device-services-page\">' . $service['service_type'] . '</span></span>';\n+            $status = '<span class=\"alert-status label-warning\"><span class=\"device-services-page\">' . htmlentities($service['service_type']) . '</span></span>';\n         } elseif ($service['service_status'] == '0') {\n-            $status = '<span class=\"alert-status label-success\"><span class=\"device-services-page\">' . $service['service_type'] . '</span></span>';\n+            $status = '<span class=\"alert-status label-success\"><span class=\"device-services-page\">' . htmlentities($service['service_type']) . '</span></span>';\n         } else {\n-            $status = '<span class=\"alert-status label-info\"><span class=\"device-services-page\">' . $service['service_type'] . '</span></span>';\n+            $status = '<span class=\"alert-status label-info\"><span class=\"device-services-page\">' . htmlentities($service['service_type']) . '</span></span>';\n         }\n \n         echo '<tr id=\"row_' . $service['service_id'] . '\">';\n         echo '<td class=\"col-sm-12\">';\n         echo '<div class=\"col-sm-1\">' . $status . '</div>';\n         echo '<div class=\"col-sm-2 text-muted\">' . \\LibreNMS\\Util\\Time::formatInterval(time() - $service['service_changed']) . '</div>';\n-        echo '<div class=\"col-sm-2 text-muted\">' . $service['service_desc'] . '</div>';\n-        echo '<div class=\"col-sm-5\">' . nl2br(trim($service['service_message'])) . '</div>';\n+        echo '<div class=\"col-sm-2 text-muted\">' . htmlentities($service['service_desc']) . '</div>';\n+        echo '<div class=\"col-sm-5\">' . nl2br(htmlentities(trim($service['service_message']))) . '</div>';\n         echo '<div class=\"col-sm-2\">';\n         echo '<div class=\"pull-right\">';\n         if (Auth::user()->hasGlobalAdmin()) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/42b156e42a3811c23758772ce8c63d4d3eaba59b",
        "url": "https://api.github.com/repos/librenms/librenms/commits/42b156e42a3811c23758772ce8c63d4d3eaba59b",
        "html_url": "https://github.com/librenms/librenms/commit/42b156e42a3811c23758772ce8c63d4d3eaba59b",
        "message": "Fix XSS in customoid (#16629)\n\nEscape all fields\r\nhttps://github.com/librenms/librenms/security/advisories/GHSA-gv4m-f6fx-859x",
        "files": [
            {
                "sha": "04c460f6185e29365226d5587fb0aedb1554122f",
                "filename": "includes/html/print-customoid.php",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/librenms/librenms/blob/42b156e42a3811c23758772ce8c63d4d3eaba59b/includes%2Fhtml%2Fprint-customoid.php",
                "raw_url": "https://github.com/librenms/librenms/raw/42b156e42a3811c23758772ce8c63d4d3eaba59b/includes%2Fhtml%2Fprint-customoid.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fprint-customoid.php?ref=42b156e42a3811c23758772ce8c63d4d3eaba59b",
                "patch": "@@ -84,14 +84,14 @@\n \n foreach (dbFetchRows($full_query, $param) as $oid) {\n     echo \"<tr class='\" . $oid['customoid_id'] . \"' id='row_\" . $oid['customoid_id'] . \"'>\";\n-    echo '<td>' . $oid['customoid_descr'] . '</td>';\n-    echo '<td>' . $oid['customoid_oid'] . '</td>';\n-    echo '<td>' . $oid['customoid_current'] . '</td>';\n-    echo '<td>' . $oid['customoid_unit'] . '</td>';\n-    echo '<td>' . $oid['customoid_limit'] . '</td>';\n-    echo '<td>' . $oid['customoid_limit_low'] . '</td>';\n-    echo '<td>' . $oid['customoid_limit_warn'] . '</td>';\n-    echo '<td>' . $oid['customoid_limit_low_warn'] . '</td>';\n+    echo '<td>' . htmlentities($oid['customoid_descr']) . '</td>';\n+    echo '<td>' . htmlentities($oid['customoid_oid']) . '</td>';\n+    echo '<td>' . htmlentities($oid['customoid_current']) . '</td>';\n+    echo '<td>' . htmlentities($oid['customoid_unit']) . '</td>';\n+    echo '<td>' . htmlentities($oid['customoid_limit']) . '</td>';\n+    echo '<td>' . htmlentities($oid['customoid_limit_low']) . '</td>';\n+    echo '<td>' . htmlentities($oid['customoid_limit_warn']) . '</td>';\n+    echo '<td>' . htmlentities($oid['customoid_limit_low_warn']) . '</td>';\n     echo \"<td><input id='\" . $oid['customoid_id'] . \"' type='checkbox' name='alert'\" . ($oid['customoid_alert'] ? ' checked' : '') . ' disabled></td>';\n     echo \"<td><input id='\" . $oid['customoid_id'] . \"' type='checkbox' name='passed'\" . ($oid['customoid_passed'] ? ' checked' : '') . ' disabled></td>';\n     echo '<td>';"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/aef739a438ffb507e927a4ec87b359164a7a053a",
        "url": "https://api.github.com/repos/librenms/librenms/commits/aef739a438ffb507e927a4ec87b359164a7a053a",
        "html_url": "https://github.com/librenms/librenms/commit/aef739a438ffb507e927a4ec87b359164a7a053a",
        "message": "Fixed XSS in Wireless and Health pages (#16569)\n\n* Fixed XSS in Wireless and Health pages\r\n\r\n* Fixed style checks",
        "files": [
            {
                "sha": "45ef3850dcb27888ed9be991785e22f8f5dcd287",
                "filename": "includes/html/pages/health.inc.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/librenms/librenms/blob/aef739a438ffb507e927a4ec87b359164a7a053a/includes%2Fhtml%2Fpages%2Fhealth.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/aef739a438ffb507e927a4ec87b359164a7a053a/includes%2Fhtml%2Fpages%2Fhealth.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fhealth.inc.php?ref=aef739a438ffb507e927a4ec87b359164a7a053a",
                "patch": "@@ -64,7 +64,7 @@\n     'percent' => 'Percent',\n ];\n \n-$active_metric = basename($vars['metric'] ?? 'processor');\n+$active_metric = basename(array_key_exists($vars['metric'], $type_text) ? $vars['metric'] : 'processor');\n \n $vars['view'] = $vars['view'] ?? 'detail';\n $link_array = ['page' => 'health'];"
            },
            {
                "sha": "2b0006bae6938e2985f0e093838914016563a37f",
                "filename": "includes/html/pages/wireless.inc.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/librenms/librenms/blob/aef739a438ffb507e927a4ec87b359164a7a053a/includes%2Fhtml%2Fpages%2Fwireless.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/aef739a438ffb507e927a4ec87b359164a7a053a/includes%2Fhtml%2Fpages%2Fwireless.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fwireless.inc.php?ref=aef739a438ffb507e927a4ec87b359164a7a053a",
                "patch": "@@ -29,7 +29,7 @@\n $sensors = dbFetchColumn('SELECT `sensor_class` FROM `wireless_sensors` GROUP BY `sensor_class`');\n $valid_wireless_types = array_intersect_key(WirelessSensor::getTypes(), array_flip($sensors));\n \n-$class = basename($vars['metric'] ?? key($valid_wireless_types));\n+$class = basename(array_key_exists($vars['metric'], $valid_wireless_types) ? $vars['metric'] : key($valid_wireless_types));\n $vars['view'] = basename($vars['view'] ?? 'nographs');\n \n $link_array = ['page' => 'wireless'];"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/4568188ce9097a2e3a3b563311077f2bb82455c0",
        "url": "https://api.github.com/repos/librenms/librenms/commits/4568188ce9097a2e3a3b563311077f2bb82455c0",
        "html_url": "https://github.com/librenms/librenms/commit/4568188ce9097a2e3a3b563311077f2bb82455c0",
        "message": "Fixed XSS issue with Device overview page and overwrite_ip (#16567)\n\n* Fixed XSS issue with Device overview page and overwrite_ip\r\n\r\n* Added htmlentities() to more output",
        "files": [
            {
                "sha": "9319a708bb4eaf4ac312c4804ecba52f2c5d5dd2",
                "filename": "includes/html/dev-overview-data.inc.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/librenms/librenms/blob/4568188ce9097a2e3a3b563311077f2bb82455c0/includes%2Fhtml%2Fdev-overview-data.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/4568188ce9097a2e3a3b563311077f2bb82455c0/includes%2Fhtml%2Fdev-overview-data.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fdev-overview-data.inc.php?ref=4568188ce9097a2e3a3b563311077f2bb82455c0",
                "patch": "@@ -39,14 +39,14 @@\n       </div>';\n \n if (! empty($device['overwrite_ip'])) {\n-    echo \"<div class='row'><div class='col-sm-4'>Assigned IP</div><div class='col-sm-8'>{$device['overwrite_ip']}</div></div>\";\n+    echo \"<div class='row'><div class='col-sm-4'>Assigned IP</div><div class='col-sm-8'>\" . htmlentities($device['overwrite_ip']) . '</div></div>';\n } elseif (! empty($device['ip'])) {\n-    echo \"<div class='row'><div class='col-sm-4'>Resolved IP</div><div class='col-sm-8'>{$device['ip']}</div></div>\";\n+    echo \"<div class='row'><div class='col-sm-4'>Resolved IP</div><div class='col-sm-8'>\" . htmlentities($device['ip']) . '</div></div>';\n } else {\n     try {\n         $ip = (string) IP::parse($device['hostname']);\n         if ($ip !== format_hostname($device)) {\n-            echo \"<div class='row'><div class='col-sm-4'>IP Address</div><div class='col-sm-8'>$ip</div></div>\";\n+            echo \"<div class='row'><div class='col-sm-4'>IP Address</div><div class='col-sm-8'>\" . htmlentities($ip) . '</div></div>';\n         }\n     } catch (InvalidIpException $e) {\n         // don't add an ip line"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/82a744bfe29017b8b58b5752ab9e1b335bedf0a0",
        "url": "https://api.github.com/repos/librenms/librenms/commits/82a744bfe29017b8b58b5752ab9e1b335bedf0a0",
        "html_url": "https://github.com/librenms/librenms/commit/82a744bfe29017b8b58b5752ab9e1b335bedf0a0",
        "message": "Fix XSS in port edit secion (#16566)\n\n* Fix XSS in port edit secion\r\n\r\n* Also fixes GHSA-xh4g-c9p6-5jxg\r\n\r\n* Added htmlentities() to more output\r\n\r\n* Update EditPortsController.php",
        "files": [
            {
                "sha": "5185c3c3d5f8d2b74beedabe3790ca884676568e",
                "filename": "app/Http/Controllers/Table/EditPortsController.php",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/librenms/librenms/blob/82a744bfe29017b8b58b5752ab9e1b335bedf0a0/app%2FHttp%2FControllers%2FTable%2FEditPortsController.php",
                "raw_url": "https://github.com/librenms/librenms/raw/82a744bfe29017b8b58b5752ab9e1b335bedf0a0/app%2FHttp%2FControllers%2FTable%2FEditPortsController.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/app%2FHttp%2FControllers%2FTable%2FEditPortsController.php?ref=82a744bfe29017b8b58b5752ab9e1b335bedf0a0",
                "patch": "@@ -66,21 +66,21 @@ public function formatItem($port)\n         $port_group_options = '';\n         foreach ($port->groups as $group) {\n             /** @var \\App\\Models\\PortGroup $group */\n-            $port_group_options .= '<option value=\"' . $group->id . '\" selected>' . $group->name . '</option>';\n+            $port_group_options .= '<option value=\"' . $group->id . '\" selected>' . htmlentities($group->name) . '</option>';\n         }\n \n         return [\n             'ifIndex' => $port->ifIndex,\n-            'ifName' => $port->getLabel(),\n-            'ifAdminStatus' => $port->ifAdminStatus,\n-            'ifOperStatus' => '<span id=\"operstatus_' . $port->port_id . '\" ' . $out_of_sync . '>' . $port->ifOperStatus . '</span>',\n+            'ifName' => htmlentities($port->getLabel()),\n+            'ifAdminStatus' => htmlentities($port->ifAdminStatus),\n+            'ifOperStatus' => '<span id=\"operstatus_' . $port->port_id . '\" ' . $out_of_sync . '>' . htmlentities($port->ifOperStatus) . '</span>',\n             'disabled' => '<input type=\"checkbox\" class=\"disable-check\" data-size=\"small\" name=\"disabled_' . $port->port_id . '\"' . ($port->disabled ? 'checked' : '') . '>\n                                <input type=\"hidden\" name=\"olddis_' . $port->port_id . '\" value=\"' . ($port->disabled ? 1 : 0) . '\"\">',\n             'ignore' => '<input type=\"checkbox\" class=\"ignore-check\" data-size=\"small\" name=\"ignore_' . $port->port_id . '\"' . ($port->ignore ? 'checked' : '') . '>\n                                <input type=\"hidden\" name=\"oldign_' . $port->port_id . '\" value=\"' . ($port->ignore ? 1 : 0) . '\"\">',\n-            'port_tune' => '<input type=\"checkbox\" name=\"override_config\" data-attrib=\"ifName_tune:' . $port->ifName . '\" data-device_id=\"' . $port->device_id . '\" data-size=\"small\" ' . $tune . '>',\n-            'ifAlias' => '<div class=\"form-group\"><input class=\"form-control input-sm\" name=\"if-alias\" data-device_id=\"' . $port->device_id . '\" data-port_id=\"' . $port->port_id . '\" data-ifName=\"' . $port->ifName . '\" value=\"' . $port->ifAlias . '\"><span class=\"form-control-feedback\"><i class=\"fa\" aria-hidden=\"true\"></i></span></div>',\n-            'ifSpeed' => '<div class=\"form-group has-feedback\"><input type=\"text\" pattern=\"[0-9]*\" inputmode=\"numeric\" class=\"form-control input-sm\" name=\"if-speed\" data-device_id=\"' . $port->device_id . '\" data-port_id=\"' . $port->port_id . '\" data-ifName=\"' . $port->ifName . '\" value=\"' . $port->ifSpeed . '\"><span class=\"form-control-feedback\"><i class=\"fas\" aria-hidden=\"true\"></i></span></div>',\n+            'port_tune' => '<input type=\"checkbox\" name=\"override_config\" data-attrib=\"ifName_tune:' . htmlentities($port->ifName) . '\" data-device_id=\"' . $port->device_id . '\" data-size=\"small\" ' . $tune . '>',\n+            'ifAlias' => '<div class=\"form-group\"><input class=\"form-control input-sm\" name=\"if-alias\" data-device_id=\"' . $port->device_id . '\" data-port_id=\"' . $port->port_id . '\" data-ifName=\"' . htmlentities($port->ifName) . '\" value=\"' . htmlentities($port->ifAlias) . '\"><span class=\"form-control-feedback\"><i class=\"fa\" aria-hidden=\"true\"></i></span></div>',\n+            'ifSpeed' => '<div class=\"form-group has-feedback\"><input type=\"text\" pattern=\"[0-9]*\" inputmode=\"numeric\" class=\"form-control input-sm\" name=\"if-speed\" data-device_id=\"' . $port->device_id . '\" data-port_id=\"' . $port->port_id . '\" data-ifName=\"' . htmlentities($port->ifName) . '\" value=\"' . $port->ifSpeed . '\"><span class=\"form-control-feedback\"><i class=\"fas\" aria-hidden=\"true\"></i></span></div>',\n             'portGroup' => '<div class=\"form-group has-feedback\"><select class=\"input-sm port_group_select\" name=\"port_group_' . $port->port_id . '[]\"  data-port_id=\"' . $port->port_id . '\" multiple>' . $port_group_options . '</select></div>',\n         ];\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/bb4731419b592867bf974dde525e536606a52976",
        "url": "https://api.github.com/repos/librenms/librenms/commits/bb4731419b592867bf974dde525e536606a52976",
        "html_url": "https://github.com/librenms/librenms/commit/bb4731419b592867bf974dde525e536606a52976",
        "message": "Fix device display name xss vulnerabilities (#16575)\n\n* Fix device display name xss vulnerabilities\r\nof note is we now strip tags in overlib popups because it is extremely difficult for htmlentities alone to fix the issue due to overlib injecting it into the dom decoded.\r\n\r\nhttps://github.com/librenms/librenms/security/advisories/GHSA-4m5r-w2rq-q54q\r\n\r\n* Fix availability map a little more thoroughly",
        "files": [
            {
                "sha": "6dfbb7f8502e7392cc7b8d9aa4e551bad94072ea",
                "filename": "LibreNMS/Util/Url.php",
                "status": "modified",
                "additions": 10,
                "deletions": 9,
                "changes": 19,
                "blob_url": "https://github.com/librenms/librenms/blob/bb4731419b592867bf974dde525e536606a52976/LibreNMS%2FUtil%2FUrl.php",
                "raw_url": "https://github.com/librenms/librenms/raw/bb4731419b592867bf974dde525e536606a52976/LibreNMS%2FUtil%2FUrl.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/LibreNMS%2FUtil%2FUrl.php?ref=bb4731419b592867bf974dde525e536606a52976",
                "patch": "@@ -51,11 +51,11 @@ class Url\n     public static function deviceLink($device, $text = '', $vars = [], $start = 0, $end = 0, $escape_text = 1, $overlib = 1)\n     {\n         if (! $device instanceof Device || ! $device->hostname) {\n-            return (string) $text;\n+            return $escape_text ? htmlentities($text) : (string) $text;\n         }\n \n         if (! $device->canAccess(Auth::user())) {\n-            return $device->displayName();\n+            return $escape_text ? htmlentities($device->displayName()) : $device->displayName();\n         }\n \n         if (! $start) {\n@@ -79,30 +79,31 @@ public static function deviceLink($device, $text = '', $vars = [], $start = 0, $\n         $url = Url::deviceUrl($device, $vars);\n \n         // beginning of overlib box contains large hostname followed by hardware & OS details\n-        $contents = '<div><span class=\"list-large\">' . $device->displayName() . '</span>';\n+        // because we are injecting this into javascript htmlentities alone won't work, so strip_tags too\n+        $contents = '<div><span class=\"list-large\">' . htmlentities(strip_tags($device->displayName())) . '</span>';\n         $devinfo = '';\n         if ($device->hardware) {\n-            $devinfo .= htmlentities($device->hardware);\n+            $devinfo .= $device->hardware;\n         }\n \n         if ($device->os) {\n-            $devinfo .= ($devinfo ? ' - ' : '') . htmlentities(Config::getOsSetting($device->os, 'text'));\n+            $devinfo .= ($devinfo ? ' - ' : '') . Config::getOsSetting($device->os, 'text');\n         }\n \n         if ($device->version) {\n-            $devinfo .= ($devinfo ? ' - ' : '') . htmlentities($device->version);\n+            $devinfo .= ($devinfo ? ' - ' : '') . $device->version;\n         }\n \n         if ($device->features) {\n-            $devinfo .= ' (' . htmlentities($device->features) . ')';\n+            $devinfo .= ' (' . $device->features . ')';\n         }\n \n         if ($devinfo) {\n-            $contents .= '<br />' . $devinfo;\n+            $contents .= '<br />' . htmlentities(strip_tags($devinfo));\n         }\n \n         if ($device->location_id) {\n-            $contents .= '<br />' . htmlentities($device->location ?? '');\n+            $contents .= '<br />' . htmlentities(strip_tags($device->location ?? ''));\n         }\n \n         $contents .= '</div><br />';"
            },
            {
                "sha": "1c7a3f4515061f84db498251a8313d29ceaed2cc",
                "filename": "includes/html/common/availability-map.inc.php",
                "status": "modified",
                "additions": 8,
                "deletions": 7,
                "changes": 15,
                "blob_url": "https://github.com/librenms/librenms/blob/bb4731419b592867bf974dde525e536606a52976/includes%2Fhtml%2Fcommon%2Favailability-map.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/bb4731419b592867bf974dde525e536606a52976/includes%2Fhtml%2Fcommon%2Favailability-map.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fcommon%2Favailability-map.inc.php?ref=bb4731419b592867bf974dde525e536606a52976",
                "patch": "@@ -231,7 +231,7 @@\n                 $host_maintenance_count++;\n             }\n \n-            $device_system_name = format_hostname($device);\n+            $device_system_name = htmlentities(format_hostname($device));\n \n             if (Config::get('webui.availability_map_compact') == 0) {\n                 if ($directpage == 'yes') {\n@@ -287,33 +287,34 @@\n                     $serviceState = 'down';\n                     $service_down_count++;\n                 }\n-                $service_system_name = format_hostname($service);\n+                $device_name = format_hostname($service);\n+                $service_descr = \" - ${service['service_type']} - ${service['service_desc']}\";\n \n                 if (Config::get('webui.availability_map_compact') == 0) {\n                     if ($directpage == 'yes') {\n                         $deviceIcon = getIconTag($service);\n                         $temp_output[] = '\n-                        <a href=\"' . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . '\" title=\"' . $service_system_name . ' - ' . $service['service_type'] . ' - ' . $service['service_desc'] . '\">\n+                        <a href=\"' . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . '\" title=\"' . htmlentities($device_name . $service_descr) . '\">\n                             <div class=\"service-availability ' . $serviceState . '\" style=\"width:' . Config::get('webui.availability_map_box_size') . 'px;\">\n                                 <span class=\"service-name-label label ' . $serviceLabel . ' label-font-border\">' . $service['service_type'] . '</span>\n                                 <span class=\"availability-label label ' . $serviceLabel . ' label-font-border\">' . $serviceState . '</span>\n                                 <span class=\"device-icon\">' . $deviceIcon . '</span><br>\n-                                <span class=\"small\">' . shorthost($service_system_name) . '</span>\n+                                <span class=\"small\">' . htmlentities(shorthost($device_name)) . '</span>\n                             </div>\n                         </a>';\n                     } else {\n-                        $serviceText = $service['service_type'] . ' - ' . $serviceState;\n+                        $serviceText = htmlentities($service['service_type']) . ' - ' . $serviceState;\n                         if ($settings['color_only_select'] == 1) {\n                             $serviceText = ' ';\n                             $serviceLabel .= ' widget-availability-fixed';\n                         }\n                         $temp_output[] = '\n-                        <a href=\"' . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . '\" title=\"' . shorthost($service_system_name) . ' - ' . $service['service_type'] . ' - ' . $service['service_desc'] . '\">\n+                        <a href=\"' . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . '\" title=\"' . htmlentities(shorthost($device_name) . $service_descr) . '\">\n                             <span class=\"label ' . $serviceLabel . ' widget-availability label-font-border\">' . $serviceText . '</span>\n                         </a>';\n                     }\n                 } else {\n-                    $temp_output[] = \"<a href='\" . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . \"' title='${service_system_name} - ${service['service_type']} - ${service['service_desc']}'><div class='\" . $serviceLabelOld . \"' style='width:${compact_tile}px;height:${compact_tile}px;'></div></a>\";\n+                    $temp_output[] = \"<a href='\" . \\LibreNMS\\Util\\Url::generate(['page' => 'device', 'device' => $service['device_id'], 'tab' => 'services']) . \"' title='$device_name$service_descr'><div class='\" . $serviceLabelOld . \"' style='width:${compact_tile}px;height:${compact_tile}px;'></div></a>\";\n                 }\n             }\n         } else {"
            },
            {
                "sha": "9cdd397fa7018740a46da0f6055e0f4f884a854b",
                "filename": "includes/html/pages/edituser.inc.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/librenms/librenms/blob/bb4731419b592867bf974dde525e536606a52976/includes%2Fhtml%2Fpages%2Fedituser.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/bb4731419b592867bf974dde525e536606a52976/includes%2Fhtml%2Fpages%2Fedituser.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fedituser.inc.php?ref=bb4731419b592867bf974dde525e536606a52976",
                "patch": "@@ -80,7 +80,7 @@\n \n         $device_perms = dbFetchRows('SELECT * from devices_perms as P, devices as D WHERE `user_id` = ? AND D.device_id = P.device_id', [$user_data['user_id']]);\n         foreach ($device_perms as $device_perm) {\n-            echo '<tr><td><strong>' . format_hostname($device_perm) . \"</td><td> <a href='edituser/action=deldevperm/user_id=\" . $vars['user_id'] . '/device_id=' . $device_perm['device_id'] . \"'><i class='fa fa-trash fa-lg icon-theme' aria-hidden='true'></i></a></strong></td></tr>\";\n+            echo '<tr><td><strong>' . htmlentities(format_hostname($device_perm)) . \"</td><td> <a href='edituser/action=deldevperm/user_id=\" . $vars['user_id'] . '/device_id=' . $device_perm['device_id'] . \"'><i class='fa fa-trash fa-lg icon-theme' aria-hidden='true'></i></a></strong></td></tr>\";\n             $access_list[] = $device_perm['device_id'];\n             $permdone = 'yes';\n         }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/b4af778ca42c5839801f16ece53505bb7fa1e7bc",
        "url": "https://api.github.com/repos/librenms/librenms/commits/b4af778ca42c5839801f16ece53505bb7fa1e7bc",
        "html_url": "https://github.com/librenms/librenms/commit/b4af778ca42c5839801f16ece53505bb7fa1e7bc",
        "message": "Fixed xss in services overview for device (#16587)",
        "files": [
            {
                "sha": "8eadf56504b5098927284e13e243d861e87eb3c5",
                "filename": "includes/html/pages/device/overview/services.inc.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/librenms/librenms/blob/b4af778ca42c5839801f16ece53505bb7fa1e7bc/includes%2Fhtml%2Fpages%2Fdevice%2Foverview%2Fservices.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/b4af778ca42c5839801f16ece53505bb7fa1e7bc/includes%2Fhtml%2Fpages%2Fdevice%2Foverview%2Fservices.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fdevice%2Foverview%2Fservices.inc.php?ref=b4af778ca42c5839801f16ece53505bb7fa1e7bc",
                "patch": "@@ -9,10 +9,10 @@\n         ->orderBy('service_type')\n         ->get(['service_type', 'service_status', 'service_message', 'service_name'])\n         ->map(function ($service) use ($colors) {\n-            $message = str_replace(' ', '&nbsp;', $service->service_message);\n+            $message = htmlentities(str_replace(' ', '&nbsp;', $service->service_message));\n             $color = $colors->get($service->service_status, 'grey');\n-            $type = strtolower($service->service_type);\n-            $name = $service->service_name;\n+            $type = htmlentities(strtolower($service->service_type));\n+            $name = htmlentities($service->service_name);\n             $name_type = ($name == '' || $name == $type) ? $type : $name . ' (' . $type . ')';\n \n             return \"<span title='$message' class='$color'>$name_type</span>\";"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/6a14a9bd767c6e452e4df77a24126c3eeb93dcbf",
        "url": "https://api.github.com/repos/librenms/librenms/commits/6a14a9bd767c6e452e4df77a24126c3eeb93dcbf",
        "html_url": "https://github.com/librenms/librenms/commit/6a14a9bd767c6e452e4df77a24126c3eeb93dcbf",
        "message": "Fix xss in report_this (#16613)\n\nhttps://github.com/librenms/librenms/security/advisories/GHSA-v7w9-63xh-6r3w",
        "files": [
            {
                "sha": "b88b80f3196c62b0bce13cd3999e69e867ae5670",
                "filename": "includes/functions.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/librenms/librenms/blob/6a14a9bd767c6e452e4df77a24126c3eeb93dcbf/includes%2Ffunctions.php",
                "raw_url": "https://github.com/librenms/librenms/raw/6a14a9bd767c6e452e4df77a24126c3eeb93dcbf/includes%2Ffunctions.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Ffunctions.php?ref=6a14a9bd767c6e452e4df77a24126c3eeb93dcbf",
                "patch": "@@ -520,7 +520,7 @@ function delta_to_bits($delta, $period)\n \n function report_this($message)\n {\n-    return '<h2>' . $message . ' Please <a href=\"' . Config::get('project_issues') . '\">report this</a> to the ' . Config::get('project_name') . ' developers.</h2>';\n+    return '<h2>' . htmlentities($message) . ' Please <a href=\"' . htmlentities(Config::get('project_issues')) . '\">report this</a> to the ' . htmlentities(Config::get('project_name')) . ' developers.</h2>';\n }//end report_this()\n \n function hytera_h2f($number, $nd)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/82a744bfe29017b8b58b5752ab9e1b335bedf0a0",
        "url": "https://api.github.com/repos/librenms/librenms/commits/82a744bfe29017b8b58b5752ab9e1b335bedf0a0",
        "html_url": "https://github.com/librenms/librenms/commit/82a744bfe29017b8b58b5752ab9e1b335bedf0a0",
        "message": "Fix XSS in port edit secion (#16566)\n\n* Fix XSS in port edit secion\r\n\r\n* Also fixes GHSA-xh4g-c9p6-5jxg\r\n\r\n* Added htmlentities() to more output\r\n\r\n* Update EditPortsController.php",
        "files": [
            {
                "sha": "5185c3c3d5f8d2b74beedabe3790ca884676568e",
                "filename": "app/Http/Controllers/Table/EditPortsController.php",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/librenms/librenms/blob/82a744bfe29017b8b58b5752ab9e1b335bedf0a0/app%2FHttp%2FControllers%2FTable%2FEditPortsController.php",
                "raw_url": "https://github.com/librenms/librenms/raw/82a744bfe29017b8b58b5752ab9e1b335bedf0a0/app%2FHttp%2FControllers%2FTable%2FEditPortsController.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/app%2FHttp%2FControllers%2FTable%2FEditPortsController.php?ref=82a744bfe29017b8b58b5752ab9e1b335bedf0a0",
                "patch": "@@ -66,21 +66,21 @@ public function formatItem($port)\n         $port_group_options = '';\n         foreach ($port->groups as $group) {\n             /** @var \\App\\Models\\PortGroup $group */\n-            $port_group_options .= '<option value=\"' . $group->id . '\" selected>' . $group->name . '</option>';\n+            $port_group_options .= '<option value=\"' . $group->id . '\" selected>' . htmlentities($group->name) . '</option>';\n         }\n \n         return [\n             'ifIndex' => $port->ifIndex,\n-            'ifName' => $port->getLabel(),\n-            'ifAdminStatus' => $port->ifAdminStatus,\n-            'ifOperStatus' => '<span id=\"operstatus_' . $port->port_id . '\" ' . $out_of_sync . '>' . $port->ifOperStatus . '</span>',\n+            'ifName' => htmlentities($port->getLabel()),\n+            'ifAdminStatus' => htmlentities($port->ifAdminStatus),\n+            'ifOperStatus' => '<span id=\"operstatus_' . $port->port_id . '\" ' . $out_of_sync . '>' . htmlentities($port->ifOperStatus) . '</span>',\n             'disabled' => '<input type=\"checkbox\" class=\"disable-check\" data-size=\"small\" name=\"disabled_' . $port->port_id . '\"' . ($port->disabled ? 'checked' : '') . '>\n                                <input type=\"hidden\" name=\"olddis_' . $port->port_id . '\" value=\"' . ($port->disabled ? 1 : 0) . '\"\">',\n             'ignore' => '<input type=\"checkbox\" class=\"ignore-check\" data-size=\"small\" name=\"ignore_' . $port->port_id . '\"' . ($port->ignore ? 'checked' : '') . '>\n                                <input type=\"hidden\" name=\"oldign_' . $port->port_id . '\" value=\"' . ($port->ignore ? 1 : 0) . '\"\">',\n-            'port_tune' => '<input type=\"checkbox\" name=\"override_config\" data-attrib=\"ifName_tune:' . $port->ifName . '\" data-device_id=\"' . $port->device_id . '\" data-size=\"small\" ' . $tune . '>',\n-            'ifAlias' => '<div class=\"form-group\"><input class=\"form-control input-sm\" name=\"if-alias\" data-device_id=\"' . $port->device_id . '\" data-port_id=\"' . $port->port_id . '\" data-ifName=\"' . $port->ifName . '\" value=\"' . $port->ifAlias . '\"><span class=\"form-control-feedback\"><i class=\"fa\" aria-hidden=\"true\"></i></span></div>',\n-            'ifSpeed' => '<div class=\"form-group has-feedback\"><input type=\"text\" pattern=\"[0-9]*\" inputmode=\"numeric\" class=\"form-control input-sm\" name=\"if-speed\" data-device_id=\"' . $port->device_id . '\" data-port_id=\"' . $port->port_id . '\" data-ifName=\"' . $port->ifName . '\" value=\"' . $port->ifSpeed . '\"><span class=\"form-control-feedback\"><i class=\"fas\" aria-hidden=\"true\"></i></span></div>',\n+            'port_tune' => '<input type=\"checkbox\" name=\"override_config\" data-attrib=\"ifName_tune:' . htmlentities($port->ifName) . '\" data-device_id=\"' . $port->device_id . '\" data-size=\"small\" ' . $tune . '>',\n+            'ifAlias' => '<div class=\"form-group\"><input class=\"form-control input-sm\" name=\"if-alias\" data-device_id=\"' . $port->device_id . '\" data-port_id=\"' . $port->port_id . '\" data-ifName=\"' . htmlentities($port->ifName) . '\" value=\"' . htmlentities($port->ifAlias) . '\"><span class=\"form-control-feedback\"><i class=\"fa\" aria-hidden=\"true\"></i></span></div>',\n+            'ifSpeed' => '<div class=\"form-group has-feedback\"><input type=\"text\" pattern=\"[0-9]*\" inputmode=\"numeric\" class=\"form-control input-sm\" name=\"if-speed\" data-device_id=\"' . $port->device_id . '\" data-port_id=\"' . $port->port_id . '\" data-ifName=\"' . htmlentities($port->ifName) . '\" value=\"' . $port->ifSpeed . '\"><span class=\"form-control-feedback\"><i class=\"fas\" aria-hidden=\"true\"></i></span></div>',\n             'portGroup' => '<div class=\"form-group has-feedback\"><select class=\"input-sm port_group_select\" name=\"port_group_' . $port->port_id . '[]\"  data-port_id=\"' . $port->port_id . '\" multiple>' . $port_group_options . '</select></div>',\n         ];\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/af15eabbb1752985d36f337cecf137a947e170f6",
        "url": "https://api.github.com/repos/librenms/librenms/commits/af15eabbb1752985d36f337cecf137a947e170f6",
        "html_url": "https://github.com/librenms/librenms/commit/af15eabbb1752985d36f337cecf137a947e170f6",
        "message": "Fixed XSS in device hostname for Capture (#16565)",
        "files": [
            {
                "sha": "6badfd25002ec959c3be2af3a5c7062b4e1839b2",
                "filename": "includes/html/pages/device/capture.inc.php",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/librenms/librenms/blob/af15eabbb1752985d36f337cecf137a947e170f6/includes%2Fhtml%2Fpages%2Fdevice%2Fcapture.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/af15eabbb1752985d36f337cecf137a947e170f6/includes%2Fhtml%2Fpages%2Fdevice%2Fcapture.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fdevice%2Fcapture.inc.php?ref=af15eabbb1752985d36f337cecf137a947e170f6",
                "patch": "@@ -39,10 +39,10 @@\n     <div class=\"tab-content\">\n     <?php\n     $tabs = [\n-        'discovery' => 'ajax_output.php?id=capture&format=text&type=discovery&hostname=' . $device['hostname'],\n-        'poller'    => 'ajax_output.php?id=capture&format=text&type=poller&hostname=' . $device['hostname'],\n-        'snmp'      => 'ajax_output.php?id=capture&format=text&type=snmpwalk&hostname=' . $device['hostname'],\n-        'alerts'    => 'ajax_output.php?id=query&format=text&type=alerts&hostname=' . $device['hostname'],\n+        'discovery' => 'ajax_output.php?id=capture&format=text&type=discovery&hostname=' . htmlentities($device['hostname']),\n+        'poller'    => 'ajax_output.php?id=capture&format=text&type=poller&hostname=' . htmlentities($device['hostname']),\n+        'snmp'      => 'ajax_output.php?id=capture&format=text&type=snmpwalk&hostname=' . htmlentities($device['hostname']),\n+        'alerts'    => 'ajax_output.php?id=query&format=text&type=alerts&hostname=' . htmlentities($device['hostname']),\n     ];\n \n     foreach ($tabs as $tab => $url) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/237f4d2e818170171dfad6efad36a275cd2ba8d0",
        "url": "https://api.github.com/repos/librenms/librenms/commits/237f4d2e818170171dfad6efad36a275cd2ba8d0",
        "html_url": "https://github.com/librenms/librenms/commit/237f4d2e818170171dfad6efad36a275cd2ba8d0",
        "message": "Resolved XSS issue in bill_name value on user screen (#16560)",
        "files": [
            {
                "sha": "f82cd67e538a80df216e8df4e16d06d9a4d97de3",
                "filename": "includes/html/pages/edituser.inc.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/librenms/librenms/blob/237f4d2e818170171dfad6efad36a275cd2ba8d0/includes%2Fhtml%2Fpages%2Fedituser.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/237f4d2e818170171dfad6efad36a275cd2ba8d0/includes%2Fhtml%2Fpages%2Fedituser.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fedituser.inc.php?ref=237f4d2e818170171dfad6efad36a275cd2ba8d0",
                "patch": "@@ -270,7 +270,7 @@\n         foreach ($bill_perms as $bill_perm) {\n             echo '<tr>\n               <td>\n-                <strong>' . $bill_perm['bill_name'] . \"</strong></td><td width=50>&nbsp;&nbsp;<a href='edituser/action=delbillperm/user_id=\" . $vars['user_id'] . '/bill_id=' . $bill_perm['bill_id'] . \"'><i class='fa fa-trash fa-lg icon-theme' aria-hidden='true'></i></a>\n+                <strong>' . htmlentities($bill_perm['bill_name']) . \"</strong></td><td width=50>&nbsp;&nbsp;<a href='edituser/action=delbillperm/user_id=\" . $vars['user_id'] . '/bill_id=' . $bill_perm['bill_id'] . \"'><i class='fa fa-trash fa-lg icon-theme' aria-hidden='true'></i></a>\n               </td>\n             </tr>\";\n             $bill_access_list[] = $bill_perm['bill_id'];\n@@ -306,7 +306,7 @@\n             }\n \n             if (! $done) {\n-                echo \"<option value='\" . $bill['bill_id'] . \"'>\" . $bill['bill_name'] . '</option>';\n+                echo \"<option value='\" . $bill['bill_id'] . \"'>\" . htmlentities($bill['bill_name']) . '</option>';\n             }\n         }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/24b142d753898e273ec20b542a27dd6eb530c7d8",
        "url": "https://api.github.com/repos/librenms/librenms/commits/24b142d753898e273ec20b542a27dd6eb530c7d8",
        "html_url": "https://github.com/librenms/librenms/commit/24b142d753898e273ec20b542a27dd6eb530c7d8",
        "message": "Filter ExamplePlugin output (#16562)\n\nFilter device notes markdown output in ExamplePlugin\r\n\r\nDon't enable the ExamplePlugin, it does nothing...",
        "files": [
            {
                "sha": "2cac5cf75768c6426e1ddbbb47de3d60b90fbbb8",
                "filename": "app/Plugins/ExamplePlugin/resources/views/device-overview.blade.php",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/librenms/librenms/blob/24b142d753898e273ec20b542a27dd6eb530c7d8/app%2FPlugins%2FExamplePlugin%2Fresources%2Fviews%2Fdevice-overview.blade.php",
                "raw_url": "https://github.com/librenms/librenms/raw/24b142d753898e273ec20b542a27dd6eb530c7d8/app%2FPlugins%2FExamplePlugin%2Fresources%2Fviews%2Fdevice-overview.blade.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/app%2FPlugins%2FExamplePlugin%2Fresources%2Fviews%2Fdevice-overview.blade.php?ref=24b142d753898e273ec20b542a27dd6eb530c7d8",
                "patch": "@@ -7,9 +7,7 @@\n             <div class=\"panel-body\">\n                 <div class=\"row\">\n                     <div class=\"col-sm-12\">\n-                        {{-- This is a comment.  Below we output the markdown output unescaped because we want the raw html\n-                         to be output to the page.  Be careful with unescaped output as it can lead to security issues. --}}\n-                        {!! Str::markdown($device->notes ?? '') !!}\n+                        {!! Str::markdown($device->notes ?? '', ['html_input' => 'strip', 'allow_unsafe_links' => false]) !!}\n                     </div>\n         </div>\n         </div>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/librenms/librenms/commits/25988a937cbaebd2ba4c0517510206c404dfb359",
        "url": "https://api.github.com/repos/librenms/librenms/commits/25988a937cbaebd2ba4c0517510206c404dfb359",
        "html_url": "https://github.com/librenms/librenms/commit/25988a937cbaebd2ba4c0517510206c404dfb359",
        "message": "Moved the API token to be generated server side to resolve XSS (#16558)\n\n* Moved the API token to be generated server side to resolve XSS\r\n\r\n* Fixed style issue",
        "files": [
            {
                "sha": "64f74dc5a185e2c9b61ac7331f6ec37065396df9",
                "filename": "includes/html/forms/token-item-create.inc.php",
                "status": "modified",
                "additions": 4,
                "deletions": 8,
                "changes": 12,
                "blob_url": "https://github.com/librenms/librenms/blob/25988a937cbaebd2ba4c0517510206c404dfb359/includes%2Fhtml%2Fforms%2Ftoken-item-create.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/25988a937cbaebd2ba4c0517510206c404dfb359/includes%2Fhtml%2Fforms%2Ftoken-item-create.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fforms%2Ftoken-item-create.inc.php?ref=25988a937cbaebd2ba4c0517510206c404dfb359",
                "patch": "@@ -18,17 +18,13 @@\n     exit('ERROR: You need to be admin');\n }\n \n-if (! is_numeric($_POST['user_id']) || ! isset($_POST['token'])) {\n+$token = bin2hex(openssl_random_pseudo_bytes(16));\n+\n+if (! is_numeric($_POST['user_id'])) {\n     echo 'ERROR: error with data, please ensure a valid user and token have been specified.';\n     exit;\n-} elseif (strlen($_POST['token']) > 32) {\n-    echo 'ERROR: The token is more than 32 characters';\n-    exit;\n-} elseif (strlen($_POST['token']) < 16) {\n-    echo 'ERROR: The token is less than 16 characters';\n-    exit;\n } else {\n-    $create = dbInsert(['user_id' => $_POST['user_id'], 'token_hash' => $_POST['token'], 'description' => $_POST['description']], 'api_tokens');\n+    $create = dbInsert(['user_id' => $_POST['user_id'], 'token_hash' => $token, 'description' => $_POST['description']], 'api_tokens');\n     if ($create > '0') {\n         echo 'API token has been created';\n         Session::put('api_token', true);"
            },
            {
                "sha": "9777a68aef086e5e40143c0f58ca4f59afdae916",
                "filename": "includes/html/pages/api-access.inc.php",
                "status": "modified",
                "additions": 5,
                "deletions": 15,
                "changes": 20,
                "blob_url": "https://github.com/librenms/librenms/blob/25988a937cbaebd2ba4c0517510206c404dfb359/includes%2Fhtml%2Fpages%2Fapi-access.inc.php",
                "raw_url": "https://github.com/librenms/librenms/raw/25988a937cbaebd2ba4c0517510206c404dfb359/includes%2Fhtml%2Fpages%2Fapi-access.inc.php",
                "contents_url": "https://api.github.com/repos/librenms/librenms/contents/includes%2Fhtml%2Fpages%2Fapi-access.inc.php?ref=25988a937cbaebd2ba4c0517510206c404dfb359",
                "patch": "@@ -17,9 +17,7 @@\n use LibreNMS\\Authentication\\LegacyAuth;\n \n if (Auth::user()->hasGlobalAdmin()) {\n-    if (empty($_POST['token'])) {\n-        $_POST['token'] = bin2hex(openssl_random_pseudo_bytes(16));\n-    } ?>\n+?>\n   <div class=\"modal fade\" id=\"confirm-delete\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"Delete\" aria-hidden=\"true\">\n     <div class=\"modal-dialog modal-sm\">\n       <div class=\"modal-content\">\n@@ -64,14 +62,6 @@\n                 </select>\n               </div>\n             </div>\n-            <div class=\"form-group\">\n-              <label for=\"token\" class=\"col-sm-2 control-label\">Token: </label>\n-              <div class=\"col-sm-8\">\n-                <input type=\"text\" class=\"form-control\" id=\"token\" name=\"token\" value=\"<?php echo htmlspecialchars($_POST['token']); ?>\" readonly>\n-              </div>\n-              <div class=\"col-sm-2\">\n-              </div>\n-            </div>\n             <div class=\"form-group\">\n               <label for=\"description\" class=\"col-sm-2 control-label\">Descr: </label>\n               <div class=\"col-sm-10\">\n@@ -147,10 +137,10 @@\n \n         echo '\n         <tr id=\"' . $api->id . '\" ' . $color . '>\n-          <td>' . $user_details->username . '</td>\n-          <td>' . $user_details->auth_type . '</td>\n-          <td>' . $api->token_hash . '</td>\n-          <td><button class=\"btn btn-info btn-xs\" data-toggle=\"modal\" data-target=\"#display-qr\" data-token_hash=\"' . $api->token_hash . '\"><i class=\"fa fa-qrcode\" ></i></button></td>\n+          <td>' . htmlentities($user_details->username) . '</td>\n+          <td>' . htmlentities($user_details->auth_type) . '</td>\n+          <td>' . htmlentities($api->token_hash) . '</td>\n+          <td><button class=\"btn btn-info btn-xs\" data-toggle=\"modal\" data-target=\"#display-qr\" data-token_hash=\"' . htmlentities($api->token_hash) . '\"><i class=\"fa fa-qrcode\" ></i></button></td>\n           <td>' . htmlspecialchars($api->description) . '</td>\n           <td><input type=\"checkbox\" name=\"token-status\" data-token_id=\"' . $api->id . '\" data-off-text=\"No\" data-on-text=\"Yes\" data-on-color=\"danger\" ' . $api_disabled . ' data-size=\"mini\"></td>\n           <td><button type=\"button\" class=\"btn btn-danger btn-xs\" id=\"' . $api->id . '\" data-token_id=\"' . $api->id . '\" data-toggle=\"modal\" data-target=\"#confirm-delete\">Delete</button></td>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openemr/openemr/commits/d141d2ca06fb2171a202c7302dd5d5af8539f255",
        "url": "https://api.github.com/repos/openemr/openemr/commits/d141d2ca06fb2171a202c7302dd5d5af8539f255",
        "html_url": "https://github.com/openemr/openemr/commit/d141d2ca06fb2171a202c7302dd5d5af8539f255",
        "message": "fix_bug_fix",
        "files": [
            {
                "sha": "8dcbc51a2e546bef2f1bbd255b6b4887232615a0",
                "filename": "config/config.yaml",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/openemr/openemr/blob/d141d2ca06fb2171a202c7302dd5d5af8539f255/config%2Fconfig.yaml",
                "raw_url": "https://github.com/openemr/openemr/raw/d141d2ca06fb2171a202c7302dd5d5af8539f255/config%2Fconfig.yaml",
                "contents_url": "https://api.github.com/repos/openemr/openemr/contents/config%2Fconfig.yaml?ref=d141d2ca06fb2171a202c7302dd5d5af8539f255",
                "patch": "@@ -244,3 +244,6 @@ assets:\n     u2f_api:\n         basePath: '%webroot%/library/js/'\n         script: u2f-api.js\n+    dompurify:\n+        basePath: '%assets_static_relative%/'\n+        script: dompurify/dist/purify.js"
            },
            {
                "sha": "b552e513c705335d5e6491badb3bfb6ea5f0ed06",
                "filename": "package-lock.json",
                "status": "modified",
                "additions": 10,
                "deletions": 4,
                "changes": 14,
                "blob_url": "https://github.com/openemr/openemr/blob/d141d2ca06fb2171a202c7302dd5d5af8539f255/package-lock.json",
                "raw_url": "https://github.com/openemr/openemr/raw/d141d2ca06fb2171a202c7302dd5d5af8539f255/package-lock.json",
                "contents_url": "https://api.github.com/repos/openemr/openemr/contents/package-lock.json?ref=d141d2ca06fb2171a202c7302dd5d5af8539f255",
                "patch": "@@ -28,6 +28,7 @@\n         \"datatables.net-jqui\": \"1.13.6\",\n         \"datatables.net-scroller\": \"2.2.0\",\n         \"datatables.net-scroller-jqui\": \"2.2.0\",\n+        \"dompurify\": \"3.0.8\",\n         \"dropzone\": \"5.9.3\",\n         \"dwv\": \"0.27.1\",\n         \"flot\": \"4.2.6\",\n@@ -4383,10 +4384,9 @@\n       }\n     },\n     \"node_modules/dompurify\": {\n-      \"version\": \"2.4.7\",\n-      \"resolved\": \"https://registry.npmjs.org/dompurify/-/dompurify-2.4.7.tgz\",\n-      \"integrity\": \"sha512-kxxKlPEDa6Nc5WJi+qRgPbOAbgTpSULL+vI3NUXsZMlkJxTqYI9wg5ZTay2sFrdZRWHPWNi+EdAhcJf81WtoMQ==\",\n-      \"optional\": true\n+      \"version\": \"3.0.8\",\n+      \"resolved\": \"https://registry.npmjs.org/dompurify/-/dompurify-3.0.8.tgz\",\n+      \"integrity\": \"sha512-b7uwreMYL2eZhrSCRC4ahLTeZcPZxSmYfmcQGXGkXiZSNW1X85v+SDM5KsWcpivIiUBH47Ji7NtyUdpLeF5JZQ==\"\n     },\n     \"node_modules/download\": {\n       \"version\": \"6.2.5\",\n@@ -9017,6 +9017,12 @@\n         \"html2canvas\": \"^1.0.0-rc.5\"\n       }\n     },\n+    \"node_modules/jspdf/node_modules/dompurify\": {\n+      \"version\": \"2.4.7\",\n+      \"resolved\": \"https://registry.npmjs.org/dompurify/-/dompurify-2.4.7.tgz\",\n+      \"integrity\": \"sha512-kxxKlPEDa6Nc5WJi+qRgPbOAbgTpSULL+vI3NUXsZMlkJxTqYI9wg5ZTay2sFrdZRWHPWNi+EdAhcJf81WtoMQ==\",\n+      \"optional\": true\n+    },\n     \"node_modules/jszip\": {\n       \"version\": \"3.10.1\",\n       \"resolved\": \"https://registry.npmjs.org/jszip/-/jszip-3.10.1.tgz\","
            },
            {
                "sha": "ff656d55c617f5f05666fe52332dbfd042827982",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/openemr/openemr/blob/d141d2ca06fb2171a202c7302dd5d5af8539f255/package.json",
                "raw_url": "https://github.com/openemr/openemr/raw/d141d2ca06fb2171a202c7302dd5d5af8539f255/package.json",
                "contents_url": "https://api.github.com/repos/openemr/openemr/contents/package.json?ref=d141d2ca06fb2171a202c7302dd5d5af8539f255",
                "patch": "@@ -85,6 +85,7 @@\n     \"datatables.net-jqui\": \"1.13.6\",\n     \"datatables.net-scroller\": \"2.2.0\",\n     \"datatables.net-scroller-jqui\": \"2.2.0\",\n+    \"dompurify\": \"3.0.8\",\n     \"dropzone\": \"5.9.3\",\n     \"dwv\": \"0.27.1\",\n     \"flot\": \"4.2.6\","
            },
            {
                "sha": "e2aee8570910b79915ba487d81556702c530339e",
                "filename": "portal/messaging/messages.php",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/openemr/openemr/blob/d141d2ca06fb2171a202c7302dd5d5af8539f255/portal%2Fmessaging%2Fmessages.php",
                "raw_url": "https://github.com/openemr/openemr/raw/d141d2ca06fb2171a202c7302dd5d5af8539f255/portal%2Fmessaging%2Fmessages.php",
                "contents_url": "https://api.github.com/repos/openemr/openemr/contents/portal%2Fmessaging%2Fmessages.php?ref=d141d2ca06fb2171a202c7302dd5d5af8539f255",
                "patch": "@@ -109,9 +109,9 @@ function getAuthPortalUsers()\n     <meta charset=\"utf-8\" />\n     <?php\n     if (IS_PORTAL) {\n-        Header::setupHeader(['no_main-theme',  'portal-theme', 'ckeditor', 'angular', 'angular-sanitize', 'checklist-model']);\n+        Header::setupHeader(['no_main-theme',  'portal-theme', 'ckeditor', 'angular', 'angular-sanitize', 'checklist-model', 'dompurify']);\n     } else {\n-        Header::setupHeader(['ckeditor', 'angular', 'angular-sanitize', 'checklist-model']);\n+        Header::setupHeader(['ckeditor', 'angular', 'angular-sanitize', 'checklist-model', 'dompurify']);\n     }\n     ?>\n     <title><?php echo xlt(\"Secure Messaging\"); ?></title>\n@@ -333,12 +333,13 @@ function getAuthPortalUsers()\n                 };\n \n                 $scope.renderMessageBody = function (html) {\n+                    html = DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });\n                     return html;\n                 };\n \n                 $scope.htmlToText = function (html) {\n                     const hold = document.createElement('DIV');\n-                    hold.innerHTML = html;\n+                    hold.innerHTML = DOMPurify.sanitize(html, { USE_PROFILES: { html: true } });\n                     return jsText(hold.textContent || hold.innerText || '');\n                 };\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/usememos/memos/commits/46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
        "url": "https://api.github.com/repos/usememos/memos/commits/46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
        "html_url": "https://github.com/usememos/memos/commit/46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
        "message": "chore: add skipper for secure (#913)",
        "files": [
            {
                "sha": "054fe6b707b8883d3ab7cdd4a8c6e6be27dca094",
                "filename": "server/common.go",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/usememos/memos/blob/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fcommon.go",
                "raw_url": "https://github.com/usememos/memos/raw/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fcommon.go",
                "contents_url": "https://api.github.com/repos/usememos/memos/contents/server%2Fcommon.go?ref=46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
                "patch": "@@ -1,6 +1,8 @@\n package server\n \n import (\n+\t\"net/http\"\n+\n \t\"github.com/labstack/echo/v4\"\n \t\"github.com/usememos/memos/api\"\n \t\"github.com/usememos/memos/common\"\n@@ -16,6 +18,10 @@ func composeResponse(data interface{}) response {\n \t}\n }\n \n+func DefaultGetRequestSkipper(c echo.Context) bool {\n+\treturn c.Request().Method == http.MethodGet\n+}\n+\n func (server *Server) DefaultAuthSkipper(c echo.Context) bool {\n \tctx := c.Request().Context()\n \tpath := c.Path()"
            },
            {
                "sha": "f46d1ece753ac6ee35972d5193f71c823d3ac9ff",
                "filename": "server/resource.go",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/usememos/memos/blob/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fresource.go",
                "raw_url": "https://github.com/usememos/memos/raw/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fresource.go",
                "contents_url": "https://api.github.com/repos/usememos/memos/contents/server%2Fresource.go?ref=46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
                "patch": "@@ -7,6 +7,7 @@ import (\n \t\"net/http\"\n \t\"net/url\"\n \t\"strconv\"\n+\t\"strings\"\n \t\"time\"\n \n \t\"github.com/pkg/errors\"\n@@ -266,7 +267,11 @@ func (s *Server) registerResourcePublicRoutes(g *echo.Group) {\n \t\t\treturn echo.NewHTTPError(http.StatusInternalServerError, fmt.Sprintf(\"Failed to fetch resource ID: %v\", resourceID)).SetInternal(err)\n \t\t}\n \n-\t\tc.Response().Writer.Header().Set(\"Content-Type\", resource.Type)\n+\t\tif strings.HasPrefix(resource.Type, \"text\") || strings.HasPrefix(resource.Type, \"application\") {\n+\t\t\tc.Response().Writer.Header().Set(\"Content-Type\", echo.MIMETextPlain)\n+\t\t} else {\n+\t\t\tc.Response().Writer.Header().Set(\"Content-Type\", resource.Type)\n+\t\t}\n \t\tc.Response().Writer.WriteHeader(http.StatusOK)\n \t\tc.Response().Writer.Header().Set(echo.HeaderCacheControl, \"max-age=31536000, immutable\")\n \t\tc.Response().Writer.Header().Set(echo.HeaderContentSecurityPolicy, \"default-src 'self'\")"
            },
            {
                "sha": "9df7ce5a3dd450b67b8b2675c4eb4274e19f866d",
                "filename": "server/server.go",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/usememos/memos/blob/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fserver.go",
                "raw_url": "https://github.com/usememos/memos/raw/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fserver.go",
                "contents_url": "https://api.github.com/repos/usememos/memos/contents/server%2Fserver.go?ref=46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
                "patch": "@@ -64,7 +64,13 @@ func NewServer(ctx context.Context, profile *profile.Profile) (*Server, error) {\n \n \te.Use(middleware.CORS())\n \n-\te.Use(middleware.Secure())\n+\te.Use(middleware.SecureWithConfig(middleware.SecureConfig{\n+\t\tSkipper:            DefaultGetRequestSkipper,\n+\t\tXSSProtection:      \"1; mode=block\",\n+\t\tContentTypeNosniff: \"nosniff\",\n+\t\tXFrameOptions:      \"SAMEORIGIN\",\n+\t\tHSTSPreloadEnabled: false,\n+\t}))\n \n \te.Use(middleware.TimeoutWithConfig(middleware.TimeoutConfig{\n \t\tSkipper:      middleware.DefaultSkipper,"
            },
            {
                "sha": "49021b4aa4f17486c4eb10cfefc4b698b6f83a83",
                "filename": "server/version/version.go",
                "status": "modified",
                "additions": 2,
                "deletions": 3,
                "changes": 5,
                "blob_url": "https://github.com/usememos/memos/blob/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fversion%2Fversion.go",
                "raw_url": "https://github.com/usememos/memos/raw/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fversion%2Fversion.go",
                "contents_url": "https://api.github.com/repos/usememos/memos/contents/server%2Fversion%2Fversion.go?ref=46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
                "patch": "@@ -7,10 +7,10 @@ import (\n \n // Version is the service current released version.\n // Semantic versioning: https://semver.org/\n-var Version = \"0.9.1\"\n+var Version = \"0.10.0\"\n \n // DevVersion is the service current development version.\n-var DevVersion = \"0.9.1\"\n+var DevVersion = \"0.10.0\"\n \n func GetCurrentVersion(mode string) string {\n \tif mode == \"dev\" {\n@@ -29,7 +29,6 @@ func GetMinorVersion(version string) string {\n \n func GetSchemaVersion(version string) string {\n \tminorVersion := GetMinorVersion(version)\n-\n \treturn minorVersion + \".0\"\n }\n "
            },
            {
                "sha": "21be7c95f32153da39fedc0b63fb01d942b27305",
                "filename": "server/version/version_test.go",
                "status": "added",
                "additions": 33,
                "deletions": 0,
                "changes": 33,
                "blob_url": "https://github.com/usememos/memos/blob/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fversion%2Fversion_test.go",
                "raw_url": "https://github.com/usememos/memos/raw/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/server%2Fversion%2Fversion_test.go",
                "contents_url": "https://api.github.com/repos/usememos/memos/contents/server%2Fversion%2Fversion_test.go?ref=46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
                "patch": "@@ -0,0 +1,33 @@\n+package version\n+\n+import \"testing\"\n+\n+func TestIsVersionGreaterOrEqualThan(t *testing.T) {\n+\ttests := []struct {\n+\t\tversion string\n+\t\ttarget  string\n+\t\twant    bool\n+\t}{\n+\t\t{\n+\t\t\tversion: \"0.9.1\",\n+\t\t\ttarget:  \"0.9.1\",\n+\t\t\twant:    true,\n+\t\t},\n+\t\t{\n+\t\t\tversion: \"0.10.0\",\n+\t\t\ttarget:  \"0.9.1\",\n+\t\t\twant:    true,\n+\t\t},\n+\t\t{\n+\t\t\tversion: \"0.9.0\",\n+\t\t\ttarget:  \"0.9.1\",\n+\t\t\twant:    false,\n+\t\t},\n+\t}\n+\tfor _, test := range tests {\n+\t\tresult := IsVersionGreaterOrEqualThan(test.version, test.target)\n+\t\tif result != test.want {\n+\t\t\tt.Errorf(\"got result %v, want %v.\", result, test.want)\n+\t\t}\n+\t}\n+}"
            },
            {
                "sha": "0d4b05e7a4b19710e226da4c533ca92bb26466ac",
                "filename": "store/db/migration/prod/0.10/00__activity.sql",
                "status": "added",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/usememos/memos/blob/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/store%2Fdb%2Fmigration%2Fprod%2F0.10%2F00__activity.sql",
                "raw_url": "https://github.com/usememos/memos/raw/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/store%2Fdb%2Fmigration%2Fprod%2F0.10%2F00__activity.sql",
                "contents_url": "https://api.github.com/repos/usememos/memos/contents/store%2Fdb%2Fmigration%2Fprod%2F0.10%2F00__activity.sql?ref=46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
                "patch": "@@ -0,0 +1,9 @@\n+-- activity\n+CREATE TABLE activity (\n+  id INTEGER PRIMARY KEY AUTOINCREMENT,\n+  creator_id INTEGER NOT NULL,\n+  created_ts BIGINT NOT NULL DEFAULT (strftime('%s', 'now')),\n+  type TEXT NOT NULL DEFAULT '',\n+  level TEXT NOT NULL CHECK (level IN ('INFO', 'WARN', 'ERROR')) DEFAULT 'INFO',\n+  payload TEXT NOT NULL DEFAULT '{}'\n+);"
            },
            {
                "sha": "7e94c60165fcc0fc2953b4b72c3a4d99d9b49efb",
                "filename": "store/db/migration/prod/LATEST__SCHEMA.sql",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/usememos/memos/blob/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/store%2Fdb%2Fmigration%2Fprod%2FLATEST__SCHEMA.sql",
                "raw_url": "https://github.com/usememos/memos/raw/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/store%2Fdb%2Fmigration%2Fprod%2FLATEST__SCHEMA.sql",
                "contents_url": "https://api.github.com/repos/usememos/memos/contents/store%2Fdb%2Fmigration%2Fprod%2FLATEST__SCHEMA.sql?ref=46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
                "patch": "@@ -93,3 +93,13 @@ CREATE TABLE tag (\n   creator_id INTEGER NOT NULL,\n   UNIQUE(name, creator_id)\n );\n+\n+-- activity\n+CREATE TABLE activity (\n+  id INTEGER PRIMARY KEY AUTOINCREMENT,\n+  creator_id INTEGER NOT NULL,\n+  created_ts BIGINT NOT NULL DEFAULT (strftime('%s', 'now')),\n+  type TEXT NOT NULL DEFAULT '',\n+  level TEXT NOT NULL CHECK (level IN ('INFO', 'WARN', 'ERROR')) DEFAULT 'INFO',\n+  payload TEXT NOT NULL DEFAULT '{}'\n+);"
            },
            {
                "sha": "aed984de0fe74df37391db2048aa30eb4633ad6a",
                "filename": "web/src/components/EmbedMemoDialog.tsx",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/usememos/memos/blob/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/web%2Fsrc%2Fcomponents%2FEmbedMemoDialog.tsx",
                "raw_url": "https://github.com/usememos/memos/raw/46c13a4b7f675b92d297df6dabb4441f13c7cd9c/web%2Fsrc%2Fcomponents%2FEmbedMemoDialog.tsx",
                "contents_url": "https://api.github.com/repos/usememos/memos/contents/web%2Fsrc%2Fcomponents%2FEmbedMemoDialog.tsx?ref=46c13a4b7f675b92d297df6dabb4441f13c7cd9c",
                "patch": "@@ -34,7 +34,7 @@ const EmbedMemoDialog: React.FC<Props> = (props: Props) => {\n           <code className=\"w-full break-all whitespace-pre-wrap\">{memoEmbeddedCode()}</code>\r\n         </pre>\r\n         <p className=\"w-full text-sm leading-6 flex flex-row justify-between items-center mt-2\">\r\n-          * Only the public memo supports.\r\n+          <span className=\"italic opacity-80\">* Only the public memo supports.</span>\r\n           <span className=\"btn-primary\" onClick={handleCopyCode}>\r\n             Copy\r\n           </span>\r"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/phpipam/phpipam/commits/50e36b9e4fff5eaa51dc6e42bc684748da378002",
        "url": "https://api.github.com/repos/phpipam/phpipam/commits/50e36b9e4fff5eaa51dc6e42bc684748da378002",
        "html_url": "https://github.com/phpipam/phpipam/commit/50e36b9e4fff5eaa51dc6e42bc684748da378002",
        "message": "Bugfix: XSS (reflected) in import previews\n\nReported by Faisal Fs <faisalfs10x@gmail.com>",
        "files": [
            {
                "sha": "2025442961803f7d28a4a49f532aa31c912748b4",
                "filename": "app/admin/import-export/import-load-data.php",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/phpipam/phpipam/blob/50e36b9e4fff5eaa51dc6e42bc684748da378002/app%2Fadmin%2Fimport-export%2Fimport-load-data.php",
                "raw_url": "https://github.com/phpipam/phpipam/raw/50e36b9e4fff5eaa51dc6e42bc684748da378002/app%2Fadmin%2Fimport-export%2Fimport-load-data.php",
                "contents_url": "https://api.github.com/repos/phpipam/phpipam/contents/app%2Fadmin%2Fimport-export%2Fimport-load-data.php?ref=50e36b9e4fff5eaa51dc6e42bc684748da378002",
                "patch": "@@ -65,7 +65,7 @@\n \tforeach ($cols as $val) {\n \t\t$col++;\n \t\t# map import columns to expected fields as per previous window\n-\t\t$fieldmap[$col] = $impfields[$val];\n+\t\t$fieldmap[$col] = escape_input(trim($impfields[$val]));\n \t\t$hcol = $col;\n \t}\n \n@@ -81,7 +81,7 @@\n \t\t\t\t$Result->show('danger', _(\"Extra column found on line \").$row._(\" in CSV file. CSV delimiter used in value field?\"), true);\n \t\t\t} else {\n \t\t\t\t# read each row into a dictionary with expected fields as keys\n-\t\t\t\t$record[$fieldmap[$col]] = trim($val);\n+\t\t\t\t$record[$fieldmap[$col]] = escape_input(trim($val));\n \t\t\t}\n \t\t}\n \t\t$data[] = $record;\n@@ -97,23 +97,20 @@\n \n \t# map import columns to expected fields as per previous window\n \tfor($col=1;$col<=$xls->colcount($sheet);$col++) {\n-\t\t$fieldmap[$col] = $impfields[$Tools->convert_encoding_to_UTF8($xls->val($row,$col,$sheet))];\n+\t\t$fieldmap[$col] = $impfields[escape_input($Tools->convert_encoding_to_UTF8($xls->val($row,$col,$sheet)))];\n \t\t$hcol = $col;\n \t}\n \n \t# read each remaining row into a dictionary with expected fields as keys\n \tfor($row=2;$row<=$xls->rowcount($sheet);$row++) {\n \t\t$record = array();\n \t\tfor($col=1;$col<=$xls->colcount($sheet);$col++) {\n-\t\t\t$record++;\n \t\t\tif ($col > $hcol) {\n \t\t\t\t\t$Result->show('danger', _(\"Extra column found on line \").$row._(\" in XLS file. Please check input file.\"), true);\n \t\t\t} else {\n-\t\t\t\t$record[$fieldmap[$col]] = trim($Tools->convert_encoding_to_UTF8($xls->val($row,$col,$sheet)));\n+\t\t\t\t$record[$fieldmap[$col]] = escape_input(trim($Tools->convert_encoding_to_UTF8($xls->val($row,$col,$sheet))));\n \t\t\t}\n \t\t}\n \t\t$data[] = $record;\n \t}\n }\n-\n-?>"
            },
            {
                "sha": "5c7ba3bc4af83ff0d7d3b075e396b13a514bd813",
                "filename": "misc/CHANGELOG",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/phpipam/phpipam/blob/50e36b9e4fff5eaa51dc6e42bc684748da378002/misc%2FCHANGELOG",
                "raw_url": "https://github.com/phpipam/phpipam/raw/50e36b9e4fff5eaa51dc6e42bc684748da378002/misc%2FCHANGELOG",
                "contents_url": "https://api.github.com/repos/phpipam/phpipam/contents/misc%2FCHANGELOG?ref=50e36b9e4fff5eaa51dc6e42bc684748da378002",
                "patch": "@@ -7,6 +7,7 @@\n     Security Fixes:\n     ----------------------------\n     + XXS (reflected) in ripe-arin-query;\n+    + XSS (reflected) in import previews;\n \n == 1.4.6\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pimcore/pimcore/commits/a4491551967d879141a3fdf0986a9dd3d891abfe",
        "url": "https://api.github.com/repos/pimcore/pimcore/commits/a4491551967d879141a3fdf0986a9dd3d891abfe",
        "html_url": "https://github.com/pimcore/pimcore/commit/a4491551967d879141a3fdf0986a9dd3d891abfe",
        "message": "Fix XSS in Conditions tab of Pricing Rules (#14963)\n\n* Fix error when the date field is null\r\n\r\n* Fix xss in date field in pricing-ecommerce\r\n\r\n* Fix date input",
        "files": [
            {
                "sha": "281ff88e99dff6687d9b1ef1312ef3457874cd9c",
                "filename": "bundles/EcommerceFrameworkBundle/PricingManager/Condition/DateRange.php",
                "status": "modified",
                "additions": 11,
                "deletions": 7,
                "changes": 18,
                "blob_url": "https://github.com/pimcore/pimcore/blob/a4491551967d879141a3fdf0986a9dd3d891abfe/bundles%2FEcommerceFrameworkBundle%2FPricingManager%2FCondition%2FDateRange.php",
                "raw_url": "https://github.com/pimcore/pimcore/raw/a4491551967d879141a3fdf0986a9dd3d891abfe/bundles%2FEcommerceFrameworkBundle%2FPricingManager%2FCondition%2FDateRange.php",
                "contents_url": "https://api.github.com/repos/pimcore/pimcore/contents/bundles%2FEcommerceFrameworkBundle%2FPricingManager%2FCondition%2FDateRange.php?ref=a4491551967d879141a3fdf0986a9dd3d891abfe",
                "patch": "@@ -92,8 +92,8 @@ public function toJSON()\n     {\n         return json_encode([\n             'type' => 'DateRange',\n-            'starting' => $this->getStarting()->format('d.m.Y'),\n-            'ending' => $this->getEnding()->format('d.m.Y'),\n+            'starting' => $this->getStarting()?->format('d.m.Y'),\n+            'ending' => $this->getEnding()?->format('d.m.Y'),\n         ]);\n     }\n \n@@ -107,13 +107,17 @@ public function fromJSON($string)\n         $json = json_decode($string);\n \n         $starting = \\DateTime::createFromFormat('d.m.Y', $json->starting, new DateTimeZone('UTC'));\n-        $starting->setTime(0, 0, 0);\n-\n+        if($starting instanceof \\DateTime) {\n+            $starting->setTime(0, 0, 0);\n+            $this->setStarting($starting);\n+        }\n         $ending = \\DateTime::createFromFormat('d.m.Y', $json->ending, new DateTimeZone('UTC'));\n-        $ending->setTime(23, 59, 59);\n \n-        $this->setStarting($starting);\n-        $this->setEnding($ending);\n+        if($ending instanceof \\DateTime) {\n+            $ending->setTime(23, 59, 59);\n+            $this->setEnding($ending);\n+        }\n+\n \n         return $this;\n     }"
            },
            {
                "sha": "6693184f1424c6afe78b4cd37bf4244dc88745c0",
                "filename": "bundles/EcommerceFrameworkBundle/Resources/public/js/pricing/config/item.js",
                "status": "modified",
                "additions": 12,
                "deletions": 2,
                "changes": 14,
                "blob_url": "https://github.com/pimcore/pimcore/blob/a4491551967d879141a3fdf0986a9dd3d891abfe/bundles%2FEcommerceFrameworkBundle%2FResources%2Fpublic%2Fjs%2Fpricing%2Fconfig%2Fitem.js",
                "raw_url": "https://github.com/pimcore/pimcore/raw/a4491551967d879141a3fdf0986a9dd3d891abfe/bundles%2FEcommerceFrameworkBundle%2FResources%2Fpublic%2Fjs%2Fpricing%2Fconfig%2Fitem.js",
                "contents_url": "https://api.github.com/repos/pimcore/pimcore/contents/bundles%2FEcommerceFrameworkBundle%2FResources%2Fpublic%2Fjs%2Fpricing%2Fconfig%2Fitem.js?ref=a4491551967d879141a3fdf0986a9dd3d891abfe",
                "patch": "@@ -706,15 +706,25 @@ pimcore.bundle.EcommerceFramework.pricing.conditions = {\n                 format: 'd.m.Y',\n                 altFormats: 'U',\n                 value: data.starting,\n-                width: 400\n+                width: 400,\n+                onChange: function (value) {\n+                    if (Ext.String.hasHtmlCharacters(value)) {\n+                        this.setValue(null);\n+                    }\n+                },\n             },{\n                 xtype:'datefield',\n                 fieldLabel: t(\"to\"),\n                 name: \"ending\",\n                 format: 'd.m.Y',\n                 altFormats: 'U',\n                 value: data.ending,\n-                width: 400\n+                width: 400,\n+                onChange: function (value) {\n+                    if (Ext.String.hasHtmlCharacters(value)) {\n+                        this.setValue(null);\n+                    }\n+                },\n             }],\n             listeners: {\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/chatwoot/chatwoot/commits/6fdd4a29969be8423f31890b807d27d13627c50c",
        "url": "https://api.github.com/repos/chatwoot/chatwoot/commits/6fdd4a29969be8423f31890b807d27d13627c50c",
        "html_url": "https://github.com/chatwoot/chatwoot/commit/6fdd4a29969be8423f31890b807d27d13627c50c",
        "message": "chore: Security Improvements to the API (#2893)\n\n- Devise auth tokens are reset on password update\r\n- Avatar attachment file type is limited to jpeg,gif and png\r\n- Avatar attachment file size is limited to 15 mb\r\n- Widget Message attachments are limited to types ['image/png', 'image/jpeg', 'image/gif', 'image/bmp', 'image/tiff', 'application/pdf', 'audio/mpeg', 'video/mp4', 'audio/ogg', 'text/csv']\r\n- Widget Message attachments are limited to 40Mb size limit.",
        "files": [
            {
                "sha": "b6ae5409d90b53aff8205a216f4a28843eaf67db",
                "filename": "app/builders/messages/message_builder.rb",
                "status": "modified",
                "additions": 14,
                "deletions": 10,
                "changes": 24,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fbuilders%2Fmessages%2Fmessage_builder.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fbuilders%2Fmessages%2Fmessage_builder.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fbuilders%2Fmessages%2Fmessage_builder.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -15,21 +15,25 @@ def initialize(user, conversation, params)\n \n   def perform\n     @message = @conversation.messages.build(message_params)\n-    if @attachments.present?\n-      @attachments.each do |uploaded_attachment|\n-        attachment = @message.attachments.new(\n-          account_id: @message.account_id,\n-          file_type: file_type(uploaded_attachment&.content_type)\n-        )\n-        attachment.file.attach(uploaded_attachment)\n-      end\n-    end\n-    @message.save\n+    process_attachments\n+    @message.save!\n     @message\n   end\n \n   private\n \n+  def process_attachments\n+    return if @attachments.blank?\n+\n+    @attachments.each do |uploaded_attachment|\n+      @message.attachments.build(\n+        account_id: @message.account_id,\n+        file_type: file_type(uploaded_attachment&.content_type),\n+        file: uploaded_attachment\n+      )\n+    end\n+  end\n+\n   def message_type\n     if @conversation.inbox.channel_type != 'Channel::Api' && @message_type == 'incoming'\n       raise StandardError, 'Incoming messages are only allowed in Api inboxes'"
            },
            {
                "sha": "0d9ab6323077d8a2885ab955d4d3a1130a866fbd",
                "filename": "app/controllers/api/v1/widget/messages_controller.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fapi%2Fv1%2Fwidget%2Fmessages_controller.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fapi%2Fv1%2Fwidget%2Fmessages_controller.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fcontrollers%2Fapi%2Fv1%2Fwidget%2Fmessages_controller.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -8,8 +8,8 @@ def index\n \n   def create\n     @message = conversation.messages.new(message_params)\n-    @message.save\n     build_attachment\n+    @message.save!\n   end\n \n   def update\n@@ -29,13 +29,12 @@ def build_attachment\n     return if params[:message][:attachments].blank?\n \n     params[:message][:attachments].each do |uploaded_attachment|\n-      attachment = @message.attachments.new(\n+      @message.attachments.new(\n         account_id: @message.account_id,\n-        file_type: helpers.file_type(uploaded_attachment&.content_type)\n+        file_type: helpers.file_type(uploaded_attachment&.content_type),\n+        file: uploaded_attachment\n       )\n-      attachment.file.attach(uploaded_attachment)\n     end\n-    @message.save!\n   end\n \n   def set_conversation"
            },
            {
                "sha": "925c16d3843369b912bee73f3aa7abfbbb6d0e34",
                "filename": "app/controllers/public/api/v1/inboxes/messages_controller.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fpublic%2Fapi%2Fv1%2Finboxes%2Fmessages_controller.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fpublic%2Fapi%2Fv1%2Finboxes%2Fmessages_controller.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fcontrollers%2Fpublic%2Fapi%2Fv1%2Finboxes%2Fmessages_controller.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -7,8 +7,8 @@ def index\n \n   def create\n     @message = @conversation.messages.new(message_params)\n-    @message.save\n     build_attachment\n+    @message.save!\n   end\n \n   def update\n@@ -23,13 +23,12 @@ def build_attachment\n     return if params[:attachments].blank?\n \n     params[:attachments].each do |uploaded_attachment|\n-      attachment = @message.attachments.new(\n+      @message.attachments.new(\n         account_id: @message.account_id,\n-        file_type: helpers.file_type(uploaded_attachment&.content_type)\n+        file_type: helpers.file_type(uploaded_attachment&.content_type),\n+        file: uploaded_attachment\n       )\n-      attachment.file.attach(uploaded_attachment)\n     end\n-    @message.save!\n   end\n \n   def message_finder_params"
            },
            {
                "sha": "64d67701a0d2b352bdb0b4c3a585ebe74b12fe0f",
                "filename": "app/helpers/file_type_helper.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fhelpers%2Ffile_type_helper.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fhelpers%2Ffile_type_helper.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fhelpers%2Ffile_type_helper.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -3,12 +3,12 @@ def file_type(content_type)\n     return :image if [\n       'image/jpeg',\n       'image/png',\n-      'image/svg+xml',\n       'image/gif',\n       'image/tiff',\n       'image/bmp'\n     ].include?(content_type)\n \n+    return :video if content_type.include?('video/')\n     return :audio if content_type.include?('audio/')\n \n     :file"
            },
            {
                "sha": "1ffc9be6538c2c14cab4eac7f249c0ec757f5b98",
                "filename": "app/javascript/dashboard/components/widgets/WootWriter/ReplyBottomPanel.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2FWootWriter%2FReplyBottomPanel.vue",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2FWootWriter%2FReplyBottomPanel.vue",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2FWootWriter%2FReplyBottomPanel.vue?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -11,10 +11,11 @@\n         @click=\"toggleEmojiPicker\"\n       />\n \n+      <!-- ensure the same validations for attachment types are implemented in  backend models as well -->\n       <file-upload\n         ref=\"upload\"\n         :size=\"4096 * 4096\"\n-        accept=\"image/*, application/pdf, audio/mpeg, video/mp4, audio/ogg, text/csv\"\n+        accept=\"image/png, image/jpeg, image/gif, image/bmp, image/tiff, application/pdf, audio/mpeg, video/mp4, audio/ogg, text/csv\"\n         :drop=\"true\"\n         :drop-directory=\"false\"\n         @input-file=\"onFileUpload\""
            },
            {
                "sha": "705d15ad85f0b83b6481dcb6aa2293a9371fb581",
                "filename": "app/javascript/dashboard/components/widgets/forms/AvatarUploader.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2Fforms%2FAvatarUploader.vue",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2Fforms%2FAvatarUploader.vue",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2Fforms%2FAvatarUploader.vue?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -20,12 +20,13 @@\n         id=\"file\"\n         ref=\"file\"\n         type=\"file\"\n-        accept=\"image/*\"\n+        accept=\"image/png, image/jpeg, image/gif\"\n         @change=\"handleImageUpload\"\n       />\n       <slot></slot>\n     </label>\n   </div>\n+\n </template>\n \n <script>"
            },
            {
                "sha": "cb1f21e33c37c8e7152ffa89710c705d7c1f5343",
                "filename": "app/models/attachment.rb",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fattachment.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fattachment.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fmodels%2Fattachment.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -20,6 +20,7 @@ class Attachment < ApplicationRecord\n   belongs_to :account\n   belongs_to :message\n   has_one_attached :file\n+  validate :acceptable_file\n \n   enum file_type: [:image, :audio, :video, :file, :location, :fallback]\n \n@@ -76,4 +77,22 @@ def base_data\n       account_id: account_id\n     }\n   end\n+\n+  def should_validate_file?\n+    return unless file.attached?\n+    # we are only limiting attachment types in case of website widget\n+    return unless message.inbox.channel_type == 'Channel::WebWidget'\n+\n+    true\n+  end\n+\n+  def acceptable_file\n+    should_validate_file?\n+\n+    errors.add(:file, 'is too big') if file.byte_size > 40.megabytes\n+\n+    acceptable_types = ['image/png', 'image/jpeg', 'image/gif', 'image/bmp', 'image/tiff', 'application/pdf', 'audio/mpeg', 'video/mp4', 'audio/ogg',\n+                        'text/csv'].freeze\n+    errors.add(:file, 'filetype not supported') unless acceptable_types.include?(file.content_type)\n+  end\n end"
            },
            {
                "sha": "d5bcb862df570534dcc7288fea159ff05be84175",
                "filename": "app/models/concerns/avatarable.rb",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fconcerns%2Favatarable.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fconcerns%2Favatarable.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fmodels%2Fconcerns%2Favatarable.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -6,6 +6,7 @@ module Avatarable\n \n   included do\n     has_one_attached :avatar\n+    validate :acceptable_avatar\n   end\n \n   def avatar_url\n@@ -18,4 +19,13 @@ def avatar_url\n \n     ''\n   end\n+\n+  def acceptable_avatar\n+    return unless avatar.attached?\n+\n+    errors.add(:avatar, 'is too big') if avatar.byte_size > 15.megabytes\n+\n+    acceptable_types = ['image/jpeg', 'image/png', 'image/gif'].freeze\n+    errors.add(:avatar, 'filetype not supported') unless acceptable_types.include?(avatar.content_type)\n+  end\n end"
            },
            {
                "sha": "f222bd7bac9f6166d7143b6aa37d6aa227650b0b",
                "filename": "config/initializers/devise_token_auth.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/config%2Finitializers%2Fdevise_token_auth.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/config%2Finitializers%2Fdevise_token_auth.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/config%2Finitializers%2Fdevise_token_auth.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -9,6 +9,10 @@\n   # determines how long tokens will remain valid after they are issued.\n   config.token_lifespan = 2.months\n \n+  # By default, old tokens are not invalidated when password is changed.\n+  # Enable this option if you want to make passwords updates to logout other devices.\n+  config.remove_tokens_after_password_reset = true\n+\n   # Sets the max number of concurrent devices per user, which is 10 by default.\n   # After this limit is reached, the oldest tokens will be removed.\n   # config.max_number_of_devices = 10"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/pyload/pyload/commits/fe94451dcc2be90b3889e2fd9d07b483c8a6dccd",
        "url": "https://api.github.com/repos/pyload/pyload/commits/fe94451dcc2be90b3889e2fd9d07b483c8a6dccd",
        "html_url": "https://github.com/pyload/pyload/commit/fe94451dcc2be90b3889e2fd9d07b483c8a6dccd",
        "message": "fix GHSA-g3cm-qg2v-2hj5 security advisory",
        "files": [
            {
                "sha": "9900293155ed5151de334ad55a6099ec748ac9a9",
                "filename": "src/pyload/webui/app/blueprints/app_blueprint.py",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/pyload/pyload/blob/fe94451dcc2be90b3889e2fd9d07b483c8a6dccd/src%2Fpyload%2Fwebui%2Fapp%2Fblueprints%2Fapp_blueprint.py",
                "raw_url": "https://github.com/pyload/pyload/raw/fe94451dcc2be90b3889e2fd9d07b483c8a6dccd/src%2Fpyload%2Fwebui%2Fapp%2Fblueprints%2Fapp_blueprint.py",
                "contents_url": "https://api.github.com/repos/pyload/pyload/contents/src%2Fpyload%2Fwebui%2Fapp%2Fblueprints%2Fapp_blueprint.py?ref=fe94451dcc2be90b3889e2fd9d07b483c8a6dccd",
                "patch": "@@ -47,7 +47,7 @@ def robots():\n def login():\n     api = flask.current_app.config[\"PYLOAD_API\"]\n \n-    next = get_redirect_url(fallback=flask.url_for(\"app.dashboard\"))\n+    next_url = get_redirect_url(fallback=\"app.dashboard\")\n \n     if flask.request.method == \"POST\":\n         user = flask.request.form[\"username\"]\n@@ -57,14 +57,14 @@ def login():\n         sanitized_user = user.replace(\"\\n\", \"\\\\n\").replace(\"\\r\", \"\\\\r\")\n         if not user_info:\n             log.error(f\"Login failed for user '{sanitized_user}'\")\n-            return render_template(\"login.html\", next=next, errors=True)\n+            return render_template(\"login.html\", errors=True)\n \n         set_session(user_info)\n         log.info(f\"User '{sanitized_user}' successfully logged in\")\n         flask.flash(\"Logged in successfully\")\n \n     if is_authenticated():\n-        return flask.redirect(next)\n+        return flask.redirect(next_url)\n \n     if api.get_config_value(\"webui\", \"autologin\"):\n         allusers = api.get_all_userdata()\n@@ -74,9 +74,9 @@ def login():\n             # NOTE: Double-check authentication here because if session[name] is empty,\n             #       next login_required redirects here again and all loop out.\n             if is_authenticated():\n-                return flask.redirect(next)\n+                return flask.redirect(next_url)\n \n-    return render_template(\"login.html\", next=next)\n+    return render_template(\"login.html\")\n \n \n @bp.route(\"/logout\", endpoint=\"logout\")"
            },
            {
                "sha": "2b50f966ea45dae540ad7af4a2d91a71f1ef9114",
                "filename": "src/pyload/webui/app/helpers.py",
                "status": "modified",
                "additions": 19,
                "deletions": 15,
                "changes": 34,
                "blob_url": "https://github.com/pyload/pyload/blob/fe94451dcc2be90b3889e2fd9d07b483c8a6dccd/src%2Fpyload%2Fwebui%2Fapp%2Fhelpers.py",
                "raw_url": "https://github.com/pyload/pyload/raw/fe94451dcc2be90b3889e2fd9d07b483c8a6dccd/src%2Fpyload%2Fwebui%2Fapp%2Fhelpers.py",
                "contents_url": "https://api.github.com/repos/pyload/pyload/contents/src%2Fpyload%2Fwebui%2Fapp%2Fhelpers.py?ref=fe94451dcc2be90b3889e2fd9d07b483c8a6dccd",
                "patch": "@@ -2,10 +2,11 @@\n \n import json\n from functools import wraps\n-from urllib.parse import unquote, urljoin, urlparse\n+from urllib.parse import urljoin, urlparse\n \n import flask\n import flask_themes2\n+import werkzeug.routing.exceptions\n from pyload.core.api import Perms, Role, has_permission\n \n \n@@ -33,22 +34,25 @@ def loads(self, s, **kwargs):\n \n #: Checks if location belongs to same host address\n def is_safe_url(location):\n-    ref_url = urlparse(flask.request.host_url)\n-    test_url = urlparse(urljoin(flask.request.host_url, location))\n-    return test_url.scheme in ('http', 'https') and ref_url.netloc == test_url.netloc\n+    location_urlp = urlparse(location)\n+    #: if relative URL then must start with \"/\"\n+    if not location_urlp.netloc and location[0] != \"/\":\n+        return False\n+    host_urlp = urlparse(flask.request.host_url)\n+    test_urlp = urlparse(urljoin(flask.request.host_url, location))\n+    return test_urlp.scheme in ('http', 'https') and host_urlp.netloc == test_urlp.netloc\n \n \n def get_redirect_url(fallback=None):\n-    login_url = urljoin(flask.request.url_root, flask.url_for('app.login'))\n-    request_url = unquote(flask.request.url)\n-    for location in flask.request.values.get(\"next\"), flask.request.referrer:\n-        if not location:\n-            continue\n-        if location in (request_url, login_url):  # don't redirect to same location\n-            continue\n-        if is_safe_url(location):\n-            return location\n-    return fallback\n+    next_arg = flask.request.values.get(\"next\")\n+    redirect_url = flask.url_for(fallback)\n+    if next_arg and next_arg != \"login\":  # don't redirect to same location\n+        try:\n+            redirect_url = flask.url_for(f\"app.{next_arg}\")\n+        except werkzeug.routing.exceptions.BuildError:\n+            pass\n+\n+    return urljoin(flask.request.url_root, redirect_url)\n \n \n def render_base(messages):\n@@ -206,7 +210,7 @@ def wrapper(*args, **kwargs):\n                 else:\n                     location = flask.url_for(\n                         \"app.login\",\n-                        next=flask.request.url\n+                        next=flask.request.endpoint.split(\".\")[-1]\n                     )\n                     response = flask.redirect(location)\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/phpipam/phpipam/commits/55c2056068be9f1359e967fcff64db6b7f4d00b5",
        "url": "https://api.github.com/repos/phpipam/phpipam/commits/55c2056068be9f1359e967fcff64db6b7f4d00b5",
        "html_url": "https://github.com/phpipam/phpipam/commit/55c2056068be9f1359e967fcff64db6b7f4d00b5",
        "message": "v1.7.0 version bump",
        "files": [
            {
                "sha": "352a24bfdc1b0a119c058322769abe44ed2e61f4",
                "filename": "db/SCHEMA.sql",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/phpipam/phpipam/blob/55c2056068be9f1359e967fcff64db6b7f4d00b5/db%2FSCHEMA.sql",
                "raw_url": "https://github.com/phpipam/phpipam/raw/55c2056068be9f1359e967fcff64db6b7f4d00b5/db%2FSCHEMA.sql",
                "contents_url": "https://api.github.com/repos/phpipam/phpipam/contents/db%2FSCHEMA.sql?ref=55c2056068be9f1359e967fcff64db6b7f4d00b5",
                "patch": "@@ -1048,7 +1048,7 @@ CREATE TABLE `passkeys` (\n   PRIMARY KEY (`id`),\n   KEY `user_id` (`user_id`),\n   CONSTRAINT `user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n \n \n # Dump of table nominatim\n@@ -1080,5 +1080,5 @@ CREATE TABLE `nominatim_cache` (\n # Dump of table -- for autofix comment, leave as it is\n # ------------------------------------------------------------\n \n-UPDATE `settings` SET `version` = \"1.6\";\n-UPDATE `settings` SET `dbversion` = 40;\n+UPDATE `settings` SET `version` = \"1.7\";\n+UPDATE `settings` SET `dbversion` = 41;"
            },
            {
                "sha": "5b9c993c60769b4b631bc7f87f449b91c42c75f1",
                "filename": "functions/upgrade_queries.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/phpipam/phpipam/blob/55c2056068be9f1359e967fcff64db6b7f4d00b5/functions%2Fupgrade_queries.php",
                "raw_url": "https://github.com/phpipam/phpipam/raw/55c2056068be9f1359e967fcff64db6b7f4d00b5/functions%2Fupgrade_queries.php",
                "contents_url": "https://api.github.com/repos/phpipam/phpipam/contents/functions%2Fupgrade_queries.php?ref=55c2056068be9f1359e967fcff64db6b7f4d00b5",
                "patch": "@@ -19,6 +19,7 @@\n include('upgrade_queries/upgrade_queries_1.4.php');\n include('upgrade_queries/upgrade_queries_1.5.php');\n include('upgrade_queries/upgrade_queries_1.6.php');\n+include('upgrade_queries/upgrade_queries_1.7.php');\n \n \n // output if required"
            },
            {
                "sha": "43e9971e038fe1ea919b8d4a2bdeeeace7e5f00e",
                "filename": "functions/upgrade_queries/upgrade_queries_1.6.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/phpipam/phpipam/blob/55c2056068be9f1359e967fcff64db6b7f4d00b5/functions%2Fupgrade_queries%2Fupgrade_queries_1.6.php",
                "raw_url": "https://github.com/phpipam/phpipam/raw/55c2056068be9f1359e967fcff64db6b7f4d00b5/functions%2Fupgrade_queries%2Fupgrade_queries_1.6.php",
                "contents_url": "https://api.github.com/repos/phpipam/phpipam/contents/functions%2Fupgrade_queries%2Fupgrade_queries_1.6.php?ref=55c2056068be9f1359e967fcff64db6b7f4d00b5",
                "patch": "@@ -28,4 +28,4 @@\n   PRIMARY KEY (`id`),\n   KEY `user_id` (`user_id`),\n   CONSTRAINT `user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8;\";\n\\ No newline at end of file\n+) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\";\n\\ No newline at end of file"
            },
            {
                "sha": "99c5b6a6864c313e39dc9e057810be9828e3a750",
                "filename": "functions/upgrade_queries/upgrade_queries_1.7.php",
                "status": "added",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/phpipam/phpipam/blob/55c2056068be9f1359e967fcff64db6b7f4d00b5/functions%2Fupgrade_queries%2Fupgrade_queries_1.7.php",
                "raw_url": "https://github.com/phpipam/phpipam/raw/55c2056068be9f1359e967fcff64db6b7f4d00b5/functions%2Fupgrade_queries%2Fupgrade_queries_1.7.php",
                "contents_url": "https://api.github.com/repos/phpipam/phpipam/contents/functions%2Fupgrade_queries%2Fupgrade_queries_1.7.php?ref=55c2056068be9f1359e967fcff64db6b7f4d00b5",
                "patch": "@@ -0,0 +1,10 @@\n+<?php\n+\n+#\n+# Version 1.71 queries\n+#\n+$upgrade_queries[\"1.7.41\"]   = [];\n+$upgrade_queries[\"1.7.41\"][] = \"-- Version update\";\n+$upgrade_queries[\"1.7.41\"][] = \"UPDATE `settings` set `version` = '1.7';\";\n+$upgrade_queries[\"1.7.41\"][] = \"-- Database version bump\";\n+$upgrade_queries[\"1.7.41\"][] = \"UPDATE `settings` set `dbversion` = '41';\";\n\\ No newline at end of file"
            },
            {
                "sha": "da913411eb540f6a004bd8e053d890938a854111",
                "filename": "functions/version.php",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/phpipam/phpipam/blob/55c2056068be9f1359e967fcff64db6b7f4d00b5/functions%2Fversion.php",
                "raw_url": "https://github.com/phpipam/phpipam/raw/55c2056068be9f1359e967fcff64db6b7f4d00b5/functions%2Fversion.php",
                "contents_url": "https://api.github.com/repos/phpipam/phpipam/contents/functions%2Fversion.php?ref=55c2056068be9f1359e967fcff64db6b7f4d00b5",
                "patch": "@@ -1,14 +1,14 @@\n <?php\n /* set latest version */\n-define(\"VERSION\", \"1.6\");\t\t\t\t\t\t\t\t\t//decimal release version e.g 1.32\n+define(\"VERSION\", \"1.7\");\t\t\t\t\t\t\t\t\t//decimal release version e.g 1.32\n /* set latest version */\n-define(\"VERSION_VISIBLE\", \"1.6.1\");\t\t\t\t\t\t\t//visible version in footer e.g 1.3.2\n+define(\"VERSION_VISIBLE\", \"1.7.0\");\t\t\t\t\t\t\t//visible version in footer e.g 1.3.2\n /* set latest revision */\n-define(\"REVISION\", \"003\");\t\t\t\t\t\t\t\t\t//increment on static content changes (js/css) or point releases to avoid caching issues\n+define(\"REVISION\", \"001\");\t\t\t\t\t\t\t\t\t//increment on static content changes (js/css) or point releases to avoid caching issues\n /* set last possible upgrade */\n define(\"LAST_POSSIBLE\", \"1.4\");\t\t\t\t\t\t\t    //minimum required version to be able to upgrade\n /* set published - hide dbversion in footer */\n-define(\"PUBLISHED\", true);\t\t\t\t\t\t\t\t\t//hide dbversion in footer\n+define(\"PUBLISHED\", false);\t\t\t\t\t\t\t\t\t//hide dbversion in footer\n \n // Automatically set DBVERSION as everyone forgets!\n function get_dbversion() {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/gpac/gpac/commits/b68b3f0bf5c366e003221d78fd663a1d5514a876",
        "url": "https://api.github.com/repos/gpac/gpac/commits/b68b3f0bf5c366e003221d78fd663a1d5514a876",
        "html_url": "https://github.com/gpac/gpac/commit/b68b3f0bf5c366e003221d78fd663a1d5514a876",
        "message": "fixed #2577",
        "files": [
            {
                "sha": "bd96400689f891c76f7a1854d12f3ceaf7a726d9",
                "filename": "src/filters/isoffin_read_ch.c",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/gpac/gpac/blob/b68b3f0bf5c366e003221d78fd663a1d5514a876/src%2Ffilters%2Fisoffin_read_ch.c",
                "raw_url": "https://github.com/gpac/gpac/raw/b68b3f0bf5c366e003221d78fd663a1d5514a876/src%2Ffilters%2Fisoffin_read_ch.c",
                "contents_url": "https://api.github.com/repos/gpac/gpac/contents/src%2Ffilters%2Fisoffin_read_ch.c?ref=b68b3f0bf5c366e003221d78fd663a1d5514a876",
                "patch": "@@ -495,6 +495,7 @@ void isor_reader_get_sample(ISOMChannel *ch)\n \t\t\t\tif (ch->pck) {\n \t\t\t\t\tgf_filter_pck_discard(ch->pck);\n \t\t\t\t\tch->pck = NULL;\n+\t\t\t\t\tch->static_sample->alloc_size = ch->static_sample->dataLength = 0;\n \t\t\t\t}\n \t\t\t\tisor_reader_get_sample(ch);\n \t\t\t\treturn;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/wallabag/wallabag/commits/268372dbbdd7ef87b84617fdebf95d0a86caf7dc",
        "url": "https://api.github.com/repos/wallabag/wallabag/commits/268372dbbdd7ef87b84617fdebf95d0a86caf7dc",
        "html_url": "https://github.com/wallabag/wallabag/commit/268372dbbdd7ef87b84617fdebf95d0a86caf7dc",
        "message": "Merge pull request #6289 from wallabag/2.5/fix-csrf-user-deletion\n\nFix CSRF on user deletion",
        "files": [
            {
                "sha": "acca1cfc0aae0e508ecabfba8fd48af4dc21e904",
                "filename": "src/Wallabag/CoreBundle/Controller/ConfigController.php",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/wallabag/wallabag/blob/268372dbbdd7ef87b84617fdebf95d0a86caf7dc/src%2FWallabag%2FCoreBundle%2FController%2FConfigController.php",
                "raw_url": "https://github.com/wallabag/wallabag/raw/268372dbbdd7ef87b84617fdebf95d0a86caf7dc/src%2FWallabag%2FCoreBundle%2FController%2FConfigController.php",
                "contents_url": "https://api.github.com/repos/wallabag/wallabag/contents/src%2FWallabag%2FCoreBundle%2FController%2FConfigController.php?ref=268372dbbdd7ef87b84617fdebf95d0a86caf7dc",
                "patch": "@@ -586,14 +586,18 @@ public function resetAction($type)\n     /**\n      * Delete account for current user.\n      *\n-     * @Route(\"/account/delete\", name=\"delete_account\")\n+     * @Route(\"/account/delete\", name=\"delete_account\", methods={\"POST\"})\n      *\n      * @throws AccessDeniedHttpException\n      *\n      * @return \\Symfony\\Component\\HttpFoundation\\RedirectResponse\n      */\n     public function deleteAccountAction(Request $request)\n     {\n+        if (!$this->isCsrfTokenValid('delete-account', $request->request->get('token'))) {\n+            throw $this->createAccessDeniedException('Bad CSRF token.');\n+        }\n+\n         $enabledUsers = $this->get('wallabag_user.user_repository')\n             ->getSumEnabledUsers();\n "
            },
            {
                "sha": "c55df5300382336a9bf7dc32b151a492f11944a4",
                "filename": "src/Wallabag/CoreBundle/Resources/views/themes/material/Config/index.html.twig",
                "status": "modified",
                "additions": 6,
                "deletions": 4,
                "changes": 10,
                "blob_url": "https://github.com/wallabag/wallabag/blob/268372dbbdd7ef87b84617fdebf95d0a86caf7dc/src%2FWallabag%2FCoreBundle%2FResources%2Fviews%2Fthemes%2Fmaterial%2FConfig%2Findex.html.twig",
                "raw_url": "https://github.com/wallabag/wallabag/raw/268372dbbdd7ef87b84617fdebf95d0a86caf7dc/src%2FWallabag%2FCoreBundle%2FResources%2Fviews%2Fthemes%2Fmaterial%2FConfig%2Findex.html.twig",
                "contents_url": "https://api.github.com/repos/wallabag/wallabag/contents/src%2FWallabag%2FCoreBundle%2FResources%2Fviews%2Fthemes%2Fmaterial%2FConfig%2Findex.html.twig?ref=268372dbbdd7ef87b84617fdebf95d0a86caf7dc",
                "patch": "@@ -548,7 +548,7 @@\n                             </div>\n                         </div>\n                     </div>\n-                    \n+\n                     <div id=\"set7\" class=\"col s12\">\n                         <div class=\"row\">\n                             <h5>{{ 'config.reset.title'|trans }}</h5>\n@@ -573,9 +573,11 @@\n                             <div class=\"row\">\n                                 <h5>{{ 'config.form_user.delete.title'|trans }}</h5>\n                                 <p>{{ 'config.form_user.delete.description'|trans }}</p>\n-                                <a href=\"{{ path('delete_account') }}\" onclick=\"return confirm('{{ 'config.form_user.delete.confirm'|trans|escape('js') }}')\" class=\"waves-effect waves-light btn red delete-account\">\n-                                    {{ 'config.form_user.delete.button'|trans }}\n-                                </a>\n+                                <form action=\"{{ path('delete_account') }}\" method=\"post\" onsubmit=\"return confirm('{{ 'config.form_user.delete.confirm'|trans|escape('js') }}')\" name=\"delete-account\">\n+                                    <input type=\"hidden\" name=\"token\" value=\"{{ csrf_token('delete-account') }}\" />\n+\n+                                    <button class=\"waves-effect waves-light btn red\" type=\"submit\">{{ 'config.form_user.delete.button'|trans }}</button>\n+                                </form>\n                             </div>\n                         {% endif %}\n                     </div>"
            },
            {
                "sha": "1021b2bcee7f32b4d74f76ee9d6fff573cf4d621",
                "filename": "tests/Wallabag/CoreBundle/Controller/ConfigControllerTest.php",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/wallabag/wallabag/blob/268372dbbdd7ef87b84617fdebf95d0a86caf7dc/tests%2FWallabag%2FCoreBundle%2FController%2FConfigControllerTest.php",
                "raw_url": "https://github.com/wallabag/wallabag/raw/268372dbbdd7ef87b84617fdebf95d0a86caf7dc/tests%2FWallabag%2FCoreBundle%2FController%2FConfigControllerTest.php",
                "contents_url": "https://api.github.com/repos/wallabag/wallabag/contents/tests%2FWallabag%2FCoreBundle%2FController%2FConfigControllerTest.php?ref=268372dbbdd7ef87b84617fdebf95d0a86caf7dc",
                "patch": "@@ -794,7 +794,7 @@ public function testDeleteUserButtonVisibility()\n         $this->assertGreaterThan(1, $body = $crawler->filter('body')->extract(['_text']));\n         $this->assertStringNotContainsString('config.form_user.delete.button', $body[0]);\n \n-        $client->request('GET', '/account/delete');\n+        $client->request('POST', '/account/delete');\n         $this->assertSame(403, $client->getResponse()->getStatusCode());\n \n         $user = $em\n@@ -860,9 +860,9 @@ public function testDeleteAccount()\n \n         $crawler = $client->request('GET', '/config');\n \n-        $deleteLink = $crawler->filter('.delete-account')->last()->link();\n+        $deleteForm = $crawler->filter('form[name=delete-account]')->form();\n \n-        $client->click($deleteLink);\n+        $client->submit($deleteForm);\n         $this->assertSame(302, $client->getResponse()->getStatusCode());\n \n         $em = $client->getContainer()->get('doctrine.orm.entity_manager');"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dolibarr/dolibarr/commits/63cd06394f39d60784d6e6a0ccf4867a71a6568f",
        "url": "https://api.github.com/repos/Dolibarr/dolibarr/commits/63cd06394f39d60784d6e6a0ccf4867a71a6568f",
        "html_url": "https://github.com/Dolibarr/dolibarr/commit/63cd06394f39d60784d6e6a0ccf4867a71a6568f",
        "message": "Debug permission on supplier order.\nFix #huntr58ddbd8a-0faf-4b3f-aec9-5850bb19ab67",
        "files": [
            {
                "sha": "07ecf19de63eb210997c3a87f8a6dadc28bf3323",
                "filename": "htdocs/core/menus/standard/eldy.lib.php",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/Dolibarr/dolibarr/blob/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Fcore%2Fmenus%2Fstandard%2Feldy.lib.php",
                "raw_url": "https://github.com/Dolibarr/dolibarr/raw/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Fcore%2Fmenus%2Fstandard%2Feldy.lib.php",
                "contents_url": "https://api.github.com/repos/Dolibarr/dolibarr/contents/htdocs%2Fcore%2Fmenus%2Fstandard%2Feldy.lib.php?ref=63cd06394f39d60784d6e6a0ccf4867a71a6568f",
                "patch": "@@ -2149,7 +2149,8 @@ function print_left_eldy_menu($db, $menu_array_before, $menu_array_after, &$tabM\n \t\t\t\t\t// Not enabled but visible (so greyed), except if parent was not enabled.\n \t\t\t\t\tprint '<div class=\"menu_contenu'.$cssmenu.'\">';\n \t\t\t\t\tprint $tabstring;\n-\t\t\t\t\tprint '<span class=\"vsmenudisabled vsmenudisabledmargin\">'.$menu_array[$i]['titre'].'</span><br></div>'.\"\\n\";\n+\t\t\t\t\tprint '<span class=\"vsmenudisabled vsmenudisabledmargin\">'.$menu_array[$i]['titre'].'</span><br>';\n+\t\t\t\t\tprint '</div>'.\"\\n\";\n \t\t\t\t}\n \t\t\t}\n "
            },
            {
                "sha": "9b68ef199db0523a5e8599030ad6a421ba147cbb",
                "filename": "htdocs/fourn/class/fournisseur.commande.class.php",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/Dolibarr/dolibarr/blob/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ffourn%2Fclass%2Ffournisseur.commande.class.php",
                "raw_url": "https://github.com/Dolibarr/dolibarr/raw/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ffourn%2Fclass%2Ffournisseur.commande.class.php",
                "contents_url": "https://api.github.com/repos/Dolibarr/dolibarr/contents/htdocs%2Ffourn%2Fclass%2Ffournisseur.commande.class.php?ref=63cd06394f39d60784d6e6a0ccf4867a71a6568f",
                "patch": "@@ -2295,7 +2295,14 @@ public function Livraison($user, $date, $type, $comment)\n \n \t\tdol_syslog(get_class($this).\"::Livraison\");\n \n-\t\tif ($user->rights->fournisseur->commande->receptionner) {\n+\t\t$usercanreceive = 0;\n+\t\tif (empty($conf->reception->enabled)) {\n+\t\t\t$usercanreceive = $user->rights->fournisseur->commande->receptionner;\n+\t\t} else {\n+\t\t\t$usercanreceive = $user->rights->reception->creer;\n+\t\t}\n+\n+\t\tif ($usercanreceive) {\n \t\t\t// Define the new status\n \t\t\tif ($type == 'par') {\n \t\t\t\t$statut = self::STATUS_RECEIVED_PARTIALLY;"
            },
            {
                "sha": "92501d57d1dbfd65969766b9e9d19596f98c1927",
                "filename": "htdocs/fourn/commande/card.php",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/Dolibarr/dolibarr/blob/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ffourn%2Fcommande%2Fcard.php",
                "raw_url": "https://github.com/Dolibarr/dolibarr/raw/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ffourn%2Fcommande%2Fcard.php",
                "contents_url": "https://api.github.com/repos/Dolibarr/dolibarr/contents/htdocs%2Ffourn%2Fcommande%2Fcard.php?ref=63cd06394f39d60784d6e6a0ccf4867a71a6568f",
                "patch": "@@ -90,7 +90,6 @@\n if ($user->socid) {\n \t$socid = $user->socid;\n }\n-$result = restrictedArea($user, 'fournisseur', $id, 'commande_fournisseur', 'commande');\n \n // Initialize technical object to manage hooks of page. Note that conf->hooks_modules contains array of hook context\n $hookmanager->initHooks(array('ordersuppliercard', 'globalcard'));\n@@ -124,6 +123,8 @@\n \t}\n }\n \n+$result = restrictedArea($user, 'fournisseur', $id, 'commande_fournisseur', 'commande');\n+\n // Common permissions\n $usercanread\t= ($user->rights->fournisseur->commande->lire || $user->rights->supplier_order->lire);\n $usercancreate\t= ($user->rights->fournisseur->commande->creer || $user->rights->supplier_order->creer);\n@@ -136,7 +137,11 @@\n $usercanapprove\t\t\t= $user->rights->fournisseur->commande->approuver;\n $usercanapprovesecond\t= $user->rights->fournisseur->commande->approve2;\n $usercanorder\t\t\t= $user->rights->fournisseur->commande->commander;\n-$usercanreceived\t\t= $user->rights->fournisseur->commande->receptionner;\n+if (empty($conf->reception->enabled)) {\n+\t$usercanreceive = $user->rights->fournisseur->commande->receptionner;\n+} else {\n+\t$usercanreceive = $user->rights->reception->creer;\n+}\n \n // Permissions for includes\n $permissionnote\t\t= $usercancreate; // Used by the include of actions_setnotes.inc.php"
            },
            {
                "sha": "311cbd5f022a0bb94d4c6a470be890511a680e7c",
                "filename": "htdocs/fourn/commande/dispatch.php",
                "status": "modified",
                "additions": 34,
                "deletions": 15,
                "changes": 49,
                "blob_url": "https://github.com/Dolibarr/dolibarr/blob/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ffourn%2Fcommande%2Fdispatch.php",
                "raw_url": "https://github.com/Dolibarr/dolibarr/raw/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ffourn%2Fcommande%2Fdispatch.php",
                "contents_url": "https://api.github.com/repos/Dolibarr/dolibarr/contents/htdocs%2Ffourn%2Fcommande%2Fdispatch.php?ref=63cd06394f39d60784d6e6a0ccf4867a71a6568f",
                "patch": "@@ -62,11 +62,6 @@\n if ($user->socid) {\n \t$socid = $user->socid;\n }\n-$result = restrictedArea($user, 'fournisseur', $id, 'commande_fournisseur', 'commande');\n-\n-if (empty($conf->stock->enabled)) {\n-\taccessforbidden();\n-}\n \n $hookmanager->initHooks(array('ordersupplierdispatch'));\n \n@@ -89,6 +84,21 @@\n \t}\n }\n \n+if (empty($conf->reception->enabled)) {\n+\t$permissiontoreceive = $user->rights->fournisseur->commande->receptionner;\n+\t$permissiontocontrol = ((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->fournisseur->commande->receptionner)) || (!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->fournisseur->commande_advance->check)));\n+} else {\n+\t$permissiontoreceive = $user->rights->reception->creer;\n+\t$permissiontocontrol = ((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->reception->creer)) || (!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->reception->reception_advance->validate)));\n+}\n+\n+// $id is id of a purchase order.\n+$result = restrictedArea($user, 'fournisseur', $id, 'commande_fournisseur', 'commande');\n+\n+if (empty($conf->stock->enabled)) {\n+\taccessforbidden();\n+}\n+\n \n /*\n  * Actions\n@@ -100,7 +110,7 @@\n \tsetEventMessages($hookmanager->error, $hookmanager->errors, 'errors');\n }\n \n-if ($action == 'checkdispatchline' && !((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty($user->rights->fournisseur->commande->receptionner)) || (!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty($user->rights->fournisseur->commande_advance->check)))) {\n+if ($action == 'checkdispatchline' && $permissiontocontrol) {\n \t$error = 0;\n \t$supplierorderdispatch = new CommandeFournisseurDispatch($db);\n \n@@ -137,7 +147,7 @@\n \t}\n }\n \n-if ($action == 'uncheckdispatchline' && !((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty($user->rights->fournisseur->commande->receptionner)) || (!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty($user->rights->fournisseur->commande_advance->check)))) {\n+if ($action == 'uncheckdispatchline' && $permissiontocontrol) {\n \t$error = 0;\n \t$supplierorderdispatch = new CommandeFournisseurDispatch($db);\n \n@@ -173,7 +183,7 @@\n \t}\n }\n \n-if ($action == 'denydispatchline' && !((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty($user->rights->fournisseur->commande->receptionner)) || (!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty($user->rights->fournisseur->commande_advance->check)))) {\n+if ($action == 'denydispatchline' && $permissiontocontrol) {\n \t$error = 0;\n \t$supplierorderdispatch = new CommandeFournisseurDispatch($db);\n \n@@ -209,7 +219,7 @@\n \t}\n }\n \n-if ($action == 'dispatch' && $user->rights->fournisseur->commande->receptionner) {\n+if ($action == 'dispatch' && $permissiontoreceive) {\n \t$error = 0;\n \n \t$db->begin();\n@@ -387,7 +397,7 @@\n }\n \n // Remove a dispatched line\n-if ($action == 'confirm_deleteline' && $confirm == 'yes' && $user->rights->fournisseur->commande->receptionner) {\n+if ($action == 'confirm_deleteline' && $confirm == 'yes' && $permissiontoreceive) {\n \t$db->begin();\n \n \t$supplierorderdispatch = new CommandeFournisseurDispatch($db);\n@@ -430,7 +440,7 @@\n }\n \n // Update a dispatched line\n-if ($action == 'updateline' && $user->rights->fournisseur->commande->receptionner) {\n+if ($action == 'updateline' && $permissiontoreceive) {\n \t$db->begin();\n \t$error = 0;\n \n@@ -751,9 +761,9 @@\n \n \t\t\t\t// Select warehouse to force it everywhere\n \t\t\t\tif (count($listwarehouses) > 1) {\n-\t\t\t\t\tprint '<br>'.$langs->trans(\"ForceTo\").' '.$form->selectarray('fk_default_warehouse', $listwarehouses, $fk_default_warehouse, 1, 0, 0, '', 0, 0, $disabled, '', 'minwidth100 maxwidth300', 1);\n+\t\t\t\t\tprint '<br><span class=\"opacitymedium\">'.$langs->trans(\"ForceTo\").'</span> '.$form->selectarray('fk_default_warehouse', $listwarehouses, $fk_default_warehouse, 1, 0, 0, '', 0, 0, $disabled, '', 'minwidth100 maxwidth300', 1);\n \t\t\t\t} elseif (count($listwarehouses) == 1) {\n-\t\t\t\t\tprint '<br>'.$langs->trans(\"ForceTo\").' '.$form->selectarray('fk_default_warehouse', $listwarehouses, $fk_default_warehouse, 0, 0, 0, '', 0, 0, $disabled, '', 'minwidth100 maxwidth300', 1);\n+\t\t\t\t\tprint '<br><span class=\"opacitymedium\">'.$langs->trans(\"ForceTo\").'</span> '.$form->selectarray('fk_default_warehouse', $listwarehouses, $fk_default_warehouse, 0, 0, 0, '', 0, 0, $disabled, '', 'minwidth100 maxwidth300', 1);\n \t\t\t\t}\n \n \t\t\t\tprint '</td>';\n@@ -1055,10 +1065,19 @@\n \n \t\t\t\t$dispatchBt = empty($conf->reception->enabled) ? $langs->trans(\"Receive\") : $langs->trans(\"CreateReception\");\n \n-\t\t\t\tprint '<br><input type=\"submit\" class=\"button\" name=\"dispatch\" value=\"'.dol_escape_htmltag($dispatchBt).'\"';\n+\t\t\t\tprint '<br>';\n+\t\t\t\tprint '<input type=\"submit\" class=\"button\" name=\"dispatch\" value=\"'.dol_escape_htmltag($dispatchBt).'\"';\n+\t\t\t\t$disabled = 0;\n+\t\t\t\tif (!$permissiontoreceive) {\n+\t\t\t\t\t$disabled = 1;\n+\t\t\t\t}\n \t\t\t\tif (count($listwarehouses) <= 0) {\n+\t\t\t\t\t$disabled = 1;\n+\t\t\t\t}\n+\t\t\t\tif ($disabled) {\n \t\t\t\t\tprint ' disabled';\n \t\t\t\t}\n+\n \t\t\t\tprint '>';\n \t\t\t}\n \t\t\tprint '</div>';\n@@ -1257,7 +1276,7 @@\n \n \t\t\t\t\t// Add button to check/uncheck disaptching\n \t\t\t\t\tprint '<td class=\"center\">';\n-\t\t\t\t\tif ((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty($user->rights->fournisseur->commande->receptionner)) || (!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty($user->rights->fournisseur->commande_advance->check))) {\n+\t\t\t\t\tif (!$permissiontocontrol) {\n \t\t\t\t\t\tif (empty($objp->status)) {\n \t\t\t\t\t\t\tprint '<a class=\"button buttonRefused\" href=\"#\">'.$langs->trans(\"Approve\").'</a>';\n \t\t\t\t\t\t\tprint '<a class=\"button buttonRefused\" href=\"#\">'.$langs->trans(\"Deny\").'</a>';"
            },
            {
                "sha": "f84b8bd4d6c4f71ab7d2d3e9ff52fde49c802b3c",
                "filename": "htdocs/reception/card.php",
                "status": "modified",
                "additions": 33,
                "deletions": 24,
                "changes": 57,
                "blob_url": "https://github.com/Dolibarr/dolibarr/blob/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Freception%2Fcard.php",
                "raw_url": "https://github.com/Dolibarr/dolibarr/raw/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Freception%2Fcard.php",
                "contents_url": "https://api.github.com/repos/Dolibarr/dolibarr/contents/htdocs%2Freception%2Fcard.php?ref=63cd06394f39d60784d6e6a0ccf4867a71a6568f",
                "patch": "@@ -112,9 +112,6 @@\n // Initialize technical object to manage hooks of page. Note that conf->hooks_modules contains array of hook context\n $hookmanager->initHooks(array('receptioncard', 'globalcard'));\n \n-$permissiondellink = $user->rights->reception->creer; // Used by the include of actions_dellink.inc.php\n-//var_dump($object->lines[0]->detail_batch);\n-\n $date_delivery = dol_mktime(GETPOST('date_deliveryhour', 'int'), GETPOST('date_deliverymin', 'int'), 0, GETPOST('date_deliverymonth', 'int'), GETPOST('date_deliveryday', 'int'), GETPOST('date_deliveryyear', 'int'));\n \n if ($id > 0 || !empty($ref)) {\n@@ -142,16 +139,31 @@\n \t$socid = $user->socid;\n }\n \n-if ($origin == 'reception') {\n+if (!empty($conf->reception->enabled) || $origin == 'reception' || empty($origin)) {\n \t$result = restrictedArea($user, 'reception', $id);\n } else {\n+\t// We do not use the reception module, so we test permission on the supplier orders\n \tif ($origin == 'supplierorder' || $origin == 'order_supplier') {\n \t\t$result = restrictedArea($user, 'fournisseur', $origin_id, 'commande_fournisseur', 'commande');\n \t} elseif (empty($user->rights->{$origin}->lire) && empty($user->rights->{$origin}->read)) {\n \t\taccessforbidden();\n \t}\n }\n \n+if (!empty($conf->reception->enabled)) {\n+\t$permissiontoread = $user->rights->reception->lire;\n+\t$permissiontoadd = $user->rights->reception->creer;\n+\t$permissiondellink = $user->rights->reception->creer; // Used by the include of actions_dellink.inc.php\n+\t$permissiontovalidate = ((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->reception->creer)) || (!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->reception->reception_advance->validate)));\n+\t$permissiontodelete = $user->rights->reception->supprimer;\n+} else {\n+\t$permissiontoread = $user->rights->fournisseur->commande->receptionner;\n+\t$permissiontoadd = $user->rights->fournisseur->commande->receptionner;\n+\t$permissiondellink = $user->rights->fournisseur->commande->receptionner; // Used by the include of actions_dellink.inc.php\n+\t$permissiontovalidate = ((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->fournisseur->commande->receptionner)) || (!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->fournisseur->commande_advance->check)));\n+\t$permissiontodelete = $user->rights->fournisseur->commande->receptionner;\n+}\n+\n \n /*\n  * Actions\n@@ -171,12 +183,12 @@\n \tinclude DOL_DOCUMENT_ROOT.'/core/actions_dellink.inc.php'; // Must be include, not include_once\n \n \t// Reopen\n-\tif ($action == 'reopen' && $user->rights->reception->creer) {\n+\tif ($action == 'reopen' && $permissiontoadd) {\n \t\t$result = $object->reOpen();\n \t}\n \n \t// Confirm back to draft status\n-\tif ($action == 'modif' && $user->rights->reception->creer) {\n+\tif ($action == 'modif' && $permissiontoadd) {\n \t\t$result = $object->setDraft($user);\n \t\tif ($result >= 0) {\n \t\t\t// Define output language\n@@ -201,11 +213,11 @@\n \t}\n \n \t// Set incoterm\n-\tif ($action == 'set_incoterms' && !empty($conf->incoterm->enabled)) {\n+\tif ($action == 'set_incoterms' && !empty($conf->incoterm->enabled) && $permissiontoadd) {\n \t\t$result = $object->setIncoterms(GETPOST('incoterm_id', 'int'), GETPOST('location_incoterms', 'alpha'));\n \t}\n \n-\tif ($action == 'setref_supplier') {\n+\tif ($action == 'setref_supplier' && $permissiontoadd) {\n \t\tif ($result < 0) {\n \t\t\tsetEventMessages($object->error, $object->errors, 'errors');\n \t\t}\n@@ -220,7 +232,7 @@\n \t\t}\n \t}\n \n-\tif ($action == 'update_extras') {\n+\tif ($action == 'update_extras' && $permissiontoadd) {\n \t\t$object->oldcopy = dol_clone($object);\n \n \t\t// Fill array 'array_options' with data from update form\n@@ -244,7 +256,7 @@\n \t}\n \n \t// Create reception\n-\tif ($action == 'add' && $user->rights->reception->creer) {\n+\tif ($action == 'add' && $permissiontoadd) {\n \t\t$error = 0;\n \t\t$predef = '';\n \n@@ -405,10 +417,7 @@\n \t\t\t$_GET[\"commande_id\"] = GETPOST('commande_id', 'int');\n \t\t\t$action = 'create';\n \t\t}\n-\t} elseif ($action == 'confirm_valid' && $confirm == 'yes' &&\n-\t\t((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->reception->creer))\n-\t\t|| (!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && !empty($user->rights->reception->reception_advance->validate)))\n-\t) {\n+\t} elseif ($action == 'confirm_valid' && $confirm == 'yes' && $permissiontovalidate) {\n \t\t$object->fetch_thirdparty();\n \n \t\t$result = $object->valid($user);\n@@ -440,7 +449,7 @@\n \t\t\t\t}\n \t\t\t}\n \t\t}\n-\t} elseif ($action == 'confirm_delete' && $confirm == 'yes' && $user->rights->reception->supprimer) {\n+\t} elseif ($action == 'confirm_delete' && $confirm == 'yes' && $permissiontodelete) {\n \t\t$result = $object->delete($user);\n \t\tif ($result > 0) {\n \t\t\theader(\"Location: \".DOL_URL_ROOT.'/reception/index.php');\n@@ -455,7 +464,7 @@\n \t\t\tif ($result < 0) {\n \t\t\t\tsetEventMessages($object->error, $object->errors, 'errors');\n \t\t}*/\n-\t} elseif ($action == 'setdate_livraison' && $user->rights->reception->creer) {\n+\t} elseif ($action == 'setdate_livraison' && $permissiontoadd) {\n \t\t//print \"x \".$_POST['liv_month'].\", \".$_POST['liv_day'].\", \".$_POST['liv_year'];\n \t\t$datedelivery = dol_mktime(GETPOST('liv_hour', 'int'), GETPOST('liv_min', 'int'), 0, GETPOST('liv_month', 'int'), GETPOST('liv_day', 'int'), GETPOST('liv_year', 'int'));\n \n@@ -506,7 +515,7 @@\n \t\t}\n \n \t\t$action = \"\";\n-\t} elseif ($action == 'builddoc') {\n+\t} elseif ($action == 'builddoc' && $permissiontoread) {\n \t\t// Build document\n \t\t// En get ou en post\n \t\t// Save last template used to generate document\n@@ -532,7 +541,7 @@\n \t\t\tsetEventMessages($object->error, $object->errors, 'errors');\n \t\t\t$action = '';\n \t\t}\n-\t} elseif ($action == 'remove_file') {\n+\t} elseif ($action == 'remove_file' && $permissiontoadd) {\n \t\t// Delete file in doc form\n \t\trequire_once DOL_DOCUMENT_ROOT.'/core/lib/files.lib.php';\n \n@@ -550,13 +559,13 @@\n \t\t\theader('Location: '.$_SERVER[\"PHP_SELF\"].'?id='.$object->id);\n \t\t\texit();\n \t\t}\n-\t} elseif ($action == 'classifyclosed') {\n+\t} elseif ($action == 'classifyclosed' && $permissiontoread) {\n \t\t$result = $object->setClosed();\n \t\tif ($result >= 0) {\n \t\t\theader('Location: '.$_SERVER[\"PHP_SELF\"].'?id='.$object->id);\n \t\t\texit();\n \t\t}\n-\t} elseif ($action == 'deleteline' && !empty($line_id)) {\n+\t} elseif ($action == 'deleteline' && !empty($line_id) && $permissiontoread) {\n \t\t// delete a line\n \t\t$lines = $object->lines;\n \t\t$line = new CommandeFournisseurDispatch($db);\n@@ -579,7 +588,7 @@\n \t\t} else {\n \t\t\tsetEventMessages($line->error, $line->errors, 'errors');\n \t\t}\n-\t} elseif ($action == 'updateline' && $user->rights->reception->creer && GETPOST('save')) {\n+\t} elseif ($action == 'updateline' && GETPOST('save') && $permissiontoadd) {\n \t\t// Update a line\n \t\t// Clean parameters\n \t\t$qty = 0;\n@@ -666,11 +675,11 @@\n \t\t\t\t$object->generateDocument($object->model_pdf, $outputlangs, $hidedetails, $hidedesc, $hideref);\n \t\t\t}\n \t\t} else {\n-\t\t\theader('Location: '.$_SERVER['PHP_SELF'].'?id='.$object->id); // Pour reaffichage de la fiche en cours d'edition\n+\t\t\theader('Location: '.$_SERVER['PHP_SELF'].'?id='.$object->id); // To reshow the record we edit\n \t\t\texit();\n \t\t}\n-\t} elseif ($action == 'updateline' && $user->rights->reception->creer && GETPOST('cancel', 'alpha') == $langs->trans(\"Cancel\")) {\n-\t\theader('Location: '.$_SERVER['PHP_SELF'].'?id='.$object->id); // Pour reaffichage de la fiche en cours d'edition\n+\t} elseif ($action == 'updateline' && $permissiontoadd && GETPOST('cancel', 'alpha') == $langs->trans(\"Cancel\")) {\n+\t\theader('Location: '.$_SERVER['PHP_SELF'].'?id='.$object->id); // To reshow the record we edit\n \t\texit();\n \t}\n "
            },
            {
                "sha": "218d2a20be00c21da3b5119308279de2a5b7b599",
                "filename": "htdocs/theme/eldy/global.inc.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/Dolibarr/dolibarr/blob/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ftheme%2Feldy%2Fglobal.inc.php",
                "raw_url": "https://github.com/Dolibarr/dolibarr/raw/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ftheme%2Feldy%2Fglobal.inc.php",
                "contents_url": "https://api.github.com/repos/Dolibarr/dolibarr/contents/htdocs%2Ftheme%2Feldy%2Fglobal.inc.php?ref=63cd06394f39d60784d6e6a0ccf4867a71a6568f",
                "patch": "@@ -2881,12 +2881,12 @@\n \tcolor: #202020;\n \tmargin: 1px 1px 1px 6px;\n }\n-font.vsmenudisabled { font-family: <?php print $fontlist ?>; text-align: <?php print $left; ?>; color: #aaa; }\n+span.vsmenudisabled, font.vsmenudisabled { font-family: <?php print $fontlist ?>; text-align: <?php print $left; ?>; color: #aaa; }\n a.vsmenu:link, a.vsmenu:visited {\n \tcolor: var(--colortextbackvmenu);\n \twhite-space: nowrap;\n }\n-font.vsmenudisabledmargin { margin: 1px 1px 1px 6px; }\n+span.vsmenudisabledmargin, font.vsmenudisabledmargin { margin: 1px 1px 1px 6px; }\n li a.vsmenudisabled, li.vsmenudisabled { color: #aaa !important; }\n \n a.help:link, a.help:visited, a.help:hover, a.help:active, span.help { text-align: <?php print $left; ?>; color: #aaa; text-decoration: none; }"
            },
            {
                "sha": "c39bf34d74a55a349604bf43a8a6266660c3154c",
                "filename": "htdocs/theme/md/style.css.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/Dolibarr/dolibarr/blob/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ftheme%2Fmd%2Fstyle.css.php",
                "raw_url": "https://github.com/Dolibarr/dolibarr/raw/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Ftheme%2Fmd%2Fstyle.css.php",
                "contents_url": "https://api.github.com/repos/Dolibarr/dolibarr/contents/htdocs%2Ftheme%2Fmd%2Fstyle.css.php?ref=63cd06394f39d60784d6e6a0ccf4867a71a6568f",
                "patch": "@@ -2928,9 +2928,9 @@\n a.vmenu:link, a.vmenu:visited { color: #<?php echo $colortextbackvmenu; ?>; }\n \n a.vsmenu:link, a.vsmenu:visited, a.vsmenu:hover, a.vsmenu:active, span.vsmenu { font-size:<?php print $fontsize ?>px; font-family: <?php print $fontlist ?>; text-align: <?php print $left; ?>; font-weight: normal; color: #202020; margin: 1px 1px 1px 8px; }\n-font.vsmenudisabled { font-size:<?php print $fontsize ?>px; font-family: <?php print $fontlist ?>; text-align: <?php print $left; ?>; font-weight: normal; color: #aaa; }\n+span.vsmenudisabled, font.vsmenudisabled { font-size:<?php print $fontsize ?>px; font-family: <?php print $fontlist ?>; text-align: <?php print $left; ?>; font-weight: normal; color: #aaa; }\n a.vsmenu:link, a.vsmenu:visited { color: #<?php echo $colortextbackvmenu; ?>; white-space: nowrap; }\n-font.vsmenudisabledmargin { margin: 1px 1px 1px 8px; }\n+span.vsmenudisabledmargin, font.vsmenudisabledmargin { margin: 1px 1px 1px 8px; }\n \n a.help:link, a.help:visited, a.help:hover, a.help:active, span.help { text-align: <?php print $left; ?>; font-weight: normal; color: #999; text-decoration: none; }\n "
            },
            {
                "sha": "4571ed48884d0a3716d34da5056d7ab918a3c4ec",
                "filename": "htdocs/user/perms.php",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/Dolibarr/dolibarr/blob/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Fuser%2Fperms.php",
                "raw_url": "https://github.com/Dolibarr/dolibarr/raw/63cd06394f39d60784d6e6a0ccf4867a71a6568f/htdocs%2Fuser%2Fperms.php",
                "contents_url": "https://api.github.com/repos/Dolibarr/dolibarr/contents/htdocs%2Fuser%2Fperms.php?ref=63cd06394f39d60784d6e6a0ccf4867a71a6568f",
                "patch": "@@ -317,6 +317,19 @@\n \t\t\tcontinue;\n \t\t}\n \n+\t\t// Special cases\n+\t\tif (!empty($conf->reception->enabled)) {\n+\t\t\t// The 2 permission in fournisseur modules has been replaced by permissions into reception module\n+\t\t\tif ($obj->module == 'fournisseur' && $obj->perms == 'commande' && $obj->subperms == 'receptionner') {\n+\t\t\t\t$i++;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\tif ($obj->module == 'fournisseur' && $obj->perms == 'commande_advance' && $obj->subperms == 'check') {\n+\t\t\t\t$i++;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t}\n+\n \t\t$objMod = $modules[$obj->module];\n \n \t\t// Save field module_position in database if value is wrong"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/janeczku/calibre-web/commits/7ad419dc8c12180e842a82118f4866ac3d074bc5",
        "url": "https://api.github.com/repos/janeczku/calibre-web/commits/7ad419dc8c12180e842a82118f4866ac3d074bc5",
        "html_url": "https://github.com/janeczku/calibre-web/commit/7ad419dc8c12180e842a82118f4866ac3d074bc5",
        "message": "Fix upload of cover and book formats containing html characters",
        "files": [
            {
                "sha": "0bfe078cfea0219a1eadc7ea938ccf4df2b9d204",
                "filename": "cps/static/js/edit_books.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/janeczku/calibre-web/blob/7ad419dc8c12180e842a82118f4866ac3d074bc5/cps%2Fstatic%2Fjs%2Fedit_books.js",
                "raw_url": "https://github.com/janeczku/calibre-web/raw/7ad419dc8c12180e842a82118f4866ac3d074bc5/cps%2Fstatic%2Fjs%2Fedit_books.js",
                "contents_url": "https://api.github.com/repos/janeczku/calibre-web/contents/cps%2Fstatic%2Fjs%2Fedit_books.js?ref=7ad419dc8c12180e842a82118f4866ac3d074bc5",
                "patch": "@@ -248,15 +248,15 @@ $(\"#btn-upload-format\").on(\"change\", function () {\n     if (filename.substring(3, 11) === \"fakepath\") {\n         filename = filename.substring(12);\n     } // Remove c:\\fake at beginning from localhost chrome\n-    $(\"#upload-format\").html(filename);\n+    $(\"#upload-format\").text(filename);\n });\n \n $(\"#btn-upload-cover\").on(\"change\", function () {\n     var filename = $(this).val();\n     if (filename.substring(3, 11) === \"fakepath\") {\n         filename = filename.substring(12);\n     } // Remove c:\\fake at beginning from localhost chrome\n-    $(\"#upload-cover\").html(filename);\n+    $(\"#upload-cover\").text(filename);\n });\n \n $(\"#xchange\").click(function () {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/janeczku/calibre-web/commits/bcdc97641447965af486964537f3821f47b28874",
        "url": "https://api.github.com/repos/janeczku/calibre-web/commits/bcdc97641447965af486964537f3821f47b28874",
        "html_url": "https://github.com/janeczku/calibre-web/commit/bcdc97641447965af486964537f3821f47b28874",
        "message": "Added missing check for creating public shelfs",
        "files": [
            {
                "sha": "97147a716884e3c7c6bfc83967b4628c15b08a57",
                "filename": "cps/shelf.py",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/janeczku/calibre-web/blob/bcdc97641447965af486964537f3821f47b28874/cps%2Fshelf.py",
                "raw_url": "https://github.com/janeczku/calibre-web/raw/bcdc97641447965af486964537f3821f47b28874/cps%2Fshelf.py",
                "contents_url": "https://api.github.com/repos/janeczku/calibre-web/contents/cps%2Fshelf.py?ref=bcdc97641447965af486964537f3821f47b28874",
                "patch": "@@ -224,8 +224,13 @@ def remove_from_shelf(shelf_id, book_id):\n @shelf.route(\"/shelf/create\", methods=[\"GET\", \"POST\"])\n @login_required\n def create_shelf():\n-    shelf = ub.Shelf()\n-    return create_edit_shelf(shelf, page_title=_(u\"Create a Shelf\"), page=\"shelfcreate\")\n+    if not current_user.role_edit_shelfs() and request.method == 'POST':\n+        flash(_(u\"Sorry you are not allowed to create a public shelf\"), category=\"error\")\n+        return redirect(url_for('web.index'))\n+    else:\n+        shelf = ub.Shelf()\n+        return create_edit_shelf(shelf, page_title=_(u\"Create a Shelf\"), page=\"shelfcreate\")\n+\n \n \n @shelf.route(\"/shelf/edit/<int:shelf_id>\", methods=[\"GET\", \"POST\"])"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/janeczku/calibre-web/commits/6f5390ead5df9779ac81fadefffb476e03f93548",
        "url": "https://api.github.com/repos/janeczku/calibre-web/commits/6f5390ead5df9779ac81fadefffb476e03f93548",
        "html_url": "https://github.com/janeczku/calibre-web/commit/6f5390ead5df9779ac81fadefffb476e03f93548",
        "message": "Changed error message in case of trying to delete a shelf unauthorized\nRemoved outcommented text",
        "files": [
            {
                "sha": "800fb3dd140d5a9dbe6c0ebbf229e692cc2615b9",
                "filename": "cps/db.py",
                "status": "modified",
                "additions": 0,
                "deletions": 9,
                "changes": 9,
                "blob_url": "https://github.com/janeczku/calibre-web/blob/6f5390ead5df9779ac81fadefffb476e03f93548/cps%2Fdb.py",
                "raw_url": "https://github.com/janeczku/calibre-web/raw/6f5390ead5df9779ac81fadefffb476e03f93548/cps%2Fdb.py",
                "contents_url": "https://api.github.com/repos/janeczku/calibre-web/contents/cps%2Fdb.py?ref=6f5390ead5df9779ac81fadefffb476e03f93548",
                "patch": "@@ -807,15 +807,6 @@ def speaking_language(self, languages=None):\n                 .group_by(text('books_languages_link.lang_code')).all()\n         for lang in languages:\n             lang.name = isoLanguages.get_language_name(get_locale(), lang.lang_code)\n-            #try:\n-            #    if lang.lang_code.lower() == \"und\":\n-            #        lang.name = isoLanguages.get_language_name(get_locale(), lang.lang_code)\n-            #        # lang.name = _(\"Undetermined\")\n-            #    else:\n-            #        cur_l = LC.parse(lang.lang_code)\n-            #        lang.name = cur_l.get_language_name(get_locale())\n-            #except UnknownLocaleError:\n-            #    lang.name = _(isoLanguages.get(part3=lang.lang_code).name)\n         return languages\n \n     def update_title_sort(self, config, conn=None):"
            },
            {
                "sha": "2c6a17a2d069165059cb803a7789e30ab8ceb01c",
                "filename": "cps/shelf.py",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/janeczku/calibre-web/blob/6f5390ead5df9779ac81fadefffb476e03f93548/cps%2Fshelf.py",
                "raw_url": "https://github.com/janeczku/calibre-web/raw/6f5390ead5df9779ac81fadefffb476e03f93548/cps%2Fshelf.py",
                "contents_url": "https://api.github.com/repos/janeczku/calibre-web/contents/cps%2Fshelf.py?ref=6f5390ead5df9779ac81fadefffb476e03f93548",
                "patch": "@@ -122,8 +122,8 @@ def search_to_shelf(shelf_id):\n         return redirect(url_for('web.index'))\n \n     if not check_shelf_edit_permissions(shelf):\n-        log.warning(\"You are not allowed to add a book to the the shelf: {}\".format(shelf.name))\n-        flash(_(u\"You are not allowed to add a book to the the shelf: %(name)s\", name=shelf.name), category=\"error\")\n+        log.warning(\"You are not allowed to add a book to the shelf\".format(shelf.name))\n+        flash(_(u\"You are not allowed to add a book to the shelf\"), category=\"error\")\n         return redirect(url_for('web.index'))\n \n     if current_user.id in ub.searched_ids and ub.searched_ids[current_user.id]:\n@@ -215,10 +215,10 @@ def remove_from_shelf(shelf_id, book_id):\n     else:\n         if not xhr:\n             log.warning(\"You are not allowed to remove a book from shelf: {}\".format(shelf.name))\n-            flash(_(u\"Sorry you are not allowed to remove a book from this shelf: %(sname)s\", sname=shelf.name),\n+            flash(_(u\"Sorry you are not allowed to remove a book from this shelf\"),\n                   category=\"error\")\n             return redirect(url_for('web.index'))\n-        return \"Sorry you are not allowed to remove a book from this shelf: %s\" % shelf.name, 403\n+        return \"Sorry you are not allowed to remove a book from this shelf\", 403\n \n \n @shelf.route(\"/shelf/create\", methods=[\"GET\", \"POST\"])"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dompdf/dompdf/commits/f56bc8e40be6c0ae0825e6c7396f4db80620b799",
        "url": "https://api.github.com/repos/dompdf/dompdf/commits/f56bc8e40be6c0ae0825e6c7396f4db80620b799",
        "html_url": "https://github.com/dompdf/dompdf/commit/f56bc8e40be6c0ae0825e6c7396f4db80620b799",
        "message": "Validate SVG image references",
        "files": [
            {
                "sha": "754b78a209c58dc74e7cda08885b0bde88d4cbb0",
                "filename": "src/Image/Cache.php",
                "status": "modified",
                "additions": 33,
                "deletions": 0,
                "changes": 33,
                "blob_url": "https://github.com/dompdf/dompdf/blob/f56bc8e40be6c0ae0825e6c7396f4db80620b799/src%2FImage%2FCache.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/f56bc8e40be6c0ae0825e6c7396f4db80620b799/src%2FImage%2FCache.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/src%2FImage%2FCache.php?ref=f56bc8e40be6c0ae0825e6c7396f4db80620b799",
                "patch": "@@ -129,6 +129,39 @@ static function resolve_url($url, $protocol, $host, $base_path, Options $options\n             if (($width && $height && in_array($type, [\"gif\", \"png\", \"jpeg\", \"bmp\", \"svg\",\"webp\"], true)) === false) {\n                 throw new ImageException(\"Image type unknown\", E_WARNING);\n             }\n+\n+            if ($type === \"svg\") {\n+                $parser = xml_parser_create(\"utf-8\");\n+                xml_parser_set_option($parser, XML_OPTION_CASE_FOLDING, false);\n+                xml_set_element_handler(\n+                    $parser,\n+                    function ($parser, $name, $attributes) use ($options, $parsed_url, $full_url) {\n+                        if ($name === \"image\") {\n+                            $attributes = array_change_key_case($attributes, CASE_LOWER);\n+                            $url = $attributes[\"xlink:href\"] ?? $attributes[\"href\"];\n+                            if (!empty($url)) {\n+                                $inner_full_url = Helpers::build_url($parsed_url[\"protocol\"], $parsed_url[\"host\"], $parsed_url[\"path\"], $url);\n+                                if ($inner_full_url === $full_url) {\n+                                    throw new ImageException(\"SVG self-reference is not allowed\", E_WARNING);\n+                                }\n+                                [$resolved_url, $type, $message] = self::resolve_url($url, $parsed_url[\"protocol\"], $parsed_url[\"host\"], $parsed_url[\"path\"], $options);\n+                                if (!empty($message)) {\n+                                    throw new ImageException(\"This SVG document references a restricted resource. $message\", E_WARNING);\n+                                }\n+                            }\n+                        }\n+                    },\n+                    false\n+                );\n+        \n+                if (($fp = fopen($resolved_url, \"r\")) !== false) {\n+                    while ($line = fread($fp, 8192)) {\n+                        xml_parse($parser, $line, false);\n+                    }\n+                    fclose($fp);\n+                }\n+                xml_parser_free($parser);\n+            }\n         } catch (ImageException $e) {\n             if ($tempfile) {\n                 unlink($tempfile);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/sylius/sylius/commits/3da169e0c23e752974d74223cc536c29a2a82edc",
        "url": "https://api.github.com/repos/Sylius/Sylius/commits/3da169e0c23e752974d74223cc536c29a2a82edc",
        "html_url": "https://github.com/Sylius/Sylius/commit/3da169e0c23e752974d74223cc536c29a2a82edc",
        "message": "bug #13765 [Security] Fixes for SVG XSS, wrong cache for logged in users and clickjacking (ernestWarwas, lchrusciel, GSadee, Zales0123, Rafikooo)\n\nThis PR was merged into the 1.9 branch.\n\nDiscussion\n----------\n\n| Q               | A\r\n| --------------- | -----\r\n| Branch?         | 1.9\r\n| Bug fix?        | yes\r\n| New feature?    | no\r\n| BC breaks?      | no\r\n| Deprecations?   | no\r\n| Related tickets | \r\n| License         | MIT\r\n\r\nThis PR aims to solve 3 issues:\r\n1. Possibility to inject SVGs with scripts (https://rietta.com/blog/svg-xss-injection-attacks/)\r\n2. Possibility to check admin pages with back button after logging out due to wrong cache'ing configuration\r\n3. Clickjacking while rendering Sylius in iframe (https://portswigger.net/web-security/clickjacking)\r\n\r\n<!--\r\n - Bug fixes must be submitted against the 1.10 or 1.11 branch(the lowest possible)\r\n - Features and deprecations must be submitted against the master branch\r\n - Make sure that the correct base branch is set\r\n\r\n To be sure you are not breaking any Backward Compatibilities, check the documentation:\r\n https://docs.sylius.com/en/latest/book/organization/backward-compatibility-promise.html\r\n-->\r\n\n\nCommits\n-------\n\n088607803652d77ea80881890f044002d737c84e listener added to finish response with X-Frame-Options sameorigin header\nc23643109c9976aa13fa3cd355c2138f4af4b790 suggested review changes\n67de9e81044fdb68ef7b0afabadaddb8644cd7ea bug #14 [Security] Clickjacking vulnerability fixed (ernestWarwas)\n4b6a77ae9e5e902737c656fb32b16ef17b461a09 [UI] Force no-store cache directives for admin and customer account section\n691b700a11b6688d7296a1693efb47bbef6141cf [Maintenace] Test existence of new cache headers\n08d0f5a1f431f9c7400f8c8c264418541c1ef56f Remove type declarations for properties due to supporting PHP 7.3\n94366fdfece8932ac22a54244492cd0d8811a648 Minor fixes for specs and unit tests of cache control subscribers\n5dee3dc656b91a9b0b88034365d48bfc1ccd0063 [Behat] Add scenarios for securing access to account and dashboard after logging out\nd4bf36c88426b899bba3aefb97987cd45604b093 [Behat] Extract browser element and context\nafa04e392472efed81f0b91c931d2452edbbc760 Replace str_contains with strpos method to support PHP 7\nb00eb517b1863bf013ac19512dbcc6102463953e [PHPUnit] Move subscribers tests to main directory\n253f66b9abfc9897d343153e18d516c6364cfe13 bug #11 [Security] Set cache control directives to fix security leak after logging out and using back button (lchrusciel, GSadee)\n46ed54bb0b7dae44e53d429a3edd68f5506c47a0 [Security] XSS - SVG file upload vulnerability fixed\n6ccc2d63fbd6b7b4678190cb17734a4b3895c3a8 bug #12 [Security] XSS - SVG file upload vulnerability fixed (Rafikooo)",
        "files": [
            {
                "sha": "9e3de1f224573d9f421af94a4c2d7d8a3c33b948",
                "filename": "composer.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/composer.json",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/composer.json",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/composer.json?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -35,6 +35,7 @@\n         \"doctrine/migrations\": \"^3.0\",\n         \"doctrine/orm\": \"^2.7\",\n         \"egulias/email-validator\": \"^2.1\",\n+        \"enshrined/svg-sanitize\": \"^0.15.4\",\n         \"fakerphp/faker\": \"^1.9\",\n         \"friendsofphp/proxy-manager-lts\": \"^1.0\",\n         \"friendsofsymfony/oauth-server-bundle\": \">2.0.0-alpha.0 ^2.0@dev\","
            },
            {
                "sha": "2861b65eff476cf9c86747029b839db7c712be4c",
                "filename": "features/account/customer_account/securing_access_to_account_after_using_back_button_after_logging_out.feature",
                "status": "added",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/features%2Faccount%2Fcustomer_account%2Fsecuring_access_to_account_after_using_back_button_after_logging_out.feature",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/features%2Faccount%2Fcustomer_account%2Fsecuring_access_to_account_after_using_back_button_after_logging_out.feature",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/features%2Faccount%2Fcustomer_account%2Fsecuring_access_to_account_after_using_back_button_after_logging_out.feature?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,17 @@\n+@customer_account\n+Feature: Securing access to the account after using the back button after logging out\n+    In order to have my personal information secured\n+    As a Customer\n+    I want to be unable to access to the account by using the back button after logging out\n+\n+    Background:\n+        Given the store operates on a single channel in \"United States\"\n+        And I am a logged in customer\n+        And I am browsing my orders\n+\n+    @ui @javascript @no-api\n+    Scenario: Securing access to the account after using the back button after logging out\n+        When I log out\n+        And I go back one page in the browser\n+        Then I should not see my orders\n+        And I should be on the login page"
            },
            {
                "sha": "8954ec9a5fff560bf336dc3cbba75d444ea3b315",
                "filename": "features/admin/securing_access_to_account_after_using_back_button_after_logging_out.feature",
                "status": "added",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/features%2Fadmin%2Fsecuring_access_to_account_after_using_back_button_after_logging_out.feature",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/features%2Fadmin%2Fsecuring_access_to_account_after_using_back_button_after_logging_out.feature",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/features%2Fadmin%2Fsecuring_access_to_account_after_using_back_button_after_logging_out.feature?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,17 @@\n+@admin_dashboard\n+Feature: Securing access to the administration panel after using the back button after logging out\n+    In order to have administration panel secured\n+    As an Administrator\n+    I want to be unable to access to the administration panel by using the back button after logging out\n+\n+    Background:\n+        Given the store operates on a single channel in \"United States\"\n+        And I am logged in as an administrator\n+        And I am on the administration dashboard\n+\n+    @ui @javascript @no-api\n+    Scenario: Securing access to administration dashboard after using the back button after logging out\n+        When I log out\n+        And I go back one page in the browser\n+        Then I should not see the administration dashboard\n+        And I should be on the login page"
            },
            {
                "sha": "52b281e79d16ad9b17c74333034bd390729aae4c",
                "filename": "src/Sylius/Behat/Context/Ui/Admin/DashboardContext.php",
                "status": "modified",
                "additions": 18,
                "deletions": 1,
                "changes": 19,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FContext%2FUi%2FAdmin%2FDashboardContext.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FContext%2FUi%2FAdmin%2FDashboardContext.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FContext%2FUi%2FAdmin%2FDashboardContext.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -30,9 +30,10 @@ public function __construct(DashboardPageInterface $dashboardPage)\n     }\n \n     /**\n+     * @Given I am on the administration dashboard\n      * @When I (try to )open administration dashboard\n      */\n-    public function iOpenAdministrationDashboard()\n+    public function iOpenAdministrationDashboard(): void\n     {\n         try {\n             $this->dashboardPage->open();\n@@ -56,6 +57,14 @@ public function iChooseChannel($channelName)\n         $this->dashboardPage->chooseChannel($channelName);\n     }\n \n+    /**\n+     * @When I log out\n+     */\n+    public function iLogOut(): void\n+    {\n+        $this->dashboardPage->logOut();\n+    }\n+\n     /**\n      * @Then I should see :number new orders\n      */\n@@ -103,4 +112,12 @@ public function iShouldSeeNewOrdersInTheList($number)\n     {\n         Assert::same($this->dashboardPage->getNumberOfNewOrdersInTheList(), (int) $number);\n     }\n+\n+    /**\n+     * @Then I should not see the administration dashboard\n+     */\n+    public function iShouldNotSeeTheAdministrationDashboard(): void\n+    {\n+        Assert::false($this->dashboardPage->isOpen());\n+    }\n }"
            },
            {
                "sha": "3064c2e141e17a801446f9bc7d66e6e6092b7279",
                "filename": "src/Sylius/Behat/Context/Ui/Admin/LoginContext.php",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FContext%2FUi%2FAdmin%2FLoginContext.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FContext%2FUi%2FAdmin%2FLoginContext.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FContext%2FUi%2FAdmin%2FLoginContext.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -141,4 +141,12 @@ private function logInAgain($username, $password)\n         $this->loginPage->specifyPassword($password);\n         $this->loginPage->logIn();\n     }\n+\n+    /**\n+     * @Then I should be on the login page\n+     */\n+    public function iShouldBeOnTheLoginPage(): void\n+    {\n+        Assert::true($this->loginPage->isOpen());\n+    }\n }"
            },
            {
                "sha": "544704d13d50fe0e57a05098c4c815bde8c5fe94",
                "filename": "src/Sylius/Behat/Context/Ui/BrowserContext.php",
                "status": "added",
                "additions": 36,
                "deletions": 0,
                "changes": 36,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FContext%2FUi%2FBrowserContext.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FContext%2FUi%2FBrowserContext.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FContext%2FUi%2FBrowserContext.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,36 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Behat\\Context\\Ui;\n+\n+use Behat\\Behat\\Context\\Context;\n+use Sylius\\Behat\\Element\\BrowserElementInterface;\n+\n+final class BrowserContext implements Context\n+{\n+    /** @var BrowserElementInterface */\n+    private $browserElement;\n+\n+    public function __construct(BrowserElementInterface $browserElement)\n+    {\n+        $this->browserElement = $browserElement;\n+    }\n+\n+    /**\n+     * @When I go back one page in the browser\n+     */\n+    public function iGoBackOnePageInTheBrowser(): void\n+    {\n+        $this->browserElement->goBack();\n+    }\n+}"
            },
            {
                "sha": "79e4e515a51ba728698952900bd0bb439edf988b",
                "filename": "src/Sylius/Behat/Context/Ui/Shop/AccountContext.php",
                "status": "modified",
                "additions": 18,
                "deletions": 1,
                "changes": 19,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FContext%2FUi%2FShop%2FAccountContext.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FContext%2FUi%2FShop%2FAccountContext.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FContext%2FUi%2FShop%2FAccountContext.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -263,9 +263,10 @@ public function iShouldBeNotifiedThatThePasswordShouldBeAtLeastCharactersLong()\n     }\n \n     /**\n+     * @Given I am browsing my orders\n      * @When I browse my orders\n      */\n-    public function iBrowseMyOrders()\n+    public function iBrowseMyOrders(): void\n     {\n         $this->orderIndexPage->open();\n     }\n@@ -531,4 +532,20 @@ public function iShouldNotBeLoggedIn(): void\n \n         throw new \\InvalidArgumentException('Dashboard has been openned, but it shouldn\\'t as customer should not be logged in');\n     }\n+\n+    /**\n+     * @Then I should not see my orders\n+     */\n+    public function iShouldNotSeeMyOrders(): void\n+    {\n+        Assert::false($this->orderIndexPage->isOpen());\n+    }\n+\n+    /**\n+     * @Then I should be on the login page\n+     */\n+    public function iShouldBeOnTheLoginPage(): void\n+    {\n+        Assert::true($this->loginPage->isOpen());\n+    }\n }"
            },
            {
                "sha": "3743fa94fc7a1b86deb02e1900145b121caa5246",
                "filename": "src/Sylius/Behat/Element/BrowserElement.php",
                "status": "added",
                "additions": 24,
                "deletions": 0,
                "changes": 24,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FElement%2FBrowserElement.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FElement%2FBrowserElement.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FElement%2FBrowserElement.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,24 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Behat\\Element;\n+\n+use FriendsOfBehat\\PageObjectExtension\\Element\\Element;\n+\n+final class BrowserElement extends Element implements BrowserElementInterface\n+{\n+    public function goBack(): void\n+    {\n+        $this->getDriver()->back();\n+    }\n+}"
            },
            {
                "sha": "4f533b13d57a426cbe0af2a8ea55d4146e3a4e64",
                "filename": "src/Sylius/Behat/Element/BrowserElementInterface.php",
                "status": "added",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FElement%2FBrowserElementInterface.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FElement%2FBrowserElementInterface.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FElement%2FBrowserElementInterface.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,19 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Behat\\Element;\n+\n+interface BrowserElementInterface\n+{\n+    public function goBack(): void;\n+}"
            },
            {
                "sha": "b98059d3fb33a2a384ec2d472789f8744848e37a",
                "filename": "src/Sylius/Behat/Resources/config/services/contexts/ui.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fservices%2Fcontexts%2Fui.xml",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fservices%2Fcontexts%2Fui.xml",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fservices%2Fcontexts%2Fui.xml?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -299,6 +299,10 @@\n             <tag name=\"fob.context_service\" />\n         </service>\n \n+        <service id=\"sylius.behat.context.ui.browser\" class=\"Sylius\\Behat\\Context\\Ui\\BrowserContext\">\n+            <argument type=\"service\" id=\"sylius.behat.element.browser\" />\n+        </service>\n+\n         <service id=\"sylius.behat.context.ui.channel\" class=\"Sylius\\Behat\\Context\\Ui\\ChannelContext\">\n             <argument type=\"service\" id=\"sylius.behat.shared_storage\" />\n             <argument type=\"service\" id=\"sylius.behat.channel_context_setter\" />"
            },
            {
                "sha": "36d55417c4e27f1c76ac223aebc3d169cf6cad09",
                "filename": "src/Sylius/Behat/Resources/config/services/elements.xml",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fservices%2Felements.xml",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fservices%2Felements.xml",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fservices%2Felements.xml?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -20,10 +20,13 @@\n         <import resource=\"elements/shop.xml\" />\n         <import resource=\"elements/product.xml\" />\n     </imports>\n+\n     <services>\n         <service id=\"sylius.behat.element\" class=\"FriendsOfBehat\\PageObjectExtension\\Element\\Element\" abstract=\"true\" public=\"false\">\n             <argument type=\"service\" id=\"behat.mink.default_session\" />\n             <argument type=\"service\" id=\"behat.mink.parameters\" />\n         </service>\n+\n+        <service id=\"sylius.behat.element.browser\" class=\"Sylius\\Behat\\Element\\BrowserElement\" parent=\"sylius.behat.element\" public=\"false\" />\n     </services>\n </container>"
            },
            {
                "sha": "12b5861363ca415ae8e80b6a0cf90a71aaaa494d",
                "filename": "src/Sylius/Behat/Resources/config/suites/ui/account/customer.yml",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fsuites%2Fui%2Faccount%2Fcustomer.yml",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fsuites%2Fui%2Faccount%2Fcustomer.yml",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fsuites%2Fui%2Faccount%2Fcustomer.yml?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -33,6 +33,7 @@ default:\n                 - sylius.behat.context.setup.user\n                 - sylius.behat.context.setup.zone\n \n+                - sylius.behat.context.ui.browser\n                 - sylius.behat.context.ui.channel\n                 - sylius.behat.context.ui.email\n                 - sylius.behat.context.ui.shop.account\n@@ -44,6 +45,7 @@ default:\n                 - sylius.behat.context.ui.shop.checkout.shipping\n                 - sylius.behat.context.ui.shop.currency\n                 - sylius.behat.context.ui.shop.homepage\n+                - sylius.behat.context.ui.user\n \n             filters:\n                 tags: \"@customer_account&&@ui\""
            },
            {
                "sha": "0a3844c97fc30eb9ff6e833d61355b6e4bb4b60a",
                "filename": "src/Sylius/Behat/Resources/config/suites/ui/admin/dashboard.yml",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fsuites%2Fui%2Fadmin%2Fdashboard.yml",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fsuites%2Fui%2Fadmin%2Fdashboard.yml",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBehat%2FResources%2Fconfig%2Fsuites%2Fui%2Fadmin%2Fdashboard.yml?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -26,7 +26,9 @@ default:\n                 - sylius.behat.context.transform.shared_storage\n \n                 - sylius.behat.context.ui.admin.dashboard\n+                - sylius.behat.context.ui.admin.login\n                 - sylius.behat.context.ui.admin.notification\n+                - sylius.behat.context.ui.browser\n \n             filters:\n                 tags: \"@admin_dashboard&&@ui\""
            },
            {
                "sha": "c85a01fbff1a3074f33e22ff192084140c71664b",
                "filename": "src/Sylius/Bundle/AdminBundle/EventListener/AdminSectionCacheControlSubscriber.php",
                "status": "added",
                "additions": 52,
                "deletions": 0,
                "changes": 52,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FAdminBundle%2FEventListener%2FAdminSectionCacheControlSubscriber.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FAdminBundle%2FEventListener%2FAdminSectionCacheControlSubscriber.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FAdminBundle%2FEventListener%2FAdminSectionCacheControlSubscriber.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,52 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Bundle\\AdminBundle\\EventListener;\n+\n+use Sylius\\Bundle\\AdminBundle\\SectionResolver\\AdminSection;\n+use Sylius\\Bundle\\CoreBundle\\SectionResolver\\SectionProviderInterface;\n+use Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n+use Symfony\\Component\\HttpKernel\\Event\\ResponseEvent;\n+use Symfony\\Component\\HttpKernel\\KernelEvents;\n+\n+final class AdminSectionCacheControlSubscriber implements EventSubscriberInterface\n+{\n+    /** @var SectionProviderInterface */\n+    private $sectionProvider;\n+\n+    public function __construct(SectionProviderInterface $sectionProvider)\n+    {\n+        $this->sectionProvider = $sectionProvider;\n+    }\n+\n+    public static function getSubscribedEvents(): array\n+    {\n+        return [\n+            KernelEvents::RESPONSE => 'setCacheControlDirectives',\n+        ];\n+    }\n+\n+    public function setCacheControlDirectives(ResponseEvent $event): void\n+    {\n+        if (!$this->sectionProvider->getSection() instanceof AdminSection) {\n+            return;\n+        }\n+\n+        $response = $event->getResponse();\n+\n+        $response->headers->addCacheControlDirective('no-cache', true);\n+        $response->headers->addCacheControlDirective('max-age', '0');\n+        $response->headers->addCacheControlDirective('must-revalidate', true);\n+        $response->headers->addCacheControlDirective('no-store', true);\n+    }\n+}"
            },
            {
                "sha": "3ae6fdbe3c49d49112ec0cf86bdc8d95ca353449",
                "filename": "src/Sylius/Bundle/AdminBundle/Resources/config/services/listener.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FAdminBundle%2FResources%2Fconfig%2Fservices%2Flistener.xml",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FAdminBundle%2FResources%2Fconfig%2Fservices%2Flistener.xml",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FAdminBundle%2FResources%2Fconfig%2Fservices%2Flistener.xml?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -25,5 +25,10 @@\n             <argument type=\"service\" id=\"session\" />\n             <tag name=\"kernel.event_subscriber\" event=\"kernel.exception\" />\n         </service>\n+\n+        <service id=\"sylius.event_subscriber.admin_cache_control_subscriber\" class=\"Sylius\\Bundle\\AdminBundle\\EventListener\\AdminSectionCacheControlSubscriber\">\n+            <argument type=\"service\" id=\"sylius.section_resolver.uri_based_section_resolver\" />\n+            <tag name=\"kernel.event_subscriber\" event=\"kernel.response\" />\n+        </service>\n     </services>\n </container>"
            },
            {
                "sha": "f67decf3f5ddc37af15408d024191b1d5ed73286",
                "filename": "src/Sylius/Bundle/AdminBundle/spec/EventListener/AdminSectionCacheControlSubscriberSpec.php",
                "status": "added",
                "additions": 93,
                "deletions": 0,
                "changes": 93,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FAdminBundle%2Fspec%2FEventListener%2FAdminSectionCacheControlSubscriberSpec.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FAdminBundle%2Fspec%2FEventListener%2FAdminSectionCacheControlSubscriberSpec.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FAdminBundle%2Fspec%2FEventListener%2FAdminSectionCacheControlSubscriberSpec.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,93 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace spec\\Sylius\\Bundle\\AdminBundle\\EventListener;\n+\n+use PhpSpec\\ObjectBehavior;\n+use Sylius\\Bundle\\AdminBundle\\SectionResolver\\AdminSection;\n+use Sylius\\Bundle\\CoreBundle\\SectionResolver\\SectionInterface;\n+use Sylius\\Bundle\\CoreBundle\\SectionResolver\\SectionProviderInterface;\n+use Symfony\\Component\\HttpFoundation\\Request;\n+use Symfony\\Component\\HttpFoundation\\Response;\n+use Symfony\\Component\\HttpFoundation\\ResponseHeaderBag;\n+use Symfony\\Component\\HttpKernel\\Event\\ResponseEvent;\n+use Symfony\\Component\\HttpKernel\\HttpKernelInterface;\n+use Symfony\\Component\\HttpKernel\\KernelEvents;\n+use Symfony\\Component\\HttpKernel\\KernelInterface;\n+\n+final class AdminSectionCacheControlSubscriberSpec extends ObjectBehavior\n+{\n+    function let(SectionProviderInterface $sectionProvider): void\n+    {\n+        $this->beConstructedWith($sectionProvider);\n+    }\n+\n+    function it_subscribes_to_kernel_response_event(): void\n+    {\n+        $this::getSubscribedEvents()->shouldReturn([KernelEvents::RESPONSE => 'setCacheControlDirectives']);\n+    }\n+\n+    function it_adds_cache_control_directives_to_admin_requests(\n+        SectionProviderInterface $sectionProvider,\n+        HttpKernelInterface $kernel,\n+        Request $request,\n+        Response $response,\n+        ResponseHeaderBag $responseHeaderBag,\n+        AdminSection $adminSection\n+    ): void {\n+        $sectionProvider->getSection()->willReturn($adminSection);\n+\n+        $response->headers = $responseHeaderBag->getWrappedObject();\n+\n+        $event = new ResponseEvent(\n+            $kernel->getWrappedObject(),\n+            $request->getWrappedObject(),\n+            KernelInterface::MASTER_REQUEST,\n+            $response->getWrappedObject()\n+        );\n+\n+        $responseHeaderBag->addCacheControlDirective('no-cache', true)->shouldBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('max-age', '0')->shouldBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('must-revalidate', true)->shouldBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('no-store', true)->shouldBeCalled();\n+\n+        $this->setCacheControlDirectives($event);\n+    }\n+\n+    function it_does_nothing_if_section_is_different_than_admin(\n+        SectionProviderInterface $sectionProvider,\n+        HttpKernelInterface $kernel,\n+        Request $request,\n+        Response $response,\n+        ResponseHeaderBag $responseHeaderBag,\n+        SectionInterface $section\n+    ): void {\n+        $sectionProvider->getSection()->willReturn($section);\n+\n+        $response->headers = $responseHeaderBag->getWrappedObject();\n+\n+        $event = new ResponseEvent(\n+            $kernel->getWrappedObject(),\n+            $request->getWrappedObject(),\n+            KernelInterface::MASTER_REQUEST,\n+            $response->getWrappedObject()\n+        );\n+\n+        $responseHeaderBag->addCacheControlDirective('no-cache', true)->shouldNotBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('max-age', '0')->shouldNotBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('must-revalidate', true)->shouldNotBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('no-store', true)->shouldNotBeCalled();\n+\n+        $this->setCacheControlDirectives($event);\n+    }\n+}"
            },
            {
                "sha": "fa47c64d68ab248892be2d303c657d4edce522e9",
                "filename": "src/Sylius/Bundle/ApiBundle/composer.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FApiBundle%2Fcomposer.json",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FApiBundle%2Fcomposer.json",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FApiBundle%2Fcomposer.json?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -26,6 +26,7 @@\n         \"php\": \"^7.3\",\n         \"api-platform/core\": \"^2.5\",\n         \"doctrine/dbal\": \"^2.7\",\n+        \"enshrined/svg-sanitize\": \"^0.15.4\",\n         \"lexik/jwt-authentication-bundle\": \"^2.6\",\n         \"sylius/core-bundle\": \"^1.7\",\n         \"symfony/messenger\": \"^4.4 || ^5.2\""
            },
            {
                "sha": "8e4727682eaadd6f64cbc5d8857db8fa39d71882",
                "filename": "src/Sylius/Bundle/CoreBundle/EventListener/XFrameOptionsSubscriber.php",
                "status": "added",
                "additions": 48,
                "deletions": 0,
                "changes": 48,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FCoreBundle%2FEventListener%2FXFrameOptionsSubscriber.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FCoreBundle%2FEventListener%2FXFrameOptionsSubscriber.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FCoreBundle%2FEventListener%2FXFrameOptionsSubscriber.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,48 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Bundle\\CoreBundle\\EventListener;\n+\n+use Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n+use Symfony\\Component\\HttpKernel\\Event\\ResponseEvent;\n+use Symfony\\Component\\HttpKernel\\KernelEvents;\n+\n+final class XFrameOptionsSubscriber implements EventSubscriberInterface\n+{\n+    public static function getSubscribedEvents(): array\n+    {\n+        return [\n+            KernelEvents::RESPONSE => 'onKernelResponse',\n+        ];\n+    }\n+\n+    public function onKernelResponse(ResponseEvent $event): void\n+    {\n+        if (!$this->isMainRequest($event)) {\n+            return;\n+        }\n+\n+        $response = $event->getResponse();\n+\n+        $response->headers->set('X-Frame-Options', 'sameorigin');\n+    }\n+\n+    private function isMainRequest(ResponseEvent $event): bool\n+    {\n+        if (\\method_exists($event, 'isMainRequest')) {\n+            return $event->isMainRequest();\n+        }\n+\n+        return $event->isMasterRequest();\n+    }\n+}"
            },
            {
                "sha": "9f02b50e081a040e9da3e81ec1000d6e4e2c1d8b",
                "filename": "src/Sylius/Bundle/CoreBundle/Resources/config/services/listeners.xml",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FCoreBundle%2FResources%2Fconfig%2Fservices%2Flisteners.xml",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FCoreBundle%2FResources%2Fconfig%2Fservices%2Flisteners.xml",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FCoreBundle%2FResources%2Fconfig%2Fservices%2Flisteners.xml?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -95,6 +95,10 @@\n             <argument type=\"service\" id=\"Sylius\\Bundle\\CoreBundle\\EventListener\\LocaleAwareListener.inner\" />\n         </service>\n \n+        <service id=\"Sylius\\Bundle\\CoreBundle\\EventListener\\XFrameOptionsSubscriber\">\n+            <tag name=\"kernel.event_subscriber\" />\n+        </service>\n+\n         <service id=\"sylius.listener.taxon_deletion\" class=\"Sylius\\Bundle\\CoreBundle\\EventListener\\TaxonDeletionListener\">\n             <argument type=\"service\" id=\"session\" />\n             <argument type=\"service\" id=\"sylius.repository.channel\" />"
            },
            {
                "sha": "803d481c9fa9722d2e209675f47c3f2bd02ccbe6",
                "filename": "src/Sylius/Bundle/ShopBundle/EventListener/ShopCustomerAccountSubSectionCacheControlSubscriber.php",
                "status": "added",
                "additions": 52,
                "deletions": 0,
                "changes": 52,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FEventListener%2FShopCustomerAccountSubSectionCacheControlSubscriber.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FEventListener%2FShopCustomerAccountSubSectionCacheControlSubscriber.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FShopBundle%2FEventListener%2FShopCustomerAccountSubSectionCacheControlSubscriber.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,52 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Bundle\\ShopBundle\\EventListener;\n+\n+use Sylius\\Bundle\\CoreBundle\\SectionResolver\\SectionProviderInterface;\n+use Sylius\\Bundle\\ShopBundle\\SectionResolver\\ShopCustomerAccountSubSection;\n+use Symfony\\Component\\EventDispatcher\\EventSubscriberInterface;\n+use Symfony\\Component\\HttpKernel\\Event\\ResponseEvent;\n+use Symfony\\Component\\HttpKernel\\KernelEvents;\n+\n+final class ShopCustomerAccountSubSectionCacheControlSubscriber implements EventSubscriberInterface\n+{\n+    /** @var SectionProviderInterface */\n+    private $sectionProvider;\n+\n+    public function __construct(SectionProviderInterface $sectionProvider)\n+    {\n+        $this->sectionProvider = $sectionProvider;\n+    }\n+\n+    public static function getSubscribedEvents(): array\n+    {\n+        return [\n+            KernelEvents::RESPONSE => 'setCacheControlDirectives',\n+        ];\n+    }\n+\n+    public function setCacheControlDirectives(ResponseEvent $event): void\n+    {\n+        if (!$this->sectionProvider->getSection() instanceof ShopCustomerAccountSubSection) {\n+            return;\n+        }\n+\n+        $response = $event->getResponse();\n+\n+        $response->headers->addCacheControlDirective('no-cache', true);\n+        $response->headers->addCacheControlDirective('max-age', '0');\n+        $response->headers->addCacheControlDirective('must-revalidate', true);\n+        $response->headers->addCacheControlDirective('no-store', true);\n+    }\n+}"
            },
            {
                "sha": "476ea0be3eab8474c0153e3f2637256723f8c31e",
                "filename": "src/Sylius/Bundle/ShopBundle/Resources/config/services.xml",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FResources%2Fconfig%2Fservices.xml",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FResources%2Fconfig%2Fservices.xml",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FShopBundle%2FResources%2Fconfig%2Fservices.xml?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -30,6 +30,7 @@\n         </service>\n \n         <service id=\"sylius.section_resolver.shop_uri_based_section_resolver\" class=\"Sylius\\Bundle\\ShopBundle\\SectionResolver\\ShopUriBasedSectionResolver\">\n+            <argument>account</argument>\n             <tag name=\"sylius.uri_based_section_resolver\" priority=\"-10\" />\n         </service>\n "
            },
            {
                "sha": "f4467d7c00be95b98eb7871c56597e3cc168ad2a",
                "filename": "src/Sylius/Bundle/ShopBundle/Resources/config/services/listeners.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FResources%2Fconfig%2Fservices%2Flisteners.xml",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FResources%2Fconfig%2Fservices%2Flisteners.xml",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FShopBundle%2FResources%2Fconfig%2Fservices%2Flisteners.xml?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -25,6 +25,11 @@\n             <tag name=\"kernel.event_listener\" event=\"sylius.customer.post_update\" method=\"sendVerificationEmail\" />\n         </service>\n \n+        <service id=\"sylius.listener.shop_customer_account_sub_section_cache_control_subscriber\" class=\"Sylius\\Bundle\\ShopBundle\\EventListener\\ShopCustomerAccountSubSectionCacheControlSubscriber\">\n+            <argument type=\"service\" id=\"sylius.section_resolver.uri_based_section_resolver\" />\n+            <tag name=\"kernel.event_subscriber\" event=\"kernel.response\" />\n+        </service>\n+\n         <service id=\"sylius.listener.order_customer_ip\" class=\"Sylius\\Bundle\\ShopBundle\\EventListener\\OrderCustomerIpListener\">\n             <argument type=\"service\" id=\"sylius.customer_ip_assigner\" />\n             <argument type=\"service\" id=\"request_stack\" />"
            },
            {
                "sha": "c99afa65ec5a3fbb3299870c1ca1fb9a3cc9c48d",
                "filename": "src/Sylius/Bundle/ShopBundle/SectionResolver/ShopCustomerAccountSubSection.php",
                "status": "added",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FSectionResolver%2FShopCustomerAccountSubSection.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FSectionResolver%2FShopCustomerAccountSubSection.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FShopBundle%2FSectionResolver%2FShopCustomerAccountSubSection.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,18 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Bundle\\ShopBundle\\SectionResolver;\n+\n+class ShopCustomerAccountSubSection extends ShopSection\n+{\n+}"
            },
            {
                "sha": "ddba21afbdc311fc23dfd045bde9182732a2af8a",
                "filename": "src/Sylius/Bundle/ShopBundle/SectionResolver/ShopUriBasedSectionResolver.php",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FSectionResolver%2FShopUriBasedSectionResolver.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2FSectionResolver%2FShopUriBasedSectionResolver.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FShopBundle%2FSectionResolver%2FShopUriBasedSectionResolver.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -18,8 +18,20 @@\n \n final class ShopUriBasedSectionResolver implements UriBasedSectionResolverInterface\n {\n+    /** @var string */\n+    private $shopCustomerAccountUri;\n+\n+    public function __construct(string $shopCustomerAccountUri = 'account')\n+    {\n+        $this->shopCustomerAccountUri = $shopCustomerAccountUri;\n+    }\n+\n     public function getSection(string $uri): SectionInterface\n     {\n+        if (strpos($uri, $this->shopCustomerAccountUri) !== false) {\n+            return new ShopCustomerAccountSubSection();\n+        }\n+\n         return new ShopSection();\n     }\n }"
            },
            {
                "sha": "61fc6e72b81d2a30c0dc47b7d79083dcfb780550",
                "filename": "src/Sylius/Bundle/ShopBundle/spec/EventListener/ShopCustomerAccountSubSectionCacheControlSubscriberSpec.php",
                "status": "added",
                "additions": 93,
                "deletions": 0,
                "changes": 93,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2Fspec%2FEventListener%2FShopCustomerAccountSubSectionCacheControlSubscriberSpec.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2Fspec%2FEventListener%2FShopCustomerAccountSubSectionCacheControlSubscriberSpec.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FShopBundle%2Fspec%2FEventListener%2FShopCustomerAccountSubSectionCacheControlSubscriberSpec.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,93 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace spec\\Sylius\\Bundle\\ShopBundle\\EventListener;\n+\n+use PhpSpec\\ObjectBehavior;\n+use Sylius\\Bundle\\CoreBundle\\SectionResolver\\SectionInterface;\n+use Sylius\\Bundle\\CoreBundle\\SectionResolver\\SectionProviderInterface;\n+use Sylius\\Bundle\\ShopBundle\\SectionResolver\\ShopCustomerAccountSubSection;\n+use Symfony\\Component\\HttpFoundation\\Request;\n+use Symfony\\Component\\HttpFoundation\\Response;\n+use Symfony\\Component\\HttpFoundation\\ResponseHeaderBag;\n+use Symfony\\Component\\HttpKernel\\Event\\ResponseEvent;\n+use Symfony\\Component\\HttpKernel\\HttpKernelInterface;\n+use Symfony\\Component\\HttpKernel\\KernelEvents;\n+use Symfony\\Component\\HttpKernel\\KernelInterface;\n+\n+final class ShopCustomerAccountSubSectionCacheControlSubscriberSpec extends ObjectBehavior\n+{\n+    function let(SectionProviderInterface $sectionProvider): void\n+    {\n+        $this->beConstructedWith($sectionProvider);\n+    }\n+\n+    function it_subscribes_to_kernel_response_event()\n+    {\n+        $this::getSubscribedEvents()->shouldReturn([KernelEvents::RESPONSE => 'setCacheControlDirectives']);\n+    }\n+\n+    function it_adds_cache_control_directives_to_customer_account_requests(\n+        SectionProviderInterface $sectionProvider,\n+        HttpKernelInterface $kernel,\n+        Request $request,\n+        Response $response,\n+        ResponseHeaderBag $responseHeaderBag,\n+        ShopCustomerAccountSubSection $customerAccountSubSection\n+    ): void {\n+        $sectionProvider->getSection()->willReturn($customerAccountSubSection);\n+\n+        $response->headers = $responseHeaderBag->getWrappedObject();\n+\n+        $event = new ResponseEvent(\n+            $kernel->getWrappedObject(),\n+            $request->getWrappedObject(),\n+            KernelInterface::MASTER_REQUEST,\n+            $response->getWrappedObject()\n+        );\n+\n+        $responseHeaderBag->addCacheControlDirective('no-cache', true)->shouldBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('max-age', '0')->shouldBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('must-revalidate', true)->shouldBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('no-store', true)->shouldBeCalled();\n+\n+        $this->setCacheControlDirectives($event);\n+    }\n+\n+    function it_does_nothing_if_section_is_different_than_customer_account(\n+        SectionProviderInterface $sectionProvider,\n+        HttpKernelInterface $kernel,\n+        Request $request,\n+        Response $response,\n+        ResponseHeaderBag $responseHeaderBag,\n+        SectionInterface $section\n+    ): void {\n+        $sectionProvider->getSection()->willReturn($section);\n+\n+        $response->headers = $responseHeaderBag->getWrappedObject();\n+\n+        $event = new ResponseEvent(\n+            $kernel->getWrappedObject(),\n+            $request->getWrappedObject(),\n+            KernelInterface::MASTER_REQUEST,\n+            $response->getWrappedObject()\n+        );\n+\n+        $responseHeaderBag->addCacheControlDirective('no-cache', true)->shouldNotBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('max-age', '0')->shouldNotBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('must-revalidate', true)->shouldNotBeCalled();\n+        $responseHeaderBag->addCacheControlDirective('no-store', true)->shouldNotBeCalled();\n+\n+        $this->setCacheControlDirectives($event);\n+    }\n+}"
            },
            {
                "sha": "1d687b94d71e8214db720c546548b21368063897",
                "filename": "src/Sylius/Bundle/ShopBundle/spec/SectionResolver/ShopUriBasedSectionResolverSpec.php",
                "status": "modified",
                "additions": 27,
                "deletions": 1,
                "changes": 28,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2Fspec%2FSectionResolver%2FShopUriBasedSectionResolverSpec.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FBundle%2FShopBundle%2Fspec%2FSectionResolver%2FShopUriBasedSectionResolverSpec.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FBundle%2FShopBundle%2Fspec%2FSectionResolver%2FShopUriBasedSectionResolverSpec.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -15,6 +15,7 @@\n \n use PhpSpec\\ObjectBehavior;\n use Sylius\\Bundle\\CoreBundle\\SectionResolver\\UriBasedSectionResolverInterface;\n+use Sylius\\Bundle\\ShopBundle\\SectionResolver\\ShopCustomerAccountSubSection;\n use Sylius\\Bundle\\ShopBundle\\SectionResolver\\ShopSection;\n \n final class ShopUriBasedSectionResolverSpec extends ObjectBehavior\n@@ -24,7 +25,7 @@ function it_it_uri_based_section_resolver(): void\n         $this->shouldImplement(UriBasedSectionResolverInterface::class);\n     }\n \n-    function it_always_returns_shop(): void\n+    function it_returns_shop_by_default(): void\n     {\n         $this->getSection('/api/something')->shouldBeLike(new ShopSection());\n         $this->getSection('/api')->shouldBeLike(new ShopSection());\n@@ -33,4 +34,29 @@ function it_always_returns_shop(): void\n         $this->getSection('/admin/asd')->shouldBeLike(new ShopSection());\n         $this->getSection('/en_US/api')->shouldBeLike(new ShopSection());\n     }\n+\n+    function it_uses_account_prefix_for_customer_account_subsection_by_default(): void\n+    {\n+        $this->getSection('/account')->shouldBeLike(new ShopCustomerAccountSubSection());\n+        $this->getSection('/api/account')->shouldBeLike(new ShopCustomerAccountSubSection());\n+        $this->getSection('/en_US/account')->shouldBeLike(new ShopCustomerAccountSubSection());\n+        $this->getSection('/account/random')->shouldBeLike(new ShopCustomerAccountSubSection());\n+    }\n+\n+    function it_may_have_account_prefix_customized(): void\n+    {\n+        $this->beConstructedWith('konto');\n+\n+        $this->getSection('/konto')->shouldBeLike(new ShopCustomerAccountSubSection());\n+        $this->getSection('/konto')->shouldBeLike(new ShopCustomerAccountSubSection());\n+        $this->getSection('/api/konto')->shouldBeLike(new ShopCustomerAccountSubSection());\n+        $this->getSection('/en_US/konto')->shouldBeLike(new ShopCustomerAccountSubSection());\n+        $this->getSection('/konto/random')->shouldBeLike(new ShopCustomerAccountSubSection());\n+\n+        $this->getSection('/account')->shouldBeLike(new ShopSection());\n+        $this->getSection('/account')->shouldBeLike(new ShopSection());\n+        $this->getSection('/api/account')->shouldBeLike(new ShopSection());\n+        $this->getSection('/en_US/account')->shouldBeLike(new ShopSection());\n+        $this->getSection('/account/random')->shouldBeLike(new ShopSection());\n+    }\n }"
            },
            {
                "sha": "21d5302ce5daf3b56ed3f0c6471beba861145a4c",
                "filename": "src/Sylius/Component/Core/Uploader/ImageUploader.php",
                "status": "modified",
                "additions": 21,
                "deletions": 5,
                "changes": 26,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FComponent%2FCore%2FUploader%2FImageUploader.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FComponent%2FCore%2FUploader%2FImageUploader.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FComponent%2FCore%2FUploader%2FImageUploader.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -13,6 +13,7 @@\n \n namespace Sylius\\Component\\Core\\Uploader;\n \n+use enshrined\\svgSanitize\\Sanitizer;\n use Gaufrette\\Filesystem;\n use Sylius\\Component\\Core\\Generator\\ImagePathGeneratorInterface;\n use Sylius\\Component\\Core\\Generator\\UploadedImagePathGenerator;\n@@ -22,12 +23,18 @@\n \n class ImageUploader implements ImageUploaderInterface\n {\n+    private const MIME_SVG_XML = 'image/svg+xml';\n+    private const MIME_SVG = 'image/svg';\n+\n     /** @var Filesystem */\n     protected $filesystem;\n \n     /** @var ImagePathGeneratorInterface */\n     protected $imagePathGenerator;\n \n+    /** @var Sanitizer */\n+    protected $sanitizer;\n+\n     public function __construct(\n         Filesystem $filesystem,\n         ?ImagePathGeneratorInterface $imagePathGenerator = null\n@@ -41,6 +48,7 @@ public function __construct(\n         }\n \n         $this->imagePathGenerator = $imagePathGenerator ?? new UploadedImagePathGenerator();\n+        $this->sanitizer = new Sanitizer();\n     }\n \n     public function upload(ImageInterface $image): void\n@@ -49,11 +57,13 @@ public function upload(ImageInterface $image): void\n             return;\n         }\n \n+        /** @var File $file */\n         $file = $image->getFile();\n \n-        /** @var File $file */\n         Assert::isInstanceOf($file, File::class);\n \n+        $fileContent = $this->sanitizeContent(file_get_contents($file->getPathname()), $file->getMimeType());\n+\n         if (null !== $image->getPath() && $this->has($image->getPath())) {\n             $this->remove($image->getPath());\n         }\n@@ -64,10 +74,7 @@ public function upload(ImageInterface $image): void\n \n         $image->setPath($path);\n \n-        $this->filesystem->write(\n-            $image->getPath(),\n-            file_get_contents($image->getFile()->getPathname())\n-        );\n+        $this->filesystem->write($image->getPath(), $fileContent);\n     }\n \n     public function remove(string $path): bool\n@@ -79,6 +86,15 @@ public function remove(string $path): bool\n         return false;\n     }\n \n+    protected function sanitizeContent(string $fileContent, string $mimeType): string\n+    {\n+        if (self::MIME_SVG_XML === $mimeType || self::MIME_SVG === $mimeType) {\n+            $fileContent = $this->sanitizer->sanitize($fileContent);\n+        }\n+\n+        return $fileContent;\n+    }\n+\n     private function has(string $path): bool\n     {\n         return $this->filesystem->has($path);"
            },
            {
                "sha": "ac5a6bab7e374d10133d5882f79e232ba339cbdd",
                "filename": "src/Sylius/Component/Core/composer.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FComponent%2FCore%2Fcomposer.json",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/src%2FSylius%2FComponent%2FCore%2Fcomposer.json",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/src%2FSylius%2FComponent%2FCore%2Fcomposer.json?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -27,6 +27,7 @@\n     ],\n     \"require\": {\n         \"php\": \"^7.3\",\n+        \"enshrined/svg-sanitize\": \"^0.15.4\",\n         \"knplabs/gaufrette\": \"^0.8\",\n         \"payum/payum\": \"^1.6\",\n         \"php-http/guzzle6-adapter\": \"^2.0\","
            },
            {
                "sha": "9c829d7ae67ac6fe1adfc73f25f536b600a7ee31",
                "filename": "symfony.lock",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/symfony.lock",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/symfony.lock",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/symfony.lock?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -155,6 +155,9 @@\n     \"egulias/email-validator\": {\n         \"version\": \"2.1.19\"\n     },\n+    \"enshrined/svg-sanitize\": {\n+        \"version\": \"0.15.4\"\n+    },\n     \"fakerphp/faker\": {\n         \"version\": \"v1.12.0\"\n     },"
            },
            {
                "sha": "1011230418bbdefc376bb03e8de5068784a6e034",
                "filename": "tests/Controller/XFrameOptionsTest.php",
                "status": "added",
                "additions": 29,
                "deletions": 0,
                "changes": 29,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FController%2FXFrameOptionsTest.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FController%2FXFrameOptionsTest.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/tests%2FController%2FXFrameOptionsTest.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,29 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Tests\\Controller;\n+\n+use ApiTestCase\\JsonApiTestCase;\n+\n+final class XFrameOptionsTest extends JsonApiTestCase\n+{\n+    /** @test */\n+    public function it_sets_frame_options_header(): void\n+    {\n+        $this->client->request('GET', '/');\n+\n+        $response = $this->client->getResponse();\n+\n+        $this->assertSame('sameorigin', $response->headers->get('X-Frame-Options'));\n+    }\n+}"
            },
            {
                "sha": "ae9bd10c9447a7c8d3587521e8ac80c8e84ab6d9",
                "filename": "tests/EventListener/AdminSectionCacheControlSubscriberTest.php",
                "status": "added",
                "additions": 31,
                "deletions": 0,
                "changes": 31,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FEventListener%2FAdminSectionCacheControlSubscriberTest.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FEventListener%2FAdminSectionCacheControlSubscriberTest.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/tests%2FEventListener%2FAdminSectionCacheControlSubscriberTest.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,31 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Tests\\EventListener;\n+\n+use Symfony\\Bundle\\FrameworkBundle\\Test\\WebTestCase;\n+\n+final class AdminSectionCacheControlSubscriberTest extends WebTestCase\n+{\n+    /**\n+     * @test\n+     */\n+    public function it_returns_proper_cache_headers_for_admin_endpoints(): void\n+    {\n+        $client = static::createClient();\n+\n+        $client->request('GET', '/admin/');\n+\n+        $this->assertResponseHeaderSame('Cache-Control', 'max-age=0, must-revalidate, no-cache, no-store, private');\n+    }\n+}"
            },
            {
                "sha": "c3ad2f1da82b31f0e3453612fa504c20f3109f49",
                "filename": "tests/EventListener/ShopCustomerAccountSubSectionCacheControlSubscriberTest.php",
                "status": "added",
                "additions": 31,
                "deletions": 0,
                "changes": 31,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FEventListener%2FShopCustomerAccountSubSectionCacheControlSubscriberTest.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FEventListener%2FShopCustomerAccountSubSectionCacheControlSubscriberTest.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/tests%2FEventListener%2FShopCustomerAccountSubSectionCacheControlSubscriberTest.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,31 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Tests\\EventListener;\n+\n+use Symfony\\Bundle\\FrameworkBundle\\Test\\WebTestCase;\n+\n+final class ShopCustomerAccountSubSectionCacheControlSubscriberTest extends WebTestCase\n+{\n+    /**\n+     * @test\n+     */\n+    public function it_returns_proper_cache_headers_for_customer_account_endpoints(): void\n+    {\n+        $client = static::createClient();\n+\n+        $client->request('GET', '/en_US/account/');\n+\n+        $this->assertResponseHeaderSame('Cache-Control', 'max-age=0, must-revalidate, no-cache, no-store, private');\n+    }\n+}"
            },
            {
                "sha": "3bc4cecef14082f74c1e259d0c99127b8f6763c0",
                "filename": "tests/Functional/ImageUploaderTest.php",
                "status": "added",
                "additions": 59,
                "deletions": 0,
                "changes": 59,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FFunctional%2FImageUploaderTest.php",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FFunctional%2FImageUploaderTest.php",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/tests%2FFunctional%2FImageUploaderTest.php?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,59 @@\n+<?php\n+\n+/*\n+ * This file is part of the Sylius package.\n+ *\n+ * (c) Pawe\u0142 J\u0119drzejewski\n+ *\n+ * For the full copyright and license information, please view the LICENSE\n+ * file that was distributed with this source code.\n+ */\n+\n+declare(strict_types=1);\n+\n+namespace Sylius\\Tests\\Functional;\n+\n+use PHPUnit\\Framework\\Assert;\n+use Sylius\\Component\\Core\\Model\\ProductImage;\n+use Symfony\\Bundle\\FrameworkBundle\\Test\\WebTestCase;\n+use Symfony\\Component\\HttpFoundation\\File\\Exception\\FileException;\n+use Symfony\\Component\\HttpFoundation\\File\\UploadedFile;\n+use Symfony\\Component\\BrowserKit\\Client;\n+\n+final class ImageUploaderTest extends WebTestCase\n+{\n+    /** @var Client */\n+    private static $client;\n+\n+    /** @test */\n+    public function it_sanitizes_file_content_if_it_is_svg_mime_type(): void\n+    {\n+        self::$client = static::createClient();\n+        self::$container = self::$client->getContainer();\n+\n+        $imageUploader = self::$container->get('sylius.image_uploader');\n+        $fileSystem =  self::$container->get('gaufrette.sylius_image_filesystem');\n+\n+        $file = new UploadedFile(__DIR__ . '/../Resources/xss.svg', 'xss.svg');\n+        Assert::assertStringContainsString('<script', $this->getContent($file));\n+\n+        $image = new ProductImage();\n+        $image->setFile($file);\n+\n+        $imageUploader->upload($image);\n+\n+        $sanitizedFile = $fileSystem->get($image->getPath());\n+        Assert::assertStringNotContainsString('<script', $sanitizedFile->getContent());\n+    }\n+\n+    private function getContent(UploadedFile $file): string\n+    {\n+        $content = file_get_contents($file->getPathname());\n+\n+        if (false === $content) {\n+            throw new FileException(sprintf('Could not get the content of the file \"%s\".', $file->getPathname()));\n+        }\n+\n+        return $content;\n+    }\n+}"
            },
            {
                "sha": "08ecd246d46777ab47533783dbbc4a5b8382d288",
                "filename": "tests/Resources/xss.svg",
                "status": "added",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/Sylius/Sylius/blob/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FResources%2Fxss.svg",
                "raw_url": "https://github.com/Sylius/Sylius/raw/3da169e0c23e752974d74223cc536c29a2a82edc/tests%2FResources%2Fxss.svg",
                "contents_url": "https://api.github.com/repos/Sylius/Sylius/contents/tests%2FResources%2Fxss.svg?ref=3da169e0c23e752974d74223cc536c29a2a82edc",
                "patch": "@@ -0,0 +1,9 @@\n+<?xml version=\"1.0\" standalone=\"no\"?>\n+<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n+\n+<svg version=\"1.1\" baseProfile=\"full\" xmlns=\"http://www.w3.org/2000/svg\">\n+    <rect width=\"100\" height=\"100\" style=\"fill:rgb(210,0,37);\" />\n+    <script type=\"text/javascript\">\n+        alert(\"XSS attack\");\n+    </script>\n+</svg>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dompdf/dompdf/commits/99aeec1efec9213e87098d42eb09439e7ee0bb6a",
        "url": "https://api.github.com/repos/dompdf/dompdf/commits/99aeec1efec9213e87098d42eb09439e7ee0bb6a",
        "html_url": "https://github.com/dompdf/dompdf/commit/99aeec1efec9213e87098d42eb09439e7ee0bb6a",
        "message": "Update resource URI validation and handling\n\nURI scheme (protocol) validation rules are now specified through the Options class. By default file and http(s) URIs are allowed and validation rules defined. Validation rules for PHAR URIs are defined but the scheme is not enabled by default.\n\nResource retrieval has been updated to use file_get_contents for schemes other than http(s).\n\nfixes #621\nfixes #2826\n\nin lieu of #1903",
        "files": [
            {
                "sha": "2720388d43dd5dc03ce274ee4d8225d888007b74",
                "filename": "src/Css/Stylesheet.php",
                "status": "modified",
                "additions": 23,
                "deletions": 46,
                "changes": 69,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FCss%2FStylesheet.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FCss%2FStylesheet.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/src%2FCss%2FStylesheet.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -325,46 +325,26 @@ function load_css_file($file, $origin = self::ORIG_AUTHOR)\n             $parsed = Helpers::parse_data_uri($file);\n             $css = $parsed[\"data\"];\n         } else {\n-            $parsed_url = Helpers::explode_url($file);\n-\n-            [$this->_protocol, $this->_base_host, $this->_base_path, $filename] = $parsed_url;\n+            $options = $this->_dompdf->getOptions();\n \n-            $file = Helpers::build_url($this->_protocol, $this->_base_host, $this->_base_path, $filename);\n+            $parsed_url = Helpers::explode_url($file);\n+            $protocol = $parsed_url[\"protocol\"];\n \n-            $options = $this->_dompdf->getOptions();\n-            // Download the remote file\n-            if (!$options->isRemoteEnabled() && ($this->_protocol !== \"\" && $this->_protocol !== \"file://\")) {\n-                Helpers::record_warnings(E_USER_WARNING, \"Remote CSS resource '$file' referenced, but remote file download is disabled.\", __FILE__, __LINE__);\n-                return;\n-            }\n-            if ($this->_protocol === \"\" || $this->_protocol === \"file://\") {\n-                $realfile = realpath($file);\n-\n-                $rootDir = realpath($options->getRootDir());\n-                if (strpos($realfile, $rootDir) !== 0) {\n-                    $chroot = $options->getChroot();\n-                    $chrootValid = false;\n-                    foreach ($chroot as $chrootPath) {\n-                        $chrootPath = realpath($chrootPath);\n-                        if ($chrootPath !== false && strpos($realfile, $chrootPath) === 0) {\n-                            $chrootValid = true;\n-                            break;\n-                        }\n-                    }\n-                    if ($chrootValid !== true) {\n-                        Helpers::record_warnings(E_USER_WARNING, \"Permission denied on $file. The file could not be found under the paths specified by Options::chroot.\", __FILE__, __LINE__);\n+            if ($file !== $this->getDefaultStylesheet()) {\n+                $allowed_protocols = $options->getAllowedProtocols();\n+                if (!array_key_exists($protocol, $allowed_protocols)) {\n+                    Helpers::record_warnings(E_USER_WARNING, \"Permission denied on $file. The communication protocol is not supported.\", __FILE__, __LINE__);\n+                    return;\n+                }\n+                foreach ($allowed_protocols[$protocol][\"rules\"] as $rule) {\n+                    [$result, $message] = $rule($file);\n+                    if (!$result) {\n+                        Helpers::record_warnings(E_USER_WARNING, \"Error loading $file: $message\", __FILE__, __LINE__);\n                         return;\n                     }\n                 }\n-\n-                if (!$realfile) {\n-                    Helpers::record_warnings(E_USER_WARNING, \"File '$realfile' not found.\", __FILE__, __LINE__);\n-                    return;\n-                }\n-\n-                $file = $realfile;\n             }\n-            \n+\n             [$css, $http_response_header] = Helpers::getFileContent($file, $this->_dompdf->getHttpContext());\n \n             $good_mime_type = true;\n@@ -379,11 +359,12 @@ function load_css_file($file, $origin = self::ORIG_AUTHOR)\n                     }\n                 }\n             }\n-\n             if (!$good_mime_type || $css === null) {\n                 Helpers::record_warnings(E_USER_WARNING, \"Unable to load css file $file\", __FILE__, __LINE__);\n                 return;\n             }\n+\n+            [$this->_protocol, $this->_base_host, $this->_base_path] = $parsed_url;\n         }\n \n         $this->_parse_css($css);\n@@ -1421,20 +1402,16 @@ public function resolve_url($val): string\n             $val = preg_replace(\"/url\\(\\s*['\\\"]?([^'\\\")]+)['\\\"]?\\s*\\)/\", \"\\\\1\", trim($val));\n \n             // Resolve the url now in the context of the current stylesheet\n-            $parsed_url = Helpers::explode_url($val);\n             $path = Helpers::build_url($this->_protocol,\n                 $this->_base_host,\n                 $this->_base_path,\n                 $val);\n-            if (($parsed_url[\"protocol\"] === \"\" || $parsed_url[\"protocol\"] === \"file://\") && ($this->_protocol === \"\" || $this->_protocol === \"file://\")) {\n-                $path = realpath($path);\n-                // If realpath returns FALSE then specifically state that there is no background image\n-                if ($path === false) {\n-                    $path = \"none\";\n-                }\n+            if ($path === null) {\n+                $path = \"none\";\n             }\n         }\n         if ($DEBUGCSS) {\n+            $parsed_url = Helpers::explode_url($path);\n             print \"<pre>[_image\\n\";\n             print_r($parsed_url);\n             print $this->_protocol . \"\\n\" . $this->_base_path . \"\\n\" . $path . \"\\n\";\n@@ -1483,9 +1460,9 @@ private function _parse_import($url)\n             // Above does not work for subfolders and absolute urls.\n             // Todo: As above, do we need to replace php or file to an empty protocol for local files?\n \n-            $url = $this->resolve_url($url);\n-\n-            $this->load_css_file($url);\n+            if (($url = $this->resolve_url($url)) !== \"none\") {\n+                $this->load_css_file($url);\n+            }\n \n             // Restore the current base url\n             $this->_protocol = $protocol;\n@@ -1675,7 +1652,7 @@ public function getDefaultStylesheet()\n     {\n         $options = $this->_dompdf->getOptions();\n         $rootDir = realpath($options->getRootDir());\n-        return $rootDir . self::DEFAULT_STYLESHEET;\n+        return Helpers::build_url(\"file://\", \"\", $rootDir, $rootDir . self::DEFAULT_STYLESHEET);\n     }\n \n     /**"
            },
            {
                "sha": "7e657af2032a154daac4ea7a7e97f61509b340a9",
                "filename": "src/Dompdf.php",
                "status": "modified",
                "additions": 18,
                "deletions": 41,
                "changes": 59,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FDompdf.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FDompdf.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/src%2FDompdf.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -196,16 +196,6 @@ class Dompdf\n      */\n     private $quirksmode = false;\n \n-    /**\n-    * Protocol whitelist\n-    *\n-    * Protocols and PHP wrappers allowed in URLs. Full support is not\n-    * guaranteed for the protocols/wrappers contained in this array.\n-    *\n-    * @var array\n-    */\n-    private $allowedProtocols = [\"\", \"file://\", \"http://\", \"https://\"];\n-\n     /**\n     * Local file extension whitelist\n     *\n@@ -271,8 +261,11 @@ public function __construct($options = null)\n         }\n \n         $versionFile = realpath(__DIR__ . '/../VERSION');\n-        if (file_exists($versionFile) && ($version = trim(file_get_contents($versionFile))) !== false && $version !== '$Format:<%h>$') {\n-            $this->version = sprintf('dompdf %s', $version);\n+        if (($version = file_get_contents($versionFile)) !== false) {\n+            $version = trim($version);\n+            if ($version !== '$Format:<%h>$') {\n+                $this->version = sprintf('dompdf %s', $version);\n+            }\n         }\n \n         $this->setPhpConfig();\n@@ -352,43 +345,25 @@ public function loadHtmlFile($file, $encoding = null)\n             [$this->protocol, $this->baseHost, $this->basePath] = Helpers::explode_url($file);\n         }\n         $protocol = strtolower($this->protocol);\n-        \n         $uri = Helpers::build_url($this->protocol, $this->baseHost, $this->basePath, $file);\n \n-        if (!in_array($protocol, $this->allowedProtocols, true)) {\n+        $allowed_protocols = $this->options->getAllowedProtocols();\n+        if (!array_key_exists($protocol, $allowed_protocols)) {\n             throw new Exception(\"Permission denied on $file. The communication protocol is not supported.\");\n         }\n \n-        if (!$this->options->isRemoteEnabled() && ($protocol !== \"\" && $protocol !== \"file://\")) {\n-            throw new Exception(\"Remote file requested, but remote file download is disabled.\");\n-        }\n-\n-        if ($protocol === \"\" || $protocol === \"file://\") {\n-            $realfile = realpath($uri);\n-\n-            $chroot = $this->options->getChroot();\n-            $chrootValid = false;\n-            foreach ($chroot as $chrootPath) {\n-                $chrootPath = realpath($chrootPath);\n-                if ($chrootPath !== false && strpos($realfile, $chrootPath) === 0) {\n-                    $chrootValid = true;\n-                    break;\n-                }\n-            }\n-            if ($chrootValid !== true) {\n-                throw new Exception(\"Permission denied on $file. The file could not be found under the paths specified by Options::chroot.\");\n-            }\n-\n-            $ext = strtolower(pathinfo($realfile, PATHINFO_EXTENSION));\n+        if ($protocol === \"file://\") {\n+            $ext = strtolower(pathinfo($uri, PATHINFO_EXTENSION));\n             if (!in_array($ext, $this->allowedLocalFileExtensions)) {\n-                throw new Exception(\"Permission denied on $file. This file extension is forbidden\");\n+                throw new Exception(\"Permission denied on $file: The file extension is forbidden.\");\n             }\n+        }\n \n-            if (!$realfile) {\n-                throw new Exception(\"File '$file' not found.\");\n+        foreach ($allowed_protocols[$protocol][\"rules\"] as $rule) {\n+            [$result, $message] = $rule($uri);\n+            if (!$result) {\n+                throw new Exception(\"Error loading $file: $message\");\n             }\n-\n-            $uri = $realfile;\n         }\n \n         [$contents, $http_response_header] = Helpers::getFileContent($uri, $this->options->getHttpContext());\n@@ -604,7 +579,9 @@ private function processHtml()\n                         $url = $tag->getAttribute(\"href\");\n                         $url = Helpers::build_url($this->protocol, $this->baseHost, $this->basePath, $url);\n \n-                        $this->css->load_css_file($url, Stylesheet::ORIG_AUTHOR);\n+                        if ($url !== null) {\n+                            $this->css->load_css_file($url, Stylesheet::ORIG_AUTHOR);\n+                        }\n                     }\n                     break;\n "
            },
            {
                "sha": "83d0c99c74bf49b6ddf001ebb274f98e44509414",
                "filename": "src/FontMetrics.php",
                "status": "modified",
                "additions": 8,
                "deletions": 27,
                "changes": 35,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FFontMetrics.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FFontMetrics.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/src%2FFontMetrics.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -214,37 +214,18 @@ public function registerFont($style, $remoteFile, $context = null)\n \n         // Download the remote file\n         [$protocol] = Helpers::explode_url($remoteFile);\n-        if (!$this->options->isRemoteEnabled() && ($protocol !== \"\" && $protocol !== \"file://\")) {\n-            Helpers::record_warnings(E_USER_WARNING, \"Remote font resource $remoteFile referenced, but remote file download is disabled.\", __FILE__, __LINE__);\n-            return false;\n+        $allowed_protocols = $this->options->getAllowedProtocols();\n+        if (!array_key_exists($protocol, $allowed_protocols)) {\n+            Helpers::record_warnings(E_USER_WARNING, \"Permission denied on $remoteFile. The communication protocol is not supported.\", __FILE__, __LINE__);\n         }\n-        if ($protocol === \"\" || $protocol === \"file://\") {\n-            $realfile = realpath($remoteFile);\n-\n-            $rootDir = realpath($this->options->getRootDir());\n-            if (strpos($realfile, $rootDir) !== 0) {\n-                $chroot = $this->options->getChroot();\n-                $chrootValid = false;\n-                foreach ($chroot as $chrootPath) {\n-                    $chrootPath = realpath($chrootPath);\n-                    if ($chrootPath !== false && strpos($realfile, $chrootPath) === 0) {\n-                        $chrootValid = true;\n-                        break;\n-                    }\n-                }\n-                if ($chrootValid !== true) {\n-                    Helpers::record_warnings(E_USER_WARNING, \"Permission denied on $remoteFile. The file could not be found under the paths specified by Options::chroot.\", __FILE__, __LINE__);\n-                    return false;\n-                }\n-            }\n \n-            if (!$realfile) {\n-                Helpers::record_warnings(E_USER_WARNING, \"File '$realfile' not found.\", __FILE__, __LINE__);\n-                return false;\n+        foreach ($allowed_protocols[$protocol][\"rules\"] as $rule) {\n+            [$result, $message] = $rule($remoteFile);\n+            if ($result !== true) {\n+                Helpers::record_warnings(E_USER_WARNING, \"Error loading $remoteFile: $message\", __FILE__, __LINE__);\n             }\n-\n-            $remoteFile = $realfile;\n         }\n+\n         list($remoteFileContent, $http_response_header) = @Helpers::getFileContent($remoteFile, $context);\n         if ($remoteFileContent === null) {\n             return false;"
            },
            {
                "sha": "c52aae803bd51d9fc17724552cefcd2db50b1f2f",
                "filename": "src/FrameDecorator/Image.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FFrameDecorator%2FImage.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FFrameDecorator%2FImage.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/src%2FFrameDecorator%2FImage.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -57,7 +57,7 @@ function __construct(Frame $frame, Dompdf $dompdf)\n             $dompdf->getProtocol(),\n             $dompdf->getBaseHost(),\n             $dompdf->getBasePath(),\n-            $dompdf\n+            $dompdf->getOptions()\n         );\n \n         if (Cache::is_broken($this->_image_url) &&"
            },
            {
                "sha": "ece05c567bf96bc607fe344e9764b94aea9c2ec7",
                "filename": "src/Helpers.php",
                "status": "modified",
                "additions": 56,
                "deletions": 39,
                "changes": 95,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FHelpers.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FHelpers.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/src%2FHelpers.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -57,28 +57,45 @@ public static function pre_r($mixed, $return = false)\n     public static function build_url($protocol, $host, $base_path, $url)\n     {\n         $protocol = mb_strtolower($protocol);\n+        if (empty($protocol)) {\n+            $protocol = \"file://\";\n+        }\n         if ($url === \"\") {\n-            //return $protocol . $host . rtrim($base_path, \"/\\\\\") . \"/\";\n-            return $protocol . $host . $base_path;\n+            return null;\n         }\n \n+        $url_lc = mb_strtolower($url);\n+\n         // Is the url already fully qualified, a Data URI, or a reference to a named anchor?\n         // File-protocol URLs may require additional processing (e.g. for URLs with a relative path)\n-        if ((mb_strpos($url, \"://\") !== false && substr($url, 0, 7) !== \"file://\") || mb_substr($url, 0, 1) === \"#\" || mb_strpos($url, \"data:\") === 0 || mb_strpos($url, \"mailto:\") === 0 || mb_strpos($url, \"tel:\") === 0) {\n+        if (\n+            (\n+                mb_strpos($url_lc, \"://\") !== false\n+                && !in_array(substr($url_lc, 0, 7), [\"file://\", \"phar://\"], true)\n+            )\n+            || mb_substr($url_lc, 0, 1) === \"#\"\n+            || mb_strpos($url_lc, \"data:\") === 0\n+            || mb_strpos($url_lc, \"mailto:\") === 0\n+            || mb_strpos($url_lc, \"tel:\") === 0\n+        ) {\n             return $url;\n         }\n \n-        if (strpos($url, \"file://\") === 0) {\n+        $res = \"\";\n+        if (strpos($url_lc, \"file://\") === 0) {\n             $url = substr($url, 7);\n-            $protocol = \"\";\n+            $protocol = \"file://\";\n+        } elseif (strpos($url_lc, \"phar://\") === 0) {\n+            $res = substr($url, strpos($url_lc, \".phar\")+5);\n+            $url = substr($url, 7, strpos($url_lc, \".phar\")-2);\n+            $protocol = \"phar://\";\n         }\n \n         $ret = \"\";\n-        if ($protocol !== \"file://\") {\n-            $ret = $protocol;\n-        }\n \n-        if (!in_array(mb_strtolower($protocol), [\"http://\", \"https://\", \"ftp://\", \"ftps://\"], true)) {\n+        $is_local_path = in_array($protocol, [\"file://\", \"phar://\"], true);\n+\n+        if ($is_local_path) {\n             //On Windows local file, an abs path can begin also with a '\\' or a drive letter and colon\n             //drive: followed by a relative path would be a drive specific default folder.\n             //not known in php app code, treat as abs path\n@@ -89,9 +106,18 @@ public static function build_url($protocol, $host, $base_path, $url)\n             }\n             $ret .= $url;\n             $ret = preg_replace('/\\?(.*)$/', \"\", $ret);\n+\n+            $filepath = realpath($ret);\n+            if ($filepath === false) {\n+                return null;\n+            }\n+\n+            $ret = \"$protocol$filepath$res\";\n+\n             return $ret;\n         }\n \n+        $ret = $protocol;\n         // Protocol relative urls (e.g. \"//example.org/style.css\")\n         if (strpos($url, '//') === 0) {\n             $ret .= substr($url, 2);\n@@ -431,14 +457,14 @@ public static function explode_url($url)\n         $host = \"\";\n         $path = \"\";\n         $file = \"\";\n+        $res = \"\";\n \n         $arr = parse_url($url);\n         if ( isset($arr[\"scheme\"]) ) {\n             $arr[\"scheme\"] = mb_strtolower($arr[\"scheme\"]);\n         }\n \n-        // Exclude windows drive letters...\n-        if (isset($arr[\"scheme\"]) && $arr[\"scheme\"] !== \"file\" && strlen($arr[\"scheme\"]) > 1) {\n+        if (isset($arr[\"scheme\"]) && $arr[\"scheme\"] !== \"file\" && $arr[\"scheme\"] !== \"phar\" && strlen($arr[\"scheme\"]) > 1) {\n             $protocol = $arr[\"scheme\"] . \"://\";\n \n             if (isset($arr[\"user\"])) {\n@@ -480,42 +506,32 @@ public static function explode_url($url)\n \n         } else {\n \n-            $i = mb_stripos($url, \"file://\");\n-            if ($i !== false) {\n-                $url = mb_substr($url, $i + 7);\n-            }\n-\n-            $protocol = \"\"; // \"file://\"; ? why doesn't this work... It's because of\n-            // network filenames like //COMPU/SHARENAME\n-\n+            $protocol = \"\";\n             $host = \"\"; // localhost, really\n-            $file = basename($url);\n-\n-            $path = dirname($url);\n-\n-            // Check that the path exists\n-            if ($path !== false) {\n-                $path .= '/';\n \n+            $i = mb_stripos($url, \"://\");\n+            if ($i !== false) {\n+                $protocol = mb_strtolower(mb_substr($url, 0, $i + 3));\n+                $url = mb_substr($url, $i + 3);\n             } else {\n-                // generate a url to access the file if no real path found.\n-                $protocol = isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on' ? 'https://' : 'http://';\n-\n-                $host = isset($_SERVER[\"HTTP_HOST\"]) ? $_SERVER[\"HTTP_HOST\"] : php_uname(\"n\");\n+                $protocol = \"file://\";\n+            }\n \n-                if (substr($arr[\"path\"], 0, 1) === '/') {\n-                    $path = dirname($arr[\"path\"]);\n-                } else {\n-                    $path = '/' . rtrim(dirname($_SERVER[\"SCRIPT_NAME\"]), '/') . '/' . $arr[\"path\"];\n-                }\n+            if ($protocol === \"phar://\") {\n+                $res = substr($url, stripos($url, \".phar\")+5);\n+                $url = substr($url, 7, stripos($url, \".phar\")-2);\n             }\n+\n+            $file = basename($url);\n+            $path = dirname($url) . \"/\";\n         }\n \n         $ret = [$protocol, $host, $path, $file,\n             \"protocol\" => $protocol,\n             \"host\" => $host,\n             \"path\" => $path,\n-            \"file\" => $file];\n+            \"file\" => $file,\n+            \"resource\" => $res];\n         return $ret;\n     }\n \n@@ -878,12 +894,13 @@ public static function getFileContent($uri, $context = null, $offset = 0, $maxle\n         $content = null;\n         $headers = null;\n         [$protocol] = Helpers::explode_url($uri);\n-        $is_local_path = ($protocol === \"\" || $protocol === \"file://\");\n+        $is_local_path = in_array(strtolower($protocol), [\"\", \"file://\", \"phar://\"], true);\n+        $can_use_curl = in_array(strtolower($protocol), [\"http://\", \"https://\"], true);\n \n         set_error_handler([self::class, 'record_warnings']);\n \n         try {\n-            if ($is_local_path || ini_get('allow_url_fopen')) {\n+            if ($is_local_path || ini_get('allow_url_fopen') || !$can_use_curl) {\n                 if ($is_local_path === false) {\n                     $uri = Helpers::encodeURI($uri);\n                 }\n@@ -899,7 +916,7 @@ public static function getFileContent($uri, $context = null, $offset = 0, $maxle\n                     $headers = $http_response_header;\n                 }\n \n-            } elseif (function_exists('curl_exec')) {\n+            } elseif ($can_use_curl && function_exists('curl_exec')) {\n                 $curl = curl_init($uri);\n \n                 curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);"
            },
            {
                "sha": "7da66a1e16fdf0a25bdc3a54264d7dd64b40b433",
                "filename": "src/Image/Cache.php",
                "status": "modified",
                "additions": 62,
                "deletions": 106,
                "changes": 168,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FImage%2FCache.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FImage%2FCache.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/src%2FImage%2FCache.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -9,7 +9,7 @@\n  */\n namespace Dompdf\\Image;\n \n-use Dompdf\\Dompdf;\n+use Dompdf\\Options;\n use Dompdf\\Helpers;\n use Dompdf\\Exception\\ImageException;\n \n@@ -43,144 +43,98 @@ class Cache\n \n     public static $error_message = \"Image not found or type unknown\";\n     \n-    /**\n-     * Current dompdf instance\n-     *\n-     * @var Dompdf\n-     */\n-    protected static $_dompdf;\n-\n     /**\n      * Resolve and fetch an image for use.\n      *\n      * @param string $url       The url of the image\n      * @param string $protocol  Default protocol if none specified in $url\n      * @param string $host      Default host if none specified in $url\n      * @param string $base_path Default path if none specified in $url\n-     * @param Dompdf $dompdf    The Dompdf instance\n+     * @param Options $options  An instance of Dompdf\\Options\n      *\n-     * @throws ImageException\n-     * @return array             An array with two elements: The local path to the image and the image extension\n+     * @return array            An array with three elements: The local path to the image, the image\n+     *                          extension, and an error message if the image could not be cached\n      */\n-    static function resolve_url($url, $protocol, $host, $base_path, Dompdf $dompdf)\n+    static function resolve_url($url, $protocol, $host, $base_path, Options $options)\n     {\n-        self::$_dompdf = $dompdf;\n-        \n-        $protocol = mb_strtolower($protocol);\n-        $parsed_url = Helpers::explode_url($url);\n+        $tempfile = null;\n+        $resolved_url = null;\n+        $type = null;\n         $message = null;\n-\n-        $remote = ($protocol && $protocol !== \"file://\") || ($parsed_url['protocol'] !== \"\");\n-\n-        $data_uri = strpos($parsed_url['protocol'], \"data:\") === 0;\n-        $full_url = null;\n-        $enable_remote = $dompdf->getOptions()->getIsRemoteEnabled();\n-        $tempfile = false;\n-\n+        \n         try {\n+            $full_url = Helpers::build_url($protocol, $host, $base_path, $url);\n \n-            // Remote not allowed and is not DataURI\n-            if (!$enable_remote && $remote && !$data_uri) {\n-                throw new ImageException(\"Remote file access is disabled.\", E_WARNING);\n+            if ($full_url === null) {\n+                throw new ImageException(\"Unable to parse image URL $url.\", E_WARNING);\n             }\n-            \n-            // remote allowed or DataURI\n-            if (($enable_remote && $remote) || $data_uri) {\n-                // Download remote files to a temporary directory\n-                $full_url = Helpers::build_url($protocol, $host, $base_path, $url);\n \n-                // From cache\n-                if (isset(self::$_cache[$full_url])) {\n-                    $resolved_url = self::$_cache[$full_url];\n-                } // From remote\n-                else {\n-                    $tmp_dir = $dompdf->getOptions()->getTempDir();\n-                    if (($resolved_url = @tempnam($tmp_dir, \"ca_dompdf_img_\")) === false) {\n-                        throw new ImageException(\"Unable to create temporary image in \" . $tmp_dir, E_WARNING);\n+            $parsed_url = Helpers::explode_url($full_url);\n+            $protocol = strtolower($parsed_url[\"protocol\"]);\n+            $is_data_uri = strpos($protocol, \"data:\") === 0;\n+            \n+            if (!$is_data_uri) {\n+                $allowed_protocols = $options->getAllowedProtocols();\n+                if (!array_key_exists($protocol, $allowed_protocols)) {\n+                    throw new ImageException(\"Permission denied on $url. The communication protocol is not supported.\", E_WARNING);\n+                }\n+                foreach ($allowed_protocols[$protocol][\"rules\"] as $rule) {\n+                    [$result, $message] = $rule($full_url);\n+                    if (!$result) {\n+                        throw new ImageException(\"Error loading $url: $message\", E_WARNING);\n                     }\n-                    $tempfile = $resolved_url;\n-                    $image = null;\n+                }\n+            }\n \n-                    if ($data_uri) {\n-                        if ($parsed_data_uri = Helpers::parse_data_uri($url)) {\n-                            $image = $parsed_data_uri['data'];\n-                        }\n-                    } else {\n-                        list($image, $http_response_header) = Helpers::getFileContent($full_url, $dompdf->getHttpContext());\n-                    }\n+            if ($protocol === \"file://\") {\n+                $resolved_url = $full_url;\n+            } elseif (isset(self::$_cache[$full_url])) {\n+                $resolved_url = self::$_cache[$full_url];\n+            } else {\n+                $tmp_dir = $options->getTempDir();\n+                if (($resolved_url = @tempnam($tmp_dir, \"ca_dompdf_img_\")) === false) {\n+                    throw new ImageException(\"Unable to create temporary image in \" . $tmp_dir, E_WARNING);\n+                }\n+                $tempfile = $resolved_url;\n \n-                    // Image not found or invalid\n-                    if ($image === null) {\n-                        $msg = ($data_uri ? \"Data-URI could not be parsed\" : \"Image not found\");\n-                        throw new ImageException($msg, E_WARNING);\n-                    } // Image found, put in cache and process\n-                    else {\n-                        //e.g. fetch.php?media=url.jpg&cache=1\n-                        //- Image file name might be one of the dynamic parts of the url, don't strip off!\n-                        //- a remote url does not need to have a file extension at all\n-                        //- local cached file does not have a matching file extension\n-                        //Therefore get image type from the content\n-                        if (@file_put_contents($resolved_url, $image) === false) {\n-                            throw new ImageException(\"Unable to create temporary image in \" . $tmp_dir, E_WARNING);\n-                        }\n+                $image = null;\n+                if ($is_data_uri) {\n+                    if (($parsed_data_uri = Helpers::parse_data_uri($url)) !== false) {\n+                        $image = $parsed_data_uri[\"data\"];\n                     }\n+                } else {\n+                    list($image, $http_response_header) = Helpers::getFileContent($full_url, $options->getHttpContext());\n                 }\n-            } // Not remote, local image\n-            else {\n-                $resolved_url = Helpers::build_url($protocol, $host, $base_path, $url);\n \n-                if ($protocol === \"\" || $protocol === \"file://\") {\n-                    $realfile = realpath($resolved_url);\n-        \n-                    $rootDir = realpath($dompdf->getOptions()->getRootDir());\n-                    if (strpos($realfile, $rootDir) !== 0) {\n-                        $chroot = $dompdf->getOptions()->getChroot();\n-                        $chrootValid = false;\n-                        foreach ($chroot as $chrootPath) {\n-                            $chrootPath = realpath($chrootPath);\n-                            if ($chrootPath !== false && strpos($realfile, $chrootPath) === 0) {\n-                                $chrootValid = true;\n-                                break;\n-                            }\n-                        }\n-                        if ($chrootValid !== true) {\n-                            throw new ImageException(\"Permission denied on $resolved_url. The file could not be found under the paths specified by Options::chroot.\", E_WARNING);\n-                        }\n-                    }\n-        \n-                    if (!$realfile) {\n-                        throw new ImageException(\"File '$realfile' not found.\", E_WARNING);\n-                    }\n-        \n-                    $resolved_url = $realfile;\n+                // Image not found or invalid\n+                if ($image === null) {\n+                    $msg = ($is_data_uri ? \"Data-URI could not be parsed\" : \"Image not found\");\n+                    throw new ImageException($msg, E_WARNING);\n+                }\n+\n+                if (@file_put_contents($resolved_url, $image) === false) {\n+                    throw new ImageException(\"Unable to create temporary image in \" . $tmp_dir, E_WARNING);\n                 }\n+\n+                self::$_cache[$full_url] = $resolved_url;\n             }\n \n             // Check if the local file is readable\n             if (!is_readable($resolved_url) || !filesize($resolved_url)) {\n                 throw new ImageException(\"Image not readable or empty\", E_WARNING);\n-            } // Check is the file is an image\n-            else {\n-                list($width, $height, $type) = Helpers::dompdf_getimagesize($resolved_url, $dompdf->getHttpContext());\n+            }\n \n-                // Known image type\n-                if ($width && $height && in_array($type, [\"gif\", \"png\", \"jpeg\", \"bmp\", \"svg\",\"webp\"], true)) {\n-                    //Don't put replacement image into cache - otherwise it will be deleted on cache cleanup.\n-                    //Only execute on successful caching of remote image.\n-                    if ($enable_remote && $remote || $data_uri) {\n-                        self::$_cache[$full_url] = $resolved_url;\n-                    }\n-                } // Unknown image type\n-                else {\n-                    throw new ImageException(\"Image type unknown\", E_WARNING);\n-                }\n+            list($width, $height, $type) = Helpers::dompdf_getimagesize($resolved_url, $options->getHttpContext());\n+\n+            if (($width && $height && in_array($type, [\"gif\", \"png\", \"jpeg\", \"bmp\", \"svg\",\"webp\"], true)) === false) {\n+                throw new ImageException(\"Image type unknown\", E_WARNING);\n             }\n         } catch (ImageException $e) {\n             if ($tempfile) {\n                 unlink($tempfile);\n             }\n             $resolved_url = self::$broken_image;\n-            $type = \"png\";\n+            $type = \"svg\";\n             $message = self::$error_message;\n             Helpers::record_warnings($e->getCode(), $e->getMessage() . \" \\n $url\", $e->getFile(), $e->getLine());\n             self::$_cache[$full_url] = $resolved_url;\n@@ -229,7 +183,9 @@ static function clear(bool $debugPng = false)\n             if ($debugPng) {\n                 print \"[clear unlink $file]\";\n             }\n-            unlink($file);\n+            if (file_exists($file)) {\n+                unlink($file);\n+            }\n         }\n \n         foreach (self::$tempImages as $versions) {"
            },
            {
                "sha": "d3a4da35a7ffdfb0d069c369ead1ea5af63ca212",
                "filename": "src/Options.php",
                "status": "modified",
                "additions": 139,
                "deletions": 3,
                "changes": 142,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FOptions.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FOptions.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/src%2FOptions.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -62,6 +62,20 @@ class Options\n      */\n     private $chroot;\n \n+    /**\n+    * Protocol whitelist\n+    *\n+    * Protocols and PHP wrappers allowed in URIs. Full support is not\n+    * guaranteed for the protocols/wrappers specified by this array.\n+    *\n+    * @var array\n+    */\n+    private $allowedProtocols = [\n+        \"file://\" => [\"rules\" => []],\n+        \"http://\" => [\"rules\" => []],\n+        \"https://\" => [\"rules\" => []]\n+    ];\n+\n     /**\n      * @var string\n      */\n@@ -299,9 +313,12 @@ public function __construct(array $attributes = null)\n         $this->setFontCache($this->getFontDir());\n \n         $ver = \"\";\n-        $versionFile = realpath(__DIR__ . \"/../VERSION\");\n-        if (file_exists($versionFile) && ($version = trim(file_get_contents($versionFile))) !== false && $version !== '$Format:<%h>$') {\n-            $ver = \"/$version\";\n+        $versionFile = realpath(__DIR__ . '/../VERSION');\n+        if (($version = file_get_contents($versionFile)) !== false) {\n+            $version = trim($version);\n+            if ($version !== '$Format:<%h>$') {\n+                $ver = \"/$version\";\n+            }\n         }\n         $this->setHttpContext([\n             \"http\" => [\n@@ -310,6 +327,8 @@ public function __construct(array $attributes = null)\n             ]\n         ]);\n \n+        $this->setAllowedProtocols([\"file://\", \"http://\", \"https://\"]);\n+\n         if (null !== $attributes) {\n             $this->set($attributes);\n         }\n@@ -334,6 +353,8 @@ public function set($attributes, $value = null)\n                 $this->setFontCache($value);\n             } elseif ($key === 'chroot') {\n                 $this->setChroot($value);\n+            } elseif ($key === 'allowedProtocols') {\n+                $this->setAllowedProtocols($value);\n             } elseif ($key === 'logOutputFile' || $key === 'log_output_file') {\n                 $this->setLogOutputFile($value);\n             } elseif ($key === 'defaultMediaType' || $key === 'default_media_type') {\n@@ -399,6 +420,8 @@ public function get($key)\n             return $this->getFontCache();\n         } elseif ($key === 'chroot') {\n             return $this->getChroot();\n+        } elseif ($key === 'allowedProtocols') {\n+            return $this->getAllowedProtocols();\n         } elseif ($key === 'logOutputFile' || $key === 'log_output_file') {\n             return $this->getLogOutputFile();\n         } elseif ($key === 'defaultMediaType' || $key === 'default_media_type') {\n@@ -499,6 +522,67 @@ public function setChroot($chroot, $delimiter = ',')\n         return $this;\n     }\n \n+    /**\n+     * @return array\n+     */\n+    public function getAllowedProtocols()\n+    {\n+        return $this->allowedProtocols;\n+    }\n+\n+    /**\n+     * @param array $allowedProtocols The protocols to allow as an array ([\"protocol://\" => [\"rules\" => [callable]]], ...) or a string list of the protocols\n+     * @return $this\n+     */\n+    public function setAllowedProtocols(array $allowedProtocols)\n+    {\n+        $protocols = [];\n+        foreach ($allowedProtocols as $protocol => $config) {\n+            if (is_string($protocol)) {\n+                $protocols[$protocol] = [];\n+                if (is_array($config)) {\n+                    $protocols[$protocol] = $config;\n+                }\n+            } elseif (is_string($config)) {\n+                $protocols[$config] = [];\n+            }\n+        }\n+        $this->allowedProtocols = [];\n+        foreach ($protocols as $protocol => $config) {\n+            $this->addAllowedProtocol($protocol, ...($config[\"rules\"] ?? []));\n+        }\n+        return $this;\n+    }\n+\n+    /**\n+     * Adds a new protocol to the allowed protocols collection\n+     *\n+     * @param string $protocol The scheme to add (e.g. \"http://\")\n+     * @param callable $rule A callable that validates the protocol\n+     * @return $this\n+     */\n+    public function addAllowedProtocol(string $protocol, callable ...$rules)\n+    {\n+        $protocol = strtolower($protocol);\n+        if (empty($rules)) {\n+            $rules = [];\n+            switch ($protocol) {\n+                case \"file://\":\n+                    $rules[] = [$this, \"validateLocalUri\"];\n+                    break;\n+                case \"http://\":\n+                case \"https://\":\n+                    $rules[] = [$this, \"validateRemoteUri\"];\n+                    break;\n+                case \"phar://\":\n+                    $rules[] = [$this, \"validatePharUri\"];\n+                    break;\n+            }\n+        }\n+        $this->allowedProtocols[$protocol] = [\"rules\" => $rules];\n+        return $this;\n+    }\n+\n     /**\n      * @return array\n      */\n@@ -1011,4 +1095,56 @@ public function getHttpContext()\n     {\n         return $this->httpContext;\n     }\n+\n+    public function validateLocalUri(string $uri)\n+    {\n+        if ($uri === null || strlen($uri) === 0) {\n+            return [false, \"The URI must not be empty.\"];\n+        }\n+\n+        $realfile = realpath(str_replace(\"file://\", \"\", $uri));\n+\n+        $dirs = $this->chroot;\n+        $dirs[] = $this->rootDir;\n+        $chrootValid = false;\n+        foreach ($dirs as $chrootPath) {\n+            $chrootPath = realpath($chrootPath);\n+            if ($chrootPath !== false && strpos($realfile, $chrootPath) === 0) {\n+                $chrootValid = true;\n+                break;\n+            }\n+        }\n+        if ($chrootValid !== true) {\n+            return [false, \"Permission denied. The file could not be found under the paths specified by Options::chroot.\"];\n+        }\n+\n+        if (!$realfile) {\n+            return [false, \"File not found.\"];\n+        }\n+\n+        return [true, null];\n+    }\n+\n+    public function validatePharUri(string $uri)\n+    {\n+        if ($uri === null || strlen($uri) === 0) {\n+            return [false, \"The URI must not be empty.\"];\n+        }\n+\n+        $file = substr(substr($uri, 0, strpos($uri, \".phar\") + 5), 7);\n+        return $this->validateLocalUri($file);\n+    }\n+\n+    public function validateRemoteUri(string $uri)\n+    {\n+        if ($uri === null || strlen($uri) === 0) {\n+            return [false, \"The URI must not be empty.\"];\n+        }\n+\n+        if (!$this->isRemoteEnabled) {\n+            return [false, \"Remote file requested, but remote file download is disabled.\"];\n+        }\n+\n+        return [true, null];\n+    }\n }"
            },
            {
                "sha": "27dc365b26c0896c2fbd6c438da5cb0442181cfb",
                "filename": "src/Renderer/AbstractRenderer.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FRenderer%2FAbstractRenderer.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/src%2FRenderer%2FAbstractRenderer.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/src%2FRenderer%2FAbstractRenderer.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -97,7 +97,7 @@ protected function _background_image($url, $x, $y, $width, $height, $style)\n             $sheet->get_protocol(),\n             $sheet->get_host(),\n             $sheet->get_base_path(),\n-            $this->_dompdf\n+            $this->_dompdf->getOptions()\n         );\n \n         // Bail if the image is no good"
            },
            {
                "sha": "45929fcb3cb0b467f8b1a015f451717b70464aca",
                "filename": "tests/Css/StyleTest.php",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/tests%2FCss%2FStyleTest.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/tests%2FCss%2FStyleTest.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/tests%2FCss%2FStyleTest.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -53,17 +53,17 @@ public function cssImageNoBaseHrefProvider(): array\n     {\n         $basePath = realpath(__DIR__ . \"/..\");\n         return [\n-            \"local absolute\" => [\"url($basePath/_files/jamaica.jpg)\", $basePath . DIRECTORY_SEPARATOR . \"_files\" . DIRECTORY_SEPARATOR . \"jamaica.jpg\"],\n-            \"local relative\" => [\"url(../_files/jamaica.jpg)\", $basePath . DIRECTORY_SEPARATOR . \"_files\" . DIRECTORY_SEPARATOR . \"jamaica.jpg\"]\n+            \"local absolute\" => [\"url($basePath/_files/jamaica.jpg)\", \"file://\" . $basePath . DIRECTORY_SEPARATOR . \"_files\" . DIRECTORY_SEPARATOR . \"jamaica.jpg\"],\n+            \"local relative\" => [\"url(../_files/jamaica.jpg)\", \"file://\" . $basePath . DIRECTORY_SEPARATOR . \"_files\" . DIRECTORY_SEPARATOR . \"jamaica.jpg\"]\n         ];\n     }\n \n     public function cssImageWithBaseHrefProvider(): array\n     {\n         $basePath = realpath(__DIR__ . \"/..\");\n         return [\n-            \"local absolute\" => [\"url($basePath/_files/jamaica.jpg)\", $basePath . DIRECTORY_SEPARATOR . \"_files\" . DIRECTORY_SEPARATOR . \"jamaica.jpg\"],\n-            \"local relative\" => [\"url(../_files/jamaica.jpg)\", $basePath . DIRECTORY_SEPARATOR . \"_files\" . DIRECTORY_SEPARATOR . \"jamaica.jpg\"]\n+            \"local absolute\" => [\"url($basePath/_files/jamaica.jpg)\", \"file://\" . $basePath . DIRECTORY_SEPARATOR . \"_files\" . DIRECTORY_SEPARATOR . \"jamaica.jpg\"],\n+            \"local relative\" => [\"url(../_files/jamaica.jpg)\", \"file://\" . $basePath . DIRECTORY_SEPARATOR . \"_files\" . DIRECTORY_SEPARATOR . \"jamaica.jpg\"]\n         ];\n     }\n "
            },
            {
                "sha": "e69f2143b805a11ce2db634e76a0f537037601c3",
                "filename": "tests/HelpersTest.php",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/tests%2FHelpersTest.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/tests%2FHelpersTest.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/tests%2FHelpersTest.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -101,4 +101,11 @@ public function testLengthEqual(float $a, float $b, bool $expected): void\n         $this->assertSame($expected, Helpers::lengthEqual(-$a, -$b));\n         $this->assertSame($expected, Helpers::lengthEqual(-$b, -$a));\n     }\n+\n+    \n+    public function testCustomProtocolParsing(): void\n+    {\n+        $uri = \"mock://path/to/resource\";\n+        $this->assertSame($uri, Helpers::build_url(\"\", \"\", \"\", $uri));\n+    }\n }"
            },
            {
                "sha": "5147ddee40defcc11b3c5d643021d64c5e5a2829",
                "filename": "tests/OptionsTest.php",
                "status": "modified",
                "additions": 40,
                "deletions": 0,
                "changes": 40,
                "blob_url": "https://github.com/dompdf/dompdf/blob/99aeec1efec9213e87098d42eb09439e7ee0bb6a/tests%2FOptionsTest.php",
                "raw_url": "https://github.com/dompdf/dompdf/raw/99aeec1efec9213e87098d42eb09439e7ee0bb6a/tests%2FOptionsTest.php",
                "contents_url": "https://api.github.com/repos/dompdf/dompdf/contents/tests%2FOptionsTest.php?ref=99aeec1efec9213e87098d42eb09439e7ee0bb6a",
                "patch": "@@ -95,4 +95,44 @@ public function testSetters()\n         $option->setChroot(['test11']);\n         $this->assertEquals(['test11'], $option->getChroot());\n     }\n+\n+    public function testAllowedProtocols()\n+    {\n+        $options = new Options([\"isRemoteEnabled\" => false]);\n+        $options->setAllowedProtocols([\"http://\"]);\n+        $allowedProtocols = $options->getAllowedProtocols();\n+        $this->assertIsArray($allowedProtocols);\n+        $this->assertEquals(1, count($allowedProtocols));\n+        $this->assertArrayHasKey(\"http://\", $allowedProtocols);\n+        $this->assertIsArray($allowedProtocols[\"http://\"]);\n+        $this->assertArrayHasKey(\"rules\", $allowedProtocols[\"http://\"]);\n+        $this->assertIsArray($allowedProtocols[\"http://\"][\"rules\"]);\n+        $this->assertEquals(1, count($allowedProtocols[\"http://\"][\"rules\"]));\n+        $this->assertEquals([$options, \"validateRemoteUri\"], $allowedProtocols[\"http://\"][\"rules\"][0]);\n+\n+        [$validation_result] = $allowedProtocols[\"http://\"][\"rules\"][0](\"http://example.com/\");\n+        $this->assertFalse($validation_result);\n+\n+        \n+        $mock_protocol = [\n+            \"mock://\" => [\n+                \"rules\" => [\n+                    function ($uri) { return [true, null]; }\n+                ]\n+            ]\n+        ];\n+        $options->setAllowedProtocols($mock_protocol);\n+        $allowedProtocols = $options->getAllowedProtocols();\n+        $this->assertIsArray($allowedProtocols);\n+        $this->assertEquals(1, count($allowedProtocols));\n+        $this->assertArrayHasKey(\"mock://\", $allowedProtocols);\n+        $this->assertIsArray($allowedProtocols[\"mock://\"]);\n+        $this->assertArrayHasKey(\"rules\", $allowedProtocols[\"mock://\"]);\n+        $this->assertIsArray($allowedProtocols[\"mock://\"][\"rules\"]);\n+        $this->assertEquals(1, count($allowedProtocols[\"mock://\"][\"rules\"]));\n+        $this->assertEquals($mock_protocol[\"mock://\"][\"rules\"][0], $allowedProtocols[\"mock://\"][\"rules\"][0]);\n+\n+        [$validation_result] = $allowedProtocols[\"mock://\"][\"rules\"][0](\"mock://example.com/\");\n+        $this->assertTrue($validation_result);\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/chatwoot/chatwoot/commits/6fdd4a29969be8423f31890b807d27d13627c50c",
        "url": "https://api.github.com/repos/chatwoot/chatwoot/commits/6fdd4a29969be8423f31890b807d27d13627c50c",
        "html_url": "https://github.com/chatwoot/chatwoot/commit/6fdd4a29969be8423f31890b807d27d13627c50c",
        "message": "chore: Security Improvements to the API (#2893)\n\n- Devise auth tokens are reset on password update\r\n- Avatar attachment file type is limited to jpeg,gif and png\r\n- Avatar attachment file size is limited to 15 mb\r\n- Widget Message attachments are limited to types ['image/png', 'image/jpeg', 'image/gif', 'image/bmp', 'image/tiff', 'application/pdf', 'audio/mpeg', 'video/mp4', 'audio/ogg', 'text/csv']\r\n- Widget Message attachments are limited to 40Mb size limit.",
        "files": [
            {
                "sha": "b6ae5409d90b53aff8205a216f4a28843eaf67db",
                "filename": "app/builders/messages/message_builder.rb",
                "status": "modified",
                "additions": 14,
                "deletions": 10,
                "changes": 24,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fbuilders%2Fmessages%2Fmessage_builder.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fbuilders%2Fmessages%2Fmessage_builder.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fbuilders%2Fmessages%2Fmessage_builder.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -15,21 +15,25 @@ def initialize(user, conversation, params)\n \n   def perform\n     @message = @conversation.messages.build(message_params)\n-    if @attachments.present?\n-      @attachments.each do |uploaded_attachment|\n-        attachment = @message.attachments.new(\n-          account_id: @message.account_id,\n-          file_type: file_type(uploaded_attachment&.content_type)\n-        )\n-        attachment.file.attach(uploaded_attachment)\n-      end\n-    end\n-    @message.save\n+    process_attachments\n+    @message.save!\n     @message\n   end\n \n   private\n \n+  def process_attachments\n+    return if @attachments.blank?\n+\n+    @attachments.each do |uploaded_attachment|\n+      @message.attachments.build(\n+        account_id: @message.account_id,\n+        file_type: file_type(uploaded_attachment&.content_type),\n+        file: uploaded_attachment\n+      )\n+    end\n+  end\n+\n   def message_type\n     if @conversation.inbox.channel_type != 'Channel::Api' && @message_type == 'incoming'\n       raise StandardError, 'Incoming messages are only allowed in Api inboxes'"
            },
            {
                "sha": "0d9ab6323077d8a2885ab955d4d3a1130a866fbd",
                "filename": "app/controllers/api/v1/widget/messages_controller.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fapi%2Fv1%2Fwidget%2Fmessages_controller.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fapi%2Fv1%2Fwidget%2Fmessages_controller.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fcontrollers%2Fapi%2Fv1%2Fwidget%2Fmessages_controller.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -8,8 +8,8 @@ def index\n \n   def create\n     @message = conversation.messages.new(message_params)\n-    @message.save\n     build_attachment\n+    @message.save!\n   end\n \n   def update\n@@ -29,13 +29,12 @@ def build_attachment\n     return if params[:message][:attachments].blank?\n \n     params[:message][:attachments].each do |uploaded_attachment|\n-      attachment = @message.attachments.new(\n+      @message.attachments.new(\n         account_id: @message.account_id,\n-        file_type: helpers.file_type(uploaded_attachment&.content_type)\n+        file_type: helpers.file_type(uploaded_attachment&.content_type),\n+        file: uploaded_attachment\n       )\n-      attachment.file.attach(uploaded_attachment)\n     end\n-    @message.save!\n   end\n \n   def set_conversation"
            },
            {
                "sha": "925c16d3843369b912bee73f3aa7abfbbb6d0e34",
                "filename": "app/controllers/public/api/v1/inboxes/messages_controller.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fpublic%2Fapi%2Fv1%2Finboxes%2Fmessages_controller.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fpublic%2Fapi%2Fv1%2Finboxes%2Fmessages_controller.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fcontrollers%2Fpublic%2Fapi%2Fv1%2Finboxes%2Fmessages_controller.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -7,8 +7,8 @@ def index\n \n   def create\n     @message = @conversation.messages.new(message_params)\n-    @message.save\n     build_attachment\n+    @message.save!\n   end\n \n   def update\n@@ -23,13 +23,12 @@ def build_attachment\n     return if params[:attachments].blank?\n \n     params[:attachments].each do |uploaded_attachment|\n-      attachment = @message.attachments.new(\n+      @message.attachments.new(\n         account_id: @message.account_id,\n-        file_type: helpers.file_type(uploaded_attachment&.content_type)\n+        file_type: helpers.file_type(uploaded_attachment&.content_type),\n+        file: uploaded_attachment\n       )\n-      attachment.file.attach(uploaded_attachment)\n     end\n-    @message.save!\n   end\n \n   def message_finder_params"
            },
            {
                "sha": "64d67701a0d2b352bdb0b4c3a585ebe74b12fe0f",
                "filename": "app/helpers/file_type_helper.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fhelpers%2Ffile_type_helper.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fhelpers%2Ffile_type_helper.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fhelpers%2Ffile_type_helper.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -3,12 +3,12 @@ def file_type(content_type)\n     return :image if [\n       'image/jpeg',\n       'image/png',\n-      'image/svg+xml',\n       'image/gif',\n       'image/tiff',\n       'image/bmp'\n     ].include?(content_type)\n \n+    return :video if content_type.include?('video/')\n     return :audio if content_type.include?('audio/')\n \n     :file"
            },
            {
                "sha": "1ffc9be6538c2c14cab4eac7f249c0ec757f5b98",
                "filename": "app/javascript/dashboard/components/widgets/WootWriter/ReplyBottomPanel.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2FWootWriter%2FReplyBottomPanel.vue",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2FWootWriter%2FReplyBottomPanel.vue",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2FWootWriter%2FReplyBottomPanel.vue?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -11,10 +11,11 @@\n         @click=\"toggleEmojiPicker\"\n       />\n \n+      <!-- ensure the same validations for attachment types are implemented in  backend models as well -->\n       <file-upload\n         ref=\"upload\"\n         :size=\"4096 * 4096\"\n-        accept=\"image/*, application/pdf, audio/mpeg, video/mp4, audio/ogg, text/csv\"\n+        accept=\"image/png, image/jpeg, image/gif, image/bmp, image/tiff, application/pdf, audio/mpeg, video/mp4, audio/ogg, text/csv\"\n         :drop=\"true\"\n         :drop-directory=\"false\"\n         @input-file=\"onFileUpload\""
            },
            {
                "sha": "705d15ad85f0b83b6481dcb6aa2293a9371fb581",
                "filename": "app/javascript/dashboard/components/widgets/forms/AvatarUploader.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2Fforms%2FAvatarUploader.vue",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2Fforms%2FAvatarUploader.vue",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2Fforms%2FAvatarUploader.vue?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -20,12 +20,13 @@\n         id=\"file\"\n         ref=\"file\"\n         type=\"file\"\n-        accept=\"image/*\"\n+        accept=\"image/png, image/jpeg, image/gif\"\n         @change=\"handleImageUpload\"\n       />\n       <slot></slot>\n     </label>\n   </div>\n+\n </template>\n \n <script>"
            },
            {
                "sha": "cb1f21e33c37c8e7152ffa89710c705d7c1f5343",
                "filename": "app/models/attachment.rb",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fattachment.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fattachment.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fmodels%2Fattachment.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -20,6 +20,7 @@ class Attachment < ApplicationRecord\n   belongs_to :account\n   belongs_to :message\n   has_one_attached :file\n+  validate :acceptable_file\n \n   enum file_type: [:image, :audio, :video, :file, :location, :fallback]\n \n@@ -76,4 +77,22 @@ def base_data\n       account_id: account_id\n     }\n   end\n+\n+  def should_validate_file?\n+    return unless file.attached?\n+    # we are only limiting attachment types in case of website widget\n+    return unless message.inbox.channel_type == 'Channel::WebWidget'\n+\n+    true\n+  end\n+\n+  def acceptable_file\n+    should_validate_file?\n+\n+    errors.add(:file, 'is too big') if file.byte_size > 40.megabytes\n+\n+    acceptable_types = ['image/png', 'image/jpeg', 'image/gif', 'image/bmp', 'image/tiff', 'application/pdf', 'audio/mpeg', 'video/mp4', 'audio/ogg',\n+                        'text/csv'].freeze\n+    errors.add(:file, 'filetype not supported') unless acceptable_types.include?(file.content_type)\n+  end\n end"
            },
            {
                "sha": "d5bcb862df570534dcc7288fea159ff05be84175",
                "filename": "app/models/concerns/avatarable.rb",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fconcerns%2Favatarable.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fconcerns%2Favatarable.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fmodels%2Fconcerns%2Favatarable.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -6,6 +6,7 @@ module Avatarable\n \n   included do\n     has_one_attached :avatar\n+    validate :acceptable_avatar\n   end\n \n   def avatar_url\n@@ -18,4 +19,13 @@ def avatar_url\n \n     ''\n   end\n+\n+  def acceptable_avatar\n+    return unless avatar.attached?\n+\n+    errors.add(:avatar, 'is too big') if avatar.byte_size > 15.megabytes\n+\n+    acceptable_types = ['image/jpeg', 'image/png', 'image/gif'].freeze\n+    errors.add(:avatar, 'filetype not supported') unless acceptable_types.include?(avatar.content_type)\n+  end\n end"
            },
            {
                "sha": "f222bd7bac9f6166d7143b6aa37d6aa227650b0b",
                "filename": "config/initializers/devise_token_auth.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/config%2Finitializers%2Fdevise_token_auth.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/config%2Finitializers%2Fdevise_token_auth.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/config%2Finitializers%2Fdevise_token_auth.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -9,6 +9,10 @@\n   # determines how long tokens will remain valid after they are issued.\n   config.token_lifespan = 2.months\n \n+  # By default, old tokens are not invalidated when password is changed.\n+  # Enable this option if you want to make passwords updates to logout other devices.\n+  config.remove_tokens_after_password_reset = true\n+\n   # Sets the max number of concurrent devices per user, which is 10 by default.\n   # After this limit is reached, the oldest tokens will be removed.\n   # config.max_number_of_devices = 10"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/chatwoot/chatwoot/commits/6fdd4a29969be8423f31890b807d27d13627c50c",
        "url": "https://api.github.com/repos/chatwoot/chatwoot/commits/6fdd4a29969be8423f31890b807d27d13627c50c",
        "html_url": "https://github.com/chatwoot/chatwoot/commit/6fdd4a29969be8423f31890b807d27d13627c50c",
        "message": "chore: Security Improvements to the API (#2893)\n\n- Devise auth tokens are reset on password update\r\n- Avatar attachment file type is limited to jpeg,gif and png\r\n- Avatar attachment file size is limited to 15 mb\r\n- Widget Message attachments are limited to types ['image/png', 'image/jpeg', 'image/gif', 'image/bmp', 'image/tiff', 'application/pdf', 'audio/mpeg', 'video/mp4', 'audio/ogg', 'text/csv']\r\n- Widget Message attachments are limited to 40Mb size limit.",
        "files": [
            {
                "sha": "b6ae5409d90b53aff8205a216f4a28843eaf67db",
                "filename": "app/builders/messages/message_builder.rb",
                "status": "modified",
                "additions": 14,
                "deletions": 10,
                "changes": 24,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fbuilders%2Fmessages%2Fmessage_builder.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fbuilders%2Fmessages%2Fmessage_builder.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fbuilders%2Fmessages%2Fmessage_builder.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -15,21 +15,25 @@ def initialize(user, conversation, params)\n \n   def perform\n     @message = @conversation.messages.build(message_params)\n-    if @attachments.present?\n-      @attachments.each do |uploaded_attachment|\n-        attachment = @message.attachments.new(\n-          account_id: @message.account_id,\n-          file_type: file_type(uploaded_attachment&.content_type)\n-        )\n-        attachment.file.attach(uploaded_attachment)\n-      end\n-    end\n-    @message.save\n+    process_attachments\n+    @message.save!\n     @message\n   end\n \n   private\n \n+  def process_attachments\n+    return if @attachments.blank?\n+\n+    @attachments.each do |uploaded_attachment|\n+      @message.attachments.build(\n+        account_id: @message.account_id,\n+        file_type: file_type(uploaded_attachment&.content_type),\n+        file: uploaded_attachment\n+      )\n+    end\n+  end\n+\n   def message_type\n     if @conversation.inbox.channel_type != 'Channel::Api' && @message_type == 'incoming'\n       raise StandardError, 'Incoming messages are only allowed in Api inboxes'"
            },
            {
                "sha": "0d9ab6323077d8a2885ab955d4d3a1130a866fbd",
                "filename": "app/controllers/api/v1/widget/messages_controller.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fapi%2Fv1%2Fwidget%2Fmessages_controller.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fapi%2Fv1%2Fwidget%2Fmessages_controller.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fcontrollers%2Fapi%2Fv1%2Fwidget%2Fmessages_controller.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -8,8 +8,8 @@ def index\n \n   def create\n     @message = conversation.messages.new(message_params)\n-    @message.save\n     build_attachment\n+    @message.save!\n   end\n \n   def update\n@@ -29,13 +29,12 @@ def build_attachment\n     return if params[:message][:attachments].blank?\n \n     params[:message][:attachments].each do |uploaded_attachment|\n-      attachment = @message.attachments.new(\n+      @message.attachments.new(\n         account_id: @message.account_id,\n-        file_type: helpers.file_type(uploaded_attachment&.content_type)\n+        file_type: helpers.file_type(uploaded_attachment&.content_type),\n+        file: uploaded_attachment\n       )\n-      attachment.file.attach(uploaded_attachment)\n     end\n-    @message.save!\n   end\n \n   def set_conversation"
            },
            {
                "sha": "925c16d3843369b912bee73f3aa7abfbbb6d0e34",
                "filename": "app/controllers/public/api/v1/inboxes/messages_controller.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fpublic%2Fapi%2Fv1%2Finboxes%2Fmessages_controller.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fcontrollers%2Fpublic%2Fapi%2Fv1%2Finboxes%2Fmessages_controller.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fcontrollers%2Fpublic%2Fapi%2Fv1%2Finboxes%2Fmessages_controller.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -7,8 +7,8 @@ def index\n \n   def create\n     @message = @conversation.messages.new(message_params)\n-    @message.save\n     build_attachment\n+    @message.save!\n   end\n \n   def update\n@@ -23,13 +23,12 @@ def build_attachment\n     return if params[:attachments].blank?\n \n     params[:attachments].each do |uploaded_attachment|\n-      attachment = @message.attachments.new(\n+      @message.attachments.new(\n         account_id: @message.account_id,\n-        file_type: helpers.file_type(uploaded_attachment&.content_type)\n+        file_type: helpers.file_type(uploaded_attachment&.content_type),\n+        file: uploaded_attachment\n       )\n-      attachment.file.attach(uploaded_attachment)\n     end\n-    @message.save!\n   end\n \n   def message_finder_params"
            },
            {
                "sha": "64d67701a0d2b352bdb0b4c3a585ebe74b12fe0f",
                "filename": "app/helpers/file_type_helper.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fhelpers%2Ffile_type_helper.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fhelpers%2Ffile_type_helper.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fhelpers%2Ffile_type_helper.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -3,12 +3,12 @@ def file_type(content_type)\n     return :image if [\n       'image/jpeg',\n       'image/png',\n-      'image/svg+xml',\n       'image/gif',\n       'image/tiff',\n       'image/bmp'\n     ].include?(content_type)\n \n+    return :video if content_type.include?('video/')\n     return :audio if content_type.include?('audio/')\n \n     :file"
            },
            {
                "sha": "1ffc9be6538c2c14cab4eac7f249c0ec757f5b98",
                "filename": "app/javascript/dashboard/components/widgets/WootWriter/ReplyBottomPanel.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2FWootWriter%2FReplyBottomPanel.vue",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2FWootWriter%2FReplyBottomPanel.vue",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2FWootWriter%2FReplyBottomPanel.vue?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -11,10 +11,11 @@\n         @click=\"toggleEmojiPicker\"\n       />\n \n+      <!-- ensure the same validations for attachment types are implemented in  backend models as well -->\n       <file-upload\n         ref=\"upload\"\n         :size=\"4096 * 4096\"\n-        accept=\"image/*, application/pdf, audio/mpeg, video/mp4, audio/ogg, text/csv\"\n+        accept=\"image/png, image/jpeg, image/gif, image/bmp, image/tiff, application/pdf, audio/mpeg, video/mp4, audio/ogg, text/csv\"\n         :drop=\"true\"\n         :drop-directory=\"false\"\n         @input-file=\"onFileUpload\""
            },
            {
                "sha": "705d15ad85f0b83b6481dcb6aa2293a9371fb581",
                "filename": "app/javascript/dashboard/components/widgets/forms/AvatarUploader.vue",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2Fforms%2FAvatarUploader.vue",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2Fforms%2FAvatarUploader.vue",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fjavascript%2Fdashboard%2Fcomponents%2Fwidgets%2Fforms%2FAvatarUploader.vue?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -20,12 +20,13 @@\n         id=\"file\"\n         ref=\"file\"\n         type=\"file\"\n-        accept=\"image/*\"\n+        accept=\"image/png, image/jpeg, image/gif\"\n         @change=\"handleImageUpload\"\n       />\n       <slot></slot>\n     </label>\n   </div>\n+\n </template>\n \n <script>"
            },
            {
                "sha": "cb1f21e33c37c8e7152ffa89710c705d7c1f5343",
                "filename": "app/models/attachment.rb",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fattachment.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fattachment.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fmodels%2Fattachment.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -20,6 +20,7 @@ class Attachment < ApplicationRecord\n   belongs_to :account\n   belongs_to :message\n   has_one_attached :file\n+  validate :acceptable_file\n \n   enum file_type: [:image, :audio, :video, :file, :location, :fallback]\n \n@@ -76,4 +77,22 @@ def base_data\n       account_id: account_id\n     }\n   end\n+\n+  def should_validate_file?\n+    return unless file.attached?\n+    # we are only limiting attachment types in case of website widget\n+    return unless message.inbox.channel_type == 'Channel::WebWidget'\n+\n+    true\n+  end\n+\n+  def acceptable_file\n+    should_validate_file?\n+\n+    errors.add(:file, 'is too big') if file.byte_size > 40.megabytes\n+\n+    acceptable_types = ['image/png', 'image/jpeg', 'image/gif', 'image/bmp', 'image/tiff', 'application/pdf', 'audio/mpeg', 'video/mp4', 'audio/ogg',\n+                        'text/csv'].freeze\n+    errors.add(:file, 'filetype not supported') unless acceptable_types.include?(file.content_type)\n+  end\n end"
            },
            {
                "sha": "d5bcb862df570534dcc7288fea159ff05be84175",
                "filename": "app/models/concerns/avatarable.rb",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fconcerns%2Favatarable.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/app%2Fmodels%2Fconcerns%2Favatarable.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/app%2Fmodels%2Fconcerns%2Favatarable.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -6,6 +6,7 @@ module Avatarable\n \n   included do\n     has_one_attached :avatar\n+    validate :acceptable_avatar\n   end\n \n   def avatar_url\n@@ -18,4 +19,13 @@ def avatar_url\n \n     ''\n   end\n+\n+  def acceptable_avatar\n+    return unless avatar.attached?\n+\n+    errors.add(:avatar, 'is too big') if avatar.byte_size > 15.megabytes\n+\n+    acceptable_types = ['image/jpeg', 'image/png', 'image/gif'].freeze\n+    errors.add(:avatar, 'filetype not supported') unless acceptable_types.include?(avatar.content_type)\n+  end\n end"
            },
            {
                "sha": "f222bd7bac9f6166d7143b6aa37d6aa227650b0b",
                "filename": "config/initializers/devise_token_auth.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/chatwoot/chatwoot/blob/6fdd4a29969be8423f31890b807d27d13627c50c/config%2Finitializers%2Fdevise_token_auth.rb",
                "raw_url": "https://github.com/chatwoot/chatwoot/raw/6fdd4a29969be8423f31890b807d27d13627c50c/config%2Finitializers%2Fdevise_token_auth.rb",
                "contents_url": "https://api.github.com/repos/chatwoot/chatwoot/contents/config%2Finitializers%2Fdevise_token_auth.rb?ref=6fdd4a29969be8423f31890b807d27d13627c50c",
                "patch": "@@ -9,6 +9,10 @@\n   # determines how long tokens will remain valid after they are issued.\n   config.token_lifespan = 2.months\n \n+  # By default, old tokens are not invalidated when password is changed.\n+  # Enable this option if you want to make passwords updates to logout other devices.\n+  config.remove_tokens_after_password_reset = true\n+\n   # Sets the max number of concurrent devices per user, which is 10 by default.\n   # After this limit is reached, the oldest tokens will be removed.\n   # config.max_number_of_devices = 10"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/unclebob/fitnesse/commits/850c599e5177d6f877af063374086f3e36b4b956",
        "url": "https://api.github.com/repos/unclebob/fitnesse/commits/850c599e5177d6f877af063374086f3e36b4b956",
        "html_url": "https://github.com/unclebob/fitnesse/commit/850c599e5177d6f877af063374086f3e36b4b956",
        "message": "Fix file traversal issue\n\nFixes #1539",
        "files": [
            {
                "sha": "e10509402b99917c6aa39257bd4cbe6c63d58e1e",
                "filename": "src/fitnesse/responders/testHistory/HistoryComparerResponder.java",
                "status": "modified",
                "additions": 19,
                "deletions": 4,
                "changes": 23,
                "blob_url": "https://github.com/unclebob/fitnesse/blob/850c599e5177d6f877af063374086f3e36b4b956/src%2Ffitnesse%2Fresponders%2FtestHistory%2FHistoryComparerResponder.java",
                "raw_url": "https://github.com/unclebob/fitnesse/raw/850c599e5177d6f877af063374086f3e36b4b956/src%2Ffitnesse%2Fresponders%2FtestHistory%2FHistoryComparerResponder.java",
                "contents_url": "https://api.github.com/repos/unclebob/fitnesse/contents/src%2Ffitnesse%2Fresponders%2FtestHistory%2FHistoryComparerResponder.java?ref=850c599e5177d6f877af063374086f3e36b4b956",
                "patch": "@@ -9,14 +9,17 @@\n import fitnesse.http.SimpleResponse;\n import fitnesse.reporting.history.PageHistory;\n import fitnesse.responders.ErrorResponder;\n+import fitnesse.util.StringUtils;\n import fitnesse.wiki.PageCrawler;\n import fitnesse.wiki.PageData;\n import fitnesse.wiki.PathParser;\n import fitnesse.wiki.WikiPage;\n import fitnesse.wiki.WikiPagePath;\n \n import java.io.File;\n+import java.io.IOException;\n import java.io.UnsupportedEncodingException;\n+import java.nio.file.Path;\n import java.text.ParseException;\n import java.text.SimpleDateFormat;\n import java.util.Date;\n@@ -72,8 +75,10 @@ private Response makeResponseFromComparison(FitNesseContext context,\n   }\n \n   private boolean filesExist() {\n-    return ((new File(firstFilePath)).exists())\n-        || ((new File(secondFilePath)).exists());\n+    if (StringUtils.isBlank(firstFileName) || StringUtils.isBlank(secondFileName)) {\n+      return false;\n+    }\n+    return (new File(firstFilePath)).exists() || (new File(secondFilePath)).exists();\n   }\n \n   private void initializeReponseComponents() {\n@@ -82,8 +87,18 @@ private void initializeReponseComponents() {\n   }\n \n   private String composeFileName(Request request, String fileName) {\n-    return context.getTestHistoryDirectory().getPath() + File.separator\n-        + request.getResource() + File.separator + fileName;\n+    try {\n+      String basePath = context.getTestHistoryDirectory().getPath();\n+      String absoluteBase = new File(basePath).getCanonicalPath() + File.separator;\n+      Path filePath = Path.of(basePath, request.getResource(), fileName);\n+      String absoluteFile = filePath.toFile().getCanonicalPath();\n+      if (absoluteFile.startsWith(absoluteBase)) {\n+        return filePath.toString();\n+      }\n+    } catch (IOException e) {\n+      // ignore we will just return empty string\n+    }\n+    return \"\";\n   }\n \n   private boolean getFileNameFromRequest(Request request) {"
            },
            {
                "sha": "c71246af6ad179b932dc9672a9c2162cab29aa15",
                "filename": "test/fitnesse/responders/testHistory/HistoryComparerResponderTest.java",
                "status": "modified",
                "additions": 32,
                "deletions": 14,
                "changes": 46,
                "blob_url": "https://github.com/unclebob/fitnesse/blob/850c599e5177d6f877af063374086f3e36b4b956/test%2Ffitnesse%2Fresponders%2FtestHistory%2FHistoryComparerResponderTest.java",
                "raw_url": "https://github.com/unclebob/fitnesse/raw/850c599e5177d6f877af063374086f3e36b4b956/test%2Ffitnesse%2Fresponders%2FtestHistory%2FHistoryComparerResponderTest.java",
                "contents_url": "https://api.github.com/repos/unclebob/fitnesse/contents/test%2Ffitnesse%2Fresponders%2FtestHistory%2FHistoryComparerResponderTest.java?ref=850c599e5177d6f877af063374086f3e36b4b956",
                "patch": "@@ -1,24 +1,25 @@\n package fitnesse.responders.testHistory;\n \n-import static org.junit.Assert.assertEquals;\n-import static org.mockito.Mockito.mock;\n-import static org.mockito.Mockito.verify;\n-import static org.mockito.Mockito.when;\n-import static util.RegexTestCase.assertHasRegexp;\n+import fitnesse.FitNesseContext;\n+import fitnesse.http.MockRequest;\n+import fitnesse.http.SimpleResponse;\n+import fitnesse.testutil.FitNesseUtil;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import util.FileUtil;\n \n import java.io.File;\n import java.io.IOException;\n import java.util.ArrayList;\n \n-import org.junit.After;\n-import org.junit.Before;\n-import org.junit.Test;\n-\n-import util.FileUtil;\n-import fitnesse.FitNesseContext;\n-import fitnesse.http.MockRequest;\n-import fitnesse.http.SimpleResponse;\n-import fitnesse.testutil.FitNesseUtil;\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.ArgumentMatchers.anyString;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.never;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+import static util.RegexTestCase.assertHasRegexp;\n \n public class HistoryComparerResponderTest {\n   public HistoryComparerResponder responder;\n@@ -96,11 +97,26 @@ public void shouldReturnErrorPageIfFilesAreInvalid() throws Exception {\n     request.addInput(\"TestResult_firstFile\", \"\");\n     request.addInput(\"TestResult_secondFile\", \"\");\n     request.setResource(\"TestFolder\");\n+    SimpleResponse response = (SimpleResponse) responder.makeResponse(context,\n+      request);\n+    assertEquals(400, response.getStatus());\n+    assertHasRegexp(\"Compare Failed because the files were not found.\",\n+      response.getContent());\n+    verify(mockedComparer, never()).compare(anyString(), anyString());\n+  }\n+\n+  @Test\n+  public void shouldReturnErrorPageIfFilesAreNotInTestHistory() throws Exception {\n+    request = new MockRequest();\n+    request.addInput(\"TestResult_../../../../../../../../../etc/passwd\", \"\");\n+    request.addInput(\"TestResult_../../../../../../../../../../etc/passwd\", \"\");\n+    request.setResource(\"TestFolder\");\n     SimpleResponse response = (SimpleResponse) responder.makeResponse(context,\n         request);\n     assertEquals(400, response.getStatus());\n     assertHasRegexp(\"Compare Failed because the files were not found.\",\n         response.getContent());\n+    verify(mockedComparer, never()).compare(anyString(), anyString());\n   }\n \n   @Test\n@@ -115,6 +131,7 @@ public void shouldReturnErrorPageIfThereAreTooFewInputFiles()\n     assertHasRegexp(\n         \"Compare Failed because the wrong number of Input Files were given. Select two please.\",\n         response.getContent());\n+    verify(mockedComparer, never()).compare(anyString(), anyString());\n   }\n \n   @Test\n@@ -127,6 +144,7 @@ public void shouldReturnErrorPageIfThereAreTooManyInputFiles()\n     assertHasRegexp(\n         \"Compare Failed because the wrong number of Input Files were given. Select two please.\",\n         response.getContent());\n+    verify(mockedComparer, never()).compare(anyString(), anyString());\n   }\n \n   @Test"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mz-automation/libiec61850/commits/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
        "url": "https://api.github.com/repos/mz-automation/libiec61850/commits/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
        "html_url": "https://github.com/mz-automation/libiec61850/commit/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
        "message": "- replaced unsafe function StringUtils_createStringFromBufferInBuffer with function with length check to not exceed target buffer (LIB61850-447)",
        "files": [
            {
                "sha": "c537d7e8678ae9330e88646989fc767fd438f902",
                "filename": "src/common/inc/string_utilities.h",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/mz-automation/libiec61850/blob/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fcommon%2Finc%2Fstring_utilities.h",
                "raw_url": "https://github.com/mz-automation/libiec61850/raw/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fcommon%2Finc%2Fstring_utilities.h",
                "contents_url": "https://api.github.com/repos/mz-automation/libiec61850/contents/src%2Fcommon%2Finc%2Fstring_utilities.h?ref=1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
                "patch": "@@ -76,6 +76,9 @@ StringUtils_createStringFromBuffer(const uint8_t* buf, int size);\n LIB61850_INTERNAL char*\n StringUtils_createStringFromBufferInBuffer(char* newString, const uint8_t* buf, int size);\n \n+LIB61850_INTERNAL char*\n+StringUtils_createStringFromBufferInBufferMax(char* newString, const uint8_t* buf, int size, int maxBufSize);\n+\n LIB61850_INTERNAL void\n StringUtils_replace(char* string, char oldChar, char newChar);\n "
            },
            {
                "sha": "aa4474584f60219bedd560ec17195dac47adfd3a",
                "filename": "src/common/string_utilities.c",
                "status": "modified",
                "additions": 12,
                "deletions": 0,
                "changes": 12,
                "blob_url": "https://github.com/mz-automation/libiec61850/blob/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fcommon%2Fstring_utilities.c",
                "raw_url": "https://github.com/mz-automation/libiec61850/raw/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fcommon%2Fstring_utilities.c",
                "contents_url": "https://api.github.com/repos/mz-automation/libiec61850/contents/src%2Fcommon%2Fstring_utilities.c?ref=1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
                "patch": "@@ -109,6 +109,18 @@ StringUtils_createStringFromBufferInBuffer(char* newString, const uint8_t* buf,\n     return newString;\n }\n \n+char*\n+StringUtils_createStringFromBufferInBufferMax(char* newString, const uint8_t* buf, int size, int maxBufSize)\n+{\n+    if (size >= maxBufSize)\n+        size = maxBufSize - 1;\n+\n+    memcpy(newString, buf, size);\n+    newString[size] = 0;\n+\n+    return newString;\n+}\n+\n char*\n StringUtils_createStringInBuffer(char* newStr, int bufSize, int count, ...)\n {"
            },
            {
                "sha": "d6227ec76d34ab120c63877c1963dad9835e4677",
                "filename": "src/iec61850/server/mms_mapping/mms_mapping.c",
                "status": "modified",
                "additions": 12,
                "deletions": 10,
                "changes": 22,
                "blob_url": "https://github.com/mz-automation/libiec61850/blob/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fiec61850%2Fserver%2Fmms_mapping%2Fmms_mapping.c",
                "raw_url": "https://github.com/mz-automation/libiec61850/raw/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fiec61850%2Fserver%2Fmms_mapping%2Fmms_mapping.c",
                "contents_url": "https://api.github.com/repos/mz-automation/libiec61850/contents/src%2Fiec61850%2Fserver%2Fmms_mapping%2Fmms_mapping.c?ref=1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
                "patch": "@@ -3394,8 +3394,9 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n \n             char* separator = strchr(variableId, '$');\n \n-            if (separator) {\n-                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+            if (separator)\n+            {\n+                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                 ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3426,8 +3427,9 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n \n             char* separator = strchr(variableId, '$');\n \n-            if (separator) {\n-                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+            if (separator)\n+            {\n+                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                 ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3467,7 +3469,7 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n                     char str[65];\n                     char subObjectBuf[65];\n \n-                    StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+                    StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                     LogicalNode* ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3484,7 +3486,7 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n                             else {\n                                 doEnd--;\n \n-                                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) (doStart + 1), doEnd - doStart);\n+                                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) (doStart + 1), doEnd - doStart, sizeof(str));\n \n                                 subObjectName = StringUtils_copyStringToBufferAndReplace(doEnd + 2, subObjectBuf, '$', '.');\n                             }\n@@ -3533,7 +3535,7 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n                     char* subObjectName = NULL;\n                     char subObjectBuf[65];\n \n-                    StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+                    StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                     LogicalNode* ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3551,7 +3553,7 @@ mmsListObjectsAccessHandler(void* parameter, MmsGetNameListType listType, MmsDom\n                             else {\n                                 doEnd--;\n \n-                                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) (doStart + 1), doEnd - doStart);\n+                                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) (doStart + 1), doEnd - doStart, sizeof(str));\n \n                                 subObjectName = StringUtils_copyStringToBufferAndReplace(doEnd + 2, subObjectBuf, '$', '.');\n                             }\n@@ -3684,7 +3686,7 @@ mmsReadAccessHandler (void* parameter, MmsDomain* domain, char* variableId, MmsS\n                 {\n                     char str[65];\n \n-                    StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) variableId, separator - variableId);\n+                    StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) variableId, separator - variableId, sizeof(str));\n \n                     LogicalNode* ln = LogicalDevice_getLogicalNode(ld, str);\n \n@@ -3704,7 +3706,7 @@ mmsReadAccessHandler (void* parameter, MmsDomain* domain, char* variableId, MmsS\n                             {\n                                 doEnd--;\n \n-                                StringUtils_createStringFromBufferInBuffer(str, (uint8_t*) (doStart + 1), doEnd - doStart);\n+                                StringUtils_createStringFromBufferInBufferMax(str, (uint8_t*) (doStart + 1), doEnd - doStart, sizeof(str));\n                             }\n \n                             if (fc == IEC61850_FC_SP)"
            },
            {
                "sha": "c679a423e68041da7f42fb838c80cff521a3ae33",
                "filename": "src/mms/iso_mms/client/mms_client_identify.c",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/mz-automation/libiec61850/blob/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fmms%2Fiso_mms%2Fclient%2Fmms_client_identify.c",
                "raw_url": "https://github.com/mz-automation/libiec61850/raw/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fmms%2Fiso_mms%2Fclient%2Fmms_client_identify.c",
                "contents_url": "https://api.github.com/repos/mz-automation/libiec61850/contents/src%2Fmms%2Fiso_mms%2Fclient%2Fmms_client_identify.c?ref=1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
                "patch": "@@ -84,15 +84,15 @@ mmsClient_parseIdentifyResponse(MmsConnection self, ByteBuffer* response, uint32\n \n         switch (tag) {\n         case 0x80: /* vendorName */\n-            vendorName = StringUtils_createStringFromBufferInBuffer(vendorNameBuf, buffer + bufPos, length);\n+            vendorName = StringUtils_createStringFromBufferInBufferMax(vendorNameBuf, buffer + bufPos, length, sizeof(vendorNameBuf));\n             bufPos += length;\n             break;\n         case 0x81: /* modelName */\n-            modelName = StringUtils_createStringFromBufferInBuffer(modelNameBuf, buffer + bufPos, length);\n+            modelName = StringUtils_createStringFromBufferInBufferMax(modelNameBuf, buffer + bufPos, length, sizeof(modelNameBuf));\n             bufPos += length;\n             break;\n         case 0x82: /* revision */\n-            revision = StringUtils_createStringFromBufferInBuffer(revisionBuf, buffer + bufPos, length);\n+            revision = StringUtils_createStringFromBufferInBufferMax(revisionBuf, buffer + bufPos, length, sizeof (revisionBuf));\n             bufPos += length;\n             break;\n         case 0x83: /* list of abstract syntaxes */"
            },
            {
                "sha": "f9cdbacf5b5f8336ffe4ed03ca7b4e2bea75905d",
                "filename": "src/mms/iso_mms/server/mms_named_variable_list_service.c",
                "status": "modified",
                "additions": 20,
                "deletions": 20,
                "changes": 40,
                "blob_url": "https://github.com/mz-automation/libiec61850/blob/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fmms%2Fiso_mms%2Fserver%2Fmms_named_variable_list_service.c",
                "raw_url": "https://github.com/mz-automation/libiec61850/raw/1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0/src%2Fmms%2Fiso_mms%2Fserver%2Fmms_named_variable_list_service.c",
                "contents_url": "https://api.github.com/repos/mz-automation/libiec61850/contents/src%2Fmms%2Fiso_mms%2Fserver%2Fmms_named_variable_list_service.c?ref=1f52be9ddeae00e69cd43e4cac3cb4f0c880c4f0",
                "patch": "@@ -401,13 +401,13 @@ createNamedVariableList(MmsServer server, MmsDomain* domain, MmsDevice* device,\n \t\t\tchar variableName[65];\n \t\t\tchar domainId[65];\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(variableName,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(variableName,\n \t\t\t\t\tvarSpec->choice.name.choice.domainspecific.itemId.buf,\n-\t\t\t\t\tvarSpec->choice.name.choice.domainspecific.itemId.size);\n+\t\t\t\t\tvarSpec->choice.name.choice.domainspecific.itemId.size, sizeof(variableName));\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(domainId,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(domainId,\n \t\t\t\t\tvarSpec->choice.name.choice.domainspecific.domainId.buf,\n-\t\t\t\t\tvarSpec->choice.name.choice.domainspecific.domainId.size);\n+\t\t\t\t\tvarSpec->choice.name.choice.domainspecific.domainId.size, sizeof(domainId));\n \n \t\t\tMmsDomain* elementDomain = MmsDevice_getDomain(device, domainId);\n \n@@ -494,9 +494,9 @@ mmsServer_handleDefineNamedVariableListRequest(\n \t\t\tgoto exit_free_struct;\n \t\t}\n \n-\t\tStringUtils_createStringFromBufferInBuffer(domainName,\n+\t\tStringUtils_createStringFromBufferInBufferMax(domainName,\n \t\t\t\trequest->variableListName.choice.domainspecific.domainId.buf,\n-\t\t\t\trequest->variableListName.choice.domainspecific.domainId.size);\n+\t\t\t\trequest->variableListName.choice.domainspecific.domainId.size, sizeof(domainName));\n \n \t\tMmsDomain* domain = MmsDevice_getDomain(device, domainName);\n \n@@ -517,9 +517,9 @@ mmsServer_handleDefineNamedVariableListRequest(\n \t\t\t\tgoto exit_free_struct;\n \t\t\t}\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(variableListName,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(variableListName,\n \t\t\t\t\trequest->variableListName.choice.domainspecific.itemId.buf,\n-\t\t\t\t\trequest->variableListName.choice.domainspecific.itemId.size);\n+\t\t\t\t\trequest->variableListName.choice.domainspecific.itemId.size, sizeof(variableListName));\n \n \t\t\tif (MmsDomain_getNamedVariableList(domain, variableListName) != NULL) {\n \t\t\t\tmmsMsg_createServiceErrorPdu(invokeId, response, MMS_ERROR_DEFINITION_OBJECT_EXISTS);\n@@ -567,9 +567,9 @@ mmsServer_handleDefineNamedVariableListRequest(\n \t\t\t\tgoto exit_free_struct;\n \t\t\t}\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(variableListName,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(variableListName,\n \t\t\t\t\trequest->variableListName.choice.aaspecific.buf,\n-\t\t\t\t\trequest->variableListName.choice.aaspecific.size);\n+\t\t\t\t\trequest->variableListName.choice.aaspecific.size, sizeof(variableListName));\n \n \t\t\tif (MmsServerConnection_getNamedVariableList(connection, variableListName) != NULL) {\n \t\t\t\tmmsMsg_createServiceErrorPdu(invokeId, response, MMS_ERROR_DEFINITION_OBJECT_EXISTS);\n@@ -611,9 +611,9 @@ mmsServer_handleDefineNamedVariableListRequest(\n \t\t\t\tgoto exit_free_struct;\n \t\t\t}\n \n-\t\t\tStringUtils_createStringFromBufferInBuffer(variableListName,\n+\t\t\tStringUtils_createStringFromBufferInBufferMax(variableListName,\n \t\t\t\t\trequest->variableListName.choice.vmdspecific.buf,\n-\t\t\t\t\trequest->variableListName.choice.vmdspecific.size);\n+\t\t\t\t\trequest->variableListName.choice.vmdspecific.size, sizeof(variableListName));\n \n \t\t\tif (mmsServer_getNamedVariableListWithName(MmsDevice_getNamedVariableLists(connection->server->device), variableListName) != NULL) {\n \t\t\t\tmmsMsg_createServiceErrorPdu(invokeId, response, MMS_ERROR_DEFINITION_OBJECT_EXISTS);\n@@ -758,11 +758,11 @@ mmsServer_handleGetNamedVariableListAttributesRequest(\n \t\t\tgoto exit_function;\n \t\t}\n \n-\t\tStringUtils_createStringFromBufferInBuffer(domainName, request->choice.domainspecific.domainId.buf,\n-\t\t\t\trequest->choice.domainspecific.domainId.size);\n+\t\tStringUtils_createStringFromBufferInBufferMax(domainName, request->choice.domainspecific.domainId.buf,\n+\t\t\t\trequest->choice.domainspecific.domainId.size, sizeof(domainName));\n \n-\t\tStringUtils_createStringFromBufferInBuffer(itemName, request->choice.domainspecific.itemId.buf,\n-\t\t\t\trequest->choice.domainspecific.itemId.size);\n+\t\tStringUtils_createStringFromBufferInBufferMax(itemName, request->choice.domainspecific.itemId.buf,\n+\t\t\t\trequest->choice.domainspecific.itemId.size, sizeof(itemName));\n \n \t\tMmsDevice* mmsDevice = MmsServer_getDevice(connection->server);\n \n@@ -809,8 +809,8 @@ mmsServer_handleGetNamedVariableListAttributesRequest(\n \t\t\tgoto exit_function;\n \t\t}\n \n-\t\tStringUtils_createStringFromBufferInBuffer(listName, request->choice.aaspecific.buf,\n-\t\t\t\trequest->choice.aaspecific.size);\n+\t\tStringUtils_createStringFromBufferInBufferMax(listName, request->choice.aaspecific.buf,\n+\t\t\t\trequest->choice.aaspecific.size, sizeof(listName));\n \n \t\tMmsNamedVariableList varList = MmsServerConnection_getNamedVariableList(connection, listName);\n \n@@ -847,8 +847,8 @@ mmsServer_handleGetNamedVariableListAttributesRequest(\n \t\t\tgoto exit_function;\n \t\t}\n \n-\t\tStringUtils_createStringFromBufferInBuffer(listName, request->choice.vmdspecific.buf,\n-\t\t\t\trequest->choice.vmdspecific.size);\n+\t\tStringUtils_createStringFromBufferInBufferMax(listName, request->choice.vmdspecific.buf,\n+\t\t\t\trequest->choice.vmdspecific.size, sizeof(listName));\n \n \t\tMmsDevice* mmsDevice = MmsServer_getDevice(connection->server);\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mz-automation/libiec61850/commits/7afa40390b26ad1f4cf93deaa0052fe7e357ef33",
        "url": "https://api.github.com/repos/mz-automation/libiec61850/commits/7afa40390b26ad1f4cf93deaa0052fe7e357ef33",
        "html_url": "https://github.com/mz-automation/libiec61850/commit/7afa40390b26ad1f4cf93deaa0052fe7e357ef33",
        "message": "- ACSE: added check for minimum message size (LIB61850-438)",
        "files": [
            {
                "sha": "40ecafe046543bcdf7fece4dad018eb63fd0cb07",
                "filename": "src/mms/iso_acse/acse.c",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/mz-automation/libiec61850/blob/7afa40390b26ad1f4cf93deaa0052fe7e357ef33/src%2Fmms%2Fiso_acse%2Facse.c",
                "raw_url": "https://github.com/mz-automation/libiec61850/raw/7afa40390b26ad1f4cf93deaa0052fe7e357ef33/src%2Fmms%2Fiso_acse%2Facse.c",
                "contents_url": "https://api.github.com/repos/mz-automation/libiec61850/contents/src%2Fmms%2Fiso_acse%2Facse.c?ref=7afa40390b26ad1f4cf93deaa0052fe7e357ef33",
                "patch": "@@ -420,6 +420,14 @@ AcseConnection_parseMessage(AcseConnection* self, ByteBuffer* message)\n {\n     AcseIndication indication = ACSE_ERROR;\n \n+    if (message == NULL || message->size < 1)\n+    {\n+        if (DEBUG_ACSE)\n+            printf(\"ACSE: invalid message - no payload\\n\");\n+\n+        return ACSE_ERROR;\n+    }\n+\n     uint8_t* buffer = message->buffer;\n \n     int messageSize = message->size;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mz-automation/libiec61850/commits/ac925fae8e281ac6defcd630e9dd756264e9c5bc",
        "url": "https://api.github.com/repos/mz-automation/libiec61850/commits/ac925fae8e281ac6defcd630e9dd756264e9c5bc",
        "html_url": "https://github.com/mz-automation/libiec61850/commit/ac925fae8e281ac6defcd630e9dd756264e9c5bc",
        "message": "- fixed potential buffer overflows in MMS client file service handling (LIB61850-449)",
        "files": [
            {
                "sha": "0d8d5006973cf4495567f355c61e775ffa06d833",
                "filename": "src/mms/iso_mms/client/mms_client_files.c",
                "status": "modified",
                "additions": 19,
                "deletions": 4,
                "changes": 23,
                "blob_url": "https://github.com/mz-automation/libiec61850/blob/ac925fae8e281ac6defcd630e9dd756264e9c5bc/src%2Fmms%2Fiso_mms%2Fclient%2Fmms_client_files.c",
                "raw_url": "https://github.com/mz-automation/libiec61850/raw/ac925fae8e281ac6defcd630e9dd756264e9c5bc/src%2Fmms%2Fiso_mms%2Fclient%2Fmms_client_files.c",
                "contents_url": "https://api.github.com/repos/mz-automation/libiec61850/contents/src%2Fmms%2Fiso_mms%2Fclient%2Fmms_client_files.c?ref=ac925fae8e281ac6defcd630e9dd756264e9c5bc",
                "patch": "@@ -484,8 +484,13 @@ parseFileAttributes(uint8_t* buffer, int bufPos, int maxBufPos, uint32_t* fileSi\n             break;\n         case 0x81: /* lastModified */\n             {\n-                if (lastModified != NULL) {\n+                if (lastModified != NULL)\n+                {\n                     char gtString[40];\n+\n+                    if (length > sizeof(gtString) - 1)\n+                        return false; /* lastModified string too long */\n+\n                     memcpy(gtString, buffer + bufPos, length);\n                     gtString[length] = 0;\n                     *lastModified = Conversions_generalizedTimeToMsTime(gtString);\n@@ -512,12 +517,14 @@ parseDirectoryEntry(uint8_t* buffer, int bufPos, int maxBufPos, uint32_t invokeI\n     uint32_t fileSize = 0;\n     uint64_t lastModified = 0;\n \n-    while (bufPos < maxBufPos) {\n+    while (bufPos < maxBufPos)\n+    {\n         uint8_t tag = buffer[bufPos++];\n         int length;\n \n         bufPos = BerDecoder_decodeLength(buffer, &length, bufPos, maxBufPos);\n-        if (bufPos < 0) {\n+        if (bufPos < 0)\n+        {\n             if (DEBUG_MMS_CLIENT)\n                 printf(\"MMS_CLIENT: invalid length field\\n\");\n             return false;\n@@ -531,12 +538,20 @@ parseDirectoryEntry(uint8_t* buffer, int bufPos, int maxBufPos, uint32_t invokeI\n             tag = buffer[bufPos++];\n \n             bufPos = BerDecoder_decodeLength(buffer, &length, bufPos, maxBufPos);\n-            if (bufPos < 0) {\n+            if (bufPos < 0)\n+            {\n                 if (DEBUG_MMS_CLIENT)\n                     printf(\"MMS_CLIENT: invalid length field\\n\");\n                 return false;\n             }\n \n+            if (length > (sizeof(fileNameMemory) - 1))\n+            {\n+                if (DEBUG_MMS_CLIENT)\n+                    printf(\"MMS_CLIENT: filename too long\\n\");\n+                return false;\n+            }\n+\n             memcpy(filename, buffer + bufPos, length);\n             filename[length] = 0;\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/parisneo/lollms-webui/commits/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e",
        "url": "https://api.github.com/repos/ParisNeo/lollms-webui/commits/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e",
        "html_url": "https://github.com/ParisNeo/lollms-webui/commit/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e",
        "message": "sync",
        "files": [
            {
                "sha": "2b4f4cf7f6bcf6e9b859d7b097d1595c921aaedb",
                "filename": "lollms_core",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": null,
                "raw_url": null,
                "contents_url": "https://api.github.com/repos/ParisNeo/lollms-webui/contents/lollms_core?ref=9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e",
                "patch": "@@ -1 +1 @@\n-Subproject commit 45cc5e39b9d207b682310637089617a8b5c05b31\n+Subproject commit 2b4f4cf7f6bcf6e9b859d7b097d1595c921aaedb"
            },
            {
                "sha": "78890a2a117620ff27cfcf38e8f94a5cacd846b5",
                "filename": "web/dist/assets/index-08a9f7b7.css",
                "status": "renamed",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/ParisNeo/lollms-webui/blob/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e/web%2Fdist%2Fassets%2Findex-08a9f7b7.css",
                "raw_url": "https://github.com/ParisNeo/lollms-webui/raw/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e/web%2Fdist%2Fassets%2Findex-08a9f7b7.css",
                "contents_url": "https://api.github.com/repos/ParisNeo/lollms-webui/contents/web%2Fdist%2Fassets%2Findex-08a9f7b7.css?ref=9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e",
                "previous_filename": "web/dist/assets/index-f34702e1.css"
            },
            {
                "sha": "c8ec80d4283c135137292173d1aa5b6b54a2e3fd",
                "filename": "web/dist/assets/index-50d6fa6f.js",
                "status": "renamed",
                "additions": 158,
                "deletions": 158,
                "changes": 316,
                "blob_url": "https://github.com/ParisNeo/lollms-webui/blob/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e/web%2Fdist%2Fassets%2Findex-50d6fa6f.js",
                "raw_url": "https://github.com/ParisNeo/lollms-webui/raw/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e/web%2Fdist%2Fassets%2Findex-50d6fa6f.js",
                "contents_url": "https://api.github.com/repos/ParisNeo/lollms-webui/contents/web%2Fdist%2Fassets%2Findex-50d6fa6f.js?ref=9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e",
                "previous_filename": "web/dist/assets/index-72c42fda.js"
            },
            {
                "sha": "25abbba1ca0f193a9225ab8a43294261af7789fa",
                "filename": "web/dist/index.html",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/ParisNeo/lollms-webui/blob/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e/web%2Fdist%2Findex.html",
                "raw_url": "https://github.com/ParisNeo/lollms-webui/raw/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e/web%2Fdist%2Findex.html",
                "contents_url": "https://api.github.com/repos/ParisNeo/lollms-webui/contents/web%2Fdist%2Findex.html?ref=9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e",
                "patch": "@@ -6,8 +6,8 @@\n     \n     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n     <title>LoLLMS WebUI - Welcome</title>\n-    <script type=\"module\" crossorigin src=\"/assets/index-72c42fda.js\"></script>\n-    <link rel=\"stylesheet\" href=\"/assets/index-f34702e1.css\">\n+    <script type=\"module\" crossorigin src=\"/assets/index-50d6fa6f.js\"></script>\n+    <link rel=\"stylesheet\" href=\"/assets/index-08a9f7b7.css\">\n   </head>\n   <body>\n     <div id=\"app\"></div>"
            },
            {
                "sha": "631db113b78b7a258d9183554b37ef79751155ed",
                "filename": "web/src/views/SettingsView.vue",
                "status": "modified",
                "additions": 18,
                "deletions": 2,
                "changes": 20,
                "blob_url": "https://github.com/ParisNeo/lollms-webui/blob/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e/web%2Fsrc%2Fviews%2FSettingsView.vue",
                "raw_url": "https://github.com/ParisNeo/lollms-webui/raw/9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e/web%2Fsrc%2Fviews%2FSettingsView.vue",
                "contents_url": "https://api.github.com/repos/ParisNeo/lollms-webui/contents/web%2Fsrc%2Fviews%2FSettingsView.vue?ref=9b0f6c4ad1b9a2cd3466dcefaa278df30feed67e",
                "patch": "@@ -5733,8 +5733,24 @@ export default {\n         console.log(\"Constructing\")\n         this.load_everything()\n         this.getSeviceVoices()\n-        this.snd_input_devices = await axios.get(\"/get_snd_input_devices\")\n-        this.snd_output_devices = await axios.get(\"/get_snd_output_devices\")\n+        try{\n+            console.log(\"Loading input devices list\")\n+            const response = await axios.get(\"/get_snd_input_devices\")\n+            console.log(\"response:\", response)\n+            console.log(\"response data : \", response.data)\n+            this.snd_input_devices = response.data[\"device_names\"]\n+        }\n+        catch{\n+            console.log(\"Couldin't list input devices\")\n+        }\n+        try{\n+            console.log(\"Loading output devices list\")\n+            this.snd_output_devices = await axios.get(\"/get_snd_output_devices\").data[\"device_names\"]\n+        }\n+        catch{\n+            console.log(\"Couldin't list output devices\")\n+        }\n+        \n \n     },\n     activated() {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/zenml-io/zenml/commits/87a6c2c8f45b49ea83fbb5fe8fff7ab5365a60c9",
        "url": "https://api.github.com/repos/zenml-io/zenml/commits/87a6c2c8f45b49ea83fbb5fe8fff7ab5365a60c9",
        "html_url": "https://github.com/zenml-io/zenml/commit/87a6c2c8f45b49ea83fbb5fe8fff7ab5365a60c9",
        "message": "Add rate limiting to user password reset operations (#2643)\n\n* Add rate limiting to user password reset operations\r\n\r\n* Fix docstrings\r\n\r\n---------\r\n\r\nCo-authored-by: Alex Strick van Linschoten <strickvl@users.noreply.github.com>",
        "files": [
            {
                "sha": "afef9530015abd6f57be5787646db7e330c05537",
                "filename": "src/zenml/zen_server/rate_limit.py",
                "status": "modified",
                "additions": 23,
                "deletions": 7,
                "changes": 30,
                "blob_url": "https://github.com/zenml-io/zenml/blob/87a6c2c8f45b49ea83fbb5fe8fff7ab5365a60c9/src%2Fzenml%2Fzen_server%2Frate_limit.py",
                "raw_url": "https://github.com/zenml-io/zenml/raw/87a6c2c8f45b49ea83fbb5fe8fff7ab5365a60c9/src%2Fzenml%2Fzen_server%2Frate_limit.py",
                "contents_url": "https://api.github.com/repos/zenml-io/zenml/contents/src%2Fzenml%2Fzen_server%2Frate_limit.py?ref=87a6c2c8f45b49ea83fbb5fe8fff7ab5365a60c9",
                "patch": "@@ -16,11 +16,13 @@\n import inspect\n import time\n from collections import defaultdict\n+from contextlib import contextmanager\n from functools import wraps\n from typing import (\n     Any,\n     Callable,\n     Dict,\n+    Generator,\n     List,\n     Optional,\n     TypeVar,\n@@ -133,6 +135,25 @@ def _get_ipaddr(self, request: Request) -> str:\n \n             return request.client.host\n \n+    @contextmanager\n+    def limit_failed_requests(\n+        self, request: Request\n+    ) -> Generator[None, Any, Any]:\n+        \"\"\"Limits the number of failed requests.\n+\n+        Args:\n+            request: Request object.\n+\n+        Yields:\n+            None\n+        \"\"\"\n+        self.hit_limiter(request)\n+\n+        yield\n+\n+        # if request was successful - reset limiter\n+        self.reset_limiter(request)\n+\n \n def rate_limit_requests(\n     day_limit: Optional[int] = None,\n@@ -171,13 +192,8 @@ def decorated(\n                 request = kwargs[request_kwarg]\n             else:\n                 request = args[request_arg]\n-            limiter.hit_limiter(request)\n-\n-            ret = func(*args, **kwargs)\n-\n-            # if request was successful - reset limiter\n-            limiter.reset_limiter(request)\n-            return ret\n+            with limiter.limit_failed_requests(request):\n+                return func(*args, **kwargs)\n \n         return cast(F, decorated)\n "
            },
            {
                "sha": "a8d9130275b652a2ef6e4cfb8986efdecb380b9b",
                "filename": "src/zenml/zen_server/routers/users_endpoints.py",
                "status": "modified",
                "additions": 27,
                "deletions": 12,
                "changes": 39,
                "blob_url": "https://github.com/zenml-io/zenml/blob/87a6c2c8f45b49ea83fbb5fe8fff7ab5365a60c9/src%2Fzenml%2Fzen_server%2Frouters%2Fusers_endpoints.py",
                "raw_url": "https://github.com/zenml-io/zenml/raw/87a6c2c8f45b49ea83fbb5fe8fff7ab5365a60c9/src%2Fzenml%2Fzen_server%2Frouters%2Fusers_endpoints.py",
                "contents_url": "https://api.github.com/repos/zenml-io/zenml/contents/src%2Fzenml%2Fzen_server%2Frouters%2Fusers_endpoints.py?ref=87a6c2c8f45b49ea83fbb5fe8fff7ab5365a60c9",
                "patch": "@@ -17,6 +17,7 @@\n from uuid import UUID\n \n from fastapi import APIRouter, Depends, Security\n+from starlette.requests import Request\n \n from zenml.analytics.utils import email_opt_int\n from zenml.constants import (\n@@ -44,6 +45,7 @@\n     authorize,\n )\n from zenml.zen_server.exceptions import error_response\n+from zenml.zen_server.rate_limit import RequestLimiter\n from zenml.zen_server.rbac.endpoint_utils import (\n     verify_permissions_and_create_entity,\n )\n@@ -226,6 +228,10 @@ def get_user(\n # When the auth scheme is set to EXTERNAL, users cannot be updated via the\n # API.\n if server_config().auth_scheme != AuthScheme.EXTERNAL:\n+    pass_change_limiter = RequestLimiter(\n+        day_limit=server_config().login_rate_limit_day,\n+        minute_limit=server_config().login_rate_limit_minute,\n+    )\n \n     @router.put(\n         \"/{user_name_or_id}\",\n@@ -240,13 +246,15 @@ def get_user(\n     def update_user(\n         user_name_or_id: Union[str, UUID],\n         user_update: UserUpdate,\n+        request: Request,\n         auth_context: AuthContext = Security(authorize),\n     ) -> UserResponse:\n         \"\"\"Updates a specific user.\n \n         Args:\n             user_name_or_id: Name or ID of the user.\n             user_update: the user to use for the update.\n+            request: The request object.\n             auth_context: Authentication context.\n \n         Returns:\n@@ -283,13 +291,15 @@ def update_user(\n                     \"The current password must be supplied when changing the \"\n                     \"password.\"\n                 )\n-            auth_user = zen_store().get_auth_user(user_name_or_id)\n-            if not UserAuthModel.verify_password(\n-                user_update.old_password, auth_user\n-            ):\n-                raise IllegalOperationError(\n-                    \"The current password is incorrect.\"\n-                )\n+\n+            with pass_change_limiter.limit_failed_requests(request):\n+                auth_user = zen_store().get_auth_user(user_name_or_id)\n+                if not UserAuthModel.verify_password(\n+                    user_update.old_password, auth_user\n+                ):\n+                    raise IllegalOperationError(\n+                        \"The current password is incorrect.\"\n+                    )\n \n         if (\n             user_update.is_admin is not None\n@@ -529,12 +539,14 @@ def get_current_user(\n     @handle_exceptions\n     def update_myself(\n         user: UserUpdate,\n+        request: Request,\n         auth_context: AuthContext = Security(authorize),\n     ) -> UserResponse:\n         \"\"\"Updates a specific user.\n \n         Args:\n             user: the user to use for the update.\n+            request: The request object.\n             auth_context: The authentication context.\n \n         Returns:\n@@ -554,11 +566,14 @@ def update_myself(\n                     \"The current password must be supplied when changing the \"\n                     \"password.\"\n                 )\n-            auth_user = zen_store().get_auth_user(auth_context.user.id)\n-            if not UserAuthModel.verify_password(user.old_password, auth_user):\n-                raise IllegalOperationError(\n-                    \"The current password is incorrect.\"\n-                )\n+            with pass_change_limiter.limit_failed_requests(request):\n+                auth_user = zen_store().get_auth_user(auth_context.user.id)\n+                if not UserAuthModel.verify_password(\n+                    user.old_password, auth_user\n+                ):\n+                    raise IllegalOperationError(\n+                        \"The current password is incorrect.\"\n+                    )\n \n         user.activation_token = current_user.activation_token\n         user.active = current_user.active"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/imartinez/privategpt/commits/86368c61760c9cee5d977131d23ad2a3e063cbe9",
        "url": "https://api.github.com/repos/zylon-ai/private-gpt/commits/86368c61760c9cee5d977131d23ad2a3e063cbe9",
        "html_url": "https://github.com/zylon-ai/private-gpt/commit/86368c61760c9cee5d977131d23ad2a3e063cbe9",
        "message": "Replacing unsafe `eval()` with `json.loads()`",
        "files": [
            {
                "sha": "bd2aec18a2b3b69ebc9a26d74c38387c5e5ae17f",
                "filename": "private_gpt/components/llm/custom/sagemaker.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zylon-ai/private-gpt/blob/86368c61760c9cee5d977131d23ad2a3e063cbe9/private_gpt%2Fcomponents%2Fllm%2Fcustom%2Fsagemaker.py",
                "raw_url": "https://github.com/zylon-ai/private-gpt/raw/86368c61760c9cee5d977131d23ad2a3e063cbe9/private_gpt%2Fcomponents%2Fllm%2Fcustom%2Fsagemaker.py",
                "contents_url": "https://api.github.com/repos/zylon-ai/private-gpt/contents/private_gpt%2Fcomponents%2Fllm%2Fcustom%2Fsagemaker.py?ref=86368c61760c9cee5d977131d23ad2a3e063cbe9",
                "patch": "@@ -218,7 +218,7 @@ def complete(self, prompt: str, **kwargs: Any) -> CompletionResponse:\n \n         response_body = resp[\"Body\"]\n         response_str = response_body.read().decode(\"utf-8\")\n-        response_dict = eval(response_str)\n+        response_dict = json.loads(response_str)\n \n         return CompletionResponse(\n             text=response_dict[0][\"generated_text\"][len(prompt) :], raw=resp"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Giskard-AI/giskard/commits/48ce81f5c626171767188d6f0669498fb613b4d3",
        "url": "https://api.github.com/repos/Giskard-AI/giskard-oss/commits/48ce81f5c626171767188d6f0669498fb613b4d3",
        "html_url": "https://github.com/Giskard-AI/giskard-oss/commit/48ce81f5c626171767188d6f0669498fb613b4d3",
        "message": "Merge commit from fork\n\nFix ReDoS",
        "files": [
            {
                "sha": "1d1cb9250ca53e999fecc89c6ec0a5e45442e139",
                "filename": "giskard/functions/transformation.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/Giskard-AI/giskard-oss/blob/48ce81f5c626171767188d6f0669498fb613b4d3/giskard%2Ffunctions%2Ftransformation.py",
                "raw_url": "https://github.com/Giskard-AI/giskard-oss/raw/48ce81f5c626171767188d6f0669498fb613b4d3/giskard%2Ffunctions%2Ftransformation.py",
                "contents_url": "https://api.github.com/repos/Giskard-AI/giskard-oss/contents/giskard%2Ffunctions%2Ftransformation.py?ref=48ce81f5c626171767188d6f0669498fb613b4d3",
                "patch": "@@ -38,7 +38,7 @@\n }\n \n gruber = re.compile(\n-    r\"\"\"(?i)\\b((?:https?:(?:/{1,3}|[a-z0-9%])|[a-z0-9.\\-]+[.](?:com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|Ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)/)(?:[^\\s()<>{}\\[\\]]+|\\([^\\s()]*?\\([^\\s()]+\\)[^\\s()]*?\\)|\\([^\\s]+?\\))+(?:\\([^\\s()]*?\\([^\\s()]+\\)[^\\s()]*?\\)|\\([^\\s]+?\\)|[^\\s`!()\\[\\]{};:'\".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019])|(?:(?<!@)[a-z0-9]+(?:[.\\-][a-z0-9]+)*[.](?:com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|Ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)\\b/?(?!@)))\"\"\"\n+    r\"\"\"(?i)\\b((?:https?:(?:/{1,3}|[a-z0-9%])|[a-z0-9.\\-]+[.](?:com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|Ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)/)(?:[^\\s()<>{}\\[\\]]|\\([^\\s()]*?\\([^\\s()]+\\)[^\\s()]*?\\)|\\([^\\s]+?\\))+(?:\\([^\\s()]*?\\([^\\s()]+\\)[^\\s()]*?\\)|\\([^\\s]+?\\)|[^\\s`!()\\[\\]{};:'\".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019])|(?:(?<!@)[a-z0-9]+(?:[.\\-][a-z0-9]+)*[.](?:com|net|org|edu|gov|mil|aero|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|post|pro|tel|travel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|Ja|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)\\b/?(?!@)))\"\"\"\n )  # noqa\n \n "
            },
            {
                "sha": "e679c82a073ccc80495c85d54e54ebbd1a822b37",
                "filename": "tests/scan/test_text_transformations.py",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/Giskard-AI/giskard-oss/blob/48ce81f5c626171767188d6f0669498fb613b4d3/tests%2Fscan%2Ftest_text_transformations.py",
                "raw_url": "https://github.com/Giskard-AI/giskard-oss/raw/48ce81f5c626171767188d6f0669498fb613b4d3/tests%2Fscan%2Ftest_text_transformations.py",
                "contents_url": "https://api.github.com/repos/Giskard-AI/giskard-oss/contents/tests%2Fscan%2Ftest_text_transformations.py?ref=48ce81f5c626171767188d6f0669498fb613b4d3",
                "patch": "@@ -94,6 +94,7 @@ def test_punctuation_strip_transformation():\n                 \"Another @TEXT with \u2192 $UNICODE$ \u2190 characters \ud83d\ude00\",\n                 \"\u201cAnd\u2026 PUNCTUATION! all SHOULD be fine\u00a0\u2014 I HOPE!?\u201d\",\n                 \"This.., is my site.. http://www.example.com/, and ., it .,.,. http://stackoverflow.com rules!..\",\n+                \"This.., is my site.. http://www.example.com/!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!, and ., it .,.,. http://stackoverflow.com rules!..\",\n                 \"comma,separated,list\",\n             ]\n         }\n@@ -111,7 +112,8 @@ def test_punctuation_strip_transformation():\n     assert transformed_text[2] == \"Another @TEXT with \u2192 $UNICODE$ \u2190 characters \ud83d\ude00\"\n     assert transformed_text[3] == \"And PUNCTUATION all SHOULD be fine\u00a0 I HOPE\"\n     assert transformed_text[4] == \"This is my site http://www.example.com/ and  it  http://stackoverflow.com rules\"\n-    assert transformed_text[5] == \"comma separated list\"\n+    assert transformed_text[5] == \"This is my site http://www.example.com/ and  it  http://stackoverflow.com rules\"\n+    assert transformed_text[6] == \"comma separated list\"\n \n \n def test_number_to_words_transformation_exception():"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/matrix-org/matrix-appservice-irc/commits/4a024eae1a992b1ea67e71a998e0b833b54221e2",
        "url": "https://api.github.com/repos/matrix-org/matrix-appservice-irc/commits/4a024eae1a992b1ea67e71a998e0b833b54221e2",
        "html_url": "https://github.com/matrix-org/matrix-appservice-irc/commit/4a024eae1a992b1ea67e71a998e0b833b54221e2",
        "message": "Disallow control characters in channel names sent via Provisioning API (#2)",
        "files": [
            {
                "sha": "34f14431e995cfdb379bde5644ed99a4125bb0df",
                "filename": "changelog.d/2.bugfix",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/matrix-org/matrix-appservice-irc/blob/4a024eae1a992b1ea67e71a998e0b833b54221e2/changelog.d%2F2.bugfix",
                "raw_url": "https://github.com/matrix-org/matrix-appservice-irc/raw/4a024eae1a992b1ea67e71a998e0b833b54221e2/changelog.d%2F2.bugfix",
                "contents_url": "https://api.github.com/repos/matrix-org/matrix-appservice-irc/contents/changelog.d%2F2.bugfix?ref=4a024eae1a992b1ea67e71a998e0b833b54221e2",
                "patch": "@@ -0,0 +1 @@\n+Disallow control characters in channel names sent via Provisioning API."
            },
            {
                "sha": "a376c05ec809e13a19c784acb224d4d795524321",
                "filename": "src/models/IrcRoom.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/matrix-org/matrix-appservice-irc/blob/4a024eae1a992b1ea67e71a998e0b833b54221e2/src%2Fmodels%2FIrcRoom.ts",
                "raw_url": "https://github.com/matrix-org/matrix-appservice-irc/raw/4a024eae1a992b1ea67e71a998e0b833b54221e2/src%2Fmodels%2FIrcRoom.ts",
                "contents_url": "https://api.github.com/repos/matrix-org/matrix-appservice-irc/contents/src%2Fmodels%2FIrcRoom.ts?ref=4a024eae1a992b1ea67e71a998e0b833b54221e2",
                "patch": "@@ -26,7 +26,8 @@ import { IrcServer } from \"../irc/IrcServer\";\n  */\n export function validateChannelName(channel: string) {\n     // According to https://www.rfc-editor.org/rfc/rfc1459#section-1.3\n-    return /^#([^\\s\\cG,]){1,199}$/.test(channel);\n+    // eslint-disable-next-line no-control-regex\n+    return /^#([^:\\x00-\\x1F\\s,]){1,199}$/.test(channel);\n }\n \n export class IrcRoom extends RemoteRoom {"
            },
            {
                "sha": "3dd7e177e8575f724d15715bd817849831adad17",
                "filename": "src/provisioning/Schema.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/matrix-org/matrix-appservice-irc/blob/4a024eae1a992b1ea67e71a998e0b833b54221e2/src%2Fprovisioning%2FSchema.ts",
                "raw_url": "https://github.com/matrix-org/matrix-appservice-irc/raw/4a024eae1a992b1ea67e71a998e0b833b54221e2/src%2Fprovisioning%2FSchema.ts",
                "contents_url": "https://api.github.com/repos/matrix-org/matrix-appservice-irc/contents/src%2Fprovisioning%2FSchema.ts?ref=4a024eae1a992b1ea67e71a998e0b833b54221e2",
                "patch": "@@ -13,7 +13,9 @@ const matrixRoomIdSchema: JSONSchemaType<string> = {\n \n const remoteRoomChannelSchema: JSONSchemaType<string> = {\n     type: \"string\",\n-    pattern: \"^([#+&]|(![A-Z0-9]{5}))[^\\\\s:,]+$\",\n+    // According to https://www.rfc-editor.org/rfc/rfc1459#section-1.3\n+    // eslint-disable-next-line no-control-regex\n+    pattern: \"^#([^:\\\\x00-\\\\x1F\\\\s,]){1,199}$\",\n };\n \n const remoteRoomServerSchema: JSONSchemaType<string> = {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/OsamaTaher/Java-springboot-codebase/commits/204402bb8b68030c14911379ddc82cfff00b8538",
        "url": "https://api.github.com/repos/OsamaTaher/Java-springboot-codebase/commits/204402bb8b68030c14911379ddc82cfff00b8538",
        "html_url": "https://github.com/OsamaTaher/Java-springboot-codebase/commit/204402bb8b68030c14911379ddc82cfff00b8538",
        "message": "FIX CVE-2024-52302\n\nUnrestricted File Upload Leading to Remote Code Execution (RCE)",
        "files": [
            {
                "sha": "b70493efbc02e7caa9f5b19bda65f59f6a6fc392",
                "filename": "spring boot/common-user-management/pom.xml",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/OsamaTaher/Java-springboot-codebase/blob/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fpom.xml",
                "raw_url": "https://github.com/OsamaTaher/Java-springboot-codebase/raw/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fpom.xml",
                "contents_url": "https://api.github.com/repos/OsamaTaher/Java-springboot-codebase/contents/spring%20boot%2Fcommon-user-management%2Fpom.xml?ref=204402bb8b68030c14911379ddc82cfff00b8538",
                "patch": "@@ -99,9 +99,9 @@\n \t\t</dependency>\n \n \t\t<dependency>\n-\t\t\t<groupId>com.google.firebase</groupId>\n-\t\t\t<artifactId>firebase-admin</artifactId>\n-\t\t\t<version>9.2.0</version>\n+\t\t\t<groupId>org.apache.tika</groupId>\n+\t\t\t<artifactId>tika-core</artifactId>\n+\t\t\t<version>2.8.0</version>\n \t\t</dependency>\n \n \t\t<dependency>\n@@ -114,6 +114,8 @@\n \t\t\t<artifactId>spring-security-test</artifactId>\n \t\t\t<scope>test</scope>\n \t\t</dependency>\n+\n+\n \t</dependencies>\n \n \t<build>"
            },
            {
                "sha": "913d4d87898007658081d0ace25fa4ed20d27dec",
                "filename": "spring boot/common-user-management/src/main/java/common/management/common/service/impl/FileSystemStorageService.java",
                "status": "modified",
                "additions": 11,
                "deletions": 24,
                "changes": 35,
                "blob_url": "https://github.com/OsamaTaher/Java-springboot-codebase/blob/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fjava%2Fcommon%2Fmanagement%2Fcommon%2Fservice%2Fimpl%2FFileSystemStorageService.java",
                "raw_url": "https://github.com/OsamaTaher/Java-springboot-codebase/raw/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fjava%2Fcommon%2Fmanagement%2Fcommon%2Fservice%2Fimpl%2FFileSystemStorageService.java",
                "contents_url": "https://api.github.com/repos/OsamaTaher/Java-springboot-codebase/contents/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fjava%2Fcommon%2Fmanagement%2Fcommon%2Fservice%2Fimpl%2FFileSystemStorageService.java?ref=204402bb8b68030c14911379ddc82cfff00b8538",
                "patch": "@@ -4,6 +4,7 @@\n import jakarta.annotation.PostConstruct;\n import lombok.extern.slf4j.Slf4j;\n import org.apache.commons.io.FilenameUtils;\n+import org.apache.tika.Tika;\n import org.imgscalr.Scalr;\n import org.springframework.beans.factory.annotation.Value;\n import org.springframework.core.io.Resource;\n@@ -41,14 +42,13 @@ public class FileSystemStorageService implements StorageService {\n     private final HashSet<String> allowedFileType = new HashSet<>(List.of(\n             \"image/jpeg\",\"image/jpg\",\"image/png\"\n             ,\"video/mp4\"\n-            ,\"audio/wave\",\"audio/wav\",\"audio/x-wav\",\"audio/x-pn-wav\",\"audio/webm\",\"audio/mpeg\"\n             ,\"application/pdf\"\n             ,\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\"\n             ,\"application/msword\"\n     ));\n \n     private final HashSet<String> imageType = new HashSet<>(List.of(\"jpeg\",\"jpg\",\"png\",\"gif\"));\n-\n+    private final HashSet<String> allowedFilesExt = new HashSet<>(List.of(\"pdf\",\"mp4\", \"jpeg\",\"jpg\",\"png\",\"gif\"));\n \n     @Override\n     public boolean isImage(MultipartFile file){\n@@ -59,6 +59,13 @@ private boolean isImage(String ext){\n         return imageType.contains(ext);\n     }\n \n+    public boolean isAllowedFileType(MultipartFile file) throws IOException {\n+        Tika tika = new Tika();\n+        String mimeType = tika.detect(file.getInputStream());\n+        return allowedFilesExt.contains(FilenameUtils.getExtension(file.getOriginalFilename()))\n+        && allowedFileType.contains(mimeType);\n+    }\n+\n \n     @PostConstruct\n     public void init() {\n@@ -70,17 +77,6 @@ public void init() {\n         }\n     }\n \n-    public void saveChunkToFile(String encodedData,String fileNameWithExtension,String meetingId) throws IOException {\n-        //append the data to the end of the file\n-\n-        OutputStream out = new FileOutputStream(rootLocation + \"/upload/\"+meetingId+ \"/\"+fileNameWithExtension,true);\n-        byte[] decoded = Base64.getDecoder().decode(encodedData);\n-        //append to the file\n-        out.write(decoded);\n-        out.close();\n-    }\n-\n-\n     @Override\n     public int store(MultipartFile file, String nameAndExt) {\n         Path location = Paths.get(rootLocation+\"/\");\n@@ -95,6 +91,8 @@ public int store(MultipartFile file, String nameAndExt) {\n                return OP_STATUS_INVALID_FILE_NAME;\n             }\n \n+            if(!isAllowedFileType(file)) return OP_STATUS_FILE_TYPE_NOT_ALLOWED;\n+\n             try (InputStream inputStream = file.getInputStream()) {\n \n                 Files.copy(inputStream, location.resolve(nameAndExt),\n@@ -120,17 +118,6 @@ private void createThumbnail(MultipartFile file, Integer width,String nameAndExt\n         ImageIO.write(thumbImg, FilenameUtils.getExtension(file.getOriginalFilename()) ,new File(rootLocation,\"thumb_\"+nameAndExt));\n     }\n \n-    public Stream<Path> loadAll() {\n-        try {\n-            return Files.walk(this.rootPath, 1)\n-                    .filter(path -> !path.equals(this.rootPath))\n-                    .map(this.rootPath::relativize);\n-        }\n-        catch (IOException e) {\n-            throw new RuntimeException(\"Failed to read stored files\", e);\n-        }\n-\n-    }\n \n     public Path load(String filename,Path location) {\n         return location.resolve(filename);"
            },
            {
                "sha": "67e40d76cbaaf584299bda920ac6f852ffd37c51",
                "filename": "spring boot/common-user-management/src/main/java/common/management/common/util/OperationStatus.java",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/OsamaTaher/Java-springboot-codebase/blob/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fjava%2Fcommon%2Fmanagement%2Fcommon%2Futil%2FOperationStatus.java",
                "raw_url": "https://github.com/OsamaTaher/Java-springboot-codebase/raw/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fjava%2Fcommon%2Fmanagement%2Fcommon%2Futil%2FOperationStatus.java",
                "contents_url": "https://api.github.com/repos/OsamaTaher/Java-springboot-codebase/contents/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fjava%2Fcommon%2Fmanagement%2Fcommon%2Futil%2FOperationStatus.java?ref=204402bb8b68030c14911379ddc82cfff00b8538",
                "patch": "@@ -36,6 +36,7 @@ public class OperationStatus {\n     public static final int OP_STATUS_FILETYPE_MISMATCH = -14;\n     public static final int OP_STATUS_WRONG_PASSWORD = -15;\n     public static final int OP_STATUS_REFRESH_TOKEN_INVALID = -16;\n+    public static final int OP_STATUS_FILE_TYPE_NOT_ALLOWED= -36;\n \n     public static final int OP_STATUS_EMAIL_ALREADY_USED_BY_ANOTHER_ACCOUNT = -17;\n     public static final int OP_STATUS_PRIVILEGE_NOT_FOUND = -18;\n@@ -109,6 +110,13 @@ public ResponseEntity<?> handle(int status) {\n                 return ResponseEntity.status(HttpStatus.NOT_FOUND).body(new BasicResponse(HttpStatus.NOT_FOUND.value(), messageSource.getMessage(\"OP_STATUS_CUSTOMER_NOT_FOUND\", null, LocaleContextHolder.getLocale())));\n             case OP_STATUS_NOT_FOUND:\n                 return ResponseEntity.status(HttpStatus.NOT_FOUND).body(new BasicResponse(HttpStatus.NOT_FOUND.value(), messageSource.getMessage(\"OP_STATUS_NOT_FOUND\", null, LocaleContextHolder.getLocale())));\n+            case OP_STATUS_FILE_EMPTY:\n+                return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(new BasicResponse(HttpStatus.BAD_REQUEST.value(), messageSource.getMessage(\"OP_STATUS_FILE_EMPTY\", null, LocaleContextHolder.getLocale())));\n+            case OP_STATUS_INVALID_FILE_NAME:\n+                return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(new BasicResponse(HttpStatus.BAD_REQUEST.value(), messageSource.getMessage(\"OP_STATUS_INVALID_FILE_NAME\", null, LocaleContextHolder.getLocale())));\n+            case OP_STATUS_FILE_TYPE_NOT_ALLOWED:\n+                return ResponseEntity.status(HttpStatus.FORBIDDEN).body(new BasicResponse(HttpStatus.FORBIDDEN.value(), messageSource.getMessage(\"OP_STATUS_FILE_TYPE_NOT_ALLOWED\", null, LocaleContextHolder.getLocale())));\n+\n             default:\n                 return ResponseEntity.internalServerError().body(new BasicResponse(HttpStatus.INTERNAL_SERVER_ERROR.value(), \"Operation Failed\"));\n         }"
            },
            {
                "sha": "cbb8e966e5566c48c731a8c7c2769b4118b72537",
                "filename": "spring boot/common-user-management/src/main/java/common/management/customer/service/impl/CustomerServiceImpl.java",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/OsamaTaher/Java-springboot-codebase/blob/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fjava%2Fcommon%2Fmanagement%2Fcustomer%2Fservice%2Fimpl%2FCustomerServiceImpl.java",
                "raw_url": "https://github.com/OsamaTaher/Java-springboot-codebase/raw/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fjava%2Fcommon%2Fmanagement%2Fcustomer%2Fservice%2Fimpl%2FCustomerServiceImpl.java",
                "contents_url": "https://api.github.com/repos/OsamaTaher/Java-springboot-codebase/contents/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fjava%2Fcommon%2Fmanagement%2Fcustomer%2Fservice%2Fimpl%2FCustomerServiceImpl.java?ref=204402bb8b68030c14911379ddc82cfff00b8538",
                "patch": "@@ -45,6 +45,9 @@ public OpWrapper<Long> create(CreateCustomerRequest request) {\n     @Override\n     @Transactional\n     public int updateProfilePicture(MultipartFile file) {\n+        //make sure file is image\n+        if(!storageService.isImage(file)) return OP_STATUS_FILE_TYPE_NOT_ALLOWED;\n+\n         var userId = userService.getAuthUserId();\n         if(userId.isEmpty()) return OP_STATUS_FORBIDDEN;\n         var customer  = customerRepository.findByUserId(userId.get());"
            },
            {
                "sha": "4282c61243c2a2ba04bb50ec3d1ade2ec05754f3",
                "filename": "spring boot/common-user-management/src/main/resources/messages.properties",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/OsamaTaher/Java-springboot-codebase/blob/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fresources%2Fmessages.properties",
                "raw_url": "https://github.com/OsamaTaher/Java-springboot-codebase/raw/204402bb8b68030c14911379ddc82cfff00b8538/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fresources%2Fmessages.properties",
                "contents_url": "https://api.github.com/repos/OsamaTaher/Java-springboot-codebase/contents/spring%20boot%2Fcommon-user-management%2Fsrc%2Fmain%2Fresources%2Fmessages.properties?ref=204402bb8b68030c14911379ddc82cfff00b8538",
                "patch": "@@ -20,6 +20,7 @@ OP_STATUS_INVALID_FILE_NAME=Invalid file name\n OP_STATUS_FILE_EMPTY=File is empty\n OP_STATUS_FILE_DATA_NOT_FOUND=File data not found\n OP_STATUS_FILETYPE_MISMATCH=File type mismatch\n+OP_STATUS_FILE_TYPE_NOT_ALLOWED= File type not allowed\n \n OP_STATUS_EMAIL_ALREADY_USED_BY_ANOTHER_ACCOUNT=Email already used by another account\n OP_STATUS_INVALID_SECRET=Invalid secret code\n@@ -30,4 +31,4 @@ OP_STATUS_STAFF_MEMBER_NOT_FOUND=STAFF_MEMBER_NOT_FOUND\n OP_STATUS_BAD_REQUEST=BAD_REQUEST\n OP_STATUS_GOVERNORATE_NOT_FOUND=GOVERNORATE_NOT_FOUND\n OP_STATUS_CUSTOMER_NOT_FOUND = CUSTOMER_NOT_FOUND\n-OP_STATUS_NOT_FOUND = NOT_FOUND\n\\ No newline at end of file\n+OP_STATUS_NOT_FOUND = NOT_FOUND"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/keycloak/keycloak/commits/4252e394cf725b16f7e4e19aa32b03fd3fe13fde",
        "url": "https://api.github.com/repos/keycloak/keycloak/commits/4252e394cf725b16f7e4e19aa32b03fd3fe13fde",
        "html_url": "https://github.com/keycloak/keycloak/commit/4252e394cf725b16f7e4e19aa32b03fd3fe13fde",
        "message": "Escape ldap id when using normal attribute syntax (#25)\n\nCloses https://github.com/keycloak/security/issues/46",
        "files": [
            {
                "sha": "df039f7a16c361ad9c81b349ded4de9bc8e6fa8c",
                "filename": "federation/ldap/src/main/java/org/keycloak/storage/ldap/idm/store/ldap/LDAPOperationManager.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/keycloak/keycloak/blob/4252e394cf725b16f7e4e19aa32b03fd3fe13fde/federation%2Fldap%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fstorage%2Fldap%2Fidm%2Fstore%2Fldap%2FLDAPOperationManager.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/4252e394cf725b16f7e4e19aa32b03fd3fe13fde/federation%2Fldap%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fstorage%2Fldap%2Fidm%2Fstore%2Fldap%2FLDAPOperationManager.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/federation%2Fldap%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fstorage%2Fldap%2Fidm%2Fstore%2Fldap%2FLDAPOperationManager.java?ref=4252e394cf725b16f7e4e19aa32b03fd3fe13fde",
                "patch": "@@ -24,6 +24,7 @@\n import org.keycloak.models.ModelException;\n import org.keycloak.storage.ldap.LDAPConfig;\n import org.keycloak.storage.ldap.idm.model.LDAPDn;\n+import org.keycloak.storage.ldap.idm.query.EscapeStrategy;\n import org.keycloak.storage.ldap.idm.query.internal.LDAPQuery;\n import org.keycloak.storage.ldap.idm.store.ldap.extended.PasswordModifyRequest;\n import org.keycloak.storage.ldap.mappers.LDAPOperationDecorator;\n@@ -386,7 +387,7 @@ public String getFilterById(String id) {\n                 ).append(LDAPUtil.convertGUIDToEdirectoryHexString(id)).append(\")\");\n         } else {\n             filter.append(\"(objectClass=*)(\").append(getUuidAttributeName()).append(LDAPConstants.EQUAL)\n-                .append(id).append(\")\");\n+                .append(EscapeStrategy.DEFAULT.escape(id)).append(\")\");\n         }\n \n         if (config.getCustomUserSearchFilter() != null) {"
            },
            {
                "sha": "481df3f3b17278a4fd5c5eec144a34eb457f549d",
                "filename": "services/src/main/java/org/keycloak/authentication/authenticators/browser/AbstractUsernameFormAuthenticator.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/keycloak/keycloak/blob/4252e394cf725b16f7e4e19aa32b03fd3fe13fde/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fauthentication%2Fauthenticators%2Fbrowser%2FAbstractUsernameFormAuthenticator.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/4252e394cf725b16f7e4e19aa32b03fd3fe13fde/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fauthentication%2Fauthenticators%2Fbrowser%2FAbstractUsernameFormAuthenticator.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/services%2Fsrc%2Fmain%2Fjava%2Forg%2Fkeycloak%2Fauthentication%2Fauthenticators%2Fbrowser%2FAbstractUsernameFormAuthenticator.java?ref=4252e394cf725b16f7e4e19aa32b03fd3fe13fde",
                "patch": "@@ -170,7 +170,7 @@ private UserModel getUser(AuthenticationFlowContext context, MultivaluedMap<Stri\n \n     private UserModel getUserFromForm(AuthenticationFlowContext context, MultivaluedMap<String, String> inputData) {\n         String username = inputData.getFirst(AuthenticationManager.FORM_USERNAME);\n-        if (username == null) {\n+        if (username == null || username.isEmpty()) {\n             context.getEvent().error(Errors.USER_NOT_FOUND);\n             Response challengeResponse = challenge(context, getDefaultChallengeMessage(context), FIELD_USERNAME);\n             context.failureChallenge(AuthenticationFlowError.INVALID_USER, challengeResponse);"
            },
            {
                "sha": "2eb776d694e79034489c93189df1748e433b7501",
                "filename": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/federation/ldap/LDAPSpecialCharsTest.java",
                "status": "modified",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/keycloak/keycloak/blob/4252e394cf725b16f7e4e19aa32b03fd3fe13fde/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Ffederation%2Fldap%2FLDAPSpecialCharsTest.java",
                "raw_url": "https://github.com/keycloak/keycloak/raw/4252e394cf725b16f7e4e19aa32b03fd3fe13fde/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Ffederation%2Fldap%2FLDAPSpecialCharsTest.java",
                "contents_url": "https://api.github.com/repos/keycloak/keycloak/contents/testsuite%2Fintegration-arquillian%2Ftests%2Fbase%2Fsrc%2Ftest%2Fjava%2Forg%2Fkeycloak%2Ftestsuite%2Ffederation%2Fldap%2FLDAPSpecialCharsTest.java?ref=4252e394cf725b16f7e4e19aa32b03fd3fe13fde",
                "patch": "@@ -31,6 +31,7 @@\n import org.keycloak.models.RealmModel;\n import org.keycloak.models.UserModel;\n import org.keycloak.models.utils.KeycloakModelUtils;\n+import org.keycloak.representations.idm.ComponentRepresentation;\n import org.keycloak.representations.idm.UserRepresentation;\n import org.keycloak.storage.ldap.idm.model.LDAPObject;\n import org.keycloak.storage.ldap.mappers.membership.LDAPGroupMapperMode;\n@@ -198,4 +199,45 @@ public void test03_specialCharUserJoiningSpecialCharGroup() {\n         });\n     }\n \n+    @Test\n+    public void test04_loginWithSpecialCharacterUsingSameUUIDThanUsernameAttribute() {\n+        // remove users from the ldap to use the new UUID attribute\n+        adminClient.realm(TEST_REALM_NAME).userStorage().removeImportedUsers(ldapModelId);\n+\n+        // change the UUID attribute to be the username attribute\n+        String origUuidAttrName = testingClient.server().fetch(session -> {\n+            LDAPTestContext ctx = LDAPTestContext.init(session);\n+\n+            String uidAttrName = ctx.getLdapProvider().getLdapIdentityStore().getConfig().getUsernameLdapAttribute();\n+            String origUuidAttrNamee = ctx.getLdapModel().get(LDAPConstants.UUID_LDAP_ATTRIBUTE);\n+            ctx.getLdapModel().put(LDAPConstants.UUID_LDAP_ATTRIBUTE, uidAttrName);\n+            ctx.getRealm().updateComponent(ctx.getLdapModel());\n+\n+            return origUuidAttrNamee;\n+        }, String.class);\n+\n+        try {\n+            // assert the user is found and UUID is the name\n+            List<UserRepresentation> users = adminClient.realm(TEST_REALM_NAME).users().search(\"jamees,key*clo\u017eak)ppp\", true);\n+            Assert.assertEquals(\"User not found\", 1, users.size());\n+            UserRepresentation jamees = users.iterator().next();\n+            Assert.assertEquals(\"Incorrect user\", \"jamees,key*clo\u017eak)ppp\", jamees.getUsername());\n+            Assert.assertEquals(\"Incorrect UUID attribute\", \"jamees,key*clo\u017eak)ppp\", jamees.firstAttribute(LDAPConstants.LDAP_ID));\n+\n+            // Fail login with wildcard\n+            loginPage.open();\n+            loginPage.login(\"jamees*\", \"Password1\");\n+            Assert.assertEquals(\"Invalid username or password.\", loginPage.getInputError());\n+\n+            // Success login as username exactly match\n+            loginPage.login(\"jamees,key*clo\u017eak)ppp\", \"Password1\");\n+            Assert.assertEquals(AppPage.RequestType.AUTH_RESPONSE, appPage.getRequestType());\n+            Assert.assertNotNull(oauth.getCurrentQuery().get(OAuth2Constants.CODE));\n+        } finally {\n+            // Revert config changes to be back to previous UUID attribute\n+            ComponentRepresentation ldapRep = testRealm().components().component(ldapModelId).toRepresentation();\n+            ldapRep.getConfig().putSingle(LDAPConstants.UUID_LDAP_ATTRIBUTE, origUuidAttrName);\n+            testRealm().components().component(ldapModelId).update(ldapRep);\n+        }\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/saltstack/salt/commits/286d55eb5a6e6bf9428405bdf5632b419bdf8444",
        "url": "https://api.github.com/repos/saltstack/salt/commits/286d55eb5a6e6bf9428405bdf5632b419bdf8444",
        "html_url": "https://github.com/saltstack/salt/commit/286d55eb5a6e6bf9428405bdf5632b419bdf8444",
        "message": "Add pytest integration pre_flight integration tests for CVE-2023-34049",
        "files": [
            {
                "sha": "1598b3d51b5d6fa8a9df0c55c724fc757c697c4b",
                "filename": "tests/integration/ssh/test_pre_flight.py",
                "status": "removed",
                "additions": 0,
                "deletions": 132,
                "changes": 132,
                "blob_url": "https://github.com/saltstack/salt/blob/e3cbe1fac59521e9500113498d4445f4ec000483/tests%2Fintegration%2Fssh%2Ftest_pre_flight.py",
                "raw_url": "https://github.com/saltstack/salt/raw/e3cbe1fac59521e9500113498d4445f4ec000483/tests%2Fintegration%2Fssh%2Ftest_pre_flight.py",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/tests%2Fintegration%2Fssh%2Ftest_pre_flight.py?ref=e3cbe1fac59521e9500113498d4445f4ec000483",
                "patch": "@@ -1,132 +0,0 @@\n-\"\"\"\n-Test for ssh_pre_flight roster option\n-\"\"\"\n-\n-import os\n-\n-import pytest\n-\n-import salt.utils.files\n-from tests.support.case import SSHCase\n-from tests.support.runtests import RUNTIME_VARS\n-\n-\n-class SSHPreFlightTest(SSHCase):\n-    \"\"\"\n-    Test ssh_pre_flight roster option\n-    \"\"\"\n-\n-    def setUp(self):\n-        super().setUp()\n-        self.roster = os.path.join(RUNTIME_VARS.TMP, \"pre_flight_roster\")\n-        self.data = {\n-            \"ssh_pre_flight\": os.path.join(RUNTIME_VARS.TMP, \"ssh_pre_flight.sh\")\n-        }\n-        self.test_script = os.path.join(\n-            RUNTIME_VARS.TMP, \"test-pre-flight-script-worked.txt\"\n-        )\n-\n-    def _create_roster(self, pre_flight_script_args=None):\n-        data = dict(self.data)\n-        if pre_flight_script_args:\n-            data[\"ssh_pre_flight_args\"] = pre_flight_script_args\n-\n-        self.custom_roster(self.roster, data)\n-\n-        with salt.utils.files.fopen(data[\"ssh_pre_flight\"], \"w\") as fp_:\n-            fp_.write(\"touch {}\".format(self.test_script))\n-\n-    @pytest.mark.slow_test\n-    def test_ssh_pre_flight(self):\n-        \"\"\"\n-        test ssh when ssh_pre_flight is set\n-        ensure the script runs successfully\n-        \"\"\"\n-        self._create_roster()\n-        assert self.run_function(\"test.ping\", roster_file=self.roster)\n-\n-        assert os.path.exists(self.test_script)\n-\n-    @pytest.mark.slow_test\n-    def test_ssh_run_pre_flight(self):\n-        \"\"\"\n-        test ssh when --pre-flight is passed to salt-ssh\n-        to ensure the script runs successfully\n-        \"\"\"\n-        self._create_roster()\n-        # make sure we previously ran a command so the thin dir exists\n-        self.run_function(\"test.ping\", wipe=False)\n-        assert not os.path.exists(self.test_script)\n-\n-        assert self.run_function(\n-            \"test.ping\", ssh_opts=\"--pre-flight\", roster_file=self.roster, wipe=False\n-        )\n-        assert os.path.exists(self.test_script)\n-\n-    @pytest.mark.slow_test\n-    def test_ssh_run_pre_flight_args(self):\n-        \"\"\"\n-        test ssh when --pre-flight is passed to salt-ssh\n-        to ensure the script runs successfully passing some args\n-        \"\"\"\n-        self._create_roster(pre_flight_script_args=\"foobar test\")\n-        # make sure we previously ran a command so the thin dir exists\n-        self.run_function(\"test.ping\", wipe=False)\n-        assert not os.path.exists(self.test_script)\n-\n-        assert self.run_function(\n-            \"test.ping\", ssh_opts=\"--pre-flight\", roster_file=self.roster, wipe=False\n-        )\n-        assert os.path.exists(self.test_script)\n-\n-    @pytest.mark.slow_test\n-    def test_ssh_run_pre_flight_args_prevent_injection(self):\n-        \"\"\"\n-        test ssh when --pre-flight is passed to salt-ssh\n-        and evil arguments are used in order to produce shell injection\n-        \"\"\"\n-        injected_file = os.path.join(RUNTIME_VARS.TMP, \"injection\")\n-        self._create_roster(\n-            pre_flight_script_args=\"foobar; echo injected > {}\".format(injected_file)\n-        )\n-        # make sure we previously ran a command so the thin dir exists\n-        self.run_function(\"test.ping\", wipe=False)\n-        assert not os.path.exists(self.test_script)\n-        assert not os.path.isfile(injected_file)\n-\n-        assert self.run_function(\n-            \"test.ping\", ssh_opts=\"--pre-flight\", roster_file=self.roster, wipe=False\n-        )\n-\n-        assert not os.path.isfile(\n-            injected_file\n-        ), \"File injection suceeded. This shouldn't happend\"\n-\n-    @pytest.mark.slow_test\n-    def test_ssh_run_pre_flight_failure(self):\n-        \"\"\"\n-        test ssh_pre_flight when there is a failure\n-        in the script.\n-        \"\"\"\n-        self._create_roster()\n-        with salt.utils.files.fopen(self.data[\"ssh_pre_flight\"], \"w\") as fp_:\n-            fp_.write(\"exit 2\")\n-\n-        ret = self.run_function(\n-            \"test.ping\", ssh_opts=\"--pre-flight\", roster_file=self.roster, wipe=False\n-        )\n-        assert ret[\"retcode\"] == 2\n-\n-    def tearDown(self):\n-        \"\"\"\n-        make sure to clean up any old ssh directories\n-        \"\"\"\n-        files = [\n-            self.roster,\n-            self.data[\"ssh_pre_flight\"],\n-            self.test_script,\n-            os.path.join(RUNTIME_VARS.TMP, \"injection\"),\n-        ]\n-        for fp_ in files:\n-            if os.path.exists(fp_):\n-                os.remove(fp_)"
            },
            {
                "sha": "78b2b751f2bc4787bc35e44a0542eb522b118037",
                "filename": "tests/pytests/integration/ssh/test_pre_flight.py",
                "status": "added",
                "additions": 309,
                "deletions": 0,
                "changes": 309,
                "blob_url": "https://github.com/saltstack/salt/blob/286d55eb5a6e6bf9428405bdf5632b419bdf8444/tests%2Fpytests%2Fintegration%2Fssh%2Ftest_pre_flight.py",
                "raw_url": "https://github.com/saltstack/salt/raw/286d55eb5a6e6bf9428405bdf5632b419bdf8444/tests%2Fpytests%2Fintegration%2Fssh%2Ftest_pre_flight.py",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/tests%2Fpytests%2Fintegration%2Fssh%2Ftest_pre_flight.py?ref=286d55eb5a6e6bf9428405bdf5632b419bdf8444",
                "patch": "@@ -0,0 +1,309 @@\n+\"\"\"\n+Test for ssh_pre_flight roster option\n+\"\"\"\n+\n+import grp\n+import os\n+import pathlib\n+import pwd\n+import shutil\n+import subprocess\n+\n+import pytest\n+import yaml\n+from saltfactories.utils import random_string\n+\n+import salt.utils.files\n+\n+\n+def _custom_roster(roster_file, roster_data):\n+    with salt.utils.files.fopen(roster_file, \"r\") as fp:\n+        data = salt.utils.yaml.safe_load(fp)\n+    for key, item in roster_data.items():\n+        data[\"localhost\"][key] = item\n+    with salt.utils.files.fopen(roster_file, \"w\") as fp:\n+        yaml.safe_dump(data, fp)\n+\n+\n+@pytest.fixture\n+def _create_roster(salt_ssh_roster_file, tmp_path):\n+    ret = {}\n+    ret[\"roster\"] = salt_ssh_roster_file\n+    ret[\"data\"] = {\"ssh_pre_flight\": str(tmp_path / \"ssh_pre_flight.sh\")}\n+    ret[\"test_script\"] = str(tmp_path / \"test-pre-flight-script-worked.txt\")\n+    ret[\"thin_dir\"] = tmp_path / \"thin_dir\"\n+\n+    with salt.utils.files.fopen(salt_ssh_roster_file, \"r\") as fp:\n+        data = salt.utils.yaml.safe_load(fp)\n+    pre_flight_script = ret[\"data\"][\"ssh_pre_flight\"]\n+    data[\"localhost\"][\"ssh_pre_flight\"] = pre_flight_script\n+    data[\"localhost\"][\"thin_dir\"] = str(ret[\"thin_dir\"])\n+    with salt.utils.files.fopen(salt_ssh_roster_file, \"w\") as fp:\n+        yaml.safe_dump(data, fp)\n+\n+    with salt.utils.files.fopen(pre_flight_script, \"w\") as fp:\n+        fp.write(\"touch {}\".format(ret[\"test_script\"]))\n+\n+    yield ret\n+    if ret[\"thin_dir\"].exists():\n+        shutil.rmtree(ret[\"thin_dir\"])\n+\n+\n+@pytest.mark.slow_test\n+def test_ssh_pre_flight(salt_ssh_cli, caplog, _create_roster):\n+    \"\"\"\n+    test ssh when ssh_pre_flight is set\n+    ensure the script runs successfully\n+    \"\"\"\n+    ret = salt_ssh_cli.run(\"test.ping\")\n+    assert ret.returncode == 0\n+\n+    assert pathlib.Path(_create_roster[\"test_script\"]).exists()\n+\n+\n+@pytest.mark.slow_test\n+def test_ssh_run_pre_flight(salt_ssh_cli, _create_roster):\n+    \"\"\"\n+    test ssh when --pre-flight is passed to salt-ssh\n+    to ensure the script runs successfully\n+    \"\"\"\n+    # make sure we previously ran a command so the thin dir exists\n+    ret = salt_ssh_cli.run(\"test.ping\")\n+    assert pathlib.Path(_create_roster[\"test_script\"]).exists()\n+\n+    # Now remeove the script to ensure pre_flight doesn't run\n+    # without --pre-flight\n+    pathlib.Path(_create_roster[\"test_script\"]).unlink()\n+\n+    assert salt_ssh_cli.run(\"test.ping\").returncode == 0\n+    assert not pathlib.Path(_create_roster[\"test_script\"]).exists()\n+\n+    # Now ensure\n+    ret = salt_ssh_cli.run(\n+        \"test.ping\",\n+        \"--pre-flight\",\n+    )\n+    assert ret.returncode == 0\n+    assert pathlib.Path(_create_roster[\"test_script\"]).exists()\n+\n+\n+@pytest.mark.slow_test\n+def test_ssh_run_pre_flight_args(salt_ssh_cli, _create_roster):\n+    \"\"\"\n+    test ssh when --pre-flight is passed to salt-ssh\n+    to ensure the script runs successfully passing some args\n+    \"\"\"\n+    _custom_roster(salt_ssh_cli.roster_file, {\"ssh_pre_flight_args\": \"foobar test\"})\n+    # Create pre_flight script that accepts args\n+    test_script = _create_roster[\"test_script\"]\n+    test_script_1 = pathlib.Path(test_script + \"-foobar\")\n+    test_script_2 = pathlib.Path(test_script + \"-test\")\n+    with salt.utils.files.fopen(_create_roster[\"data\"][\"ssh_pre_flight\"], \"w\") as fp:\n+        fp.write(\n+            f\"\"\"\n+        touch {str(test_script)}-$1\n+        touch {str(test_script)}-$2\n+        \"\"\"\n+        )\n+    ret = salt_ssh_cli.run(\"test.ping\")\n+    assert ret.returncode == 0\n+    assert test_script_1.exists()\n+    assert test_script_2.exists()\n+    pathlib.Path(test_script_1).unlink()\n+    pathlib.Path(test_script_2).unlink()\n+\n+    ret = salt_ssh_cli.run(\"test.ping\")\n+    assert ret.returncode == 0\n+    assert not test_script_1.exists()\n+    assert not test_script_2.exists()\n+\n+    ret = salt_ssh_cli.run(\n+        \"test.ping\",\n+        \"--pre-flight\",\n+    )\n+    assert ret.returncode == 0\n+    assert test_script_1.exists()\n+    assert test_script_2.exists()\n+\n+\n+@pytest.mark.slow_test\n+def test_ssh_run_pre_flight_args_prevent_injection(\n+    salt_ssh_cli, _create_roster, tmp_path\n+):\n+    \"\"\"\n+    test ssh when --pre-flight is passed to salt-ssh\n+    and evil arguments are used in order to produce shell injection\n+    \"\"\"\n+    injected_file = tmp_path / \"injection\"\n+    _custom_roster(\n+        salt_ssh_cli.roster_file,\n+        {\"ssh_pre_flight_args\": f\"foobar; echo injected > {str(injected_file)}\"},\n+    )\n+    # Create pre_flight script that accepts args\n+    test_script = _create_roster[\"test_script\"]\n+    test_script_1 = pathlib.Path(test_script + \"-echo\")\n+    test_script_2 = pathlib.Path(test_script + \"-foobar;\")\n+    with salt.utils.files.fopen(_create_roster[\"data\"][\"ssh_pre_flight\"], \"w\") as fp:\n+        fp.write(\n+            f\"\"\"\n+        touch {str(test_script)}-$1\n+        touch {str(test_script)}-$2\n+        \"\"\"\n+        )\n+\n+    # make sure we previously ran a command so the thin dir exists\n+    ret = salt_ssh_cli.run(\"test.ping\")\n+    assert ret.returncode == 0\n+    assert test_script_1.exists()\n+    assert test_script_2.exists()\n+    test_script_1.unlink()\n+    test_script_2.unlink()\n+    assert not injected_file.is_file()\n+\n+    ret = salt_ssh_cli.run(\n+        \"test.ping\",\n+        \"--pre-flight\",\n+    )\n+    assert ret.returncode == 0\n+\n+    assert test_script_1.exists()\n+    assert test_script_2.exists()\n+    assert not pathlib.Path(\n+        injected_file\n+    ).is_file(), \"File injection suceeded. This shouldn't happend\"\n+\n+\n+@pytest.mark.flaky(max_runs=4)\n+@pytest.mark.slow_test\n+def test_ssh_run_pre_flight_failure(salt_ssh_cli, _create_roster):\n+    \"\"\"\n+    test ssh_pre_flight when there is a failure\n+    in the script.\n+    \"\"\"\n+    with salt.utils.files.fopen(_create_roster[\"data\"][\"ssh_pre_flight\"], \"w\") as fp_:\n+        fp_.write(\"exit 2\")\n+\n+    ret = salt_ssh_cli.run(\n+        \"test.ping\",\n+        \"--pre-flight\",\n+    )\n+    assert ret.data[\"retcode\"] == 2\n+\n+\n+@pytest.fixture\n+def account():\n+    username = random_string(\"test-account-\", uppercase=False)\n+    with pytest.helpers.create_account(username=username) as account:\n+        yield account\n+\n+\n+@pytest.mark.slow_test\n+def test_ssh_pre_flight_script(salt_ssh_cli, caplog, _create_roster, tmp_path, account):\n+    \"\"\"\n+    Test to ensure user cannot create and run a script\n+    with the expected pre_flight script path on target.\n+    \"\"\"\n+    try:\n+        script = pathlib.Path.home() / \"hacked\"\n+        tmp_preflight = pathlib.Path(\"/tmp\", \"ssh_pre_flight.sh\")\n+        tmp_preflight.write_text(f\"touch {script}\")\n+        os.chown(tmp_preflight, account.info.uid, account.info.gid)\n+        ret = salt_ssh_cli.run(\"test.ping\")\n+        assert not script.is_file()\n+        assert ret.returncode == 0\n+        assert ret.stdout == '{\\n\"localhost\": true\\n}\\n'\n+    finally:\n+        for _file in [script, tmp_preflight]:\n+            if _file.is_file():\n+                _file.unlink()\n+\n+\n+def demote(user_uid, user_gid):\n+    def result():\n+        # os.setgid does not remove group membership, so we remove them here so they are REALLY non-root\n+        os.setgroups([])\n+        os.setgid(user_gid)\n+        os.setuid(user_uid)\n+\n+    return result\n+\n+\n+@pytest.mark.slow_test\n+def test_ssh_pre_flight_perms(salt_ssh_cli, caplog, _create_roster, account):\n+    \"\"\"\n+    Test to ensure standard user cannot run pre flight script\n+    on target when user sets wrong permissions (777) on\n+    ssh_pre_flight script.\n+    \"\"\"\n+    try:\n+        script = pathlib.Path(\"/tmp\", \"itworked\")\n+        preflight = pathlib.Path(\"/ssh_pre_flight.sh\")\n+        preflight.write_text(f\"touch {str(script)}\")\n+        tmp_preflight = pathlib.Path(\"/tmp\", preflight.name)\n+\n+        _custom_roster(salt_ssh_cli.roster_file, {\"ssh_pre_flight\": str(preflight)})\n+        preflight.chmod(0o0777)\n+        run_script = pathlib.Path(\"/run_script\")\n+        run_script.write_text(\n+            f\"\"\"\n+        x=1\n+        while [ $x -le 200000 ]; do\n+            SCRIPT=`bash {str(tmp_preflight)} 2> /dev/null; echo $?`\n+            if [ ${{SCRIPT}} == 0 ]; then\n+                break\n+            fi\n+            x=$(( $x + 1 ))\n+        done\n+        \"\"\"\n+        )\n+        run_script.chmod(0o0777)\n+        # pylint: disable=W1509\n+        ret = subprocess.Popen(\n+            [\"sh\", f\"{run_script}\"],\n+            preexec_fn=demote(account.info.uid, account.info.gid),\n+            stdout=None,\n+            stderr=None,\n+            stdin=None,\n+            universal_newlines=True,\n+        )\n+        # pylint: enable=W1509\n+        ret = salt_ssh_cli.run(\"test.ping\")\n+        assert ret.returncode == 0\n+\n+        # Lets make sure a different user other than root\n+        # Didn't run the script\n+        assert os.stat(script).st_uid != account.info.uid\n+        assert script.is_file()\n+    finally:\n+        for _file in [script, preflight, tmp_preflight, run_script]:\n+            if _file.is_file():\n+                _file.unlink()\n+\n+\n+@pytest.mark.slow_test\n+def test_ssh_run_pre_flight_target_file_perms(salt_ssh_cli, _create_roster, tmp_path):\n+    \"\"\"\n+    test ssh_pre_flight to ensure the target pre flight script\n+    has the correct perms\n+    \"\"\"\n+    perms_file = tmp_path / \"perms\"\n+    with salt.utils.files.fopen(_create_roster[\"data\"][\"ssh_pre_flight\"], \"w\") as fp_:\n+        fp_.write(\n+            f\"\"\"\n+        SCRIPT_NAME=$0\n+        stat -L -c \"%a %G %U\" $SCRIPT_NAME > {perms_file}\n+        \"\"\"\n+        )\n+\n+    ret = salt_ssh_cli.run(\n+        \"test.ping\",\n+        \"--pre-flight\",\n+    )\n+    assert ret.returncode == 0\n+    with salt.utils.files.fopen(perms_file) as fp:\n+        data = fp.read()\n+    assert data.split()[0] == \"600\"\n+    uid = os.getuid()\n+    gid = os.getgid()\n+    assert data.split()[1] == grp.getgrgid(gid).gr_name\n+    assert data.split()[2] == pwd.getpwuid(uid).pw_name"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/saltstack/salt/commits/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4",
        "url": "https://api.github.com/repos/saltstack/salt/commits/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4",
        "html_url": "https://github.com/saltstack/salt/commit/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4",
        "message": "Fix CVE-2023-34049",
        "files": [
            {
                "sha": "6b0ca190a2773b03aef452dfbdc78dbcfa2a1aab",
                "filename": "changelog/cve-2023-34049.security.md",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/saltstack/salt/blob/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4/changelog%2Fcve-2023-34049.security.md",
                "raw_url": "https://github.com/saltstack/salt/raw/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4/changelog%2Fcve-2023-34049.security.md",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/changelog%2Fcve-2023-34049.security.md?ref=7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4",
                "patch": "@@ -0,0 +1,2 @@\n+Fix CVE-2023-34049 by ensuring we do not use a predictable name for the script and correctly check returncode of scp command.\n+This only impacts salt-ssh users using the pre-flight option."
            },
            {
                "sha": "e9c290e13ff4ee9392dce76476b0e34a4793c51a",
                "filename": "salt/client/ssh/__init__.py",
                "status": "modified",
                "additions": 44,
                "deletions": 12,
                "changes": 56,
                "blob_url": "https://github.com/saltstack/salt/blob/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4/salt%2Fclient%2Fssh%2F__init__.py",
                "raw_url": "https://github.com/saltstack/salt/raw/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4/salt%2Fclient%2Fssh%2F__init__.py",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/salt%2Fclient%2Fssh%2F__init__.py?ref=7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4",
                "patch": "@@ -11,9 +11,11 @@\n import logging\n import multiprocessing\n import os\n+import pathlib\n import queue\n import re\n import shlex\n+import shutil\n import subprocess\n import sys\n import tarfile\n@@ -467,7 +469,14 @@ def key_deploy(self, host, ret):\n             if target.get(\"passwd\", False) or self.opts[\"ssh_passwd\"]:\n                 self._key_deploy_run(host, target, False)\n             return ret\n-        if ret[host].get(\"stderr\", \"\").count(\"Permission denied\"):\n+        stderr = ret[host].get(\"stderr\", \"\")\n+        # -failed to upload file- is detecting scp errors\n+        # Errors to ignore when Permission denied is in the stderr. For example\n+        # scp can get a permission denied on the target host, but they where\n+        # able to accurate authenticate against the box\n+        ignore_err = [\"failed to upload file\"]\n+        check_err = [x for x in ignore_err if stderr.count(x)]\n+        if \"Permission denied\" in stderr and not check_err:\n             target = self.targets[host]\n             # permission denied, attempt to auto deploy ssh key\n             print(\n@@ -1007,11 +1016,32 @@ def run_ssh_pre_flight(self):\n         \"\"\"\n         Run our pre_flight script before running any ssh commands\n         \"\"\"\n-        script = os.path.join(tempfile.gettempdir(), self.ssh_pre_file)\n-\n-        self.shell.send(self.ssh_pre_flight, script)\n+        with tempfile.NamedTemporaryFile() as temp:\n+            # ensure we use copyfile to not copy the file attributes\n+            # we want to ensure we use the perms set by the secure\n+            # NamedTemporaryFile\n+            try:\n+                shutil.copyfile(self.ssh_pre_flight, temp.name)\n+            except OSError as err:\n+                return (\n+                    \"\",\n+                    f\"Could not copy pre flight script {self.ssh_pre_flight} to temporary path\",\n+                    1,\n+                )\n+            target_script = f\".{pathlib.Path(temp.name).name}\"\n+            log.trace(f\"Copying the pre flight script {self.ssh_pre_file} to target\")\n+            stdout, stderr, retcode = self.shell.send(temp.name, target_script)\n+            if retcode != 0:\n+                # We could not copy the script to the target\n+                log.error(\n+                    f\"Could not copy the pre flight script {self.ssh_pre_file} to target\"\n+                )\n+                return stdout, stderr, retcode\n \n-        return self.execute_script(script, script_args=self.ssh_pre_flight_args)\n+            log.trace(f\"Executing the pre flight script {self.ssh_pre_file} on target\")\n+            return self.execute_script(\n+                target_script, script_args=self.ssh_pre_flight_args\n+            )\n \n     def check_thin_dir(self):\n         \"\"\"\n@@ -1388,18 +1418,20 @@ def shim_cmd(self, cmd_str, extension=\"py\"):\n             return self.shell.exec_cmd(cmd_str)\n \n         # Write the shim to a temporary file in the default temp directory\n-        with tempfile.NamedTemporaryFile(\n-            mode=\"w+b\", prefix=\"shim_\", delete=False\n-        ) as shim_tmp_file:\n+        with tempfile.NamedTemporaryFile(mode=\"w+b\", delete=False) as shim_tmp_file:\n             shim_tmp_file.write(salt.utils.stringutils.to_bytes(cmd_str))\n \n         # Copy shim to target system, under $HOME/.<randomized name>\n-        target_shim_file = \".{}.{}\".format(\n-            binascii.hexlify(os.urandom(6)).decode(\"ascii\"), extension\n-        )\n+        target_shim_file = f\".{pathlib.Path(shim_tmp_file.name).name}\"\n+\n         if self.winrm:\n             target_shim_file = saltwinshell.get_target_shim_file(self, target_shim_file)\n-        self.shell.send(shim_tmp_file.name, target_shim_file, makedirs=True)\n+        stdout, stderr, retcode = self.shell.send(\n+            shim_tmp_file.name, target_shim_file, makedirs=True\n+        )\n+        if retcode != 0:\n+            log.error(f\"Could not copy the shim script to target\")\n+            return stdout, stderr, retcode\n \n         # Remove our shim file\n         try:"
            },
            {
                "sha": "91c5e7db914c20dc0163e2de2a40d790d6c1e965",
                "filename": "tests/pytests/unit/client/ssh/test_single.py",
                "status": "modified",
                "additions": 260,
                "deletions": 39,
                "changes": 299,
                "blob_url": "https://github.com/saltstack/salt/blob/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_single.py",
                "raw_url": "https://github.com/saltstack/salt/raw/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_single.py",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_single.py?ref=7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4",
                "patch": "@@ -1,6 +1,5 @@\n-import os\n+import logging\n import re\n-import tempfile\n from textwrap import dedent\n \n import pytest\n@@ -16,6 +15,8 @@\n from salt.client import ssh\n from tests.support.mock import MagicMock, call, patch\n \n+log = logging.getLogger(__name__)\n+\n \n @pytest.fixture\n def opts(tmp_path):\n@@ -59,7 +60,7 @@ def test_single_opts(opts, target):\n         fsclient=None,\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n-        **target\n+        **target,\n     )\n \n     assert single.shell._ssh_opts() == \"\"\n@@ -87,7 +88,7 @@ def test_run_with_pre_flight(opts, target, tmp_path):\n         fsclient=None,\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n-        **target\n+        **target,\n     )\n \n     cmd_ret = (\"Success\", \"\", 0)\n@@ -122,7 +123,7 @@ def test_run_with_pre_flight_with_args(opts, target, tmp_path):\n         fsclient=None,\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n-        **target\n+        **target,\n     )\n \n     cmd_ret = (\"Success\", \"foobar\", 0)\n@@ -156,7 +157,7 @@ def test_run_with_pre_flight_stderr(opts, target, tmp_path):\n         fsclient=None,\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n-        **target\n+        **target,\n     )\n \n     cmd_ret = (\"\", \"Error running script\", 1)\n@@ -190,7 +191,7 @@ def test_run_with_pre_flight_script_doesnot_exist(opts, target, tmp_path):\n         fsclient=None,\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n-        **target\n+        **target,\n     )\n \n     cmd_ret = (\"Success\", \"\", 0)\n@@ -224,7 +225,7 @@ def test_run_with_pre_flight_thin_dir_exists(opts, target, tmp_path):\n         fsclient=None,\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n-        **target\n+        **target,\n     )\n \n     cmd_ret = (\"\", \"\", 0)\n@@ -242,6 +243,39 @@ def test_run_with_pre_flight_thin_dir_exists(opts, target, tmp_path):\n         assert ret == cmd_ret\n \n \n+def test_run_ssh_pre_flight(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight function\n+    \"\"\"\n+    target[\"ssh_pre_flight\"] = str(tmp_path / \"script.sh\")\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    cmd_ret = (\"Success\", \"\", 0)\n+    mock_flight = MagicMock(return_value=cmd_ret)\n+    mock_cmd = MagicMock(return_value=cmd_ret)\n+    patch_flight = patch(\"salt.client.ssh.Single.run_ssh_pre_flight\", mock_flight)\n+    patch_cmd = patch(\"salt.client.ssh.Single.cmd_block\", mock_cmd)\n+    patch_exec_cmd = patch(\n+        \"salt.client.ssh.shell.Shell.exec_cmd\", return_value=(\"\", \"\", 1)\n+    )\n+    patch_os = patch(\"os.path.exists\", side_effect=[True])\n+\n+    with patch_os, patch_flight, patch_cmd, patch_exec_cmd:\n+        ret = single.run()\n+        mock_cmd.assert_called()\n+        mock_flight.assert_called()\n+        assert ret == cmd_ret\n+\n+\n def test_execute_script(opts, target, tmp_path):\n     \"\"\"\n     test Single.execute_script()\n@@ -255,7 +289,7 @@ def test_execute_script(opts, target, tmp_path):\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n         winrm=False,\n-        **target\n+        **target,\n     )\n \n     exp_ret = (\"Success\", \"\", 0)\n@@ -273,7 +307,7 @@ def test_execute_script(opts, target, tmp_path):\n         ] == mock_cmd.call_args_list\n \n \n-def test_shim_cmd(opts, target):\n+def test_shim_cmd(opts, target, tmp_path):\n     \"\"\"\n     test Single.shim_cmd()\n     \"\"\"\n@@ -287,29 +321,32 @@ def test_shim_cmd(opts, target):\n         mine=False,\n         winrm=False,\n         tty=True,\n-        **target\n+        **target,\n     )\n \n     exp_ret = (\"Success\", \"\", 0)\n     mock_cmd = MagicMock(return_value=exp_ret)\n     patch_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_cmd)\n     patch_send = patch(\"salt.client.ssh.shell.Shell.send\", return_value=(\"\", \"\", 0))\n     patch_rand = patch(\"os.urandom\", return_value=b\"5\\xd9l\\xca\\xc2\\xff\")\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n \n-    with patch_cmd, patch_rand, patch_send:\n+    with patch_cmd, patch_tmp, patch_send:\n         ret = single.shim_cmd(cmd_str=\"echo test\")\n         assert ret == exp_ret\n         assert [\n-            call(\"/bin/sh '.35d96ccac2ff.py'\"),\n-            call(\"rm '.35d96ccac2ff.py'\"),\n+            call(f\"/bin/sh '.{tmp_file.name}'\"),\n+            call(f\"rm '.{tmp_file.name}'\"),\n         ] == mock_cmd.call_args_list\n \n \n-def test_run_ssh_pre_flight(opts, target, tmp_path):\n+def test_shim_cmd_copy_fails(opts, target, caplog):\n     \"\"\"\n-    test Single.run_ssh_pre_flight\n+    test Single.shim_cmd() when copying the file fails\n     \"\"\"\n-    target[\"ssh_pre_flight\"] = str(tmp_path / \"script.sh\")\n     single = ssh.Single(\n         opts,\n         opts[\"argv\"],\n@@ -320,24 +357,205 @@ def test_run_ssh_pre_flight(opts, target, tmp_path):\n         mine=False,\n         winrm=False,\n         tty=True,\n-        **target\n+        **target,\n     )\n \n-    exp_ret = (\"Success\", \"\", 0)\n-    mock_cmd = MagicMock(return_value=exp_ret)\n+    ret_cmd = (\"Success\", \"\", 0)\n+    mock_cmd = MagicMock(return_value=ret_cmd)\n     patch_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_cmd)\n-    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", return_value=exp_ret)\n-    exp_tmp = os.path.join(\n-        tempfile.gettempdir(), os.path.basename(target[\"ssh_pre_flight\"])\n+    ret_send = (\"\", \"General error in file copy\", 1)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", return_value=ret_send)\n+    patch_rand = patch(\"os.urandom\", return_value=b\"5\\xd9l\\xca\\xc2\\xff\")\n+\n+    with patch_cmd, patch_rand, patch_send:\n+        ret = single.shim_cmd(cmd_str=\"echo test\")\n+        assert ret == ret_send\n+        assert \"Could not copy the shim script to target\" in caplog.text\n+        mock_cmd.assert_not_called()\n+\n+\n+def test_run_ssh_pre_flight_no_connect(opts, target, tmp_path, caplog):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight when you\n+    cannot connect to the target\n+    \"\"\"\n+    pre_flight = tmp_path / \"script.sh\"\n+    pre_flight.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight)\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+    mock_exec_cmd = MagicMock(return_value=(\"\", \"\", 1))\n+    patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n+    ret_send = (\n+        \"\",\n+        \"ssh: connect to host 192.168.1.186 port 22: No route to host\\nscp: Connection closed\\n\",\n+        255,\n+    )\n+    send_mock = MagicMock(return_value=ret_send)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", send_mock)\n+\n+    with caplog.at_level(logging.TRACE):\n+        with patch_send, patch_exec_cmd, patch_tmp:\n+            ret = single.run_ssh_pre_flight()\n+    assert f\"Copying the pre flight script {pre_flight.name}\" in caplog.text\n+    assert (\n+        f\"Could not copy the pre flight script {pre_flight.name} to target\"\n+        in caplog.text\n+    )\n+    assert ret == ret_send\n+    assert send_mock.call_args_list[0][0][0] == tmp_file\n+    target_script = send_mock.call_args_list[0][0][1]\n+    assert re.search(r\".[a-z0-9]+\", target_script)\n+    mock_exec_cmd.assert_not_called()\n+\n+\n+def test_run_ssh_pre_flight_permission_denied(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight when you\n+    cannot copy script to the target due to\n+    a permission denied error\n+    \"\"\"\n+    pre_flight = tmp_path / \"script.sh\"\n+    pre_flight.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight)\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+    mock_exec_cmd = MagicMock(return_value=(\"\", \"\", 1))\n+    patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n+    ret_send = (\n+        \"\",\n+        'scp: dest open \"/tmp/preflight.sh\": Permission denied\\nscp: failed to upload file /etc/salt/preflight.sh to /tmp/preflight.sh\\n',\n+        255,\n     )\n+    send_mock = MagicMock(return_value=ret_send)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", send_mock)\n \n-    with patch_cmd, patch_send:\n+    with patch_send, patch_exec_cmd, patch_tmp:\n         ret = single.run_ssh_pre_flight()\n-        assert ret == exp_ret\n-        assert [\n-            call(\"/bin/sh '{}'\".format(exp_tmp)),\n-            call(\"rm '{}'\".format(exp_tmp)),\n-        ] == mock_cmd.call_args_list\n+    assert ret == ret_send\n+    assert send_mock.call_args_list[0][0][0] == tmp_file\n+    target_script = send_mock.call_args_list[0][0][1]\n+    assert re.search(r\".[a-z0-9]+\", target_script)\n+    mock_exec_cmd.assert_not_called()\n+\n+\n+def test_run_ssh_pre_flight_connect(opts, target, tmp_path, caplog):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight when you\n+    can connect to the target\n+    \"\"\"\n+    pre_flight = tmp_path / \"script.sh\"\n+    pre_flight.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight)\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+    ret_exec_cmd = (\"\", \"\", 1)\n+    mock_exec_cmd = MagicMock(return_value=ret_exec_cmd)\n+    patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n+    ret_send = (\n+        \"\",\n+        \"\\rroot@192.168.1.187's password: \\n\\rpreflight.sh 0%    0 0.0KB/s   --:-- ETA\\rpreflight.sh 100%   20     2.7KB/s   00:00 \\n\",\n+        0,\n+    )\n+    send_mock = MagicMock(return_value=ret_send)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", send_mock)\n+\n+    with caplog.at_level(logging.TRACE):\n+        with patch_send, patch_exec_cmd, patch_tmp:\n+            ret = single.run_ssh_pre_flight()\n+\n+    assert f\"Executing the pre flight script {pre_flight.name} on target\" in caplog.text\n+    assert ret == ret_exec_cmd\n+    assert send_mock.call_args_list[0][0][0] == tmp_file\n+    target_script = send_mock.call_args_list[0][0][1]\n+    assert re.search(r\".[a-z0-9]+\", target_script)\n+    mock_exec_cmd.assert_called()\n+\n+\n+def test_run_ssh_pre_flight_shutil_fails(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight when cannot\n+    copyfile with shutil\n+    \"\"\"\n+    pre_flight = tmp_path / \"script.sh\"\n+    pre_flight.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight)\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+    ret_exec_cmd = (\"\", \"\", 1)\n+    mock_exec_cmd = MagicMock(return_value=ret_exec_cmd)\n+    patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n+    send_mock = MagicMock()\n+    mock_shutil = MagicMock(side_effect=IOError(\"Permission Denied\"))\n+    patch_shutil = patch(\"shutil.copyfile\", mock_shutil)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", send_mock)\n+\n+    with patch_send, patch_exec_cmd, patch_tmp, patch_shutil:\n+        ret = single.run_ssh_pre_flight()\n+\n+    assert ret == (\n+        \"\",\n+        f\"Could not copy pre flight script {pre_flight} to temporary path\",\n+        1,\n+    )\n+    mock_exec_cmd.assert_not_called()\n+    send_mock.assert_not_called()\n \n \n @pytest.mark.skip_on_windows(reason=\"SSH_PY_SHIM not set on windows\")\n@@ -355,7 +573,7 @@ def test_cmd_run_set_path(opts, target):\n         fsclient=None,\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n-        **target\n+        **target,\n     )\n \n     ret = single._cmd_str()\n@@ -376,7 +594,7 @@ def test_cmd_run_not_set_path(opts, target):\n         fsclient=None,\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n-        **target\n+        **target,\n     )\n \n     ret = single._cmd_str()\n@@ -395,7 +613,7 @@ def test_cmd_block_python_version_error(opts, target):\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n         winrm=False,\n-        **target\n+        **target,\n     )\n     mock_shim = MagicMock(\n         return_value=((\"\", \"ERROR: Unable to locate appropriate python command\\n\", 10))\n@@ -434,7 +652,9 @@ def test_run_with_pre_flight_args(opts, target, test_opts, tmp_path):\n     and script successfully runs\n     \"\"\"\n     opts[\"ssh_run_pre_flight\"] = True\n-    target[\"ssh_pre_flight\"] = str(tmp_path / \"script.sh\")\n+    pre_flight_script = tmp_path / \"script.sh\"\n+    pre_flight_script.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight_script)\n \n     if test_opts[0] is not None:\n         target[\"ssh_pre_flight_args\"] = test_opts[0]\n@@ -448,22 +668,23 @@ def test_run_with_pre_flight_args(opts, target, test_opts, tmp_path):\n         fsclient=None,\n         thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n         mine=False,\n-        **target\n+        **target,\n     )\n \n     cmd_ret = (\"Success\", \"\", 0)\n     mock_cmd = MagicMock(return_value=cmd_ret)\n     mock_exec_cmd = MagicMock(return_value=(\"\", \"\", 0))\n     patch_cmd = patch(\"salt.client.ssh.Single.cmd_block\", mock_cmd)\n     patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n-    patch_shell_send = patch(\"salt.client.ssh.shell.Shell.send\", return_value=None)\n+    patch_shell_send = patch(\n+        \"salt.client.ssh.shell.Shell.send\", return_value=(\"\", \"\", 0)\n+    )\n     patch_os = patch(\"os.path.exists\", side_effect=[True])\n \n     with patch_os, patch_cmd, patch_exec_cmd, patch_shell_send:\n-        ret = single.run()\n-        assert mock_exec_cmd.mock_calls[0].args[\n-            0\n-        ] == \"/bin/sh '/tmp/script.sh'{}\".format(expected_args)\n+        single.run()\n+        script_args = mock_exec_cmd.mock_calls[0].args[0]\n+        assert re.search(r\"\\/bin\\/sh '.[a-z0-9]+\", script_args)\n \n \n @pytest.mark.slow_test"
            },
            {
                "sha": "329448919285cc6402de2e353f920b8aa8341eb5",
                "filename": "tests/pytests/unit/client/ssh/test_ssh.py",
                "status": "modified",
                "additions": 110,
                "deletions": 0,
                "changes": 110,
                "blob_url": "https://github.com/saltstack/salt/blob/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_ssh.py",
                "raw_url": "https://github.com/saltstack/salt/raw/7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_ssh.py",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_ssh.py?ref=7a14112f2a16ce70e3c3e1862c92e37af5f2c7a4",
                "patch": "@@ -339,3 +339,113 @@ def test_extra_filerefs(tmp_path, opts):\n     with patch(\"salt.roster.get_roster_file\", MagicMock(return_value=roster)):\n         ssh_obj = client._prep_ssh(**ssh_opts)\n         assert ssh_obj.opts.get(\"extra_filerefs\", None) == \"salt://foobar\"\n+\n+\n+def test_key_deploy_permission_denied_scp(tmp_path, opts):\n+    \"\"\"\n+    test \"key_deploy\" function when\n+    permission denied authentication error\n+    when attempting to use scp to copy file\n+    to target\n+    \"\"\"\n+    host = \"localhost\"\n+    passwd = \"password\"\n+    usr = \"ssh-usr\"\n+    opts[\"ssh_user\"] = usr\n+    opts[\"tgt\"] = host\n+\n+    ssh_ret = {\n+        host: {\n+            \"stdout\": \"\\rroot@192.168.1.187's password: \\n\\rroot@192.168.1.187's password: \\n\\rroot@192.168.1.187's password: \\n\",\n+            \"stderr\": \"Permission denied, please try again.\\nPermission denied, please try again.\\nroot@192.168.1.187: Permission denied (publickey,gssapi-keyex,gssapi-with-micimport pudb; pu.dbassword).\\nscp: Connection closed\\n\",\n+            \"retcode\": 255,\n+        }\n+    }\n+    key_run_ret = {\n+        \"localhost\": {\n+            \"jid\": \"20230922155652279959\",\n+            \"return\": \"test\",\n+            \"retcode\": 0,\n+            \"id\": \"test\",\n+            \"fun\": \"cmd.run\",\n+            \"fun_args\": [\"echo test\"],\n+        }\n+    }\n+    patch_roster_file = patch(\"salt.roster.get_roster_file\", MagicMock(return_value=\"\"))\n+    with patch_roster_file:\n+        client = ssh.SSH(opts)\n+    patch_input = patch(\"builtins.input\", side_effect=[\"y\"])\n+    patch_getpass = patch(\"getpass.getpass\", return_value=[\"password\"])\n+    mock_key_run = MagicMock(return_value=key_run_ret)\n+    patch_key_run = patch(\"salt.client.ssh.SSH._key_deploy_run\", mock_key_run)\n+    with patch_input, patch_getpass, patch_key_run:\n+        ret = client.key_deploy(host, ssh_ret)\n+    assert mock_key_run.call_args_list[0][0] == (\n+        host,\n+        {\"passwd\": [passwd], \"host\": host, \"user\": usr},\n+        True,\n+    )\n+    assert ret == key_run_ret\n+    assert mock_key_run.call_count == 1\n+\n+\n+def test_key_deploy_permission_denied_file_scp(tmp_path, opts):\n+    \"\"\"\n+    test \"key_deploy\" function when permission denied\n+    due to not having access to copy the file to the target\n+    We do not want to deploy the key, because this is not\n+    an authentication to the target error.\n+    \"\"\"\n+    host = \"localhost\"\n+    passwd = \"password\"\n+    usr = \"ssh-usr\"\n+    opts[\"ssh_user\"] = usr\n+    opts[\"tgt\"] = host\n+\n+    mock_key_run = MagicMock(return_value=False)\n+    patch_key_run = patch(\"salt.client.ssh.SSH._key_deploy_run\", mock_key_run)\n+\n+    ssh_ret = {\n+        \"localhost\": {\n+            \"stdout\": \"\",\n+            \"stderr\": 'scp: dest open \"/tmp/preflight.sh\": Permission denied\\nscp: failed to upload file /etc/salt/preflight.sh to /tmp/preflight.sh\\n',\n+            \"retcode\": 1,\n+        }\n+    }\n+    patch_roster_file = patch(\"salt.roster.get_roster_file\", MagicMock(return_value=\"\"))\n+    with patch_roster_file:\n+        client = ssh.SSH(opts)\n+    ret = client.key_deploy(host, ssh_ret)\n+    assert ret == ssh_ret\n+    assert mock_key_run.call_count == 0\n+\n+\n+def test_key_deploy_no_permission_denied(tmp_path, opts):\n+    \"\"\"\n+    test \"key_deploy\" function when no permission denied\n+    is returned\n+    \"\"\"\n+    host = \"localhost\"\n+    passwd = \"password\"\n+    usr = \"ssh-usr\"\n+    opts[\"ssh_user\"] = usr\n+    opts[\"tgt\"] = host\n+\n+    mock_key_run = MagicMock(return_value=False)\n+    patch_key_run = patch(\"salt.client.ssh.SSH._key_deploy_run\", mock_key_run)\n+    ssh_ret = {\n+        \"localhost\": {\n+            \"jid\": \"20230922161937998385\",\n+            \"return\": \"test\",\n+            \"retcode\": 0,\n+            \"id\": \"test\",\n+            \"fun\": \"cmd.run\",\n+            \"fun_args\": [\"echo test\"],\n+        }\n+    }\n+    patch_roster_file = patch(\"salt.roster.get_roster_file\", MagicMock(return_value=\"\"))\n+    with patch_roster_file:\n+        client = ssh.SSH(opts)\n+    ret = client.key_deploy(host, ssh_ret)\n+    assert ret == ssh_ret\n+    assert mock_key_run.call_count == 0"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/saltstack/salt/commits/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce",
        "url": "https://api.github.com/repos/saltstack/salt/commits/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce",
        "html_url": "https://github.com/saltstack/salt/commit/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce",
        "message": "Fix CVE-2023-34049",
        "files": [
            {
                "sha": "6b0ca190a2773b03aef452dfbdc78dbcfa2a1aab",
                "filename": "changelog/cve-2023-34049.security",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/saltstack/salt/blob/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce/changelog%2Fcve-2023-34049.security",
                "raw_url": "https://github.com/saltstack/salt/raw/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce/changelog%2Fcve-2023-34049.security",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/changelog%2Fcve-2023-34049.security?ref=8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce",
                "patch": "@@ -0,0 +1,2 @@\n+Fix CVE-2023-34049 by ensuring we do not use a predictable name for the script and correctly check returncode of scp command.\n+This only impacts salt-ssh users using the pre-flight option."
            },
            {
                "sha": "1c25942d90a6aacad9fc8ef66d2624c15bb5d1c9",
                "filename": "salt/client/ssh/__init__.py",
                "status": "modified",
                "additions": 50,
                "deletions": 18,
                "changes": 68,
                "blob_url": "https://github.com/saltstack/salt/blob/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce/salt%2Fclient%2Fssh%2F__init__.py",
                "raw_url": "https://github.com/saltstack/salt/raw/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce/salt%2Fclient%2Fssh%2F__init__.py",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/salt%2Fclient%2Fssh%2F__init__.py?ref=8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce",
                "patch": "@@ -11,9 +11,11 @@\n import logging\n import multiprocessing\n import os\n+import pathlib\n import queue\n import re\n import shlex\n+import shutil\n import subprocess\n import sys\n import tarfile\n@@ -467,7 +469,14 @@ def key_deploy(self, host, ret):\n             if target.get(\"passwd\", False) or self.opts[\"ssh_passwd\"]:\n                 self._key_deploy_run(host, target, False)\n             return ret\n-        if ret[host].get(\"stderr\", \"\").count(\"Permission denied\"):\n+        stderr = ret[host].get(\"stderr\", \"\")\n+        # -failed to upload file- is detecting scp errors\n+        # Errors to ignore when Permission denied is in the stderr. For example\n+        # scp can get a permission denied on the target host, but they where\n+        # able to accurate authenticate against the box\n+        ignore_err = [\"failed to upload file\"]\n+        check_err = [x for x in ignore_err if stderr.count(x)]\n+        if \"Permission denied\" in stderr and not check_err:\n             target = self.targets[host]\n             # permission denied, attempt to auto deploy ssh key\n             print(\n@@ -500,7 +509,7 @@ def _key_deploy_run(self, host, target, re_run=True):\n             mods=self.mods,\n             fsclient=self.fsclient,\n             thin=self.thin,\n-            **target\n+            **target,\n         )\n         if salt.utils.path.which(\"ssh-copy-id\"):\n             # we have ssh-copy-id, use it!\n@@ -516,7 +525,7 @@ def _key_deploy_run(self, host, target, re_run=True):\n                 mods=self.mods,\n                 fsclient=self.fsclient,\n                 thin=self.thin,\n-                **target\n+                **target,\n             )\n             stdout, stderr, retcode = single.cmd_block()\n             try:\n@@ -543,7 +552,7 @@ def handle_routine(self, que, opts, host, target, mine=False):\n             fsclient=self.fsclient,\n             thin=self.thin,\n             mine=mine,\n-            **target\n+            **target,\n         )\n         ret = {\"id\": single.id}\n         stdout, stderr, retcode = single.run()\n@@ -883,7 +892,7 @@ def __init__(\n         remote_port_forwards=None,\n         winrm=False,\n         ssh_options=None,\n-        **kwargs\n+        **kwargs,\n     ):\n         # Get mine setting and mine_functions if defined in kwargs (from roster)\n         self.mine = mine\n@@ -1007,11 +1016,32 @@ def run_ssh_pre_flight(self):\n         \"\"\"\n         Run our pre_flight script before running any ssh commands\n         \"\"\"\n-        script = os.path.join(tempfile.gettempdir(), self.ssh_pre_file)\n-\n-        self.shell.send(self.ssh_pre_flight, script)\n+        with tempfile.NamedTemporaryFile() as temp:\n+            # ensure we use copyfile to not copy the file attributes\n+            # we want to ensure we use the perms set by the secure\n+            # NamedTemporaryFile\n+            try:\n+                shutil.copyfile(self.ssh_pre_flight, temp.name)\n+            except OSError as err:\n+                return (\n+                    \"\",\n+                    f\"Could not copy pre flight script {self.ssh_pre_flight} to temporary path\",\n+                    1,\n+                )\n+            target_script = f\".{pathlib.Path(temp.name).name}\"\n+            log.trace(f\"Copying the pre flight script {self.ssh_pre_file} to target\")\n+            stdout, stderr, retcode = self.shell.send(temp.name, target_script)\n+            if retcode != 0:\n+                # We could not copy the script to the target\n+                log.error(\n+                    f\"Could not copy the pre flight script {self.ssh_pre_file} to target\"\n+                )\n+                return stdout, stderr, retcode\n \n-        return self.execute_script(script, script_args=self.ssh_pre_flight_args)\n+            log.trace(f\"Executing the pre flight script {self.ssh_pre_file} on target\")\n+            return self.execute_script(\n+                target_script, script_args=self.ssh_pre_flight_args\n+            )\n \n     def check_thin_dir(self):\n         \"\"\"\n@@ -1131,7 +1161,7 @@ def run_wfunc(self):\n                 self.id,\n                 fsclient=self.fsclient,\n                 minion_opts=self.minion_opts,\n-                **self.target\n+                **self.target,\n             )\n \n             opts_pkg = pre_wrapper[\"test.opts_pkg\"]()  # pylint: disable=E1102\n@@ -1210,7 +1240,7 @@ def run_wfunc(self):\n             self.id,\n             fsclient=self.fsclient,\n             minion_opts=self.minion_opts,\n-            **self.target\n+            **self.target,\n         )\n         wrapper.fsclient.opts[\"cachedir\"] = opts[\"cachedir\"]\n         self.wfuncs = salt.loader.ssh_wrapper(opts, wrapper, self.context)\n@@ -1381,18 +1411,20 @@ def shim_cmd(self, cmd_str, extension=\"py\"):\n             return self.shell.exec_cmd(cmd_str)\n \n         # Write the shim to a temporary file in the default temp directory\n-        with tempfile.NamedTemporaryFile(\n-            mode=\"w+b\", prefix=\"shim_\", delete=False\n-        ) as shim_tmp_file:\n+        with tempfile.NamedTemporaryFile(mode=\"w+b\", delete=False) as shim_tmp_file:\n             shim_tmp_file.write(salt.utils.stringutils.to_bytes(cmd_str))\n \n         # Copy shim to target system, under $HOME/.<randomized name>\n-        target_shim_file = \".{}.{}\".format(\n-            binascii.hexlify(os.urandom(6)).decode(\"ascii\"), extension\n-        )\n+        target_shim_file = f\".{pathlib.Path(shim_tmp_file.name).name}\"\n+\n         if self.winrm:\n             target_shim_file = saltwinshell.get_target_shim_file(self, target_shim_file)\n-        self.shell.send(shim_tmp_file.name, target_shim_file, makedirs=True)\n+        stdout, stderr, retcode = self.shell.send(\n+            shim_tmp_file.name, target_shim_file, makedirs=True\n+        )\n+        if retcode != 0:\n+            log.error(f\"Could not copy the shim script to target\")\n+            return stdout, stderr, retcode\n \n         # Remove our shim file\n         try:"
            },
            {
                "sha": "912c8cccec0cf04dd31c79514a4009e5a4684b30",
                "filename": "tests/pytests/unit/client/ssh/test_single.py",
                "status": "added",
                "additions": 820,
                "deletions": 0,
                "changes": 820,
                "blob_url": "https://github.com/saltstack/salt/blob/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_single.py",
                "raw_url": "https://github.com/saltstack/salt/raw/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_single.py",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_single.py?ref=8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce",
                "patch": "@@ -0,0 +1,820 @@\n+import logging\n+import re\n+from textwrap import dedent\n+\n+import pytest\n+import salt.client.ssh.client\n+import salt.config\n+import salt.roster\n+import salt.utils.files\n+import salt.utils.path\n+import salt.utils.platform\n+import salt.utils.thin\n+import salt.utils.yaml\n+from salt.client import ssh\n+from tests.support.mock import MagicMock, call, patch\n+\n+log = logging.getLogger(__name__)\n+\n+\n+@pytest.fixture\n+def opts(tmp_path):\n+    return {\n+        \"argv\": [\n+            \"ssh.set_auth_key\",\n+            \"root\",\n+            \"hobn+amNAXSBTiOXEqlBjGB...rsa root@master\",\n+        ],\n+        \"__role\": \"master\",\n+        \"cachedir\": str(tmp_path),\n+        \"extension_modules\": str(tmp_path / \"extmods\"),\n+    }\n+\n+\n+@pytest.fixture\n+def target():\n+    return {\n+        \"passwd\": \"abc123\",\n+        \"ssh_options\": None,\n+        \"sudo\": False,\n+        \"identities_only\": False,\n+        \"host\": \"login1\",\n+        \"user\": \"root\",\n+        \"timeout\": 65,\n+        \"remote_port_forwards\": None,\n+        \"sudo_user\": \"\",\n+        \"port\": \"22\",\n+        \"priv\": \"/etc/salt/pki/master/ssh/salt-ssh.rsa\",\n+    }\n+\n+\n+def test_single_opts(opts, target):\n+    \"\"\"Sanity check for ssh.Single options\"\"\"\n+\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    assert single.shell._ssh_opts() == \"\"\n+    expected_cmd = (\n+        \"ssh login1 \"\n+        \"-o KbdInteractiveAuthentication=no -o \"\n+        \"PasswordAuthentication=yes -o ConnectTimeout=65 -o Port=22 \"\n+        \"-o IdentityFile=/etc/salt/pki/master/ssh/salt-ssh.rsa \"\n+        \"-o User=root  date +%s\"\n+    )\n+    assert single.shell._cmd_str(\"date +%s\") == expected_cmd\n+\n+\n+def test_run_with_pre_flight(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run() when ssh_pre_flight is set\n+    and script successfully runs\n+    \"\"\"\n+    target[\"ssh_pre_flight\"] = str(tmp_path / \"script.sh\")\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    cmd_ret = (\"Success\", \"\", 0)\n+    mock_flight = MagicMock(return_value=cmd_ret)\n+    mock_cmd = MagicMock(return_value=cmd_ret)\n+    patch_flight = patch(\"salt.client.ssh.Single.run_ssh_pre_flight\", mock_flight)\n+    patch_cmd = patch(\"salt.client.ssh.Single.cmd_block\", mock_cmd)\n+    patch_exec_cmd = patch(\n+        \"salt.client.ssh.shell.Shell.exec_cmd\", return_value=(\"\", \"\", 1)\n+    )\n+    patch_os = patch(\"os.path.exists\", side_effect=[True])\n+\n+    with patch_os, patch_flight, patch_cmd, patch_exec_cmd:\n+        ret = single.run()\n+        mock_cmd.assert_called()\n+        mock_flight.assert_called()\n+        assert ret == cmd_ret\n+\n+\n+def test_run_with_pre_flight_with_args(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run() when ssh_pre_flight is set\n+    and script successfully runs\n+    \"\"\"\n+    target[\"ssh_pre_flight\"] = str(tmp_path / \"script.sh\")\n+    target[\"ssh_pre_flight_args\"] = \"foobar\"\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    cmd_ret = (\"Success\", \"foobar\", 0)\n+    mock_flight = MagicMock(return_value=cmd_ret)\n+    mock_cmd = MagicMock(return_value=cmd_ret)\n+    patch_flight = patch(\"salt.client.ssh.Single.run_ssh_pre_flight\", mock_flight)\n+    patch_cmd = patch(\"salt.client.ssh.Single.cmd_block\", mock_cmd)\n+    patch_exec_cmd = patch(\n+        \"salt.client.ssh.shell.Shell.exec_cmd\", return_value=(\"\", \"\", 1)\n+    )\n+    patch_os = patch(\"os.path.exists\", side_effect=[True])\n+\n+    with patch_os, patch_flight, patch_cmd, patch_exec_cmd:\n+        ret = single.run()\n+        mock_cmd.assert_called()\n+        mock_flight.assert_called()\n+        assert ret == cmd_ret\n+\n+\n+def test_run_with_pre_flight_stderr(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run() when ssh_pre_flight is set\n+    and script errors when run\n+    \"\"\"\n+    target[\"ssh_pre_flight\"] = str(tmp_path / \"script.sh\")\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    cmd_ret = (\"\", \"Error running script\", 1)\n+    mock_flight = MagicMock(return_value=cmd_ret)\n+    mock_cmd = MagicMock(return_value=cmd_ret)\n+    patch_flight = patch(\"salt.client.ssh.Single.run_ssh_pre_flight\", mock_flight)\n+    patch_cmd = patch(\"salt.client.ssh.Single.cmd_block\", mock_cmd)\n+    patch_exec_cmd = patch(\n+        \"salt.client.ssh.shell.Shell.exec_cmd\", return_value=(\"\", \"\", 1)\n+    )\n+    patch_os = patch(\"os.path.exists\", side_effect=[True])\n+\n+    with patch_os, patch_flight, patch_cmd, patch_exec_cmd:\n+        ret = single.run()\n+        mock_cmd.assert_not_called()\n+        mock_flight.assert_called()\n+        assert ret == cmd_ret\n+\n+\n+def test_run_with_pre_flight_script_doesnot_exist(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run() when ssh_pre_flight is set\n+    and the script does not exist\n+    \"\"\"\n+    target[\"ssh_pre_flight\"] = str(tmp_path / \"script.sh\")\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    cmd_ret = (\"Success\", \"\", 0)\n+    mock_flight = MagicMock(return_value=cmd_ret)\n+    mock_cmd = MagicMock(return_value=cmd_ret)\n+    patch_flight = patch(\"salt.client.ssh.Single.run_ssh_pre_flight\", mock_flight)\n+    patch_cmd = patch(\"salt.client.ssh.Single.cmd_block\", mock_cmd)\n+    patch_exec_cmd = patch(\n+        \"salt.client.ssh.shell.Shell.exec_cmd\", return_value=(\"\", \"\", 1)\n+    )\n+    patch_os = patch(\"os.path.exists\", side_effect=[False])\n+\n+    with patch_os, patch_flight, patch_cmd, patch_exec_cmd:\n+        ret = single.run()\n+        mock_cmd.assert_called()\n+        mock_flight.assert_not_called()\n+        assert ret == cmd_ret\n+\n+\n+def test_run_with_pre_flight_thin_dir_exists(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run() when ssh_pre_flight is set\n+    and thin_dir already exists\n+    \"\"\"\n+    target[\"ssh_pre_flight\"] = str(tmp_path / \"script.sh\")\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    cmd_ret = (\"\", \"\", 0)\n+    mock_flight = MagicMock(return_value=cmd_ret)\n+    mock_cmd = MagicMock(return_value=cmd_ret)\n+    patch_flight = patch(\"salt.client.ssh.Single.run_ssh_pre_flight\", mock_flight)\n+    patch_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_cmd)\n+    patch_cmd_block = patch(\"salt.client.ssh.Single.cmd_block\", mock_cmd)\n+    patch_os = patch(\"os.path.exists\", return_value=True)\n+\n+    with patch_os, patch_flight, patch_cmd, patch_cmd_block:\n+        ret = single.run()\n+        mock_cmd.assert_called()\n+        mock_flight.assert_not_called()\n+        assert ret == cmd_ret\n+\n+\n+def test_run_ssh_pre_flight(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight function\n+    \"\"\"\n+    target[\"ssh_pre_flight\"] = str(tmp_path / \"script.sh\")\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    cmd_ret = (\"Success\", \"\", 0)\n+    mock_flight = MagicMock(return_value=cmd_ret)\n+    mock_cmd = MagicMock(return_value=cmd_ret)\n+    patch_flight = patch(\"salt.client.ssh.Single.run_ssh_pre_flight\", mock_flight)\n+    patch_cmd = patch(\"salt.client.ssh.Single.cmd_block\", mock_cmd)\n+    patch_exec_cmd = patch(\n+        \"salt.client.ssh.shell.Shell.exec_cmd\", return_value=(\"\", \"\", 1)\n+    )\n+    patch_os = patch(\"os.path.exists\", side_effect=[True])\n+\n+    with patch_os, patch_flight, patch_cmd, patch_exec_cmd:\n+        ret = single.run()\n+        mock_cmd.assert_called()\n+        mock_flight.assert_called()\n+        assert ret == cmd_ret\n+\n+\n+def test_execute_script(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.execute_script()\n+    \"\"\"\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        **target,\n+    )\n+\n+    exp_ret = (\"Success\", \"\", 0)\n+    mock_cmd = MagicMock(return_value=exp_ret)\n+    patch_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_cmd)\n+    script = str(tmp_path / \"script.sh\")\n+\n+    with patch_cmd:\n+        ret = single.execute_script(script=script)\n+        assert ret == exp_ret\n+        assert mock_cmd.call_count == 2\n+        assert [\n+            call(\"/bin/sh '{}'\".format(script)),\n+            call(\"rm '{}'\".format(script)),\n+        ] == mock_cmd.call_args_list\n+\n+\n+def test_shim_cmd(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.shim_cmd()\n+    \"\"\"\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+\n+    exp_ret = (\"Success\", \"\", 0)\n+    mock_cmd = MagicMock(return_value=exp_ret)\n+    patch_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_cmd)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", return_value=(\"\", \"\", 0))\n+    patch_rand = patch(\"os.urandom\", return_value=b\"5\\xd9l\\xca\\xc2\\xff\")\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n+\n+    with patch_cmd, patch_tmp, patch_send:\n+        ret = single.shim_cmd(cmd_str=\"echo test\")\n+        assert ret == exp_ret\n+        assert [\n+            call(f\"/bin/sh '.{tmp_file.name}'\"),\n+            call(f\"rm '.{tmp_file.name}'\"),\n+        ] == mock_cmd.call_args_list\n+\n+\n+def test_shim_cmd_copy_fails(opts, target, caplog):\n+    \"\"\"\n+    test Single.shim_cmd() when copying the file fails\n+    \"\"\"\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+\n+    ret_cmd = (\"Success\", \"\", 0)\n+    mock_cmd = MagicMock(return_value=ret_cmd)\n+    patch_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_cmd)\n+    ret_send = (\"\", \"General error in file copy\", 1)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", return_value=ret_send)\n+    patch_rand = patch(\"os.urandom\", return_value=b\"5\\xd9l\\xca\\xc2\\xff\")\n+\n+    with patch_cmd, patch_rand, patch_send:\n+        ret = single.shim_cmd(cmd_str=\"echo test\")\n+        assert ret == ret_send\n+        assert \"Could not copy the shim script to target\" in caplog.text\n+        mock_cmd.assert_not_called()\n+\n+\n+def test_run_ssh_pre_flight_no_connect(opts, target, tmp_path, caplog):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight when you\n+    cannot connect to the target\n+    \"\"\"\n+    pre_flight = tmp_path / \"script.sh\"\n+    pre_flight.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight)\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+    mock_exec_cmd = MagicMock(return_value=(\"\", \"\", 1))\n+    patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n+    ret_send = (\n+        \"\",\n+        \"ssh: connect to host 192.168.1.186 port 22: No route to host\\nscp: Connection closed\\n\",\n+        255,\n+    )\n+    send_mock = MagicMock(return_value=ret_send)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", send_mock)\n+\n+    with caplog.at_level(logging.TRACE):\n+        with patch_send, patch_exec_cmd, patch_tmp:\n+            ret = single.run_ssh_pre_flight()\n+    assert f\"Copying the pre flight script {pre_flight.name}\" in caplog.text\n+    assert (\n+        f\"Could not copy the pre flight script {pre_flight.name} to target\"\n+        in caplog.text\n+    )\n+    assert ret == ret_send\n+    assert send_mock.call_args_list[0][0][0] == tmp_file\n+    target_script = send_mock.call_args_list[0][0][1]\n+    assert re.search(r\".[a-z0-9]+\", target_script)\n+    mock_exec_cmd.assert_not_called()\n+\n+\n+def test_run_ssh_pre_flight_permission_denied(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight when you\n+    cannot copy script to the target due to\n+    a permission denied error\n+    \"\"\"\n+    pre_flight = tmp_path / \"script.sh\"\n+    pre_flight.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight)\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+    mock_exec_cmd = MagicMock(return_value=(\"\", \"\", 1))\n+    patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n+    ret_send = (\n+        \"\",\n+        'scp: dest open \"/tmp/preflight.sh\": Permission denied\\nscp: failed to upload file /etc/salt/preflight.sh to /tmp/preflight.sh\\n',\n+        255,\n+    )\n+    send_mock = MagicMock(return_value=ret_send)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", send_mock)\n+\n+    with patch_send, patch_exec_cmd, patch_tmp:\n+        ret = single.run_ssh_pre_flight()\n+    assert ret == ret_send\n+    assert send_mock.call_args_list[0][0][0] == tmp_file\n+    target_script = send_mock.call_args_list[0][0][1]\n+    assert re.search(r\".[a-z0-9]+\", target_script)\n+    mock_exec_cmd.assert_not_called()\n+\n+\n+def test_run_ssh_pre_flight_connect(opts, target, tmp_path, caplog):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight when you\n+    can connect to the target\n+    \"\"\"\n+    pre_flight = tmp_path / \"script.sh\"\n+    pre_flight.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight)\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+    ret_exec_cmd = (\"\", \"\", 1)\n+    mock_exec_cmd = MagicMock(return_value=ret_exec_cmd)\n+    patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n+    ret_send = (\n+        \"\",\n+        \"\\rroot@192.168.1.187's password: \\n\\rpreflight.sh 0%    0 0.0KB/s   --:-- ETA\\rpreflight.sh 100%   20     2.7KB/s   00:00 \\n\",\n+        0,\n+    )\n+    send_mock = MagicMock(return_value=ret_send)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", send_mock)\n+\n+    with caplog.at_level(logging.TRACE):\n+        with patch_send, patch_exec_cmd, patch_tmp:\n+            ret = single.run_ssh_pre_flight()\n+\n+    assert f\"Executing the pre flight script {pre_flight.name} on target\" in caplog.text\n+    assert ret == ret_exec_cmd\n+    assert send_mock.call_args_list[0][0][0] == tmp_file\n+    target_script = send_mock.call_args_list[0][0][1]\n+    assert re.search(r\".[a-z0-9]+\", target_script)\n+    mock_exec_cmd.assert_called()\n+\n+\n+def test_run_ssh_pre_flight_shutil_fails(opts, target, tmp_path):\n+    \"\"\"\n+    test Single.run_ssh_pre_flight when cannot\n+    copyfile with shutil\n+    \"\"\"\n+    pre_flight = tmp_path / \"script.sh\"\n+    pre_flight.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight)\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        tty=True,\n+        **target,\n+    )\n+    ret_exec_cmd = (\"\", \"\", 1)\n+    mock_exec_cmd = MagicMock(return_value=ret_exec_cmd)\n+    patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n+    tmp_file = tmp_path / \"tmp_file\"\n+    mock_tmp = MagicMock()\n+    patch_tmp = patch(\"tempfile.NamedTemporaryFile\", mock_tmp)\n+    mock_tmp.return_value.__enter__.return_value.name = tmp_file\n+    send_mock = MagicMock()\n+    mock_shutil = MagicMock(side_effect=IOError(\"Permission Denied\"))\n+    patch_shutil = patch(\"shutil.copyfile\", mock_shutil)\n+    patch_send = patch(\"salt.client.ssh.shell.Shell.send\", send_mock)\n+\n+    with patch_send, patch_exec_cmd, patch_tmp, patch_shutil:\n+        ret = single.run_ssh_pre_flight()\n+\n+    assert ret == (\n+        \"\",\n+        f\"Could not copy pre flight script {pre_flight} to temporary path\",\n+        1,\n+    )\n+    mock_exec_cmd.assert_not_called()\n+    send_mock.assert_not_called()\n+\n+\n+@pytest.mark.skip_on_windows(reason=\"SSH_PY_SHIM not set on windows\")\n+@pytest.mark.slow_test\n+def test_cmd_run_set_path(opts, target):\n+    \"\"\"\n+    test when set_path is set\n+    \"\"\"\n+    target[\"set_path\"] = \"$PATH:/tmp/path/\"\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    ret = single._cmd_str()\n+    assert re.search(\"\\\\\" + target[\"set_path\"], ret)\n+\n+\n+@pytest.mark.skip_on_windows(reason=\"SSH_PY_SHIM not set on windows\")\n+@pytest.mark.slow_test\n+def test_cmd_run_not_set_path(opts, target):\n+    \"\"\"\n+    test when set_path is not set\n+    \"\"\"\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    ret = single._cmd_str()\n+    assert re.search('SET_PATH=\"\"', ret)\n+\n+\n+@pytest.mark.skip_on_windows(reason=\"SSH_PY_SHIM not set on windows\")\n+@pytest.mark.slow_test\n+def test_cmd_block_python_version_error(opts, target):\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        winrm=False,\n+        **target,\n+    )\n+    mock_shim = MagicMock(\n+        return_value=((\"\", \"ERROR: Unable to locate appropriate python command\\n\", 10))\n+    )\n+    patch_shim = patch(\"salt.client.ssh.Single.shim_cmd\", mock_shim)\n+    with patch_shim:\n+        ret = single.cmd_block()\n+        assert \"ERROR: Python version error. Recommendation(s) follow:\" in ret[0]\n+\n+\n+def _check_skip(grains):\n+    if grains[\"os\"] == \"MacOS\":\n+        return True\n+    return False\n+\n+\n+@pytest.mark.skip_initial_gh_actions_failure(skip=_check_skip)\n+@pytest.mark.skip_on_windows(reason=\"pre_flight_args is not implemented for Windows\")\n+@pytest.mark.parametrize(\n+    \"test_opts\",\n+    [\n+        (None, \"\"),\n+        (\"one\", \" one\"),\n+        (\"one two\", \" one two\"),\n+        (\"| touch /tmp/test\", \" '|' touch /tmp/test\"),\n+        (\"; touch /tmp/test\", \" ';' touch /tmp/test\"),\n+        ([\"one\"], \" one\"),\n+        ([\"one\", \"two\"], \" one two\"),\n+        ([\"one\", \"two\", \"| touch /tmp/test\"], \" one two '| touch /tmp/test'\"),\n+        ([\"one\", \"two\", \"; touch /tmp/test\"], \" one two '; touch /tmp/test'\"),\n+    ],\n+)\n+def test_run_with_pre_flight_args(opts, target, test_opts, tmp_path):\n+    \"\"\"\n+    test Single.run() when ssh_pre_flight is set\n+    and script successfully runs\n+    \"\"\"\n+    opts[\"ssh_run_pre_flight\"] = True\n+    pre_flight_script = tmp_path / \"script.sh\"\n+    pre_flight_script.write_text(\"\")\n+    target[\"ssh_pre_flight\"] = str(pre_flight_script)\n+\n+    if test_opts[0] is not None:\n+        target[\"ssh_pre_flight_args\"] = test_opts[0]\n+    expected_args = test_opts[1]\n+\n+    single = ssh.Single(\n+        opts,\n+        opts[\"argv\"],\n+        \"localhost\",\n+        mods={},\n+        fsclient=None,\n+        thin=salt.utils.thin.thin_path(opts[\"cachedir\"]),\n+        mine=False,\n+        **target,\n+    )\n+\n+    cmd_ret = (\"Success\", \"\", 0)\n+    mock_cmd = MagicMock(return_value=cmd_ret)\n+    mock_exec_cmd = MagicMock(return_value=(\"\", \"\", 0))\n+    patch_cmd = patch(\"salt.client.ssh.Single.cmd_block\", mock_cmd)\n+    patch_exec_cmd = patch(\"salt.client.ssh.shell.Shell.exec_cmd\", mock_exec_cmd)\n+    patch_shell_send = patch(\n+        \"salt.client.ssh.shell.Shell.send\", return_value=(\"\", \"\", 0)\n+    )\n+    patch_os = patch(\"os.path.exists\", side_effect=[True])\n+\n+    with patch_os, patch_cmd, patch_exec_cmd, patch_shell_send:\n+        single.run()\n+        script_args = mock_exec_cmd.mock_calls[0].args[0]\n+        assert re.search(r\"\\/bin\\/sh '.[a-z0-9]+\", script_args)\n+\n+\n+@pytest.mark.slow_test\n+@pytest.mark.skip_on_windows(reason=\"Windows does not support salt-ssh\")\n+@pytest.mark.skip_if_binaries_missing(\"ssh\", check_all=True)\n+def test_ssh_single__cmd_str(opts):\n+    argv = []\n+    id_ = \"minion\"\n+    host = \"minion\"\n+\n+    single = ssh.Single(opts, argv, id_, host, sudo=False)\n+    cmd = single._cmd_str()\n+    expected = dedent(\n+        \"\"\"\n+        SUDO=\"\"\n+        if [ -n \"\" ]\n+        then SUDO=\" \"\n+        fi\n+        SUDO_USER=\"\"\n+        if [ \"$SUDO\" ] && [ \"$SUDO_USER\" ]\n+        then SUDO=\"$SUDO -u $SUDO_USER\"\n+        fi\n+        \"\"\"\n+    )\n+\n+    assert expected in cmd\n+\n+\n+@pytest.mark.slow_test\n+@pytest.mark.skip_on_windows(reason=\"Windows does not support salt-ssh\")\n+@pytest.mark.skip_if_binaries_missing(\"ssh\", check_all=True)\n+def test_ssh_single__cmd_str_sudo(opts):\n+    argv = []\n+    id_ = \"minion\"\n+    host = \"minion\"\n+\n+    single = ssh.Single(opts, argv, id_, host, sudo=True)\n+    cmd = single._cmd_str()\n+    expected = dedent(\n+        \"\"\"\n+        SUDO=\"\"\n+        if [ -n \"sudo\" ]\n+        then SUDO=\"sudo \"\n+        fi\n+        SUDO_USER=\"\"\n+        if [ \"$SUDO\" ] && [ \"$SUDO_USER\" ]\n+        then SUDO=\"$SUDO -u $SUDO_USER\"\n+        fi\n+        \"\"\"\n+    )\n+\n+    assert expected in cmd\n+\n+\n+@pytest.mark.slow_test\n+@pytest.mark.skip_on_windows(reason=\"Windows does not support salt-ssh\")\n+@pytest.mark.skip_if_binaries_missing(\"ssh\", check_all=True)\n+def test_ssh_single__cmd_str_sudo_user(opts):\n+    argv = []\n+    id_ = \"minion\"\n+    host = \"minion\"\n+    user = \"wayne\"\n+\n+    single = ssh.Single(opts, argv, id_, host, sudo=True, sudo_user=user)\n+    cmd = single._cmd_str()\n+    expected = dedent(\n+        \"\"\"\n+        SUDO=\"\"\n+        if [ -n \"sudo\" ]\n+        then SUDO=\"sudo \"\n+        fi\n+        SUDO_USER=\"wayne\"\n+        if [ \"$SUDO\" ] && [ \"$SUDO_USER\" ]\n+        then SUDO=\"$SUDO -u $SUDO_USER\"\n+        fi\n+        \"\"\"\n+    )\n+\n+    assert expected in cmd\n+\n+\n+@pytest.mark.slow_test\n+@pytest.mark.skip_on_windows(reason=\"Windows does not support salt-ssh\")\n+@pytest.mark.skip_if_binaries_missing(\"ssh\", check_all=True)\n+def test_ssh_single__cmd_str_sudo_passwd(opts):\n+    argv = []\n+    id_ = \"minion\"\n+    host = \"minion\"\n+    passwd = \"salty\"\n+\n+    single = ssh.Single(opts, argv, id_, host, sudo=True, passwd=passwd)\n+    cmd = single._cmd_str()\n+    expected = dedent(\n+        \"\"\"\n+        SUDO=\"\"\n+        if [ -n \"sudo -p '[salt:sudo:d11bd4221135c33324a6bdc09674146fbfdf519989847491e34a689369bbce23]passwd:'\" ]\n+        then SUDO=\"sudo -p '[salt:sudo:d11bd4221135c33324a6bdc09674146fbfdf519989847491e34a689369bbce23]passwd:' \"\n+        fi\n+        SUDO_USER=\"\"\n+        if [ \"$SUDO\" ] && [ \"$SUDO_USER\" ]\n+        then SUDO=\"$SUDO -u $SUDO_USER\"\n+        fi\n+        \"\"\"\n+    )\n+\n+    assert expected in cmd\n+\n+\n+@pytest.mark.slow_test\n+@pytest.mark.skip_on_windows(reason=\"Windows does not support salt-ssh\")\n+@pytest.mark.skip_if_binaries_missing(\"ssh\", check_all=True)\n+def test_ssh_single__cmd_str_sudo_passwd_user(opts):\n+    argv = []\n+    id_ = \"minion\"\n+    host = \"minion\"\n+    user = \"wayne\"\n+    passwd = \"salty\"\n+\n+    single = ssh.Single(opts, argv, id_, host, sudo=True, passwd=passwd, sudo_user=user)\n+    cmd = single._cmd_str()\n+    expected = dedent(\n+        \"\"\"\n+        SUDO=\"\"\n+        if [ -n \"sudo -p '[salt:sudo:d11bd4221135c33324a6bdc09674146fbfdf519989847491e34a689369bbce23]passwd:'\" ]\n+        then SUDO=\"sudo -p '[salt:sudo:d11bd4221135c33324a6bdc09674146fbfdf519989847491e34a689369bbce23]passwd:' \"\n+        fi\n+        SUDO_USER=\"wayne\"\n+        if [ \"$SUDO\" ] && [ \"$SUDO_USER\" ]\n+        then SUDO=\"$SUDO -u $SUDO_USER\"\n+        fi\n+        \"\"\"\n+    )\n+\n+    assert expected in cmd"
            },
            {
                "sha": "07f70c42437657ebc450d5738a275f12235dd28b",
                "filename": "tests/pytests/unit/client/ssh/test_ssh.py",
                "status": "modified",
                "additions": 277,
                "deletions": 0,
                "changes": 277,
                "blob_url": "https://github.com/saltstack/salt/blob/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_ssh.py",
                "raw_url": "https://github.com/saltstack/salt/raw/8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_ssh.py",
                "contents_url": "https://api.github.com/repos/saltstack/salt/contents/tests%2Fpytests%2Funit%2Fclient%2Fssh%2Ftest_ssh.py?ref=8ed7bad4f8b9439ad2fbb86a22d120fb2fa592ce",
                "patch": "@@ -194,3 +194,280 @@ def test_run_with_pre_flight_args(ssh_target, test_opts):\n         assert mock_exec_cmd.mock_calls[0].args[\n             0\n         ] == \"/bin/sh '/tmp/script.sh'{}\".format(expected_args)\n+\n+\n+def test_expand_target_dns(opts, roster):\n+    \"\"\"\n+    test expand_target when target is root@<dns>\n+    \"\"\"\n+    host = \"localhost\"\n+    user = \"test-user@\"\n+    opts[\"tgt\"] = user + host\n+\n+    with patch(\"salt.utils.network.is_reachable_host\", MagicMock(return_value=False)):\n+        client = ssh.SSH(opts)\n+    assert opts[\"tgt\"] == user + host\n+    with patch(\n+        \"salt.roster.get_roster_file\", MagicMock(return_value=\"/etc/salt/roster\")\n+    ), patch(\n+        \"salt.client.ssh.compile_template\",\n+        MagicMock(return_value=salt.utils.yaml.safe_load(roster)),\n+    ):\n+        client._expand_target()\n+    assert opts[\"tgt\"] == host\n+\n+\n+def test_expand_target_no_user(opts, roster):\n+    \"\"\"\n+    test expand_target when no user defined\n+    \"\"\"\n+    host = \"127.0.0.1\"\n+    opts[\"tgt\"] = host\n+\n+    with patch(\"salt.utils.network.is_reachable_host\", MagicMock(return_value=False)):\n+        client = ssh.SSH(opts)\n+    assert opts[\"tgt\"] == host\n+\n+    with patch(\n+        \"salt.roster.get_roster_file\", MagicMock(return_value=\"/etc/salt/roster\")\n+    ), patch(\n+        \"salt.client.ssh.compile_template\",\n+        MagicMock(return_value=salt.utils.yaml.safe_load(roster)),\n+    ):\n+        client._expand_target()\n+    assert opts[\"tgt\"] == host\n+\n+\n+def test_update_targets_ip_address(opts):\n+    \"\"\"\n+    test update_targets when host is ip address\n+    \"\"\"\n+    host = \"127.0.0.1\"\n+    user = \"test-user@\"\n+    opts[\"tgt\"] = user + host\n+\n+    with patch(\"salt.utils.network.is_reachable_host\", MagicMock(return_value=False)):\n+        client = ssh.SSH(opts)\n+    assert opts[\"tgt\"] == user + host\n+    client._update_targets()\n+    assert opts[\"tgt\"] == host\n+    assert client.targets[host][\"user\"] == user.split(\"@\")[0]\n+\n+\n+def test_update_targets_dns(opts):\n+    \"\"\"\n+    test update_targets when host is dns\n+    \"\"\"\n+    host = \"localhost\"\n+    user = \"test-user@\"\n+    opts[\"tgt\"] = user + host\n+\n+    with patch(\"salt.utils.network.is_reachable_host\", MagicMock(return_value=False)):\n+        client = ssh.SSH(opts)\n+    assert opts[\"tgt\"] == user + host\n+    client._update_targets()\n+    assert opts[\"tgt\"] == host\n+    assert client.targets[host][\"user\"] == user.split(\"@\")[0]\n+\n+\n+def test_update_targets_no_user(opts):\n+    \"\"\"\n+    test update_targets when no user defined\n+    \"\"\"\n+    host = \"127.0.0.1\"\n+    opts[\"tgt\"] = host\n+\n+    with patch(\"salt.utils.network.is_reachable_host\", MagicMock(return_value=False)):\n+        client = ssh.SSH(opts)\n+    assert opts[\"tgt\"] == host\n+    client._update_targets()\n+    assert opts[\"tgt\"] == host\n+\n+\n+def test_update_expand_target_dns(opts, roster):\n+    \"\"\"\n+    test update_targets and expand_target when host is dns\n+    \"\"\"\n+    host = \"localhost\"\n+    user = \"test-user@\"\n+    opts[\"tgt\"] = user + host\n+\n+    with patch(\"salt.utils.network.is_reachable_host\", MagicMock(return_value=False)):\n+        client = ssh.SSH(opts)\n+    assert opts[\"tgt\"] == user + host\n+    with patch(\n+        \"salt.roster.get_roster_file\", MagicMock(return_value=\"/etc/salt/roster\")\n+    ), patch(\n+        \"salt.client.ssh.compile_template\",\n+        MagicMock(return_value=salt.utils.yaml.safe_load(roster)),\n+    ):\n+        client._expand_target()\n+    client._update_targets()\n+    assert opts[\"tgt\"] == host\n+    assert client.targets[host][\"user\"] == user.split(\"@\")[0]\n+\n+\n+def test_parse_tgt(opts):\n+    \"\"\"\n+    test parse_tgt when user and host set on\n+    the ssh cli tgt\n+    \"\"\"\n+    host = \"localhost\"\n+    user = \"test-user@\"\n+    opts[\"tgt\"] = user + host\n+\n+    with patch(\"salt.utils.network.is_reachable_host\", MagicMock(return_value=False)):\n+        assert not opts.get(\"ssh_cli_tgt\")\n+        client = ssh.SSH(opts)\n+        assert client.parse_tgt[\"hostname\"] == host\n+        assert client.parse_tgt[\"user\"] == user.split(\"@\")[0]\n+        assert opts.get(\"ssh_cli_tgt\") == user + host\n+\n+\n+def test_parse_tgt_no_user(opts):\n+    \"\"\"\n+    test parse_tgt when only the host set on\n+    the ssh cli tgt\n+    \"\"\"\n+    host = \"localhost\"\n+    opts[\"ssh_user\"] = \"ssh-usr\"\n+    opts[\"tgt\"] = host\n+\n+    with patch(\"salt.utils.network.is_reachable_host\", MagicMock(return_value=False)):\n+        assert not opts.get(\"ssh_cli_tgt\")\n+        client = ssh.SSH(opts)\n+        assert client.parse_tgt[\"hostname\"] == host\n+        assert client.parse_tgt[\"user\"] == opts[\"ssh_user\"]\n+        assert opts.get(\"ssh_cli_tgt\") == host\n+\n+\n+def test_extra_filerefs(tmp_path, opts):\n+    \"\"\"\n+    test \"extra_filerefs\" are not excluded from kwargs\n+    when preparing the SSH opts\n+    \"\"\"\n+    ssh_opts = {\n+        \"eauth\": \"auto\",\n+        \"username\": \"test\",\n+        \"password\": \"test\",\n+        \"client\": \"ssh\",\n+        \"tgt\": \"localhost\",\n+        \"fun\": \"test.ping\",\n+        \"ssh_port\": 22,\n+        \"extra_filerefs\": \"salt://foobar\",\n+    }\n+    roster = str(tmp_path / \"roster\")\n+    client = salt.client.ssh.client.SSHClient(mopts=opts, disable_custom_roster=True)\n+    with patch(\"salt.roster.get_roster_file\", MagicMock(return_value=roster)):\n+        ssh_obj = client._prep_ssh(**ssh_opts)\n+        assert ssh_obj.opts.get(\"extra_filerefs\", None) == \"salt://foobar\"\n+\n+\n+def test_key_deploy_permission_denied_scp(tmp_path, opts):\n+    \"\"\"\n+    test \"key_deploy\" function when\n+    permission denied authentication error\n+    when attempting to use scp to copy file\n+    to target\n+    \"\"\"\n+    host = \"localhost\"\n+    passwd = \"password\"\n+    usr = \"ssh-usr\"\n+    opts[\"ssh_user\"] = usr\n+    opts[\"tgt\"] = host\n+\n+    ssh_ret = {\n+        host: {\n+            \"stdout\": \"\\rroot@192.168.1.187's password: \\n\\rroot@192.168.1.187's password: \\n\\rroot@192.168.1.187's password: \\n\",\n+            \"stderr\": \"Permission denied, please try again.\\nPermission denied, please try again.\\nroot@192.168.1.187: Permission denied (publickey,gssapi-keyex,gssapi-with-micimport pudb; pu.dbassword).\\nscp: Connection closed\\n\",\n+            \"retcode\": 255,\n+        }\n+    }\n+    key_run_ret = {\n+        \"localhost\": {\n+            \"jid\": \"20230922155652279959\",\n+            \"return\": \"test\",\n+            \"retcode\": 0,\n+            \"id\": \"test\",\n+            \"fun\": \"cmd.run\",\n+            \"fun_args\": [\"echo test\"],\n+        }\n+    }\n+    patch_roster_file = patch(\"salt.roster.get_roster_file\", MagicMock(return_value=\"\"))\n+    with patch_roster_file:\n+        client = ssh.SSH(opts)\n+    patch_input = patch(\"builtins.input\", side_effect=[\"y\"])\n+    patch_getpass = patch(\"getpass.getpass\", return_value=[\"password\"])\n+    mock_key_run = MagicMock(return_value=key_run_ret)\n+    patch_key_run = patch(\"salt.client.ssh.SSH._key_deploy_run\", mock_key_run)\n+    with patch_input, patch_getpass, patch_key_run:\n+        ret = client.key_deploy(host, ssh_ret)\n+    assert mock_key_run.call_args_list[0][0] == (\n+        host,\n+        {\"passwd\": [passwd], \"host\": host, \"user\": usr},\n+        True,\n+    )\n+    assert ret == key_run_ret\n+    assert mock_key_run.call_count == 1\n+\n+\n+def test_key_deploy_permission_denied_file_scp(tmp_path, opts):\n+    \"\"\"\n+    test \"key_deploy\" function when permission denied\n+    due to not having access to copy the file to the target\n+    We do not want to deploy the key, because this is not\n+    an authentication to the target error.\n+    \"\"\"\n+    host = \"localhost\"\n+    passwd = \"password\"\n+    usr = \"ssh-usr\"\n+    opts[\"ssh_user\"] = usr\n+    opts[\"tgt\"] = host\n+\n+    mock_key_run = MagicMock(return_value=False)\n+    patch_key_run = patch(\"salt.client.ssh.SSH._key_deploy_run\", mock_key_run)\n+\n+    ssh_ret = {\n+        \"localhost\": {\n+            \"stdout\": \"\",\n+            \"stderr\": 'scp: dest open \"/tmp/preflight.sh\": Permission denied\\nscp: failed to upload file /etc/salt/preflight.sh to /tmp/preflight.sh\\n',\n+            \"retcode\": 1,\n+        }\n+    }\n+    patch_roster_file = patch(\"salt.roster.get_roster_file\", MagicMock(return_value=\"\"))\n+    with patch_roster_file:\n+        client = ssh.SSH(opts)\n+    ret = client.key_deploy(host, ssh_ret)\n+    assert ret == ssh_ret\n+    assert mock_key_run.call_count == 0\n+\n+\n+def test_key_deploy_no_permission_denied(tmp_path, opts):\n+    \"\"\"\n+    test \"key_deploy\" function when no permission denied\n+    is returned\n+    \"\"\"\n+    host = \"localhost\"\n+    passwd = \"password\"\n+    usr = \"ssh-usr\"\n+    opts[\"ssh_user\"] = usr\n+    opts[\"tgt\"] = host\n+\n+    mock_key_run = MagicMock(return_value=False)\n+    patch_key_run = patch(\"salt.client.ssh.SSH._key_deploy_run\", mock_key_run)\n+    ssh_ret = {\n+        \"localhost\": {\n+            \"jid\": \"20230922161937998385\",\n+            \"return\": \"test\",\n+            \"retcode\": 0,\n+            \"id\": \"test\",\n+            \"fun\": \"cmd.run\",\n+            \"fun_args\": [\"echo test\"],\n+        }\n+    }\n+    patch_roster_file = patch(\"salt.roster.get_roster_file\", MagicMock(return_value=\"\"))\n+    with patch_roster_file:\n+        client = ssh.SSH(opts)\n+    ret = client.key_deploy(host, ssh_ret)\n+    assert ret == ssh_ret\n+    assert mock_key_run.call_count == 0"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/yugabyte/yugabyte-db/commits/0bf6e5a3e9c0718a28e654483596615d0798b208",
        "url": "https://api.github.com/repos/yugabyte/yugabyte-db/commits/0bf6e5a3e9c0718a28e654483596615d0798b208",
        "html_url": "https://github.com/yugabyte/yugabyte-db/commit/0bf6e5a3e9c0718a28e654483596615d0798b208",
        "message": "[BACKPORT 2024.1][PLAT-13707] redact ysql_hba_conf_csv value from logs\n\nSummary:\nOriginal commit: 6fe34d463ea87943ef2c483687008ab42b2d2970/D37481\n\nWe currently log the value of ysql_hba_conf_csv during Gflags operations.\nThis gflag contains the ldap bind password so need to redact it before logging.\n\nTest Plan: Manually verified that the value of the flag is redacted in logs during gflag upgrade.\n\nReviewers: vbansal\n\nReviewed By: vbansal\n\nSubscribers: yugaware\n\nDifferential Revision: https://phorge.dev.yugabyte.com/D37499",
        "files": [
            {
                "sha": "d6d0aaf4cc3b96a30ee33f611d4e6354c3c5f735",
                "filename": "managed/src/main/java/com/yugabyte/yw/commissioner/TaskExecutor.java",
                "status": "modified",
                "additions": 12,
                "deletions": 5,
                "changes": 17,
                "blob_url": "https://github.com/yugabyte/yugabyte-db/blob/0bf6e5a3e9c0718a28e654483596615d0798b208/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommissioner%2FTaskExecutor.java",
                "raw_url": "https://github.com/yugabyte/yugabyte-db/raw/0bf6e5a3e9c0718a28e654483596615d0798b208/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommissioner%2FTaskExecutor.java",
                "contents_url": "https://api.github.com/repos/yugabyte/yugabyte-db/contents/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommissioner%2FTaskExecutor.java?ref=0bf6e5a3e9c0718a28e654483596615d0798b208",
                "patch": "@@ -1017,9 +1017,9 @@ synchronized void updateTaskDetailsOnError(TaskInfo.State state, Throwable t) {\n           \"Task state must be one of \" + TaskInfo.ERROR_STATES);\n       taskInfo.refresh();\n       ObjectNode taskDetails = taskInfo.getDetails().deepCopy();\n-      // Method maskConfig does not modify the input as it makes a deep-copy.\n-      String maskedTaskDetails = CommonUtils.maskConfig(taskDetails).toString();\n       String errorString;\n+      // Method getRedactedParams does not modify the input as it makes a deep-copy.\n+      String redactedTaskParams = taskInfo.getRedactedParams().toString();\n       if (state == TaskInfo.State.Aborted && isShutdown.get()) {\n         errorString = \"Platform shutdown\";\n       } else {\n@@ -1032,14 +1032,14 @@ synchronized void updateTaskDetailsOnError(TaskInfo.State state, Throwable t) {\n         errorString =\n             String.format(\n                 \"Failed to execute task %s, hit error:\\n\\n %s.\",\n-                StringUtils.abbreviate(maskedTaskDetails, 500),\n+                StringUtils.abbreviate(redactedTaskParams, 500),\n                 StringUtils.abbreviateMiddle(cause.getMessage(), \"...\", 3000));\n       }\n       log.error(\n           \"Failed to execute task type {} UUID {} details {}, hit error.\",\n           taskInfo.getTaskType(),\n           taskInfo.getTaskUUID(),\n-          maskedTaskDetails,\n+          redactedTaskParams,\n           t);\n \n       if (log.isDebugEnabled()) {\n@@ -1330,7 +1330,14 @@ public void run() {\n             throw e;\n           }\n \n-          log.warn(\"Task {} attempt {} has failed\", getTask(), currentAttempt);\n+          String redactedParams =\n+              RedactingService.filterSecretFields(getTask().getTaskDetails(), RedactionTarget.LOGS)\n+                  .toString();\n+          log.warn(\n+              \"Task {} with params {} attempt {} has failed\",\n+              getTask().getName(),\n+              redactedParams,\n+              currentAttempt);\n           if (!getTask().onFailure(getTaskInfo(), e)) {\n             throw e;\n           }"
            },
            {
                "sha": "dd1bdd8668c9f7f1f64061751e756a9d9183b53f",
                "filename": "managed/src/main/java/com/yugabyte/yw/commissioner/tasks/upgrade/GFlagsUpgrade.java",
                "status": "modified",
                "additions": 28,
                "deletions": 4,
                "changes": 32,
                "blob_url": "https://github.com/yugabyte/yugabyte-db/blob/0bf6e5a3e9c0718a28e654483596615d0798b208/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommissioner%2Ftasks%2Fupgrade%2FGFlagsUpgrade.java",
                "raw_url": "https://github.com/yugabyte/yugabyte-db/raw/0bf6e5a3e9c0718a28e654483596615d0798b208/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommissioner%2Ftasks%2Fupgrade%2FGFlagsUpgrade.java",
                "contents_url": "https://api.github.com/repos/yugabyte/yugabyte-db/contents/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommissioner%2Ftasks%2Fupgrade%2FGFlagsUpgrade.java?ref=0bf6e5a3e9c0718a28e654483596615d0798b208",
                "patch": "@@ -4,12 +4,15 @@\n \n import static play.mvc.Http.Status.BAD_REQUEST;\n \n+import com.fasterxml.jackson.databind.ObjectMapper;\n import com.yugabyte.yw.commissioner.BaseTaskDependencies;\n import com.yugabyte.yw.commissioner.ITask.Abortable;\n import com.yugabyte.yw.commissioner.ITask.Retryable;\n import com.yugabyte.yw.commissioner.UpgradeTaskBase;\n import com.yugabyte.yw.commissioner.UserTaskDetails.SubTaskGroupType;\n import com.yugabyte.yw.common.PlatformServiceException;\n+import com.yugabyte.yw.common.RedactingService;\n+import com.yugabyte.yw.common.RedactingService.RedactionTarget;\n import com.yugabyte.yw.common.XClusterUniverseService;\n import com.yugabyte.yw.common.config.UniverseConfKeys;\n import com.yugabyte.yw.common.gflags.GFlagsUtil;\n@@ -162,16 +165,37 @@ protected MastersAndTservers calculateNodesToBeRestarted() {\n           GFlagsUtil.getBaseGFlags(ServerType.MASTER, newCluster, newClusters.values());\n       Map<String, String> tserverGflags =\n           GFlagsUtil.getBaseGFlags(ServerType.TSERVER, newCluster, newClusters.values());\n+      ObjectMapper mapper = new ObjectMapper();\n+      String redactedMasterNewFlags =\n+          RedactingService.filterSecretFields(\n+                  mapper.valueToTree(masterGflags), RedactionTarget.LOGS)\n+              .toString();\n+      String redactedMasterOldFlags =\n+          RedactingService.filterSecretFields(\n+                  mapper.valueToTree(\n+                      GFlagsUtil.getBaseGFlags(ServerType.MASTER, curCluster, curClusters)),\n+                  RedactionTarget.LOGS)\n+              .toString();\n       log.debug(\n           \"Cluster {} master: new flags {} old flags {}\",\n           curCluster.clusterType,\n-          masterGflags,\n-          GFlagsUtil.getBaseGFlags(ServerType.MASTER, curCluster, curClusters));\n+          redactedMasterNewFlags,\n+          redactedMasterOldFlags);\n+      String redactedTsNewFlags =\n+          RedactingService.filterSecretFields(\n+                  mapper.valueToTree(tserverGflags), RedactionTarget.LOGS)\n+              .toString();\n+      String redactedTsOldFlags =\n+          RedactingService.filterSecretFields(\n+                  mapper.valueToTree(\n+                      GFlagsUtil.getBaseGFlags(ServerType.TSERVER, curCluster, curClusters)),\n+                  RedactionTarget.LOGS)\n+              .toString();\n       log.debug(\n           \"Cluster {} tserver: new flags {} old flags {}\",\n           curCluster.clusterType,\n-          tserverGflags,\n-          GFlagsUtil.getBaseGFlags(ServerType.TSERVER, curCluster, curClusters));\n+          redactedTsNewFlags,\n+          redactedTsOldFlags);\n \n       boolean changedByMasterFlags =\n           curCluster.clusterType == UniverseDefinitionTaskParams.ClusterType.PRIMARY"
            },
            {
                "sha": "7d4b603ce483fc8be8f5dcc441fc18a0e049a5da",
                "filename": "managed/src/main/java/com/yugabyte/yw/common/RedactingService.java",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/yugabyte/yugabyte-db/blob/0bf6e5a3e9c0718a28e654483596615d0798b208/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommon%2FRedactingService.java",
                "raw_url": "https://github.com/yugabyte/yugabyte-db/raw/0bf6e5a3e9c0718a28e654483596615d0798b208/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommon%2FRedactingService.java",
                "contents_url": "https://api.github.com/repos/yugabyte/yugabyte-db/contents/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommon%2FRedactingService.java?ref=0bf6e5a3e9c0718a28e654483596615d0798b208",
                "patch": "@@ -92,6 +92,7 @@ public class RedactingService {\n           // LDAP - DB Universe Sync\n           .add(\"$..dbuserPassword\")\n           .add(\"$..ldapBindPassword\")\n+          .add(\"$..ysql_hba_conf_csv\")\n           .build();\n \n   // List of json paths to any secret fields we want to redact."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/getumbrel/umbrel/commits/b83e3542650880bf1439419d00bf82285a7d2b22",
        "url": "https://api.github.com/repos/getumbrel/umbrel/commits/b83e3542650880bf1439419d00bf82285a7d2b22",
        "html_url": "https://github.com/getumbrel/umbrel/commit/b83e3542650880bf1439419d00bf82285a7d2b22",
        "message": "Add CSP and referer headers\n\nCo-authored-by: Nathan Fretz <nmfretz@gmail.com>",
        "files": [
            {
                "sha": "4584936d86f6df3ad92521dddeee687e133be260",
                "filename": "packages/umbreld/package-lock.json",
                "status": "modified",
                "additions": 16,
                "deletions": 2,
                "changes": 18,
                "blob_url": "https://github.com/getumbrel/umbrel/blob/b83e3542650880bf1439419d00bf82285a7d2b22/packages%2Fumbreld%2Fpackage-lock.json",
                "raw_url": "https://github.com/getumbrel/umbrel/raw/b83e3542650880bf1439419d00bf82285a7d2b22/packages%2Fumbreld%2Fpackage-lock.json",
                "contents_url": "https://api.github.com/repos/getumbrel/umbrel/contents/packages%2Fumbreld%2Fpackage-lock.json?ref=b83e3542650880bf1439419d00bf82285a7d2b22",
                "patch": "@@ -1,12 +1,12 @@\n {\n \t\"name\": \"umbreld\",\n-\t\"version\": \"1.0.0\",\n+\t\"version\": \"1.2.1\",\n \t\"lockfileVersion\": 2,\n \t\"requires\": true,\n \t\"packages\": {\n \t\t\"\": {\n \t\t\t\"name\": \"umbreld\",\n-\t\t\t\"version\": \"1.0.0\",\n+\t\t\t\"version\": \"1.2.1\",\n \t\t\t\"license\": \"PolyForm Noncommercial License 1.0.0\",\n \t\t\t\"dependencies\": {\n \t\t\t\t\"@trpc/client\": \"^10.34.0\",\n@@ -31,6 +31,7 @@\n \t\t\t\t\"express-session\": \"^1.17.3\",\n \t\t\t\t\"fs-extra\": \"^11.1.1\",\n \t\t\t\t\"globby\": \"^13.2.1\",\n+\t\t\t\t\"helmet\": \"^7.1.0\",\n \t\t\t\t\"http-proxy-middleware\": \"^2.0.6\",\n \t\t\t\t\"isomorphic-git\": \"^1.24.5\",\n \t\t\t\t\"js-yaml\": \"^4.1.0\",\n@@ -5051,6 +5052,14 @@\n \t\t\t\t\"minimalistic-assert\": \"^1.0.1\"\n \t\t\t}\n \t\t},\n+\t\t\"node_modules/helmet\": {\n+\t\t\t\"version\": \"7.1.0\",\n+\t\t\t\"resolved\": \"https://registry.npmjs.org/helmet/-/helmet-7.1.0.tgz\",\n+\t\t\t\"integrity\": \"sha512-g+HZqgfbpXdCkme/Cd/mZkV0aV3BZZZSugecH03kl38m/Kmdx8jKjBikpDj2cr+Iynv4KpYEviojNdTJActJAg==\",\n+\t\t\t\"engines\": {\n+\t\t\t\t\"node\": \">=16.0.0\"\n+\t\t\t}\n+\t\t},\n \t\t\"node_modules/hmac-drbg\": {\n \t\t\t\"version\": \"1.0.1\",\n \t\t\t\"resolved\": \"https://registry.npmjs.org/hmac-drbg/-/hmac-drbg-1.0.1.tgz\",\n@@ -14787,6 +14796,11 @@\n \t\t\t\t\"minimalistic-assert\": \"^1.0.1\"\n \t\t\t}\n \t\t},\n+\t\t\"helmet\": {\n+\t\t\t\"version\": \"7.1.0\",\n+\t\t\t\"resolved\": \"https://registry.npmjs.org/helmet/-/helmet-7.1.0.tgz\",\n+\t\t\t\"integrity\": \"sha512-g+HZqgfbpXdCkme/Cd/mZkV0aV3BZZZSugecH03kl38m/Kmdx8jKjBikpDj2cr+Iynv4KpYEviojNdTJActJAg==\"\n+\t\t},\n \t\t\"hmac-drbg\": {\n \t\t\t\"version\": \"1.0.1\",\n \t\t\t\"resolved\": \"https://registry.npmjs.org/hmac-drbg/-/hmac-drbg-1.0.1.tgz\","
            },
            {
                "sha": "b652c1cc3ccab6e656f20d7dc4c742f7bb45de20",
                "filename": "packages/umbreld/package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/getumbrel/umbrel/blob/b83e3542650880bf1439419d00bf82285a7d2b22/packages%2Fumbreld%2Fpackage.json",
                "raw_url": "https://github.com/getumbrel/umbrel/raw/b83e3542650880bf1439419d00bf82285a7d2b22/packages%2Fumbreld%2Fpackage.json",
                "contents_url": "https://api.github.com/repos/getumbrel/umbrel/contents/packages%2Fumbreld%2Fpackage.json?ref=b83e3542650880bf1439419d00bf82285a7d2b22",
                "patch": "@@ -117,6 +117,7 @@\n \t\t\"express-session\": \"^1.17.3\",\n \t\t\"fs-extra\": \"^11.1.1\",\n \t\t\"globby\": \"^13.2.1\",\n+\t\t\"helmet\": \"^7.1.0\",\n \t\t\"http-proxy-middleware\": \"^2.0.6\",\n \t\t\"isomorphic-git\": \"^1.24.5\",\n \t\t\"js-yaml\": \"^4.1.0\","
            },
            {
                "sha": "6e7896225ea6ede23db9d821c70d1cc7f2bd8c8f",
                "filename": "packages/umbreld/source/modules/server/index.ts",
                "status": "modified",
                "additions": 17,
                "deletions": 2,
                "changes": 19,
                "blob_url": "https://github.com/getumbrel/umbrel/blob/b83e3542650880bf1439419d00bf82285a7d2b22/packages%2Fumbreld%2Fsource%2Fmodules%2Fserver%2Findex.ts",
                "raw_url": "https://github.com/getumbrel/umbrel/raw/b83e3542650880bf1439419d00bf82285a7d2b22/packages%2Fumbreld%2Fsource%2Fmodules%2Fserver%2Findex.ts",
                "contents_url": "https://api.github.com/repos/getumbrel/umbrel/contents/packages%2Fumbreld%2Fsource%2Fmodules%2Fserver%2Findex.ts?ref=b83e3542650880bf1439419d00bf82285a7d2b22",
                "patch": "@@ -9,6 +9,7 @@ import {pipeline} from 'node:stream/promises'\n import {$} from 'execa'\n import express from 'express'\n import cookieParser from 'cookie-parser'\n+import helmet from 'helmet'\n import cors from 'cors'\n import pty, {IPty} from 'node-pty'\n \n@@ -67,10 +68,24 @@ class Server {\n \t\t// Setup cookie parser\n \t\tapp.use(cookieParser())\n \n+\t\t// Security hardening, CSP\n+\t\tapp.use(\n+\t\t\thelmet.contentSecurityPolicy({\n+\t\t\t\tdirectives: {\n+\t\t\t\t\t// Allow inline scripts ONLY in development for vite dev server\n+\t\t\t\t\tscriptSrc: this.umbreld.developmentMode ? [\"'self'\", \"'unsafe-inline'\"] : null,\n+\t\t\t\t\t// Allow 3rd party app images (remove this if we serve them locally in the future)\n+\t\t\t\t\timgSrc: ['*'],\n+\t\t\t\t\t// Allow fetching data from our apps API (e.g., for Discover page in App Store)\n+\t\t\t\t\tconnectSrc: [\"'self'\", 'https://apps.umbrel.com'],\n+\t\t\t\t\t// Allow plain text access over the local network\n+\t\t\t\t\tupgradeInsecureRequests: null,\n+\t\t\t\t},\n+\t\t\t}),\n+\t\t)\n+\t\tapp.use(helmet.referrerPolicy({policy: 'no-referrer'}))\n \t\tapp.disable('x-powered-by')\n \n-\t\t// TODO: Security hardening, helmet etc.\n-\n \t\t// Attach the umbreld and logger instances so they're accessible to routes\n \t\tapp.set('umbreld', this.umbreld)\n \t\tapp.set('logger', this.logger)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/symfony/symfony/commits/81354d392c5f0b7a52bcbd729d6f82501e94135a",
        "url": "https://api.github.com/repos/symfony/symfony/commits/81354d392c5f0b7a52bcbd729d6f82501e94135a",
        "html_url": "https://github.com/symfony/symfony/commit/81354d392c5f0b7a52bcbd729d6f82501e94135a",
        "message": "[security-http] Check owner of persisted remember-me cookie",
        "files": [
            {
                "sha": "438db1b8c4b02c501bf17dc92aae87ecf7f2a955",
                "filename": "src/Symfony/Component/Security/Http/RememberMe/PersistentRememberMeHandler.php",
                "status": "modified",
                "additions": 16,
                "deletions": 3,
                "changes": 19,
                "blob_url": "https://github.com/symfony/symfony/blob/81354d392c5f0b7a52bcbd729d6f82501e94135a/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FRememberMe%2FPersistentRememberMeHandler.php",
                "raw_url": "https://github.com/symfony/symfony/raw/81354d392c5f0b7a52bcbd729d6f82501e94135a/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FRememberMe%2FPersistentRememberMeHandler.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FRememberMe%2FPersistentRememberMeHandler.php?ref=81354d392c5f0b7a52bcbd729d6f82501e94135a",
                "patch": "@@ -66,9 +66,16 @@ public function consumeRememberMeCookie(RememberMeDetails $rememberMeDetails): U\n             throw new AuthenticationException('The cookie is incorrectly formatted.');\n         }\n \n-        [$series, $tokenValue] = explode(':', $rememberMeDetails->getValue());\n+        [$series, $tokenValue] = explode(':', $rememberMeDetails->getValue(), 2);\n         $persistentToken = $this->tokenProvider->loadTokenBySeries($series);\n \n+        if ($persistentToken->getUserIdentifier() !== $rememberMeDetails->getUserIdentifier() || $persistentToken->getClass() !== $rememberMeDetails->getUserFqcn()) {\n+            throw new AuthenticationException('The cookie\\'s hash is invalid.');\n+        }\n+\n+        // content of $rememberMeDetails is not trustable. this prevents use of this class\n+        unset($rememberMeDetails);\n+\n         if ($this->tokenVerifier) {\n             $isTokenValid = $this->tokenVerifier->verifyToken($persistentToken, $tokenValue);\n         } else {\n@@ -78,11 +85,17 @@ public function consumeRememberMeCookie(RememberMeDetails $rememberMeDetails): U\n             throw new CookieTheftException('This token was already used. The account is possibly compromised.');\n         }\n \n-        if ($persistentToken->getLastUsed()->getTimestamp() + $this->options['lifetime'] < time()) {\n+        $expires = $persistentToken->getLastUsed()->getTimestamp() + $this->options['lifetime'];\n+        if ($expires < time()) {\n             throw new AuthenticationException('The cookie has expired.');\n         }\n \n-        return parent::consumeRememberMeCookie($rememberMeDetails->withValue($persistentToken->getLastUsed()->getTimestamp().':'.$rememberMeDetails->getValue().':'.$persistentToken->getClass()));\n+        return parent::consumeRememberMeCookie(new RememberMeDetails(\n+            $persistentToken->getClass(),\n+            $persistentToken->getUserIdentifier(),\n+            $expires,\n+            $persistentToken->getLastUsed()->getTimestamp().':'.$series.':'.$tokenValue.':'.$persistentToken->getClass()\n+        ));\n     }\n \n     public function processRememberMe(RememberMeDetails $rememberMeDetails, UserInterface $user): void"
            },
            {
                "sha": "33ea98ff563852f33b703c60b1db59011c6816b0",
                "filename": "src/Symfony/Component/Security/Http/Tests/RememberMe/PersistentRememberMeHandlerTest.php",
                "status": "modified",
                "additions": 32,
                "deletions": 2,
                "changes": 34,
                "blob_url": "https://github.com/symfony/symfony/blob/81354d392c5f0b7a52bcbd729d6f82501e94135a/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FTests%2FRememberMe%2FPersistentRememberMeHandlerTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/81354d392c5f0b7a52bcbd729d6f82501e94135a/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FTests%2FRememberMe%2FPersistentRememberMeHandlerTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FSecurity%2FHttp%2FTests%2FRememberMe%2FPersistentRememberMeHandlerTest.php?ref=81354d392c5f0b7a52bcbd729d6f82501e94135a",
                "patch": "@@ -80,7 +80,7 @@ public function testConsumeRememberMeCookieValid()\n         $this->tokenProvider->expects($this->any())\n             ->method('loadTokenBySeries')\n             ->with('series1')\n-            ->willReturn(new PersistentToken(InMemoryUser::class, 'wouter', 'series1', 'tokenvalue', new \\DateTime('-10 min')))\n+            ->willReturn(new PersistentToken(InMemoryUser::class, 'wouter', 'series1', 'tokenvalue', $lastUsed = new \\DateTime('-10 min')))\n         ;\n \n         $this->tokenProvider->expects($this->once())->method('updateToken')->with('series1');\n@@ -98,11 +98,41 @@ public function testConsumeRememberMeCookieValid()\n \n         $this->assertSame($rememberParts[0], $cookieParts[0]); // class\n         $this->assertSame($rememberParts[1], $cookieParts[1]); // identifier\n-        $this->assertSame($rememberParts[2], $cookieParts[2]); // expire\n+        $this->assertEqualsWithDelta($lastUsed->getTimestamp() + 31536000, (int) $cookieParts[2], 2); // expire\n         $this->assertNotSame($rememberParts[3], $cookieParts[3]); // value\n         $this->assertSame(explode(':', $rememberParts[3])[0], explode(':', $cookieParts[3])[0]); // series\n     }\n \n+    public function testConsumeRememberMeCookieInvalidOwner()\n+    {\n+        $this->tokenProvider->expects($this->any())\n+            ->method('loadTokenBySeries')\n+            ->with('series1')\n+            ->willReturn(new PersistentToken(InMemoryUser::class, 'wouter', 'series1', 'tokenvalue', new \\DateTime('-10 min')))\n+        ;\n+\n+        $rememberMeDetails = new RememberMeDetails(InMemoryUser::class, 'jeremy', 360, 'series1:tokenvalue');\n+\n+        $this->expectException(AuthenticationException::class);\n+        $this->expectExceptionMessage('The cookie\\'s hash is invalid.');\n+        $this->handler->consumeRememberMeCookie($rememberMeDetails);\n+    }\n+\n+    public function testConsumeRememberMeCookieInvalidValue()\n+    {\n+        $this->tokenProvider->expects($this->any())\n+            ->method('loadTokenBySeries')\n+            ->with('series1')\n+            ->willReturn(new PersistentToken(InMemoryUser::class, 'wouter', 'series1', 'tokenvalue', new \\DateTime('-10 min')))\n+        ;\n+\n+        $rememberMeDetails = new RememberMeDetails(InMemoryUser::class, 'wouter', 360, 'series1:tokenvalue:somethingelse');\n+\n+        $this->expectException(AuthenticationException::class);\n+        $this->expectExceptionMessage('This token was already used. The account is possibly compromised.');\n+        $this->handler->consumeRememberMeCookie($rememberMeDetails);\n+    }\n+\n     public function testConsumeRememberMeCookieValidByValidatorWithoutUpdate()\n     {\n         $verifier = $this->createMock(TokenVerifierInterface::class);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/craftcms/cms/commits/123e48a696de1e2f63ab519d4730eb3b87beaa58",
        "url": "https://api.github.com/repos/craftcms/cms/commits/123e48a696de1e2f63ab519d4730eb3b87beaa58",
        "html_url": "https://github.com/craftcms/cms/commit/123e48a696de1e2f63ab519d4730eb3b87beaa58",
        "message": "Fixed an RCE vulnerability",
        "files": [
            {
                "sha": "a16099630f9c53c599542c78565e1a942313fa62",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/craftcms/cms/blob/123e48a696de1e2f63ab519d4730eb3b87beaa58/CHANGELOG.md",
                "raw_url": "https://github.com/craftcms/cms/raw/123e48a696de1e2f63ab519d4730eb3b87beaa58/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/craftcms/cms/contents/CHANGELOG.md?ref=123e48a696de1e2f63ab519d4730eb3b87beaa58",
                "patch": "@@ -3,6 +3,7 @@\n ## Unreleased\n \n - Updated Twig to 3.14. ([#15704](https://github.com/craftcms/cms/issues/15704))\n+- Fixed an RCE vulnerability.\n \n ## 4.12.1 - 2024-09-06\n "
            },
            {
                "sha": "85cf38183f436ce506ba80522f6568a73714208e",
                "filename": "src/helpers/FileHelper.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/craftcms/cms/blob/123e48a696de1e2f63ab519d4730eb3b87beaa58/src%2Fhelpers%2FFileHelper.php",
                "raw_url": "https://github.com/craftcms/cms/raw/123e48a696de1e2f63ab519d4730eb3b87beaa58/src%2Fhelpers%2FFileHelper.php",
                "contents_url": "https://api.github.com/repos/craftcms/cms/contents/src%2Fhelpers%2FFileHelper.php?ref=123e48a696de1e2f63ab519d4730eb3b87beaa58",
                "patch": "@@ -133,7 +133,7 @@ public static function absolutePath(\n             $from = static::absolutePath($from, ds: $ds);\n         }\n \n-        return $from . $ds . $to;\n+        return static::normalizePath($from . $ds . $to, $ds);\n     }\n \n     /**"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dataease/dataease/commits/e755248d59543bcd668ace495f293ff735fa82e9",
        "url": "https://api.github.com/repos/dataease/dataease/commits/e755248d59543bcd668ace495f293ff735fa82e9",
        "html_url": "https://github.com/dataease/dataease/commit/e755248d59543bcd668ace495f293ff735fa82e9",
        "message": "perf: \u793e\u533a\u7248token\u673a\u5236",
        "files": [
            {
                "sha": "cc6de17d762f9c2300dceb220f90e0af945ee85c",
                "filename": "core/core-backend/src/main/java/io/dataease/substitute/permissions/login/SubstituleLoginServer.java",
                "status": "modified",
                "additions": 24,
                "deletions": 6,
                "changes": 30,
                "blob_url": "https://github.com/dataease/dataease/blob/e755248d59543bcd668ace495f293ff735fa82e9/core%2Fcore-backend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fsubstitute%2Fpermissions%2Flogin%2FSubstituleLoginServer.java",
                "raw_url": "https://github.com/dataease/dataease/raw/e755248d59543bcd668ace495f293ff735fa82e9/core%2Fcore-backend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fsubstitute%2Fpermissions%2Flogin%2FSubstituleLoginServer.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/core%2Fcore-backend%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fsubstitute%2Fpermissions%2Flogin%2FSubstituleLoginServer.java?ref=e755248d59543bcd668ace495f293ff735fa82e9",
                "patch": "@@ -5,14 +5,17 @@\n import com.auth0.jwt.algorithms.Algorithm;\n import io.dataease.api.permissions.login.dto.PwdLoginDTO;\n import io.dataease.auth.bo.TokenUserBO;\n+import io.dataease.auth.config.SubstituleLoginConfig;\n import io.dataease.auth.vo.TokenVO;\n+import io.dataease.exception.DEException;\n+import io.dataease.i18n.Translator;\n import io.dataease.utils.LogUtil;\n+import io.dataease.utils.Md5Utils;\n+import io.dataease.utils.RsaUtils;\n+import org.apache.commons.lang3.StringUtils;\n import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n import org.springframework.stereotype.Component;\n-import org.springframework.web.bind.annotation.GetMapping;\n-import org.springframework.web.bind.annotation.PostMapping;\n-import org.springframework.web.bind.annotation.RequestMapping;\n-import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.bind.annotation.*;\n \n @Component\n @ConditionalOnMissingBean(name = \"loginServer\")\n@@ -21,11 +24,26 @@\n public class SubstituleLoginServer {\n \n     @PostMapping(\"/login/localLogin\")\n-    public TokenVO localLogin(PwdLoginDTO dto) {\n+    public TokenVO localLogin(@RequestBody PwdLoginDTO dto) {\n+\n+        String name = dto.getName();\n+        name = RsaUtils.decryptStr(name);\n+        String pwd = dto.getPwd();\n+        pwd = RsaUtils.decryptStr(pwd);\n+\n+        dto.setName(name);\n+        dto.setPwd(pwd);\n+\n+        if (!StringUtils.equals(\"admin\", name)) {\n+            DEException.throwException(\"\u4ec5admin\u8d26\u53f7\u53ef\u7528\");\n+        }\n+        if (!StringUtils.equals(pwd, SubstituleLoginConfig.getPwd())) {\n+            DEException.throwException(Translator.get(\"i18n_login_name_pwd_err\"));\n+        }\n         TokenUserBO tokenUserBO = new TokenUserBO();\n         tokenUserBO.setUserId(1L);\n         tokenUserBO.setDefaultOid(1L);\n-        String md5Pwd = \"83d923c9f1d8fcaa46cae0ed2aaa81b5\";\n+        String md5Pwd = Md5Utils.md5(pwd);\n         return generate(tokenUserBO, md5Pwd);\n     }\n "
            },
            {
                "sha": "1aae01674cc0dd042bbb5eac7f1cc54f30b9d23d",
                "filename": "de-xpack",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": null,
                "raw_url": null,
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/de-xpack?ref=e755248d59543bcd668ace495f293ff735fa82e9",
                "patch": "@@ -1 +1 @@\n-Subproject commit f028be49a62cb21a53c11fa4f931946417381a55\n+Subproject commit 1aae01674cc0dd042bbb5eac7f1cc54f30b9d23d"
            },
            {
                "sha": "2a69b31c96721386a0c1ae018aa20b79352b77ac",
                "filename": "sdk/common/src/main/java/io/dataease/auth/config/SubstituleLoginConfig.java",
                "status": "added",
                "additions": 71,
                "deletions": 0,
                "changes": 71,
                "blob_url": "https://github.com/dataease/dataease/blob/e755248d59543bcd668ace495f293ff735fa82e9/sdk%2Fcommon%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fauth%2Fconfig%2FSubstituleLoginConfig.java",
                "raw_url": "https://github.com/dataease/dataease/raw/e755248d59543bcd668ace495f293ff735fa82e9/sdk%2Fcommon%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fauth%2Fconfig%2FSubstituleLoginConfig.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/sdk%2Fcommon%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fauth%2Fconfig%2FSubstituleLoginConfig.java?ref=e755248d59543bcd668ace495f293ff735fa82e9",
                "patch": "@@ -0,0 +1,71 @@\n+package io.dataease.auth.config;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import io.dataease.utils.CommonBeanFactory;\n+import io.dataease.utils.LogUtil;\n+import org.apache.commons.lang3.ObjectUtils;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.core.env.Environment;\n+import org.springframework.core.io.ResourceLoader;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@ConditionalOnMissingBean(name = \"loginServer\")\n+@Configuration\n+public class SubstituleLoginConfig {\n+\n+\n+    private static String jsonFilePath = \"classpath:substitule.json\";\n+\n+    private static String pwd;\n+\n+    private static boolean ready = false;\n+\n+\n+    @ConditionalOnMissingBean(name = \"loginServer\")\n+    @Bean\n+    public Map<String, Object> substituleLoginData(ResourceLoader resourceLoader) throws IOException {\n+        ObjectMapper objectMapper = new ObjectMapper();\n+        File jsonFile = new File(jsonFilePath);\n+        if (!jsonFile.exists()) {\n+            pwd = CommonBeanFactory.getBean(Environment.class).getProperty(\"dataease.default-pwd\", \"DataEase@123456\");\n+            modifyPwd(pwd);\n+        }\n+        return objectMapper.readValue(jsonFile, Map.class);\n+    }\n+\n+    public static String getPwd() {\n+        if (!ready) {\n+            ready = true;\n+            Object substituleLoginDataObject = CommonBeanFactory.getBean(\"substituleLoginData\");\n+            if (substituleLoginDataObject != null) {\n+                Map<String, Object> substituleLoginData = (Map<String, Object>) substituleLoginDataObject;\n+                if (ObjectUtils.isNotEmpty(substituleLoginData.get(\"pwd\"))) {\n+                    pwd = substituleLoginData.get(\"pwd\").toString();\n+                    return substituleLoginData.get(\"pwd\").toString();\n+                }\n+            }\n+        }\n+        return pwd;\n+    }\n+\n+    public static void modifyPwd(String pwd) {\n+        File file = new File(jsonFilePath);\n+        Map<String, String> myObject = new HashMap<>();\n+        myObject.put(\"pwd\", pwd);\n+        SubstituleLoginConfig.pwd = pwd;\n+        ObjectMapper mapper = new ObjectMapper();\n+        try (FileOutputStream fos = new FileOutputStream(file)) {\n+            // \u5c06\u5bf9\u8c61\u5199\u5165\u6587\u4ef6\n+            mapper.writeValue(fos, myObject);\n+        } catch (IOException e) {\n+            LogUtil.error(e.getCause(), new Throwable(e));\n+        }\n+    }\n+}"
            },
            {
                "sha": "8f3d11726740aa04aca5fcf6efc72de5fc33479f",
                "filename": "sdk/common/src/main/java/io/dataease/auth/filter/TokenFilter.java",
                "status": "modified",
                "additions": 40,
                "deletions": 6,
                "changes": 46,
                "blob_url": "https://github.com/dataease/dataease/blob/e755248d59543bcd668ace495f293ff735fa82e9/sdk%2Fcommon%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fauth%2Ffilter%2FTokenFilter.java",
                "raw_url": "https://github.com/dataease/dataease/raw/e755248d59543bcd668ace495f293ff735fa82e9/sdk%2Fcommon%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fauth%2Ffilter%2FTokenFilter.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/sdk%2Fcommon%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Fauth%2Ffilter%2FTokenFilter.java?ref=e755248d59543bcd668ace495f293ff735fa82e9",
                "patch": "@@ -6,13 +6,22 @@\n import jakarta.servlet.FilterConfig;\n import jakarta.servlet.*;\n import jakarta.servlet.http.HttpServletRequest;\n+import jakarta.servlet.http.HttpServletResponse;\n import org.apache.commons.lang3.StringUtils;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.HttpStatusCode;\n+import org.springframework.http.ResponseEntity;\n \n import java.io.IOException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n import java.util.Objects;\n \n public class TokenFilter implements Filter {\n \n+    private static final String headName = \"DE-GATEWAY-FLAG\";\n+\n     @Override\n     public void init(FilterConfig filterConfig) throws ServletException {\n     }\n@@ -36,10 +45,6 @@ public void doFilter(ServletRequest servletRequest, ServletResponse servletRespo\n             filterChain.doFilter(servletRequest, servletResponse);\n             return;\n         }\n-        /*String refreshToken = null;\n-        if (StringUtils.isNotBlank(refreshToken = ServletUtils.request().getHeader(AuthConstant.REFRESH_TOKEN_KEY))) {\n-            ServletUtils.response().addHeader(AuthConstant.REFRESH_TOKEN_KEY, refreshToken);\n-        }*/\n         String executeVersion = null;\n         if (StringUtils.isNotBlank(executeVersion = VersionUtil.getRandomVersion())) {\n             Objects.requireNonNull(ServletUtils.response()).addHeader(AuthConstant.DE_EXECUTE_VERSION, executeVersion);\n@@ -52,12 +57,41 @@ public void doFilter(ServletRequest servletRequest, ServletResponse servletRespo\n             return;\n         }\n         String token = ServletUtils.getToken();\n-        TokenUserBO userBO = TokenUtils.validate(token);\n-        UserUtils.setUserInfo(userBO);\n+        TokenUserBO userBO = null;\n+        try {\n+            userBO = TokenUtils.validate(token);\n+            UserUtils.setUserInfo(userBO);\n+        } catch (Exception e) {\n+            HttpServletResponse res = (HttpServletResponse) servletResponse;\n+            LogUtil.error(e.getMessage(), e);\n+            HttpHeaders headers = new HttpHeaders();\n+            String msg = URLEncoder.encode(e.getMessage(), StandardCharsets.UTF_8).replace(\"+\", \"%20\");\n+            headers.add(headName, msg);\n+            sendResponseEntity(res, new ResponseEntity<>(e.getMessage(), headers, HttpStatus.UNAUTHORIZED));\n+            return;\n+        }\n         filterChain.doFilter(servletRequest, servletResponse);\n     }\n \n     @Override\n     public void destroy() {\n     }\n+\n+    private void sendResponseEntity(HttpServletResponse httpResponse, ResponseEntity<String> responseEntity) throws IOException {\n+        HttpHeaders headers = responseEntity.getHeaders();\n+        HttpStatusCode statusCode = responseEntity.getStatusCode();\n+\n+        // \u8bbe\u7f6e\u72b6\u6001\u7801\n+        httpResponse.setStatus(statusCode.value());\n+\n+        // \u8bbe\u7f6e\u54cd\u5e94\u5934\n+        if (headers != null) {\n+            for (String name : headers.keySet()) {\n+                httpResponse.setHeader(name, headers.getFirst(name));\n+            }\n+        }\n+\n+        // \u8bbe\u7f6e\u54cd\u5e94\u4f53\n+        httpResponse.getWriter().write(responseEntity.getBody());\n+    }\n }"
            },
            {
                "sha": "8603b6debcbff867aa3f1ae031d8d27b7768855f",
                "filename": "sdk/common/src/main/java/io/dataease/utils/TokenUtils.java",
                "status": "modified",
                "additions": 33,
                "deletions": 1,
                "changes": 34,
                "blob_url": "https://github.com/dataease/dataease/blob/e755248d59543bcd668ace495f293ff735fa82e9/sdk%2Fcommon%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Futils%2FTokenUtils.java",
                "raw_url": "https://github.com/dataease/dataease/raw/e755248d59543bcd668ace495f293ff735fa82e9/sdk%2Fcommon%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Futils%2FTokenUtils.java",
                "contents_url": "https://api.github.com/repos/dataease/dataease/contents/sdk%2Fcommon%2Fsrc%2Fmain%2Fjava%2Fio%2Fdataease%2Futils%2FTokenUtils.java?ref=e755248d59543bcd668ace495f293ff735fa82e9",
                "patch": "@@ -1,11 +1,19 @@\n package io.dataease.utils;\n \n import com.auth0.jwt.JWT;\n+import com.auth0.jwt.JWTVerifier;\n+import com.auth0.jwt.algorithms.Algorithm;\n import com.auth0.jwt.interfaces.DecodedJWT;\n+import com.auth0.jwt.interfaces.Verification;\n import io.dataease.auth.bo.TokenUserBO;\n+import io.dataease.auth.config.SubstituleLoginConfig;\n import io.dataease.exception.DEException;\n+import io.dataease.license.utils.LicenseUtil;\n import org.apache.commons.lang3.ObjectUtils;\n import org.apache.commons.lang3.StringUtils;\n+import org.springframework.util.ReflectionUtils;\n+\n+import java.lang.reflect.Method;\n \n public class TokenUtils {\n \n@@ -28,9 +36,33 @@ public static TokenUserBO validate(String token) {\n         if (StringUtils.length(token) < 100) {\n             DEException.throwException(\"token is invalid\");\n         }\n-        return userBOByToken(token);\n+        TokenUserBO userBO = userBOByToken(token);\n+        if (ObjectUtils.isEmpty(userBO) || LicenseUtil.licenseValid()) {\n+            return userBO;\n+        }\n+        Long userId = userBO.getUserId();\n+        String secret = null;\n+        if (ObjectUtils.isEmpty(CommonBeanFactory.getBean(\"loginServer\"))) {\n+            String pwd = SubstituleLoginConfig.getPwd();\n+            secret = Md5Utils.md5(pwd);\n+        } else {\n+            Object apisixTokenManage = CommonBeanFactory.getBean(\"apisixTokenManage\");\n+            Method method = DeReflectUtil.findMethod(apisixTokenManage.getClass(), \"userCacheBO\");\n+            Object o = ReflectionUtils.invokeMethod(method, apisixTokenManage, userId);\n+            Method pwdMethod = DeReflectUtil.findMethod(o.getClass(), \"getPwd\");\n+            Object pwdObj = ReflectionUtils.invokeMethod(pwdMethod, o);\n+            secret = pwdObj.toString();\n+        }\n+        Algorithm algorithm = Algorithm.HMAC256(secret);\n+        Verification verification = JWT.require(algorithm).withClaim(\"uid\", userId).withClaim(\"oid\", userBO.getDefaultOid());\n+        JWTVerifier verifier = verification.build();\n+        DecodedJWT decode = JWT.decode(token);\n+        algorithm.verify(decode);\n+        verifier.verify(token);\n+        return userBO;\n     }\n \n+\n     public static TokenUserBO validateLinkToken(String linkToken) {\n         if (StringUtils.isBlank(linkToken)) {\n             String uri = ServletUtils.request().getRequestURI();"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/unopim/unopim/commits/9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a",
        "url": "https://api.github.com/repos/unopim/unopim/commits/9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a",
        "html_url": "https://github.com/unopim/unopim/commit/9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a",
        "message": "fix: user creation command validations and logging",
        "files": [
            {
                "sha": "3204d4140a1ffcdd68ab7c604ad15deb15f6232e",
                "filename": "packages/Webkul/Installer/src/Console/Commands/DefaultUser.php",
                "status": "modified",
                "additions": 302,
                "deletions": 12,
                "changes": 314,
                "blob_url": "https://github.com/unopim/unopim/blob/9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a/packages%2FWebkul%2FInstaller%2Fsrc%2FConsole%2FCommands%2FDefaultUser.php",
                "raw_url": "https://github.com/unopim/unopim/raw/9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a/packages%2FWebkul%2FInstaller%2Fsrc%2FConsole%2FCommands%2FDefaultUser.php",
                "contents_url": "https://api.github.com/repos/unopim/unopim/contents/packages%2FWebkul%2FInstaller%2Fsrc%2FConsole%2FCommands%2FDefaultUser.php?ref=9a0da7a0892c60f58df2351b5a9498dcb4cb8b7a",
                "patch": "@@ -2,8 +2,10 @@\n \n namespace Webkul\\Installer\\Console\\Commands;\n \n+use Carbon\\Carbon;\n use Illuminate\\Console\\Command;\n use Illuminate\\Support\\Facades\\DB;\n+use Illuminate\\Support\\Facades\\Log;\n use Illuminate\\Support\\Str;\n \n use function Laravel\\Prompts\\select;\n@@ -49,59 +51,322 @@ class DefaultUser extends Command\n         'zh_CN' => 'Chinese',\n     ];\n \n+    /**\n+     * Local codes.\n+     */\n+    protected $localCodes = [\n+        'af_ZA',\n+        'am_ET',\n+        'ar_AE',\n+        'ar_BH',\n+        'ar_DZ',\n+        'ar_EG',\n+        'ar_IQ',\n+        'ar_JO',\n+        'ar_KW',\n+        'ar_LB',\n+        'ar_LY',\n+        'ar_MA',\n+        'arn_CL',\n+        'ar_OM',\n+        'ar_QA',\n+        'ar_SA',\n+        'ar_SY',\n+        'ar_TN',\n+        'ar_YE',\n+        'as_IN',\n+        'az_Cyrl_AZ',\n+        'az_Latn_AZ',\n+        'ba_RU',\n+        'be_BY',\n+        'bg_BG',\n+        'bn_BD',\n+        'bn_IN',\n+        'bo_CN',\n+        'br_FR',\n+        'bs_Cyrl_BA',\n+        'bs_Latn_BA',\n+        'ca_ES',\n+        'co_FR',\n+        'cs_CZ',\n+        'cy_GB',\n+        'da_DK',\n+        'de_AT',\n+        'de_CH',\n+        'de_DE',\n+        'de_LI',\n+        'de_LU',\n+        'dsb_DE',\n+        'dv_MV',\n+        'el_GR',\n+        'en_029',\n+        'en_AU',\n+        'en_BZ',\n+        'en_CA',\n+        'en_GB',\n+        'en_IE',\n+        'en_IN',\n+        'en_JM',\n+        'en_MY',\n+        'en_NZ',\n+        'en_PH',\n+        'en_SG',\n+        'en_TT',\n+        'en_US',\n+        'en_ZA',\n+        'en_ZW',\n+        'es_AR',\n+        'es_BO',\n+        'es_CL',\n+        'es_CO',\n+        'es_CR',\n+        'es_DO',\n+        'es_EC',\n+        'es_ES',\n+        'es_GT',\n+        'es_HN',\n+        'es_MX',\n+        'es_NI',\n+        'es_PA',\n+        'es_PE',\n+        'es_PR',\n+        'es_PY',\n+        'es_SV',\n+        'es_US',\n+        'es_UY',\n+        'es_VE',\n+        'et_EE',\n+        'eu_ES',\n+        'fa_IR',\n+        'fi_FI',\n+        'fil_PH',\n+        'fo_FO',\n+        'fr_BE',\n+        'fr_CA',\n+        'fr_CH',\n+        'fr_FR',\n+        'fr_LU',\n+        'fr_MC',\n+        'fy_NL',\n+        'ga_IE',\n+        'gd_GB',\n+        'gl_ES',\n+        'gsw_FR',\n+        'gu_IN',\n+        'ha_Latn_NG',\n+        'he_IL',\n+        'hi_IN',\n+        'hr_BA',\n+        'hr_HR',\n+        'hsb_DE',\n+        'hu_HU',\n+        'hy_AM',\n+        'id_ID',\n+        'ig_NG',\n+        'ii_CN',\n+        'is_IS',\n+        'it_CH',\n+        'it_IT',\n+        'iu_Cans_CA',\n+        'iu_Latn_CA',\n+        'ja_JP',\n+        'ka_GE',\n+        'kk_KZ',\n+        'kl_GL',\n+        'km_KH',\n+        'kn_IN',\n+        'kok_IN',\n+        'ko_KR',\n+        'ky_KG',\n+        'lb_LU',\n+        'lo_LA',\n+        'lt_LT',\n+        'lv_LV',\n+        'mi_NZ',\n+        'mk_MK',\n+        'ml_IN',\n+        'mn_MN',\n+        'mn_Mong_CN',\n+        'moh_CA',\n+        'mr_IN',\n+        'ms_BN',\n+        'ms_MY',\n+        'mt_MT',\n+        'nb_NO',\n+        'ne_NP',\n+        'nl_BE',\n+        'nl_NL',\n+        'nn_NO',\n+        'nso_ZA',\n+        'oc_FR',\n+        'or_IN',\n+        'pa_IN',\n+        'pl_PL',\n+        'prs_AF',\n+        'ps_AF',\n+        'pt_BR',\n+        'pt_PT',\n+        'qut_GT',\n+        'quz_BO',\n+        'quz_EC',\n+        'quz_PE',\n+        'rm_CH',\n+        'ro_RO',\n+        'ru_RU',\n+        'rw_RW',\n+        'sah_RU',\n+        'sa_IN',\n+        'se_FI',\n+        'se_NO',\n+        'se_SE',\n+        'si_LK',\n+        'sk_SK',\n+        'sl_SI',\n+        'sma_NO',\n+        'sma_SE',\n+        'smj_NO',\n+        'smj_SE',\n+        'smn_FI',\n+        'sms_FI',\n+        'sq_AL',\n+        'sr_Cyrl_BA',\n+        'sr_Cyrl_CS',\n+        'sr_Cyrl_ME',\n+        'sr_Cyrl_RS',\n+        'sr_Latn_BA',\n+        'sr_Latn_CS',\n+        'sr_Latn_ME',\n+        'sr_Latn_RS',\n+        'sv_FI',\n+        'sv_SE',\n+        'sw_KE',\n+        'syr_SY',\n+        'ta_IN',\n+        'te_IN',\n+        'tg_Cyrl_TJ',\n+        'th_TH',\n+        'tk_TM',\n+        'tn_ZA',\n+        'tr_TR',\n+        'tt_RU',\n+        'tzm_Latn_DZ',\n+        'ug_CN',\n+        'uk_UA',\n+        'ur_PK',\n+        'uz_Cyrl_UZ',\n+        'uz_Latn_UZ',\n+        'vi_VN',\n+        'wo_SN',\n+        'xh_ZA',\n+        'yo_NG',\n+        'zh_CN',\n+        'zh_HK',\n+        'zh_MO',\n+        'zh_SG',\n+        'zh_TW',\n+        'zu_ZA',\n+    ];\n+\n     /**\n      * Create UnoPim user.\n      */\n     public function handle()\n     {\n-        $userName = $this->option('name') ?: text(\n+        Log::info('User create command has started');\n+\n+        $userName = $this->option('name');\n+        $isAdmin = $this->option('admin');\n+\n+        if ($userName && ! preg_match('/^[a-zA-Z0-9\\s]+$/', $userName)) {\n+            $this->warn('The name can only accept alphanumeric characters and spaces.');\n+            Log::warning('The name can only accept alphanumeric characters and spaces.');\n+            $userName = null;\n+        }\n+\n+        $userName = $userName ?: text(\n             label: 'Set the Name for User',\n-            default: 'Admin',\n-            required: true\n+            default: $isAdmin ? 'Admin' : 'User',\n+            required: true,\n+            validate: fn (string $value) => match (true) {\n+                ! preg_match('/^[a-zA-Z0-9\\s]+$/', $value) => 'The name can only accept alphanumeric characters and spaces.',\n+                default                                    => null\n+            }\n         );\n \n         $userEmail = $this->option('email');\n+        $existingUserEmails = DB::table('admins')->pluck('email')->toArray();\n+\n+        if ($userEmail && ! filter_var($userEmail, FILTER_VALIDATE_EMAIL)) {\n+            $this->warn('The provided email is invalid, kindly enter a valid email address.');\n+            Log::warning('The provided email is invalid, kindly enter a valid email address.');\n+        }\n+\n+        if ($userEmail && in_array($userEmail, $existingUserEmails)) {\n+            $this->warn('User with email '.$userEmail.' already exists.');\n+            Log::warning('User with email '.$userEmail.' already exists.');\n+            $userEmail = null;\n+        }\n \n         if (! $userEmail || ! filter_var($userEmail, FILTER_VALIDATE_EMAIL)) {\n             $userEmail = text(\n                 label: 'Provide Email of User',\n-                default: 'admin@example.com',\n+                default: $isAdmin ? 'admin@example.com' : 'user@example.com',\n                 validate: fn (string $value) => match (true) {\n                     ! filter_var($value, FILTER_VALIDATE_EMAIL) => 'The provided email is invalid, kindly enter a valid email address.',\n+                    in_array($value, $existingUserEmails)       => 'User with email '.$value.' already exists.',\n                     default                                     => null\n                 }\n             );\n         }\n \n         $userPassword = $this->option('password') ?: text(\n             label: 'Input a Secure Password for User',\n-            default: 'admin@123',\n+            default: $isAdmin ? 'admin@123' : 'user@123',\n             required: true\n         );\n \n         while (strlen($userPassword) < 6) {\n-            $this->error('Password must be at least 6 characters.');\n+            $this->warn('Password must be at least 6 characters.');\n+            Log::warning('Password must be at least 6 characters.');\n \n             $userPassword = text(\n                 label: 'Input a Secure Password for User',\n-                default: 'admin@123',\n+                default: $isAdmin ? 'admin@123' : 'user@123',\n                 required: true\n             );\n         }\n \n         $password = password_hash($userPassword, PASSWORD_BCRYPT, ['cost' => 10]);\n \n-        $timezone = $this->option('timezone') ?? date_default_timezone_get();\n+        $timezone = $this->option('timezone');\n+\n+        if ($timezone && ! array_key_exists($timezone, $this->getTimeZones())) {\n+            $this->warn(\"The specified timezone '$timezone' is not valid. Please select a valid timezone.\");\n+            Log::warning(\"The specified timezone '$timezone' is not valid. Please select a valid timezone.\");\n+            $timezone = null;\n+        }\n+\n+        $timezone = $timezone ?: $this->askForDefaultValues(\n+            'APP_LOCALE',\n+            'Please select the default timezone',\n+            $this->getTimeZones()\n+        );\n+\n+        $uiLocale = $this->option('ui_locale');\n \n-        $this->info('Your Default Timezone is '.$timezone);\n+        if ($uiLocale && ! in_array($uiLocale, $this->localCodes)) {\n+            $this->warn(\"The specified locale code '$uiLocale' is not valid. Please select a valid locale.\");\n+            Log::warning(\"The specified locale code '$uiLocale' is not valid. Please select a valid locale.\");\n+\n+            $uiLocale = null;\n+        }\n \n-        $defaultLocale = $this->option('ui_locale') ?: $this->askForDefaultLocale(\n+        $defaultLocale = $uiLocale ?: $this->askForDefaultValues(\n             'APP_LOCALE',\n             'Please select the default application locale',\n             $this->locales\n         );\n \n-        $isAdmin = $this->option('admin');\n         $localeId = DB::table('locales')->where('code', $defaultLocale)->where('status', 1)->first()?->id ?? 58;\n         $role = $isAdmin ? DB::table('roles')->where('permission_type', 'all')->first()?->id : DB::table('roles')->where('permission_type', 'custom')->first()?->id;\n \n@@ -140,19 +405,22 @@ public function handle()\n             $this->info('Email: '.$userEmail);\n             $this->info('Password: '.$userPassword);\n             $this->info('Cheers!');\n+            Log::info('Congratulations! The User has been created successfully');\n         } catch (\\Exception $e) {\n             if (strpos($e->getMessage(), 'Duplicate entry')) {\n                 $this->error('User with email '.$userEmail.' already exists.');\n+                Log::error('User with email '.$userEmail.' already exists.');\n             } else {\n                 $this->error($e->getMessage());\n+                Log::error($e->getMessage());\n             }\n         }\n     }\n \n     /**\n      * Method for asking default locale choice based on the list of options.\n      */\n-    protected function askForDefaultLocale(string $key, string $question, array $choices): string\n+    protected function askForDefaultValues(string $key, string $question, array $choices): string\n     {\n         $choice = select(\n             label: $question,\n@@ -162,4 +430,26 @@ protected function askForDefaultLocale(string $key, string $question, array $cho\n \n         return $choice;\n     }\n+\n+    /**\n+     * Get All timezones list with offset in name\n+     */\n+    public function getTimeZones(): array\n+    {\n+        $timezones = \\DateTimeZone::listIdentifiers();\n+\n+        $formattedTimezones = [];\n+\n+        foreach ($timezones as $index => $timezone) {\n+            $now = Carbon::now($timezone);\n+\n+            $offset = $now->offset / 60;\n+\n+            $formattedName = sprintf('%s (%+03d:%02d)', $timezone, $offset / 60, abs($offset % 60));\n+\n+            $formattedTimezones[$timezone] = $formattedName;\n+        }\n+\n+        return $formattedTimezones;\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Laravel-Backpack/FileManager/commits/2830498b85e05fb3c92179053b4d7c4a0fdb880b",
        "url": "https://api.github.com/repos/Laravel-Backpack/FileManager/commits/2830498b85e05fb3c92179053b4d7c4a0fdb880b",
        "html_url": "https://github.com/Laravel-Backpack/FileManager/commit/2830498b85e05fb3c92179053b4d7c4a0fdb880b",
        "message": "Merge pull request #58 from Laravel-Backpack/fix-json-decode-request-value\n\nfix mime types",
        "files": [
            {
                "sha": "35dc84837482e23ac571ce3aedbfe30209501d7e",
                "filename": "src/BackpackElfinderController.php",
                "status": "added",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/Laravel-Backpack/FileManager/blob/2830498b85e05fb3c92179053b4d7c4a0fdb880b/src%2FBackpackElfinderController.php",
                "raw_url": "https://github.com/Laravel-Backpack/FileManager/raw/2830498b85e05fb3c92179053b4d7c4a0fdb880b/src%2FBackpackElfinderController.php",
                "contents_url": "https://api.github.com/repos/Laravel-Backpack/FileManager/contents/src%2FBackpackElfinderController.php?ref=2830498b85e05fb3c92179053b4d7c4a0fdb880b",
                "patch": "@@ -0,0 +1,28 @@\n+<?php\n+\n+namespace Backpack\\FileManager;\n+\n+use Illuminate\\Support\\Facades\\Crypt;\n+use Illuminate\\Support\\Facades\\Log;\n+\n+class BackpackElfinderController extends \\Barryvdh\\Elfinder\\ElfinderController\n+{\n+    public function showPopup($input_id)\n+    {\n+        $mimes = request('mimes');\n+\n+        try {\n+            $mimes = Crypt::decrypt(urldecode(request('mimes')));\n+        } catch (\\Illuminate\\Contracts\\Encryption\\DecryptException $e) {\n+            Log::error('Someone attempted to tamper with mime types in elfinder popup. The attempt was blocked.');\n+            abort(403, 'Unauthorized action.');\n+        }\n+\n+        request()->merge(['mimes' => urlencode(serialize($mimes))]);\n+\n+        return $this->app['view']\n+            ->make($this->package.'::standalonepopup')\n+            ->with($this->getViewVars())\n+            ->with(compact('input_id'));\n+    }\n+}"
            },
            {
                "sha": "a426fa0c4ff4a75219762b8e06d9a63ad14197d9",
                "filename": "src/FileManagerServiceProvider.php",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/Laravel-Backpack/FileManager/blob/2830498b85e05fb3c92179053b4d7c4a0fdb880b/src%2FFileManagerServiceProvider.php",
                "raw_url": "https://github.com/Laravel-Backpack/FileManager/raw/2830498b85e05fb3c92179053b4d7c4a0fdb880b/src%2FFileManagerServiceProvider.php",
                "contents_url": "https://api.github.com/repos/Laravel-Backpack/FileManager/contents/src%2FFileManagerServiceProvider.php?ref=2830498b85e05fb3c92179053b4d7c4a0fdb880b",
                "patch": "@@ -3,13 +3,14 @@\n namespace Backpack\\FileManager;\n \n use Backpack\\Basset\\Facades\\Basset;\n+use Barryvdh\\Elfinder\\ElfinderController;\n use Illuminate\\Support\\Facades\\Config;\n use Illuminate\\Support\\ServiceProvider;\n \n class FileManagerServiceProvider extends ServiceProvider\n {\n     protected $commands = [\n-        \\Backpack\\FileManager\\Console\\Commands\\Install::class,\n+        Console\\Commands\\Install::class,\n     ];\n \n     /**\n@@ -25,6 +26,11 @@ public function boot()\n         }\n     }\n \n+    public function register()\n+    {\n+        $this->app->bind(ElfinderController::class, BackpackElfinderController::class);\n+    }\n+\n     /**\n      * Console-specific booting.\n      *"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/yugabyte/yugabyte-db/commits/920989b6c0db0222bb7a0cce46febc76cf72d438",
        "url": "https://api.github.com/repos/yugabyte/yugabyte-db/commits/920989b6c0db0222bb7a0cce46febc76cf72d438",
        "html_url": "https://github.com/yugabyte/yugabyte-db/commit/920989b6c0db0222bb7a0cce46febc76cf72d438",
        "message": "[PLAT-14788]mask SAS token in backup config response and logs\n\nSummary:\nRedact SAS token in backup response and v1 backup logs.\nSAS token is basically a bunch of query params,\neg `sp=racwdli&st=2024-09-02T08:35:05Z&se=2024-12-31T16:35:05Z&sv=2022-11-02&sr=c&sig=****`.\n\nIn v1 backups we are logging this token without redacting the sig.\n\nTest Plan: Manually reproduced the issue by taking v1 backups on a universe. verfied the sig is redacted after my changes. Also verified that the SAS token is masked on backup config UI.\n\nReviewers: #yba-api-review!, vkumar, amalyshev\n\nReviewed By: amalyshev\n\nSubscribers: yugaware\n\nDifferential Revision: https://phorge.dev.yugabyte.com/D37715",
        "files": [
            {
                "sha": "cc421d3b41a2343fc6afb58e0e1b1e6bba3d5105",
                "filename": "managed/src/main/java/com/yugabyte/yw/common/RedactingService.java",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/yugabyte/yugabyte-db/blob/920989b6c0db0222bb7a0cce46febc76cf72d438/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommon%2FRedactingService.java",
                "raw_url": "https://github.com/yugabyte/yugabyte-db/raw/920989b6c0db0222bb7a0cce46febc76cf72d438/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommon%2FRedactingService.java",
                "contents_url": "https://api.github.com/repos/yugabyte/yugabyte-db/contents/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommon%2FRedactingService.java?ref=920989b6c0db0222bb7a0cce46febc76cf72d438",
                "patch": "@@ -32,6 +32,9 @@ public class RedactingService {\n           \"$..ysqlCurrentPassword\",\n           \"$..sshPrivateKeyContent\");\n \n+  public static final List<String> SECRET_QUERY_PARAMS_FOR_LOGS =\n+      ImmutableList.of(/* SAS Token */ \"sig\");\n+\n   public static final List<String> SECRET_PATHS_FOR_LOGS =\n       ImmutableList.<String>builder()\n           .addAll(SECRET_PATHS_FOR_APIS)\n@@ -150,6 +153,16 @@ public static String redactString(String input) {\n     return output;\n   }\n \n+  public static String redactQueryParams(String input) {\n+    String output = input;\n+    for (String param : SECRET_QUERY_PARAMS_FOR_LOGS) {\n+      String regex = \"([?&]\" + param + \"=)([^&]+)\";\n+      String replacement = \"$1\" + SECRET_REPLACEMENT;\n+      output = output.replaceAll(regex, replacement);\n+    }\n+    return output;\n+  }\n+\n   public enum RedactionTarget {\n     LOGS,\n     APIS;"
            },
            {
                "sha": "4aaf0247f8a1600f967907fccdb8f217d16206ab",
                "filename": "managed/src/main/java/com/yugabyte/yw/common/ShellProcessHandler.java",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/yugabyte/yugabyte-db/blob/920989b6c0db0222bb7a0cce46febc76cf72d438/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommon%2FShellProcessHandler.java",
                "raw_url": "https://github.com/yugabyte/yugabyte-db/raw/920989b6c0db0222bb7a0cce46febc76cf72d438/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommon%2FShellProcessHandler.java",
                "contents_url": "https://api.github.com/repos/yugabyte/yugabyte-db/contents/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fcommon%2FShellProcessHandler.java?ref=920989b6c0db0222bb7a0cce46febc76cf72d438",
                "patch": "@@ -239,13 +239,13 @@ private String getOutputLines(BufferedReader reader, boolean logOutput) {\n             .peek(\n                 line -> {\n                   if (logOutput) {\n-                    log.debug(fileMarker, line);\n+                    log.debug(fileMarker, RedactingService.redactQueryParams(line));\n                   }\n                 })\n             .collect(Collectors.joining(\"\\n\"))\n             .trim();\n     if (logOutput && cloudLoggingEnabled && lines.length() > 0) {\n-      log.debug(consoleMarker, lines);\n+      log.debug(consoleMarker, RedactingService.redactQueryParams(lines));\n     }\n     return lines;\n   }"
            },
            {
                "sha": "b0fec90c0e69c1cfd26e341012d551f13e65058c",
                "filename": "managed/src/main/java/com/yugabyte/yw/models/helpers/CommonUtils.java",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/yugabyte/yugabyte-db/blob/920989b6c0db0222bb7a0cce46febc76cf72d438/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fmodels%2Fhelpers%2FCommonUtils.java",
                "raw_url": "https://github.com/yugabyte/yugabyte-db/raw/920989b6c0db0222bb7a0cce46febc76cf72d438/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fmodels%2Fhelpers%2FCommonUtils.java",
                "contents_url": "https://api.github.com/repos/yugabyte/yugabyte-db/contents/managed%2Fsrc%2Fmain%2Fjava%2Fcom%2Fyugabyte%2Fyw%2Fmodels%2Fhelpers%2FCommonUtils.java?ref=920989b6c0db0222bb7a0cce46febc76cf72d438",
                "patch": "@@ -84,7 +84,14 @@ public class CommonUtils {\n   // Sensisitve field substrings\n   private static final List<String> sensitiveFieldSubstrings =\n       Arrays.asList(\n-          \"KEY\", \"SECRET\", \"CREDENTIALS\", \"API\", \"POLICY\", \"HC_VAULT_TOKEN\", \"vaultToken\");\n+          \"KEY\",\n+          \"SECRET\",\n+          \"CREDENTIALS\",\n+          \"API\",\n+          \"POLICY\",\n+          \"HC_VAULT_TOKEN\",\n+          \"vaultToken\",\n+          \"SAS_TOKEN\");\n   // Exclude following strings from being sensitive fields\n   private static final List<String> excludedFieldNames =\n       Arrays.asList("
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openssl/openssl/commits/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
        "url": "https://api.github.com/repos/openssl/openssl/commits/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
        "html_url": "https://github.com/openssl/openssl/commit/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
        "message": "Only free the read buffers if we're not using them\n\nIf we're part way through processing a record, or the application has\nnot released all the records then we should not free our buffer because\nthey are still needed.\n\nCVE-2024-4741\n\nReviewed-by: Tomas Mraz <tomas@openssl.org>\nReviewed-by: Neil Horman <nhorman@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/24395)\n\n(cherry picked from commit 704f725b96aa373ee45ecfb23f6abfe8be8d9177)",
        "files": [
            {
                "sha": "1569997bea2d31277f50189f52465eae028a7260",
                "filename": "ssl/record/rec_layer_s3.c",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/openssl/openssl/blob/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Frecord%2Frec_layer_s3.c",
                "raw_url": "https://github.com/openssl/openssl/raw/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Frecord%2Frec_layer_s3.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Frecord%2Frec_layer_s3.c?ref=b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
                "patch": "@@ -81,6 +81,15 @@ int RECORD_LAYER_read_pending(const RECORD_LAYER *rl)\n     return SSL3_BUFFER_get_left(&rl->rbuf) != 0;\n }\n \n+int RECORD_LAYER_data_present(const RECORD_LAYER *rl)\n+{\n+    if (rl->rstate == SSL_ST_READ_BODY)\n+        return 1;\n+    if (RECORD_LAYER_processed_read_pending(rl))\n+        return 1;\n+    return 0;\n+}\n+\n /* Checks if we have decrypted unread record data pending */\n int RECORD_LAYER_processed_read_pending(const RECORD_LAYER *rl)\n {"
            },
            {
                "sha": "b60f71c8cb23b49e813fd2ec4a4c2906767e4fb7",
                "filename": "ssl/record/record.h",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/openssl/openssl/blob/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Frecord%2Frecord.h",
                "raw_url": "https://github.com/openssl/openssl/raw/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Frecord%2Frecord.h",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Frecord%2Frecord.h?ref=b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
                "patch": "@@ -205,6 +205,7 @@ void RECORD_LAYER_release(RECORD_LAYER *rl);\n int RECORD_LAYER_read_pending(const RECORD_LAYER *rl);\n int RECORD_LAYER_processed_read_pending(const RECORD_LAYER *rl);\n int RECORD_LAYER_write_pending(const RECORD_LAYER *rl);\n+int RECORD_LAYER_data_present(const RECORD_LAYER *rl);\n void RECORD_LAYER_reset_read_sequence(RECORD_LAYER *rl);\n void RECORD_LAYER_reset_write_sequence(RECORD_LAYER *rl);\n int RECORD_LAYER_is_sslv2_record(RECORD_LAYER *rl);"
            },
            {
                "sha": "d14c55ae557bcc272ba58aa15b6f9fac519d2c37",
                "filename": "ssl/ssl_lib.c",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/openssl/openssl/blob/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Fssl_lib.c",
                "raw_url": "https://github.com/openssl/openssl/raw/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Fssl_lib.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Fssl_lib.c?ref=b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
                "patch": "@@ -5492,6 +5492,9 @@ int SSL_free_buffers(SSL *ssl)\n     if (RECORD_LAYER_read_pending(rl) || RECORD_LAYER_write_pending(rl))\n         return 0;\n \n+    if (RECORD_LAYER_data_present(rl))\n+        return 0;\n+\n     RECORD_LAYER_release(rl);\n     return 1;\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openssl/openssl/commits/e5093133c35ca82874ad83697af76f4b0f7e3bd8",
        "url": "https://api.github.com/repos/openssl/openssl/commits/e5093133c35ca82874ad83697af76f4b0f7e3bd8",
        "html_url": "https://github.com/openssl/openssl/commit/e5093133c35ca82874ad83697af76f4b0f7e3bd8",
        "message": "Only free the read buffers if we're not using them\n\nIf we're part way through processing a record, or the application has\nnot released all the records then we should not free our buffer because\nthey are still needed.\n\nCVE-2024-4741\n\nReviewed-by: Tomas Mraz <tomas@openssl.org>\nReviewed-by: Neil Horman <nhorman@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/24395)\n\n(cherry picked from commit 38690cab18de88198f46478565fab423cf534efa)",
        "files": [
            {
                "sha": "01cf3012b8c2cbf167fe3e8ec8ddaf30f8917f0a",
                "filename": "ssl/record/methods/tls_common.c",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/openssl/openssl/blob/e5093133c35ca82874ad83697af76f4b0f7e3bd8/ssl%2Frecord%2Fmethods%2Ftls_common.c",
                "raw_url": "https://github.com/openssl/openssl/raw/e5093133c35ca82874ad83697af76f4b0f7e3bd8/ssl%2Frecord%2Fmethods%2Ftls_common.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Frecord%2Fmethods%2Ftls_common.c?ref=e5093133c35ca82874ad83697af76f4b0f7e3bd8",
                "patch": "@@ -2124,7 +2124,10 @@ int tls_free_buffers(OSSL_RECORD_LAYER *rl)\n     /* Read direction */\n \n     /* If we have pending data to be read then fail */\n-    if (rl->curr_rec < rl->num_recs || TLS_BUFFER_get_left(&rl->rbuf) != 0)\n+    if (rl->curr_rec < rl->num_recs\n+            || rl->curr_rec != rl->num_released\n+            || TLS_BUFFER_get_left(&rl->rbuf) != 0\n+            || rl->rstate == SSL_ST_READ_BODY)\n         return 0;\n \n     return tls_release_read_buffer(rl);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openssl/openssl/commits/b3f0eb0a29",
        "url": "https://api.github.com/repos/openssl/openssl/commits/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
        "html_url": "https://github.com/openssl/openssl/commit/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
        "message": "Only free the read buffers if we're not using them\n\nIf we're part way through processing a record, or the application has\nnot released all the records then we should not free our buffer because\nthey are still needed.\n\nCVE-2024-4741\n\nReviewed-by: Tomas Mraz <tomas@openssl.org>\nReviewed-by: Neil Horman <nhorman@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/24395)\n\n(cherry picked from commit 704f725b96aa373ee45ecfb23f6abfe8be8d9177)",
        "files": [
            {
                "sha": "1569997bea2d31277f50189f52465eae028a7260",
                "filename": "ssl/record/rec_layer_s3.c",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/openssl/openssl/blob/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Frecord%2Frec_layer_s3.c",
                "raw_url": "https://github.com/openssl/openssl/raw/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Frecord%2Frec_layer_s3.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Frecord%2Frec_layer_s3.c?ref=b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
                "patch": "@@ -81,6 +81,15 @@ int RECORD_LAYER_read_pending(const RECORD_LAYER *rl)\n     return SSL3_BUFFER_get_left(&rl->rbuf) != 0;\n }\n \n+int RECORD_LAYER_data_present(const RECORD_LAYER *rl)\n+{\n+    if (rl->rstate == SSL_ST_READ_BODY)\n+        return 1;\n+    if (RECORD_LAYER_processed_read_pending(rl))\n+        return 1;\n+    return 0;\n+}\n+\n /* Checks if we have decrypted unread record data pending */\n int RECORD_LAYER_processed_read_pending(const RECORD_LAYER *rl)\n {"
            },
            {
                "sha": "b60f71c8cb23b49e813fd2ec4a4c2906767e4fb7",
                "filename": "ssl/record/record.h",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/openssl/openssl/blob/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Frecord%2Frecord.h",
                "raw_url": "https://github.com/openssl/openssl/raw/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Frecord%2Frecord.h",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Frecord%2Frecord.h?ref=b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
                "patch": "@@ -205,6 +205,7 @@ void RECORD_LAYER_release(RECORD_LAYER *rl);\n int RECORD_LAYER_read_pending(const RECORD_LAYER *rl);\n int RECORD_LAYER_processed_read_pending(const RECORD_LAYER *rl);\n int RECORD_LAYER_write_pending(const RECORD_LAYER *rl);\n+int RECORD_LAYER_data_present(const RECORD_LAYER *rl);\n void RECORD_LAYER_reset_read_sequence(RECORD_LAYER *rl);\n void RECORD_LAYER_reset_write_sequence(RECORD_LAYER *rl);\n int RECORD_LAYER_is_sslv2_record(RECORD_LAYER *rl);"
            },
            {
                "sha": "d14c55ae557bcc272ba58aa15b6f9fac519d2c37",
                "filename": "ssl/ssl_lib.c",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/openssl/openssl/blob/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Fssl_lib.c",
                "raw_url": "https://github.com/openssl/openssl/raw/b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d/ssl%2Fssl_lib.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Fssl_lib.c?ref=b3f0eb0a295f58f16ba43ba99dad70d4ee5c437d",
                "patch": "@@ -5492,6 +5492,9 @@ int SSL_free_buffers(SSL *ssl)\n     if (RECORD_LAYER_read_pending(rl) || RECORD_LAYER_write_pending(rl))\n         return 0;\n \n+    if (RECORD_LAYER_data_present(rl))\n+        return 0;\n+\n     RECORD_LAYER_release(rl);\n     return 1;\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openssl/openssl/commits/c88c3de51020c37e8706bf7a682a162593053aac",
        "url": "https://api.github.com/repos/openssl/openssl/commits/c88c3de51020c37e8706bf7a682a162593053aac",
        "html_url": "https://github.com/openssl/openssl/commit/c88c3de51020c37e8706bf7a682a162593053aac",
        "message": "Only free the read buffers if we're not using them\n\nIf we're part way through processing a record, or the application has\nnot released all the records then we should not free our buffer because\nthey are still needed.\n\nCVE-2024-4741\n\nReviewed-by: Tomas Mraz <tomas@openssl.org>\nReviewed-by: Neil Horman <nhorman@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/24395)\n\n(cherry picked from commit 38690cab18de88198f46478565fab423cf534efa)",
        "files": [
            {
                "sha": "f46da0fd5b33f401beecdc4850f29393089f7202",
                "filename": "ssl/record/methods/tls_common.c",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/openssl/openssl/blob/c88c3de51020c37e8706bf7a682a162593053aac/ssl%2Frecord%2Fmethods%2Ftls_common.c",
                "raw_url": "https://github.com/openssl/openssl/raw/c88c3de51020c37e8706bf7a682a162593053aac/ssl%2Frecord%2Fmethods%2Ftls_common.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Frecord%2Fmethods%2Ftls_common.c?ref=c88c3de51020c37e8706bf7a682a162593053aac",
                "patch": "@@ -2129,7 +2129,10 @@ int tls_free_buffers(OSSL_RECORD_LAYER *rl)\n     /* Read direction */\n \n     /* If we have pending data to be read then fail */\n-    if (rl->curr_rec < rl->num_recs || TLS_BUFFER_get_left(&rl->rbuf) != 0)\n+    if (rl->curr_rec < rl->num_recs\n+            || rl->curr_rec != rl->num_released\n+            || TLS_BUFFER_get_left(&rl->rbuf) != 0\n+            || rl->rstate == SSL_ST_READ_BODY)\n         return 0;\n \n     return tls_release_read_buffer(rl);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/openssl/openssl/commits/704f725b96aa373ee45ecfb23f6abfe8be8d9177",
        "url": "https://api.github.com/repos/openssl/openssl/commits/704f725b96aa373ee45ecfb23f6abfe8be8d9177",
        "html_url": "https://github.com/openssl/openssl/commit/704f725b96aa373ee45ecfb23f6abfe8be8d9177",
        "message": "Only free the read buffers if we're not using them\n\nIf we're part way through processing a record, or the application has\nnot released all the records then we should not free our buffer because\nthey are still needed.\n\nCVE-2024-4741\n\nReviewed-by: Tomas Mraz <tomas@openssl.org>\nReviewed-by: Neil Horman <nhorman@openssl.org>\nReviewed-by: Matt Caswell <matt@openssl.org>\n(Merged from https://github.com/openssl/openssl/pull/24395)",
        "files": [
            {
                "sha": "1569997bea2d31277f50189f52465eae028a7260",
                "filename": "ssl/record/rec_layer_s3.c",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/openssl/openssl/blob/704f725b96aa373ee45ecfb23f6abfe8be8d9177/ssl%2Frecord%2Frec_layer_s3.c",
                "raw_url": "https://github.com/openssl/openssl/raw/704f725b96aa373ee45ecfb23f6abfe8be8d9177/ssl%2Frecord%2Frec_layer_s3.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Frecord%2Frec_layer_s3.c?ref=704f725b96aa373ee45ecfb23f6abfe8be8d9177",
                "patch": "@@ -81,6 +81,15 @@ int RECORD_LAYER_read_pending(const RECORD_LAYER *rl)\n     return SSL3_BUFFER_get_left(&rl->rbuf) != 0;\n }\n \n+int RECORD_LAYER_data_present(const RECORD_LAYER *rl)\n+{\n+    if (rl->rstate == SSL_ST_READ_BODY)\n+        return 1;\n+    if (RECORD_LAYER_processed_read_pending(rl))\n+        return 1;\n+    return 0;\n+}\n+\n /* Checks if we have decrypted unread record data pending */\n int RECORD_LAYER_processed_read_pending(const RECORD_LAYER *rl)\n {"
            },
            {
                "sha": "b60f71c8cb23b49e813fd2ec4a4c2906767e4fb7",
                "filename": "ssl/record/record.h",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/openssl/openssl/blob/704f725b96aa373ee45ecfb23f6abfe8be8d9177/ssl%2Frecord%2Frecord.h",
                "raw_url": "https://github.com/openssl/openssl/raw/704f725b96aa373ee45ecfb23f6abfe8be8d9177/ssl%2Frecord%2Frecord.h",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Frecord%2Frecord.h?ref=704f725b96aa373ee45ecfb23f6abfe8be8d9177",
                "patch": "@@ -205,6 +205,7 @@ void RECORD_LAYER_release(RECORD_LAYER *rl);\n int RECORD_LAYER_read_pending(const RECORD_LAYER *rl);\n int RECORD_LAYER_processed_read_pending(const RECORD_LAYER *rl);\n int RECORD_LAYER_write_pending(const RECORD_LAYER *rl);\n+int RECORD_LAYER_data_present(const RECORD_LAYER *rl);\n void RECORD_LAYER_reset_read_sequence(RECORD_LAYER *rl);\n void RECORD_LAYER_reset_write_sequence(RECORD_LAYER *rl);\n int RECORD_LAYER_is_sslv2_record(RECORD_LAYER *rl);"
            },
            {
                "sha": "9088223b9f6bbd2439a3fc65caf7acfe9fd1a178",
                "filename": "ssl/ssl_lib.c",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/openssl/openssl/blob/704f725b96aa373ee45ecfb23f6abfe8be8d9177/ssl%2Fssl_lib.c",
                "raw_url": "https://github.com/openssl/openssl/raw/704f725b96aa373ee45ecfb23f6abfe8be8d9177/ssl%2Fssl_lib.c",
                "contents_url": "https://api.github.com/repos/openssl/openssl/contents/ssl%2Fssl_lib.c?ref=704f725b96aa373ee45ecfb23f6abfe8be8d9177",
                "patch": "@@ -5493,6 +5493,9 @@ int SSL_free_buffers(SSL *ssl)\n     if (RECORD_LAYER_read_pending(rl) || RECORD_LAYER_write_pending(rl))\n         return 0;\n \n+    if (RECORD_LAYER_data_present(rl))\n+        return 0;\n+\n     RECORD_LAYER_release(rl);\n     return 1;\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/matthewmueller/dom-iterator/commits/9e0e0fad5a251de5b42feb326c4204eb04080805",
        "url": "https://api.github.com/repos/matthewmueller/dom-iterator/commits/9e0e0fad5a251de5b42feb326c4204eb04080805",
        "html_url": "https://github.com/matthewmueller/dom-iterator/commit/9e0e0fad5a251de5b42feb326c4204eb04080805",
        "message": "Fix for CVE-2024-21541",
        "files": [
            {
                "sha": "f52a2576c4b665cce30dbd7cc72d5da124afd315",
                "filename": "index.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/matthewmueller/dom-iterator/blob/9e0e0fad5a251de5b42feb326c4204eb04080805/index.js",
                "raw_url": "https://github.com/matthewmueller/dom-iterator/raw/9e0e0fad5a251de5b42feb326c4204eb04080805/index.js",
                "contents_url": "https://api.github.com/repos/matthewmueller/dom-iterator/contents/index.js?ref=9e0e0fad5a251de5b42feb326c4204eb04080805",
                "patch": "@@ -267,7 +267,7 @@ Iterator.prototype.compile = function(expr) {\n     case 'number':\n       return function(node) { return expr == node.nodeType; };\n     case 'string':\n-      return new Function('node', 'return ' + props(expr, 'node.'));\n+      return new Function('node', 'Object.freeze(node); return ' + props(expr, 'node.'));\n     case 'function':\n       return expr;\n     default:"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mihula/ProDotNetZip/commits/18486ad6d13742a07a6755ef6edf60d7458f1854",
        "url": "https://api.github.com/repos/mihula/ProDotNetZip/commits/18486ad6d13742a07a6755ef6edf60d7458f1854",
        "html_url": "https://github.com/mihula/ProDotNetZip/commit/18486ad6d13742a07a6755ef6edf60d7458f1854",
        "message": "Fix CVE-2024-48510",
        "files": [
            {
                "sha": "f8e0d90205f44e76b7abe4baafbec2a5b03517c2",
                "filename": "src/Zip/ZipEntry.Extract.cs",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/mihula/ProDotNetZip/blob/18486ad6d13742a07a6755ef6edf60d7458f1854/src%2FZip%2FZipEntry.Extract.cs",
                "raw_url": "https://github.com/mihula/ProDotNetZip/raw/18486ad6d13742a07a6755ef6edf60d7458f1854/src%2FZip%2FZipEntry.Extract.cs",
                "contents_url": "https://api.github.com/repos/mihula/ProDotNetZip/contents/src%2FZip%2FZipEntry.Extract.cs?ref=18486ad6d13742a07a6755ef6edf60d7458f1854",
                "patch": "@@ -1389,6 +1389,16 @@ bool IsDoneWithOutputToBaseDir(string baseDir, out string outFileName)\n \n             // workitem 10639\n             outFileName = outFileName.Replace('/', Path.DirectorySeparatorChar);\n+            \n+            // Resolve any directory traversal sequence and compare the result with the intended base directory\n+            // where the file or folder will be created.\n+            // https://gist.github.com/thomas-chauchefoin-bentley-systems/855218959116f870f08857cce2aec731\n+            var canonicalOutPath = Path.GetFullPath(outFileName);\n+            var canonicalBaseDir = Path.GetFullPath(baseDir);\n+            if (!canonicalOutPath.StartsWith(canonicalBaseDir, StringComparison.OrdinalIgnoreCase))\n+            {\n+                throw new IOException(string.Format(\"Extracting {0} would write to {1}, outside of {2}; rejecting.\", outFileName, canonicalOutPath, canonicalBaseDir));\n+            }\n \n             // check if it is a directory\n             if (IsDirectory || FileName.EndsWith(\"/\"))"
            },
            {
                "sha": "b09219b23f4651d6eb9e6afe3e79b09928aa2890",
                "filename": "test/BasicTest.cs",
                "status": "modified",
                "additions": 45,
                "deletions": 7,
                "changes": 52,
                "blob_url": "https://github.com/mihula/ProDotNetZip/blob/18486ad6d13742a07a6755ef6edf60d7458f1854/test%2FBasicTest.cs",
                "raw_url": "https://github.com/mihula/ProDotNetZip/raw/18486ad6d13742a07a6755ef6edf60d7458f1854/test%2FBasicTest.cs",
                "contents_url": "https://api.github.com/repos/mihula/ProDotNetZip/contents/test%2FBasicTest.cs?ref=18486ad6d13742a07a6755ef6edf60d7458f1854",
                "patch": "@@ -1,14 +1,52 @@\n using Xunit;\n+using Xunit.Abstractions;\n \n-namespace Ionic.Zip.Tests\n+namespace Ionic.Zip.Tests;\n+\n+public class BasicTest\n {\n-    public class BasicTest\n+    private readonly ITestOutputHelper _output;\n+    \n+    public BasicTest(ITestOutputHelper output)\n+    {\n+        _output = output;\n+    }\n+        \n+    [Fact]\n+    public void TestCreate()\n+    {\n+        var result = new ZipFile();\n+        Assert.NotNull(result);\n+    }\n+\n+    [Fact]\n+    public void Extract_ZipWithAbsolutePathsOutside()\n     {\n-        [Fact]\n-        public void TestCreate()\n+        Assert.Throws<IOException>(() => Extract_ZipFile(\"absolute-path-traversal.zip\"));\n+        Assert.False(File.Exists(@\"C:\\Windows\\Temp\\foo\"));\n+    }\n+\n+    private void Extract_ZipFile(string fileName)\n+    {\n+        var sourceDir = Directory.GetCurrentDirectory();\n+        _output.WriteLine(\"Current Dir: {0}\", sourceDir);\n+\n+        var fqFileName = Path.Combine(sourceDir, \"zips\", fileName);\n+\n+        _output.WriteLine(\"Reading zip file: '{0}'\", fqFileName);\n+        using var zip = ZipFile.Read(fqFileName);\n+        const string extractDir = \"extract\";\n+        foreach (ZipEntry e in zip)\n         {\n-            var result = new ZipFile();\n-            Assert.NotNull(result);\n+            _output.WriteLine(\"{1,-22} {2,9} {3,5:F0}%   {4,9}  {5,3} {6:X8} {0}\",\n+                e.FileName,\n+                e.LastModified.ToString(\"yyyy-MM-dd HH:mm:ss\"),\n+                e.UncompressedSize,\n+                e.CompressionRatio,\n+                e.CompressedSize,\n+                (e.UsesEncryption) ? \"Y\" : \"N\",\n+                e.Crc);\n+            e.Extract(extractDir);\n         }\n     }\n-}\n+}\n\\ No newline at end of file"
            },
            {
                "sha": "3e7a0515e9f5685d10d321f75f97a6a24dceb2e2",
                "filename": "test/ProDotNetZipNetStandardTest.csproj",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/mihula/ProDotNetZip/blob/18486ad6d13742a07a6755ef6edf60d7458f1854/test%2FProDotNetZipNetStandardTest.csproj",
                "raw_url": "https://github.com/mihula/ProDotNetZip/raw/18486ad6d13742a07a6755ef6edf60d7458f1854/test%2FProDotNetZipNetStandardTest.csproj",
                "contents_url": "https://api.github.com/repos/mihula/ProDotNetZip/contents/test%2FProDotNetZipNetStandardTest.csproj?ref=18486ad6d13742a07a6755ef6edf60d7458f1854",
                "patch": "@@ -26,4 +26,10 @@\n \t\t<ProjectReference Include=\"..\\src\\ProDotNetZipNetStandard.csproj\" />\n \t</ItemGroup>\n \n+\t<ItemGroup>\n+\t  <None Update=\"zips\\absolute-path-traversal.zip\">\n+\t    <CopyToOutputDirectory>Always</CopyToOutputDirectory>\n+\t  </None>\n+\t</ItemGroup>\n+\n </Project>"
            },
            {
                "sha": "ac62b13709c1f4795e5d56502e763b983c46ee07",
                "filename": "test/zips/absolute-path-traversal.zip",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/mihula/ProDotNetZip/blob/18486ad6d13742a07a6755ef6edf60d7458f1854/test%2Fzips%2Fabsolute-path-traversal.zip",
                "raw_url": "https://github.com/mihula/ProDotNetZip/raw/18486ad6d13742a07a6755ef6edf60d7458f1854/test%2Fzips%2Fabsolute-path-traversal.zip",
                "contents_url": "https://api.github.com/repos/mihula/ProDotNetZip/contents/test%2Fzips%2Fabsolute-path-traversal.zip?ref=18486ad6d13742a07a6755ef6edf60d7458f1854"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/ddca2953191c67a12b1f19d6bca41016c6ae7132",
        "url": "https://api.github.com/repos/python/cpython/commits/ddca2953191c67a12b1f19d6bca41016c6ae7132",
        "html_url": "https://github.com/python/cpython/commit/ddca2953191c67a12b1f19d6bca41016c6ae7132",
        "message": "[3.9] gh-103848: Adds checks to ensure that bracketed hosts found by urlsplit are of IPv6 or IPvFuture format (#103849) (#126976)\n\nCo-authored-by: Gregory P. Smith <greg@krypto.org>\r\n(cherry picked from commit 29f348e232e82938ba2165843c448c2b291504c5)\r\n\r\nCo-authored-by: JohnJamesUtley <81572567+JohnJamesUtley@users.noreply.github.com>",
        "files": [
            {
                "sha": "6f7d40c21253caa2a75e93cebf227858b54cf99a",
                "filename": "Lib/test/test_urlparse.py",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/python/cpython/blob/ddca2953191c67a12b1f19d6bca41016c6ae7132/Lib%2Ftest%2Ftest_urlparse.py",
                "raw_url": "https://github.com/python/cpython/raw/ddca2953191c67a12b1f19d6bca41016c6ae7132/Lib%2Ftest%2Ftest_urlparse.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_urlparse.py?ref=ddca2953191c67a12b1f19d6bca41016c6ae7132",
                "patch": "@@ -1135,6 +1135,32 @@ def test_issue14072(self):\n         self.assertEqual(p2.scheme, 'tel')\n         self.assertEqual(p2.path, '+31641044153')\n \n+    def test_invalid_bracketed_hosts(self):\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[192.0.2.146]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[important.com:8000]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v123r.IP]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v12ae]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v.IP]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v123.]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[0439:23af::2309::fae7:1234]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[0439:23af:2309::fae7:1234:2342:438e:192.0.2.146]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@]v6a.ip[/Path')\n+\n+    def test_splitting_bracketed_hosts(self):\n+        p1 = urllib.parse.urlsplit('scheme://user@[v6a.ip]/path?query')\n+        self.assertEqual(p1.hostname, 'v6a.ip')\n+        self.assertEqual(p1.username, 'user')\n+        self.assertEqual(p1.path, '/path')\n+        p2 = urllib.parse.urlsplit('scheme://user@[0439:23af:2309::fae7%test]/path?query')\n+        self.assertEqual(p2.hostname, '0439:23af:2309::fae7%test')\n+        self.assertEqual(p2.username, 'user')\n+        self.assertEqual(p2.path, '/path')\n+        p3 = urllib.parse.urlsplit('scheme://user@[0439:23af:2309::fae7:1234:192.0.2.146%test]/path?query')\n+        self.assertEqual(p3.hostname, '0439:23af:2309::fae7:1234:192.0.2.146%test')\n+        self.assertEqual(p3.username, 'user')\n+        self.assertEqual(p3.path, '/path')\n+\n     def test_port_casting_failure_message(self):\n         message = \"Port could not be cast to integer value as 'oracle'\"\n         p1 = urllib.parse.urlparse('http://Server=sde; Service=sde:oracle')"
            },
            {
                "sha": "9d37dcaa9049976a143b29315ff902b189024067",
                "filename": "Lib/urllib/parse.py",
                "status": "modified",
                "additions": 15,
                "deletions": 1,
                "changes": 16,
                "blob_url": "https://github.com/python/cpython/blob/ddca2953191c67a12b1f19d6bca41016c6ae7132/Lib%2Furllib%2Fparse.py",
                "raw_url": "https://github.com/python/cpython/raw/ddca2953191c67a12b1f19d6bca41016c6ae7132/Lib%2Furllib%2Fparse.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Furllib%2Fparse.py?ref=ddca2953191c67a12b1f19d6bca41016c6ae7132",
                "patch": "@@ -36,6 +36,7 @@\n import types\n import collections\n import warnings\n+import ipaddress\n \n __all__ = [\"urlparse\", \"urlunparse\", \"urljoin\", \"urldefrag\",\n            \"urlsplit\", \"urlunsplit\", \"urlencode\", \"parse_qs\",\n@@ -442,6 +443,17 @@ def _checknetloc(netloc):\n             raise ValueError(\"netloc '\" + netloc + \"' contains invalid \" +\n                              \"characters under NFKC normalization\")\n \n+# Valid bracketed hosts are defined in\n+# https://www.rfc-editor.org/rfc/rfc3986#page-49 and https://url.spec.whatwg.org/\n+def _check_bracketed_host(hostname):\n+    if hostname.startswith('v'):\n+        if not re.match(r\"\\Av[a-fA-F0-9]+\\..+\\Z\", hostname):\n+            raise ValueError(f\"IPvFuture address is invalid\")\n+    else:\n+        ip = ipaddress.ip_address(hostname) # Throws Value Error if not IPv6 or IPv4\n+        if isinstance(ip, ipaddress.IPv4Address):\n+            raise ValueError(f\"An IPv4 address cannot be in brackets\")\n+\n def urlsplit(url, scheme='', allow_fragments=True):\n     \"\"\"Parse a URL into 5 components:\n     <scheme>://<netloc>/<path>?<query>#<fragment>\n@@ -488,12 +500,14 @@ def urlsplit(url, scheme='', allow_fragments=True):\n                 break\n         else:\n             scheme, url = url[:i].lower(), url[i+1:]\n-\n     if url[:2] == '//':\n         netloc, url = _splitnetloc(url, 2)\n         if (('[' in netloc and ']' not in netloc) or\n                 (']' in netloc and '[' not in netloc)):\n             raise ValueError(\"Invalid IPv6 URL\")\n+        if '[' in netloc and ']' in netloc:\n+            bracketed_host = netloc.partition('[')[2].partition(']')[0]\n+            _check_bracketed_host(bracketed_host)\n     if allow_fragments and '#' in url:\n         url, fragment = url.split('#', 1)\n     if '?' in url:"
            },
            {
                "sha": "81e5904aa6cca22cb3355b74d9bea67f034f9fd6",
                "filename": "Misc/NEWS.d/next/Library/2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/ddca2953191c67a12b1f19d6bca41016c6ae7132/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "raw_url": "https://github.com/python/cpython/raw/ddca2953191c67a12b1f19d6bca41016c6ae7132/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst?ref=ddca2953191c67a12b1f19d6bca41016c6ae7132",
                "patch": "@@ -0,0 +1,2 @@\n+Add checks to ensure that ``[`` bracketed ``]`` hosts found by\n+:func:`urllib.parse.urlsplit` are of IPv6 or IPvFuture format."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/29f348e232e82938ba2165843c448c2b291504c5",
        "url": "https://api.github.com/repos/python/cpython/commits/29f348e232e82938ba2165843c448c2b291504c5",
        "html_url": "https://github.com/python/cpython/commit/29f348e232e82938ba2165843c448c2b291504c5",
        "message": "gh-103848: Adds checks to ensure that bracketed hosts found by urlsplit are of IPv6 or IPvFuture format (#103849)\n\n* Adds checks to ensure that bracketed hosts found by urlsplit are of IPv6 or IPvFuture format\r\n\r\n---------\r\n\r\nCo-authored-by: Gregory P. Smith <greg@krypto.org>",
        "files": [
            {
                "sha": "e324babdd5ed0b7f7f220df180d8f9f22ee43b22",
                "filename": "Lib/test/test_urlparse.py",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/python/cpython/blob/29f348e232e82938ba2165843c448c2b291504c5/Lib%2Ftest%2Ftest_urlparse.py",
                "raw_url": "https://github.com/python/cpython/raw/29f348e232e82938ba2165843c448c2b291504c5/Lib%2Ftest%2Ftest_urlparse.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_urlparse.py?ref=29f348e232e82938ba2165843c448c2b291504c5",
                "patch": "@@ -1042,6 +1042,32 @@ def test_issue14072(self):\n         self.assertEqual(p2.scheme, 'tel')\n         self.assertEqual(p2.path, '+31641044153')\n \n+    def test_invalid_bracketed_hosts(self):\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[192.0.2.146]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[important.com:8000]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v123r.IP]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v12ae]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v.IP]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v123.]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[0439:23af::2309::fae7:1234]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[0439:23af:2309::fae7:1234:2342:438e:192.0.2.146]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@]v6a.ip[/Path')\n+\n+    def test_splitting_bracketed_hosts(self):\n+        p1 = urllib.parse.urlsplit('scheme://user@[v6a.ip]/path?query')\n+        self.assertEqual(p1.hostname, 'v6a.ip')\n+        self.assertEqual(p1.username, 'user')\n+        self.assertEqual(p1.path, '/path')\n+        p2 = urllib.parse.urlsplit('scheme://user@[0439:23af:2309::fae7%test]/path?query')\n+        self.assertEqual(p2.hostname, '0439:23af:2309::fae7%test')\n+        self.assertEqual(p2.username, 'user')\n+        self.assertEqual(p2.path, '/path')\n+        p3 = urllib.parse.urlsplit('scheme://user@[0439:23af:2309::fae7:1234:192.0.2.146%test]/path?query')\n+        self.assertEqual(p3.hostname, '0439:23af:2309::fae7:1234:192.0.2.146%test')\n+        self.assertEqual(p3.username, 'user')\n+        self.assertEqual(p3.path, '/path')\n+\n     def test_port_casting_failure_message(self):\n         message = \"Port could not be cast to integer value as 'oracle'\"\n         p1 = urllib.parse.urlparse('http://Server=sde; Service=sde:oracle')"
            },
            {
                "sha": "da0073969bff0b50ff84a88257461a63c96b1fe9",
                "filename": "Lib/urllib/parse.py",
                "status": "modified",
                "additions": 15,
                "deletions": 1,
                "changes": 16,
                "blob_url": "https://github.com/python/cpython/blob/29f348e232e82938ba2165843c448c2b291504c5/Lib%2Furllib%2Fparse.py",
                "raw_url": "https://github.com/python/cpython/raw/29f348e232e82938ba2165843c448c2b291504c5/Lib%2Furllib%2Fparse.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Furllib%2Fparse.py?ref=29f348e232e82938ba2165843c448c2b291504c5",
                "patch": "@@ -33,6 +33,7 @@\n import re\n import types\n import warnings\n+import ipaddress\n \n __all__ = [\"urlparse\", \"urlunparse\", \"urljoin\", \"urldefrag\",\n            \"urlsplit\", \"urlunsplit\", \"urlencode\", \"parse_qs\",\n@@ -427,6 +428,17 @@ def _checknetloc(netloc):\n             raise ValueError(\"netloc '\" + netloc + \"' contains invalid \" +\n                              \"characters under NFKC normalization\")\n \n+# Valid bracketed hosts are defined in\n+# https://www.rfc-editor.org/rfc/rfc3986#page-49 and https://url.spec.whatwg.org/\n+def _check_bracketed_host(hostname):\n+    if hostname.startswith('v'):\n+        if not re.match(r\"\\Av[a-fA-F0-9]+\\..+\\Z\", hostname):\n+            raise ValueError(f\"IPvFuture address is invalid\")\n+    else:\n+        ip = ipaddress.ip_address(hostname) # Throws Value Error if not IPv6 or IPv4\n+        if isinstance(ip, ipaddress.IPv4Address):\n+            raise ValueError(f\"An IPv4 address cannot be in brackets\")\n+\n # typed=True avoids BytesWarnings being emitted during cache key\n # comparison since this API supports both bytes and str input.\n @functools.lru_cache(typed=True)\n@@ -466,12 +478,14 @@ def urlsplit(url, scheme='', allow_fragments=True):\n                 break\n         else:\n             scheme, url = url[:i].lower(), url[i+1:]\n-\n     if url[:2] == '//':\n         netloc, url = _splitnetloc(url, 2)\n         if (('[' in netloc and ']' not in netloc) or\n                 (']' in netloc and '[' not in netloc)):\n             raise ValueError(\"Invalid IPv6 URL\")\n+        if '[' in netloc and ']' in netloc:\n+            bracketed_host = netloc.partition('[')[2].partition(']')[0]\n+            _check_bracketed_host(bracketed_host)\n     if allow_fragments and '#' in url:\n         url, fragment = url.split('#', 1)\n     if '?' in url:"
            },
            {
                "sha": "81e5904aa6cca22cb3355b74d9bea67f034f9fd6",
                "filename": "Misc/NEWS.d/next/Library/2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/29f348e232e82938ba2165843c448c2b291504c5/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "raw_url": "https://github.com/python/cpython/raw/29f348e232e82938ba2165843c448c2b291504c5/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst?ref=29f348e232e82938ba2165843c448c2b291504c5",
                "patch": "@@ -0,0 +1,2 @@\n+Add checks to ensure that ``[`` bracketed ``]`` hosts found by\n+:func:`urllib.parse.urlsplit` are of IPv6 or IPvFuture format."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/b2171a2fd41416cf68afd67460578631d755a550",
        "url": "https://api.github.com/repos/python/cpython/commits/b2171a2fd41416cf68afd67460578631d755a550",
        "html_url": "https://github.com/python/cpython/commit/b2171a2fd41416cf68afd67460578631d755a550",
        "message": "[3.11] gh-103848: Adds checks to ensure that bracketed hosts found by urlsplit are of IPv6 or IPvFuture format (GH-103849) (#104349)\n\ngh-103848: Adds checks to ensure that bracketed hosts found by urlsplit are of IPv6 or IPvFuture format (GH-103849)\r\n\r\n* Adds checks to ensure that bracketed hosts found by urlsplit are of IPv6 or IPvFuture format\r\n\r\n---------\r\n\r\n(cherry picked from commit 29f348e232e82938ba2165843c448c2b291504c5)\r\n\r\nCo-authored-by: JohnJamesUtley <81572567+JohnJamesUtley@users.noreply.github.com>\r\nCo-authored-by: Gregory P. Smith <greg@krypto.org>",
        "files": [
            {
                "sha": "6b23ba604cceef0cca6abefaff2e55cc1558587e",
                "filename": "Lib/test/test_urlparse.py",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/python/cpython/blob/b2171a2fd41416cf68afd67460578631d755a550/Lib%2Ftest%2Ftest_urlparse.py",
                "raw_url": "https://github.com/python/cpython/raw/b2171a2fd41416cf68afd67460578631d755a550/Lib%2Ftest%2Ftest_urlparse.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_urlparse.py?ref=b2171a2fd41416cf68afd67460578631d755a550",
                "patch": "@@ -1033,6 +1033,32 @@ def test_issue14072(self):\n         self.assertEqual(p2.scheme, 'tel')\n         self.assertEqual(p2.path, '+31641044153')\n \n+    def test_invalid_bracketed_hosts(self):\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[192.0.2.146]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[important.com:8000]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v123r.IP]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v12ae]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v.IP]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v123.]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[0439:23af::2309::fae7:1234]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[0439:23af:2309::fae7:1234:2342:438e:192.0.2.146]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@]v6a.ip[/Path')\n+\n+    def test_splitting_bracketed_hosts(self):\n+        p1 = urllib.parse.urlsplit('scheme://user@[v6a.ip]/path?query')\n+        self.assertEqual(p1.hostname, 'v6a.ip')\n+        self.assertEqual(p1.username, 'user')\n+        self.assertEqual(p1.path, '/path')\n+        p2 = urllib.parse.urlsplit('scheme://user@[0439:23af:2309::fae7%test]/path?query')\n+        self.assertEqual(p2.hostname, '0439:23af:2309::fae7%test')\n+        self.assertEqual(p2.username, 'user')\n+        self.assertEqual(p2.path, '/path')\n+        p3 = urllib.parse.urlsplit('scheme://user@[0439:23af:2309::fae7:1234:192.0.2.146%test]/path?query')\n+        self.assertEqual(p3.hostname, '0439:23af:2309::fae7:1234:192.0.2.146%test')\n+        self.assertEqual(p3.username, 'user')\n+        self.assertEqual(p3.path, '/path')\n+\n     def test_port_casting_failure_message(self):\n         message = \"Port could not be cast to integer value as 'oracle'\"\n         p1 = urllib.parse.urlparse('http://Server=sde; Service=sde:oracle')"
            },
            {
                "sha": "2af4700a703ee085ae034550522c9a90b23710ea",
                "filename": "Lib/urllib/parse.py",
                "status": "modified",
                "additions": 15,
                "deletions": 1,
                "changes": 16,
                "blob_url": "https://github.com/python/cpython/blob/b2171a2fd41416cf68afd67460578631d755a550/Lib%2Furllib%2Fparse.py",
                "raw_url": "https://github.com/python/cpython/raw/b2171a2fd41416cf68afd67460578631d755a550/Lib%2Furllib%2Fparse.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Furllib%2Fparse.py?ref=b2171a2fd41416cf68afd67460578631d755a550",
                "patch": "@@ -33,6 +33,7 @@\n import sys\n import types\n import warnings\n+import ipaddress\n \n __all__ = [\"urlparse\", \"urlunparse\", \"urljoin\", \"urldefrag\",\n            \"urlsplit\", \"urlunsplit\", \"urlencode\", \"parse_qs\",\n@@ -427,6 +428,17 @@ def _checknetloc(netloc):\n             raise ValueError(\"netloc '\" + netloc + \"' contains invalid \" +\n                              \"characters under NFKC normalization\")\n \n+# Valid bracketed hosts are defined in\n+# https://www.rfc-editor.org/rfc/rfc3986#page-49 and https://url.spec.whatwg.org/\n+def _check_bracketed_host(hostname):\n+    if hostname.startswith('v'):\n+        if not re.match(r\"\\Av[a-fA-F0-9]+\\..+\\Z\", hostname):\n+            raise ValueError(f\"IPvFuture address is invalid\")\n+    else:\n+        ip = ipaddress.ip_address(hostname) # Throws Value Error if not IPv6 or IPv4\n+        if isinstance(ip, ipaddress.IPv4Address):\n+            raise ValueError(f\"An IPv4 address cannot be in brackets\")\n+\n # typed=True avoids BytesWarnings being emitted during cache key\n # comparison since this API supports both bytes and str input.\n @functools.lru_cache(typed=True)\n@@ -466,12 +478,14 @@ def urlsplit(url, scheme='', allow_fragments=True):\n                 break\n         else:\n             scheme, url = url[:i].lower(), url[i+1:]\n-\n     if url[:2] == '//':\n         netloc, url = _splitnetloc(url, 2)\n         if (('[' in netloc and ']' not in netloc) or\n                 (']' in netloc and '[' not in netloc)):\n             raise ValueError(\"Invalid IPv6 URL\")\n+        if '[' in netloc and ']' in netloc:\n+            bracketed_host = netloc.partition('[')[2].partition(']')[0]\n+            _check_bracketed_host(bracketed_host)\n     if allow_fragments and '#' in url:\n         url, fragment = url.split('#', 1)\n     if '?' in url:"
            },
            {
                "sha": "81e5904aa6cca22cb3355b74d9bea67f034f9fd6",
                "filename": "Misc/NEWS.d/next/Library/2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/b2171a2fd41416cf68afd67460578631d755a550/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "raw_url": "https://github.com/python/cpython/raw/b2171a2fd41416cf68afd67460578631d755a550/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst?ref=b2171a2fd41416cf68afd67460578631d755a550",
                "patch": "@@ -0,0 +1,2 @@\n+Add checks to ensure that ``[`` bracketed ``]`` hosts found by\n+:func:`urllib.parse.urlsplit` are of IPv6 or IPvFuture format."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/python/cpython/commits/634ded45545ce8cbd6fd5d49785613dd7fa9b89e",
        "url": "https://api.github.com/repos/python/cpython/commits/634ded45545ce8cbd6fd5d49785613dd7fa9b89e",
        "html_url": "https://github.com/python/cpython/commit/634ded45545ce8cbd6fd5d49785613dd7fa9b89e",
        "message": "[3.10] gh-103848: Adds checks to ensure that bracketed hosts found by urlsplit are of IPv6 or IPvFuture format (#103849) (#126975)\n\nCo-authored-by: Gregory P. Smith <greg@krypto.org>\r\n(cherry picked from commit 29f348e232e82938ba2165843c448c2b291504c5)\r\n\r\nCo-authored-by: JohnJamesUtley <81572567+JohnJamesUtley@users.noreply.github.com>",
        "files": [
            {
                "sha": "f2ffc452e566c00fcfb1b76123928c274b0f792f",
                "filename": "Lib/test/test_urlparse.py",
                "status": "modified",
                "additions": 26,
                "deletions": 0,
                "changes": 26,
                "blob_url": "https://github.com/python/cpython/blob/634ded45545ce8cbd6fd5d49785613dd7fa9b89e/Lib%2Ftest%2Ftest_urlparse.py",
                "raw_url": "https://github.com/python/cpython/raw/634ded45545ce8cbd6fd5d49785613dd7fa9b89e/Lib%2Ftest%2Ftest_urlparse.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Ftest%2Ftest_urlparse.py?ref=634ded45545ce8cbd6fd5d49785613dd7fa9b89e",
                "patch": "@@ -1138,6 +1138,32 @@ def test_issue14072(self):\n         self.assertEqual(p2.scheme, 'tel')\n         self.assertEqual(p2.path, '+31641044153')\n \n+    def test_invalid_bracketed_hosts(self):\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[192.0.2.146]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[important.com:8000]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v123r.IP]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v12ae]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v.IP]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v123.]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[v]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[0439:23af::2309::fae7:1234]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@[0439:23af:2309::fae7:1234:2342:438e:192.0.2.146]/Path?Query')\n+        self.assertRaises(ValueError, urllib.parse.urlsplit, 'Scheme://user@]v6a.ip[/Path')\n+\n+    def test_splitting_bracketed_hosts(self):\n+        p1 = urllib.parse.urlsplit('scheme://user@[v6a.ip]/path?query')\n+        self.assertEqual(p1.hostname, 'v6a.ip')\n+        self.assertEqual(p1.username, 'user')\n+        self.assertEqual(p1.path, '/path')\n+        p2 = urllib.parse.urlsplit('scheme://user@[0439:23af:2309::fae7%test]/path?query')\n+        self.assertEqual(p2.hostname, '0439:23af:2309::fae7%test')\n+        self.assertEqual(p2.username, 'user')\n+        self.assertEqual(p2.path, '/path')\n+        p3 = urllib.parse.urlsplit('scheme://user@[0439:23af:2309::fae7:1234:192.0.2.146%test]/path?query')\n+        self.assertEqual(p3.hostname, '0439:23af:2309::fae7:1234:192.0.2.146%test')\n+        self.assertEqual(p3.username, 'user')\n+        self.assertEqual(p3.path, '/path')\n+\n     def test_port_casting_failure_message(self):\n         message = \"Port could not be cast to integer value as 'oracle'\"\n         p1 = urllib.parse.urlparse('http://Server=sde; Service=sde:oracle')"
            },
            {
                "sha": "07e3248504b988c3aa94156087b830a8892fc351",
                "filename": "Lib/urllib/parse.py",
                "status": "modified",
                "additions": 15,
                "deletions": 1,
                "changes": 16,
                "blob_url": "https://github.com/python/cpython/blob/634ded45545ce8cbd6fd5d49785613dd7fa9b89e/Lib%2Furllib%2Fparse.py",
                "raw_url": "https://github.com/python/cpython/raw/634ded45545ce8cbd6fd5d49785613dd7fa9b89e/Lib%2Furllib%2Fparse.py",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Lib%2Furllib%2Fparse.py?ref=634ded45545ce8cbd6fd5d49785613dd7fa9b89e",
                "patch": "@@ -36,6 +36,7 @@\n import types\n import collections\n import warnings\n+import ipaddress\n \n __all__ = [\"urlparse\", \"urlunparse\", \"urljoin\", \"urldefrag\",\n            \"urlsplit\", \"urlunsplit\", \"urlencode\", \"parse_qs\",\n@@ -441,6 +442,17 @@ def _checknetloc(netloc):\n             raise ValueError(\"netloc '\" + netloc + \"' contains invalid \" +\n                              \"characters under NFKC normalization\")\n \n+# Valid bracketed hosts are defined in\n+# https://www.rfc-editor.org/rfc/rfc3986#page-49 and https://url.spec.whatwg.org/\n+def _check_bracketed_host(hostname):\n+    if hostname.startswith('v'):\n+        if not re.match(r\"\\Av[a-fA-F0-9]+\\..+\\Z\", hostname):\n+            raise ValueError(f\"IPvFuture address is invalid\")\n+    else:\n+        ip = ipaddress.ip_address(hostname) # Throws Value Error if not IPv6 or IPv4\n+        if isinstance(ip, ipaddress.IPv4Address):\n+            raise ValueError(f\"An IPv4 address cannot be in brackets\")\n+\n def urlsplit(url, scheme='', allow_fragments=True):\n     \"\"\"Parse a URL into 5 components:\n     <scheme>://<netloc>/<path>?<query>#<fragment>\n@@ -487,12 +499,14 @@ def urlsplit(url, scheme='', allow_fragments=True):\n                 break\n         else:\n             scheme, url = url[:i].lower(), url[i+1:]\n-\n     if url[:2] == '//':\n         netloc, url = _splitnetloc(url, 2)\n         if (('[' in netloc and ']' not in netloc) or\n                 (']' in netloc and '[' not in netloc)):\n             raise ValueError(\"Invalid IPv6 URL\")\n+        if '[' in netloc and ']' in netloc:\n+            bracketed_host = netloc.partition('[')[2].partition(']')[0]\n+            _check_bracketed_host(bracketed_host)\n     if allow_fragments and '#' in url:\n         url, fragment = url.split('#', 1)\n     if '?' in url:"
            },
            {
                "sha": "81e5904aa6cca22cb3355b74d9bea67f034f9fd6",
                "filename": "Misc/NEWS.d/next/Library/2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/python/cpython/blob/634ded45545ce8cbd6fd5d49785613dd7fa9b89e/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "raw_url": "https://github.com/python/cpython/raw/634ded45545ce8cbd6fd5d49785613dd7fa9b89e/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst",
                "contents_url": "https://api.github.com/repos/python/cpython/contents/Misc%2FNEWS.d%2Fnext%2FLibrary%2F2023-04-26-09-54-25.gh-issue-103848.aDSnpR.rst?ref=634ded45545ce8cbd6fd5d49785613dd7fa9b89e",
                "patch": "@@ -0,0 +1,2 @@\n+Add checks to ensure that ``[`` bracketed ``]`` hosts found by\n+:func:`urllib.parse.urlsplit` are of IPv6 or IPvFuture format."
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Icinga/icinga2/commits/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8",
        "url": "https://api.github.com/repos/Icinga/icinga2/commits/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8",
        "html_url": "https://github.com/Icinga/icinga2/commit/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8",
        "message": "Security: fix TLS certificate validation bypass\n\nThe previous validation in set_verify_callback() could be bypassed, tricking\nIcinga 2 into treating invalid certificates as valid. To fix this, the\nvalidation checks were moved into the IsVerifyOK() function.\n\nThis is tracked as CVE-2024-49369, more details will be published at a later time.",
        "files": [
            {
                "sha": "a71451a53691f6c2999213a901bf5646349d6ec1",
                "filename": "lib/base/tlsstream.cpp",
                "status": "modified",
                "additions": 48,
                "deletions": 14,
                "changes": 62,
                "blob_url": "https://github.com/Icinga/icinga2/blob/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8/lib%2Fbase%2Ftlsstream.cpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8/lib%2Fbase%2Ftlsstream.cpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.cpp?ref=2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8",
                "patch": "@@ -18,14 +18,48 @@\n \n using namespace icinga;\n \n-bool UnbufferedAsioTlsStream::IsVerifyOK() const\n+/**\n+ * Checks whether the TLS handshake was completed with a valid peer certificate.\n+ *\n+ * @return true if the peer presented a valid certificate, false otherwise\n+ */\n+bool UnbufferedAsioTlsStream::IsVerifyOK()\n {\n-\treturn m_VerifyOK;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\t// handshake was not completed\n+\t\treturn false;\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\t// no peer certificate was sent\n+\t\treturn false;\n+\t}\n+\n+\treturn SSL_get_verify_result(native_handle()) == X509_V_OK;\n }\n \n-String UnbufferedAsioTlsStream::GetVerifyError() const\n+/**\n+ * Returns a human-readable error string for situations where IsVerifyOK() returns false.\n+ *\n+ * If the handshake was completed and a peer certificate was provided,\n+ * the string additionally contains the OpenSSL verification error code.\n+ *\n+ * @return string containing the error message\n+ */\n+String UnbufferedAsioTlsStream::GetVerifyError()\n {\n-\treturn m_VerifyError;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\treturn \"handshake not completed\";\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\treturn \"no peer certificate provided\";\n+\t}\n+\n+\tstd::ostringstream buf;\n+\tlong err = SSL_get_verify_result(native_handle());\n+\tbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n+\treturn buf.str();\n }\n \n std::shared_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate()\n@@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake_type type)\n \n \tset_verify_mode(ssl::verify_peer | ssl::verify_client_once);\n \n-\tset_verify_callback([this](bool preverified, ssl::verify_context& ctx) {\n-\t\tif (!preverified) {\n-\t\t\tm_VerifyOK = false;\n-\n-\t\t\tstd::ostringstream msgbuf;\n-\t\t\tint err = X509_STORE_CTX_get_error(ctx.native_handle());\n-\n-\t\t\tmsgbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n-\t\t\tm_VerifyError = msgbuf.str();\n-\t\t}\n+\tset_verify_callback([](bool preverified, ssl::verify_context& ctx) {\n+\t\t(void) preverified;\n+\t\t(void) ctx;\n \n+\t\t/* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be\n+\t\t * checked using the IsVerifyOK() method.\n+\t\t *\n+\t\t * Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to\n+\t\t * send a certificate request and receive their valid certificate after approval (manually by the administrator\n+\t\t * or using a certificate ticket).\n+\t\t */\n \t\treturn true;\n \t});\n "
            },
            {
                "sha": "9a6340bafcfadd7e7e45f22fda84b9066c25adcc",
                "filename": "lib/base/tlsstream.hpp",
                "status": "modified",
                "additions": 3,
                "deletions": 5,
                "changes": 8,
                "blob_url": "https://github.com/Icinga/icinga2/blob/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8/lib%2Fbase%2Ftlsstream.hpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8/lib%2Fbase%2Ftlsstream.hpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.hpp?ref=2febc5e18ae0c93d989e64ebc2a9fd90e7205ad8",
                "patch": "@@ -70,12 +70,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n public:\n \tinline\n \tUnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init)\n-\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_VerifyOK(true), m_Hostname(init.Hostname)\n+\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_Hostname(init.Hostname)\n \t{\n \t}\n \n-\tbool IsVerifyOK() const;\n-\tString GetVerifyError() const;\n+\tbool IsVerifyOK();\n+\tString GetVerifyError();\n \tstd::shared_ptr<X509> GetPeerCertificate();\n \n \ttemplate<class... Args>\n@@ -97,8 +97,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n \t}\n \n private:\n-\tbool m_VerifyOK;\n-\tString m_VerifyError;\n \tString m_Hostname;\n \n \tvoid BeforeHandshake(handshake_type type);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Icinga/icinga2/commits/0419a2c36de408e9a703aec0962061ec9a285d3c",
        "url": "https://api.github.com/repos/Icinga/icinga2/commits/0419a2c36de408e9a703aec0962061ec9a285d3c",
        "html_url": "https://github.com/Icinga/icinga2/commit/0419a2c36de408e9a703aec0962061ec9a285d3c",
        "message": "Security: fix TLS certificate validation bypass\n\nThe previous validation in set_verify_callback() could be bypassed, tricking\nIcinga 2 into treating invalid certificates as valid. To fix this, the\nvalidation checks were moved into the IsVerifyOK() function.\n\nThis is tracked as CVE-2024-49369, more details will be published at a later time.",
        "files": [
            {
                "sha": "a71451a53691f6c2999213a901bf5646349d6ec1",
                "filename": "lib/base/tlsstream.cpp",
                "status": "modified",
                "additions": 48,
                "deletions": 14,
                "changes": 62,
                "blob_url": "https://github.com/Icinga/icinga2/blob/0419a2c36de408e9a703aec0962061ec9a285d3c/lib%2Fbase%2Ftlsstream.cpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/0419a2c36de408e9a703aec0962061ec9a285d3c/lib%2Fbase%2Ftlsstream.cpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.cpp?ref=0419a2c36de408e9a703aec0962061ec9a285d3c",
                "patch": "@@ -18,14 +18,48 @@\n \n using namespace icinga;\n \n-bool UnbufferedAsioTlsStream::IsVerifyOK() const\n+/**\n+ * Checks whether the TLS handshake was completed with a valid peer certificate.\n+ *\n+ * @return true if the peer presented a valid certificate, false otherwise\n+ */\n+bool UnbufferedAsioTlsStream::IsVerifyOK()\n {\n-\treturn m_VerifyOK;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\t// handshake was not completed\n+\t\treturn false;\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\t// no peer certificate was sent\n+\t\treturn false;\n+\t}\n+\n+\treturn SSL_get_verify_result(native_handle()) == X509_V_OK;\n }\n \n-String UnbufferedAsioTlsStream::GetVerifyError() const\n+/**\n+ * Returns a human-readable error string for situations where IsVerifyOK() returns false.\n+ *\n+ * If the handshake was completed and a peer certificate was provided,\n+ * the string additionally contains the OpenSSL verification error code.\n+ *\n+ * @return string containing the error message\n+ */\n+String UnbufferedAsioTlsStream::GetVerifyError()\n {\n-\treturn m_VerifyError;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\treturn \"handshake not completed\";\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\treturn \"no peer certificate provided\";\n+\t}\n+\n+\tstd::ostringstream buf;\n+\tlong err = SSL_get_verify_result(native_handle());\n+\tbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n+\treturn buf.str();\n }\n \n std::shared_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate()\n@@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake_type type)\n \n \tset_verify_mode(ssl::verify_peer | ssl::verify_client_once);\n \n-\tset_verify_callback([this](bool preverified, ssl::verify_context& ctx) {\n-\t\tif (!preverified) {\n-\t\t\tm_VerifyOK = false;\n-\n-\t\t\tstd::ostringstream msgbuf;\n-\t\t\tint err = X509_STORE_CTX_get_error(ctx.native_handle());\n-\n-\t\t\tmsgbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n-\t\t\tm_VerifyError = msgbuf.str();\n-\t\t}\n+\tset_verify_callback([](bool preverified, ssl::verify_context& ctx) {\n+\t\t(void) preverified;\n+\t\t(void) ctx;\n \n+\t\t/* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be\n+\t\t * checked using the IsVerifyOK() method.\n+\t\t *\n+\t\t * Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to\n+\t\t * send a certificate request and receive their valid certificate after approval (manually by the administrator\n+\t\t * or using a certificate ticket).\n+\t\t */\n \t\treturn true;\n \t});\n "
            },
            {
                "sha": "9a6340bafcfadd7e7e45f22fda84b9066c25adcc",
                "filename": "lib/base/tlsstream.hpp",
                "status": "modified",
                "additions": 3,
                "deletions": 5,
                "changes": 8,
                "blob_url": "https://github.com/Icinga/icinga2/blob/0419a2c36de408e9a703aec0962061ec9a285d3c/lib%2Fbase%2Ftlsstream.hpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/0419a2c36de408e9a703aec0962061ec9a285d3c/lib%2Fbase%2Ftlsstream.hpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.hpp?ref=0419a2c36de408e9a703aec0962061ec9a285d3c",
                "patch": "@@ -70,12 +70,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n public:\n \tinline\n \tUnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init)\n-\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_VerifyOK(true), m_Hostname(init.Hostname)\n+\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_Hostname(init.Hostname)\n \t{\n \t}\n \n-\tbool IsVerifyOK() const;\n-\tString GetVerifyError() const;\n+\tbool IsVerifyOK();\n+\tString GetVerifyError();\n \tstd::shared_ptr<X509> GetPeerCertificate();\n \n \ttemplate<class... Args>\n@@ -97,8 +97,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n \t}\n \n private:\n-\tbool m_VerifyOK;\n-\tString m_VerifyError;\n \tString m_Hostname;\n \n \tvoid BeforeHandshake(handshake_type type);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Icinga/icinga2/commits/869a7d6f0fe38c748e67bacc1fbdd42c933030f6",
        "url": "https://api.github.com/repos/Icinga/icinga2/commits/869a7d6f0fe38c748e67bacc1fbdd42c933030f6",
        "html_url": "https://github.com/Icinga/icinga2/commit/869a7d6f0fe38c748e67bacc1fbdd42c933030f6",
        "message": "Security: fix TLS certificate validation bypass\n\nThe previous validation in set_verify_callback() could be bypassed, tricking\nIcinga 2 into treating invalid certificates as valid. To fix this, the\nvalidation checks were moved into the IsVerifyOK() function.\n\nThis is tracked as CVE-2024-49369, more details will be published at a later time.",
        "files": [
            {
                "sha": "a71451a53691f6c2999213a901bf5646349d6ec1",
                "filename": "lib/base/tlsstream.cpp",
                "status": "modified",
                "additions": 48,
                "deletions": 14,
                "changes": 62,
                "blob_url": "https://github.com/Icinga/icinga2/blob/869a7d6f0fe38c748e67bacc1fbdd42c933030f6/lib%2Fbase%2Ftlsstream.cpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/869a7d6f0fe38c748e67bacc1fbdd42c933030f6/lib%2Fbase%2Ftlsstream.cpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.cpp?ref=869a7d6f0fe38c748e67bacc1fbdd42c933030f6",
                "patch": "@@ -18,14 +18,48 @@\n \n using namespace icinga;\n \n-bool UnbufferedAsioTlsStream::IsVerifyOK() const\n+/**\n+ * Checks whether the TLS handshake was completed with a valid peer certificate.\n+ *\n+ * @return true if the peer presented a valid certificate, false otherwise\n+ */\n+bool UnbufferedAsioTlsStream::IsVerifyOK()\n {\n-\treturn m_VerifyOK;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\t// handshake was not completed\n+\t\treturn false;\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\t// no peer certificate was sent\n+\t\treturn false;\n+\t}\n+\n+\treturn SSL_get_verify_result(native_handle()) == X509_V_OK;\n }\n \n-String UnbufferedAsioTlsStream::GetVerifyError() const\n+/**\n+ * Returns a human-readable error string for situations where IsVerifyOK() returns false.\n+ *\n+ * If the handshake was completed and a peer certificate was provided,\n+ * the string additionally contains the OpenSSL verification error code.\n+ *\n+ * @return string containing the error message\n+ */\n+String UnbufferedAsioTlsStream::GetVerifyError()\n {\n-\treturn m_VerifyError;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\treturn \"handshake not completed\";\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\treturn \"no peer certificate provided\";\n+\t}\n+\n+\tstd::ostringstream buf;\n+\tlong err = SSL_get_verify_result(native_handle());\n+\tbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n+\treturn buf.str();\n }\n \n std::shared_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate()\n@@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake_type type)\n \n \tset_verify_mode(ssl::verify_peer | ssl::verify_client_once);\n \n-\tset_verify_callback([this](bool preverified, ssl::verify_context& ctx) {\n-\t\tif (!preverified) {\n-\t\t\tm_VerifyOK = false;\n-\n-\t\t\tstd::ostringstream msgbuf;\n-\t\t\tint err = X509_STORE_CTX_get_error(ctx.native_handle());\n-\n-\t\t\tmsgbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n-\t\t\tm_VerifyError = msgbuf.str();\n-\t\t}\n+\tset_verify_callback([](bool preverified, ssl::verify_context& ctx) {\n+\t\t(void) preverified;\n+\t\t(void) ctx;\n \n+\t\t/* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be\n+\t\t * checked using the IsVerifyOK() method.\n+\t\t *\n+\t\t * Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to\n+\t\t * send a certificate request and receive their valid certificate after approval (manually by the administrator\n+\t\t * or using a certificate ticket).\n+\t\t */\n \t\treturn true;\n \t});\n "
            },
            {
                "sha": "9a6340bafcfadd7e7e45f22fda84b9066c25adcc",
                "filename": "lib/base/tlsstream.hpp",
                "status": "modified",
                "additions": 3,
                "deletions": 5,
                "changes": 8,
                "blob_url": "https://github.com/Icinga/icinga2/blob/869a7d6f0fe38c748e67bacc1fbdd42c933030f6/lib%2Fbase%2Ftlsstream.hpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/869a7d6f0fe38c748e67bacc1fbdd42c933030f6/lib%2Fbase%2Ftlsstream.hpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.hpp?ref=869a7d6f0fe38c748e67bacc1fbdd42c933030f6",
                "patch": "@@ -70,12 +70,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n public:\n \tinline\n \tUnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init)\n-\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_VerifyOK(true), m_Hostname(init.Hostname)\n+\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_Hostname(init.Hostname)\n \t{\n \t}\n \n-\tbool IsVerifyOK() const;\n-\tString GetVerifyError() const;\n+\tbool IsVerifyOK();\n+\tString GetVerifyError();\n \tstd::shared_ptr<X509> GetPeerCertificate();\n \n \ttemplate<class... Args>\n@@ -97,8 +97,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n \t}\n \n private:\n-\tbool m_VerifyOK;\n-\tString m_VerifyError;\n \tString m_Hostname;\n \n \tvoid BeforeHandshake(handshake_type type);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Icinga/icinga2/commits/8fed6608912c752b337d977f730547875a820831",
        "url": "https://api.github.com/repos/Icinga/icinga2/commits/8fed6608912c752b337d977f730547875a820831",
        "html_url": "https://github.com/Icinga/icinga2/commit/8fed6608912c752b337d977f730547875a820831",
        "message": "Security: fix TLS certificate validation bypass\n\nThe previous validation in set_verify_callback() could be bypassed, tricking\nIcinga 2 into treating invalid certificates as valid. To fix this, the\nvalidation checks were moved into the IsVerifyOK() function.\n\nThis is tracked as CVE-2024-49369, more details will be published at a later time.",
        "files": [
            {
                "sha": "a71451a53691f6c2999213a901bf5646349d6ec1",
                "filename": "lib/base/tlsstream.cpp",
                "status": "modified",
                "additions": 48,
                "deletions": 14,
                "changes": 62,
                "blob_url": "https://github.com/Icinga/icinga2/blob/8fed6608912c752b337d977f730547875a820831/lib%2Fbase%2Ftlsstream.cpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/8fed6608912c752b337d977f730547875a820831/lib%2Fbase%2Ftlsstream.cpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.cpp?ref=8fed6608912c752b337d977f730547875a820831",
                "patch": "@@ -18,14 +18,48 @@\n \n using namespace icinga;\n \n-bool UnbufferedAsioTlsStream::IsVerifyOK() const\n+/**\n+ * Checks whether the TLS handshake was completed with a valid peer certificate.\n+ *\n+ * @return true if the peer presented a valid certificate, false otherwise\n+ */\n+bool UnbufferedAsioTlsStream::IsVerifyOK()\n {\n-\treturn m_VerifyOK;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\t// handshake was not completed\n+\t\treturn false;\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\t// no peer certificate was sent\n+\t\treturn false;\n+\t}\n+\n+\treturn SSL_get_verify_result(native_handle()) == X509_V_OK;\n }\n \n-String UnbufferedAsioTlsStream::GetVerifyError() const\n+/**\n+ * Returns a human-readable error string for situations where IsVerifyOK() returns false.\n+ *\n+ * If the handshake was completed and a peer certificate was provided,\n+ * the string additionally contains the OpenSSL verification error code.\n+ *\n+ * @return string containing the error message\n+ */\n+String UnbufferedAsioTlsStream::GetVerifyError()\n {\n-\treturn m_VerifyError;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\treturn \"handshake not completed\";\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\treturn \"no peer certificate provided\";\n+\t}\n+\n+\tstd::ostringstream buf;\n+\tlong err = SSL_get_verify_result(native_handle());\n+\tbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n+\treturn buf.str();\n }\n \n std::shared_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate()\n@@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake_type type)\n \n \tset_verify_mode(ssl::verify_peer | ssl::verify_client_once);\n \n-\tset_verify_callback([this](bool preverified, ssl::verify_context& ctx) {\n-\t\tif (!preverified) {\n-\t\t\tm_VerifyOK = false;\n-\n-\t\t\tstd::ostringstream msgbuf;\n-\t\t\tint err = X509_STORE_CTX_get_error(ctx.native_handle());\n-\n-\t\t\tmsgbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n-\t\t\tm_VerifyError = msgbuf.str();\n-\t\t}\n+\tset_verify_callback([](bool preverified, ssl::verify_context& ctx) {\n+\t\t(void) preverified;\n+\t\t(void) ctx;\n \n+\t\t/* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be\n+\t\t * checked using the IsVerifyOK() method.\n+\t\t *\n+\t\t * Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to\n+\t\t * send a certificate request and receive their valid certificate after approval (manually by the administrator\n+\t\t * or using a certificate ticket).\n+\t\t */\n \t\treturn true;\n \t});\n "
            },
            {
                "sha": "3b1d121ffc3de3a269c61ee776b2261ad46d8f98",
                "filename": "lib/base/tlsstream.hpp",
                "status": "modified",
                "additions": 3,
                "deletions": 5,
                "changes": 8,
                "blob_url": "https://github.com/Icinga/icinga2/blob/8fed6608912c752b337d977f730547875a820831/lib%2Fbase%2Ftlsstream.hpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/8fed6608912c752b337d977f730547875a820831/lib%2Fbase%2Ftlsstream.hpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.hpp?ref=8fed6608912c752b337d977f730547875a820831",
                "patch": "@@ -69,12 +69,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n public:\n \tinline\n \tUnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init)\n-\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_VerifyOK(true), m_Hostname(init.Hostname)\n+\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_Hostname(init.Hostname)\n \t{\n \t}\n \n-\tbool IsVerifyOK() const;\n-\tString GetVerifyError() const;\n+\tbool IsVerifyOK();\n+\tString GetVerifyError();\n \tstd::shared_ptr<X509> GetPeerCertificate();\n \n \ttemplate<class... Args>\n@@ -96,8 +96,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n \t}\n \n private:\n-\tbool m_VerifyOK;\n-\tString m_VerifyError;\n \tString m_Hostname;\n \n \tvoid BeforeHandshake(handshake_type type);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Icinga/icinga2/commits/3504fc7ed688c10d86988e2029a65efc311393fe",
        "url": "https://api.github.com/repos/Icinga/icinga2/commits/3504fc7ed688c10d86988e2029a65efc311393fe",
        "html_url": "https://github.com/Icinga/icinga2/commit/3504fc7ed688c10d86988e2029a65efc311393fe",
        "message": "Security: fix TLS certificate validation bypass\n\nThe previous validation in set_verify_callback() could be bypassed, tricking\nIcinga 2 into treating invalid certificates as valid. To fix this, the\nvalidation checks were moved into the IsVerifyOK() function.\n\nThis is tracked as CVE-2024-49369, more details will be published at a later time.",
        "files": [
            {
                "sha": "a71451a53691f6c2999213a901bf5646349d6ec1",
                "filename": "lib/base/tlsstream.cpp",
                "status": "modified",
                "additions": 48,
                "deletions": 14,
                "changes": 62,
                "blob_url": "https://github.com/Icinga/icinga2/blob/3504fc7ed688c10d86988e2029a65efc311393fe/lib%2Fbase%2Ftlsstream.cpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/3504fc7ed688c10d86988e2029a65efc311393fe/lib%2Fbase%2Ftlsstream.cpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.cpp?ref=3504fc7ed688c10d86988e2029a65efc311393fe",
                "patch": "@@ -18,14 +18,48 @@\n \n using namespace icinga;\n \n-bool UnbufferedAsioTlsStream::IsVerifyOK() const\n+/**\n+ * Checks whether the TLS handshake was completed with a valid peer certificate.\n+ *\n+ * @return true if the peer presented a valid certificate, false otherwise\n+ */\n+bool UnbufferedAsioTlsStream::IsVerifyOK()\n {\n-\treturn m_VerifyOK;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\t// handshake was not completed\n+\t\treturn false;\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\t// no peer certificate was sent\n+\t\treturn false;\n+\t}\n+\n+\treturn SSL_get_verify_result(native_handle()) == X509_V_OK;\n }\n \n-String UnbufferedAsioTlsStream::GetVerifyError() const\n+/**\n+ * Returns a human-readable error string for situations where IsVerifyOK() returns false.\n+ *\n+ * If the handshake was completed and a peer certificate was provided,\n+ * the string additionally contains the OpenSSL verification error code.\n+ *\n+ * @return string containing the error message\n+ */\n+String UnbufferedAsioTlsStream::GetVerifyError()\n {\n-\treturn m_VerifyError;\n+\tif (!SSL_is_init_finished(native_handle())) {\n+\t\treturn \"handshake not completed\";\n+\t}\n+\n+\tif (GetPeerCertificate() == nullptr) {\n+\t\treturn \"no peer certificate provided\";\n+\t}\n+\n+\tstd::ostringstream buf;\n+\tlong err = SSL_get_verify_result(native_handle());\n+\tbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n+\treturn buf.str();\n }\n \n std::shared_ptr<X509> UnbufferedAsioTlsStream::GetPeerCertificate()\n@@ -43,17 +77,17 @@ void UnbufferedAsioTlsStream::BeforeHandshake(handshake_type type)\n \n \tset_verify_mode(ssl::verify_peer | ssl::verify_client_once);\n \n-\tset_verify_callback([this](bool preverified, ssl::verify_context& ctx) {\n-\t\tif (!preverified) {\n-\t\t\tm_VerifyOK = false;\n-\n-\t\t\tstd::ostringstream msgbuf;\n-\t\t\tint err = X509_STORE_CTX_get_error(ctx.native_handle());\n-\n-\t\t\tmsgbuf << \"code \" << err << \": \" << X509_verify_cert_error_string(err);\n-\t\t\tm_VerifyError = msgbuf.str();\n-\t\t}\n+\tset_verify_callback([](bool preverified, ssl::verify_context& ctx) {\n+\t\t(void) preverified;\n+\t\t(void) ctx;\n \n+\t\t/* Continue the handshake even if an invalid peer certificate was presented. The verification result has to be\n+\t\t * checked using the IsVerifyOK() method.\n+\t\t *\n+\t\t * Such connections are used for the initial enrollment of nodes where they use a self-signed certificate to\n+\t\t * send a certificate request and receive their valid certificate after approval (manually by the administrator\n+\t\t * or using a certificate ticket).\n+\t\t */\n \t\treturn true;\n \t});\n "
            },
            {
                "sha": "9a6340bafcfadd7e7e45f22fda84b9066c25adcc",
                "filename": "lib/base/tlsstream.hpp",
                "status": "modified",
                "additions": 3,
                "deletions": 5,
                "changes": 8,
                "blob_url": "https://github.com/Icinga/icinga2/blob/3504fc7ed688c10d86988e2029a65efc311393fe/lib%2Fbase%2Ftlsstream.hpp",
                "raw_url": "https://github.com/Icinga/icinga2/raw/3504fc7ed688c10d86988e2029a65efc311393fe/lib%2Fbase%2Ftlsstream.hpp",
                "contents_url": "https://api.github.com/repos/Icinga/icinga2/contents/lib%2Fbase%2Ftlsstream.hpp?ref=3504fc7ed688c10d86988e2029a65efc311393fe",
                "patch": "@@ -70,12 +70,12 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n public:\n \tinline\n \tUnbufferedAsioTlsStream(UnbufferedAsioTlsStreamParams& init)\n-\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_VerifyOK(true), m_Hostname(init.Hostname)\n+\t\t: AsioTcpTlsStream(init.IoContext, init.SslContext), m_Hostname(init.Hostname)\n \t{\n \t}\n \n-\tbool IsVerifyOK() const;\n-\tString GetVerifyError() const;\n+\tbool IsVerifyOK();\n+\tString GetVerifyError();\n \tstd::shared_ptr<X509> GetPeerCertificate();\n \n \ttemplate<class... Args>\n@@ -97,8 +97,6 @@ class UnbufferedAsioTlsStream : public AsioTcpTlsStream\n \t}\n \n private:\n-\tbool m_VerifyOK;\n-\tString m_VerifyError;\n \tString m_Hostname;\n \n \tvoid BeforeHandshake(handshake_type type);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/element-hq/element-web/commits/231073c578d5f92b33cde7aa2b0b9c5836b2dc48",
        "url": "https://api.github.com/repos/element-hq/element-web/commits/231073c578d5f92b33cde7aa2b0b9c5836b2dc48",
        "html_url": "https://github.com/element-hq/element-web/commit/231073c578d5f92b33cde7aa2b0b9c5836b2dc48",
        "message": "Merge commit from fork\n\nHandle rendering of invalid date errors",
        "files": [
            {
                "sha": "f36c02a16ac0cd7f52e192819cf66f07ff097325",
                "filename": "src/components/views/messages/DateSeparator.tsx",
                "status": "modified",
                "additions": 23,
                "deletions": 19,
                "changes": 42,
                "blob_url": "https://github.com/element-hq/element-web/blob/231073c578d5f92b33cde7aa2b0b9c5836b2dc48/src%2Fcomponents%2Fviews%2Fmessages%2FDateSeparator.tsx",
                "raw_url": "https://github.com/element-hq/element-web/raw/231073c578d5f92b33cde7aa2b0b9c5836b2dc48/src%2Fcomponents%2Fviews%2Fmessages%2FDateSeparator.tsx",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/src%2Fcomponents%2Fviews%2Fmessages%2FDateSeparator.tsx?ref=231073c578d5f92b33cde7aa2b0b9c5836b2dc48",
                "patch": "@@ -96,25 +96,29 @@ export default class DateSeparator extends React.Component<IProps, IState> {\n     }\n \n     private getLabel(): string {\n-        const date = new Date(this.props.ts);\n-        const disableRelativeTimestamps = !SettingsStore.getValue(UIFeature.TimelineEnableRelativeDates);\n-\n-        // During the time the archive is being viewed, a specific day might not make sense, so we return the full date\n-        if (this.props.forExport || disableRelativeTimestamps) return formatFullDateNoTime(date);\n-\n-        const today = new Date();\n-        const yesterday = new Date();\n-        const days = getDaysArray(\"long\");\n-        yesterday.setDate(today.getDate() - 1);\n-\n-        if (date.toDateString() === today.toDateString()) {\n-            return this.relativeTimeFormat.format(0, \"day\"); // Today\n-        } else if (date.toDateString() === yesterday.toDateString()) {\n-            return this.relativeTimeFormat.format(-1, \"day\"); // Yesterday\n-        } else if (today.getTime() - date.getTime() < 6 * 24 * 60 * 60 * 1000) {\n-            return days[date.getDay()]; // Sunday-Saturday\n-        } else {\n-            return formatFullDateNoTime(date);\n+        try {\n+            const date = new Date(this.props.ts);\n+            const disableRelativeTimestamps = !SettingsStore.getValue(UIFeature.TimelineEnableRelativeDates);\n+\n+            // During the time the archive is being viewed, a specific day might not make sense, so we return the full date\n+            if (this.props.forExport || disableRelativeTimestamps) return formatFullDateNoTime(date);\n+\n+            const today = new Date();\n+            const yesterday = new Date();\n+            const days = getDaysArray(\"long\");\n+            yesterday.setDate(today.getDate() - 1);\n+\n+            if (date.toDateString() === today.toDateString()) {\n+                return this.relativeTimeFormat.format(0, \"day\"); // Today\n+            } else if (date.toDateString() === yesterday.toDateString()) {\n+                return this.relativeTimeFormat.format(-1, \"day\"); // Yesterday\n+            } else if (today.getTime() - date.getTime() < 6 * 24 * 60 * 60 * 1000) {\n+                return days[date.getDay()]; // Sunday-Saturday\n+            } else {\n+                return formatFullDateNoTime(date);\n+            }\n+        } catch {\n+            return _t(\"common|message_timestamp_invalid\");\n         }\n     }\n "
            },
            {
                "sha": "2a62cc2ac6dedd7f2e227edf615a2ac3a5134d5d",
                "filename": "src/i18n/strings/en_EN.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/element-hq/element-web/blob/231073c578d5f92b33cde7aa2b0b9c5836b2dc48/src%2Fi18n%2Fstrings%2Fen_EN.json",
                "raw_url": "https://github.com/element-hq/element-web/raw/231073c578d5f92b33cde7aa2b0b9c5836b2dc48/src%2Fi18n%2Fstrings%2Fen_EN.json",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/src%2Fi18n%2Fstrings%2Fen_EN.json?ref=231073c578d5f92b33cde7aa2b0b9c5836b2dc48",
                "patch": "@@ -506,6 +506,7 @@\n         \"matrix\": \"Matrix\",\n         \"message\": \"Message\",\n         \"message_layout\": \"Message layout\",\n+        \"message_timestamp_invalid\": \"Invalid timestamp\",\n         \"microphone\": \"Microphone\",\n         \"model\": \"Model\",\n         \"modern\": \"Modern\","
            },
            {
                "sha": "ebe3ac42d448f56ec1a72b142d085d1aa5b1a308",
                "filename": "test/unit-tests/components/views/messages/DateSeparator-test.tsx",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/element-hq/element-web/blob/231073c578d5f92b33cde7aa2b0b9c5836b2dc48/test%2Funit-tests%2Fcomponents%2Fviews%2Fmessages%2FDateSeparator-test.tsx",
                "raw_url": "https://github.com/element-hq/element-web/raw/231073c578d5f92b33cde7aa2b0b9c5836b2dc48/test%2Funit-tests%2Fcomponents%2Fviews%2Fmessages%2FDateSeparator-test.tsx",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/test%2Funit-tests%2Fcomponents%2Fviews%2Fmessages%2FDateSeparator-test.tsx?ref=231073c578d5f92b33cde7aa2b0b9c5836b2dc48",
                "patch": "@@ -91,6 +91,12 @@ describe(\"DateSeparator\", () => {\n         expect(getComponent({ ts, forExport: false }).container.textContent).toEqual(result);\n     });\n \n+    it(\"renders invalid date separator correctly\", () => {\n+        const ts = new Date(-8640000000000004).getTime();\n+        const { asFragment } = getComponent({ ts });\n+        expect(asFragment()).toMatchSnapshot();\n+    });\n+\n     describe(\"when forExport is true\", () => {\n         it.each(testCases)(\"formats date in full when current time is %s\", (_d, ts) => {\n             expect(getComponent({ ts, forExport: true }).container.textContent).toEqual("
            },
            {
                "sha": "69de39e31dca638b5f04ae14c269cbdd0acd9ccd",
                "filename": "test/unit-tests/components/views/messages/__snapshots__/DateSeparator-test.tsx.snap",
                "status": "modified",
                "additions": 27,
                "deletions": 0,
                "changes": 27,
                "blob_url": "https://github.com/element-hq/element-web/blob/231073c578d5f92b33cde7aa2b0b9c5836b2dc48/test%2Funit-tests%2Fcomponents%2Fviews%2Fmessages%2F__snapshots__%2FDateSeparator-test.tsx.snap",
                "raw_url": "https://github.com/element-hq/element-web/raw/231073c578d5f92b33cde7aa2b0b9c5836b2dc48/test%2Funit-tests%2Fcomponents%2Fviews%2Fmessages%2F__snapshots__%2FDateSeparator-test.tsx.snap",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/test%2Funit-tests%2Fcomponents%2Fviews%2Fmessages%2F__snapshots__%2FDateSeparator-test.tsx.snap?ref=231073c578d5f92b33cde7aa2b0b9c5836b2dc48",
                "patch": "@@ -1,5 +1,32 @@\n // Jest Snapshot v1, https://goo.gl/fbAQLP\n \n+exports[`DateSeparator renders invalid date separator correctly 1`] = `\n+<DocumentFragment>\n+  <div\n+    aria-label=\"Invalid timestamp\"\n+    class=\"mx_TimelineSeparator\"\n+    role=\"separator\"\n+  >\n+    <hr\n+      role=\"none\"\n+    />\n+    <div\n+      class=\"mx_DateSeparator_dateContent\"\n+    >\n+      <h2\n+        aria-hidden=\"true\"\n+        class=\"mx_DateSeparator_dateHeading\"\n+      >\n+        Invalid timestamp\n+      </h2>\n+    </div>\n+    <hr\n+      role=\"none\"\n+    />\n+  </div>\n+</DocumentFragment>\n+`;\n+\n exports[`DateSeparator renders the date separator correctly 1`] = `\n <DocumentFragment>\n   <div"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/element-hq/element-web/commits/a00c343435d633e64de2c0548217aa611c7bbef5",
        "url": "https://api.github.com/repos/element-hq/element-web/commits/a00c343435d633e64de2c0548217aa611c7bbef5",
        "html_url": "https://github.com/element-hq/element-web/commit/a00c343435d633e64de2c0548217aa611c7bbef5",
        "message": "Merge commit from fork\n\nAdd mimetype checks to stickers, image and video messages",
        "files": [
            {
                "sha": "04f1a91e77cb005bee5c00a5003de715905b47a5",
                "filename": "jest.config.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/element-hq/element-web/blob/a00c343435d633e64de2c0548217aa611c7bbef5/jest.config.ts",
                "raw_url": "https://github.com/element-hq/element-web/raw/a00c343435d633e64de2c0548217aa611c7bbef5/jest.config.ts",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/jest.config.ts?ref=a00c343435d633e64de2c0548217aa611c7bbef5",
                "patch": "@@ -38,7 +38,7 @@ const config: Config = {\n         \"recorderWorkletFactory\": \"<rootDir>/__mocks__/empty.js\",\n         \"^fetch-mock$\": \"<rootDir>/node_modules/fetch-mock\",\n     },\n-    transformIgnorePatterns: [\"/node_modules/(?!matrix-js-sdk).+$\"],\n+    transformIgnorePatterns: [\"/node_modules/(?!(mime|matrix-js-sdk)).+$\"],\n     collectCoverageFrom: [\n         \"<rootDir>/src/**/*.{js,ts,tsx}\",\n         // getSessionLock is piped into a different JS context via stringification, and the coverage functionality is"
            },
            {
                "sha": "6c41ae4b0d33da7794234e4676cab9855c76d42e",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/element-hq/element-web/blob/a00c343435d633e64de2c0548217aa611c7bbef5/package.json",
                "raw_url": "https://github.com/element-hq/element-web/raw/a00c343435d633e64de2c0548217aa611c7bbef5/package.json",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/package.json?ref=a00c343435d633e64de2c0548217aa611c7bbef5",
                "patch": "@@ -129,6 +129,7 @@\n         \"matrix-js-sdk\": \"34.10.0\",\n         \"matrix-widget-api\": \"^1.9.0\",\n         \"memoize-one\": \"^6.0.0\",\n+        \"mime\": \"^4.0.4\",\n         \"oidc-client-ts\": \"^3.0.1\",\n         \"opus-recorder\": \"^8.0.3\",\n         \"pako\": \"^2.0.3\","
            },
            {
                "sha": "318f712961613041fe1a27f0015b96ed204c9f34",
                "filename": "playwright/e2e/widgets/stickers.spec.ts",
                "status": "modified",
                "additions": 101,
                "deletions": 60,
                "changes": 161,
                "blob_url": "https://github.com/element-hq/element-web/blob/a00c343435d633e64de2c0548217aa611c7bbef5/playwright%2Fe2e%2Fwidgets%2Fstickers.spec.ts",
                "raw_url": "https://github.com/element-hq/element-web/raw/a00c343435d633e64de2c0548217aa611c7bbef5/playwright%2Fe2e%2Fwidgets%2Fstickers.spec.ts",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/playwright%2Fe2e%2Fwidgets%2Fstickers.spec.ts?ref=a00c343435d633e64de2c0548217aa611c7bbef5",
                "patch": "@@ -6,32 +6,48 @@ SPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\n Please see LICENSE files in the repository root for full details.\n */\n \n+import * as fs from \"node:fs\";\n+\n import type { Page } from \"@playwright/test\";\n import { test, expect } from \"../../element-web-test\";\n import { ElementAppPage } from \"../../pages/ElementAppPage\";\n+import { Credentials } from \"../../plugins/homeserver\";\n \n const STICKER_PICKER_WIDGET_ID = \"fake-sticker-picker\";\n const STICKER_PICKER_WIDGET_NAME = \"Fake Stickers\";\n const STICKER_NAME = \"Test Sticker\";\n const ROOM_NAME_1 = \"Sticker Test\";\n const ROOM_NAME_2 = \"Sticker Test Two\";\n-const STICKER_MESSAGE = JSON.stringify({\n-    action: \"m.sticker\",\n-    api: \"fromWidget\",\n-    data: {\n-        name: \"teststicker\",\n-        description: STICKER_NAME,\n-        file: \"test.png\",\n-        content: {\n-            body: STICKER_NAME,\n-            msgtype: \"m.sticker\",\n-            url: \"mxc://localhost/somewhere\",\n+const STICKER_IMAGE = fs.readFileSync(\"playwright/sample-files/riot.png\");\n+\n+function getStickerMessage(contentUri: string, mimetype: string): string {\n+    return JSON.stringify({\n+        action: \"m.sticker\",\n+        api: \"fromWidget\",\n+        data: {\n+            name: \"teststicker\",\n+            description: STICKER_NAME,\n+            file: \"test.png\",\n+            content: {\n+                body: STICKER_NAME,\n+                info: {\n+                    h: 480,\n+                    mimetype: mimetype,\n+                    size: 13818,\n+                    w: 480,\n+                },\n+                msgtype: \"m.sticker\",\n+                url: contentUri,\n+            },\n         },\n-    },\n-    requestId: \"1\",\n-    widgetId: STICKER_PICKER_WIDGET_ID,\n-});\n-const WIDGET_HTML = `\n+        requestId: \"1\",\n+        widgetId: STICKER_PICKER_WIDGET_ID,\n+    });\n+}\n+\n+function getWidgetHtml(contentUri: string, mimetype: string) {\n+    const stickerMessage = getStickerMessage(contentUri, mimetype);\n+    return `\n     <html lang=\"en\">\n         <head>\n             <title>Fake Sticker Picker</title>\n@@ -51,13 +67,13 @@ const WIDGET_HTML = `\n             <button name=\"Send\" id=\"sendsticker\">Press for sticker</button>\n             <script>\n                 document.getElementById('sendsticker').onclick = () => {\n-                    window.parent.postMessage(${STICKER_MESSAGE}, '*')\n+                    window.parent.postMessage(${stickerMessage}, '*')\n                 };\n             </script>\n         </body>\n     </html>\n `;\n-\n+}\n async function openStickerPicker(app: ElementAppPage) {\n     const options = await app.openMessageComposerOptions();\n     await options.getByRole(\"menuitem\", { name: \"Sticker\" }).click();\n@@ -71,7 +87,8 @@ async function sendStickerFromPicker(page: Page) {\n     await expect(page.locator(\".mx_AppTileFullWidth#stickers\")).not.toBeVisible();\n }\n \n-async function expectTimelineSticker(page: Page, roomId: string) {\n+async function expectTimelineSticker(page: Page, roomId: string, contentUri: string) {\n+    const contentId = contentUri.split(\"/\").slice(-1)[0];\n     // Make sure it's in the right room\n     await expect(page.locator(\".mx_EventTile_sticker > a\")).toHaveAttribute(\"href\", new RegExp(`/${roomId}/`));\n \n@@ -80,13 +97,43 @@ async function expectTimelineSticker(page: Page, roomId: string) {\n     // download URL.\n     await expect(page.locator(`img[alt=\"${STICKER_NAME}\"]`)).toHaveAttribute(\n         \"src\",\n-        new RegExp(\"/download/localhost/somewhere\"),\n+        new RegExp(`/localhost/${contentId}`),\n     );\n }\n \n+async function expectFileTile(page: Page, roomId: string, contentUri: string) {\n+    await expect(page.locator(\".mx_MFileBody_info_filename\")).toContainText(STICKER_NAME);\n+}\n+\n+async function setWidgetAccountData(\n+    app: ElementAppPage,\n+    user: Credentials,\n+    stickerPickerUrl: string,\n+    provideCreatorUserId: boolean = true,\n+) {\n+    await app.client.setAccountData(\"m.widgets\", {\n+        [STICKER_PICKER_WIDGET_ID]: {\n+            content: {\n+                type: \"m.stickerpicker\",\n+                name: STICKER_PICKER_WIDGET_NAME,\n+                url: stickerPickerUrl,\n+                creatorUserId: provideCreatorUserId ? user.userId : undefined,\n+            },\n+            sender: user.userId,\n+            state_key: STICKER_PICKER_WIDGET_ID,\n+            type: \"m.widget\",\n+            id: STICKER_PICKER_WIDGET_ID,\n+        },\n+    });\n+}\n+\n test.describe(\"Stickers\", () => {\n     test.use({\n         displayName: \"Sally\",\n+        room: async ({ app }, use) => {\n+            const roomId = await app.client.createRoom({ name: ROOM_NAME_1 });\n+            await use({ roomId });\n+        },\n     });\n \n     // We spin up a web server for the sticker picker so that we're not testing to see if\n@@ -96,66 +143,60 @@ test.describe(\"Stickers\", () => {\n     //\n     // See sendStickerFromPicker() for more detail on iframe comms.\n     let stickerPickerUrl: string;\n-    test.beforeEach(async ({ webserver }) => {\n-        stickerPickerUrl = webserver.start(WIDGET_HTML);\n-    });\n \n-    test(\"should send a sticker to multiple rooms\", async ({ page, app, user }) => {\n-        const roomId1 = await app.client.createRoom({ name: ROOM_NAME_1 });\n+    test(\"should send a sticker to multiple rooms\", async ({ webserver, page, app, user, room }) => {\n         const roomId2 = await app.client.createRoom({ name: ROOM_NAME_2 });\n-\n-        await app.client.setAccountData(\"m.widgets\", {\n-            [STICKER_PICKER_WIDGET_ID]: {\n-                content: {\n-                    type: \"m.stickerpicker\",\n-                    name: STICKER_PICKER_WIDGET_NAME,\n-                    url: stickerPickerUrl,\n-                    creatorUserId: user.userId,\n-                },\n-                sender: user.userId,\n-                state_key: STICKER_PICKER_WIDGET_ID,\n-                type: \"m.widget\",\n-                id: STICKER_PICKER_WIDGET_ID,\n-            },\n-        });\n+        const { content_uri: contentUri } = await app.client.uploadContent(STICKER_IMAGE, { type: \"image/png\" });\n+        const widgetHtml = getWidgetHtml(contentUri, \"image/png\");\n+        stickerPickerUrl = webserver.start(widgetHtml);\n+        setWidgetAccountData(app, user, stickerPickerUrl);\n \n         await app.viewRoomByName(ROOM_NAME_1);\n-        await expect(page).toHaveURL(`/#/room/${roomId1}`);\n+        await expect(page).toHaveURL(`/#/room/${room.roomId}`);\n         await openStickerPicker(app);\n         await sendStickerFromPicker(page);\n-        await expectTimelineSticker(page, roomId1);\n+        await expectTimelineSticker(page, room.roomId, contentUri);\n \n         // Ensure that when we switch to a different room that the sticker\n         // goes to the right place\n         await app.viewRoomByName(ROOM_NAME_2);\n         await expect(page).toHaveURL(`/#/room/${roomId2}`);\n         await openStickerPicker(app);\n         await sendStickerFromPicker(page);\n-        await expectTimelineSticker(page, roomId2);\n+        await expectTimelineSticker(page, roomId2, contentUri);\n     });\n \n-    test(\"should handle a sticker picker widget missing creatorUserId\", async ({ page, app, user }) => {\n-        const roomId1 = await app.client.createRoom({ name: ROOM_NAME_1 });\n+    test(\"should handle a sticker picker widget missing creatorUserId\", async ({\n+        webserver,\n+        page,\n+        app,\n+        user,\n+        room,\n+    }) => {\n+        const { content_uri: contentUri } = await app.client.uploadContent(STICKER_IMAGE, { type: \"image/png\" });\n+        const widgetHtml = getWidgetHtml(contentUri, \"image/png\");\n+        stickerPickerUrl = webserver.start(widgetHtml);\n+        setWidgetAccountData(app, user, stickerPickerUrl, false);\n \n-        await app.client.setAccountData(\"m.widgets\", {\n-            [STICKER_PICKER_WIDGET_ID]: {\n-                content: {\n-                    type: \"m.stickerpicker\",\n-                    name: STICKER_PICKER_WIDGET_NAME,\n-                    url: stickerPickerUrl,\n-                    // No creatorUserId\n-                },\n-                sender: user.userId,\n-                state_key: STICKER_PICKER_WIDGET_ID,\n-                type: \"m.widget\",\n-                id: STICKER_PICKER_WIDGET_ID,\n-            },\n+        await app.viewRoomByName(ROOM_NAME_1);\n+        await expect(page).toHaveURL(`/#/room/${room.roomId}`);\n+        await openStickerPicker(app);\n+        await sendStickerFromPicker(page);\n+        await expectTimelineSticker(page, room.roomId, contentUri);\n+    });\n+\n+    test(\"should render invalid mimetype as a file\", async ({ webserver, page, app, user, room }) => {\n+        const { content_uri: contentUri } = await app.client.uploadContent(STICKER_IMAGE, {\n+            type: \"application/octet-stream\",\n         });\n+        const widgetHtml = getWidgetHtml(contentUri, \"application/octet-stream\");\n+        stickerPickerUrl = webserver.start(widgetHtml);\n+        setWidgetAccountData(app, user, stickerPickerUrl);\n \n         await app.viewRoomByName(ROOM_NAME_1);\n-        await expect(page).toHaveURL(`/#/room/${roomId1}`);\n+        await expect(page).toHaveURL(`/#/room/${room.roomId}`);\n         await openStickerPicker(app);\n         await sendStickerFromPicker(page);\n-        await expectTimelineSticker(page, roomId1);\n+        await expectFileTile(page, room.roomId, contentUri);\n     });\n });"
            },
            {
                "sha": "60fcce6493e30c1ad3d3cd78cffc9c85d7a172f6",
                "filename": "src/components/views/messages/MessageEvent.tsx",
                "status": "modified",
                "additions": 107,
                "deletions": 0,
                "changes": 107,
                "blob_url": "https://github.com/element-hq/element-web/blob/a00c343435d633e64de2c0548217aa611c7bbef5/src%2Fcomponents%2Fviews%2Fmessages%2FMessageEvent.tsx",
                "raw_url": "https://github.com/element-hq/element-web/raw/a00c343435d633e64de2c0548217aa611c7bbef5/src%2Fcomponents%2Fviews%2Fmessages%2FMessageEvent.tsx",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/src%2Fcomponents%2Fviews%2Fmessages%2FMessageEvent.tsx?ref=a00c343435d633e64de2c0548217aa611c7bbef5",
                "patch": "@@ -6,7 +6,9 @@ SPDX-License-Identifier: AGPL-3.0-only OR GPL-3.0-only\n Please see LICENSE files in the repository root for full details.\n */\n \n+import mime from \"mime\";\n import React, { createRef } from \"react\";\n+import { logger } from \"matrix-js-sdk/src/logger\";\n import {\n     EventType,\n     MsgType,\n@@ -15,6 +17,7 @@ import {\n     M_LOCATION,\n     M_POLL_END,\n     M_POLL_START,\n+    IContent,\n } from \"matrix-js-sdk/src/matrix\";\n \n import SettingsStore from \"../../../settings/SettingsStore\";\n@@ -144,6 +147,103 @@ export default class MessageEvent extends React.Component<IProps> implements IMe\n         this.forceUpdate();\n     };\n \n+    /**\n+     *  Validates that the filename extension and advertised mimetype\n+     *  of the supplied image/file message content match and are actuallly video/image content.\n+     *  For image/video messages with a thumbnail it also validates the mimetype is an image.\n+     * @param content The mxEvent content of the message\n+     * @returns A boolean indicating whether the validation passed\n+     */\n+    private validateImageOrVideoMimetype = (content: IContent): boolean => {\n+        // As per the spec if filename is not present the body represents the filename\n+        const filename = content.filename ?? content.body;\n+        if (!filename) {\n+            logger.log(\"Failed to validate image/video content, filename null\");\n+            return false;\n+        }\n+        // Check mimetype of the thumbnail\n+        if (!this.validateThumbnailMimetype(content)) {\n+            logger.log(\"Failed to validate file/image thumbnail\");\n+            return false;\n+        }\n+\n+        // if there is no mimetype from the extesion or the mimetype is not image/video validation fails\n+        const typeFromExtension = mime.getType(filename) ?? undefined;\n+        const extensionMajorMimetype = this.parseMajorMimetype(typeFromExtension);\n+        if (!typeFromExtension || !this.validateAllowedMimetype(typeFromExtension, [\"image\", \"video\"])) {\n+            logger.log(\"Failed to validate image/video content, invalid or missing extension\");\n+            return false;\n+        }\n+\n+        // if the content mimetype is set check it is an image/video and that it matches the extesion mimetype otherwise validation fails\n+        const contentMimetype = content.info?.mimetype;\n+        if (contentMimetype) {\n+            const contentMajorMimetype = this.parseMajorMimetype(contentMimetype);\n+            if (\n+                !this.validateAllowedMimetype(contentMimetype, [\"image\", \"video\"]) ||\n+                extensionMajorMimetype !== contentMajorMimetype\n+            ) {\n+                logger.log(\"Failed to validate image/video content, invalid or missing mimetype\");\n+                return false;\n+            }\n+        }\n+        return true;\n+    };\n+\n+    /**\n+     *  Validates that the advertised mimetype of the sticker content\n+     *  is an image.\n+     *  For stickers with a thumbnail it also validates the mimetype is an image.\n+     * @param content The mxEvent content of the message\n+     * @returns A boolean indicating whether the validation passed\n+     */\n+    private validateStickerMimetype = (content: IContent): boolean => {\n+        // Validate mimetype of the thumbnail\n+        const thumbnailResult = this.validateThumbnailMimetype(content);\n+        if (!thumbnailResult) {\n+            logger.log(\"Failed to validate sticker thumbnail\");\n+            return false;\n+        }\n+        // Validate mimetype of the content info is valid if it is set\n+        const contentMimetype = content.info?.mimetype;\n+        if (contentMimetype && !this.validateAllowedMimetype(contentMimetype, [\"image\"])) {\n+            logger.log(\"Failed to validate image/video content, invalid or missing mimetype/extensions\");\n+            return false;\n+        }\n+        return true;\n+    };\n+\n+    /**\n+     *  For image/video messages or stickers that have a thumnail mimetype specified,\n+     *  validates that the major mimetime is image.\n+     * @param content The mxEvent content of the message\n+     * @returns A boolean indicating whether the validation passed\n+     */\n+    private validateThumbnailMimetype = (content: IContent): boolean => {\n+        const thumbnailMimetype = content.info?.thumbnail_info?.mimetype;\n+        return !thumbnailMimetype || this.validateAllowedMimetype(thumbnailMimetype, [\"image\"]);\n+    };\n+\n+    /**\n+     * Validates that the major part of a mimetime from an allowed list.\n+     * @param mimetype The mimetype to validate\n+     * @param allowedMajorMimeTypes The list of allowed major mimetimes\n+     * @returns A boolean indicating whether the validation passed\n+     */\n+    private validateAllowedMimetype = (mimetype: string, allowedMajorMimeTypes: string[]): boolean => {\n+        const majorMimetype = this.parseMajorMimetype(mimetype);\n+        return !!majorMimetype && allowedMajorMimeTypes.includes(majorMimetype);\n+    };\n+\n+    /**\n+     * Parses and returns the the major part of a mimetype(before the \"/\").\n+     * @param mimetype As optional mimetype string to parse\n+     * @returns The major part of the mimetype string or undefined\n+     */\n+    private parseMajorMimetype(mimetype?: string): string | undefined {\n+        return mimetype?.split(\"/\")[0];\n+    }\n+\n     public render(): React.ReactNode {\n         const content = this.props.mxEvent.getContent();\n         const type = this.props.mxEvent.getType();\n@@ -165,6 +265,13 @@ export default class MessageEvent extends React.Component<IProps> implements IMe\n                 BodyType = UnknownBody;\n             }\n \n+            if (\n+                ((BodyType === MImageBody || BodyType == MVideoBody) && !this.validateImageOrVideoMimetype(content)) ||\n+                (BodyType === MStickerBody && !this.validateStickerMimetype(content))\n+            ) {\n+                BodyType = this.bodyTypes.get(MsgType.File)!;\n+            }\n+\n             // TODO: move to eventTypes when location sharing spec stabilises\n             if (M_LOCATION.matches(type) || (type === EventType.RoomMessage && msgtype === MsgType.Location)) {\n                 BodyType = MLocationBody;"
            },
            {
                "sha": "9ee323f17553c57795bbd49d7cd0f278d40b93f7",
                "filename": "test/unit-tests/components/views/messages/MessageEvent-test.tsx",
                "status": "modified",
                "additions": 47,
                "deletions": 7,
                "changes": 54,
                "blob_url": "https://github.com/element-hq/element-web/blob/a00c343435d633e64de2c0548217aa611c7bbef5/test%2Funit-tests%2Fcomponents%2Fviews%2Fmessages%2FMessageEvent-test.tsx",
                "raw_url": "https://github.com/element-hq/element-web/raw/a00c343435d633e64de2c0548217aa611c7bbef5/test%2Funit-tests%2Fcomponents%2Fviews%2Fmessages%2FMessageEvent-test.tsx",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/test%2Funit-tests%2Fcomponents%2Fviews%2Fmessages%2FMessageEvent-test.tsx?ref=a00c343435d633e64de2c0548217aa611c7bbef5",
                "patch": "@@ -33,6 +33,16 @@ jest.mock(\"../../../../../src/components/views/messages/MImageBody\", () => ({\n     default: () => <div data-testid=\"image-body\" />,\n }));\n \n+jest.mock(\"../../../../../src/components/views/messages/MVideoBody\", () => ({\n+    __esModule: true,\n+    default: () => <div data-testid=\"video-body\" />,\n+}));\n+\n+jest.mock(\"../../../../../src/components/views/messages/MFileBody\", () => ({\n+    __esModule: true,\n+    default: () => <div data-testid=\"file-body\" />,\n+}));\n+\n jest.mock(\"../../../../../src/components/views/messages/MImageReplyBody\", () => ({\n     __esModule: true,\n     default: () => <div data-testid=\"image-reply-body\" />,\n@@ -95,8 +105,8 @@ describe(\"MessageEvent\", () => {\n     describe(\"when an image with a caption is sent\", () => {\n         let result: RenderResult;\n \n-        beforeEach(() => {\n-            event = mkEvent({\n+        function createEvent(mimetype: string, filename: string, msgtype: string) {\n+            return mkEvent({\n                 event: true,\n                 type: EventType.RoomMessage,\n                 user: client.getUserId()!,\n@@ -105,28 +115,58 @@ describe(\"MessageEvent\", () => {\n                     body: \"caption for a test image\",\n                     format: \"org.matrix.custom.html\",\n                     formatted_body: \"<strong>caption for a test image</strong>\",\n-                    msgtype: MsgType.Image,\n-                    filename: \"image.webp\",\n+                    msgtype: msgtype,\n+                    filename: filename,\n                     info: {\n                         w: 40,\n                         h: 50,\n+                        mimetype: mimetype,\n                     },\n                     url: \"mxc://server/image\",\n                 },\n             });\n-            result = renderMessageEvent();\n-        });\n+        }\n \n-        it(\"should render a TextualBody and an ImageBody\", () => {\n+        function mockMedia() {\n             fetchMock.getOnce(\n                 \"https://server/_matrix/media/v3/download/server/image\",\n                 {\n                     body: fs.readFileSync(path.resolve(__dirname, \"..\", \"..\", \"..\", \"images\", \"animated-logo.webp\")),\n                 },\n                 { sendAsJson: false },\n             );\n+        }\n+\n+        it(\"should render a TextualBody and an ImageBody\", () => {\n+            event = createEvent(\"image/webp\", \"image.webp\", MsgType.Image);\n+            result = renderMessageEvent();\n+            mockMedia();\n             result.getByTestId(\"image-body\");\n             result.getByTestId(\"textual-body\");\n         });\n+\n+        it(\"should render a TextualBody and a FileBody for mismatched extension\", () => {\n+            event = createEvent(\"image/webp\", \"image.exe\", MsgType.Image);\n+            result = renderMessageEvent();\n+            mockMedia();\n+            result.getByTestId(\"file-body\");\n+            result.getByTestId(\"textual-body\");\n+        });\n+\n+        it(\"should render a TextualBody and an VideoBody\", () => {\n+            event = createEvent(\"video/mp4\", \"video.mp4\", MsgType.Video);\n+            result = renderMessageEvent();\n+            mockMedia();\n+            result.getByTestId(\"video-body\");\n+            result.getByTestId(\"textual-body\");\n+        });\n+\n+        it(\"should render a TextualBody and a FileBody for non-video mimetype\", () => {\n+            event = createEvent(\"application/octet-stream\", \"video.mp4\", MsgType.Video);\n+            result = renderMessageEvent();\n+            mockMedia();\n+            result.getByTestId(\"file-body\");\n+            result.getByTestId(\"textual-body\");\n+        });\n     });\n });"
            },
            {
                "sha": "f246eaf135779fbb4dca61a200c0a59c09384f11",
                "filename": "yarn.lock",
                "status": "modified",
                "additions": 5,
                "deletions": 0,
                "changes": 5,
                "blob_url": "https://github.com/element-hq/element-web/blob/a00c343435d633e64de2c0548217aa611c7bbef5/yarn.lock",
                "raw_url": "https://github.com/element-hq/element-web/raw/a00c343435d633e64de2c0548217aa611c7bbef5/yarn.lock",
                "contents_url": "https://api.github.com/repos/element-hq/element-web/contents/yarn.lock?ref=a00c343435d633e64de2c0548217aa611c7bbef5",
                "patch": "@@ -8411,6 +8411,11 @@ mime@1.6.0:\n   resolved \"https://registry.yarnpkg.com/mime/-/mime-1.6.0.tgz#32cd9e5c64553bd58d19a568af452acff04981b1\"\n   integrity sha512-x0Vn8spI+wuJ1O6S7gnbaQg8Pxh4NNHb7KSINmEWKiPE4RKOplvijn+NkmYmmRgP68mc70j2EbeTFRsrswaQeg==\n \n+mime@^4.0.4:\n+  version \"4.0.4\"\n+  resolved \"https://registry.yarnpkg.com/mime/-/mime-4.0.4.tgz#9f851b0fc3c289d063b20a7a8055b3014b25664b\"\n+  integrity sha512-v8yqInVjhXyqP6+Kw4fV3ZzeMRqEW6FotRsKXjRS5VMTNIuXsdRoAvklpoRgSqXm6o9VNH4/C0mgedko9DdLsQ==\n+\n mimic-fn@^2.1.0:\n   version \"2.1.0\"\n   resolved \"https://registry.yarnpkg.com/mimic-fn/-/mimic-fn-2.1.0.tgz#7ed2c2ccccaf84d3ffcb7a69b57711fc2083401b\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/tobychui/zoraxy/commits/2e9bc77a5d832bff1093058d42ce7a61382e4bc6",
        "url": "https://api.github.com/repos/tobychui/zoraxy/commits/2e9bc77a5d832bff1093058d42ce7a61382e4bc6",
        "html_url": "https://github.com/tobychui/zoraxy/commit/2e9bc77a5d832bff1093058d42ce7a61382e4bc6",
        "message": "Merge commit from fork\n\nFixed web ssh security bug",
        "files": [
            {
                "sha": "113cb453de408e9debdefc4828142a46b1ab45a2",
                "filename": "src/mod/sshprox/sshprox.go",
                "status": "modified",
                "additions": 11,
                "deletions": 15,
                "changes": 26,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/2e9bc77a5d832bff1093058d42ce7a61382e4bc6/src%2Fmod%2Fsshprox%2Fsshprox.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/2e9bc77a5d832bff1093058d42ce7a61382e4bc6/src%2Fmod%2Fsshprox%2Fsshprox.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Fsshprox.go?ref=2e9bc77a5d832bff1093058d42ce7a61382e4bc6",
                "patch": "@@ -50,21 +50,6 @@ func NewSSHProxyManager() *Manager {\n \t}\n }\n \n-// Get the next free port in the list\n-func (m *Manager) GetNextPort() int {\n-\tnextPort := m.StartingPort\n-\toccupiedPort := make(map[int]bool)\n-\tfor _, instance := range m.Instances {\n-\t\toccupiedPort[instance.AssignedPort] = true\n-\t}\n-\tfor {\n-\t\tif !occupiedPort[nextPort] {\n-\t\t\treturn nextPort\n-\t\t}\n-\t\tnextPort++\n-\t}\n-}\n-\n func (m *Manager) HandleHttpByInstanceId(instanceId string, w http.ResponseWriter, r *http.Request) {\n \ttargetInstance, err := m.GetInstanceById(instanceId)\n \tif err != nil {\n@@ -168,6 +153,17 @@ func (i *Instance) CreateNewConnection(listenPort int, username string, remoteIp\n \tif username != \"\" {\n \t\tconnAddr = username + \"@\" + remoteIpAddr\n \t}\n+\n+\t//Trim the space in the username and remote address\n+\tusername = strings.TrimSpace(username)\n+\tremoteIpAddr = strings.TrimSpace(remoteIpAddr)\n+\n+\t//Validate the username and remote address\n+\terr := ValidateUsernameAndRemoteAddr(username, remoteIpAddr)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n \tconfigPath := filepath.Join(filepath.Dir(i.ExecPath), \".gotty\")\n \ttitle := username + \"@\" + remoteIpAddr\n \tif remotePort != 22 {"
            },
            {
                "sha": "36a9ab591b88758b992ef07083eeaca88212cc3b",
                "filename": "src/mod/sshprox/sshprox_test.go",
                "status": "added",
                "additions": 66,
                "deletions": 0,
                "changes": 66,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/2e9bc77a5d832bff1093058d42ce7a61382e4bc6/src%2Fmod%2Fsshprox%2Fsshprox_test.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/2e9bc77a5d832bff1093058d42ce7a61382e4bc6/src%2Fmod%2Fsshprox%2Fsshprox_test.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Fsshprox_test.go?ref=2e9bc77a5d832bff1093058d42ce7a61382e4bc6",
                "patch": "@@ -0,0 +1,66 @@\n+package sshprox\n+\n+import (\n+\t\"testing\"\n+)\n+\n+func TestInstance_Destroy(t *testing.T) {\n+\tmanager := NewSSHProxyManager()\n+\tinstance, err := manager.NewSSHProxy(\"/tmp\")\n+\tif err != nil {\n+\t\tt.Fatalf(\"Failed to create new SSH proxy: %v\", err)\n+\t}\n+\n+\tinstance.Destroy()\n+\n+\tif len(manager.Instances) != 0 {\n+\t\tt.Errorf(\"Expected Instances to be empty, got %d\", len(manager.Instances))\n+\t}\n+}\n+\n+func TestInstance_ValidateUsernameAndRemoteAddr(t *testing.T) {\n+\ttests := []struct {\n+\t\tusername    string\n+\t\tremoteAddr  string\n+\t\texpectError bool\n+\t}{\n+\t\t{\"validuser\", \"127.0.0.1\", false},\n+\t\t{\"valid.user\", \"example.com\", false},\n+\t\t{\"; bash ;\", \"example.com\", true},\n+\t\t{\"valid-user\", \"example.com\", false},\n+\t\t{\"invalid user\", \"127.0.0.1\", true},\n+\t\t{\"validuser\", \"invalid address\", true},\n+\t\t{\"invalid@user\", \"127.0.0.1\", true},\n+\t\t{\"validuser\", \"invalid@address\", true},\n+\t\t{\"injection; rm -rf /\", \"127.0.0.1\", true},\n+\t\t{\"validuser\", \"127.0.0.1; rm -rf /\", true},\n+\t\t{\"$(reboot)\", \"127.0.0.1\", true},\n+\t\t{\"validuser\", \"$(reboot)\", true},\n+\t\t{\"validuser\", \"127.0.0.1; $(reboot)\", true},\n+\t\t{\"validuser\", \"127.0.0.1 | ls\", true},\n+\t\t{\"validuser\", \"127.0.0.1 & ls\", true},\n+\t\t{\"validuser\", \"127.0.0.1 && ls\", true},\n+\t\t{\"validuser\", \"127.0.0.1 |& ls\", true},\n+\t\t{\"validuser\", \"127.0.0.1 ; ls\", true},\n+\t\t{\"validuser\", \"2001:0db8:85a3:0000:0000:8a2e:0370:7334\", false},\n+\t\t{\"validuser\", \"2001:db8::ff00:42:8329\", false},\n+\t\t{\"validuser\", \"2001:db8:0:1234:0:567:8:1\", false},\n+\t\t{\"validuser\", \"2001:db8::1234:0:567:8:1\", false},\n+\t\t{\"validuser\", \"2001:db8:0:0:0:0:2:1\", false},\n+\t\t{\"validuser\", \"2001:db8::2:1\", false},\n+\t\t{\"validuser\", \"2001:db8:0:0:8:800:200c:417a\", false},\n+\t\t{\"validuser\", \"2001:db8::8:800:200c:417a\", false},\n+\t\t{\"validuser\", \"2001:db8:0:0:8:800:200c:417a; rm -rf /\", true},\n+\t\t{\"validuser\", \"2001:db8::8:800:200c:417a; rm -rf /\", true},\n+\t}\n+\n+\tfor _, test := range tests {\n+\t\terr := ValidateUsernameAndRemoteAddr(test.username, test.remoteAddr)\n+\t\tif test.expectError && err == nil {\n+\t\t\tt.Errorf(\"Expected error for username %s and remoteAddr %s, but got none\", test.username, test.remoteAddr)\n+\t\t}\n+\t\tif !test.expectError && err != nil {\n+\t\t\tt.Errorf(\"Did not expect error for username %s and remoteAddr %s, but got %v\", test.username, test.remoteAddr, err)\n+\t\t}\n+\t}\n+}"
            },
            {
                "sha": "0e4d271350feaf7d66230f48e1352f18c11596a6",
                "filename": "src/mod/sshprox/utils.go",
                "status": "modified",
                "additions": 57,
                "deletions": 6,
                "changes": 63,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/2e9bc77a5d832bff1093058d42ce7a61382e4bc6/src%2Fmod%2Fsshprox%2Futils.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/2e9bc77a5d832bff1093058d42ce7a61382e4bc6/src%2Fmod%2Fsshprox%2Futils.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Futils.go?ref=2e9bc77a5d832bff1093058d42ce7a61382e4bc6",
                "patch": "@@ -1,9 +1,11 @@\n package sshprox\n \n import (\n+\t\"errors\"\n \t\"fmt\"\n \t\"net\"\n \t\"net/url\"\n+\t\"regexp\"\n \t\"runtime\"\n \t\"strings\"\n \t\"time\"\n@@ -34,6 +36,21 @@ func IsWebSSHSupported() bool {\n \treturn true\n }\n \n+// Get the next free port in the list\n+func (m *Manager) GetNextPort() int {\n+\tnextPort := m.StartingPort\n+\toccupiedPort := make(map[int]bool)\n+\tfor _, instance := range m.Instances {\n+\t\toccupiedPort[instance.AssignedPort] = true\n+\t}\n+\tfor {\n+\t\tif !occupiedPort[nextPort] {\n+\t\t\treturn nextPort\n+\t\t}\n+\t\tnextPort++\n+\t}\n+}\n+\n // Check if a given domain and port is a valid ssh server\n func IsSSHConnectable(ipOrDomain string, port int) bool {\n \ttimeout := time.Second * 3\n@@ -60,13 +77,47 @@ func IsSSHConnectable(ipOrDomain string, port int) bool {\n \treturn string(buf[:7]) == \"SSH-2.0\"\n }\n \n-// Check if the port is used by other process or application\n-func isPortInUse(port int) bool {\n-\taddress := fmt.Sprintf(\":%d\", port)\n-\tlistener, err := net.Listen(\"tcp\", address)\n-\tif err != nil {\n+// Validate the username and remote address to prevent injection\n+func ValidateUsernameAndRemoteAddr(username string, remoteIpAddr string) error {\n+\t// Validate and sanitize the username to prevent ssh injection\n+\tvalidUsername := regexp.MustCompile(`^[a-zA-Z0-9._-]+$`)\n+\tif !validUsername.MatchString(username) {\n+\t\treturn errors.New(\"invalid username, only alphanumeric characters, dots, underscores and dashes are allowed\")\n+\t}\n+\n+\t//Check if the remoteIpAddr is a valid ipv4 or ipv6 address\n+\tif net.ParseIP(remoteIpAddr) != nil {\n+\t\t//A valid IP address do not need further validation\n+\t\treturn nil\n+\t}\n+\n+\t// Validate and sanitize the remote domain to prevent injection\n+\tvalidRemoteAddr := regexp.MustCompile(`^[a-zA-Z0-9._-]+$`)\n+\tif !validRemoteAddr.MatchString(remoteIpAddr) {\n+\t\treturn errors.New(\"invalid remote address, only alphanumeric characters, dots, underscores and dashes are allowed\")\n+\t}\n+\n+\treturn nil\n+}\n+\n+// Check if the given ip or domain is a loopback address\n+// or resolves to a loopback address\n+func IsLoopbackIPOrDomain(ipOrDomain string) bool {\n+\tif strings.EqualFold(strings.TrimSpace(ipOrDomain), \"localhost\") || strings.TrimSpace(ipOrDomain) == \"127.0.0.1\" {\n \t\treturn true\n \t}\n-\tlistener.Close()\n+\n+\t//Check if the ipOrDomain resolves to a loopback address\n+\tips, err := net.LookupIP(ipOrDomain)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\tfor _, ip := range ips {\n+\t\tif ip.IsLoopback() {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\n \treturn false\n }"
            },
            {
                "sha": "8d870b9387e94ebe62b1ea439a16780b8cf68e00",
                "filename": "src/webssh.go",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/2e9bc77a5d832bff1093058d42ce7a61382e4bc6/src%2Fwebssh.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/2e9bc77a5d832bff1093058d42ce7a61382e4bc6/src%2Fwebssh.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fwebssh.go?ref=2e9bc77a5d832bff1093058d42ce7a61382e4bc6",
                "patch": "@@ -42,7 +42,7 @@ func HandleCreateProxySession(w http.ResponseWriter, r *http.Request) {\n \n \tif !*allowSshLoopback {\n \t\t//Not allow loopback connections\n-\t\tif strings.EqualFold(strings.TrimSpace(ipaddr), \"localhost\") || strings.TrimSpace(ipaddr) == \"127.0.0.1\" {\n+\t\tif sshprox.IsLoopbackIPOrDomain(ipaddr) {\n \t\t\t//Request target is loopback\n \t\t\tutils.SendErrorResponse(w, \"loopback web ssh connection is not enabled on this host\")\n \t\t\treturn\n@@ -74,7 +74,7 @@ func HandleCreateProxySession(w http.ResponseWriter, r *http.Request) {\n \tutils.SendJSONResponse(w, string(js))\n }\n \n-//Check if the host support ssh, or if the target domain (and port, optional) support ssh\n+// Check if the host support ssh, or if the target domain (and port, optional) support ssh\n func HandleWebSshSupportCheck(w http.ResponseWriter, r *http.Request) {\n \tdomain, err := utils.PostPara(r, \"domain\")\n \tif err != nil {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/tobychui/zoraxy/commits/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
        "url": "https://api.github.com/repos/tobychui/zoraxy/commits/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
        "html_url": "https://github.com/tobychui/zoraxy/commit/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
        "message": "v2 init commit",
        "files": [
            {
                "sha": "c5dbbc25730269675037d3f069dae5c58c9acf99",
                "filename": "src/Makefile",
                "status": "added",
                "additions": 60,
                "deletions": 0,
                "changes": 60,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2FMakefile",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2FMakefile",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2FMakefile?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,60 @@\n+# PLATFORMS := darwin/amd64 darwin/arm64 freebsd/amd64 linux/386 linux/amd64 linux/arm linux/arm64 linux/mipsle windows/386 windows/amd64 windows/arm windows/arm64\n+PLATFORMS := linux/amd64 linux/386 linux/arm linux/arm64 linux/mipsle linux/riscv64 windows/amd64\n+temp = $(subst /, ,$@)\n+os = $(word 1, $(temp))\n+arch = $(word 2, $(temp))\n+\n+#all:  web.tar.gz $(PLATFORMS) fixwindows zoraxy_file_checksum.sha1\n+all:  clear_old $(PLATFORMS) fixwindows\n+\n+binary: $(PLATFORMS)\n+\n+hash: zoraxy_file_checksum.sha1\n+\n+web: web.tar.gz\n+\n+clean: \n+\trm -f zoraxy_*_*\n+\trm -f web.tar.gz\n+\n+$(PLATFORMS):\n+\t@echo \"Building $(os)/$(arch)\"\n+\tGOROOT_FINAL=Git/ GOOS=$(os) GOARCH=$(arch) GOARM=6 go build -o './dist/zoraxy_$(os)_$(arch)'  -ldflags \"-s -w\" -trimpath\n+\n+\n+fixwindows:\n+\t-mv ./dist/zoraxy_windows_amd64 ./dist/zoraxy_windows_amd64.exe\n+#\t-mv ./dist/zoraxy_windows_arm64 ./dist/zoraxy_windows_arm64.exe\n+\n+\n+clear_old:\n+\t-rm -rf ./dist/\n+\t-mkdir ./dist/\n+\n+web.tar.gz:\n+\t\n+\t@echo \"Removing old build resources, if exists\"\n+\t-rm -rf ./dist/\n+\t-mkdir ./dist/\n+\n+\t@echo \"Moving subfolders to build folder\"\n+\t-cp -r ./web ./dist/web/\n+\t-cp -r ./system ./dist/system/\n+\n+\t@ echo \"Remove sensitive information\"\n+\t-rm -rf ./dist/certs/\n+\t-rm -rf ./dist/conf/\n+\t-rm -rf ./dist/rules/\n+\n+\n+\t@echo \"Creating tarball for all required files\"\n+\t-rm ./dist/web.tar.gz\n+\t-cd ./dist/ && tar -czf ./web.tar.gz system/ web/\n+\n+\t@echo \"Clearing up unzipped folder structures\"\n+\t-rm -rf \"./dist/web\"\n+\t-rm -rf \"./dist/system\"\n+\n+zoraxy_file_checksum.sha1:\n+\t@echo \"Generating the checksum, if sha1sum installed\"\n+\t-sha1sum ./dist/web.tar.gz > ./dist/zoraxy_file_checksum.sha1\n\\ No newline at end of file"
            },
            {
                "sha": "0d129b825e91d06399fdfa04401332ac04adb6d5",
                "filename": "src/api.go",
                "status": "added",
                "additions": 203,
                "deletions": 0,
                "changes": 203,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fapi.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fapi.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fapi.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,203 @@\n+package main\n+\n+import (\n+\t\"encoding/json\"\n+\t\"net/http\"\n+\n+\t\"imuslab.com/zoraxy/mod/auth\"\n+\t\"imuslab.com/zoraxy/mod/netstat\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+/*\n+\tAPI.go\n+\n+\tThis file contains all the API called by the web management interface\n+\n+*/\n+\n+var requireAuth = true\n+\n+func initAPIs() {\n+\n+\tauthRouter := auth.NewManagedHTTPRouter(auth.RouterOption{\n+\t\tAuthAgent:   authAgent,\n+\t\tRequireAuth: requireAuth,\n+\t\tDeniedHandler: func(w http.ResponseWriter, r *http.Request) {\n+\t\t\thttp.Error(w, \"401 - Unauthorized\", http.StatusUnauthorized)\n+\t\t},\n+\t})\n+\n+\t//Register the standard web services urls\n+\tfs := http.FileServer(http.FS(webres))\n+\tif development {\n+\t\tfs = http.FileServer(http.Dir(\"web/\"))\n+\t}\n+\t//Add a layer of middleware for advance  control\n+\tadvHandler := FSHandler(fs)\n+\thttp.Handle(\"/\", advHandler)\n+\n+\t//Authentication APIs\n+\tregisterAuthAPIs(requireAuth)\n+\n+\t//Reverse proxy\n+\tauthRouter.HandleFunc(\"/api/proxy/enable\", ReverseProxyHandleOnOff)\n+\tauthRouter.HandleFunc(\"/api/proxy/add\", ReverseProxyHandleAddEndpoint)\n+\tauthRouter.HandleFunc(\"/api/proxy/status\", ReverseProxyStatus)\n+\tauthRouter.HandleFunc(\"/api/proxy/list\", ReverseProxyList)\n+\tauthRouter.HandleFunc(\"/api/proxy/del\", DeleteProxyEndpoint)\n+\tauthRouter.HandleFunc(\"/api/proxy/tlscheck\", HandleCheckSiteSupportTLS)\n+\tauthRouter.HandleFunc(\"/api/proxy/setIncoming\", HandleIncomingPortSet)\n+\tauthRouter.HandleFunc(\"/api/proxy/useHttpsRedirect\", HandleUpdateHttpsRedirect)\n+\tauthRouter.HandleFunc(\"/api/proxy/requestIsProxied\", HandleManagementProxyCheck)\n+\n+\t//TLS / SSL config\n+\tauthRouter.HandleFunc(\"/api/cert/tls\", handleToggleTLSProxy)\n+\tauthRouter.HandleFunc(\"/api/cert/upload\", handleCertUpload)\n+\tauthRouter.HandleFunc(\"/api/cert/list\", handleListCertificate)\n+\tauthRouter.HandleFunc(\"/api/cert/checkDefault\", handleDefaultCertCheck)\n+\tauthRouter.HandleFunc(\"/api/cert/delete\", handleCertRemove)\n+\n+\t//Redirection config\n+\tauthRouter.HandleFunc(\"/api/redirect/list\", handleListRedirectionRules)\n+\tauthRouter.HandleFunc(\"/api/redirect/add\", handleAddRedirectionRule)\n+\tauthRouter.HandleFunc(\"/api/redirect/delete\", handleDeleteRedirectionRule)\n+\n+\t//Blacklist APIs\n+\tauthRouter.HandleFunc(\"/api/blacklist/list\", handleListBlacklisted)\n+\tauthRouter.HandleFunc(\"/api/blacklist/country/add\", handleCountryBlacklistAdd)\n+\tauthRouter.HandleFunc(\"/api/blacklist/country/remove\", handleCountryBlacklistRemove)\n+\tauthRouter.HandleFunc(\"/api/blacklist/ip/add\", handleIpBlacklistAdd)\n+\tauthRouter.HandleFunc(\"/api/blacklist/ip/remove\", handleIpBlacklistRemove)\n+\tauthRouter.HandleFunc(\"/api/blacklist/enable\", handleBlacklistEnable)\n+\n+\t//Statistic & uptime monitoring API\n+\tauthRouter.HandleFunc(\"/api/stats/summary\", statisticCollector.HandleTodayStatLoad)\n+\tauthRouter.HandleFunc(\"/api/stats/countries\", HandleCountryDistrSummary)\n+\tauthRouter.HandleFunc(\"/api/stats/netstat\", netstat.HandleGetNetworkInterfaceStats)\n+\tauthRouter.HandleFunc(\"/api/stats/netstatgraph\", netstatBuffers.HandleGetBufferedNetworkInterfaceStats)\n+\tauthRouter.HandleFunc(\"/api/stats/listnic\", netstat.HandleListNetworkInterfaces)\n+\tauthRouter.HandleFunc(\"/api/utm/list\", HandleUptimeMonitorListing)\n+\n+\t//Global Area Network APIs\n+\tauthRouter.HandleFunc(\"/api/gan/network/info\", ganManager.HandleGetNodeID)\n+\tauthRouter.HandleFunc(\"/api/gan/network/add\", ganManager.HandleAddNetwork)\n+\tauthRouter.HandleFunc(\"/api/gan/network/remove\", ganManager.HandleRemoveNetwork)\n+\tauthRouter.HandleFunc(\"/api/gan/network/list\", ganManager.HandleListNetwork)\n+\tauthRouter.HandleFunc(\"/api/gan/network/name\", ganManager.HandleNetworkNaming)\n+\t//authRouter.HandleFunc(\"/api/gan/network/detail\", ganManager.HandleNetworkDetails)\n+\tauthRouter.HandleFunc(\"/api/gan/network/setRange\", ganManager.HandleSetRanges)\n+\tauthRouter.HandleFunc(\"/api/gan/members/list\", ganManager.HandleMemberList)\n+\tauthRouter.HandleFunc(\"/api/gan/members/ip\", ganManager.HandleMemberIP)\n+\tauthRouter.HandleFunc(\"/api/gan/members/name\", ganManager.HandleMemberNaming)\n+\tauthRouter.HandleFunc(\"/api/gan/members/authorize\", ganManager.HandleMemberAuthorization)\n+\tauthRouter.HandleFunc(\"/api/gan/members/delete\", ganManager.HandleMemberDelete)\n+\n+\t//TCP Proxy\n+\tauthRouter.HandleFunc(\"/api/tcpprox/config/add\", tcpProxyManager.HandleAddProxyConfig)\n+\tauthRouter.HandleFunc(\"/api/tcpprox/config/edit\", tcpProxyManager.HandleEditProxyConfigs)\n+\tauthRouter.HandleFunc(\"/api/tcpprox/config/list\", tcpProxyManager.HandleListConfigs)\n+\tauthRouter.HandleFunc(\"/api/tcpprox/config/status\", tcpProxyManager.HandleGetProxyStatus)\n+\tauthRouter.HandleFunc(\"/api/tcpprox/config/validate\", tcpProxyManager.HandleConfigValidate)\n+\n+\t//mDNS APIs\n+\tauthRouter.HandleFunc(\"/api/mdns/list\", HandleMdnsListing)\n+\tauthRouter.HandleFunc(\"/api/mdns/discover\", HandleMdnsScanning)\n+\n+\t//Zoraxy Analytic\n+\tauthRouter.HandleFunc(\"/api/analytic/list\", AnalyticLoader.HandleSummaryList)\n+\tauthRouter.HandleFunc(\"/api/analytic/load\", AnalyticLoader.HandleLoadTargetDaySummary)\n+\tauthRouter.HandleFunc(\"/api/analytic/loadRange\", AnalyticLoader.HandleLoadTargetRangeSummary)\n+\n+\t//Network utilities\n+\tauthRouter.HandleFunc(\"/api/tools/ipscan\", HandleIpScan)\n+\tauthRouter.HandleFunc(\"/api/tools/webssh\", HandleCreateProxySession)\n+\tauthRouter.HandleFunc(\"/api/tools/websshSupported\", HandleWebSshSupportCheck)\n+\tauthRouter.HandleFunc(\"/api/tools/wol\", HandleWakeOnLan)\n+\tauthRouter.HandleFunc(\"/api/tools/smtp/get\", HandleSMTPGet)\n+\tauthRouter.HandleFunc(\"/api/tools/smtp/set\", HandleSMTPSet)\n+\tauthRouter.HandleFunc(\"/api/tools/smtp/admin\", HandleAdminEmailGet)\n+\tauthRouter.HandleFunc(\"/api/tools/smtp/test\", HandleTestEmailSend)\n+\n+\t//Account Reset\n+\thttp.HandleFunc(\"/api/account/reset\", HandleAdminAccountResetEmail)\n+\thttp.HandleFunc(\"/api/account/new\", HandleNewPasswordSetup)\n+\n+\t//If you got APIs to add, append them here\n+}\n+\n+// Function to renders Auth related APIs\n+func registerAuthAPIs(requireAuth bool) {\n+\t//Auth APIs\n+\thttp.HandleFunc(\"/api/auth/login\", authAgent.HandleLogin)\n+\thttp.HandleFunc(\"/api/auth/logout\", authAgent.HandleLogout)\n+\thttp.HandleFunc(\"/api/auth/checkLogin\", func(w http.ResponseWriter, r *http.Request) {\n+\t\tif requireAuth {\n+\t\t\tauthAgent.CheckLogin(w, r)\n+\t\t} else {\n+\t\t\tutils.SendJSONResponse(w, \"true\")\n+\t\t}\n+\t})\n+\thttp.HandleFunc(\"/api/auth/username\", func(w http.ResponseWriter, r *http.Request) {\n+\t\tusername, err := authAgent.GetUserName(w, r)\n+\t\tif err != nil {\n+\t\t\thttp.Error(w, http.StatusText(http.StatusUnauthorized), http.StatusUnauthorized)\n+\t\t\treturn\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(username)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t})\n+\thttp.HandleFunc(\"/api/auth/userCount\", func(w http.ResponseWriter, r *http.Request) {\n+\t\tuc := authAgent.GetUserCounts()\n+\t\tjs, _ := json.Marshal(uc)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t})\n+\thttp.HandleFunc(\"/api/auth/register\", func(w http.ResponseWriter, r *http.Request) {\n+\t\tif authAgent.GetUserCounts() == 0 {\n+\t\t\t//Allow register root admin\n+\t\t\tauthAgent.HandleRegisterWithoutEmail(w, r, func(username, reserved string) {\n+\n+\t\t\t})\n+\t\t} else {\n+\t\t\t//This function is disabled\n+\t\t\tutils.SendErrorResponse(w, \"Root management account already exists\")\n+\t\t}\n+\t})\n+\thttp.HandleFunc(\"/api/auth/changePassword\", func(w http.ResponseWriter, r *http.Request) {\n+\t\tusername, err := authAgent.GetUserName(w, r)\n+\t\tif err != nil {\n+\t\t\thttp.Error(w, \"401 - Unauthorized\", http.StatusUnauthorized)\n+\t\t\treturn\n+\t\t}\n+\n+\t\toldPassword, err := utils.PostPara(r, \"oldPassword\")\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"empty current password\")\n+\t\t\treturn\n+\t\t}\n+\t\tnewPassword, err := utils.PostPara(r, \"newPassword\")\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"empty new password\")\n+\t\t\treturn\n+\t\t}\n+\t\tconfirmPassword, _ := utils.PostPara(r, \"confirmPassword\")\n+\n+\t\tif newPassword != confirmPassword {\n+\t\t\tutils.SendErrorResponse(w, \"confirm password not match\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\t//Check if the old password correct\n+\t\toldPasswordCorrect, _ := authAgent.ValidateUsernameAndPasswordWithReason(username, oldPassword)\n+\t\tif !oldPasswordCorrect {\n+\t\t\tutils.SendErrorResponse(w, \"Invalid current password given\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\t//Change the password of the root user\n+\t\tauthAgent.UnregisterUser(username)\n+\t\tauthAgent.CreateUserAccount(username, newPassword, \"\")\n+\t})\n+\n+}"
            },
            {
                "sha": "3ed83cfbbb631577714a537574e2d02eab96fbd6",
                "filename": "src/blacklist.go",
                "status": "added",
                "additions": 102,
                "deletions": 0,
                "changes": 102,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fblacklist.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fblacklist.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fblacklist.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,102 @@\n+package main\n+\n+import (\n+\t\"encoding/json\"\n+\t\"net/http\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+/*\n+\tblacklist.go\n+\n+\tThis script file is added to extend the\n+\treverse proxy function to include\n+\tbanning a specific IP address or country code\n+*/\n+\n+//List a of blacklisted ip address or country code\n+func handleListBlacklisted(w http.ResponseWriter, r *http.Request) {\n+\tbltype, err := utils.GetPara(r, \"type\")\n+\tif err != nil {\n+\t\tbltype = \"country\"\n+\t}\n+\n+\tresulst := []string{}\n+\tif bltype == \"country\" {\n+\t\tresulst = geodbStore.GetAllBlacklistedCountryCode()\n+\t} else if bltype == \"ip\" {\n+\t\tresulst = geodbStore.GetAllBlacklistedIp()\n+\t}\n+\n+\tjs, _ := json.Marshal(resulst)\n+\tutils.SendJSONResponse(w, string(js))\n+\n+}\n+\n+func handleCountryBlacklistAdd(w http.ResponseWriter, r *http.Request) {\n+\tcountryCode, err := utils.PostPara(r, \"cc\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid or empty country code\")\n+\t\treturn\n+\t}\n+\n+\tgeodbStore.AddCountryCodeToBlackList(countryCode)\n+\n+\tutils.SendOK(w)\n+}\n+\n+func handleCountryBlacklistRemove(w http.ResponseWriter, r *http.Request) {\n+\tcountryCode, err := utils.PostPara(r, \"cc\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid or empty country code\")\n+\t\treturn\n+\t}\n+\n+\tgeodbStore.RemoveCountryCodeFromBlackList(countryCode)\n+\n+\tutils.SendOK(w)\n+}\n+\n+func handleIpBlacklistAdd(w http.ResponseWriter, r *http.Request) {\n+\tipAddr, err := utils.PostPara(r, \"ip\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid or empty ip address\")\n+\t\treturn\n+\t}\n+\n+\tgeodbStore.AddIPToBlackList(ipAddr)\n+}\n+\n+func handleIpBlacklistRemove(w http.ResponseWriter, r *http.Request) {\n+\tipAddr, err := utils.PostPara(r, \"ip\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid or empty ip address\")\n+\t\treturn\n+\t}\n+\n+\tgeodbStore.RemoveIPFromBlackList(ipAddr)\n+\n+\tutils.SendOK(w)\n+}\n+\n+func handleBlacklistEnable(w http.ResponseWriter, r *http.Request) {\n+\tenable, err := utils.PostPara(r, \"enable\")\n+\tif err != nil {\n+\t\t//Return the current enabled state\n+\t\tcurrentEnabled := geodbStore.Enabled\n+\t\tjs, _ := json.Marshal(currentEnabled)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\tif enable == \"true\" {\n+\t\t\tgeodbStore.ToggleBlacklist(true)\n+\t\t} else if enable == \"false\" {\n+\t\t\tgeodbStore.ToggleBlacklist(false)\n+\t\t} else {\n+\t\t\tutils.SendErrorResponse(w, \"invalid enable state: only true and false is accepted\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tutils.SendOK(w)\n+\t}\n+}"
            },
            {
                "sha": "897bc2adc63675267395ff4de8c6d590a087de10",
                "filename": "src/cert.go",
                "status": "added",
                "additions": 189,
                "deletions": 0,
                "changes": 189,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fcert.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fcert.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fcert.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,189 @@\n+package main\n+\n+import (\n+\t\"encoding/json\"\n+\t\"fmt\"\n+\t\"io\"\n+\t\"log\"\n+\t\"net/http\"\n+\t\"os\"\n+\t\"path/filepath\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+// Check if the default certificates is correctly setup\n+func handleDefaultCertCheck(w http.ResponseWriter, r *http.Request) {\n+\ttype CheckResult struct {\n+\t\tDefaultPubExists bool\n+\t\tDefaultPriExists bool\n+\t}\n+\n+\tpub, pri := tlsCertManager.DefaultCertExistsSep()\n+\tjs, _ := json.Marshal(CheckResult{\n+\t\tpub,\n+\t\tpri,\n+\t})\n+\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+// Return a list of domains where the certificates covers\n+func handleListCertificate(w http.ResponseWriter, r *http.Request) {\n+\tfilenames, err := tlsCertManager.ListCertDomains()\n+\tif err != nil {\n+\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n+\t\treturn\n+\t}\n+\n+\tshowDate, _ := utils.GetPara(r, \"date\")\n+\tif showDate == \"true\" {\n+\t\ttype CertInfo struct {\n+\t\t\tDomain           string\n+\t\t\tLastModifiedDate string\n+\t\t}\n+\n+\t\tresults := []*CertInfo{}\n+\n+\t\tfor _, filename := range filenames {\n+\t\t\tfileInfo, err := os.Stat(filepath.Join(tlsCertManager.CertStore, filename+\".crt\"))\n+\t\t\tif err != nil {\n+\t\t\t\tutils.SendErrorResponse(w, \"invalid domain certificate discovered: \"+filename)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tmodifiedTime := fileInfo.ModTime().Format(\"2006-01-02 15:04:05\")\n+\n+\t\t\tthisCertInfo := CertInfo{\n+\t\t\t\tDomain:           filename,\n+\t\t\t\tLastModifiedDate: modifiedTime,\n+\t\t\t}\n+\n+\t\t\tresults = append(results, &thisCertInfo)\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(results)\n+\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n+\t\tw.Write(js)\n+\t} else {\n+\t\tresponse, err := json.Marshal(filenames)\n+\t\tif err != nil {\n+\t\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\n+\t\t\treturn\n+\t\t}\n+\n+\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n+\t\tw.Write(response)\n+\t}\n+\n+}\n+\n+// Handle front-end toggling TLS mode\n+func handleToggleTLSProxy(w http.ResponseWriter, r *http.Request) {\n+\tcurrentTlsSetting := false\n+\tif sysdb.KeyExists(\"settings\", \"usetls\") {\n+\t\tsysdb.Read(\"settings\", \"usetls\", &currentTlsSetting)\n+\t}\n+\n+\tnewState, err := utils.PostPara(r, \"set\")\n+\tif err != nil {\n+\t\t//No setting. Get the current status\n+\t\tjs, _ := json.Marshal(currentTlsSetting)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\tif newState == \"true\" {\n+\t\t\tsysdb.Write(\"settings\", \"usetls\", true)\n+\t\t\tlog.Println(\"Enabling TLS mode on reverse proxy\")\n+\t\t\tdynamicProxyRouter.UpdateTLSSetting(true)\n+\t\t} else if newState == \"false\" {\n+\t\t\tsysdb.Write(\"settings\", \"usetls\", false)\n+\t\t\tlog.Println(\"Disabling TLS mode on reverse proxy\")\n+\t\t\tdynamicProxyRouter.UpdateTLSSetting(false)\n+\t\t} else {\n+\t\t\tutils.SendErrorResponse(w, \"invalid state given. Only support true or false\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tutils.SendOK(w)\n+\n+\t}\n+}\n+\n+// Handle upload of the certificate\n+func handleCertUpload(w http.ResponseWriter, r *http.Request) {\n+\t// check if request method is POST\n+\tif r.Method != \"POST\" {\n+\t\thttp.Error(w, \"Method not allowed\", http.StatusMethodNotAllowed)\n+\t\treturn\n+\t}\n+\n+\t// get the key type\n+\tkeytype, err := utils.GetPara(r, \"ktype\")\n+\toverWriteFilename := \"\"\n+\tif err != nil {\n+\t\thttp.Error(w, \"Not defined key type (pub / pri)\", http.StatusBadRequest)\n+\t\treturn\n+\t}\n+\n+\t// get the domain\n+\tdomain, err := utils.GetPara(r, \"domain\")\n+\tif err != nil {\n+\t\t//Assume localhost\n+\t\tdomain = \"default\"\n+\t}\n+\n+\tif keytype == \"pub\" {\n+\t\toverWriteFilename = domain + \".crt\"\n+\t} else if keytype == \"pri\" {\n+\t\toverWriteFilename = domain + \".key\"\n+\t} else {\n+\t\thttp.Error(w, \"Not supported keytype: \"+keytype, http.StatusBadRequest)\n+\t\treturn\n+\t}\n+\n+\t// parse multipart form data\n+\terr = r.ParseMultipartForm(10 << 20) // 10 MB\n+\tif err != nil {\n+\t\thttp.Error(w, \"Failed to parse form data\", http.StatusBadRequest)\n+\t\treturn\n+\t}\n+\n+\t// get file from form data\n+\tfile, _, err := r.FormFile(\"file\")\n+\tif err != nil {\n+\t\thttp.Error(w, \"Failed to get file\", http.StatusBadRequest)\n+\t\treturn\n+\t}\n+\tdefer file.Close()\n+\n+\t// create file in upload directory\n+\tos.MkdirAll(\"./certs\", 0775)\n+\tf, err := os.Create(filepath.Join(\"./certs\", overWriteFilename))\n+\tif err != nil {\n+\t\thttp.Error(w, \"Failed to create file\", http.StatusInternalServerError)\n+\t\treturn\n+\t}\n+\tdefer f.Close()\n+\n+\t// copy file contents to destination file\n+\t_, err = io.Copy(f, file)\n+\tif err != nil {\n+\t\thttp.Error(w, \"Failed to save file\", http.StatusInternalServerError)\n+\t\treturn\n+\t}\n+\n+\t// send response\n+\tfmt.Fprintln(w, \"File upload successful!\")\n+}\n+\n+// Handle cert remove\n+func handleCertRemove(w http.ResponseWriter, r *http.Request) {\n+\tdomain, err := utils.PostPara(r, \"domain\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid domain given\")\n+\t\treturn\n+\t}\n+\terr = tlsCertManager.RemoveCert(domain)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t}\n+}"
            },
            {
                "sha": "b2eba059cc56ae94da0e7d79c3d861b0fd4c142f",
                "filename": "src/config.go",
                "status": "added",
                "additions": 86,
                "deletions": 0,
                "changes": 86,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fconfig.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fconfig.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fconfig.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,86 @@\n+package main\n+\n+import (\n+\t\"encoding/json\"\n+\t\"io/ioutil\"\n+\t\"log\"\n+\t\"os\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+/*\n+\tReverse Proxy Configs\n+\n+\tThe following section handle\n+\tthe reverse proxy configs\n+*/\n+\n+type Record struct {\n+\tProxyType   string\n+\tRootname    string\n+\tProxyTarget string\n+\tUseTLS      bool\n+}\n+\n+func SaveReverseProxyConfig(ptype string, rootname string, proxyTarget string, useTLS bool) error {\n+\tos.MkdirAll(\"conf\", 0775)\n+\tfilename := getFilenameFromRootName(rootname)\n+\n+\t//Generate record\n+\tthisRecord := Record{\n+\t\tProxyType:   ptype,\n+\t\tRootname:    rootname,\n+\t\tProxyTarget: proxyTarget,\n+\t\tUseTLS:      useTLS,\n+\t}\n+\n+\t//Write to file\n+\tjs, _ := json.MarshalIndent(thisRecord, \"\", \" \")\n+\treturn ioutil.WriteFile(filepath.Join(\"conf\", filename), js, 0775)\n+}\n+\n+func RemoveReverseProxyConfig(rootname string) error {\n+\tfilename := getFilenameFromRootName(rootname)\n+\tremovePendingFile := strings.ReplaceAll(filepath.Join(\"conf\", filename), \"\\\\\", \"/\")\n+\tlog.Println(\"Config Removed: \", removePendingFile)\n+\tif utils.FileExists(removePendingFile) {\n+\t\terr := os.Remove(removePendingFile)\n+\t\tif err != nil {\n+\t\t\tlog.Println(err.Error())\n+\t\t\treturn err\n+\t\t}\n+\t}\n+\n+\t//File already gone\n+\treturn nil\n+}\n+\n+// Return ptype, rootname and proxyTarget, error if any\n+func LoadReverseProxyConfig(filename string) (*Record, error) {\n+\tthisRecord := Record{}\n+\tconfigContent, err := ioutil.ReadFile(filename)\n+\tif err != nil {\n+\t\treturn &thisRecord, err\n+\t}\n+\n+\t//Unmarshal the content into config\n+\n+\terr = json.Unmarshal(configContent, &thisRecord)\n+\tif err != nil {\n+\t\treturn &thisRecord, err\n+\t}\n+\n+\t//Return it\n+\treturn &thisRecord, nil\n+}\n+\n+func getFilenameFromRootName(rootname string) string {\n+\t//Generate a filename for this rootname\n+\tfilename := strings.ReplaceAll(rootname, \".\", \"_\")\n+\tfilename = strings.ReplaceAll(filename, \"/\", \"-\")\n+\tfilename = filename + \".config\"\n+\treturn filename\n+}"
            },
            {
                "sha": "0921928ec0751fdf58f1839cee636759958e0629",
                "filename": "src/emails.go",
                "status": "added",
                "additions": 298,
                "deletions": 0,
                "changes": 298,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Femails.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Femails.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Femails.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,298 @@\n+package main\n+\n+import (\n+\t\"bytes\"\n+\t\"encoding/gob\"\n+\t\"encoding/json\"\n+\t\"net/http\"\n+\t\"strconv\"\n+\t\"strings\"\n+\t\"time\"\n+\n+\tuuid \"github.com/satori/go.uuid\"\n+\t\"imuslab.com/zoraxy/mod/email\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+/*\n+\tSMTP Settings and Test Email Handlers\n+*/\n+\n+func HandleSMTPSet(w http.ResponseWriter, r *http.Request) {\n+\thostname, err := utils.PostPara(r, \"hostname\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"hostname cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\tdomain, err := utils.PostPara(r, \"domain\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"domain cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\tportString, err := utils.PostPara(r, \"port\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"port must be a valid integer\")\n+\t\treturn\n+\t}\n+\n+\tport, err := strconv.Atoi(portString)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"port must be a valid integer\")\n+\t\treturn\n+\t}\n+\n+\tusername, err := utils.PostPara(r, \"username\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"username cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\tpassword, err := utils.PostPara(r, \"password\")\n+\tif err != nil {\n+\t\t//Empty password. Use old one if exists\n+\t\toldConfig := loadSMTPConfig()\n+\t\tif oldConfig.Password == \"\" {\n+\t\t\tutils.SendErrorResponse(w, \"password cannot be empty\")\n+\t\t\treturn\n+\t\t} else {\n+\t\t\tpassword = oldConfig.Password\n+\t\t}\n+\t}\n+\n+\tsenderAddr, err := utils.PostPara(r, \"senderAddr\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"senderAddr cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\tadminAddr, err := utils.PostPara(r, \"adminAddr\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"adminAddr cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\t//Set the email sender properties\n+\tthisEmailSender := email.Sender{\n+\t\tHostname:   strings.TrimSpace(hostname),\n+\t\tDomain:     strings.TrimSpace(domain),\n+\t\tPort:       port,\n+\t\tUsername:   strings.TrimSpace(username),\n+\t\tPassword:   strings.TrimSpace(password),\n+\t\tSenderAddr: strings.TrimSpace(senderAddr),\n+\t}\n+\n+\t//Write this into database\n+\tsetSMTPConfig(&thisEmailSender)\n+\n+\t//Update the current EmailSender\n+\tEmailSender = &thisEmailSender\n+\n+\t//Set the admin address of password reset\n+\tsetSMTPAdminAddress(adminAddr)\n+\n+\t//Reply ok\n+\tutils.SendOK(w)\n+}\n+\n+func HandleSMTPGet(w http.ResponseWriter, r *http.Request) {\n+\t// Create a buffer to store the encoded value\n+\tvar buf bytes.Buffer\n+\n+\t// Encode the original object into the buffer\n+\tencoder := gob.NewEncoder(&buf)\n+\terr := encoder.Encode(*EmailSender)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Internal encode error\")\n+\t\treturn\n+\t}\n+\n+\t// Decode the buffer into a new object\n+\tvar copied email.Sender\n+\tdecoder := gob.NewDecoder(&buf)\n+\terr = decoder.Decode(&copied)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Internal decode error\")\n+\t\treturn\n+\t}\n+\n+\tcopied.Password = \"\"\n+\n+\tjs, _ := json.Marshal(copied)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func HandleAdminEmailGet(w http.ResponseWriter, r *http.Request) {\n+\tjs, _ := json.Marshal(loadSMTPAdminAddr())\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func HandleTestEmailSend(w http.ResponseWriter, r *http.Request) {\n+\tadminEmailAccount := loadSMTPAdminAddr()\n+\tif adminEmailAccount == \"\" {\n+\t\tutils.SendErrorResponse(w, \"Management account not set\")\n+\t\treturn\n+\t}\n+\n+\terr := EmailSender.SendEmail(adminEmailAccount,\n+\t\t\"SMTP Testing Email | Zoraxy\", \"This is a test email sent by Zoraxy. Please do not reply to this email.<br>Zoraxy \u304b\u3089\u306e\u30c6\u30b9\u30c8\u30e1\u30fc\u30eb\u3067\u3059\u3002\u3053\u306e\u30e1\u30fc\u30eb\u306b\u306f\u8fd4\u4fe1\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002<br>\u9019\u662f\u7531 Zoraxy \u767c\u9001\u7684\u6e2c\u8a66\u96fb\u5b50\u90f5\u4ef6\u3002\u8acb\u52ff\u56de\u8986\u6b64\u90f5\u4ef6\u3002<br>Ceci est un email de test envoy\u00e9 par Zoraxy. Merci de ne pas r\u00e9pondre \u00e0 cet email.<br>Dies ist eine Test-E-Mail, die von Zoraxy gesendet wurde. Bitte antworten Sie nicht auf diese E-Mail.\")\n+\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tutils.SendOK(w)\n+}\n+\n+/*\n+\tSMTP config\n+\n+\tThe following handle SMTP configs\n+*/\n+\n+func setSMTPConfig(config *email.Sender) error {\n+\treturn sysdb.Write(\"smtp\", \"config\", config)\n+}\n+\n+func loadSMTPConfig() *email.Sender {\n+\tif sysdb.KeyExists(\"smtp\", \"config\") {\n+\t\tthisEmailSender := email.Sender{\n+\t\t\tPort: 587,\n+\t\t}\n+\t\terr := sysdb.Read(\"smtp\", \"config\", &thisEmailSender)\n+\t\tif err != nil {\n+\t\t\treturn &email.Sender{\n+\t\t\t\tPort: 587,\n+\t\t\t}\n+\t\t}\n+\t\treturn &thisEmailSender\n+\t} else {\n+\t\t//Not set. Return an empty one\n+\t\treturn &email.Sender{\n+\t\t\tPort: 587,\n+\t\t}\n+\t}\n+}\n+\n+func setSMTPAdminAddress(adminAddr string) error {\n+\treturn sysdb.Write(\"smtp\", \"admin\", adminAddr)\n+}\n+\n+//Load SMTP admin address. Return empty string if not set\n+func loadSMTPAdminAddr() string {\n+\tadminAddr := \"\"\n+\tif sysdb.KeyExists(\"smtp\", \"admin\") {\n+\t\terr := sysdb.Read(\"smtp\", \"admin\", &adminAddr)\n+\t\tif err != nil {\n+\t\t\treturn \"\"\n+\t\t}\n+\t\treturn adminAddr\n+\t} else {\n+\t\treturn \"\"\n+\t}\n+}\n+\n+/*\n+\tAdmin Account Reset\n+*/\n+\n+var (\n+\taccountResetEmailDelay   int64  = 30      //Delay between each account reset email, default 30s\n+\ttokenValidDuration       int64  = 15 * 60 //Duration of the token, default 15 minutes\n+\tlastAccountResetEmail    int64  = 0       //Timestamp for last sent account reset email\n+\tpasswordResetAccessToken string = \"\"      //Access token for resetting password\n+)\n+\n+func HandleAdminAccountResetEmail(w http.ResponseWriter, r *http.Request) {\n+\tif EmailSender.Username == \"\" || EmailSender.Domain == \"\" {\n+\t\t//Reset account not setup\n+\t\tutils.SendErrorResponse(w, \"Reset account not setup.\")\n+\t\treturn\n+\t}\n+\n+\tif loadSMTPAdminAddr() == \"\" {\n+\t\tutils.SendErrorResponse(w, \"Reset account not setup.\")\n+\t}\n+\n+\t//Check if the delay expired\n+\tif lastAccountResetEmail+accountResetEmailDelay > time.Now().Unix() {\n+\t\t//Too frequent\n+\t\tutils.SendErrorResponse(w, \"You cannot send another account reset email in cooldown time\")\n+\t\treturn\n+\t}\n+\n+\tpasswordResetAccessToken = uuid.NewV4().String()\n+\n+\t//SMTP info exists. Send reset account email\n+\tlastAccountResetEmail = time.Now().Unix()\n+\tEmailSender.SendEmail(loadSMTPAdminAddr(), \"Management Account Reset | Zoraxy\",\n+\t\t\"Enter the following reset token to reset your password on your Zoraxy router.<br>\"+passwordResetAccessToken+\"<br><br> This is an automated generated email. DO NOT REPLY TO THIS EMAIL.\")\n+\n+\tutils.SendOK(w)\n+}\n+\n+func HandleNewPasswordSetup(w http.ResponseWriter, r *http.Request) {\n+\tif passwordResetAccessToken == \"\" {\n+\t\t//Not initiated\n+\t\tutils.SendErrorResponse(w, \"Invalid usage\")\n+\t\treturn\n+\t}\n+\n+\tusername, err := utils.PostPara(r, \"username\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Invalid username given\")\n+\t\treturn\n+\t}\n+\ttoken, err := utils.PostPara(r, \"token\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Invalid token given\")\n+\t\treturn\n+\t}\n+\tnewPassword, err := utils.PostPara(r, \"newpw\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Invalid new password given\")\n+\t\treturn\n+\t}\n+\n+\ttoken = strings.TrimSpace(token)\n+\tusername = strings.TrimSpace(username)\n+\n+\t//Validate the token\n+\tif token != passwordResetAccessToken {\n+\t\tutils.SendErrorResponse(w, \"Invalid Token\")\n+\t\treturn\n+\t}\n+\n+\t//Check if time expired\n+\tif lastAccountResetEmail+tokenValidDuration < time.Now().Unix() {\n+\t\t//Expired\n+\t\tutils.SendErrorResponse(w, \"Token expired\")\n+\t\treturn\n+\t}\n+\n+\t//Check if user exists\n+\tif !authAgent.UserExists(username) {\n+\t\t//Invalid admin account name\n+\t\tutils.SendErrorResponse(w, \"Invalid Username\")\n+\t\treturn\n+\t}\n+\n+\t//Delete the user account\n+\tauthAgent.UnregisterUser(username)\n+\n+\t//Ok. Set the new password\n+\terr = authAgent.CreateUserAccount(username, newPassword, \"\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tutils.SendOK(w)\n+}"
            },
            {
                "sha": "ed3f0bdd33975174501366ebc9036b7924abc7c5",
                "filename": "src/geoip.go",
                "status": "added",
                "additions": 39,
                "deletions": 0,
                "changes": 39,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fgeoip.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fgeoip.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fgeoip.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,39 @@\n+package main\n+\n+import (\n+\t\"net\"\n+\t\"net/http\"\n+\t\"strings\"\n+\n+\t\"github.com/oschwald/geoip2-golang\"\n+)\n+\n+func getCountryCodeFromRequest(r *http.Request) string {\n+\tcountryCode := \"\"\n+\n+\t// Get the IP address of the user from the request headers\n+\tipAddress := r.Header.Get(\"X-Forwarded-For\")\n+\tif ipAddress == \"\" {\n+\t\tipAddress = strings.Split(r.RemoteAddr, \":\")[0]\n+\t}\n+\n+\t// Open the GeoIP database\n+\tdb, err := geoip2.Open(\"./tmp/GeoIP2-Country.mmdb\")\n+\tif err != nil {\n+\t\t// Handle the error\n+\t\treturn countryCode\n+\t}\n+\tdefer db.Close()\n+\n+\t// Look up the country code for the IP address\n+\trecord, err := db.Country(net.ParseIP(ipAddress))\n+\tif err != nil {\n+\t\t// Handle the error\n+\t\treturn countryCode\n+\t}\n+\n+\t// Get the ISO country code from the record\n+\tcountryCode = record.Country.IsoCode\n+\n+\treturn countryCode\n+}"
            },
            {
                "sha": "caa94d1768e3815b6c3c3f5790d216947e113a12",
                "filename": "src/go.mod",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fgo.mod",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fgo.mod",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fgo.mod?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,16 @@\n+module imuslab.com/zoraxy\n+\n+go 1.16\n+\n+require (\n+\tgithub.com/boltdb/bolt v1.3.1\n+\tgithub.com/go-ping/ping v1.1.0\n+\tgithub.com/google/uuid v1.3.0\n+\tgithub.com/gorilla/sessions v1.2.1\n+\tgithub.com/gorilla/websocket v1.4.2\n+\tgithub.com/grandcat/zeroconf v1.0.0\n+\tgithub.com/oschwald/geoip2-golang v1.8.0\n+\tgithub.com/satori/go.uuid v1.2.0\n+\tgolang.org/x/net v0.9.0 // indirect\n+\tgolang.org/x/sys v0.7.0\n+)"
            },
            {
                "sha": "503ee37167234edcff5abeac7c560afc202cf2f2",
                "filename": "src/go.sum",
                "status": "added",
                "additions": 94,
                "deletions": 0,
                "changes": 94,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fgo.sum",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fgo.sum",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fgo.sum?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,94 @@\n+github.com/boltdb/bolt v1.3.1 h1:JQmyP4ZBrce+ZQu0dY660FMfatumYDLun9hBCUVIkF4=\n+github.com/boltdb/bolt v1.3.1/go.mod h1:clJnj/oiGkjum5o1McbSZDSLxVThjynRyGBgiAx27Ps=\n+github.com/cenkalti/backoff v2.2.1+incompatible h1:tNowT99t7UNflLxfYYSlKYsBpXdEet03Pg2g16Swow4=\n+github.com/cenkalti/backoff v2.2.1+incompatible/go.mod h1:90ReRw6GdpyfrHakVjL/QHaoyV4aDUVVkXQJJJ3NXXM=\n+github.com/davecgh/go-spew v1.1.0/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=\n+github.com/davecgh/go-spew v1.1.1 h1:vj9j/u1bqnvCEfJOwUhtlOARqs3+rkHYY13jYWTU97c=\n+github.com/davecgh/go-spew v1.1.1/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=\n+github.com/go-ping/ping v1.1.0 h1:3MCGhVX4fyEUuhsfwPrsEdQw6xspHkv5zHsiSoDFZYw=\n+github.com/go-ping/ping v1.1.0/go.mod h1:xIFjORFzTxqIV/tDVGO4eDy/bLuSyawEeojSm3GfRGk=\n+github.com/google/uuid v1.2.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=\n+github.com/google/uuid v1.3.0 h1:t6JiXgmwXMjEs8VusXIJk2BXHsn+wx8BZdTaoZ5fu7I=\n+github.com/google/uuid v1.3.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=\n+github.com/gorilla/securecookie v1.1.1 h1:miw7JPhV+b/lAHSXz4qd/nN9jRiAFV5FwjeKyCS8BvQ=\n+github.com/gorilla/securecookie v1.1.1/go.mod h1:ra0sb63/xPlUeL+yeDciTfxMRAA+MP+HVt/4epWDjd4=\n+github.com/gorilla/sessions v1.2.1 h1:DHd3rPN5lE3Ts3D8rKkQ8x/0kqfeNmBAaiSi+o7FsgI=\n+github.com/gorilla/sessions v1.2.1/go.mod h1:dk2InVEVJ0sfLlnXv9EAgkf6ecYs/i80K/zI+bUmuGM=\n+github.com/gorilla/websocket v1.4.2 h1:+/TMaTYc4QFitKJxsQ7Yye35DkWvkdLcvGKqM+x0Ufc=\n+github.com/gorilla/websocket v1.4.2/go.mod h1:YR8l580nyteQvAITg2hZ9XVh4b55+EU/adAjf1fMHhE=\n+github.com/grandcat/zeroconf v1.0.0 h1:uHhahLBKqwWBV6WZUDAT71044vwOTL+McW0mBJvo6kE=\n+github.com/grandcat/zeroconf v1.0.0/go.mod h1:lTKmG1zh86XyCoUeIHSA4FJMBwCJiQmGfcP2PdzytEs=\n+github.com/miekg/dns v1.1.27 h1:aEH/kqUzUxGJ/UHcEKdJY+ugH6WEzsEBBSPa8zuy1aM=\n+github.com/miekg/dns v1.1.27/go.mod h1:KNUDUusw/aVsxyTYZM1oqvCicbwhgbNgztCETuNZ7xM=\n+github.com/oschwald/geoip2-golang v1.8.0 h1:KfjYB8ojCEn/QLqsDU0AzrJ3R5Qa9vFlx3z6SLNcKTs=\n+github.com/oschwald/geoip2-golang v1.8.0/go.mod h1:R7bRvYjOeaoenAp9sKRS8GX5bJWcZ0laWO5+DauEktw=\n+github.com/oschwald/maxminddb-golang v1.10.0 h1:Xp1u0ZhqkSuopaKmk1WwHtjF0H9Hd9181uj2MQ5Vndg=\n+github.com/oschwald/maxminddb-golang v1.10.0/go.mod h1:Y2ELenReaLAZ0b400URyGwvYxHV1dLIxBuyOsyYjHK0=\n+github.com/pkg/errors v0.9.1 h1:FEBLx1zS214owpjy7qsBeixbURkuhQAwrK5UwLGTwt4=\n+github.com/pkg/errors v0.9.1/go.mod h1:bwawxfHBFNV+L2hUp1rHADufV3IMtnDRdf1r5NINEl0=\n+github.com/pmezard/go-difflib v1.0.0 h1:4DBwDE0NGyQoBHbLQYPwSUPoCMWR5BEzIk/f1lZbAQM=\n+github.com/pmezard/go-difflib v1.0.0/go.mod h1:iKH77koFhYxTK1pcRnkKkqfTogsbg7gZNVY4sRDYZ/4=\n+github.com/satori/go.uuid v1.2.0 h1:0uYX9dsZ2yD7q2RtLRtPSdGDWzjeM3TbMJP9utgA0ww=\n+github.com/satori/go.uuid v1.2.0/go.mod h1:dA0hQrYB0VpLJoorglMZABFdXlWrHn1NEOzdhQKdks0=\n+github.com/stretchr/objx v0.1.0/go.mod h1:HFkY916IF+rwdDfMAkV7OtwuqBVzrE8GR6GFx+wExME=\n+github.com/stretchr/objx v0.4.0/go.mod h1:YvHI0jy2hoMjB+UWwv71VJQ9isScKT/TqJzVSSt89Yw=\n+github.com/stretchr/testify v1.7.1/go.mod h1:6Fq8oRcR53rry900zMqJjRRixrwX3KX962/h/Wwjteg=\n+github.com/stretchr/testify v1.7.3/go.mod h1:yNjHg4UonilssWZ8iaSj1OCr/vHnekPRkoO+kdMU+MU=\n+github.com/stretchr/testify v1.8.0 h1:pSgiaMZlXftHpm5L7V1+rVB+AZJydKsMxsQBIJw4PKk=\n+github.com/stretchr/testify v1.8.0/go.mod h1:yNjHg4UonilssWZ8iaSj1OCr/vHnekPRkoO+kdMU+MU=\n+github.com/yuin/goldmark v1.4.13/go.mod h1:6yULJ656Px+3vBD8DxQVa3kxgyrAnzto9xy5taEt/CY=\n+golang.org/x/crypto v0.0.0-20190308221718-c2843e01d9a2/go.mod h1:djNgcEr1/C05ACkg1iLfiJU5Ep61QUkGW8qpdssI0+w=\n+golang.org/x/crypto v0.0.0-20191011191535-87dc89f01550/go.mod h1:yigFU9vqHzYiE8UmvKecakEJjdnWj3jj499lnFckfCI=\n+golang.org/x/crypto v0.0.0-20210921155107-089bfa567519 h1:7I4JAnoQBe7ZtJcBaYHi5UtiO8tQHbUSXxL+pnGRANg=\n+golang.org/x/crypto v0.0.0-20210921155107-089bfa567519/go.mod h1:GvvjBRRGRdwPK5ydBHafDWAxML/pGHZbMvKqRZ5+Abc=\n+golang.org/x/mod v0.1.1-0.20191105210325-c90efee705ee/go.mod h1:QqPTAvyqsEbceGzBzNggFXnrqF1CaUcvgkdR5Ot7KZg=\n+golang.org/x/mod v0.6.0-dev.0.20220419223038-86c51ed26bb4/go.mod h1:jJ57K6gSWd91VN4djpZkiMVwK6gcyfeH4XE8wZrZaV4=\n+golang.org/x/mod v0.8.0/go.mod h1:iBbtSCu2XBx23ZKBPSOrRkjjQPZFPuis4dIYUhu/chs=\n+golang.org/x/net v0.0.0-20190404232315-eb5bcb51f2a3/go.mod h1:t9HGtf8HONx5eT2rtn7q6eTqICYqUVnKs3thJo3Qplg=\n+golang.org/x/net v0.0.0-20190620200207-3b0461eec859/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n+golang.org/x/net v0.0.0-20190923162816-aa69164e4478/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n+golang.org/x/net v0.0.0-20200114155413-6afb5195e5aa/go.mod h1:z5CRVTTTmAJ677TzLLGU+0bjPO0LkuOLi4/5GtJWs/s=\n+golang.org/x/net v0.0.0-20210226172049-e18ecbb05110/go.mod h1:m0MpNAwzfU5UDzcl9v0D8zg8gWTRqZa9RBIspLL5mdg=\n+golang.org/x/net v0.0.0-20210316092652-d523dce5a7f4/go.mod h1:RBQZq4jEuRlivfhVLdyRGr576XBO4/greRjx4P4O3yc=\n+golang.org/x/net v0.0.0-20220722155237-a158d28d115b/go.mod h1:XRhObCWvk6IyKnWLug+ECip1KBveYUHfp+8e9klMJ9c=\n+golang.org/x/net v0.6.0/go.mod h1:2Tu9+aMcznHK/AK1HMvgo6xiTLG5rD5rZLDS+rp2Bjs=\n+golang.org/x/net v0.9.0 h1:aWJ/m6xSmxWBx+V0XRHTlrYrPG56jKsLdTFmsSsCzOM=\n+golang.org/x/net v0.9.0/go.mod h1:d48xBJpPfHeWQsugry2m+kC02ZBRGRgulfHnEXEuWns=\n+golang.org/x/sync v0.0.0-20190423024810-112230192c58/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n+golang.org/x/sync v0.0.0-20210220032951-036812b2e83c/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n+golang.org/x/sync v0.0.0-20220722155255-886fb9371eb4/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n+golang.org/x/sync v0.1.0 h1:wsuoTGHzEhffawBOhz5CYhcrV4IdKZbEyZjBMuTp12o=\n+golang.org/x/sync v0.1.0/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n+golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n+golang.org/x/sys v0.0.0-20190412213103-97732733099d/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n+golang.org/x/sys v0.0.0-20190924154521-2837fb4f24fe/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n+golang.org/x/sys v0.0.0-20201119102817-f84b799fce68/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n+golang.org/x/sys v0.0.0-20210315160823-c6e025ad8005/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n+golang.org/x/sys v0.0.0-20210615035016-665e8c7367d1/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n+golang.org/x/sys v0.0.0-20220520151302-bc2c85ada10a/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n+golang.org/x/sys v0.0.0-20220722155257-8c9f86f7a55f/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n+golang.org/x/sys v0.0.0-20220804214406-8e32c043e418/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n+golang.org/x/sys v0.5.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n+golang.org/x/sys v0.7.0 h1:3jlCCIQZPdOYu1h8BkNvLz8Kgwtae2cagcG/VamtZRU=\n+golang.org/x/sys v0.7.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n+golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=\n+golang.org/x/term v0.0.0-20210927222741-03fcf44c2211/go.mod h1:jbD1KX2456YbFQfuXm/mYQcufACuNUgVhRMnK/tPxf8=\n+golang.org/x/term v0.5.0/go.mod h1:jMB1sMXY+tzblOD4FWmEbocvup2/aLOaQEp7JmGp78k=\n+golang.org/x/term v0.7.0/go.mod h1:P32HKFT3hSsZrRxla30E9HqToFYAQPCMs/zFMBUFqPY=\n+golang.org/x/text v0.3.0/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=\n+golang.org/x/text v0.3.3/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=\n+golang.org/x/text v0.3.7/go.mod h1:u+2+/6zg+i71rQMx5EYifcz6MCKuco9NR6JIITiCfzQ=\n+golang.org/x/text v0.7.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=\n+golang.org/x/text v0.9.0/go.mod h1:e1OnstbJyHTd6l/uOt8jFFHp6TRDWZR/bV3emEE/zU8=\n+golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=\n+golang.org/x/tools v0.0.0-20191119224855-298f0cb1881e/go.mod h1:b+2E5dAYhXwXZwtnZ6UAqBI28+e2cm9otk0dWdXHAEo=\n+golang.org/x/tools v0.0.0-20191216052735-49a3e744a425/go.mod h1:TB2adYChydJhpapKDTa4BR/hXlZSLoq2Wpct/0txZ28=\n+golang.org/x/tools v0.1.12/go.mod h1:hNGJHUnrk76NpqgfD5Aqm5Crs+Hm0VOH/i9J2+nxYbc=\n+golang.org/x/tools v0.6.0/go.mod h1:Xwgl3UAJ/d3gWutnCtw505GrjyAbvKui8lOU390QaIU=\n+golang.org/x/xerrors v0.0.0-20190717185122-a985d3407aa7/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=\n+golang.org/x/xerrors v0.0.0-20191011141410-1b5146add898/go.mod h1:I/5z698sn9Ka8TeJc9MKroUUfqBBauWjQqLJ2OPfmY0=\n+gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405 h1:yhCVgyC4o1eVCa2tZl7eS0r+SDo693bJlVdllGtEeKM=\n+gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=\n+gopkg.in/yaml.v3 v3.0.0-20200313102051-9f266ea9e77c/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM=\n+gopkg.in/yaml.v3 v3.0.1 h1:fxVm/GzAzEWqLHuvctI91KS9hhNmmWOoWu0XTYJS7CA=\n+gopkg.in/yaml.v3 v3.0.1/go.mod h1:K4uyk7z7BCEPqu6E+C64Yfv1cQ7kz7rIZviUmN+EgEM="
            },
            {
                "sha": "f95bcf869fdecd9702d3ba62feb758a1cfb2a26e",
                "filename": "src/main.go",
                "status": "added",
                "additions": 158,
                "deletions": 0,
                "changes": 158,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmain.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmain.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmain.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,158 @@\n+package main\n+\n+import (\n+\t\"embed\"\n+\t\"flag\"\n+\t\"fmt\"\n+\t\"log\"\n+\t\"net/http\"\n+\t\"os\"\n+\t\"os/signal\"\n+\t\"syscall\"\n+\t\"time\"\n+\n+\t\"github.com/google/uuid\"\n+\t\"imuslab.com/zoraxy/mod/aroz\"\n+\t\"imuslab.com/zoraxy/mod/auth\"\n+\t\"imuslab.com/zoraxy/mod/database\"\n+\t\"imuslab.com/zoraxy/mod/dynamicproxy/redirection\"\n+\t\"imuslab.com/zoraxy/mod/email\"\n+\t\"imuslab.com/zoraxy/mod/ganserv\"\n+\t\"imuslab.com/zoraxy/mod/geodb\"\n+\t\"imuslab.com/zoraxy/mod/mdns\"\n+\t\"imuslab.com/zoraxy/mod/netstat\"\n+\t\"imuslab.com/zoraxy/mod/sshprox\"\n+\t\"imuslab.com/zoraxy/mod/statistic\"\n+\t\"imuslab.com/zoraxy/mod/statistic/analytic\"\n+\t\"imuslab.com/zoraxy/mod/tcpprox\"\n+\t\"imuslab.com/zoraxy/mod/tlscert\"\n+\t\"imuslab.com/zoraxy/mod/uptime\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+// General flags\n+var noauth = flag.Bool(\"noauth\", false, \"Disable authentication for management interface\")\n+var showver = flag.Bool(\"version\", false, \"Show version of this server\")\n+var allowSshLoopback = flag.Bool(\"sshlb\", false, \"Allow loopback web ssh connection (DANGER)\")\n+var ztAuthToken = flag.String(\"ztauth\", \"\", \"ZeroTier authtoken for the local node\")\n+var ztAPIPort = flag.Int(\"ztport\", 9993, \"ZeroTier controller API port\")\n+var (\n+\tname        = \"Zoraxy\"\n+\tversion     = \"2.5\"\n+\tnodeUUID    = \"generic\"\n+\tdevelopment = false //Set this to false to use embedded web fs\n+\n+\t/*\n+\t\tBinary Embedding File System\n+\t*/\n+\t//go:embed web/*\n+\twebres embed.FS\n+\n+\t/*\n+\t\tHandler Modules\n+\t*/\n+\thandler            *aroz.ArozHandler       //Handle arozos managed permission system\n+\tsysdb              *database.Database      //System database\n+\tauthAgent          *auth.AuthAgent         //Authentication agent\n+\ttlsCertManager     *tlscert.Manager        //TLS / SSL management\n+\tredirectTable      *redirection.RuleTable  //Handle special redirection rule sets\n+\tgeodbStore         *geodb.Store            //GeoIP database\n+\tnetstatBuffers     *netstat.NetStatBuffers //Realtime graph buffers\n+\tstatisticCollector *statistic.Collector    //Collecting statistic from visitors\n+\tuptimeMonitor      *uptime.Monitor         //Uptime monitor service worker\n+\tmdnsScanner        *mdns.MDNSHost          //mDNS discovery services\n+\tganManager         *ganserv.NetworkManager //Global Area Network Manager\n+\twebSshManager      *sshprox.Manager        //Web SSH connection service\n+\ttcpProxyManager    *tcpprox.Manager        //TCP Proxy Manager\n+\n+\t//Helper modules\n+\tEmailSender    *email.Sender        //Email sender that handle email sending\n+\tAnalyticLoader *analytic.DataLoader //Data loader for Zoraxy Analytic\n+)\n+\n+// Kill signal handler. Do something before the system the core terminate.\n+func SetupCloseHandler() {\n+\tc := make(chan os.Signal, 2)\n+\tsignal.Notify(c, os.Interrupt, syscall.SIGTERM)\n+\tgo func() {\n+\t\t<-c\n+\t\tfmt.Println(\"- Shutting down \" + name)\n+\t\tfmt.Println(\"- Closing GeoDB \")\n+\t\tgeodbStore.Close()\n+\t\tfmt.Println(\"- Closing Netstats Listener\")\n+\t\tnetstatBuffers.Close()\n+\t\tfmt.Println(\"- Closing Statistic Collector\")\n+\t\tstatisticCollector.Close()\n+\t\tfmt.Println(\"- Stopping mDNS Discoverer\")\n+\t\t//Stop the mdns service\n+\t\tmdnsTickerStop <- true\n+\t\tmdnsScanner.Close()\n+\n+\t\t//Remove the tmp folder\n+\t\tfmt.Println(\"- Cleaning up tmp files\")\n+\t\tos.RemoveAll(\"./tmp\")\n+\n+\t\t//Close database, final\n+\t\tfmt.Println(\"- Stopping system database\")\n+\t\tsysdb.Close()\n+\t\tos.Exit(0)\n+\t}()\n+}\n+\n+func main() {\n+\t//Start the aoModule pipeline (which will parse the flags as well). Pass in the module launch information\n+\thandler = aroz.HandleFlagParse(aroz.ServiceInfo{\n+\t\tName:        name,\n+\t\tDesc:        \"Dynamic Reverse Proxy Server\",\n+\t\tGroup:       \"Network\",\n+\t\tIconPath:    \"zoraxy/img/small_icon.png\",\n+\t\tVersion:     version,\n+\t\tStartDir:    \"zoraxy/index.html\",\n+\t\tSupportFW:   true,\n+\t\tLaunchFWDir: \"zoraxy/index.html\",\n+\t\tSupportEmb:  false,\n+\t\tInitFWSize:  []int{1080, 580},\n+\t})\n+\n+\tif *showver {\n+\t\tfmt.Println(name + \" - Version \" + version)\n+\t\tos.Exit(0)\n+\t}\n+\n+\tSetupCloseHandler()\n+\n+\t//Read or create the system uuid\n+\tuuidRecord := \"./sys.uuid\"\n+\tif !utils.FileExists(uuidRecord) {\n+\t\tnewSystemUUID := uuid.New().String()\n+\t\tos.WriteFile(uuidRecord, []byte(newSystemUUID), 0775)\n+\t}\n+\tuuidBytes, err := os.ReadFile(uuidRecord)\n+\tif err != nil {\n+\t\tlog.Println(\"Unable to read system uuid from file system\")\n+\t\tpanic(err)\n+\t}\n+\tnodeUUID = string(uuidBytes)\n+\n+\t//Startup all modules\n+\tstartupSequence()\n+\n+\t//Initiate management interface APIs\n+\trequireAuth = !(*noauth || handler.IsUsingExternalPermissionManager())\n+\tinitAPIs()\n+\n+\t//Start the reverse proxy server in go routine\n+\tgo func() {\n+\t\tReverseProxtInit()\n+\t}()\n+\n+\ttime.Sleep(500 * time.Millisecond)\n+\n+\tlog.Println(\"Zoraxy started. Visit control panel at http://localhost\" + handler.Port)\n+\terr = http.ListenAndServe(handler.Port, nil)\n+\n+\tif err != nil {\n+\t\tlog.Fatal(err)\n+\t}\n+\n+}"
            },
            {
                "sha": "2296b7b88b0fd194353db72fac3827f2b4a29f14",
                "filename": "src/mod/aroz/aroz.go",
                "status": "added",
                "additions": 76,
                "deletions": 0,
                "changes": 76,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Faroz%2Faroz.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Faroz%2Faroz.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Faroz%2Faroz.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,76 @@\n+package aroz\n+\n+import (\n+\t\"encoding/json\"\n+\t\"flag\"\n+\t\"fmt\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\t\"os\"\n+)\n+\n+//To be used with arozos system\n+type ArozHandler struct {\n+\tPort            string\n+\trestfulEndpoint string\n+}\n+\n+//Information required for registering this subservice to arozos\n+type ServiceInfo struct {\n+\tName         string   //Name of this module. e.g. \"Audio\"\n+\tDesc         string   //Description for this module\n+\tGroup        string   //Group of the module, e.g. \"system\" / \"media\" etc\n+\tIconPath     string   //Module icon image path e.g. \"Audio/img/function_icon.png\"\n+\tVersion      string   //Version of the module. Format: [0-9]*.[0-9][0-9].[0-9]\n+\tStartDir     string   //Default starting dir, e.g. \"Audio/index.html\"\n+\tSupportFW    bool     //Support floatWindow. If yes, floatWindow dir will be loaded\n+\tLaunchFWDir  string   //This link will be launched instead of 'StartDir' if fw mode\n+\tSupportEmb   bool     //Support embedded mode\n+\tLaunchEmb    string   //This link will be launched instead of StartDir / Fw if a file is opened with this module\n+\tInitFWSize   []int    //Floatwindow init size. [0] => Width, [1] => Height\n+\tInitEmbSize  []int    //Embedded mode init size. [0] => Width, [1] => Height\n+\tSupportedExt []string //Supported File Extensions. e.g. \".mp3\", \".flac\", \".wav\"\n+}\n+\n+//This function will request the required flag from the startup paramters and parse it to the need of the arozos.\n+func HandleFlagParse(info ServiceInfo) *ArozHandler {\n+\tvar infoRequestMode = flag.Bool(\"info\", false, \"Show information about this program in JSON\")\n+\tvar port = flag.String(\"port\", \":8000\", \"Management web interface listening port\")\n+\tvar restful = flag.String(\"rpt\", \"\", \"Reserved\")\n+\t//Parse the flags\n+\tflag.Parse()\n+\tif *infoRequestMode {\n+\t\t//Information request mode\n+\t\tjsonString, _ := json.MarshalIndent(info, \"\", \" \")\n+\t\tfmt.Println(string(jsonString))\n+\t\tos.Exit(0)\n+\t}\n+\treturn &ArozHandler{\n+\t\tPort:            *port,\n+\t\trestfulEndpoint: *restful,\n+\t}\n+}\n+\n+//Get the username and resources access token from the request, return username, token\n+func (a *ArozHandler) GetUserInfoFromRequest(w http.ResponseWriter, r *http.Request) (string, string) {\n+\tusername := r.Header.Get(\"aouser\")\n+\ttoken := r.Header.Get(\"aotoken\")\n+\n+\treturn username, token\n+}\n+\n+func (a *ArozHandler) IsUsingExternalPermissionManager() bool {\n+\treturn !(a.restfulEndpoint == \"\")\n+}\n+\n+//Request gateway interface for advance permission sandbox control\n+func (a *ArozHandler) RequestGatewayInterface(token string, script string) (*http.Response, error) {\n+\tresp, err := http.PostForm(a.restfulEndpoint,\n+\t\turl.Values{\"token\": {token}, \"script\": {script}})\n+\tif err != nil {\n+\t\t// handle error\n+\t\treturn nil, err\n+\t}\n+\n+\treturn resp, nil\n+}"
            },
            {
                "sha": "346c5151c8722a2cddfe71d88441f60b23d062a7",
                "filename": "src/mod/aroz/doc.txt",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Faroz%2Fdoc.txt",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Faroz%2Fdoc.txt",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Faroz%2Fdoc.txt?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0"
            },
            {
                "sha": "46f42f907089e4517555e4e5aa86f91fc67048eb",
                "filename": "src/mod/auth/auth.go",
                "status": "added",
                "additions": 478,
                "deletions": 0,
                "changes": 478,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fauth%2Fauth.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fauth%2Fauth.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fauth%2Fauth.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,478 @@\n+package auth\n+\n+/*\n+\n+\tauthor: tobychui\n+*/\n+\n+import (\n+\t\"crypto/rand\"\n+\t\"crypto/sha512\"\n+\t\"errors\"\n+\t\"net/http\"\n+\t\"net/mail\"\n+\t\"strings\"\n+\n+\t\"encoding/hex\"\n+\t\"log\"\n+\n+\t\"github.com/gorilla/sessions\"\n+\tdb \"imuslab.com/zoraxy/mod/database\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+type AuthAgent struct {\n+\t//Session related\n+\tSessionName             string\n+\tSessionStore            *sessions.CookieStore\n+\tDatabase                *db.Database\n+\tLoginRedirectionHandler func(http.ResponseWriter, *http.Request)\n+}\n+\n+type AuthEndpoints struct {\n+\tLogin         string\n+\tLogout        string\n+\tRegister      string\n+\tCheckLoggedIn string\n+\tAutologin     string\n+}\n+\n+//Constructor\n+func NewAuthenticationAgent(sessionName string, key []byte, sysdb *db.Database, allowReg bool, loginRedirectionHandler func(http.ResponseWriter, *http.Request)) *AuthAgent {\n+\tstore := sessions.NewCookieStore(key)\n+\terr := sysdb.NewTable(\"auth\")\n+\tif err != nil {\n+\t\tlog.Println(\"Failed to create auth database. Terminating.\")\n+\t\tpanic(err)\n+\t}\n+\n+\t//Create a new AuthAgent object\n+\tnewAuthAgent := AuthAgent{\n+\t\tSessionName:             sessionName,\n+\t\tSessionStore:            store,\n+\t\tDatabase:                sysdb,\n+\t\tLoginRedirectionHandler: loginRedirectionHandler,\n+\t}\n+\n+\t//Return the authAgent\n+\treturn &newAuthAgent\n+}\n+\n+func GetSessionKey(sysdb *db.Database) (string, error) {\n+\tsysdb.NewTable(\"auth\")\n+\tsessionKey := \"\"\n+\tif !sysdb.KeyExists(\"auth\", \"sessionkey\") {\n+\t\tkey := make([]byte, 32)\n+\t\trand.Read(key)\n+\t\tsessionKey = string(key)\n+\t\tsysdb.Write(\"auth\", \"sessionkey\", sessionKey)\n+\t\tlog.Println(\"[Auth] New authentication session key generated\")\n+\t} else {\n+\t\tlog.Println(\"[Auth] Authentication session key loaded from database\")\n+\t\terr := sysdb.Read(\"auth\", \"sessionkey\", &sessionKey)\n+\t\tif err != nil {\n+\t\t\treturn \"\", errors.New(\"database read error. Is the database file corrupted?\")\n+\t\t}\n+\t}\n+\treturn sessionKey, nil\n+}\n+\n+//This function will handle an http request and redirect to the given login address if not logged in\n+func (a *AuthAgent) HandleCheckAuth(w http.ResponseWriter, r *http.Request, handler func(http.ResponseWriter, *http.Request)) {\n+\tif a.CheckAuth(r) {\n+\t\t//User already logged in\n+\t\thandler(w, r)\n+\t} else {\n+\t\t//User not logged in\n+\t\ta.LoginRedirectionHandler(w, r)\n+\t}\n+}\n+\n+//Handle login request, require POST username and password\n+func (a *AuthAgent) HandleLogin(w http.ResponseWriter, r *http.Request) {\n+\n+\t//Get username from request using POST mode\n+\tusername, err := utils.PostPara(r, \"username\")\n+\tif err != nil {\n+\t\t//Username not defined\n+\t\tlog.Println(\"[Auth] \" + r.RemoteAddr + \" trying to login with username: \" + username)\n+\t\tutils.SendErrorResponse(w, \"Username not defined or empty.\")\n+\t\treturn\n+\t}\n+\n+\t//Get password from request using POST mode\n+\tpassword, err := utils.PostPara(r, \"password\")\n+\tif err != nil {\n+\t\t//Password not defined\n+\t\tutils.SendErrorResponse(w, \"Password not defined or empty.\")\n+\t\treturn\n+\t}\n+\n+\t//Get rememberme settings\n+\trememberme := false\n+\trmbme, _ := utils.PostPara(r, \"rmbme\")\n+\tif rmbme == \"true\" {\n+\t\trememberme = true\n+\t}\n+\n+\t//Check the database and see if this user is in the database\n+\tpasswordCorrect, rejectionReason := a.ValidateUsernameAndPasswordWithReason(username, password)\n+\t//The database contain this user information. Check its password if it is correct\n+\tif passwordCorrect {\n+\t\t//Password correct\n+\t\t// Set user as authenticated\n+\t\ta.LoginUserByRequest(w, r, username, rememberme)\n+\n+\t\t//Print the login message to console\n+\t\tlog.Println(username + \" logged in.\")\n+\t\tutils.SendOK(w)\n+\t} else {\n+\t\t//Password incorrect\n+\t\tlog.Println(username + \" login request rejected: \" + rejectionReason)\n+\n+\t\tutils.SendErrorResponse(w, rejectionReason)\n+\t\treturn\n+\t}\n+}\n+\n+func (a *AuthAgent) ValidateUsernameAndPassword(username string, password string) bool {\n+\tsucc, _ := a.ValidateUsernameAndPasswordWithReason(username, password)\n+\treturn succ\n+}\n+\n+//validate the username and password, return reasons if the auth failed\n+func (a *AuthAgent) ValidateUsernameAndPasswordWithReason(username string, password string) (bool, string) {\n+\thashedPassword := Hash(password)\n+\tvar passwordInDB string\n+\terr := a.Database.Read(\"auth\", \"passhash/\"+username, &passwordInDB)\n+\tif err != nil {\n+\t\t//User not found or db exception\n+\t\tlog.Println(\"[Auth] \" + username + \" login with incorrect password\")\n+\t\treturn false, \"Invalid username or password\"\n+\t}\n+\n+\tif passwordInDB == hashedPassword {\n+\t\treturn true, \"\"\n+\t} else {\n+\t\treturn false, \"Invalid username or password\"\n+\t}\n+}\n+\n+//Login the user by creating a valid session for this user\n+func (a *AuthAgent) LoginUserByRequest(w http.ResponseWriter, r *http.Request, username string, rememberme bool) {\n+\tsession, _ := a.SessionStore.Get(r, a.SessionName)\n+\n+\tsession.Values[\"authenticated\"] = true\n+\tsession.Values[\"username\"] = username\n+\tsession.Values[\"rememberMe\"] = rememberme\n+\n+\t//Check if remember me is clicked. If yes, set the maxage to 1 week.\n+\tif rememberme {\n+\t\tsession.Options = &sessions.Options{\n+\t\t\tMaxAge: 3600 * 24 * 7, //One week\n+\t\t\tPath:   \"/\",\n+\t\t}\n+\t} else {\n+\t\tsession.Options = &sessions.Options{\n+\t\t\tMaxAge: 3600 * 1, //One hour\n+\t\t\tPath:   \"/\",\n+\t\t}\n+\t}\n+\tsession.Save(r, w)\n+}\n+\n+//Handle logout, reply OK after logged out. WILL NOT DO REDIRECTION\n+func (a *AuthAgent) HandleLogout(w http.ResponseWriter, r *http.Request) {\n+\tusername, err := a.GetUserName(w, r)\n+\tif username != \"\" {\n+\t\tlog.Println(username + \" logged out.\")\n+\t}\n+\t// Revoke users authentication\n+\terr = a.Logout(w, r)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Logout failed\")\n+\t\treturn\n+\t}\n+\n+\tw.Write([]byte(\"OK\"))\n+}\n+\n+func (a *AuthAgent) Logout(w http.ResponseWriter, r *http.Request) error {\n+\tsession, err := a.SessionStore.Get(r, a.SessionName)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tsession.Values[\"authenticated\"] = false\n+\tsession.Values[\"username\"] = nil\n+\tsession.Save(r, w)\n+\treturn nil\n+}\n+\n+//Get the current session username from request\n+func (a *AuthAgent) GetUserName(w http.ResponseWriter, r *http.Request) (string, error) {\n+\tif a.CheckAuth(r) {\n+\t\t//This user has logged in.\n+\t\tsession, _ := a.SessionStore.Get(r, a.SessionName)\n+\t\treturn session.Values[\"username\"].(string), nil\n+\t} else {\n+\t\t//This user has not logged in.\n+\t\treturn \"\", errors.New(\"user not logged in\")\n+\t}\n+}\n+\n+//Get the current session user email from request\n+func (a *AuthAgent) GetUserEmail(w http.ResponseWriter, r *http.Request) (string, error) {\n+\tif a.CheckAuth(r) {\n+\t\t//This user has logged in.\n+\t\tsession, _ := a.SessionStore.Get(r, a.SessionName)\n+\t\tusername := session.Values[\"username\"].(string)\n+\t\tuserEmail := \"\"\n+\t\terr := a.Database.Read(\"auth\", \"email/\"+username, &userEmail)\n+\t\tif err != nil {\n+\t\t\treturn \"\", err\n+\t\t}\n+\n+\t\treturn userEmail, nil\n+\t} else {\n+\t\t//This user has not logged in.\n+\t\treturn \"\", errors.New(\"user not logged in\")\n+\t}\n+}\n+\n+//Check if the user has logged in, return true / false in JSON\n+func (a *AuthAgent) CheckLogin(w http.ResponseWriter, r *http.Request) {\n+\tif a.CheckAuth(r) {\n+\t\tutils.SendJSONResponse(w, \"true\")\n+\t} else {\n+\t\tutils.SendJSONResponse(w, \"false\")\n+\t}\n+}\n+\n+//Handle new user register. Require POST username, password, group.\n+func (a *AuthAgent) HandleRegister(w http.ResponseWriter, r *http.Request, callback func(string, string)) {\n+\t//Get username from request\n+\tnewusername, err := utils.PostPara(r, \"username\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Missing 'username' paramter\")\n+\t\treturn\n+\t}\n+\n+\t//Get password from request\n+\tpassword, err := utils.PostPara(r, \"password\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Missing 'password' paramter\")\n+\t\treturn\n+\t}\n+\n+\t//Get email from request\n+\temail, err := utils.PostPara(r, \"email\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Missing 'email' paramter\")\n+\t\treturn\n+\t}\n+\n+\t_, err = mail.ParseAddress(email)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Invalid or malformed email\")\n+\t\treturn\n+\t}\n+\n+\t//Ok to proceed create this user\n+\terr = a.CreateUserAccount(newusername, password, email)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\t//Do callback if exists\n+\tif callback != nil {\n+\t\tcallback(newusername, email)\n+\t}\n+\n+\t//Return to the client with OK\n+\tutils.SendOK(w)\n+\tlog.Println(\"[Auth] New user \" + newusername + \" added to system.\")\n+}\n+\n+//Handle new user register without confirmation email. Require POST username, password, group.\n+func (a *AuthAgent) HandleRegisterWithoutEmail(w http.ResponseWriter, r *http.Request, callback func(string, string)) {\n+\t//Get username from request\n+\tnewusername, err := utils.PostPara(r, \"username\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Missing 'username' paramter\")\n+\t\treturn\n+\t}\n+\n+\t//Get password from request\n+\tpassword, err := utils.PostPara(r, \"password\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Missing 'password' paramter\")\n+\t\treturn\n+\t}\n+\n+\t//Ok to proceed create this user\n+\terr = a.CreateUserAccount(newusername, password, \"\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\t//Do callback if exists\n+\tif callback != nil {\n+\t\tcallback(newusername, \"\")\n+\t}\n+\n+\t//Return to the client with OK\n+\tutils.SendOK(w)\n+\tlog.Println(\"[Auth] Admin account created: \" + newusername)\n+}\n+\n+//Check authentication from request header's session value\n+func (a *AuthAgent) CheckAuth(r *http.Request) bool {\n+\tsession, err := a.SessionStore.Get(r, a.SessionName)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\t// Check if user is authenticated\n+\tif auth, ok := session.Values[\"authenticated\"].(bool); !ok || !auth {\n+\t\treturn false\n+\t}\n+\treturn true\n+}\n+\n+//Handle de-register of users. Require POST username.\n+//THIS FUNCTION WILL NOT CHECK FOR PERMISSION. PLEASE USE WITH PERMISSION HANDLER\n+func (a *AuthAgent) HandleUnregister(w http.ResponseWriter, r *http.Request) {\n+\t//Check if the user is logged in\n+\tif !a.CheckAuth(r) {\n+\t\t//This user has not logged in\n+\t\tutils.SendErrorResponse(w, \"Login required to remove user from the system.\")\n+\t\treturn\n+\t}\n+\n+\t//Get username from request\n+\tusername, err := utils.PostPara(r, \"username\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Missing 'username' paramter\")\n+\t\treturn\n+\t}\n+\n+\terr = a.UnregisterUser(username)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\t//Return to the client with OK\n+\tutils.SendOK(w)\n+\tlog.Println(\"[Auth] User \" + username + \" has been removed from the system.\")\n+}\n+\n+func (a *AuthAgent) UnregisterUser(username string) error {\n+\t//Check if the user exists in the system database.\n+\tif !a.Database.KeyExists(\"auth\", \"passhash/\"+username) {\n+\t\t//This user do not exists.\n+\t\treturn errors.New(\"this user does not exists\")\n+\t}\n+\n+\t//OK! Remove the user from the database\n+\ta.Database.Delete(\"auth\", \"passhash/\"+username)\n+\ta.Database.Delete(\"auth\", \"email/\"+username)\n+\treturn nil\n+}\n+\n+//Get the number of users in the system\n+func (a *AuthAgent) GetUserCounts() int {\n+\tentries, _ := a.Database.ListTable(\"auth\")\n+\tusercount := 0\n+\tfor _, keypairs := range entries {\n+\t\tif strings.Contains(string(keypairs[0]), \"passhash/\") {\n+\t\t\t//This is a user registry\n+\t\t\tusercount++\n+\t\t}\n+\t}\n+\n+\tif usercount == 0 {\n+\t\tlog.Println(\"There are no user in the database.\")\n+\t}\n+\treturn usercount\n+}\n+\n+//List all username within the system\n+func (a *AuthAgent) ListUsers() []string {\n+\tentries, _ := a.Database.ListTable(\"auth\")\n+\tresults := []string{}\n+\tfor _, keypairs := range entries {\n+\t\tif strings.Contains(string(keypairs[0]), \"passhash/\") {\n+\t\t\tusername := strings.Split(string(keypairs[0]), \"/\")[1]\n+\t\t\tresults = append(results, username)\n+\t\t}\n+\t}\n+\treturn results\n+}\n+\n+//Check if the given username exists\n+func (a *AuthAgent) UserExists(username string) bool {\n+\tuserpasswordhash := \"\"\n+\terr := a.Database.Read(\"auth\", \"passhash/\"+username, &userpasswordhash)\n+\tif err != nil || userpasswordhash == \"\" {\n+\t\treturn false\n+\t}\n+\treturn true\n+}\n+\n+//Update the session expire time given the request header.\n+func (a *AuthAgent) UpdateSessionExpireTime(w http.ResponseWriter, r *http.Request) bool {\n+\tsession, _ := a.SessionStore.Get(r, a.SessionName)\n+\tif session.Values[\"authenticated\"].(bool) {\n+\t\t//User authenticated. Extend its expire time\n+\t\trememberme := session.Values[\"rememberMe\"].(bool)\n+\t\t//Extend the session expire time\n+\t\tif rememberme {\n+\t\t\tsession.Options = &sessions.Options{\n+\t\t\t\tMaxAge: 3600 * 24 * 7, //One week\n+\t\t\t\tPath:   \"/\",\n+\t\t\t}\n+\t\t} else {\n+\t\t\tsession.Options = &sessions.Options{\n+\t\t\t\tMaxAge: 3600 * 1, //One hour\n+\t\t\t\tPath:   \"/\",\n+\t\t\t}\n+\t\t}\n+\t\tsession.Save(r, w)\n+\t\treturn true\n+\t} else {\n+\t\treturn false\n+\t}\n+}\n+\n+//Create user account\n+func (a *AuthAgent) CreateUserAccount(newusername string, password string, email string) error {\n+\t//Check user already exists\n+\tif a.UserExists(newusername) {\n+\t\treturn errors.New(\"user with same name already exists\")\n+\t}\n+\n+\tkey := newusername\n+\thashedPassword := Hash(password)\n+\terr := a.Database.Write(\"auth\", \"passhash/\"+key, hashedPassword)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tif email != \"\" {\n+\t\terr = a.Database.Write(\"auth\", \"email/\"+key, email)\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t}\n+\n+\treturn nil\n+}\n+\n+//Hash the given raw string into sha512 hash\n+func Hash(raw string) string {\n+\th := sha512.New()\n+\th.Write([]byte(raw))\n+\treturn hex.EncodeToString(h.Sum(nil))\n+}"
            },
            {
                "sha": "546cae03ff98bd2c644181d0a24598af28c9d911",
                "filename": "src/mod/auth/router.go",
                "status": "added",
                "additions": 53,
                "deletions": 0,
                "changes": 53,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fauth%2Frouter.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fauth%2Frouter.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fauth%2Frouter.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,53 @@\n+package auth\n+\n+import (\n+\t\"errors\"\n+\t\"log\"\n+\t\"net/http\"\n+)\n+\n+type RouterOption struct {\n+\tAuthAgent     *AuthAgent\n+\tRequireAuth   bool                                     //This router require authentication\n+\tDeniedHandler func(http.ResponseWriter, *http.Request) //Things to do when request is rejected\n+\n+}\n+\n+type RouterDef struct {\n+\toption    RouterOption\n+\tendpoints map[string]func(http.ResponseWriter, *http.Request)\n+}\n+\n+func NewManagedHTTPRouter(option RouterOption) *RouterDef {\n+\treturn &RouterDef{\n+\t\toption:    option,\n+\t\tendpoints: map[string]func(http.ResponseWriter, *http.Request){},\n+\t}\n+}\n+\n+func (router *RouterDef) HandleFunc(endpoint string, handler func(http.ResponseWriter, *http.Request)) error {\n+\t//Check if the endpoint already registered\n+\tif _, exist := router.endpoints[endpoint]; exist {\n+\t\tlog.Println(\"WARNING! Duplicated registering of web endpoint: \" + endpoint)\n+\t\treturn errors.New(\"endpoint register duplicated\")\n+\t}\n+\n+\tauthAgent := router.option.AuthAgent\n+\n+\t//OK. Register handler\n+\thttp.HandleFunc(endpoint, func(w http.ResponseWriter, r *http.Request) {\n+\t\t//Check authentication of the user\n+\t\tif router.option.RequireAuth {\n+\t\t\tauthAgent.HandleCheckAuth(w, r, func(w http.ResponseWriter, r *http.Request) {\n+\t\t\t\thandler(w, r)\n+\t\t\t})\n+\t\t} else {\n+\t\t\thandler(w, r)\n+\t\t}\n+\n+\t})\n+\n+\trouter.endpoints[endpoint] = handler\n+\n+\treturn nil\n+}"
            },
            {
                "sha": "9726df8e28d13a7e5c12e5f353839f120d765faf",
                "filename": "src/mod/database/database.go",
                "status": "added",
                "additions": 120,
                "deletions": 0,
                "changes": 120,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdatabase%2Fdatabase.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdatabase%2Fdatabase.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdatabase%2Fdatabase.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,120 @@\n+package database\n+\n+/*\n+\tArOZ Online Database Access Module\n+\tauthor: tobychui\n+\n+\tThis is an improved Object oriented base solution to the original\n+\taroz online database script.\n+*/\n+\n+import (\n+\t\"sync\"\n+)\n+\n+type Database struct {\n+\tDb       interface{} //This will be nil on openwrt and *bolt.DB in the rest of the systems\n+\tTables   sync.Map\n+\tReadOnly bool\n+}\n+\n+func NewDatabase(dbfile string, readOnlyMode bool) (*Database, error) {\n+\treturn newDatabase(dbfile, readOnlyMode)\n+}\n+\n+/*\n+\tCreate / Drop a table\n+\tUsage:\n+\terr := sysdb.NewTable(\"MyTable\")\n+\terr := sysdb.DropTable(\"MyTable\")\n+*/\n+\n+func (d *Database) UpdateReadWriteMode(readOnly bool) {\n+\td.ReadOnly = readOnly\n+}\n+\n+//Dump the whole db into a log file\n+func (d *Database) Dump(filename string) ([]string, error) {\n+\treturn d.dump(filename)\n+}\n+\n+//Create a new table\n+func (d *Database) NewTable(tableName string) error {\n+\treturn d.newTable(tableName)\n+}\n+\n+//Check is table exists\n+func (d *Database) TableExists(tableName string) bool {\n+\treturn d.tableExists(tableName)\n+}\n+\n+//Drop the given table\n+func (d *Database) DropTable(tableName string) error {\n+\treturn d.dropTable(tableName)\n+}\n+\n+/*\n+\tWrite to database with given tablename and key. Example Usage:\n+\ttype demo struct{\n+\t\tcontent string\n+\t}\n+\tthisDemo := demo{\n+\t\tcontent: \"Hello World\",\n+\t}\n+\terr := sysdb.Write(\"MyTable\", \"username/message\",thisDemo);\n+*/\n+func (d *Database) Write(tableName string, key string, value interface{}) error {\n+\treturn d.write(tableName, key, value)\n+}\n+\n+/*\n+\tRead from database and assign the content to a given datatype. Example Usage:\n+\n+\ttype demo struct{\n+\t\tcontent string\n+\t}\n+\tthisDemo := new(demo)\n+\terr := sysdb.Read(\"MyTable\", \"username/message\",&thisDemo);\n+*/\n+\n+func (d *Database) Read(tableName string, key string, assignee interface{}) error {\n+\treturn d.read(tableName, key, assignee)\n+}\n+\n+func (d *Database) KeyExists(tableName string, key string) bool {\n+\treturn d.keyExists(tableName, key)\n+}\n+\n+/*\n+\tDelete a value from the database table given tablename and key\n+\n+\terr := sysdb.Delete(\"MyTable\", \"username/message\");\n+*/\n+func (d *Database) Delete(tableName string, key string) error {\n+\treturn d.delete(tableName, key)\n+}\n+\n+/*\n+\t//List table example usage\n+\t//Assume the value is stored as a struct named \"groupstruct\"\n+\n+\tentries, err := sysdb.ListTable(\"test\")\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\tfor _, keypairs := range entries{\n+\t\tlog.Println(string(keypairs[0]))\n+\t\tgroup := new(groupstruct)\n+\t\tjson.Unmarshal(keypairs[1], &group)\n+\t\tlog.Println(group);\n+\t}\n+\n+*/\n+\n+func (d *Database) ListTable(tableName string) ([][][]byte, error) {\n+\treturn d.listTable(tableName)\n+}\n+\n+func (d *Database) Close() {\n+\td.close()\n+}"
            },
            {
                "sha": "3035fc88e6ecc2ba5c17ea576cceeb9e08c15a47",
                "filename": "src/mod/database/database_core.go",
                "status": "added",
                "additions": 186,
                "deletions": 0,
                "changes": 186,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdatabase%2Fdatabase_core.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdatabase%2Fdatabase_core.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdatabase%2Fdatabase_core.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,186 @@\n+//go:build !mipsle && !riscv64\n+// +build !mipsle,!riscv64\n+\n+package database\n+\n+import (\n+\t\"encoding/json\"\n+\t\"errors\"\n+\t\"log\"\n+\t\"sync\"\n+\n+\t\"github.com/boltdb/bolt\"\n+)\n+\n+func newDatabase(dbfile string, readOnlyMode bool) (*Database, error) {\n+\tdb, err := bolt.Open(dbfile, 0600, nil)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\ttableMap := sync.Map{}\n+\t//Build the table list from database\n+\terr = db.View(func(tx *bolt.Tx) error {\n+\t\treturn tx.ForEach(func(name []byte, _ *bolt.Bucket) error {\n+\t\t\ttableMap.Store(string(name), \"\")\n+\t\t\treturn nil\n+\t\t})\n+\t})\n+\n+\treturn &Database{\n+\t\tDb:       db,\n+\t\tTables:   tableMap,\n+\t\tReadOnly: readOnlyMode,\n+\t}, err\n+}\n+\n+//Dump the whole db into a log file\n+func (d *Database) dump(filename string) ([]string, error) {\n+\tresults := []string{}\n+\n+\td.Tables.Range(func(tableName, v interface{}) bool {\n+\t\tentries, err := d.ListTable(tableName.(string))\n+\t\tif err != nil {\n+\t\t\tlog.Println(\"Reading table \" + tableName.(string) + \" failed: \" + err.Error())\n+\t\t\treturn false\n+\t\t}\n+\t\tfor _, keypairs := range entries {\n+\t\t\tresults = append(results, string(keypairs[0])+\":\"+string(keypairs[1])+\"\\n\")\n+\t\t}\n+\t\treturn true\n+\t})\n+\n+\treturn results, nil\n+}\n+\n+//Create a new table\n+func (d *Database) newTable(tableName string) error {\n+\tif d.ReadOnly == true {\n+\t\treturn errors.New(\"Operation rejected in ReadOnly mode\")\n+\t}\n+\n+\terr := d.Db.(*bolt.DB).Update(func(tx *bolt.Tx) error {\n+\t\t_, err := tx.CreateBucketIfNotExists([]byte(tableName))\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t\treturn nil\n+\t})\n+\n+\td.Tables.Store(tableName, \"\")\n+\treturn err\n+}\n+\n+//Check is table exists\n+func (d *Database) tableExists(tableName string) bool {\n+\tif _, ok := d.Tables.Load(tableName); ok {\n+\t\treturn true\n+\t}\n+\treturn false\n+}\n+\n+//Drop the given table\n+func (d *Database) dropTable(tableName string) error {\n+\tif d.ReadOnly == true {\n+\t\treturn errors.New(\"Operation rejected in ReadOnly mode\")\n+\t}\n+\n+\terr := d.Db.(*bolt.DB).Update(func(tx *bolt.Tx) error {\n+\t\terr := tx.DeleteBucket([]byte(tableName))\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t\treturn nil\n+\t})\n+\treturn err\n+}\n+\n+//Write to table\n+func (d *Database) write(tableName string, key string, value interface{}) error {\n+\tif d.ReadOnly {\n+\t\treturn errors.New(\"Operation rejected in ReadOnly mode\")\n+\t}\n+\n+\tjsonString, err := json.Marshal(value)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\terr = d.Db.(*bolt.DB).Update(func(tx *bolt.Tx) error {\n+\t\t_, err := tx.CreateBucketIfNotExists([]byte(tableName))\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t\tb := tx.Bucket([]byte(tableName))\n+\t\terr = b.Put([]byte(key), jsonString)\n+\t\treturn err\n+\t})\n+\treturn err\n+}\n+\n+func (d *Database) read(tableName string, key string, assignee interface{}) error {\n+\terr := d.Db.(*bolt.DB).View(func(tx *bolt.Tx) error {\n+\t\tb := tx.Bucket([]byte(tableName))\n+\t\tv := b.Get([]byte(key))\n+\t\tjson.Unmarshal(v, &assignee)\n+\t\treturn nil\n+\t})\n+\treturn err\n+}\n+\n+func (d *Database) keyExists(tableName string, key string) bool {\n+\tresultIsNil := false\n+\tif !d.TableExists(tableName) {\n+\t\t//Table not exists. Do not proceed accessing key\n+\t\tlog.Println(\"[DB] ERROR: Requesting key from table that didn't exist!!!\")\n+\t\treturn false\n+\t}\n+\terr := d.Db.(*bolt.DB).View(func(tx *bolt.Tx) error {\n+\t\tb := tx.Bucket([]byte(tableName))\n+\t\tv := b.Get([]byte(key))\n+\t\tif v == nil {\n+\t\t\tresultIsNil = true\n+\t\t}\n+\t\treturn nil\n+\t})\n+\n+\tif err != nil {\n+\t\treturn false\n+\t} else {\n+\t\tif resultIsNil {\n+\t\t\treturn false\n+\t\t} else {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+}\n+\n+func (d *Database) delete(tableName string, key string) error {\n+\tif d.ReadOnly {\n+\t\treturn errors.New(\"Operation rejected in ReadOnly mode\")\n+\t}\n+\n+\terr := d.Db.(*bolt.DB).Update(func(tx *bolt.Tx) error {\n+\t\ttx.Bucket([]byte(tableName)).Delete([]byte(key))\n+\t\treturn nil\n+\t})\n+\n+\treturn err\n+}\n+\n+func (d *Database) listTable(tableName string) ([][][]byte, error) {\n+\tvar results [][][]byte\n+\terr := d.Db.(*bolt.DB).View(func(tx *bolt.Tx) error {\n+\t\tb := tx.Bucket([]byte(tableName))\n+\t\tc := b.Cursor()\n+\n+\t\tfor k, v := c.First(); k != nil; k, v = c.Next() {\n+\t\t\tresults = append(results, [][]byte{k, v})\n+\t\t}\n+\t\treturn nil\n+\t})\n+\treturn results, err\n+}\n+\n+func (d *Database) close() {\n+\td.Db.(*bolt.DB).Close()\n+}"
            },
            {
                "sha": "9df3f031496bef67f7e5e6545c6fd6f1366b79b7",
                "filename": "src/mod/database/database_openwrt.go",
                "status": "added",
                "additions": 208,
                "deletions": 0,
                "changes": 208,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdatabase%2Fdatabase_openwrt.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdatabase%2Fdatabase_openwrt.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdatabase%2Fdatabase_openwrt.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,208 @@\n+//go:build mipsle || riscv64\n+// +build mipsle riscv64\n+\n+package database\n+\n+import (\n+\t\"encoding/json\"\n+\t\"errors\"\n+\t\"log\"\n+\t\"os\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\t\"sync\"\n+)\n+\n+func newDatabase(dbfile string, readOnlyMode bool) (*Database, error) {\n+\tdbRootPath := filepath.ToSlash(filepath.Clean(dbfile))\n+\tdbRootPath = \"fsdb/\" + dbRootPath\n+\terr := os.MkdirAll(dbRootPath, 0755)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\ttableMap := sync.Map{}\n+\t//build the table list from file system\n+\tfiles, err := filepath.Glob(filepath.Join(dbRootPath, \"/*\"))\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tfor _, file := range files {\n+\t\tif isDirectory(file) {\n+\t\t\ttableMap.Store(filepath.Base(file), \"\")\n+\t\t}\n+\t}\n+\n+\tlog.Println(\"Filesystem Emulated Key-value Database Service Started: \" + dbRootPath)\n+\treturn &Database{\n+\t\tDb:       dbRootPath,\n+\t\tTables:   tableMap,\n+\t\tReadOnly: readOnlyMode,\n+\t}, nil\n+}\n+\n+func (d *Database) dump(filename string) ([]string, error) {\n+\t//Get all file objects from root\n+\trootfiles, err := filepath.Glob(filepath.Join(d.Db.(string), \"/*\"))\n+\tif err != nil {\n+\t\treturn []string{}, err\n+\t}\n+\n+\t//Filter out the folders\n+\trootFolders := []string{}\n+\tfor _, file := range rootfiles {\n+\t\tif !isDirectory(file) {\n+\t\t\trootFolders = append(rootFolders, filepath.Base(file))\n+\t\t}\n+\t}\n+\n+\treturn rootFolders, nil\n+}\n+\n+func (d *Database) newTable(tableName string) error {\n+\tif d.ReadOnly {\n+\t\treturn errors.New(\"Operation rejected in ReadOnly mode\")\n+\t}\n+\ttablePath := filepath.Join(d.Db.(string), filepath.Base(tableName))\n+\tif !fileExists(tablePath) {\n+\t\treturn os.MkdirAll(tablePath, 0755)\n+\t}\n+\treturn nil\n+}\n+\n+func (d *Database) tableExists(tableName string) bool {\n+\ttablePath := filepath.Join(d.Db.(string), filepath.Base(tableName))\n+\tif _, err := os.Stat(tablePath); errors.Is(err, os.ErrNotExist) {\n+\t\treturn false\n+\t}\n+\n+\tif !isDirectory(tablePath) {\n+\t\treturn false\n+\t}\n+\n+\treturn true\n+}\n+\n+func (d *Database) dropTable(tableName string) error {\n+\tif d.ReadOnly {\n+\t\treturn errors.New(\"Operation rejected in ReadOnly mode\")\n+\t}\n+\ttablePath := filepath.Join(d.Db.(string), filepath.Base(tableName))\n+\tif d.tableExists(tableName) {\n+\t\treturn os.RemoveAll(tablePath)\n+\t} else {\n+\t\treturn errors.New(\"table not exists\")\n+\t}\n+\n+}\n+\n+func (d *Database) write(tableName string, key string, value interface{}) error {\n+\tif d.ReadOnly {\n+\t\treturn errors.New(\"Operation rejected in ReadOnly mode\")\n+\t}\n+\ttablePath := filepath.Join(d.Db.(string), filepath.Base(tableName))\n+\tjs, err := json.Marshal(value)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tkey = strings.ReplaceAll(key, \"/\", \"-SLASH_SIGN-\")\n+\n+\treturn os.WriteFile(filepath.Join(tablePath, key+\".entry\"), js, 0755)\n+}\n+\n+func (d *Database) read(tableName string, key string, assignee interface{}) error {\n+\tif !d.keyExists(tableName, key) {\n+\t\treturn errors.New(\"key not exists\")\n+\t}\n+\n+\tkey = strings.ReplaceAll(key, \"/\", \"-SLASH_SIGN-\")\n+\n+\ttablePath := filepath.Join(d.Db.(string), filepath.Base(tableName))\n+\tentryPath := filepath.Join(tablePath, key+\".entry\")\n+\tcontent, err := os.ReadFile(entryPath)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\terr = json.Unmarshal(content, &assignee)\n+\treturn err\n+}\n+\n+func (d *Database) keyExists(tableName string, key string) bool {\n+\tkey = strings.ReplaceAll(key, \"/\", \"-SLASH_SIGN-\")\n+\ttablePath := filepath.Join(d.Db.(string), filepath.Base(tableName))\n+\tentryPath := filepath.Join(tablePath, key+\".entry\")\n+\treturn fileExists(entryPath)\n+}\n+\n+func (d *Database) delete(tableName string, key string) error {\n+\tif d.ReadOnly {\n+\t\treturn errors.New(\"Operation rejected in ReadOnly mode\")\n+\t}\n+\tif !d.keyExists(tableName, key) {\n+\t\treturn errors.New(\"key not exists\")\n+\t}\n+\tkey = strings.ReplaceAll(key, \"/\", \"-SLASH_SIGN-\")\n+\ttablePath := filepath.Join(d.Db.(string), filepath.Base(tableName))\n+\tentryPath := filepath.Join(tablePath, key+\".entry\")\n+\n+\treturn os.Remove(entryPath)\n+}\n+\n+func (d *Database) listTable(tableName string) ([][][]byte, error) {\n+\tif !d.tableExists(tableName) {\n+\t\treturn [][][]byte{}, errors.New(\"table not exists\")\n+\t}\n+\ttablePath := filepath.Join(d.Db.(string), filepath.Base(tableName))\n+\tentries, err := filepath.Glob(filepath.Join(tablePath, \"/*.entry\"))\n+\tif err != nil {\n+\t\treturn [][][]byte{}, err\n+\t}\n+\n+\tvar results [][][]byte = [][][]byte{}\n+\tfor _, entry := range entries {\n+\t\tif !isDirectory(entry) {\n+\t\t\t//Read it\n+\t\t\tkey := filepath.Base(entry)\n+\t\t\tkey = strings.TrimSuffix(key, filepath.Ext(key))\n+\t\t\tkey = strings.ReplaceAll(key, \"-SLASH_SIGN-\", \"/\")\n+\n+\t\t\tbkey := []byte(key)\n+\t\t\tbval := []byte(\"\")\n+\t\t\tc, err := os.ReadFile(entry)\n+\t\t\tif err != nil {\n+\t\t\t\tbreak\n+\t\t\t}\n+\n+\t\t\tbval = c\n+\t\t\tresults = append(results, [][]byte{bkey, bval})\n+\t\t}\n+\t}\n+\treturn results, nil\n+}\n+\n+func (d *Database) close() {\n+\t//Nothing to close as it is file system\n+}\n+\n+func isDirectory(path string) bool {\n+\tfileInfo, err := os.Stat(path)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\treturn fileInfo.IsDir()\n+}\n+\n+func fileExists(name string) bool {\n+\t_, err := os.Stat(name)\n+\tif err == nil {\n+\t\treturn true\n+\t}\n+\tif errors.Is(err, os.ErrNotExist) {\n+\t\treturn false\n+\t}\n+\treturn false\n+}"
            },
            {
                "sha": "e93efef5d94d53cc1e01480625ae17593482155a",
                "filename": "src/mod/dynamicproxy/Server.go",
                "status": "added",
                "additions": 85,
                "deletions": 0,
                "changes": 85,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2FServer.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2FServer.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2FServer.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,85 @@\n+package dynamicproxy\n+\n+import (\n+\t\"net/http\"\n+\t\"os\"\n+\t\"strings\"\n+\n+\t\"imuslab.com/zoraxy/mod/geodb\"\n+)\n+\n+/*\n+\tServer.go\n+\n+\tMain server for dynamic proxy core\n+*/\n+\n+func (h *ProxyHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n+\t//Check if this ip is in blacklist\n+\tclientIpAddr := geodb.GetRequesterIP(r)\n+\tif h.Parent.Option.GeodbStore.IsBlacklisted(clientIpAddr) {\n+\t\tw.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n+\t\tw.WriteHeader(http.StatusForbidden)\n+\t\ttemplate, err := os.ReadFile(\"./web/forbidden.html\")\n+\t\tif err != nil {\n+\t\t\tw.Write([]byte(\"403 - Forbidden\"))\n+\t\t} else {\n+\t\t\tw.Write(template)\n+\t\t}\n+\t\th.logRequest(r, false, 403, \"blacklist\", \"\")\n+\t\treturn\n+\t}\n+\n+\t//Check if this is a redirection url\n+\tif h.Parent.Option.RedirectRuleTable.IsRedirectable(r) {\n+\t\tstatusCode := h.Parent.Option.RedirectRuleTable.HandleRedirect(w, r)\n+\t\th.logRequest(r, statusCode != 500, statusCode, \"redirect\", \"\")\n+\t\treturn\n+\t}\n+\n+\t//Check if there are external routing rule matches.\n+\t//If yes, route them via external rr\n+\tmatchedRoutingRule := h.Parent.GetMatchingRoutingRule(r)\n+\tif matchedRoutingRule != nil {\n+\t\t//Matching routing rule found. Let the sub-router handle it\n+\t\tmatchedRoutingRule.Route(w, r)\n+\t\treturn\n+\t}\n+\n+\t//Extract request host to see if it is virtual directory or subdomain\n+\tdomainOnly := r.Host\n+\tif strings.Contains(r.Host, \":\") {\n+\t\thostPath := strings.Split(r.Host, \":\")\n+\t\tdomainOnly = hostPath[0]\n+\t}\n+\n+\tif strings.Contains(r.Host, \".\") {\n+\t\t//This might be a subdomain. See if there are any subdomain proxy router for this\n+\t\t//Remove the port if any\n+\n+\t\tsep := h.Parent.getSubdomainProxyEndpointFromHostname(domainOnly)\n+\t\tif sep != nil {\n+\t\t\th.subdomainRequest(w, r, sep)\n+\t\t\treturn\n+\t\t}\n+\t}\n+\n+\t//Clean up the request URI\n+\tproxyingPath := strings.TrimSpace(r.RequestURI)\n+\ttargetProxyEndpoint := h.Parent.getTargetProxyEndpointFromRequestURI(proxyingPath)\n+\tif targetProxyEndpoint != nil {\n+\t\th.proxyRequest(w, r, targetProxyEndpoint)\n+\t} else if !strings.HasSuffix(proxyingPath, \"/\") {\n+\t\tpotentialProxtEndpoint := h.Parent.getTargetProxyEndpointFromRequestURI(proxyingPath + \"/\")\n+\n+\t\tif potentialProxtEndpoint != nil {\n+\t\t\t//Missing tailing slash. Redirect to target proxy endpoint\n+\t\t\thttp.Redirect(w, r, r.RequestURI+\"/\", http.StatusTemporaryRedirect)\n+\t\t\t//h.proxyRequest(w, r, potentialProxtEndpoint)\n+\t\t} else {\n+\t\t\th.proxyRequest(w, r, h.Parent.Root)\n+\t\t}\n+\t} else {\n+\t\th.proxyRequest(w, r, h.Parent.Root)\n+\t}\n+}"
            },
            {
                "sha": "52ba9a4cbceea5657f1cccb4e672a4387db33c31",
                "filename": "src/mod/dynamicproxy/domainsniff/domainsniff.go",
                "status": "added",
                "additions": 23,
                "deletions": 0,
                "changes": 23,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdomainsniff%2Fdomainsniff.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdomainsniff%2Fdomainsniff.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2Fdomainsniff%2Fdomainsniff.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,23 @@\n+package domainsniff\n+\n+import (\n+\t\"net\"\n+\t\"time\"\n+)\n+\n+//Check if the domain is reachable and return err if not reachable\n+func DomainReachableWithError(domain string) error {\n+\ttimeout := 1 * time.Second\n+\tconn, err := net.DialTimeout(\"tcp\", domain, timeout)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tconn.Close()\n+\treturn nil\n+}\n+\n+//Check if domain reachable\n+func DomainReachable(domain string) bool {\n+\treturn DomainReachableWithError(domain) == nil\n+}"
            },
            {
                "sha": "3e055f032247c736f6233f14be0595e2c9a5d2df",
                "filename": "src/mod/dynamicproxy/dpcore/LICENSE",
                "status": "added",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdpcore%2FLICENSE",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdpcore%2FLICENSE",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2Fdpcore%2FLICENSE?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,21 @@\n+MIT License\n+\n+Copyright (c) 2018-present tobychui\n+\n+Permission is hereby granted, free of charge, to any person obtaining a copy\n+of this software and associated documentation files (the \"Software\"), to deal\n+in the Software without restriction, including without limitation the rights\n+to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+copies of the Software, and to permit persons to whom the Software is\n+furnished to do so, subject to the following conditions:\n+\n+The above copyright notice and this permission notice shall be included in all\n+copies or substantial portions of the Software.\n+\n+THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+SOFTWARE."
            },
            {
                "sha": "79f19c42d4aa0c6f39a3979c48bec60753db980f",
                "filename": "src/mod/dynamicproxy/dpcore/dpcore.go",
                "status": "added",
                "additions": 494,
                "deletions": 0,
                "changes": 494,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdpcore%2Fdpcore.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdpcore%2Fdpcore.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2Fdpcore%2Fdpcore.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,494 @@\n+package dpcore\n+\n+import (\n+\t\"errors\"\n+\t\"io\"\n+\t\"log\"\n+\t\"net\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\t\"strings\"\n+\t\"sync\"\n+\t\"time\"\n+)\n+\n+var onExitFlushLoop func()\n+\n+const (\n+\tdefaultTimeout = time.Minute * 5\n+)\n+\n+// ReverseProxy is an HTTP Handler that takes an incoming request and\n+// sends it to another server, proxying the response back to the\n+// client, support http, also support https tunnel using http.hijacker\n+type ReverseProxy struct {\n+\t// Set the timeout of the proxy server, default is 5 minutes\n+\tTimeout time.Duration\n+\n+\t// Director must be a function which modifies\n+\t// the request into a new request to be sent\n+\t// using Transport. Its response is then copied\n+\t// back to the original client unmodified.\n+\t// Director must not access the provided Request\n+\t// after returning.\n+\tDirector func(*http.Request)\n+\n+\t// The transport used to perform proxy requests.\n+\t// default is http.DefaultTransport.\n+\tTransport http.RoundTripper\n+\n+\t// FlushInterval specifies the flush interval\n+\t// to flush to the client while copying the\n+\t// response body. If zero, no periodic flushing is done.\n+\tFlushInterval time.Duration\n+\n+\t// ErrorLog specifies an optional logger for errors\n+\t// that occur when attempting to proxy the request.\n+\t// If nil, logging goes to os.Stderr via the log package's\n+\t// standard logger.\n+\tErrorLog *log.Logger\n+\n+\t// ModifyResponse is an optional function that\n+\t// modifies the Response from the backend.\n+\t// If it returns an error, the proxy returns a StatusBadGateway error.\n+\tModifyResponse func(*http.Response) error\n+\n+\t//Prepender is an optional prepend text for URL rewrite\n+\t//\n+\tPrepender string\n+\n+\tVerbal bool\n+}\n+\n+type ResponseRewriteRuleSet struct {\n+\tProxyDomain  string\n+\tOriginalHost string\n+\tUseTLS       bool\n+\tPathPrefix   string //Vdir prefix for root, / will be rewrite to this\n+}\n+\n+type requestCanceler interface {\n+\tCancelRequest(req *http.Request)\n+}\n+\n+func NewDynamicProxyCore(target *url.URL, prepender string) *ReverseProxy {\n+\ttargetQuery := target.RawQuery\n+\tdirector := func(req *http.Request) {\n+\t\treq.URL.Scheme = target.Scheme\n+\t\treq.URL.Host = target.Host\n+\t\treq.URL.Path, req.URL.RawPath = joinURLPath(target, req.URL)\n+\t\tif targetQuery == \"\" || req.URL.RawQuery == \"\" {\n+\t\t\treq.URL.RawQuery = targetQuery + req.URL.RawQuery\n+\t\t} else {\n+\t\t\treq.URL.RawQuery = targetQuery + \"&\" + req.URL.RawQuery\n+\t\t}\n+\n+\t\tif _, ok := req.Header[\"User-Agent\"]; !ok {\n+\t\t\treq.Header.Set(\"User-Agent\", \"\")\n+\t\t}\n+\n+\t}\n+\n+\t//Hack the default transporter to handle more connections\n+\tthisTransporter := http.DefaultTransport\n+\tthisTransporter.(*http.Transport).MaxIdleConns = 3000\n+\tthisTransporter.(*http.Transport).MaxIdleConnsPerHost = 3000\n+\tthisTransporter.(*http.Transport).IdleConnTimeout = 10 * time.Second\n+\tthisTransporter.(*http.Transport).MaxConnsPerHost = 0\n+\tthisTransporter.(*http.Transport).DisableCompression = true\n+\n+\treturn &ReverseProxy{\n+\t\tDirector:  director,\n+\t\tPrepender: prepender,\n+\t\tVerbal:    false,\n+\t\tTransport: thisTransporter,\n+\t}\n+}\n+\n+func singleJoiningSlash(a, b string) string {\n+\taslash := strings.HasSuffix(a, \"/\")\n+\tbslash := strings.HasPrefix(b, \"/\")\n+\tswitch {\n+\tcase aslash && bslash:\n+\t\treturn a + b[1:]\n+\tcase !aslash && !bslash:\n+\t\treturn a + \"/\" + b\n+\t}\n+\treturn a + b\n+}\n+\n+func joinURLPath(a, b *url.URL) (path, rawpath string) {\n+\n+\tif a.RawPath == \"\" && b.RawPath == \"\" {\n+\n+\t\treturn singleJoiningSlash(a.Path, b.Path), \"\"\n+\n+\t}\n+\n+\t// Same as singleJoiningSlash, but uses EscapedPath to determine\n+\n+\t// whether a slash should be added\n+\n+\tapath := a.EscapedPath()\n+\n+\tbpath := b.EscapedPath()\n+\n+\taslash := strings.HasSuffix(apath, \"/\")\n+\n+\tbslash := strings.HasPrefix(bpath, \"/\")\n+\n+\tswitch {\n+\n+\tcase aslash && bslash:\n+\n+\t\treturn a.Path + b.Path[1:], apath + bpath[1:]\n+\n+\tcase !aslash && !bslash:\n+\n+\t\treturn a.Path + \"/\" + b.Path, apath + \"/\" + bpath\n+\n+\t}\n+\n+\treturn a.Path + b.Path, apath + bpath\n+\n+}\n+\n+func copyHeader(dst, src http.Header) {\n+\tfor k, vv := range src {\n+\t\tfor _, v := range vv {\n+\t\t\tdst.Add(k, v)\n+\t\t}\n+\t}\n+}\n+\n+// Hop-by-hop headers. These are removed when sent to the backend.\n+// http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html\n+var hopHeaders = []string{\n+\t//\"Connection\",\n+\t\"Proxy-Connection\", // non-standard but still sent by libcurl and rejected by e.g. google\n+\t\"Keep-Alive\",\n+\t\"Proxy-Authenticate\",\n+\t\"Proxy-Authorization\",\n+\t\"Te\",      // canonicalized version of \"TE\"\n+\t\"Trailer\", // not Trailers per URL above; http://www.rfc-editor.org/errata_search.php?eid=4522\n+\t\"Transfer-Encoding\",\n+\t//\"Upgrade\",\n+}\n+\n+func (p *ReverseProxy) copyResponse(dst io.Writer, src io.Reader) {\n+\tif p.FlushInterval != 0 {\n+\t\tif wf, ok := dst.(writeFlusher); ok {\n+\t\t\tmlw := &maxLatencyWriter{\n+\t\t\t\tdst:     wf,\n+\t\t\t\tlatency: p.FlushInterval,\n+\t\t\t\tdone:    make(chan bool),\n+\t\t\t}\n+\n+\t\t\tgo mlw.flushLoop()\n+\t\t\tdefer mlw.stop()\n+\t\t\tdst = mlw\n+\t\t}\n+\t}\n+\n+\tio.Copy(dst, src)\n+}\n+\n+type writeFlusher interface {\n+\tio.Writer\n+\thttp.Flusher\n+}\n+\n+type maxLatencyWriter struct {\n+\tdst     writeFlusher\n+\tlatency time.Duration\n+\tmu      sync.Mutex\n+\tdone    chan bool\n+}\n+\n+func (m *maxLatencyWriter) Write(b []byte) (int, error) {\n+\tm.mu.Lock()\n+\tdefer m.mu.Unlock()\n+\treturn m.dst.Write(b)\n+}\n+\n+func (m *maxLatencyWriter) flushLoop() {\n+\tt := time.NewTicker(m.latency)\n+\tdefer t.Stop()\n+\tfor {\n+\t\tselect {\n+\t\tcase <-m.done:\n+\t\t\tif onExitFlushLoop != nil {\n+\t\t\t\tonExitFlushLoop()\n+\t\t\t}\n+\t\t\treturn\n+\t\tcase <-t.C:\n+\t\t\tm.mu.Lock()\n+\t\t\tm.dst.Flush()\n+\t\t\tm.mu.Unlock()\n+\t\t}\n+\t}\n+}\n+\n+func (m *maxLatencyWriter) stop() {\n+\tm.done <- true\n+}\n+\n+func (p *ReverseProxy) logf(format string, args ...interface{}) {\n+\tif p.ErrorLog != nil {\n+\t\tp.ErrorLog.Printf(format, args...)\n+\t} else {\n+\t\tlog.Printf(format, args...)\n+\t}\n+}\n+\n+func removeHeaders(header http.Header) {\n+\t// Remove hop-by-hop headers listed in the \"Connection\" header.\n+\tif c := header.Get(\"Connection\"); c != \"\" {\n+\t\tfor _, f := range strings.Split(c, \",\") {\n+\t\t\tif f = strings.TrimSpace(f); f != \"\" {\n+\t\t\t\theader.Del(f)\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t// Remove hop-by-hop headers\n+\tfor _, h := range hopHeaders {\n+\t\tif header.Get(h) != \"\" {\n+\t\t\theader.Del(h)\n+\t\t}\n+\t}\n+\n+\tif header.Get(\"A-Upgrade\") != \"\" {\n+\t\theader.Set(\"Upgrade\", header.Get(\"A-Upgrade\"))\n+\t\theader.Del(\"A-Upgrade\")\n+\t}\n+}\n+\n+func addXForwardedForHeader(req *http.Request) {\n+\tif clientIP, _, err := net.SplitHostPort(req.RemoteAddr); err == nil {\n+\t\t// If we aren't the first proxy retain prior\n+\t\t// X-Forwarded-For information as a comma+space\n+\t\t// separated list and fold multiple headers into one.\n+\t\tif prior, ok := req.Header[\"X-Forwarded-For\"]; ok {\n+\t\t\tclientIP = strings.Join(prior, \", \") + \", \" + clientIP\n+\t\t}\n+\t\treq.Header.Set(\"X-Forwarded-For\", clientIP)\n+\t}\n+}\n+\n+func (p *ReverseProxy) ProxyHTTP(rw http.ResponseWriter, req *http.Request, rrr *ResponseRewriteRuleSet) error {\n+\ttransport := p.Transport\n+\tif transport == nil {\n+\t\ttransport = http.DefaultTransport\n+\t}\n+\n+\toutreq := new(http.Request)\n+\t// Shallow copies of maps, like header\n+\t*outreq = *req\n+\n+\tif cn, ok := rw.(http.CloseNotifier); ok {\n+\t\tif requestCanceler, ok := transport.(requestCanceler); ok {\n+\t\t\t// After the Handler has returned, there is no guarantee\n+\t\t\t// that the channel receives a value, so to make sure\n+\t\t\treqDone := make(chan struct{})\n+\t\t\tdefer close(reqDone)\n+\t\t\tclientGone := cn.CloseNotify()\n+\n+\t\t\tgo func() {\n+\t\t\t\tselect {\n+\t\t\t\tcase <-clientGone:\n+\t\t\t\t\trequestCanceler.CancelRequest(outreq)\n+\t\t\t\tcase <-reqDone:\n+\t\t\t\t}\n+\t\t\t}()\n+\t\t}\n+\t}\n+\n+\tp.Director(outreq)\n+\toutreq.Close = false\n+\n+\tif !rrr.UseTLS {\n+\t\t//This seems to be routing to external sites\n+\t\t//Do not keep the original host\n+\t\toutreq.Host = rrr.OriginalHost\n+\t}\n+\n+\t// We may modify the header (shallow copied above), so we only copy it.\n+\toutreq.Header = make(http.Header)\n+\tcopyHeader(outreq.Header, req.Header)\n+\n+\t// Remove hop-by-hop headers listed in the \"Connection\" header, Remove hop-by-hop headers.\n+\tremoveHeaders(outreq.Header)\n+\n+\t// Add X-Forwarded-For Header.\n+\taddXForwardedForHeader(outreq)\n+\n+\tres, err := transport.RoundTrip(outreq)\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\n+\t\t//rw.WriteHeader(http.StatusBadGateway)\n+\t\treturn err\n+\t}\n+\n+\t// Remove hop-by-hop headers listed in the \"Connection\" header of the response, Remove hop-by-hop headers.\n+\tremoveHeaders(res.Header)\n+\n+\tif p.ModifyResponse != nil {\n+\t\tif err := p.ModifyResponse(res); err != nil {\n+\t\t\tif p.Verbal {\n+\t\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t\t}\n+\n+\t\t\t//rw.WriteHeader(http.StatusBadGateway)\n+\t\t\treturn err\n+\t\t}\n+\t}\n+\n+\t//Custom header rewriter functions\n+\tif res.Header.Get(\"Location\") != \"\" {\n+\t\t/*\n+\t\t\tfmt.Println(\">>> REQ\", req)\n+\t\t\tfmt.Println(\">>> OUTR\", outreq)\n+\t\t\tfmt.Println(\">>> RESP\", res)\n+\t\t*/\n+\t\tlocationRewrite := res.Header.Get(\"Location\")\n+\t\toriginLocation := res.Header.Get(\"Location\")\n+\t\tres.Header.Set(\"zr-origin-location\", originLocation)\n+\n+\t\tif strings.HasPrefix(originLocation, \"http://\") || strings.HasPrefix(originLocation, \"https://\") {\n+\t\t\t//Full path\n+\t\t\t//Replace the forwarded target with expected Host\n+\t\t\tlr, err := replaceLocationHost(locationRewrite, rrr.OriginalHost, req.TLS != nil)\n+\t\t\tif err == nil {\n+\t\t\t\tlocationRewrite = lr\n+\t\t\t}\n+\t\t\t//locationRewrite = strings.ReplaceAll(locationRewrite, rrr.ProxyDomain, rrr.OriginalHost)\n+\t\t\t//locationRewrite = strings.ReplaceAll(locationRewrite, domainWithoutPort, rrr.OriginalHost)\n+\t\t} else if strings.HasPrefix(originLocation, \"/\") && rrr.PathPrefix != \"\" {\n+\t\t\t//Back to the root of this proxy object\n+\t\t\t//fmt.Println(rrr.ProxyDomain, rrr.OriginalHost)\n+\t\t\tlocationRewrite = strings.TrimSuffix(rrr.PathPrefix, \"/\") + originLocation\n+\t\t} else {\n+\t\t\t//Relative path. Do not modifiy location header\n+\n+\t\t}\n+\n+\t\t//Custom redirection to this rproxy relative path\n+\t\tres.Header.Set(\"Location\", locationRewrite)\n+\t}\n+\t// Copy header from response to client.\n+\tcopyHeader(rw.Header(), res.Header)\n+\n+\t// The \"Trailer\" header isn't included in the Transport's response, Build it up from Trailer.\n+\tif len(res.Trailer) > 0 {\n+\t\ttrailerKeys := make([]string, 0, len(res.Trailer))\n+\t\tfor k := range res.Trailer {\n+\t\t\ttrailerKeys = append(trailerKeys, k)\n+\t\t}\n+\t\trw.Header().Add(\"Trailer\", strings.Join(trailerKeys, \", \"))\n+\t}\n+\n+\trw.WriteHeader(res.StatusCode)\n+\tif len(res.Trailer) > 0 {\n+\t\t// Force chunking if we saw a response trailer.\n+\t\t// This prevents net/http from calculating the length for short\n+\t\t// bodies and adding a Content-Length.\n+\t\tif fl, ok := rw.(http.Flusher); ok {\n+\t\t\tfl.Flush()\n+\t\t}\n+\t}\n+\n+\tp.copyResponse(rw, res.Body)\n+\t// close now, instead of defer, to populate res.Trailer\n+\tres.Body.Close()\n+\tcopyHeader(rw.Header(), res.Trailer)\n+\n+\treturn nil\n+}\n+\n+func (p *ReverseProxy) ProxyHTTPS(rw http.ResponseWriter, req *http.Request) error {\n+\thij, ok := rw.(http.Hijacker)\n+\tif !ok {\n+\t\tp.logf(\"http server does not support hijacker\")\n+\t\treturn errors.New(\"http server does not support hijacker\")\n+\t}\n+\n+\tclientConn, _, err := hij.Hijack()\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\t\treturn err\n+\t}\n+\n+\tproxyConn, err := net.Dial(\"tcp\", req.URL.Host)\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\n+\t\treturn err\n+\t}\n+\n+\t// The returned net.Conn may have read or write deadlines\n+\t// already set, depending on the configuration of the\n+\t// Server, to set or clear those deadlines as needed\n+\t// we set timeout to 5 minutes\n+\tdeadline := time.Now()\n+\tif p.Timeout == 0 {\n+\t\tdeadline = deadline.Add(time.Minute * 5)\n+\t} else {\n+\t\tdeadline = deadline.Add(p.Timeout)\n+\t}\n+\n+\terr = clientConn.SetDeadline(deadline)\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\t\treturn err\n+\t}\n+\n+\terr = proxyConn.SetDeadline(deadline)\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\n+\t\treturn err\n+\t}\n+\n+\t_, err = clientConn.Write([]byte(\"HTTP/1.0 200 OK\\r\\n\\r\\n\"))\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\n+\t\treturn err\n+\t}\n+\n+\tgo func() {\n+\t\tio.Copy(clientConn, proxyConn)\n+\t\tclientConn.Close()\n+\t\tproxyConn.Close()\n+\t}()\n+\n+\tio.Copy(proxyConn, clientConn)\n+\tproxyConn.Close()\n+\tclientConn.Close()\n+\n+\treturn nil\n+}\n+\n+func (p *ReverseProxy) ServeHTTP(rw http.ResponseWriter, req *http.Request, rrr *ResponseRewriteRuleSet) error {\n+\tif req.Method == \"CONNECT\" {\n+\t\terr := p.ProxyHTTPS(rw, req)\n+\t\treturn err\n+\t} else {\n+\t\terr := p.ProxyHTTP(rw, req, rrr)\n+\t\treturn err\n+\t}\n+}"
            },
            {
                "sha": "75f68a6cebeb1eefd07500921dd2cdfa0a5e31f6",
                "filename": "src/mod/dynamicproxy/dpcore/utils.go",
                "status": "added",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdpcore%2Futils.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdpcore%2Futils.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2Fdpcore%2Futils.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,21 @@\n+package dpcore\n+\n+import (\n+\t\"net/url\"\n+)\n+\n+func replaceLocationHost(urlString string, newHost string, useTLS bool) (string, error) {\n+\tu, err := url.Parse(urlString)\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\tif useTLS {\n+\t\tu.Scheme = \"https\"\n+\t} else {\n+\t\tu.Scheme = \"http\"\n+\t}\n+\n+\tu.Host = newHost\n+\treturn u.String(), nil\n+}"
            },
            {
                "sha": "6475bc751b59e2604cb4191326904dc89cd4269e",
                "filename": "src/mod/dynamicproxy/dynamicproxy.go",
                "status": "added",
                "additions": 373,
                "deletions": 0,
                "changes": 373,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdynamicproxy.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fdynamicproxy.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2Fdynamicproxy.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,373 @@\n+package dynamicproxy\n+\n+import (\n+\t\"context\"\n+\t\"crypto/tls\"\n+\t\"errors\"\n+\t\"log\"\n+\t\"net\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\t\"strconv\"\n+\t\"strings\"\n+\t\"sync\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/dynamicproxy/dpcore\"\n+\t\"imuslab.com/zoraxy/mod/dynamicproxy/redirection\"\n+\t\"imuslab.com/zoraxy/mod/geodb\"\n+\t\"imuslab.com/zoraxy/mod/reverseproxy\"\n+\t\"imuslab.com/zoraxy/mod/statistic\"\n+\t\"imuslab.com/zoraxy/mod/tlscert\"\n+)\n+\n+/*\n+Zoraxy Dynamic Proxy\n+*/\n+type RouterOption struct {\n+\tPort               int\n+\tUseTls             bool\n+\tForceHttpsRedirect bool\n+\tTlsManager         *tlscert.Manager\n+\tRedirectRuleTable  *redirection.RuleTable\n+\tGeodbStore         *geodb.Store\n+\tStatisticCollector *statistic.Collector\n+}\n+\n+type Router struct {\n+\tOption            *RouterOption\n+\tProxyEndpoints    *sync.Map\n+\tSubdomainEndpoint *sync.Map\n+\tRunning           bool\n+\tRoot              *ProxyEndpoint\n+\tmux               http.Handler\n+\tserver            *http.Server\n+\ttlsListener       net.Listener\n+\troutingRules      []*RoutingRule\n+\n+\ttlsRedirectStop chan bool\n+}\n+\n+type ProxyEndpoint struct {\n+\tRoot       string\n+\tDomain     string\n+\tRequireTLS bool\n+\tProxy      *dpcore.ReverseProxy `json:\"-\"`\n+}\n+\n+type SubdomainEndpoint struct {\n+\tMatchingDomain string\n+\tDomain         string\n+\tRequireTLS     bool\n+\tProxy          *reverseproxy.ReverseProxy `json:\"-\"`\n+}\n+\n+type ProxyHandler struct {\n+\tParent *Router\n+}\n+\n+func NewDynamicProxy(option RouterOption) (*Router, error) {\n+\tproxyMap := sync.Map{}\n+\tdomainMap := sync.Map{}\n+\tthisRouter := Router{\n+\t\tOption:            &option,\n+\t\tProxyEndpoints:    &proxyMap,\n+\t\tSubdomainEndpoint: &domainMap,\n+\t\tRunning:           false,\n+\t\tserver:            nil,\n+\t\troutingRules:      []*RoutingRule{},\n+\t}\n+\n+\tthisRouter.mux = &ProxyHandler{\n+\t\tParent: &thisRouter,\n+\t}\n+\n+\treturn &thisRouter, nil\n+}\n+\n+// Update TLS setting in runtime. Will restart the proxy server\n+// if it is already running in the background\n+func (router *Router) UpdateTLSSetting(tlsEnabled bool) {\n+\trouter.Option.UseTls = tlsEnabled\n+\trouter.Restart()\n+}\n+\n+// Update https redirect, which will require updates\n+func (router *Router) UpdateHttpToHttpsRedirectSetting(useRedirect bool) {\n+\trouter.Option.ForceHttpsRedirect = useRedirect\n+\trouter.Restart()\n+}\n+\n+// Start the dynamic routing\n+func (router *Router) StartProxyService() error {\n+\t//Create a new server object\n+\tif router.server != nil {\n+\t\treturn errors.New(\"Reverse proxy server already running\")\n+\t}\n+\n+\tif router.Root == nil {\n+\t\treturn errors.New(\"Reverse proxy router root not set\")\n+\t}\n+\n+\tconfig := &tls.Config{\n+\t\tGetCertificate: router.Option.TlsManager.GetCert,\n+\t}\n+\n+\tif router.Option.UseTls {\n+\t\t//Serve with TLS mode\n+\t\tln, err := tls.Listen(\"tcp\", \":\"+strconv.Itoa(router.Option.Port), config)\n+\t\tif err != nil {\n+\t\t\tlog.Println(err)\n+\t\t\trouter.Running = false\n+\t\t\treturn err\n+\t\t}\n+\t\trouter.tlsListener = ln\n+\t\trouter.server = &http.Server{Addr: \":\" + strconv.Itoa(router.Option.Port), Handler: router.mux}\n+\t\trouter.Running = true\n+\n+\t\tif router.Option.Port != 80 && router.Option.ForceHttpsRedirect {\n+\t\t\t//Add a 80 to 443 redirector\n+\t\t\thttpServer := &http.Server{\n+\t\t\t\tAddr: \":80\",\n+\t\t\t\tHandler: http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n+\t\t\t\t\tprotocol := \"https://\"\n+\t\t\t\t\tif router.Option.Port == 443 {\n+\t\t\t\t\t\thttp.Redirect(w, r, protocol+r.Host+r.RequestURI, http.StatusTemporaryRedirect)\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\thttp.Redirect(w, r, protocol+r.Host+\":\"+strconv.Itoa(router.Option.Port)+r.RequestURI, http.StatusTemporaryRedirect)\n+\t\t\t\t\t}\n+\n+\t\t\t\t}),\n+\t\t\t\tReadTimeout:  3 * time.Second,\n+\t\t\t\tWriteTimeout: 3 * time.Second,\n+\t\t\t\tIdleTimeout:  120 * time.Second,\n+\t\t\t}\n+\n+\t\t\tlog.Println(\"Starting HTTP-to-HTTPS redirector (port 80)\")\n+\n+\t\t\t//Create a redirection stop channel\n+\t\t\tstopChan := make(chan bool)\n+\n+\t\t\t//Start a blocking wait for shutting down the http to https redirection server\n+\t\t\tgo func() {\n+\t\t\t\t<-stopChan\n+\t\t\t\tctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\n+\t\t\t\tdefer cancel()\n+\t\t\t\thttpServer.Shutdown(ctx)\n+\t\t\t\tlog.Println(\"HTTP to HTTPS redirection listener stopped\")\n+\t\t\t}()\n+\n+\t\t\t//Start the http server that listens to port 80 and redirect to 443\n+\t\t\tgo func() {\n+\t\t\t\tif err := httpServer.ListenAndServe(); err != nil && err != http.ErrServerClosed {\n+\t\t\t\t\t//Unable to startup port 80 listener. Handle shutdown process gracefully\n+\t\t\t\t\tstopChan <- true\n+\t\t\t\t\tlog.Fatalf(\"Could not start server: %v\\n\", err)\n+\t\t\t\t}\n+\t\t\t}()\n+\t\t\trouter.tlsRedirectStop = stopChan\n+\t\t}\n+\n+\t\t//Start the TLS server\n+\t\tlog.Println(\"Reverse proxy service started in the background (TLS mode)\")\n+\t\tgo func() {\n+\t\t\tif err := router.server.Serve(ln); err != nil && err != http.ErrServerClosed {\n+\t\t\t\tlog.Fatalf(\"Could not start server: %v\\n\", err)\n+\t\t\t}\n+\t\t}()\n+\t} else {\n+\t\t//Serve with non TLS mode\n+\t\trouter.tlsListener = nil\n+\t\trouter.server = &http.Server{Addr: \":\" + strconv.Itoa(router.Option.Port), Handler: router.mux}\n+\t\trouter.Running = true\n+\t\tlog.Println(\"Reverse proxy service started in the background (Plain HTTP mode)\")\n+\t\tgo func() {\n+\t\t\trouter.server.ListenAndServe()\n+\t\t\t//log.Println(\"[DynamicProxy] \" + err.Error())\n+\t\t}()\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (router *Router) StopProxyService() error {\n+\tif router.server == nil {\n+\t\treturn errors.New(\"Reverse proxy server already stopped\")\n+\t}\n+\tctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\n+\tdefer cancel()\n+\terr := router.server.Shutdown(ctx)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tif router.tlsListener != nil {\n+\t\trouter.tlsListener.Close()\n+\t}\n+\n+\tif router.tlsRedirectStop != nil {\n+\t\trouter.tlsRedirectStop <- true\n+\t}\n+\n+\t//Discard the server object\n+\trouter.tlsListener = nil\n+\trouter.server = nil\n+\trouter.Running = false\n+\trouter.tlsRedirectStop = nil\n+\treturn nil\n+}\n+\n+// Restart the current router if it is running.\n+// Startup the server if it is not running initially\n+func (router *Router) Restart() error {\n+\t//Stop the router if it is already running\n+\tif router.Running {\n+\t\terr := router.StopProxyService()\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t}\n+\n+\t//Start the server\n+\terr := router.StartProxyService()\n+\treturn err\n+}\n+\n+/*\n+\tCheck if a given request is accessed via a proxied subdomain\n+*/\n+\n+func (router *Router) IsProxiedSubdomain(r *http.Request) bool {\n+\thostname := r.Header.Get(\"X-Forwarded-Host\")\n+\tif hostname == \"\" {\n+\t\thostname = r.Host\n+\t}\n+\thostname = strings.Split(hostname, \":\")[0]\n+\tsubdEndpoint := router.getSubdomainProxyEndpointFromHostname(hostname)\n+\treturn subdEndpoint != nil\n+}\n+\n+/*\n+Add an URL into a custom proxy services\n+*/\n+func (router *Router) AddVirtualDirectoryProxyService(rootname string, domain string, requireTLS bool) error {\n+\n+\tif domain[len(domain)-1:] == \"/\" {\n+\t\tdomain = domain[:len(domain)-1]\n+\t}\n+\n+\t/*\n+\t\tif rootname[len(rootname)-1:] == \"/\" {\n+\t\t\trootname = rootname[:len(rootname)-1]\n+\t\t}\n+\t*/\n+\n+\twebProxyEndpoint := domain\n+\tif requireTLS {\n+\t\twebProxyEndpoint = \"https://\" + webProxyEndpoint\n+\t} else {\n+\t\twebProxyEndpoint = \"http://\" + webProxyEndpoint\n+\t}\n+\t//Create a new proxy agent for this root\n+\tpath, err := url.Parse(webProxyEndpoint)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tproxy := dpcore.NewDynamicProxyCore(path, rootname)\n+\n+\tendpointObject := ProxyEndpoint{\n+\t\tRoot:       rootname,\n+\t\tDomain:     domain,\n+\t\tRequireTLS: requireTLS,\n+\t\tProxy:      proxy,\n+\t}\n+\n+\trouter.ProxyEndpoints.Store(rootname, &endpointObject)\n+\n+\tlog.Println(\"Adding Proxy Rule: \", rootname+\" to \"+domain)\n+\treturn nil\n+}\n+\n+/*\n+Remove routing from RP\n+*/\n+func (router *Router) RemoveProxy(ptype string, key string) error {\n+\t//fmt.Println(ptype, key)\n+\tif ptype == \"vdir\" {\n+\t\trouter.ProxyEndpoints.Delete(key)\n+\t\treturn nil\n+\t} else if ptype == \"subd\" {\n+\t\trouter.SubdomainEndpoint.Delete(key)\n+\t\treturn nil\n+\t}\n+\treturn errors.New(\"invalid ptype\")\n+}\n+\n+/*\n+Add an default router for the proxy server\n+*/\n+func (router *Router) SetRootProxy(proxyLocation string, requireTLS bool) error {\n+\tif proxyLocation[len(proxyLocation)-1:] == \"/\" {\n+\t\tproxyLocation = proxyLocation[:len(proxyLocation)-1]\n+\t}\n+\n+\twebProxyEndpoint := proxyLocation\n+\tif requireTLS {\n+\t\twebProxyEndpoint = \"https://\" + webProxyEndpoint\n+\t} else {\n+\t\twebProxyEndpoint = \"http://\" + webProxyEndpoint\n+\t}\n+\t//Create a new proxy agent for this root\n+\tpath, err := url.Parse(webProxyEndpoint)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tproxy := dpcore.NewDynamicProxyCore(path, \"\")\n+\n+\trootEndpoint := ProxyEndpoint{\n+\t\tRoot:       \"/\",\n+\t\tDomain:     proxyLocation,\n+\t\tRequireTLS: requireTLS,\n+\t\tProxy:      proxy,\n+\t}\n+\n+\trouter.Root = &rootEndpoint\n+\treturn nil\n+}\n+\n+// Helpers to export the syncmap for easier processing\n+func (r *Router) GetSDProxyEndpointsAsMap() map[string]*SubdomainEndpoint {\n+\tm := make(map[string]*SubdomainEndpoint)\n+\tr.SubdomainEndpoint.Range(func(key, value interface{}) bool {\n+\t\tk, ok := key.(string)\n+\t\tif !ok {\n+\t\t\treturn true\n+\t\t}\n+\t\tv, ok := value.(*SubdomainEndpoint)\n+\t\tif !ok {\n+\t\t\treturn true\n+\t\t}\n+\t\tm[k] = v\n+\t\treturn true\n+\t})\n+\treturn m\n+}\n+\n+func (r *Router) GetVDProxyEndpointsAsMap() map[string]*ProxyEndpoint {\n+\tm := make(map[string]*ProxyEndpoint)\n+\tr.ProxyEndpoints.Range(func(key, value interface{}) bool {\n+\t\tk, ok := key.(string)\n+\t\tif !ok {\n+\t\t\treturn true\n+\t\t}\n+\t\tv, ok := value.(*ProxyEndpoint)\n+\t\tif !ok {\n+\t\t\treturn true\n+\t\t}\n+\t\tm[k] = v\n+\t\treturn true\n+\t})\n+\treturn m\n+}"
            },
            {
                "sha": "187e3b0b1952d6a6e3a7018721fab84a78d188a0",
                "filename": "src/mod/dynamicproxy/proxyRequestHandler.go",
                "status": "added",
                "additions": 155,
                "deletions": 0,
                "changes": 155,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2FproxyRequestHandler.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2FproxyRequestHandler.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2FproxyRequestHandler.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,155 @@\n+package dynamicproxy\n+\n+import (\n+\t\"errors\"\n+\t\"log\"\n+\t\"net\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\t\"strings\"\n+\n+\t\"imuslab.com/zoraxy/mod/dynamicproxy/dpcore\"\n+\t\"imuslab.com/zoraxy/mod/geodb\"\n+\t\"imuslab.com/zoraxy/mod/statistic\"\n+\t\"imuslab.com/zoraxy/mod/websocketproxy\"\n+)\n+\n+func (router *Router) getTargetProxyEndpointFromRequestURI(requestURI string) *ProxyEndpoint {\n+\tvar targetProxyEndpoint *ProxyEndpoint = nil\n+\trouter.ProxyEndpoints.Range(func(key, value interface{}) bool {\n+\t\trootname := key.(string)\n+\t\tif strings.HasPrefix(requestURI, rootname) {\n+\t\t\tthisProxyEndpoint := value.(*ProxyEndpoint)\n+\t\t\ttargetProxyEndpoint = thisProxyEndpoint\n+\t\t}\n+\t\treturn true\n+\t})\n+\n+\treturn targetProxyEndpoint\n+}\n+\n+func (router *Router) getSubdomainProxyEndpointFromHostname(hostname string) *SubdomainEndpoint {\n+\tvar targetSubdomainEndpoint *SubdomainEndpoint = nil\n+\tep, ok := router.SubdomainEndpoint.Load(hostname)\n+\tif ok {\n+\t\ttargetSubdomainEndpoint = ep.(*SubdomainEndpoint)\n+\t}\n+\n+\treturn targetSubdomainEndpoint\n+}\n+\n+func (router *Router) rewriteURL(rooturl string, requestURL string) string {\n+\trewrittenURL := requestURL\n+\trewrittenURL = strings.TrimPrefix(rewrittenURL, strings.TrimSuffix(rooturl, \"/\"))\n+\treturn rewrittenURL\n+}\n+\n+func (h *ProxyHandler) subdomainRequest(w http.ResponseWriter, r *http.Request, target *SubdomainEndpoint) {\n+\tr.Header.Set(\"X-Forwarded-Host\", r.Host)\n+\trequestURL := r.URL.String()\n+\tif r.Header[\"Upgrade\"] != nil && strings.ToLower(r.Header[\"Upgrade\"][0]) == \"websocket\" {\n+\t\t//Handle WebSocket request. Forward the custom Upgrade header and rewrite origin\n+\t\tr.Header.Set(\"A-Upgrade\", \"websocket\")\n+\t\twsRedirectionEndpoint := target.Domain\n+\t\tif wsRedirectionEndpoint[len(wsRedirectionEndpoint)-1:] != \"/\" {\n+\t\t\t//Append / to the end of the redirection endpoint if not exists\n+\t\t\twsRedirectionEndpoint = wsRedirectionEndpoint + \"/\"\n+\t\t}\n+\t\tif len(requestURL) > 0 && requestURL[:1] == \"/\" {\n+\t\t\t//Remove starting / from request URL if exists\n+\t\t\trequestURL = requestURL[1:]\n+\t\t}\n+\t\tu, _ := url.Parse(\"ws://\" + wsRedirectionEndpoint + requestURL)\n+\t\tif target.RequireTLS {\n+\t\t\tu, _ = url.Parse(\"wss://\" + wsRedirectionEndpoint + requestURL)\n+\t\t}\n+\t\th.logRequest(r, true, 101, \"subdomain-websocket\", target.Domain)\n+\t\twspHandler := websocketproxy.NewProxy(u)\n+\t\twspHandler.ServeHTTP(w, r)\n+\t\treturn\n+\t}\n+\n+\tr.Host = r.URL.Host\n+\terr := target.Proxy.ServeHTTP(w, r)\n+\tvar dnsError *net.DNSError\n+\tif err != nil {\n+\t\tif errors.As(err, &dnsError) {\n+\t\t\thttp.ServeFile(w, r, \"./web/hosterror.html\")\n+\t\t\tlog.Println(err.Error())\n+\t\t\th.logRequest(r, false, 404, \"subdomain-http\", target.Domain)\n+\t\t} else {\n+\t\t\thttp.ServeFile(w, r, \"./web/rperror.html\")\n+\t\t\tlog.Println(err.Error())\n+\t\t\th.logRequest(r, false, 521, \"subdomain-http\", target.Domain)\n+\t\t}\n+\t}\n+\n+\th.logRequest(r, true, 200, \"subdomain-http\", target.Domain)\n+}\n+\n+func (h *ProxyHandler) proxyRequest(w http.ResponseWriter, r *http.Request, target *ProxyEndpoint) {\n+\trewriteURL := h.Parent.rewriteURL(target.Root, r.RequestURI)\n+\tr.URL, _ = url.Parse(rewriteURL)\n+\n+\tr.Header.Set(\"X-Forwarded-Host\", r.Host)\n+\tif r.Header[\"Upgrade\"] != nil && strings.ToLower(r.Header[\"Upgrade\"][0]) == \"websocket\" {\n+\t\t//Handle WebSocket request. Forward the custom Upgrade header and rewrite origin\n+\t\tr.Header.Set(\"A-Upgrade\", \"websocket\")\n+\t\twsRedirectionEndpoint := target.Domain\n+\t\tif wsRedirectionEndpoint[len(wsRedirectionEndpoint)-1:] != \"/\" {\n+\t\t\twsRedirectionEndpoint = wsRedirectionEndpoint + \"/\"\n+\t\t}\n+\t\tu, _ := url.Parse(\"ws://\" + wsRedirectionEndpoint + r.URL.String())\n+\t\tif target.RequireTLS {\n+\t\t\tu, _ = url.Parse(\"wss://\" + wsRedirectionEndpoint + r.URL.String())\n+\t\t}\n+\t\th.logRequest(r, true, 101, \"vdir-websocket\", target.Domain)\n+\t\twspHandler := websocketproxy.NewProxy(u)\n+\t\twspHandler.ServeHTTP(w, r)\n+\t\treturn\n+\t}\n+\n+\toriginalHostHeader := r.Host\n+\tr.Host = r.URL.Host\n+\terr := target.Proxy.ServeHTTP(w, r, &dpcore.ResponseRewriteRuleSet{\n+\t\tProxyDomain:  target.Domain,\n+\t\tOriginalHost: originalHostHeader,\n+\t\tUseTLS:       target.RequireTLS,\n+\t\tPathPrefix:   target.Root,\n+\t})\n+\n+\tvar dnsError *net.DNSError\n+\tif err != nil {\n+\t\tif errors.As(err, &dnsError) {\n+\t\t\thttp.ServeFile(w, r, \"./web/hosterror.html\")\n+\t\t\tlog.Println(err.Error())\n+\t\t\th.logRequest(r, false, 404, \"vdir-http\", target.Domain)\n+\t\t} else {\n+\t\t\thttp.ServeFile(w, r, \"./web/rperror.html\")\n+\t\t\tlog.Println(err.Error())\n+\t\t\th.logRequest(r, false, 521, \"vdir-http\", target.Domain)\n+\t\t}\n+\t}\n+\th.logRequest(r, true, 200, \"vdir-http\", target.Domain)\n+\n+}\n+\n+func (h *ProxyHandler) logRequest(r *http.Request, succ bool, statusCode int, forwardType string, target string) {\n+\tif h.Parent.Option.StatisticCollector != nil {\n+\t\tgo func() {\n+\t\t\trequestInfo := statistic.RequestInfo{\n+\t\t\t\tIpAddr:                        geodb.GetRequesterIP(r),\n+\t\t\t\tRequestOriginalCountryISOCode: h.Parent.Option.GeodbStore.GetRequesterCountryISOCode(r),\n+\t\t\t\tSucc:                          succ,\n+\t\t\t\tStatusCode:                    statusCode,\n+\t\t\t\tForwardType:                   forwardType,\n+\t\t\t\tReferer:                       r.Referer(),\n+\t\t\t\tUserAgent:                     r.UserAgent(),\n+\t\t\t\tRequestURL:                    r.Host + r.RequestURI,\n+\t\t\t\tTarget:                        target,\n+\t\t\t}\n+\t\t\th.Parent.Option.StatisticCollector.RecordRequest(requestInfo)\n+\t\t}()\n+\n+\t}\n+}"
            },
            {
                "sha": "952cde77436fcef10804df6e80e7cae43b685345",
                "filename": "src/mod/dynamicproxy/redirection/handler.go",
                "status": "added",
                "additions": 56,
                "deletions": 0,
                "changes": 56,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fredirection%2Fhandler.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fredirection%2Fhandler.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2Fredirection%2Fhandler.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,56 @@\n+package redirection\n+\n+import (\n+\t\"log\"\n+\t\"net/http\"\n+\t\"strings\"\n+)\n+\n+/*\n+\thandler.go\n+\n+\tThis script store the handlers use for handling\n+\tredirection request\n+*/\n+\n+// Check if a request URL is a redirectable URI\n+func (t *RuleTable) IsRedirectable(r *http.Request) bool {\n+\trequestPath := r.Host + r.URL.Path\n+\trr := t.MatchRedirectRule(requestPath)\n+\treturn rr != nil\n+}\n+\n+// Handle the redirect request, return after calling this function to prevent\n+// multiple write to the response writer\n+// Return the status code of the redirection handling\n+func (t *RuleTable) HandleRedirect(w http.ResponseWriter, r *http.Request) int {\n+\trequestPath := r.Host + r.URL.Path\n+\trr := t.MatchRedirectRule(requestPath)\n+\tif rr != nil {\n+\t\tredirectTarget := rr.TargetURL\n+\t\t//Always pad a / at the back of the target URL\n+\t\tif redirectTarget[len(redirectTarget)-1:] != \"/\" {\n+\t\t\tredirectTarget += \"/\"\n+\t\t}\n+\t\tif rr.ForwardChildpath {\n+\t\t\t//Remove the first / in the path\n+\t\t\tredirectTarget += strings.TrimPrefix(r.URL.Path, \"/\")\n+\t\t\tif r.URL.RawQuery != \"\" {\n+\t\t\t\tredirectTarget += \"?\" + r.URL.RawQuery\n+\t\t\t}\n+\t\t}\n+\n+\t\tif !strings.HasPrefix(redirectTarget, \"http://\") && !strings.HasPrefix(redirectTarget, \"https://\") {\n+\t\t\tredirectTarget = \"http://\" + redirectTarget\n+\t\t}\n+\n+\t\thttp.Redirect(w, r, redirectTarget, rr.StatusCode)\n+\t\treturn rr.StatusCode\n+\t} else {\n+\t\t//Invalid usage\n+\t\tw.WriteHeader(http.StatusInternalServerError)\n+\t\tw.Write([]byte(\"500 - Internal Server Error\"))\n+\t\tlog.Println(\"Target request URL do not have matching redirect rule. Check with IsRedirectable before calling HandleRedirect!\")\n+\t\treturn 500\n+\t}\n+}"
            },
            {
                "sha": "4b164fd33ce2b58068c0685d9a3269fcfc4005a3",
                "filename": "src/mod/dynamicproxy/redirection/redirection.go",
                "status": "added",
                "additions": 162,
                "deletions": 0,
                "changes": 162,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fredirection%2Fredirection.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fredirection%2Fredirection.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2Fredirection%2Fredirection.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,162 @@\n+package redirection\n+\n+import (\n+\t\"encoding/json\"\n+\t\"log\"\n+\t\"os\"\n+\t\"path\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\t\"sync\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+type RuleTable struct {\n+\tconfigPath string   //The location where the redirection rules is stored\n+\trules      sync.Map //Store the redirection rules for this reverse proxy instance\n+}\n+\n+type RedirectRules struct {\n+\tRedirectURL      string //The matching URL to redirect\n+\tTargetURL        string //The destination redirection url\n+\tForwardChildpath bool   //Also redirect the pathname\n+\tStatusCode       int    //Status Code for redirection\n+}\n+\n+func NewRuleTable(configPath string) (*RuleTable, error) {\n+\tthisRuleTable := RuleTable{\n+\t\trules:      sync.Map{},\n+\t\tconfigPath: configPath,\n+\t}\n+\t//Load all the rules from the config path\n+\tif !utils.FileExists(configPath) {\n+\t\tos.MkdirAll(configPath, 0775)\n+\t}\n+\n+\t// Load all the *.json from the configPath\n+\tfiles, err := filepath.Glob(filepath.Join(configPath, \"*.json\"))\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\t// Parse the json content into RedirectRules\n+\tvar rules []*RedirectRules\n+\tfor _, file := range files {\n+\t\tb, err := os.ReadFile(file)\n+\t\tif err != nil {\n+\t\t\tcontinue\n+\t\t}\n+\n+\t\tthisRule := RedirectRules{}\n+\n+\t\terr = json.Unmarshal(b, &thisRule)\n+\t\tif err != nil {\n+\t\t\tcontinue\n+\t\t}\n+\n+\t\trules = append(rules, &thisRule)\n+\t}\n+\n+\t//Map the rules into the sync map\n+\tfor _, rule := range rules {\n+\t\tlog.Println(\"Redirection rule added: \" + rule.RedirectURL + \" -> \" + rule.TargetURL)\n+\t\tthisRuleTable.rules.Store(rule.RedirectURL, rule)\n+\t}\n+\n+\treturn &thisRuleTable, nil\n+}\n+\n+func (t *RuleTable) AddRedirectRule(redirectURL string, destURL string, forwardPathname bool, statusCode int) error {\n+\t// Create a new RedirectRules object with the given parameters\n+\tnewRule := &RedirectRules{\n+\t\tRedirectURL:      redirectURL,\n+\t\tTargetURL:        destURL,\n+\t\tForwardChildpath: forwardPathname,\n+\t\tStatusCode:       statusCode,\n+\t}\n+\n+\t// Convert the redirectURL to a valid filename by replacing \"/\" with \"-\" and \".\" with \"_\"\n+\tfilename := strings.ReplaceAll(strings.ReplaceAll(redirectURL, \"/\", \"-\"), \".\", \"_\") + \".json\"\n+\n+\t// Create the full file path by joining the t.configPath with the filename\n+\tfilepath := path.Join(t.configPath, filename)\n+\n+\t// Create a new file for writing the JSON data\n+\tfile, err := os.Create(filepath)\n+\tif err != nil {\n+\t\tlog.Printf(\"Error creating file %s: %s\", filepath, err)\n+\t\treturn err\n+\t}\n+\tdefer file.Close()\n+\n+\t// Encode the RedirectRules object to JSON and write it to the file\n+\terr = json.NewEncoder(file).Encode(newRule)\n+\tif err != nil {\n+\t\tlog.Printf(\"Error encoding JSON to file %s: %s\", filepath, err)\n+\t\treturn err\n+\t}\n+\n+\t// Store the RedirectRules object in the sync.Map\n+\tt.rules.Store(redirectURL, newRule)\n+\n+\treturn nil\n+}\n+\n+func (t *RuleTable) DeleteRedirectRule(redirectURL string) error {\n+\t// Convert the redirectURL to a valid filename by replacing \"/\" with \"-\" and \".\" with \"_\"\n+\tfilename := strings.ReplaceAll(strings.ReplaceAll(redirectURL, \"/\", \"-\"), \".\", \"_\") + \".json\"\n+\n+\t// Create the full file path by joining the t.configPath with the filename\n+\tfilepath := path.Join(t.configPath, filename)\n+\n+\t// Check if the file exists\n+\tif _, err := os.Stat(filepath); os.IsNotExist(err) {\n+\t\treturn nil // File doesn't exist, nothing to delete\n+\t}\n+\n+\t// Delete the file\n+\tif err := os.Remove(filepath); err != nil {\n+\t\tlog.Printf(\"Error deleting file %s: %s\", filepath, err)\n+\t\treturn err\n+\t}\n+\n+\t// Delete the key-value pair from the sync.Map\n+\tt.rules.Delete(redirectURL)\n+\n+\treturn nil\n+}\n+\n+// Get a list of all the redirection rules\n+func (t *RuleTable) GetAllRedirectRules() []*RedirectRules {\n+\trules := []*RedirectRules{}\n+\tt.rules.Range(func(key, value interface{}) bool {\n+\t\tr, ok := value.(*RedirectRules)\n+\t\tif ok {\n+\t\t\trules = append(rules, r)\n+\t\t}\n+\t\treturn true\n+\t})\n+\treturn rules\n+}\n+\n+// Check if a given request URL matched any of the redirection rule\n+func (t *RuleTable) MatchRedirectRule(requestedURL string) *RedirectRules {\n+\t// Iterate through all the keys in the rules map\n+\tvar targetRedirectionRule *RedirectRules = nil\n+\tvar maxMatch int = 0\n+\n+\tt.rules.Range(func(key interface{}, value interface{}) bool {\n+\t\t// Check if the requested URL starts with the key as a prefix\n+\t\tif strings.HasPrefix(requestedURL, key.(string)) {\n+\t\t\t// This request URL matched the domain\n+\t\t\tif len(key.(string)) > maxMatch {\n+\t\t\t\tmaxMatch = len(key.(string))\n+\t\t\t\ttargetRedirectionRule = value.(*RedirectRules)\n+\t\t\t}\n+\t\t}\n+\t\treturn true\n+\t})\n+\n+\treturn targetRedirectionRule\n+}"
            },
            {
                "sha": "c7d4707e56ebf08831ddf415438b061762939956",
                "filename": "src/mod/dynamicproxy/special.go",
                "status": "added",
                "additions": 85,
                "deletions": 0,
                "changes": 85,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fspecial.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fspecial.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2Fspecial.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,85 @@\n+package dynamicproxy\n+\n+import (\n+\t\"errors\"\n+\t\"net/http\"\n+)\n+\n+/*\n+\tSpecial.go\n+\n+\tThis script handle special routing rules\n+\tby external modules\n+*/\n+\n+type RoutingRule struct {\n+\tID             string\n+\tMatchRule      func(r *http.Request) bool\n+\tRoutingHandler http.Handler\n+\tEnabled        bool\n+}\n+\n+//Router functions\n+//Check if a routing rule exists given its id\n+func (router *Router) GetRoutingRuleById(rrid string) (*RoutingRule, error) {\n+\tfor _, rr := range router.routingRules {\n+\t\tif rr.ID == rrid {\n+\t\t\treturn rr, nil\n+\t\t}\n+\t}\n+\n+\treturn nil, errors.New(\"routing rule with given id not found\")\n+}\n+\n+//Add a routing rule to the router\n+func (router *Router) AddRoutingRules(rr *RoutingRule) error {\n+\t_, err := router.GetRoutingRuleById(rr.ID)\n+\tif err != nil {\n+\t\t//routing rule with given id already exists\n+\t\treturn err\n+\t}\n+\n+\trouter.routingRules = append(router.routingRules, rr)\n+\treturn nil\n+}\n+\n+//Remove a routing rule from the router\n+func (router *Router) RemoveRoutingRule(rrid string) {\n+\tnewRoutingRules := []*RoutingRule{}\n+\tfor _, rr := range router.routingRules {\n+\t\tif rr.ID != rrid {\n+\t\t\tnewRoutingRules = append(newRoutingRules, rr)\n+\t\t}\n+\t}\n+\n+\trouter.routingRules = newRoutingRules\n+}\n+\n+//Get all routing rules\n+func (router *Router) GetAllRoutingRules() []*RoutingRule {\n+\treturn router.routingRules\n+}\n+\n+//Get the matching routing rule that describe this request.\n+//Return nil if no routing rule is match\n+func (router *Router) GetMatchingRoutingRule(r *http.Request) *RoutingRule {\n+\tfor _, thisRr := range router.routingRules {\n+\t\tif thisRr.IsMatch(r) {\n+\t\t\treturn thisRr\n+\t\t}\n+\t}\n+\treturn nil\n+}\n+\n+//Routing Rule functions\n+//Check if a request object match the\n+func (e *RoutingRule) IsMatch(r *http.Request) bool {\n+\tif !e.Enabled {\n+\t\treturn false\n+\t}\n+\treturn e.MatchRule(r)\n+}\n+\n+func (e *RoutingRule) Route(w http.ResponseWriter, r *http.Request) {\n+\te.RoutingHandler.ServeHTTP(w, r)\n+}"
            },
            {
                "sha": "ef1873b871a27371009fd0abf4d6b252dc0738e7",
                "filename": "src/mod/dynamicproxy/subdomain.go",
                "status": "added",
                "additions": 44,
                "deletions": 0,
                "changes": 44,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fsubdomain.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fdynamicproxy%2Fsubdomain.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fdynamicproxy%2Fsubdomain.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,44 @@\n+package dynamicproxy\n+\n+import (\n+\t\"log\"\n+\t\"net/url\"\n+\n+\t\"imuslab.com/zoraxy/mod/reverseproxy\"\n+)\n+\n+/*\n+\tAdd an URL intoa custom subdomain service\n+\n+*/\n+\n+func (router *Router) AddSubdomainRoutingService(hostnameWithSubdomain string, domain string, requireTLS bool) error {\n+\tif domain[len(domain)-1:] == \"/\" {\n+\t\tdomain = domain[:len(domain)-1]\n+\t}\n+\n+\twebProxyEndpoint := domain\n+\tif requireTLS {\n+\t\twebProxyEndpoint = \"https://\" + webProxyEndpoint\n+\t} else {\n+\t\twebProxyEndpoint = \"http://\" + webProxyEndpoint\n+\t}\n+\n+\t//Create a new proxy agent for this root\n+\tpath, err := url.Parse(webProxyEndpoint)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tproxy := reverseproxy.NewReverseProxy(path)\n+\n+\trouter.SubdomainEndpoint.Store(hostnameWithSubdomain, &SubdomainEndpoint{\n+\t\tMatchingDomain: hostnameWithSubdomain,\n+\t\tDomain:         domain,\n+\t\tRequireTLS:     requireTLS,\n+\t\tProxy:          proxy,\n+\t})\n+\n+\tlog.Println(\"Adding Subdomain Rule: \", hostnameWithSubdomain+\" to \"+domain)\n+\treturn nil\n+}"
            },
            {
                "sha": "3191c7f1625aff9a5759b9ad9771966dd23a5648",
                "filename": "src/mod/email/email.go",
                "status": "added",
                "additions": 60,
                "deletions": 0,
                "changes": 60,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Femail%2Femail.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Femail%2Femail.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Femail%2Femail.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,60 @@\n+package email\n+\n+import (\n+\t\"net/smtp\"\n+\t\"strconv\"\n+)\n+\n+/*\n+\tEmail.go\n+\n+\tThis script handle mailing services using SMTP protocol\n+*/\n+\n+type Sender struct {\n+\tHostname   string //E.g. mail.gandi.net\n+\tDomain     string //E.g. arozos.com\n+\tPort       int    //E.g. 587\n+\tUsername   string //Username of the email account\n+\tPassword   string //Password of the email account\n+\tSenderAddr string //e.g. admin@arozos.com\n+}\n+\n+//Create a new email sender object\n+func NewEmailSender(hostname string, domain string, port int, username string, password string, senderAddr string) *Sender {\n+\treturn &Sender{\n+\t\tHostname:   hostname,\n+\t\tDomain:     domain,\n+\t\tPort:       port,\n+\t\tUsername:   username,\n+\t\tPassword:   password,\n+\t\tSenderAddr: senderAddr,\n+\t}\n+}\n+\n+/*\n+\tSend a email to a reciving addr\n+\tExample Usage:\n+\tSendEmail(\n+\t\ttest@example.com,\n+\t\t\"Free donuts\",\n+\t\t\"Come get your free donuts on this Sunday!\"\n+\t)\n+*/\n+func (s *Sender) SendEmail(to string, subject string, content string) error {\n+\t//Parse the email content\n+\tmsg := []byte(\"To: \" + to + \"\\n\" +\n+\t\t\"From: Zoraxy <\" + s.SenderAddr + \">\\n\" +\n+\t\t\"Subject: \" + subject + \"\\n\" +\n+\t\t\"MIME-version: 1.0;\\nContent-Type: text/html; charset=\\\"UTF-8\\\";\\n\\n\" +\n+\t\tcontent + \"\\n\\n\")\n+\n+\t//Login to the SMTP server\n+\tauth := smtp.PlainAuth(\"\", s.Username+\"@\"+s.Domain, s.Password, s.Hostname)\n+\terr := smtp.SendMail(s.Hostname+\":\"+strconv.Itoa(s.Port), auth, s.SenderAddr, []string{to}, msg)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\treturn nil\n+}"
            },
            {
                "sha": "006e90d06ab756b2c501bd43645308470aa6a97c",
                "filename": "src/mod/ganserv/authkey.go",
                "status": "added",
                "additions": 80,
                "deletions": 0,
                "changes": 80,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fauthkey.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fauthkey.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fganserv%2Fauthkey.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,80 @@\n+package ganserv\n+\n+import (\n+\t\"errors\"\n+\t\"log\"\n+\t\"os\"\n+\t\"runtime\"\n+\t\"strings\"\n+)\n+\n+func TryLoadorAskUserForAuthkey() (string, error) {\n+\t//Check for zt auth token\n+\tvalue, exists := os.LookupEnv(\"ZT_AUTH\")\n+\tif !exists {\n+\t\tlog.Println(\"Environment variable ZT_AUTH not defined. Trying to load authtoken from file.\")\n+\t} else {\n+\t\treturn value, nil\n+\t}\n+\n+\tauthKey := \"\"\n+\tif runtime.GOOS == \"windows\" {\n+\t\tif isAdmin() {\n+\t\t\t//Read the secret file directly\n+\t\t\tb, err := os.ReadFile(\"C:\\\\ProgramData\\\\ZeroTier\\\\One\\\\authtoken.secret\")\n+\t\t\tif err == nil {\n+\t\t\t\tlog.Println(\"Zerotier authkey loaded\")\n+\t\t\t\tauthKey = string(b)\n+\t\t\t} else {\n+\t\t\t\tlog.Println(\"Unable to read authkey at C:\\\\ProgramData\\\\ZeroTier\\\\One\\\\authtoken.secret: \", err.Error())\n+\t\t\t}\n+\t\t} else {\n+\t\t\t//Elavate the permission to admin\n+\t\t\tak, err := readAuthTokenAsAdmin()\n+\t\t\tif err == nil {\n+\t\t\t\tlog.Println(\"Zerotier authkey loaded\")\n+\t\t\t\tauthKey = ak\n+\t\t\t} else {\n+\t\t\t\tlog.Println(\"Unable to read authkey at C:\\\\ProgramData\\\\ZeroTier\\\\One\\\\authtoken.secret: \", err.Error())\n+\t\t\t}\n+\t\t}\n+\n+\t} else if runtime.GOOS == \"linux\" {\n+\t\tif isAdmin() {\n+\t\t\t//Try to read from source using sudo\n+\t\t\tak, err := readAuthTokenAsAdmin()\n+\t\t\tif err == nil {\n+\t\t\t\tlog.Println(\"Zerotier authkey loaded\")\n+\t\t\t\tauthKey = strings.TrimSpace(ak)\n+\t\t\t} else {\n+\t\t\t\tlog.Println(\"Unable to read authkey at /var/lib/zerotier-one/authtoken.secret: \", err.Error())\n+\t\t\t}\n+\t\t} else {\n+\t\t\t//Try read from source\n+\t\t\tb, err := os.ReadFile(\"/var/lib/zerotier-one/authtoken.secret\")\n+\t\t\tif err == nil {\n+\t\t\t\tlog.Println(\"Zerotier authkey loaded\")\n+\t\t\t\tauthKey = string(b)\n+\t\t\t} else {\n+\t\t\t\tlog.Println(\"Unable to read authkey at /var/lib/zerotier-one/authtoken.secret: \", err.Error())\n+\t\t\t}\n+\t\t}\n+\n+\t} else if runtime.GOOS == \"darwin\" {\n+\t\tb, err := os.ReadFile(\"/Library/Application Support/ZeroTier/One/authtoken.secret\")\n+\t\tif err == nil {\n+\t\t\tlog.Println(\"Zerotier authkey loaded\")\n+\t\t\tauthKey = string(b)\n+\t\t} else {\n+\t\t\tlog.Println(\"Unable to read authkey at /Library/Application Support/ZeroTier/One/authtoken.secret \", err.Error())\n+\t\t}\n+\t}\n+\n+\tauthKey = strings.TrimSpace(authKey)\n+\n+\tif authKey == \"\" {\n+\t\treturn \"\", errors.New(\"Unable to load authkey from file\")\n+\t}\n+\n+\treturn authKey, nil\n+}"
            },
            {
                "sha": "abe50799781dbaeac392eca85cc043ccec95e13d",
                "filename": "src/mod/ganserv/authkeyLinux.go",
                "status": "added",
                "additions": 37,
                "deletions": 0,
                "changes": 37,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2FauthkeyLinux.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2FauthkeyLinux.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fganserv%2FauthkeyLinux.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,37 @@\n+//go:build linux\n+// +build linux\n+\n+package ganserv\n+\n+import (\n+\t\"os\"\n+\t\"os/exec\"\n+\t\"os/user\"\n+\t\"strings\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+func readAuthTokenAsAdmin() (string, error) {\n+\tif utils.FileExists(\"./authtoken.secret\") {\n+\t\tauthKey, err := os.ReadFile(\"./authtoken.secret\")\n+\t\tif err == nil {\n+\t\t\treturn strings.TrimSpace(string(authKey)), nil\n+\t\t}\n+\t}\n+\n+\tcmd := exec.Command(\"sudo\", \"cat\", \"/var/lib/zerotier-one/authtoken.secret\")\n+\toutput, err := cmd.Output()\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\treturn string(output), nil\n+}\n+\n+func isAdmin() bool {\n+\tcurrentUser, err := user.Current()\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\treturn currentUser.Username == \"root\"\n+}"
            },
            {
                "sha": "40bbfc8894aedb6d7d44262809c86160e5a0afe1",
                "filename": "src/mod/ganserv/authkeyWin.go",
                "status": "added",
                "additions": 73,
                "deletions": 0,
                "changes": 73,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2FauthkeyWin.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2FauthkeyWin.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fganserv%2FauthkeyWin.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,73 @@\n+//go:build windows\n+// +build windows\n+\n+package ganserv\n+\n+import (\n+\t\"fmt\"\n+\t\"log\"\n+\t\"os\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\t\"syscall\"\n+\t\"time\"\n+\n+\t\"golang.org/x/sys/windows\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+// Use admin permission to read auth token on Windows\n+func readAuthTokenAsAdmin() (string, error) {\n+\t//Check if the previous startup already extracted the authkey\n+\tif utils.FileExists(\"./authtoken.secret\") {\n+\t\tauthKey, err := os.ReadFile(\"./authtoken.secret\")\n+\t\tif err == nil {\n+\t\t\treturn strings.TrimSpace(string(authKey)), nil\n+\t\t}\n+\t}\n+\n+\tverb := \"runas\"\n+\texe := \"cmd.exe\"\n+\tcwd, _ := os.Getwd()\n+\n+\toutput, _ := filepath.Abs(filepath.Join(\"./\", \"authtoken.secret\"))\n+\tos.WriteFile(output, []byte(\"\"), 0775)\n+\targs := fmt.Sprintf(\"/C type \\\"C:\\\\ProgramData\\\\ZeroTier\\\\One\\\\authtoken.secret\\\" > \\\"\" + output + \"\\\"\")\n+\n+\tverbPtr, _ := syscall.UTF16PtrFromString(verb)\n+\texePtr, _ := syscall.UTF16PtrFromString(exe)\n+\tcwdPtr, _ := syscall.UTF16PtrFromString(cwd)\n+\targPtr, _ := syscall.UTF16PtrFromString(args)\n+\n+\tvar showCmd int32 = 1 //SW_NORMAL\n+\n+\terr := windows.ShellExecute(0, verbPtr, exePtr, argPtr, cwdPtr, showCmd)\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\tlog.Println(\"Please click agree to allow access to ZeroTier authtoken from ProgramData\")\n+\tretry := 0\n+\ttime.Sleep(3 * time.Second)\n+\tfor !utils.FileExists(\"./authtoken.secret\") && retry < 10 {\n+\t\ttime.Sleep(3 * time.Second)\n+\t\tlog.Println(\"Waiting for ZeroTier authtoken extraction...\")\n+\t\tretry++\n+\t}\n+\n+\tauthKey, err := os.ReadFile(\"./authtoken.secret\")\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\treturn strings.TrimSpace(string(authKey)), nil\n+}\n+\n+// Check if admin on Windows\n+func isAdmin() bool {\n+\t_, err := os.Open(\"\\\\\\\\.\\\\PHYSICALDRIVE0\")\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\treturn true\n+}"
            },
            {
                "sha": "34697b8e3fec7ef2d1c84d7a83ea322c07775f9b",
                "filename": "src/mod/ganserv/ganserv.go",
                "status": "added",
                "additions": 128,
                "deletions": 0,
                "changes": 128,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fganserv.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fganserv.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fganserv%2Fganserv.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,128 @@\n+package ganserv\n+\n+import (\n+\t\"net\"\n+\n+\t\"imuslab.com/zoraxy/mod/database\"\n+)\n+\n+/*\n+\tGlobal Area Network\n+\tServer side implementation\n+\n+\tThis module do a few things to help manage\n+\tthe system GANs\n+\n+\t- Provide DHCP assign to client\n+\t- Provide a list of connected nodes in the same VLAN\n+\t- Provide proxy of packet if the target VLAN is online but not reachable\n+\n+\tAlso provide HTTP Handler functions for management\n+\t- Create Network\n+\t- Update Network Properties (Name / Desc)\n+\t- Delete Network\n+\n+\t- Authorize Node\n+\t- Deauthorize Node\n+\t- Set / Get Network Prefered Subnet Mask\n+\t- Handle Node ping\n+*/\n+\n+type Node struct {\n+\tAuth          bool   //If the node is authorized in this network\n+\tClientID      string //The client ID\n+\tMAC           string //The tap MAC this client is using\n+\tName          string //Name of the client in this network\n+\tDescription   string //Description text\n+\tManagedIP     net.IP //The IP address assigned by this network\n+\tLastSeen      int64  //Last time it is seen from this host\n+\tClientVersion string //Client application version\n+\tPublicIP      net.IP //Public IP address as seen from this host\n+}\n+\n+type Network struct {\n+\tUID         string  //UUID of the network, must be a 16 char random ASCII string\n+\tName        string  //Name of the network, ASCII only\n+\tDescription string  //Description of the network\n+\tCIDR        string  //The subnet masked use by this network\n+\tNodes       []*Node //The nodes currently attached in this network\n+}\n+\n+type NetworkManagerOptions struct {\n+\tDatabase  *database.Database\n+\tAuthToken string\n+\tApiPort   int\n+}\n+\n+type NetworkMetaData struct {\n+\tDesc string\n+}\n+\n+type MemberMetaData struct {\n+\tName string\n+}\n+\n+type NetworkManager struct {\n+\tauthToken        string\n+\tapiPort          int\n+\tControllerID     string\n+\toption           *NetworkManagerOptions\n+\tnetworksMetadata map[string]NetworkMetaData\n+}\n+\n+// Create a new GAN manager\n+func NewNetworkManager(option *NetworkManagerOptions) *NetworkManager {\n+\toption.Database.NewTable(\"ganserv\")\n+\n+\t//Load network metadata\n+\tnetworkMeta := map[string]NetworkMetaData{}\n+\tif option.Database.KeyExists(\"ganserv\", \"networkmeta\") {\n+\t\toption.Database.Read(\"ganserv\", \"networkmeta\", &networkMeta)\n+\t}\n+\n+\t//Start the zerotier instance if not exists\n+\n+\t//Get controller info\n+\tinstanceInfo, err := getControllerInfo(option.AuthToken, option.ApiPort)\n+\tif err != nil {\n+\t\treturn &NetworkManager{\n+\t\t\tauthToken:        option.AuthToken,\n+\t\t\tapiPort:          option.ApiPort,\n+\t\t\tControllerID:     \"\",\n+\t\t\toption:           option,\n+\t\t\tnetworksMetadata: networkMeta,\n+\t\t}\n+\t}\n+\n+\treturn &NetworkManager{\n+\t\tauthToken:        option.AuthToken,\n+\t\tapiPort:          option.ApiPort,\n+\t\tControllerID:     instanceInfo.Address,\n+\t\toption:           option,\n+\t\tnetworksMetadata: networkMeta,\n+\t}\n+}\n+\n+func (m *NetworkManager) GetNetworkMetaData(netid string) *NetworkMetaData {\n+\tmd, ok := m.networksMetadata[netid]\n+\tif !ok {\n+\t\treturn &NetworkMetaData{}\n+\t}\n+\n+\treturn &md\n+}\n+\n+func (m *NetworkManager) WriteNetworkMetaData(netid string, meta *NetworkMetaData) {\n+\tm.networksMetadata[netid] = *meta\n+\tm.option.Database.Write(\"ganserv\", \"networkmeta\", m.networksMetadata)\n+}\n+\n+func (m *NetworkManager) GetMemberMetaData(netid string, memid string) *MemberMetaData {\n+\tthisMemberData := MemberMetaData{}\n+\tm.option.Database.Read(\"ganserv\", \"memberdata_\"+netid+\"_\"+memid, &thisMemberData)\n+\treturn &thisMemberData\n+}\n+\n+func (m *NetworkManager) WriteMemeberMetaData(netid string, memid string, meta *MemberMetaData) {\n+\tm.option.Database.Write(\"ganserv\", \"memberdata_\"+netid+\"_\"+memid, meta)\n+}"
            },
            {
                "sha": "c15ae19151890a6680846a72e27ae3a6966ebd51",
                "filename": "src/mod/ganserv/handlers.go",
                "status": "added",
                "additions": 428,
                "deletions": 0,
                "changes": 428,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fhandlers.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fhandlers.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fganserv%2Fhandlers.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,428 @@\n+package ganserv\n+\n+import (\n+\t\"encoding/json\"\n+\t\"net\"\n+\t\"net/http\"\n+\t\"regexp\"\n+\t\"strings\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+func (m *NetworkManager) HandleGetNodeID(w http.ResponseWriter, r *http.Request) {\n+\tif m.ControllerID == \"\" {\n+\t\t//Node id not exists. Check again\n+\t\tinstanceInfo, err := getControllerInfo(m.option.AuthToken, m.option.ApiPort)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"unable to access node id information\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tm.ControllerID = instanceInfo.Address\n+\t}\n+\n+\tjs, _ := json.Marshal(m.ControllerID)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func (m *NetworkManager) HandleAddNetwork(w http.ResponseWriter, r *http.Request) {\n+\tnetworkInfo, err := m.createNetwork()\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\t//Network created. Assign it the standard network settings\n+\terr = m.configureNetwork(networkInfo.Nwid, \"192.168.192.1\", \"192.168.192.254\", \"192.168.192.0/24\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\t// Return the new network ID\n+\tjs, _ := json.Marshal(networkInfo.Nwid)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func (m *NetworkManager) HandleRemoveNetwork(w http.ResponseWriter, r *http.Request) {\n+\tnetworkID, err := utils.PostPara(r, \"id\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid or empty network id given\")\n+\t\treturn\n+\t}\n+\n+\tif !m.networkExists(networkID) {\n+\t\tutils.SendErrorResponse(w, \"network id not exists\")\n+\t\treturn\n+\t}\n+\n+\terr = m.deleteNetwork(networkID)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t}\n+\n+\tutils.SendOK(w)\n+}\n+\n+func (m *NetworkManager) HandleListNetwork(w http.ResponseWriter, r *http.Request) {\n+\tnetid, _ := utils.GetPara(r, \"netid\")\n+\tif netid != \"\" {\n+\t\ttargetNetInfo, err := m.getNetworkInfoById(netid)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(targetNetInfo)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\n+\t} else {\n+\t\t// Return the list of networks as JSON\n+\t\tnetworkIds, err := m.listNetworkIds()\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\n+\t\tnetworkInfos := []*NetworkInfo{}\n+\t\tfor _, id := range networkIds {\n+\t\t\tthisNetInfo, err := m.getNetworkInfoById(id)\n+\t\t\tif err == nil {\n+\t\t\t\tnetworkInfos = append(networkInfos, thisNetInfo)\n+\t\t\t}\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(networkInfos)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t}\n+\n+}\n+\n+func (m *NetworkManager) HandleNetworkNaming(w http.ResponseWriter, r *http.Request) {\n+\tnetid, err := utils.PostPara(r, \"netid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"network id not given\")\n+\t\treturn\n+\t}\n+\n+\tif !m.networkExists(netid) {\n+\t\tutils.SendErrorResponse(w, \"network not eixsts\")\n+\t}\n+\n+\tnewName, _ := utils.PostPara(r, \"name\")\n+\tnewDesc, _ := utils.PostPara(r, \"desc\")\n+\tif newName != \"\" && newDesc != \"\" {\n+\t\t//Strip away html from name and desc\n+\t\tre := regexp.MustCompile(\"<[^>]*>\")\n+\t\tnewName := re.ReplaceAllString(newName, \"\")\n+\t\tnewDesc := re.ReplaceAllString(newDesc, \"\")\n+\n+\t\t//Set the new network name and desc\n+\t\terr = m.setNetworkNameAndDescription(netid, newName, newDesc)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\n+\t\tutils.SendOK(w)\n+\t} else {\n+\t\t//Get current name and description\n+\t\tname, desc, err := m.getNetworkNameAndDescription(netid)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal([]string{name, desc})\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t}\n+}\n+\n+func (m *NetworkManager) HandleNetworkDetails(w http.ResponseWriter, r *http.Request) {\n+\tnetid, err := utils.PostPara(r, \"netid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"netid not given\")\n+\t\treturn\n+\t}\n+\n+\ttargetNetwork, err := m.getNetworkInfoById(netid)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tjs, _ := json.Marshal(targetNetwork)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func (m *NetworkManager) HandleSetRanges(w http.ResponseWriter, r *http.Request) {\n+\tnetid, err := utils.PostPara(r, \"netid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"netid not given\")\n+\t\treturn\n+\t}\n+\tcidr, err := utils.PostPara(r, \"cidr\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"cidr not given\")\n+\t\treturn\n+\t}\n+\tipstart, err := utils.PostPara(r, \"ipstart\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"ipstart not given\")\n+\t\treturn\n+\t}\n+\tipend, err := utils.PostPara(r, \"ipend\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"ipend not given\")\n+\t\treturn\n+\t}\n+\n+\t//Validate the CIDR is real, the ip range is within the CIDR range\n+\t_, ipnet, err := net.ParseCIDR(cidr)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid cidr string given\")\n+\t\treturn\n+\t}\n+\n+\tstartIP := net.ParseIP(ipstart)\n+\tendIP := net.ParseIP(ipend)\n+\tif startIP == nil || endIP == nil {\n+\t\tutils.SendErrorResponse(w, \"invalid start or end ip given\")\n+\t\treturn\n+\t}\n+\n+\twithinRange := ipnet.Contains(startIP) && ipnet.Contains(endIP)\n+\tif !withinRange {\n+\t\tutils.SendErrorResponse(w, \"given CIDR did not cover all of the start to end ip range\")\n+\t\treturn\n+\t}\n+\n+\terr = m.configureNetwork(netid, startIP.String(), endIP.String(), strings.TrimSpace(cidr))\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tutils.SendOK(w)\n+}\n+\n+//Handle listing of network members. Set details=true for listing all details\n+func (m *NetworkManager) HandleMemberList(w http.ResponseWriter, r *http.Request) {\n+\tnetid, err := utils.GetPara(r, \"netid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"netid is empty\")\n+\t\treturn\n+\t}\n+\n+\tdetails, _ := utils.GetPara(r, \"detail\")\n+\n+\tmemberIds, err := m.getNetworkMembers(netid)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\tif details == \"\" {\n+\t\t//Only show client ids\n+\t\tjs, _ := json.Marshal(memberIds)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\t//Show detail members info\n+\t\tdetailMemberInfo := []*MemberInfo{}\n+\t\tfor _, thisMemberId := range memberIds {\n+\t\t\tmemInfo, err := m.getNetworkMemberInfo(netid, thisMemberId)\n+\t\t\tif err == nil {\n+\t\t\t\tdetailMemberInfo = append(detailMemberInfo, memInfo)\n+\t\t\t}\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(detailMemberInfo)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t}\n+}\n+\n+//Handle Authorization of members\n+func (m *NetworkManager) HandleMemberAuthorization(w http.ResponseWriter, r *http.Request) {\n+\tnetid, err := utils.PostPara(r, \"netid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"net id not set\")\n+\t\treturn\n+\t}\n+\n+\tmemberid, err := utils.PostPara(r, \"memid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"memid not set\")\n+\t\treturn\n+\t}\n+\n+\t//Check if the target memeber exists\n+\tif !m.memberExistsInNetwork(netid, memberid) {\n+\t\tutils.SendErrorResponse(w, \"member not exists in given network\")\n+\t\treturn\n+\t}\n+\n+\tsetAuthorized, err := utils.PostPara(r, \"auth\")\n+\tif err != nil || setAuthorized == \"\" {\n+\t\t//Get the member authorization state\n+\t\tmemberInfo, err := m.getNetworkMemberInfo(netid, memberid)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(memberInfo.Authorized)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else if setAuthorized == \"true\" {\n+\t\tm.AuthorizeMember(netid, memberid, true)\n+\t} else if setAuthorized == \"false\" {\n+\t\tm.AuthorizeMember(netid, memberid, false)\n+\t} else {\n+\t\tutils.SendErrorResponse(w, \"unknown operation state: \"+setAuthorized)\n+\t}\n+}\n+\n+//Handle Delete or Add IP for a member in a network\n+func (m *NetworkManager) HandleMemberIP(w http.ResponseWriter, r *http.Request) {\n+\tnetid, err := utils.PostPara(r, \"netid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"net id not set\")\n+\t\treturn\n+\t}\n+\n+\tmemberid, err := utils.PostPara(r, \"memid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"memid not set\")\n+\t\treturn\n+\t}\n+\n+\topr, err := utils.PostPara(r, \"opr\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"opr not defined\")\n+\t\treturn\n+\t}\n+\n+\ttargetip, _ := utils.PostPara(r, \"ip\")\n+\n+\tmemberInfo, err := m.getNetworkMemberInfo(netid, memberid)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tif opr == \"add\" {\n+\t\tif targetip == \"\" {\n+\t\t\tutils.SendErrorResponse(w, \"ip not set\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tif !isValidIPAddr(targetip) {\n+\t\t\tutils.SendErrorResponse(w, \"ip address not valid\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tnewIpList := append(memberInfo.IPAssignments, targetip)\n+\t\terr = m.setAssignedIps(netid, memberid, newIpList)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\t\tutils.SendOK(w)\n+\n+\t} else if opr == \"del\" {\n+\t\tif targetip == \"\" {\n+\t\t\tutils.SendErrorResponse(w, \"ip not set\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\t//Delete user ip from the list\n+\t\tnewIpList := []string{}\n+\t\tfor _, thisIp := range memberInfo.IPAssignments {\n+\t\t\tif thisIp != targetip {\n+\t\t\t\tnewIpList = append(newIpList, thisIp)\n+\t\t\t}\n+\t\t}\n+\n+\t\terr = m.setAssignedIps(netid, memberid, newIpList)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\t\tutils.SendOK(w)\n+\t} else if opr == \"get\" {\n+\t\tjs, _ := json.Marshal(memberInfo.IPAssignments)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\tutils.SendErrorResponse(w, \"unsupported opr type: \"+opr)\n+\t}\n+}\n+\n+//Handle naming for members\n+func (m *NetworkManager) HandleMemberNaming(w http.ResponseWriter, r *http.Request) {\n+\tnetid, err := utils.PostPara(r, \"netid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"net id not set\")\n+\t\treturn\n+\t}\n+\n+\tmemberid, err := utils.PostPara(r, \"memid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"memid not set\")\n+\t\treturn\n+\t}\n+\n+\tif !m.memberExistsInNetwork(netid, memberid) {\n+\t\tutils.SendErrorResponse(w, \"target member not exists in given network\")\n+\t\treturn\n+\t}\n+\n+\t//Read memeber data\n+\ttargetMemberData := m.GetMemberMetaData(netid, memberid)\n+\n+\tnewname, err := utils.PostPara(r, \"name\")\n+\tif err != nil {\n+\t\t//Send over the member data\n+\t\tjs, _ := json.Marshal(targetMemberData)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\t//Write member data\n+\t\ttargetMemberData.Name = newname\n+\t\tm.WriteMemeberMetaData(netid, memberid, targetMemberData)\n+\t\tutils.SendOK(w)\n+\t}\n+}\n+\n+//Handle delete of a given memver\n+func (m *NetworkManager) HandleMemberDelete(w http.ResponseWriter, r *http.Request) {\n+\tnetid, err := utils.PostPara(r, \"netid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"net id not set\")\n+\t\treturn\n+\t}\n+\n+\tmemberid, err := utils.PostPara(r, \"memid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"memid not set\")\n+\t\treturn\n+\t}\n+\n+\t//Check if that member is authorized.\n+\tmemberInfo, err := m.getNetworkMemberInfo(netid, memberid)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"member not exists in given GANet\")\n+\t\treturn\n+\t}\n+\n+\tif memberInfo.Authorized {\n+\t\t//Deauthorized this member before deleting\n+\t\tm.AuthorizeMember(netid, memberid, false)\n+\t}\n+\n+\t//Remove the memeber\n+\terr = m.deleteMember(netid, memberid)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tutils.SendOK(w)\n+}"
            },
            {
                "sha": "9f4ec73a601f18230949e8ba3d0d55598d04ddea",
                "filename": "src/mod/ganserv/network.go",
                "status": "added",
                "additions": 39,
                "deletions": 0,
                "changes": 39,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fnetwork.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fnetwork.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fganserv%2Fnetwork.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,39 @@\n+package ganserv\n+\n+import (\n+\t\"fmt\"\n+\t\"math/rand\"\n+\t\"net\"\n+\t\"time\"\n+)\n+\n+//Get a random free IP from the pool\n+func (n *Network) GetRandomFreeIP() (net.IP, error) {\n+\t// Get all IP addresses in the subnet\n+\tips, err := GetAllAddressFromCIDR(n.CIDR)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\t// Filter out used IPs\n+\tusedIPs := make(map[string]bool)\n+\tfor _, node := range n.Nodes {\n+\t\tusedIPs[node.ManagedIP.String()] = true\n+\t}\n+\tavailableIPs := []string{}\n+\tfor _, ip := range ips {\n+\t\tif !usedIPs[ip] {\n+\t\t\tavailableIPs = append(availableIPs, ip)\n+\t\t}\n+\t}\n+\n+\t// Randomly choose an available IP\n+\tif len(availableIPs) == 0 {\n+\t\treturn nil, fmt.Errorf(\"no available IP\")\n+\t}\n+\trand.Seed(time.Now().UnixNano())\n+\trandIndex := rand.Intn(len(availableIPs))\n+\tpickedFreeIP := availableIPs[randIndex]\n+\n+\treturn net.ParseIP(pickedFreeIP), nil\n+}"
            },
            {
                "sha": "5857915e22b07f2c5e45221cbfe94473984aba86",
                "filename": "src/mod/ganserv/network_test.go",
                "status": "added",
                "additions": 55,
                "deletions": 0,
                "changes": 55,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fnetwork_test.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fnetwork_test.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fganserv%2Fnetwork_test.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,55 @@\n+package ganserv_test\n+\n+import (\n+\t\"fmt\"\n+\t\"net\"\n+\t\"strconv\"\n+\t\"testing\"\n+\n+\t\"imuslab.com/zoraxy/mod/ganserv\"\n+)\n+\n+func TestGetRandomFreeIP(t *testing.T) {\n+\tn := ganserv.Network{\n+\t\tCIDR: \"172.16.0.0/12\",\n+\t\tNodes: []*ganserv.Node{\n+\t\t\t{\n+\t\t\t\tName:      \"nodeC1\",\n+\t\t\t\tManagedIP: net.ParseIP(\"172.16.1.142\"),\n+\t\t\t},\n+\t\t\t{\n+\t\t\t\tName:      \"nodeC2\",\n+\t\t\t\tManagedIP: net.ParseIP(\"172.16.5.174\"),\n+\t\t\t},\n+\t\t},\n+\t}\n+\n+\t// Call the function for 10 times\n+\tfor i := 0; i < 10; i++ {\n+\t\tfreeIP, err := n.GetRandomFreeIP()\n+\t\tfmt.Println(\"[\"+strconv.Itoa(i)+\"] Free IP address assigned: \", freeIP)\n+\n+\t\t// Assert that no error occurred\n+\t\tif err != nil {\n+\t\t\tt.Errorf(\"Unexpected error: %s\", err.Error())\n+\t\t}\n+\n+\t\t// Assert that the returned IP is a valid IPv4 address\n+\t\tif freeIP.To4() == nil {\n+\t\t\tt.Errorf(\"Invalid IP address format: %s\", freeIP.String())\n+\t\t}\n+\n+\t\t// Assert that the returned IP is not already used by a node\n+\t\tfor _, node := range n.Nodes {\n+\t\t\tif freeIP.Equal(node.ManagedIP) {\n+\t\t\t\tt.Errorf(\"Returned IP is already in use: %s\", freeIP.String())\n+\t\t\t}\n+\t\t}\n+\n+\t\tn.Nodes = append(n.Nodes, &ganserv.Node{\n+\t\t\tName:      \"NodeT\" + strconv.Itoa(i),\n+\t\t\tManagedIP: freeIP,\n+\t\t})\n+\t}\n+\n+}"
            },
            {
                "sha": "684f597bb9325ca0a39e347218dc3f256e9d1707",
                "filename": "src/mod/ganserv/utils.go",
                "status": "added",
                "additions": 55,
                "deletions": 0,
                "changes": 55,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Futils.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Futils.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fganserv%2Futils.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,55 @@\n+package ganserv\n+\n+import (\n+\t\"net\"\n+)\n+\n+//Generate all ip address from a CIDR\n+func GetAllAddressFromCIDR(cidr string) ([]string, error) {\n+\tip, ipnet, err := net.ParseCIDR(cidr)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tvar ips []string\n+\tfor ip := ip.Mask(ipnet.Mask); ipnet.Contains(ip); inc(ip) {\n+\t\tips = append(ips, ip.String())\n+\t}\n+\t// remove network address and broadcast address\n+\treturn ips[1 : len(ips)-1], nil\n+}\n+\n+func inc(ip net.IP) {\n+\tfor j := len(ip) - 1; j >= 0; j-- {\n+\t\tip[j]++\n+\t\tif ip[j] > 0 {\n+\t\t\tbreak\n+\t\t}\n+\t}\n+}\n+\n+func isValidIPAddr(ipAddr string) bool {\n+\tip := net.ParseIP(ipAddr)\n+\tif ip == nil {\n+\t\treturn false\n+\t}\n+\n+\treturn true\n+}\n+\n+func ipWithinCIDR(ipAddr string, cidr string) bool {\n+\t// Parse the CIDR string\n+\t_, ipNet, err := net.ParseCIDR(cidr)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\t// Parse the IP address\n+\tip := net.ParseIP(ipAddr)\n+\tif ip == nil {\n+\t\treturn false\n+\t}\n+\n+\t// Check if the IP address is in the CIDR range\n+\treturn ipNet.Contains(ip)\n+}"
            },
            {
                "sha": "3016948b65a3aad04fafbb3df464db88dae53598",
                "filename": "src/mod/ganserv/zerotier.go",
                "status": "added",
                "additions": 622,
                "deletions": 0,
                "changes": 622,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fzerotier.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fganserv%2Fzerotier.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fganserv%2Fzerotier.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,622 @@\n+package ganserv\n+\n+import (\n+\t\"bytes\"\n+\t\"encoding/json\"\n+\t\"errors\"\n+\t\"fmt\"\n+\t\"io\"\n+\t\"net/http\"\n+\t\"os\"\n+\t\"strconv\"\n+\t\"strings\"\n+)\n+\n+/*\n+\tzerotier.go\n+\n+\tThis hold the functions that required to communicate with\n+\ta zerotier instance\n+\n+\tSee more on\n+\thttps://docs.zerotier.com/self-hosting/network-controllers/\n+\n+*/\n+\n+type NodeInfo struct {\n+\tAddress string `json:\"address\"`\n+\tClock   int64  `json:\"clock\"`\n+\tConfig  struct {\n+\t\tSettings struct {\n+\t\t\tAllowTCPFallbackRelay bool   `json:\"allowTcpFallbackRelay\"`\n+\t\t\tPortMappingEnabled    bool   `json:\"portMappingEnabled\"`\n+\t\t\tPrimaryPort           int    `json:\"primaryPort\"`\n+\t\t\tSoftwareUpdate        string `json:\"softwareUpdate\"`\n+\t\t\tSoftwareUpdateChannel string `json:\"softwareUpdateChannel\"`\n+\t\t} `json:\"settings\"`\n+\t} `json:\"config\"`\n+\tOnline               bool   `json:\"online\"`\n+\tPlanetWorldID        int    `json:\"planetWorldId\"`\n+\tPlanetWorldTimestamp int64  `json:\"planetWorldTimestamp\"`\n+\tPublicIdentity       string `json:\"publicIdentity\"`\n+\tTCPFallbackActive    bool   `json:\"tcpFallbackActive\"`\n+\tVersion              string `json:\"version\"`\n+\tVersionBuild         int    `json:\"versionBuild\"`\n+\tVersionMajor         int    `json:\"versionMajor\"`\n+\tVersionMinor         int    `json:\"versionMinor\"`\n+\tVersionRev           int    `json:\"versionRev\"`\n+}\n+\n+type ErrResp struct {\n+\tMessage string `json:\"message\"`\n+}\n+\n+type NetworkInfo struct {\n+\tAuthTokens            []interface{} `json:\"authTokens\"`\n+\tAuthorizationEndpoint string        `json:\"authorizationEndpoint\"`\n+\tCapabilities          []interface{} `json:\"capabilities\"`\n+\tClientID              string        `json:\"clientId\"`\n+\tCreationTime          int64         `json:\"creationTime\"`\n+\tDNS                   []interface{} `json:\"dns\"`\n+\tEnableBroadcast       bool          `json:\"enableBroadcast\"`\n+\tID                    string        `json:\"id\"`\n+\tIPAssignmentPools     []interface{} `json:\"ipAssignmentPools\"`\n+\tMtu                   int           `json:\"mtu\"`\n+\tMulticastLimit        int           `json:\"multicastLimit\"`\n+\tName                  string        `json:\"name\"`\n+\tNwid                  string        `json:\"nwid\"`\n+\tObjtype               string        `json:\"objtype\"`\n+\tPrivate               bool          `json:\"private\"`\n+\tRemoteTraceLevel      int           `json:\"remoteTraceLevel\"`\n+\tRemoteTraceTarget     interface{}   `json:\"remoteTraceTarget\"`\n+\tRevision              int           `json:\"revision\"`\n+\tRoutes                []interface{} `json:\"routes\"`\n+\tRules                 []struct {\n+\t\tNot  bool   `json:\"not\"`\n+\t\tOr   bool   `json:\"or\"`\n+\t\tType string `json:\"type\"`\n+\t} `json:\"rules\"`\n+\tRulesSource  string        `json:\"rulesSource\"`\n+\tSsoEnabled   bool          `json:\"ssoEnabled\"`\n+\tTags         []interface{} `json:\"tags\"`\n+\tV4AssignMode struct {\n+\t\tZt bool `json:\"zt\"`\n+\t} `json:\"v4AssignMode\"`\n+\tV6AssignMode struct {\n+\t\tSixPlane bool `json:\"6plane\"`\n+\t\tRfc4193  bool `json:\"rfc4193\"`\n+\t\tZt       bool `json:\"zt\"`\n+\t} `json:\"v6AssignMode\"`\n+}\n+\n+type MemberInfo struct {\n+\tActiveBridge                 bool          `json:\"activeBridge\"`\n+\tAddress                      string        `json:\"address\"`\n+\tAuthenticationExpiryTime     int           `json:\"authenticationExpiryTime\"`\n+\tAuthorized                   bool          `json:\"authorized\"`\n+\tCapabilities                 []interface{} `json:\"capabilities\"`\n+\tCreationTime                 int64         `json:\"creationTime\"`\n+\tID                           string        `json:\"id\"`\n+\tIdentity                     string        `json:\"identity\"`\n+\tIPAssignments                []string      `json:\"ipAssignments\"`\n+\tLastAuthorizedCredential     interface{}   `json:\"lastAuthorizedCredential\"`\n+\tLastAuthorizedCredentialType string        `json:\"lastAuthorizedCredentialType\"`\n+\tLastAuthorizedTime           int           `json:\"lastAuthorizedTime\"`\n+\tLastDeauthorizedTime         int           `json:\"lastDeauthorizedTime\"`\n+\tNoAutoAssignIps              bool          `json:\"noAutoAssignIps\"`\n+\tNwid                         string        `json:\"nwid\"`\n+\tObjtype                      string        `json:\"objtype\"`\n+\tRemoteTraceLevel             int           `json:\"remoteTraceLevel\"`\n+\tRemoteTraceTarget            interface{}   `json:\"remoteTraceTarget\"`\n+\tRevision                     int           `json:\"revision\"`\n+\tSsoExempt                    bool          `json:\"ssoExempt\"`\n+\tTags                         []interface{} `json:\"tags\"`\n+\tVMajor                       int           `json:\"vMajor\"`\n+\tVMinor                       int           `json:\"vMinor\"`\n+\tVProto                       int           `json:\"vProto\"`\n+\tVRev                         int           `json:\"vRev\"`\n+}\n+\n+//Get the zerotier node info from local service\n+func getControllerInfo(token string, apiPort int) (*NodeInfo, error) {\n+\turl := \"http://localhost:\" + strconv.Itoa(apiPort) + \"/status\"\n+\n+\treq, err := http.NewRequest(\"GET\", url, nil)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\treq.Header.Set(\"X-ZT1-AUTH\", token)\n+\tclient := &http.Client{}\n+\tresp, err := client.Do(req)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\t//Read from zerotier service instance\n+\n+\tdefer resp.Body.Close()\n+\tpayload, err := io.ReadAll(resp.Body)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\t//Parse the payload into struct\n+\tthisInstanceInfo := NodeInfo{}\n+\terr = json.Unmarshal(payload, &thisInstanceInfo)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\treturn &thisInstanceInfo, nil\n+}\n+\n+/*\n+\tNetwork Functions\n+*/\n+//Create a zerotier network\n+func (m *NetworkManager) createNetwork() (*NetworkInfo, error) {\n+\turl := fmt.Sprintf(\"http://localhost:\"+strconv.Itoa(m.apiPort)+\"/controller/network/%s______\", m.ControllerID)\n+\n+\tdata := []byte(`{}`)\n+\treq, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(data))\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\treq.Header.Set(\"X-ZT1-AUTH\", m.authToken)\n+\tclient := &http.Client{}\n+\tresp, err := client.Do(req)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tdefer resp.Body.Close()\n+\n+\tpayload, err := io.ReadAll(resp.Body)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tnetworkInfo := NetworkInfo{}\n+\terr = json.Unmarshal(payload, &networkInfo)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\treturn &networkInfo, nil\n+}\n+\n+//List network details\n+func (m *NetworkManager) getNetworkInfoById(networkId string) (*NetworkInfo, error) {\n+\treq, err := http.NewRequest(\"GET\", os.ExpandEnv(\"http://localhost:\"+strconv.Itoa(m.apiPort)+\"/controller/network/\"+networkId+\"/\"), nil)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\treq.Header.Set(\"X-Zt1-Auth\", m.authToken)\n+\n+\tresp, err := http.DefaultClient.Do(req)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tdefer resp.Body.Close()\n+\tif resp.StatusCode != 200 {\n+\t\treturn nil, errors.New(\"network error. Status code: \" + strconv.Itoa(resp.StatusCode))\n+\t}\n+\n+\tthisNetworkInfo := NetworkInfo{}\n+\tpayload, err := io.ReadAll(resp.Body)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\terr = json.Unmarshal(payload, &thisNetworkInfo)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\treturn &thisNetworkInfo, nil\n+}\n+\n+func (m *NetworkManager) setNetworkInfoByID(networkId string, newNetworkInfo *NetworkInfo) error {\n+\tpayloadBytes, err := json.Marshal(newNetworkInfo)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tpayloadBuffer := bytes.NewBuffer(payloadBytes)\n+\n+\t// Create the HTTP request\n+\turl := \"http://localhost:\" + strconv.Itoa(m.apiPort) + \"/controller/network/\" + networkId + \"/\"\n+\treq, err := http.NewRequest(\"POST\", url, payloadBuffer)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\treq.Header.Set(\"X-Zt1-Auth\", m.authToken)\n+\treq.Header.Set(\"Content-Type\", \"application/json\")\n+\n+\t// Send the HTTP request\n+\tresp, err := http.DefaultClient.Do(req)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tdefer resp.Body.Close()\n+\n+\t// Print the response status code\n+\tif resp.StatusCode != 200 {\n+\t\treturn errors.New(\"network error. status code: \" + strconv.Itoa(resp.StatusCode))\n+\t}\n+\n+\treturn nil\n+}\n+\n+//List network IDs\n+func (m *NetworkManager) listNetworkIds() ([]string, error) {\n+\treq, err := http.NewRequest(\"GET\", \"http://localhost:\"+strconv.Itoa(m.apiPort)+\"/controller/network/\", nil)\n+\tif err != nil {\n+\t\treturn []string{}, err\n+\t}\n+\treq.Header.Set(\"X-Zt1-Auth\", m.authToken)\n+\n+\tresp, err := http.DefaultClient.Do(req)\n+\tif err != nil {\n+\t\treturn []string{}, err\n+\t}\n+\tdefer resp.Body.Close()\n+\n+\tif resp.StatusCode != 200 {\n+\t\treturn []string{}, errors.New(\"network error\")\n+\t}\n+\n+\tnetworkIds := []string{}\n+\tpayload, err := io.ReadAll(resp.Body)\n+\tif err != nil {\n+\t\treturn []string{}, err\n+\t}\n+\n+\terr = json.Unmarshal(payload, &networkIds)\n+\tif err != nil {\n+\t\treturn []string{}, err\n+\t}\n+\n+\treturn networkIds, nil\n+}\n+\n+//wrapper for checking if a network id exists\n+func (m *NetworkManager) networkExists(networkId string) bool {\n+\tnetworkIds, err := m.listNetworkIds()\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\tfor _, thisid := range networkIds {\n+\t\tif thisid == networkId {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\n+\treturn false\n+}\n+\n+//delete a network\n+func (m *NetworkManager) deleteNetwork(networkID string) error {\n+\turl := \"http://localhost:\" + strconv.Itoa(m.apiPort) + \"/controller/network/\" + networkID + \"/\"\n+\tclient := &http.Client{}\n+\n+\t// Create a new DELETE request\n+\treq, err := http.NewRequest(\"DELETE\", url, nil)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\t// Add the required authorization header\n+\treq.Header.Set(\"X-Zt1-Auth\", m.authToken)\n+\n+\t// Send the request and get the response\n+\tresp, err := client.Do(req)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\t// Close the response body when we're done\n+\tdefer resp.Body.Close()\n+\ts, err := io.ReadAll(resp.Body)\n+\tfmt.Println(string(s), err, resp.StatusCode)\n+\n+\t// Print the response status code\n+\tif resp.StatusCode != 200 {\n+\t\treturn errors.New(\"network error. status code: \" + strconv.Itoa(resp.StatusCode))\n+\t}\n+\n+\treturn nil\n+}\n+\n+//Configure network\n+//Example: configureNetwork(netid, \"192.168.192.1\", \"192.168.192.254\", \"192.168.192.0/24\")\n+func (m *NetworkManager) configureNetwork(networkID string, ipRangeStart string, ipRangeEnd string, routeTarget string) error {\n+\turl := \"http://localhost:\" + strconv.Itoa(m.apiPort) + \"/controller/network/\" + networkID + \"/\"\n+\tdata := map[string]interface{}{\n+\t\t\"ipAssignmentPools\": []map[string]string{\n+\t\t\t{\n+\t\t\t\t\"ipRangeStart\": ipRangeStart,\n+\t\t\t\t\"ipRangeEnd\":   ipRangeEnd,\n+\t\t\t},\n+\t\t},\n+\t\t\"routes\": []map[string]interface{}{\n+\t\t\t{\n+\t\t\t\t\"target\": routeTarget,\n+\t\t\t\t\"via\":    nil,\n+\t\t\t},\n+\t\t},\n+\t\t\"v4AssignMode\": \"zt\",\n+\t\t\"private\":      true,\n+\t}\n+\n+\tpayload, err := json.Marshal(data)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\treq, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(payload))\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\treq.Header.Set(\"Content-Type\", \"application/json\")\n+\treq.Header.Set(\"X-ZT1-AUTH\", m.authToken)\n+\n+\tclient := &http.Client{}\n+\tresp, err := client.Do(req)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tdefer resp.Body.Close()\n+\t// Print the response status code\n+\tif resp.StatusCode != 200 {\n+\t\treturn errors.New(\"network error. status code: \" + strconv.Itoa(resp.StatusCode))\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (m *NetworkManager) setAssignedIps(networkID string, memid string, newIps []string) error {\n+\turl := \"http://localhost:\" + strconv.Itoa(m.apiPort) + \"/controller/network/\" + networkID + \"/member/\" + memid\n+\tdata := map[string]interface{}{\n+\t\t\"ipAssignments\": newIps,\n+\t}\n+\n+\tpayload, err := json.Marshal(data)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\treq, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(payload))\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\treq.Header.Set(\"Content-Type\", \"application/json\")\n+\treq.Header.Set(\"X-ZT1-AUTH\", m.authToken)\n+\n+\tclient := &http.Client{}\n+\tresp, err := client.Do(req)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tdefer resp.Body.Close()\n+\t// Print the response status code\n+\tif resp.StatusCode != 200 {\n+\t\treturn errors.New(\"network error. status code: \" + strconv.Itoa(resp.StatusCode))\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (m *NetworkManager) setNetworkNameAndDescription(netid string, name string, desc string) error {\n+\t// Convert string to rune slice\n+\tr := []rune(name)\n+\n+\t// Loop over runes and remove non-ASCII characters\n+\tfor i, v := range r {\n+\t\tif v > 127 {\n+\t\t\tr[i] = ' '\n+\t\t}\n+\t}\n+\n+\t// Convert back to string and trim whitespace\n+\tname = strings.TrimSpace(string(r))\n+\n+\turl := \"http://localhost:\" + strconv.Itoa(m.apiPort) + \"/controller/network/\" + netid + \"/\"\n+\tdata := map[string]interface{}{\n+\t\t\"name\": name,\n+\t}\n+\n+\tpayload, err := json.Marshal(data)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\treq, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(payload))\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\treq.Header.Set(\"Content-Type\", \"application/json\")\n+\treq.Header.Set(\"X-ZT1-AUTH\", m.authToken)\n+\n+\tclient := &http.Client{}\n+\tresp, err := client.Do(req)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tdefer resp.Body.Close()\n+\t// Print the response status code\n+\tif resp.StatusCode != 200 {\n+\t\treturn errors.New(\"network error. status code: \" + strconv.Itoa(resp.StatusCode))\n+\t}\n+\n+\tmeta := m.GetNetworkMetaData(netid)\n+\tif meta != nil {\n+\t\tmeta.Desc = desc\n+\t\tm.WriteNetworkMetaData(netid, meta)\n+\t}\n+\n+\treturn nil\n+}\n+\n+func (m *NetworkManager) getNetworkNameAndDescription(netid string) (string, string, error) {\n+\t//Get name from network info\n+\tnetinfo, err := m.getNetworkInfoById(netid)\n+\tif err != nil {\n+\t\treturn \"\", \"\", err\n+\t}\n+\n+\tname := netinfo.Name\n+\n+\t//Get description from meta\n+\tdesc := \"\"\n+\tnetworkMeta := m.GetNetworkMetaData(netid)\n+\tif networkMeta != nil {\n+\t\tdesc = networkMeta.Desc\n+\t}\n+\n+\treturn name, desc, nil\n+}\n+\n+/*\n+\tMember functions\n+*/\n+\n+func (m *NetworkManager) getNetworkMembers(networkId string) ([]string, error) {\n+\turl := \"http://localhost:\" + strconv.Itoa(m.apiPort) + \"/controller/network/\" + networkId + \"/member\"\n+\treqBody := bytes.NewBuffer([]byte{})\n+\treq, err := http.NewRequest(\"GET\", url, reqBody)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\treq.Header.Set(\"X-ZT1-AUTH\", m.authToken)\n+\n+\tclient := &http.Client{}\n+\tresp, err := client.Do(req)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tdefer resp.Body.Close()\n+\n+\tif resp.StatusCode != http.StatusOK {\n+\t\treturn nil, errors.New(\"failed to get network members\")\n+\t}\n+\n+\tmemberList := map[string]int{}\n+\tpayload, err := io.ReadAll(resp.Body)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\terr = json.Unmarshal(payload, &memberList)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tmembers := make([]string, 0, len(memberList))\n+\tfor k := range memberList {\n+\t\tmembers = append(members, k)\n+\t}\n+\n+\treturn members, nil\n+}\n+\n+func (m *NetworkManager) memberExistsInNetwork(netid string, memid string) bool {\n+\t//Get a list of member\n+\tmemberids, err := m.getNetworkMembers(netid)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\tfor _, thisMemberId := range memberids {\n+\t\tif thisMemberId == memid {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\n+\treturn false\n+}\n+\n+//Get a network memeber info by netid and memberid\n+func (m *NetworkManager) getNetworkMemberInfo(netid string, memberid string) (*MemberInfo, error) {\n+\treq, err := http.NewRequest(\"GET\", \"http://localhost:\"+strconv.Itoa(m.apiPort)+\"/controller/network/\"+netid+\"/member/\"+memberid, nil)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\treq.Header.Set(\"X-Zt1-Auth\", m.authToken)\n+\n+\tresp, err := http.DefaultClient.Do(req)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tdefer resp.Body.Close()\n+\n+\tthisMemeberInfo := &MemberInfo{}\n+\tpayload, err := io.ReadAll(resp.Body)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\terr = json.Unmarshal(payload, &thisMemeberInfo)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\treturn thisMemeberInfo, nil\n+}\n+\n+//Set the authorization state of a member\n+func (m *NetworkManager) AuthorizeMember(netid string, memberid string, setAuthorized bool) error {\n+\turl := \"http://localhost:\" + strconv.Itoa(m.apiPort) + \"/controller/network/\" + netid + \"/member/\" + memberid\n+\tpayload := []byte(`{\"authorized\": true}`)\n+\tif !setAuthorized {\n+\t\tpayload = []byte(`{\"authorized\": false}`)\n+\t}\n+\n+\treq, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(payload))\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\treq.Header.Set(\"X-ZT1-AUTH\", m.authToken)\n+\tclient := &http.Client{}\n+\tresp, err := client.Do(req)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tdefer resp.Body.Close()\n+\n+\tif resp.StatusCode != 200 {\n+\t\treturn errors.New(\"network error. Status code: \" + strconv.Itoa(resp.StatusCode))\n+\t}\n+\n+\treturn nil\n+}\n+\n+//Delete a member from the network\n+func (m *NetworkManager) deleteMember(netid string, memid string) error {\n+\treq, err := http.NewRequest(\"DELETE\", \"http://localhost:\"+strconv.Itoa(m.apiPort)+\"/controller/network/\"+netid+\"/member/\"+memid, nil)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\treq.Header.Set(\"X-Zt1-Auth\", os.ExpandEnv(m.authToken))\n+\n+\tresp, err := http.DefaultClient.Do(req)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tdefer resp.Body.Close()\n+\n+\tif resp.StatusCode != 200 {\n+\t\treturn errors.New(\"network error. Status code: \" + strconv.Itoa(resp.StatusCode))\n+\t}\n+\n+\treturn nil\n+}"
            },
            {
                "sha": "f73cf30d319d23ad54395d987c63c1440ce016d2",
                "filename": "src/mod/geodb/geodb.go",
                "status": "added",
                "additions": 250,
                "deletions": 0,
                "changes": 250,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Fgeodb.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Fgeodb.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fgeodb%2Fgeodb.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,250 @@\n+package geodb\n+\n+import (\n+\t_ \"embed\"\n+\t\"log\"\n+\t\"net\"\n+\t\"net/http\"\n+\t\"strings\"\n+\n+\t\"imuslab.com/zoraxy/mod/database\"\n+)\n+\n+//go:embed geoipv4.csv\n+var geoipv4 []byte //Original embedded csv file\n+\n+type Store struct {\n+\tEnabled bool\n+\tgeodb   [][]string //Parsed geodb list\n+\t//geoipCache sync.Map\n+\tgeotrie *trie\n+\tsysdb   *database.Database\n+}\n+\n+type CountryInfo struct {\n+\tCountryIsoCode string\n+\tContinetCode   string\n+}\n+\n+func NewGeoDb(sysdb *database.Database) (*Store, error) {\n+\tparsedGeoData, err := parseCSV(geoipv4)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tblacklistEnabled := false\n+\tif sysdb != nil {\n+\t\terr = sysdb.NewTable(\"blacklist-cn\")\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\n+\t\terr = sysdb.NewTable(\"blacklist-ip\")\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\n+\t\terr = sysdb.NewTable(\"blacklist\")\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\t\tsysdb.Read(\"blacklist\", \"enabled\", &blacklistEnabled)\n+\t} else {\n+\t\tlog.Println(\"Database pointer set to nil: Entering debug mode\")\n+\t}\n+\n+\treturn &Store{\n+\t\tEnabled: blacklistEnabled,\n+\t\tgeodb:   parsedGeoData,\n+\t\t//geoipCache: sync.Map{},\n+\t\tgeotrie: constrctTrieTree(parsedGeoData),\n+\t\tsysdb:   sysdb,\n+\t}, nil\n+}\n+\n+func (s *Store) ToggleBlacklist(enabled bool) {\n+\ts.sysdb.Write(\"blacklist\", \"enabled\", enabled)\n+\ts.Enabled = enabled\n+}\n+\n+func (s *Store) ResolveCountryCodeFromIP(ipstring string) (*CountryInfo, error) {\n+\tcc := s.search(ipstring)\n+\treturn &CountryInfo{\n+\t\tCountryIsoCode: cc,\n+\t\tContinetCode:   \"\",\n+\t}, nil\n+}\n+\n+func (s *Store) Close() {\n+\n+}\n+\n+func (s *Store) AddCountryCodeToBlackList(countryCode string) {\n+\tcountryCode = strings.ToLower(countryCode)\n+\ts.sysdb.Write(\"blacklist-cn\", countryCode, true)\n+}\n+\n+func (s *Store) RemoveCountryCodeFromBlackList(countryCode string) {\n+\tcountryCode = strings.ToLower(countryCode)\n+\ts.sysdb.Delete(\"blacklist-cn\", countryCode)\n+}\n+\n+func (s *Store) IsCountryCodeBlacklisted(countryCode string) bool {\n+\tcountryCode = strings.ToLower(countryCode)\n+\tvar isBlacklisted bool = false\n+\ts.sysdb.Read(\"blacklist-cn\", countryCode, &isBlacklisted)\n+\treturn isBlacklisted\n+}\n+\n+func (s *Store) GetAllBlacklistedCountryCode() []string {\n+\tbannedCountryCodes := []string{}\n+\tentries, err := s.sysdb.ListTable(\"blacklist-cn\")\n+\tif err != nil {\n+\t\treturn bannedCountryCodes\n+\t}\n+\tfor _, keypairs := range entries {\n+\t\tip := string(keypairs[0])\n+\t\tbannedCountryCodes = append(bannedCountryCodes, ip)\n+\t}\n+\n+\treturn bannedCountryCodes\n+}\n+\n+func (s *Store) AddIPToBlackList(ipAddr string) {\n+\ts.sysdb.Write(\"blacklist-ip\", ipAddr, true)\n+}\n+\n+func (s *Store) RemoveIPFromBlackList(ipAddr string) {\n+\ts.sysdb.Delete(\"blacklist-ip\", ipAddr)\n+}\n+\n+func (s *Store) IsIPBlacklisted(ipAddr string) bool {\n+\tvar isBlacklisted bool = false\n+\ts.sysdb.Read(\"blacklist-ip\", ipAddr, &isBlacklisted)\n+\tif isBlacklisted {\n+\t\treturn true\n+\t}\n+\n+\t//Check for IP wildcard and CIRD rules\n+\tAllBlacklistedIps := s.GetAllBlacklistedIp()\n+\tfor _, blacklistRule := range AllBlacklistedIps {\n+\t\twildcardMatch := MatchIpWildcard(ipAddr, blacklistRule)\n+\t\tif wildcardMatch {\n+\t\t\treturn true\n+\t\t}\n+\n+\t\tcidrMatch := MatchIpCIDR(ipAddr, blacklistRule)\n+\t\tif cidrMatch {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\n+\treturn false\n+}\n+\n+func (s *Store) GetAllBlacklistedIp() []string {\n+\tbannedIps := []string{}\n+\tentries, err := s.sysdb.ListTable(\"blacklist-ip\")\n+\tif err != nil {\n+\t\treturn bannedIps\n+\t}\n+\n+\tfor _, keypairs := range entries {\n+\t\tip := string(keypairs[0])\n+\t\tbannedIps = append(bannedIps, ip)\n+\t}\n+\n+\treturn bannedIps\n+}\n+\n+// Check if a IP address is blacklisted, in either country or IP blacklist\n+func (s *Store) IsBlacklisted(ipAddr string) bool {\n+\tif !s.Enabled {\n+\t\t//Blacklist not enabled. Always return false\n+\t\treturn false\n+\t}\n+\n+\tif ipAddr == \"\" {\n+\t\t//Unable to get the target IP address\n+\t\treturn false\n+\t}\n+\n+\tcountryCode, err := s.ResolveCountryCodeFromIP(ipAddr)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\tif s.IsCountryCodeBlacklisted(countryCode.CountryIsoCode) {\n+\t\treturn true\n+\t}\n+\n+\tif s.IsIPBlacklisted(ipAddr) {\n+\t\treturn true\n+\t}\n+\n+\treturn false\n+}\n+\n+func (s *Store) GetRequesterCountryISOCode(r *http.Request) string {\n+\tipAddr := GetRequesterIP(r)\n+\tif ipAddr == \"\" {\n+\t\treturn \"\"\n+\t}\n+\tcountryCode, err := s.ResolveCountryCodeFromIP(ipAddr)\n+\tif err != nil {\n+\t\treturn \"\"\n+\t}\n+\n+\treturn countryCode.CountryIsoCode\n+}\n+\n+// Utilities function\n+func GetRequesterIP(r *http.Request) string {\n+\tip := r.Header.Get(\"X-Forwarded-For\")\n+\tif ip == \"\" {\n+\t\tip = r.Header.Get(\"X-Real-IP\")\n+\t\tif ip == \"\" {\n+\t\t\tip = strings.Split(r.RemoteAddr, \":\")[0]\n+\t\t}\n+\t}\n+\treturn ip\n+}\n+\n+// Match the IP address with a wildcard string\n+func MatchIpWildcard(ipAddress, wildcard string) bool {\n+\t// Split IP address and wildcard into octets\n+\tipOctets := strings.Split(ipAddress, \".\")\n+\twildcardOctets := strings.Split(wildcard, \".\")\n+\n+\t// Check that both have 4 octets\n+\tif len(ipOctets) != 4 || len(wildcardOctets) != 4 {\n+\t\treturn false\n+\t}\n+\n+\t// Check each octet to see if it matches the wildcard or is an exact match\n+\tfor i := 0; i < 4; i++ {\n+\t\tif wildcardOctets[i] == \"*\" {\n+\t\t\tcontinue\n+\t\t}\n+\t\tif ipOctets[i] != wildcardOctets[i] {\n+\t\t\treturn false\n+\t\t}\n+\t}\n+\n+\treturn true\n+}\n+\n+// Match ip address with CIDR\n+func MatchIpCIDR(ip string, cidr string) bool {\n+\t// parse the CIDR string\n+\t_, cidrnet, err := net.ParseCIDR(cidr)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\t// parse the IP address\n+\tipAddr := net.ParseIP(ip)\n+\n+\t// check if the IP address is within the CIDR range\n+\treturn cidrnet.Contains(ipAddr)\n+}"
            },
            {
                "sha": "3c56f644870f26931b52a6cefd88a8118d69d764",
                "filename": "src/mod/geodb/geodb_test.go",
                "status": "added",
                "additions": 73,
                "deletions": 0,
                "changes": 73,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Fgeodb_test.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Fgeodb_test.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fgeodb%2Fgeodb_test.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,73 @@\n+package geodb_test\n+\n+import (\n+\t\"testing\"\n+\n+\t\"imuslab.com/zoraxy/mod/geodb\"\n+)\n+\n+/*\n+func TestTrieConstruct(t *testing.T) {\n+\ttt := geodb.NewTrie()\n+\tdata := [][]string{\n+\t\t{\"1.0.16.0\", \"1.0.31.255\", \"JP\"},\n+\t\t{\"1.0.32.0\", \"1.0.63.255\", \"CN\"},\n+\t\t{\"1.0.64.0\", \"1.0.127.255\", \"JP\"},\n+\t\t{\"1.0.128.0\", \"1.0.255.255\", \"TH\"},\n+\t\t{\"1.1.0.0\", \"1.1.0.255\", \"CN\"},\n+\t\t{\"1.1.1.0\", \"1.1.1.255\", \"AU\"},\n+\t\t{\"1.1.2.0\", \"1.1.63.255\", \"CN\"},\n+\t\t{\"1.1.64.0\", \"1.1.127.255\", \"JP\"},\n+\t\t{\"1.1.128.0\", \"1.1.255.255\", \"TH\"},\n+\t\t{\"1.2.0.0\", \"1.2.2.255\", \"CN\"},\n+\t\t{\"1.2.3.0\", \"1.2.3.255\", \"AU\"},\n+\t}\n+\n+\tfor _, entry := range data {\n+\t\tstartIp := entry[0]\n+\t\tendIp := entry[1]\n+\t\tcc := entry[2]\n+\t\ttt.Insert(startIp, cc)\n+\t\ttt.Insert(endIp, cc)\n+\t}\n+\n+\tt.Log(tt.Search(\"1.0.16.20\"), \"== JP\")  //JP\n+\tt.Log(tt.Search(\"1.2.0.122\"), \"== CN\")  //CN\n+\tt.Log(tt.Search(\"1.2.1.0\"), \"== CN\")    //CN\n+\tt.Log(tt.Search(\"1.0.65.243\"), \"== JP\") //JP\n+\tt.Log(tt.Search(\"1.0.62.243\"), \"== CN\") //CN\n+}\n+*/\n+\n+func TestResolveCountryCodeFromIP(t *testing.T) {\n+\t// Create a new store\n+\tstore, err := geodb.NewGeoDb(nil)\n+\tif err != nil {\n+\t\tt.Errorf(\"error creating store: %v\", err)\n+\t\treturn\n+\t}\n+\n+\t// Test an IP address that should return a valid country code\n+\tip := \"8.8.8.8\"\n+\texpected := \"US\"\n+\tinfo, err := store.ResolveCountryCodeFromIP(ip)\n+\tif err != nil {\n+\t\tt.Errorf(\"error resolving country code for IP %s: %v\", ip, err)\n+\t\treturn\n+\t}\n+\tif info.CountryIsoCode != expected {\n+\t\tt.Errorf(\"expected country code %s, but got %s for IP %s\", expected, info.CountryIsoCode, ip)\n+\t}\n+\n+\t// Test an IP address that should return an empty country code\n+\tip = \"127.0.0.1\"\n+\texpected = \"\"\n+\tinfo, err = store.ResolveCountryCodeFromIP(ip)\n+\tif err != nil {\n+\t\tt.Errorf(\"error resolving country code for IP %s: %v\", ip, err)\n+\t\treturn\n+\t}\n+\tif info.CountryIsoCode != expected {\n+\t\tt.Errorf(\"expected country code %s, but got %s for IP %s\", expected, info.CountryIsoCode, ip)\n+\t}\n+}"
            },
            {
                "sha": "10d84aef9f8eab0b95010d751ecde7966b021e7d",
                "filename": "src/mod/geodb/geoipv4.csv",
                "status": "added",
                "additions": 261318,
                "deletions": 0,
                "changes": 261318,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Fgeoipv4.csv",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Fgeoipv4.csv",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fgeodb%2Fgeoipv4.csv?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0"
            },
            {
                "sha": "6078da6191850f095f88c01f3cb099ab8208b6ad",
                "filename": "src/mod/geodb/geoloader.go",
                "status": "added",
                "additions": 89,
                "deletions": 0,
                "changes": 89,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Fgeoloader.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Fgeoloader.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fgeodb%2Fgeoloader.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,89 @@\n+package geodb\n+\n+import (\n+\t\"bytes\"\n+\t\"encoding/csv\"\n+\t\"io\"\n+\t\"net\"\n+\t\"strings\"\n+)\n+\n+func (s *Store) search(ip string) string {\n+\tif strings.Contains(ip, \",\") {\n+\t\t//This is a CF proxied request. We only need the front part\n+\t\t//Example 219.71.102.145, 172.71.139.178\n+\t\tip = strings.Split(ip, \",\")[0]\n+\t\tip = strings.TrimSpace(ip)\n+\t}\n+\t//See if there are cached country code for this ip\n+\t/*\n+\t\tccc, ok := s.geoipCache.Load(ip)\n+\t\tif ok {\n+\t\t\treturn ccc.(string)\n+\t\t}\n+\t*/\n+\n+\t//Search in geotrie tree\n+\tcc := s.geotrie.search(ip)\n+\t/*\n+\t\tif cc != \"\" {\n+\t\t\ts.geoipCache.Store(ip, cc)\n+\t\t}\n+\t*/\n+\treturn cc\n+}\n+\n+// Construct the trie data structure for quick lookup\n+func constrctTrieTree(data [][]string) *trie {\n+\ttt := newTrie()\n+\tfor _, entry := range data {\n+\t\tstartIp := entry[0]\n+\t\tendIp := entry[1]\n+\t\tcc := entry[2]\n+\t\ttt.insert(startIp, cc)\n+\t\ttt.insert(endIp, cc)\n+\t}\n+\n+\treturn tt\n+}\n+\n+// Parse the embedded csv as ipstart, ipend and country code entries\n+func parseCSV(content []byte) ([][]string, error) {\n+\tvar records [][]string\n+\tr := csv.NewReader(bytes.NewReader(content))\n+\tfor {\n+\t\trecord, err := r.Read()\n+\t\tif err == io.EOF {\n+\t\t\tbreak\n+\t\t}\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\t\trecords = append(records, record)\n+\t}\n+\treturn records, nil\n+}\n+\n+// Check if a ip string is within the range of two others\n+func isIPInRange(ip, start, end string) bool {\n+\tipAddr := net.ParseIP(ip)\n+\tif ipAddr == nil {\n+\t\treturn false\n+\t}\n+\n+\tstartAddr := net.ParseIP(start)\n+\tif startAddr == nil {\n+\t\treturn false\n+\t}\n+\n+\tendAddr := net.ParseIP(end)\n+\tif endAddr == nil {\n+\t\treturn false\n+\t}\n+\n+\tif ipAddr.To4() == nil || startAddr.To4() == nil || endAddr.To4() == nil {\n+\t\treturn false\n+\t}\n+\n+\treturn bytes.Compare(ipAddr.To4(), startAddr.To4()) >= 0 && bytes.Compare(ipAddr.To4(), endAddr.To4()) <= 0\n+}"
            },
            {
                "sha": "f4614a6e34e207143e18122a0b80dc751ec6b907",
                "filename": "src/mod/geodb/trie.go",
                "status": "added",
                "additions": 131,
                "deletions": 0,
                "changes": 131,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Ftrie.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fgeodb%2Ftrie.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fgeodb%2Ftrie.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,131 @@\n+package geodb\n+\n+import (\n+\t\"fmt\"\n+\t\"net\"\n+\t\"strconv\"\n+\t\"strings\"\n+)\n+\n+type trie_Node struct {\n+\tchildrens [2]*trie_Node\n+\tends      bool\n+\tcc        string\n+}\n+\n+// Initializing the root of the trie\n+type trie struct {\n+\troot *trie_Node\n+}\n+\n+func ipToBitString(ip string) string {\n+\t// Parse the IP address string into a net.IP object\n+\tparsedIP := net.ParseIP(ip)\n+\n+\t// Convert the IP address to a 4-byte slice\n+\tipBytes := parsedIP.To4()\n+\n+\t// Convert each byte in the IP address to its 8-bit binary representation\n+\tvar result []string\n+\tfor _, b := range ipBytes {\n+\t\tresult = append(result, fmt.Sprintf(\"%08b\", b))\n+\t}\n+\n+\t// Join the binary representation of each byte with dots to form the final bit string\n+\treturn strings.Join(result, \"\")\n+}\n+\n+func bitStringToIp(bitString string) string {\n+\t// Split the bit string into four 8-bit segments\n+\tsegments := []string{\n+\t\tbitString[:8],\n+\t\tbitString[8:16],\n+\t\tbitString[16:24],\n+\t\tbitString[24:32],\n+\t}\n+\n+\t// Convert each segment to its decimal equivalent\n+\tvar decimalSegments []int\n+\tfor _, s := range segments {\n+\t\ti, _ := strconv.ParseInt(s, 2, 64)\n+\t\tdecimalSegments = append(decimalSegments, int(i))\n+\t}\n+\n+\t// Join the decimal segments with dots to form the IP address string\n+\treturn fmt.Sprintf(\"%d.%d.%d.%d\", decimalSegments[0], decimalSegments[1], decimalSegments[2], decimalSegments[3])\n+}\n+\n+// inititlaizing a new trie\n+func newTrie() *trie {\n+\tt := new(trie)\n+\tt.root = new(trie_Node)\n+\treturn t\n+}\n+\n+// Passing words to trie\n+func (t *trie) insert(ipAddr string, cc string) {\n+\tword := ipToBitString(ipAddr)\n+\tcurrent := t.root\n+\tfor _, wr := range word {\n+\t\tindex := wr - '0'\n+\t\tif current.childrens[index] == nil {\n+\t\t\tcurrent.childrens[index] = &trie_Node{\n+\t\t\t\tchildrens: [2]*trie_Node{},\n+\t\t\t\tends:      false,\n+\t\t\t\tcc:        cc,\n+\t\t\t}\n+\t\t}\n+\t\tcurrent = current.childrens[index]\n+\t}\n+\tcurrent.ends = true\n+}\n+\n+func isReservedIP(ip string) bool {\n+\tparsedIP := net.ParseIP(ip)\n+\tif parsedIP == nil {\n+\t\treturn false\n+\t}\n+\t// Check if the IP address is a loopback address\n+\tif parsedIP.IsLoopback() {\n+\t\treturn true\n+\t}\n+\t// Check if the IP address is in the link-local address range\n+\tif parsedIP.IsLinkLocalUnicast() || parsedIP.IsLinkLocalMulticast() {\n+\t\treturn true\n+\t}\n+\t// Check if the IP address is in the private address ranges\n+\tprivateRanges := []*net.IPNet{\n+\t\t{IP: net.ParseIP(\"10.0.0.0\"), Mask: net.CIDRMask(8, 32)},\n+\t\t{IP: net.ParseIP(\"172.16.0.0\"), Mask: net.CIDRMask(12, 32)},\n+\t\t{IP: net.ParseIP(\"192.168.0.0\"), Mask: net.CIDRMask(16, 32)},\n+\t}\n+\tfor _, r := range privateRanges {\n+\t\tif r.Contains(parsedIP) {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\t// If the IP address is not a reserved address, return false\n+\treturn false\n+}\n+\n+// Initializing the search for word in node\n+func (t *trie) search(ipAddr string) string {\n+\tif isReservedIP(ipAddr) {\n+\t\treturn \"\"\n+\t}\n+\tword := ipToBitString(ipAddr)\n+\tcurrent := t.root\n+\tfor _, wr := range word {\n+\t\tindex := wr - '0'\n+\t\tif current.childrens[index] == nil {\n+\t\t\treturn current.cc\n+\t\t}\n+\t\tcurrent = current.childrens[index]\n+\t}\n+\tif current.ends {\n+\t\treturn current.cc\n+\t}\n+\n+\t//Not found\n+\treturn \"\"\n+}"
            },
            {
                "sha": "8605685447d69a4b81cb4a59f62d7b72d84fd435",
                "filename": "src/mod/ipscan/ipscan.go",
                "status": "added",
                "additions": 149,
                "deletions": 0,
                "changes": 149,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fipscan%2Fipscan.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fipscan%2Fipscan.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fipscan%2Fipscan.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,149 @@\n+package ipscan\n+\n+import (\n+\t\"bytes\"\n+\t\"fmt\"\n+\t\"net\"\n+\t\"sort\"\n+\t\"strconv\"\n+\t\"sync\"\n+\t\"time\"\n+\n+\t\"github.com/go-ping/ping\"\n+)\n+\n+/*\n+\tIP Scanner\n+\n+\tThis module scan the given network range and return a list\n+\tof nearby nodes.\n+*/\n+\n+type DiscoveredHost struct {\n+\tIP                string\n+\tPing              int\n+\tHostname          string\n+\tHttpPortDetected  bool\n+\tHttpsPortDetected bool\n+}\n+\n+//Scan an IP range given the start and ending ip address\n+func ScanIpRange(start, end string) ([]*DiscoveredHost, error) {\n+\tipStart := net.ParseIP(start)\n+\tipEnd := net.ParseIP(end)\n+\tif ipStart == nil || ipEnd == nil {\n+\t\treturn nil, fmt.Errorf(\"Invalid IP address\")\n+\t}\n+\n+\tif bytes.Compare(ipStart, ipEnd) > 0 {\n+\t\treturn nil, fmt.Errorf(\"Invalid IP range\")\n+\t}\n+\n+\tvar wg sync.WaitGroup\n+\thosts := make([]*DiscoveredHost, 0)\n+\tfor ip := ipStart; bytes.Compare(ip, ipEnd) <= 0; inc(ip) {\n+\t\twg.Add(1)\n+\t\tthisIp := ip.String()\n+\t\tgo func(thisIp string) {\n+\t\t\tdefer wg.Done()\n+\t\t\thost := &DiscoveredHost{IP: thisIp}\n+\t\t\tif err := host.CheckPing(); err != nil {\n+\t\t\t\t// skip if the host is unreachable\n+\t\t\t\thost.Ping = -1\n+\t\t\t\thosts = append(hosts, host)\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\thost.CheckHostname()\n+\t\t\thost.CheckPort(\"http\", 80, &host.HttpPortDetected)\n+\t\t\thost.CheckPort(\"https\", 443, &host.HttpsPortDetected)\n+\t\t\tfmt.Println(\"OK\", host)\n+\t\t\thosts = append(hosts, host)\n+\n+\t\t}(thisIp)\n+\t}\n+\n+\t//Wait until all go routine done\n+\twg.Wait()\n+\tsortByIP(hosts)\n+\treturn hosts, nil\n+}\n+\n+func ScanCIDRRange(cidr string) ([]*DiscoveredHost, error) {\n+\t_, ipNet, err := net.ParseCIDR(cidr)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tip := ipNet.IP.To4()\n+\tstartIP := net.IPv4(ip[0], ip[1], ip[2], 1).String()\n+\tendIP := net.IPv4(ip[0], ip[1], ip[2], 254).String()\n+\n+\treturn ScanIpRange(startIP, endIP)\n+}\n+\n+func inc(ip net.IP) {\n+\tfor j := len(ip) - 1; j >= 0; j-- {\n+\t\tip[j]++\n+\t\tif ip[j] > 0 {\n+\t\t\tbreak\n+\t\t}\n+\t}\n+}\n+\n+func sortByIP(discovered []*DiscoveredHost) {\n+\tsort.Slice(discovered, func(i, j int) bool {\n+\t\treturn discovered[i].IP < discovered[j].IP\n+\t})\n+}\n+\n+func (host *DiscoveredHost) CheckPing() error {\n+\t// ping the host and set the ping time in milliseconds\n+\tpinger, err := ping.NewPinger(host.IP)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tpinger.Count = 4\n+\tpinger.Timeout = time.Second\n+\tpinger.SetPrivileged(true) // This line may help on some systems\n+\tpinger.Run()\n+\tstats := pinger.Statistics()\n+\tif stats.PacketsRecv == 0 {\n+\t\treturn fmt.Errorf(\"Host unreachable for \" + host.IP)\n+\t}\n+\thost.Ping = int(stats.AvgRtt.Milliseconds())\n+\treturn nil\n+}\n+\n+func (host *DiscoveredHost) CheckHostname() {\n+\t// lookup the hostname for the IP address\n+\tnames, err := net.LookupAddr(host.IP)\n+\tfmt.Println(names, err)\n+\tif err == nil && len(names) > 0 {\n+\t\thost.Hostname = names[0]\n+\t}\n+}\n+\n+func (host *DiscoveredHost) CheckPort(protocol string, port int, detected *bool) {\n+\t// try to connect to the specified port on the host\n+\tconn, err := net.DialTimeout(\"tcp\", net.JoinHostPort(host.IP, strconv.Itoa(port)), 1*time.Second)\n+\tif err == nil {\n+\t\tconn.Close()\n+\t\t*detected = true\n+\t}\n+}\n+\n+func (host *DiscoveredHost) ScanPorts(startPort, endPort int) []int {\n+\tvar openPorts []int\n+\n+\tfor port := startPort; port <= endPort; port++ {\n+\t\ttarget := fmt.Sprintf(\"%s:%d\", host.IP, port)\n+\t\tconn, err := net.DialTimeout(\"tcp\", target, time.Millisecond*500)\n+\t\tif err == nil {\n+\t\t\tconn.Close()\n+\t\t\topenPorts = append(openPorts, port)\n+\t\t}\n+\t}\n+\n+\treturn openPorts\n+}"
            },
            {
                "sha": "3a0022d1ee48357ec42f8bff3521d9085108631d",
                "filename": "src/mod/mdns/mdns.go",
                "status": "added",
                "additions": 243,
                "deletions": 0,
                "changes": 243,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fmdns%2Fmdns.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fmdns%2Fmdns.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fmdns%2Fmdns.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,243 @@\n+package mdns\n+\n+import (\n+\t\"context\"\n+\t\"log\"\n+\t\"net\"\n+\t\"strings\"\n+\t\"time\"\n+\n+\t\"github.com/grandcat/zeroconf\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+type MDNSHost struct {\n+\tMDNS          *zeroconf.Server\n+\tHost          *NetworkHost\n+\tIfaceOverride *net.Interface\n+}\n+\n+type NetworkHost struct {\n+\tHostName     string\n+\tPort         int\n+\tIPv4         []net.IP\n+\tDomain       string\n+\tModel        string\n+\tUUID         string\n+\tVendor       string\n+\tBuildVersion string\n+\tMacAddr      []string\n+\tOnline       bool\n+}\n+\n+// Create a new MDNS discoverer, set MacOverride to empty string for using the first NIC discovered\n+func NewMDNS(config NetworkHost, MacOverride string) (*MDNSHost, error) {\n+\t//Get host MAC Address\n+\tmacAddress, err := getMacAddr()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tmacAddressBoardcast := \"\"\n+\tif err == nil {\n+\t\tmacAddressBoardcast = strings.Join(macAddress, \",\")\n+\t} else {\n+\t\tlog.Println(\"[mDNS] Unable to get MAC Address: \", err.Error())\n+\t}\n+\n+\t//Register the mds services\n+\tserver, err := zeroconf.Register(config.HostName, \"_http._tcp\", \"local.\", config.Port, []string{\"version_build=\" + config.BuildVersion, \"vendor=\" + config.Vendor, \"model=\" + config.Model, \"uuid=\" + config.UUID, \"domain=\" + config.Domain, \"mac_addr=\" + macAddressBoardcast}, nil)\n+\tif err != nil {\n+\t\tlog.Println(\"[mDNS] Error when registering zeroconf broadcast message\", err.Error())\n+\t\treturn &MDNSHost{}, err\n+\t}\n+\n+\t//Discover the iface to override if exists\n+\tvar overrideIface *net.Interface = nil\n+\tif MacOverride != \"\" {\n+\t\tifaceIp := \"\"\n+\t\tifaces, err := net.Interfaces()\n+\t\tif err != nil {\n+\t\t\tlog.Println(\"[mDNS] Unable to override iface MAC: \" + err.Error() + \". Resuming with default iface\")\n+\t\t}\n+\n+\t\tfoundMatching := false\n+\t\tfor _, iface := range ifaces {\n+\t\t\tthisIfaceMac := iface.HardwareAddr.String()\n+\t\t\tthisIfaceMac = strings.ReplaceAll(thisIfaceMac, \":\", \"-\")\n+\t\t\tMacOverride = strings.ReplaceAll(MacOverride, \":\", \"-\")\n+\t\t\tif strings.EqualFold(thisIfaceMac, strings.TrimSpace(MacOverride)) {\n+\t\t\t\t//This is the correct iface to use\n+\t\t\t\toverrideIface = &iface\n+\t\t\t\taddrs, err := iface.Addrs()\n+\n+\t\t\t\tif err == nil && len(addrs) > 0 {\n+\t\t\t\t\tifaceIp = addrs[0].String()\n+\t\t\t\t}\n+\n+\t\t\t\tfor _, addr := range addrs {\n+\t\t\t\t\tvar ip net.IP\n+\t\t\t\t\tswitch v := addr.(type) {\n+\t\t\t\t\tcase *net.IPNet:\n+\t\t\t\t\t\tip = v.IP\n+\t\t\t\t\tcase *net.IPAddr:\n+\t\t\t\t\t\tip = v.IP\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tif ip.To4() != nil {\n+\t\t\t\t\t\t//This NIC have Ipv4 addr\n+\t\t\t\t\t\tifaceIp = ip.String()\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\tfoundMatching = true\n+\t\t\t\tbreak\n+\t\t\t}\n+\t\t}\n+\n+\t\tif !foundMatching {\n+\t\t\tlog.Println(\"[mDNS] Unable to find the target iface with MAC address: \" + MacOverride + \". Resuming with default iface\")\n+\t\t} else {\n+\t\t\tlog.Println(\"[mDNS] Entering force MAC address mode, listening on: \" + MacOverride + \"(IP address: \" + ifaceIp + \")\")\n+\t\t}\n+\t}\n+\n+\treturn &MDNSHost{\n+\t\tMDNS:          server,\n+\t\tHost:          &config,\n+\t\tIfaceOverride: overrideIface,\n+\t}, nil\n+}\n+\n+func (m *MDNSHost) Close() {\n+\tif m != nil {\n+\t\tm.MDNS.Shutdown()\n+\t}\n+\n+}\n+\n+// Scan with given timeout and domain filter. Use m.Host.Domain for scanning similar typed devices\n+func (m *MDNSHost) Scan(timeout int, domainFilter string) []*NetworkHost {\n+\t// Discover all services on the network (e.g. _workstation._tcp)\n+\n+\tvar zcoption zeroconf.ClientOption = nil\n+\tif m.IfaceOverride != nil {\n+\t\tzcoption = zeroconf.SelectIfaces([]net.Interface{*m.IfaceOverride})\n+\t}\n+\n+\tresolver, err := zeroconf.NewResolver(zcoption)\n+\tif err != nil {\n+\t\tlog.Fatalln(\"Failed to initialize resolver:\", err.Error())\n+\t}\n+\n+\tentries := make(chan *zeroconf.ServiceEntry)\n+\t//Create go routine  to wait for the resolver\n+\n+\tdiscoveredHost := []*NetworkHost{}\n+\n+\tgo func(results <-chan *zeroconf.ServiceEntry) {\n+\t\tfor entry := range results {\n+\t\t\tif domainFilter == \"\" {\n+\t\t\t\t//This is a ArOZ Online Host\n+\t\t\t\t//Split the required information out of the text element\n+\t\t\t\tTEXT := entry.Text\n+\t\t\t\tproperties := map[string]string{}\n+\t\t\t\tfor _, v := range TEXT {\n+\t\t\t\t\tkv := strings.Split(v, \"=\")\n+\t\t\t\t\tif len(kv) == 2 {\n+\t\t\t\t\t\tproperties[kv[0]] = kv[1]\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n+\t\t\t\tvar macAddrs []string\n+\t\t\t\tval, ok := properties[\"mac_addr\"]\n+\t\t\t\tif !ok || val == \"\" {\n+\t\t\t\t\t//No MacAddr found. Target node version too old\n+\t\t\t\t\tmacAddrs = []string{}\n+\t\t\t\t} else {\n+\t\t\t\t\tmacAddrs = strings.Split(properties[\"mac_addr\"], \",\")\n+\t\t\t\t}\n+\n+\t\t\t\t//log.Println(properties)\n+\t\t\t\tdiscoveredHost = append(discoveredHost, &NetworkHost{\n+\t\t\t\t\tHostName:     entry.HostName,\n+\t\t\t\t\tPort:         entry.Port,\n+\t\t\t\t\tIPv4:         entry.AddrIPv4,\n+\t\t\t\t\tDomain:       properties[\"domain\"],\n+\t\t\t\t\tModel:        properties[\"model\"],\n+\t\t\t\t\tUUID:         properties[\"uuid\"],\n+\t\t\t\t\tVendor:       properties[\"vendor\"],\n+\t\t\t\t\tBuildVersion: properties[\"version_build\"],\n+\t\t\t\t\tMacAddr:      macAddrs,\n+\t\t\t\t\tOnline:       true,\n+\t\t\t\t})\n+\n+\t\t\t} else {\n+\t\t\t\tif utils.StringInArray(entry.Text, \"domain=\"+domainFilter) {\n+\t\t\t\t\t//This is generic scan request\n+\t\t\t\t\t//Split the required information out of the text element\n+\t\t\t\t\tTEXT := entry.Text\n+\t\t\t\t\tproperties := map[string]string{}\n+\t\t\t\t\tfor _, v := range TEXT {\n+\t\t\t\t\t\tkv := strings.Split(v, \"=\")\n+\t\t\t\t\t\tif len(kv) == 2 {\n+\t\t\t\t\t\t\tproperties[kv[0]] = kv[1]\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tvar macAddrs []string\n+\t\t\t\t\tval, ok := properties[\"mac_addr\"]\n+\t\t\t\t\tif !ok || val == \"\" {\n+\t\t\t\t\t\t//No MacAddr found. Target node version too old\n+\t\t\t\t\t\tmacAddrs = []string{}\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\tmacAddrs = strings.Split(properties[\"mac_addr\"], \",\")\n+\t\t\t\t\t}\n+\n+\t\t\t\t\t//log.Println(properties)\n+\t\t\t\t\tdiscoveredHost = append(discoveredHost, &NetworkHost{\n+\t\t\t\t\t\tHostName:     entry.HostName,\n+\t\t\t\t\t\tPort:         entry.Port,\n+\t\t\t\t\t\tIPv4:         entry.AddrIPv4,\n+\t\t\t\t\t\tDomain:       properties[\"domain\"],\n+\t\t\t\t\t\tModel:        properties[\"model\"],\n+\t\t\t\t\t\tUUID:         properties[\"uuid\"],\n+\t\t\t\t\t\tVendor:       properties[\"vendor\"],\n+\t\t\t\t\t\tBuildVersion: properties[\"version_build\"],\n+\t\t\t\t\t\tMacAddr:      macAddrs,\n+\t\t\t\t\t\tOnline:       true,\n+\t\t\t\t\t})\n+\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t}\n+\t}(entries)\n+\n+\t//Resolve each of the mDNS and pipe it back to the log functions\n+\tctx, cancel := context.WithTimeout(context.Background(), time.Second*time.Duration(timeout))\n+\tdefer cancel()\n+\terr = resolver.Browse(ctx, \"_http._tcp\", \"local.\", entries)\n+\tif err != nil {\n+\t\tlog.Fatalln(\"Failed to browse:\", err.Error())\n+\t}\n+\n+\t//Update the master scan record\n+\t<-ctx.Done()\n+\treturn discoveredHost\n+}\n+\n+//Get all mac address of all interfaces\n+func getMacAddr() ([]string, error) {\n+\tifas, err := net.Interfaces()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tvar as []string\n+\tfor _, ifa := range ifas {\n+\t\ta := ifa.HardwareAddr.String()\n+\t\tif a != \"\" {\n+\t\t\tas = append(as, a)\n+\t\t}\n+\t}\n+\treturn as, nil\n+}"
            },
            {
                "sha": "d784bce759f2bb66611e53721c016bf3271d5e9c",
                "filename": "src/mod/netstat/netstat.go",
                "status": "added",
                "additions": 339,
                "deletions": 0,
                "changes": 339,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fnetstat%2Fnetstat.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fnetstat%2Fnetstat.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fnetstat%2Fnetstat.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,339 @@\n+package netstat\n+\n+import (\n+\t\"encoding/json\"\n+\t\"errors\"\n+\t\"fmt\"\n+\t\"log\"\n+\t\"net/http\"\n+\t\"os\"\n+\t\"os/exec\"\n+\t\"path/filepath\"\n+\t\"runtime\"\n+\t\"strconv\"\n+\t\"strings\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+// Float stat store the change of RX and TX\n+type FlowStat struct {\n+\tRX int64\n+\tTX int64\n+}\n+\n+// A new type of FloatStat that save the raw value from rx tx\n+type RawFlowStat struct {\n+\tRX int64\n+\tTX int64\n+}\n+\n+type NetStatBuffers struct {\n+\tStatRecordCount int          //No. of record number to keep\n+\tPreviousStat    *RawFlowStat //The value of the last instance of netstats\n+\tStats           []*FlowStat  //Statistic of the flow\n+\tStopChan        chan bool    //Channel to stop the ticker\n+\tEventTicker     *time.Ticker //Ticker for event logging\n+}\n+\n+// Get a new network statistic buffers\n+func NewNetStatBuffer(recordCount int) (*NetStatBuffers, error) {\n+\n+\t//Flood fill the stats with 0\n+\tinitialStats := []*FlowStat{}\n+\tfor i := 0; i < recordCount; i++ {\n+\t\tinitialStats = append(initialStats, &FlowStat{\n+\t\t\tRX: 0,\n+\t\t\tTX: 0,\n+\t\t})\n+\t}\n+\n+\t//Setup a timer to get the value from NIC accumulation stats\n+\tticker := time.NewTicker(time.Second)\n+\n+\t//Setup a stop channel\n+\tstopCh := make(chan bool)\n+\n+\tcurrnetNetSpec := RawFlowStat{\n+\t\tRX: 0,\n+\t\tTX: 0,\n+\t}\n+\n+\tthisNetBuffer := NetStatBuffers{\n+\t\tStatRecordCount: recordCount,\n+\t\tPreviousStat:    &currnetNetSpec,\n+\t\tStats:           initialStats,\n+\t\tStopChan:        stopCh,\n+\t\tEventTicker:     ticker,\n+\t}\n+\n+\t//Get the initial measurements of netstats\n+\trx, tx, err := GetNetworkInterfaceStats()\n+\tif err != nil {\n+\t\tlog.Println(\"Unable to get NIC stats: \", err.Error())\n+\t}\n+\n+\tretryCount := 0\n+\tfor rx == 0 && tx == 0 && retryCount < 10 {\n+\t\t//Strange. Retry\n+\t\tlog.Println(\"NIC stats return all 0. Retrying...\")\n+\t\trx, tx, err = GetNetworkInterfaceStats()\n+\t\tif err != nil {\n+\t\t\tlog.Println(\"Unable to get NIC stats: \", err.Error())\n+\t\t}\n+\t\tretryCount++\n+\t}\n+\n+\tthisNetBuffer.PreviousStat = &RawFlowStat{\n+\t\tRX: rx,\n+\t\tTX: tx,\n+\t}\n+\n+\t// Update the buffer every second\n+\tgo func(n *NetStatBuffers) {\n+\t\tfor {\n+\t\t\tselect {\n+\t\t\tcase <-n.StopChan:\n+\t\t\t\tfmt.Println(\"- Netstats listener stopped\")\n+\t\t\t\treturn\n+\n+\t\t\tcase <-ticker.C:\n+\t\t\t\tif n.PreviousStat.RX == 0 && n.PreviousStat.TX == 0 {\n+\t\t\t\t\t//Initiation state is still not done. Ignore request\n+\t\t\t\t\tlog.Println(\"No initial states. Waiting\")\n+\t\t\t\t\treturn\n+\t\t\t\t}\n+\t\t\t\t// Get the latest network interface stats\n+\t\t\t\trx, tx, err := GetNetworkInterfaceStats()\n+\t\t\t\tif err != nil {\n+\t\t\t\t\t// Log the error, but don't stop the buffer\n+\t\t\t\t\tlog.Printf(\"Failed to get network interface stats: %v\", err)\n+\t\t\t\t\tcontinue\n+\t\t\t\t}\n+\n+\t\t\t\t//Calculate the difference between this and last values\n+\t\t\t\tdrx := rx - n.PreviousStat.RX\n+\t\t\t\tdtx := tx - n.PreviousStat.TX\n+\n+\t\t\t\t// Push the new stats to the buffer\n+\t\t\t\tnewStat := &FlowStat{\n+\t\t\t\t\tRX: drx,\n+\t\t\t\t\tTX: dtx,\n+\t\t\t\t}\n+\n+\t\t\t\t//Set current rx tx as the previous rxtx\n+\t\t\t\tn.PreviousStat = &RawFlowStat{\n+\t\t\t\t\tRX: rx,\n+\t\t\t\t\tTX: tx,\n+\t\t\t\t}\n+\n+\t\t\t\tnewStats := n.Stats[1:]\n+\t\t\t\tnewStats = append(newStats, newStat)\n+\n+\t\t\t\tn.Stats = newStats\n+\t\t\t}\n+\t\t}\n+\t}(&thisNetBuffer)\n+\n+\treturn &thisNetBuffer, nil\n+}\n+\n+func (n *NetStatBuffers) HandleGetBufferedNetworkInterfaceStats(w http.ResponseWriter, r *http.Request) {\n+\tarr, _ := utils.GetPara(r, \"array\")\n+\tif arr == \"true\" {\n+\t\t//Restructure it into array\n+\t\trx := []int{}\n+\t\ttx := []int{}\n+\n+\t\tfor _, state := range n.Stats {\n+\t\t\trx = append(rx, int(state.RX))\n+\t\t\ttx = append(tx, int(state.TX))\n+\t\t}\n+\n+\t\ttype info struct {\n+\t\t\tRx []int\n+\t\t\tTx []int\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(info{\n+\t\t\tRx: rx,\n+\t\t\tTx: tx,\n+\t\t})\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\tjs, _ := json.Marshal(n.Stats)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t}\n+\n+}\n+\n+func (n *NetStatBuffers) Close() {\n+\tn.StopChan <- true\n+\ttime.Sleep(300 * time.Millisecond)\n+\tn.EventTicker.Stop()\n+}\n+\n+func HandleGetNetworkInterfaceStats(w http.ResponseWriter, r *http.Request) {\n+\trx, tx, err := GetNetworkInterfaceStats()\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tcurrnetNetSpec := struct {\n+\t\tRX int64\n+\t\tTX int64\n+\t}{\n+\t\trx,\n+\t\ttx,\n+\t}\n+\n+\tjs, _ := json.Marshal(currnetNetSpec)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+// Get network interface stats, return accumulated rx bits, tx bits and error if any\n+func GetNetworkInterfaceStats() (int64, int64, error) {\n+\tif runtime.GOOS == \"windows\" {\n+\t\t//Windows wmic sometime freeze and not respond.\n+\t\t//The safer way is to make a bypass mechanism\n+\t\t//when timeout with channel\n+\n+\t\ttype wmicResult struct {\n+\t\t\tRX  int64\n+\t\t\tTX  int64\n+\t\t\tErr error\n+\t\t}\n+\n+\t\tcallbackChan := make(chan wmicResult)\n+\t\tcmd := exec.Command(\"wmic\", \"path\", \"Win32_PerfRawData_Tcpip_NetworkInterface\", \"Get\", \"BytesReceivedPersec,BytesSentPersec,BytesTotalPersec\")\n+\t\t//Execute the cmd in goroutine\n+\t\tgo func() {\n+\t\t\tout, err := cmd.Output()\n+\t\t\tif err != nil {\n+\t\t\t\tcallbackChan <- wmicResult{0, 0, err}\n+\t\t\t}\n+\n+\t\t\t//Filter out the first line\n+\t\t\tlines := strings.Split(strings.ReplaceAll(string(out), \"\\r\\n\", \"\\n\"), \"\\n\")\n+\t\t\tif len(lines) >= 2 && len(lines[1]) >= 0 {\n+\t\t\t\tdataLine := lines[1]\n+\t\t\t\tfor strings.Contains(dataLine, \"  \") {\n+\t\t\t\t\tdataLine = strings.ReplaceAll(dataLine, \"  \", \" \")\n+\t\t\t\t}\n+\t\t\t\tdataLine = strings.TrimSpace(dataLine)\n+\t\t\t\tinfo := strings.Split(dataLine, \" \")\n+\t\t\t\tif len(info) != 3 {\n+\t\t\t\t\tcallbackChan <- wmicResult{0, 0, errors.New(\"invalid wmic results length\")}\n+\t\t\t\t}\n+\t\t\t\trxString := info[0]\n+\t\t\t\ttxString := info[1]\n+\n+\t\t\t\trx := int64(0)\n+\t\t\t\ttx := int64(0)\n+\t\t\t\tif s, err := strconv.ParseInt(rxString, 10, 64); err == nil {\n+\t\t\t\t\trx = s\n+\t\t\t\t}\n+\n+\t\t\t\tif s, err := strconv.ParseInt(txString, 10, 64); err == nil {\n+\t\t\t\t\ttx = s\n+\t\t\t\t}\n+\n+\t\t\t\ttime.Sleep(100 * time.Millisecond)\n+\t\t\t\tcallbackChan <- wmicResult{rx * 4, tx * 4, nil}\n+\t\t\t} else {\n+\t\t\t\t//Invalid data\n+\t\t\t\tcallbackChan <- wmicResult{0, 0, errors.New(\"invalid wmic results\")}\n+\t\t\t}\n+\n+\t\t}()\n+\n+\t\tgo func() {\n+\t\t\t//Spawn a timer to terminate the cmd process if timeout\n+\t\t\tvar timer *time.Timer\n+\t\t\ttimer = time.AfterFunc(3*time.Second, func() {\n+\t\t\t\ttimer.Stop()\n+\t\t\t\tif cmd != nil && cmd.Process != nil {\n+\t\t\t\t\tcmd.Process.Kill()\n+\t\t\t\t}\n+\t\t\t\tcallbackChan <- wmicResult{0, 0, errors.New(\"wmic execution timeout\")}\n+\t\t\t})\n+\t\t}()\n+\n+\t\tresult := wmicResult{}\n+\t\tresult = <-callbackChan\n+\t\tif result.Err != nil {\n+\t\t\tlog.Println(\"Unable to extract NIC info from wmic: \" + result.Err.Error())\n+\t\t}\n+\t\treturn result.RX, result.TX, result.Err\n+\t} else if runtime.GOOS == \"linux\" {\n+\t\tallIfaceRxByteFiles, err := filepath.Glob(\"/sys/class/net/*/statistics/rx_bytes\")\n+\t\tif err != nil {\n+\t\t\t//Permission denied\n+\t\t\treturn 0, 0, errors.New(\"Access denied\")\n+\t\t}\n+\n+\t\tif len(allIfaceRxByteFiles) == 0 {\n+\t\t\treturn 0, 0, errors.New(\"No valid iface found\")\n+\t\t}\n+\n+\t\trxSum := int64(0)\n+\t\ttxSum := int64(0)\n+\t\tfor _, rxByteFile := range allIfaceRxByteFiles {\n+\t\t\trxBytes, err := os.ReadFile(rxByteFile)\n+\t\t\tif err == nil {\n+\t\t\t\trxBytesInt, err := strconv.Atoi(strings.TrimSpace(string(rxBytes)))\n+\t\t\t\tif err == nil {\n+\t\t\t\t\trxSum += int64(rxBytesInt)\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\t//Usually the tx_bytes file is nearby it. Read it as well\n+\t\t\ttxByteFile := filepath.Join(filepath.Dir(rxByteFile), \"tx_bytes\")\n+\t\t\ttxBytes, err := os.ReadFile(txByteFile)\n+\t\t\tif err == nil {\n+\t\t\t\ttxBytesInt, err := strconv.Atoi(strings.TrimSpace(string(txBytes)))\n+\t\t\t\tif err == nil {\n+\t\t\t\t\ttxSum += int64(txBytesInt)\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t}\n+\n+\t\t//Return value as bits\n+\t\treturn rxSum * 8, txSum * 8, nil\n+\n+\t} else if runtime.GOOS == \"darwin\" {\n+\t\tcmd := exec.Command(\"netstat\", \"-ib\") //get data from netstat -ib\n+\t\tout, err := cmd.Output()\n+\t\tif err != nil {\n+\t\t\treturn 0, 0, err\n+\t\t}\n+\n+\t\toutStrs := string(out)                                                          //byte array to multi-line string\n+\t\tfor _, outStr := range strings.Split(strings.TrimSuffix(outStrs, \"\\n\"), \"\\n\") { //foreach multi-line string\n+\t\t\tif strings.HasPrefix(outStr, \"en\") { //search for ethernet interface\n+\t\t\t\tif strings.Contains(outStr, \"<Link#\") { //search for the link with <Link#?>\n+\t\t\t\t\toutStrSplit := strings.Fields(outStr) //split by white-space\n+\n+\t\t\t\t\trxSum, errRX := strconv.Atoi(outStrSplit[6]) //received bytes sum\n+\t\t\t\t\tif errRX != nil {\n+\t\t\t\t\t\treturn 0, 0, errRX\n+\t\t\t\t\t}\n+\n+\t\t\t\t\ttxSum, errTX := strconv.Atoi(outStrSplit[9]) //transmitted bytes sum\n+\t\t\t\t\tif errTX != nil {\n+\t\t\t\t\t\treturn 0, 0, errTX\n+\t\t\t\t\t}\n+\n+\t\t\t\t\treturn int64(rxSum) * 8, int64(txSum) * 8, nil\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\n+\t\treturn 0, 0, nil //no ethernet adapters with en*/<Link#*>\n+\t}\n+\n+\treturn 0, 0, errors.New(\"Platform not supported\")\n+}"
            },
            {
                "sha": "648b7463e76794a08776347f4b9cd9580a1a177c",
                "filename": "src/mod/netstat/nic.go",
                "status": "added",
                "additions": 55,
                "deletions": 0,
                "changes": 55,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fnetstat%2Fnic.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fnetstat%2Fnic.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fnetstat%2Fnic.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,55 @@\n+package netstat\n+\n+import (\n+\t\"encoding/json\"\n+\t\"net\"\n+\t\"net/http\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+type NetworkInterface struct {\n+\tName string\n+\tID   int\n+\tIPs  []string\n+}\n+\n+func HandleListNetworkInterfaces(w http.ResponseWriter, r *http.Request) {\n+\tnic, err := ListNetworkInterfaces()\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tjs, _ := json.Marshal(nic)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func ListNetworkInterfaces() ([]NetworkInterface, error) {\n+\tvar interfaces []NetworkInterface\n+\n+\tifaces, err := net.Interfaces()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tfor _, iface := range ifaces {\n+\t\tvar ips []string\n+\t\taddrs, err := iface.Addrs()\n+\t\tif err != nil {\n+\t\t\treturn nil, err\n+\t\t}\n+\n+\t\tfor _, addr := range addrs {\n+\t\t\tips = append(ips, addr.String())\n+\t\t}\n+\n+\t\tinterfaces = append(interfaces, NetworkInterface{\n+\t\t\tName: iface.Name,\n+\t\t\tID:   iface.Index,\n+\t\t\tIPs:  ips,\n+\t\t})\n+\t}\n+\n+\treturn interfaces, nil\n+}"
            },
            {
                "sha": "3e055f032247c736f6233f14be0595e2c9a5d2df",
                "filename": "src/mod/reverseproxy/LICENSE",
                "status": "added",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Freverseproxy%2FLICENSE",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Freverseproxy%2FLICENSE",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Freverseproxy%2FLICENSE?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,21 @@\n+MIT License\n+\n+Copyright (c) 2018-present tobychui\n+\n+Permission is hereby granted, free of charge, to any person obtaining a copy\n+of this software and associated documentation files (the \"Software\"), to deal\n+in the Software without restriction, including without limitation the rights\n+to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+copies of the Software, and to permit persons to whom the Software is\n+furnished to do so, subject to the following conditions:\n+\n+The above copyright notice and this permission notice shall be included in all\n+copies or substantial portions of the Software.\n+\n+THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+SOFTWARE."
            },
            {
                "sha": "678287e28bcd9ab5d8cd6bcbe99f4a5dcbfbbd09",
                "filename": "src/mod/reverseproxy/reverse.go",
                "status": "added",
                "additions": 405,
                "deletions": 0,
                "changes": 405,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Freverseproxy%2Freverse.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Freverseproxy%2Freverse.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Freverseproxy%2Freverse.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,405 @@\n+package reverseproxy\n+\n+import (\n+\t\"errors\"\n+\t\"io\"\n+\t\"log\"\n+\t\"net\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\t\"strings\"\n+\t\"sync\"\n+\t\"time\"\n+)\n+\n+var onExitFlushLoop func()\n+\n+const (\n+\tdefaultTimeout = time.Minute * 5\n+)\n+\n+// ReverseProxy is an HTTP Handler that takes an incoming request and\n+// sends it to another server, proxying the response back to the\n+// client, support http, also support https tunnel using http.hijacker\n+type ReverseProxy struct {\n+\t// Set the timeout of the proxy server, default is 5 minutes\n+\tTimeout time.Duration\n+\n+\t// Director must be a function which modifies\n+\t// the request into a new request to be sent\n+\t// using Transport. Its response is then copied\n+\t// back to the original client unmodified.\n+\t// Director must not access the provided Request\n+\t// after returning.\n+\tDirector func(*http.Request)\n+\n+\t// The transport used to perform proxy requests.\n+\t// default is http.DefaultTransport.\n+\tTransport http.RoundTripper\n+\n+\t// FlushInterval specifies the flush interval\n+\t// to flush to the client while copying the\n+\t// response body. If zero, no periodic flushing is done.\n+\tFlushInterval time.Duration\n+\n+\t// ErrorLog specifies an optional logger for errors\n+\t// that occur when attempting to proxy the request.\n+\t// If nil, logging goes to os.Stderr via the log package's\n+\t// standard logger.\n+\tErrorLog *log.Logger\n+\n+\t// ModifyResponse is an optional function that\n+\t// modifies the Response from the backend.\n+\t// If it returns an error, the proxy returns a StatusBadGateway error.\n+\tModifyResponse func(*http.Response) error\n+\n+\tVerbal bool\n+}\n+\n+type requestCanceler interface {\n+\tCancelRequest(req *http.Request)\n+}\n+\n+// NewReverseProxy returns a new ReverseProxy that routes\n+// URLs to the scheme, host, and base path provided in target. If the\n+// target's path is \"/base\" and the incoming request was for \"/dir\",\n+// the target request will be for /base/dir. if the target's query is a=10\n+// and the incoming request's query is b=100, the target's request's query\n+// will be a=10&b=100.\n+// NewReverseProxy does not rewrite the Host header.\n+// To rewrite Host headers, use ReverseProxy directly with a custom\n+// Director policy.\n+func NewReverseProxy(target *url.URL) *ReverseProxy {\n+\ttargetQuery := target.RawQuery\n+\tdirector := func(req *http.Request) {\n+\t\treq.URL.Scheme = target.Scheme\n+\t\treq.URL.Host = target.Host\n+\t\treq.URL.Path = singleJoiningSlash(target.Path, req.URL.Path)\n+\n+\t\t// If Host is empty, the Request.Write method uses\n+\t\t// the value of URL.Host.\n+\t\t// force use URL.Host\n+\t\treq.Host = req.URL.Host\n+\t\tif targetQuery == \"\" || req.URL.RawQuery == \"\" {\n+\t\t\treq.URL.RawQuery = targetQuery + req.URL.RawQuery\n+\t\t} else {\n+\t\t\treq.URL.RawQuery = targetQuery + \"&\" + req.URL.RawQuery\n+\t\t}\n+\n+\t\tif _, ok := req.Header[\"User-Agent\"]; !ok {\n+\t\t\treq.Header.Set(\"User-Agent\", \"\")\n+\t\t}\n+\t}\n+\n+\treturn &ReverseProxy{Director: director, Verbal: false}\n+}\n+\n+func singleJoiningSlash(a, b string) string {\n+\taslash := strings.HasSuffix(a, \"/\")\n+\tbslash := strings.HasPrefix(b, \"/\")\n+\tswitch {\n+\tcase aslash && bslash:\n+\t\treturn a + b[1:]\n+\tcase !aslash && !bslash:\n+\t\treturn a + \"/\" + b\n+\t}\n+\treturn a + b\n+}\n+\n+func copyHeader(dst, src http.Header) {\n+\tfor k, vv := range src {\n+\t\tfor _, v := range vv {\n+\t\t\tdst.Add(k, v)\n+\t\t}\n+\t}\n+}\n+\n+// Hop-by-hop headers. These are removed when sent to the backend.\n+// http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html\n+var hopHeaders = []string{\n+\t//\"Connection\",\n+\t\"Proxy-Connection\", // non-standard but still sent by libcurl and rejected by e.g. google\n+\t\"Keep-Alive\",\n+\t\"Proxy-Authenticate\",\n+\t\"Proxy-Authorization\",\n+\t\"Te\",      // canonicalized version of \"TE\"\n+\t\"Trailer\", // not Trailers per URL above; http://www.rfc-editor.org/errata_search.php?eid=4522\n+\t\"Transfer-Encoding\",\n+\t//\"Upgrade\",\n+}\n+\n+func (p *ReverseProxy) copyResponse(dst io.Writer, src io.Reader) {\n+\tif p.FlushInterval != 0 {\n+\t\tif wf, ok := dst.(writeFlusher); ok {\n+\t\t\tmlw := &maxLatencyWriter{\n+\t\t\t\tdst:     wf,\n+\t\t\t\tlatency: p.FlushInterval,\n+\t\t\t\tdone:    make(chan bool),\n+\t\t\t}\n+\n+\t\t\tgo mlw.flushLoop()\n+\t\t\tdefer mlw.stop()\n+\t\t\tdst = mlw\n+\t\t}\n+\t}\n+\n+\tio.Copy(dst, src)\n+}\n+\n+type writeFlusher interface {\n+\tio.Writer\n+\thttp.Flusher\n+}\n+\n+type maxLatencyWriter struct {\n+\tdst     writeFlusher\n+\tlatency time.Duration\n+\tmu      sync.Mutex\n+\tdone    chan bool\n+}\n+\n+func (m *maxLatencyWriter) Write(b []byte) (int, error) {\n+\tm.mu.Lock()\n+\tdefer m.mu.Unlock()\n+\treturn m.dst.Write(b)\n+}\n+\n+func (m *maxLatencyWriter) flushLoop() {\n+\tt := time.NewTicker(m.latency)\n+\tdefer t.Stop()\n+\tfor {\n+\t\tselect {\n+\t\tcase <-m.done:\n+\t\t\tif onExitFlushLoop != nil {\n+\t\t\t\tonExitFlushLoop()\n+\t\t\t}\n+\t\t\treturn\n+\t\tcase <-t.C:\n+\t\t\tm.mu.Lock()\n+\t\t\tm.dst.Flush()\n+\t\t\tm.mu.Unlock()\n+\t\t}\n+\t}\n+}\n+\n+func (m *maxLatencyWriter) stop() {\n+\tm.done <- true\n+}\n+\n+func (p *ReverseProxy) logf(format string, args ...interface{}) {\n+\tif p.ErrorLog != nil {\n+\t\tp.ErrorLog.Printf(format, args...)\n+\t} else {\n+\t\tlog.Printf(format, args...)\n+\t}\n+}\n+\n+func removeHeaders(header http.Header) {\n+\t// Remove hop-by-hop headers listed in the \"Connection\" header.\n+\tif c := header.Get(\"Connection\"); c != \"\" {\n+\t\tfor _, f := range strings.Split(c, \",\") {\n+\t\t\tif f = strings.TrimSpace(f); f != \"\" {\n+\t\t\t\theader.Del(f)\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t// Remove hop-by-hop headers\n+\tfor _, h := range hopHeaders {\n+\t\tif header.Get(h) != \"\" {\n+\t\t\theader.Del(h)\n+\t\t}\n+\t}\n+\n+\tif header.Get(\"A-Upgrade\") != \"\" {\n+\t\theader.Set(\"Upgrade\", header.Get(\"A-Upgrade\"))\n+\t\theader.Del(\"A-Upgrade\")\n+\t}\n+}\n+\n+func addXForwardedForHeader(req *http.Request) {\n+\tif clientIP, _, err := net.SplitHostPort(req.RemoteAddr); err == nil {\n+\t\t// If we aren't the first proxy retain prior\n+\t\t// X-Forwarded-For information as a comma+space\n+\t\t// separated list and fold multiple headers into one.\n+\t\tif prior, ok := req.Header[\"X-Forwarded-For\"]; ok {\n+\t\t\tclientIP = strings.Join(prior, \", \") + \", \" + clientIP\n+\t\t}\n+\t\treq.Header.Set(\"X-Forwarded-For\", clientIP)\n+\t}\n+}\n+\n+func (p *ReverseProxy) ProxyHTTP(rw http.ResponseWriter, req *http.Request) error {\n+\ttransport := p.Transport\n+\tif transport == nil {\n+\t\ttransport = http.DefaultTransport\n+\t}\n+\n+\toutreq := new(http.Request)\n+\t// Shallow copies of maps, like header\n+\t*outreq = *req\n+\n+\tif cn, ok := rw.(http.CloseNotifier); ok {\n+\t\tif requestCanceler, ok := transport.(requestCanceler); ok {\n+\t\t\t// After the Handler has returned, there is no guarantee\n+\t\t\t// that the channel receives a value, so to make sure\n+\t\t\treqDone := make(chan struct{})\n+\t\t\tdefer close(reqDone)\n+\t\t\tclientGone := cn.CloseNotify()\n+\n+\t\t\tgo func() {\n+\t\t\t\tselect {\n+\t\t\t\tcase <-clientGone:\n+\t\t\t\t\trequestCanceler.CancelRequest(outreq)\n+\t\t\t\tcase <-reqDone:\n+\t\t\t\t}\n+\t\t\t}()\n+\t\t}\n+\t}\n+\n+\tp.Director(outreq)\n+\toutreq.Close = false\n+\n+\t// We may modify the header (shallow copied above), so we only copy it.\n+\toutreq.Header = make(http.Header)\n+\tcopyHeader(outreq.Header, req.Header)\n+\n+\t// Remove hop-by-hop headers listed in the \"Connection\" header, Remove hop-by-hop headers.\n+\tremoveHeaders(outreq.Header)\n+\n+\t// Add X-Forwarded-For Header.\n+\taddXForwardedForHeader(outreq)\n+\n+\tres, err := transport.RoundTrip(outreq)\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\n+\t\t//rw.WriteHeader(http.StatusBadGateway)\n+\t\treturn err\n+\t}\n+\n+\t// Remove hop-by-hop headers listed in the \"Connection\" header of the response, Remove hop-by-hop headers.\n+\tremoveHeaders(res.Header)\n+\n+\tif p.ModifyResponse != nil {\n+\t\tif err := p.ModifyResponse(res); err != nil {\n+\t\t\tif p.Verbal {\n+\t\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t\t}\n+\t\t\t//rw.WriteHeader(http.StatusBadGateway)\n+\t\t\treturn err\n+\t\t}\n+\t}\n+\n+\t// Copy header from response to client.\n+\tcopyHeader(rw.Header(), res.Header)\n+\n+\t// The \"Trailer\" header isn't included in the Transport's response, Build it up from Trailer.\n+\tif len(res.Trailer) > 0 {\n+\t\ttrailerKeys := make([]string, 0, len(res.Trailer))\n+\t\tfor k := range res.Trailer {\n+\t\t\ttrailerKeys = append(trailerKeys, k)\n+\t\t}\n+\t\trw.Header().Add(\"Trailer\", strings.Join(trailerKeys, \", \"))\n+\t}\n+\n+\trw.WriteHeader(res.StatusCode)\n+\tif len(res.Trailer) > 0 {\n+\t\t// Force chunking if we saw a response trailer.\n+\t\t// This prevents net/http from calculating the length for short\n+\t\t// bodies and adding a Content-Length.\n+\t\tif fl, ok := rw.(http.Flusher); ok {\n+\t\t\tfl.Flush()\n+\t\t}\n+\t}\n+\n+\tp.copyResponse(rw, res.Body)\n+\t// close now, instead of defer, to populate res.Trailer\n+\tres.Body.Close()\n+\tcopyHeader(rw.Header(), res.Trailer)\n+\n+\treturn nil\n+}\n+\n+func (p *ReverseProxy) ProxyHTTPS(rw http.ResponseWriter, req *http.Request) error {\n+\thij, ok := rw.(http.Hijacker)\n+\tif !ok {\n+\t\tp.logf(\"http server does not support hijacker\")\n+\t\treturn errors.New(\"http server does not support hijacker\")\n+\t}\n+\n+\tclientConn, _, err := hij.Hijack()\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\t\treturn err\n+\t}\n+\n+\tproxyConn, err := net.Dial(\"tcp\", req.URL.Host)\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\t\treturn err\n+\t}\n+\n+\t// The returned net.Conn may have read or write deadlines\n+\t// already set, depending on the configuration of the\n+\t// Server, to set or clear those deadlines as needed\n+\t// we set timeout to 5 minutes\n+\tdeadline := time.Now()\n+\tif p.Timeout == 0 {\n+\t\tdeadline = deadline.Add(time.Minute * 5)\n+\t} else {\n+\t\tdeadline = deadline.Add(p.Timeout)\n+\t}\n+\n+\terr = clientConn.SetDeadline(deadline)\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\t\treturn err\n+\t}\n+\n+\terr = proxyConn.SetDeadline(deadline)\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\t\treturn err\n+\t}\n+\n+\t_, err = clientConn.Write([]byte(\"HTTP/1.0 200 OK\\r\\n\\r\\n\"))\n+\tif err != nil {\n+\t\tif p.Verbal {\n+\t\t\tp.logf(\"http: proxy error: %v\", err)\n+\t\t}\n+\t\treturn err\n+\t}\n+\n+\tgo func() {\n+\t\tio.Copy(clientConn, proxyConn)\n+\t\tclientConn.Close()\n+\t\tproxyConn.Close()\n+\t}()\n+\n+\tio.Copy(proxyConn, clientConn)\n+\tproxyConn.Close()\n+\tclientConn.Close()\n+\n+\treturn nil\n+}\n+\n+func (p *ReverseProxy) ServeHTTP(rw http.ResponseWriter, req *http.Request) error {\n+\tif req.Method == \"CONNECT\" {\n+\t\terr := p.ProxyHTTPS(rw, req)\n+\t\treturn err\n+\t} else {\n+\t\terr := p.ProxyHTTP(rw, req)\n+\t\treturn err\n+\t}\n+}"
            },
            {
                "sha": "9db28d087b9d346d825d033033b6c275c3f0deda",
                "filename": "src/mod/sshprox/gotty/.gotty",
                "status": "added",
                "additions": 302,
                "deletions": 0,
                "changes": 302,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2F.gotty",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2F.gotty",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Fgotty%2F.gotty?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,302 @@\n+// [string] Address to listen, all addresses will be used when empty\n+// address = \"\"\n+\n+// [string] Port to listen\n+// port = \"8080\"\n+\n+// [bool] Permit clients to write to the TTY\n+// permit_write = false\n+\n+// [bool] Enable basic authentication\n+// enable_basic_auth = false\n+\n+// [string] Default username and password of basic authentication (user:pass)\n+//          To enable basic authentication, set `true` to `enable_basic_auth`\n+// credential = \"user:pass\"\n+\n+// [bool] Enable random URL generation\n+// enable_random_url = false\n+\n+// [int] Default length of random strings appended to URL\n+//       To enable random URL generation, set `true` to `enable_random_url`\n+// random_url_length = 8\n+\n+// [bool] Enable TLS/SSL\n+// enable_tls = false\n+\n+// [string] Default TLS certificate file path\n+// tls_crt_file = \"~/.gotty.crt\"\n+\n+// [string] Default TLS key file path\n+// tls_key_file = \"~/.gotty.key\"\n+\n+// [bool] Enable client certificate authentication\n+// enable_tls_client_auth = false\n+\n+// [string] Certificate file of CA for client certificates\n+// tls_ca_crt_file = \"~/.gotty.ca.crt\"\n+\n+// [string] Custom index.html file\n+// index_file = \"\"\n+\n+// [string] Title format of browser window\n+//          Available variables are:\n+//            Command    Command string\n+//            Pid        PID of the process for the client\n+//            Hostname   Server hostname\n+//            RemoteAddr Client IP address\n+// title_format = \"GoTTY - {{ .Command }} ({{ .Hostname }})\"\n+\n+// [bool] Enable client side reconnection when connection closed\n+// enable_reconnect = false\n+\n+// [int] Interval time to try reconnection (seconds)\n+//       To enable reconnection, set `true` to `enable_reconnect`\n+// reconnect_time = 10\n+\n+// [int] Timeout seconds for waiting a client (0 to disable)\n+// timeout = 60\n+\n+// [int] Maximum connection to gotty, 0(default) means no limit.\n+// max_connection = 0\n+\n+// [bool] Accept only one client and exit gotty once the client exits\n+// once = false\n+\n+// [bool] Permit clients to send command line arguments in URL (e.g. http://example.com:8080/?arg=AAA&arg=BBB)\n+// permit_arguments = false\n+\n+// [object] Client terminal (hterm) preferences\n+// preferences {\n+\n+  // [enum(null, \"none\", \"ctrl-alt\", \"left-alt\", \"right-alt\")]\n+  //     Select an AltGr detection hack^Wheuristic.\n+  //       null: Autodetect based on navigator.language: \"en-us\" => \"none\", else => \"right-alt\"\n+  //       \"none\": Disable any AltGr related munging.\n+  //       \"ctrl-alt\": Assume Ctrl+Alt means AltGr.\n+  //       \"left-alt\": Assume left Alt means AltGr.\n+  //       \"right-alt\": Assume right Alt means AltGr.\n+  // alt_gr_mode = null\n+\n+  // [bool] If set, alt-backspace indeed is alt-backspace.\n+  // alt_backspace_is_meta_backspace = false\n+\n+  // [bool] Set whether the alt key acts as a meta key or as a distinct alt key.\n+  // alt_is_meta = false\n+\n+  // [enum(\"escape\", \"8-bit\", \"browser-key\")]\n+  //     Controls how the alt key is handled.\n+  //       \"escape\"....... Send an ESC prefix.\n+  //       \"8-bit\"........ Add 128 to the unshifted character as in xterm.\n+  //       \"browser-key\".. Wait for the keypress event and see what the browser says.\n+  //                       (This won't work well on platforms where the browser performs a default action for some alt sequences.)\n+  // alt_sends_what = \"escape\"\n+\n+  // [string] URL of the terminal bell sound.  Empty string for no audible bell.\n+  // audible_bell_sound = \"lib-resource:hterm/audio/bell\"\n+\n+  // [bool] If true, terminal bells in the background will create a Web Notification. http://www.w3.org/TR/notifications/\n+  //        Displaying notifications requires permission from the user.\n+  //        When this option is set to true, hterm will attempt to ask the user for permission if necessary.\n+  //        Note browsers may not show this permission request\n+  //        if it did not originate from a user action.\n+  // desktop_notification_bell = false\n+\n+  // [string] The background color for text with no other color attributes.\n+  // background_color = \"rgb(16, 16, 16)\"\n+\n+  // [string] CSS value of the background image.  Empty string for no image.\n+  //          For example:\n+  //            \"url(https://goo.gl/anedTK) linear-gradient(top bottom, blue, red)\"\n+  // background_image = \"\"\n+\n+  // [string] CSS value of the background image size.  Defaults to none.\n+  // background_size = \"\"\n+\n+  // [string] CSS value of the background image position.\n+  //          For example:\n+  //           \"10% 10% center\"\n+  // background_position = \"\"\n+\n+  // [bool] If true, the backspace should send BS ('\\x08', aka ^H).  Otherwise the backspace key should send '\\x7f'.\n+  // backspace_sends_backspace = false\n+\n+  // [map[string]map[string]string]\n+  //     A nested map where each property is the character set code and the value is a map that is a sparse array itself.\n+  //     In that sparse array, each property is the received character and the value is the displayed character.\n+  //     For example:\n+  //       {\"0\" = {\"+\" = \"\\u2192\"\n+  //               \",\" = \"\\u2190\"\n+  //               \"-\" = \"\\u2191\"\n+  //               \".\" = \"\\u2193\"\n+  //               \"0\" = \"\\u2588\"}}\n+  // character_map_overrides = null\n+\n+  // [bool] Whether or not to close the window when the command exits.\n+  // close_on_exit = true\n+\n+  // [bool] Whether or not to blink the cursor by default.\n+  // cursor_blink = false\n+\n+  // [2[int]] The cursor blink rate in milliseconds.\n+  //          A two element array, the first of which is how long the cursor should be on, second is how long it should be off.\n+  // cursor_blink_cycle = [1000, 500]\n+\n+  // [string] The color of the visible cursor.\n+  // cursor_color = \"rgba(255, 0, 0, 0.5)\"\n+\n+  // [[]string]\n+  //     Override colors in the default palette.\n+  //     This can be specified as an array or an object.\n+  //     Values can be specified as almost any css color value.\n+  //     This includes #RGB, #RRGGBB, rgb(...), rgba(...), and any color names that are also part of the stock X11 rgb.txt file.\n+  //     You can use 'null' to specify that the default value should be not be changed.\n+  //     This is useful for skipping a small number of indicies when the value is specified as an array.\n+  // color_palette_overrides = null\n+\n+  // [bool] Automatically copy mouse selection to the clipboard.\n+  copy_on_select = true\n+\n+  // [bool] Whether to use the default window copy behaviour\n+  //use_default_window_copy = false\n+\n+  // [bool] Whether to clear the selection after copying.\n+  clear_selection_after_copy = false\n+\n+  // [bool] If true, Ctrl-Plus/Minus/Zero controls zoom.\n+  //        If false, Ctrl-Shift-Plus/Minus/Zero controls zoom, Ctrl-Minus sends ^_, Ctrl-Plus/Zero do nothing.\n+  // ctrl_plus_minus_zero_zoom = true\n+\n+  // [bool] Ctrl+C copies if true, send ^C to host if false.\n+  //        Ctrl+Shift+C sends ^C to host if true, copies if false.\n+  // ctrl_c_copy = true\n+\n+  // [bool] Ctrl+V pastes if true, send ^V to host if false.\n+  //        Ctrl+Shift+V sends ^V to host if true, pastes if false.\n+  // ctrl_v_paste = true\n+\n+  // [bool] Set whether East Asian Ambiguous characters have two column width.\n+  // east_asian_ambiguous_as_two_column = false\n+\n+  // [bool] True to enable 8-bit control characters, false to ignore them.\n+  //        We'll respect the two-byte versions of these control characters regardless of this setting.\n+  // enable_8_bit_control = false\n+\n+  // [enum(null, true, false)]\n+  //     True if we should use bold weight font for text with the bold/bright attribute.\n+  //     False to use the normal weight font.\n+  //     Null to autodetect.\n+  // enable_bold = null\n+\n+  // [bool] True if we should use bright colors (8-15 on a 16 color palette) for any text with the bold attribute.\n+  //        False otherwise.\n+  // enable_bold_as_bright = true\n+\n+  // [bool] Show a message in the terminal when the host writes to the clipboard.\n+  // enable_clipboard_notice = true\n+\n+  // [bool] Allow the host to write directly to the system clipboard.\n+  // enable_clipboard_write = true\n+\n+  // [bool] Respect the host's attempt to change the cursor blink status using DEC Private Mode 12.\n+  // enable_dec12 = false\n+\n+  // [map[string]string] The default environment variables, as an object.\n+  // environment = {\"TERM\" = \"xterm-256color\"}\n+\n+  // [string] Default font family for the terminal text.\n+  // font_family = \"'DejaVu Sans Mono', 'Everson Mono', FreeMono, 'Menlo', 'Terminal', monospace\"\n+\n+  // [int] The default font size in pixels.\n+  // font_size = 15\n+\n+  // [string] CSS font-smoothing property.\n+  // font_smoothing = \"antialiased\"\n+\n+  // [string] The foreground color for text with no other color attributes.\n+  // foreground_color = \"rgb(240, 240, 240)\"\n+\n+  // [bool] If true, home/end will control the terminal scrollbar and shift home/end will send the VT keycodes.\n+  //        If false then home/end sends VT codes and shift home/end scrolls.\n+  // home_keys_scroll = false\n+\n+  // [map[string]string]\n+  //     A map of key sequence to key actions.\n+  //     Key sequences include zero or more modifier keys followed by a key code.\n+  //     Key codes can be decimal or hexadecimal numbers, or a key identifier.\n+  //     Key actions can be specified a string to send to the host, or an action identifier.\n+  //     For a full list of key code and action identifiers, see https://goo.gl/8AoD09.\n+  //     Sample keybindings:\n+  //       {\"Ctrl-Alt-K\" = \"clearScrollback\"\n+  //        \"Ctrl-Shift-L\"= \"PASS\"\n+  //        \"Ctrl-H\" = \"'HELLO\\n'\"}\n+  // keybindings = null\n+\n+  // [int] Max length of a DCS, OSC, PM, or APS sequence before we give up and ignore the code.\n+  // max_string_sequence = 100000\n+\n+  // [bool] If true, convert media keys to their Fkey equivalent.\n+  //        If false, let the browser handle the keys.\n+  // media_keys_are_fkeys = false\n+\n+  // [bool] Set whether the meta key sends a leading escape or not.\n+  // meta_sends_escape = true\n+\n+  // [enum(null, 0, 1, 2, 3, 4, 5, 6]\n+  //     Mouse paste button, or null to autodetect.\n+  //     For autodetect, we'll try to enable middle button paste for non-X11 platforms.\n+  //     On X11 we move it to button 3.\n+  // mouse_paste_button = null\n+\n+  // [bool] If true, page up/down will control the terminal scrollbar and shift page up/down will send the VT keycodes.\n+  //        If false then page up/down sends VT codes and shift page up/down scrolls.\n+  // page_keys_scroll = false\n+\n+  // [enum(null, true, false)]\n+  //     Set whether we should pass Alt-1..9 to the browser.\n+  //     This is handy when running hterm in a browser tab, so that you don't lose Chrome's \"switch to tab\" keyboard accelerators.\n+  //     When not running in a tab it's better to send these keys to the host so they can be used in vim or emacs.\n+  //     If true, Alt-1..9 will be handled by the browser.\n+  //     If false, Alt-1..9 will be sent to the host.\n+  //     If null, autodetect based on browser platform and window type.\n+  // pass_alt_number = null\n+\n+  // [enum(null, true, false)]\n+  //     Set whether we should pass Ctrl-1..9 to the browser.\n+  //     This is handy when running hterm in a browser tab, so that you don't lose Chrome's \"switch to tab\" keyboard accelerators.\n+  //     When not running in a tab it's better to send these keys to the host so they can be used in vim or emacs.\n+  //     If true, Ctrl-1..9 will be handled by the browser.\n+  //     If false, Ctrl-1..9 will be sent to the host.\n+  //     If null, autodetect based on browser platform and window type.\n+  // pass_ctrl_number = null\n+\n+  // [enum(null, true, false)]\n+  //     Set whether we should pass Meta-1..9 to the browser.\n+  //     This is handy when running hterm in a browser tab, so that you don't lose Chrome's \"switch to tab\" keyboard accelerators.\n+  //     When not running in a tab it's better to send these keys to the host so they can be used in vim or emacs.\n+  //     If true, Meta-1..9 will be handled by the browser.\n+  //     If false, Meta-1..9 will be sent to the host.  If null, autodetect based on browser platform and window type.\n+  // pass_meta_number = null\n+\n+  // [bool] Set whether meta-V gets passed to host.\n+  // pass_meta_v = true\n+\n+  // [bool] If true, scroll to the bottom on any keystroke.\n+  // scroll_on_keystroke = true\n+\n+  // [bool] If true, scroll to the bottom on terminal output.\n+  // scroll_on_output = false\n+\n+  // [bool] The vertical scrollbar mode.\n+  // scrollbar_visible = true\n+\n+  // [int] The multiplier for the pixel delta in mousewheel event caused by the scroll wheel. Alters how fast the page scrolls.\n+  // scroll_wheel_move_multiplier = 1\n+\n+  // [bool] Shift + Insert pastes if true, sent to host if false.\n+  // shift_insert_paste = true\n+\n+  // [string] URL of user stylesheet to include in the terminal document.\n+  // user_css = \"\"\n+\n+// }"
            },
            {
                "sha": "e93081f8ed92dded4970f197639598e1b48f7874",
                "filename": "src/mod/sshprox/gotty/LICENSE",
                "status": "added",
                "additions": 21,
                "deletions": 0,
                "changes": 21,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2FLICENSE",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2FLICENSE",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Fgotty%2FLICENSE?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,21 @@\n+The MIT License (MIT)\n+\n+Copyright (c) 2015-2017 Iwasaki Yudai\n+\n+Permission is hereby granted, free of charge, to any person obtaining a copy\n+of this software and associated documentation files (the \"Software\"), to deal\n+in the Software without restriction, including without limitation the rights\n+to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+copies of the Software, and to permit persons to whom the Software is\n+furnished to do so, subject to the following conditions:\n+\n+The above copyright notice and this permission notice shall be included in\n+all copies or substantial portions of the Software.\n+\n+THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+THE SOFTWARE."
            },
            {
                "sha": "7cd073e773314d10dd3c07ece887746452b44177",
                "filename": "src/mod/sshprox/gotty/gotty_linux_386",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_386",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_386",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_386?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0"
            },
            {
                "sha": "ca5cdca0952a69605c2e2378cd34f455df1ee2d9",
                "filename": "src/mod/sshprox/gotty/gotty_linux_amd64",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_amd64",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_amd64",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_amd64?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0"
            },
            {
                "sha": "744fe2892419fa0f840a264314a86e3b7bcb1011",
                "filename": "src/mod/sshprox/gotty/gotty_linux_arm",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_arm",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_arm",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_arm?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0"
            },
            {
                "sha": "62017dcd93e4d4d838edb98c8823f72fb63c523b",
                "filename": "src/mod/sshprox/gotty/gotty_linux_arm64",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_arm64",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_arm64",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Fgotty%2Fgotty_linux_arm64?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0"
            },
            {
                "sha": "92fb2d1d8c9e32bdfc215ef10492f64c05ef2454",
                "filename": "src/mod/sshprox/sshprox.go",
                "status": "added",
                "additions": 222,
                "deletions": 0,
                "changes": 222,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fsshprox.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Fsshprox.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Fsshprox.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,222 @@\n+package sshprox\n+\n+import (\n+\t\"embed\"\n+\t\"errors\"\n+\t\"fmt\"\n+\t\"log\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\t\"os\"\n+\t\"os/exec\"\n+\t\"path/filepath\"\n+\t\"runtime\"\n+\t\"strconv\"\n+\t\"strings\"\n+\n+\t\"github.com/google/uuid\"\n+\t\"imuslab.com/zoraxy/mod/reverseproxy\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+\t\"imuslab.com/zoraxy/mod/websocketproxy\"\n+)\n+\n+/*\n+\tSSH Proxy\n+\n+\tThis is a tool to bind gotty into Zoraxy\n+\tso that you can do something similar to\n+\tonline ssh terminal\n+*/\n+\n+/*\n+\tBianry embedding\n+\n+\tMake sure when compile, gotty binary exists in static.gotty\n+*/\n+var (\n+\t//go:embed gotty/*\n+\tgotty embed.FS\n+)\n+\n+type Manager struct {\n+\tStartingPort int\n+\tInstances    []*Instance\n+}\n+\n+type Instance struct {\n+\tUUID         string\n+\tExecPath     string\n+\tRemoteAddr   string\n+\tRemotePort   int\n+\tAssignedPort int\n+\tconn         *reverseproxy.ReverseProxy //HTTP proxy\n+\ttty          *exec.Cmd                  //SSH connection ported to web interface\n+\tParent       *Manager\n+}\n+\n+func NewSSHProxyManager() *Manager {\n+\treturn &Manager{\n+\t\tStartingPort: 14810,\n+\t\tInstances:    []*Instance{},\n+\t}\n+}\n+\n+//Get the next free port in the list\n+func (m *Manager) GetNextPort() int {\n+\tnextPort := m.StartingPort\n+\toccupiedPort := make(map[int]bool)\n+\tfor _, instance := range m.Instances {\n+\t\toccupiedPort[instance.AssignedPort] = true\n+\t}\n+\tfor {\n+\t\tif !occupiedPort[nextPort] {\n+\t\t\treturn nextPort\n+\t\t}\n+\t\tnextPort++\n+\t}\n+}\n+\n+func (m *Manager) HandleHttpByInstanceId(instanceId string, w http.ResponseWriter, r *http.Request) {\n+\ttargetInstance, err := m.GetInstanceById(instanceId)\n+\tif err != nil {\n+\t\thttp.Error(w, err.Error(), http.StatusNotFound)\n+\t\treturn\n+\t}\n+\n+\tif targetInstance.tty == nil {\n+\t\t//Server side already closed\n+\t\thttp.Error(w, \"Connection already closed\", http.StatusInternalServerError)\n+\t\treturn\n+\t}\n+\n+\tr.Header.Set(\"X-Forwarded-Host\", r.Host)\n+\trequestURL := r.URL.String()\n+\tif r.Header[\"Upgrade\"] != nil && strings.ToLower(r.Header[\"Upgrade\"][0]) == \"websocket\" {\n+\t\t//Handle WebSocket request. Forward the custom Upgrade header and rewrite origin\n+\t\tr.Header.Set(\"A-Upgrade\", \"websocket\")\n+\t\trequestURL = strings.TrimPrefix(requestURL, \"/\")\n+\t\tu, _ := url.Parse(\"ws://127.0.0.1:\" + strconv.Itoa(targetInstance.AssignedPort) + \"/\" + requestURL)\n+\t\twspHandler := websocketproxy.NewProxy(u)\n+\t\twspHandler.ServeHTTP(w, r)\n+\t\treturn\n+\t}\n+\n+\ttargetInstance.conn.ProxyHTTP(w, r)\n+}\n+\n+func (m *Manager) GetInstanceById(instanceId string) (*Instance, error) {\n+\tfor _, instance := range m.Instances {\n+\t\tif instance.UUID == instanceId {\n+\t\t\treturn instance, nil\n+\t\t}\n+\t}\n+\treturn nil, fmt.Errorf(\"instance not found: %s\", instanceId)\n+}\n+func (m *Manager) NewSSHProxy(binaryRoot string) (*Instance, error) {\n+\t//Check if the binary exists in system/gotty/\n+\tbinary := \"gotty_\" + runtime.GOOS + \"_\" + runtime.GOARCH\n+\n+\tif runtime.GOOS == \"windows\" {\n+\t\tbinary = binary + \".exe\"\n+\t}\n+\n+\t//Extract it from embedfs if not exists locally\n+\texecPath := filepath.Join(binaryRoot, binary)\n+\n+\t//Create the storage folder structure\n+\tos.MkdirAll(filepath.Dir(execPath), 0775)\n+\n+\t//Create config file if not exists\n+\tif !utils.FileExists(filepath.Join(filepath.Dir(execPath), \".gotty\")) {\n+\t\tconfigFile, _ := gotty.ReadFile(\"gotty/.gotty\")\n+\t\tos.WriteFile(filepath.Join(filepath.Dir(execPath), \".gotty\"), configFile, 0775)\n+\t}\n+\n+\t//Create web.ssh binary if not exists\n+\tif !utils.FileExists(execPath) {\n+\t\t//Try to extract it from embedded fs\n+\t\texecutable, err := gotty.ReadFile(\"gotty/\" + binary)\n+\t\tif err != nil {\n+\t\t\t//Binary not found in embedded\n+\t\t\treturn nil, errors.New(\"platform not supported\")\n+\t\t}\n+\n+\t\t//Extract to target location\n+\t\terr = os.WriteFile(execPath, executable, 0777)\n+\t\tif err != nil {\n+\t\t\t//Binary not found in embedded\n+\t\t\tlog.Println(\"Extract web.ssh failed: \" + err.Error())\n+\t\t\treturn nil, errors.New(\"web.ssh sub-program extract failed\")\n+\t\t}\n+\t}\n+\n+\t//Convert the binary path to realpath\n+\trealpath, err := filepath.Abs(execPath)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\n+\tthisInstance := Instance{\n+\t\tUUID:         uuid.New().String(),\n+\t\tExecPath:     realpath,\n+\t\tAssignedPort: -1,\n+\t\tParent:       m,\n+\t}\n+\n+\tm.Instances = append(m.Instances, &thisInstance)\n+\n+\treturn &thisInstance, nil\n+}\n+\n+//Create a new Connection to target address\n+func (i *Instance) CreateNewConnection(listenPort int, username string, remoteIpAddr string, remotePort int) error {\n+\t//Create a gotty instance\n+\tconnAddr := remoteIpAddr\n+\tif username != \"\" {\n+\t\tconnAddr = username + \"@\" + remoteIpAddr\n+\t}\n+\tconfigPath := filepath.Join(filepath.Dir(i.ExecPath), \".gotty\")\n+\ttitle := username + \"@\" + remoteIpAddr\n+\tif remotePort != 22 {\n+\t\ttitle = title + \":\" + strconv.Itoa(remotePort)\n+\t}\n+\n+\tsshCommand := []string{\"ssh\", \"-t\", connAddr, \"-p\", strconv.Itoa(remotePort)}\n+\tcmd := exec.Command(i.ExecPath, \"-w\", \"-p\", strconv.Itoa(listenPort), \"--once\", \"--config\", configPath, \"--title-format\", title, \"bash\", \"-c\", strings.Join(sshCommand, \" \"))\n+\tcmd.Dir = filepath.Dir(i.ExecPath)\n+\tcmd.Env = append(os.Environ(), \"TERM=xterm\")\n+\tcmd.Stdout = os.Stdout\n+\tcmd.Stderr = os.Stderr\n+\tgo func() {\n+\t\tcmd.Run()\n+\t\ti.Destroy()\n+\t}()\n+\ti.tty = cmd\n+\ti.AssignedPort = listenPort\n+\ti.RemoteAddr = remoteIpAddr\n+\ti.RemotePort = remotePort\n+\n+\t//Create a new proxy agent for this root\n+\tpath, err := url.Parse(\"http://127.0.0.1:\" + strconv.Itoa(listenPort))\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\t//Create new proxy objects to the proxy\n+\tproxy := reverseproxy.NewReverseProxy(path)\n+\n+\ti.conn = proxy\n+\treturn nil\n+}\n+\n+func (i *Instance) Destroy() {\n+\t// Remove the instance from the Manager's Instances list\n+\tfor idx, inst := range i.Parent.Instances {\n+\t\tif inst == i {\n+\t\t\t// Remove the instance from the slice by swapping it with the last instance and slicing the slice\n+\t\t\ti.Parent.Instances[len(i.Parent.Instances)-1], i.Parent.Instances[idx] = i.Parent.Instances[idx], i.Parent.Instances[len(i.Parent.Instances)-1]\n+\t\t\ti.Parent.Instances = i.Parent.Instances[:len(i.Parent.Instances)-1]\n+\t\t\tbreak\n+\t\t}\n+\t}\n+}"
            },
            {
                "sha": "46801c028d88c37f4f5d57886b8b12e1e4783f75",
                "filename": "src/mod/sshprox/utils.go",
                "status": "added",
                "additions": 72,
                "deletions": 0,
                "changes": 72,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Futils.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fsshprox%2Futils.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fsshprox%2Futils.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,72 @@\n+package sshprox\n+\n+import (\n+\t\"fmt\"\n+\t\"net\"\n+\t\"net/url\"\n+\t\"runtime\"\n+\t\"strings\"\n+\t\"time\"\n+)\n+\n+//Rewrite url based on proxy root\n+func RewriteURL(rooturl string, requestURL string) (*url.URL, error) {\n+\trewrittenURL := strings.TrimPrefix(requestURL, rooturl)\n+\treturn url.Parse(rewrittenURL)\n+}\n+\n+//Check if the current platform support web.ssh function\n+func IsWebSSHSupported() bool {\n+\t//Check if the binary exists in system/gotty/\n+\tbinary := \"gotty_\" + runtime.GOOS + \"_\" + runtime.GOARCH\n+\n+\tif runtime.GOOS == \"windows\" {\n+\t\tbinary = binary + \".exe\"\n+\t}\n+\n+\t//Check if the target gotty terminal exists\n+\tf, err := gotty.Open(\"gotty/\" + binary)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\tf.Close()\n+\treturn true\n+}\n+\n+//Check if a given domain and port is a valid ssh server\n+func IsSSHConnectable(ipOrDomain string, port int) bool {\n+\ttimeout := time.Second * 3\n+\tconn, err := net.DialTimeout(\"tcp\", fmt.Sprintf(\"%s:%d\", ipOrDomain, port), timeout)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\tdefer conn.Close()\n+\n+\t// Send an SSH version identification string to the server to check if it's SSH\n+\t_, err = conn.Write([]byte(\"SSH-2.0-Go\\r\\n\"))\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\t// Wait for a response from the server\n+\tbuf := make([]byte, 1024)\n+\t_, err = conn.Read(buf)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\t// Check if the response starts with \"SSH-2.0\"\n+\treturn string(buf[:7]) == \"SSH-2.0\"\n+}\n+\n+//Check if the port is used by other process or application\n+func isPortInUse(port int) bool {\n+\taddress := fmt.Sprintf(\":%d\", port)\n+\tlistener, err := net.Listen(\"tcp\", address)\n+\tif err != nil {\n+\t\treturn true\n+\t}\n+\tlistener.Close()\n+\treturn false\n+}"
            },
            {
                "sha": "d38ea062f0c1705a83db716ee04c5b97620c5997",
                "filename": "src/mod/statistic/analytic/analytic.go",
                "status": "added",
                "additions": 128,
                "deletions": 0,
                "changes": 128,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fanalytic%2Fanalytic.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fanalytic%2Fanalytic.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fstatistic%2Fanalytic%2Fanalytic.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,128 @@\n+package analytic\n+\n+import (\n+\t\"encoding/json\"\n+\t\"net/http\"\n+\t\"strings\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/database\"\n+\t\"imuslab.com/zoraxy/mod/statistic\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+type DataLoader struct {\n+\tDatabase           *database.Database\n+\tStatisticCollector *statistic.Collector\n+}\n+\n+// Create a new data loader for loading statistic from database\n+func NewDataLoader(db *database.Database, sc *statistic.Collector) *DataLoader {\n+\treturn &DataLoader{\n+\t\tDatabase:           db,\n+\t\tStatisticCollector: sc,\n+\t}\n+}\n+\n+func (d *DataLoader) HandleSummaryList(w http.ResponseWriter, r *http.Request) {\n+\tentries, err := d.Database.ListTable(\"stats\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"unable to load data from database\")\n+\t\treturn\n+\t}\n+\n+\tentryDates := []string{}\n+\tfor _, keypairs := range entries {\n+\t\tentryDates = append(entryDates, string(keypairs[0]))\n+\t}\n+\n+\tjs, _ := json.MarshalIndent(entryDates, \"\", \" \")\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func (d *DataLoader) HandleLoadTargetDaySummary(w http.ResponseWriter, r *http.Request) {\n+\tday, err := utils.GetPara(r, \"id\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"id cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\tif strings.Contains(day, \"-\") {\n+\t\t//Must be underscore\n+\t\tday = strings.ReplaceAll(day, \"-\", \"_\")\n+\t}\n+\n+\tif !statistic.IsBeforeToday(day) {\n+\t\tutils.SendErrorResponse(w, \"given date is in the future\")\n+\t\treturn\n+\t}\n+\n+\tvar targetDailySummary statistic.DailySummaryExport\n+\n+\tif day == time.Now().Format(\"2006_01_02\") {\n+\t\ttargetDailySummary = *d.StatisticCollector.GetExportSummary()\n+\t} else {\n+\t\t//Not today data\n+\t\terr = d.Database.Read(\"stats\", day, &targetDailySummary)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"target day data not found\")\n+\t\t\treturn\n+\t\t}\n+\t}\n+\n+\tjs, _ := json.Marshal(targetDailySummary)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func (d *DataLoader) HandleLoadTargetRangeSummary(w http.ResponseWriter, r *http.Request) {\n+\t//Get the start date from POST para\n+\tstart, err := utils.GetPara(r, \"start\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"start date cannot be empty\")\n+\t\treturn\n+\t}\n+\tif strings.Contains(start, \"-\") {\n+\t\t//Must be underscore\n+\t\tstart = strings.ReplaceAll(start, \"-\", \"_\")\n+\t}\n+\t//Get end date from POST para\n+\tend, err := utils.GetPara(r, \"end\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"emd date cannot be empty\")\n+\t\treturn\n+\t}\n+\tif strings.Contains(end, \"-\") {\n+\t\t//Must be underscore\n+\t\tend = strings.ReplaceAll(end, \"-\", \"_\")\n+\t}\n+\n+\t//Generate all the dates in between the range\n+\tkeys, err := generateDateRange(start, end)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\t//Load all the data from database\n+\tdailySummaries := []*statistic.DailySummaryExport{}\n+\tfor _, key := range keys {\n+\t\tthisStat := statistic.DailySummaryExport{}\n+\t\terr = d.Database.Read(\"stats\", key, &thisStat)\n+\t\tif err == nil {\n+\t\t\tdailySummaries = append(dailySummaries, &thisStat)\n+\t\t}\n+\t}\n+\n+\t//Merge the summaries into one\n+\tmergedSummary := mergeDailySummaryExports(dailySummaries)\n+\n+\tjs, _ := json.Marshal(struct {\n+\t\tSummary *statistic.DailySummaryExport\n+\t\tRecords []*statistic.DailySummaryExport\n+\t}{\n+\t\tSummary: mergedSummary,\n+\t\tRecords: dailySummaries,\n+\t})\n+\n+\tutils.SendJSONResponse(w, string(js))\n+}"
            },
            {
                "sha": "239ab82c021d2e7b6ff4f46191b9574f6233d703",
                "filename": "src/mod/statistic/analytic/utils.go",
                "status": "added",
                "additions": 72,
                "deletions": 0,
                "changes": 72,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fanalytic%2Futils.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fanalytic%2Futils.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fstatistic%2Fanalytic%2Futils.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,72 @@\n+package analytic\n+\n+import (\n+\t\"fmt\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/statistic\"\n+)\n+\n+// Generate all the record keys from a given start and end dates\n+func generateDateRange(startDate, endDate string) ([]string, error) {\n+\tlayout := \"2006_01_02\"\n+\tstart, err := time.Parse(layout, startDate)\n+\tif err != nil {\n+\t\treturn nil, fmt.Errorf(\"error parsing start date: %v\", err)\n+\t}\n+\n+\tend, err := time.Parse(layout, endDate)\n+\tif err != nil {\n+\t\treturn nil, fmt.Errorf(\"error parsing end date: %v\", err)\n+\t}\n+\n+\tvar dateRange []string\n+\tfor d := start; !d.After(end); d = d.AddDate(0, 0, 1) {\n+\t\tdateRange = append(dateRange, d.Format(layout))\n+\t}\n+\n+\treturn dateRange, nil\n+}\n+\n+func mergeDailySummaryExports(exports []*statistic.DailySummaryExport) *statistic.DailySummaryExport {\n+\tmergedExport := &statistic.DailySummaryExport{\n+\t\tForwardTypes:    make(map[string]int),\n+\t\tRequestOrigin:   make(map[string]int),\n+\t\tRequestClientIp: make(map[string]int),\n+\t\tReferer:         make(map[string]int),\n+\t\tUserAgent:       make(map[string]int),\n+\t\tRequestURL:      make(map[string]int),\n+\t}\n+\n+\tfor _, export := range exports {\n+\t\tmergedExport.TotalRequest += export.TotalRequest\n+\t\tmergedExport.ErrorRequest += export.ErrorRequest\n+\t\tmergedExport.ValidRequest += export.ValidRequest\n+\n+\t\tfor key, value := range export.ForwardTypes {\n+\t\t\tmergedExport.ForwardTypes[key] += value\n+\t\t}\n+\n+\t\tfor key, value := range export.RequestOrigin {\n+\t\t\tmergedExport.RequestOrigin[key] += value\n+\t\t}\n+\n+\t\tfor key, value := range export.RequestClientIp {\n+\t\t\tmergedExport.RequestClientIp[key] += value\n+\t\t}\n+\n+\t\tfor key, value := range export.Referer {\n+\t\t\tmergedExport.Referer[key] += value\n+\t\t}\n+\n+\t\tfor key, value := range export.UserAgent {\n+\t\t\tmergedExport.UserAgent[key] += value\n+\t\t}\n+\n+\t\tfor key, value := range export.RequestURL {\n+\t\t\tmergedExport.RequestURL[key] += value\n+\t\t}\n+\t}\n+\n+\treturn mergedExport\n+}"
            },
            {
                "sha": "6069f2af3d34365ceedd5b3ae000f8041eb68f72",
                "filename": "src/mod/statistic/handler.go",
                "status": "added",
                "additions": 40,
                "deletions": 0,
                "changes": 40,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fhandler.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fhandler.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fstatistic%2Fhandler.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,40 @@\n+package statistic\n+\n+import (\n+\t\"encoding/json\"\n+\t\"net/http\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+/*\n+\tHandler.go\n+\n+\tThis script handles incoming request for loading the statistic of the day\n+\n+*/\n+\n+func (c *Collector) HandleTodayStatLoad(w http.ResponseWriter, r *http.Request) {\n+\n+\tfast, err := utils.GetPara(r, \"fast\")\n+\tif err != nil {\n+\t\tfast = \"false\"\n+\t}\n+\td := c.DailySummary\n+\tif fast == \"true\" {\n+\t\t//Only return the counter\n+\t\texported := DailySummaryExport{\n+\t\t\tTotalRequest: d.TotalRequest,\n+\t\t\tErrorRequest: d.ErrorRequest,\n+\t\t\tValidRequest: d.ValidRequest,\n+\t\t}\n+\t\tjs, _ := json.Marshal(exported)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\t//Return everything\n+\t\texported := c.GetExportSummary()\n+\t\tjs, _ := json.Marshal(exported)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t}\n+\n+}"
            },
            {
                "sha": "c65c07e2f2c040210bdf9c5b62b584f5e4d44d1e",
                "filename": "src/mod/statistic/statistic.go",
                "status": "added",
                "additions": 237,
                "deletions": 0,
                "changes": 237,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fstatistic.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fstatistic.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fstatistic%2Fstatistic.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,237 @@\n+package statistic\n+\n+import (\n+\t\"path/filepath\"\n+\t\"strings\"\n+\t\"sync\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/database\"\n+)\n+\n+/*\n+\tStatistic Package\n+\n+\tThis packet is designed to collection information\n+\tand store them for future analysis\n+*/\n+\n+// Faststat, a interval summary for all collected data and avoid\n+// looping through every data everytime a overview is needed\n+type DailySummary struct {\n+\tTotalRequest int64 //Total request of the day\n+\tErrorRequest int64 //Invalid request of the day, including error or not found\n+\tValidRequest int64 //Valid request of the day\n+\t//Type counters\n+\tForwardTypes    *sync.Map //Map that hold the forward types\n+\tRequestOrigin   *sync.Map //Map that hold [country ISO code]: visitor counter\n+\tRequestClientIp *sync.Map //Map that hold all unique request IPs\n+\tReferer         *sync.Map //Map that store where the user was refered from\n+\tUserAgent       *sync.Map //Map that store the useragent of the request\n+\tRequestURL      *sync.Map //Request URL of the request object\n+}\n+\n+type RequestInfo struct {\n+\tIpAddr                        string\n+\tRequestOriginalCountryISOCode string\n+\tSucc                          bool\n+\tStatusCode                    int\n+\tForwardType                   string\n+\tReferer                       string\n+\tUserAgent                     string\n+\tRequestURL                    string\n+\tTarget                        string\n+}\n+\n+type CollectorOption struct {\n+\tDatabase *database.Database\n+}\n+\n+type Collector struct {\n+\trtdataStopChan chan bool\n+\tDailySummary   *DailySummary\n+\tOption         *CollectorOption\n+}\n+\n+func NewStatisticCollector(option CollectorOption) (*Collector, error) {\n+\toption.Database.NewTable(\"stats\")\n+\n+\t//Create the collector object\n+\tthisCollector := Collector{\n+\t\tDailySummary: newDailySummary(),\n+\t\tOption:       &option,\n+\t}\n+\n+\t//Load the stat if exists for today\n+\t//This will exists if the program was forcefully restarted\n+\tyear, month, day := time.Now().Date()\n+\tsummary := thisCollector.LoadSummaryOfDay(year, month, day)\n+\tif summary != nil {\n+\t\tthisCollector.DailySummary = summary\n+\t}\n+\n+\t//Schedule the realtime statistic clearing at midnight everyday\n+\trtstatStopChan := thisCollector.ScheduleResetRealtimeStats()\n+\tthisCollector.rtdataStopChan = rtstatStopChan\n+\n+\treturn &thisCollector, nil\n+}\n+\n+// Write the current in-memory summary to database file\n+func (c *Collector) SaveSummaryOfDay() {\n+\t//When it is called in 0:00am, make sure it is stored as yesterday key\n+\tt := time.Now().Add(-30 * time.Second)\n+\tsummaryKey := t.Format(\"2006_01_02\")\n+\tsaveData := DailySummaryToExport(*c.DailySummary)\n+\tc.Option.Database.Write(\"stats\", summaryKey, saveData)\n+}\n+\n+// Load the summary of a day given\n+func (c *Collector) LoadSummaryOfDay(year int, month time.Month, day int) *DailySummary {\n+\tdate := time.Date(year, time.Month(month), day, 0, 0, 0, 0, time.Local)\n+\tsummaryKey := date.Format(\"2006_01_02\")\n+\ttargetSummaryExport := DailySummaryExport{}\n+\tc.Option.Database.Read(\"stats\", summaryKey, &targetSummaryExport)\n+\ttargetSummary := DailySummaryExportToSummary(targetSummaryExport)\n+\treturn &targetSummary\n+}\n+\n+// This function gives the current slot in the 288- 5 minutes interval of the day\n+func (c *Collector) GetCurrentRealtimeStatIntervalId() int {\n+\tnow := time.Now()\n+\tstartOfDay := time.Date(now.Year(), now.Month(), now.Day(), 0, 0, 0, 0, time.Local).Unix()\n+\tsecondsSinceStartOfDay := now.Unix() - startOfDay\n+\tinterval := secondsSinceStartOfDay / (5 * 60)\n+\treturn int(interval)\n+}\n+\n+func (c *Collector) Close() {\n+\t//Stop the ticker\n+\tc.rtdataStopChan <- true\n+\n+\t//Write the buffered data into database\n+\tc.SaveSummaryOfDay()\n+\n+}\n+\n+// Main function to record all the inbound traffics\n+// Note that this function run in go routine and might have concurrent R/W issue\n+// Please make sure there is no racing paramters in this function\n+func (c *Collector) RecordRequest(ri RequestInfo) {\n+\tgo func() {\n+\t\tc.DailySummary.TotalRequest++\n+\t\tif ri.Succ {\n+\t\t\tc.DailySummary.ValidRequest++\n+\t\t} else {\n+\t\t\tc.DailySummary.ErrorRequest++\n+\t\t}\n+\n+\t\t//Store the request info into correct types of maps\n+\t\tft, ok := c.DailySummary.ForwardTypes.Load(ri.ForwardType)\n+\t\tif !ok {\n+\t\t\tc.DailySummary.ForwardTypes.Store(ri.ForwardType, 1)\n+\t\t} else {\n+\t\t\tc.DailySummary.ForwardTypes.Store(ri.ForwardType, ft.(int)+1)\n+\t\t}\n+\n+\t\toriginISO := strings.ToLower(ri.RequestOriginalCountryISOCode)\n+\t\tfo, ok := c.DailySummary.RequestOrigin.Load(originISO)\n+\t\tif !ok {\n+\t\t\tc.DailySummary.RequestOrigin.Store(originISO, 1)\n+\t\t} else {\n+\t\t\tc.DailySummary.RequestOrigin.Store(originISO, fo.(int)+1)\n+\t\t}\n+\n+\t\t//Filter out CF forwarded requests\n+\t\tif strings.Contains(ri.IpAddr, \",\") {\n+\t\t\tips := strings.Split(strings.TrimSpace(ri.IpAddr), \",\")\n+\t\t\tif len(ips) >= 1 {\n+\t\t\t\tri.IpAddr = ips[0]\n+\t\t\t}\n+\t\t}\n+\n+\t\tfi, ok := c.DailySummary.RequestClientIp.Load(ri.IpAddr)\n+\t\tif !ok {\n+\t\t\tc.DailySummary.RequestClientIp.Store(ri.IpAddr, 1)\n+\t\t} else {\n+\t\t\tc.DailySummary.RequestClientIp.Store(ri.IpAddr, fi.(int)+1)\n+\t\t}\n+\n+\t\t//Record the referer\n+\t\trf, ok := c.DailySummary.Referer.Load(ri.Referer)\n+\t\tif !ok {\n+\t\t\tc.DailySummary.Referer.Store(ri.Referer, 1)\n+\t\t} else {\n+\t\t\tc.DailySummary.Referer.Store(ri.Referer, rf.(int)+1)\n+\t\t}\n+\n+\t\t//Record the UserAgent\n+\t\tua, ok := c.DailySummary.UserAgent.Load(ri.UserAgent)\n+\t\tif !ok {\n+\t\t\tc.DailySummary.UserAgent.Store(ri.UserAgent, 1)\n+\t\t} else {\n+\t\t\tc.DailySummary.UserAgent.Store(ri.UserAgent, ua.(int)+1)\n+\t\t}\n+\n+\t\t//ADD MORE HERE IF NEEDED\n+\n+\t\t//Record request URL, if it is a page\n+\t\text := filepath.Ext(ri.RequestURL)\n+\n+\t\tif ext != \"\" && !isWebPageExtension(ext) {\n+\t\t\treturn\n+\t\t}\n+\n+\t\tru, ok := c.DailySummary.RequestURL.Load(ri.RequestURL)\n+\t\tif !ok {\n+\t\t\tc.DailySummary.RequestURL.Store(ri.RequestURL, 1)\n+\t\t} else {\n+\t\t\tc.DailySummary.RequestURL.Store(ri.RequestURL, ru.(int)+1)\n+\t\t}\n+\t}()\n+}\n+\n+// nightly task\n+func (c *Collector) ScheduleResetRealtimeStats() chan bool {\n+\tdoneCh := make(chan bool)\n+\n+\tgo func() {\n+\t\tdefer close(doneCh)\n+\n+\t\tfor {\n+\t\t\t// calculate duration until next midnight\n+\t\t\tnow := time.Now()\n+\n+\t\t\t// Get midnight of the next day in the local time zone\n+\t\t\tmidnight := time.Date(now.Year(), now.Month(), now.Day()+1, 0, 0, 0, 0, now.Location())\n+\n+\t\t\t// Calculate the duration until midnight\n+\t\t\tduration := midnight.Sub(now)\n+\t\t\tselect {\n+\t\t\tcase <-time.After(duration):\n+\t\t\t\t// store daily summary to database and reset summary\n+\t\t\t\tc.SaveSummaryOfDay()\n+\t\t\t\tc.DailySummary = newDailySummary()\n+\t\t\tcase <-doneCh:\n+\t\t\t\t// stop the routine\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t}\n+\t}()\n+\n+\treturn doneCh\n+}\n+\n+func newDailySummary() *DailySummary {\n+\treturn &DailySummary{\n+\t\tTotalRequest:    0,\n+\t\tErrorRequest:    0,\n+\t\tValidRequest:    0,\n+\t\tForwardTypes:    &sync.Map{},\n+\t\tRequestOrigin:   &sync.Map{},\n+\t\tRequestClientIp: &sync.Map{},\n+\t\tReferer:         &sync.Map{},\n+\t\tUserAgent:       &sync.Map{},\n+\t\tRequestURL:      &sync.Map{},\n+\t}\n+}"
            },
            {
                "sha": "7de5c98aea2209150aaaaf58f64d84201e7a082b",
                "filename": "src/mod/statistic/structconv.go",
                "status": "added",
                "additions": 108,
                "deletions": 0,
                "changes": 108,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fstructconv.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Fstructconv.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fstatistic%2Fstructconv.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,108 @@\n+package statistic\n+\n+import \"sync\"\n+\n+type DailySummaryExport struct {\n+\tTotalRequest int64 //Total request of the day\n+\tErrorRequest int64 //Invalid request of the day, including error or not found\n+\tValidRequest int64 //Valid request of the day\n+\n+\tForwardTypes    map[string]int\n+\tRequestOrigin   map[string]int\n+\tRequestClientIp map[string]int\n+\tReferer         map[string]int\n+\tUserAgent       map[string]int\n+\tRequestURL      map[string]int\n+}\n+\n+func DailySummaryToExport(summary DailySummary) DailySummaryExport {\n+\texport := DailySummaryExport{\n+\t\tTotalRequest:    summary.TotalRequest,\n+\t\tErrorRequest:    summary.ErrorRequest,\n+\t\tValidRequest:    summary.ValidRequest,\n+\t\tForwardTypes:    make(map[string]int),\n+\t\tRequestOrigin:   make(map[string]int),\n+\t\tRequestClientIp: make(map[string]int),\n+\t\tReferer:         make(map[string]int),\n+\t\tUserAgent:       make(map[string]int),\n+\t\tRequestURL:      make(map[string]int),\n+\t}\n+\n+\tsummary.ForwardTypes.Range(func(key, value interface{}) bool {\n+\t\texport.ForwardTypes[key.(string)] = value.(int)\n+\t\treturn true\n+\t})\n+\n+\tsummary.RequestOrigin.Range(func(key, value interface{}) bool {\n+\t\texport.RequestOrigin[key.(string)] = value.(int)\n+\t\treturn true\n+\t})\n+\n+\tsummary.RequestClientIp.Range(func(key, value interface{}) bool {\n+\t\texport.RequestClientIp[key.(string)] = value.(int)\n+\t\treturn true\n+\t})\n+\n+\tsummary.Referer.Range(func(key, value interface{}) bool {\n+\t\texport.Referer[key.(string)] = value.(int)\n+\t\treturn true\n+\t})\n+\n+\tsummary.UserAgent.Range(func(key, value interface{}) bool {\n+\t\texport.UserAgent[key.(string)] = value.(int)\n+\t\treturn true\n+\t})\n+\n+\tsummary.RequestURL.Range(func(key, value interface{}) bool {\n+\t\texport.RequestURL[key.(string)] = value.(int)\n+\t\treturn true\n+\t})\n+\n+\treturn export\n+}\n+\n+func DailySummaryExportToSummary(export DailySummaryExport) DailySummary {\n+\tsummary := DailySummary{\n+\t\tTotalRequest:    export.TotalRequest,\n+\t\tErrorRequest:    export.ErrorRequest,\n+\t\tValidRequest:    export.ValidRequest,\n+\t\tForwardTypes:    &sync.Map{},\n+\t\tRequestOrigin:   &sync.Map{},\n+\t\tRequestClientIp: &sync.Map{},\n+\t\tReferer:         &sync.Map{},\n+\t\tUserAgent:       &sync.Map{},\n+\t\tRequestURL:      &sync.Map{},\n+\t}\n+\n+\tfor k, v := range export.ForwardTypes {\n+\t\tsummary.ForwardTypes.Store(k, v)\n+\t}\n+\n+\tfor k, v := range export.RequestOrigin {\n+\t\tsummary.RequestOrigin.Store(k, v)\n+\t}\n+\n+\tfor k, v := range export.RequestClientIp {\n+\t\tsummary.RequestClientIp.Store(k, v)\n+\t}\n+\n+\tfor k, v := range export.Referer {\n+\t\tsummary.Referer.Store(k, v)\n+\t}\n+\n+\tfor k, v := range export.UserAgent {\n+\t\tsummary.UserAgent.Store(k, v)\n+\t}\n+\n+\tfor k, v := range export.RequestURL {\n+\t\tsummary.RequestURL.Store(k, v)\n+\t}\n+\n+\treturn summary\n+}\n+\n+// External object function call\n+func (c *Collector) GetExportSummary() *DailySummaryExport {\n+\texportFormatDailySummary := DailySummaryToExport(*c.DailySummary)\n+\treturn &exportFormatDailySummary\n+}"
            },
            {
                "sha": "7f6c6d0e158258d17b49085cf06eb9e847b4050c",
                "filename": "src/mod/statistic/utils.go",
                "status": "added",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Futils.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fstatistic%2Futils.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fstatistic%2Futils.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,28 @@\n+package statistic\n+\n+import (\n+\t\"fmt\"\n+\t\"time\"\n+)\n+\n+func isWebPageExtension(ext string) bool {\n+\twebPageExts := []string{\".html\", \".htm\", \".php\", \".jsp\", \".aspx\", \".js\", \".jsx\"}\n+\tfor _, e := range webPageExts {\n+\t\tif e == ext {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\treturn false\n+}\n+\n+func IsBeforeToday(dateString string) bool {\n+\tlayout := \"2006_01_02\"\n+\tdate, err := time.Parse(layout, dateString)\n+\tif err != nil {\n+\t\tfmt.Println(\"Error parsing date:\", err)\n+\t\treturn false\n+\t}\n+\n+\ttoday := time.Now().UTC().Truncate(24 * time.Hour)\n+\treturn date.Before(today) || dateString == time.Now().Format(layout)\n+}"
            },
            {
                "sha": "99c086dc9dcd303f976a606db40f88d6b00f5cd1",
                "filename": "src/mod/tcpprox/conn.go",
                "status": "added",
                "additions": 324,
                "deletions": 0,
                "changes": 324,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Fconn.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Fconn.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Ftcpprox%2Fconn.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,324 @@\n+package tcpprox\n+\n+import (\n+\t\"errors\"\n+\t\"io\"\n+\t\"log\"\n+\t\"net\"\n+\t\"strconv\"\n+\t\"sync\"\n+\t\"time\"\n+)\n+\n+func isValidIP(ip string) bool {\n+\tparsedIP := net.ParseIP(ip)\n+\treturn parsedIP != nil\n+}\n+\n+func isValidPort(port string) bool {\n+\tportInt, err := strconv.Atoi(port)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\n+\tif portInt < 1 || portInt > 65535 {\n+\t\treturn false\n+\t}\n+\n+\treturn true\n+}\n+\n+func isReachable(target string) bool {\n+\ttimeout := time.Duration(2 * time.Second) // Set the timeout value as per your requirement\n+\tconn, err := net.DialTimeout(\"tcp\", target, timeout)\n+\tif err != nil {\n+\t\treturn false\n+\t}\n+\tdefer conn.Close()\n+\treturn true\n+}\n+\n+func connCopy(conn1 net.Conn, conn2 net.Conn, wg *sync.WaitGroup, accumulator *int64) {\n+\tio.Copy(conn1, conn2)\n+\tconn1.Close()\n+\tlog.Println(\"[\u2190]\", \"close the connect at local:[\"+conn1.LocalAddr().String()+\"] and remote:[\"+conn1.RemoteAddr().String()+\"]\")\n+\t//conn2.Close()\n+\t//log.Println(\"[\u2190]\", \"close the connect at local:[\"+conn2.LocalAddr().String()+\"] and remote:[\"+conn2.RemoteAddr().String()+\"]\")\n+\twg.Done()\n+}\n+\n+func forward(conn1 net.Conn, conn2 net.Conn, aTob *int64, bToa *int64) {\n+\tlog.Printf(\"[+] start transmit. [%s],[%s] <-> [%s],[%s] \\n\", conn1.LocalAddr().String(), conn1.RemoteAddr().String(), conn2.LocalAddr().String(), conn2.RemoteAddr().String())\n+\tvar wg sync.WaitGroup\n+\t// wait tow goroutines\n+\twg.Add(2)\n+\tgo connCopy(conn1, conn2, &wg, aTob)\n+\tgo connCopy(conn2, conn1, &wg, bToa)\n+\t//blocking when the wg is locked\n+\twg.Wait()\n+}\n+\n+func accept(listener net.Listener) (net.Conn, error) {\n+\tconn, err := listener.Accept()\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tlog.Println(\"[\u221a]\", \"accept a new client. remote address:[\"+conn.RemoteAddr().String()+\"], local address:[\"+conn.LocalAddr().String()+\"]\")\n+\treturn conn, err\n+}\n+\n+func startListener(address string) (net.Listener, error) {\n+\tlog.Println(\"[+]\", \"try to start server on:[\"+address+\"]\")\n+\tserver, err := net.Listen(\"tcp\", address)\n+\tif err != nil {\n+\t\treturn nil, errors.New(\"listen address [\" + address + \"] faild\")\n+\t}\n+\tlog.Println(\"[\u221a]\", \"start listen at address:[\"+address+\"]\")\n+\treturn server, nil\n+}\n+\n+/*\n+\tConfig Functions\n+*/\n+\n+// Config validator\n+func (c *ProxyRelayConfig) ValidateConfigs() error {\n+\tif c.Mode == ProxyMode_Transport {\n+\t\t//Port2Host: PortA int, PortB string\n+\t\tif !isValidPort(c.PortA) {\n+\t\t\treturn errors.New(\"first address must be a valid port number\")\n+\t\t}\n+\n+\t\tif !isReachable(c.PortB) {\n+\t\t\treturn errors.New(\"second address is unreachable\")\n+\t\t}\n+\t\treturn nil\n+\n+\t} else if c.Mode == ProxyMode_Listen {\n+\t\t//Port2Port: Both port are port number\n+\t\tif !isValidPort(c.PortA) {\n+\t\t\treturn errors.New(\"first address is not a valid port number\")\n+\t\t}\n+\n+\t\tif !isValidPort(c.PortB) {\n+\t\t\treturn errors.New(\"second address is not a valid port number\")\n+\t\t}\n+\n+\t\treturn nil\n+\t} else if c.Mode == ProxyMode_Starter {\n+\t\t//Host2Host: Both have to be hosts\n+\t\tif !isReachable(c.PortA) {\n+\t\t\treturn errors.New(\"first address is unreachable\")\n+\t\t}\n+\n+\t\tif !isReachable(c.PortB) {\n+\t\t\treturn errors.New(\"second address is unreachable\")\n+\t\t}\n+\n+\t\treturn nil\n+\t} else {\n+\t\treturn errors.New(\"invalid mode given\")\n+\t}\n+}\n+\n+// Start a proxy if stopped\n+func (c *ProxyRelayConfig) Start() error {\n+\tif c.Running {\n+\t\treturn errors.New(\"proxy already running\")\n+\t}\n+\n+\t// Create a stopChan to control the loop\n+\tstopChan := make(chan bool)\n+\tc.stopChan = stopChan\n+\n+\t//Validate configs\n+\terr := c.ValidateConfigs()\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\t//Start the proxy service\n+\tgo func() {\n+\t\tc.Running = true\n+\t\tif c.Mode == ProxyMode_Transport {\n+\t\t\terr = c.Port2host(c.PortA, c.PortB, stopChan)\n+\t\t} else if c.Mode == ProxyMode_Listen {\n+\t\t\terr = c.Port2port(c.PortA, c.PortB, stopChan)\n+\t\t} else if c.Mode == ProxyMode_Starter {\n+\t\t\terr = c.Host2host(c.PortA, c.PortB, stopChan)\n+\t\t}\n+\t\tif err != nil {\n+\t\t\tc.Running = false\n+\t\t\tlog.Println(\"Error starting proxy service \" + c.Name + \"(\" + c.UUID + \"): \" + err.Error())\n+\t\t}\n+\t}()\n+\n+\t//Successfully spawned off the proxy routine\n+\treturn nil\n+}\n+\n+// Stop a running proxy if running\n+func (c *ProxyRelayConfig) Stop() {\n+\tif c.Running || c.stopChan != nil {\n+\t\tc.stopChan <- true\n+\t\ttime.Sleep(300 * time.Millisecond)\n+\t\tc.stopChan = nil\n+\t\tc.Running = false\n+\t}\n+}\n+\n+/*\n+\tForwarder Functions\n+*/\n+\n+/*\n+portA -> server\n+portB -> server\n+*/\n+func (c *ProxyRelayConfig) Port2port(port1 string, port2 string, stopChan chan bool) error {\n+\t//Trim the Prefix of : if exists\n+\tlisten1, err := startListener(\"0.0.0.0:\" + port1)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tlisten2, err := startListener(\"0.0.0.0:\" + port2)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tlog.Println(\"[\u221a]\", \"listen port:\", port1, \"and\", port2, \"success. waiting for client...\")\n+\tc.Running = true\n+\n+\tgo func() {\n+\t\t<-stopChan\n+\t\tlog.Println(\"[x]\", \"Received stop signal. Exiting Port to Port forwarder\")\n+\t\tc.Running = false\n+\t\tlisten1.Close()\n+\t\tlisten2.Close()\n+\t}()\n+\n+\tfor {\n+\t\tconn1, err := accept(listen1)\n+\t\tif err != nil {\n+\t\t\tif !c.Running {\n+\t\t\t\treturn nil\n+\t\t\t}\n+\t\t\tcontinue\n+\t\t}\n+\n+\t\tconn2, err := accept(listen2)\n+\t\tif err != nil {\n+\t\t\tif !c.Running {\n+\t\t\t\treturn nil\n+\t\t\t}\n+\t\t\tcontinue\n+\t\t}\n+\n+\t\tif conn1 == nil || conn2 == nil {\n+\t\t\tlog.Println(\"[x]\", \"accept client faild. retry in \", c.Timeout, \" seconds. \")\n+\t\t\ttime.Sleep(time.Duration(c.Timeout) * time.Second)\n+\t\t\tcontinue\n+\t\t}\n+\t\tforward(conn1, conn2, &c.aTobAccumulatedByteTransfer, &c.bToaAccumulatedByteTransfer)\n+\t}\n+}\n+\n+/*\n+portA -> server\n+server -> portB\n+*/\n+func (c *ProxyRelayConfig) Port2host(allowPort string, targetAddress string, stopChan chan bool) error {\n+\tserver, err := startListener(\"0.0.0.0:\" + allowPort)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\t//Start stop handler\n+\tgo func() {\n+\t\t<-stopChan\n+\t\tlog.Println(\"[x]\", \"Received stop signal. Exiting Port to Host forwarder\")\n+\t\tc.Running = false\n+\t\tserver.Close()\n+\t}()\n+\n+\t//Start blocking loop for accepting connections\n+\tfor {\n+\t\tconn, err := accept(server)\n+\t\tif conn == nil || err != nil {\n+\t\t\tif !c.Running {\n+\t\t\t\t//Terminate by stop chan. Exit listener loop\n+\t\t\t\treturn nil\n+\t\t\t}\n+\n+\t\t\t//Connection error. Retry\n+\t\t\tcontinue\n+\t\t}\n+\n+\t\tgo func(targetAddress string) {\n+\t\t\tlog.Println(\"[+]\", \"start connect host:[\"+targetAddress+\"]\")\n+\t\t\ttarget, err := net.Dial(\"tcp\", targetAddress)\n+\t\t\tif err != nil {\n+\t\t\t\t// temporarily unavailable, don't use fatal.\n+\t\t\t\tlog.Println(\"[x]\", \"connect target address [\"+targetAddress+\"] faild. retry in \", c.Timeout, \"seconds. \")\n+\t\t\t\tconn.Close()\n+\t\t\t\tlog.Println(\"[\u2190]\", \"close the connect at local:[\"+conn.LocalAddr().String()+\"] and remote:[\"+conn.RemoteAddr().String()+\"]\")\n+\t\t\t\ttime.Sleep(time.Duration(c.Timeout) * time.Second)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tlog.Println(\"[\u2192]\", \"connect target address [\"+targetAddress+\"] success.\")\n+\t\t\tforward(target, conn, &c.aTobAccumulatedByteTransfer, &c.bToaAccumulatedByteTransfer)\n+\t\t}(targetAddress)\n+\t}\n+}\n+\n+/*\n+server -> portA\n+server -> portB\n+*/\n+func (c *ProxyRelayConfig) Host2host(address1, address2 string, stopChan chan bool) error {\n+\tc.Running = true\n+\tgo func() {\n+\t\t<-stopChan\n+\t\tlog.Println(\"[x]\", \"Received stop signal. Exiting Host to Host forwarder\")\n+\t\tc.Running = false\n+\t}()\n+\n+\tfor c.Running {\n+\t\tlog.Println(\"[+]\", \"try to connect host:[\"+address1+\"] and [\"+address2+\"]\")\n+\t\tvar host1, host2 net.Conn\n+\t\tvar err error\n+\t\tfor {\n+\t\t\td := net.Dialer{Timeout: time.Duration(c.Timeout)}\n+\t\t\thost1, err = d.Dial(\"tcp\", address1)\n+\t\t\tif err == nil {\n+\t\t\t\tlog.Println(\"[\u2192]\", \"connect [\"+address1+\"] success.\")\n+\t\t\t\tbreak\n+\t\t\t} else {\n+\t\t\t\tlog.Println(\"[x]\", \"connect target address [\"+address1+\"] faild. retry in \", c.Timeout, \" seconds. \")\n+\t\t\t\ttime.Sleep(time.Duration(c.Timeout) * time.Second)\n+\t\t\t}\n+\n+\t\t\tif !c.Running {\n+\t\t\t\treturn nil\n+\t\t\t}\n+\t\t}\n+\t\tfor {\n+\t\t\td := net.Dialer{Timeout: time.Duration(c.Timeout)}\n+\t\t\thost2, err = d.Dial(\"tcp\", address2)\n+\t\t\tif err == nil {\n+\t\t\t\tlog.Println(\"[\u2192]\", \"connect [\"+address2+\"] success.\")\n+\t\t\t\tbreak\n+\t\t\t} else {\n+\t\t\t\tlog.Println(\"[x]\", \"connect target address [\"+address2+\"] faild. retry in \", c.Timeout, \" seconds. \")\n+\t\t\t\ttime.Sleep(time.Duration(c.Timeout) * time.Second)\n+\t\t\t}\n+\n+\t\t\tif !c.Running {\n+\t\t\t\treturn nil\n+\t\t\t}\n+\t\t}\n+\t\tforward(host1, host2, &c.aTobAccumulatedByteTransfer, &c.bToaAccumulatedByteTransfer)\n+\t}\n+\n+\treturn nil\n+}"
            },
            {
                "sha": "24bcba55796bd0c155afa413608ccd44a77f065a",
                "filename": "src/mod/tcpprox/handler.go",
                "status": "added",
                "additions": 162,
                "deletions": 0,
                "changes": 162,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Fhandler.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Fhandler.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Ftcpprox%2Fhandler.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,162 @@\n+package tcpprox\n+\n+import (\n+\t\"encoding/json\"\n+\t\"net/http\"\n+\t\"strconv\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+/*\n+\tHandler.go\n+\tHandlers for the tcprox. Remove this file\n+\tif your application do not need any http\n+\thandler.\n+*/\n+\n+func (m *Manager) HandleAddProxyConfig(w http.ResponseWriter, r *http.Request) {\n+\tname, err := utils.PostPara(r, \"name\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"name cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\tportA, err := utils.PostPara(r, \"porta\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"first address cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\tportB, err := utils.PostPara(r, \"portb\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"second address cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\ttimeoutStr, _ := utils.PostPara(r, \"timeout\")\n+\ttimeout := m.Options.DefaultTimeout\n+\tif timeoutStr != \"\" {\n+\t\ttimeout, err = strconv.Atoi(timeoutStr)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"invalid timeout value: \"+timeoutStr)\n+\t\t\treturn\n+\t\t}\n+\t}\n+\n+\tmodeValue := ProxyMode_Transport\n+\tmode, err := utils.PostPara(r, \"mode\")\n+\tif err != nil || mode == \"\" {\n+\t\tutils.SendErrorResponse(w, \"no mode given\")\n+\t} else if mode == \"listen\" {\n+\t\tmodeValue = ProxyMode_Listen\n+\t} else if mode == \"transport\" {\n+\t\tmodeValue = ProxyMode_Transport\n+\t} else if mode == \"starter\" {\n+\t\tmodeValue = ProxyMode_Starter\n+\t} else {\n+\t\tutils.SendErrorResponse(w, \"invalid mode given. Only support listen / transport / starter\")\n+\t}\n+\n+\t//Create the target config\n+\tnewConfigUUID := m.NewConfig(&ProxyRelayOptions{\n+\t\tName:    name,\n+\t\tPortA:   portA,\n+\t\tPortB:   portB,\n+\t\tTimeout: timeout,\n+\t\tMode:    modeValue,\n+\t})\n+\n+\tjs, _ := json.Marshal(newConfigUUID)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func (m *Manager) HandleEditProxyConfigs(w http.ResponseWriter, r *http.Request) {\n+\t// Extract POST parameters using utils.PostPara\n+\tconfigUUID, err := utils.PostPara(r, \"uuid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"config UUID cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\tnewName, _ := utils.PostPara(r, \"name\")\n+\tnewPortA, _ := utils.PostPara(r, \"porta\")\n+\tnewPortB, _ := utils.PostPara(r, \"portb\")\n+\tnewModeStr, _ := utils.PostPara(r, \"mode\")\n+\tnewMode := -1\n+\tif newModeStr != \"\" {\n+\t\tif newModeStr == \"listen\" {\n+\t\t\tnewMode = 0\n+\t\t} else if newModeStr == \"transport\" {\n+\t\t\tnewMode = 1\n+\t\t} else if newModeStr == \"starter\" {\n+\t\t\tnewMode = 2\n+\t\t} else {\n+\t\t\tutils.SendErrorResponse(w, \"invalid new mode value\")\n+\t\t\treturn\n+\t\t}\n+\t}\n+\n+\tnewTimeoutStr, _ := utils.PostPara(r, \"timeout\")\n+\tnewTimeout := -1\n+\tif newTimeoutStr != \"\" {\n+\t\tnewTimeout, err = strconv.Atoi(newTimeoutStr)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"invalid newTimeout value: \"+newTimeoutStr)\n+\t\t\treturn\n+\t\t}\n+\t}\n+\n+\t// Call the EditConfig method to modify the configuration\n+\terr = m.EditConfig(configUUID, newName, newPortA, newPortB, newMode, newTimeout)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tutils.SendOK(w)\n+}\n+\n+func (m *Manager) HandleListConfigs(w http.ResponseWriter, r *http.Request) {\n+\tjs, _ := json.Marshal(m.Configs)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func (m *Manager) HandleGetProxyStatus(w http.ResponseWriter, r *http.Request) {\n+\tuuid, err := utils.GetPara(r, \"uuid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid uuid given\")\n+\t\treturn\n+\t}\n+\n+\ttargetConfig, err := m.GetConfigByUUID(uuid)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tjs, _ := json.Marshal(targetConfig)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func (m *Manager) HandleConfigValidate(w http.ResponseWriter, r *http.Request) {\n+\tuuid, err := utils.GetPara(r, \"uuid\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid uuid given\")\n+\t\treturn\n+\t}\n+\n+\ttargetConfig, err := m.GetConfigByUUID(uuid)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\terr = targetConfig.ValidateConfigs()\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tutils.SendOK(w)\n+}"
            },
            {
                "sha": "6335766db619897a01fa25f9b7bd2ff3ce238039",
                "filename": "src/mod/tcpprox/nb.go.ref",
                "status": "added",
                "additions": 289,
                "deletions": 0,
                "changes": 289,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Fnb.go.ref",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Fnb.go.ref",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Ftcpprox%2Fnb.go.ref?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,289 @@\n+package tcpprox\n+\n+import (\n+\t\"fmt\"\n+\t\"io\"\n+\t\"log\"\n+\t\"net\"\n+\t\"os\"\n+\t\"regexp\"\n+\t\"strconv\"\n+\t\"strings\"\n+\t\"sync\"\n+\t\"time\"\n+)\n+\n+const timeout = 5\n+\n+func main() {\n+\t//log.SetFlags(log.Ldate | log.Lmicroseconds | log.Lshortfile)\n+\tlog.SetFlags(log.Ldate | log.Lmicroseconds)\n+\n+\tprintWelcome()\n+\n+\targs := os.Args\n+\targc := len(os.Args)\n+\tif argc <= 2 {\n+\t\tprintHelp()\n+\t\tos.Exit(0)\n+\t}\n+\n+\t//TODO:support UDP protocol\n+\n+\t/*var logFileError error\n+\tif argc > 5 && args[4] == \"-log\" {\n+\t\tlogPath := args[5] + \"/\" + time.Now().Format(\"2006_01_02_15_04_05\") // \"2006-01-02 15:04:05\"\n+\t\tlogPath += args[1] + \"-\" + strings.Replace(args[2], \":\", \"_\", -1) + \"-\" + args[3] + \".log\"\n+\t\tlogPath = strings.Replace(logPath, `\\`, \"/\", -1)\n+\t\tlogPath = strings.Replace(logPath, \"//\", \"/\", -1)\n+\t\tlogFile, logFileError = os.OpenFile(logPath, os.O_APPEND|os.O_CREATE, 0666)\n+\t\tif logFileError != nil {\n+\t\t\tlog.Fatalln(\"[x]\", \"log file path error.\", logFileError.Error())\n+\t\t}\n+\t\tlog.Println(\"[\u221a]\", \"open test log file success. path:\", logPath)\n+\t}*/\n+\n+\tswitch args[1] {\n+\tcase \"-listen\":\n+\t\tif argc < 3 {\n+\t\t\tlog.Fatalln(`-listen need two arguments, like \"nb -listen 1997 2017\".`)\n+\t\t}\n+\t\tport1 := checkPort(args[2])\n+\t\tport2 := checkPort(args[3])\n+\t\tlog.Println(\"[\u221a]\", \"start to listen port:\", port1, \"and port:\", port2)\n+\t\tport2port(port1, port2)\n+\t\tbreak\n+\tcase \"-tran\":\n+\t\tif argc < 3 {\n+\t\t\tlog.Fatalln(`-tran need two arguments, like \"nb -tran 1997 192.168.1.2:3389\".`)\n+\t\t}\n+\t\tport := checkPort(args[2])\n+\t\tvar remoteAddress string\n+\t\tif checkIp(args[3]) {\n+\t\t\tremoteAddress = args[3]\n+\t\t}\n+\t\tsplit := strings.SplitN(remoteAddress, \":\", 2)\n+\t\tlog.Println(\"[\u221a]\", \"start to transmit address:\", remoteAddress, \"to address:\", split[0]+\":\"+port)\n+\t\tport2host(port, remoteAddress)\n+\t\tbreak\n+\tcase \"-slave\":\n+\t\tif argc < 3 {\n+\t\t\tlog.Fatalln(`-slave need two arguments, like \"nb -slave 127.0.0.1:3389 8.8.8.8:1997\".`)\n+\t\t}\n+\t\tvar address1, address2 string\n+\t\tcheckIp(args[2])\n+\t\tif checkIp(args[2]) {\n+\t\t\taddress1 = args[2]\n+\t\t}\n+\t\tcheckIp(args[3])\n+\t\tif checkIp(args[3]) {\n+\t\t\taddress2 = args[3]\n+\t\t}\n+\t\tlog.Println(\"[\u221a]\", \"start to connect address:\", address1, \"and address:\", address2)\n+\t\thost2host(address1, address2)\n+\t\tbreak\n+\tdefault:\n+\t\tprintHelp()\n+\t}\n+}\n+\n+func printWelcome() {\n+\tfmt.Println(\"+----------------------------------------------------------------+\")\n+\tfmt.Println(\"| Welcome to use NATBypass Ver1.0.0 .                            |\")\n+\tfmt.Println(\"| Code by cw1997 at 2017-10-19 03:59:51                          |\")\n+\tfmt.Println(\"| If you have some problem when you use the tool,                |\")\n+\tfmt.Println(\"| please submit issue at : https://github.com/cw1997/NATBypass . |\")\n+\tfmt.Println(\"+----------------------------------------------------------------+\")\n+\tfmt.Println()\n+\t// sleep one second because the fmt is not thread-safety.\n+\t// if not to do this, fmt.Print will print after the log.Print.\n+\ttime.Sleep(time.Second)\n+}\n+func printHelp() {\n+\tfmt.Println(`usage: \"-listen port1 port2\" example: \"nb -listen 1997 2017\" `)\n+\tfmt.Println(`       \"-tran port1 ip:port2\" example: \"nb -tran 1997 192.168.1.2:3389\" `)\n+\tfmt.Println(`       \"-slave ip1:port1 ip2:port2\" example: \"nb -slave 127.0.0.1:3389 8.8.8.8:1997\" `)\n+\tfmt.Println(`============================================================`)\n+\tfmt.Println(`optional argument: \"-log logpath\" . example: \"nb -listen 1997 2017 -log d:/nb\" `)\n+\tfmt.Println(`log filename format: Y_m_d_H_i_s-agrs1-args2-args3.log`)\n+\tfmt.Println(`============================================================`)\n+\tfmt.Println(`if you want more help, please read \"README.md\". `)\n+}\n+\n+func checkPort(port string) string {\n+\tPortNum, err := strconv.Atoi(port)\n+\tif err != nil {\n+\t\tlog.Fatalln(\"[x]\", \"port should be a number\")\n+\t}\n+\tif PortNum < 1 || PortNum > 65535 {\n+\t\tlog.Fatalln(\"[x]\", \"port should be a number and the range is [1,65536)\")\n+\t}\n+\treturn port\n+}\n+\n+func checkIp(address string) bool {\n+\tipAndPort := strings.Split(address, \":\")\n+\tif len(ipAndPort) != 2 {\n+\t\tlog.Fatalln(\"[x]\", \"address error. should be a string like [ip:port]. \")\n+\t}\n+\tip := ipAndPort[0]\n+\tport := ipAndPort[1]\n+\tcheckPort(port)\n+\tpattern := `^(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])$`\n+\tok, err := regexp.MatchString(pattern, ip)\n+\tif err != nil || !ok {\n+\t\tlog.Fatalln(\"[x]\", \"ip error. \")\n+\t}\n+\treturn ok\n+}\n+\n+func port2port(port1 string, port2 string) {\n+\tlisten1 := start_server(\"0.0.0.0:\" + port1)\n+\tlisten2 := start_server(\"0.0.0.0:\" + port2)\n+\tlog.Println(\"[\u221a]\", \"listen port:\", port1, \"and\", port2, \"success. waiting for client...\")\n+\tfor {\n+\t\tconn1 := accept(listen1)\n+\t\tconn2 := accept(listen2)\n+\t\tif conn1 == nil || conn2 == nil {\n+\t\t\tlog.Println(\"[x]\", \"accept client faild. retry in \", timeout, \" seconds. \")\n+\t\t\ttime.Sleep(timeout * time.Second)\n+\t\t\tcontinue\n+\t\t}\n+\t\tforward(conn1, conn2)\n+\t}\n+}\n+\n+func port2host(allowPort string, targetAddress string) {\n+\tserver := start_server(\"0.0.0.0:\" + allowPort)\n+\tfor {\n+\t\tconn := accept(server)\n+\t\tif conn == nil {\n+\t\t\tcontinue\n+\t\t}\n+\t\t//println(targetAddress)\n+\t\tgo func(targetAddress string) {\n+\t\t\tlog.Println(\"[+]\", \"start connect host:[\"+targetAddress+\"]\")\n+\t\t\ttarget, err := net.Dial(\"tcp\", targetAddress)\n+\t\t\tif err != nil {\n+\t\t\t\t// temporarily unavailable, don't use fatal.\n+\t\t\t\tlog.Println(\"[x]\", \"connect target address [\"+targetAddress+\"] faild. retry in \", timeout, \"seconds. \")\n+\t\t\t\tconn.Close()\n+\t\t\t\tlog.Println(\"[\u2190]\", \"close the connect at local:[\"+conn.LocalAddr().String()+\"] and remote:[\"+conn.RemoteAddr().String()+\"]\")\n+\t\t\t\ttime.Sleep(timeout * time.Second)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tlog.Println(\"[\u2192]\", \"connect target address [\"+targetAddress+\"] success.\")\n+\t\t\tforward(target, conn)\n+\t\t}(targetAddress)\n+\t}\n+}\n+\n+func host2host(address1, address2 string) {\n+\tfor {\n+\t\tlog.Println(\"[+]\", \"try to connect host:[\"+address1+\"] and [\"+address2+\"]\")\n+\t\tvar host1, host2 net.Conn\n+\t\tvar err error\n+\t\tfor {\n+\t\t\thost1, err = net.Dial(\"tcp\", address1)\n+\t\t\tif err == nil {\n+\t\t\t\tlog.Println(\"[\u2192]\", \"connect [\"+address1+\"] success.\")\n+\t\t\t\tbreak\n+\t\t\t} else {\n+\t\t\t\tlog.Println(\"[x]\", \"connect target address [\"+address1+\"] faild. retry in \", timeout, \" seconds. \")\n+\t\t\t\ttime.Sleep(timeout * time.Second)\n+\t\t\t}\n+\t\t}\n+\t\tfor {\n+\t\t\thost2, err = net.Dial(\"tcp\", address2)\n+\t\t\tif err == nil {\n+\t\t\t\tlog.Println(\"[\u2192]\", \"connect [\"+address2+\"] success.\")\n+\t\t\t\tbreak\n+\t\t\t} else {\n+\t\t\t\tlog.Println(\"[x]\", \"connect target address [\"+address2+\"] faild. retry in \", timeout, \" seconds. \")\n+\t\t\t\ttime.Sleep(timeout * time.Second)\n+\t\t\t}\n+\t\t}\n+\t\tforward(host1, host2)\n+\t}\n+}\n+\n+func start_server(address string) net.Listener {\n+\tlog.Println(\"[+]\", \"try to start server on:[\"+address+\"]\")\n+\tserver, err := net.Listen(\"tcp\", address)\n+\tif err != nil {\n+\t\tlog.Fatalln(\"[x]\", \"listen address [\"+address+\"] faild.\")\n+\t}\n+\tlog.Println(\"[\u221a]\", \"start listen at address:[\"+address+\"]\")\n+\treturn server\n+\t/*defer server.Close()\n+\n+\tfor {\n+\t\tconn, err := server.Accept()\n+\t\tlog.Println(\"accept a new client. remote address:[\" + conn.RemoteAddr().String() +\n+\t\t\t\"], local address:[\" + conn.LocalAddr().String() + \"]\")\n+\t\tif err != nil {\n+\t\t\tlog.Println(\"accept a new client faild.\", err.Error())\n+\t\t\tcontinue\n+\t\t}\n+\t\t//go recvConnMsg(conn)\n+\t}*/\n+}\n+\n+func accept(listener net.Listener) net.Conn {\n+\tconn, err := listener.Accept()\n+\tif err != nil {\n+\t\tlog.Println(\"[x]\", \"accept connect [\"+conn.RemoteAddr().String()+\"] faild.\", err.Error())\n+\t\treturn nil\n+\t}\n+\tlog.Println(\"[\u221a]\", \"accept a new client. remote address:[\"+conn.RemoteAddr().String()+\"], local address:[\"+conn.LocalAddr().String()+\"]\")\n+\treturn conn\n+}\n+\n+func forward(conn1 net.Conn, conn2 net.Conn) {\n+\tlog.Printf(\"[+] start transmit. [%s],[%s] <-> [%s],[%s] \\n\", conn1.LocalAddr().String(), conn1.RemoteAddr().String(), conn2.LocalAddr().String(), conn2.RemoteAddr().String())\n+\tvar wg sync.WaitGroup\n+\t// wait tow goroutines\n+\twg.Add(2)\n+\tgo connCopy(conn1, conn2, &wg)\n+\tgo connCopy(conn2, conn1, &wg)\n+\t//blocking when the wg is locked\n+\twg.Wait()\n+}\n+\n+func connCopy(conn1 net.Conn, conn2 net.Conn, wg *sync.WaitGroup) {\n+\t//TODO:log, record the data from conn1 and conn2.\n+\tlogFile := openLog(conn1.LocalAddr().String(), conn1.RemoteAddr().String(), conn2.LocalAddr().String(), conn2.RemoteAddr().String())\n+\tif logFile != nil {\n+\t\tw := io.MultiWriter(conn1, logFile)\n+\t\tio.Copy(w, conn2)\n+\t} else {\n+\t\tio.Copy(conn1, conn2)\n+\t}\n+\tconn1.Close()\n+\tlog.Println(\"[\u2190]\", \"close the connect at local:[\"+conn1.LocalAddr().String()+\"] and remote:[\"+conn1.RemoteAddr().String()+\"]\")\n+\t//conn2.Close()\n+\t//log.Println(\"[\u2190]\", \"close the connect at local:[\"+conn2.LocalAddr().String()+\"] and remote:[\"+conn2.RemoteAddr().String()+\"]\")\n+\twg.Done()\n+}\n+func openLog(address1, address2, address3, address4 string) *os.File {\n+\targs := os.Args\n+\targc := len(os.Args)\n+\tvar logFileError error\n+\tvar logFile *os.File\n+\tif argc > 5 && args[4] == \"-log\" {\n+\t\taddress1 = strings.Replace(address1, \":\", \"_\", -1)\n+\t\taddress2 = strings.Replace(address2, \":\", \"_\", -1)\n+\t\taddress3 = strings.Replace(address3, \":\", \"_\", -1)\n+\t\taddress4 = strings.Replace(address4, \":\", \"_\", -1)\n+\t\ttimeStr := time.Now().Format(\"2006_01_02_15_04_05\") // \"2006-01-02 15:04:05\"\n+\t\tlogPath := args[5] + \"/\" + timeStr + args[1] + \"-\" + address1 + \"_\" + address2 + \"-\" + address3 + \"_\" + address4 + \".log\"\n+\t\tlogPath = strings.Replace(logPath, `\\`, \"/\", -1)\n+\t\tlogPath = strings.Replace(logPath, \"//\", \"/\", -1)\n+\t\tlogFile, logFileError = os.OpenFile(logPath, os.O_APPEND|os.O_CREATE, 0666)\n+\t\tif logFileError != nil {\n+\t\t\tlog.Fatalln(\"[x]\", \"log file path error.\", logFileError.Error())\n+\t\t}\n+\t\tlog.Println(\"[\u221a]\", \"open test log file success. path:\", logPath)\n+\t}\n+\treturn logFile\n+}"
            },
            {
                "sha": "93b046e0e828081ae5324cbfe5e735c0f90b9393",
                "filename": "src/mod/tcpprox/tcpprox.go",
                "status": "added",
                "additions": 159,
                "deletions": 0,
                "changes": 159,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Ftcpprox.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Ftcpprox.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Ftcpprox%2Ftcpprox.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,159 @@\n+package tcpprox\n+\n+import (\n+\t\"errors\"\n+\n+\tuuid \"github.com/satori/go.uuid\"\n+\t\"imuslab.com/zoraxy/mod/database\"\n+)\n+\n+/*\n+\tTCP Proxy\n+\n+\tForward port from one port to another\n+\tAlso accept active connection and passive\n+\tconnection\n+*/\n+\n+const (\n+\tProxyMode_Listen    = 0\n+\tProxyMode_Transport = 1\n+\tProxyMode_Starter   = 2\n+)\n+\n+type ProxyRelayOptions struct {\n+\tName    string\n+\tPortA   string\n+\tPortB   string\n+\tTimeout int\n+\tMode    int\n+}\n+\n+type ProxyRelayConfig struct {\n+\tUUID                        string    //A UUIDv4 representing this config\n+\tName                        string    //Name of the config\n+\tRunning                     bool      //If the service is running\n+\tPortA                       string    //Ports A (config depends on mode)\n+\tPortB                       string    //Ports B (config depends on mode)\n+\tMode                        int       //Operation Mode\n+\tTimeout                     int       //Timeout for connection in sec\n+\tstopChan                    chan bool //Stop channel to stop the listener\n+\taTobAccumulatedByteTransfer int64     //Accumulated byte transfer from A to B\n+\tbToaAccumulatedByteTransfer int64     //Accumulated byte transfer from B to A\n+}\n+\n+type Options struct {\n+\tDatabase       *database.Database\n+\tDefaultTimeout int\n+}\n+\n+type Manager struct {\n+\t//Config and stores\n+\tOptions *Options\n+\tConfigs []*ProxyRelayConfig\n+\n+\t//Realtime Statistics\n+\tConnections int //currently connected connect counts\n+}\n+\n+func NewTCProxy(options *Options) *Manager {\n+\toptions.Database.NewTable(\"tcprox\")\n+\n+\tpreviousRules := []*ProxyRelayConfig{}\n+\tif options.Database.KeyExists(\"tcprox\", \"rules\") {\n+\t\toptions.Database.Read(\"tcprox\", \"rules\", &previousRules)\n+\t}\n+\n+\treturn &Manager{\n+\t\tOptions:     options,\n+\t\tConfigs:     previousRules,\n+\t\tConnections: 0,\n+\t}\n+}\n+\n+func (m *Manager) NewConfig(config *ProxyRelayOptions) string {\n+\t//Generate a new config from options\n+\tconfigUUID := uuid.NewV4().String()\n+\tthisConfig := ProxyRelayConfig{\n+\t\tUUID:                        configUUID,\n+\t\tName:                        config.Name,\n+\t\tRunning:                     false,\n+\t\tPortA:                       config.PortA,\n+\t\tPortB:                       config.PortB,\n+\t\tMode:                        config.Mode,\n+\t\tTimeout:                     config.Timeout,\n+\t\tstopChan:                    nil,\n+\t\taTobAccumulatedByteTransfer: 0,\n+\t\tbToaAccumulatedByteTransfer: 0,\n+\t}\n+\tm.Configs = append(m.Configs, &thisConfig)\n+\tm.SaveConfigToDatabase()\n+\treturn configUUID\n+}\n+\n+func (m *Manager) GetConfigByUUID(configUUID string) (*ProxyRelayConfig, error) {\n+\t// Find and return the config with the specified UUID\n+\tfor _, config := range m.Configs {\n+\t\tif config.UUID == configUUID {\n+\t\t\treturn config, nil\n+\t\t}\n+\t}\n+\treturn nil, errors.New(\"config not found\")\n+}\n+\n+// Edit the config based on config UUID, leave empty for unchange fields\n+func (m *Manager) EditConfig(configUUID string, newName string, newPortA string, newPortB string, newMode int, newTimeout int) error {\n+\t// Find the config with the specified UUID\n+\tfoundConfig, err := m.GetConfigByUUID(configUUID)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\t// Validate and update the fields\n+\tif newName != \"\" {\n+\t\tfoundConfig.Name = newName\n+\t}\n+\tif newPortA != \"\" {\n+\t\tfoundConfig.PortA = newPortA\n+\t}\n+\tif newPortB != \"\" {\n+\t\tfoundConfig.PortB = newPortB\n+\t}\n+\tif newMode != -1 {\n+\t\tif newMode > 2 || newMode < 0 {\n+\t\t\treturn errors.New(\"invalid mode given\")\n+\t\t}\n+\t\tfoundConfig.Mode = newMode\n+\t}\n+\tif newTimeout != -1 {\n+\t\tif newTimeout < 0 {\n+\t\t\treturn errors.New(\"invalid timeout value given\")\n+\t\t}\n+\t\tfoundConfig.Timeout = newTimeout\n+\t}\n+\n+\terr = foundConfig.ValidateConfigs()\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tm.SaveConfigToDatabase()\n+\n+\treturn nil\n+}\n+\n+func (m *Manager) RemoveConfig(configUUID string) error {\n+\t// Find and remove the config with the specified UUID\n+\tfor i, config := range m.Configs {\n+\t\tif config.UUID == configUUID {\n+\t\t\tm.Configs = append(m.Configs[:i], m.Configs[i+1:]...)\n+\t\t\tm.SaveConfigToDatabase()\n+\t\t\treturn nil\n+\t\t}\n+\t}\n+\treturn errors.New(\"config not found\")\n+}\n+\n+func (m *Manager) SaveConfigToDatabase() {\n+\tm.Options.Database.Write(\"tcprox\", \"rules\", m.Configs)\n+}"
            },
            {
                "sha": "0dd3cdf582d4cb098640a2b80eb1b3c2b2ab70c0",
                "filename": "src/mod/tcpprox/tcpprox_test.go",
                "status": "added",
                "additions": 43,
                "deletions": 0,
                "changes": 43,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Ftcpprox_test.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftcpprox%2Ftcpprox_test.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Ftcpprox%2Ftcpprox_test.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,43 @@\n+package tcpprox_test\n+\n+import (\n+\t\"testing\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/tcpprox\"\n+)\n+\n+func TestPort2Port(t *testing.T) {\n+\t// Create a stopChan to control the loop\n+\tstopChan := make(chan bool)\n+\n+\t// Create a ProxyRelayConfig with dummy values\n+\tconfig := &tcpprox.ProxyRelayConfig{\n+\t\tTimeout: 1,\n+\t}\n+\n+\t// Run port2port in a separate goroutine\n+\tt.Log(\"Starting go routine for proxy service\")\n+\tgo func() {\n+\t\terr := config.Port2host(\"8080\", \"124.244.86.40:8080\", stopChan)\n+\t\tif err != nil {\n+\t\t\tt.Errorf(\"port2port returned an error: %v\", err)\n+\t\t}\n+\t}()\n+\n+\t// Let the goroutine run for a while\n+\ttime.Sleep(20 * time.Second)\n+\n+\t// Send a stop signal to stopChan\n+\tt.Log(\"Sending over stop signal\")\n+\tstopChan <- true\n+\n+\t// Allow some time for the goroutine to exit\n+\ttime.Sleep(1 * time.Second)\n+\n+\t// If the goroutine is still running, it means it did not stop as expected\n+\tif config.Running {\n+\t\tt.Errorf(\"port2port did not stop as expected\")\n+\t}\n+\n+}"
            },
            {
                "sha": "10c52da7d5b6554b39cfcaa7329511e86cec8280",
                "filename": "src/mod/tlscert/helper.go",
                "status": "added",
                "additions": 60,
                "deletions": 0,
                "changes": 60,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftlscert%2Fhelper.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftlscert%2Fhelper.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Ftlscert%2Fhelper.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,60 @@\n+package tlscert\n+\n+import (\n+\t\"path/filepath\"\n+\t\"strings\"\n+)\n+\n+//This remove the certificates in the list where either the\n+//public key or the private key is missing\n+func getCertPairs(certFiles []string) []string {\n+\tcrtMap := make(map[string]bool)\n+\tkeyMap := make(map[string]bool)\n+\n+\tfor _, filename := range certFiles {\n+\t\tif filepath.Ext(filename) == \".crt\" {\n+\t\t\tcrtMap[strings.TrimSuffix(filename, \".crt\")] = true\n+\t\t} else if filepath.Ext(filename) == \".key\" {\n+\t\t\tkeyMap[strings.TrimSuffix(filename, \".key\")] = true\n+\t\t}\n+\t}\n+\n+\tvar result []string\n+\tfor domain := range crtMap {\n+\t\tif keyMap[domain] {\n+\t\t\tresult = append(result, domain)\n+\t\t}\n+\t}\n+\n+\treturn result\n+}\n+\n+//Get the cloest subdomain certificate from a list of domains\n+func matchClosestDomainCertificate(subdomain string, domains []string) string {\n+\tvar matchingDomain string = \"\"\n+\tmaxLength := 0\n+\n+\tfor _, domain := range domains {\n+\t\tif strings.HasSuffix(subdomain, \".\"+domain) && len(domain) > maxLength {\n+\t\t\tmatchingDomain = domain\n+\t\t\tmaxLength = len(domain)\n+\t\t}\n+\t}\n+\n+\treturn matchingDomain\n+}\n+\n+//Check if a requesting domain is a subdomain of a given domain\n+func isSubdomain(subdomain, domain string) bool {\n+\tsubdomainParts := strings.Split(subdomain, \".\")\n+\tdomainParts := strings.Split(domain, \".\")\n+\tif len(subdomainParts) < len(domainParts) {\n+\t\treturn false\n+\t}\n+\tfor i := range domainParts {\n+\t\tif subdomainParts[len(subdomainParts)-1-i] != domainParts[len(domainParts)-1-i] {\n+\t\t\treturn false\n+\t\t}\n+\t}\n+\treturn true\n+}"
            },
            {
                "sha": "d59e5b980c56ff3bcc2c67b22c84030b3d15b9f7",
                "filename": "src/mod/tlscert/localhost.crt",
                "status": "added",
                "additions": 34,
                "deletions": 0,
                "changes": 34,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftlscert%2Flocalhost.crt",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftlscert%2Flocalhost.crt",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Ftlscert%2Flocalhost.crt?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,34 @@\n+-----BEGIN CERTIFICATE-----\n+MIIF8TCCA9mgAwIBAgIUavNWjB6rlfRLpeXJ9TXb2FVrENYwDQYJKoZIhvcNAQEL\n+BQAwbjELMAkGA1UEBhMCR0wxEjAQBgNVBAgMCU1pbGt5IFdheTEOMAwGA1UEBwwF\n+RWFydGgxEDAOBgNVBAoMB2ltdXNsYWIxDzANBgNVBAsMBkFyb3pPUzEYMBYGA1UE\n+AwwPd3d3LmltdXNsYWIuY29tMB4XDTIxMDkxNzA4NTkyNFoXDTQ5MDIwMTA4NTky\n+NFowbjELMAkGA1UEBhMCR0wxEjAQBgNVBAgMCU1pbGt5IFdheTEOMAwGA1UEBwwF\n+RWFydGgxEDAOBgNVBAoMB2ltdXNsYWIxDzANBgNVBAsMBkFyb3pPUzEYMBYGA1UE\n+AwwPd3d3LmltdXNsYWIuY29tMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKC\n+AgEAsBpf9ufRYOfdKft+51EibpqhA9yw6YstxL5BNselx3ETVnu7vYRIlH0ypgPN\n+nKguZ+BcN4mJFjQ36N4VpN7ySVfOCSCZz7lPvPfLib9iukBodBYQNAzMkKcLjyoY\n+gS8MD99cqe7s48k4JKp6b2WOmn2OtVZIS7AKZvVsRJNblhy7C3LkLnASKF0jb/ia\n+MGRAE+QV/zznvGg9FhNgQWWUil2Oesx3elj4KwlcHNX+c9pZz6yVgJrerj0s94OD\n+EuueiqAFOWsZrpp754ffC45PbeTNiflQ1B3aqkTtl5bL88ESgwMdtb1JGWN5HIS1\n+Tq2d/3PgqbtvUEhggaFDbe0OxG2V33HqEfeG3BpZpYhCB3I7FPpRC/Tp8PACY13N\n+HYB9P5hRU/DnINhHjMCLKxHsolhiphWuxSuNIIojRL62zj7JwjnBgcghQzVFJ4O4\n+TBfeMDadLII3ndDtsmR1dIba7fg+CWWdv4Zs0XGqHOaiHNclc7BhJF8SgiQxjxjm\n+Fh1ZsJm3LxPsw/iCl7ILE7+1aBQlBjEj0yBvMttkEDhRbILxXFPMALG/qakPvW9O\n+7WWClAc03ei/JFdq2camuY62/Tf1HB+TSpGWYH+cSIqsu3V5u29jmdZjrjnuM7Fz\n+GEjNSCsrMhSLYLkMJmrDGdFQBB31x24o9IXtyrfKZiwxMlUCAwEAAaOBhjCBgzAL\n+BgNVHQ8EBAMCBeAwEwYDVR0lBAwwCgYIKwYBBQUHAwEwQAYDVR0RBDkwN4IBKoIQ\n+aW11c2xhYi5pbnRlcm5hbIISbm90LmZvci5wcm9kdWN0aW9uggxkZXYudXNlLm9u\n+bHkwHQYDVR0OBBYEFISIH/rn8RX1hcNf4rQajJR7FEdMMA0GCSqGSIb3DQEBCwUA\n+A4ICAQBVldF/qjWyGJ5TiZMiXly/So9zR3Xq7O1qayqYxb5SxvhZYCtsFVrAl6Ux\n+5bTZ0XQagjck2VouHOG6s98DpaslWFw9N8ADAmljQ8WL1hT5Ij1LXs2sF0FqttFf\n+YgoT5BOjnHZGlN+FgzAkdF91cYrfZwLm63jvAQtIHwjMSeymy2Fq8gdEZxagYuwG\n+gLkZxw1YG+gP778CKHT2Ff232kH+5up460aGLHLvg+xHQIWBt2FNGdv68u57hWxh\n+XXji4/DewQ0RdJW1JdpSg4npebDNiXpo9pKY/SxU056raOtPA94U/h12cHVkszT7\n+IxdFC2PszAblbSZhHKGE0C6SbATsqvK4gz6e4h7HWVuPPNWpPW2BNjvyenpijV/E\n+YsSe6F7uQE/I/iHp9VMcjWuwItqed9yKDeOfDH4+pidowbSJQ97xYfZge36ZEUHC\n+2ZdQsR0qS+t2h0KlEDN7FNxai3ikSB1bs2AjtU67ofGtoIz/HD70TT6zHKhISZgI\n+w/4/SY7Hd+P+AWSdJwo+ycZYZlXajqh/cxVJ0zVBr5vKC9KnJ+IjnQ/q7CLcxM4W\n+aAFC1jakdPz7qO+xNVLQRf8lVnPJNtI88OrlL4n02JlLS/QUSwELXFW0bOKP33jm\n+PIbPdeP8k0XVe9wlI7MzUQC8pCt+gQ77awTt83Nxp9Xdn1Zbqw==\n+-----END CERTIFICATE-----"
            },
            {
                "sha": "35e2cb57cf5b40ce4f6a4ab87c55a65bea4d4fea",
                "filename": "src/mod/tlscert/localhost.key",
                "status": "added",
                "additions": 52,
                "deletions": 0,
                "changes": 52,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftlscert%2Flocalhost.key",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftlscert%2Flocalhost.key",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Ftlscert%2Flocalhost.key?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,52 @@\n+-----BEGIN PRIVATE KEY-----\n+MIIJQgIBADANBgkqhkiG9w0BAQEFAASCCSwwggkoAgEAAoICAQCwGl/259Fg590p\n++37nUSJumqED3LDpiy3EvkE2x6XHcRNWe7u9hEiUfTKmA82cqC5n4Fw3iYkWNDfo\n+3hWk3vJJV84JIJnPuU+898uJv2K6QGh0FhA0DMyQpwuPKhiBLwwP31yp7uzjyTgk\n+qnpvZY6afY61VkhLsApm9WxEk1uWHLsLcuQucBIoXSNv+JowZEAT5BX/POe8aD0W\n+E2BBZZSKXY56zHd6WPgrCVwc1f5z2lnPrJWAmt6uPSz3g4MS656KoAU5axmumnvn\n+h98Ljk9t5M2J+VDUHdqqRO2XlsvzwRKDAx21vUkZY3kchLVOrZ3/c+Cpu29QSGCB\n+oUNt7Q7EbZXfceoR94bcGlmliEIHcjsU+lEL9Onw8AJjXc0dgH0/mFFT8Ocg2EeM\n+wIsrEeyiWGKmFa7FK40giiNEvrbOPsnCOcGByCFDNUUng7hMF94wNp0sgjed0O2y\n+ZHV0htrt+D4JZZ2/hmzRcaoc5qIc1yVzsGEkXxKCJDGPGOYWHVmwmbcvE+zD+IKX\n+sgsTv7VoFCUGMSPTIG8y22QQOFFsgvFcU8wAsb+pqQ+9b07tZYKUBzTd6L8kV2rZ\n+xqa5jrb9N/UcH5NKkZZgf5xIiqy7dXm7b2OZ1mOuOe4zsXMYSM1IKysyFItguQwm\n+asMZ0VAEHfXHbij0he3Kt8pmLDEyVQIDAQABAoICAATmtwUILqujyGQCu+V0PKEX\n+bKPO4J2fYga3xNjhdZu3afJePztnEx4O3foA4RgbFi+N7wMcsNQNYAD7LV8JVXT1\n+HKbkYWOGpNF9lAyhZv4IDOAuPQU11fuwqoGxij0OMie+77VLEQzF7OoYVJAFI5Lp\n+K6+gVyLEI4X6DqlZ8JKc+he3euJP/DFjZjkXkjMGl0H2dyZDa6+ytwCGSYeIbDnt\n+oKmKR0kAcOfBuu6ShiJzUUyWYRLTPJ9c1IOPBXbhV+hDy+FtOanCYvBut6Z6r3s/\n+gvj0F2vP6OYURQiTCdoe5YT/8TO9sOsj+Zrxlpo5+svBTd9reA2j9gulkVrd3itN\n+c2Ee7fyuyrCRnEcKoT6BI8/LqH5eWGQKKS9WhOz26VkrorcYYZN3g4ayv+MiiSIm\n+jeo/kAWCqT5ylvlw2gaCbPjB4kbx7yMI/myjgF0R4+aNQaHpXa2qqEORitGx40M7\n+T1V2JIxnsa83TBwumunkYC2pX7bNS0a1VuCNxUafJRKEcvKhWmiRHaWddZn46G8N\n+E56qFzSaLbkd+J71jso9llK5joGIQTt2pbKUdV9LIm5Nsbtp2VgF9URIw5RZFftx\n+PfSm9XM9DtWuxheO4gNwAuOvtaOxztNMvSkQzhTOggSRpt15hFd7CeBrpK43feAH\n+b2pMequB8MHpUieyxlwBAoIBAQC5IRbaKx+fSEbYeIySUwbN8GCJQl+wmvc1gqCC\n+DflEQqxTvCGBB5SLHHurTT0ubhXkvbrtuS5f4IC+htzKSuwlqn3lS0aOXtFP2tT6\n+D9iiMxLxIId5l6dD+PjMWtQcWc8wUQ7+ieRgxybDqiCWMyTbvNgwlkcIbRxmcqyN\n+4/LmmgzTnr5CH0DC/J7xpUJuX9LPVb4ZvBYjz5X++Yb7pCa+kXp0Z6yU48bG3sRe\n+yiUKp3Z4vDoOkMLHTPvTQLG81rQuJnBUw2uLWM0kg1AwteZcQ/gH1ilVbJzMBnKm\n+mtuJWtoPnM2zIhCsURngmBN+qxOb5kchMSvPzAQBCw7HBjWpAoIBAQDzhLQO434G\n+XhyDcdkdMRbDZ8Q8PqtOloAbczMuPGgwHV7rVe/BvnJS7HDDebwlJBD8nhGvgBrp\n+CsjNGHjSQC7ydUa8dP4Aw/46izdR8DsAwqGZq+tZhkY5CS88QpflUT5rftW0RObn\n+Cb/gDzdxHy35/scSICxa2HwcZnqXqfEwnbjkxFwBYFSt6hRiwNhDhd6ZxKa6gt56\n+DS9uIxt1IhKgXZfIw1Vo0mHHFLsB7czGZ0O24ya31Es0bUWGgWIcxvKw6MqKhFWw\n+ncCakVg278UYUm/zt6Dcrn3XYnK7Pr944AiKO21PMQhG7Rb+OVwxgjMhk7/BCt+k\n+sPR1Dct5pqrNAoIBAAl2jYp9ZdJoiWaLUvQv1ks0nFqnz+hhI33SvY2oVTOODO0C\n+0tubnZY20IODITt8WRYmNKXuL1arTSlwD10v0z5hpqnP3T1tz1k7oGNf5/zyi2dT\n++FjYza4FzgH0Kp+AX7zih9evCMOBqpOZ4KyM1Ld+wbZKGDtwCGGcPwHJwyLSgRFY\n+LfWHT3IoI5/KiMjHkSkUAvGh0afm9o3gB2xZibl4CkBlBEdgFUsZHASUZKxUvxOQ\n+247fC3XQk5bK2csDVpZ9VISgsKCg22ugYrr6sVnKB6Wu5tH9CU7MjZPCmrI8uKTP\n+qRwdA6krRB1c6LIy4H+5l600rD6k+Rdsj0bRJHECggEAeBXSrRzmAsHaEb/MryaL\n+8SR0krjcxU5WMjMm5AAJ6OAy9J5WMxZ1TgsmuF6Jt08HyWsxkXf8zTryNqGAwz2/\n+aPUIQtr2fu4nqjsItrFeh0tzYVJ0JpueeXXcAz1bpkvgGiZbwB/SNdCK/DTExFX5\n+2DQZewi+lrX2zhKDFdNKCw1cJgPm0w7r8y9hiilK/FFBqlZdWdA7Ybiq0Qci/Som\n+QUqmFOyua5iDeybv6U2ZE6XMsJ1ndHON+naAOIoJFePNvguuBYyorQW9+vr9o2mt\n+qgbNCkRdYTXy/ImhxlB1H2hrDa+sgcbOLBuyoP8sRYXNLRutDccM7iwNAMQiuQTF\n+aQKCAQEAiKPwUodT6LNu4lrSbsDAYIqWwlfM0wwUhudT5UTVHSYI3ap0QOiEuzOl\n+IJVdx+vx7rQW7l+JIL6s4shA7mzpzuTVlhRuDuGZx0qQLP7INVpCLzIEbYGI2dL7\n+WLhJd4eYKltJ+BG7S51tq9/6rVcUDn5DKzyGNyeGhOnaYkk+eTm483+vpOP2/ITi\n+cbVv3mx4qE7zMPIxIufm+c8RonadJzYiq1uMk8t0TrcW/B9RTly/Y96kamjyU5b0\n+OcLdRcx3ppKAxHD9AvwAR6SiuNLfNjM9KZM40zM5goMrCJJzwgb7UGeMuw2z7L9F\n++iSj2pW0Rbdy7oOcFRF/iM2GwFYc1Q==\n+-----END PRIVATE KEY-----"
            },
            {
                "sha": "6a739ebbf5ee15479790c5a86b5336fcb075c5c5",
                "filename": "src/mod/tlscert/tlscert.go",
                "status": "added",
                "additions": 187,
                "deletions": 0,
                "changes": 187,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftlscert%2Ftlscert.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Ftlscert%2Ftlscert.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Ftlscert%2Ftlscert.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,187 @@\n+package tlscert\n+\n+import (\n+\t\"crypto/tls\"\n+\t\"crypto/x509\"\n+\t\"embed\"\n+\t\"encoding/pem\"\n+\t\"io\"\n+\t\"io/ioutil\"\n+\t\"log\"\n+\t\"os\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+type Manager struct {\n+\tCertStore string\n+\tverbal    bool\n+}\n+\n+//go:embed localhost.crt localhost.key\n+var buildinCertStore embed.FS\n+\n+func NewManager(certStore string, verbal bool) (*Manager, error) {\n+\tif !utils.FileExists(certStore) {\n+\t\tos.MkdirAll(certStore, 0775)\n+\t}\n+\n+\tthisManager := Manager{\n+\t\tCertStore: certStore,\n+\t\tverbal:    verbal,\n+\t}\n+\n+\treturn &thisManager, nil\n+}\n+\n+func (m *Manager) ListCertDomains() ([]string, error) {\n+\tfilenames, err := m.ListCerts()\n+\tif err != nil {\n+\t\treturn []string{}, err\n+\t}\n+\n+\t//Remove certificates where there are missing public key or private key\n+\tfilenames = getCertPairs(filenames)\n+\n+\treturn filenames, nil\n+}\n+\n+func (m *Manager) ListCerts() ([]string, error) {\n+\tcerts, err := ioutil.ReadDir(m.CertStore)\n+\tif err != nil {\n+\t\treturn []string{}, err\n+\t}\n+\n+\tfilenames := make([]string, 0, len(certs))\n+\tfor _, cert := range certs {\n+\t\tif !cert.IsDir() {\n+\t\t\tfilenames = append(filenames, cert.Name())\n+\t\t}\n+\t}\n+\n+\treturn filenames, nil\n+}\n+\n+func (m *Manager) GetCert(helloInfo *tls.ClientHelloInfo) (*tls.Certificate, error) {\n+\t//Check if the domain corrisponding cert exists\n+\tpubKey := \"./tmp/localhost.crt\"\n+\tpriKey := \"./tmp/localhost.key\"\n+\n+\t//Check if this is initial setup\n+\tif !utils.FileExists(pubKey) {\n+\t\tbuildInPubKey, _ := buildinCertStore.ReadFile(filepath.Base(pubKey))\n+\t\tos.WriteFile(pubKey, buildInPubKey, 0775)\n+\t}\n+\n+\tif !utils.FileExists(priKey) {\n+\t\tbuildInPriKey, _ := buildinCertStore.ReadFile(filepath.Base(priKey))\n+\t\tos.WriteFile(priKey, buildInPriKey, 0775)\n+\t}\n+\n+\tif utils.FileExists(filepath.Join(m.CertStore, helloInfo.ServerName+\".crt\")) && utils.FileExists(filepath.Join(m.CertStore, helloInfo.ServerName+\".key\")) {\n+\t\tpubKey = filepath.Join(m.CertStore, helloInfo.ServerName+\".crt\")\n+\t\tpriKey = filepath.Join(m.CertStore, helloInfo.ServerName+\".key\")\n+\n+\t} else {\n+\t\tdomainCerts, _ := m.ListCertDomains()\n+\t\tcloestDomainCert := matchClosestDomainCertificate(helloInfo.ServerName, domainCerts)\n+\t\tif cloestDomainCert != \"\" {\n+\t\t\t//There is a matching parent domain for this subdomain. Use this instead.\n+\t\t\tpubKey = filepath.Join(m.CertStore, cloestDomainCert+\".crt\")\n+\t\t\tpriKey = filepath.Join(m.CertStore, cloestDomainCert+\".key\")\n+\t\t} else if m.DefaultCertExists() {\n+\t\t\t//Use default.crt and default.key\n+\t\t\tpubKey = filepath.Join(m.CertStore, \"default.crt\")\n+\t\t\tpriKey = filepath.Join(m.CertStore, \"default.key\")\n+\t\t\tif m.verbal {\n+\t\t\t\tlog.Println(\"No matching certificate found. Serving with default\")\n+\t\t\t}\n+\t\t} else {\n+\t\t\tif m.verbal {\n+\t\t\t\tlog.Println(\"Matching certificate not found. Serving with build-in certificate. Requesting server name: \", helloInfo.ServerName)\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t//Load the cert and serve it\n+\tcer, err := tls.LoadX509KeyPair(pubKey, priKey)\n+\tif err != nil {\n+\t\tlog.Println(err)\n+\t\treturn nil, nil\n+\t}\n+\n+\treturn &cer, nil\n+}\n+\n+// Check if both the default cert public key and private key exists\n+func (m *Manager) DefaultCertExists() bool {\n+\treturn utils.FileExists(filepath.Join(m.CertStore, \"default.crt\")) && utils.FileExists(filepath.Join(m.CertStore, \"default.key\"))\n+}\n+\n+// Check if the default cert exists returning seperate results for pubkey and prikey\n+func (m *Manager) DefaultCertExistsSep() (bool, bool) {\n+\treturn utils.FileExists(filepath.Join(m.CertStore, \"default.crt\")), utils.FileExists(filepath.Join(m.CertStore, \"default.key\"))\n+}\n+\n+// Delete the cert if exists\n+func (m *Manager) RemoveCert(domain string) error {\n+\tpubKey := filepath.Join(m.CertStore, domain+\".crt\")\n+\tpriKey := filepath.Join(m.CertStore, domain+\".key\")\n+\tif utils.FileExists(pubKey) {\n+\t\terr := os.Remove(pubKey)\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t}\n+\n+\tif utils.FileExists(priKey) {\n+\t\terr := os.Remove(priKey)\n+\t\tif err != nil {\n+\t\t\treturn err\n+\t\t}\n+\t}\n+\n+\treturn nil\n+}\n+\n+// Check if the given file is a valid TLS file\n+func IsValidTLSFile(file io.Reader) bool {\n+\t// Read the contents of the uploaded file\n+\tcontents, err := io.ReadAll(file)\n+\tif err != nil {\n+\t\t// Handle the error\n+\t\treturn false\n+\t}\n+\n+\t// Parse the contents of the file as a PEM-encoded certificate or key\n+\tblock, _ := pem.Decode(contents)\n+\tif block == nil {\n+\t\t// The file is not a valid PEM-encoded certificate or key\n+\t\treturn false\n+\t}\n+\n+\t// Parse the certificate or key\n+\tif strings.Contains(block.Type, \"CERTIFICATE\") {\n+\t\t// The file contains a certificate\n+\t\tcert, err := x509.ParseCertificate(block.Bytes)\n+\t\tif err != nil {\n+\t\t\t// Handle the error\n+\t\t\treturn false\n+\t\t}\n+\t\t// Check if the certificate is a valid TLS/SSL certificate\n+\t\treturn cert.IsCA == false && cert.KeyUsage&x509.KeyUsageDigitalSignature != 0 && cert.KeyUsage&x509.KeyUsageKeyEncipherment != 0\n+\t} else if strings.Contains(block.Type, \"PRIVATE KEY\") {\n+\t\t// The file contains a private key\n+\t\t_, err := x509.ParsePKCS1PrivateKey(block.Bytes)\n+\t\tif err != nil {\n+\t\t\t// Handle the error\n+\t\t\treturn false\n+\t\t}\n+\t\treturn true\n+\t} else {\n+\t\treturn false\n+\t}\n+\n+}"
            },
            {
                "sha": "ff22b61fa06a95a0480d41761daf494967f279ba",
                "filename": "src/mod/uptime/uptime.go",
                "status": "added",
                "additions": 228,
                "deletions": 0,
                "changes": 228,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fuptime%2Fuptime.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fuptime%2Fuptime.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fuptime%2Fuptime.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,228 @@\n+package uptime\n+\n+import (\n+\t\"encoding/json\"\n+\t\"log\"\n+\t\"net/http\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+type Record struct {\n+\tTimestamp  int64\n+\tID         string\n+\tName       string\n+\tURL        string\n+\tProtocol   string\n+\tOnline     bool\n+\tStatusCode int\n+\tLatency    int64\n+}\n+\n+type Target struct {\n+\tID       string\n+\tName     string\n+\tURL      string\n+\tProtocol string\n+}\n+\n+type Config struct {\n+\tTargets         []*Target\n+\tInterval        int\n+\tMaxRecordsStore int\n+}\n+\n+type Monitor struct {\n+\tConfig          *Config\n+\tOnlineStatusLog map[string][]*Record\n+}\n+\n+// Default configs\n+var exampleTarget = Target{\n+\tID:       \"example\",\n+\tName:     \"Example\",\n+\tURL:      \"example.com\",\n+\tProtocol: \"https\",\n+}\n+\n+// Create a new uptime monitor\n+func NewUptimeMonitor(config *Config) (*Monitor, error) {\n+\t//Create new monitor object\n+\tthisMonitor := Monitor{\n+\t\tConfig:          config,\n+\t\tOnlineStatusLog: map[string][]*Record{},\n+\t}\n+\t//Start the endpoint listener\n+\tticker := time.NewTicker(time.Duration(config.Interval) * time.Second)\n+\tdone := make(chan bool)\n+\n+\t//Start the uptime check once first before entering loop\n+\tthisMonitor.ExecuteUptimeCheck()\n+\n+\tgo func() {\n+\t\tfor {\n+\t\t\tselect {\n+\t\t\tcase <-done:\n+\t\t\t\treturn\n+\t\t\tcase t := <-ticker.C:\n+\t\t\t\tlog.Println(\"Uptime updated - \", t.Unix())\n+\t\t\t\tthisMonitor.ExecuteUptimeCheck()\n+\t\t\t}\n+\t\t}\n+\t}()\n+\n+\treturn &thisMonitor, nil\n+}\n+\n+func (m *Monitor) ExecuteUptimeCheck() {\n+\tfor _, target := range m.Config.Targets {\n+\t\t//For each target to check online, do the following\n+\t\tvar thisRecord Record\n+\t\tif target.Protocol == \"http\" || target.Protocol == \"https\" {\n+\t\t\tonline, laterncy, statusCode := getWebsiteStatusWithLatency(target.URL)\n+\t\t\tthisRecord = Record{\n+\t\t\t\tTimestamp:  time.Now().Unix(),\n+\t\t\t\tID:         target.ID,\n+\t\t\t\tName:       target.Name,\n+\t\t\t\tURL:        target.URL,\n+\t\t\t\tProtocol:   target.Protocol,\n+\t\t\t\tOnline:     online,\n+\t\t\t\tStatusCode: statusCode,\n+\t\t\t\tLatency:    laterncy,\n+\t\t\t}\n+\n+\t\t\t//fmt.Println(thisRecord)\n+\n+\t\t} else {\n+\t\t\tlog.Println(\"Unknown protocol: \" + target.Protocol + \". Skipping\")\n+\t\t\tcontinue\n+\t\t}\n+\n+\t\tthisRecords, ok := m.OnlineStatusLog[target.ID]\n+\t\tif !ok {\n+\t\t\t//First record. Create the array\n+\t\t\tm.OnlineStatusLog[target.ID] = []*Record{&thisRecord}\n+\t\t} else {\n+\t\t\t//Append to the previous record\n+\t\t\tthisRecords = append(thisRecords, &thisRecord)\n+\n+\t\t\t//Check if the record is longer than the logged record. If yes, clear out the old records\n+\t\t\tif len(thisRecords) > m.Config.MaxRecordsStore {\n+\t\t\t\tthisRecords = thisRecords[1:]\n+\t\t\t}\n+\n+\t\t\tm.OnlineStatusLog[target.ID] = thisRecords\n+\t\t}\n+\t}\n+\n+\t//TODO: Write results to db\n+}\n+\n+func (m *Monitor) AddTargetToMonitor(target *Target) {\n+\t// Add target to Config\n+\tm.Config.Targets = append(m.Config.Targets, target)\n+\n+\t// Add target to OnlineStatusLog\n+\tm.OnlineStatusLog[target.ID] = []*Record{}\n+}\n+\n+func (m *Monitor) RemoveTargetFromMonitor(targetId string) {\n+\t// Remove target from Config\n+\tfor i, target := range m.Config.Targets {\n+\t\tif target.ID == targetId {\n+\t\t\tm.Config.Targets = append(m.Config.Targets[:i], m.Config.Targets[i+1:]...)\n+\t\t\tbreak\n+\t\t}\n+\t}\n+\n+\t// Remove target from OnlineStatusLog\n+\tdelete(m.OnlineStatusLog, targetId)\n+}\n+\n+// Scan the config target. If a target exists in m.OnlineStatusLog no longer\n+// exists in m.Monitor.Config.Targets, it remove it from the log as well.\n+func (m *Monitor) CleanRecords() {\n+\t// Create a set of IDs for all targets in the config\n+\ttargetIDs := make(map[string]bool)\n+\tfor _, target := range m.Config.Targets {\n+\t\ttargetIDs[target.ID] = true\n+\t}\n+\n+\t// Iterate over all log entries and remove any that have a target ID that\n+\t// is not in the set of current target IDs\n+\tnewStatusLog := m.OnlineStatusLog\n+\tfor id, _ := range m.OnlineStatusLog {\n+\t\t_, idExistsInTargets := targetIDs[id]\n+\t\tif !idExistsInTargets {\n+\t\t\tdelete(newStatusLog, id)\n+\t\t}\n+\t}\n+\n+\tm.OnlineStatusLog = newStatusLog\n+}\n+\n+/*\n+\tWeb Interface Handler\n+*/\n+\n+func (m *Monitor) HandleUptimeLogRead(w http.ResponseWriter, r *http.Request) {\n+\tid, _ := utils.GetPara(r, \"id\")\n+\tif id == \"\" {\n+\t\tjs, _ := json.Marshal(m.OnlineStatusLog)\n+\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n+\t\tw.Write(js)\n+\t} else {\n+\t\t//Check if that id exists\n+\t\tlog, ok := m.OnlineStatusLog[id]\n+\t\tif !ok {\n+\t\t\thttp.NotFound(w, r)\n+\t\t\treturn\n+\t\t}\n+\n+\t\tjs, _ := json.MarshalIndent(log, \"\", \" \")\n+\t\tw.Header().Set(\"Content-Type\", \"application/json\")\n+\t\tw.Write(js)\n+\t}\n+\n+}\n+\n+/*\n+\tUtilities\n+*/\n+\n+// Get website stauts with latency given URL, return is conn succ and its latency and status code\n+func getWebsiteStatusWithLatency(url string) (bool, int64, int) {\n+\tstart := time.Now().UnixNano() / int64(time.Millisecond)\n+\tstatusCode, err := getWebsiteStatus(url)\n+\tend := time.Now().UnixNano() / int64(time.Millisecond)\n+\tif err != nil {\n+\t\tlog.Println(err.Error())\n+\t\treturn false, 0, 0\n+\t} else {\n+\t\tdiff := end - start\n+\t\tsucc := false\n+\t\tif statusCode >= 200 && statusCode < 300 {\n+\t\t\t//OK\n+\t\t\tsucc = true\n+\t\t} else if statusCode >= 300 && statusCode < 400 {\n+\t\t\t//Redirection code\n+\t\t\tsucc = true\n+\t\t} else {\n+\t\t\tsucc = false\n+\t\t}\n+\n+\t\treturn succ, diff, statusCode\n+\t}\n+\n+}\n+\n+func getWebsiteStatus(url string) (int, error) {\n+\tresp, err := http.Get(url)\n+\tif err != nil {\n+\t\treturn 0, err\n+\t}\n+\tstatus_code := resp.StatusCode\n+\tresp.Body.Close()\n+\treturn status_code, nil\n+}"
            },
            {
                "sha": "9256b11d5911ba443226ac7769282301e47d3409",
                "filename": "src/mod/utils/conv.go",
                "status": "added",
                "additions": 16,
                "deletions": 0,
                "changes": 16,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Futils%2Fconv.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Futils%2Fconv.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Futils%2Fconv.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,16 @@\n+package utils\n+\n+import \"strconv\"\n+\n+func StringToInt64(number string) (int64, error) {\n+\ti, err := strconv.ParseInt(number, 10, 64)\n+\tif err != nil {\n+\t\treturn -1, err\n+\t}\n+\treturn i, nil\n+}\n+\n+func Int64ToString(number int64) string {\n+\tconvedNumber := strconv.FormatInt(number, 10)\n+\treturn convedNumber\n+}"
            },
            {
                "sha": "e5772a80fff3a73d9c179dfcfe577e1be5d4ef93",
                "filename": "src/mod/utils/template.go",
                "status": "added",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Futils%2Ftemplate.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Futils%2Ftemplate.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Futils%2Ftemplate.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,19 @@\n+package utils\n+\n+import (\n+\t\"net/http\"\n+)\n+\n+/*\n+\tWeb Template Generator\n+\n+\tThis is the main system core module that perform function similar to what PHP did.\n+\tTo replace part of the content of any file, use {{paramter}} to replace it.\n+\n+\n+*/\n+\n+func SendHTMLResponse(w http.ResponseWriter, msg string) {\n+\tw.Header().Set(\"Content-Type\", \"text/html\")\n+\tw.Write([]byte(msg))\n+}"
            },
            {
                "sha": "a604113bcade5accc4f5350211c7596b9e84064a",
                "filename": "src/mod/utils/utils.go",
                "status": "added",
                "additions": 175,
                "deletions": 0,
                "changes": 175,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Futils%2Futils.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Futils%2Futils.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Futils%2Futils.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,175 @@\n+package utils\n+\n+import (\n+\t\"bufio\"\n+\t\"encoding/base64\"\n+\t\"errors\"\n+\t\"io\"\n+\t\"log\"\n+\t\"net/http\"\n+\t\"os\"\n+\t\"strings\"\n+\t\"time\"\n+)\n+\n+/*\n+\tCommon\n+\n+\tSome commonly used functions in ArozOS\n+\n+*/\n+\n+// Response related\n+func SendTextResponse(w http.ResponseWriter, msg string) {\n+\tw.Write([]byte(msg))\n+}\n+\n+// Send JSON response, with an extra json header\n+func SendJSONResponse(w http.ResponseWriter, json string) {\n+\tw.Header().Set(\"Content-Type\", \"application/json\")\n+\tw.Write([]byte(json))\n+}\n+\n+func SendErrorResponse(w http.ResponseWriter, errMsg string) {\n+\tw.Header().Set(\"Content-Type\", \"application/json\")\n+\tw.Write([]byte(\"{\\\"error\\\":\\\"\" + errMsg + \"\\\"}\"))\n+}\n+\n+func SendOK(w http.ResponseWriter) {\n+\tw.Header().Set(\"Content-Type\", \"application/json\")\n+\tw.Write([]byte(\"\\\"OK\\\"\"))\n+}\n+\n+/*\n+\tThe paramter move function (mv)\n+\n+\tYou can find similar things in the PHP version of ArOZ Online Beta. You need to pass in\n+\tr (HTTP Request Object)\n+\tgetParamter (string, aka $_GET['This string])\n+\n+\tWill return\n+\tParamter string (if any)\n+\tError (if error)\n+\n+*/\n+/*\n+func Mv(r *http.Request, getParamter string, postMode bool) (string, error) {\n+\tif postMode == false {\n+\t\t//Access the paramter via GET\n+\t\tkeys, ok := r.URL.Query()[getParamter]\n+\n+\t\tif !ok || len(keys[0]) < 1 {\n+\t\t\t//log.Println(\"Url Param \" + getParamter +\" is missing\")\n+\t\t\treturn \"\", errors.New(\"GET paramter \" + getParamter + \" not found or it is empty\")\n+\t\t}\n+\n+\t\t// Query()[\"key\"] will return an array of items,\n+\t\t// we only want the single item.\n+\t\tkey := keys[0]\n+\t\treturn string(key), nil\n+\t} else {\n+\t\t//Access the parameter via POST\n+\t\tr.ParseForm()\n+\t\tx := r.Form.Get(getParamter)\n+\t\tif len(x) == 0 || x == \"\" {\n+\t\t\treturn \"\", errors.New(\"POST paramter \" + getParamter + \" not found or it is empty\")\n+\t\t}\n+\t\treturn string(x), nil\n+\t}\n+\n+}\n+*/\n+\n+// Get GET parameter\n+func GetPara(r *http.Request, key string) (string, error) {\n+\tkeys, ok := r.URL.Query()[key]\n+\tif !ok || len(keys[0]) < 1 {\n+\t\treturn \"\", errors.New(\"invalid \" + key + \" given\")\n+\t} else {\n+\t\treturn keys[0], nil\n+\t}\n+}\n+\n+// Get POST paramter\n+func PostPara(r *http.Request, key string) (string, error) {\n+\tr.ParseForm()\n+\tx := r.Form.Get(key)\n+\tif x == \"\" {\n+\t\treturn \"\", errors.New(\"invalid \" + key + \" given\")\n+\t} else {\n+\t\treturn x, nil\n+\t}\n+}\n+\n+func FileExists(filename string) bool {\n+\t_, err := os.Stat(filename)\n+\tif os.IsNotExist(err) {\n+\t\treturn false\n+\t}\n+\treturn true\n+}\n+\n+func IsDir(path string) bool {\n+\tif FileExists(path) == false {\n+\t\treturn false\n+\t}\n+\tfi, err := os.Stat(path)\n+\tif err != nil {\n+\t\tlog.Fatal(err)\n+\t\treturn false\n+\t}\n+\tswitch mode := fi.Mode(); {\n+\tcase mode.IsDir():\n+\t\treturn true\n+\tcase mode.IsRegular():\n+\t\treturn false\n+\t}\n+\treturn false\n+}\n+\n+func TimeToString(targetTime time.Time) string {\n+\treturn targetTime.Format(\"2006-01-02 15:04:05\")\n+}\n+\n+func LoadImageAsBase64(filepath string) (string, error) {\n+\tif !FileExists(filepath) {\n+\t\treturn \"\", errors.New(\"File not exists\")\n+\t}\n+\tf, _ := os.Open(filepath)\n+\treader := bufio.NewReader(f)\n+\tcontent, _ := io.ReadAll(reader)\n+\tencoded := base64.StdEncoding.EncodeToString(content)\n+\treturn string(encoded), nil\n+}\n+\n+// Use for redirections\n+func ConstructRelativePathFromRequestURL(requestURI string, redirectionLocation string) string {\n+\tif strings.Count(requestURI, \"/\") == 1 {\n+\t\t//Already root level\n+\t\treturn redirectionLocation\n+\t}\n+\tfor i := 0; i < strings.Count(requestURI, \"/\")-1; i++ {\n+\t\tredirectionLocation = \"../\" + redirectionLocation\n+\t}\n+\n+\treturn redirectionLocation\n+}\n+\n+// Check if given string in a given slice\n+func StringInArray(arr []string, str string) bool {\n+\tfor _, a := range arr {\n+\t\tif a == str {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\treturn false\n+}\n+\n+func StringInArrayIgnoreCase(arr []string, str string) bool {\n+\tsmallArray := []string{}\n+\tfor _, item := range arr {\n+\t\tsmallArray = append(smallArray, strings.ToLower(item))\n+\t}\n+\n+\treturn StringInArray(smallArray, strings.ToLower(str))\n+}"
            },
            {
                "sha": "795dc71548872ba1523517b3edd7c979d5e021d5",
                "filename": "src/mod/wakeonlan/wakeonlan.go",
                "status": "added",
                "additions": 68,
                "deletions": 0,
                "changes": 68,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwakeonlan%2Fwakeonlan.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwakeonlan%2Fwakeonlan.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fwakeonlan%2Fwakeonlan.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,68 @@\n+package wakeonlan\n+\n+import (\n+\t\"errors\"\n+\t\"net\"\n+\t\"time\"\n+)\n+\n+/*\n+\tWake On Lan\n+\tAuthor: tobychui\n+\n+\tThis module send wake on LAN signal to a given MAC address\n+\tand do nothing else\n+*/\n+\n+type magicPacket [102]byte\n+\n+func WakeTarget(macAddr string) error {\n+\tpacket := magicPacket{}\n+\tmac, err := net.ParseMAC(macAddr)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tif len(mac) != 6 {\n+\t\treturn errors.New(\"invalid MAC address\")\n+\t}\n+\n+\t//Initialize the packet with all F\n+\tcopy(packet[0:], []byte{255, 255, 255, 255, 255, 255})\n+\toffset := 6\n+\n+\tfor i := 0; i < 16; i++ {\n+\t\tcopy(packet[offset:], mac)\n+\t\toffset += 6\n+\t}\n+\n+\t//Most devices listen to either port 7 or 9, send to both of them\n+\terr = sendPacket(\"255.255.255.255:7\", packet)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\ttime.Sleep(30 * time.Millisecond)\n+\n+\terr = sendPacket(\"255.255.255.255:9\", packet)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\treturn nil\n+}\n+\n+func sendPacket(addr string, packet magicPacket) error {\n+\tconn, err := net.Dial(\"udp\", addr)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tdefer conn.Close()\n+\n+\t_, err = conn.Write(packet[:])\n+\treturn err\n+}\n+\n+func IsValidMacAddress(macaddr string) bool {\n+\t_, err := net.ParseMAC(macaddr)\n+\treturn err == nil\n+}"
            },
            {
                "sha": "f0a2a7c7f209ed8ae971e81b9b20096eedc14355",
                "filename": "src/mod/websocketproxy/LICENSE.md",
                "status": "added",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwebsocketproxy%2FLICENSE.md",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwebsocketproxy%2FLICENSE.md",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fwebsocketproxy%2FLICENSE.md?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,20 @@\n+The MIT License (MIT)\n+\n+Copyright (c) 2014 Koding, Inc.\n+\n+Permission is hereby granted, free of charge, to any person obtaining a copy of\n+this software and associated documentation files (the \"Software\"), to deal in\n+the Software without restriction, including without limitation the rights to\n+use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n+the Software, and to permit persons to whom the Software is furnished to do so,\n+subject to the following conditions:\n+\n+The above copyright notice and this permission notice shall be included in all\n+copies or substantial portions of the Software.\n+\n+THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n+FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n+COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n+IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n+CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE."
            },
            {
                "sha": "526bb43f86c3e45752c34c2d409dc514e8b7304d",
                "filename": "src/mod/websocketproxy/README.md",
                "status": "added",
                "additions": 54,
                "deletions": 0,
                "changes": 54,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwebsocketproxy%2FREADME.md",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwebsocketproxy%2FREADME.md",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fwebsocketproxy%2FREADME.md?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,54 @@\n+# WebsocketProxy [![GoDoc](https://godoc.org/github.com/koding/websocketproxy?status.svg)](https://godoc.org/github.com/koding/websocketproxy) [![Build Status](https://travis-ci.org/koding/websocketproxy.svg)](https://travis-ci.org/koding/websocketproxy)\n+\n+WebsocketProxy is an http.Handler interface build on top of\n+[gorilla/websocket](https://github.com/gorilla/websocket) that you can plug\n+into your existing Go webserver to provide WebSocket reverse proxy.\n+\n+## Install\n+\n+```bash\n+go get github.com/koding/websocketproxy\n+```\n+\n+## Example\n+\n+Below is a simple server that proxies to the given backend URL\n+\n+```go\n+package main\n+\n+import (\n+\t\"flag\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\n+\t\"github.com/koding/websocketproxy\"\n+)\n+\n+var (\n+\tflagBackend = flag.String(\"backend\", \"\", \"Backend URL for proxying\")\n+)\n+\n+func main() {\n+\tu, err := url.Parse(*flagBackend)\n+\tif err != nil {\n+\t\tlog.Fatalln(err)\n+\t}\n+\n+\terr = http.ListenAndServe(\":80\", websocketproxy.NewProxy(u))\n+\tif err != nil {\n+\t\tlog.Fatalln(err)\n+\t}\n+}\n+```\n+\n+Save it as `proxy.go` and run as:\n+\n+```bash\n+go run proxy.go -backend ws://example.com:3000\n+```\n+\n+Now all incoming WebSocket requests coming to this server will be proxied to\n+`ws://example.com:3000`\n+\n+"
            },
            {
                "sha": "18c18591827fb5974a45b5761b476b1fe52b164b",
                "filename": "src/mod/websocketproxy/websocketproxy.go",
                "status": "added",
                "additions": 239,
                "deletions": 0,
                "changes": 239,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwebsocketproxy%2Fwebsocketproxy.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwebsocketproxy%2Fwebsocketproxy.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fwebsocketproxy%2Fwebsocketproxy.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,239 @@\n+// Package websocketproxy is a reverse proxy for WebSocket connections.\n+package websocketproxy\n+\n+import (\n+\t\"fmt\"\n+\t\"io\"\n+\t\"log\"\n+\t\"net\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\t\"strings\"\n+\n+\t\"github.com/gorilla/websocket\"\n+)\n+\n+var (\n+\t// DefaultUpgrader specifies the parameters for upgrading an HTTP\n+\t// connection to a WebSocket connection.\n+\tDefaultUpgrader = &websocket.Upgrader{\n+\t\tReadBufferSize:  1024,\n+\t\tWriteBufferSize: 1024,\n+\t}\n+\n+\t// DefaultDialer is a dialer with all fields set to the default zero values.\n+\tDefaultDialer = websocket.DefaultDialer\n+)\n+\n+// WebsocketProxy is an HTTP Handler that takes an incoming WebSocket\n+// connection and proxies it to another server.\n+type WebsocketProxy struct {\n+\t// Director, if non-nil, is a function that may copy additional request\n+\t// headers from the incoming WebSocket connection into the output headers\n+\t// which will be forwarded to another server.\n+\tDirector func(incoming *http.Request, out http.Header)\n+\n+\t// Backend returns the backend URL which the proxy uses to reverse proxy\n+\t// the incoming WebSocket connection. Request is the initial incoming and\n+\t// unmodified request.\n+\tBackend func(*http.Request) *url.URL\n+\n+\t// Upgrader specifies the parameters for upgrading a incoming HTTP\n+\t// connection to a WebSocket connection. If nil, DefaultUpgrader is used.\n+\tUpgrader *websocket.Upgrader\n+\n+\t//  Dialer contains options for connecting to the backend WebSocket server.\n+\t//  If nil, DefaultDialer is used.\n+\tDialer *websocket.Dialer\n+\n+\tVerbal bool\n+}\n+\n+// ProxyHandler returns a new http.Handler interface that reverse proxies the\n+// request to the given target.\n+func ProxyHandler(target *url.URL) http.Handler { return NewProxy(target) }\n+\n+// NewProxy returns a new Websocket reverse proxy that rewrites the\n+// URL's to the scheme, host and base path provider in target.\n+func NewProxy(target *url.URL) *WebsocketProxy {\n+\tbackend := func(r *http.Request) *url.URL {\n+\t\t// Shallow copy\n+\t\tu := *target\n+\t\tu.Fragment = r.URL.Fragment\n+\t\tu.Path = r.URL.Path\n+\t\tu.RawQuery = r.URL.RawQuery\n+\t\treturn &u\n+\t}\n+\treturn &WebsocketProxy{Backend: backend, Verbal: false}\n+}\n+\n+// ServeHTTP implements the http.Handler that proxies WebSocket connections.\n+func (w *WebsocketProxy) ServeHTTP(rw http.ResponseWriter, req *http.Request) {\n+\tif w.Backend == nil {\n+\t\tlog.Println(\"websocketproxy: backend function is not defined\")\n+\t\thttp.Error(rw, \"internal server error (code: 1)\", http.StatusInternalServerError)\n+\t\treturn\n+\t}\n+\n+\tbackendURL := w.Backend(req)\n+\tif backendURL == nil {\n+\t\tlog.Println(\"websocketproxy: backend URL is nil\")\n+\t\thttp.Error(rw, \"internal server error (code: 2)\", http.StatusInternalServerError)\n+\t\treturn\n+\t}\n+\n+\tdialer := w.Dialer\n+\tif w.Dialer == nil {\n+\t\tdialer = DefaultDialer\n+\t}\n+\n+\t// Pass headers from the incoming request to the dialer to forward them to\n+\t// the final destinations.\n+\trequestHeader := http.Header{}\n+\tif origin := req.Header.Get(\"Origin\"); origin != \"\" {\n+\t\trequestHeader.Add(\"Origin\", origin)\n+\t}\n+\tfor _, prot := range req.Header[http.CanonicalHeaderKey(\"Sec-WebSocket-Protocol\")] {\n+\t\trequestHeader.Add(\"Sec-WebSocket-Protocol\", prot)\n+\t}\n+\tfor _, cookie := range req.Header[http.CanonicalHeaderKey(\"Cookie\")] {\n+\t\trequestHeader.Add(\"Cookie\", cookie)\n+\t}\n+\tif req.Host != \"\" {\n+\t\trequestHeader.Set(\"Host\", req.Host)\n+\t}\n+\n+\t// Pass X-Forwarded-For headers too, code below is a part of\n+\t// httputil.ReverseProxy. See http://en.wikipedia.org/wiki/X-Forwarded-For\n+\t// for more information\n+\t// TODO: use RFC7239 http://tools.ietf.org/html/rfc7239\n+\tif clientIP, _, err := net.SplitHostPort(req.RemoteAddr); err == nil {\n+\t\t// If we aren't the first proxy retain prior\n+\t\t// X-Forwarded-For information as a comma+space\n+\t\t// separated list and fold multiple headers into one.\n+\t\tif prior, ok := req.Header[\"X-Forwarded-For\"]; ok {\n+\t\t\tclientIP = strings.Join(prior, \", \") + \", \" + clientIP\n+\t\t}\n+\t\trequestHeader.Set(\"X-Forwarded-For\", clientIP)\n+\t}\n+\n+\t// Set the originating protocol of the incoming HTTP request. The SSL might\n+\t// be terminated on our site and because we doing proxy adding this would\n+\t// be helpful for applications on the backend.\n+\trequestHeader.Set(\"X-Forwarded-Proto\", \"http\")\n+\tif req.TLS != nil {\n+\t\trequestHeader.Set(\"X-Forwarded-Proto\", \"https\")\n+\t}\n+\n+\t// Enable the director to copy any additional headers it desires for\n+\t// forwarding to the remote server.\n+\tif w.Director != nil {\n+\t\tw.Director(req, requestHeader)\n+\t}\n+\n+\t// Connect to the backend URL, also pass the headers we get from the requst\n+\t// together with the Forwarded headers we prepared above.\n+\t// TODO: support multiplexing on the same backend connection instead of\n+\t// opening a new TCP connection time for each request. This should be\n+\t// optional:\n+\t// http://tools.ietf.org/html/draft-ietf-hybi-websocket-multiplexing-01\n+\tconnBackend, resp, err := dialer.Dial(backendURL.String(), requestHeader)\n+\tif err != nil {\n+\t\tlog.Printf(\"websocketproxy: couldn't dial to remote backend url %s\", err)\n+\t\tif resp != nil {\n+\t\t\t// If the WebSocket handshake fails, ErrBadHandshake is returned\n+\t\t\t// along with a non-nil *http.Response so that callers can handle\n+\t\t\t// redirects, authentication, etcetera.\n+\t\t\tif err := copyResponse(rw, resp); err != nil {\n+\t\t\t\tlog.Printf(\"websocketproxy: couldn't write response after failed remote backend handshake: %s\", err)\n+\t\t\t}\n+\t\t} else {\n+\t\t\thttp.Error(rw, http.StatusText(http.StatusServiceUnavailable), http.StatusServiceUnavailable)\n+\t\t}\n+\t\treturn\n+\t}\n+\tdefer connBackend.Close()\n+\n+\tupgrader := w.Upgrader\n+\tif w.Upgrader == nil {\n+\t\tupgrader = DefaultUpgrader\n+\t}\n+\n+\t// Only pass those headers to the upgrader.\n+\tupgradeHeader := http.Header{}\n+\tif hdr := resp.Header.Get(\"Sec-Websocket-Protocol\"); hdr != \"\" {\n+\t\tupgradeHeader.Set(\"Sec-Websocket-Protocol\", hdr)\n+\t}\n+\tif hdr := resp.Header.Get(\"Set-Cookie\"); hdr != \"\" {\n+\t\tupgradeHeader.Set(\"Set-Cookie\", hdr)\n+\t}\n+\n+\t// Now upgrade the existing incoming request to a WebSocket connection.\n+\t// Also pass the header that we gathered from the Dial handshake.\n+\tconnPub, err := upgrader.Upgrade(rw, req, upgradeHeader)\n+\tif err != nil {\n+\t\tlog.Printf(\"websocketproxy: couldn't upgrade %s\", err)\n+\t\treturn\n+\t}\n+\tdefer connPub.Close()\n+\n+\terrClient := make(chan error, 1)\n+\terrBackend := make(chan error, 1)\n+\treplicateWebsocketConn := func(dst, src *websocket.Conn, errc chan error) {\n+\t\tfor {\n+\t\t\tmsgType, msg, err := src.ReadMessage()\n+\t\t\tif err != nil {\n+\t\t\t\tm := websocket.FormatCloseMessage(websocket.CloseNormalClosure, fmt.Sprintf(\"%v\", err))\n+\t\t\t\tif e, ok := err.(*websocket.CloseError); ok {\n+\t\t\t\t\tif e.Code != websocket.CloseNoStatusReceived {\n+\t\t\t\t\t\tm = websocket.FormatCloseMessage(e.Code, e.Text)\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\terrc <- err\n+\t\t\t\tdst.WriteMessage(websocket.CloseMessage, m)\n+\t\t\t\tbreak\n+\t\t\t}\n+\t\t\terr = dst.WriteMessage(msgType, msg)\n+\t\t\tif err != nil {\n+\t\t\t\terrc <- err\n+\t\t\t\tbreak\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tgo replicateWebsocketConn(connPub, connBackend, errClient)\n+\tgo replicateWebsocketConn(connBackend, connPub, errBackend)\n+\n+\tvar message string\n+\tselect {\n+\tcase err = <-errClient:\n+\t\tmessage = \"websocketproxy: Error when copying from backend to client: %v\"\n+\tcase err = <-errBackend:\n+\t\tmessage = \"websocketproxy: Error when copying from client to backend: %v\"\n+\n+\t}\n+\tif e, ok := err.(*websocket.CloseError); !ok || e.Code == websocket.CloseAbnormalClosure {\n+\t\tif w.Verbal {\n+\t\t\t//Only print message on verbal mode\n+\t\t\tlog.Printf(message, err)\n+\t\t}\n+\n+\t}\n+}\n+\n+func copyHeader(dst, src http.Header) {\n+\tfor k, vv := range src {\n+\t\tfor _, v := range vv {\n+\t\t\tdst.Add(k, v)\n+\t\t}\n+\t}\n+}\n+\n+func copyResponse(rw http.ResponseWriter, resp *http.Response) error {\n+\tcopyHeader(rw.Header(), resp.Header)\n+\trw.WriteHeader(resp.StatusCode)\n+\tdefer resp.Body.Close()\n+\n+\t_, err := io.Copy(rw, resp.Body)\n+\treturn err\n+}"
            },
            {
                "sha": "b90e02b93c7281b78015b24a8ddc975c25372c29",
                "filename": "src/mod/websocketproxy/websocketproxy_test.go",
                "status": "added",
                "additions": 130,
                "deletions": 0,
                "changes": 130,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwebsocketproxy%2Fwebsocketproxy_test.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fmod%2Fwebsocketproxy%2Fwebsocketproxy_test.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fmod%2Fwebsocketproxy%2Fwebsocketproxy_test.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,130 @@\n+package websocketproxy\n+\n+import (\n+\t\"log\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\t\"testing\"\n+\t\"time\"\n+\n+\t\"github.com/gorilla/websocket\"\n+)\n+\n+var (\n+\tserverURL  = \"ws://127.0.0.1:7777\"\n+\tbackendURL = \"ws://127.0.0.1:8888\"\n+)\n+\n+func TestProxy(t *testing.T) {\n+\t// websocket proxy\n+\tsupportedSubProtocols := []string{\"test-protocol\"}\n+\tupgrader := &websocket.Upgrader{\n+\t\tReadBufferSize:  4096,\n+\t\tWriteBufferSize: 4096,\n+\t\tCheckOrigin: func(r *http.Request) bool {\n+\t\t\treturn true\n+\t\t},\n+\t\tSubprotocols: supportedSubProtocols,\n+\t}\n+\n+\tu, _ := url.Parse(backendURL)\n+\tproxy := NewProxy(u)\n+\tproxy.Upgrader = upgrader\n+\n+\tmux := http.NewServeMux()\n+\tmux.Handle(\"/proxy\", proxy)\n+\tgo func() {\n+\t\tif err := http.ListenAndServe(\":7777\", mux); err != nil {\n+\t\t\tt.Fatal(\"ListenAndServe: \", err)\n+\t\t}\n+\t}()\n+\n+\ttime.Sleep(time.Millisecond * 100)\n+\n+\t// backend echo server\n+\tgo func() {\n+\t\tmux2 := http.NewServeMux()\n+\t\tmux2.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n+\t\t\t// Don't upgrade if original host header isn't preserved\n+\t\t\tif r.Host !=  \"127.0.0.1:7777\" {\n+\t\t\t\tlog.Printf(\"Host header set incorrectly.  Expecting 127.0.0.1:7777 got %s\", r.Host)\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\tconn, err := upgrader.Upgrade(w, r, nil)\n+\t\t\tif err != nil {\n+\t\t\t\tlog.Println(err)\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\tmessageType, p, err := conn.ReadMessage()\n+\t\t\tif err != nil {\n+\t\t\t\treturn\n+\t\t\t}\n+\n+\t\t\tif err = conn.WriteMessage(messageType, p); err != nil {\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t})\n+\n+\t\terr := http.ListenAndServe(\":8888\", mux2)\n+\t\tif err != nil {\n+\t\t\tt.Fatal(\"ListenAndServe: \", err)\n+\t\t}\n+\t}()\n+\n+\ttime.Sleep(time.Millisecond * 100)\n+\n+\t// let's us define two subprotocols, only one is supported by the server\n+\tclientSubProtocols := []string{\"test-protocol\", \"test-notsupported\"}\n+\th := http.Header{}\n+\tfor _, subprot := range clientSubProtocols {\n+\t\th.Add(\"Sec-WebSocket-Protocol\", subprot)\n+\t}\n+\n+\t// frontend server, dial now our proxy, which will reverse proxy our\n+\t// message to the backend websocket server.\n+\tconn, resp, err := websocket.DefaultDialer.Dial(serverURL+\"/proxy\", h)\n+\tif err != nil {\n+\t\tt.Fatal(err)\n+\t}\n+\n+\t// check if the server really accepted only the first one\n+\tin := func(desired string) bool {\n+\t\tfor _, prot := range resp.Header[http.CanonicalHeaderKey(\"Sec-WebSocket-Protocol\")] {\n+\t\t\tif desired == prot {\n+\t\t\t\treturn true\n+\t\t\t}\n+\t\t}\n+\t\treturn false\n+\t}\n+\n+\tif !in(\"test-protocol\") {\n+\t\tt.Error(\"test-protocol should be available\")\n+\t}\n+\n+\tif in(\"test-notsupported\") {\n+\t\tt.Error(\"test-notsupported should be not recevied from the server.\")\n+\t}\n+\n+\t// now write a message and send it to the backend server (which goes trough\n+\t// proxy..)\n+\tmsg := \"hello kite\"\n+\terr = conn.WriteMessage(websocket.TextMessage, []byte(msg))\n+\tif err != nil {\n+\t\tt.Error(err)\n+\t}\n+\n+\tmessageType, p, err := conn.ReadMessage()\n+\tif err != nil {\n+\t\tt.Error(err)\n+\t}\n+\n+\tif messageType != websocket.TextMessage {\n+\t\tt.Error(\"incoming message type is not Text\")\n+\t}\n+\n+\tif msg != string(p) {\n+\t\tt.Errorf(\"expecting: %s, got: %s\", msg, string(p))\n+\t}\n+}"
            },
            {
                "sha": "e8b7222b262a54e64ff2d0d0fadfe5d6619e9604",
                "filename": "src/redirect.go",
                "status": "added",
                "additions": 75,
                "deletions": 0,
                "changes": 75,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fredirect.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fredirect.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fredirect.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,75 @@\n+package main\n+\n+import (\n+\t\"encoding/json\"\n+\t\"net/http\"\n+\t\"strconv\"\n+\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+/*\n+\tRedirect.go\n+\n+\tThis script handle all the http handlers\n+\trelated to redirection function in the reverse proxy\n+*/\n+\n+func handleListRedirectionRules(w http.ResponseWriter, r *http.Request) {\n+\trules := redirectTable.GetAllRedirectRules()\n+\tjs, _ := json.Marshal(rules)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func handleAddRedirectionRule(w http.ResponseWriter, r *http.Request) {\n+\tredirectUrl, err := utils.PostPara(r, \"redirectUrl\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"redirect url cannot be empty\")\n+\t\treturn\n+\t}\n+\tdestUrl, err := utils.PostPara(r, \"destUrl\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"destination url cannot be empty\")\n+\t}\n+\n+\tforwardChildpath, err := utils.PostPara(r, \"forwardChildpath\")\n+\tif err != nil {\n+\t\t//Assume true\n+\t\tforwardChildpath = \"true\"\n+\t}\n+\n+\tredirectTypeString, err := utils.PostPara(r, \"redirectType\")\n+\tif err != nil {\n+\t\tredirectTypeString = \"307\"\n+\t}\n+\n+\tredirectionStatusCode, err := strconv.Atoi(redirectTypeString)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid status code number\")\n+\t\treturn\n+\t}\n+\n+\terr = redirectTable.AddRedirectRule(redirectUrl, destUrl, forwardChildpath == \"true\", redirectionStatusCode)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tutils.SendOK(w)\n+}\n+\n+func handleDeleteRedirectionRule(w http.ResponseWriter, r *http.Request) {\n+\tredirectUrl, err := utils.PostPara(r, \"redirectUrl\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"redirect url cannot be empty\")\n+\t\treturn\n+\t}\n+\n+\terr = redirectTable.DeleteRedirectRule(redirectUrl)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\tutils.SendOK(w)\n+}"
            },
            {
                "sha": "9863de5b923b9ea3f0a62ae7202f090cbf9f87de",
                "filename": "src/reverseproxy.go",
                "status": "added",
                "additions": 350,
                "deletions": 0,
                "changes": 350,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Freverseproxy.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Freverseproxy.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Freverseproxy.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,350 @@\n+package main\n+\n+import (\n+\t\"encoding/json\"\n+\t\"log\"\n+\t\"net/http\"\n+\t\"path/filepath\"\n+\t\"sort\"\n+\t\"strconv\"\n+\t\"strings\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/dynamicproxy\"\n+\t\"imuslab.com/zoraxy/mod/uptime\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+var (\n+\tdynamicProxyRouter *dynamicproxy.Router\n+)\n+\n+// Add user customizable reverse proxy\n+func ReverseProxtInit() {\n+\tinboundPort := 80\n+\tif sysdb.KeyExists(\"settings\", \"inbound\") {\n+\t\tsysdb.Read(\"settings\", \"inbound\", &inboundPort)\n+\t\tlog.Println(\"Serving inbound port \", inboundPort)\n+\t} else {\n+\t\tlog.Println(\"Inbound port not set. Using default (80)\")\n+\t}\n+\n+\tuseTls := false\n+\tsysdb.Read(\"settings\", \"usetls\", &useTls)\n+\tif useTls {\n+\t\tlog.Println(\"TLS mode enabled. Serving proxxy request with TLS\")\n+\t} else {\n+\t\tlog.Println(\"TLS mode disabled. Serving proxy request with plain http\")\n+\t}\n+\n+\tforceHttpsRedirect := false\n+\tsysdb.Read(\"settings\", \"redirect\", &forceHttpsRedirect)\n+\tif forceHttpsRedirect {\n+\t\tlog.Println(\"Force HTTPS mode enabled\")\n+\t} else {\n+\t\tlog.Println(\"Force HTTPS mode disabled\")\n+\t}\n+\n+\tdprouter, err := dynamicproxy.NewDynamicProxy(dynamicproxy.RouterOption{\n+\t\tPort:               inboundPort,\n+\t\tUseTls:             useTls,\n+\t\tForceHttpsRedirect: forceHttpsRedirect,\n+\t\tTlsManager:         tlsCertManager,\n+\t\tRedirectRuleTable:  redirectTable,\n+\t\tGeodbStore:         geodbStore,\n+\t\tStatisticCollector: statisticCollector,\n+\t})\n+\tif err != nil {\n+\t\tlog.Println(err.Error())\n+\t\treturn\n+\t}\n+\n+\tdynamicProxyRouter = dprouter\n+\n+\t//Load all conf from files\n+\tconfs, _ := filepath.Glob(\"./conf/*.config\")\n+\tfor _, conf := range confs {\n+\t\trecord, err := LoadReverseProxyConfig(conf)\n+\t\tif err != nil {\n+\t\t\tlog.Println(\"Failed to load \"+filepath.Base(conf), err.Error())\n+\t\t\treturn\n+\t\t}\n+\n+\t\tif record.ProxyType == \"root\" {\n+\t\t\tdynamicProxyRouter.SetRootProxy(record.ProxyTarget, record.UseTLS)\n+\t\t} else if record.ProxyType == \"subd\" {\n+\t\t\tdynamicProxyRouter.AddSubdomainRoutingService(record.Rootname, record.ProxyTarget, record.UseTLS)\n+\t\t} else if record.ProxyType == \"vdir\" {\n+\t\t\tdynamicProxyRouter.AddVirtualDirectoryProxyService(record.Rootname, record.ProxyTarget, record.UseTLS)\n+\t\t} else {\n+\t\t\tlog.Println(\"Unsupported endpoint type: \" + record.ProxyType + \". Skipping \" + filepath.Base(conf))\n+\t\t}\n+\t}\n+\n+\t/*\n+\t\tdynamicProxyRouter.SetRootProxy(\"192.168.0.107:8080\", false)\n+\t\tdynamicProxyRouter.AddSubdomainRoutingService(\"aroz.localhost\", \"192.168.0.107:8080/private/AOB/\", false)\n+\t\tdynamicProxyRouter.AddSubdomainRoutingService(\"loopback.localhost\", \"localhost:8080\", false)\n+\t\tdynamicProxyRouter.AddSubdomainRoutingService(\"git.localhost\", \"mc.alanyeung.co:3000\", false)\n+\t\tdynamicProxyRouter.AddVirtualDirectoryProxyService(\"/git/server/\", \"mc.alanyeung.co:3000\", false)\n+\t*/\n+\n+\t//Start Service\n+\t//Not sure why but delay must be added if you have another\n+\t//reverse proxy server in front of this service\n+\ttime.Sleep(300 * time.Millisecond)\n+\tdynamicProxyRouter.StartProxyService()\n+\tlog.Println(\"Dynamic Reverse Proxy service started\")\n+\n+\t//Add all proxy services to uptime monitor\n+\t//Create a uptime monitor service\n+\tgo func() {\n+\t\t//This must be done in go routine to prevent blocking on system startup\n+\t\tuptimeMonitor, _ = uptime.NewUptimeMonitor(&uptime.Config{\n+\t\t\tTargets:         GetUptimeTargetsFromReverseProxyRules(dynamicProxyRouter),\n+\t\t\tInterval:        300, //5 minutes\n+\t\t\tMaxRecordsStore: 288, //1 day\n+\t\t})\n+\t\tlog.Println(\"Uptime Monitor background service started\")\n+\t}()\n+\n+}\n+\n+func ReverseProxyHandleOnOff(w http.ResponseWriter, r *http.Request) {\n+\n+\tenable, _ := utils.PostPara(r, \"enable\") //Support root, vdir and subd\n+\tif enable == \"true\" {\n+\t\terr := dynamicProxyRouter.StartProxyService()\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\t} else {\n+\t\t//Check if it is loopback\n+\t\tif dynamicProxyRouter.IsProxiedSubdomain(r) {\n+\t\t\t//Loopback routing. Turning it off will make the user lost control\n+\t\t\t//of the whole system. Do not allow shutdown\n+\t\t\tutils.SendErrorResponse(w, \"Unable to shutdown in loopback rp mode. Remove proxy rules for management interface and retry.\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\terr := dynamicProxyRouter.StopProxyService()\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\t}\n+\n+\tutils.SendOK(w)\n+}\n+\n+func ReverseProxyHandleAddEndpoint(w http.ResponseWriter, r *http.Request) {\n+\teptype, err := utils.PostPara(r, \"type\") //Support root, vdir and subd\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"type not defined\")\n+\t\treturn\n+\t}\n+\n+\tendpoint, err := utils.PostPara(r, \"ep\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"endpoint not defined\")\n+\t\treturn\n+\t}\n+\n+\ttls, _ := utils.PostPara(r, \"tls\")\n+\tif tls == \"\" {\n+\t\ttls = \"false\"\n+\t}\n+\n+\tuseTLS := (tls == \"true\")\n+\trootname := \"\"\n+\tif eptype == \"vdir\" {\n+\t\tvdir, err := utils.PostPara(r, \"rootname\")\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"vdir not defined\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\t//Vdir must start with /\n+\t\tif !strings.HasPrefix(vdir, \"/\") {\n+\t\t\tvdir = \"/\" + vdir\n+\t\t}\n+\t\trootname = vdir\n+\t\tdynamicProxyRouter.AddVirtualDirectoryProxyService(vdir, endpoint, useTLS)\n+\n+\t} else if eptype == \"subd\" {\n+\t\tsubdomain, err := utils.PostPara(r, \"rootname\")\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"subdomain not defined\")\n+\t\t\treturn\n+\t\t}\n+\t\trootname = subdomain\n+\t\tdynamicProxyRouter.AddSubdomainRoutingService(subdomain, endpoint, useTLS)\n+\t} else if eptype == \"root\" {\n+\t\trootname = \"root\"\n+\t\tdynamicProxyRouter.SetRootProxy(endpoint, useTLS)\n+\t} else {\n+\t\t//Invalid eptype\n+\t\tutils.SendErrorResponse(w, \"Invalid endpoint type\")\n+\t\treturn\n+\t}\n+\n+\t//Save it\n+\tSaveReverseProxyConfig(eptype, rootname, endpoint, useTLS)\n+\n+\t//Update utm if exists\n+\tif uptimeMonitor != nil {\n+\t\tuptimeMonitor.Config.Targets = GetUptimeTargetsFromReverseProxyRules(dynamicProxyRouter)\n+\t\tuptimeMonitor.CleanRecords()\n+\t}\n+\n+\tutils.SendOK(w)\n+\n+}\n+\n+func DeleteProxyEndpoint(w http.ResponseWriter, r *http.Request) {\n+\tep, err := utils.GetPara(r, \"ep\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Invalid ep given\")\n+\t}\n+\n+\tptype, err := utils.PostPara(r, \"ptype\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"Invalid ptype given\")\n+\t}\n+\n+\terr = dynamicProxyRouter.RemoveProxy(ptype, ep)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t}\n+\n+\tRemoveReverseProxyConfig(ep)\n+\n+\t//Update utm if exists\n+\tif uptimeMonitor != nil {\n+\t\tuptimeMonitor.Config.Targets = GetUptimeTargetsFromReverseProxyRules(dynamicProxyRouter)\n+\t\tuptimeMonitor.CleanRecords()\n+\t}\n+\n+\tutils.SendOK(w)\n+}\n+\n+func ReverseProxyStatus(w http.ResponseWriter, r *http.Request) {\n+\tjs, _ := json.Marshal(dynamicProxyRouter)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func ReverseProxyList(w http.ResponseWriter, r *http.Request) {\n+\teptype, err := utils.PostPara(r, \"type\") //Support root, vdir and subd\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"type not defined\")\n+\t\treturn\n+\t}\n+\n+\tif eptype == \"vdir\" {\n+\t\tresults := []*dynamicproxy.ProxyEndpoint{}\n+\t\tdynamicProxyRouter.ProxyEndpoints.Range(func(key, value interface{}) bool {\n+\t\t\tresults = append(results, value.(*dynamicproxy.ProxyEndpoint))\n+\t\t\treturn true\n+\t\t})\n+\n+\t\tsort.Slice(results, func(i, j int) bool {\n+\t\t\treturn results[i].Domain < results[j].Domain\n+\t\t})\n+\n+\t\tjs, _ := json.Marshal(results)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else if eptype == \"subd\" {\n+\t\tresults := []*dynamicproxy.SubdomainEndpoint{}\n+\t\tdynamicProxyRouter.SubdomainEndpoint.Range(func(key, value interface{}) bool {\n+\t\t\tresults = append(results, value.(*dynamicproxy.SubdomainEndpoint))\n+\t\t\treturn true\n+\t\t})\n+\n+\t\tsort.Slice(results, func(i, j int) bool {\n+\t\t\treturn results[i].MatchingDomain < results[j].MatchingDomain\n+\t\t})\n+\n+\t\tjs, _ := json.Marshal(results)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else if eptype == \"root\" {\n+\t\tjs, _ := json.Marshal(dynamicProxyRouter.Root)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\tutils.SendErrorResponse(w, \"Invalid type given\")\n+\t}\n+}\n+\n+// Handle https redirect\n+func HandleUpdateHttpsRedirect(w http.ResponseWriter, r *http.Request) {\n+\tuseRedirect, err := utils.GetPara(r, \"set\")\n+\tif err != nil {\n+\t\tcurrentRedirectToHttps := false\n+\t\t//Load the current status\n+\t\terr = sysdb.Read(\"settings\", \"redirect\", &currentRedirectToHttps)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\t\tjs, _ := json.Marshal(currentRedirectToHttps)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\tif useRedirect == \"true\" {\n+\t\t\tsysdb.Write(\"settings\", \"redirect\", true)\n+\t\t\tlog.Println(\"Updating force HTTPS redirection to true\")\n+\t\t\tdynamicProxyRouter.UpdateHttpToHttpsRedirectSetting(true)\n+\t\t} else if useRedirect == \"false\" {\n+\t\t\tsysdb.Write(\"settings\", \"redirect\", false)\n+\t\t\tlog.Println(\"Updating force HTTPS redirection to false\")\n+\t\t\tdynamicProxyRouter.UpdateHttpToHttpsRedirectSetting(false)\n+\t\t}\n+\n+\t\tutils.SendOK(w)\n+\t}\n+}\n+\n+// Handle checking if the current user is accessing via the reverse proxied interface\n+// Of the management interface.\n+func HandleManagementProxyCheck(w http.ResponseWriter, r *http.Request) {\n+\tisProxied := dynamicProxyRouter.IsProxiedSubdomain(r)\n+\tjs, _ := json.Marshal(isProxied)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+// Handle incoming port set. Change the current proxy incoming port\n+func HandleIncomingPortSet(w http.ResponseWriter, r *http.Request) {\n+\tnewIncomingPort, err := utils.PostPara(r, \"incoming\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid incoming port given\")\n+\t\treturn\n+\t}\n+\n+\tnewIncomingPortInt, err := strconv.Atoi(newIncomingPort)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid incoming port given\")\n+\t\treturn\n+\t}\n+\n+\t//Check if it is identical as proxy root (recursion!)\n+\tproxyRoot := strings.TrimSuffix(dynamicProxyRouter.Root.Domain, \"/\")\n+\tif strings.HasPrefix(proxyRoot, \"localhost:\"+strconv.Itoa(newIncomingPortInt)) || strings.HasPrefix(proxyRoot, \"127.0.0.1:\"+strconv.Itoa(newIncomingPortInt)) {\n+\t\t//Listening port is same as proxy root\n+\t\t//Not allow recursive settings\n+\t\tutils.SendErrorResponse(w, \"Recursive listening port! Check your proxy root settings.\")\n+\t\treturn\n+\t}\n+\n+\t//Stop and change the setting of the reverse proxy service\n+\tif dynamicProxyRouter.Running {\n+\t\tdynamicProxyRouter.StopProxyService()\n+\t\tdynamicProxyRouter.Option.Port = newIncomingPortInt\n+\t\tdynamicProxyRouter.StartProxyService()\n+\t} else {\n+\t\t//Only change setting but not starting the proxy service\n+\t\tdynamicProxyRouter.Option.Port = newIncomingPortInt\n+\t}\n+\n+\tsysdb.Write(\"settings\", \"inbound\", newIncomingPortInt)\n+\n+\tutils.SendOK(w)\n+}"
            },
            {
                "sha": "d02befcbd2ad6775f4e7d277d5d8af2b4362b2a0",
                "filename": "src/router.go",
                "status": "added",
                "additions": 88,
                "deletions": 0,
                "changes": 88,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Frouter.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Frouter.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Frouter.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,88 @@\n+package main\n+\n+import (\n+\t\"fmt\"\n+\t\"net/http\"\n+\t\"net/url\"\n+\t\"path/filepath\"\n+\t\"strings\"\n+\n+\t\"imuslab.com/zoraxy/mod/sshprox\"\n+)\n+\n+/*\n+\trouter.go\n+\n+\tThis script holds the static resources router\n+\tfor the reverse proxy service\n+*/\n+\n+func FSHandler(handler http.Handler) http.Handler {\n+\treturn http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n+\t\t/*\n+\t\t\tDevelopment Mode Override\n+\t\t\t=> Web root is located in /\n+\t\t*/\n+\t\tif development && strings.HasPrefix(r.URL.Path, \"/web/\") {\n+\t\t\tu, _ := url.Parse(strings.TrimPrefix(r.URL.Path, \"/web\"))\n+\t\t\tr.URL = u\n+\t\t}\n+\n+\t\t/*\n+\t\t\tProduction Mode Override\n+\t\t\t=> Web root is located in /web\n+\t\t*/\n+\t\tif !development && r.URL.Path == \"/\" {\n+\t\t\t//Redirect to web UI\n+\t\t\thttp.Redirect(w, r, \"/web/\", http.StatusTemporaryRedirect)\n+\t\t\treturn\n+\t\t}\n+\n+\t\t// Allow access to /script/*, /img/pubic/* and /login.html without authentication\n+\t\tif strings.HasPrefix(r.URL.Path, ppf(\"/script/\")) || strings.HasPrefix(r.URL.Path, ppf(\"/img/public/\")) || r.URL.Path == ppf(\"/login.html\") || r.URL.Path == ppf(\"/reset.html\") || r.URL.Path == ppf(\"/favicon.png\") {\n+\t\t\thandler.ServeHTTP(w, r)\n+\t\t\treturn\n+\t\t}\n+\n+\t\t// check authentication\n+\t\tif !authAgent.CheckAuth(r) && requireAuth {\n+\t\t\thttp.Redirect(w, r, ppf(\"/login.html\"), http.StatusTemporaryRedirect)\n+\t\t\treturn\n+\t\t}\n+\n+\t\t//For WebSSH Routing\n+\t\t//Example URL Path: /web.ssh/{{instance_uuid}}/*\n+\t\tif strings.HasPrefix(r.URL.Path, \"/web.ssh/\") {\n+\t\t\trequestPath := r.URL.Path\n+\t\t\tparts := strings.Split(requestPath, \"/\")\n+\t\t\tif !strings.HasSuffix(requestPath, \"/\") && len(parts) == 3 {\n+\t\t\t\thttp.Redirect(w, r, requestPath+\"/\", http.StatusTemporaryRedirect)\n+\t\t\t\treturn\n+\t\t\t}\n+\t\t\tif len(parts) > 2 {\n+\t\t\t\t//Extract the instance ID from the request path\n+\t\t\t\tinstanceUUID := parts[2]\n+\t\t\t\tfmt.Println(instanceUUID)\n+\n+\t\t\t\t//Rewrite the url so the proxy knows how to serve stuffs\n+\t\t\t\tr.URL, _ = sshprox.RewriteURL(\"/web.ssh/\"+instanceUUID, r.RequestURI)\n+\t\t\t\twebSshManager.HandleHttpByInstanceId(instanceUUID, w, r)\n+\t\t\t} else {\n+\t\t\t\tfmt.Println(parts)\n+\t\t\t\thttp.Error(w, \"Invalid Usage\", http.StatusInternalServerError)\n+\t\t\t}\n+\t\t\treturn\n+\t\t}\n+\n+\t\t//Authenticated\n+\t\thandler.ServeHTTP(w, r)\n+\t})\n+}\n+\n+// Production path fix wrapper. Fix the path on production or development environment\n+func ppf(relativeFilepath string) string {\n+\tif !development {\n+\t\treturn strings.ReplaceAll(filepath.Join(\"/web/\", relativeFilepath), \"\\\\\", \"/\")\n+\t}\n+\treturn relativeFilepath\n+}"
            },
            {
                "sha": "5b3e3d4d6da240a2e34b1602dddd5e7c8990735d",
                "filename": "src/start.go",
                "status": "added",
                "additions": 182,
                "deletions": 0,
                "changes": 182,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fstart.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fstart.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fstart.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,182 @@\n+package main\n+\n+import (\n+\t\"log\"\n+\t\"net/http\"\n+\t\"os\"\n+\t\"strconv\"\n+\t\"strings\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/auth\"\n+\t\"imuslab.com/zoraxy/mod/database\"\n+\t\"imuslab.com/zoraxy/mod/dynamicproxy/redirection\"\n+\t\"imuslab.com/zoraxy/mod/ganserv\"\n+\t\"imuslab.com/zoraxy/mod/geodb\"\n+\t\"imuslab.com/zoraxy/mod/mdns\"\n+\t\"imuslab.com/zoraxy/mod/netstat\"\n+\t\"imuslab.com/zoraxy/mod/sshprox\"\n+\t\"imuslab.com/zoraxy/mod/statistic\"\n+\t\"imuslab.com/zoraxy/mod/statistic/analytic\"\n+\t\"imuslab.com/zoraxy/mod/tcpprox\"\n+\t\"imuslab.com/zoraxy/mod/tlscert\"\n+)\n+\n+/*\n+\tStartup Sequence\n+\n+\tThis function starts the startup sequence of all\n+\trequired modules\n+*/\n+\n+var (\n+\t/*\n+\t\tMDNS related\n+\t*/\n+\tpreviousmdnsScanResults = []*mdns.NetworkHost{}\n+\tmdnsTickerStop          chan bool\n+)\n+\n+func startupSequence() {\n+\t//Create database\n+\tdb, err := database.NewDatabase(\"sys.db\", false)\n+\tif err != nil {\n+\t\tlog.Fatal(err)\n+\t}\n+\tsysdb = db\n+\t//Create tables for the database\n+\tsysdb.NewTable(\"settings\")\n+\n+\t//Create tmp folder\n+\tos.MkdirAll(\"./tmp\", 0775)\n+\n+\t//Create an auth agent\n+\tsessionKey, err := auth.GetSessionKey(sysdb)\n+\tif err != nil {\n+\t\tlog.Fatal(err)\n+\t}\n+\tauthAgent = auth.NewAuthenticationAgent(name, []byte(sessionKey), sysdb, true, func(w http.ResponseWriter, r *http.Request) {\n+\t\t//Not logged in. Redirecting to login page\n+\t\thttp.Redirect(w, r, ppf(\"/login.html\"), http.StatusTemporaryRedirect)\n+\t})\n+\n+\t//Create a TLS certificate manager\n+\ttlsCertManager, err = tlscert.NewManager(\"./certs\", development)\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\n+\t//Create a redirection rule table\n+\tredirectTable, err = redirection.NewRuleTable(\"./rules\")\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\n+\t//Create a geodb store\n+\tgeodbStore, err = geodb.NewGeoDb(sysdb)\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\n+\t//Create a statistic collector\n+\tstatisticCollector, err = statistic.NewStatisticCollector(statistic.CollectorOption{\n+\t\tDatabase: sysdb,\n+\t})\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\n+\t//Create a netstat buffer\n+\tnetstatBuffers, err = netstat.NewNetStatBuffer(300)\n+\tif err != nil {\n+\t\tlog.Println(\"Failed to load network statistic info\")\n+\t\tpanic(err)\n+\t}\n+\n+\t/*\n+\t\tMDNS Discovery Service\n+\n+\t\tThis discover nearby ArozOS Nodes or other services\n+\t\tthat provide mDNS discovery with domain (e.g. Synology NAS)\n+\t*/\n+\tportInt, err := strconv.Atoi(strings.Split(handler.Port, \":\")[1])\n+\tif err != nil {\n+\t\tportInt = 8000\n+\t}\n+\tmdnsScanner, err = mdns.NewMDNS(mdns.NetworkHost{\n+\t\tHostName:     \"zoraxy_\" + nodeUUID,\n+\t\tPort:         portInt,\n+\t\tDomain:       \"zoraxy.imuslab.com\",\n+\t\tModel:        \"Network Gateway\",\n+\t\tUUID:         nodeUUID,\n+\t\tVendor:       \"imuslab.com\",\n+\t\tBuildVersion: version,\n+\t}, \"\")\n+\tif err != nil {\n+\t\tpanic(err)\n+\t}\n+\n+\t//Start initial scanning\n+\tgo func() {\n+\t\thosts := mdnsScanner.Scan(30, \"\")\n+\t\tpreviousmdnsScanResults = hosts\n+\t\tlog.Println(\"mDNS Startup scan completed\")\n+\t}()\n+\n+\t//Create a ticker to update mDNS results every 5 minutes\n+\tticker := time.NewTicker(15 * time.Minute)\n+\tstopChan := make(chan bool)\n+\tgo func() {\n+\t\tfor {\n+\t\t\tselect {\n+\t\t\tcase <-stopChan:\n+\t\t\t\tticker.Stop()\n+\t\t\tcase <-ticker.C:\n+\t\t\t\thosts := mdnsScanner.Scan(30, \"\")\n+\t\t\t\tpreviousmdnsScanResults = hosts\n+\t\t\t\tlog.Println(\"mDNS scan result updated\")\n+\t\t\t}\n+\t\t}\n+\t}()\n+\tmdnsTickerStop = stopChan\n+\n+\t/*\n+\t\tGlobal Area Network\n+\n+\t\tRequire zerotier token to work\n+\t*/\n+\tusingZtAuthToken := *ztAuthToken\n+\tif usingZtAuthToken == \"\" {\n+\t\tusingZtAuthToken, err = ganserv.TryLoadorAskUserForAuthkey()\n+\t\tif err != nil {\n+\t\t\tlog.Println(\"Failed to load ZeroTier controller API authtoken\")\n+\t\t}\n+\t}\n+\tganManager = ganserv.NewNetworkManager(&ganserv.NetworkManagerOptions{\n+\t\tAuthToken: usingZtAuthToken,\n+\t\tApiPort:   *ztAPIPort,\n+\t\tDatabase:  sysdb,\n+\t})\n+\n+\t//Create WebSSH Manager\n+\twebSshManager = sshprox.NewSSHProxyManager()\n+\n+\t//Create TCP Proxy Manager\n+\ttcpProxyManager = tcpprox.NewTCProxy(&tcpprox.Options{\n+\t\tDatabase: sysdb,\n+\t})\n+\n+\t//Create WoL MAC storage table\n+\tsysdb.NewTable(\"wolmac\")\n+\n+\t//Create an email sender if SMTP config exists\n+\tsysdb.NewTable(\"smtp\")\n+\tEmailSender = loadSMTPConfig()\n+\n+\t//Create an analytic loader\n+\tAnalyticLoader = analytic.NewDataLoader(sysdb, statisticCollector)\n+}"
            },
            {
                "sha": "0f8631fee85cf9b7d70d0e65829434bb34a1da95",
                "filename": "src/webssh.go",
                "status": "added",
                "additions": 107,
                "deletions": 0,
                "changes": 107,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fwebssh.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fwebssh.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fwebssh.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,107 @@\n+package main\n+\n+import (\n+\t\"encoding/json\"\n+\t\"net/http\"\n+\t\"strconv\"\n+\t\"strings\"\n+\n+\t\"imuslab.com/zoraxy/mod/sshprox\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+)\n+\n+/*\n+\twebssh.go\n+\n+\tThis script handle the establish of a new ssh proxy object\n+*/\n+\n+func HandleCreateProxySession(w http.ResponseWriter, r *http.Request) {\n+\t//Get what ip address and port to connect to\n+\tipaddr, err := utils.PostPara(r, \"ipaddr\")\n+\tif err != nil {\n+\t\thttp.Error(w, \"Invalid Usage\", http.StatusInternalServerError)\n+\t\treturn\n+\t}\n+\n+\tportString, err := utils.PostPara(r, \"port\")\n+\tif err != nil {\n+\t\tportString = \"22\"\n+\t}\n+\n+\tusername, err := utils.PostPara(r, \"username\")\n+\tif err != nil {\n+\t\tusername = \"\"\n+\t}\n+\n+\tport, err := strconv.Atoi(portString)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid port number given\")\n+\t\treturn\n+\t}\n+\n+\tif !*allowSshLoopback {\n+\t\t//Not allow loopback connections\n+\t\tif strings.EqualFold(strings.TrimSpace(ipaddr), \"localhost\") || strings.TrimSpace(ipaddr) == \"127.0.0.1\" {\n+\t\t\t//Request target is loopback\n+\t\t\tutils.SendErrorResponse(w, \"loopback web ssh connection is not enabled on this host\")\n+\t\t\treturn\n+\t\t}\n+\t}\n+\n+\t//Check if the target is a valid ssh endpoint\n+\tif !sshprox.IsSSHConnectable(ipaddr, port) {\n+\t\tutils.SendErrorResponse(w, ipaddr+\":\"+strconv.Itoa(port)+\" is not a valid SSH server\")\n+\t\treturn\n+\t}\n+\n+\t//Create a new proxy instance\n+\tinstance, err := webSshManager.NewSSHProxy(\"./tmp/gotty\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, strings.ReplaceAll(err.Error(), \"\\\\\", \"/\"))\n+\t\treturn\n+\t}\n+\n+\t//Create an ssh process to the target address\n+\terr = instance.CreateNewConnection(webSshManager.GetNextPort(), username, ipaddr, port)\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, err.Error())\n+\t\treturn\n+\t}\n+\n+\t//Return the instance uuid\n+\tjs, _ := json.Marshal(instance.UUID)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+//Check if the host support ssh, or if the target domain (and port, optional) support ssh\n+func HandleWebSshSupportCheck(w http.ResponseWriter, r *http.Request) {\n+\tdomain, err := utils.PostPara(r, \"domain\")\n+\tif err != nil {\n+\t\t//Check if ssh supported on this host\n+\t\tisSupport := sshprox.IsWebSSHSupported()\n+\t\tjs, _ := json.Marshal(isSupport)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\t//Domain is given. Check if port is given\n+\t\tportString, err := utils.PostPara(r, \"port\")\n+\t\tif err != nil {\n+\t\t\tportString = \"22\"\n+\t\t}\n+\n+\t\tport, err := strconv.Atoi(portString)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"invalid port number given\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tif port < 1 || port > 65534 {\n+\t\t\tutils.SendErrorResponse(w, \"invalid port number given\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tlooksLikeSSHServer := sshprox.IsSSHConnectable(domain, port)\n+\t\tjs, _ := json.Marshal(looksLikeSSHServer)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t}\n+}"
            },
            {
                "sha": "51f341133d84cf2ce6848003639a102a71535a3c",
                "filename": "src/wrappers.go",
                "status": "added",
                "additions": 299,
                "deletions": 0,
                "changes": 299,
                "blob_url": "https://github.com/tobychui/zoraxy/blob/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fwrappers.go",
                "raw_url": "https://github.com/tobychui/zoraxy/raw/c07d5f85dfc37bd32819358ed7d4bc32c604e8f0/src%2Fwrappers.go",
                "contents_url": "https://api.github.com/repos/tobychui/zoraxy/contents/src%2Fwrappers.go?ref=c07d5f85dfc37bd32819358ed7d4bc32c604e8f0",
                "patch": "@@ -0,0 +1,299 @@\n+package main\n+\n+/*\n+\tWrappers.go\n+\n+\tThis script provide wrapping functions\n+\tfor modules that do not provide\n+\thandler interface within the modules\n+\n+\t--- NOTES ---\n+\tIf your module have more than one layer\n+\tor require state keeping, please move\n+\tthe abstraction up one layer into\n+\tyour own module. Do not keep state on\n+\tthe global scope other than single\n+\tManager instance\n+*/\n+\n+import (\n+\t\"encoding/json\"\n+\t\"fmt\"\n+\t\"log\"\n+\t\"net/http\"\n+\t\"strings\"\n+\t\"time\"\n+\n+\t\"imuslab.com/zoraxy/mod/dynamicproxy\"\n+\t\"imuslab.com/zoraxy/mod/ipscan\"\n+\t\"imuslab.com/zoraxy/mod/mdns\"\n+\t\"imuslab.com/zoraxy/mod/uptime\"\n+\t\"imuslab.com/zoraxy/mod/utils\"\n+\t\"imuslab.com/zoraxy/mod/wakeonlan\"\n+)\n+\n+/*\n+\tProxy Utils\n+*/\n+//Check if site support TLS\n+func HandleCheckSiteSupportTLS(w http.ResponseWriter, r *http.Request) {\n+\ttargetURL, err := utils.PostPara(r, \"url\")\n+\tif err != nil {\n+\t\tutils.SendErrorResponse(w, \"invalid url given\")\n+\t\treturn\n+\t}\n+\n+\thttpsUrl := fmt.Sprintf(\"https://%s\", targetURL)\n+\thttpUrl := fmt.Sprintf(\"http://%s\", targetURL)\n+\n+\tclient := http.Client{Timeout: 5 * time.Second}\n+\n+\tresp, err := client.Head(httpsUrl)\n+\tif err == nil && resp.StatusCode == http.StatusOK {\n+\t\tjs, _ := json.Marshal(\"https\")\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t\treturn\n+\t}\n+\n+\tresp, err = client.Head(httpUrl)\n+\tif err == nil && resp.StatusCode == http.StatusOK {\n+\t\tjs, _ := json.Marshal(\"http\")\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t\treturn\n+\t}\n+\n+\tutils.SendErrorResponse(w, \"invalid url given\")\n+}\n+\n+/*\n+\tStatistic Summary\n+*/\n+\n+//Handle conversion of statistic daily summary to country summary\n+func HandleCountryDistrSummary(w http.ResponseWriter, r *http.Request) {\n+\trequestClientCountry := map[string]int{}\n+\tstatisticCollector.DailySummary.RequestClientIp.Range(func(key, value interface{}) bool {\n+\t\t//Get this client country of original\n+\t\tclientIp := key.(string)\n+\t\t//requestCount := value.(int)\n+\n+\t\tci, err := geodbStore.ResolveCountryCodeFromIP(clientIp)\n+\t\tif err != nil {\n+\t\t\treturn true\n+\t\t}\n+\n+\t\tisoCode := ci.CountryIsoCode\n+\t\tif isoCode == \"\" {\n+\t\t\t//local or reserved addr\n+\t\t\tisoCode = \"local\"\n+\t\t}\n+\t\tuc, ok := requestClientCountry[isoCode]\n+\t\tif !ok {\n+\t\t\t//Create the counter\n+\t\t\trequestClientCountry[isoCode] = 1\n+\t\t} else {\n+\t\t\trequestClientCountry[isoCode] = uc + 1\n+\t\t}\n+\t\treturn true\n+\t})\n+\n+\tjs, _ := json.Marshal(requestClientCountry)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+/*\n+\tUp Time Monitor\n+*/\n+//Generate uptime monitor targets from reverse proxy rules\n+func GetUptimeTargetsFromReverseProxyRules(dp *dynamicproxy.Router) []*uptime.Target {\n+\tsubds := dp.GetSDProxyEndpointsAsMap()\n+\tvdirs := dp.GetVDProxyEndpointsAsMap()\n+\n+\tUptimeTargets := []*uptime.Target{}\n+\tfor subd, target := range subds {\n+\t\turl := \"http://\" + target.Domain\n+\t\tprotocol := \"http\"\n+\t\tif target.RequireTLS {\n+\t\t\turl = \"https://\" + target.Domain\n+\t\t\tprotocol = \"https\"\n+\t\t}\n+\t\tUptimeTargets = append(UptimeTargets, &uptime.Target{\n+\t\t\tID:       subd,\n+\t\t\tName:     subd,\n+\t\t\tURL:      url,\n+\t\t\tProtocol: protocol,\n+\t\t})\n+\t}\n+\n+\tfor vdir, target := range vdirs {\n+\t\turl := \"http://\" + target.Domain\n+\t\tprotocol := \"http\"\n+\t\tif target.RequireTLS {\n+\t\t\turl = \"https://\" + target.Domain\n+\t\t\tprotocol = \"https\"\n+\t\t}\n+\t\tUptimeTargets = append(UptimeTargets, &uptime.Target{\n+\t\t\tID:       vdir,\n+\t\t\tName:     \"*\" + vdir,\n+\t\t\tURL:      url,\n+\t\t\tProtocol: protocol,\n+\t\t})\n+\t}\n+\n+\treturn UptimeTargets\n+}\n+\n+//Handle rendering up time monitor data\n+func HandleUptimeMonitorListing(w http.ResponseWriter, r *http.Request) {\n+\tif uptimeMonitor != nil {\n+\t\tuptimeMonitor.HandleUptimeLogRead(w, r)\n+\t} else {\n+\t\thttp.Error(w, \"500 - Internal Server Error\", http.StatusInternalServerError)\n+\t\treturn\n+\t}\n+}\n+\n+//Handle listing current registered mdns nodes\n+func HandleMdnsListing(w http.ResponseWriter, r *http.Request) {\n+\tjs, _ := json.Marshal(previousmdnsScanResults)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+func HandleMdnsScanning(w http.ResponseWriter, r *http.Request) {\n+\tdomain, err := utils.PostPara(r, \"domain\")\n+\tvar hosts []*mdns.NetworkHost\n+\tif err != nil {\n+\t\t//Search for arozos node\n+\t\thosts = mdnsScanner.Scan(30, \"\")\n+\t\tpreviousmdnsScanResults = hosts\n+\t} else {\n+\t\t//Search for other nodes\n+\t\thosts = mdnsScanner.Scan(30, domain)\n+\t}\n+\n+\tjs, _ := json.Marshal(hosts)\n+\tutils.SendJSONResponse(w, string(js))\n+}\n+\n+//handle ip scanning\n+func HandleIpScan(w http.ResponseWriter, r *http.Request) {\n+\tcidr, err := utils.PostPara(r, \"cidr\")\n+\tif err != nil {\n+\t\t//Ip range mode\n+\t\tstart, err := utils.PostPara(r, \"start\")\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"missing start ip\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tend, err := utils.PostPara(r, \"end\")\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"missing end ip\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tdiscoveredHosts, err := ipscan.ScanIpRange(start, end)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(discoveredHosts)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t} else {\n+\t\t//CIDR mode\n+\t\tdiscoveredHosts, err := ipscan.ScanCIDRRange(cidr)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(discoveredHosts)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t}\n+}\n+\n+/*\n+\tHandle wake on LAN\n+\tSupport following methods\n+\t/?set=xxx&name=xxx Record a new MAC address into the database\n+\t/?wake=xxx Wake a server given its MAC address\n+\t/?del=xxx Delete a server given its MAC address\n+\t/ Default: list all recorded WoL MAC address\n+\n+*/\n+func HandleWakeOnLan(w http.ResponseWriter, r *http.Request) {\n+\tset, _ := utils.PostPara(r, \"set\")\n+\tdel, _ := utils.PostPara(r, \"del\")\n+\twake, _ := utils.PostPara(r, \"wake\")\n+\tif set != \"\" {\n+\t\t//Get the name of the describing server\n+\t\tservername, err := utils.PostPara(r, \"name\")\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"invalid server name given\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\t//Check if the given mac address is a valid mac address\n+\t\tset = strings.TrimSpace(set)\n+\t\tif !wakeonlan.IsValidMacAddress(set) {\n+\t\t\tutils.SendErrorResponse(w, \"invalid mac address given\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\t//Store this into the database\n+\t\tsysdb.Write(\"wolmac\", set, servername)\n+\n+\t\tutils.SendOK(w)\n+\t} else if wake != \"\" {\n+\t\t//Wake the target up by MAC address\n+\t\tif !wakeonlan.IsValidMacAddress(wake) {\n+\t\t\tutils.SendErrorResponse(w, \"invalid mac address given\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tlog.Println(\"[WoL] Sending Wake on LAN magic packet to \" + wake)\n+\t\terr := wakeonlan.WakeTarget(wake)\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, err.Error())\n+\t\t\treturn\n+\t\t}\n+\n+\t\tutils.SendOK(w)\n+\t} else if del != \"\" {\n+\t\tif !wakeonlan.IsValidMacAddress(del) {\n+\t\t\tutils.SendErrorResponse(w, \"invalid mac address given\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\tsysdb.Delete(\"wolmac\", del)\n+\t\tutils.SendOK(w)\n+\t} else {\n+\t\t//List all the saved WoL MAC Address\n+\t\tentries, err := sysdb.ListTable(\"wolmac\")\n+\t\tif err != nil {\n+\t\t\tutils.SendErrorResponse(w, \"unknown error occured\")\n+\t\t\treturn\n+\t\t}\n+\n+\t\ttype MacAddrRecord struct {\n+\t\t\tServerName string\n+\t\t\tMacAddr    string\n+\t\t}\n+\n+\t\tresults := []*MacAddrRecord{}\n+\t\tfor _, keypairs := range entries {\n+\t\t\tmacAddr := string(keypairs[0])\n+\t\t\tserverName := \"\"\n+\t\t\tjson.Unmarshal(keypairs[1], &serverName)\n+\n+\t\t\tresults = append(results, &MacAddrRecord{\n+\t\t\t\tServerName: serverName,\n+\t\t\t\tMacAddr:    macAddr,\n+\t\t\t})\n+\t\t}\n+\n+\t\tjs, _ := json.Marshal(results)\n+\t\tutils.SendJSONResponse(w, string(js))\n+\t}\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/goToMain/libosdp/commits/24409e98a260176765956ec766a04cb35984fab1",
        "url": "https://api.github.com/repos/goToMain/libosdp/commits/24409e98a260176765956ec766a04cb35984fab1",
        "html_url": "https://github.com/goToMain/libosdp/commit/24409e98a260176765956ec766a04cb35984fab1",
        "message": "Fix null pointer deref issue osdp_reply_name\n\nSigned-off-by: Siddharth Chandrasekaran <sidcha.dev@gmail.com>",
        "files": [
            {
                "sha": "054c18608a038a76ce7aeac9f662193fd8405ee8",
                "filename": "src/osdp_common.c",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/goToMain/libosdp/blob/24409e98a260176765956ec766a04cb35984fab1/src%2Fosdp_common.c",
                "raw_url": "https://github.com/goToMain/libosdp/raw/24409e98a260176765956ec766a04cb35984fab1/src%2Fosdp_common.c",
                "contents_url": "https://api.github.com/repos/goToMain/libosdp/contents/src%2Fosdp_common.c?ref=24409e98a260176765956ec766a04cb35984fab1",
                "patch": "@@ -120,7 +120,7 @@ const char *osdp_reply_name(int reply_id)\n \t\treturn \"INVALID\";\n \t}\n \tname = names[reply_id - REPLY_ACK];\n-\tif (name[0] == '\\0') {\n+\tif (!name) {\n \t\treturn \"UNKNOWN\";\n \t}\n \treturn name;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/netty/netty/commits/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3",
        "url": "https://api.github.com/repos/netty/netty/commits/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3",
        "html_url": "https://github.com/netty/netty/commit/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3",
        "message": "Merge commit from fork\n\nMotivation:\n\nWe didnt verify the amount of data buffered while reading files / streams during startup which could allow an attacker to cause an OMME if the attacker was able to create a massive file.\n\nModifications:\n\nDecorate InputStream with own that will throw an exception once we reach the limit of data read.\n\nResult:\n\nNo more risk of OOME",
        "files": [
            {
                "sha": "c28389f05a8a7d4dc91cb7396d9e2975a94d6896",
                "filename": "common/src/main/java/io/netty/util/NetUtil.java",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/netty/netty/blob/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/common%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Futil%2FNetUtil.java",
                "raw_url": "https://github.com/netty/netty/raw/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/common%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Futil%2FNetUtil.java",
                "contents_url": "https://api.github.com/repos/netty/netty/contents/common%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Futil%2FNetUtil.java?ref=fbf7a704a82e7449b48bd0bbb679f5661c6d61a3",
                "patch": "@@ -16,6 +16,7 @@\n package io.netty.util;\n \n import io.netty.util.NetUtilInitializations.NetworkIfaceAndInetAddress;\n+import io.netty.util.internal.BoundedInputStream;\n import io.netty.util.internal.PlatformDependent;\n import io.netty.util.internal.StringUtil;\n import io.netty.util.internal.SystemPropertyUtil;\n@@ -24,7 +25,7 @@\n \n import java.io.BufferedReader;\n import java.io.File;\n-import java.io.FileReader;\n+import java.io.FileInputStream;\n import java.io.IOException;\n import java.io.InputStream;\n import java.io.InputStreamReader;\n@@ -190,7 +191,8 @@ public Integer run() {\n                 // try / catch block.\n                 // See https://github.com/netty/netty/issues/4936\n                 if (file.exists()) {\n-                    in = new BufferedReader(new FileReader(file));\n+                    in = new BufferedReader(new InputStreamReader(\n+                            new BoundedInputStream(new FileInputStream(file))));\n                     somaxconn = Integer.parseInt(in.readLine());\n                     if (logger.isDebugEnabled()) {\n                         logger.debug(\"{}: {}\", file, somaxconn);\n@@ -243,7 +245,7 @@ private static Integer sysctlGetInt(String sysctlKey) throws IOException {\n         try {\n             // Suppress warnings about resource leaks since the buffered reader is closed below\n             InputStream is = process.getInputStream();\n-            InputStreamReader isr = new InputStreamReader(is);\n+            InputStreamReader isr = new InputStreamReader(new BoundedInputStream(is));\n             BufferedReader br = new BufferedReader(isr);\n             try {\n                 String line = br.readLine();"
            },
            {
                "sha": "3062f46905bff52904e9e369bbcbf142c14720e7",
                "filename": "common/src/main/java/io/netty/util/internal/BoundedInputStream.java",
                "status": "added",
                "additions": 83,
                "deletions": 0,
                "changes": 83,
                "blob_url": "https://github.com/netty/netty/blob/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/common%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Futil%2Finternal%2FBoundedInputStream.java",
                "raw_url": "https://github.com/netty/netty/raw/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/common%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Futil%2Finternal%2FBoundedInputStream.java",
                "contents_url": "https://api.github.com/repos/netty/netty/contents/common%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Futil%2Finternal%2FBoundedInputStream.java?ref=fbf7a704a82e7449b48bd0bbb679f5661c6d61a3",
                "patch": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2024 The Netty Project\n+ *\n+ * The Netty Project licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package io.netty.util.internal;\n+\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.io.FilterInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+\n+public final class BoundedInputStream extends FilterInputStream {\n+\n+    private final int maxBytesRead;\n+    private int numRead;\n+\n+    public BoundedInputStream(@NotNull InputStream in, int maxBytesRead) {\n+        super(in);\n+        this.maxBytesRead = ObjectUtil.checkPositive(maxBytesRead, \"maxRead\");\n+    }\n+\n+    public BoundedInputStream(@NotNull InputStream in) {\n+        this(in, 8 * 1024);\n+    }\n+\n+    @Override\n+    public int read() throws IOException {\n+        checkMaxBytesRead(1);\n+        try {\n+            int b = super.read();\n+            if (b <= 0) {\n+                // We couldn't read anything.\n+                numRead--;\n+            }\n+            return b;\n+        } catch (IOException e) {\n+            numRead--;\n+            throw e;\n+        }\n+    }\n+\n+    @Override\n+    public int read(byte[] buf, int off, int len) throws IOException {\n+        // Calculate the maximum number of bytes that we should try to read.\n+        int num = Math.min(len, maxBytesRead - numRead + 1);\n+        checkMaxBytesRead(num);\n+        try {\n+            int b = super.read(buf, off, num);\n+            if (b == -1) {\n+                // We couldn't read anything.\n+                numRead -= num;\n+            } else if (b != num) {\n+                // Correct numRead based on the actual amount we were able to read.\n+                numRead -= num - b;\n+            }\n+            return b;\n+        } catch (IOException e) {\n+            numRead -= num;\n+            throw e;\n+        }\n+    }\n+\n+    private void checkMaxBytesRead(int n) throws IOException {\n+        int sum = numRead + n;\n+        if (sum < 0 || sum > maxBytesRead) {\n+            numRead = maxBytesRead + 1;\n+            throw new IOException(\"Maximum number of bytes read: \" + maxBytesRead);\n+        }\n+        numRead = sum;\n+    }\n+}"
            },
            {
                "sha": "ed9b313256d0ac494dc76b902d0bb48d141e354c",
                "filename": "common/src/main/java/io/netty/util/internal/PlatformDependent.java",
                "status": "modified",
                "additions": 2,
                "deletions": 3,
                "changes": 5,
                "blob_url": "https://github.com/netty/netty/blob/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/common%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Futil%2Finternal%2FPlatformDependent.java",
                "raw_url": "https://github.com/netty/netty/raw/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/common%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Futil%2Finternal%2FPlatformDependent.java",
                "contents_url": "https://api.github.com/repos/netty/netty/contents/common%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Futil%2Finternal%2FPlatformDependent.java?ref=fbf7a704a82e7449b48bd0bbb679f5661c6d61a3",
                "patch": "@@ -239,9 +239,8 @@ public Boolean run() {\n                         if (file.exists()) {\n                             BufferedReader reader = null;\n                             try {\n-                                reader = new BufferedReader(\n-                                        new InputStreamReader(\n-                                                new FileInputStream(file), CharsetUtil.UTF_8));\n+                                reader = new BufferedReader(new InputStreamReader(\n+                                        new BoundedInputStream(new FileInputStream(file)), CharsetUtil.UTF_8));\n \n                                 String line;\n                                 while ((line = reader.readLine()) != null) {"
            },
            {
                "sha": "35e66e578fcd87685d38eedd505feb121f310f16",
                "filename": "common/src/test/java/io/netty/util/internal/BoundedInputStreamTest.java",
                "status": "added",
                "additions": 44,
                "deletions": 0,
                "changes": 44,
                "blob_url": "https://github.com/netty/netty/blob/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/common%2Fsrc%2Ftest%2Fjava%2Fio%2Fnetty%2Futil%2Finternal%2FBoundedInputStreamTest.java",
                "raw_url": "https://github.com/netty/netty/raw/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/common%2Fsrc%2Ftest%2Fjava%2Fio%2Fnetty%2Futil%2Finternal%2FBoundedInputStreamTest.java",
                "contents_url": "https://api.github.com/repos/netty/netty/contents/common%2Fsrc%2Ftest%2Fjava%2Fio%2Fnetty%2Futil%2Finternal%2FBoundedInputStreamTest.java?ref=fbf7a704a82e7449b48bd0bbb679f5661c6d61a3",
                "patch": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2024 The Netty Project\n+ *\n+ * The Netty Project licenses this file to you under the Apache License,\n+ * version 2.0 (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *   https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package io.netty.util.internal;\n+\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.function.Executable;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+public class BoundedInputStreamTest {\n+\n+    @Test\n+    void testBoundEnforced() throws IOException {\n+        final byte[] bytes = new byte[64];\n+        PlatformDependent.threadLocalRandom().nextBytes(bytes);\n+        final BoundedInputStream reader = new BoundedInputStream(new ByteArrayInputStream(bytes), bytes.length - 1);\n+        assertEquals(bytes[0], (byte) reader.read());\n+\n+        assertThrows(IOException.class, new Executable() {\n+            @Override\n+            public void execute() throws Throwable {\n+                reader.read(new byte[64], 0, 64);\n+            }\n+        });\n+        reader.close();\n+    }\n+}"
            },
            {
                "sha": "1610fb2aa349f1ce26becfbbf7b64b9946bb44f0",
                "filename": "resolver-dns/src/main/java/io/netty/resolver/dns/ResolvConf.java",
                "status": "modified",
                "additions": 8,
                "deletions": 4,
                "changes": 12,
                "blob_url": "https://github.com/netty/netty/blob/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/resolver-dns%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Fresolver%2Fdns%2FResolvConf.java",
                "raw_url": "https://github.com/netty/netty/raw/fbf7a704a82e7449b48bd0bbb679f5661c6d61a3/resolver-dns%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Fresolver%2Fdns%2FResolvConf.java",
                "contents_url": "https://api.github.com/repos/netty/netty/contents/resolver-dns%2Fsrc%2Fmain%2Fjava%2Fio%2Fnetty%2Fresolver%2Fdns%2FResolvConf.java?ref=fbf7a704a82e7449b48bd0bbb679f5661c6d61a3",
                "patch": "@@ -15,9 +15,12 @@\n  */\n package io.netty.resolver.dns;\n \n+import io.netty.util.internal.BoundedInputStream;\n+\n import java.io.BufferedReader;\n-import java.io.FileReader;\n+import java.io.FileInputStream;\n import java.io.IOException;\n+import java.io.InputStreamReader;\n import java.net.InetSocketAddress;\n import java.util.ArrayList;\n import java.util.Collections;\n@@ -45,12 +48,13 @@ static ResolvConf fromReader(BufferedReader reader) throws IOException {\n      * {@code /etc/resolv.conf} file, see {@code man resolv.conf}.\n      */\n     static ResolvConf fromFile(String file) throws IOException {\n-        FileReader fileReader = new FileReader(file);\n+        BufferedReader reader = new BufferedReader(new InputStreamReader(\n+                // Use 1 MB to be a bit conservative\n+                new BoundedInputStream(new FileInputStream(file), 1024 * 1024)));\n         try {\n-            BufferedReader reader = new BufferedReader(new FileReader(file));\n             return fromReader(reader);\n         } finally {\n-            fileReader.close();\n+            reader.close();\n         }\n     }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/commits/84374037d34a3ac80dc18406834169c65869f11b",
        "url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/commits/84374037d34a3ac80dc18406834169c65869f11b",
        "html_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/commit/84374037d34a3ac80dc18406834169c65869f11b",
        "message": "Security fix (#327)\n\n* prevent sql injection\r\n\r\n* ruboxcop\r\n\r\n* simplify orderable override\r\n\r\n* escape collation search\r\n\r\n* fix location detection\r\n\r\n* use filter-map",
        "files": [
            {
                "sha": "8dee4fc2e721845d5bbb6597152e09314e1491f8",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/blob/84374037d34a3ac80dc18406834169c65869f11b/CHANGELOG.md",
                "raw_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/raw/84374037d34a3ac80dc18406834169c65869f11b/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/contents/CHANGELOG.md?ref=84374037d34a3ac80dc18406834169c65869f11b",
                "patch": "@@ -1,6 +1,16 @@\n CHANGELOG\n =========\n \n+v0.11.2\n+-------\n+\n+Compatibility:\n+  - Decidim v0.28.x\n+\n+Features:\n+  - SQL vulnerability fix for admin accountability\n+  - Private fields proposal draft update fix\n+\n v0.11.1\n ------\n "
            },
            {
                "sha": "8e34fe4048acc468e585e5209c1178aaaf39b94e",
                "filename": "Gemfile.lock",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/blob/84374037d34a3ac80dc18406834169c65869f11b/Gemfile.lock",
                "raw_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/raw/84374037d34a3ac80dc18406834169c65869f11b/Gemfile.lock",
                "contents_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/contents/Gemfile.lock?ref=84374037d34a3ac80dc18406834169c65869f11b",
                "patch": "@@ -1,7 +1,7 @@\n PATH\n   remote: .\n   specs:\n-    decidim-decidim_awesome (0.11.1)\n+    decidim-decidim_awesome (0.11.2)\n       decidim-admin (>= 0.28.0, < 0.29)\n       decidim-core (>= 0.28.0, < 0.29)\n       deface (>= 1.5)"
            },
            {
                "sha": "7d737acacdb3ff0f1a236852a6f2eff95ae96900",
                "filename": "app/controllers/concerns/decidim/decidim_awesome/admin_accountability/admin/filterable_helper.rb",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/blob/84374037d34a3ac80dc18406834169c65869f11b/app%2Fcontrollers%2Fconcerns%2Fdecidim%2Fdecidim_awesome%2Fadmin_accountability%2Fadmin%2Ffilterable_helper.rb",
                "raw_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/raw/84374037d34a3ac80dc18406834169c65869f11b/app%2Fcontrollers%2Fconcerns%2Fdecidim%2Fdecidim_awesome%2Fadmin_accountability%2Fadmin%2Ffilterable_helper.rb",
                "contents_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/contents/app%2Fcontrollers%2Fconcerns%2Fdecidim%2Fdecidim_awesome%2Fadmin_accountability%2Fadmin%2Ffilterable_helper.rb?ref=84374037d34a3ac80dc18406834169c65869f11b",
                "patch": "@@ -13,10 +13,11 @@ def extra_dropdown_submenu_options_items(_filter, _i18n_scope)\n           end\n \n           def applied_filters_tags(i18n_ctx)\n-            if global? && params[:admin_role_type].present?\n+            admin_role_type = PaperTrailVersion.safe_admin_role_type(params[:admin_role_type])\n+            if global? && admin_role_type.present?\n               content_tag(:span, class: \"label secondary\") do\n                 concat \"#{i18n_filter_label(:admin_role_type, filterable_i18n_scope_from_ctx(i18n_ctx))}: \"\n-                concat t(\"decidim.decidim_awesome.admin.admin_accountability.admin_roles.#{params[:admin_role_type]}\", default: params[:admin_role_type])\n+                concat t(\"decidim.decidim_awesome.admin.admin_accountability.admin_roles.#{admin_role_type}\", default: admin_role_type)\n                 concat icon_link_to(\n                   \"close-circle-line\",\n                   url_for(export_params.except(:admin_role_type)),"
            },
            {
                "sha": "9d8623c71e5f5c89ea3633a6dc9544142d0701e6",
                "filename": "app/controllers/concerns/decidim/decidim_awesome/proposals/orderable_override.rb",
                "status": "modified",
                "additions": 9,
                "deletions": 22,
                "changes": 31,
                "blob_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/blob/84374037d34a3ac80dc18406834169c65869f11b/app%2Fcontrollers%2Fconcerns%2Fdecidim%2Fdecidim_awesome%2Fproposals%2Forderable_override.rb",
                "raw_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/raw/84374037d34a3ac80dc18406834169c65869f11b/app%2Fcontrollers%2Fconcerns%2Fdecidim%2Fdecidim_awesome%2Fproposals%2Forderable_override.rb",
                "contents_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/contents/app%2Fcontrollers%2Fconcerns%2Fdecidim%2Fdecidim_awesome%2Fproposals%2Forderable_override.rb?ref=84374037d34a3ac80dc18406834169c65869f11b",
                "patch": "@@ -14,6 +14,8 @@ module OrderableOverride\n \n           private\n \n+          alias_method :decidim_original_reorder, :reorder\n+\n           # read order from session if available\n           def order\n             @order ||= detect_order(session[:order]) || default_order\n@@ -31,38 +33,23 @@ def possible_orders\n             end\n           end\n \n-          # rubocop:disable Metrics/CyclomaticComplexity\n           def reorder(proposals)\n+            title_by_locale = Arel.sql(proposals.sanitize_sql([\"decidim_proposals_proposals.title->>? #{collation}\", locale]))\n+            title_by_machine_translation = Arel.sql(proposals.sanitize_sql([\"decidim_proposals_proposals.title->'machine_translations'->>? #{collation}\", locale]))\n+            title_by_default_locale = Arel.sql(proposals.sanitize_sql([\"decidim_proposals_proposals.title->>? #{collation}\", default_locale]))\n             case order\n             when \"az\"\n-              proposals.order(Arel.sql(\"CONCAT(decidim_proposals_proposals.title->>'#{locale}',\n-                                        decidim_proposals_proposals.title->'machine_translations'->>'#{locale}',\n-                                        decidim_proposals_proposals.title->>'#{default_locale}') #{collation} ASC\"))\n+              proposals.order(title_by_locale => :asc, title_by_machine_translation => :asc, title_by_default_locale => :asc)\n             when \"za\"\n-              proposals.order(Arel.sql(\"CONCAT(decidim_proposals_proposals.title->>'#{locale}',\n-                                        decidim_proposals_proposals.title->'machine_translations'->>'#{locale}',\n-                                        decidim_proposals_proposals.title->>'#{default_locale}') #{collation} DESC\"))\n+              proposals.order(title_by_locale => :desc, title_by_machine_translation => :desc, title_by_default_locale => :desc)\n             when \"supported_first\"\n               proposals.joins(my_votes_join).group(:id).order(Arel.sql(\"COUNT(decidim_proposals_proposal_votes.id) DESC\"))\n             when \"supported_last\"\n               proposals.joins(my_votes_join).group(:id).order(Arel.sql(\"COUNT(decidim_proposals_proposal_votes.id) ASC\"))\n-            when \"most_commented\"\n-              proposals.left_joins(:comments).group(:id).order(Arel.sql(\"COUNT(decidim_comments_comments.id) DESC\"))\n-            when \"most_endorsed\"\n-              proposals.order(endorsements_count: :desc)\n-            when \"most_followed\"\n-              proposals.left_joins(:follows).group(:id).order(Arel.sql(\"COUNT(decidim_follows.id) DESC\"))\n-            when \"most_voted\"\n-              proposals.order(proposal_votes_count: :desc)\n-            when \"random\"\n-              proposals.order_randomly(random_seed)\n-            when \"recent\"\n-              proposals.order(published_at: :desc)\n-            when \"with_more_authors\"\n-              proposals.order(coauthorships_count: :desc)\n+            else\n+              decidim_original_reorder(proposals)\n             end\n           end\n-          # rubocop:enable Metrics/CyclomaticComplexity\n \n           def collation\n             @collation ||= begin"
            },
            {
                "sha": "ec3ffe3ce35b7cf7e06043757cd16cf6d7ed846e",
                "filename": "app/controllers/decidim/decidim_awesome/admin/admin_accountability_controller.rb",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/blob/84374037d34a3ac80dc18406834169c65869f11b/app%2Fcontrollers%2Fdecidim%2Fdecidim_awesome%2Fadmin%2Fadmin_accountability_controller.rb",
                "raw_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/raw/84374037d34a3ac80dc18406834169c65869f11b/app%2Fcontrollers%2Fdecidim%2Fdecidim_awesome%2Fadmin%2Fadmin_accountability_controller.rb",
                "contents_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/contents/app%2Fcontrollers%2Fdecidim%2Fdecidim_awesome%2Fadmin%2Fadmin_accountability_controller.rb?ref=84374037d34a3ac80dc18406834169c65869f11b",
                "patch": "@@ -5,7 +5,7 @@ module DecidimAwesome\n     module Admin\n       class AdminAccountabilityController < DecidimAwesome::Admin::ApplicationController\n         include NeedsAwesomeConfig\n-        include Decidim::DecidimAwesome::AdminAccountability::Admin::Filterable\n+        include AdminAccountability::Admin::Filterable\n \n         helper_method :admin_actions, :collection, :export_params, :global?, :global_users_missing_date\n \n@@ -20,9 +20,9 @@ def index; end\n         def export\n           filters = export_params[:q]\n \n-          Decidim::DecidimAwesome::ExportAdminActionsJob.perform_later(current_user,\n-                                                                       params[:format].to_s,\n-                                                                       admin_actions.ransack(filters).result.ids)\n+          ExportAdminActionsJob.perform_later(current_user,\n+                                              params[:format].to_s,\n+                                              admin_actions.ransack(filters).result.ids)\n \n           redirect_back fallback_location: decidim_admin_decidim_awesome.admin_accountability_path,\n                         notice: t(\"decidim.decidim_awesome.admin.admin_accountability.exports.notice\")\n@@ -39,11 +39,11 @@ def collection\n         end\n \n         def space_role_actions\n-          @space_role_actions ||= Decidim::DecidimAwesome::PaperTrailVersion.space_role_actions(current_organization)\n+          @space_role_actions ||= PaperTrailVersion.space_role_actions(current_organization)\n         end\n \n         def admin_role_actions\n-          @admin_role_actions ||= Decidim::DecidimAwesome::PaperTrailVersion.in_organization(current_organization).admin_role_actions(params[:admin_role_type])\n+          @admin_role_actions ||= PaperTrailVersion.in_organization(current_organization).admin_role_actions(PaperTrailVersion.safe_admin_role_type(params[:admin_role_type]))\n         end\n \n         def export_params\n@@ -61,7 +61,7 @@ def global_users_missing_date\n           return unless global?\n \n           @global_users_missing_date ||= begin\n-            first_version = Decidim::DecidimAwesome::PaperTrailVersion.where(item_type: \"Decidim::UserBaseEntity\").last\n+            first_version = PaperTrailVersion.where(item_type: \"Decidim::UserBaseEntity\").last\n             first_user = Decidim::User.first\n             first_version.created_at if first_user && first_version && (first_version.created_at > first_user.created_at + 1.second)\n           end"
            },
            {
                "sha": "5e3ad2d6ca6f9929786c69f698dab929f1256ed5",
                "filename": "app/models/decidim/decidim_awesome/paper_trail_version.rb",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/blob/84374037d34a3ac80dc18406834169c65869f11b/app%2Fmodels%2Fdecidim%2Fdecidim_awesome%2Fpaper_trail_version.rb",
                "raw_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/raw/84374037d34a3ac80dc18406834169c65869f11b/app%2Fmodels%2Fdecidim%2Fdecidim_awesome%2Fpaper_trail_version.rb",
                "contents_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/contents/app%2Fmodels%2Fdecidim%2Fdecidim_awesome%2Fpaper_trail_version.rb?ref=84374037d34a3ac80dc18406834169c65869f11b",
                "patch": "@@ -9,6 +9,10 @@ def self.safe_user_roles\n         DecidimAwesome.participatory_space_roles.filter(&:safe_constantize)\n       end\n \n+      def self.safe_admin_role_type(admin_role)\n+        Decidim.user_roles.find { |role| role == admin_role }\n+      end\n+\n       scope :space_role_actions, lambda { |organization|\n         role_changes = where(item_type: PaperTrailVersion.safe_user_roles, event: \"create\")\n         user_ids_from_object_changes = role_changes.pluck(:object_changes).map { |change| change.match(/decidim_user_id:\\n- ?\\n- (\\d+)/)[1].to_i }\n@@ -33,7 +37,7 @@ def self.admin_role_actions(filter = nil)\n         when \"admin\"\n           base.where(\"object_changes LIKE '%\\nadmin:\\n- false\\n- true%'\")\n         else\n-          base.where(Arel.sql(\"object_changes LIKE '%\\nroles:\\n- []\\n- - #{filter}\\n%'\"))\n+          base.where(\"object_changes LIKE ?\", \"%\\nroles:\\n- []\\n- - #{filter}\\n%\")\n         end\n       end\n "
            },
            {
                "sha": "58042876173167427180a822bd9d4395f66599d3",
                "filename": "lib/decidim/decidim_awesome/awesome.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/blob/84374037d34a3ac80dc18406834169c65869f11b/lib%2Fdecidim%2Fdecidim_awesome%2Fawesome.rb",
                "raw_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/raw/84374037d34a3ac80dc18406834169c65869f11b/lib%2Fdecidim%2Fdecidim_awesome%2Fawesome.rb",
                "contents_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/contents/lib%2Fdecidim%2Fdecidim_awesome%2Fawesome.rb?ref=84374037d34a3ac80dc18406834169c65869f11b",
                "patch": "@@ -333,11 +333,11 @@ def self.hash_prepend!(hash, before_key, key, value)\n \n     def self.collation_for(locale)\n       @collation_for ||= {}\n-      @collation_for[locale] ||= begin\n-        res = ActiveRecord::Base.connection.execute(Arel.sql(\"SELECT collname FROM pg_collation WHERE collname LIKE '#{locale}-x-icu' LIMIT 1\")).first\n-        res ||= ActiveRecord::Base.connection.execute(Arel.sql(\"SELECT collname FROM pg_collation WHERE collname LIKE '#{locale[0..1]}%' LIMIT 1\")).first\n+      @collation_for[locale] ||= [\"#{locale}-x-icu\", \"#{locale[0..1]}%\"].filter_map do |loc|\n+        sql = ApplicationRecord.sanitize_sql([\"SELECT collname FROM pg_collation WHERE collname LIKE ? LIMIT 1\", loc])\n+        res = ActiveRecord::Base.connection.execute(sql).first\n         res[\"collname\"] if res\n-      end\n+      end.first\n     end\n \n     def self.enabled?(*config_vars)"
            },
            {
                "sha": "644e87f9d24278a33a7b099bb25a52d7f257e487",
                "filename": "lib/decidim/decidim_awesome/version.rb",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/blob/84374037d34a3ac80dc18406834169c65869f11b/lib%2Fdecidim%2Fdecidim_awesome%2Fversion.rb",
                "raw_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/raw/84374037d34a3ac80dc18406834169c65869f11b/lib%2Fdecidim%2Fdecidim_awesome%2Fversion.rb",
                "contents_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/contents/lib%2Fdecidim%2Fdecidim_awesome%2Fversion.rb?ref=84374037d34a3ac80dc18406834169c65869f11b",
                "patch": "@@ -3,7 +3,7 @@\n module Decidim\n   # This holds the decidim-decidim_awesome version.\n   module DecidimAwesome\n-    VERSION = \"0.11.1\"\n+    VERSION = \"0.11.2\"\n     COMPAT_DECIDIM_VERSION = [\">= 0.28.0\", \"< 0.29\"].freeze\n   end\n end"
            },
            {
                "sha": "e7fd773ba617c2083e913301d7cb2ebccf7bf589",
                "filename": "spec/models/paper_trail_version_spec.rb",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/blob/84374037d34a3ac80dc18406834169c65869f11b/spec%2Fmodels%2Fpaper_trail_version_spec.rb",
                "raw_url": "https://github.com/decidim-ice/decidim-module-decidim_awesome/raw/84374037d34a3ac80dc18406834169c65869f11b/spec%2Fmodels%2Fpaper_trail_version_spec.rb",
                "contents_url": "https://api.github.com/repos/decidim-ice/decidim-module-decidim_awesome/contents/spec%2Fmodels%2Fpaper_trail_version_spec.rb?ref=84374037d34a3ac80dc18406834169c65869f11b",
                "patch": "@@ -106,6 +106,10 @@ module Decidim::DecidimAwesome\n         expect(PaperTrailVersion.in_organization(external_organization).admin_role_actions(\"valuator\")).to include(external_paper_trail_version)\n         expect(PaperTrailVersion.in_organization(external_organization).admin_role_actions(\"admin\")).to eq([])\n       end\n+\n+      it \"ignores invalid filters\" do\n+        expect(PaperTrailVersion.in_organization(organization).admin_role_actions(\"%')\")).to eq([])\n+      end\n     end\n   end\n end"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/RealTimeLogic/SharkSSL/commits/7045f6f254060640ff77eef2027f108fcc20e2f2",
        "url": "https://api.github.com/repos/RealTimeLogic/SharkSSL/commits/7045f6f254060640ff77eef2027f108fcc20e2f2",
        "html_url": "https://github.com/RealTimeLogic/SharkSSL/commit/7045f6f254060640ff77eef2027f108fcc20e2f2",
        "message": "Update SharkSSL.c",
        "files": [
            {
                "sha": "40113ebb17d4e3803c9e1e43aff8ada32d4a8a91",
                "filename": "src/SharkSSL.c",
                "status": "modified",
                "additions": 25,
                "deletions": 0,
                "changes": 25,
                "blob_url": "https://github.com/RealTimeLogic/SharkSSL/blob/7045f6f254060640ff77eef2027f108fcc20e2f2/src%2FSharkSSL.c",
                "raw_url": "https://github.com/RealTimeLogic/SharkSSL/raw/7045f6f254060640ff77eef2027f108fcc20e2f2/src%2FSharkSSL.c",
                "contents_url": "https://api.github.com/repos/RealTimeLogic/SharkSSL/contents/src%2FSharkSSL.c?ref=7045f6f254060640ff77eef2027f108fcc20e2f2",
                "patch": "@@ -2687,6 +2687,11 @@ static int handleptrauth(SharkSslCon* o, U8* registeredevent, U16 len)\n             {\n                U8 savedsigmask;\n \n+               if (paramnamed < 2)\n+               {\n+                  SHARKDBG_PRINTF((\"\\045\\163\\072\\040\\045\\144\\012\", __FILE__, __LINE__));\n+                  return -1;\n+               }\n                \n                prminstwrite  = (U16)(*registeredevent++) << 8;\n                prminstwrite += *registeredevent++;\n@@ -2805,6 +2810,11 @@ static int handleptrauth(SharkSslCon* o, U8* registeredevent, U16 len)\n          #endif  \n \n          default:  \n+            if (len < paramnamed)\n+            {\n+               SHARKDBG_PRINTF((\"\\045\\163\\072\\040\\045\\144\\012\", __FILE__, __LINE__));\n+               return -1;\n+            }\n             len -= paramnamed;\n             registeredevent += paramnamed;\n             break;\n@@ -2919,6 +2929,11 @@ static int dfbmcs320device(SharkSslCon* o, U8* registeredevent, U16 len)\n          case clkdmclear:\n             if (paramnamed)\n             {\n+               if (len < 2)\n+               {\n+                  SHARKDBG_PRINTF((\"\\045\\163\\072\\040\\045\\144\\012\", __FILE__, __LINE__));\n+                  return -1;\n+               }\n                paramnamed = (U16)(*registeredevent++) << 8;\n                paramnamed += *registeredevent++;\n                len -= 2;\n@@ -3047,6 +3062,11 @@ static int dfbmcs320device(SharkSslCon* o, U8* registeredevent, U16 len)\n             if (SharkSsl_isServer(o->sharkSsl))\n             {\n                \n+               if (len < paramnamed)\n+               {\n+                  SHARKDBG_PRINTF((\"\\045\\163\\072\\040\\045\\144\\012\", __FILE__, __LINE__));\n+                  return -1;\n+               }\n                len -= paramnamed;\n                registeredevent += paramnamed;\n             }\n@@ -3073,6 +3093,11 @@ static int dfbmcs320device(SharkSslCon* o, U8* registeredevent, U16 len)\n          \n          default:  \n             \n+            if (len < paramnamed)\n+            {\n+               SHARKDBG_PRINTF((\"\\045\\163\\072\\040\\045\\144\\012\", __FILE__, __LINE__));\n+               return -1;\n+            }\n             len -= paramnamed;\n             registeredevent += paramnamed;\n             break;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/ansible/commits/98774d15d7748ebaaaf2e83942cc7e8d39f7280e",
        "url": "https://api.github.com/repos/ansible/ansible/commits/98774d15d7748ebaaaf2e83942cc7e8d39f7280e",
        "html_url": "https://github.com/ansible/ansible/commit/98774d15d7748ebaaaf2e83942cc7e8d39f7280e",
        "message": "Fix CVE-2024-11079 hostvars unsafe context (#84339) (#84354)\n\nFix to preserve an unsafe variable when accessing through an\r\nintermediary variable from hostvars.\r\n\r\n(cherry picked from commit 2936b80dbbc7efb889934aeec80f6142c10266ce)",
        "files": [
            {
                "sha": "cf7ca888e23473427f19c3604745c13b3a309886",
                "filename": "changelogs/fragments/unsafe_hostvars_fix.yml",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/ansible/ansible/blob/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/changelogs%2Ffragments%2Funsafe_hostvars_fix.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/changelogs%2Ffragments%2Funsafe_hostvars_fix.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/changelogs%2Ffragments%2Funsafe_hostvars_fix.yml?ref=98774d15d7748ebaaaf2e83942cc7e8d39f7280e",
                "patch": "@@ -0,0 +1,2 @@\n+security_fixes:\n+  - Templating will not prefer AnsibleUnsafe when a variable is referenced via hostvars - CVE-2024-11079"
            },
            {
                "sha": "6713300f5e141c037dea3c945200a6a7319fbd89",
                "filename": "lib/ansible/template/__init__.py",
                "status": "modified",
                "additions": 1,
                "deletions": 30,
                "changes": 31,
                "blob_url": "https://github.com/ansible/ansible/blob/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/lib%2Fansible%2Ftemplate%2F__init__.py",
                "raw_url": "https://github.com/ansible/ansible/raw/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/lib%2Fansible%2Ftemplate%2F__init__.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Ftemplate%2F__init__.py?ref=98774d15d7748ebaaaf2e83942cc7e8d39f7280e",
                "patch": "@@ -48,7 +48,7 @@\n from ansible.module_utils.common.text.converters import to_native, to_text, to_bytes\n from ansible.module_utils.common.collections import is_sequence\n from ansible.plugins.loader import filter_loader, lookup_loader, test_loader\n-from ansible.template.native_helpers import ansible_native_concat, ansible_eval_concat, ansible_concat\n+from ansible.template.native_helpers import AnsibleUndefined, ansible_native_concat, ansible_eval_concat, ansible_concat\n from ansible.template.template import AnsibleJ2Template\n from ansible.template.vars import AnsibleJ2Vars\n from ansible.utils.display import Display\n@@ -312,35 +312,6 @@ def wrapper(*args, **kwargs):\n     return functools.update_wrapper(wrapper, func)\n \n \n-class AnsibleUndefined(StrictUndefined):\n-    '''\n-    A custom Undefined class, which returns further Undefined objects on access,\n-    rather than throwing an exception.\n-    '''\n-    def __getattr__(self, name):\n-        if name == '__UNSAFE__':\n-            # AnsibleUndefined should never be assumed to be unsafe\n-            # This prevents ``hasattr(val, '__UNSAFE__')`` from evaluating to ``True``\n-            raise AttributeError(name)\n-        # Return original Undefined object to preserve the first failure context\n-        return self\n-\n-    def __getitem__(self, key):\n-        # Return original Undefined object to preserve the first failure context\n-        return self\n-\n-    def __repr__(self):\n-        return 'AnsibleUndefined(hint={0!r}, obj={1!r}, name={2!r})'.format(\n-            self._undefined_hint,\n-            self._undefined_obj,\n-            self._undefined_name\n-        )\n-\n-    def __contains__(self, item):\n-        # Return original Undefined object to preserve the first failure context\n-        return self\n-\n-\n class AnsibleContext(Context):\n     '''\n     A custom context, which intercepts resolve_or_missing() calls and sets a flag"
            },
            {
                "sha": "860235eb4f773c5f9538da4f247d61d1b5b03f58",
                "filename": "lib/ansible/template/native_helpers.py",
                "status": "modified",
                "additions": 118,
                "deletions": 4,
                "changes": 122,
                "blob_url": "https://github.com/ansible/ansible/blob/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/lib%2Fansible%2Ftemplate%2Fnative_helpers.py",
                "raw_url": "https://github.com/ansible/ansible/raw/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/lib%2Fansible%2Ftemplate%2Fnative_helpers.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Ftemplate%2Fnative_helpers.py?ref=98774d15d7748ebaaaf2e83942cc7e8d39f7280e",
                "patch": "@@ -5,13 +5,19 @@\n \n \n import ast\n+from collections.abc import Mapping\n from itertools import islice, chain\n from types import GeneratorType\n \n+from ansible.module_utils.common.collections import is_sequence\n from ansible.module_utils.common.text.converters import to_text\n from ansible.module_utils.six import string_types\n from ansible.parsing.yaml.objects import AnsibleVaultEncryptedUnicode\n from ansible.utils.native_jinja import NativeJinjaText\n+from ansible.utils.unsafe_proxy import wrap_var\n+import ansible.module_utils.compat.typing as t\n+\n+from jinja2.runtime import StrictUndefined\n \n \n _JSON_MAP = {\n@@ -28,6 +34,40 @@ def visit_Name(self, node):\n         return ast.Constant(value=_JSON_MAP[node.id])\n \n \n+def _is_unsafe(value: t.Any) -> bool:\n+    \"\"\"\n+    Our helper function, which will also recursively check dict and\n+    list entries due to the fact that they may be repr'd and contain\n+    a key or value which contains jinja2 syntax and would otherwise\n+    lose the AnsibleUnsafe value.\n+    \"\"\"\n+    to_check = [value]\n+    seen = set()\n+\n+    while True:\n+        if not to_check:\n+            break\n+\n+        val = to_check.pop(0)\n+        val_id = id(val)\n+\n+        if val_id in seen:\n+            continue\n+        seen.add(val_id)\n+\n+        if isinstance(val, AnsibleUndefined):\n+            continue\n+        if isinstance(val, Mapping):\n+            to_check.extend(val.keys())\n+            to_check.extend(val.values())\n+        elif is_sequence(val):\n+            to_check.extend(val)\n+        elif getattr(val, '__UNSAFE__', False):\n+            return True\n+\n+    return False\n+\n+\n def ansible_eval_concat(nodes):\n     \"\"\"Return a string of concatenated compiled nodes. Throw an undefined error\n     if any of the nodes is undefined.\n@@ -43,17 +83,28 @@ def ansible_eval_concat(nodes):\n     if not head:\n         return ''\n \n+    unsafe = False\n+\n     if len(head) == 1:\n         out = head[0]\n \n         if isinstance(out, NativeJinjaText):\n             return out\n \n+        unsafe = _is_unsafe(out)\n         out = to_text(out)\n     else:\n         if isinstance(nodes, GeneratorType):\n             nodes = chain(head, nodes)\n-        out = ''.join([to_text(v) for v in nodes])\n+\n+        out_values = []\n+        for v in nodes:\n+            if not unsafe and _is_unsafe(v):\n+                unsafe = True\n+\n+            out_values.append(to_text(v))\n+\n+        out = ''.join(out_values)\n \n     # if this looks like a dictionary, list or bool, convert it to such\n     if out.startswith(('{', '[')) or out in ('True', 'False'):\n@@ -68,6 +119,9 @@ def ansible_eval_concat(nodes):\n         except (TypeError, ValueError, SyntaxError, MemoryError):\n             pass\n \n+    if unsafe:\n+        out = wrap_var(out)\n+\n     return out\n \n \n@@ -78,7 +132,19 @@ def ansible_concat(nodes):\n \n     Used in Templar.template() when jinja2_native=False and convert_data=False.\n     \"\"\"\n-    return ''.join([to_text(v) for v in nodes])\n+    unsafe = False\n+    values = []\n+    for v in nodes:\n+        if not unsafe and _is_unsafe(v):\n+            unsafe = True\n+\n+        values.append(to_text(v))\n+\n+    out = ''.join(values)\n+    if unsafe:\n+        out = wrap_var(out)\n+\n+    return out\n \n \n def ansible_native_concat(nodes):\n@@ -95,6 +161,8 @@ def ansible_native_concat(nodes):\n     if not head:\n         return None\n \n+    unsafe = False\n+\n     if len(head) == 1:\n         out = head[0]\n \n@@ -115,10 +183,21 @@ def ansible_native_concat(nodes):\n         # short-circuit literal_eval for anything other than strings\n         if not isinstance(out, string_types):\n             return out\n+\n+        unsafe = _is_unsafe(out)\n+\n     else:\n         if isinstance(nodes, GeneratorType):\n             nodes = chain(head, nodes)\n-        out = ''.join([to_text(v) for v in nodes])\n+\n+        out_values = []\n+        for v in nodes:\n+            if not unsafe and _is_unsafe(v):\n+                unsafe = True\n+\n+            out_values.append(to_text(v))\n+\n+        out = ''.join(out_values)\n \n     try:\n         evaled = ast.literal_eval(\n@@ -128,10 +207,45 @@ def ansible_native_concat(nodes):\n             ast.parse(out, mode='eval')\n         )\n     except (TypeError, ValueError, SyntaxError, MemoryError):\n+        if unsafe:\n+            out = wrap_var(out)\n+\n         return out\n \n     if isinstance(evaled, string_types):\n         quote = out[0]\n-        return f'{quote}{evaled}{quote}'\n+        evaled = f'{quote}{evaled}{quote}'\n+\n+    if unsafe:\n+        evaled = wrap_var(evaled)\n \n     return evaled\n+\n+\n+class AnsibleUndefined(StrictUndefined):\n+    \"\"\"\n+    A custom Undefined class, which returns further Undefined objects on access,\n+    rather than throwing an exception.\n+    \"\"\"\n+    def __getattr__(self, name):\n+        if name == '__UNSAFE__':\n+            # AnsibleUndefined should never be assumed to be unsafe\n+            # This prevents ``hasattr(val, '__UNSAFE__')`` from evaluating to ``True``\n+            raise AttributeError(name)\n+        # Return original Undefined object to preserve the first failure context\n+        return self\n+\n+    def __getitem__(self, key):\n+        # Return original Undefined object to preserve the first failure context\n+        return self\n+\n+    def __repr__(self):\n+        return 'AnsibleUndefined(hint={0!r}, obj={1!r}, name={2!r})'.format(\n+            self._undefined_hint,\n+            self._undefined_obj,\n+            self._undefined_name\n+        )\n+\n+    def __contains__(self, item):\n+        # Return original Undefined object to preserve the first failure context\n+        return self"
            },
            {
                "sha": "d0e2b9830743c81057adc1e2ef4bc875473beee7",
                "filename": "lib/ansible/vars/hostvars.py",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/ansible/ansible/blob/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/lib%2Fansible%2Fvars%2Fhostvars.py",
                "raw_url": "https://github.com/ansible/ansible/raw/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/lib%2Fansible%2Fvars%2Fhostvars.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Fvars%2Fhostvars.py?ref=98774d15d7748ebaaaf2e83942cc7e8d39f7280e",
                "patch": "@@ -92,10 +92,12 @@ def __contains__(self, host_name):\n         return self._find_host(host_name) is not None\n \n     def __iter__(self):\n-        yield from self._inventory.hosts\n+        # include implicit localhost only if it has variables set\n+        yield from self._inventory.hosts | {'localhost': self._inventory.localhost} if self._inventory.localhost else {}\n \n     def __len__(self):\n-        return len(self._inventory.hosts)\n+        # include implicit localhost only if it has variables set\n+        return len(self._inventory.hosts) + (1 if self._inventory.localhost else 0)\n \n     def __repr__(self):\n         out = {}"
            },
            {
                "sha": "00eb16d995dc5876ea1d93028598a552d26e3b85",
                "filename": "test/integration/targets/template/cve-2024-11079.yml",
                "status": "added",
                "additions": 30,
                "deletions": 0,
                "changes": 30,
                "blob_url": "https://github.com/ansible/ansible/blob/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/test%2Fintegration%2Ftargets%2Ftemplate%2Fcve-2024-11079.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/test%2Fintegration%2Ftargets%2Ftemplate%2Fcve-2024-11079.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Ftemplate%2Fcve-2024-11079.yml?ref=98774d15d7748ebaaaf2e83942cc7e8d39f7280e",
                "patch": "@@ -0,0 +1,30 @@\n+- name: test CVE-2024-11079 loop variables preserve unsafe hostvars\n+  hosts: localhost\n+  gather_facts: false\n+  tasks:\n+  - set_fact:\n+      foo:\n+        safe:\n+          prop: '{{ \"{{\" }} unsafe_var {{ \"}}\" }}'\n+        unsafe:\n+          prop: !unsafe '{{ unsafe_var }}'\n+\n+  - name: safe var through hostvars loop is templated\n+    assert:\n+      that:\n+      - item.prop == expected\n+    loop:\n+    - \"{{ hostvars['localhost']['foo']['safe'] }}\"\n+    vars:\n+      unsafe_var: bar\n+      expected: bar\n+\n+  - name: unsafe var through hostvars loop is not templated\n+    assert:\n+      that:\n+      - item.prop == expected\n+    loop:\n+    - \"{{ hostvars['localhost']['foo']['unsafe'] }}\"\n+    vars:\n+      unsafe_var: bar\n+      expected: !unsafe '{{ unsafe_var }}'"
            },
            {
                "sha": "f9050b994478dd4625997c61205b570916b6632a",
                "filename": "test/integration/targets/template/runme.sh",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/ansible/ansible/blob/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/test%2Fintegration%2Ftargets%2Ftemplate%2Frunme.sh",
                "raw_url": "https://github.com/ansible/ansible/raw/98774d15d7748ebaaaf2e83942cc7e8d39f7280e/test%2Fintegration%2Ftargets%2Ftemplate%2Frunme.sh",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Ftemplate%2Frunme.sh?ref=98774d15d7748ebaaaf2e83942cc7e8d39f7280e",
                "patch": "@@ -41,6 +41,10 @@ ansible-playbook 72262.yml -v \"$@\"\n # ensure unsafe is preserved, even with extra newlines\n ansible-playbook unsafe.yml -v \"$@\"\n \n+# CVE 2024-11079\n+ANSIBLE_JINJA2_NATIVE=true ansible-playbook cve-2024-11079.yml -v \"$@\"\n+ANSIBLE_JINJA2_NATIVE=false ansible-playbook cve-2024-11079.yml -v \"$@\"\n+\n # ensure Jinja2 overrides from a template are used\n ansible-playbook template_overrides.yml -v \"$@\"\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/ansible/commits/2936b80dbbc7efb889934aeec80f6142c10266ce",
        "url": "https://api.github.com/repos/ansible/ansible/commits/2936b80dbbc7efb889934aeec80f6142c10266ce",
        "html_url": "https://github.com/ansible/ansible/commit/2936b80dbbc7efb889934aeec80f6142c10266ce",
        "message": "Fix CVE-2024-11079 hostvars unsafe context (#84339)\n\nFix to preserve an unsafe variable when accessing through an\r\nintermediary variable from hostvars.",
        "files": [
            {
                "sha": "cf7ca888e23473427f19c3604745c13b3a309886",
                "filename": "changelogs/fragments/unsafe_hostvars_fix.yml",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/ansible/ansible/blob/2936b80dbbc7efb889934aeec80f6142c10266ce/changelogs%2Ffragments%2Funsafe_hostvars_fix.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/2936b80dbbc7efb889934aeec80f6142c10266ce/changelogs%2Ffragments%2Funsafe_hostvars_fix.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/changelogs%2Ffragments%2Funsafe_hostvars_fix.yml?ref=2936b80dbbc7efb889934aeec80f6142c10266ce",
                "patch": "@@ -0,0 +1,2 @@\n+security_fixes:\n+  - Templating will not prefer AnsibleUnsafe when a variable is referenced via hostvars - CVE-2024-11079"
            },
            {
                "sha": "0d68dd620678e7696d088a2dd5f5137d64dce908",
                "filename": "lib/ansible/template/__init__.py",
                "status": "modified",
                "additions": 1,
                "deletions": 30,
                "changes": 31,
                "blob_url": "https://github.com/ansible/ansible/blob/2936b80dbbc7efb889934aeec80f6142c10266ce/lib%2Fansible%2Ftemplate%2F__init__.py",
                "raw_url": "https://github.com/ansible/ansible/raw/2936b80dbbc7efb889934aeec80f6142c10266ce/lib%2Fansible%2Ftemplate%2F__init__.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Ftemplate%2F__init__.py?ref=2936b80dbbc7efb889934aeec80f6142c10266ce",
                "patch": "@@ -48,7 +48,7 @@\n from ansible.module_utils.common.text.converters import to_native, to_text, to_bytes\n from ansible.module_utils.common.collections import is_sequence\n from ansible.plugins.loader import filter_loader, lookup_loader, test_loader\n-from ansible.template.native_helpers import ansible_native_concat, ansible_eval_concat, ansible_concat\n+from ansible.template.native_helpers import AnsibleUndefined, ansible_native_concat, ansible_eval_concat, ansible_concat\n from ansible.template.template import AnsibleJ2Template\n from ansible.template.vars import AnsibleJ2Vars\n from ansible.utils.display import Display\n@@ -312,35 +312,6 @@ def wrapper(*args, **kwargs):\n     return functools.update_wrapper(wrapper, func)\n \n \n-class AnsibleUndefined(StrictUndefined):\n-    '''\n-    A custom Undefined class, which returns further Undefined objects on access,\n-    rather than throwing an exception.\n-    '''\n-    def __getattr__(self, name):\n-        if name == '__UNSAFE__':\n-            # AnsibleUndefined should never be assumed to be unsafe\n-            # This prevents ``hasattr(val, '__UNSAFE__')`` from evaluating to ``True``\n-            raise AttributeError(name)\n-        # Return original Undefined object to preserve the first failure context\n-        return self\n-\n-    def __getitem__(self, key):\n-        # Return original Undefined object to preserve the first failure context\n-        return self\n-\n-    def __repr__(self):\n-        return 'AnsibleUndefined(hint={0!r}, obj={1!r}, name={2!r})'.format(\n-            self._undefined_hint,\n-            self._undefined_obj,\n-            self._undefined_name\n-        )\n-\n-    def __contains__(self, item):\n-        # Return original Undefined object to preserve the first failure context\n-        return self\n-\n-\n class AnsibleContext(Context):\n     '''\n     A custom context, which intercepts resolve_or_missing() calls and sets a flag"
            },
            {
                "sha": "860235eb4f773c5f9538da4f247d61d1b5b03f58",
                "filename": "lib/ansible/template/native_helpers.py",
                "status": "modified",
                "additions": 118,
                "deletions": 4,
                "changes": 122,
                "blob_url": "https://github.com/ansible/ansible/blob/2936b80dbbc7efb889934aeec80f6142c10266ce/lib%2Fansible%2Ftemplate%2Fnative_helpers.py",
                "raw_url": "https://github.com/ansible/ansible/raw/2936b80dbbc7efb889934aeec80f6142c10266ce/lib%2Fansible%2Ftemplate%2Fnative_helpers.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Ftemplate%2Fnative_helpers.py?ref=2936b80dbbc7efb889934aeec80f6142c10266ce",
                "patch": "@@ -5,13 +5,19 @@\n \n \n import ast\n+from collections.abc import Mapping\n from itertools import islice, chain\n from types import GeneratorType\n \n+from ansible.module_utils.common.collections import is_sequence\n from ansible.module_utils.common.text.converters import to_text\n from ansible.module_utils.six import string_types\n from ansible.parsing.yaml.objects import AnsibleVaultEncryptedUnicode\n from ansible.utils.native_jinja import NativeJinjaText\n+from ansible.utils.unsafe_proxy import wrap_var\n+import ansible.module_utils.compat.typing as t\n+\n+from jinja2.runtime import StrictUndefined\n \n \n _JSON_MAP = {\n@@ -28,6 +34,40 @@ def visit_Name(self, node):\n         return ast.Constant(value=_JSON_MAP[node.id])\n \n \n+def _is_unsafe(value: t.Any) -> bool:\n+    \"\"\"\n+    Our helper function, which will also recursively check dict and\n+    list entries due to the fact that they may be repr'd and contain\n+    a key or value which contains jinja2 syntax and would otherwise\n+    lose the AnsibleUnsafe value.\n+    \"\"\"\n+    to_check = [value]\n+    seen = set()\n+\n+    while True:\n+        if not to_check:\n+            break\n+\n+        val = to_check.pop(0)\n+        val_id = id(val)\n+\n+        if val_id in seen:\n+            continue\n+        seen.add(val_id)\n+\n+        if isinstance(val, AnsibleUndefined):\n+            continue\n+        if isinstance(val, Mapping):\n+            to_check.extend(val.keys())\n+            to_check.extend(val.values())\n+        elif is_sequence(val):\n+            to_check.extend(val)\n+        elif getattr(val, '__UNSAFE__', False):\n+            return True\n+\n+    return False\n+\n+\n def ansible_eval_concat(nodes):\n     \"\"\"Return a string of concatenated compiled nodes. Throw an undefined error\n     if any of the nodes is undefined.\n@@ -43,17 +83,28 @@ def ansible_eval_concat(nodes):\n     if not head:\n         return ''\n \n+    unsafe = False\n+\n     if len(head) == 1:\n         out = head[0]\n \n         if isinstance(out, NativeJinjaText):\n             return out\n \n+        unsafe = _is_unsafe(out)\n         out = to_text(out)\n     else:\n         if isinstance(nodes, GeneratorType):\n             nodes = chain(head, nodes)\n-        out = ''.join([to_text(v) for v in nodes])\n+\n+        out_values = []\n+        for v in nodes:\n+            if not unsafe and _is_unsafe(v):\n+                unsafe = True\n+\n+            out_values.append(to_text(v))\n+\n+        out = ''.join(out_values)\n \n     # if this looks like a dictionary, list or bool, convert it to such\n     if out.startswith(('{', '[')) or out in ('True', 'False'):\n@@ -68,6 +119,9 @@ def ansible_eval_concat(nodes):\n         except (TypeError, ValueError, SyntaxError, MemoryError):\n             pass\n \n+    if unsafe:\n+        out = wrap_var(out)\n+\n     return out\n \n \n@@ -78,7 +132,19 @@ def ansible_concat(nodes):\n \n     Used in Templar.template() when jinja2_native=False and convert_data=False.\n     \"\"\"\n-    return ''.join([to_text(v) for v in nodes])\n+    unsafe = False\n+    values = []\n+    for v in nodes:\n+        if not unsafe and _is_unsafe(v):\n+            unsafe = True\n+\n+        values.append(to_text(v))\n+\n+    out = ''.join(values)\n+    if unsafe:\n+        out = wrap_var(out)\n+\n+    return out\n \n \n def ansible_native_concat(nodes):\n@@ -95,6 +161,8 @@ def ansible_native_concat(nodes):\n     if not head:\n         return None\n \n+    unsafe = False\n+\n     if len(head) == 1:\n         out = head[0]\n \n@@ -115,10 +183,21 @@ def ansible_native_concat(nodes):\n         # short-circuit literal_eval for anything other than strings\n         if not isinstance(out, string_types):\n             return out\n+\n+        unsafe = _is_unsafe(out)\n+\n     else:\n         if isinstance(nodes, GeneratorType):\n             nodes = chain(head, nodes)\n-        out = ''.join([to_text(v) for v in nodes])\n+\n+        out_values = []\n+        for v in nodes:\n+            if not unsafe and _is_unsafe(v):\n+                unsafe = True\n+\n+            out_values.append(to_text(v))\n+\n+        out = ''.join(out_values)\n \n     try:\n         evaled = ast.literal_eval(\n@@ -128,10 +207,45 @@ def ansible_native_concat(nodes):\n             ast.parse(out, mode='eval')\n         )\n     except (TypeError, ValueError, SyntaxError, MemoryError):\n+        if unsafe:\n+            out = wrap_var(out)\n+\n         return out\n \n     if isinstance(evaled, string_types):\n         quote = out[0]\n-        return f'{quote}{evaled}{quote}'\n+        evaled = f'{quote}{evaled}{quote}'\n+\n+    if unsafe:\n+        evaled = wrap_var(evaled)\n \n     return evaled\n+\n+\n+class AnsibleUndefined(StrictUndefined):\n+    \"\"\"\n+    A custom Undefined class, which returns further Undefined objects on access,\n+    rather than throwing an exception.\n+    \"\"\"\n+    def __getattr__(self, name):\n+        if name == '__UNSAFE__':\n+            # AnsibleUndefined should never be assumed to be unsafe\n+            # This prevents ``hasattr(val, '__UNSAFE__')`` from evaluating to ``True``\n+            raise AttributeError(name)\n+        # Return original Undefined object to preserve the first failure context\n+        return self\n+\n+    def __getitem__(self, key):\n+        # Return original Undefined object to preserve the first failure context\n+        return self\n+\n+    def __repr__(self):\n+        return 'AnsibleUndefined(hint={0!r}, obj={1!r}, name={2!r})'.format(\n+            self._undefined_hint,\n+            self._undefined_obj,\n+            self._undefined_name\n+        )\n+\n+    def __contains__(self, item):\n+        # Return original Undefined object to preserve the first failure context\n+        return self"
            },
            {
                "sha": "d0e2b9830743c81057adc1e2ef4bc875473beee7",
                "filename": "lib/ansible/vars/hostvars.py",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/ansible/ansible/blob/2936b80dbbc7efb889934aeec80f6142c10266ce/lib%2Fansible%2Fvars%2Fhostvars.py",
                "raw_url": "https://github.com/ansible/ansible/raw/2936b80dbbc7efb889934aeec80f6142c10266ce/lib%2Fansible%2Fvars%2Fhostvars.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Fvars%2Fhostvars.py?ref=2936b80dbbc7efb889934aeec80f6142c10266ce",
                "patch": "@@ -92,10 +92,12 @@ def __contains__(self, host_name):\n         return self._find_host(host_name) is not None\n \n     def __iter__(self):\n-        yield from self._inventory.hosts\n+        # include implicit localhost only if it has variables set\n+        yield from self._inventory.hosts | {'localhost': self._inventory.localhost} if self._inventory.localhost else {}\n \n     def __len__(self):\n-        return len(self._inventory.hosts)\n+        # include implicit localhost only if it has variables set\n+        return len(self._inventory.hosts) + (1 if self._inventory.localhost else 0)\n \n     def __repr__(self):\n         out = {}"
            },
            {
                "sha": "00eb16d995dc5876ea1d93028598a552d26e3b85",
                "filename": "test/integration/targets/template/cve-2024-11079.yml",
                "status": "added",
                "additions": 30,
                "deletions": 0,
                "changes": 30,
                "blob_url": "https://github.com/ansible/ansible/blob/2936b80dbbc7efb889934aeec80f6142c10266ce/test%2Fintegration%2Ftargets%2Ftemplate%2Fcve-2024-11079.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/2936b80dbbc7efb889934aeec80f6142c10266ce/test%2Fintegration%2Ftargets%2Ftemplate%2Fcve-2024-11079.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Ftemplate%2Fcve-2024-11079.yml?ref=2936b80dbbc7efb889934aeec80f6142c10266ce",
                "patch": "@@ -0,0 +1,30 @@\n+- name: test CVE-2024-11079 loop variables preserve unsafe hostvars\n+  hosts: localhost\n+  gather_facts: false\n+  tasks:\n+  - set_fact:\n+      foo:\n+        safe:\n+          prop: '{{ \"{{\" }} unsafe_var {{ \"}}\" }}'\n+        unsafe:\n+          prop: !unsafe '{{ unsafe_var }}'\n+\n+  - name: safe var through hostvars loop is templated\n+    assert:\n+      that:\n+      - item.prop == expected\n+    loop:\n+    - \"{{ hostvars['localhost']['foo']['safe'] }}\"\n+    vars:\n+      unsafe_var: bar\n+      expected: bar\n+\n+  - name: unsafe var through hostvars loop is not templated\n+    assert:\n+      that:\n+      - item.prop == expected\n+    loop:\n+    - \"{{ hostvars['localhost']['foo']['unsafe'] }}\"\n+    vars:\n+      unsafe_var: bar\n+      expected: !unsafe '{{ unsafe_var }}'"
            },
            {
                "sha": "f9050b994478dd4625997c61205b570916b6632a",
                "filename": "test/integration/targets/template/runme.sh",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/ansible/ansible/blob/2936b80dbbc7efb889934aeec80f6142c10266ce/test%2Fintegration%2Ftargets%2Ftemplate%2Frunme.sh",
                "raw_url": "https://github.com/ansible/ansible/raw/2936b80dbbc7efb889934aeec80f6142c10266ce/test%2Fintegration%2Ftargets%2Ftemplate%2Frunme.sh",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Ftemplate%2Frunme.sh?ref=2936b80dbbc7efb889934aeec80f6142c10266ce",
                "patch": "@@ -41,6 +41,10 @@ ansible-playbook 72262.yml -v \"$@\"\n # ensure unsafe is preserved, even with extra newlines\n ansible-playbook unsafe.yml -v \"$@\"\n \n+# CVE 2024-11079\n+ANSIBLE_JINJA2_NATIVE=true ansible-playbook cve-2024-11079.yml -v \"$@\"\n+ANSIBLE_JINJA2_NATIVE=false ansible-playbook cve-2024-11079.yml -v \"$@\"\n+\n # ensure Jinja2 overrides from a template are used\n ansible-playbook template_overrides.yml -v \"$@\"\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/ansible/commits/70e83e72b43e05e57eb42a6d52d01a4d9768f510",
        "url": "https://api.github.com/repos/ansible/ansible/commits/70e83e72b43e05e57eb42a6d52d01a4d9768f510",
        "html_url": "https://github.com/ansible/ansible/commit/70e83e72b43e05e57eb42a6d52d01a4d9768f510",
        "message": "Fix CVE-2024-11079 hostvars unsafe context (#84339) (#84353)\n\nFix to preserve an unsafe variable when accessing through an\r\nintermediary variable from hostvars.\r\n\r\n(cherry picked from commit 2936b80dbbc7efb889934aeec80f6142c10266ce)",
        "files": [
            {
                "sha": "cf7ca888e23473427f19c3604745c13b3a309886",
                "filename": "changelogs/fragments/unsafe_hostvars_fix.yml",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/ansible/ansible/blob/70e83e72b43e05e57eb42a6d52d01a4d9768f510/changelogs%2Ffragments%2Funsafe_hostvars_fix.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/70e83e72b43e05e57eb42a6d52d01a4d9768f510/changelogs%2Ffragments%2Funsafe_hostvars_fix.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/changelogs%2Ffragments%2Funsafe_hostvars_fix.yml?ref=70e83e72b43e05e57eb42a6d52d01a4d9768f510",
                "patch": "@@ -0,0 +1,2 @@\n+security_fixes:\n+  - Templating will not prefer AnsibleUnsafe when a variable is referenced via hostvars - CVE-2024-11079"
            },
            {
                "sha": "fedda75ac044f239a28c3799b3d2eaadb7ef89a3",
                "filename": "lib/ansible/template/__init__.py",
                "status": "modified",
                "additions": 1,
                "deletions": 30,
                "changes": 31,
                "blob_url": "https://github.com/ansible/ansible/blob/70e83e72b43e05e57eb42a6d52d01a4d9768f510/lib%2Fansible%2Ftemplate%2F__init__.py",
                "raw_url": "https://github.com/ansible/ansible/raw/70e83e72b43e05e57eb42a6d52d01a4d9768f510/lib%2Fansible%2Ftemplate%2F__init__.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Ftemplate%2F__init__.py?ref=70e83e72b43e05e57eb42a6d52d01a4d9768f510",
                "patch": "@@ -49,7 +49,7 @@\n from ansible.module_utils.common.text.converters import to_native, to_text, to_bytes\n from ansible.module_utils.common.collections import is_sequence\n from ansible.plugins.loader import filter_loader, lookup_loader, test_loader\n-from ansible.template.native_helpers import ansible_native_concat, ansible_eval_concat, ansible_concat\n+from ansible.template.native_helpers import AnsibleUndefined, ansible_native_concat, ansible_eval_concat, ansible_concat\n from ansible.template.template import AnsibleJ2Template\n from ansible.template.vars import AnsibleJ2Vars\n from ansible.utils.display import Display\n@@ -329,35 +329,6 @@ def wrapper(*args, **kwargs):\n     return _update_wrapper(wrapper, func)\n \n \n-class AnsibleUndefined(StrictUndefined):\n-    '''\n-    A custom Undefined class, which returns further Undefined objects on access,\n-    rather than throwing an exception.\n-    '''\n-    def __getattr__(self, name):\n-        if name == '__UNSAFE__':\n-            # AnsibleUndefined should never be assumed to be unsafe\n-            # This prevents ``hasattr(val, '__UNSAFE__')`` from evaluating to ``True``\n-            raise AttributeError(name)\n-        # Return original Undefined object to preserve the first failure context\n-        return self\n-\n-    def __getitem__(self, key):\n-        # Return original Undefined object to preserve the first failure context\n-        return self\n-\n-    def __repr__(self):\n-        return 'AnsibleUndefined(hint={0!r}, obj={1!r}, name={2!r})'.format(\n-            self._undefined_hint,\n-            self._undefined_obj,\n-            self._undefined_name\n-        )\n-\n-    def __contains__(self, item):\n-        # Return original Undefined object to preserve the first failure context\n-        return self\n-\n-\n class AnsibleContext(Context):\n     '''\n     A custom context, which intercepts resolve_or_missing() calls and sets a flag"
            },
            {
                "sha": "b20ae28cc3a80b9edde5763d55b50e138577a6bb",
                "filename": "lib/ansible/template/native_helpers.py",
                "status": "modified",
                "additions": 118,
                "deletions": 4,
                "changes": 122,
                "blob_url": "https://github.com/ansible/ansible/blob/70e83e72b43e05e57eb42a6d52d01a4d9768f510/lib%2Fansible%2Ftemplate%2Fnative_helpers.py",
                "raw_url": "https://github.com/ansible/ansible/raw/70e83e72b43e05e57eb42a6d52d01a4d9768f510/lib%2Fansible%2Ftemplate%2Fnative_helpers.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Ftemplate%2Fnative_helpers.py?ref=70e83e72b43e05e57eb42a6d52d01a4d9768f510",
                "patch": "@@ -7,13 +7,19 @@\n \n \n import ast\n+from collections.abc import Mapping\n from itertools import islice, chain\n from types import GeneratorType\n \n+from ansible.module_utils.common.collections import is_sequence\n from ansible.module_utils.common.text.converters import to_text\n from ansible.module_utils.six import string_types\n from ansible.parsing.yaml.objects import AnsibleVaultEncryptedUnicode\n from ansible.utils.native_jinja import NativeJinjaText\n+from ansible.utils.unsafe_proxy import wrap_var\n+import ansible.module_utils.compat.typing as t\n+\n+from jinja2.runtime import StrictUndefined\n \n \n _JSON_MAP = {\n@@ -30,6 +36,40 @@ def visit_Name(self, node):\n         return ast.Constant(value=_JSON_MAP[node.id])\n \n \n+def _is_unsafe(value: t.Any) -> bool:\n+    \"\"\"\n+    Our helper function, which will also recursively check dict and\n+    list entries due to the fact that they may be repr'd and contain\n+    a key or value which contains jinja2 syntax and would otherwise\n+    lose the AnsibleUnsafe value.\n+    \"\"\"\n+    to_check = [value]\n+    seen = set()\n+\n+    while True:\n+        if not to_check:\n+            break\n+\n+        val = to_check.pop(0)\n+        val_id = id(val)\n+\n+        if val_id in seen:\n+            continue\n+        seen.add(val_id)\n+\n+        if isinstance(val, AnsibleUndefined):\n+            continue\n+        if isinstance(val, Mapping):\n+            to_check.extend(val.keys())\n+            to_check.extend(val.values())\n+        elif is_sequence(val):\n+            to_check.extend(val)\n+        elif getattr(val, '__UNSAFE__', False):\n+            return True\n+\n+    return False\n+\n+\n def ansible_eval_concat(nodes):\n     \"\"\"Return a string of concatenated compiled nodes. Throw an undefined error\n     if any of the nodes is undefined.\n@@ -45,17 +85,28 @@ def ansible_eval_concat(nodes):\n     if not head:\n         return ''\n \n+    unsafe = False\n+\n     if len(head) == 1:\n         out = head[0]\n \n         if isinstance(out, NativeJinjaText):\n             return out\n \n+        unsafe = _is_unsafe(out)\n         out = to_text(out)\n     else:\n         if isinstance(nodes, GeneratorType):\n             nodes = chain(head, nodes)\n-        out = ''.join([to_text(v) for v in nodes])\n+\n+        out_values = []\n+        for v in nodes:\n+            if not unsafe and _is_unsafe(v):\n+                unsafe = True\n+\n+            out_values.append(to_text(v))\n+\n+        out = ''.join(out_values)\n \n     # if this looks like a dictionary, list or bool, convert it to such\n     if out.startswith(('{', '[')) or out in ('True', 'False'):\n@@ -70,6 +121,9 @@ def ansible_eval_concat(nodes):\n         except (TypeError, ValueError, SyntaxError, MemoryError):\n             pass\n \n+    if unsafe:\n+        out = wrap_var(out)\n+\n     return out\n \n \n@@ -80,7 +134,19 @@ def ansible_concat(nodes):\n \n     Used in Templar.template() when jinja2_native=False and convert_data=False.\n     \"\"\"\n-    return ''.join([to_text(v) for v in nodes])\n+    unsafe = False\n+    values = []\n+    for v in nodes:\n+        if not unsafe and _is_unsafe(v):\n+            unsafe = True\n+\n+        values.append(to_text(v))\n+\n+    out = ''.join(values)\n+    if unsafe:\n+        out = wrap_var(out)\n+\n+    return out\n \n \n def ansible_native_concat(nodes):\n@@ -97,6 +163,8 @@ def ansible_native_concat(nodes):\n     if not head:\n         return None\n \n+    unsafe = False\n+\n     if len(head) == 1:\n         out = head[0]\n \n@@ -117,10 +185,21 @@ def ansible_native_concat(nodes):\n         # short-circuit literal_eval for anything other than strings\n         if not isinstance(out, string_types):\n             return out\n+\n+        unsafe = _is_unsafe(out)\n+\n     else:\n         if isinstance(nodes, GeneratorType):\n             nodes = chain(head, nodes)\n-        out = ''.join([to_text(v) for v in nodes])\n+\n+        out_values = []\n+        for v in nodes:\n+            if not unsafe and _is_unsafe(v):\n+                unsafe = True\n+\n+            out_values.append(to_text(v))\n+\n+        out = ''.join(out_values)\n \n     try:\n         evaled = ast.literal_eval(\n@@ -130,10 +209,45 @@ def ansible_native_concat(nodes):\n             ast.parse(out, mode='eval')\n         )\n     except (TypeError, ValueError, SyntaxError, MemoryError):\n+        if unsafe:\n+            out = wrap_var(out)\n+\n         return out\n \n     if isinstance(evaled, string_types):\n         quote = out[0]\n-        return f'{quote}{evaled}{quote}'\n+        evaled = f'{quote}{evaled}{quote}'\n+\n+    if unsafe:\n+        evaled = wrap_var(evaled)\n \n     return evaled\n+\n+\n+class AnsibleUndefined(StrictUndefined):\n+    \"\"\"\n+    A custom Undefined class, which returns further Undefined objects on access,\n+    rather than throwing an exception.\n+    \"\"\"\n+    def __getattr__(self, name):\n+        if name == '__UNSAFE__':\n+            # AnsibleUndefined should never be assumed to be unsafe\n+            # This prevents ``hasattr(val, '__UNSAFE__')`` from evaluating to ``True``\n+            raise AttributeError(name)\n+        # Return original Undefined object to preserve the first failure context\n+        return self\n+\n+    def __getitem__(self, key):\n+        # Return original Undefined object to preserve the first failure context\n+        return self\n+\n+    def __repr__(self):\n+        return 'AnsibleUndefined(hint={0!r}, obj={1!r}, name={2!r})'.format(\n+            self._undefined_hint,\n+            self._undefined_obj,\n+            self._undefined_name\n+        )\n+\n+    def __contains__(self, item):\n+        # Return original Undefined object to preserve the first failure context\n+        return self"
            },
            {
                "sha": "9ab0795e8007a5ce78dbfb6ab9a43af8c5f51c56",
                "filename": "lib/ansible/vars/hostvars.py",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/ansible/ansible/blob/70e83e72b43e05e57eb42a6d52d01a4d9768f510/lib%2Fansible%2Fvars%2Fhostvars.py",
                "raw_url": "https://github.com/ansible/ansible/raw/70e83e72b43e05e57eb42a6d52d01a4d9768f510/lib%2Fansible%2Fvars%2Fhostvars.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Fvars%2Fhostvars.py?ref=70e83e72b43e05e57eb42a6d52d01a4d9768f510",
                "patch": "@@ -94,11 +94,12 @@ def __contains__(self, host_name):\n         return self._find_host(host_name) is not None\n \n     def __iter__(self):\n-        for host in self._inventory.hosts:\n-            yield host\n+        # include implicit localhost only if it has variables set\n+        yield from self._inventory.hosts | {'localhost': self._inventory.localhost} if self._inventory.localhost else {}\n \n     def __len__(self):\n-        return len(self._inventory.hosts)\n+        # include implicit localhost only if it has variables set\n+        return len(self._inventory.hosts) + (1 if self._inventory.localhost else 0)\n \n     def __repr__(self):\n         out = {}"
            },
            {
                "sha": "00eb16d995dc5876ea1d93028598a552d26e3b85",
                "filename": "test/integration/targets/template/cve-2024-11079.yml",
                "status": "added",
                "additions": 30,
                "deletions": 0,
                "changes": 30,
                "blob_url": "https://github.com/ansible/ansible/blob/70e83e72b43e05e57eb42a6d52d01a4d9768f510/test%2Fintegration%2Ftargets%2Ftemplate%2Fcve-2024-11079.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/70e83e72b43e05e57eb42a6d52d01a4d9768f510/test%2Fintegration%2Ftargets%2Ftemplate%2Fcve-2024-11079.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Ftemplate%2Fcve-2024-11079.yml?ref=70e83e72b43e05e57eb42a6d52d01a4d9768f510",
                "patch": "@@ -0,0 +1,30 @@\n+- name: test CVE-2024-11079 loop variables preserve unsafe hostvars\n+  hosts: localhost\n+  gather_facts: false\n+  tasks:\n+  - set_fact:\n+      foo:\n+        safe:\n+          prop: '{{ \"{{\" }} unsafe_var {{ \"}}\" }}'\n+        unsafe:\n+          prop: !unsafe '{{ unsafe_var }}'\n+\n+  - name: safe var through hostvars loop is templated\n+    assert:\n+      that:\n+      - item.prop == expected\n+    loop:\n+    - \"{{ hostvars['localhost']['foo']['safe'] }}\"\n+    vars:\n+      unsafe_var: bar\n+      expected: bar\n+\n+  - name: unsafe var through hostvars loop is not templated\n+    assert:\n+      that:\n+      - item.prop == expected\n+    loop:\n+    - \"{{ hostvars['localhost']['foo']['unsafe'] }}\"\n+    vars:\n+      unsafe_var: bar\n+      expected: !unsafe '{{ unsafe_var }}'"
            },
            {
                "sha": "f9050b994478dd4625997c61205b570916b6632a",
                "filename": "test/integration/targets/template/runme.sh",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/ansible/ansible/blob/70e83e72b43e05e57eb42a6d52d01a4d9768f510/test%2Fintegration%2Ftargets%2Ftemplate%2Frunme.sh",
                "raw_url": "https://github.com/ansible/ansible/raw/70e83e72b43e05e57eb42a6d52d01a4d9768f510/test%2Fintegration%2Ftargets%2Ftemplate%2Frunme.sh",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Ftemplate%2Frunme.sh?ref=70e83e72b43e05e57eb42a6d52d01a4d9768f510",
                "patch": "@@ -41,6 +41,10 @@ ansible-playbook 72262.yml -v \"$@\"\n # ensure unsafe is preserved, even with extra newlines\n ansible-playbook unsafe.yml -v \"$@\"\n \n+# CVE 2024-11079\n+ANSIBLE_JINJA2_NATIVE=true ansible-playbook cve-2024-11079.yml -v \"$@\"\n+ANSIBLE_JINJA2_NATIVE=false ansible-playbook cve-2024-11079.yml -v \"$@\"\n+\n # ensure Jinja2 overrides from a template are used\n ansible-playbook template_overrides.yml -v \"$@\"\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Stirling-Tools/Stirling-PDF/commits/404e31468ec98413f1906cc7ee3d49091638c693",
        "url": "https://api.github.com/repos/Stirling-Tools/Stirling-PDF/commits/404e31468ec98413f1906cc7ee3d49091638c693",
        "html_url": "https://github.com/Stirling-Tools/Stirling-PDF/commit/404e31468ec98413f1906cc7ee3d49091638c693",
        "message": "Added input sanitization to fix self-xss issue (#2189)",
        "files": [
            {
                "sha": "2c9a393976dc13c11d6f395ba15e77f80c46210b",
                "filename": "src/main/resources/static/js/merge.js",
                "status": "modified",
                "additions": 41,
                "deletions": 13,
                "changes": 54,
                "blob_url": "https://github.com/Stirling-Tools/Stirling-PDF/blob/404e31468ec98413f1906cc7ee3d49091638c693/src%2Fmain%2Fresources%2Fstatic%2Fjs%2Fmerge.js",
                "raw_url": "https://github.com/Stirling-Tools/Stirling-PDF/raw/404e31468ec98413f1906cc7ee3d49091638c693/src%2Fmain%2Fresources%2Fstatic%2Fjs%2Fmerge.js",
                "contents_url": "https://api.github.com/repos/Stirling-Tools/Stirling-PDF/contents/src%2Fmain%2Fresources%2Fstatic%2Fjs%2Fmerge.js?ref=404e31468ec98413f1906cc7ee3d49091638c693",
                "patch": "@@ -21,27 +21,55 @@ async function displayFiles(files) {\n   for (let i = 0; i < files.length; i++) {\n     const pageCount = await getPDFPageCount(files[i]);\n     const pageLabel = pageCount === 1 ? pageTranslation : pagesTranslation;\n+    \n+    // Create list item\n     const item = document.createElement(\"li\");\n     item.className = \"list-group-item\";\n-    item.innerHTML = `\n-            <div class=\"d-flex justify-content-between align-items-center w-100\">\n-                <div class=\"filename\">${files[i].name}</div>\n-                <div class=\"page-info\">\n-                    <span class=\"page-count\">${pageCount} ${pageLabel}</span>\n-                </div>\n-                <div class=\"arrows d-flex\">\n-                    <button class=\"btn btn-secondary move-up\"><span>&uarr;</span></button>\n-                    <button class=\"btn btn-secondary move-down\"><span>&darr;</span></button>\n-                    <button class=\"btn btn-danger remove-file\"><span>&times;</span></button>\n-                </div>\n-            </div>\n-        `;\n+\n+    // Create filename div and set textContent to sanitize\n+    const fileNameDiv = document.createElement(\"div\");\n+    fileNameDiv.className = \"filename\";\n+    fileNameDiv.textContent = files[i].name;\n+\n+    // Create page info div and set textContent to sanitize\n+    const pageInfoDiv = document.createElement(\"div\");\n+    pageInfoDiv.className = \"page-info\";\n+    const pageCountSpan = document.createElement(\"span\");\n+    pageCountSpan.className = \"page-count\";\n+    pageCountSpan.textContent = `${pageCount} ${pageLabel}`;\n+    pageInfoDiv.appendChild(pageCountSpan);\n+\n+    // Create arrows div with buttons\n+    const arrowsDiv = document.createElement(\"div\");\n+    arrowsDiv.className = \"arrows d-flex\";\n+\n+    const moveUpButton = document.createElement(\"button\");\n+    moveUpButton.className = \"btn btn-secondary move-up\";\n+    moveUpButton.innerHTML = \"<span>&uarr;</span>\";\n+\n+    const moveDownButton = document.createElement(\"button\");\n+    moveDownButton.className = \"btn btn-secondary move-down\";\n+    moveDownButton.innerHTML = \"<span>&darr;</span>\";\n+\n+    const removeButton = document.createElement(\"button\");\n+    removeButton.className = \"btn btn-danger remove-file\";\n+    removeButton.innerHTML = \"<span>&times;</span>\";\n+\n+    arrowsDiv.append(moveUpButton, moveDownButton, removeButton);\n+\n+    // Append elements to item and then to list\n+    const itemContainer = document.createElement(\"div\");\n+    itemContainer.className = \"d-flex justify-content-between align-items-center w-100\";\n+    itemContainer.append(fileNameDiv, pageInfoDiv, arrowsDiv);\n+\n+    item.appendChild(itemContainer);\n     list.appendChild(item);\n   }\n \n   attachMoveButtons();\n }\n \n+\n async function getPDFPageCount(file) {\n   const blobUrl = URL.createObjectURL(file);\n   const pdf = await pdfjsLib.getDocument(blobUrl).promise;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/goToMain/libosdp/commits/298576d9214b48214092eebdd892ec77be085e5a",
        "url": "https://api.github.com/repos/goToMain/libosdp/commits/298576d9214b48214092eebdd892ec77be085e5a",
        "html_url": "https://github.com/goToMain/libosdp/commit/298576d9214b48214092eebdd892ec77be085e5a",
        "message": "cp: disallow unexpected SC responses\n\nWhen CP has a secure channel active, it should never receive a\nREPLY_CCRYPT or REPLY_RMAC_I. Since these responses change the SC state,\nlet's also make sure that they are accepted only when they are\nexpected: in response to commands CMD_CHLNG and CMD_SCRYPT respectively.\n\nSince this incident has some security implication, let's increase the\nlog level of such out-of-order messages to EMERGENCY so they can be\ntriaged appropriately.\n\nReported-by: Eran Jacob <eran.jacob@otorio.com>\nSigned-off-by: Siddharth Chandrasekaran <sidcha.dev@gmail.com>",
        "files": [
            {
                "sha": "faf8d9038abe147fc8b0c550a99d18f731febfa9",
                "filename": "src/osdp_cp.c",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/goToMain/libosdp/blob/298576d9214b48214092eebdd892ec77be085e5a/src%2Fosdp_cp.c",
                "raw_url": "https://github.com/goToMain/libosdp/raw/298576d9214b48214092eebdd892ec77be085e5a/src%2Fosdp_cp.c",
                "contents_url": "https://api.github.com/repos/goToMain/libosdp/contents/src%2Fosdp_cp.c?ref=298576d9214b48214092eebdd892ec77be085e5a",
                "patch": "@@ -639,6 +639,10 @@ static int cp_decode_response(struct osdp_pd *pd, uint8_t *buf, int len)\n \t\tret = osdp_file_cmd_stat_decode(pd, buf + pos, len);\n \t\tbreak;\n \tcase REPLY_CCRYPT:\n+\t\tif (sc_is_active(pd) || pd->cmd_id != CMD_CHLNG) {\n+\t\t\tLOG_EM(\"Out of order REPLY_CCRYPT; has PD gone rogue?\");\n+\t\t\tbreak;\n+\t\t}\n \t\tif (len != REPLY_CCRYPT_DATA_LEN) {\n \t\t\tbreak;\n \t\t}\n@@ -654,6 +658,10 @@ static int cp_decode_response(struct osdp_pd *pd, uint8_t *buf, int len)\n \t\tret = OSDP_CP_ERR_NONE;\n \t\tbreak;\n \tcase REPLY_RMAC_I:\n+\t\tif (sc_is_active(pd) || pd->cmd_id != CMD_SCRYPT) {\n+\t\t\tLOG_EM(\"Out of order REPLY_RMAC_I; has PD gone rogue?\");\n+\t\t\tbreak;\n+\t\t}\n \t\tif (len != REPLY_RMAC_I_DATA_LEN) {\n \t\t\tbreak;\n \t\t}"
            },
            {
                "sha": "b1e31cb46a993b330a49242f1da46267909c5894",
                "filename": "src/osdp_pd.c",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/goToMain/libosdp/blob/298576d9214b48214092eebdd892ec77be085e5a/src%2Fosdp_pd.c",
                "raw_url": "https://github.com/goToMain/libosdp/raw/298576d9214b48214092eebdd892ec77be085e5a/src%2Fosdp_pd.c",
                "contents_url": "https://api.github.com/repos/goToMain/libosdp/contents/src%2Fosdp_pd.c?ref=298576d9214b48214092eebdd892ec77be085e5a",
                "patch": "@@ -621,7 +621,7 @@ static int pd_decode_command(struct osdp_pd *pd, uint8_t *buf, int len)\n \t\tif (sc_is_active(pd)) {\n \t\t\tpd->reply_id = REPLY_NAK;\n \t\t\tpd->ephemeral_data[0] = OSDP_PD_NAK_SC_COND;\n-\t\t\tLOG_WRN(\"Out of order CMD_SCRYPT; has CP gone rogue?\");\n+\t\t\tLOG_EM(\"Out of order CMD_SCRYPT; has CP gone rogue?\");\n \t\t\tbreak;\n \t\t}\n \t\tmemcpy(pd->sc.cp_cryptogram, buf + pos, CMD_SCRYPT_DATA_LEN);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moodle/moodle/commits/c7d9026715a107ee16b9f9b2134ed4e6f667af99",
        "url": "https://api.github.com/repos/moodle/moodle/commits/c7d9026715a107ee16b9f9b2134ed4e6f667af99",
        "html_url": "https://github.com/moodle/moodle/commit/c7d9026715a107ee16b9f9b2134ed4e6f667af99",
        "message": "MDL-82558 h5p: escape template error/exception content.",
        "files": [
            {
                "sha": "df2ddf8918ba4a5063b85a82452eafd2cc07fd7b",
                "filename": "h5p/templates/h5perror.mustache",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/moodle/moodle/blob/c7d9026715a107ee16b9f9b2134ed4e6f667af99/h5p%2Ftemplates%2Fh5perror.mustache",
                "raw_url": "https://github.com/moodle/moodle/raw/c7d9026715a107ee16b9f9b2134ed4e6f667af99/h5p%2Ftemplates%2Fh5perror.mustache",
                "contents_url": "https://api.github.com/repos/moodle/moodle/contents/h5p%2Ftemplates%2Fh5perror.mustache?ref=c7d9026715a107ee16b9f9b2134ed4e6f667af99",
                "patch": "@@ -43,17 +43,17 @@\n    <div class=\"container mt-5\">\n       {{#exception}}\n       <div class=\"alert alert-block fade in alert-danger my-2\" role=\"alert\">\n-         {{{ exception }}}\n+         {{ . }}\n       </div>\n       {{/exception}}\n       {{#info}}\n       <div class=\"alert alert-block fade in alert-info my-2\" role=\"alert\">\n-         {{{ . }}}\n+         {{ . }}\n       </div>\n       {{/info}}\n       {{#error}}\n       <div class=\"alert alert-block fade in alert-warning my-2\" role=\"alert\">\n-         {{#code}}{{{code}}} : {{/code}}{{{ message }}}\n+         {{#code}} {{ . }} : {{/code}} {{ message }}\n       </div>\n       {{/error}}\n    </div>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/runatlantis/atlantis/commits/0def7d3fb74aabb75570554692b053950cde02e1",
        "url": "https://api.github.com/repos/runatlantis/atlantis/commits/0def7d3fb74aabb75570554692b053950cde02e1",
        "html_url": "https://github.com/runatlantis/atlantis/commit/0def7d3fb74aabb75570554692b053950cde02e1",
        "message": "feat: Dont log GitHub app token in logs",
        "files": [
            {
                "sha": "d5b059f972ffd7b0a4cf968ff76c557ce5895a82",
                "filename": "server/events/vcs/gh_app_creds_rotator.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/runatlantis/atlantis/blob/0def7d3fb74aabb75570554692b053950cde02e1/server%2Fevents%2Fvcs%2Fgh_app_creds_rotator.go",
                "raw_url": "https://github.com/runatlantis/atlantis/raw/0def7d3fb74aabb75570554692b053950cde02e1/server%2Fevents%2Fvcs%2Fgh_app_creds_rotator.go",
                "contents_url": "https://api.github.com/repos/runatlantis/atlantis/contents/server%2Fevents%2Fvcs%2Fgh_app_creds_rotator.go?ref=0def7d3fb74aabb75570554692b053950cde02e1",
                "patch": "@@ -61,7 +61,7 @@ func (r *githubAppTokenRotator) rotate() error {\n \tif err != nil {\n \t\treturn errors.Wrap(err, \"Getting github token\")\n \t}\n-\tr.log.Debug(\"token %s\", token)\n+\tr.log.Debug(\"Token successfully refreshed\")\n \n \t// https://developer.github.com/apps/building-github-apps/authenticating-with-github-apps/#http-based-git-access-by-an-installation\n \tif err := WriteGitCreds(\"x-access-token\", token, r.githubHostname, r.homeDirPath, r.log, true); err != nil {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moxystudio/node-cross-spawn/commits/640d391fde65388548601d95abedccc12943374f",
        "url": "https://api.github.com/repos/moxystudio/node-cross-spawn/commits/640d391fde65388548601d95abedccc12943374f",
        "html_url": "https://github.com/moxystudio/node-cross-spawn/commit/640d391fde65388548601d95abedccc12943374f",
        "message": "fix: fix escaping bug introduced by backtracking",
        "files": [
            {
                "sha": "7bf2905cd035ad517486b0b0549f660551a2e199",
                "filename": "lib/util/escape.js",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/moxystudio/node-cross-spawn/blob/640d391fde65388548601d95abedccc12943374f/lib%2Futil%2Fescape.js",
                "raw_url": "https://github.com/moxystudio/node-cross-spawn/raw/640d391fde65388548601d95abedccc12943374f/lib%2Futil%2Fescape.js",
                "contents_url": "https://api.github.com/repos/moxystudio/node-cross-spawn/contents/lib%2Futil%2Fescape.js?ref=640d391fde65388548601d95abedccc12943374f",
                "patch": "@@ -20,12 +20,12 @@ function escapeArgument(arg, doubleEscapeMetaChars) {\n \n     // Sequence of backslashes followed by a double quote:\n     // double up all the backslashes and escape the double quote\n-    arg = arg.replace(/(?=\\\\*?)\"/g, '$1$1\\\\\"');\n+    arg = arg.replace(/(?=(\\\\+?)?)\\1\"/g, '$1$1\\\\\"');\n \n     // Sequence of backslashes followed by the end of the string\n     // (which will become a double quote later):\n     // double up all the backslashes\n-    arg = arg.replace(/(?=\\\\*?)$/, '$1$1');\n+    arg = arg.replace(/(?=(\\\\+?)?)\\1$/, '$1$1');\n \n     // All other backslashes occur literally\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moxystudio/node-cross-spawn/commits/d35c865b877d2f9ded7c1ed87521c2fdb689c8dd",
        "url": "https://api.github.com/repos/moxystudio/node-cross-spawn/commits/d35c865b877d2f9ded7c1ed87521c2fdb689c8dd",
        "html_url": "https://github.com/moxystudio/node-cross-spawn/commit/d35c865b877d2f9ded7c1ed87521c2fdb689c8dd",
        "message": "chore(release): 6.0.6",
        "files": [
            {
                "sha": "c17c7c9ebd51e6ba06829c6761295e97dbb03d42",
                "filename": "CHANGELOG.md",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/moxystudio/node-cross-spawn/blob/d35c865b877d2f9ded7c1ed87521c2fdb689c8dd/CHANGELOG.md",
                "raw_url": "https://github.com/moxystudio/node-cross-spawn/raw/d35c865b877d2f9ded7c1ed87521c2fdb689c8dd/CHANGELOG.md",
                "contents_url": "https://api.github.com/repos/moxystudio/node-cross-spawn/contents/CHANGELOG.md?ref=d35c865b877d2f9ded7c1ed87521c2fdb689c8dd",
                "patch": "@@ -2,6 +2,17 @@\n \n All notable changes to this project will be documented in this file. See [standard-version](https://github.com/conventional-changelog/standard-version) for commit guidelines.\n \n+<a name=\"6.0.6\"></a>\n+## [6.0.6](https://github.com/moxystudio/node-cross-spawn/compare/v6.0.5...v6.0.6) (2024-11-18)\n+\n+\n+### Bug Fixes\n+\n+* disable regexp backtracking ([#160](https://github.com/moxystudio/node-cross-spawn/issues/160)) ([ba5aaef](https://github.com/moxystudio/node-cross-spawn/commit/ba5aaef))\n+* **core:** support worker threads ([#127](https://github.com/moxystudio/node-cross-spawn/issues/127)) ([f4af31c](https://github.com/moxystudio/node-cross-spawn/commit/f4af31c))\n+\n+\n+\n <a name=\"6.0.5\"></a>\n ## [6.0.5](https://github.com/moxystudio/node-cross-spawn/compare/v6.0.4...v6.0.5) (2018-03-02)\n "
            },
            {
                "sha": "21e2be587dc24a975b675950309b6b98e4288bb0",
                "filename": "package-lock.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/moxystudio/node-cross-spawn/blob/d35c865b877d2f9ded7c1ed87521c2fdb689c8dd/package-lock.json",
                "raw_url": "https://github.com/moxystudio/node-cross-spawn/raw/d35c865b877d2f9ded7c1ed87521c2fdb689c8dd/package-lock.json",
                "contents_url": "https://api.github.com/repos/moxystudio/node-cross-spawn/contents/package-lock.json?ref=d35c865b877d2f9ded7c1ed87521c2fdb689c8dd",
                "patch": "@@ -1,6 +1,6 @@\n {\n   \"name\": \"cross-spawn\",\n-  \"version\": \"6.0.5\",\n+  \"version\": \"6.0.6\",\n   \"lockfileVersion\": 3,\n   \"requires\": true,\n   \"packages\": {"
            },
            {
                "sha": "e5d800007220aff161ecbc7a3984cc0d73512509",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/moxystudio/node-cross-spawn/blob/d35c865b877d2f9ded7c1ed87521c2fdb689c8dd/package.json",
                "raw_url": "https://github.com/moxystudio/node-cross-spawn/raw/d35c865b877d2f9ded7c1ed87521c2fdb689c8dd/package.json",
                "contents_url": "https://api.github.com/repos/moxystudio/node-cross-spawn/contents/package.json?ref=d35c865b877d2f9ded7c1ed87521c2fdb689c8dd",
                "patch": "@@ -1,6 +1,6 @@\n {\n   \"name\": \"cross-spawn\",\n-  \"version\": \"6.0.5\",\n+  \"version\": \"6.0.6\",\n   \"description\": \"Cross platform child_process#spawn and child_process#spawnSync\",\n   \"keywords\": [\n     \"spawn\","
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/moxystudio/node-cross-spawn/commits/5ff3a07d9add449021d806e45c4168203aa833ff",
        "url": "https://api.github.com/repos/moxystudio/node-cross-spawn/commits/5ff3a07d9add449021d806e45c4168203aa833ff",
        "html_url": "https://github.com/moxystudio/node-cross-spawn/commit/5ff3a07d9add449021d806e45c4168203aa833ff",
        "message": "fix: disable regexp backtracking (#160)",
        "files": [
            {
                "sha": "e4804b997e52e5effd844270271d7c39c7563372",
                "filename": "lib/util/escape.js",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/moxystudio/node-cross-spawn/blob/5ff3a07d9add449021d806e45c4168203aa833ff/lib%2Futil%2Fescape.js",
                "raw_url": "https://github.com/moxystudio/node-cross-spawn/raw/5ff3a07d9add449021d806e45c4168203aa833ff/lib%2Futil%2Fescape.js",
                "contents_url": "https://api.github.com/repos/moxystudio/node-cross-spawn/contents/lib%2Futil%2Fescape.js?ref=5ff3a07d9add449021d806e45c4168203aa833ff",
                "patch": "@@ -15,15 +15,17 @@ function escapeArgument(arg, doubleEscapeMetaChars) {\n     arg = `${arg}`;\n \n     // Algorithm below is based on https://qntm.org/cmd\n+    // It's slightly altered to disable JS backtracking to avoid hanging on specially crafted input\n+    // Please see https://github.com/moxystudio/node-cross-spawn/pull/160 for more information\n \n     // Sequence of backslashes followed by a double quote:\n     // double up all the backslashes and escape the double quote\n-    arg = arg.replace(/(\\\\*)\"/g, '$1$1\\\\\"');\n+    arg = arg.replace(/(?=\\\\*?)\"/g, '$1$1\\\\\"');\n \n     // Sequence of backslashes followed by the end of the string\n     // (which will become a double quote later):\n     // double up all the backslashes\n-    arg = arg.replace(/(\\\\*)$/, '$1$1');\n+    arg = arg.replace(/(?=\\\\*?)$/, '$1$1');\n \n     // All other backslashes occur literally\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/wasm3/wasm3/commits/526c1251b64e6e9fdc0d40c768ae46cd20338594",
        "url": "https://api.github.com/repos/wasm3/wasm3/commits/526c1251b64e6e9fdc0d40c768ae46cd20338594",
        "html_url": "https://github.com/wasm3/wasm3/commit/526c1251b64e6e9fdc0d40c768ae46cd20338594",
        "message": "fix: Releases M3Module.memoryImport. (#490)\n\nFixes #462",
        "files": [
            {
                "sha": "507981df71b79b5b442a1c40712bd8979cea6220",
                "filename": "source/m3_module.c",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/wasm3/wasm3/blob/526c1251b64e6e9fdc0d40c768ae46cd20338594/source%2Fm3_module.c",
                "raw_url": "https://github.com/wasm3/wasm3/raw/526c1251b64e6e9fdc0d40c768ae46cd20338594/source%2Fm3_module.c",
                "contents_url": "https://api.github.com/repos/wasm3/wasm3/contents/source%2Fm3_module.c?ref=526c1251b64e6e9fdc0d40c768ae46cd20338594",
                "patch": "@@ -40,6 +40,7 @@ void  m3_FreeModule  (IM3Module i_module)\n             FreeImportInfo(&(i_module->globals[i].import));\n         }\n         m3_Free (i_module->globals);\n+        FreeImportInfo(&i_module->memoryImport);\n \n         m3_Free (i_module);\n     }"
            },
            {
                "sha": "00389a616ec785f7a9ee9cb128e1c40f3cbe33d4",
                "filename": "test/regression/github-462.wasm",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/wasm3/wasm3/blob/526c1251b64e6e9fdc0d40c768ae46cd20338594/test%2Fregression%2Fgithub-462.wasm",
                "raw_url": "https://github.com/wasm3/wasm3/raw/526c1251b64e6e9fdc0d40c768ae46cd20338594/test%2Fregression%2Fgithub-462.wasm",
                "contents_url": "https://api.github.com/repos/wasm3/wasm3/contents/test%2Fregression%2Fgithub-462.wasm?ref=526c1251b64e6e9fdc0d40c768ae46cd20338594"
            },
            {
                "sha": "a188e051f30dedbf4ea4bbfad09b78665f8ab6b5",
                "filename": "test/regression/github-462.wat",
                "status": "added",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/wasm3/wasm3/blob/526c1251b64e6e9fdc0d40c768ae46cd20338594/test%2Fregression%2Fgithub-462.wat",
                "raw_url": "https://github.com/wasm3/wasm3/raw/526c1251b64e6e9fdc0d40c768ae46cd20338594/test%2Fregression%2Fgithub-462.wat",
                "contents_url": "https://api.github.com/repos/wasm3/wasm3/contents/test%2Fregression%2Fgithub-462.wat?ref=526c1251b64e6e9fdc0d40c768ae46cd20338594",
                "patch": "@@ -0,0 +1,7 @@\n+(module\n+  (import \"mod\" \"mem\" (memory 0 1))\n+  (type (;0;) (func (result i32)))\n+  (func (;0;) (type 0) (result i32)\n+    i32.const 0\n+  )\n+  (export \"_start\" (func 0)))"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/x-stream/xstream/commits/bb838ce2269cac47433e31c77b2b236466e9f266",
        "url": "https://api.github.com/repos/x-stream/xstream/commits/bb838ce2269cac47433e31c77b2b236466e9f266",
        "html_url": "https://github.com/x-stream/xstream/commit/bb838ce2269cac47433e31c77b2b236466e9f266",
        "message": "Document CVE-2024-47072 and add test case.",
        "files": [
            {
                "sha": "9e021709b76bf40cf0ad3cea705e99018e57b0b5",
                "filename": "xstream-distribution/src/content/CVE-2024-47072.html",
                "status": "added",
                "additions": 68,
                "deletions": 0,
                "changes": 68,
                "blob_url": "https://github.com/x-stream/xstream/blob/bb838ce2269cac47433e31c77b2b236466e9f266/xstream-distribution%2Fsrc%2Fcontent%2FCVE-2024-47072.html",
                "raw_url": "https://github.com/x-stream/xstream/raw/bb838ce2269cac47433e31c77b2b236466e9f266/xstream-distribution%2Fsrc%2Fcontent%2FCVE-2024-47072.html",
                "contents_url": "https://api.github.com/repos/x-stream/xstream/contents/xstream-distribution%2Fsrc%2Fcontent%2FCVE-2024-47072.html?ref=bb838ce2269cac47433e31c77b2b236466e9f266",
                "patch": "@@ -0,0 +1,68 @@\n+<html>\n+<!--\n+ Copyright (C) 2024 XStream committers.\n+ All rights reserved.\n+ \n+ The software in this package is published under the terms of the BSD\n+ style license a copy of which has been included with this distribution in\n+ the LICENSE.txt file.\n+ \n+ Created on 19. September 2024 by Joerg Schaible\n+ -->\n+  <head>\n+    <title>CVE-2024-47072</title>\n+  </head>\n+  <body>\n+\n+    <h2 id=\"vulnerability\">Vulnerability</h2>\n+    \n+    <p>CVE-2024-47072: XStream is vulnerable to a Denial of Service attack due to stack overflow from a manipulated\n+\tbinary input stream.</p>\n+    \n+    <h2 id=\"affected_versions\">Affected Versions</h2>\n+    \n+    <p>All versions until and including version 1.4.20 are affected, if using XStream's BinaryStreamDriver.</p>\n+\n+    <h2 id=\"description\">Description</h2>\n+    \n+    <p>XStream provides a BinaryStreamDriver with an own optimized serialization format.  The format uses ids for\n+\tstring values as deduplication.  The mapping for these ids are created on-the-fly at marshalling time.  At\n+\tunmarshalling time the reader's implementation simply used a simple one-time recursion after reading a mapping\n+\ttoken to process the next normal token of the data stream.  However, an endless recursion could be triggered with\n+\tmanipulated input data resulting in a stack overflow causing a denial of service.</p>\n+\n+    <h2 id=\"reproduction\">Steps to Reproduce</h2>\n+\n+    <p>Prepare the manipulated data and provide it as input for a XStream instance using the BinaryDriver:</p>\n+<div class=\"Source Java\"><pre>final byte[] byteArray = new byte[36000];\n+for (int i = 0; i &lt; byteArray.length / 4; i++) {\n+      byteArray[i * 4] = 10;\n+      byteArray[i * 4 + 1] = -127;\n+      byteArray[i * 4 + 2] = 0;\n+      byteArray[i * 4 + 3] = 0;\n+}\n+\n+XStream xstream = new XStream(new BinaryStreamDriver());\n+xstream.fromXML(new ByteArrayInputStream(byteArray));\n+</pre></div>\n+\n+    <p>As soon as the data gets unmarshalled, the endless recursion is entered and the executing thread is aborted with\n+\ta stack overflow error.</p>\n+\n+    <h2 id=\"impact\">Impact</h2>\n+\n+    <p>The vulnerability may allow a remote attacker to terminate the application with a stack overflow error resulting\n+    in a denial of service only by manipulating the processed input stream if the instance is setup with a\n+\tBinaryStreamDriver.</p>\n+\n+    <h2 id=\"workarounds\">Workarounds</h2>\n+\n+\t<p>A simple solution is to catch the StackOverflowError in the client code calling XStream.  There's no other known\n+\tworkaround when using the BinaryStreamDriver.</p>\n+\n+    <h2 id=\"credits\">Credits</h2>\n+    \n+    <p>Alexis Challande of Trail Of Bits found and reported the issue to XStream and provided the required information to reproduce it.</p>\n+    \n+      </body>\n+ </html>"
            },
            {
                "sha": "1a68de0a833eb0ecfd699d79da381354d5e49d4e",
                "filename": "xstream-distribution/src/content/security.html",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/x-stream/xstream/blob/bb838ce2269cac47433e31c77b2b236466e9f266/xstream-distribution%2Fsrc%2Fcontent%2Fsecurity.html",
                "raw_url": "https://github.com/x-stream/xstream/raw/bb838ce2269cac47433e31c77b2b236466e9f266/xstream-distribution%2Fsrc%2Fcontent%2Fsecurity.html",
                "contents_url": "https://api.github.com/repos/x-stream/xstream/contents/xstream-distribution%2Fsrc%2Fcontent%2Fsecurity.html?ref=bb838ce2269cac47433e31c77b2b236466e9f266",
                "patch": "@@ -1,6 +1,6 @@\n <html>\n <!--\n- Copyright (C) 2014, 2015, 2017, 2019, 2020, 2021, 2022 XStream committers.\n+ Copyright (C) 2014, 2015, 2017, 2019, 2020, 2021, 2022, 2024 XStream committers.\n  All rights reserved.\n  \n  The software in this package is published under the terms of the BSD\n@@ -49,6 +49,15 @@ <h2 id=\"CVEs\">Documented Vulnerabilities</h2>\n         <th>CVE</th>\n         <th>Description</th>\n       </tr>\n+\t  <tr>\n+\t    <th>Version 1.4.21</th>\n+\t    <td></td>\n+\t  </tr>\n+\t  <tr>\n+\t    <th><a href=\"CVE-2024-47072.html\">CVE-2024-47072</a></th>\n+\t    <td>XStream is vulnerable to a Denial of Service attack due to stack overflow from a manipulated binary input\n+\t\tstream.</td>\n+\t  </tr>\n       <tr>\n         <th>Version 1.4.19</th>\n         <td></td>"
            },
            {
                "sha": "c6b253fb31b8c6b3a1a852d534687ebe29d366d8",
                "filename": "xstream-distribution/src/content/website.xml",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/x-stream/xstream/blob/bb838ce2269cac47433e31c77b2b236466e9f266/xstream-distribution%2Fsrc%2Fcontent%2Fwebsite.xml",
                "raw_url": "https://github.com/x-stream/xstream/raw/bb838ce2269cac47433e31c77b2b236466e9f266/xstream-distribution%2Fsrc%2Fcontent%2Fwebsite.xml",
                "contents_url": "https://api.github.com/repos/x-stream/xstream/contents/xstream-distribution%2Fsrc%2Fcontent%2Fwebsite.xml?ref=bb838ce2269cac47433e31c77b2b236466e9f266",
                "patch": "@@ -1,6 +1,6 @@\n <!--\n  Copyright (C) 2005, 2006 Joe Walnes.\n- Copyright (C) 2006, 2007, 2010, 2011, 2014, 2015, 2016, 2017, 2020, 2021, 2022 XStream committers.\n+ Copyright (C) 2006, 2007, 2010, 2011, 2014, 2015, 2016, 2017, 2020, 2021, 2022, 2024 XStream committers.\n  All rights reserved.\n  \n  The software in this package is published under the terms of the BSD\n@@ -63,6 +63,7 @@\n     </section>\n     <section>\n         <name>!Vulnerabilities</name>\n+        <page>CVE-2024-47072.html</page>\n         <page>CVE-2022-41966.html</page>\n         <page>CVE-2022-40151.html</page>\n         <page>CVE-2021-21341.html</page>"
            },
            {
                "sha": "49281fd0665c72e11b2020081cc3768ec93a239a",
                "filename": "xstream/src/test/com/thoughtworks/acceptance/SecurityVulnerabilityTest.java",
                "status": "modified",
                "additions": 19,
                "deletions": 0,
                "changes": 19,
                "blob_url": "https://github.com/x-stream/xstream/blob/bb838ce2269cac47433e31c77b2b236466e9f266/xstream%2Fsrc%2Ftest%2Fcom%2Fthoughtworks%2Facceptance%2FSecurityVulnerabilityTest.java",
                "raw_url": "https://github.com/x-stream/xstream/raw/bb838ce2269cac47433e31c77b2b236466e9f266/xstream%2Fsrc%2Ftest%2Fcom%2Fthoughtworks%2Facceptance%2FSecurityVulnerabilityTest.java",
                "contents_url": "https://api.github.com/repos/x-stream/xstream/contents/xstream%2Fsrc%2Ftest%2Fcom%2Fthoughtworks%2Facceptance%2FSecurityVulnerabilityTest.java?ref=bb838ce2269cac47433e31c77b2b236466e9f266",
                "patch": "@@ -26,8 +26,10 @@\n import java.util.Map;\n import java.util.Set;\n \n+import com.thoughtworks.xstream.XStream;\n import com.thoughtworks.xstream.converters.ConversionException;\n import com.thoughtworks.xstream.core.JVM;\n+import com.thoughtworks.xstream.io.binary.BinaryStreamDriver;\n import com.thoughtworks.xstream.security.AnyTypePermission;\n import com.thoughtworks.xstream.security.ForbiddenClassException;\n import com.thoughtworks.xstream.security.InputManipulationException;\n@@ -545,4 +547,21 @@ public void testStackOverflowWithDeeplyNestedStructure() {\n             assertTrue(e.getMessage().indexOf(\"Stack Overflow\") >= 0);\n         }\n     }\n+\n+    public void testStackOverflowInBinaryStreamReaderWithManipulatedInputData() {\n+        final byte[] byteArray = new byte[36000];\n+        for (int i = 0; i < byteArray.length / 4; i++) {\n+            byteArray[i * 4] = 10;\n+            byteArray[i * 4 + 1] = -127;\n+            byteArray[i * 4 + 2] = 0;\n+            byteArray[i * 4 + 3] = 0;\n+        }\n+\n+        try {\n+            xstream = new XStream(new BinaryStreamDriver());\n+            xstream.fromXML(new ByteArrayInputStream(byteArray));\n+        } catch (final InputManipulationException e) {\n+            assertTrue(e.getMessage().indexOf(\"two mapping tokens\") >= 0);\n+        }\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/x-stream/xstream/commits/fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a",
        "url": "https://api.github.com/repos/x-stream/xstream/commits/fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a",
        "html_url": "https://github.com/x-stream/xstream/commit/fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a",
        "message": "Detect input manipulation in c.t.x.io.binary.BinaryStreamReader.",
        "files": [
            {
                "sha": "660b5aa2ed658eda968b8d9c7bb98097b13acae3",
                "filename": "xstream-distribution/src/content/changes.html",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/x-stream/xstream/blob/fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a/xstream-distribution%2Fsrc%2Fcontent%2Fchanges.html",
                "raw_url": "https://github.com/x-stream/xstream/raw/fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a/xstream-distribution%2Fsrc%2Fcontent%2Fchanges.html",
                "contents_url": "https://api.github.com/repos/x-stream/xstream/contents/xstream-distribution%2Fsrc%2Fcontent%2Fchanges.html?ref=fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a",
                "patch": "@@ -1,7 +1,7 @@\n <html>\n <!--\n  Copyright (C) 2005, 2006 Joe Walnes.\n- Copyright (C) 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023 XStream committers.\n+ Copyright (C) 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024 XStream committers.\n  All rights reserved.\n  \n  The software in this package is published under the terms of the BSD\n@@ -41,6 +41,7 @@ <h2>Minor changes</h2>\n \t\t<li>GHPR:#334: Fix remaining buffer size calculation in QuickWriter (by Higuchi Yuta).</li>\n \t\t<li>GHI:#342: Optimize internal handling of children in DomReader avoiding O(n\u00b2) access times for siblings (by Shiang-Yun Yang).</li>\n \t\t<li>GHI:#359: Add KEYS file with public keys to verify signed artifacts.</li>\n+\t\t<li>Detect input manipulation in c.t.x.io.binary.BinaryStreamReader.</li>\n \t</ul>\n \n \t<h2>API changes</h2>"
            },
            {
                "sha": "cd870cd0054379979d60fc2318b0263fa0475eac",
                "filename": "xstream/src/java/com/thoughtworks/xstream/io/binary/BinaryStreamReader.java",
                "status": "modified",
                "additions": 12,
                "deletions": 6,
                "changes": 18,
                "blob_url": "https://github.com/x-stream/xstream/blob/fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a/xstream%2Fsrc%2Fjava%2Fcom%2Fthoughtworks%2Fxstream%2Fio%2Fbinary%2FBinaryStreamReader.java",
                "raw_url": "https://github.com/x-stream/xstream/raw/fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a/xstream%2Fsrc%2Fjava%2Fcom%2Fthoughtworks%2Fxstream%2Fio%2Fbinary%2FBinaryStreamReader.java",
                "contents_url": "https://api.github.com/repos/x-stream/xstream/contents/xstream%2Fsrc%2Fjava%2Fcom%2Fthoughtworks%2Fxstream%2Fio%2Fbinary%2FBinaryStreamReader.java?ref=fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a",
                "patch": "@@ -1,6 +1,6 @@\n /*\n  * Copyright (C) 2006 Joe Walnes.\n- * Copyright (C) 2006, 2007, 2011, 2013 XStream Committers.\n+ * Copyright (C) 2006, 2007, 2011, 2013, 2024 XStream Committers.\n  * All rights reserved.\n  *\n  * The software in this package is published under the terms of the BSD\n@@ -15,6 +15,7 @@\n import com.thoughtworks.xstream.io.ExtendedHierarchicalStreamReader;\n import com.thoughtworks.xstream.io.HierarchicalStreamReader;\n import com.thoughtworks.xstream.io.StreamException;\n+import com.thoughtworks.xstream.security.InputManipulationException;\n \n import java.io.DataInputStream;\n import java.io.IOException;\n@@ -150,15 +151,20 @@ public void moveUp() {\n     private Token readToken() {\n         if (pushback == null) {\n             try {\n-                Token token = tokenFormatter.read(in);\n-                switch (token.getType()) {\n+                boolean mapping = false;\n+                do {\n+                    final Token token = tokenFormatter.read(in);\n+                    switch (token.getType()) {\n                     case Token.TYPE_MAP_ID_TO_VALUE:\n                         idRegistry.put(token.getId(), token.getValue());\n-                        return readToken(); // Next one please.\n+                        mapping ^= true;\n+                        continue; // Next one please.\n                     default:\n                         return token;\n-                }\n-            } catch (IOException e) {\n+                    }\n+                } while (mapping);\n+                throw new InputManipulationException(\"Binary stream will never have two mapping tokens in sequence\");\n+            } catch (final IOException e) {\n                 throw new StreamException(e);\n             }\n         } else {"
            },
            {
                "sha": "d93954fa55f542fb526bf3314ed8f057b1a322de",
                "filename": "xstream/src/test/com/thoughtworks/xstream/io/binary/BinaryStreamTest.java",
                "status": "modified",
                "additions": 16,
                "deletions": 1,
                "changes": 17,
                "blob_url": "https://github.com/x-stream/xstream/blob/fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a/xstream%2Fsrc%2Ftest%2Fcom%2Fthoughtworks%2Fxstream%2Fio%2Fbinary%2FBinaryStreamTest.java",
                "raw_url": "https://github.com/x-stream/xstream/raw/fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a/xstream%2Fsrc%2Ftest%2Fcom%2Fthoughtworks%2Fxstream%2Fio%2Fbinary%2FBinaryStreamTest.java",
                "contents_url": "https://api.github.com/repos/x-stream/xstream/contents/xstream%2Fsrc%2Ftest%2Fcom%2Fthoughtworks%2Fxstream%2Fio%2Fbinary%2FBinaryStreamTest.java?ref=fdd9f7d3de0d7ccf2f9979bcd09fbf3e6a0c881a",
                "patch": "@@ -1,6 +1,6 @@\n /*\n  * Copyright (C) 2006 Joe Walnes.\n- * Copyright (C) 2006, 2007, 2011, 2015, 2016, 2021 XStream Committers.\n+ * Copyright (C) 2006, 2007, 2011, 2015, 2016, 2021, 2024 XStream Committers.\n  * All rights reserved.\n  *\n  * The software in this package is published under the terms of the BSD\n@@ -17,10 +17,12 @@\n import com.thoughtworks.xstream.io.copy.HierarchicalStreamCopier;\n import com.thoughtworks.xstream.io.xml.AbstractXMLReaderTest;\n import com.thoughtworks.xstream.io.xml.MXParserDriver;\n+import com.thoughtworks.xstream.security.InputManipulationException;\n \n import java.io.ByteArrayOutputStream;\n import java.io.StringReader;\n import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n \n public class BinaryStreamTest extends AbstractXMLReaderTest {\n \n@@ -89,4 +91,17 @@ public void testIsXXEVulnerableWithExternalGeneralEntity() throws Exception {\n         }\n     }\n \n+    public void testHandleMaliciousInputsOfIdMappingTokens() {\n+        // Insert two successive id mapping tokens into the stream\n+        final byte[] byteArray = new byte[8];\n+        byteArray[0] = byteArray[4] = 10;\n+        byteArray[1] = byteArray[5] = -127;\n+\n+        final InputStream in = new ByteArrayInputStream(byteArray);\n+        try {\n+            new BinaryStreamReader(in);\n+            fail(\"Thrown \" + InputManipulationException.class.getName() + \" expected\");\n+        } catch (final InputManipulationException e) {\n+        }\n+    }\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/DuendeSoftware/Duende.AccessTokenManagement/commits/09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
        "url": "https://api.github.com/repos/DuendeArchive/Duende.AccessTokenManagement/commits/09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
        "html_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/commit/09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
        "message": "Merge commit from fork\n\nAdvisory fix",
        "files": [
            {
                "sha": "ab2cab47872ba69a8300badfe0d8450ba8ae363e",
                "filename": "Directory.Build.targets",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/blob/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/Directory.Build.targets",
                "raw_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/raw/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/Directory.Build.targets",
                "contents_url": "https://api.github.com/repos/DuendeArchive/Duende.AccessTokenManagement/contents/Directory.Build.targets?ref=09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
                "patch": "@@ -3,7 +3,7 @@\n         <FrameworkVersion>8.0.1</FrameworkVersion>\n         <ExtensionsVersion>8.0.0</ExtensionsVersion>\n         <WilsonVersion>7.1.2</WilsonVersion>\n-        <IdentityServerVersion>7.0.6</IdentityServerVersion>\n+        <IdentityServerVersion>7.0.8</IdentityServerVersion>\n     </PropertyGroup>\n \n     <ItemGroup>"
            },
            {
                "sha": "d2149db38259a049a08b1851b237af89ce814095",
                "filename": "src/Duende.AccessTokenManagement.OpenIdConnect/AuthenticateResultCache.cs",
                "status": "added",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/blob/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/src%2FDuende.AccessTokenManagement.OpenIdConnect%2FAuthenticateResultCache.cs",
                "raw_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/raw/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/src%2FDuende.AccessTokenManagement.OpenIdConnect%2FAuthenticateResultCache.cs",
                "contents_url": "https://api.github.com/repos/DuendeArchive/Duende.AccessTokenManagement/contents/src%2FDuende.AccessTokenManagement.OpenIdConnect%2FAuthenticateResultCache.cs?ref=09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
                "patch": "@@ -0,0 +1,14 @@\n+// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n+// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n+\n+using Microsoft.AspNetCore.Authentication;\n+using System.Collections.Generic;\n+\n+/// <summary>\n+/// Per-request cache so that if SignInAsync is used, we won't re-read the old/cached AuthenticateResult from the handler.\n+/// This requires this service to be added as scoped to the DI system.\n+/// Be VERY CAREFUL to not accidentally capture this service for longer than the appropriate DI scope - e.g., in an HttpClient.\n+/// </summary>\n+internal class AuthenticateResultCache: Dictionary<string, AuthenticateResult>\n+{\n+}\n\\ No newline at end of file"
            },
            {
                "sha": "dc4d62b8a52285449ad29997d14d954ecb6d6fbb",
                "filename": "src/Duende.AccessTokenManagement.OpenIdConnect/AuthenticationSessionUserTokenStore.cs",
                "status": "modified",
                "additions": 16,
                "deletions": 10,
                "changes": 26,
                "blob_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/blob/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/src%2FDuende.AccessTokenManagement.OpenIdConnect%2FAuthenticationSessionUserTokenStore.cs",
                "raw_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/raw/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/src%2FDuende.AccessTokenManagement.OpenIdConnect%2FAuthenticationSessionUserTokenStore.cs",
                "contents_url": "https://api.github.com/repos/DuendeArchive/Duende.AccessTokenManagement/contents/src%2FDuende.AccessTokenManagement.OpenIdConnect%2FAuthenticationSessionUserTokenStore.cs?ref=09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
                "patch": "@@ -4,10 +4,11 @@\n using Microsoft.AspNetCore.Authentication;\n using Microsoft.AspNetCore.Http;\n using System;\n-using System.Collections.Generic;\n using System.Security.Claims;\n using System.Threading.Tasks;\n using Microsoft.Extensions.Logging;\n+using Microsoft.Extensions.DependencyInjection;\n+using IdentityModel;\n \n namespace Duende.AccessTokenManagement.OpenIdConnect\n {\n@@ -20,10 +21,6 @@ public class AuthenticationSessionUserAccessTokenStore : IUserTokenStore\n         private readonly IStoreTokensInAuthenticationProperties _tokensInProps;\n         private readonly ILogger<AuthenticationSessionUserAccessTokenStore> _logger;\n \n-        // per-request cache so that if SignInAsync is used, we won't re-read the old/cached AuthenticateResult from the handler\n-        // this requires this service to be added as scoped to the DI system\n-        private readonly Dictionary<string, AuthenticateResult> _cache = new Dictionary<string, AuthenticateResult>();\n-\n         /// <summary>\n         /// ctor\n         /// </summary>\n@@ -46,10 +43,14 @@ public async Task<UserToken> GetTokenAsync(\n             UserTokenRequestParameters? parameters = null)\n         {\n             parameters ??= new();\n-\n+            // Resolve the cache here because it needs to have a per-request\n+            // lifetime. Sometimes the store itself is captured for longer than\n+            // that inside an HttpClient.\n+            var cache = _contextAccessor.HttpContext?.RequestServices.GetRequiredService<AuthenticateResultCache>();\n+         \n             // check the cache in case the cookie was re-issued via StoreTokenAsync\n             // we use String.Empty as the key for a null SignInScheme\n-            if (!_cache.TryGetValue(parameters.SignInScheme ?? String.Empty, out var result))\n+            if (!cache!.TryGetValue(parameters.SignInScheme ?? String.Empty, out var result))\n             {\n                 result = await _contextAccessor!.HttpContext!.AuthenticateAsync(parameters.SignInScheme).ConfigureAwait(false);\n             }\n@@ -80,9 +81,14 @@ public async Task StoreTokenAsync(\n         {\n             parameters ??= new();\n \n+            // Resolve the cache here because it needs to have a per-request\n+            // lifetime. Sometimes the store itself is captured for longer than\n+            // that inside an HttpClient.\n+            var cache = _contextAccessor.HttpContext?.RequestServices.GetRequiredService<AuthenticateResultCache>();\n+\n             // check the cache in case the cookie was re-issued via StoreTokenAsync\n             // we use String.Empty as the key for a null SignInScheme\n-            if (!_cache.TryGetValue(parameters.SignInScheme ?? String.Empty, out var result))\n+            if (!cache!.TryGetValue(parameters.SignInScheme ?? String.Empty, out var result))\n             {\n                 result = await _contextAccessor.HttpContext!.AuthenticateAsync(parameters.SignInScheme)!.ConfigureAwait(false);\n             }\n@@ -103,7 +109,7 @@ public async Task StoreTokenAsync(\n \n             // add to the cache so if GetTokenAsync is called again, we will use the updated property values\n             // we use String.Empty as the key for a null SignInScheme\n-            _cache[parameters.SignInScheme ?? String.Empty] = AuthenticateResult.Success(new AuthenticationTicket(transformedPrincipal, result.Properties, scheme!));\n+            cache[parameters.SignInScheme ?? String.Empty] = AuthenticateResult.Success(new AuthenticationTicket(transformedPrincipal, result.Properties, scheme!));\n         }\n \n         /// <inheritdoc/>\n@@ -125,4 +131,4 @@ protected virtual Task<ClaimsPrincipal> FilterPrincipalAsync(ClaimsPrincipal pri\n             return Task.FromResult(principal);\n         }\n     }\n-}\n\\ No newline at end of file\n+}"
            },
            {
                "sha": "e344f968d629f5fc337c0b8600814b4e8100cf0b",
                "filename": "src/Duende.AccessTokenManagement.OpenIdConnect/OpenIdConnectTokenManagementServiceCollectionExtensions.cs",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/blob/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/src%2FDuende.AccessTokenManagement.OpenIdConnect%2FOpenIdConnectTokenManagementServiceCollectionExtensions.cs",
                "raw_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/raw/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/src%2FDuende.AccessTokenManagement.OpenIdConnect%2FOpenIdConnectTokenManagementServiceCollectionExtensions.cs",
                "contents_url": "https://api.github.com/repos/DuendeArchive/Duende.AccessTokenManagement/contents/src%2FDuende.AccessTokenManagement.OpenIdConnect%2FOpenIdConnectTokenManagementServiceCollectionExtensions.cs?ref=09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
                "patch": "@@ -2,9 +2,11 @@\n // Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n \n using System;\n+using System.Collections.Generic;\n using System.Net.Http;\n using Duende.AccessTokenManagement;\n using Duende.AccessTokenManagement.OpenIdConnect;\n+using Microsoft.AspNetCore.Authentication;\n using Microsoft.AspNetCore.Http;\n using Microsoft.Extensions.DependencyInjection.Extensions;\n using Microsoft.Extensions.Logging;\n@@ -46,8 +48,10 @@ public static IServiceCollection AddOpenIdConnectAccessTokenManagement(this ISer\n         // context, and we register different ones in blazor\n         \n         services.TryAddScoped<IUserAccessor, HttpContextUserAccessor>();\n-        // scoped since it will be caching per-request authentication results\n         services.TryAddScoped<IUserTokenStore, AuthenticationSessionUserAccessTokenStore>();\n+        \n+        // scoped since it will be caching per-request authentication results\n+        services.AddScoped<AuthenticateResultCache>();\n \n         return services;\n     }"
            },
            {
                "sha": "322f76b01f566e1351e03f36e0a4a870016ef22b",
                "filename": "test/Tests/Framework/ApiHost.cs",
                "status": "modified",
                "additions": 8,
                "deletions": 37,
                "changes": 45,
                "blob_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/blob/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/test%2FTests%2FFramework%2FApiHost.cs",
                "raw_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/raw/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/test%2FTests%2FFramework%2FApiHost.cs",
                "contents_url": "https://api.github.com/repos/DuendeArchive/Duende.AccessTokenManagement/contents/test%2FTests%2FFramework%2FApiHost.cs?ref=09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
                "patch": "@@ -3,6 +3,7 @@\n \n using Duende.IdentityServer.Models;\n using Microsoft.AspNetCore.Builder;\n+using Microsoft.AspNetCore.Http;\n using Microsoft.Extensions.DependencyInjection;\n \n namespace Duende.AccessTokenManagement.Tests;\n@@ -37,6 +38,7 @@ private void ConfigureServices(IServiceCollection services)\n                 options.Audience = _identityServerHost.Url(\"/resources\");\n                 options.MapInboundClaims = false;\n                 options.BackchannelHttpHandler = _identityServerHost.Server.CreateHandler();\n+                options.TokenValidationParameters.NameClaimType = \"sub\";\n             });\n     }\n \n@@ -62,43 +64,12 @@ private void Configure(IApplicationBuilder app)\n \n         app.UseEndpoints(endpoints =>\n         {\n-            // endpoints.Map(\"/{**catch-all}\", async context =>\n-            // {\n-            //     // capture body if present\n-            //     var body = default(string);\n-            //     if (context.Request.HasJsonContentType())\n-            //     {\n-            //         using (var sr = new StreamReader(context.Request.Body))\n-            //         {\n-            //             body = await sr.ReadToEndAsync();\n-            //         }\n-            //     }\n-            //     \n-            //     // capture request headers\n-            //     var requestHeaders = new Dictionary<string, List<string>>();\n-            //     foreach (var header in context.Request.Headers)\n-            //     {\n-            //         var values = new List<string>(header.Value.Select(v => v));\n-            //         requestHeaders.Add(header.Key, values);\n-            //     }\n-            //\n-            //     var response = new ApiResponse(\n-            //         context.Request.Method,\n-            //         context.Request.Path.Value,\n-            //         context.User.FindFirst((\"sub\"))?.Value,\n-            //         context.User.FindFirst((\"client_id\"))?.Value,\n-            //         context.User.Claims.Select(x => new ClaimRecord(x.Type, x.Value)).ToArray())\n-            //     {\n-            //         Body = body,\n-            //         RequestHeaders = requestHeaders\n-            //     };\n-            //\n-            //     context.Response.StatusCode = ApiStatusCodeToReturn ?? 200;\n-            //     ApiStatusCodeToReturn = null;\n-            //\n-            //     context.Response.ContentType = \"application/json\";\n-            //     await context.Response.WriteAsync(JsonSerializer.Serialize(response));\n-            // });\n+            endpoints.Map(\"/{**catch-all}\", (HttpContext context) =>\n+            {\n+                return new TokenEchoResponse(\n+                    context.User.Identity?.Name ?? \"missing sub\", \n+                    context.Request.Headers.Authorization.First() ?? \"missing token\");\n+            });\n         });\n     }\n }\n\\ No newline at end of file"
            },
            {
                "sha": "cca58377d1f4cdda49f3ef6046ca7274b58372ba",
                "filename": "test/Tests/Framework/AppHost.cs",
                "status": "modified",
                "additions": 19,
                "deletions": 5,
                "changes": 24,
                "blob_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/blob/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/test%2FTests%2FFramework%2FAppHost.cs",
                "raw_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/raw/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/test%2FTests%2FFramework%2FAppHost.cs",
                "contents_url": "https://api.github.com/repos/DuendeArchive/Duende.AccessTokenManagement/contents/test%2FTests%2FFramework%2FAppHost.cs?ref=09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
                "patch": "@@ -10,14 +10,15 @@\n using IdentityModel;\n using Duende.AccessTokenManagement.OpenIdConnect;\n using RichardSzalay.MockHttp;\n+using System.Net.Http.Json;\n \n namespace Duende.AccessTokenManagement.Tests;\n \n public class AppHost : GenericHost\n {\n     private readonly IdentityServerHost _identityServerHost;\n     private readonly ApiHost _apiHost;\n-    private readonly string _clientId;\n+    public string ClientId;\n     private readonly Action<UserTokenManagementOptions>? _configureUserTokenManagementOptions;\n \n     public AppHost(\n@@ -30,7 +31,7 @@ public AppHost(\n     {\n         _identityServerHost = identityServerHost;\n         _apiHost = apiHost;\n-        _clientId = clientId;\n+        ClientId = clientId;\n         _configureUserTokenManagementOptions = configureUserTokenManagementOptions;\n         OnConfigureServices += ConfigureServices;\n         OnConfigure += Configure;\n@@ -58,7 +59,7 @@ private void ConfigureServices(IServiceCollection services)\n             {\n                 options.Authority = _identityServerHost.Url();\n \n-                options.ClientId = _clientId;\n+                options.ClientId = ClientId;\n                 options.ClientSecret = \"secret\";\n                 options.ResponseType = \"code\";\n                 options.ResponseMode = \"query\";\n@@ -68,7 +69,7 @@ private void ConfigureServices(IServiceCollection services)\n                 options.SaveTokens = true;\n \n                 options.Scope.Clear();\n-                var client = _identityServerHost.Clients.Single(x => x.ClientId == _clientId);\n+                var client = _identityServerHost.Clients.Single(x => x.ClientId == ClientId);\n                 foreach (var scope in client.AllowedScopes)\n                 {\n                     options.Scope.Add(scope);\n@@ -107,6 +108,10 @@ private void ConfigureServices(IServiceCollection services)\n             }\n         });\n \n+        services.AddUserAccessTokenHttpClient(\"callApi\", configureClient: client => {\n+            client.BaseAddress = new Uri(_apiHost.Url());\n+         })\n+        .ConfigurePrimaryHttpMessageHandler(() => _apiHost.HttpMessageHandler);\n     }\n \n     private void Configure(IApplicationBuilder app)\n@@ -136,6 +141,13 @@ await context.ChallengeAsync(new AuthenticationProperties\n                 await context.Response.WriteAsJsonAsync(token);\n             });\n \n+            endpoints.MapGet(\"/call_api\", async (IHttpClientFactory factory, HttpContext context) =>\n+            {\n+                var http = factory.CreateClient(\"callApi\");\n+                var response = await http.GetAsync(\"test\");\n+                return await response.Content.ReadFromJsonAsync<TokenEchoResponse>();\n+            });\n+\n             endpoints.MapGet(\"/user_token_with_resource/{resource}\", async (string resource, HttpContext context) =>\n             {\n                 var token = await context.GetUserAccessTokenAsync(new UserTokenRequestParameters\n@@ -204,4 +216,6 @@ public async Task<HttpResponseMessage> LogoutAsync(string? sid = null)\n         response = await BrowserClient.GetAsync(Url(response.Headers.Location.ToString()));\n         return response;\n     }\n-}\n\\ No newline at end of file\n+}\n+\n+public record TokenEchoResponse(string sub, string token);\n\\ No newline at end of file"
            },
            {
                "sha": "5e558ad7a62c669c16154a1a90b1f10f3531f36c",
                "filename": "test/Tests/Framework/GenericHost.cs",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/blob/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/test%2FTests%2FFramework%2FGenericHost.cs",
                "raw_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/raw/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/test%2FTests%2FFramework%2FGenericHost.cs",
                "contents_url": "https://api.github.com/repos/DuendeArchive/Duende.AccessTokenManagement/contents/test%2FTests%2FFramework%2FGenericHost.cs?ref=09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
                "patch": "@@ -32,10 +32,9 @@ public GenericHost(string baseAddress = \"https://server\")\n     public TestServer Server { get; private set; } = default!;\n     public TestBrowserClient BrowserClient { get; set; } = default!;\n     public HttpClient HttpClient { get; set; } = default!;\n-\n+    public HttpMessageHandler HttpMessageHandler { get; set; } = default!;\n     public TestLoggerProvider Logger { get; set; } = new TestLoggerProvider();\n \n-\n     public T Resolve<T>()\n         where T : notnull\n     {\n@@ -84,6 +83,7 @@ public async Task InitializeAsync()\n         Server = host.GetTestServer();\n         BrowserClient = new TestBrowserClient(Server.CreateHandler());\n         HttpClient = Server.CreateClient();\n+        HttpMessageHandler = Server.CreateHandler();\n     }\n \n     public event Action<IServiceCollection> OnConfigureServices = services => { };"
            },
            {
                "sha": "6d0ced5b15ec48d872c0eae6d1038cdfb9625ddc",
                "filename": "test/Tests/UserTokenManagementTests.cs",
                "status": "modified",
                "additions": 36,
                "deletions": 9,
                "changes": 45,
                "blob_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/blob/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/test%2FTests%2FUserTokenManagementTests.cs",
                "raw_url": "https://github.com/DuendeArchive/Duende.AccessTokenManagement/raw/09c73e32b182da5c6d7b55ec790cb2271cc4b63f/test%2FTests%2FUserTokenManagementTests.cs",
                "contents_url": "https://api.github.com/repos/DuendeArchive/Duende.AccessTokenManagement/contents/test%2FTests%2FUserTokenManagementTests.cs?ref=09c73e32b182da5c6d7b55ec790cb2271cc4b63f",
                "patch": "@@ -183,10 +183,18 @@ public async Task Missing_initial_refresh_token_and_expired_access_token_should_\n     [Fact]\n     public async Task Short_token_lifetime_should_trigger_refresh()\n     {\n+        // This test makes an initial token request using code flow and then\n+        // refreshes the token a couple of times.\n+        \n+        // We mock the expiration of the first few token responses to be short\n+        // enough that we will automatically refresh immediately when attempting\n+        // to use the tokens, while the final response gets a long refresh time,\n+        // allowing us to verify that the token is not refreshed. \n+\n         var mockHttp = new MockHttpMessageHandler();\n         AppHost.IdentityServerHttpHandler = mockHttp;\n \n-        // short token lifetime should trigger refresh on 1st use\n+        // Respond to code flow with a short token lifetime so that we trigger refresh on 1st use\n         var initialTokenResponse = new\n         {\n             id_token = IdentityServerHost.CreateIdToken(\"1\", \"web\"),\n@@ -195,37 +203,31 @@ public async Task Short_token_lifetime_should_trigger_refresh()\n             expires_in = 10,\n             refresh_token = \"initial_refresh_token\",\n         };\n-\n-        // response for re-deeming code\n         mockHttp.When(\"/connect/token\")\n             .WithFormData(\"grant_type\", \"authorization_code\")\n             .Respond(\"application/json\", JsonSerializer.Serialize(initialTokenResponse));\n \n-        // short token lifetime should trigger refresh on 1st use\n+        // Respond to refresh with a short token lifetime so that we trigger another refresh on 2nd use\n         var refreshTokenResponse = new\n         {\n             access_token = \"refreshed1_access_token\",\n             token_type = \"token_type1\",\n             expires_in = 10,\n             refresh_token = \"refreshed1_refresh_token\",\n         };\n-\n-        // response for refresh 1\n         mockHttp.When(\"/connect/token\")\n             .WithFormData(\"grant_type\", \"refresh_token\")\n             .WithFormData(\"refresh_token\", \"initial_refresh_token\")\n             .Respond(\"application/json\", JsonSerializer.Serialize(refreshTokenResponse));\n \n-        // short token lifetime should trigger refresh on 2nd use\n+        // Respond to second refresh with a long token lifetime so that we don't trigger another refresh on 3rd use\n         var refreshTokenResponse2 = new\n         {\n             access_token = \"refreshed2_access_token\",\n             token_type = \"token_type2\",\n             expires_in = 3600,\n             refresh_token = \"refreshed2_refresh_token\",\n         };\n-\n-        // response for refresh 1\n         mockHttp.When(\"/connect/token\")\n             .WithFormData(\"grant_type\", \"refresh_token\")\n             .WithFormData(\"refresh_token\", \"refreshed1_refresh_token\")\n@@ -397,4 +399,29 @@ public async Task Refresh_responses_without_refresh_token_use_old_refresh_token(\n         token.IsError.ShouldBeFalse();\n         token.RefreshToken.ShouldBe(\"initial_refresh_token\");\n     }\n+\n+    [Fact]\n+    public async Task Multiple_users_have_distinct_tokens_across_refreshes()\n+    {\n+        // setup host\n+        AppHost.ClientId = \"web.short\";\n+        await AppHost.InitializeAsync();\n+        await AppHost.LoginAsync(\"alice\");\n+\n+        var firstResponse = await AppHost.BrowserClient.GetAsync(AppHost.Url(\"/call_api\"));\n+        var firstToken = await firstResponse.Content.ReadFromJsonAsync<TokenEchoResponse>();\n+        var secondResponse = await AppHost.BrowserClient.GetAsync(AppHost.Url(\"/call_api\"));\n+        var secondToken = await secondResponse.Content.ReadFromJsonAsync<TokenEchoResponse>();\n+        firstToken.ShouldNotBeNull();\n+        secondToken.ShouldNotBeNull();\n+        secondToken.sub.ShouldBe(firstToken.sub);\n+        secondToken.token.ShouldNotBe(firstToken.token);\n+\n+        await AppHost.LoginAsync(\"bob\");\n+        var thirdResponse = await AppHost.BrowserClient.GetAsync(AppHost.Url(\"/call_api\"));\n+        var thirdToken = await thirdResponse.Content.ReadFromJsonAsync<TokenEchoResponse>();\n+        thirdToken.ShouldNotBeNull(); \n+        thirdToken.sub.ShouldNotBe(secondToken.sub);\n+        thirdToken.token.ShouldNotBe(firstToken.token);\n+    }\n }\n\\ No newline at end of file"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/dgtlmoon/changedetection.io/commits/49bc982c697169c98b79698889fb9d26f6b3317f",
        "url": "https://api.github.com/repos/dgtlmoon/changedetection.io/commits/49bc982c697169c98b79698889fb9d26f6b3317f",
        "html_url": "https://github.com/dgtlmoon/changedetection.io/commit/49bc982c697169c98b79698889fb9d26f6b3317f",
        "message": "CVE-2024-51998 - file:/ path traversal access should not be allowed to access a file without ALLOW_FILE_URI set",
        "files": [
            {
                "sha": "2dcc9730580382b5fbf649aaa9dee13ad12375ce",
                "filename": "changedetectionio/processors/__init__.py",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/dgtlmoon/changedetection.io/blob/49bc982c697169c98b79698889fb9d26f6b3317f/changedetectionio%2Fprocessors%2F__init__.py",
                "raw_url": "https://github.com/dgtlmoon/changedetection.io/raw/49bc982c697169c98b79698889fb9d26f6b3317f/changedetectionio%2Fprocessors%2F__init__.py",
                "contents_url": "https://api.github.com/repos/dgtlmoon/changedetection.io/contents/changedetectionio%2Fprocessors%2F__init__.py?ref=49bc982c697169c98b79698889fb9d26f6b3317f",
                "patch": "@@ -33,8 +33,8 @@ def call_browser(self, preferred_proxy_id=None):\n \n         url = self.watch.link\n \n-        # Protect against file:// access, check the real \"link\" without any meta \"source:\" etc prepended.\n-        if re.search(r'^file://', url, re.IGNORECASE):\n+        # Protect against file://, file:/ access, check the real \"link\" without any meta \"source:\" etc prepended.\n+        if re.search(r'^file:/', url.strip(), re.IGNORECASE):\n             if not strtobool(os.getenv('ALLOW_FILE_URI', 'false')):\n                 raise Exception(\n                     \"file:// type access is denied for security reasons.\""
            },
            {
                "sha": "5bb9e879dc4a60a28c72b07d6ae70efc183867dd",
                "filename": "changedetectionio/tests/test_security.py",
                "status": "modified",
                "additions": 28,
                "deletions": 1,
                "changes": 29,
                "blob_url": "https://github.com/dgtlmoon/changedetection.io/blob/49bc982c697169c98b79698889fb9d26f6b3317f/changedetectionio%2Ftests%2Ftest_security.py",
                "raw_url": "https://github.com/dgtlmoon/changedetection.io/raw/49bc982c697169c98b79698889fb9d26f6b3317f/changedetectionio%2Ftests%2Ftest_security.py",
                "contents_url": "https://api.github.com/repos/dgtlmoon/changedetection.io/contents/changedetectionio%2Ftests%2Ftest_security.py?ref=49bc982c697169c98b79698889fb9d26f6b3317f",
                "patch": "@@ -61,7 +61,7 @@ def test_bad_access(client, live_server, measure_memory_usage):\n     assert b'Watch protocol is not permitted by SAFE_PROTOCOL_REGEX' in res.data\n \n \n-def test_file_access(client, live_server, measure_memory_usage):\n+def test_file_slashslash_access(client, live_server, measure_memory_usage):\n     #live_server_setup(live_server)\n \n     test_file_path = \"/tmp/test-file.txt\"\n@@ -88,6 +88,33 @@ def test_file_access(client, live_server, measure_memory_usage):\n         # Default should be here\n         assert b'file:// type access is denied for security reasons.' in res.data\n \n+def test_file_slash_access(client, live_server, measure_memory_usage):\n+    #live_server_setup(live_server)\n+\n+    test_file_path = \"/tmp/test-file.txt\"\n+\n+    # file:// is permitted by default, but it will be caught by ALLOW_FILE_URI\n+    client.post(\n+        url_for(\"form_quick_watch_add\"),\n+        data={\"url\": f\"file:/{test_file_path}\", \"tags\": ''},\n+        follow_redirects=True\n+    )\n+    wait_for_all_checks(client)\n+    res = client.get(url_for(\"index\"))\n+\n+    # If it is enabled at test time\n+    if strtobool(os.getenv('ALLOW_FILE_URI', 'false')):\n+        res = client.get(\n+            url_for(\"preview_page\", uuid=\"first\"),\n+            follow_redirects=True\n+        )\n+\n+        # Should see something (this file added by run_basic_tests.sh)\n+        assert b\"Hello world\" in res.data\n+    else:\n+        # Default should be here\n+        assert b'file:// type access is denied for security reasons.' in res.data\n+\n def test_xss(client, live_server, measure_memory_usage):\n     #live_server_setup(live_server)\n     from changedetectionio.notification import ("
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/hashicorp/nomad/commits/30849c518e16647a4f698e5f5cc82bef2bf40e4d",
        "url": "https://api.github.com/repos/hashicorp/nomad/commits/30849c518e16647a4f698e5f5cc82bef2bf40e4d",
        "html_url": "https://github.com/hashicorp/nomad/commit/30849c518e16647a4f698e5f5cc82bef2bf40e4d",
        "message": "CSI: fix namespace ACL bypass on create/register APIs (#24396)\n\nWhen creating or registering a CSI volume, the RPC handler uses the volume\r\nspecification's namespace instead of the request namespace. This works as\r\nintended, but the ACL check is only on the request namespace.\r\n\r\nThis allows a cross-namespace ACL bypass for authenticated users who have\r\n`csi-write-volume` capabilities in one namespace but not another namespace. Such\r\na user can set the volume specification to a forbidden namespace while setting\r\nthe `-namespace` flag in the CLI or API. The ACL check happens against the\r\nnamespace they do have permission to, but the volume is created in the forbidden\r\nnamespace.\r\n\r\nThis changeset fixes the bug by moving the namespace check into the loop over\r\nthe volumes being written by the RPCs. It also updates the tests to better cover\r\nACL checking in these two RPCs.\r\n\r\nRef: CVE-2024-10975\r\nRef: https://hashicorp.atlassian.net/browse/SECVULN-15463\r\nFixes: https://github.com/hashicorp/nomad/issues/24397",
        "files": [
            {
                "sha": "563f964083391da05fc4c03c1f6803120b3197bb",
                "filename": ".changelog/24396.txt",
                "status": "added",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/hashicorp/nomad/blob/30849c518e16647a4f698e5f5cc82bef2bf40e4d/.changelog%2F24396.txt",
                "raw_url": "https://github.com/hashicorp/nomad/raw/30849c518e16647a4f698e5f5cc82bef2bf40e4d/.changelog%2F24396.txt",
                "contents_url": "https://api.github.com/repos/hashicorp/nomad/contents/.changelog%2F24396.txt?ref=30849c518e16647a4f698e5f5cc82bef2bf40e4d",
                "patch": "@@ -0,0 +1,3 @@\n+```release-note:security\n+csi: Fixed a bug where a user with csi-write-volume permissions to one namespace can create volumes in another namespace (CVE-2024-10975)\n+```"
            },
            {
                "sha": "6f7bd2caa87b90da6e53c0b1bb67295a3c2fce67",
                "filename": "nomad/csi_endpoint.go",
                "status": "modified",
                "additions": 23,
                "deletions": 17,
                "changes": 40,
                "blob_url": "https://github.com/hashicorp/nomad/blob/30849c518e16647a4f698e5f5cc82bef2bf40e4d/nomad%2Fcsi_endpoint.go",
                "raw_url": "https://github.com/hashicorp/nomad/raw/30849c518e16647a4f698e5f5cc82bef2bf40e4d/nomad%2Fcsi_endpoint.go",
                "contents_url": "https://api.github.com/repos/hashicorp/nomad/contents/nomad%2Fcsi_endpoint.go?ref=30849c518e16647a4f698e5f5cc82bef2bf40e4d",
                "patch": "@@ -304,32 +304,34 @@ func (v *CSIVolume) Register(args *structs.CSIVolumeRegisterRequest, reply *stru\n \n \tdefer metrics.MeasureSince([]string{\"nomad\", \"volume\", \"register\"}, time.Now())\n \n-\tif !allowVolume(aclObj, args.RequestNamespace()) || !aclObj.AllowPluginRead() {\n+\t// permission for the volume namespaces will be checked below\n+\tif !aclObj.AllowPluginRead() {\n \t\treturn structs.ErrPermissionDenied\n \t}\n \n \tif len(args.Volumes) == 0 {\n \t\treturn fmt.Errorf(\"missing volume definition\")\n \t}\n \n-\t// This is the only namespace we ACL checked, force all the volumes to use it.\n-\t// We also validate that the plugin exists for each plugin, and validate the\n+\tsnap, err := v.srv.State().Snapshot()\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\t// Validate ACLs, that the plugin exists for each volume, and validate the\n \t// capabilities when the plugin has a controller.\n \tfor _, vol := range args.Volumes {\n-\n-\t\tsnap, err := v.srv.State().Snapshot()\n-\t\tif err != nil {\n-\t\t\treturn err\n-\t\t}\n \t\tif vol.Namespace == \"\" {\n \t\t\tvol.Namespace = args.RequestNamespace()\n \t\t}\n+\t\tif !allowVolume(aclObj, vol.Namespace) {\n+\t\t\treturn structs.ErrPermissionDenied\n+\t\t}\n \t\tif err = vol.Validate(); err != nil {\n \t\t\treturn err\n \t\t}\n \n-\t\tws := memdb.NewWatchSet()\n-\t\texistingVol, err := snap.CSIVolumeByID(ws, vol.Namespace, vol.ID)\n+\t\texistingVol, err := snap.CSIVolumeByID(nil, vol.Namespace, vol.ID)\n \t\tif err != nil {\n \t\t\treturn err\n \t\t}\n@@ -1044,7 +1046,8 @@ func (v *CSIVolume) Create(args *structs.CSIVolumeCreateRequest, reply *structs.\n \t\treturn err\n \t}\n \n-\tif !allowVolume(aclObj, args.RequestNamespace()) || !aclObj.AllowPluginRead() {\n+\t// permission for the volume namespaces will be checked below\n+\tif !aclObj.AllowPluginRead() {\n \t\treturn structs.ErrPermissionDenied\n \t}\n \n@@ -1062,13 +1065,20 @@ func (v *CSIVolume) Create(args *structs.CSIVolumeCreateRequest, reply *structs.\n \t}\n \tvalidatedVols := []validated{}\n \n-\t// This is the only namespace we ACL checked, force all the volumes to use it.\n-\t// We also validate that the plugin exists for each plugin, and validate the\n+\tsnap, err := v.srv.State().Snapshot()\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\t// Validate ACLs, that the plugin exists for each volume, and validate the\n \t// capabilities when the plugin has a controller.\n \tfor _, vol := range args.Volumes {\n \t\tif vol.Namespace == \"\" {\n \t\t\tvol.Namespace = args.RequestNamespace()\n \t\t}\n+\t\tif !allowVolume(aclObj, vol.Namespace) {\n+\t\t\treturn structs.ErrPermissionDenied\n+\t\t}\n \t\tif err = vol.Validate(); err != nil {\n \t\t\treturn err\n \t\t}\n@@ -1084,10 +1094,6 @@ func (v *CSIVolume) Create(args *structs.CSIVolumeCreateRequest, reply *structs.\n \t\t}\n \n \t\t// if the volume already exists, we'll update it instead\n-\t\tsnap, err := v.srv.State().Snapshot()\n-\t\tif err != nil {\n-\t\t\treturn err\n-\t\t}\n \t\t// current will be nil if it does not exist.\n \t\tcurrent, err := snap.CSIVolumeByID(nil, vol.Namespace, vol.ID)\n \t\tif err != nil {"
            },
            {
                "sha": "d329df72eb55530fd0de3e3be68cd4de85dbce02",
                "filename": "nomad/csi_endpoint_test.go",
                "status": "modified",
                "additions": 97,
                "deletions": 44,
                "changes": 141,
                "blob_url": "https://github.com/hashicorp/nomad/blob/30849c518e16647a4f698e5f5cc82bef2bf40e4d/nomad%2Fcsi_endpoint_test.go",
                "raw_url": "https://github.com/hashicorp/nomad/raw/30849c518e16647a4f698e5f5cc82bef2bf40e4d/nomad%2Fcsi_endpoint_test.go",
                "contents_url": "https://api.github.com/repos/hashicorp/nomad/contents/nomad%2Fcsi_endpoint_test.go?ref=30849c518e16647a4f698e5f5cc82bef2bf40e4d",
                "patch": "@@ -206,7 +206,7 @@ func TestCSIVolume_pluginValidateVolume(t *testing.T) {\n \n func TestCSIVolumeEndpoint_Register(t *testing.T) {\n \tci.Parallel(t)\n-\tsrv, shutdown := TestServer(t, func(c *Config) {\n+\tsrv, _, shutdown := TestACLServer(t, func(c *Config) {\n \t\tc.NumSchedulers = 0 // Prevent automatic dequeue\n \t})\n \tdefer shutdown()\n@@ -217,9 +217,10 @@ func TestCSIVolumeEndpoint_Register(t *testing.T) {\n \n \tid0 := uuid.Generate()\n \n-\t// Create the register request\n-\tns := mock.Namespace()\n-\tstore.UpsertNamespaces(900, []*structs.Namespace{ns})\n+\tns := \"prod\"\n+\totherNS := \"other\"\n+\tindex := uint64(1000)\n+\tmust.NoError(t, store.UpsertNamespaces(index, []*structs.Namespace{{Name: ns}, {Name: otherNS}}))\n \n \t// Create the node and plugin\n \tnode := mock.Node()\n@@ -231,12 +232,24 @@ func TestCSIVolumeEndpoint_Register(t *testing.T) {\n \t\t\tNodeInfo: &structs.CSINodeInfo{},\n \t\t},\n \t}\n-\trequire.NoError(t, store.UpsertNode(structs.MsgTypeTestSetup, 1000, node))\n+\tmust.NoError(t, store.UpsertNode(structs.MsgTypeTestSetup, index, node))\n+\n+\tindex++\n+\tvalidToken := mock.CreatePolicyAndToken(t, store, index, \"csi-access-ns\",\n+\t\t`namespace \"prod\" { capabilities = [\"csi-write-volume\", \"csi-read-volume\"] }\n+         namespace \"default\" { capabilities = [\"csi-write-volume\"] }\n+         plugin { policy = \"read\" }\n+         node { policy = \"read\" }`).SecretID\n+\n+\tindex++\n+\tinvalidToken := mock.CreatePolicyAndToken(t, store, index, \"csi-access-other\",\n+\t\t`namespace \"other\" { capabilities = [\"csi-write-volume\"] }\n+         plugin { policy = \"read\" }\n+         node { policy = \"read\" }`).SecretID\n \n-\t// Create the volume\n \tvols := []*structs.CSIVolume{{\n \t\tID:             id0,\n-\t\tNamespace:      ns.Name,\n+\t\tNamespace:      ns,\n \t\tPluginID:       \"minnie\",\n \t\tAccessMode:     structs.CSIVolumeAccessModeSingleNodeReader, // legacy field ignored\n \t\tAttachmentMode: structs.CSIVolumeAttachmentModeBlockDevice,  // legacy field ignored\n@@ -252,57 +265,68 @@ func TestCSIVolumeEndpoint_Register(t *testing.T) {\n \t}}\n \n \t// Create the register request\n+\t// The token has access to the request namespace but not the volume namespace\n \treq1 := &structs.CSIVolumeRegisterRequest{\n \t\tVolumes: vols,\n \t\tWriteRequest: structs.WriteRequest{\n \t\t\tRegion:    \"global\",\n-\t\t\tNamespace: \"\",\n+\t\t\tAuthToken: invalidToken,\n+\t\t\tNamespace: otherNS,\n \t\t},\n \t}\n \tresp1 := &structs.CSIVolumeRegisterResponse{}\n \terr := msgpackrpc.CallWithCodec(codec, \"CSIVolume.Register\", req1, resp1)\n-\trequire.NoError(t, err)\n-\trequire.NotEqual(t, uint64(0), resp1.Index)\n+\tmust.EqError(t, err, \"Permission denied\")\n+\n+\t// Switch to a token that has access to the volume's namespace, but switch\n+\t// the request namespace to one that will be overwritten by the vol spec\n+\treq1.AuthToken = validToken\n+\treq1.Namespace = structs.DefaultNamespace\n+\terr = msgpackrpc.CallWithCodec(codec, \"CSIVolume.Register\", req1, resp1)\n+\tmust.NoError(t, err)\n+\tmust.NotEq(t, uint64(0), resp1.Index)\n \n \t// Get the volume back out\n \treq2 := &structs.CSIVolumeGetRequest{\n \t\tID: id0,\n \t\tQueryOptions: structs.QueryOptions{\n \t\t\tRegion:    \"global\",\n-\t\t\tNamespace: ns.Name,\n+\t\t\tNamespace: ns,\n+\t\t\tAuthToken: validToken,\n \t\t},\n \t}\n \tresp2 := &structs.CSIVolumeGetResponse{}\n \terr = msgpackrpc.CallWithCodec(codec, \"CSIVolume.Get\", req2, resp2)\n-\trequire.NoError(t, err)\n-\trequire.Equal(t, resp1.Index, resp2.Index)\n-\trequire.Equal(t, vols[0].ID, resp2.Volume.ID)\n-\trequire.Equal(t, \"csi.CSISecrets(map[mysecret:[REDACTED]])\",\n+\tmust.NoError(t, err)\n+\tmust.Eq(t, resp1.Index, resp2.Index)\n+\tmust.Eq(t, vols[0].ID, resp2.Volume.ID)\n+\tmust.Eq(t, \"csi.CSISecrets(map[mysecret:[REDACTED]])\",\n \t\tresp2.Volume.Secrets.String())\n-\trequire.Equal(t, \"csi.CSIOptions(FSType: ext4, MountFlags: [REDACTED])\",\n+\tmust.Eq(t, \"csi.CSIOptions(FSType: ext4, MountFlags: [REDACTED])\",\n \t\tresp2.Volume.MountOptions.String())\n \n \t// Registration does not update\n \treq1.Volumes[0].PluginID = \"adam\"\n \terr = msgpackrpc.CallWithCodec(codec, \"CSIVolume.Register\", req1, resp1)\n-\trequire.Error(t, err, \"exists\")\n+\tmust.ErrorContains(t, err, \"no CSI plugin named\")\n \n \t// Deregistration works\n \treq3 := &structs.CSIVolumeDeregisterRequest{\n \t\tVolumeIDs: []string{id0},\n \t\tWriteRequest: structs.WriteRequest{\n \t\t\tRegion:    \"global\",\n-\t\t\tNamespace: ns.Name,\n+\t\t\tNamespace: ns,\n+\t\t\tAuthToken: validToken,\n \t\t},\n \t}\n \tresp3 := &structs.CSIVolumeDeregisterResponse{}\n \terr = msgpackrpc.CallWithCodec(codec, \"CSIVolume.Deregister\", req3, resp3)\n-\trequire.NoError(t, err)\n+\tmust.NoError(t, err)\n \n \t// Volume is missing\n \terr = msgpackrpc.CallWithCodec(codec, \"CSIVolume.Get\", req2, resp2)\n-\trequire.NoError(t, err)\n-\trequire.Nil(t, resp2.Volume)\n+\tmust.NoError(t, err)\n+\tmust.Nil(t, resp2.Volume)\n }\n \n // TestCSIVolumeEndpoint_Claim exercises the VolumeClaim RPC, verifying that claims\n@@ -1098,7 +1122,7 @@ func TestCSIVolumeEndpoint_List_PaginationFiltering(t *testing.T) {\n func TestCSIVolumeEndpoint_Create(t *testing.T) {\n \tci.Parallel(t)\n \tvar err error\n-\tsrv, shutdown := TestServer(t, func(c *Config) {\n+\tsrv, rootToken, shutdown := TestACLServer(t, func(c *Config) {\n \t\tc.NumSchedulers = 0 // Prevent automatic dequeue\n \t})\n \tdefer shutdown()\n@@ -1132,11 +1156,11 @@ func TestCSIVolumeEndpoint_Create(t *testing.T) {\n \n \treq0 := &structs.NodeRegisterRequest{\n \t\tNode:         node,\n-\t\tWriteRequest: structs.WriteRequest{Region: \"global\"},\n+\t\tWriteRequest: structs.WriteRequest{Region: \"global\", AuthToken: rootToken.SecretID},\n \t}\n \tvar resp0 structs.NodeUpdateResponse\n \terr = client.RPC(\"Node.Register\", req0, &resp0)\n-\trequire.NoError(t, err)\n+\tmust.NoError(t, err)\n \n \ttestutil.WaitForResult(func() (bool, error) {\n \t\tnodes := srv.connectedNodes()\n@@ -1145,9 +1169,10 @@ func TestCSIVolumeEndpoint_Create(t *testing.T) {\n \t\tt.Fatalf(\"should have a client\")\n \t})\n \n-\tns := structs.DefaultNamespace\n+\tns := \"prod\"\n+\totherNS := \"other\"\n \n-\tstate := srv.fsm.State()\n+\tstore := srv.fsm.State()\n \tcodec := rpcClient(t, srv)\n \tindex := uint64(1000)\n \n@@ -1172,14 +1197,17 @@ func TestCSIVolumeEndpoint_Create(t *testing.T) {\n \t\t}\n \t}).Node\n \tindex++\n-\trequire.NoError(t, state.UpsertNode(structs.MsgTypeTestSetup, index, node))\n+\tmust.NoError(t, store.UpsertNode(structs.MsgTypeTestSetup, index, node))\n+\n+\tindex++\n+\tmust.NoError(t, store.UpsertNamespaces(index, []*structs.Namespace{{Name: ns}, {Name: otherNS}}))\n \n \t// Create the volume\n \tvolID := uuid.Generate()\n \tvols := []*structs.CSIVolume{{\n \t\tID:             volID,\n \t\tName:           \"vol\",\n-\t\tNamespace:      \"\", // overriden by WriteRequest\n+\t\tNamespace:      ns,\n \t\tPluginID:       \"minnie\",\n \t\tAccessMode:     structs.CSIVolumeAccessModeSingleNodeReader, // legacy field ignored\n \t\tAttachmentMode: structs.CSIVolumeAttachmentModeBlockDevice,  // legacy field ignored\n@@ -1200,48 +1228,73 @@ func TestCSIVolumeEndpoint_Create(t *testing.T) {\n \t\t},\n \t}}\n \n+\tindex++\n+\tvalidToken := mock.CreatePolicyAndToken(t, store, index, \"csi-access-ns\",\n+\t\t`namespace \"prod\" { capabilities = [\"csi-write-volume\", \"csi-read-volume\"] }\n+         namespace \"default\" { capabilities = [\"csi-write-volume\"] }\n+         plugin { policy = \"read\" }\n+         node { policy = \"read\" }`).SecretID\n+\n+\tindex++\n+\tinvalidToken := mock.CreatePolicyAndToken(t, store, index, \"csi-access-other\",\n+\t\t`namespace \"other\" { capabilities = [\"csi-write-volume\"] }\n+         plugin { policy = \"read\" }\n+         node { policy = \"read\" }`).SecretID\n+\n \t// Create the create request\n+\t// The token has access to the request namespace but not the volume namespace\n \treq1 := &structs.CSIVolumeCreateRequest{\n \t\tVolumes: vols,\n \t\tWriteRequest: structs.WriteRequest{\n \t\t\tRegion:    \"global\",\n-\t\t\tNamespace: ns,\n+\t\t\tAuthToken: invalidToken,\n+\t\t\tNamespace: otherNS,\n \t\t},\n \t}\n \tresp1 := &structs.CSIVolumeCreateResponse{}\n \terr = msgpackrpc.CallWithCodec(codec, \"CSIVolume.Create\", req1, resp1)\n-\trequire.NoError(t, err)\n+\tmust.EqError(t, err, \"Permission denied\")\n+\n+\t// Switch to a token that has access to the volume's namespace, but switch\n+\t// the request namespace to one that will be overwritten by the vol spec\n+\treq1.AuthToken = validToken\n+\treq1.Namespace = structs.DefaultNamespace\n+\terr = msgpackrpc.CallWithCodec(codec, \"CSIVolume.Create\", req1, resp1)\n+\tmust.NoError(t, err)\n+\tmust.NotEq(t, uint64(0), resp1.Index)\n \n \t// Get the volume back out\n \treq2 := &structs.CSIVolumeGetRequest{\n \t\tID: volID,\n \t\tQueryOptions: structs.QueryOptions{\n-\t\t\tRegion: \"global\",\n+\t\t\tRegion:    \"global\",\n+\t\t\tNamespace: ns,\n+\t\t\tAuthToken: validToken,\n \t\t},\n \t}\n \tresp2 := &structs.CSIVolumeGetResponse{}\n \terr = msgpackrpc.CallWithCodec(codec, \"CSIVolume.Get\", req2, resp2)\n-\trequire.NoError(t, err)\n-\trequire.Equal(t, resp1.Index, resp2.Index)\n+\tmust.NoError(t, err)\n+\tmust.Eq(t, resp1.Index, resp2.Index)\n \n \tvol := resp2.Volume\n-\trequire.NotNil(t, vol)\n-\trequire.Equal(t, volID, vol.ID)\n+\tmust.NotNil(t, vol)\n+\tmust.Eq(t, volID, vol.ID)\n \n \t// these fields are set from the args\n-\trequire.Equal(t, \"csi.CSISecrets(map[mysecret:[REDACTED]])\",\n+\tmust.Eq(t, \"csi.CSISecrets(map[mysecret:[REDACTED]])\",\n \t\tvol.Secrets.String())\n-\trequire.Equal(t, \"csi.CSIOptions(FSType: ext4, MountFlags: [REDACTED])\",\n+\tmust.Eq(t, \"csi.CSIOptions(FSType: ext4, MountFlags: [REDACTED])\",\n \t\tvol.MountOptions.String())\n-\trequire.Equal(t, ns, vol.Namespace)\n-\trequire.Len(t, vol.RequestedCapabilities, 1)\n+\tmust.Eq(t, ns, vol.Namespace)\n+\tmust.Len(t, 1, vol.RequestedCapabilities)\n \n \t// these fields are set from the plugin and should have been written to raft\n-\trequire.Equal(t, \"vol-12345\", vol.ExternalID)\n-\trequire.Equal(t, int64(42), vol.Capacity)\n-\trequire.Equal(t, \"bar\", vol.Context[\"plugincontext\"])\n-\trequire.Equal(t, \"\", vol.Context[\"mycontext\"])\n-\trequire.Equal(t, map[string]string{\"rack\": \"R1\"}, vol.Topologies[0].Segments)\n+\tmust.Eq(t, \"vol-12345\", vol.ExternalID)\n+\tmust.Eq(t, int64(42), vol.Capacity)\n+\tmust.Eq(t, \"bar\", vol.Context[\"plugincontext\"])\n+\tmust.Eq(t, \"\", vol.Context[\"mycontext\"])\n+\tmust.Eq(t, map[string]string{\"rack\": \"R1\"}, vol.Topologies[0].Segments)\n }\n \n func TestCSIVolumeEndpoint_Delete(t *testing.T) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/filamentphp/filament/commits/19f5347f0e17d9f4eb515e24ea5632031c6829df",
        "url": "https://api.github.com/repos/filamentphp/filament/commits/19f5347f0e17d9f4eb515e24ea5632031c6829df",
        "html_url": "https://github.com/filamentphp/filament/commit/19f5347f0e17d9f4eb515e24ea5632031c6829df",
        "message": "Dynamically swap public for local disk for exports",
        "files": [
            {
                "sha": "eb1bb23a4b158852a111b597ac6df63d349af8ab",
                "filename": "packages/actions/docs/01-installation.md",
                "status": "modified",
                "additions": 0,
                "deletions": 8,
                "changes": 8,
                "blob_url": "https://github.com/filamentphp/filament/blob/19f5347f0e17d9f4eb515e24ea5632031c6829df/packages%2Factions%2Fdocs%2F01-installation.md",
                "raw_url": "https://github.com/filamentphp/filament/raw/19f5347f0e17d9f4eb515e24ea5632031c6829df/packages%2Factions%2Fdocs%2F01-installation.md",
                "contents_url": "https://api.github.com/repos/filamentphp/filament/contents/packages%2Factions%2Fdocs%2F01-installation.md?ref=19f5347f0e17d9f4eb515e24ea5632031c6829df",
                "patch": "@@ -147,14 +147,6 @@ Create a new `resources/views/components/layouts/app.blade.php` layout file for\n </html>\n ```\n \n-## Deploying to production\n-\n-### Using a production-ready storage disk\n-\n-Filament has a storage disk defined in the [configuration](#publishing-configuration), which by default is set to `public`. You can set the `FILAMENT_FILESYSTEM_DISK` environment variable to change this.\n-\n-The `public` disk, while great for easy local development, is not suitable for production. It does not support file visibility, so features of Filament such as [exports](prebuilt-actions/export) will create public files. In production, you need to use a production-ready disk such as `s3` with a private access policy, to prevent unauthorized access to the exported files.\n-\n ## Publishing configuration\n \n You can publish the package configuration using the following command (optional):"
            },
            {
                "sha": "2827aefc9df7ae6868c8b538d190409f03eadfd4",
                "filename": "packages/actions/docs/07-prebuilt-actions/09-export.md",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/filamentphp/filament/blob/19f5347f0e17d9f4eb515e24ea5632031c6829df/packages%2Factions%2Fdocs%2F07-prebuilt-actions%2F09-export.md",
                "raw_url": "https://github.com/filamentphp/filament/raw/19f5347f0e17d9f4eb515e24ea5632031c6829df/packages%2Factions%2Fdocs%2F07-prebuilt-actions%2F09-export.md",
                "contents_url": "https://api.github.com/repos/filamentphp/filament/contents/packages%2Factions%2Fdocs%2F07-prebuilt-actions%2F09-export.md?ref=19f5347f0e17d9f4eb515e24ea5632031c6829df",
                "patch": "@@ -4,8 +4,6 @@ title: Export action\n \n ## Overview\n \n-> Please note that this feature uses the Filament filesystem to store exported files. The disk used by the Filament filesystem is defined in the [configuration file](../installation#publishing-configuration). By default, the disk is set to `public` for easy local development, so when using Filament exports in production, please make sure that you use a production-ready disk such as `s3` with a private access policy. You may also consider [customizing the storage disk](#customizing-the-storage-disk) for exports only.\n-\n Filament v3.2 introduced a prebuilt action that is able to export rows to a CSV or XLSX file. When the trigger button is clicked, a modal asks for the columns that they want to export, and what they should be labeled. This feature uses [job batches](https://laravel.com/docs/queues#job-batching) and [database notifications](../../notifications/database-notifications#overview), so you need to publish those migrations from Laravel. Also, you need to publish the migrations for tables that Filament uses to store information about exports:\n \n ```bash\n@@ -380,7 +378,11 @@ public static function modifyQuery(Builder $query): Builder\n \n ### Customizing the storage disk\n \n-By default, exported files will be uploaded to the storage disk defined in the [configuration file](../installation#publishing-configuration), which is `public` by default. You can set the `FILAMENT_FILESYSTEM_DISK` environment variable to change this. In production, you need to use a production-ready disk such as `s3` with a private access policy, to prevent unauthorized access to the exported files.\n+By default, exported files will be uploaded to the storage disk defined in the [configuration file](../installation#publishing-configuration), which is `public` by default. You can set the `FILAMENT_FILESYSTEM_DISK` environment variable to change this.\n+\n+While using the `public` disk a good default for many parts of Filament, using it for exports would result in exported files being stored in a public location. As such, if the default filesystem disk is `public` and a `local` disk exists in your `config/filesystems.php`, Filament will use the `local` disk for exports instead. If you override the disk to be `public` for an `ExportAction` or inside an exporter class, Filament will use that.\n+\n+In production, you should use a disk such as `s3` with a private access policy, to prevent unauthorized access to the exported files.\n \n If you want to use a different disk for a specific export, you can pass the disk name to the `disk()` method on the action:\n "
            },
            {
                "sha": "e7fc9e73b9fa860d1fd0578b1b2736c9dc3a83e3",
                "filename": "packages/actions/src/Exports/Exporter.php",
                "status": "modified",
                "additions": 7,
                "deletions": 1,
                "changes": 8,
                "blob_url": "https://github.com/filamentphp/filament/blob/19f5347f0e17d9f4eb515e24ea5632031c6829df/packages%2Factions%2Fsrc%2FExports%2FExporter.php",
                "raw_url": "https://github.com/filamentphp/filament/raw/19f5347f0e17d9f4eb515e24ea5632031c6829df/packages%2Factions%2Fsrc%2FExports%2FExporter.php",
                "contents_url": "https://api.github.com/repos/filamentphp/filament/contents/packages%2Factions%2Fsrc%2FExports%2FExporter.php?ref=19f5347f0e17d9f4eb515e24ea5632031c6829df",
                "patch": "@@ -143,7 +143,13 @@ public function getOptions(): array\n \n     public function getFileDisk(): string\n     {\n-        return config('filament.default_filesystem_disk');\n+        $disk = config('filament.default_filesystem_disk');\n+\n+        if (($disk === 'public') && array_key_exists('local', config('filesystems.disks'))) {\n+            return 'local';\n+        }\n+\n+        return $disk;\n     }\n \n     public function getFileName(Export $export): string"
            },
            {
                "sha": "52e0e8bba221950c6a9c771d82af03920e7a96a8",
                "filename": "packages/panels/docs/01-installation.md",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/filamentphp/filament/blob/19f5347f0e17d9f4eb515e24ea5632031c6829df/packages%2Fpanels%2Fdocs%2F01-installation.md",
                "raw_url": "https://github.com/filamentphp/filament/raw/19f5347f0e17d9f4eb515e24ea5632031c6829df/packages%2Fpanels%2Fdocs%2F01-installation.md",
                "contents_url": "https://api.github.com/repos/filamentphp/filament/contents/packages%2Fpanels%2Fdocs%2F01-installation.md?ref=19f5347f0e17d9f4eb515e24ea5632031c6829df",
                "patch": "@@ -116,7 +116,7 @@ Learn more about [users](users).\n \n Filament has a storage disk defined in the [configuration](#publishing-configuration), which by default is set to `public`. You can set the `FILAMENT_FILESYSTEM_DISK` environment variable to change this.\n \n-The `public` disk, while great for easy local development, is not suitable for production. It does not support file visibility, so features of Filament such as [exports](../actions/prebuilt-actions/export) will create public files. In production, you need to use a production-ready disk such as `s3` with a private access policy, to prevent unauthorized access to the exported files.\n+The `public` disk, while great for easy local development, is not suitable for production. It does not support file visibility, so features of Filament such as [file uploads](../forms/fields/file-upload) will create public files. In production, you need to use a production-ready disk such as `s3` with a private access policy, to prevent unauthorized access to the uploaded files.\n \n ## Publishing configuration\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/devtron-labs/devtron/commits/1540271bd777b6bccd288e513a9070d8f04b6056",
        "url": "https://api.github.com/repos/devtron-labs/devtron/commits/1540271bd777b6bccd288e513a9070d8f04b6056",
        "html_url": "https://github.com/devtron-labs/devtron/commit/1540271bd777b6bccd288e513a9070d8f04b6056",
        "message": "fix: sql injection fixes (#5783)\n\n* sql injection fixes\r\n\r\n* query param init fix",
        "files": [
            {
                "sha": "f11bfef4156e94096d233a2ec84cd77e4deb399e",
                "filename": "pkg/auth/user/repository/UserAuthRepository.go",
                "status": "modified",
                "additions": 60,
                "deletions": 26,
                "changes": 86,
                "blob_url": "https://github.com/devtron-labs/devtron/blob/1540271bd777b6bccd288e513a9070d8f04b6056/pkg%2Fauth%2Fuser%2Frepository%2FUserAuthRepository.go",
                "raw_url": "https://github.com/devtron-labs/devtron/raw/1540271bd777b6bccd288e513a9070d8f04b6056/pkg%2Fauth%2Fuser%2Frepository%2FUserAuthRepository.go",
                "contents_url": "https://api.github.com/repos/devtron-labs/devtron/contents/pkg%2Fauth%2Fuser%2Frepository%2FUserAuthRepository.go?ref=1540271bd777b6bccd288e513a9070d8f04b6056",
                "patch": "@@ -945,40 +945,48 @@ func (impl UserAuthRepositoryImpl) GetRolesForWorkflow(workflow, entityName stri\n \n func (impl UserAuthRepositoryImpl) GetRoleForClusterEntity(cluster, namespace, group, kind, resource, action string) (RoleModel, error) {\n \tvar model RoleModel\n+\tvar queryParams []string\n \tquery := \"SELECT * FROM roles  WHERE entity = ? \"\n+\tqueryParams = append(queryParams, bean.CLUSTER_ENTITIY)\n \tvar err error\n \n \tif len(cluster) > 0 {\n-\t\tquery += \" and cluster='\" + cluster + \"' \"\n+\t\tquery += \" and cluster = ? \"\n+\t\tqueryParams = append(queryParams, cluster)\n \t} else {\n \t\tquery += \" and cluster IS NULL \"\n \t}\n \tif len(namespace) > 0 {\n-\t\tquery += \" and namespace='\" + namespace + \"' \"\n+\t\tquery += \" and namespace = ? \"\n+\t\tqueryParams = append(queryParams, namespace)\n \t} else {\n \t\tquery += \" and namespace IS NULL \"\n \t}\n \tif len(group) > 0 {\n-\t\tquery += \" and \\\"group\\\"='\" + group + \"' \"\n+\t\tquery += \" and \\\"group\\\"= ? \"\n+\t\tqueryParams = append(queryParams, group)\n \t} else {\n \t\tquery += \" and \\\"group\\\" IS NULL \"\n \t}\n \tif len(kind) > 0 {\n-\t\tquery += \" and kind='\" + kind + \"' \"\n+\t\tquery += \" and kind = ? \"\n+\t\tqueryParams = append(queryParams, kind)\n \t} else {\n \t\tquery += \" and kind IS NULL \"\n \t}\n \tif len(resource) > 0 {\n-\t\tquery += \" and resource='\" + resource + \"' \"\n+\t\tquery += \" and resource = ? \"\n+\t\tqueryParams = append(queryParams, resource)\n \t} else {\n \t\tquery += \" and resource IS NULL \"\n \t}\n \tif len(action) > 0 {\n-\t\tquery += \" and action='\" + action + \"' ;\"\n+\t\tquery += \" and action = ? ;\"\n+\t\tqueryParams = append(queryParams, action)\n \t} else {\n \t\tquery += \" and action IS NULL ;\"\n \t}\n-\t_, err = impl.dbConnection.Query(&model, query, bean.CLUSTER_ENTITIY)\n+\t_, err = impl.dbConnection.Query(&model, query, queryParams)\n \tif err != nil {\n \t\timpl.Logger.Errorw(\"error in getting roles for clusterEntity\", \"err\", err,\n \t\t\tbean2.CLUSTER, cluster, \"namespace\", namespace, \"kind\", kind, \"group\", group, \"resource\", resource)\n@@ -990,24 +998,29 @@ func (impl UserAuthRepositoryImpl) GetRoleForClusterEntity(cluster, namespace, g\n func (impl UserAuthRepositoryImpl) GetRoleForJobsEntity(entity, team, app, env, act string, workflow string) (RoleModel, error) {\n \tvar model RoleModel\n \tvar err error\n+\tvar queryParams []string\n \tif len(team) > 0 && len(act) > 0 {\n \t\tquery := \"SELECT role.* FROM roles role WHERE role.team = ? AND role.action=? AND role.entity=? \"\n+\t\tqueryParams = append(queryParams, team, act, entity)\n \t\tif len(env) == 0 {\n \t\t\tquery = query + \" AND role.environment is NULL\"\n \t\t} else {\n-\t\t\tquery += \"AND role.environment='\" + env + \"'\"\n+\t\t\tquery += \"AND role.environment = ? \"\n+\t\t\tqueryParams = append(queryParams, env)\n \t\t}\n \t\tif len(app) == 0 {\n \t\t\tquery = query + \" AND role.entity_name is NULL\"\n \t\t} else {\n-\t\t\tquery += \" AND role.entity_name='\" + app + \"'\"\n+\t\t\tquery += \" AND role.entity_name = ? \"\n+\t\t\tqueryParams = append(queryParams, app)\n \t\t}\n \t\tif len(workflow) == 0 {\n \t\t\tquery = query + \" AND role.workflow is NULL;\"\n \t\t} else {\n-\t\t\tquery += \" AND role.workflow='\" + workflow + \"';\"\n+\t\t\tquery += \" AND role.workflow = ? ;\"\n+\t\t\tqueryParams = append(queryParams, workflow)\n \t\t}\n-\t\t_, err = impl.dbConnection.Query(&model, query, team, act, entity)\n+\t\t_, err = impl.dbConnection.Query(&model, query, queryParams)\n \t} else {\n \t\treturn model, nil\n \t}\n@@ -1021,21 +1034,27 @@ func (impl UserAuthRepositoryImpl) GetRoleForChartGroupEntity(entity, app, act,\n \tvar model RoleModel\n \tvar err error\n \tif len(app) > 0 && act == \"update\" {\n+\t\tvar queryParams []string\n \t\tquery := \"SELECT role.* FROM roles role WHERE role.entity = ? AND role.entity_name=? AND role.action=?\"\n+\t\tqueryParams = append(queryParams, entity, app, act)\n \t\tif len(accessType) == 0 {\n \t\t\tquery = query + \" and role.access_type is NULL\"\n \t\t} else {\n-\t\t\tquery += \" and role.access_type='\" + accessType + \"'\"\n+\t\t\tquery += \" and role.access_type = ? \"\n+\t\t\tqueryParams = append(queryParams, accessType)\n \t\t}\n-\t\t_, err = impl.dbConnection.Query(&model, query, entity, app, act)\n+\t\t_, err = impl.dbConnection.Query(&model, query, queryParams)\n \t} else if app == \"\" {\n+\t\tvar queryParams []string\n \t\tquery := \"SELECT role.* FROM roles role WHERE role.entity = ? AND role.action=?\"\n+\t\tqueryParams = append(queryParams, entity, act)\n \t\tif len(accessType) == 0 {\n \t\t\tquery = query + \" and role.access_type is NULL\"\n \t\t} else {\n-\t\t\tquery += \" and role.access_type='\" + accessType + \"'\"\n+\t\t\tquery += \" and role.access_type = ? \"\n+\t\t\tqueryParams = append(queryParams, accessType)\n \t\t}\n-\t\t_, err = impl.dbConnection.Query(&model, query, entity, act)\n+\t\t_, err = impl.dbConnection.Query(&model, query, queryParams)\n \t}\n \tif err != nil {\n \t\timpl.Logger.Errorw(\"error in getting role for chart group entity\", \"err\", err, \"entity\", entity, \"app\", app, \"act\", act, \"accessType\", accessType)\n@@ -1047,52 +1066,67 @@ func (impl UserAuthRepositoryImpl) GetRoleForOtherEntity(team, app, env, act, ac\n \tvar model RoleModel\n \tvar err error\n \tif len(team) > 0 && len(app) > 0 && len(env) > 0 && len(act) > 0 {\n+\t\tvar queryParams []string\n \t\tquery := \"SELECT role.* FROM roles role WHERE role.team = ? AND role.entity_name=? AND role.environment=? AND role.action=?\"\n+\t\tqueryParams = append(queryParams, team, app, env, act)\n \t\tif oldValues {\n \t\t\tquery = query + \" and role.access_type is NULL\"\n \t\t} else {\n-\t\t\tquery += \" and role.access_type='\" + accessType + \"'\"\n+\t\t\tquery += \" and role.access_type = ? \"\n+\t\t\tqueryParams = append(queryParams, accessType)\n \t\t}\n \n-\t\t_, err = impl.dbConnection.Query(&model, query, team, app, env, act)\n+\t\t_, err = impl.dbConnection.Query(&model, query, queryParams)\n \t} else if len(team) > 0 && app == \"\" && len(env) > 0 && len(act) > 0 {\n-\n+\t\tvar queryParams []string\n \t\tquery := \"SELECT role.* FROM roles role WHERE role.team=? AND coalesce(role.entity_name,'')=? AND role.environment=? AND role.action=?\"\n+\t\tqueryParams = append(queryParams, team, EMPTY_PLACEHOLDER_FOR_QUERY, env, act)\n \t\tif oldValues {\n \t\t\tquery = query + \" and role.access_type is NULL\"\n \t\t} else {\n-\t\t\tquery += \" and role.access_type='\" + accessType + \"'\"\n+\t\t\tquery += \" and role.access_type = ? \"\n+\t\t\tqueryParams = append(queryParams, accessType)\n \t\t}\n-\t\t_, err = impl.dbConnection.Query(&model, query, team, EMPTY_PLACEHOLDER_FOR_QUERY, env, act)\n+\t\t_, err = impl.dbConnection.Query(&model, query, queryParams)\n \t} else if len(team) > 0 && len(app) > 0 && env == \"\" && len(act) > 0 {\n+\t\tvar queryParams []string\n \t\t//this is applicable for all environment of a team\n \t\tquery := \"SELECT role.* FROM roles role WHERE role.team = ? AND role.entity_name=? AND coalesce(role.environment,'')=? AND role.action=?\"\n+\t\tqueryParams = append(queryParams, team, app, EMPTY_PLACEHOLDER_FOR_QUERY, act)\n \t\tif oldValues {\n \t\t\tquery = query + \" and role.access_type is NULL\"\n \t\t} else {\n-\t\t\tquery += \" and role.access_type='\" + accessType + \"'\"\n+\t\t\tquery += \" and role.access_type = ? \"\n+\t\t\tqueryParams = append(queryParams, accessType)\n \t\t}\n \n-\t\t_, err = impl.dbConnection.Query(&model, query, team, app, EMPTY_PLACEHOLDER_FOR_QUERY, act)\n+\t\t_, err = impl.dbConnection.Query(&model, query, queryParams)\n \t} else if len(team) > 0 && app == \"\" && env == \"\" && len(act) > 0 {\n+\t\tvar queryParams []string\n \t\t//this is applicable for all environment of a team\n \t\tquery := \"SELECT role.* FROM roles role WHERE role.team = ? AND coalesce(role.entity_name,'')=? AND coalesce(role.environment,'')=? AND role.action=?\"\n+\t\tqueryParams = append(queryParams, team, EMPTY_PLACEHOLDER_FOR_QUERY, EMPTY_PLACEHOLDER_FOR_QUERY, act)\n \t\tif oldValues {\n \t\t\tquery = query + \" and role.access_type is NULL\"\n \t\t} else {\n-\t\t\tquery += \" and role.access_type='\" + accessType + \"'\"\n+\t\t\tquery += \" and role.access_type = ? \"\n+\t\t\tqueryParams = append(queryParams, accessType)\n \t\t}\n \n-\t\t_, err = impl.dbConnection.Query(&model, query, team, EMPTY_PLACEHOLDER_FOR_QUERY, EMPTY_PLACEHOLDER_FOR_QUERY, act)\n+\t\t_, err = impl.dbConnection.Query(&model, query, queryParams)\n \t} else if team == \"\" && app == \"\" && env == \"\" && len(act) > 0 {\n+\t\tvar queryParams []string\n \t\t//this is applicable for super admin, all env, all team, all app\n \t\tquery := \"SELECT role.* FROM roles role WHERE coalesce(role.team,'') = ? AND coalesce(role.entity_name,'')=? AND coalesce(role.environment,'')=? AND role.action=?\"\n+\t\tqueryParams = append(queryParams, EMPTY_PLACEHOLDER_FOR_QUERY, EMPTY_PLACEHOLDER_FOR_QUERY, EMPTY_PLACEHOLDER_FOR_QUERY, act)\n \t\tif len(accessType) == 0 {\n \t\t\tquery = query + \" and role.access_type is NULL\"\n \t\t} else {\n-\t\t\tquery += \" and role.access_type='\" + accessType + \"'\"\n+\t\t\tquery += \" and role.access_type = ? \"\n+\t\t\tqueryParams = append(queryParams, accessType)\n+\n \t\t}\n-\t\t_, err = impl.dbConnection.Query(&model, query, EMPTY_PLACEHOLDER_FOR_QUERY, EMPTY_PLACEHOLDER_FOR_QUERY, EMPTY_PLACEHOLDER_FOR_QUERY, act)\n+\t\t_, err = impl.dbConnection.Query(&model, query, queryParams)\n \t} else if team == \"\" && app == \"\" && env == \"\" && act == \"\" {\n \t\treturn model, nil\n \t} else {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/fengzeroz/neuron/commits/c9ce39747e0372aaa2157b2b56174914a12c06d8",
        "url": "https://api.github.com/repos/fengzeroz/neuron/commits/c9ce39747e0372aaa2157b2b56174914a12c06d8",
        "html_url": "https://github.com/fengzeroz/neuron/commit/c9ce39747e0372aaa2157b2b56174914a12c06d8",
        "message": "#2281: check plugin schema exist",
        "files": [
            {
                "sha": "c5d3f34961168bd85df4830197dbe1dc0f0766d3",
                "filename": "include/neuron/msg.h",
                "status": "modified",
                "additions": 15,
                "deletions": 0,
                "changes": 15,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/include%2Fneuron%2Fmsg.h",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/include%2Fneuron%2Fmsg.h",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/include%2Fneuron%2Fmsg.h?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -122,6 +122,9 @@ typedef enum neu_reqresp_type {\n \n     NEU_REQ_SCAN_TAGS,\n     NEU_RESP_SCAN_TAGS,\n+\n+    NEU_REQ_CHECK_SCHEMA,\n+    NEU_RESP_CHECK_SCHEMA,\n } neu_reqresp_type_e;\n \n static const char *neu_reqresp_type_string_t[] = {\n@@ -204,6 +207,9 @@ static const char *neu_reqresp_type_string_t[] = {\n \n     [NEU_REQ_SCAN_TAGS]  = \"NEU_REQ_SCAN_TAGS\",\n     [NEU_RESP_SCAN_TAGS] = \"NEU_RESP_SCAN_TAGS\",\n+\n+    [NEU_REQ_CHECK_SCHEMA]  = \"NEU_REQ_CHECK_SCHEMA\",\n+    [NEU_RESP_CHECK_SCHEMA] = \"NEU_RESP_CHECK_SCHEMA\",\n };\n \n inline static const char *neu_reqresp_type_string(neu_reqresp_type_e type)\n@@ -232,6 +238,15 @@ typedef struct neu_resp_error {\n     int error;\n } neu_resp_error_t;\n \n+typedef struct neu_req_check_schema {\n+    char schema[NEU_PLUGIN_NAME_LEN];\n+} neu_req_check_schema_t;\n+\n+typedef struct {\n+    bool exist;\n+    char schema[NEU_PLUGIN_NAME_LEN];\n+} neu_resp_check_schema_t;\n+\n typedef struct {\n     char                     node[NEU_NODE_NAME_LEN];\n     neu_node_running_state_e state;"
            },
            {
                "sha": "b03557c39bc58ed1f7a8014df708512eddb7e023",
                "filename": "plugins/restful/normal_handle.c",
                "status": "modified",
                "additions": 61,
                "deletions": 34,
                "changes": 95,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/plugins%2Frestful%2Fnormal_handle.c",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/plugins%2Frestful%2Fnormal_handle.c",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/plugins%2Frestful%2Fnormal_handle.c?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -289,10 +289,9 @@ static inline const char *plugin_name_to_schema_name(const char *name)\n \n void handle_get_plugin_schema(nng_aio *aio)\n {\n-    size_t      len                        = 0;\n-    char *      schema_path                = NULL;\n-    char        param[NEU_PLUGIN_NAME_LEN] = { 0 };\n-    const char *schema_name                = param;\n+    char          param[NEU_PLUGIN_NAME_LEN] = { 0 };\n+    const char *  schema_name                = param;\n+    neu_plugin_t *plugin                     = neu_rest_get_plugin();\n \n     NEU_VALIDATE_JWT(aio);\n \n@@ -302,56 +301,84 @@ void handle_get_plugin_schema(nng_aio *aio)\n         rv = neu_http_get_param_str(aio, \"plugin_name\", param, sizeof(param));\n         schema_name = plugin_name_to_schema_name(param);\n     }\n-    if (rv < 0) {\n+    if (rv < 0 || strlen(schema_name) >= NEU_PLUGIN_NAME_LEN) {\n         neu_http_bad_request(aio, \"{\\\"error\\\": 1002}\");\n         return;\n     }\n \n-    if (0 > neu_asprintf(&schema_path, \"%s/schema/%s.json\", g_plugin_dir,\n-                         schema_name)) {\n-        NEU_JSON_RESPONSE_ERROR(NEU_ERR_EINTERNAL, {\n-            neu_http_response(aio, error_code.error, result_error);\n+    int                    ret    = 0;\n+    neu_reqresp_head_t     header = { 0 };\n+    neu_req_check_schema_t cmd    = { 0 };\n+\n+    header.otel_trace_type = NEU_OTEL_TRACE_TYPE_REST_COMM;\n+\n+    header.ctx  = aio;\n+    header.type = NEU_REQ_CHECK_SCHEMA;\n+    strcpy(cmd.schema, schema_name);\n+\n+    ret = neu_plugin_op(plugin, header, &cmd);\n+    if (ret != 0) {\n+        NEU_JSON_RESPONSE_ERROR(NEU_ERR_IS_BUSY, {\n+            neu_http_response(aio, NEU_ERR_IS_BUSY, result_error);\n         });\n-        return;\n     }\n+}\n \n-    char *buf = NULL;\n+void handle_get_plugin_schema_resp(nng_aio *aio, neu_resp_check_schema_t *resp)\n+{\n+    if (resp->exist) {\n+        char * schema_path = NULL;\n+        size_t len         = 0;\n+        char * buf         = NULL;\n \n-    buf = file_string_read(&len, schema_path);\n-    if (NULL == buf) {\n-        free(schema_path);\n-        if (0 > neu_asprintf(&schema_path, \"%s/custom/schema/%s.json\",\n-                             g_plugin_dir, schema_name)) {\n+        if (0 > neu_asprintf(&schema_path, \"%s/schema/%s.json\", g_plugin_dir,\n+                             resp->schema)) {\n             NEU_JSON_RESPONSE_ERROR(NEU_ERR_EINTERNAL, {\n                 neu_http_response(aio, error_code.error, result_error);\n             });\n             return;\n         }\n+\n         buf = file_string_read(&len, schema_path);\n-    }\n+        if (NULL == buf) {\n+            free(schema_path);\n+            if (0 > neu_asprintf(&schema_path, \"%s/custom/schema/%s.json\",\n+                                 g_plugin_dir, resp->schema)) {\n+                NEU_JSON_RESPONSE_ERROR(NEU_ERR_EINTERNAL, {\n+                    neu_http_response(aio, error_code.error, result_error);\n+                });\n+                return;\n+            }\n+            buf = file_string_read(&len, schema_path);\n+        }\n \n-    if (NULL == buf) {\n-        free(schema_path);\n-        if (0 > neu_asprintf(&schema_path, \"%s/system/schema/%s.json\",\n-                             g_plugin_dir, schema_name)) {\n-            NEU_JSON_RESPONSE_ERROR(NEU_ERR_EINTERNAL, {\n-                neu_http_response(aio, error_code.error, result_error);\n-            });\n+        if (NULL == buf) {\n+            free(schema_path);\n+            if (0 > neu_asprintf(&schema_path, \"%s/system/schema/%s.json\",\n+                                 g_plugin_dir, resp->schema)) {\n+                NEU_JSON_RESPONSE_ERROR(NEU_ERR_EINTERNAL, {\n+                    neu_http_response(aio, error_code.error, result_error);\n+                });\n+                return;\n+            }\n+            buf = file_string_read(&len, schema_path);\n+        }\n+\n+        if (NULL == buf) {\n+            nlog_info(\"open %s error: %d\", schema_path, errno);\n+            neu_http_not_found(aio, \"{\\\"status\\\": \\\"error\\\"}\");\n+            free(schema_path);\n             return;\n         }\n-        buf = file_string_read(&len, schema_path);\n-    }\n \n-    if (NULL == buf) {\n-        nlog_info(\"open %s error: %d\", schema_path, errno);\n-        neu_http_not_found(aio, \"{\\\"status\\\": \\\"error\\\"}\");\n+        neu_http_ok(aio, buf);\n+        free(buf);\n         free(schema_path);\n-        return;\n+    } else {\n+        NEU_JSON_RESPONSE_ERROR(NEU_ERR_PLUGIN_NOT_FOUND, {\n+            neu_http_response(aio, error_code.error, result_error);\n+        });\n     }\n-\n-    neu_http_ok(aio, buf);\n-    free(buf);\n-    free(schema_path);\n }\n \n void handle_status(nng_aio *aio)"
            },
            {
                "sha": "6ac17d1731cf9e53fb9c42a9e4bf1393370767c9",
                "filename": "plugins/restful/normal_handle.h",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/plugins%2Frestful%2Fnormal_handle.h",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/plugins%2Frestful%2Fnormal_handle.h",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/plugins%2Frestful%2Fnormal_handle.h?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -22,10 +22,13 @@\n \n #include <nng/nng.h>\n \n+#include \"msg.h\"\n+\n void handle_ping(nng_aio *aio);\n void handle_login(nng_aio *aio);\n void handle_password(nng_aio *aio);\n void handle_get_plugin_schema(nng_aio *aio);\n+void handle_get_plugin_schema_resp(nng_aio *aio, neu_resp_check_schema_t *resp);\n void handle_status(nng_aio *aio);\n \n #endif\n\\ No newline at end of file"
            },
            {
                "sha": "3c0191f14382ba7bca7ceff7a2671a332a455292",
                "filename": "plugins/restful/rest.c",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/plugins%2Frestful%2Frest.c",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/plugins%2Frestful%2Frest.c",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/plugins%2Frestful%2Frest.c?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -31,6 +31,7 @@\n #include \"global_config_handle.h\"\n #include \"group_config_handle.h\"\n #include \"handle.h\"\n+#include \"normal_handle.h\"\n #include \"otel/otel_manager.h\"\n #include \"plugin_handle.h\"\n #include \"rest.h\"\n@@ -211,6 +212,14 @@ static int dashb_plugin_request(neu_plugin_t *      plugin,\n         }\n         break;\n     }\n+    case NEU_RESP_CHECK_SCHEMA: {\n+        handle_get_plugin_schema_resp(header->ctx,\n+                                      (neu_resp_check_schema_t *) data);\n+        if (neu_otel_control_is_started() && trace) {\n+            neu_otel_scope_set_status_code2(scope, NEU_OTEL_STATUS_OK, 0);\n+        }\n+        break;\n+    }\n     case NEU_RESP_GET_PLUGIN:\n         handle_get_plugin_resp(header->ctx, (neu_resp_get_plugin_t *) data);\n         if (neu_otel_control_is_started() && trace) {"
            },
            {
                "sha": "169f73571476aa8abd4d8d5cbc6be75b134f80ab",
                "filename": "src/adapter/adapter.c",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fadapter%2Fadapter.c",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fadapter%2Fadapter.c",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/src%2Fadapter%2Fadapter.c?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -509,6 +509,7 @@ static int adapter_command(neu_adapter_t *adapter, neu_reqresp_head_t header,\n         strcpy(pheader->receiver, cmd->node);\n         break;\n     }\n+    case NEU_REQ_CHECK_SCHEMA:\n     case NEU_REQ_GET_DRIVER_GROUP:\n     case NEU_REQ_GET_SUB_DRIVER_TAGS: {\n         strcpy(pheader->receiver, \"manager\");\n@@ -721,6 +722,7 @@ static int adapter_loop(enum neu_event_io_type type, int fd, void *usr_data)\n     case NEU_REQRESP_NODES_STATE:\n     case NEU_REQ_PRGFILE_PROCESS:\n     case NEU_RESP_PRGFILE_PROCESS:\n+    case NEU_RESP_CHECK_SCHEMA:\n         adapter->module->intf_funs->request(\n             adapter->plugin, (neu_reqresp_head_t *) header, &header[1]);\n         neu_msg_free(msg);"
            },
            {
                "sha": "3c6df2c2908441e438e46386dde3c9cd798f0707",
                "filename": "src/base/msg_internal.h",
                "status": "modified",
                "additions": 6,
                "deletions": 1,
                "changes": 7,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fbase%2Fmsg_internal.h",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fbase%2Fmsg_internal.h",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/src%2Fbase%2Fmsg_internal.h?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -99,7 +99,9 @@ extern \"C\" {\n     XX(NEU_REQ_PRGFILE_PROCESS, neu_req_prgfile_process_t)           \\\n     XX(NEU_RESP_PRGFILE_PROCESS, neu_resp_prgfile_process_t)         \\\n     XX(NEU_REQ_SCAN_TAGS, neu_req_scan_tags_t)                       \\\n-    XX(NEU_RESP_SCAN_TAGS, neu_resp_scan_tags_t)\n+    XX(NEU_RESP_SCAN_TAGS, neu_resp_scan_tags_t)                     \\\n+    XX(NEU_REQ_CHECK_SCHEMA, neu_req_check_schema_t)                 \\\n+    XX(NEU_RESP_CHECK_SCHEMA, neu_resp_check_schema_t)\n \n static inline size_t neu_reqresp_size(neu_reqresp_type_e t)\n {\n@@ -140,6 +142,9 @@ static inline neu_msg_t *neu_msg_new(neu_reqresp_type_e t, void *ctx,\n     // NOTE: ensure enough space to reuse message\n     size_t body_size = 0;\n     switch (t) {\n+    case NEU_REQ_CHECK_SCHEMA:\n+        body_size = neu_reqresp_size(NEU_RESP_CHECK_SCHEMA);\n+        break;\n     case NEU_REQ_GET_PLUGIN:\n         body_size = neu_reqresp_size(NEU_RESP_GET_PLUGIN);\n         break;"
            },
            {
                "sha": "b2d9d8a9080192f13b13678d52120681a21dc80c",
                "filename": "src/core/manager.c",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fcore%2Fmanager.c",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fcore%2Fmanager.c",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/src%2Fcore%2Fmanager.c?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -709,6 +709,17 @@ static int manager_loop(enum neu_event_io_type type, int fd, void *usr_data)\n         reply(manager, header, &resp);\n         break;\n     }\n+    case NEU_REQ_CHECK_SCHEMA: {\n+        neu_req_check_schema_t *cmd  = (neu_req_check_schema_t *) &header[1];\n+        neu_resp_check_schema_t resp = { 0 };\n+        strcpy(resp.schema, cmd->schema);\n+        resp.exist   = neu_plugin_manager_schema_exist(manager->plugin_manager,\n+                                                     cmd->schema);\n+        header->type = NEU_RESP_CHECK_SCHEMA;\n+        strcpy(header->receiver, header->sender);\n+        reply(manager, header, &resp);\n+        break;\n+    }\n     case NEU_REQ_ADD_NODE: {\n         neu_req_add_node_t *cmd = (neu_req_add_node_t *) &header[1];\n         nlog_notice(\"add node name:%s plugin:%s\", cmd->node, cmd->plugin);"
            },
            {
                "sha": "6a91a02eb366e0df81d508cace830428440684b3",
                "filename": "src/core/plugin_manager.c",
                "status": "modified",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fcore%2Fplugin_manager.c",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fcore%2Fplugin_manager.c",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/src%2Fcore%2Fplugin_manager.c?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -556,3 +556,20 @@ bool neu_plugin_manager_remove_library(neu_plugin_manager_t *mgr,\n \n     return ret;\n }\n+\n+bool neu_plugin_manager_schema_exist(neu_plugin_manager_t *mgr,\n+                                     const char *          schema)\n+{\n+    bool             exist = false;\n+    plugin_entity_t *el = NULL, *tmp = NULL;\n+\n+    HASH_ITER(hh, mgr->plugins, el, tmp)\n+    {\n+        if (strcmp(el->schema, schema) == 0) {\n+            exist = true;\n+            break;\n+        }\n+    }\n+\n+    return exist;\n+}\n\\ No newline at end of file"
            },
            {
                "sha": "8cef2ccf12fd56102ea03b9fecbe9ab89aeda4a4",
                "filename": "src/core/plugin_manager.h",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fcore%2Fplugin_manager.h",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/src%2Fcore%2Fplugin_manager.h",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/src%2Fcore%2Fplugin_manager.h?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -78,4 +78,7 @@ bool neu_plugin_manager_remove_library(neu_plugin_manager_t *mgr,\n int neu_plugin_manager_update(neu_plugin_manager_t *mgr,\n                               const char *          plugin_lib_name);\n \n+bool neu_plugin_manager_schema_exist(neu_plugin_manager_t *mgr,\n+                                     const char *          schema);\n+\n #endif\n\\ No newline at end of file"
            },
            {
                "sha": "ded618e5dfb948d59115804dd5b4ee5f02e75747",
                "filename": "tests/ft/http_api/test_http_api.py",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/fengzeroz/neuron/blob/c9ce39747e0372aaa2157b2b56174914a12c06d8/tests%2Fft%2Fhttp_api%2Ftest_http_api.py",
                "raw_url": "https://github.com/fengzeroz/neuron/raw/c9ce39747e0372aaa2157b2b56174914a12c06d8/tests%2Fft%2Fhttp_api%2Ftest_http_api.py",
                "contents_url": "https://api.github.com/repos/fengzeroz/neuron/contents/tests%2Fft%2Fhttp_api%2Ftest_http_api.py?ref=c9ce39747e0372aaa2157b2b56174914a12c06d8",
                "patch": "@@ -594,7 +594,6 @@ def test_get_plugin_schema(self):\n \n         response = api.get_plugin_schema(plugin='invalid')\n         assert 404 == response.status_code\n-        assert response.json()['status'] == 'error'\n \n     @description(given=\"running neuron\", when=\"get plugin\", then=\"success\")\n     def test_get_plugin(self):"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/undertow-io/undertow/commits/b289b18bc0ba40c134698a430c70ca1835c51d78",
        "url": "https://api.github.com/repos/undertow-io/undertow/commits/b289b18bc0ba40c134698a430c70ca1835c51d78",
        "html_url": "https://github.com/undertow-io/undertow/commit/b289b18bc0ba40c134698a430c70ca1835c51d78",
        "message": "[UNDERTOW-2264] CVE-2023-1973 Force session timeout to 2 minutes when session was created during the authentication phase. Once authentication is complete restore original (configured) session timeout.\n\nSigned-off-by: Flavia Rainone <frainone@redhat.com>",
        "files": [
            {
                "sha": "6bf56a8663a12df5e30129f5b8e117a36cf0b303",
                "filename": "core/src/main/java/io/undertow/security/impl/FormAuthenticationMechanism.java",
                "status": "modified",
                "additions": 25,
                "deletions": 3,
                "changes": 28,
                "blob_url": "https://github.com/undertow-io/undertow/blob/b289b18bc0ba40c134698a430c70ca1835c51d78/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fsecurity%2Fimpl%2FFormAuthenticationMechanism.java",
                "raw_url": "https://github.com/undertow-io/undertow/raw/b289b18bc0ba40c134698a430c70ca1835c51d78/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fsecurity%2Fimpl%2FFormAuthenticationMechanism.java",
                "contents_url": "https://api.github.com/repos/undertow-io/undertow/contents/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fsecurity%2Fimpl%2FFormAuthenticationMechanism.java?ref=b289b18bc0ba40c134698a430c70ca1835c51d78",
                "patch": "@@ -46,16 +46,22 @@\n public class FormAuthenticationMechanism implements AuthenticationMechanism {\n \n     public static final String LOCATION_ATTRIBUTE = FormAuthenticationMechanism.class.getName() + \".LOCATION\";\n-\n     public static final String DEFAULT_POST_LOCATION = \"/j_security_check\";\n-\n+    protected static final String ORIGINAL_SESSION_TIMEOUT = \"io.undertow.servlet.form.auth.orig.session.timeout\";;\n     private final String name;\n     private final String loginPage;\n     private final String errorPage;\n     private final String postLocation;\n     private final FormParserFactory formParserFactory;\n     private final IdentityManager identityManager;\n \n+    /**\n+     * If the authentication process creates a session, this is the maximum session timeout (in seconds) during the\n+     * authentication process. Once authentication is complete, the default session timeout will apply. Sessions that\n+     * exist before the authentication process starts will retain their original session timeout throughout.\n+     */\n+    protected final int authenticationSessionTimeout = 120;\n+\n     public FormAuthenticationMechanism(final String name, final String loginPage, final String errorPage) {\n         this(FormParserFactory.builder().build(), name, loginPage, errorPage);\n     }\n@@ -166,6 +172,10 @@ public AuthenticationMechanismOutcome runFormAuth(final HttpServerExchange excha\n     protected void handleRedirectBack(final HttpServerExchange exchange) {\n         final Session session = Sessions.getSession(exchange);\n         if (session != null) {\n+            final Integer originalSessionTimeout = (Integer) session.removeAttribute(ORIGINAL_SESSION_TIMEOUT);\n+            if (originalSessionTimeout != null) {\n+                session.setMaxInactiveInterval(originalSessionTimeout);\n+            }\n             final String location = (String) session.removeAttribute(LOCATION_ATTRIBUTE);\n             if(location != null) {\n                 exchange.addDefaultResponseListener(new DefaultResponseListener() {\n@@ -208,7 +218,19 @@ public ChallengeResult sendChallenge(final HttpServerExchange exchange, final Se\n     }\n \n     protected void storeInitialLocation(final HttpServerExchange exchange) {\n-        Session session = Sessions.getOrCreateSession(exchange);\n+        Session session = Sessions.getSession(exchange);\n+        boolean newSession = false;\n+        if (session == null) {\n+            session = Sessions.getOrCreateSession(exchange);\n+            newSession = true;\n+        }\n+        if (newSession) {\n+            int originalMaxInactiveInterval = session.getMaxInactiveInterval();\n+            if (originalMaxInactiveInterval > authenticationSessionTimeout) {\n+                session.setAttribute(ORIGINAL_SESSION_TIMEOUT, session.getMaxInactiveInterval());\n+                session.setMaxInactiveInterval(authenticationSessionTimeout);\n+            }\n+        }\n         session.setAttribute(LOCATION_ATTRIBUTE, RedirectBuilder.redirect(exchange, exchange.getRelativePath()));\n     }\n "
            },
            {
                "sha": "50bb70a49abe2bfa3fa50ba42af83897d1407267",
                "filename": "servlet/src/main/java/io/undertow/servlet/handlers/security/ServletFormAuthenticationMechanism.java",
                "status": "modified",
                "additions": 19,
                "deletions": 1,
                "changes": 20,
                "blob_url": "https://github.com/undertow-io/undertow/blob/b289b18bc0ba40c134698a430c70ca1835c51d78/servlet%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fservlet%2Fhandlers%2Fsecurity%2FServletFormAuthenticationMechanism.java",
                "raw_url": "https://github.com/undertow-io/undertow/raw/b289b18bc0ba40c134698a430c70ca1835c51d78/servlet%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fservlet%2Fhandlers%2Fsecurity%2FServletFormAuthenticationMechanism.java",
                "contents_url": "https://api.github.com/repos/undertow-io/undertow/contents/servlet%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fservlet%2Fhandlers%2Fsecurity%2FServletFormAuthenticationMechanism.java?ref=b289b18bc0ba40c134698a430c70ca1835c51d78",
                "patch": "@@ -32,6 +32,7 @@\n import io.undertow.servlet.handlers.ServletRequestContext;\n import io.undertow.servlet.spec.HttpSessionImpl;\n import io.undertow.servlet.util.SavedRequest;\n+import io.undertow.servlet.spec.ServletContextImpl;\n import io.undertow.util.Headers;\n import io.undertow.util.RedirectBuilder;\n \n@@ -195,13 +196,26 @@ protected void storeInitialLocation(final HttpServerExchange exchange, byte[] by\n             return;\n         }\n         final ServletRequestContext servletRequestContext = exchange.getAttachment(ServletRequestContext.ATTACHMENT_KEY);\n-        HttpSessionImpl httpSession = servletRequestContext.getCurrentServletContext().getSession(exchange, true);\n+        final ServletContextImpl servletContextImpl =  servletRequestContext.getCurrentServletContext();\n+        HttpSessionImpl httpSession = servletContextImpl.getSession(exchange, false);\n+        boolean newSession = false;\n+        if (httpSession == null) {\n+            httpSession = servletContextImpl.getSession(exchange, true);\n+            newSession = true;\n+        }\n         Session session;\n         if (System.getSecurityManager() == null) {\n             session = httpSession.getSession();\n         } else {\n             session = AccessController.doPrivileged(new HttpSessionImpl.UnwrapSessionAction(httpSession));\n         }\n+        if (newSession) {\n+            int originalMaxInactiveInterval = session.getMaxInactiveInterval();\n+            if (originalMaxInactiveInterval > authenticationSessionTimeout) {\n+                session.setAttribute(ORIGINAL_SESSION_TIMEOUT, session.getMaxInactiveInterval());\n+                session.setMaxInactiveInterval(authenticationSessionTimeout);\n+            }\n+        }\n         SessionManager manager = session.getSessionManager();\n         if (seenSessionManagers.add(manager)) {\n             manager.registerSessionListener(LISTENER);\n@@ -226,6 +240,10 @@ protected void handleRedirectBack(final HttpServerExchange exchange) {\n             } else {\n                 session = AccessController.doPrivileged(new HttpSessionImpl.UnwrapSessionAction(httpSession));\n             }\n+            Integer originalSessionTimeout = (Integer) session.removeAttribute(ORIGINAL_SESSION_TIMEOUT);\n+            if (originalSessionTimeout != null) {\n+                session.setMaxInactiveInterval(originalSessionTimeout);\n+            }\n             String path = (String) session.getAttribute(SESSION_KEY);\n             if ((path == null || overrideInitial) && defaultPage != null) {\n                 path = defaultPage;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/undertow-io/undertow/commits/0410f3c4d9b39b754a2203a29834cac51da11258",
        "url": "https://api.github.com/repos/undertow-io/undertow/commits/0410f3c4d9b39b754a2203a29834cac51da11258",
        "html_url": "https://github.com/undertow-io/undertow/commit/0410f3c4d9b39b754a2203a29834cac51da11258",
        "message": "[UNDERTOW-2264] CVE-2023-1973 Force session timeout to 2 minutes when session was created during the authentication phase. Once authentication is complete restore original (configured) session timeout.\n\nSigned-off-by: Flavia Rainone <frainone@redhat.com>",
        "files": [
            {
                "sha": "6bf56a8663a12df5e30129f5b8e117a36cf0b303",
                "filename": "core/src/main/java/io/undertow/security/impl/FormAuthenticationMechanism.java",
                "status": "modified",
                "additions": 25,
                "deletions": 3,
                "changes": 28,
                "blob_url": "https://github.com/undertow-io/undertow/blob/0410f3c4d9b39b754a2203a29834cac51da11258/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fsecurity%2Fimpl%2FFormAuthenticationMechanism.java",
                "raw_url": "https://github.com/undertow-io/undertow/raw/0410f3c4d9b39b754a2203a29834cac51da11258/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fsecurity%2Fimpl%2FFormAuthenticationMechanism.java",
                "contents_url": "https://api.github.com/repos/undertow-io/undertow/contents/core%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fsecurity%2Fimpl%2FFormAuthenticationMechanism.java?ref=0410f3c4d9b39b754a2203a29834cac51da11258",
                "patch": "@@ -46,16 +46,22 @@\n public class FormAuthenticationMechanism implements AuthenticationMechanism {\n \n     public static final String LOCATION_ATTRIBUTE = FormAuthenticationMechanism.class.getName() + \".LOCATION\";\n-\n     public static final String DEFAULT_POST_LOCATION = \"/j_security_check\";\n-\n+    protected static final String ORIGINAL_SESSION_TIMEOUT = \"io.undertow.servlet.form.auth.orig.session.timeout\";;\n     private final String name;\n     private final String loginPage;\n     private final String errorPage;\n     private final String postLocation;\n     private final FormParserFactory formParserFactory;\n     private final IdentityManager identityManager;\n \n+    /**\n+     * If the authentication process creates a session, this is the maximum session timeout (in seconds) during the\n+     * authentication process. Once authentication is complete, the default session timeout will apply. Sessions that\n+     * exist before the authentication process starts will retain their original session timeout throughout.\n+     */\n+    protected final int authenticationSessionTimeout = 120;\n+\n     public FormAuthenticationMechanism(final String name, final String loginPage, final String errorPage) {\n         this(FormParserFactory.builder().build(), name, loginPage, errorPage);\n     }\n@@ -166,6 +172,10 @@ public AuthenticationMechanismOutcome runFormAuth(final HttpServerExchange excha\n     protected void handleRedirectBack(final HttpServerExchange exchange) {\n         final Session session = Sessions.getSession(exchange);\n         if (session != null) {\n+            final Integer originalSessionTimeout = (Integer) session.removeAttribute(ORIGINAL_SESSION_TIMEOUT);\n+            if (originalSessionTimeout != null) {\n+                session.setMaxInactiveInterval(originalSessionTimeout);\n+            }\n             final String location = (String) session.removeAttribute(LOCATION_ATTRIBUTE);\n             if(location != null) {\n                 exchange.addDefaultResponseListener(new DefaultResponseListener() {\n@@ -208,7 +218,19 @@ public ChallengeResult sendChallenge(final HttpServerExchange exchange, final Se\n     }\n \n     protected void storeInitialLocation(final HttpServerExchange exchange) {\n-        Session session = Sessions.getOrCreateSession(exchange);\n+        Session session = Sessions.getSession(exchange);\n+        boolean newSession = false;\n+        if (session == null) {\n+            session = Sessions.getOrCreateSession(exchange);\n+            newSession = true;\n+        }\n+        if (newSession) {\n+            int originalMaxInactiveInterval = session.getMaxInactiveInterval();\n+            if (originalMaxInactiveInterval > authenticationSessionTimeout) {\n+                session.setAttribute(ORIGINAL_SESSION_TIMEOUT, session.getMaxInactiveInterval());\n+                session.setMaxInactiveInterval(authenticationSessionTimeout);\n+            }\n+        }\n         session.setAttribute(LOCATION_ATTRIBUTE, RedirectBuilder.redirect(exchange, exchange.getRelativePath()));\n     }\n "
            },
            {
                "sha": "1ad22fa239f103403f80e8b170e00c92bb549b92",
                "filename": "servlet/src/main/java/io/undertow/servlet/handlers/security/ServletFormAuthenticationMechanism.java",
                "status": "modified",
                "additions": 19,
                "deletions": 1,
                "changes": 20,
                "blob_url": "https://github.com/undertow-io/undertow/blob/0410f3c4d9b39b754a2203a29834cac51da11258/servlet%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fservlet%2Fhandlers%2Fsecurity%2FServletFormAuthenticationMechanism.java",
                "raw_url": "https://github.com/undertow-io/undertow/raw/0410f3c4d9b39b754a2203a29834cac51da11258/servlet%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fservlet%2Fhandlers%2Fsecurity%2FServletFormAuthenticationMechanism.java",
                "contents_url": "https://api.github.com/repos/undertow-io/undertow/contents/servlet%2Fsrc%2Fmain%2Fjava%2Fio%2Fundertow%2Fservlet%2Fhandlers%2Fsecurity%2FServletFormAuthenticationMechanism.java?ref=0410f3c4d9b39b754a2203a29834cac51da11258",
                "patch": "@@ -32,6 +32,7 @@\n import io.undertow.servlet.handlers.ServletRequestContext;\n import io.undertow.servlet.spec.HttpSessionImpl;\n import io.undertow.servlet.util.SavedRequest;\n+import io.undertow.servlet.spec.ServletContextImpl;\n import io.undertow.util.Headers;\n import io.undertow.util.RedirectBuilder;\n \n@@ -195,13 +196,26 @@ protected void storeInitialLocation(final HttpServerExchange exchange, byte[] by\n             return;\n         }\n         final ServletRequestContext servletRequestContext = exchange.getAttachment(ServletRequestContext.ATTACHMENT_KEY);\n-        HttpSessionImpl httpSession = servletRequestContext.getCurrentServletContext().getSession(exchange, true);\n+        final ServletContextImpl servletContextImpl =  servletRequestContext.getCurrentServletContext();\n+        HttpSessionImpl httpSession = servletContextImpl.getSession(exchange, false);\n+        boolean newSession = false;\n+        if (httpSession == null) {\n+            httpSession = servletContextImpl.getSession(exchange, true);\n+            newSession = true;\n+        }\n         Session session;\n         if (System.getSecurityManager() == null) {\n             session = httpSession.getSession();\n         } else {\n             session = AccessController.doPrivileged(new HttpSessionImpl.UnwrapSessionAction(httpSession));\n         }\n+        if (newSession) {\n+            int originalMaxInactiveInterval = session.getMaxInactiveInterval();\n+            if (originalMaxInactiveInterval > authenticationSessionTimeout) {\n+                session.setAttribute(ORIGINAL_SESSION_TIMEOUT, session.getMaxInactiveInterval());\n+                session.setMaxInactiveInterval(authenticationSessionTimeout);\n+            }\n+        }\n         SessionManager manager = session.getSessionManager();\n         if (seenSessionManagers.add(manager)) {\n             manager.registerSessionListener(LISTENER);\n@@ -226,6 +240,10 @@ protected void handleRedirectBack(final HttpServerExchange exchange) {\n             } else {\n                 session = AccessController.doPrivileged(new HttpSessionImpl.UnwrapSessionAction(httpSession));\n             }\n+            Integer originalSessionTimeout = (Integer) session.removeAttribute(ORIGINAL_SESSION_TIMEOUT);\n+            if (originalSessionTimeout != null) {\n+                session.setMaxInactiveInterval(originalSessionTimeout);\n+            }\n             String path = (String) session.getAttribute(SESSION_KEY);\n             if ((path == null || overrideInitial) && defaultPage != null) {\n                 path = defaultPage;"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/hibernate/hibernate-validator/commits/55a24f3368bda1e590b7a2ffe31575e46398f988",
        "url": "https://api.github.com/repos/hibernate/hibernate-validator/commits/55a24f3368bda1e590b7a2ffe31575e46398f988",
        "html_url": "https://github.com/hibernate/hibernate-validator/commit/55a24f3368bda1e590b7a2ffe31575e46398f988",
        "message": "HV-1790 Remove the SafeHtml constraint and the jsoup dependency\n\nThere is no replacement for this constraint.\nIt has been deprecated and planned for removal in both 6.0 and 6.1.",
        "files": [
            {
                "sha": "0220534d7e7780732d5b26024ab82f705cacd2cf",
                "filename": "annotation-processor/src/main/java/org/hibernate/validator/ap/internal/util/ConstraintHelper.java",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/annotation-processor%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2Finternal%2Futil%2FConstraintHelper.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/annotation-processor%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2Finternal%2Futil%2FConstraintHelper.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/annotation-processor%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2Finternal%2Futil%2FConstraintHelper.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -305,7 +305,6 @@ public ConstraintHelper(Types typeUtils, AnnotationApiHelper annotationApiHelper\n \t\tregisterAllowedTypesForBuiltInConstraint( HibernateValidatorTypes.NOT_BLANK, CharSequence.class );\n \t\tregisterAllowedTypesForBuiltInConstraint( HibernateValidatorTypes.NOT_EMPTY, TYPES_SUPPORTED_BY_SIZE_AND_NOT_EMPTY_ANNOTATIONS );\n \t\tregisterAllowedTypesForBuiltInConstraint( HibernateValidatorTypes.NORMALIZED, CharSequence.class );\n-\t\tregisterAllowedTypesForBuiltInConstraint( HibernateValidatorTypes.SAFE_HTML, CharSequence.class );\n \t\tregisterAllowedTypesForBuiltInConstraint( HibernateValidatorTypes.SCRIPT_ASSERT, Object.class );\n \t\tregisterAllowedTypesForBuiltInConstraint( HibernateValidatorTypes.UNIQUE_ELEMENTS, Collection.class );\n \t\tregisterAllowedTypesForBuiltInConstraint( HibernateValidatorTypes.URL, CharSequence.class );"
            },
            {
                "sha": "b346c4a9006570147824fb513fd9c61b685073f9",
                "filename": "annotation-processor/src/main/java/org/hibernate/validator/ap/internal/util/TypeNames.java",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/annotation-processor%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2Finternal%2Futil%2FTypeNames.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/annotation-processor%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2Finternal%2Futil%2FTypeNames.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/annotation-processor%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2Finternal%2Futil%2FTypeNames.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -81,7 +81,6 @@ public static class HibernateValidatorTypes {\n \t\tpublic static final String NORMALIZED = ORG_HIBERNATE_VALIDATOR_CONSTRAINTS + \".Normalized\";\n \t\tpublic static final String NOT_BLANK = ORG_HIBERNATE_VALIDATOR_CONSTRAINTS + \".NotBlank\";\n \t\tpublic static final String NOT_EMPTY = ORG_HIBERNATE_VALIDATOR_CONSTRAINTS + \".NotEmpty\";\n-\t\tpublic static final String SAFE_HTML = ORG_HIBERNATE_VALIDATOR_CONSTRAINTS + \".SafeHtml\";\n \t\tpublic static final String SCRIPT_ASSERT = ORG_HIBERNATE_VALIDATOR_CONSTRAINTS + \".ScriptAssert\";\n \t\tpublic static final String UNIQUE_ELEMENTS = ORG_HIBERNATE_VALIDATOR_CONSTRAINTS + \".UniqueElements\";\n \t\tpublic static final String URL = ORG_HIBERNATE_VALIDATOR_CONSTRAINTS + \".URL\";"
            },
            {
                "sha": "8fdad4b55f9160094e173427d516b15be822261b",
                "filename": "annotation-processor/src/test/java/org/hibernate/validator/ap/ConstraintValidationProcessorTest.java",
                "status": "modified",
                "additions": 3,
                "deletions": 4,
                "changes": 7,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/annotation-processor%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2FConstraintValidationProcessorTest.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/annotation-processor%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2FConstraintValidationProcessorTest.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/annotation-processor%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2FConstraintValidationProcessorTest.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -155,6 +155,8 @@ public void hibernateValidatorProvidedCustomConstraints() {\n \t\tassertFalse( compilationResult );\n \t\tassertThatDiagnosticsMatch(\n \t\t\t\tdiagnostics,\n+\t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 66 ),\n+\t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 67 ),\n \t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 68 ),\n \t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 69 ),\n \t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 70 ),\n@@ -171,10 +173,7 @@ public void hibernateValidatorProvidedCustomConstraints() {\n \t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 81 ),\n \t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 82 ),\n \t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 83 ),\n-\t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 84 ),\n-\t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 85 ),\n-\t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 86 ),\n-\t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 87 )\n+\t\t\t\tnew DiagnosticExpectation( Kind.ERROR, 84 )\n \t\t);\n \t}\n "
            },
            {
                "sha": "75d3706624b790c7f11b167c7769af2e7b351de6",
                "filename": "annotation-processor/src/test/java/org/hibernate/validator/ap/testmodel/customconstraints/HibernateValidatorProvidedCustomConstraints.java",
                "status": "modified",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/annotation-processor%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2Ftestmodel%2Fcustomconstraints%2FHibernateValidatorProvidedCustomConstraints.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/annotation-processor%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2Ftestmodel%2Fcustomconstraints%2FHibernateValidatorProvidedCustomConstraints.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/annotation-processor%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fap%2Ftestmodel%2Fcustomconstraints%2FHibernateValidatorProvidedCustomConstraints.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -19,7 +19,6 @@\n import org.hibernate.validator.constraints.NotBlank;\n import org.hibernate.validator.constraints.NotEmpty;\n import org.hibernate.validator.constraints.Range;\n-import org.hibernate.validator.constraints.SafeHtml;\n import org.hibernate.validator.constraints.ScriptAssert;\n import org.hibernate.validator.constraints.URL;\n import org.hibernate.validator.constraints.br.CNPJ;\n@@ -48,7 +47,6 @@ public class HibernateValidatorProvidedCustomConstraints {\n \t@NotBlank\n \t@NotEmpty\n \t@Range\n-\t@SafeHtml\n \t@URL\n \t@CNPJ\n \t@CPF\n@@ -75,7 +73,6 @@ public class HibernateValidatorProvidedCustomConstraints {\n \t@NotBlank\n \t@NotEmpty\n \t@Range\n-\t@SafeHtml\n \t@URL\n \t@CNPJ\n \t@CPF"
            },
            {
                "sha": "9688e62064f6764ffbe7aab28cec1c410ad15f7a",
                "filename": "distribution/pom.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/distribution%2Fpom.xml",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/distribution%2Fpom.xml",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/distribution%2Fpom.xml?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -65,10 +65,6 @@\n             <groupId>javax.money</groupId>\n             <artifactId>money-api</artifactId>\n         </dependency>\n-        <dependency>\n-            <groupId>org.jsoup</groupId>\n-            <artifactId>jsoup</artifactId>\n-        </dependency>\n         <dependency>\n             <groupId>com.thoughtworks.paranamer</groupId>\n             <artifactId>paranamer</artifactId>"
            },
            {
                "sha": "0f1fb92a9e128b82343f6e809fa5558755832074",
                "filename": "distribution/src/main/assembly/dist.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/distribution%2Fsrc%2Fmain%2Fassembly%2Fdist.xml",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/distribution%2Fsrc%2Fmain%2Fassembly%2Fdist.xml",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/distribution%2Fsrc%2Fmain%2Fassembly%2Fdist.xml?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -45,7 +45,6 @@\n                 <include>org.apache.logging.log4j:log4j-core</include>\n                 <include>joda-time:joda-time</include>\n                 <include>jakarta.persistence:jakarta.persistence-api</include>\n-                <include>org.jsoup:jsoup</include>\n                 <include>com.thoughtworks.paranamer:paranamer</include>\n             </includes>\n         </dependencySet>"
            },
            {
                "sha": "b0a5a16a3f4642e1b0672ed37338dc10dfef4448",
                "filename": "documentation/src/main/asciidoc/ch02.asciidoc",
                "status": "modified",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/documentation%2Fsrc%2Fmain%2Fasciidoc%2Fch02.asciidoc",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/documentation%2Fsrc%2Fmain%2Fasciidoc%2Fch02.asciidoc",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/documentation%2Fsrc%2Fmain%2Fasciidoc%2Fch02.asciidoc?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -715,11 +715,6 @@ With one exception also these constraints apply to the field/property level, onl\n \tSupported data types::: `BigDecimal`, `BigInteger`, `CharSequence`, `byte`, `short`, `int`, `long` and the respective wrappers of the primitive types\n \tHibernate metadata impact::: None\n \n-`@SafeHtml(whitelistType= , additionalTags=, additionalTagsWithAttributes=, baseURI=)`:: Checks whether the annotated value contains potentially malicious fragments such as `<script/>`. In order to use this constraint, the http://jsoup.org/[jsoup] library must be part of the class path. With the `whitelistType` attribute a predefined whitelist type can be chosen which can be refined via `additionalTags` or `additionalTagsWithAttributes`. The former allows to add tags without any attributes, whereas the latter allows to specify tags and optionally allowed attributes as well as accepted protocols for the attributes using the annotation `@SafeHtml.Tag`.\n-In addition, `baseURI` allows to specify the base URI used to resolve relative URIs.\n-\tSupported data types::: `CharSequence`\n-\tHibernate metadata impact::: None\n-\n `@ScriptAssert(lang=, script=, alias=, reportOn=)`:: Checks whether the given script can successfully be evaluated against the annotated element. In order to use this constraint, an implementation of the Java Scripting API as defined by JSR 223 (\"Scripting for the Java^TM^ Platform\") must be a part of the class path. The expressions to be evaluated can be written in any scripting or expression language, for which a JSR 223 compatible engine can be found in the class path. Even though this is a class-level constraint, one can use the `reportOn` attribute to report a constraint violation on a specific property rather than the whole object.\n \tSupported data types::: Any type\n \tHibernate metadata impact::: None"
            },
            {
                "sha": "98299bf4fef1b9555a053b2316c7b28da9b965bf",
                "filename": "engine/pom.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fpom.xml",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fpom.xml",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fpom.xml?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -89,11 +89,6 @@\n             <artifactId>joda-time</artifactId>\n             <optional>true</optional>\n         </dependency>\n-        <dependency>\n-            <groupId>org.jsoup</groupId>\n-            <artifactId>jsoup</artifactId>\n-            <optional>true</optional>\n-        </dependency>\n         <dependency>\n             <groupId>com.thoughtworks.paranamer</groupId>\n             <artifactId>paranamer</artifactId>\n@@ -251,7 +246,6 @@\n                             org.jboss.logging.*;version=\"[3.1.0,4.0.0)\",\n                             com.fasterxml.classmate.*;version=\"[1.3,2.0.0)\",\n                             org.joda.time.*;version=\"[2.0.0,3.0.0)\";resolution:=optional,\n-                            org.jsoup.*;version=\"[1.5.2,2.0.0)\";resolution:=optional,\n                             javax.money;version=\"[1.0.0,2.0.0)\";resolution:=optional,\n                             com.thoughtworks.paranamer.*;version=\"[2.5.5,3.0.0)\";resolution:=optional\n                         </Import-Package>"
            },
            {
                "sha": "1f04b6dbbb93b39ed2d4d08bd66e0159ca7eeef9",
                "filename": "engine/src/main/java/org/hibernate/validator/cfg/defs/SafeHtmlDef.java",
                "status": "removed",
                "additions": 0,
                "deletions": 140,
                "changes": 140,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fcfg%2Fdefs%2FSafeHtmlDef.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fcfg%2Fdefs%2FSafeHtmlDef.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fcfg%2Fdefs%2FSafeHtmlDef.java?ref=93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28",
                "patch": "@@ -1,140 +0,0 @@\n-/*\n- * Hibernate Validator, declare and validate application constraints\n- *\n- * License: Apache License, Version 2.0\n- * See the license.txt file in the root directory or <http://www.apache.org/licenses/LICENSE-2.0>.\n- */\n-package org.hibernate.validator.cfg.defs;\n-\n-import org.hibernate.validator.cfg.AnnotationDef;\n-import org.hibernate.validator.cfg.ConstraintDef;\n-import org.hibernate.validator.constraints.SafeHtml;\n-\n-/**\n- * @author Marko Bekta\n- * @deprecated {@code @SafeHtml} support will be removed in a future version\n- */\n-@Deprecated\n-public class SafeHtmlDef extends ConstraintDef<SafeHtmlDef, SafeHtml> {\n-\n-\tpublic SafeHtmlDef() {\n-\t\tsuper( SafeHtml.class );\n-\t}\n-\n-\tprivate SafeHtmlDef(ConstraintDef<?, SafeHtml> original) {\n-\t\tsuper( original );\n-\t}\n-\n-\tpublic SafeHtmlDef whitelistType(SafeHtml.WhiteListType whitelistType) {\n-\t\taddParameter( \"whitelistType\", whitelistType );\n-\t\treturn this;\n-\t}\n-\n-\tpublic SafeHtmlDef additionalTags(String... additionalTags) {\n-\t\taddParameter( \"additionalTags\", additionalTags );\n-\t\treturn this;\n-\t}\n-\n-\t/**\n-\t * @deprecated Use {@link SafeHtmlDef#additionalTags(TagDef, TagDef...)} instead.\n-\t */\n-\t@Deprecated\n-\tpublic SafeHtmlDef additionalTagsWithAttributes(SafeHtml.Tag... additionalTagsWithAttributes) {\n-\t\taddParameter( \"additionalTagsWithAttributes\", additionalTagsWithAttributes );\n-\t\treturn this;\n-\t}\n-\n-\t/**\n-\t * Whitelists additional tags.\n-\t *\n-\t * @since 6.0\n-\t */\n-\tpublic SafeHtmlDef additionalTags(TagDef tag, TagDef... furtherTags) {\n-\t\taddAnnotationAsParameter( \"additionalTagsWithAttributes\", tag );\n-\n-\t\tif ( furtherTags != null && furtherTags.length > 0 ) {\n-\t\t\tfor ( TagDef tagDef : furtherTags ) {\n-\t\t\t\taddAnnotationAsParameter( \"additionalTagsWithAttributes\", tagDef );\n-\t\t\t}\n-\t\t}\n-\t\treturn this;\n-\t}\n-\n-\t/**\n-\t * @since 6.0\n-\t */\n-\tpublic SafeHtmlDef baseURI(String baseURI) {\n-\t\taddParameter( \"baseURI\", baseURI );\n-\t\treturn this;\n-\t}\n-\n-\t/**\n-\t * Represents a {@link SafeHtml.Tag}.\n-\t *\n-\t * @since 6.0\n-\t */\n-\tpublic static class TagDef extends AnnotationDef<TagDef, SafeHtml.Tag> {\n-\n-\t\tpublic TagDef(String name) {\n-\t\t\tsuper( SafeHtml.Tag.class );\n-\t\t\taddParameter( \"name\", name );\n-\t\t}\n-\n-\t\tpublic TagDef attributes(String attribute, String... furtherAttributes) {\n-\t\t\tString[] attributes;\n-\n-\t\t\tif ( furtherAttributes != null && furtherAttributes.length > 0 ) {\n-\t\t\t\tattributes = new String[furtherAttributes.length + 1];\n-\t\t\t\tSystem.arraycopy( furtherAttributes, 0, attributes, 1, furtherAttributes.length );\n-\t\t\t\tattributes[0] = attribute;\n-\t\t\t}\n-\t\t\telse {\n-\t\t\t\tattributes = new String[] { attribute };\n-\t\t\t}\n-\n-\t\t\taddParameter( \"attributes\", attributes );\n-\t\t\treturn this;\n-\t\t}\n-\n-\t\tpublic TagDef attributes(AttributeDef attribute, AttributeDef... furtherAttributes) {\n-\t\t\taddAnnotationAsParameter( \"attributesWithProtocols\", attribute );\n-\n-\t\t\tif ( furtherAttributes != null && furtherAttributes.length > 0 ) {\n-\t\t\t\tfor ( AttributeDef attributeDef : furtherAttributes ) {\n-\t\t\t\t\taddAnnotationAsParameter( \"attributesWithProtocols\", attributeDef );\n-\t\t\t\t}\n-\t\t\t}\n-\n-\t\t\treturn this;\n-\t\t}\n-\t}\n-\n-\t/**\n-\t * Represents a {@link SafeHtml.Attribute}.\n-\t *\n-\t * @since 6.0\n-\t */\n-\tpublic static class AttributeDef extends AnnotationDef<AttributeDef, SafeHtml.Attribute> {\n-\n-\t\tpublic AttributeDef(String name, String protocol, String... furtherProtocols) {\n-\t\t\tsuper( SafeHtml.Attribute.class );\n-\t\t\taddParameter( \"name\", name );\n-\t\t\taddProtocols( protocol, furtherProtocols );\n-\t\t}\n-\n-\t\tprivate void addProtocols(String protocol, String... furtherProtocols) {\n-\t\t\tString[] protocols;\n-\n-\t\t\tif ( furtherProtocols != null ) {\n-\t\t\t\tprotocols = new String[furtherProtocols.length + 1];\n-\t\t\t\tSystem.arraycopy( furtherProtocols, 0, protocols, 1, furtherProtocols.length );\n-\t\t\t\tprotocols[0] = protocol;\n-\t\t\t}\n-\t\t\telse {\n-\t\t\t\tprotocols = new String[] { protocol };\n-\t\t\t}\n-\n-\t\t\taddParameter( \"protocols\", protocols );\n-\t\t}\n-\t}\n-}"
            },
            {
                "sha": "86d7848cec0e866486a61308eee20999a56cd8bd",
                "filename": "engine/src/main/java/org/hibernate/validator/constraints/SafeHtml.java",
                "status": "removed",
                "additions": 0,
                "deletions": 179,
                "changes": 179,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fconstraints%2FSafeHtml.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fconstraints%2FSafeHtml.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fconstraints%2FSafeHtml.java?ref=93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28",
                "patch": "@@ -1,179 +0,0 @@\n-/*\n- * Hibernate Validator, declare and validate application constraints\n- *\n- * License: Apache License, Version 2.0\n- * See the license.txt file in the root directory or <http://www.apache.org/licenses/LICENSE-2.0>.\n- */\n-package org.hibernate.validator.constraints;\n-\n-import static java.lang.annotation.ElementType.ANNOTATION_TYPE;\n-import static java.lang.annotation.ElementType.CONSTRUCTOR;\n-import static java.lang.annotation.ElementType.FIELD;\n-import static java.lang.annotation.ElementType.METHOD;\n-import static java.lang.annotation.ElementType.PARAMETER;\n-import static java.lang.annotation.ElementType.TYPE_USE;\n-import static java.lang.annotation.RetentionPolicy.RUNTIME;\n-import static org.hibernate.validator.constraints.SafeHtml.WhiteListType.RELAXED;\n-\n-import java.lang.annotation.Documented;\n-import java.lang.annotation.Repeatable;\n-import java.lang.annotation.Retention;\n-import java.lang.annotation.Target;\n-\n-import javax.validation.Constraint;\n-import javax.validation.Payload;\n-\n-import org.hibernate.validator.constraints.SafeHtml.List;\n-\n-/**\n- * Validate a rich text value provided by the user to ensure that it contains no malicious code, such as embedded\n- * &lt;script&gt; elements.\n- * <p>\n- * Note that this constraint assumes you want to validate input which represents a body fragment of an HTML document. If\n- * you instead want to validate input which represents a complete HTML document, add the {@code html}, {@code head} and\n- * {@code body} tags to the used whitelist as required.\n- *\n- * @author George Gastaldi\n- * @deprecated {@code @SafeHtml} support will be removed in a future version\n- */\n-@Documented\n-@Constraint(validatedBy = { })\n-@Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })\n-@Retention(RUNTIME)\n-@Repeatable(List.class)\n-@Deprecated\n-public @interface SafeHtml {\n-\n-\tString message() default \"{org.hibernate.validator.constraints.SafeHtml.message}\";\n-\n-\tClass<?>[] groups() default { };\n-\n-\tClass<? extends Payload>[] payload() default { };\n-\n-\t/**\n-\t * @return The built-in whitelist type which will be applied to the rich text value\n-\t */\n-\tWhiteListType whitelistType() default RELAXED;\n-\n-\t/**\n-\t * @return Additional whitelist tags which are allowed on top of the tags specified by the\n-\t * {@link #whitelistType()}.\n-\t */\n-\tString[] additionalTags() default { };\n-\n-\t/**\n-\t * @return Allows to specify additional whitelist tags with optional attributes and protocols.\n-\t */\n-\tTag[] additionalTagsWithAttributes() default { };\n-\n-\t/**\n-\t * @return Base URI used to resolve relative URIs to absolute ones. If not set, validation\n-\t * of HTML containing relative URIs will fail.\n-\t *\n-\t * @since 6.0\n-\t */\n-\tString baseURI() default \"\";\n-\n-\t/**\n-\t * Allows to specify whitelist tags with specified optional attributes. Adding a tag with a given attribute also\n-\t * whitelists the tag itself without any attribute.\n-\t */\n-\t@Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER })\n-\t@Retention(RUNTIME)\n-\t@Documented\n-\tpublic @interface Tag {\n-\n-\t\t/**\n-\t\t * @return the tag name to whitelist.\n-\t\t */\n-\t\tString name();\n-\n-\t\t/**\n-\t\t * @return list of tag attributes which are whitelisted.\n-\t\t */\n-\t\tString[] attributes() default { };\n-\n-\t\t/**\n-\t\t * @return list of tag attributes with corresponding allowed protocols which are whitelisted.\n-\t\t * @since 6.0\n-\t\t */\n-\t\tAttribute[] attributesWithProtocols() default { };\n-\t}\n-\n-\t/**\n-\t * Allows to specify whitelisted attributes with whitelisted protocols.\n-\t *\n-\t * @since 6.0\n-\t */\n-\t@Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER })\n-\t@Retention(RUNTIME)\n-\t@Documented @interface Attribute {\n-\n-\t\t/**\n-\t\t * @return the attribute name to whitelist.\n-\t\t */\n-\t\tString name();\n-\n-\t\t/**\n-\t\t * @return list of attribute protocols which are whitelisted.\n-\t\t */\n-\t\tString[] protocols();\n-\t}\n-\n-\t/**\n-\t * Defines several {@code @SafeHtml} annotations on the same element.\n-\t */\n-\t@Target({ METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE })\n-\t@Retention(RUNTIME)\n-\t@Documented\n-\tpublic @interface List {\n-\t\tSafeHtml[] value();\n-\t}\n-\n-\t/**\n-\t * Defines default whitelist implementations.\n-\t */\n-\tenum WhiteListType {\n-\t\t/**\n-\t\t * This whitelist allows only text nodes: all HTML will be stripped.\n-\t\t */\n-\t\tNONE,\n-\n-\t\t/**\n-\t\t * This whitelist allows only simple text formatting: {@code b, em, i, strong, u}. All other HTML (tags and\n-\t\t * attributes) will be removed.\n-\t\t */\n-\t\tSIMPLE_TEXT,\n-\n-\t\t/**\n-\t\t * This whitelist allows a fuller range of text nodes:\n-\t\t * {@code a, b, blockquote, br, cite, code, dd, dl, dt, em, i, li, ol, p, pre, q, small, span, strike, strong, sub,\n-\t\t * sup, u, ul}, and appropriate attributes.\n-\t\t * <p>\n-\t\t * Links ({@code a} elements) can point to {@code http, https, ftp, mailto}, and have an enforced\n-\t\t * {@code rel=nofollow} attribute.\n-\t\t * </p>\n-\t\t * Does not allow images.\n-\t\t */\n-\t\tBASIC,\n-\n-\t\t/**\n-\t\t * This whitelist allows the same text tags as {@link WhiteListType#BASIC}, and also allows {@code img}\n-\t\t * tags,\n-\t\t * with\n-\t\t * appropriate attributes, with {@code src} pointing to {@code http} or {@code https}.\n-\t\t */\n-\t\tBASIC_WITH_IMAGES,\n-\n-\t\t/**\n-\t\t * This whitelist allows a full range of text and structural body HTML:\n-\t\t * {@code a, b, blockquote, br, caption, cite, code, col, colgroup, dd, div, dl, dt, em, h1, h2, h3, h4, h5, h6,\n-\t\t * i, img, li, ol, p, pre, q, small, span, strike, strong, sub, sup, table, tbody, td, tfoot, th, thead, tr, u,\n-\t\t * ul}\n-\t\t * <p>\n-\t\t * Links do not have an enforced {@code rel=nofollow} attribute, but you can add that if desired.\n-\t\t * </p>\n-\t\t */\n-\t\tRELAXED\n-\t}\n-}"
            },
            {
                "sha": "3949aedc511ff9e1fc03d3f86e61d8675e7bf1f3",
                "filename": "engine/src/main/java/org/hibernate/validator/internal/constraintvalidators/hv/SafeHtmlValidator.java",
                "status": "removed",
                "additions": 0,
                "deletions": 103,
                "changes": 103,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Finternal%2Fconstraintvalidators%2Fhv%2FSafeHtmlValidator.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Finternal%2Fconstraintvalidators%2Fhv%2FSafeHtmlValidator.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Finternal%2Fconstraintvalidators%2Fhv%2FSafeHtmlValidator.java?ref=93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28",
                "patch": "@@ -1,103 +0,0 @@\n-/*\n- * Hibernate Validator, declare and validate application constraints\n- *\n- * License: Apache License, Version 2.0\n- * See the license.txt file in the root directory or <http://www.apache.org/licenses/LICENSE-2.0>.\n- */\n-package org.hibernate.validator.internal.constraintvalidators.hv;\n-\n-import java.util.List;\n-\n-import javax.validation.ConstraintValidator;\n-import javax.validation.ConstraintValidatorContext;\n-\n-import org.hibernate.validator.constraints.SafeHtml;\n-import org.jsoup.Jsoup;\n-import org.jsoup.nodes.Document;\n-import org.jsoup.nodes.Node;\n-import org.jsoup.parser.Parser;\n-import org.jsoup.safety.Cleaner;\n-import org.jsoup.safety.Whitelist;\n-\n-/**\n- * Validate that the string does not contain malicious code.\n- *\n- * It uses <a href=\"http://www.jsoup.org\">JSoup</a> as the underlying parser/sanitizer library.\n- *\n- * @author George Gastaldi\n- * @author Hardy Ferentschik\n- * @author Marko Bekhta\n- * @deprecated {@code @SafeHtml} support will be removed in a future version\n- */\n-@Deprecated\n-public class SafeHtmlValidator implements ConstraintValidator<SafeHtml, CharSequence> {\n-\tprivate Whitelist whitelist;\n-\n-\tprivate String baseURI;\n-\n-\t@Override\n-\tpublic void initialize(SafeHtml safeHtmlAnnotation) {\n-\t\tswitch ( safeHtmlAnnotation.whitelistType() ) {\n-\t\t\tcase BASIC:\n-\t\t\t\twhitelist = Whitelist.basic();\n-\t\t\t\tbreak;\n-\t\t\tcase BASIC_WITH_IMAGES:\n-\t\t\t\twhitelist = Whitelist.basicWithImages();\n-\t\t\t\tbreak;\n-\t\t\tcase NONE:\n-\t\t\t\twhitelist = Whitelist.none();\n-\t\t\t\tbreak;\n-\t\t\tcase RELAXED:\n-\t\t\t\twhitelist = Whitelist.relaxed();\n-\t\t\t\tbreak;\n-\t\t\tcase SIMPLE_TEXT:\n-\t\t\t\twhitelist = Whitelist.simpleText();\n-\t\t\t\tbreak;\n-\t\t}\n-\t\tbaseURI = safeHtmlAnnotation.baseURI();\n-\t\twhitelist.addTags( safeHtmlAnnotation.additionalTags() );\n-\n-\t\tfor ( SafeHtml.Tag tag : safeHtmlAnnotation.additionalTagsWithAttributes() ) {\n-\t\t\twhitelist.addTags( tag.name() );\n-\t\t\tif ( tag.attributes().length > 0 ) {\n-\t\t\t\twhitelist.addAttributes( tag.name(), tag.attributes() );\n-\t\t\t}\n-\n-\t\t\tfor ( SafeHtml.Attribute attribute : tag.attributesWithProtocols() ) {\n-\t\t\t\twhitelist.addAttributes( tag.name(), attribute.name() );\n-\n-\t\t\t\tif ( attribute.protocols().length > 0 ) {\n-\t\t\t\t\twhitelist.addProtocols( tag.name(), attribute.name(), attribute.protocols() );\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t}\n-\n-\t@Override\n-\tpublic boolean isValid(CharSequence value, ConstraintValidatorContext context) {\n-\t\tif ( value == null ) {\n-\t\t\treturn true;\n-\t\t}\n-\n-\t\treturn new Cleaner( whitelist ).isValid( getFragmentAsDocument( value ) );\n-\t}\n-\n-\t/**\n-\t * Returns a document whose {@code <body>} element contains the given HTML fragment.\n-\t */\n-\tprivate Document getFragmentAsDocument(CharSequence value) {\n-\t\t// using the XML parser ensures that all elements in the input are retained, also if they actually are not allowed at the given\n-\t\t// location; E.g. a <td> element isn't allowed directly within the <body> element, so it would be used by the default HTML parser.\n-\t\t// we need to retain it though to apply the given white list properly; See HV-873\n-\t\tDocument fragment = Jsoup.parse( value.toString(), baseURI, Parser.xmlParser() );\n-\t\tDocument document = Document.createShell( baseURI );\n-\n-\t\t// add the fragment's nodes to the body of resulting document\n-\t\tList<Node> childNodes = fragment.childNodes();\n-\t\tfor ( Node node : childNodes ) {\n-\t\t\tdocument.body().appendChild( node.clone() );\n-\t\t}\n-\n-\t\treturn document;\n-\t}\n-}"
            },
            {
                "sha": "9e2156c6ff69ac01f7b1a86fce86452826de73ee",
                "filename": "engine/src/main/java/org/hibernate/validator/internal/metadata/core/BuiltinConstraint.java",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Finternal%2Fmetadata%2Fcore%2FBuiltinConstraint.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Finternal%2Fmetadata%2Fcore%2FBuiltinConstraint.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Finternal%2Fmetadata%2Fcore%2FBuiltinConstraint.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -73,7 +73,6 @@ enum BuiltinConstraint {\n \tORG_HIBERNATE_VALIDATOR_CONSTRAINTS_PARAMETER_SCRIPT_ASSERT(\"org.hibernate.validator.constraints.ParameterScriptAssert\"),\n \tORG_HIBERNATE_VALIDATOR_CONSTRAINTS_RANGE(\"org.hibernate.validator.constraints.Range\",\n \t\t\tArrays.asList( JAVAX_VALIDATION_CONSTRAINTS_MIN, JAVAX_VALIDATION_CONSTRAINTS_MAX )),\n-\tORG_HIBERNATE_VALIDATOR_CONSTRAINTS_SAFE_HTML(\"org.hibernate.validator.constraints.SafeHtml\"),\n \tORG_HIBERNATE_VALIDATOR_CONSTRAINTS_SCRIPT_ASSERT(\"org.hibernate.validator.constraints.ScriptAssert\"),\n \tORG_HIBERNATE_VALIDATOR_CONSTRAINTS_URL(\"org.hibernate.validator.constraints.URL\",\n \t\t\tArrays.asList( JAVAX_VALIDATION_CONSTRAINTS_PATTERN )),"
            },
            {
                "sha": "ed442dad424b3e853195dbe6e8a6bb82f022d678",
                "filename": "engine/src/main/java/org/hibernate/validator/internal/metadata/core/ConstraintHelper.java",
                "status": "modified",
                "additions": 0,
                "deletions": 16,
                "changes": 16,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Finternal%2Fmetadata%2Fcore%2FConstraintHelper.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Finternal%2Fmetadata%2Fcore%2FConstraintHelper.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Finternal%2Fmetadata%2Fcore%2FConstraintHelper.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -50,7 +50,6 @@\n import static org.hibernate.validator.internal.metadata.core.BuiltinConstraint.ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_PL_PESEL;\n import static org.hibernate.validator.internal.metadata.core.BuiltinConstraint.ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_PL_REGON;\n import static org.hibernate.validator.internal.metadata.core.BuiltinConstraint.ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_RANGE;\n-import static org.hibernate.validator.internal.metadata.core.BuiltinConstraint.ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_SAFE_HTML;\n import static org.hibernate.validator.internal.metadata.core.BuiltinConstraint.ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_SCRIPT_ASSERT;\n import static org.hibernate.validator.internal.metadata.core.BuiltinConstraint.ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_TIME_DURATION_MAX;\n import static org.hibernate.validator.internal.metadata.core.BuiltinConstraint.ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_TIME_DURATION_MIN;\n@@ -118,7 +117,6 @@\n import org.hibernate.validator.constraints.Normalized;\n import org.hibernate.validator.constraints.ParameterScriptAssert;\n import org.hibernate.validator.constraints.Range;\n-import org.hibernate.validator.constraints.SafeHtml;\n import org.hibernate.validator.constraints.ScriptAssert;\n import org.hibernate.validator.constraints.URL;\n import org.hibernate.validator.constraints.UniqueElements;\n@@ -335,7 +333,6 @@\n import org.hibernate.validator.internal.constraintvalidators.hv.ModCheckValidator;\n import org.hibernate.validator.internal.constraintvalidators.hv.NormalizedValidator;\n import org.hibernate.validator.internal.constraintvalidators.hv.ParameterScriptAssertValidator;\n-import org.hibernate.validator.internal.constraintvalidators.hv.SafeHtmlValidator;\n import org.hibernate.validator.internal.constraintvalidators.hv.ScriptAssertValidator;\n import org.hibernate.validator.internal.constraintvalidators.hv.URLValidator;\n import org.hibernate.validator.internal.constraintvalidators.hv.UniqueElementsValidator;\n@@ -377,7 +374,6 @@ public class ConstraintHelper {\n \tprivate static final Log LOG = LoggerFactory.make( MethodHandles.lookup() );\n \tprivate static final String JODA_TIME_CLASS_NAME = \"org.joda.time.ReadableInstant\";\n \tprivate static final String JAVA_MONEY_CLASS_NAME = \"javax.money.MonetaryAmount\";\n-\tprivate static final String JSOUP_CLASS_NAME = \"org.jsoup.Jsoup\";\n \n \t@Immutable\n \tprivate final Map<Class<? extends Annotation>, List<? extends ConstraintValidatorDescriptor<?>>> enabledBuiltinConstraints;\n@@ -392,8 +388,6 @@ public class ConstraintHelper {\n \n \tprivate Boolean jodaTimeInClassPath;\n \n-\tprivate Boolean jsoupInClasspath;\n-\n \tpublic static ConstraintHelper forAllBuiltinConstraints() {\n \t\treturn new ConstraintHelper( new HashSet<>( Arrays.asList( BuiltinConstraint.values() ) ) );\n \t}\n@@ -803,9 +797,6 @@ private ConstraintHelper(Set<BuiltinConstraint> enabledBuiltinConstraints) {\n \t\tif ( enabledBuiltinConstraints.contains( ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_PL_REGON ) ) {\n \t\t\tputBuiltinConstraint( tmpConstraints, REGON.class, REGONValidator.class );\n \t\t}\n-\t\tif ( enabledBuiltinConstraints.contains( ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_SAFE_HTML ) && isJsoupInClasspath() ) {\n-\t\t\tputBuiltinConstraint( tmpConstraints, SafeHtml.class, SafeHtmlValidator.class );\n-\t\t}\n \t\tif ( enabledBuiltinConstraints.contains( ORG_HIBERNATE_VALIDATOR_CONSTRAINTS_SCRIPT_ASSERT ) ) {\n \t\t\tputBuiltinConstraint( tmpConstraints, ScriptAssert.class, ScriptAssertValidator.class );\n \t\t}\n@@ -1125,13 +1116,6 @@ private boolean isJavaMoneyInClasspath() {\n \t\treturn javaMoneyInClasspath.booleanValue();\n \t}\n \n-\tprivate boolean isJsoupInClasspath() {\n-\t\tif ( jsoupInClasspath == null ) {\n-\t\t\tjsoupInClasspath = isClassPresent( JSOUP_CLASS_NAME );\n-\t\t}\n-\t\treturn jsoupInClasspath.booleanValue();\n-\t}\n-\n \t/**\n \t * Returns the default validators for the given constraint type.\n \t *"
            },
            {
                "sha": "81048ae4dbea769395aed03aa360881a2f58225f",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -37,7 +37,6 @@ org.hibernate.validator.constraints.NotBlank.message                = may not be\n org.hibernate.validator.constraints.NotEmpty.message                = may not be empty\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = script expression \"{script}\" didn't evaluate to true\n org.hibernate.validator.constraints.Range.message                   = must be between {min} and {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = may have unsafe html content\n org.hibernate.validator.constraints.ScriptAssert.message            = script expression \"{script}\" didn't evaluate to true\n org.hibernate.validator.constraints.UniqueElements.message          = must only contain unique elements\n org.hibernate.validator.constraints.URL.message                     = must be a valid URL"
            },
            {
                "sha": "5395605416e7074609cc3d68734e79f107b5cb95",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_ar.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ar.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ar.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ar.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -24,6 +24,5 @@ org.hibernate.validator.constraints.NotBlank.message                = \\u0644\\u06\n org.hibernate.validator.constraints.NotEmpty.message                = \\u0644\\u0627 \\u064a\\u0645\\u0643\\u0646 \\u0623\\u0646 \\u062a\\u0643\\u0648\\u0646 \\u0641\\u0627\\u0631\\u063a\\u0629\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = \\u0627\\u0644\\u062a\\u0639\\u0628\\u064a\\u0631 \\u0627\\u0644\\u0646\\u0635\\u064a \"{script}\" \\u0644\\u0645 \\u064a\\u062a\\u0645 \\u062a\\u0642\\u064a\\u064a\\u0645\\u0647 \\u0635\\u062d\\u064a\\u062d\\u0627\n org.hibernate.validator.constraints.Range.message                   = \\u064a\\u062c\\u0628 \\u0623\\u0646 \\u064a\\u0643\\u0648\\u0646 \\u0628\\u064a\\u0646 {min} \\u0648{max}\n-org.hibernate.validator.constraints.SafeHtml.message                = \\u0642\\u062f \\u064a\\u062d\\u062a\\u0648\\u0649 \\u0639\\u0644\\u0649 \\u0633\\u062c\\u0644 \\u0645\\u0646 \\u0646\\u0648\\u0639 HTML \\u063a\\u064a\\u0631 \\u0622\\u0645\\u0646\n org.hibernate.validator.constraints.ScriptAssert.message            = \\u0627\\u0644\\u062a\\u0639\\u0628\\u064a\\u0631 \\u0627\\u0644\\u0646\\u0635\\u064a \"{script}\" \\u0644\\u0645 \\u064a\\u062a\\u0645 \\u062a\\u0642\\u064a\\u064a\\u0645\\u0647  \\u0635\\u062d\\u064a\\u062d\\u0627\n org.hibernate.validator.constraints.URL.message                     = \\u064a\\u062c\\u0628 \\u0623\\u0646 \\u064a\\u0643\\u0648\\u0646 \\u0645\\u062d\\u062f\\u062f \\u0645\\u0648\\u0642\\u0639 \\u0627\\u0644\\u0645\\u0639\\u0644\\u0648\\u0645\\u0627\\u062a \\u0635\\u062d\\u064a\\u062d\\u0627"
            },
            {
                "sha": "52861936e0cbd41f7ed23529009544486b094019",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_cs.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_cs.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_cs.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_cs.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = nesm\\u00ed\n org.hibernate.validator.constraints.NotEmpty.message                = nesm\\u00ed b\\u00fdt pr\\u00e1zdn\\u00e1\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = v\\u00fdraz skriptu \"{script}\" se nevyhodnotil na true\n org.hibernate.validator.constraints.Range.message                   = mus\\u00ed le\\u017eet v rozsahu {min} a\\u017e {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = je mo\\u017en\\u00e9, \\u017ee obsah html nen\\u00ed bezpe\\u010dn\\u00fd\n org.hibernate.validator.constraints.ScriptAssert.message            = v\\u00fdraz skriptu \"{script}\" se nevyhodnotil na true\n org.hibernate.validator.constraints.UniqueElements.message          = mus\\u00ed obsahovat pouze jedine\\u010dn\\u00e9 prvky\n org.hibernate.validator.constraints.URL.message                     = mus\\u00ed b\\u00fdt platnou adresou URL"
            },
            {
                "sha": "48c59415b4a399e4083b108ac080e2e91f5c5402",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_da.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_da.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_da.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_da.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message               = m\\u00e5 ikk\n org.hibernate.validator.constraints.NotEmpty.message               = m\\u00e5 ikke v\\u00e6re tomt\n org.hibernate.validator.constraints.ParametersScriptAssert.message = script udtryk \"{script}\" evaluerede ikke til true\n org.hibernate.validator.constraints.Range.message                  = skal v\\u00e6re mellem {min} og {max}\n-org.hibernate.validator.constraints.SafeHtml.message               = kan have usikkert HTML-indhold\n org.hibernate.validator.constraints.ScriptAssert.message           = script udtryk \"{script}\" evaluerede ikke til true\n org.hibernate.validator.constraints.UniqueElements.message         = m\\u00e5 kun indeholde unikke elementer\n org.hibernate.validator.constraints.URL.message                    = skal v\\u00e6re en gyldig webadresse"
            },
            {
                "sha": "4197a8a41698ec194c4894e665bd2bfbd3bb471a",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_de.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_de.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_de.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_de.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = darf nicht\n org.hibernate.validator.constraints.NotEmpty.message                = darf nicht leer sein\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = die Evaluierung des Scriptausdrucks \"{script}\" ergab nicht true\n org.hibernate.validator.constraints.Range.message                   = muss zwischen {min} und {max} sein\n-org.hibernate.validator.constraints.SafeHtml.message                = hat m\\u00f6glicherweise keinen gesch\\u00fctzten HTML-Inhalt\n org.hibernate.validator.constraints.ScriptAssert.message            = die Evaluierung des Scriptausdrucks \"{script}\" ergab nicht true\n org.hibernate.validator.constraints.UniqueElements.message          = darf nur eindeutige Elemente enthalten\n org.hibernate.validator.constraints.URL.message                     = muss eine g\\u00fcltige URL sein"
            },
            {
                "sha": "50110923a20f2c84aad024d1205e684486ad7715",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_es.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_es.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_es.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_es.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = no debe es\n org.hibernate.validator.constraints.NotEmpty.message                = no debe estar vac\\u00edo\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = la expresi\\u00f3n de script \"{script}\" no se ha evaluado en verdadera\n org.hibernate.validator.constraints.Range.message                   = debe estar entre {min} y {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = puede tener contenido HTML no seguro\n org.hibernate.validator.constraints.ScriptAssert.message            = la expresi\\u00f3n de script \"{script}\" no se ha evaluado en verdadera\n org.hibernate.validator.constraints.UniqueElements.message          = solo debe contener elementos exclusivos\n org.hibernate.validator.constraints.URL.message                     = debe ser un URL v\\u00e1lido"
            },
            {
                "sha": "64d20b05140d00a3509c93dceca895bda9a47cd9",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_fa.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_fa.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_fa.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_fa.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -35,7 +35,6 @@ org.hibernate.validator.constraints.NotBlank.message                = \\u0645\\u06\n org.hibernate.validator.constraints.NotEmpty.message                = \\u0645\\u0642\\u062F\\u0627\\u0631 \\u0646\\u0628\\u0627\\u06CC\\u062F \\u062E\\u0627\\u0644\\u06CC \\u0628\\u0627\\u0634\\u062F\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = \\u0627\\u0633\\u06A9\\u0631\\u06CC\\u067E\\u062A \"{script}\" \\u0645\\u0642\\u062F\\u0627\\u0631 \\u062F\\u0631\\u0633\\u062A \\u0628\\u0631\\u0646\\u0645\\u06CC\\u06AF\\u0631\\u062F\\u0627\\u0646\\u062F\n org.hibernate.validator.constraints.Range.message                   = \\u0645\\u0642\\u062F\\u0627\\u0631 \\u0628\\u0627\\u06CC\\u062F \\u0628\\u06CC\\u0646 {min} \\u0648 {max} \\u0628\\u0627\\u0634\\u062F\n-org.hibernate.validator.constraints.SafeHtml.message                = \\u0645\\u0642\\u062F\\u0627\\u0631 \\u0628\\u0631\\u0627\\u06CC \\u0642\\u0631\\u0627\\u0631\\u06AF\\u06CC\\u0631\\u06CC \\u062F\\u0631 html \\u0645\\u0646\\u0627\\u0633\\u0628 \\u0646\\u0645\\u06CC\\u0628\\u0627\\u0634\\u062F\n org.hibernate.validator.constraints.ScriptAssert.message            = \\u0627\\u0633\\u06A9\\u0631\\u06CC\\u067E\\u062A \"{script}\" \\u0645\\u0642\\u062F\\u0627\\u0631 \\u062F\\u0631\\u0633\\u062A \\u0628\\u0631\\u0646\\u0645\\u06CC\\u06AF\\u0631\\u062F\\u0627\\u0646\\u062F\n org.hibernate.validator.constraints.URL.message                     = \\u0645\\u0642\\u062F\\u0627\\u0631 URL \\u062F\\u0631\\u0633\\u062A \\u0646\\u0645\\u06CC\\u0628\\u0627\\u0634\\u062F\n "
            },
            {
                "sha": "c4284e4fc8113b1189ab1f7a12396cae0e23d37d",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_fr.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_fr.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_fr.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_fr.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = ne doit pa\n org.hibernate.validator.constraints.NotEmpty.message                = ne doit pas \\u00eatre vide\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = le script \"{script}\" n'a pas \\u00E9t\\u00E9 \\u00E9valu\\u00E9 \\u00E0 vrai\n org.hibernate.validator.constraints.Range.message                   = doit \\u00eatre compris entre {min} et {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = peut comporter un contenu HTML non s\\u00e9curis\\u00e9\n org.hibernate.validator.constraints.ScriptAssert.message            = le script \"{script}\" n'a pas \\u00E9t\\u00E9 \\u00E9valu\\u00E9 \\u00E0 vrai\n org.hibernate.validator.constraints.UniqueElements.message          = ne doit contenir que des \\u00e9l\\u00e9ments uniques\n org.hibernate.validator.constraints.URL.message                     = doit \\u00eatre une URL valide"
            },
            {
                "sha": "cb21853d94da049f478bf678157e88e9cbc4c7f9",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_hu.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_hu.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_hu.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_hu.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = nem lehet\n org.hibernate.validator.constraints.NotEmpty.message                = nem lehet \\u00fcres\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = a(z) \"{script}\" parancsf\\u00e1jl kifejez\\u00e9s nem true \\u00e9rt\\u00e9kre \\u00e9rt\\u00e9kel\\u0151d\\u00f6tt ki\n org.hibernate.validator.constraints.Range.message                   = a(z) {min} \\u00e9s {max} \\u00e9rt\\u00e9kek k\\u00f6z\\u00f6tt kell lennie\n-org.hibernate.validator.constraints.SafeHtml.message                = lehets\\u00e9ges nem biztons\\u00e1gos html tartalom\n org.hibernate.validator.constraints.ScriptAssert.message            = a(z) \"{script}\" parancsf\\u00e1jl kifejez\\u00e9s nem true \\u00e9rt\\u00e9kre \\u00e9rt\\u00e9kel\\u0151d\\u00f6tt ki\n org.hibernate.validator.constraints.UniqueElements.message          = csak egyedi elemeket tartalmazhat\n org.hibernate.validator.constraints.URL.message                     = egy \\u00e9rv\\u00e9nyes URL c\\u00edmnek kell lennie"
            },
            {
                "sha": "fa39d1e96fee64c00ab1218bcd2ad694a78f233b",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_it.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_it.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_it.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_it.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = non deve e\n org.hibernate.validator.constraints.NotEmpty.message                = non deve essere vuoto\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = espressione script \"{script}\" non valutata true\n org.hibernate.validator.constraints.Range.message                   = deve essere compresa tra {min} e {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = ha contenuto html non sicuro\n org.hibernate.validator.constraints.ScriptAssert.message            = espressione script \"{script}\" non valutata true\n org.hibernate.validator.constraints.UniqueElements.message          = deve contenere solo elementi univoci\n org.hibernate.validator.constraints.URL.message                     = deve essere un URL valido"
            },
            {
                "sha": "c451bbe8ad86a4097241baf38c4e13021e974a05",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_ja.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ja.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ja.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ja.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = \\u7a7a\\u76\n org.hibernate.validator.constraints.NotEmpty.message                = \\u7a7a\\u8981\\u7d20\\u306f\\u8a31\\u53ef\\u3055\\u308c\\u3066\\u3044\\u307e\\u305b\\u3093\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = \\u6b21\\u306e\\u30b9\\u30af\\u30ea\\u30d7\\u30c8\\u5f0f \"{script}\" \\u306b\\u3088\\u308b\\u8a55\\u4fa1\\u7d50\\u679c\\u304c true \\u306b\\u306a\\u308a\\u307e\\u305b\\u3093\\u3067\\u3057\\u305f\n org.hibernate.validator.constraints.Range.message                   = {min} \\u304b\\u3089 {max} \\u306e\\u9593\\u306b\\u3057\\u3066\\u304f\\u3060\\u3055\\u3044\n-org.hibernate.validator.constraints.SafeHtml.message                = \\u5b89\\u5168\\u3067\\u306f\\u306a\\u3044 HTML \\u30b3\\u30f3\\u30c6\\u30f3\\u30c4\\u3067\\u3059\n org.hibernate.validator.constraints.ScriptAssert.message            = \\u6b21\\u306e\\u30b9\\u30af\\u30ea\\u30d7\\u30c8\\u5f0f \"{script}\" \\u306b\\u3088\\u308b\\u8a55\\u4fa1\\u7d50\\u679c\\u304c true \\u306b\\u306a\\u308a\\u307e\\u305b\\u3093\\u3067\\u3057\\u305f\n org.hibernate.validator.constraints.UniqueElements.message          = \\u8981\\u7d20\\u306f\\u5168\\u3066\\u30e6\\u30cb\\u30fc\\u30af\\u306b\\u3057\\u3066\\u304f\\u3060\\u3055\\u3044\n org.hibernate.validator.constraints.URL.message                     = URL \\u3068\\u3057\\u3066\\u6b63\\u3057\\u3044\\u5f62\\u5f0f\\u306b\\u3057\\u3066\\u304f\\u3060\\u3055\\u3044"
            },
            {
                "sha": "c1ed720f40df32497aa205b389e469a3c4e5d890",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_ko.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ko.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ko.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ko.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = \\uacf5\\ubc\n org.hibernate.validator.constraints.NotEmpty.message                = \\ube44\\uc5b4 \\uc788\\uc744 \\uc218 \\uc5c6\\uc2b5\\ub2c8\\ub2e4\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = \\uc2a4\\ud06c\\ub9bd\\ud2b8 \\ud45c\\ud604\\uc2dd \"{script}\"\\uac00 true\\ub85c \\ud3c9\\uac00\\ub418\\uc9c0 \\uc54a\\uc558\\uc2b5\\ub2c8\\ub2e4\n org.hibernate.validator.constraints.Range.message                   = {min}\\uc5d0\\uc11c {max} \\uc0ac\\uc774\\uc5ec\\uc57c \\ud569\\ub2c8\\ub2e4\n-org.hibernate.validator.constraints.SafeHtml.message                = \\uc548\\uc804\\ud558\\uc9c0 \\uc54a\\uc740 html \\ucee8\\ud150\\uce20\\uac00 \\uc788\\uc744 \\uc218 \\uc788\\uc2b5\\ub2c8\\ub2e4\n org.hibernate.validator.constraints.ScriptAssert.message            = \\uc2a4\\ud06c\\ub9bd\\ud2b8 \\ud45c\\ud604\\uc2dd \"{script}\"\\uac00 true\\ub85c \\ud3c9\\uac00\\ub418\\uc9c0 \\uc54a\\uc558\\uc2b5\\ub2c8\\ub2e4\n org.hibernate.validator.constraints.UniqueElements.message          = \\uace0\\uc720 \\uc694\\uc18c\\ub9cc \\ud3ec\\ud568\\ud574\\uc57c \\ud569\\ub2c8\\ub2e4\n org.hibernate.validator.constraints.URL.message                     = \\uc62c\\ubc14\\ub978 URL\\uc774\\uc5b4\\uc57c \\ud569\\ub2c8\\ub2e4"
            },
            {
                "sha": "706b64ff8ce742d060f4a18bd8b276854758d3dd",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_nl.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_nl.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_nl.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_nl.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = mag niet o\n org.hibernate.validator.constraints.NotEmpty.message                = mag niet leeg zijn\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = scriptexpressie \"{script}\" is ongeldig\n org.hibernate.validator.constraints.Range.message                   = moet tussen {min} en {max} zijn\n-org.hibernate.validator.constraints.SafeHtml.message                = kan onveilige HTML-inhoud bevatten\n org.hibernate.validator.constraints.ScriptAssert.message            = scriptexpressie \"{script}\" is ongeldig\n org.hibernate.validator.constraints.UniqueElements.message          = mag geen duplicaten bevatten\n org.hibernate.validator.constraints.URL.message                     = moet een geldige URL zijn"
            },
            {
                "sha": "56afd25f30a704ff6df66bef8f6c61ada933e49d",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_pl.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_pl.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_pl.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_pl.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = nie mo\\u01\n org.hibernate.validator.constraints.NotEmpty.message                = nie mo\\u017ce by\\u0107 puste\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = warto\\u015bciowanie wyra\\u017cenia skryptu {script} nie zwr\\u00f3ci\\u0142o warto\\u015bci true\n org.hibernate.validator.constraints.Range.message                   = musi nale\\u017ce\\u0107 do zakresu od {min} do {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = mo\\u017ce zawiera\\u0107 niebezpieczn\\u0105 tre\\u015b\\u0107 HTML\n org.hibernate.validator.constraints.ScriptAssert.message            = warto\\u015bciowanie wyra\\u017cenia skryptu {script} nie zwr\\u00f3ci\\u0142o warto\\u015bci true\n org.hibernate.validator.constraints.UniqueElements.message          = musi zawiera\\u0107 tylko unikalne elementy\n org.hibernate.validator.constraints.URL.message                     = musi by\\u0107 poprawnym adresem URL"
            },
            {
                "sha": "8bcaefef53990363789490d35193c38d8cb82e0d",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_pt_BR.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_pt_BR.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_pt_BR.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_pt_BR.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = n\\u00e3o d\n org.hibernate.validator.constraints.NotEmpty.message                = n\\u00e3o deve estar vazio\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = express\\u00e3o de script \"{script}\" n\\u00e3o avaliou para true\n org.hibernate.validator.constraints.Range.message                   = deve estar entre {min} e {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = pode ter conte\\u00fado HTML n\\u00e3o seguro\n org.hibernate.validator.constraints.ScriptAssert.message            = express\\u00e3o de script \"{script}\" n\\u00e3o avaliou para true\n org.hibernate.validator.constraints.UniqueElements.message          = deve conter apenas elementos exclusivos\n org.hibernate.validator.constraints.URL.message                     = deve ser uma URL v\\u00e1lida"
            },
            {
                "sha": "5bbc9185cfb2eb5bbcb50c8fb96614c45b5c85d4",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_ro.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ro.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ro.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ro.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = nu trebuie\n org.hibernate.validator.constraints.NotEmpty.message                = nu trebuie s\\u0103 fie gol\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = expresia de script \"{script}\" nu s-a evaluat la true\n org.hibernate.validator.constraints.Range.message                   = trebuie s\\u0103 fie \\u00eentre {min} \\u015fi {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = poate avea con\\u0163inut HTML periculos\n org.hibernate.validator.constraints.ScriptAssert.message            = expresia de script \"{script}\" nu s-a evaluat la true\n org.hibernate.validator.constraints.UniqueElements.message          = trebuie s\\u0103 con\\u0163in\\u0103 numai elemente unice\n org.hibernate.validator.constraints.URL.message                     = trebuie s\\u0103 fie un URL valid"
            },
            {
                "sha": "20dbee9900f3da58d58fb725434578fba435ec98",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_ru.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ru.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ru.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_ru.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = \\u043d\\u04\n org.hibernate.validator.constraints.NotEmpty.message                = \\u043d\\u0435 \\u0434\\u043e\\u043b\\u0436\\u043d\\u043e \\u0431\\u044b\\u0442\\u044c \\u043f\\u0443\\u0441\\u0442\\u044b\\u043c\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = \\u0440\\u0435\\u0437\\u0443\\u043b\\u044c\\u0442\\u0430\\u0442 \\u0432\\u044b\\u0447\\u0438\\u0441\\u043b\\u0435\\u043d\\u0438\\u044f \\u0432\\u044b\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u044f \\u0441\\u0446\\u0435\\u043d\\u0430\\u0440\\u0438\\u044f \"{script}\" \\u043d\\u0435 \\u0440\\u0430\\u0432\\u0435\\u043d true\n org.hibernate.validator.constraints.Range.message                   = \\u0434\\u043e\\u043b\\u0436\\u043d\\u043e \\u043d\\u0430\\u0445\\u043e\\u0434\\u0438\\u0442\\u044c\\u0441\\u044f \\u0432 \\u0434\\u0438\\u0430\\u043f\\u0430\\u0437\\u043e\\u043d\\u0435 \\u043e\\u0442 {min} \\u0434\\u043e {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = \\u043c\\u043e\\u0436\\u0435\\u0442 \\u0438\\u043c\\u0435\\u0442\\u044c \\u043d\\u0435\\u0431\\u0435\\u0437\\u043e\\u043f\\u0430\\u0441\\u043d\\u044b\\u0439 \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442 html\n org.hibernate.validator.constraints.ScriptAssert.message            = \\u0440\\u0435\\u0437\\u0443\\u043b\\u044c\\u0442\\u0430\\u0442 \\u0432\\u044b\\u0447\\u0438\\u0441\\u043b\\u0435\\u043d\\u0438\\u044f \\u0432\\u044b\\u0440\\u0430\\u0436\\u0435\\u043d\\u0438\\u044f \\u0441\\u0446\\u0435\\u043d\\u0430\\u0440\\u0438\\u044f \"{script}\" \\u043d\\u0435 \\u0440\\u0430\\u0432\\u0435\\u043d true\n org.hibernate.validator.constraints.UniqueElements.message          = \\u0434\\u043e\\u043b\\u0436\\u043d\\u043e \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0430\\u0442\\u044c \\u0442\\u043e\\u043b\\u044c\\u043a\\u043e \\u0443\\u043d\\u0438\\u043a\\u0430\\u043b\\u044c\\u043d\\u044b\\u0435 \\u044d\\u043b\\u0435\\u043c\\u0435\\u043d\\u0442\\u044b\n org.hibernate.validator.constraints.URL.message                     = \\u0434\\u043e\\u043b\\u0436\\u043d\\u043e \\u0441\\u043e\\u0434\\u0435\\u0440\\u0436\\u0430\\u0442\\u044c \\u0434\\u043e\\u043f\\u0443\\u0441\\u0442\\u0438\\u043c\\u044b\\u0439 URL"
            },
            {
                "sha": "c58d0a66dfd5c26fb618571376c1877b1ff7f079",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_sk.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_sk.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_sk.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_sk.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -28,6 +28,5 @@ org.hibernate.validator.constraints.NotBlank.message                = nem\\u00f4\\\n org.hibernate.validator.constraints.NotEmpty.message                = nem\\u00f4\\u017ee by\\u0165 pr\\u00e1zdne\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = skriptovac\\u00ed v\\u00fdraz \"{script}\" nebol vyhodnoten\\u00fd na \\u00e1no\n org.hibernate.validator.constraints.Range.message                   = mus\\u00ed by\\u0165 medzi {min} a {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = m\\u00f4\\u017ee obsahova\\u0165 nebezpe\\u010dn\\u00fd html obsah\n org.hibernate.validator.constraints.ScriptAssert.message            = skriptovac\\u00ed v\\u00fdraz \"{script}\" nebol vyhodnoten\\u00fd na \\u00e1no\n org.hibernate.validator.constraints.URL.message                     = mus\\u00ed b\\u00fdt platn\\u00e1 URL"
            },
            {
                "sha": "206cde75fa74c81d42f0ccdff3ce31b3d12e1085",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_tr.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_tr.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_tr.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_tr.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -21,4 +21,3 @@ org.hibernate.validator.constraints.CodePointLength.message = uzunluk '{min}' il\n org.hibernate.validator.constraints.NotBlank.message        = bo\\u015F de\\u011Fer olamaz\n org.hibernate.validator.constraints.NotEmpty.message        = bo\\u015F de\\u011Fer olamaz\n org.hibernate.validator.constraints.Range.message           = {min} ve {max} aras\\u0131nda olmal\\u0131d\\u0131r!\n-org.hibernate.validator.constraints.SafeHtml.message        = g\\u00FCvensiz html i\\u00E7erik olabilir"
            },
            {
                "sha": "31b6790ac34beace4d9a2623ac749642766a813c",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_uk.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_uk.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_uk.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_uk.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = \\u043d\\u04\n org.hibernate.validator.constraints.NotEmpty.message                = \\u043d\\u0435 \\u043c\\u043e\\u0436\\u0435 \\u0431\\u0443\\u0442\\u0438 \\u043f\\u043e\\u0440\\u043e\\u0436\\u043d\\u0456\\u043c\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = \\u0441\\u043a\\u0440\\u0438\\u043f\\u0442\\u043e\\u0432\\u0438\\u0439 \\u0432\\u0438\\u0440\\u0430\\u0437 \"{script}\" \\u043d\\u0435 \\u0454 \\u0456\\u0441\\u0442\\u0438\\u043d\\u043d\\u0438\\u043c\n org.hibernate.validator.constraints.Range.message                   = \\u043c\\u0430\\u0454 \\u0431\\u0443\\u0442\\u0438 \\u043c\\u0456\\u0436 {min} \\u0442\\u0430 {max}\n-org.hibernate.validator.constraints.SafeHtml.message                = \\u043c\\u043e\\u0436\\u0435 \\u043c\\u0456\\u0441\\u0442\\u0438\\u0442\\u0438 \\u043d\\u0435\\u0431\\u0435\\u0437\\u043f\\u0435\\u0447\\u043d\\u0438\\u0439 html \\u043a\\u043e\\u043d\\u0442\\u0435\\u043d\\u0442\n org.hibernate.validator.constraints.ScriptAssert.message            = \\u0441\\u043a\\u0440\\u0438\\u043f\\u0442\\u043e\\u0432\\u0438\\u0439 \\u0432\\u0438\\u0440\\u0430\\u0437 \"{script}\" \\u043d\\u0435 \\u0454 \\u0456\\u0441\\u0442\\u0438\\u043d\\u043d\\u0438\\u043c\n org.hibernate.validator.constraints.UniqueElements.message          = \\u043f\\u043e\\u0432\\u0438\\u043d\\u043d\\u043e \\u043c\\u0456\\u0441\\u0442\\u0438\\u0442\\u0438 \\u043b\\u0438\\u0448\\u0435 \\u0443\\u043d\\u0456\\u043a\\u0430\\u043b\\u044c\\u043d\\u0456 \\u0435\\u043b\\u0435\\u043c\\u0435\\u043d\\u0442\\u0438\n org.hibernate.validator.constraints.URL.message                     = \\u043c\\u0430\\u0454 \\u0431\\u0443\\u0442\\u0438 \\u0434\\u0456\\u0439\\u0441\\u043d\\u0438\\u043c URL"
            },
            {
                "sha": "7bfb8209b5783549c2dd867fe57c83aad109c17c",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_zh.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_zh.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_zh.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_zh.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = \\u53ef\\u80\n org.hibernate.validator.constraints.NotEmpty.message                = \\u53ef\\u80fd\\u4e0d\\u4e3a\\u7a7a\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = \\u811a\\u672c\\u8868\\u8fbe\\u5f0f \"{script}\" \\u672a\\u6c42\\u503c\\u4e3a true\n org.hibernate.validator.constraints.Range.message                   = \\u5fc5\\u987b\\u4ecb\\u4e8e {min} \\u4e0e {max} \\u4e4b\\u95f4\n-org.hibernate.validator.constraints.SafeHtml.message                = \\u53ef\\u80fd\\u5177\\u6709\\u4e0d\\u5b89\\u5168\\u7684 HTML \\u5185\\u5bb9\n org.hibernate.validator.constraints.ScriptAssert.message            = \\u811a\\u672c\\u8868\\u8fbe\\u5f0f \"{script}\" \\u672a\\u6c42\\u503c\\u4e3a true\n org.hibernate.validator.constraints.UniqueElements.message          = \\u5fc5\\u987b\\u4ec5\\u5305\\u542b\\u552f\\u4e00\\u5143\\u7d20\n org.hibernate.validator.constraints.URL.message                     = \\u5fc5\\u987b\\u4e3a\\u6709\\u6548 URL"
            },
            {
                "sha": "5019f48aca60288b554cb2eccb09df98ae7b3b61",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_zh_CN.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_zh_CN.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_zh_CN.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_zh_CN.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -35,7 +35,6 @@ org.hibernate.validator.constraints.NotBlank.message                = \\u4e0d\\u80\n org.hibernate.validator.constraints.NotEmpty.message                = \\u4e0d\\u80fd\\u4e3a\\u7a7a\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = \\u6267\\u884c\\u811a\\u672c\\u8868\\u8fbe\\u5f0f\"{script}\"\\u6ca1\\u6709\\u8fd4\\u56de\\u671f\\u671b\\u7ed3\\u679c\n org.hibernate.validator.constraints.Range.message                   = \\u9700\\u8981\\u5728{min}\\u548c{max}\\u4e4b\\u95f4\n-org.hibernate.validator.constraints.SafeHtml.message                = \\u53ef\\u80fd\\u6709\\u4e0d\\u5b89\\u5168\\u7684HTML\\u5185\\u5bb9\n org.hibernate.validator.constraints.ScriptAssert.message            = \\u6267\\u884c\\u811a\\u672c\\u8868\\u8fbe\\u5f0f\"{script}\"\\u6ca1\\u6709\\u8fd4\\u56de\\u671f\\u671b\\u7ed3\\u679c\n org.hibernate.validator.constraints.URL.message                     = \\u9700\\u8981\\u662f\\u4e00\\u4e2a\\u5408\\u6cd5\\u7684URL\n "
            },
            {
                "sha": "5eda26f38dddfe363d8afcca6c9476d5dcd63369",
                "filename": "engine/src/main/resources/org/hibernate/validator/ValidationMessages_zh_TW.properties",
                "status": "modified",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_zh_TW.properties",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_zh_TW.properties",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Fmain%2Fresources%2Forg%2Fhibernate%2Fvalidator%2FValidationMessages_zh_TW.properties?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -36,7 +36,6 @@ org.hibernate.validator.constraints.NotBlank.message                = \\u4e0d\\u80\n org.hibernate.validator.constraints.NotEmpty.message                = \\u4e0d\\u80fd\\u662f\\u7a7a\\u7684\n org.hibernate.validator.constraints.ParametersScriptAssert.message  = Script \\u8868\\u793a\\u5f0f \"{script}\" \\u4e0d\\u662f\\u6c42\\u503c\\u70ba true\n org.hibernate.validator.constraints.Range.message                   = \\u5fc5\\u9808\\u5728 {min} \\u548c {max} \\u4e4b\\u9593\n-org.hibernate.validator.constraints.SafeHtml.message                = \\u53ef\\u80fd\\u5177\\u6709\\u4e0d\\u5b89\\u5168\\u7684 html \\u5167\\u5bb9\n org.hibernate.validator.constraints.ScriptAssert.message            = Script \\u8868\\u793a\\u5f0f \"{script}\" \\u4e0d\\u662f\\u6c42\\u503c\\u70ba true\n org.hibernate.validator.constraints.UniqueElements.message          = \\u53ea\\u80fd\\u5305\\u542b\\u552f\\u4e00\\u5143\\u7d20\n org.hibernate.validator.constraints.URL.message                     = \\u5fc5\\u9808\\u662f\\u6709\\u6548\\u7684 URL"
            },
            {
                "sha": "790b7f3871bbb34d3ebe4bbef51bf3bfbcc077a0",
                "filename": "engine/src/test/java/org/hibernate/validator/test/cfg/ProgrammaticConstraintDefinitionsTest.java",
                "status": "modified",
                "additions": 0,
                "deletions": 103,
                "changes": 103,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Fcfg%2FProgrammaticConstraintDefinitionsTest.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Fcfg%2FProgrammaticConstraintDefinitionsTest.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Fcfg%2FProgrammaticConstraintDefinitionsTest.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -26,24 +26,19 @@\n import org.hibernate.validator.cfg.ConstraintMapping;\n import org.hibernate.validator.cfg.defs.LuhnCheckDef;\n import org.hibernate.validator.cfg.defs.ParameterScriptAssertDef;\n-import org.hibernate.validator.cfg.defs.SafeHtmlDef;\n-import org.hibernate.validator.cfg.defs.SafeHtmlDef.AttributeDef;\n-import org.hibernate.validator.cfg.defs.SafeHtmlDef.TagDef;\n import org.hibernate.validator.cfg.defs.br.CNPJDef;\n import org.hibernate.validator.cfg.defs.br.CPFDef;\n import org.hibernate.validator.cfg.defs.br.TituloEleitoralDef;\n import org.hibernate.validator.cfg.defs.pl.NIPDef;\n import org.hibernate.validator.cfg.defs.pl.PESELDef;\n import org.hibernate.validator.cfg.defs.pl.REGONDef;\n import org.hibernate.validator.constraints.LuhnCheck;\n-import org.hibernate.validator.constraints.SafeHtml;\n import org.hibernate.validator.constraints.br.CNPJ;\n import org.hibernate.validator.constraints.br.CPF;\n import org.hibernate.validator.constraints.br.TituloEleitoral;\n import org.hibernate.validator.constraints.pl.NIP;\n import org.hibernate.validator.constraints.pl.PESEL;\n import org.hibernate.validator.constraints.pl.REGON;\n-import org.hibernate.validator.internal.util.annotation.AnnotationDescriptor;\n import org.hibernate.validator.testutil.PrefixableParameterNameProvider;\n import org.testng.annotations.Test;\n \n@@ -67,104 +62,6 @@ public void countrySpecificProgrammaticDefinition() {\n \n \t}\n \n-\t@Test\n-\t@SuppressWarnings(\"deprecation\")\n-\tpublic void safeHtmlProgrammaticDefinition() {\n-\t\tdoProgrammaticTest( SafeHtml.class, new SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.BASIC ), \"<td>1234qwertd>\", 1 );\n-\t\tdoProgrammaticTest( SafeHtml.class, new SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE ), \"test\", 0 );\n-\t\tdoProgrammaticTest( SafeHtml.class, new SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.RELAXED ), \"<td>1234qwer</td>\", 0 );\n-\t\tdoProgrammaticTest( SafeHtml.class, new SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE ).additionalTags( \"td\" ), \"<td>1234qwer</td>\", 0 );\n-\n-\t\tdoProgrammaticTest( SafeHtml.class, new SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.RELAXED ), \"<img src='/some/relative/url/image.png' />\", 1 );\n-\t\tdoProgrammaticTest( SafeHtml.class, new SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.RELAXED ).baseURI( \"http://localhost\" ),\n-\t\t\t\t\"<img src='/some/relative/url/image.png' />\", 0\n-\t\t);\n-\n-\t\t// disallowed attribute\n-\t\tdoProgrammaticTest(\n-\t\t\t\tSafeHtml.class,\n-\t\t\t\tnew SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE )\n-\t\t\t\t\t\t.additionalTags( new TagDef( \"img\" )\n-\t\t\t\t\t\t\t\t.attributes( \"src\" )\n-\t\t\t\t\t\t),\n-\t\t\t\t\"<img href='snafu' />\", 1\n-\t\t);\n-\n-\t\t// allowed attribute, no restrictions on protocols\n-\t\tdoProgrammaticTest(\n-\t\t\t\tSafeHtml.class,\n-\t\t\t\tnew SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE )\n-\t\t\t\t\t\t.additionalTags( new TagDef( \"img\" )\n-\t\t\t\t\t\t\t\t.attributes( \"src\" )\n-\t\t\t\t\t\t),\n-\t\t\t\t\"<img src='data:image/png;base64,100101' />\", 0\n-\t\t);\n-\n-\t\t// allowed attribute, allowed protocol\n-\t\tdoProgrammaticTest(\n-\t\t\t\tSafeHtml.class,\n-\t\t\t\tnew SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE )\n-\t\t\t\t\t\t.additionalTags( new TagDef( \"img\" )\n-\t\t\t\t\t\t\t\t.attributes( new AttributeDef( \"src\", \"data\" ) )\n-\t\t\t\t\t\t),\n-\t\t\t\t\"<img src='data:image/png;base64,100101' />\", 0\n-\t\t);\n-\n-\t\t// allowed attribute, disallowed protocol\n-\t\tdoProgrammaticTest(\n-\t\t\t\tSafeHtml.class,\n-\t\t\t\tnew SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE )\n-\t\t\t\t\t\t.additionalTags( new TagDef( \"img\" )\n-\t\t\t\t\t\t\t\t.attributes( new AttributeDef( \"src\", \"data\" ) )\n-\t\t\t\t\t\t),\n-\t\t\t\t\"<img src='not_data:image/png;base64,100101' />\", 1\n-\t\t);\n-\n-\t\t// multiple allowed attributes and protocols\n-\t\tdoProgrammaticTest(\n-\t\t\t\tSafeHtml.class,\n-\t\t\t\tnew SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE )\n-\t\t\t\t\t\t.additionalTags( new TagDef( \"img\" )\n-\t\t\t\t\t\t\t\t.attributes(\n-\t\t\t\t\t\t\t\t\t\tnew AttributeDef( \"src\", \"data\", \"data2\" ),\n-\t\t\t\t\t\t\t\t\t\tnew AttributeDef( \"href\", \"http\", \"http2\" )\n-\t\t\t\t\t\t\t\t)\n-\t\t\t\t\t\t),\n-\t\t\t\t\"<img src='data:image/png;base64,100101' href='http://foo'/>\", 0\n-\t\t);\n-\n-\t\tdoProgrammaticTest(\n-\t\t\t\tSafeHtml.class,\n-\t\t\t\tnew SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE )\n-\t\t\t\t\t\t.additionalTags( new TagDef( \"td\" ).attributes( \"class\", \"id\" ) ),\n-\t\t\t\t\"<td class='class' id='tableId'>1234qwer</td>\", 0\n-\t\t);\n-\t\tdoProgrammaticTest(\n-\t\t\t\tSafeHtml.class,\n-\t\t\t\tnew SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE )\n-\t\t\t\t\t\t.additionalTags( new TagDef( \"td\" ).attributes( \"class\", \"id\" ) ),\n-\t\t\t\t\"<td class='class' id='tableId' otherAttribute='value'>1234qwer</td>\", 1\n-\t\t);\n-\n-\t\t// Deprecated, kept to ensure backwards compatibility (or at least ensure we are aware we break something if we decide to do so)\n-\t\tAnnotationDescriptor.Builder<SafeHtml.Tag> tagDescriptorBuilder = new AnnotationDescriptor.Builder<>( SafeHtml.Tag.class );\n-\t\ttagDescriptorBuilder.setAttribute( \"name\", \"td\" );\n-\t\ttagDescriptorBuilder.setAttribute( \"attributes\", new String[]{ \"class\", \"id\" } );\n-\t\tdoProgrammaticTest( SafeHtml.class, new SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE )\n-\t\t\t\t.additionalTagsWithAttributes( tagDescriptorBuilder.build().getAnnotation() ), \"<td class='class' id='tableId'>1234qwer</td>\", 0 );\n-\n-\t\tAnnotationDescriptor.Builder<SafeHtml.Attribute> attributeDescriptorBuilder = new AnnotationDescriptor.Builder<>( SafeHtml.Attribute.class );\n-\t\tattributeDescriptorBuilder.setAttribute( \"name\", \"src\" );\n-\t\tattributeDescriptorBuilder.setAttribute( \"protocols\", new String[]{ \"data\" } );\n-\n-\t\ttagDescriptorBuilder = new AnnotationDescriptor.Builder<>( SafeHtml.Tag.class );\n-\t\ttagDescriptorBuilder.setAttribute( \"name\", \"img\" );\n-\t\ttagDescriptorBuilder.setAttribute( \"attributesWithProtocols\", new SafeHtml.Attribute[]{ attributeDescriptorBuilder.build().getAnnotation() } );\n-\n-\t\tdoProgrammaticTest( SafeHtml.class, new SafeHtmlDef().whitelistType( SafeHtml.WhiteListType.NONE )\n-\t\t\t\t.additionalTagsWithAttributes( tagDescriptorBuilder.build().getAnnotation() ), \"<img src='data:image/png;base64,100101' />\", 0 );\n-\t}\n-\n \t@Test\n \tpublic void luhnCheckDefProgrammaticDefinition() {\n \t\tdoProgrammaticTest( LuhnCheck.class, new LuhnCheckDef().startIndex( 0 )"
            },
            {
                "sha": "79311533d979a7df32d7cff832a223a5257c4ca1",
                "filename": "engine/src/test/java/org/hibernate/validator/test/constraints/annotations/hv/SafeHtmlConstrainedTest.java",
                "status": "removed",
                "additions": 0,
                "deletions": 52,
                "changes": 52,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Fconstraints%2Fannotations%2Fhv%2FSafeHtmlConstrainedTest.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Fconstraints%2Fannotations%2Fhv%2FSafeHtmlConstrainedTest.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Fconstraints%2Fannotations%2Fhv%2FSafeHtmlConstrainedTest.java?ref=93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28",
                "patch": "@@ -1,52 +0,0 @@\n-/*\n- * Hibernate Validator, declare and validate application constraints\n- *\n- * License: Apache License, Version 2.0\n- * See the license.txt file in the root directory or <http://www.apache.org/licenses/LICENSE-2.0>.\n- */\n-package org.hibernate.validator.test.constraints.annotations.hv;\n-\n-import static org.hibernate.validator.testutil.ConstraintViolationAssert.assertNoViolations;\n-import static org.hibernate.validator.testutil.ConstraintViolationAssert.assertThat;\n-import static org.hibernate.validator.testutil.ConstraintViolationAssert.violationOf;\n-\n-import java.util.Set;\n-\n-import javax.validation.ConstraintViolation;\n-\n-import org.hibernate.validator.constraints.SafeHtml;\n-import org.hibernate.validator.test.constraints.annotations.AbstractConstrainedTest;\n-\n-import org.testng.annotations.Test;\n-\n-/**\n- * @author Marko Bekhta\n- */\n-public class SafeHtmlConstrainedTest extends AbstractConstrainedTest {\n-\n-\t@Test\n-\tpublic void testSafeHtmlNumber() {\n-\t\tFoo foo = new Foo( \"<div>content</div>\" );\n-\t\tSet<ConstraintViolation<Foo>> violations = validator.validate( foo );\n-\t\tassertNoViolations( violations );\n-\t}\n-\n-\t@Test\n-\tpublic void testSafeHtmlInvalid() {\n-\t\tFoo foo = new Foo( \"<script>alert('Doh')</script>\" );\n-\t\tSet<ConstraintViolation<Foo>> violations = validator.validate( foo );\n-\t\tassertThat( violations ).containsOnlyViolations(\n-\t\t\t\tviolationOf( SafeHtml.class )\n-\t\t);\n-\t}\n-\n-\tprivate static class Foo {\n-\n-\t\t@SafeHtml\n-\t\tprivate final String html;\n-\n-\t\tpublic Foo(String html) {\n-\t\t\tthis.html = html;\n-\t\t}\n-\t}\n-}"
            },
            {
                "sha": "0ad6a0a17720b83d4e51b0e30560733ad4bd1e24",
                "filename": "engine/src/test/java/org/hibernate/validator/test/internal/constraintvalidators/MessagePropertiesTest.java",
                "status": "modified",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Finternal%2Fconstraintvalidators%2FMessagePropertiesTest.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Finternal%2Fconstraintvalidators%2FMessagePropertiesTest.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Finternal%2Fconstraintvalidators%2FMessagePropertiesTest.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -59,7 +59,6 @@\n import org.hibernate.validator.constraints.Normalized;\n import org.hibernate.validator.constraints.ParameterScriptAssert;\n import org.hibernate.validator.constraints.Range;\n-import org.hibernate.validator.constraints.SafeHtml;\n import org.hibernate.validator.constraints.ScriptAssert;\n import org.hibernate.validator.constraints.URL;\n import org.hibernate.validator.constraints.UniqueElements;\n@@ -162,7 +161,6 @@ public void testMessageProperties() throws NoSuchMethodException, SecurityExcept\n \t\t\t\t\t\t\tviolationOf( org.hibernate.validator.constraints.NotBlank.class ),\n \t\t\t\t\t\t\tviolationOf( org.hibernate.validator.constraints.NotEmpty.class ),\n \t\t\t\t\t\t\tviolationOf( Range.class ),\n-\t\t\t\t\t\t\tviolationOf( SafeHtml.class ),\n \t\t\t\t\t\t\tviolationOf( UniqueElements.class ),\n \t\t\t\t\t\t\tviolationOf( URL.class ),\n \t\t\t\t\t\t\tviolationOf( CNPJ.class ),\n@@ -322,9 +320,6 @@ private static class Bean {\n \t\t@Range(min = 2, max = 4)\n \t\tprivate int range = 6;\n \n-\t\t@SafeHtml\n-\t\tprivate String safeHtml = \"<script></script>\";\n-\n \t\t@UniqueElements\n \t\tprivate List<String> uniqueElements = Arrays.asList( \"a\", \"a\" );\n "
            },
            {
                "sha": "497c3200c6b3912d90551fe5be21e5893eeb6b59",
                "filename": "engine/src/test/java/org/hibernate/validator/test/internal/constraintvalidators/PredefinedScopeAllConstraintsTest.java",
                "status": "modified",
                "additions": 0,
                "deletions": 8,
                "changes": 8,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Finternal%2Fconstraintvalidators%2FPredefinedScopeAllConstraintsTest.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Finternal%2Fconstraintvalidators%2FPredefinedScopeAllConstraintsTest.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Finternal%2Fconstraintvalidators%2FPredefinedScopeAllConstraintsTest.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -58,7 +58,6 @@\n import org.hibernate.validator.constraints.Normalized;\n import org.hibernate.validator.constraints.ParameterScriptAssert;\n import org.hibernate.validator.constraints.Range;\n-import org.hibernate.validator.constraints.SafeHtml;\n import org.hibernate.validator.constraints.ScriptAssert;\n import org.hibernate.validator.constraints.URL;\n import org.hibernate.validator.constraints.UniqueElements;\n@@ -121,7 +120,6 @@ public void testConstraints() throws NoSuchMethodException, SecurityException {\n \t\ttestConstraint( org.hibernate.validator.constraints.NotBlank.class, new HvNotBlankBean() );\n \t\ttestConstraint( org.hibernate.validator.constraints.NotEmpty.class, new HvNotEmptyBean() );\n \t\ttestConstraint( Range.class, new RangeBean() );\n-\t\ttestConstraint( SafeHtml.class, new SafeHtmlBean() );\n \t\ttestConstraint( UniqueElements.class, new UniqueElementsBean() );\n \t\ttestConstraint( URL.class, new URLBean() );\n \t\ttestConstraint( CNPJ.class, new CNPJBean() );\n@@ -383,12 +381,6 @@ private static class RangeBean {\n \t\tprivate int range = 6;\n \t}\n \n-\tprivate static class SafeHtmlBean {\n-\n-\t\t@SafeHtml\n-\t\tprivate String safeHtml = \"<script></script>\";\n-\t}\n-\n \tprivate static class UniqueElementsBean {\n \n \t\t@UniqueElements"
            },
            {
                "sha": "45e6f031dad224b0b2d84af00dae4d92cd001d19",
                "filename": "engine/src/test/java/org/hibernate/validator/test/internal/constraintvalidators/hv/SafeHtmlValidatorTest.java",
                "status": "removed",
                "additions": 0,
                "deletions": 292,
                "changes": 292,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Finternal%2Fconstraintvalidators%2Fhv%2FSafeHtmlValidatorTest.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Finternal%2Fconstraintvalidators%2Fhv%2FSafeHtmlValidatorTest.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/engine%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Ftest%2Finternal%2Fconstraintvalidators%2Fhv%2FSafeHtmlValidatorTest.java?ref=93c7dd7ec09dc4d1db48ef02fe0255bb33de1e28",
                "patch": "@@ -1,292 +0,0 @@\n-/*\n- * Hibernate Validator, declare and validate application constraints\n- *\n- * License: Apache License, Version 2.0\n- * See the license.txt file in the root directory or <http://www.apache.org/licenses/LICENSE-2.0>.\n- */\n-package org.hibernate.validator.test.internal.constraintvalidators.hv;\n-\n-import static org.hibernate.validator.testutil.ConstraintViolationAssert.assertNoViolations;\n-import static org.hibernate.validator.testutil.ConstraintViolationAssert.assertThat;\n-import static org.hibernate.validator.testutil.ConstraintViolationAssert.violationOf;\n-import static org.hibernate.validator.testutils.ValidatorUtil.getValidator;\n-import static org.testng.Assert.assertFalse;\n-import static org.testng.Assert.assertTrue;\n-\n-import java.util.Set;\n-\n-import javax.validation.ConstraintViolation;\n-import javax.validation.Validator;\n-\n-import org.hibernate.validator.constraints.SafeHtml;\n-import org.hibernate.validator.constraints.SafeHtml.WhiteListType;\n-import org.hibernate.validator.internal.constraintvalidators.hv.SafeHtmlValidator;\n-import org.hibernate.validator.internal.util.annotation.AnnotationDescriptor;\n-import org.hibernate.validator.internal.util.annotation.ConstraintAnnotationDescriptor;\n-import org.hibernate.validator.testutil.TestForIssue;\n-import org.testng.annotations.BeforeMethod;\n-import org.testng.annotations.Test;\n-\n-/**\n- * Unit test for {@link SafeHtmlValidator}.\n- *\n- * @author George Gastaldi\n- * @author Hardy Ferentschik\n- * @author Marko Bekhta\n- */\n-public class SafeHtmlValidatorTest {\n-\n-\tprivate ConstraintAnnotationDescriptor.Builder<SafeHtml> descriptorBuilder;\n-\n-\t@BeforeMethod\n-\tpublic void setUp() {\n-\t\tdescriptorBuilder = new ConstraintAnnotationDescriptor.Builder<>( SafeHtml.class );\n-\t}\n-\n-\t@Test\n-\tpublic void testNullValue() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tassertTrue( getSafeHtmlValidator().isValid( null, null ) );\n-\t}\n-\n-\t@Test\n-\tpublic void testInvalidScriptTagIncluded() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tassertFalse( getSafeHtmlValidator().isValid( \"Hello<script>alert('Doh')</script>World !\", null ) );\n-\t}\n-\n-\t@Test\n-\t// A \"downlevel revealed\" conditional 'comment' is not an (X)HTML comment at all,\n-\t// despite the misleading name, it is default Microsoft syntax.\n-\t// The tag is unrecognized by therefore executed\n-\tpublic void testDownlevelRevealedConditionalComment() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tassertFalse( getSafeHtmlValidator().isValid( \"<![if !IE]>\\n<SCRIPT>alert{'XSS'};</SCRIPT>\\n<![endif]>\", null ) );\n-\t}\n-\n-\t@Test\n-\tpublic void testDownlevelHiddenConditionalComment() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tassertFalse( getSafeHtmlValidator().isValid( \"<!--[if gte IE 4]>\\n<SCRIPT>alert{'XSS'};</SCRIPT>\\n<![endif]-->\", null ) );\n-\t}\n-\n-\t@Test\n-\tpublic void testSimpleComment() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tassertFalse( getSafeHtmlValidator().isValid( \"<!-- Just a comment -->\", null ) );\n-\t}\n-\n-\t@Test\n-\tpublic void testServerSideIncludesSSI() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tassertFalse( getSafeHtmlValidator().isValid( \"<? echo{'<SCR}'; echo{'IPT>alert{\\\"XSS\\\"}</SCRIPT>'}; ?>\", null ) );\n-\t}\n-\n-\t@Test\n-\tpublic void testPHPScript() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tassertFalse( getSafeHtmlValidator().isValid( \"<? echo{'<SCR}'; echo{'IPT>alert{\\\"XSS\\\"}</SCRIPT>'}; ?>\", null ) );\n-\t}\n-\n-\t@Test\n-\tpublic void testInvalidIncompleteImgTagWithScriptIncluded() {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tassertFalse( getSafeHtmlValidator().isValid( \"<img src=asdf onerror=\\\"alert(1)\\\" x=\", null ) );\n-\t}\n-\n-\t@Test\n-\tpublic void testValid() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tassertTrue( getSafeHtmlValidator().isValid( \"<p><a href='http://example.com/'>Link</a></p>\", null ) );\n-\t}\n-\n-\t@Test\n-\tpublic void testAdditionalTags() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"additionalTags\", new String[] { \"script\" } );\n-\n-\t\tassertTrue( getSafeHtmlValidator().isValid( \"Hello<script>alert('Doh')</script>World !\", null ) );\n-\t}\n-\n-\t@Test\n-\t@TestForIssue(jiraKey = \"HV-817\")\n-\tpublic void testDivNotAllowedInBasicWhiteList() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );\n-\n-\t\tSafeHtmlValidator validator = getSafeHtmlValidator();\n-\t\tassertFalse( validator.isValid( \"<div>test</div>\", null ) );\n-\t}\n-\n-\t@Test\n-\t@TestForIssue(jiraKey = \"HV-817\")\n-\tpublic void testDivAllowedInRelaxedWhiteList() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.RELAXED );\n-\n-\t\tassertTrue( getSafeHtmlValidator().isValid( \"<div>test</div>\", null ) );\n-\t}\n-\n-\t@Test\n-\t@TestForIssue(jiraKey = \"HV-817\")\n-\tpublic void testDivWithWhiteListedClassAttribute() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.RELAXED );\n-\n-\t\tAnnotationDescriptor.Builder<SafeHtml.Tag> tagDescriptorBuilder = new AnnotationDescriptor.Builder<>( SafeHtml.Tag.class );\n-\t\ttagDescriptorBuilder.setAttribute( \"name\", \"div\" );\n-\t\ttagDescriptorBuilder.setAttribute( \"attributes\", new String[] { \"class\" } );\n-\t\tSafeHtml.Tag tag = tagDescriptorBuilder.build().getAnnotation();\n-\t\tdescriptorBuilder.setAttribute( \"additionalTagsWithAttributes\", new SafeHtml.Tag[] { tag } );\n-\n-\t\tassertTrue(\n-\t\t\t\tgetSafeHtmlValidator().isValid( \"<div class='foo'>test</div>\", null ),\n-\t\t\t\t\"class attribute should be white listed\"\n-\t\t);\n-\t\tassertFalse(\n-\t\t\t\tgetSafeHtmlValidator().isValid( \"<div style='foo'>test</div>\", null ),\n-\t\t\t\t\"style attribute is not white listed\"\n-\t\t);\n-\t}\n-\n-\t@Test\n-\t@TestForIssue(jiraKey = \"HV-817\")\n-\tpublic void testDivWithWhiteListedStyleAttribute() throws Exception {\n-\t\tValidator validator = getValidator();\n-\t\tSet<ConstraintViolation<Foo>> constraintViolations = validator.validate( new Foo( \"<div style='foo'>test</div>\" ) );\n-\t\tassertNoViolations( constraintViolations );\n-\n-\t\t// the attributes are optional - allowing <div class> also allows just <div>\n-\t\tconstraintViolations = validator.validate( new Foo( \"<div>test</div>\" ) );\n-\t\tassertNoViolations( constraintViolations );\n-\n-\t\tconstraintViolations = validator.validate( new Foo( \"<div class='foo'>test</div>\" ) );\n-\t\tassertThat( constraintViolations ).containsOnlyViolations(\n-\t\t\t\tviolationOf( SafeHtml.class )\n-\t\t);\n-\t}\n-\n-\t@Test\n-\t@TestForIssue(jiraKey = \"HV-873\")\n-\tpublic void testValidationOfInvalidFragment() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.NONE );\n-\n-\t\tassertFalse( getSafeHtmlValidator().isValid( \"<td>1234qwer</td>\", null ) );\n-\t}\n-\n-\t@Test\n-\t@TestForIssue(jiraKey = \"HV-873\")\n-\tpublic void testValidationOfValidFragment() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.RELAXED );\n-\n-\t\tassertTrue( getSafeHtmlValidator().isValid( \"<td>1234qwer</td>\", null ) );\n-\t}\n-\n-\t@Test\n-\t@TestForIssue(jiraKey = \"HV-873\")\n-\tpublic void testValidationOfTextFragment() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.NONE );\n-\n-\t\tassertTrue( getSafeHtmlValidator().isValid( \"Foobar\", null ) );\n-\t}\n-\n-\t@Test\n-\t@TestForIssue(jiraKey = \"HV-1302\")\n-\tpublic void testAdditionalProtocols() {\n-\t\tValidator validator = getValidator();\n-\n-\t\tassertNoViolations( validator.validate( new Bar( \"<img src='data:image/png;base64,100101' />\" ) ) );\n-\t\tassertNoViolations( validator.validate( new Bar( \"<img/>\" ) ) );\n-\t\tassertThat( validator.validate( new Bar( \"<img src='not_data:image/png;base64,100101' />\" ) ) )\n-\t\t\t\t.containsOnlyViolations(\n-\t\t\t\t\t\tviolationOf( SafeHtml.class )\n-\t\t\t\t);\n-\t\tassertThat( validator.validate( new Bar( \"<img not_src='data:image/png;base64,100101' />\" ) ) )\n-\t\t\t\t.containsOnlyViolations(\n-\t\t\t\t\t\tviolationOf( SafeHtml.class )\n-\t\t\t\t);\n-\t\tassertThat( validator.validate( new Bar( \"<div src='data:image/png;base64,100101' />\" ) ) )\n-\t\t\t\t.containsOnlyViolations(\n-\t\t\t\t\t\tviolationOf( SafeHtml.class )\n-\t\t\t\t);\n-\t\tassertThat( validator.validate( new Bar( \"<div src='data:image/png;base64,100101' />\" ) ) )\n-\t\t\t\t.containsOnlyViolations(\n-\t\t\t\t\t\tviolationOf( SafeHtml.class )\n-\t\t\t\t);\n-\t\tassertNoViolations( validator.validate( new Bar(\n-\t\t\t\t\"<custom>\" +\n-\t\t\t\t\t\t\"  <img src='data:image/png;base64,100101' />\" +\n-\t\t\t\t\t\t\"  <custom attr1='strange_protocol:some_text' />\" +\n-\t\t\t\t\t\t\"  <custom attr3='some_protocol:some_text' />\" +\n-\t\t\t\t\t\t\"  <custom><img /></custom>\" +\n-\t\t\t\t\t\t\"  <section id='sec1' attr='val'></section>\" +\n-\t\t\t\t\t\t\"  <custom attr1='dataprotocol:some_text' attr2='strange_protocol:some_text' />\" +\n-\t\t\t\t\t\t\"</custom>\" ) ) );\n-\t\tassertThat( validator.validate( new Bar(\n-\t\t\t\t\"<div>\" +\n-\t\t\t\t\t\t\"<img src='not_data:image/png;base64,100101' />\" +\n-\t\t\t\t\t\t\"<custom attr1='strange_protocol:some_text' />\" +\n-\t\t\t\t\t\t\"/<div>\"\n-\t\t) ) ).containsOnlyViolations(\n-\t\t\t\tviolationOf( SafeHtml.class )\n-\t\t);\n-\t}\n-\n-\t@Test\n-\t@TestForIssue(jiraKey = \"HV-1303\")\n-\tpublic void testPreserveRelativeLinks() throws Exception {\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.RELAXED );\n-\t\tdescriptorBuilder.setAttribute( \"baseURI\", \"http://127.0.0.1\" );\n-\n-\t\tassertTrue( getSafeHtmlValidator().isValid( \"<img src='/some/relative/url/image.png' />\", null ) );\n-\n-\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.RELAXED );\n-\t\tdescriptorBuilder.setAttribute( \"baseURI\", \"\" );\n-\n-\t\tassertFalse( getSafeHtmlValidator().isValid( \"<img src='/some/relative/url/image.png' />\", null ) );\n-\t}\n-\n-\tprivate SafeHtmlValidator getSafeHtmlValidator() {\n-\t\tSafeHtml p = descriptorBuilder.build().getAnnotation();\n-\t\tSafeHtmlValidator validator = new SafeHtmlValidator();\n-\t\tvalidator.initialize( p );\n-\t\treturn validator;\n-\t}\n-\n-\tpublic static class Foo {\n-\t\t@SafeHtml(\n-\t\t\t\twhitelistType = WhiteListType.BASIC,\n-\t\t\t\tadditionalTagsWithAttributes = @SafeHtml.Tag(name = \"div\", attributes = { \"style\" })\n-\t\t)\n-\t\tString source;\n-\n-\t\tpublic Foo(String source) {\n-\t\t\tthis.source = source;\n-\t\t}\n-\t}\n-\n-\tpublic static class Bar {\n-\t\t@SafeHtml(\n-\t\t\t\twhitelistType = WhiteListType.BASIC,\n-\t\t\t\tadditionalTagsWithAttributes = {\n-\t\t\t\t\t\t@SafeHtml.Tag(name = \"img\", attributesWithProtocols = @SafeHtml.Attribute(name = \"src\", protocols = { \"data\" })),\n-\t\t\t\t\t\t@SafeHtml.Tag(name = \"custom\", attributesWithProtocols = {\n-\t\t\t\t\t\t\t\t@SafeHtml.Attribute(name = \"attr1\", protocols = { \"dataprotocol\", \"strange_protocol\" }),\n-\t\t\t\t\t\t\t\t@SafeHtml.Attribute(name = \"attr2\", protocols = { \"dataprotocol\", \"strange_protocol\" }),\n-\t\t\t\t\t\t\t\t@SafeHtml.Attribute(name = \"attr3\", protocols = \"some_protocol\")\n-\t\t\t\t\t\t}),\n-\t\t\t\t\t\t@SafeHtml.Tag(name = \"section\", attributes = { \"attr\", \"id\" })\n-\t\t\t\t}\n-\t\t)\n-\t\tString source;\n-\n-\t\tpublic Bar(String source) {\n-\t\t\tthis.source = source;\n-\t\t}\n-\t}\n-}"
            },
            {
                "sha": "1e170f3d5a3372ecc2d7e56f12cd53eb89dcb634",
                "filename": "integration/pom.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 5,
                "changes": 5,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/integration%2Fpom.xml",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/integration%2Fpom.xml",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/integration%2Fpom.xml?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -62,11 +62,6 @@\n             <artifactId>joda-time</artifactId>\n             <scope>test</scope>\n         </dependency>\n-        <dependency>\n-            <groupId>org.jsoup</groupId>\n-            <artifactId>jsoup</artifactId>\n-            <scope>test</scope>\n-        </dependency>\n         <dependency>\n             <groupId>javax.money</groupId>\n             <artifactId>money-api</artifactId>"
            },
            {
                "sha": "ab6d7246d5dca406a46579e08a03b43057f1627a",
                "filename": "integration/src/test/java/org/hibernate/validator/integration/wildfly/OptionalConstraintsIT.java",
                "status": "modified",
                "additions": 1,
                "deletions": 16,
                "changes": 17,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/integration%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fintegration%2Fwildfly%2FOptionalConstraintsIT.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/integration%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fintegration%2Fwildfly%2FOptionalConstraintsIT.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/integration%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fintegration%2Fwildfly%2FOptionalConstraintsIT.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -18,7 +18,6 @@\n import javax.validation.constraints.Future;\n \n import org.hibernate.validator.constraints.Currency;\n-import org.hibernate.validator.constraints.SafeHtml;\n import org.hibernate.validator.integration.AbstractArquillianIT;\n import org.javamoney.moneta.Money;\n import org.jboss.arquillian.container.test.api.Deployment;\n@@ -28,7 +27,7 @@\n import org.testng.annotations.Test;\n \n /**\n- * Asserts that the constraints based on the JodaTime and JSoup server modules can be used.\n+ * Asserts that the constraints based on the JodaTime and Javax Money server modules can be used.\n  *\n  * @author Gunnar Morling\n  * @author Guillaume Smet\n@@ -57,14 +56,6 @@ public void canUseJodaTimeConstraintValidator() {\n \t\tassertThat( violations.iterator().next().getConstraintDescriptor().getAnnotation().annotationType() ).isEqualTo( Future.class );\n \t}\n \n-\t@Test\n-\tpublic void canUseJsoupBasedConstraint() {\n-\t\tSet<ConstraintViolation<Item>> violations = validator.validate( new Item() );\n-\n-\t\tassertThat( violations.size() ).isEqualTo( 1 );\n-\t\tassertThat( violations.iterator().next().getConstraintDescriptor().getAnnotation().annotationType() ).isEqualTo( SafeHtml.class );\n-\t}\n-\n \t@Test\n \tpublic void canUseJavaMoneyBasedConstraint() {\n \t\tSet<ConstraintViolation<Order>> violations = validator.validate( new Order( Money.of( 1200.0, \"EUR\" ) ) );\n@@ -84,12 +75,6 @@ private static class Shipment {\n \t\tpublic DateTime deliveryDate = new DateTime( 2014, 10, 21, 0, 0, 0, 0 );\n \t}\n \n-\tprivate static class Item {\n-\n-\t\t@SafeHtml\n-\t\tpublic String descriptionHtml = \"<script>Cross-site scripting https://en.wikipedia.org/wiki/42<script/>\";\n-\t}\n-\n \tprivate static class Order {\n \n \t\t@DecimalMax(\"1000\")"
            },
            {
                "sha": "2fba3b2e68d14fa93f49faecbbdd57777f8aa538",
                "filename": "osgi/integrationtest/src/test/java/org/hibernate/validator/osgi/integrationtest/KarafFeaturesAreInstallableTest.java",
                "status": "modified",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/osgi%2Fintegrationtest%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fosgi%2Fintegrationtest%2FKarafFeaturesAreInstallableTest.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/osgi%2Fintegrationtest%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fosgi%2Fintegrationtest%2FKarafFeaturesAreInstallableTest.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/osgi%2Fintegrationtest%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fosgi%2Fintegrationtest%2FKarafFeaturesAreInstallableTest.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -135,12 +135,6 @@ public void canInstallFeatureHibernateValidator() throws Exception {\n \t\tcanInstallFeature( \"hibernate-validator\" );\n \t}\n \n-\t@Test\n-\tpublic void canInstallFeatureHibernateValidatorJsoup() throws Exception {\n-\t\tfeaturesService.addRepository( new URI( System.getProperty( \"validatorRepositoryUrl\" ) ) );\n-\t\tcanInstallFeature( \"hibernate-validator-jsoup\" );\n-\t}\n-\n \t@Test\n \tpublic void canInstallFeatureHibernateValidatorJodaTime() throws Exception {\n \t\tfeaturesService.addRepository( new URI( System.getProperty( \"validatorRepositoryUrl\" ) ) );"
            },
            {
                "sha": "b4ee9443ea5345335864bd140c8f15f3731f3e17",
                "filename": "osgi/integrationtest/src/test/java/org/hibernate/validator/osgi/integrationtest/OsgiIntegrationTest.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/osgi%2Fintegrationtest%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fosgi%2Fintegrationtest%2FOsgiIntegrationTest.java",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/osgi%2Fintegrationtest%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fosgi%2Fintegrationtest%2FOsgiIntegrationTest.java",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/osgi%2Fintegrationtest%2Fsrc%2Ftest%2Fjava%2Forg%2Fhibernate%2Fvalidator%2Fosgi%2Fintegrationtest%2FOsgiIntegrationTest.java?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -143,7 +143,7 @@ public Option[] config() {\n \t\t\t\t\t\t\"org.ops4j.pax.url.mvn.repositories\",\n \t\t\t\t\t\tmavenCentralRepository + \"@id=central\"\n \t\t\t\t),\n-\t\t\t\tfeatures( hibernateValidatorFeature, \"hibernate-validator\", \"hibernate-validator-jsoup\", \"hibernate-validator-joda-time\",\n+\t\t\t\tfeatures( hibernateValidatorFeature, \"hibernate-validator\", \"hibernate-validator-joda-time\",\n \t\t\t\t\t\t\"hibernate-validator-javax-money\", \"hibernate-validator-groovy\" )\n \t\t);\n \t}"
            },
            {
                "sha": "9b5f4cc037e36ac602f97df449f637e66c596f1e",
                "filename": "osgi/karaf-features/src/main/features/features.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 4,
                "changes": 4,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/osgi%2Fkaraf-features%2Fsrc%2Fmain%2Ffeatures%2Ffeatures.xml",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/osgi%2Fkaraf-features%2Fsrc%2Fmain%2Ffeatures%2Ffeatures.xml",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/osgi%2Fkaraf-features%2Fsrc%2Fmain%2Ffeatures%2Ffeatures.xml?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -18,10 +18,6 @@\n         <bundle>mvn:com.fasterxml/classmate/${version.com.fasterxml.classmate}</bundle>\n         <bundle>mvn:org.glassfish/jakarta.el/${version.org.glassfish.jakarta.el}</bundle>\n     </feature>\n-    <feature name=\"hibernate-validator-jsoup\" version=\"${project.version}\">\n-        <feature>hibernate-validator</feature>\n-        <bundle>mvn:org.jsoup/jsoup/${version.jsoup}</bundle>\n-    </feature>\n     <feature name=\"hibernate-validator-joda-time\" version=\"${project.version}\">\n         <feature>hibernate-validator</feature>\n         <bundle>mvn:joda-time/joda-time/${version.joda-time}</bundle>"
            },
            {
                "sha": "bbfeb54cf35374949571562cdab7626d9ca6fdbe",
                "filename": "pom.xml",
                "status": "modified",
                "additions": 0,
                "deletions": 6,
                "changes": 6,
                "blob_url": "https://github.com/hibernate/hibernate-validator/blob/55a24f3368bda1e590b7a2ffe31575e46398f988/pom.xml",
                "raw_url": "https://github.com/hibernate/hibernate-validator/raw/55a24f3368bda1e590b7a2ffe31575e46398f988/pom.xml",
                "contents_url": "https://api.github.com/repos/hibernate/hibernate-validator/contents/pom.xml?ref=55a24f3368bda1e590b7a2ffe31575e46398f988",
                "patch": "@@ -133,7 +133,6 @@\n             See http://search.maven.org/#search|gav|1|g%3A\"org.wildfly\"%20AND%20a%3A\"wildfly-parent\"\n         -->\n         <version.com.fasterxml.classmate>1.3.4</version.com.fasterxml.classmate>\n-        <version.jsoup>1.8.3</version.jsoup>\n         <version.joda-time>2.9.7</version.joda-time>\n         <version.org.slf4j>1.7.22</version.org.slf4j>\n         <version.org.apache.logging.log4j>2.13.3</version.org.apache.logging.log4j>\n@@ -397,11 +396,6 @@\n                 <artifactId>org.osgi.core</artifactId>\n                 <version>${version.org.osgi.core}</version>\n             </dependency>\n-            <dependency>\n-                <groupId>org.jsoup</groupId>\n-                <artifactId>jsoup</artifactId>\n-                <version>${version.jsoup}</version>\n-            </dependency>\n             <dependency>\n                 <groupId>org.apache.logging.log4j</groupId>\n                 <artifactId>log4j-core</artifactId>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/apache/zookeeper/commits/2c2b74c1c11b6531aabb1bf06782e859048d5983",
        "url": "https://api.github.com/repos/apache/zookeeper/commits/2c2b74c1c11b6531aabb1bf06782e859048d5983",
        "html_url": "https://github.com/apache/zookeeper/commit/2c2b74c1c11b6531aabb1bf06782e859048d5983",
        "message": "ZOOKEEPER-4851: Honor X-Forwarded-For optionally in IPAuthenticationProvider\n\nReviewers: kezhuw, purushah\nAuthor: anmolnar\nCloses #2181 from anmolnar/ZOOKEEPER-4851",
        "files": [
            {
                "sha": "4096a1fdecfe9ee2978cee5fa87e1921fdba5172",
                "filename": "zookeeper-docs/src/main/resources/markdown/zookeeperAdmin.md",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/apache/zookeeper/blob/2c2b74c1c11b6531aabb1bf06782e859048d5983/zookeeper-docs%2Fsrc%2Fmain%2Fresources%2Fmarkdown%2FzookeeperAdmin.md",
                "raw_url": "https://github.com/apache/zookeeper/raw/2c2b74c1c11b6531aabb1bf06782e859048d5983/zookeeper-docs%2Fsrc%2Fmain%2Fresources%2Fmarkdown%2FzookeeperAdmin.md",
                "contents_url": "https://api.github.com/repos/apache/zookeeper/contents/zookeeper-docs%2Fsrc%2Fmain%2Fresources%2Fmarkdown%2FzookeeperAdmin.md?ref=2c2b74c1c11b6531aabb1bf06782e859048d5983",
                "patch": "@@ -1572,6 +1572,16 @@ and [SASL authentication for ZooKeeper](https://cwiki.apache.org/confluence/disp\n         - 1. Regenerate `superDigest` when migrating to new algorithm.\n         - 2. `SetAcl` for a znode which already had a digest auth of old algorithm.\n \n+* *IPAuthenticationProvider.skipxforwardedfor* :\n+    (Java system property: **zookeeper.IPAuthenticationProvider.skipxforwardedfor**)\n+    **New in 3.9.3:**\n+    IPAuthenticationProvider needs the client IP address to authenticate the user.\n+    By default, it tries to read **X-Forwarded-For** HTTP header first and if it's not\n+    found, reads the **Host** header. Some proxy configuration requires this to\n+    properly identify the client IP, but we can disable it relying only on the **Host**\n+    header by setting this config option to **true**.\n+    Default value is **false**.\n+\n * *X509AuthenticationProvider.superUser* :\n     (Java system property: **zookeeper.X509AuthenticationProvider.superUser**)\n     The SSL-backed way to enable a ZooKeeper ensemble"
            },
            {
                "sha": "c73d12f78c2c5093832fa4f4b6d39f2507a5bf92",
                "filename": "zookeeper-server/src/main/java/org/apache/zookeeper/server/auth/IPAuthenticationProvider.java",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/apache/zookeeper/blob/2c2b74c1c11b6531aabb1bf06782e859048d5983/zookeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fzookeeper%2Fserver%2Fauth%2FIPAuthenticationProvider.java",
                "raw_url": "https://github.com/apache/zookeeper/raw/2c2b74c1c11b6531aabb1bf06782e859048d5983/zookeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fzookeeper%2Fserver%2Fauth%2FIPAuthenticationProvider.java",
                "contents_url": "https://api.github.com/repos/apache/zookeeper/contents/zookeeper-server%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fzookeeper%2Fserver%2Fauth%2FIPAuthenticationProvider.java?ref=2c2b74c1c11b6531aabb1bf06782e859048d5983",
                "patch": "@@ -30,6 +30,8 @@\n public class IPAuthenticationProvider implements AuthenticationProvider {\n     public static final String X_FORWARDED_FOR_HEADER_NAME = \"X-Forwarded-For\";\n \n+    static final String SKIP_X_FORWARDED_FOR_KEY = \"zookeeper.IPAuthenticationProvider.skipxforwardedfor\";\n+\n     public String getScheme() {\n         return \"ip\";\n     }\n@@ -150,6 +152,10 @@ public boolean isValid(String id) {\n      * @return IP address\n      */\n     public static String getClientIPAddress(final HttpServletRequest request) {\n+        if (Boolean.getBoolean(SKIP_X_FORWARDED_FOR_KEY)) {\n+            return request.getRemoteAddr();\n+        }\n+\n         // to handle the case that a HTTP(s) client connects via a proxy or load balancer\n         final String xForwardedForHeader = request.getHeader(X_FORWARDED_FOR_HEADER_NAME);\n         if (xForwardedForHeader == null) {"
            },
            {
                "sha": "fc814f7ea5bbec2a1dad6385e36f41a5d2a38139",
                "filename": "zookeeper-server/src/test/java/org/apache/zookeeper/server/auth/IPAuthenticationProviderTest.java",
                "status": "added",
                "additions": 85,
                "deletions": 0,
                "changes": 85,
                "blob_url": "https://github.com/apache/zookeeper/blob/2c2b74c1c11b6531aabb1bf06782e859048d5983/zookeeper-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fzookeeper%2Fserver%2Fauth%2FIPAuthenticationProviderTest.java",
                "raw_url": "https://github.com/apache/zookeeper/raw/2c2b74c1c11b6531aabb1bf06782e859048d5983/zookeeper-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fzookeeper%2Fserver%2Fauth%2FIPAuthenticationProviderTest.java",
                "contents_url": "https://api.github.com/repos/apache/zookeeper/contents/zookeeper-server%2Fsrc%2Ftest%2Fjava%2Forg%2Fapache%2Fzookeeper%2Fserver%2Fauth%2FIPAuthenticationProviderTest.java?ref=2c2b74c1c11b6531aabb1bf06782e859048d5983",
                "patch": "@@ -0,0 +1,85 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.zookeeper.server.auth;\n+\n+import static org.apache.zookeeper.server.auth.IPAuthenticationProvider.SKIP_X_FORWARDED_FOR_KEY;\n+import static org.apache.zookeeper.server.auth.IPAuthenticationProvider.X_FORWARDED_FOR_HEADER_NAME;\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.mock;\n+import javax.servlet.http.HttpServletRequest;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class IPAuthenticationProviderTest {\n+\n+  private HttpServletRequest request;\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    System.clearProperty(SKIP_X_FORWARDED_FOR_KEY);\n+    request = mock(HttpServletRequest.class);\n+  }\n+\n+  @After\n+  public void tearDown() {\n+    System.clearProperty(SKIP_X_FORWARDED_FOR_KEY);\n+  }\n+\n+  @Test\n+  public void testGetClientIPAddressSkipXForwardedFor() {\n+    // Arrange\n+    System.setProperty(SKIP_X_FORWARDED_FOR_KEY, \"true\");\n+    doReturn(\"192.168.1.1\").when(request).getRemoteAddr();\n+    doReturn(\"192.168.1.2,192.168.1.3,192.168.1.4\").when(request).getHeader(X_FORWARDED_FOR_HEADER_NAME);\n+\n+    // Act\n+    String clientIp = IPAuthenticationProvider.getClientIPAddress(request);\n+\n+    // Assert\n+    assertEquals(\"192.168.1.1\", clientIp);\n+  }\n+\n+  @Test\n+  public void testGetClientIPAddressWithXForwardedFor() {\n+    // Arrange\n+    System.setProperty(SKIP_X_FORWARDED_FOR_KEY, \"false\");\n+    doReturn(\"192.168.1.1\").when(request).getRemoteAddr();\n+    doReturn(\"192.168.1.2,192.168.1.3,192.168.1.4\").when(request).getHeader(X_FORWARDED_FOR_HEADER_NAME);\n+\n+    // Act\n+    String clientIp = IPAuthenticationProvider.getClientIPAddress(request);\n+\n+    // Assert\n+    assertEquals(\"192.168.1.2\", clientIp);\n+  }\n+\n+  @Test\n+  public void testGetClientIPAddressMissingXForwardedFor() {\n+    // Arrange\n+    System.setProperty(SKIP_X_FORWARDED_FOR_KEY, \"false\");\n+    doReturn(\"192.168.1.1\").when(request).getRemoteAddr();\n+\n+    // Act\n+    String clientIp = IPAuthenticationProvider.getClientIPAddress(request);\n+\n+    // Assert\n+    assertEquals(\"192.168.1.1\", clientIp);\n+  }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/symfony/symfony/commits/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa",
        "url": "https://api.github.com/repos/symfony/symfony/commits/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa",
        "html_url": "https://github.com/symfony/symfony/commit/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa",
        "message": "Do not read from argv on non-CLI SAPIs",
        "files": [
            {
                "sha": "5612b3e5708722c8ba1df4d4fdc9b85b0eb55b6c",
                "filename": "src/Symfony/Component/Runtime/SymfonyRuntime.php",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/symfony/symfony/blob/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa/src%2FSymfony%2FComponent%2FRuntime%2FSymfonyRuntime.php",
                "raw_url": "https://github.com/symfony/symfony/raw/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa/src%2FSymfony%2FComponent%2FRuntime%2FSymfonyRuntime.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FRuntime%2FSymfonyRuntime.php?ref=a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa",
                "patch": "@@ -95,7 +95,7 @@ public function __construct(array $options = [])\n \n         if (isset($options['env'])) {\n             $_SERVER[$envKey] = $options['env'];\n-        } elseif (isset($_SERVER['argv']) && class_exists(ArgvInput::class)) {\n+        } elseif (empty($_GET) && isset($_SERVER['argv']) && class_exists(ArgvInput::class)) {\n             $this->options = $options;\n             $this->getInput();\n         }\n@@ -216,6 +216,10 @@ protected static function register(GenericRuntime $runtime): GenericRuntime\n \n     private function getInput(): ArgvInput\n     {\n+        if (!empty($_GET) && filter_var(ini_get('register_argc_argv'), \\FILTER_VALIDATE_BOOL)) {\n+            throw new \\Exception('CLI applications cannot be run safely on non-CLI SAPIs with register_argc_argv=On.');\n+        }\n+\n         if (null !== $this->input) {\n             return $this->input;\n         }"
            },
            {
                "sha": "b7c43c5c8b64a8fe44e30da63597657ef29cfef6",
                "filename": "src/Symfony/Component/Runtime/Tests/phpt/kernel.php",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/symfony/symfony/blob/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa/src%2FSymfony%2FComponent%2FRuntime%2FTests%2Fphpt%2Fkernel.php",
                "raw_url": "https://github.com/symfony/symfony/raw/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa/src%2FSymfony%2FComponent%2FRuntime%2FTests%2Fphpt%2Fkernel.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FRuntime%2FTests%2Fphpt%2Fkernel.php?ref=a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa",
                "patch": "@@ -17,19 +17,21 @@\n \n class TestKernel implements HttpKernelInterface\n {\n+    private $env;\n     private $var;\n \n-    public function __construct(string $var)\n+    public function __construct(string $env, string $var)\n     {\n+        $this->env = $env;\n         $this->var = $var;\n     }\n \n     public function handle(Request $request, $type = self::MASTER_REQUEST, $catch = true): Response\n     {\n-        return new Response('OK Kernel '.$this->var);\n+        return new Response('OK Kernel (env='.$this->env.') '.$this->var);\n     }\n }\n \n return function (array $context) {\n-    return new TestKernel($context['SOME_VAR']);\n+    return new TestKernel($context['APP_ENV'], $context['SOME_VAR']);\n };"
            },
            {
                "sha": "e7df91e75089bc2a7f5b979939756cf11f8fed0e",
                "filename": "src/Symfony/Component/Runtime/Tests/phpt/kernel.phpt",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/symfony/symfony/blob/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa/src%2FSymfony%2FComponent%2FRuntime%2FTests%2Fphpt%2Fkernel.phpt",
                "raw_url": "https://github.com/symfony/symfony/raw/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa/src%2FSymfony%2FComponent%2FRuntime%2FTests%2Fphpt%2Fkernel.phpt",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FRuntime%2FTests%2Fphpt%2Fkernel.phpt?ref=a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa",
                "patch": "@@ -9,4 +9,4 @@ require $_SERVER['SCRIPT_FILENAME'] = __DIR__.'/kernel.php';\n \n ?>\n --EXPECTF--\n-OK Kernel foo_bar\n+OK Kernel (env=dev) foo_bar"
            },
            {
                "sha": "4da82d2ac6408d36ed76044981f1f51976e47590",
                "filename": "src/Symfony/Component/Runtime/Tests/phpt/kernel_register_argc_argv.phpt",
                "status": "added",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/symfony/symfony/blob/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa/src%2FSymfony%2FComponent%2FRuntime%2FTests%2Fphpt%2Fkernel_register_argc_argv.phpt",
                "raw_url": "https://github.com/symfony/symfony/raw/a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa/src%2FSymfony%2FComponent%2FRuntime%2FTests%2Fphpt%2Fkernel_register_argc_argv.phpt",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FRuntime%2FTests%2Fphpt%2Fkernel_register_argc_argv.phpt?ref=a77b308c3f179ed7c8a8bc295f82b2d6ee3493fa",
                "patch": "@@ -0,0 +1,18 @@\n+--TEST--\n+Test HttpKernelInterface with register_argc_argv=1\n+--INI--\n+display_errors=1\n+register_argc_argv=1\n+--FILE--\n+<?php\n+\n+// emulating PHP behavior with register_argc_argv=1\n+$_GET['-e_test'] = '';\n+$_SERVER['argc'] = 1;\n+$_SERVER['argv'] = [' ', '-e', 'test'];\n+\n+require $_SERVER['SCRIPT_FILENAME'] = __DIR__.'/kernel.php';\n+\n+?>\n+--EXPECTF--\n+OK Kernel (env=dev) foo_bar"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/symfony/symfony/commits/7d1032bbead9a4229b32fa6ebca32681c80cb76f",
        "url": "https://api.github.com/repos/symfony/symfony/commits/7d1032bbead9a4229b32fa6ebca32681c80cb76f",
        "html_url": "https://github.com/symfony/symfony/commit/7d1032bbead9a4229b32fa6ebca32681c80cb76f",
        "message": "[Validator] Add `D` regex modifier in relevant validators",
        "files": [
            {
                "sha": "9425e9b4f5a990424096f3c519f820310d1bb4e3",
                "filename": "src/Symfony/Component/Validator/Constraints/CardSchemeValidator.php",
                "status": "modified",
                "additions": 19,
                "deletions": 19,
                "changes": 38,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FCardSchemeValidator.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FCardSchemeValidator.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FCardSchemeValidator.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -29,65 +29,65 @@ class CardSchemeValidator extends ConstraintValidator\n     protected $schemes = [\n         // American Express card numbers start with 34 or 37 and have 15 digits.\n         CardScheme::AMEX => [\n-            '/^3[47][0-9]{13}$/',\n+            '/^3[47][0-9]{13}$/D',\n         ],\n         // China UnionPay cards start with 62 and have between 16 and 19 digits.\n         // Please note that these cards do not follow Luhn Algorithm as a checksum.\n         CardScheme::CHINA_UNIONPAY => [\n-            '/^62[0-9]{14,17}$/',\n+            '/^62[0-9]{14,17}$/D',\n         ],\n         // Diners Club card numbers begin with 300 through 305, 36 or 38. All have 14 digits.\n         // There are Diners Club cards that begin with 5 and have 16 digits.\n         // These are a joint venture between Diners Club and MasterCard, and should be processed like a MasterCard.\n         CardScheme::DINERS => [\n-            '/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/',\n+            '/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/D',\n         ],\n         // Discover card numbers begin with 6011, 622126 through 622925, 644 through 649 or 65.\n         // All have 16 digits.\n         CardScheme::DISCOVER => [\n-            '/^6011[0-9]{12}$/',\n-            '/^64[4-9][0-9]{13}$/',\n-            '/^65[0-9]{14}$/',\n-            '/^622(12[6-9]|1[3-9][0-9]|[2-8][0-9][0-9]|91[0-9]|92[0-5])[0-9]{10}$/',\n+            '/^6011[0-9]{12}$/D',\n+            '/^64[4-9][0-9]{13}$/D',\n+            '/^65[0-9]{14}$/D',\n+            '/^622(12[6-9]|1[3-9][0-9]|[2-8][0-9][0-9]|91[0-9]|92[0-5])[0-9]{10}$/D',\n         ],\n         // InstaPayment cards begin with 637 through 639 and have 16 digits.\n         CardScheme::INSTAPAYMENT => [\n-            '/^63[7-9][0-9]{13}$/',\n+            '/^63[7-9][0-9]{13}$/D',\n         ],\n         // JCB cards beginning with 2131 or 1800 have 15 digits.\n         // JCB cards beginning with 35 have 16 digits.\n         CardScheme::JCB => [\n-            '/^(?:2131|1800|35[0-9]{3})[0-9]{11}$/',\n+            '/^(?:2131|1800|35[0-9]{3})[0-9]{11}$/D',\n         ],\n         // Laser cards begin with either 6304, 6706, 6709 or 6771 and have between 16 and 19 digits.\n         CardScheme::LASER => [\n-            '/^(6304|670[69]|6771)[0-9]{12,15}$/',\n+            '/^(6304|670[69]|6771)[0-9]{12,15}$/D',\n         ],\n         // Maestro international cards begin with 675900..675999 and have between 12 and 19 digits.\n         // Maestro UK cards begin with either 500000..509999 or 560000..699999 and have between 12 and 19 digits.\n         CardScheme::MAESTRO => [\n-            '/^(6759[0-9]{2})[0-9]{6,13}$/',\n-            '/^(50[0-9]{4})[0-9]{6,13}$/',\n-            '/^5[6-9][0-9]{10,17}$/',\n-            '/^6[0-9]{11,18}$/',\n+            '/^(6759[0-9]{2})[0-9]{6,13}$/D',\n+            '/^(50[0-9]{4})[0-9]{6,13}$/D',\n+            '/^5[6-9][0-9]{10,17}$/D',\n+            '/^6[0-9]{11,18}$/D',\n         ],\n         // All MasterCard numbers start with the numbers 51 through 55. All have 16 digits.\n         // October 2016 MasterCard numbers can also start with 222100 through 272099.\n         CardScheme::MASTERCARD => [\n-            '/^5[1-5][0-9]{14}$/',\n-            '/^2(22[1-9][0-9]{12}|2[3-9][0-9]{13}|[3-6][0-9]{14}|7[0-1][0-9]{13}|720[0-9]{12})$/',\n+            '/^5[1-5][0-9]{14}$/D',\n+            '/^2(22[1-9][0-9]{12}|2[3-9][0-9]{13}|[3-6][0-9]{14}|7[0-1][0-9]{13}|720[0-9]{12})$/D',\n         ],\n         // Payment system MIR numbers start with 220, then 1 digit from 0 to 4, then between 12 and 15 digits\n         CardScheme::MIR => [\n-            '/^220[0-4][0-9]{12,15}$/',\n+            '/^220[0-4][0-9]{12,15}$/D',\n         ],\n         // All UATP card numbers start with a 1 and have a length of 15 digits.\n         CardScheme::UATP => [\n-            '/^1[0-9]{14}$/',\n+            '/^1[0-9]{14}$/D',\n         ],\n         // All Visa card numbers start with a 4 and have a length of 13, 16, or 19 digits.\n         CardScheme::VISA => [\n-            '/^4([0-9]{12}|[0-9]{15}|[0-9]{18})$/',\n+            '/^4([0-9]{12}|[0-9]{15}|[0-9]{18})$/D',\n         ],\n     ];\n "
            },
            {
                "sha": "be377d83f4cf9ad17ab533f45fc439b633ec5544",
                "filename": "src/Symfony/Component/Validator/Constraints/CssColorValidator.php",
                "status": "modified",
                "additions": 12,
                "deletions": 12,
                "changes": 24,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FCssColorValidator.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FCssColorValidator.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FCssColorValidator.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -21,21 +21,21 @@\n  */\n class CssColorValidator extends ConstraintValidator\n {\n-    private const PATTERN_HEX_LONG = '/^#[0-9a-f]{6}$/i';\n-    private const PATTERN_HEX_LONG_WITH_ALPHA = '/^#[0-9a-f]{8}$/i';\n-    private const PATTERN_HEX_SHORT = '/^#[0-9a-f]{3}$/i';\n-    private const PATTERN_HEX_SHORT_WITH_ALPHA = '/^#[0-9a-f]{4}$/i';\n+    private const PATTERN_HEX_LONG = '/^#[0-9a-f]{6}$/iD';\n+    private const PATTERN_HEX_LONG_WITH_ALPHA = '/^#[0-9a-f]{8}$/iD';\n+    private const PATTERN_HEX_SHORT = '/^#[0-9a-f]{3}$/iD';\n+    private const PATTERN_HEX_SHORT_WITH_ALPHA = '/^#[0-9a-f]{4}$/iD';\n     // List comes from https://www.w3.org/wiki/CSS/Properties/color/keywords#Basic_Colors\n-    private const PATTERN_BASIC_NAMED_COLORS = '/^(black|silver|gray|white|maroon|red|purple|fuchsia|green|lime|olive|yellow|navy|blue|teal|aqua)$/i';\n+    private const PATTERN_BASIC_NAMED_COLORS = '/^(black|silver|gray|white|maroon|red|purple|fuchsia|green|lime|olive|yellow|navy|blue|teal|aqua)$/iD';\n     // List comes from https://www.w3.org/wiki/CSS/Properties/color/keywords#Extended_colors\n-    private const PATTERN_EXTENDED_NAMED_COLORS = '/^(aliceblue|antiquewhite|aqua|aquamarine|azure|beige|bisque|black|blanchedalmond|blue|blueviolet|brown|burlywood|cadetblue|chartreuse|chocolate|coral|cornflowerblue|cornsilk|crimson|cyan|darkblue|darkcyan|darkgoldenrod|darkgray|darkgreen|darkgrey|darkkhaki|darkmagenta|darkolivegreen|darkorange|darkorchid|darkred|darksalmon|darkseagreen|darkslateblue|darkslategray|darkslategrey|darkturquoise|darkviolet|deeppink|deepskyblue|dimgray|dimgrey|dodgerblue|firebrick|floralwhite|forestgreen|fuchsia|gainsboro|ghostwhite|gold|goldenrod|gray|green|greenyellow|grey|honeydew|hotpink|indianred|indigo|ivory|khaki|lavender|lavenderblush|lawngreen|lemonchiffon|lightblue|lightcoral|lightcyan|lightgoldenrodyellow|lightgray|lightgreen|lightgrey|lightpink|lightsalmon|lightseagreen|lightskyblue|lightslategray|lightslategrey|lightsteelblue|lightyellow|lime|limegreen|linen|magenta|maroon|mediumaquamarine|mediumblue|mediumorchid|mediumpurple|mediumseagreen|mediumslateblue|mediumspringgreen|mediumturquoise|mediumvioletred|midnightblue|mintcream|mistyrose|moccasin|navajowhite|navy|oldlace|olive|olivedrab|orange|orangered|orchid|palegoldenrod|palegreen|paleturquoise|palevioletred|papayawhip|peachpuff|peru|pink|plum|powderblue|purple|red|rosybrown|royalblue|saddlebrown|salmon|sandybrown|seagreen|seashell|sienna|silver|skyblue|slateblue|slategray|slategrey|snow|springgreen|steelblue|tan|teal|thistle|tomato|turquoise|violet|wheat|white|whitesmoke|yellow|yellowgreen)$/i';\n+    private const PATTERN_EXTENDED_NAMED_COLORS = '/^(aliceblue|antiquewhite|aqua|aquamarine|azure|beige|bisque|black|blanchedalmond|blue|blueviolet|brown|burlywood|cadetblue|chartreuse|chocolate|coral|cornflowerblue|cornsilk|crimson|cyan|darkblue|darkcyan|darkgoldenrod|darkgray|darkgreen|darkgrey|darkkhaki|darkmagenta|darkolivegreen|darkorange|darkorchid|darkred|darksalmon|darkseagreen|darkslateblue|darkslategray|darkslategrey|darkturquoise|darkviolet|deeppink|deepskyblue|dimgray|dimgrey|dodgerblue|firebrick|floralwhite|forestgreen|fuchsia|gainsboro|ghostwhite|gold|goldenrod|gray|green|greenyellow|grey|honeydew|hotpink|indianred|indigo|ivory|khaki|lavender|lavenderblush|lawngreen|lemonchiffon|lightblue|lightcoral|lightcyan|lightgoldenrodyellow|lightgray|lightgreen|lightgrey|lightpink|lightsalmon|lightseagreen|lightskyblue|lightslategray|lightslategrey|lightsteelblue|lightyellow|lime|limegreen|linen|magenta|maroon|mediumaquamarine|mediumblue|mediumorchid|mediumpurple|mediumseagreen|mediumslateblue|mediumspringgreen|mediumturquoise|mediumvioletred|midnightblue|mintcream|mistyrose|moccasin|navajowhite|navy|oldlace|olive|olivedrab|orange|orangered|orchid|palegoldenrod|palegreen|paleturquoise|palevioletred|papayawhip|peachpuff|peru|pink|plum|powderblue|purple|red|rosybrown|royalblue|saddlebrown|salmon|sandybrown|seagreen|seashell|sienna|silver|skyblue|slateblue|slategray|slategrey|snow|springgreen|steelblue|tan|teal|thistle|tomato|turquoise|violet|wheat|white|whitesmoke|yellow|yellowgreen)$/iD';\n     // List comes from https://drafts.csswg.org/css-color/#css-system-colors\n-    private const PATTERN_SYSTEM_COLORS = '/^(Canvas|CanvasText|LinkText|VisitedText|ActiveText|ButtonFace|ButtonText|ButtonBorder|Field|FieldText|Highlight|HighlightText|SelectedItem|SelectedItemText|Mark|MarkText|GrayText)$/i';\n-    private const PATTERN_KEYWORDS = '/^(transparent|currentColor)$/i';\n-    private const PATTERN_RGB = '/^rgb\\(\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d)\\s*\\)$/i';\n-    private const PATTERN_RGBA = '/^rgba\\(\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|0?\\.\\d+|1(\\.0)?)\\s*\\)$/i';\n-    private const PATTERN_HSL = '/^hsl\\(\\s*(0|360|35\\d|3[0-4]\\d|[12]\\d\\d|0?\\d?\\d),\\s*(0|100|\\d{1,2})%,\\s*(0|100|\\d{1,2})%\\s*\\)$/i';\n-    private const PATTERN_HSLA = '/^hsla\\(\\s*(0|360|35\\d|3[0-4]\\d|[12]\\d\\d|0?\\d?\\d),\\s*(0|100|\\d{1,2})%,\\s*(0|100|\\d{1,2})%,\\s*(0|0?\\.\\d+|1(\\.0)?)\\s*\\)$/i';\n+    private const PATTERN_SYSTEM_COLORS = '/^(Canvas|CanvasText|LinkText|VisitedText|ActiveText|ButtonFace|ButtonText|ButtonBorder|Field|FieldText|Highlight|HighlightText|SelectedItem|SelectedItemText|Mark|MarkText|GrayText)$/iD';\n+    private const PATTERN_KEYWORDS = '/^(transparent|currentColor)$/iD';\n+    private const PATTERN_RGB = '/^rgb\\(\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d)\\s*\\)$/iD';\n+    private const PATTERN_RGBA = '/^rgba\\(\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|255|25[0-4]|2[0-4]\\d|1\\d\\d|0?\\d?\\d),\\s*(0|0?\\.\\d+|1(\\.0)?)\\s*\\)$/iD';\n+    private const PATTERN_HSL = '/^hsl\\(\\s*(0|360|35\\d|3[0-4]\\d|[12]\\d\\d|0?\\d?\\d),\\s*(0|100|\\d{1,2})%,\\s*(0|100|\\d{1,2})%\\s*\\)$/iD';\n+    private const PATTERN_HSLA = '/^hsla\\(\\s*(0|360|35\\d|3[0-4]\\d|[12]\\d\\d|0?\\d?\\d),\\s*(0|100|\\d{1,2})%,\\s*(0|100|\\d{1,2})%,\\s*(0|0?\\.\\d+|1(\\.0)?)\\s*\\)$/iD';\n \n     private const COLOR_PATTERNS = [\n         CssColor::HEX_LONG => self::PATTERN_HEX_LONG,"
            },
            {
                "sha": "4a1fb7dd705f66a341b4a000170fa6b8864c7475",
                "filename": "src/Symfony/Component/Validator/Constraints/DateValidator.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FDateValidator.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FDateValidator.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FDateValidator.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -21,7 +21,7 @@\n  */\n class DateValidator extends ConstraintValidator\n {\n-    public const PATTERN = '/^(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})$/';\n+    public const PATTERN = '/^(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})$/D';\n \n     /**\n      * Checks whether a date is valid."
            },
            {
                "sha": "a073ab31ce86d4bf405dd92070a21c7c10b06a24",
                "filename": "src/Symfony/Component/Validator/Constraints/EmailValidator.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FEmailValidator.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FEmailValidator.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FEmailValidator.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -25,8 +25,8 @@\n  */\n class EmailValidator extends ConstraintValidator\n {\n-    private const PATTERN_HTML5 = '/^[a-zA-Z0-9.!#$%&\\'*+\\\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/';\n-    private const PATTERN_LOOSE = '/^.+\\@\\S+\\.\\S+$/';\n+    private const PATTERN_HTML5 = '/^[a-zA-Z0-9.!#$%&\\'*+\\\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/D';\n+    private const PATTERN_LOOSE = '/^.+\\@\\S+\\.\\S+$/D';\n \n     private const EMAIL_PATTERNS = [\n         Email::VALIDATION_MODE_LOOSE => self::PATTERN_LOOSE,"
            },
            {
                "sha": "0065fc93f87d5317a49967d967ac8cc253edd2fb",
                "filename": "src/Symfony/Component/Validator/Constraints/TimeValidator.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FTimeValidator.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FTimeValidator.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FTimeValidator.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -21,7 +21,7 @@\n  */\n class TimeValidator extends ConstraintValidator\n {\n-    public const PATTERN = '/^(\\d{2}):(\\d{2}):(\\d{2})$/';\n+    public const PATTERN = '/^(\\d{2}):(\\d{2}):(\\d{2})$/D';\n \n     /**\n      * Checks whether a time is valid."
            },
            {
                "sha": "eb286e7b1b422ee551a733a0a495c78c60eb483d",
                "filename": "src/Symfony/Component/Validator/Constraints/UrlValidator.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FUrlValidator.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FUrlValidator.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FConstraints%2FUrlValidator.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -43,7 +43,7 @@ class UrlValidator extends ConstraintValidator\n             (?:/ (?:[\\pL\\pN\\pS\\pM\\-._\\~!$&\\'()*+,;=:@]|%%[0-9A-Fa-f]{2})* )*    # a path\n             (?:\\? (?:[\\pL\\pN\\-._\\~!$&\\'\\[\\]()*+,;=:@/?]|%%[0-9A-Fa-f]{2})* )?   # a query (optional)\n             (?:\\# (?:[\\pL\\pN\\-._\\~!$&\\'()*+,;=:@/?]|%%[0-9A-Fa-f]{2})* )?       # a fragment (optional)\n-        $~ixu';\n+        $~ixuD';\n \n     /**\n      * {@inheritdoc}"
            },
            {
                "sha": "9a6bc5598157774905b2a83a32936c62f5e8756c",
                "filename": "src/Symfony/Component/Validator/Tests/Constraints/CardSchemeValidatorTest.php",
                "status": "modified",
                "additions": 30,
                "deletions": 0,
                "changes": 30,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FCardSchemeValidatorTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FCardSchemeValidatorTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FCardSchemeValidatorTest.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -46,6 +46,36 @@ public function testValidNumbers($scheme, $number)\n         $this->assertNoViolation();\n     }\n \n+    /**\n+     * @requires PHP 8\n+     *\n+     * @dataProvider getValidNumbers\n+     */\n+    public function testValidNumbersWithNewLine($scheme, $number)\n+    {\n+        $this->validator->validate($number.\"\\n\", new CardScheme(['schemes' => $scheme, 'message' => 'myMessage']));\n+\n+        $this->buildViolation('myMessage')\n+            ->setParameter('{{ value }}', '\"'.$number.\"\\n\\\"\")\n+            ->setCode(CardScheme::INVALID_FORMAT_ERROR)\n+            ->assertRaised();\n+    }\n+\n+    /**\n+     * @requires PHP < 8\n+     *\n+     * @dataProvider getValidNumbers\n+     */\n+    public function testValidNumbersWithNewLinePriorToPhp8($scheme, $number)\n+    {\n+        $this->validator->validate($number.\"\\n\", new CardScheme(['schemes' => $scheme, 'message' => 'myMessage']));\n+\n+        $this->buildViolation('myMessage')\n+            ->setParameter('{{ value }}', '\"'.$number.\"\\n\\\"\")\n+            ->setCode(CardScheme::NOT_NUMERIC_ERROR)\n+            ->assertRaised();\n+    }\n+\n     public function testValidNumberWithOrderedArguments()\n     {\n         $this->validator->validate("
            },
            {
                "sha": "ce121977c0924c6bc57bca9eb336c763b69a2b07",
                "filename": "src/Symfony/Component/Validator/Tests/Constraints/CssColorValidatorTest.php",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FCssColorValidatorTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FCssColorValidatorTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FCssColorValidatorTest.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -52,6 +52,19 @@ public function testValidAnyColor($cssColor)\n         $this->assertNoViolation();\n     }\n \n+    /**\n+     * @dataProvider getValidAnyColor\n+     */\n+    public function testValidAnyColorWithNewLine($cssColor)\n+    {\n+        $this->validator->validate($cssColor.\"\\n\", new CssColor([], 'myMessage'));\n+\n+        $this->buildViolation('myMessage')\n+            ->setParameter('{{ value }}', '\"'.$cssColor.\"\\n\\\"\")\n+            ->setCode(CssColor::INVALID_FORMAT_ERROR)\n+            ->assertRaised();\n+    }\n+\n     public static function getValidAnyColor(): array\n     {\n         return ["
            },
            {
                "sha": "23725d5e491e6c91e9dfc765a0cff8733a80a6e7",
                "filename": "src/Symfony/Component/Validator/Tests/Constraints/DateValidatorTest.php",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FDateValidatorTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FDateValidatorTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FDateValidatorTest.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -53,6 +53,19 @@ public function testValidDates($date)\n         $this->assertNoViolation();\n     }\n \n+    /**\n+     * @dataProvider getValidDates\n+     */\n+    public function testValidDatesWithNewLine(string $date)\n+    {\n+        $this->validator->validate($date.\"\\n\", new Date(['message' => 'myMessage']));\n+\n+        $this->buildViolation('myMessage')\n+            ->setParameter('{{ value }}', '\"'.$date.\"\\n\\\"\")\n+            ->setCode(Date::INVALID_FORMAT_ERROR)\n+            ->assertRaised();\n+    }\n+\n     public static function getValidDates()\n     {\n         return ["
            },
            {
                "sha": "1cd661aab79b6fe1f4678fab15e6a22d54a11591",
                "filename": "src/Symfony/Component/Validator/Tests/Constraints/EmailValidatorTest.php",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FEmailValidatorTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FEmailValidatorTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FEmailValidatorTest.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -70,6 +70,19 @@ public function testValidEmails($email)\n         $this->assertNoViolation();\n     }\n \n+    /**\n+     * @dataProvider getValidEmails\n+     */\n+    public function testValidEmailsWithNewLine($email)\n+    {\n+        $this->validator->validate($email.\"\\n\", new Email());\n+\n+        $this->buildViolation('This value is not a valid email address.')\n+            ->setParameter('{{ value }}', '\"'.$email.\"\\n\\\"\")\n+            ->setCode(Email::INVALID_FORMAT_ERROR)\n+            ->assertRaised();\n+    }\n+\n     public static function getValidEmails()\n     {\n         return ["
            },
            {
                "sha": "eb625fa4948685aa1d57ec749175bfaa8656aae1",
                "filename": "src/Symfony/Component/Validator/Tests/Constraints/IbanValidatorTest.php",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FIbanValidatorTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FIbanValidatorTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FIbanValidatorTest.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -48,6 +48,19 @@ public function testValidIbans($iban)\n         $this->assertNoViolation();\n     }\n \n+    /**\n+     * @dataProvider getValidIbans\n+     */\n+    public function testValidIbansWithNewLine(string $iban)\n+    {\n+        $this->validator->validate($iban.\"\\n\", new Iban());\n+\n+        $this->buildViolation('This is not a valid International Bank Account Number (IBAN).')\n+            ->setParameter('{{ value }}', '\"'.$iban.\"\\n\\\"\")\n+            ->setCode(Iban::INVALID_CHARACTERS_ERROR)\n+            ->assertRaised();\n+    }\n+\n     public static function getValidIbans()\n     {\n         return ["
            },
            {
                "sha": "56d8abc15159087f61d1ab572d4ede7fb2f097bb",
                "filename": "src/Symfony/Component/Validator/Tests/Constraints/TimeValidatorTest.php",
                "status": "modified",
                "additions": 13,
                "deletions": 0,
                "changes": 13,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FTimeValidatorTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FTimeValidatorTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FTimeValidatorTest.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -53,6 +53,19 @@ public function testValidTimes($time)\n         $this->assertNoViolation();\n     }\n \n+    /**\n+     * @dataProvider getValidTimes\n+     */\n+    public function testValidTimesWithNewLine(string $time)\n+    {\n+        $this->validator->validate($time.\"\\n\", new Time());\n+\n+        $this->buildViolation('This value is not a valid time.')\n+            ->setParameter('{{ value }}', '\"'.$time.\"\\n\".'\"')\n+            ->setCode(Time::INVALID_FORMAT_ERROR)\n+            ->assertRaised();\n+    }\n+\n     public static function getValidTimes()\n     {\n         return ["
            },
            {
                "sha": "900f92afcc4f94f88cd939be2060d3d015eacc39",
                "filename": "src/Symfony/Component/Validator/Tests/Constraints/UrlValidatorTest.php",
                "status": "modified",
                "additions": 31,
                "deletions": 0,
                "changes": 31,
                "blob_url": "https://github.com/symfony/symfony/blob/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FUrlValidatorTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/7d1032bbead9a4229b32fa6ebca32681c80cb76f/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FUrlValidatorTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FValidator%2FTests%2FConstraints%2FUrlValidatorTest.php?ref=7d1032bbead9a4229b32fa6ebca32681c80cb76f",
                "patch": "@@ -60,6 +60,19 @@ public function testValidUrls($url)\n         $this->assertNoViolation();\n     }\n \n+    /**\n+     * @dataProvider getValidUrls\n+     */\n+    public function testValidUrlsWithNewLine($url)\n+    {\n+        $this->validator->validate($url.\"\\n\", new Url());\n+\n+        $this->buildViolation('This value is not a valid URL.')\n+            ->setParameter('{{ value }}', '\"'.$url.\"\\n\".'\"')\n+            ->setCode(Url::INVALID_URL_ERROR)\n+            ->assertRaised();\n+    }\n+\n     /**\n      * @dataProvider getValidUrlsWithWhitespaces\n      */\n@@ -85,6 +98,24 @@ public function testValidRelativeUrl($url)\n         $this->assertNoViolation();\n     }\n \n+    /**\n+     * @dataProvider getValidRelativeUrls\n+     * @dataProvider getValidUrls\n+     */\n+    public function testValidRelativeUrlWithNewLine(string $url)\n+    {\n+        $constraint = new Url([\n+            'relativeProtocol' => true,\n+        ]);\n+\n+        $this->validator->validate($url.\"\\n\", $constraint);\n+\n+        $this->buildViolation('This value is not a valid URL.')\n+            ->setParameter('{{ value }}', '\"'.$url.\"\\n\".'\"')\n+            ->setCode(Url::INVALID_URL_ERROR)\n+            ->assertRaised();\n+    }\n+\n     public static function getValidRelativeUrls()\n     {\n         return ["
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/symfony/symfony/commits/5a9b08e5740af795854b1b639b7d45b9cbfe8819",
        "url": "https://api.github.com/repos/symfony/symfony/commits/5a9b08e5740af795854b1b639b7d45b9cbfe8819",
        "html_url": "https://github.com/symfony/symfony/commit/5a9b08e5740af795854b1b639b7d45b9cbfe8819",
        "message": "[HttpFoundation] Reject URIs that contain invalid characters",
        "files": [
            {
                "sha": "e404b4cd0181f9b8a596de4cb0857ff4a45c7683",
                "filename": "src/Symfony/Component/HttpFoundation/Request.php",
                "status": "modified",
                "additions": 17,
                "deletions": 0,
                "changes": 17,
                "blob_url": "https://github.com/symfony/symfony/blob/5a9b08e5740af795854b1b639b7d45b9cbfe8819/src%2FSymfony%2FComponent%2FHttpFoundation%2FRequest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/5a9b08e5740af795854b1b639b7d45b9cbfe8819/src%2FSymfony%2FComponent%2FHttpFoundation%2FRequest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FHttpFoundation%2FRequest.php?ref=5a9b08e5740af795854b1b639b7d45b9cbfe8819",
                "patch": "@@ -11,6 +11,7 @@\n \n namespace Symfony\\Component\\HttpFoundation;\n \n+use Symfony\\Component\\HttpFoundation\\Exception\\BadRequestException;\n use Symfony\\Component\\HttpFoundation\\Exception\\ConflictingHeadersException;\n use Symfony\\Component\\HttpFoundation\\Exception\\JsonException;\n use Symfony\\Component\\HttpFoundation\\Exception\\SessionNotFoundException;\n@@ -333,6 +334,8 @@ public static function createFromGlobals()\n      * @param string|resource|null $content    The raw body data\n      *\n      * @return static\n+     *\n+     * @throws BadRequestException When the URI is invalid\n      */\n     public static function create(string $uri, string $method = 'GET', array $parameters = [], array $cookies = [], array $files = [], array $server = [], $content = null)\n     {\n@@ -360,6 +363,20 @@ public static function create(string $uri, string $method = 'GET', array $parame\n             unset($components['fragment']);\n         }\n \n+        if (false === $components) {\n+            throw new BadRequestException('Invalid URI.');\n+        }\n+\n+        if (false !== ($i = strpos($uri, '\\\\')) && $i < strcspn($uri, '?#')) {\n+            throw new BadRequestException('Invalid URI: A URI cannot contain a backslash.');\n+        }\n+        if (\\strlen($uri) !== strcspn($uri, \"\\r\\n\\t\")) {\n+            throw new BadRequestException('Invalid URI: A URI cannot contain CR/LF/TAB characters.');\n+        }\n+        if ('' !== $uri && (\\ord($uri[0]) <= 32 || \\ord($uri[-1]) <= 32)) {\n+            throw new BadRequestException('Invalid URI: A URI must not start nor end with ASCII control characters or spaces.');\n+        }\n+\n         if (isset($components['host'])) {\n             $server['SERVER_NAME'] = $components['host'];\n             $server['HTTP_HOST'] = $components['host'];"
            },
            {
                "sha": "c2986907b732ad5f9599a279f2260f133d20caa7",
                "filename": "src/Symfony/Component/HttpFoundation/Tests/RequestTest.php",
                "status": "modified",
                "additions": 28,
                "deletions": 2,
                "changes": 30,
                "blob_url": "https://github.com/symfony/symfony/blob/5a9b08e5740af795854b1b639b7d45b9cbfe8819/src%2FSymfony%2FComponent%2FHttpFoundation%2FTests%2FRequestTest.php",
                "raw_url": "https://github.com/symfony/symfony/raw/5a9b08e5740af795854b1b639b7d45b9cbfe8819/src%2FSymfony%2FComponent%2FHttpFoundation%2FTests%2FRequestTest.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FHttpFoundation%2FTests%2FRequestTest.php?ref=5a9b08e5740af795854b1b639b7d45b9cbfe8819",
                "patch": "@@ -13,6 +13,7 @@\n \n use PHPUnit\\Framework\\TestCase;\n use Symfony\\Bridge\\PhpUnit\\ExpectDeprecationTrait;\n+use Symfony\\Component\\HttpFoundation\\Exception\\BadRequestException;\n use Symfony\\Component\\HttpFoundation\\Exception\\ConflictingHeadersException;\n use Symfony\\Component\\HttpFoundation\\Exception\\JsonException;\n use Symfony\\Component\\HttpFoundation\\Exception\\SuspiciousOperationException;\n@@ -289,9 +290,34 @@ public function testCreateWithRequestUri()\n         $this->assertTrue($request->isSecure());\n \n         // Fragment should not be included in the URI\n-        $request = Request::create('http://test.com/foo#bar');\n-        $request->server->set('REQUEST_URI', 'http://test.com/foo#bar');\n+        $request = Request::create('http://test.com/foo#bar\\\\baz');\n+        $request->server->set('REQUEST_URI', 'http://test.com/foo#bar\\\\baz');\n         $this->assertEquals('http://test.com/foo', $request->getUri());\n+\n+        $request = Request::create('http://test.com/foo?bar=f\\\\o');\n+        $this->assertEquals('http://test.com/foo?bar=f%5Co', $request->getUri());\n+        $this->assertEquals('/foo', $request->getPathInfo());\n+        $this->assertEquals('bar=f%5Co', $request->getQueryString());\n+    }\n+\n+    /**\n+     * @testWith [\"http://foo.com\\\\bar\"]\n+     *           [\"\\\\\\\\foo.com/bar\"]\n+     *           [\"a\\rb\"]\n+     *           [\"a\\nb\"]\n+     *           [\"a\\tb\"]\n+     *           [\"\\u0000foo\"]\n+     *           [\"foo\\u0000\"]\n+     *           [\" foo\"]\n+     *           [\"foo \"]\n+     *           [\":\"]\n+     */\n+    public function testCreateWithBadRequestUri(string $uri)\n+    {\n+        $this->expectException(BadRequestException::class);\n+        $this->expectExceptionMessage('Invalid URI');\n+\n+        Request::create($uri);\n     }\n \n     /**"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/symfony/symfony/commits/18ecd03eda3917fdf901a48e72518f911c64a1c9",
        "url": "https://api.github.com/repos/symfony/symfony/commits/18ecd03eda3917fdf901a48e72518f911c64a1c9",
        "html_url": "https://github.com/symfony/symfony/commit/18ecd03eda3917fdf901a48e72518f911c64a1c9",
        "message": "[Process] Use %PATH% before %CD% to load the shell on Windows",
        "files": [
            {
                "sha": "89edd22fb240012104246efbd7ae787dea61dded",
                "filename": "src/Symfony/Component/Process/ExecutableFinder.php",
                "status": "modified",
                "additions": 8,
                "deletions": 6,
                "changes": 14,
                "blob_url": "https://github.com/symfony/symfony/blob/18ecd03eda3917fdf901a48e72518f911c64a1c9/src%2FSymfony%2FComponent%2FProcess%2FExecutableFinder.php",
                "raw_url": "https://github.com/symfony/symfony/raw/18ecd03eda3917fdf901a48e72518f911c64a1c9/src%2FSymfony%2FComponent%2FProcess%2FExecutableFinder.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FProcess%2FExecutableFinder.php?ref=18ecd03eda3917fdf901a48e72518f911c64a1c9",
                "patch": "@@ -19,7 +19,6 @@\n  */\n class ExecutableFinder\n {\n-    private $suffixes = ['.exe', '.bat', '.cmd', '.com'];\n     private const CMD_BUILTINS = [\n         'assoc', 'break', 'call', 'cd', 'chdir', 'cls', 'color', 'copy', 'date',\n         'del', 'dir', 'echo', 'endlocal', 'erase', 'exit', 'for', 'ftype', 'goto',\n@@ -28,6 +27,8 @@ class ExecutableFinder\n         'setlocal', 'shift', 'start', 'time', 'title', 'type', 'ver', 'vol',\n     ];\n \n+    private $suffixes = [];\n+\n     /**\n      * Replaces default suffixes of executable.\n      */\n@@ -65,11 +66,13 @@ public function find(string $name, ?string $default = null, array $extraDirs = [\n             $extraDirs\n         );\n \n-        $suffixes = [''];\n+        $suffixes = [];\n         if ('\\\\' === \\DIRECTORY_SEPARATOR) {\n             $pathExt = getenv('PATHEXT');\n-            $suffixes = array_merge($pathExt ? explode(\\PATH_SEPARATOR, $pathExt) : $this->suffixes, $suffixes);\n+            $suffixes = $this->suffixes;\n+            $suffixes = array_merge($suffixes, $pathExt ? explode(\\PATH_SEPARATOR, $pathExt) : ['.exe', '.bat', '.cmd', '.com']);\n         }\n+        $suffixes = '' !== pathinfo($name, PATHINFO_EXTENSION) ? array_merge([''], $suffixes) : array_merge($suffixes, ['']);\n         foreach ($suffixes as $suffix) {\n             foreach ($dirs as $dir) {\n                 if ('' === $dir) {\n@@ -85,12 +88,11 @@ public function find(string $name, ?string $default = null, array $extraDirs = [\n             }\n         }\n \n-        if (!\\function_exists('exec') || \\strlen($name) !== strcspn($name, '/'.\\DIRECTORY_SEPARATOR)) {\n+        if ('\\\\' === \\DIRECTORY_SEPARATOR || !\\function_exists('exec') || \\strlen($name) !== strcspn($name, '/'.\\DIRECTORY_SEPARATOR)) {\n             return $default;\n         }\n \n-        $command = '\\\\' === \\DIRECTORY_SEPARATOR ? 'where %s 2> NUL' : 'command -v -- %s';\n-        $execResult = exec(\\sprintf($command, escapeshellarg($name)));\n+        $execResult = exec('command -v -- '.escapeshellarg($name));\n \n         if (($executablePath = substr($execResult, 0, strpos($execResult, \\PHP_EOL) ?: null)) && @is_executable($executablePath)) {\n             return $executablePath;"
            },
            {
                "sha": "c3a9680d757b35ed1d35a5d84f62122e42a4a078",
                "filename": "src/Symfony/Component/Process/PhpExecutableFinder.php",
                "status": "modified",
                "additions": 2,
                "deletions": 13,
                "changes": 15,
                "blob_url": "https://github.com/symfony/symfony/blob/18ecd03eda3917fdf901a48e72518f911c64a1c9/src%2FSymfony%2FComponent%2FProcess%2FPhpExecutableFinder.php",
                "raw_url": "https://github.com/symfony/symfony/raw/18ecd03eda3917fdf901a48e72518f911c64a1c9/src%2FSymfony%2FComponent%2FProcess%2FPhpExecutableFinder.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FProcess%2FPhpExecutableFinder.php?ref=18ecd03eda3917fdf901a48e72518f911c64a1c9",
                "patch": "@@ -34,19 +34,8 @@ public function __construct()\n     public function find(bool $includeArgs = true)\n     {\n         if ($php = getenv('PHP_BINARY')) {\n-            if (!is_executable($php)) {\n-                if (!\\function_exists('exec') || \\strlen($php) !== strcspn($php, '/'.\\DIRECTORY_SEPARATOR)) {\n-                    return false;\n-                }\n-\n-                $command = '\\\\' === \\DIRECTORY_SEPARATOR ? 'where %s 2> NUL' : 'command -v -- %s';\n-                $execResult = exec(\\sprintf($command, escapeshellarg($php)));\n-                if (!$php = substr($execResult, 0, strpos($execResult, \\PHP_EOL) ?: null)) {\n-                    return false;\n-                }\n-                if (!is_executable($php)) {\n-                    return false;\n-                }\n+            if (!is_executable($php) && !$php = $this->executableFinder->find($php)) {\n+                return false;\n             }\n \n             if (@is_dir($php)) {"
            },
            {
                "sha": "0f3457f382179ed2e89643eda2bb1193635e1592",
                "filename": "src/Symfony/Component/Process/Process.php",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/symfony/symfony/blob/18ecd03eda3917fdf901a48e72518f911c64a1c9/src%2FSymfony%2FComponent%2FProcess%2FProcess.php",
                "raw_url": "https://github.com/symfony/symfony/raw/18ecd03eda3917fdf901a48e72518f911c64a1c9/src%2FSymfony%2FComponent%2FProcess%2FProcess.php",
                "contents_url": "https://api.github.com/repos/symfony/symfony/contents/src%2FSymfony%2FComponent%2FProcess%2FProcess.php?ref=18ecd03eda3917fdf901a48e72518f911c64a1c9",
                "patch": "@@ -1592,7 +1592,14 @@ function ($m) use (&$env, &$varCache, &$varCount, $uid) {\n             $cmd\n         );\n \n-        $cmd = 'cmd /V:ON /E:ON /D /C ('.str_replace(\"\\n\", ' ', $cmd).')';\n+        static $comSpec;\n+\n+        if (!$comSpec && $comSpec = (new ExecutableFinder())->find('cmd.exe')) {\n+            // Escape according to CommandLineToArgvW rules\n+            $comSpec = '\"'.preg_replace('{(\\\\\\\\*+)\"}', '$1$1\\\"', $comSpec) .'\"';\n+        }\n+\n+        $cmd = ($comSpec ?? 'cmd').' /V:ON /E:ON /D /C ('.str_replace(\"\\n\", ' ', $cmd).')';\n         foreach ($this->processPipes->getFiles() as $offset => $filename) {\n             $cmd .= ' '.$offset.'>\"'.$filename.'\"';\n         }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/twigphp/Twig/commits/2bb8c2460a2c519c498df9b643d5277117155a73",
        "url": "https://api.github.com/repos/twigphp/Twig/commits/2bb8c2460a2c519c498df9b643d5277117155a73",
        "html_url": "https://github.com/twigphp/Twig/commit/2bb8c2460a2c519c498df9b643d5277117155a73",
        "message": "Fix sandbox handling for __toString()",
        "files": [
            {
                "sha": "c9ffe6477bda651dd0ab386373e05c39ca4524f3",
                "filename": "src/Extension/SandboxExtension.php",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/twigphp/Twig/blob/2bb8c2460a2c519c498df9b643d5277117155a73/src%2FExtension%2FSandboxExtension.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/2bb8c2460a2c519c498df9b643d5277117155a73/src%2FExtension%2FSandboxExtension.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/src%2FExtension%2FSandboxExtension.php?ref=2bb8c2460a2c519c498df9b643d5277117155a73",
                "patch": "@@ -119,6 +119,14 @@ public function checkPropertyAllowed($obj, $property, int $lineno = -1, ?Source\n \n     public function ensureToStringAllowed($obj, int $lineno = -1, ?Source $source = null)\n     {\n+        if (\\is_array($obj)) {\n+            foreach ($obj as $v) {\n+                $this->ensureToStringAllowed($v, $lineno, $source);\n+            }\n+\n+            return $obj;\n+        }\n+\n         if ($this->isSandboxed($source) && $obj instanceof \\Stringable) {\n             try {\n                 $this->policy->checkMethodAllowed($obj, '__toString');"
            },
            {
                "sha": "8c15db0d6f22937d6026439de4aac975dde83a9a",
                "filename": "src/NodeVisitor/SandboxNodeVisitor.php",
                "status": "modified",
                "additions": 14,
                "deletions": 1,
                "changes": 15,
                "blob_url": "https://github.com/twigphp/Twig/blob/2bb8c2460a2c519c498df9b643d5277117155a73/src%2FNodeVisitor%2FSandboxNodeVisitor.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/2bb8c2460a2c519c498df9b643d5277117155a73/src%2FNodeVisitor%2FSandboxNodeVisitor.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/src%2FNodeVisitor%2FSandboxNodeVisitor.php?ref=2bb8c2460a2c519c498df9b643d5277117155a73",
                "patch": "@@ -15,12 +15,14 @@\n use Twig\\Node\\CheckSecurityCallNode;\n use Twig\\Node\\CheckSecurityNode;\n use Twig\\Node\\CheckToStringNode;\n+use Twig\\Node\\Expression\\ArrayExpression;\n use Twig\\Node\\Expression\\Binary\\ConcatBinary;\n use Twig\\Node\\Expression\\Binary\\RangeBinary;\n use Twig\\Node\\Expression\\FilterExpression;\n use Twig\\Node\\Expression\\FunctionExpression;\n use Twig\\Node\\Expression\\GetAttrExpression;\n use Twig\\Node\\Expression\\NameExpression;\n+use Twig\\Node\\Expression\\Unary\\SpreadUnary;\n use Twig\\Node\\ModuleNode;\n use Twig\\Node\\Node;\n use Twig\\Node\\PrintNode;\n@@ -120,7 +122,18 @@ private function wrapNode(Node $node, string $name): void\n     {\n         $expr = $node->getNode($name);\n         if (($expr instanceof NameExpression || $expr instanceof GetAttrExpression) && !$expr->isGenerator()) {\n-            $node->setNode($name, new CheckToStringNode($expr));\n+            // Simplify in 4.0 as the spread attribute has been removed there\n+            $new = new CheckToStringNode($expr);\n+            if ($expr->hasAttribute('spread')) {\n+                $new->setAttribute('spread', $expr->getAttribute('spread'));\n+            }\n+            $node->setNode($name, $new);\n+        } elseif ($expr instanceof SpreadUnary) {\n+            $this->wrapNode($expr, 'node');\n+        } elseif ($expr instanceof ArrayExpression) {\n+            foreach ($expr as $name => $_) {\n+                $this->wrapNode($expr, $name);\n+            }\n         }\n     }\n "
            },
            {
                "sha": "59e68f67ec28ecd3f8fb390d49e5da4c6d5bb890",
                "filename": "tests/Extension/SandboxTest.php",
                "status": "modified",
                "additions": 13,
                "deletions": 2,
                "changes": 15,
                "blob_url": "https://github.com/twigphp/Twig/blob/2bb8c2460a2c519c498df9b643d5277117155a73/tests%2FExtension%2FSandboxTest.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/2bb8c2460a2c519c498df9b643d5277117155a73/tests%2FExtension%2FSandboxTest.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/tests%2FExtension%2FSandboxTest.php?ref=2bb8c2460a2c519c498df9b643d5277117155a73",
                "patch": "@@ -42,6 +42,7 @@ protected function setUp(): void\n             'obj' => new FooObject(),\n             'arr' => ['obj' => new FooObject()],\n             'child_obj' => new ChildClass(),\n+            'some_array' => [5, 6, 7, new FooObject()],\n         ];\n \n         self::$templates = [\n@@ -246,10 +247,10 @@ public function testSandboxUnallowedProperty()\n      */\n     public function testSandboxUnallowedToString($template)\n     {\n-        $twig = $this->getEnvironment(true, [], ['index' => $template], [], ['upper'], ['Twig\\Tests\\Extension\\FooObject' => 'getAnotherFooObject'], [], ['random']);\n+        $twig = $this->getEnvironment(true, [], ['index' => $template], [], ['upper', 'join', 'replace'], ['Twig\\Tests\\Extension\\FooObject' => 'getAnotherFooObject'], [], ['random']);\n         try {\n             $twig->load('index')->render(self::$params);\n-            $this->fail('Sandbox throws a SecurityError exception if an unallowed method (__toString()) is called in the template');\n+            $this->fail('Sandbox throws a SecurityError exception if an unallowed method \"__toString()\" method is called in the template');\n         } catch (SecurityNotAllowedMethodError $e) {\n             $this->assertEquals('Twig\\Tests\\Extension\\FooObject', $e->getClassName(), 'Exception should be raised on the \"Twig\\Tests\\Extension\\FooObject\" class');\n             $this->assertEquals('__tostring', $e->getMethodName(), 'Exception should be raised on the \"__toString\" method');\n@@ -272,6 +273,16 @@ public static function getSandboxUnallowedToStringTests()\n             'object_chain_and_function' => ['{{ random(obj.anotherFooObject) }}'],\n             'concat' => ['{{ obj ~ \"\" }}'],\n             'concat_again' => ['{{ \"\" ~ obj }}'],\n+            'object_in_arguments' => ['{{ \"__toString\"|replace({\"__toString\": obj}) }}'],\n+            'object_in_array' => ['{{ [12, \"foo\", obj]|join(\", \") }}'],\n+            'object_in_array_var' => ['{{ some_array|join(\", \") }}'],\n+            'object_in_array_nested' => ['{{ [12, \"foo\", [12, \"foo\", obj]]|join(\", \") }}'],\n+            'object_in_array_var_nested' => ['{{ [12, \"foo\", some_array]|join(\", \") }}'],\n+            'object_in_array_dynamic_key' => ['{{ {(obj): \"foo\"}|join(\", \") }}'],\n+            'object_in_array_dynamic_key_nested' => ['{{ {\"foo\": { (obj): \"foo\" }}|join(\", \") }}'],\n+            'context' => ['{{ _context|join(\", \") }}'],\n+            'spread_array_operator' => ['{{ [1, 2, ...[5, 6, 7, obj]]|join(\",\") }}'],\n+            'spread_array_operator_var' => ['{{ [1, 2, ...some_array]|join(\",\") }}'],\n         ];\n     }\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/twigphp/Twig/commits/831c148e786178e5f2fde9db67266be3bf241c21",
        "url": "https://api.github.com/repos/twigphp/Twig/commits/831c148e786178e5f2fde9db67266be3bf241c21",
        "html_url": "https://github.com/twigphp/Twig/commit/831c148e786178e5f2fde9db67266be3bf241c21",
        "message": "Sandbox ArrayAccess and do sandbox checks before isset() checks",
        "files": [
            {
                "sha": "d5e484aa87b02c10b1b60ff7a83064eb87604790",
                "filename": "doc/api.rst",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/twigphp/Twig/blob/831c148e786178e5f2fde9db67266be3bf241c21/doc%2Fapi.rst",
                "raw_url": "https://github.com/twigphp/Twig/raw/831c148e786178e5f2fde9db67266be3bf241c21/doc%2Fapi.rst",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/doc%2Fapi.rst?ref=831c148e786178e5f2fde9db67266be3bf241c21",
                "patch": "@@ -486,6 +486,15 @@ able to call the ``getTitle()`` and ``getBody()`` methods on ``Article``\n objects, and the ``title`` and ``body`` public properties. Everything else\n won't be allowed and will generate a ``\\Twig\\Sandbox\\SecurityError`` exception.\n \n+.. note::\n+\n+    As of Twig 1.14.1 (and on Twig 3.11.2), if the ``Article`` class implements\n+    the ``ArrayAccess`` interface, the templates will only be able to access\n+    the ``title`` and ``body`` attributes.\n+\n+    Note that native array-like classes (like ``ArrayObject``) are always\n+    allowed, you don't need to configure them.\n+\n .. caution::\n \n     The ``extends`` and ``use`` tags are always allowed in a sandboxed"
            },
            {
                "sha": "e1fd3962e0e98f27d27e89bb512131c6c80d5aac",
                "filename": "src/Extension/CoreExtension.php",
                "status": "modified",
                "additions": 56,
                "deletions": 8,
                "changes": 64,
                "blob_url": "https://github.com/twigphp/Twig/blob/831c148e786178e5f2fde9db67266be3bf241c21/src%2FExtension%2FCoreExtension.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/831c148e786178e5f2fde9db67266be3bf241c21/src%2FExtension%2FCoreExtension.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/src%2FExtension%2FCoreExtension.php?ref=831c148e786178e5f2fde9db67266be3bf241c21",
                "patch": "@@ -65,6 +65,8 @@\n use Twig\\Node\\Node;\n use Twig\\NodeVisitor\\MacroAutoImportNodeVisitor;\n use Twig\\Parser;\n+use Twig\\Sandbox\\SecurityNotAllowedMethodError;\n+use Twig\\Sandbox\\SecurityNotAllowedPropertyError;\n use Twig\\Source;\n use Twig\\Template;\n use Twig\\TemplateWrapper;\n@@ -92,6 +94,20 @@\n \n final class CoreExtension extends AbstractExtension\n {\n+    public const ARRAY_LIKE_CLASSES = [\n+        'ArrayIterator',\n+        'ArrayObject',\n+        'CachingIterator',\n+        'RecursiveArrayIterator',\n+        'RecursiveCachingIterator',\n+        'SplDoublyLinkedList',\n+        'SplFixedArray',\n+        'SplObjectStorage',\n+        'SplQueue',\n+        'SplStack',\n+        'WeakMap',\n+    ];\n+\n     private $dateFormats = ['F j, Y H:i', '%d days'];\n     private $numberFormat = [0, '.', ','];\n     private $timezone = null;\n@@ -1587,10 +1603,20 @@ public static function batch($items, $size, $fill = null, $preserveKeys = true):\n      */\n     public static function getAttribute(Environment $env, Source $source, $object, $item, array $arguments = [], $type = Template::ANY_CALL, $isDefinedTest = false, $ignoreStrictCheck = false, $sandboxed = false, int $lineno = -1)\n     {\n+        $propertyNotAllowedError = null;\n+\n         // array\n         if (Template::METHOD_CALL !== $type) {\n             $arrayItem = \\is_bool($item) || \\is_float($item) ? (int) $item : $item;\n \n+            if ($sandboxed && $object instanceof \\ArrayAccess && !\\in_array($object::class, self::ARRAY_LIKE_CLASSES, true)) {\n+                try {\n+                    $env->getExtension(SandboxExtension::class)->checkPropertyAllowed($object, $arrayItem, $lineno, $source);\n+                } catch (SecurityNotAllowedPropertyError $propertyNotAllowedError) {\n+                    goto methodCheck;\n+                }\n+            }\n+\n             if (((\\is_array($object) || $object instanceof \\ArrayObject) && (isset($object[$arrayItem]) || \\array_key_exists($arrayItem, (array) $object)))\n                 || ($object instanceof \\ArrayAccess && isset($object[$arrayItem]))\n             ) {\n@@ -1662,19 +1688,25 @@ public static function getAttribute(Environment $env, Source $source, $object, $\n \n         // object property\n         if (Template::METHOD_CALL !== $type) {\n+            if ($sandboxed) {\n+                try {\n+                    $env->getExtension(SandboxExtension::class)->checkPropertyAllowed($object, $item, $lineno, $source);\n+                } catch (SecurityNotAllowedPropertyError $propertyNotAllowedError) {\n+                    goto methodCheck;\n+                }\n+            }\n+\n             if (isset($object->$item) || \\array_key_exists((string) $item, (array) $object)) {\n                 if ($isDefinedTest) {\n                     return true;\n                 }\n \n-                if ($sandboxed) {\n-                    $env->getExtension(SandboxExtension::class)->checkPropertyAllowed($object, $item, $lineno, $source);\n-                }\n-\n                 return $object->$item;\n             }\n         }\n \n+        methodCheck:\n+\n         static $cache = [];\n \n         $class = \\get_class($object);\n@@ -1733,19 +1765,35 @@ public static function getAttribute(Environment $env, Source $source, $object, $\n                 return false;\n             }\n \n+            if ($propertyNotAllowedError) {\n+                throw $propertyNotAllowedError;\n+            }\n+\n             if ($ignoreStrictCheck || !$env->isStrictVariables()) {\n                 return;\n             }\n \n             throw new RuntimeError(\\sprintf('Neither the property \"%1$s\" nor one of the methods \"%1$s()\", \"get%1$s()\"/\"is%1$s()\"/\"has%1$s()\" or \"__call()\" exist and have public access in class \"%2$s\".', $item, $class), $lineno, $source);\n         }\n \n-        if ($isDefinedTest) {\n-            return true;\n+        if ($sandboxed) {\n+            try {\n+                $env->getExtension(SandboxExtension::class)->checkMethodAllowed($object, $method, $lineno, $source);\n+            } catch (SecurityNotAllowedMethodError $e) {\n+                if ($isDefinedTest) {\n+                    return false;\n+                }\n+\n+                if ($propertyNotAllowedError) {\n+                    throw $propertyNotAllowedError;\n+                }\n+\n+                throw $e;\n+            }\n         }\n \n-        if ($sandboxed) {\n-            $env->getExtension(SandboxExtension::class)->checkMethodAllowed($object, $method, $lineno, $source);\n+        if ($isDefinedTest) {\n+            return true;\n         }\n \n         // Some objects throw exceptions when they have __call, and the method we try"
            },
            {
                "sha": "2181b0f78625a7d03947c78d6eb119b74d0532e5",
                "filename": "src/Node/Expression/GetAttrExpression.php",
                "status": "modified",
                "additions": 28,
                "deletions": 5,
                "changes": 33,
                "blob_url": "https://github.com/twigphp/Twig/blob/831c148e786178e5f2fde9db67266be3bf241c21/src%2FNode%2FExpression%2FGetAttrExpression.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/831c148e786178e5f2fde9db67266be3bf241c21/src%2FNode%2FExpression%2FGetAttrExpression.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/src%2FNode%2FExpression%2FGetAttrExpression.php?ref=831c148e786178e5f2fde9db67266be3bf241c21",
                "patch": "@@ -31,6 +31,7 @@ public function __construct(AbstractExpression $node, AbstractExpression $attrib\n     public function compile(Compiler $compiler): void\n     {\n         $env = $compiler->getEnvironment();\n+        $arrayAccessSandbox = false;\n \n         // optimize array calls\n         if (\n@@ -44,17 +45,35 @@ public function compile(Compiler $compiler): void\n                 ->raw('(('.$var.' = ')\n                 ->subcompile($this->getNode('node'))\n                 ->raw(') && is_array(')\n-                ->raw($var)\n+                ->raw($var);\n+\n+            if (!$env->hasExtension(SandboxExtension::class)) {\n+                $compiler\n+                    ->raw(') || ')\n+                    ->raw($var)\n+                    ->raw(' instanceof ArrayAccess ? (')\n+                    ->raw($var)\n+                    ->raw('[')\n+                    ->subcompile($this->getNode('attribute'))\n+                    ->raw('] ?? null) : null)')\n+                ;\n+\n+                return;\n+            }\n+\n+            $arrayAccessSandbox = true;\n+\n+            $compiler\n                 ->raw(') || ')\n                 ->raw($var)\n-                ->raw(' instanceof ArrayAccess ? (')\n+                ->raw(' instanceof ArrayAccess && in_array(')\n+                ->raw($var.'::class')\n+                ->raw(', CoreExtension::ARRAY_LIKE_CLASSES, true) ? (')\n                 ->raw($var)\n                 ->raw('[')\n                 ->subcompile($this->getNode('attribute'))\n-                ->raw('] ?? null) : null)')\n+                ->raw('] ?? null) : ')\n             ;\n-\n-            return;\n         }\n \n         $compiler->raw('CoreExtension::getAttribute($this->env, $this->source, ');\n@@ -83,5 +102,9 @@ public function compile(Compiler $compiler): void\n             ->raw(', ')->repr($this->getNode('node')->getTemplateLine())\n             ->raw(')')\n         ;\n+\n+        if ($arrayAccessSandbox) {\n+            $compiler->raw(')');\n+        }\n     }\n }"
            },
            {
                "sha": "999483241ae5c74733aae0c5b2cda4aa37f676d5",
                "filename": "tests/Extension/SandboxTest.php",
                "status": "modified",
                "additions": 60,
                "deletions": 6,
                "changes": 66,
                "blob_url": "https://github.com/twigphp/Twig/blob/831c148e786178e5f2fde9db67266be3bf241c21/tests%2FExtension%2FSandboxTest.php",
                "raw_url": "https://github.com/twigphp/Twig/raw/831c148e786178e5f2fde9db67266be3bf241c21/tests%2FExtension%2FSandboxTest.php",
                "contents_url": "https://api.github.com/repos/twigphp/Twig/contents/tests%2FExtension%2FSandboxTest.php?ref=831c148e786178e5f2fde9db67266be3bf241c21",
                "patch": "@@ -43,6 +43,8 @@ protected function setUp(): void\n             'arr' => ['obj' => new FooObject()],\n             'child_obj' => new ChildClass(),\n             'some_array' => [5, 6, 7, new FooObject()],\n+            'array_like' => new ArrayLikeObject(),\n+            'magic' => new MagicObject(),\n         ];\n \n         self::$templates = [\n@@ -66,6 +68,7 @@ protected function setUp(): void\n             '1_childobj_parentmethod' => '{{ child_obj.ParentMethod() }}',\n             '1_childobj_childmethod' => '{{ child_obj.ChildMethod() }}',\n             '1_empty' => '',\n+            '1_array_like' => '{{ array_like[\"foo\"] }}',\n         ];\n     }\n \n@@ -141,15 +144,31 @@ public function testSandboxGloballySet()\n         $this->assertEquals('FOO', $twig->load('1_basic')->render(self::$params), 'Sandbox does nothing if it is disabled globally');\n     }\n \n-    public function testSandboxUnallowedMethodAccessor()\n+    public function testSandboxUnallowedPropertyAccessor()\n     {\n         $twig = $this->getEnvironment(true, [], self::$templates);\n         try {\n-            $twig->load('1_basic1')->render(self::$params);\n+            $twig->load('1_basic1')->render(['obj' => new MagicObject()]);\n             $this->fail('Sandbox throws a SecurityError exception if an unallowed method is called');\n-        } catch (SecurityNotAllowedMethodError $e) {\n-            $this->assertEquals('Twig\\Tests\\Extension\\FooObject', $e->getClassName(), 'Exception should be raised on the \"Twig\\Tests\\Extension\\FooObject\" class');\n-            $this->assertEquals('foo', $e->getMethodName(), 'Exception should be raised on the \"foo\" method');\n+        } catch (SecurityNotAllowedPropertyError $e) {\n+            $this->assertEquals('Twig\\Tests\\Extension\\MagicObject', $e->getClassName(), 'Exception should be raised on the \"Twig\\Tests\\Extension\\MagicObject\" class');\n+            $this->assertEquals('foo', $e->getPropertyName(), 'Exception should be raised on the \"foo\" property');\n+        }\n+    }\n+\n+    public function testSandboxUnallowedArrayIndexAccessor()\n+    {\n+        $twig = $this->getEnvironment(true, [], self::$templates);\n+\n+        // ArrayObject and other internal array-like classes are exempted from sandbox restrictions\n+        $this->assertSame('bar', $twig->load('1_array_like')->render(['array_like' => new \\ArrayObject(['foo' => 'bar'])]));\n+\n+        try {\n+            $twig->load('1_array_like')->render(self::$params);\n+            $this->fail('Sandbox throws a SecurityError exception if an unallowed method is called');\n+        } catch (SecurityNotAllowedPropertyError $e) {\n+            $this->assertEquals('Twig\\Tests\\Extension\\ArrayLikeObject', $e->getClassName(), 'Exception should be raised on the \"Twig\\Tests\\Extension\\ArrayLikeObject\" class');\n+            $this->assertEquals('foo', $e->getPropertyName(), 'Exception should be raised on the \"foo\" property');\n         }\n     }\n \n@@ -300,7 +319,8 @@ public static function getSandboxAllowedToStringTests()\n         return [\n             'constant_test' => ['{{ obj is constant(\"PHP_INT_MAX\") }}', ''],\n             'set_object' => ['{% set a = obj.anotherFooObject %}{{ a.foo }}', 'foo'],\n-            'is_defined' => ['{{ obj.anotherFooObject is defined }}', '1'],\n+            'is_defined1' => ['{{ obj.anotherFooObject is defined }}', '1'],\n+            'is_defined2' => ['{{ magic.foo is defined }}', ''],\n             'is_null' => ['{{ obj is null }}', ''],\n             'is_sameas' => ['{{ obj is same as(obj) }}', '1'],\n             'is_sameas_no_brackets' => ['{{ obj is same as obj }}', '1'],\n@@ -610,3 +630,37 @@ public function getAnotherFooObject()\n         return new self();\n     }\n }\n+\n+class ArrayLikeObject extends \\ArrayObject\n+{\n+    public function offsetExists($offset): bool\n+    {\n+        throw new \\BadMethodCallException('Should not be called');\n+    }\n+\n+    public function offsetGet($offset): mixed\n+    {\n+        throw new \\BadMethodCallException('Should not be called');\n+    }\n+\n+    public function offsetSet($offset, $value): void\n+    {\n+    }\n+\n+    public function offsetUnset($offset): void\n+    {\n+    }\n+}\n+\n+class MagicObject\n+{\n+    public function __get($name): mixed\n+    {\n+        throw new \\BadMethodCallException('Should not be called');\n+    }\n+\n+    public function __isset($name): bool\n+    {\n+        throw new \\BadMethodCallException('Should not be called');\n+    }\n+}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/capricorn86/happy-dom/commits/5ee0b1676d4ce20cc2a70d1c9c8d6f1e3f57efac",
        "url": "https://api.github.com/repos/capricorn86/happy-dom/commits/5ee0b1676d4ce20cc2a70d1c9c8d6f1e3f57efac",
        "html_url": "https://github.com/capricorn86/happy-dom/commit/5ee0b1676d4ce20cc2a70d1c9c8d6f1e3f57efac",
        "message": "fix: [#1585] Fixes security vulnerability that allowed for server side code to be executed by a <script> tag (#1586)\n\n* fix: [#1585] Fixes security vulnerability that allowed for server side code to be executed by a <script> tag\r\n\r\n* chore: [#1585] Fixes unit test",
        "files": [
            {
                "sha": "e9e8c7c959cb283eba14e23feb5abbc5aef55245",
                "filename": "packages/happy-dom/src/fetch/utilities/SyncFetchScriptBuilder.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/capricorn86/happy-dom/blob/5ee0b1676d4ce20cc2a70d1c9c8d6f1e3f57efac/packages%2Fhappy-dom%2Fsrc%2Ffetch%2Futilities%2FSyncFetchScriptBuilder.ts",
                "raw_url": "https://github.com/capricorn86/happy-dom/raw/5ee0b1676d4ce20cc2a70d1c9c8d6f1e3f57efac/packages%2Fhappy-dom%2Fsrc%2Ffetch%2Futilities%2FSyncFetchScriptBuilder.ts",
                "contents_url": "https://api.github.com/repos/capricorn86/happy-dom/contents/packages%2Fhappy-dom%2Fsrc%2Ffetch%2Futilities%2FSyncFetchScriptBuilder.ts?ref=5ee0b1676d4ce20cc2a70d1c9c8d6f1e3f57efac",
                "patch": "@@ -23,6 +23,7 @@ export default class SyncFetchScriptBuilder {\n \t}): string {\n \t\tconst sortedHeaders = {};\n \t\tconst headerNames = Object.keys(request.headers).sort();\n+\n \t\tfor (const name of headerNames) {\n \t\t\tsortedHeaders[name] = request.headers[name];\n \t\t}\n@@ -43,7 +44,7 @@ export default class SyncFetchScriptBuilder {\n \t\t\t\t\t\t\t\t\tnull,\n \t\t\t\t\t\t\t\t\t4\n \t\t\t\t\t\t\t\t)};\n-                const request = sendRequest('${request.url.href}', options, (incomingMessage) => {\n+                const request = sendRequest(\\`${request.url.href}\\`, options, (incomingMessage) => {\n                     let data = Buffer.alloc(0);\n                     incomingMessage.on('data', (chunk) => {\n                         data = Buffer.concat([data, Buffer.from(chunk)]);"
            },
            {
                "sha": "35945435ef8ada7ce5223a96509dd4b2c3f946a4",
                "filename": "packages/happy-dom/test/fetch/SyncFetch.test.ts",
                "status": "modified",
                "additions": 66,
                "deletions": 0,
                "changes": 66,
                "blob_url": "https://github.com/capricorn86/happy-dom/blob/5ee0b1676d4ce20cc2a70d1c9c8d6f1e3f57efac/packages%2Fhappy-dom%2Ftest%2Ffetch%2FSyncFetch.test.ts",
                "raw_url": "https://github.com/capricorn86/happy-dom/raw/5ee0b1676d4ce20cc2a70d1c9c8d6f1e3f57efac/packages%2Fhappy-dom%2Ftest%2Ffetch%2FSyncFetch.test.ts",
                "contents_url": "https://api.github.com/repos/capricorn86/happy-dom/contents/packages%2Fhappy-dom%2Ftest%2Ffetch%2FSyncFetch.test.ts?ref=5ee0b1676d4ce20cc2a70d1c9c8d6f1e3f57efac",
                "patch": "@@ -249,6 +249,72 @@ describe('SyncFetch', () => {\n \t\t\texpect(response.body.toString()).toBe(responseText);\n \t\t});\n \n+\t\tit('Should not allow to inject code into scripts executed using child_process.execFileSync().', () => {\n+\t\t\tbrowserFrame.url = 'https://localhost:8080/';\n+\n+\t\t\tconst url =\n+\t\t\t\t\"https://localhost:8080/`+require('child_process').execSync('id')+`/'+require('child_process').execSync('id')+'\";\n+\t\t\tconst responseText = 'test';\n+\n+\t\t\tmockModule('child_process', {\n+\t\t\t\texecFileSync: (\n+\t\t\t\t\tcommand: string,\n+\t\t\t\t\targs: string[],\n+\t\t\t\t\toptions: { encoding: string; maxBuffer: number }\n+\t\t\t\t) => {\n+\t\t\t\t\texpect(command).toEqual(process.argv[0]);\n+\t\t\t\t\texpect(args[0]).toBe('-e');\n+\t\t\t\t\texpect(args[1]).toBe(\n+\t\t\t\t\t\tSyncFetchScriptBuilder.getScript({\n+\t\t\t\t\t\t\turl: new URL(\n+\t\t\t\t\t\t\t\t\"https://localhost:8080/%60+require('child_process').execSync('id')+%60/'+require('child_process').execSync('id')+'\"\n+\t\t\t\t\t\t\t),\n+\t\t\t\t\t\t\tmethod: 'GET',\n+\t\t\t\t\t\t\theaders: {\n+\t\t\t\t\t\t\t\tAccept: '*/*',\n+\t\t\t\t\t\t\t\tConnection: 'close',\n+\t\t\t\t\t\t\t\tReferer: 'https://localhost:8080/',\n+\t\t\t\t\t\t\t\t'User-Agent': window.navigator.userAgent,\n+\t\t\t\t\t\t\t\t'Accept-Encoding': 'gzip, deflate, br'\n+\t\t\t\t\t\t\t},\n+\t\t\t\t\t\t\tbody: null\n+\t\t\t\t\t\t})\n+\t\t\t\t\t);\n+\t\t\t\t\t// new URL() will convert ` into %60\n+\t\t\t\t\t// By using ` for the URL string within the script, we can prevent the script from being injected\n+\t\t\t\t\texpect(\n+\t\t\t\t\t\targs[1].includes(\n+\t\t\t\t\t\t\t`\\`https://localhost:8080/%60+require('child_process').execSync('id')+%60/'+require('child_process').execSync('id')+'\\``\n+\t\t\t\t\t\t)\n+\t\t\t\t\t).toBe(true);\n+\t\t\t\t\texpect(options).toEqual({\n+\t\t\t\t\t\tencoding: 'buffer',\n+\t\t\t\t\t\tmaxBuffer: 1024 * 1024 * 1024\n+\t\t\t\t\t});\n+\t\t\t\t\treturn JSON.stringify({\n+\t\t\t\t\t\terror: null,\n+\t\t\t\t\t\tincomingMessage: {\n+\t\t\t\t\t\t\tstatusCode: 200,\n+\t\t\t\t\t\t\tstatusMessage: 'OK',\n+\t\t\t\t\t\t\trawHeaders: [],\n+\t\t\t\t\t\t\tdata: Buffer.from(responseText).toString('base64')\n+\t\t\t\t\t\t}\n+\t\t\t\t\t});\n+\t\t\t\t}\n+\t\t\t});\n+\n+\t\t\tconst response = new SyncFetch({\n+\t\t\t\tbrowserFrame,\n+\t\t\t\twindow,\n+\t\t\t\turl,\n+\t\t\t\tinit: {\n+\t\t\t\t\tmethod: 'GET'\n+\t\t\t\t}\n+\t\t\t}).send();\n+\n+\t\t\texpect(response.body.toString()).toBe(responseText);\n+\t\t});\n+\n \t\tit('Should send custom key/value object request headers.', () => {\n \t\t\tbrowserFrame.url = 'https://localhost:8080/';\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/capricorn86/happy-dom/commits/d23834c232f1cf5519c9418b073f1dcec6b2f0fd",
        "url": "https://api.github.com/repos/capricorn86/happy-dom/commits/d23834c232f1cf5519c9418b073f1dcec6b2f0fd",
        "html_url": "https://github.com/capricorn86/happy-dom/commit/d23834c232f1cf5519c9418b073f1dcec6b2f0fd",
        "message": "fix: [#1585] Fixes a security vulnerability that allowed for server side code to be executed by a <script> tag (#1588)",
        "files": [
            {
                "sha": "6b6eea1ed37ad39013dc9edc4112d25294f3713f",
                "filename": "packages/happy-dom/src/fetch/utilities/SyncFetchScriptBuilder.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/capricorn86/happy-dom/blob/d23834c232f1cf5519c9418b073f1dcec6b2f0fd/packages%2Fhappy-dom%2Fsrc%2Ffetch%2Futilities%2FSyncFetchScriptBuilder.ts",
                "raw_url": "https://github.com/capricorn86/happy-dom/raw/d23834c232f1cf5519c9418b073f1dcec6b2f0fd/packages%2Fhappy-dom%2Fsrc%2Ffetch%2Futilities%2FSyncFetchScriptBuilder.ts",
                "contents_url": "https://api.github.com/repos/capricorn86/happy-dom/contents/packages%2Fhappy-dom%2Fsrc%2Ffetch%2Futilities%2FSyncFetchScriptBuilder.ts?ref=d23834c232f1cf5519c9418b073f1dcec6b2f0fd",
                "patch": "@@ -44,7 +44,9 @@ export default class SyncFetchScriptBuilder {\n \t\t\t\t\t\t\t\t\tnull,\n \t\t\t\t\t\t\t\t\t4\n \t\t\t\t\t\t\t\t)};\n-                const request = sendRequest(\\`${request.url.href}\\`, options, (incomingMessage) => {\n+                const request = sendRequest(${JSON.stringify(\n+\t\t\t\t\t\t\t\t\trequest.url.href\n+\t\t\t\t\t\t\t\t)}, options, (incomingMessage) => {\n                     let data = Buffer.alloc(0);\n                     incomingMessage.on('data', (chunk) => {\n                         data = Buffer.concat([data, Buffer.from(chunk)]);"
            },
            {
                "sha": "6b781a56521a23c536c805f507b5dada0661c130",
                "filename": "packages/happy-dom/test/fetch/SyncFetch.test.ts",
                "status": "modified",
                "additions": 3,
                "deletions": 6,
                "changes": 9,
                "blob_url": "https://github.com/capricorn86/happy-dom/blob/d23834c232f1cf5519c9418b073f1dcec6b2f0fd/packages%2Fhappy-dom%2Ftest%2Ffetch%2FSyncFetch.test.ts",
                "raw_url": "https://github.com/capricorn86/happy-dom/raw/d23834c232f1cf5519c9418b073f1dcec6b2f0fd/packages%2Fhappy-dom%2Ftest%2Ffetch%2FSyncFetch.test.ts",
                "contents_url": "https://api.github.com/repos/capricorn86/happy-dom/contents/packages%2Fhappy-dom%2Ftest%2Ffetch%2FSyncFetch.test.ts?ref=d23834c232f1cf5519c9418b073f1dcec6b2f0fd",
                "patch": "@@ -252,8 +252,7 @@ describe('SyncFetch', () => {\n \t\tit('Should not allow to inject code into scripts executed using child_process.execFileSync().', () => {\n \t\t\tbrowserFrame.url = 'https://localhost:8080/';\n \n-\t\t\tconst url =\n-\t\t\t\t\"https://localhost:8080/`+require('child_process').execSync('id')+`/'+require('child_process').execSync('id')+'\";\n+\t\t\tconst url = `https://localhost:8080/\\`+require('child_process').execSync('id')+\\`/'+require('child_process').execSync('id')+'/?key=\"+require('child_process').execSync('id')+\"`;\n \t\t\tconst responseText = 'test';\n \n \t\t\tmockModule('child_process', {\n@@ -267,7 +266,7 @@ describe('SyncFetch', () => {\n \t\t\t\t\texpect(args[1]).toBe(\n \t\t\t\t\t\tSyncFetchScriptBuilder.getScript({\n \t\t\t\t\t\t\turl: new URL(\n-\t\t\t\t\t\t\t\t\"https://localhost:8080/%60+require('child_process').execSync('id')+%60/'+require('child_process').execSync('id')+'\"\n+\t\t\t\t\t\t\t\t`https://localhost:8080/\\`+require('child_process').execSync('id')+\\`/'+require('child_process').execSync('id')+'/?key=\"+require('child_process').execSync('id')+\"`\n \t\t\t\t\t\t\t),\n \t\t\t\t\t\t\tmethod: 'GET',\n \t\t\t\t\t\t\theaders: {\n@@ -280,11 +279,9 @@ describe('SyncFetch', () => {\n \t\t\t\t\t\t\tbody: null\n \t\t\t\t\t\t})\n \t\t\t\t\t);\n-\t\t\t\t\t// new URL() will convert ` into %60\n-\t\t\t\t\t// By using ` for the URL string within the script, we can prevent the script from being injected\n \t\t\t\t\texpect(\n \t\t\t\t\t\targs[1].includes(\n-\t\t\t\t\t\t\t`\\`https://localhost:8080/%60+require('child_process').execSync('id')+%60/'+require('child_process').execSync('id')+'\\``\n+\t\t\t\t\t\t\t`\"https://localhost:8080/%60+require('child_process').execSync('id')+%60/'+require('child_process').execSync('id')+'/?key=%22+require(%27child_process%27).execSync(%27id%27)+%22\"`\n \t\t\t\t\t\t)\n \t\t\t\t\t).toBe(true);\n \t\t\t\t\texpect(options).toEqual({"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Ericsson/codechecker/commits/866f3796d01f3158c49b87ccae3e09c0807c1c7b",
        "url": "https://api.github.com/repos/Ericsson/codechecker/commits/866f3796d01f3158c49b87ccae3e09c0807c1c7b",
        "html_url": "https://github.com/Ericsson/codechecker/commit/866f3796d01f3158c49b87ccae3e09c0807c1c7b",
        "message": "Removing the root user creation\n\nInstead the user can assign\nthe super user role to a user",
        "files": [
            {
                "sha": "69a2683e1e8c281aa082a1301c56d0adc986fa81",
                "filename": "docs/web/permissions.md",
                "status": "modified",
                "additions": 28,
                "deletions": 33,
                "changes": 61,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/866f3796d01f3158c49b87ccae3e09c0807c1c7b/docs%2Fweb%2Fpermissions.md",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/866f3796d01f3158c49b87ccae3e09c0807c1c7b/docs%2Fweb%2Fpermissions.md",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/docs%2Fweb%2Fpermissions.md?ref=866f3796d01f3158c49b87ccae3e09c0807c1c7b",
                "patch": "@@ -18,45 +18,40 @@ on the product level.\n \n Table of Contents\n =================\n-* [The master superuser (root)](#the-master-superuser)\n-* [Managing permissions](#managing-permissions)\n-* [Permission concepts](#permission-concepts)\n-    * [Default value](#default-value)\n-    * [Permission inheritance](#permission-inheritance)\n-    * [Permission manager](#permission-manager)\n-* [Available permissions](#available-permissions)\n-    * [Server-wide (global) permissions](#global-permissions)\n-        * [`SUPERUSER`](#superuser)\n-        * [`PERMISSION_VIEW`](#permission-view)\n-    * [Product-level permissions](#product-level-permissions)\n-        * [`PRODUCT_ADMIN`](#product-admin)\n-        * [`PRODUCT_ACCESS`](#product-access)\n-        * [`PRODUCT_STORE`](#product-store)\n-        * [`PRODUCT_VIEW`](#product-view)\n+- [Permission subsystem](#permission-subsystem)\n+- [Table of Contents](#table-of-contents)\n+- [The master superuser (root) ](#the-master-superuser-root-)\n+- [Managing permissions ](#managing-permissions-)\n+- [Permission concepts ](#permission-concepts-)\n+  - [Default value ](#default-value-)\n+  - [Permission inheritance ](#permission-inheritance-)\n+  - [Permission manager ](#permission-manager-)\n+- [Available permissions ](#available-permissions-)\n+  - [Server-wide (global) permissions ](#server-wide-global-permissions-)\n+    - [`SUPERUSER` ](#superuser-)\n+    - [`PERMISSION_VIEW`](#permission_view)\n+  - [Product-level permissions ](#product-level-permissions-)\n+    - [`PRODUCT_ADMIN` ](#product_admin-)\n+    - [`PRODUCT_ACCESS` ](#product_access-)\n+    - [`PRODUCT_STORE` ](#product_store-)\n+    - [`PRODUCT_VIEW` ](#product_view-)\n \n # The master superuser (root) <a name=\"the-master-superuser\"></a>\n \n-Each CodeChecker server at its first start generates a master superuser\n-(*root*) access credential which it prints into its standard output:\n \n+At the first CodeChecker startup it is recommended that\n+you set up a single user with  `SUPERUSER` permission.\n+Then with this user you will be able to configure additional permissions\n+for other users in the WEB GUI.\n+Let's say you want to give `SUPERUSER` permission to user `admin`.\n+Then set `super_user` field in the `server_config.json` configuration file:\n ```sh\n-[WARNING] Server started without 'root.user' present in CONFIG_DIRECTORY!\n-A NEW superuser credential was generated for the server. This information IS\n-SAVED, thus subsequent server starts WILL use these credentials. You WILL NOT\n-get to see the credentials again, so MAKE SURE YOU REMEMBER THIS LOGIN!\n------------------------------------------------------------------\n-The superuser's username is 'AAAAAA' with the password 'aaaa0000'\n------------------------------------------------------------------\n+\"authentication\": {\n+    \"enabled\" : true,\n+    \"super_user\" : \"admin\",\n+...\n ```\n \n-These credentials can be deleted and new ones can be requested by starting\n-CodeChecker server with the `--reset-root` flag. The credentials are always\n-**randomly generated**.\n-\n-If the server has authentication enabled, the *root* user will **always have\n-access** despite of the configured authentication backends' decision, and\n-will automatically **have the `SUPERUSER` permission**.\n-\n # Managing permissions <a name=\"managing-permissions\"></a>\n \n ![Global permission manager](images/permissions.png)\n@@ -184,4 +179,4 @@ delete existing analysis runs from the server.\n |---------|-----------------|-----------------|\n | Granted | `PRODUCT_ADMIN` | `PRODUCT_ADMIN`, `PRODUCT_STORE`, `PRODUCT_ACCESS` |\n \n-Users need the `PRODUCT_VIEW` permission to `view` analysis runs without modifying any properties of the runs. \n\\ No newline at end of file\n+Users need the `PRODUCT_VIEW` permission to `view` analysis runs without modifying any properties of the runs.\n\\ No newline at end of file"
            },
            {
                "sha": "c5ca9b9004ca2db4ff883f716752c4a594516121",
                "filename": "docs/web/user_guide.md",
                "status": "modified",
                "additions": 18,
                "deletions": 23,
                "changes": 41,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/866f3796d01f3158c49b87ccae3e09c0807c1c7b/docs%2Fweb%2Fuser_guide.md",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/866f3796d01f3158c49b87ccae3e09c0807c1c7b/docs%2Fweb%2Fuser_guide.md",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/docs%2Fweb%2Fuser_guide.md?ref=866f3796d01f3158c49b87ccae3e09c0807c1c7b",
                "patch": "@@ -12,8 +12,8 @@\n       - [Configuring database and server settings location](#configuring-database-and-server-settings-location)\n         - [Server Configuration (Authentication and Server Limits)](#server-configuration-authentication-and-server-limits)\n         - [Database Configuration](#database-configuration)\n-      - [Master superuser and authentication forcing](#master-superuser-and-authentication-forcing)\n-      - [Enfore secure socket (TLS/SSL)](#enfore-secure-socket-ssl)\n+      - [Initial super-user](#initial-super-user)\n+      - [Enfore secure socket (TLS/SSL)](#enfore-secure-socket-tlsssl)\n       - [Managing running servers](#managing-running-servers)\n       - [Manage server database upgrades](#manage-server-database-upgrades)\n     - [`store`](#store)\n@@ -150,7 +150,7 @@ usage: CodeChecker server [-h] [-w WORKSPACE] [-f CONFIG_DIRECTORY]\n                           [--sqlite SQLITE_FILE | --postgresql]\n                           [--dbaddress DBADDRESS] [--dbport DBPORT]\n                           [--dbusername DBUSERNAME] [--dbname DBNAME]\n-                          [--reset-root] [--force-authentication]\n+                          [--force-authentication]\n                           [-l | -r | -s | --stop-all]\n                           [--db-status STATUS | --db-upgrade-schema PRODUCT_TO_UPGRADE | --db-force-upgrade]\n                           [--verbose {info,debug,debug_analyzer}]\n@@ -309,26 +309,21 @@ project.\n **It is recommended to use only the Postgresql databse for production\n deployments!**\n \n-#### Master superuser and authentication forcing\n-\n-```\n-root account arguments:\n-  Servers automatically create a root user to access the server's\n-  configuration via the clients. This user is created at first start and\n-  saved in the CONFIG_DIRECTORY, and the credentials are printed to the\n-  server's standard output. The plaintext credentials are NEVER accessible\n-  again.\n-\n-  --reset-root          Force the server to recreate the master superuser\n-                        (root) account name and password. The previous\n-                        credentials will be invalidated, and the new ones will\n-                        be printed to the standard output.\n-  --force-authentication\n-                        Force the server to run in authentication requiring\n-                        mode, despite the configuration value in\n-                        'session_config.json'. This is needed if you need to\n-                        edit the product configuration of a server that would\n-                        not require authentication otherwise.\n+#### Initial super-user\n+\n+You can give a single user SUPER_USER permission\n+by setting the `super_user` field in the `authentication`\n+section of the `server_config.json`.\n+The user which is set here, must be an existing user.\n+For example it should be a user\n+with dictionary authentication method.\n+\n+```\n+ \"authentication\": {\n+    \"enabled\" : true,\n+    \"super_user\" : \"admin\",\n+...\n+\n ```\n \n #### Enfore secure socket (TLS/SSL)"
            },
            {
                "sha": "c7781250b88453293ce4782364d307c44c09140f",
                "filename": "web/server/codechecker_server/cmd/server.py",
                "status": "modified",
                "additions": 0,
                "deletions": 20,
                "changes": 20,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Fserver%2Fcodechecker_server%2Fcmd%2Fserver.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Fserver%2Fcodechecker_server%2Fcmd%2Fserver.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Fcodechecker_server%2Fcmd%2Fserver.py?ref=866f3796d01f3158c49b87ccae3e09c0807c1c7b",
                "patch": "@@ -212,17 +212,6 @@ def add_arguments_to_parser(parser):\n CONFIG_DIRECTORY, and the credentials are printed to the server's standard\n output. The plaintext credentials are NEVER accessible again.\"\"\")\n \n-    root_account.add_argument('--reset-root',\n-                              dest=\"reset_root\",\n-                              action='store_true',\n-                              default=argparse.SUPPRESS,\n-                              required=False,\n-                              help=\"Force the server to recreate the master \"\n-                                   \"superuser (root) account name and \"\n-                                   \"password. The previous credentials will \"\n-                                   \"be invalidated, and the new ones will be \"\n-                                   \"printed to the standard output.\")\n-\n     root_account.add_argument('--force-authentication',\n                               dest=\"force_auth\",\n                               action='store_true',\n@@ -932,15 +921,6 @@ def server_init_start(args):\n             not os.path.isdir(os.path.dirname(args.sqlite)):\n         os.makedirs(os.path.dirname(args.sqlite))\n \n-    if 'reset_root' in args:\n-        try:\n-            os.remove(os.path.join(args.config_directory, 'root.user'))\n-            LOG.info(\"Master superuser (root) credentials invalidated and \"\n-                     \"deleted. New ones will be generated...\")\n-        except OSError:\n-            # File doesn't exist.\n-            pass\n-\n     if 'force_auth' in args:\n         LOG.info(\"'--force-authentication' was passed as a command-line \"\n                  \"option. The server will ask for users to authenticate!\")"
            },
            {
                "sha": "36f2713bd2be5016c3f19f3f2c41bea5181d06fc",
                "filename": "web/server/codechecker_server/server.py",
                "status": "modified",
                "additions": 11,
                "deletions": 59,
                "changes": 70,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Fserver%2Fcodechecker_server%2Fserver.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Fserver%2Fcodechecker_server%2Fserver.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Fcodechecker_server%2Fserver.py?ref=866f3796d01f3158c49b87ccae3e09c0807c1c7b",
                "patch": "@@ -14,17 +14,14 @@\n import atexit\n import datetime\n from functools import partial\n-from hashlib import sha256\n from http.server import HTTPServer, SimpleHTTPRequestHandler\n import os\n import posixpath\n-from random import sample\n import shutil\n import signal\n import socket\n import ssl\n import sys\n-import stat\n from typing import List, Optional, Tuple\n import urllib\n \n@@ -68,8 +65,6 @@\n     Configuration as ORMConfiguration\n from .database.database import DBSession\n from .database.run_db_model import IDENTIFIER as RUN_META, Run, RunLock\n-from .tmp import get_tmp_dir_hash\n-\n \n LOG = get_logger('server')\n \n@@ -991,43 +986,6 @@ class CCSimpleHttpServerIPv6(CCSimpleHttpServer):\n     address_family = socket.AF_INET6\n \n \n-def __make_root_file(root_file):\n-    \"\"\"\n-    Generate a root username and password SHA. This hash is saved to the\n-    given file path, and is also returned.\n-    \"\"\"\n-\n-    LOG.debug(\"Generating initial superuser (root) credentials...\")\n-\n-    username = ''.join(sample(\"ABCDEFGHIJKLMNOPQRSTUVWXYZ\", 6))\n-    password = get_tmp_dir_hash()[:8]\n-\n-    LOG.info(\"A NEW superuser credential was generated for the server. \"\n-             \"This information IS SAVED, thus subsequent server starts \"\n-             \"WILL use these credentials. You WILL NOT get to see \"\n-             \"the credentials again, so MAKE SURE YOU REMEMBER THIS \"\n-             \"LOGIN!\")\n-\n-    # Highlight the message a bit more, as the server owner configuring the\n-    # server must know this root access initially.\n-    credential_msg = f\"The superuser's username is '{username}' with the \" \\\n-                     f\"password '{password}'\"\n-    LOG.info(\"-\" * len(credential_msg))\n-    LOG.info(credential_msg)\n-    LOG.info(\"-\" * len(credential_msg))\n-\n-    sha = sha256((username + ':' + password).encode('utf-8')).hexdigest()\n-    secret = f\"{username}:{sha}\"\n-    with open(root_file, 'w', encoding=\"utf-8\", errors=\"ignore\") as f:\n-        LOG.debug(\"Save root SHA256 '%s'\", secret)\n-        f.write(secret)\n-\n-    # This file should be only readable by the process owner, and noone else.\n-    os.chmod(root_file, stat.S_IRUSR)\n-\n-    return secret\n-\n-\n def start_server(config_directory, package_data, port, config_sql_server,\n                  listen_address, force_auth, skip_db_cleanup: bool,\n                  context, check_env):\n@@ -1038,22 +996,17 @@ def start_server(config_directory, package_data, port, config_sql_server,\n \n     server_addr = (listen_address, port)\n \n+    # The root user file is DEPRECATED AND IGNORED\n     root_file = os.path.join(config_directory, 'root.user')\n-    if not os.path.exists(root_file):\n-        LOG.warning(\"Server started without 'root.user' present in \"\n-                    \"CONFIG_DIRECTORY!\")\n-        root_sha = __make_root_file(root_file)\n-    else:\n-        LOG.debug(\"Root file was found. Loading...\")\n-        try:\n-            with open(root_file, 'r', encoding=\"utf-8\", errors=\"ignore\") as f:\n-                root_sha = f.read()\n-            LOG.debug(\"Root digest is '%s'\", root_sha)\n-        except IOError:\n-            LOG.info(\"Cannot open root file '%s' even though it exists\",\n-                     root_file)\n-            root_sha = __make_root_file(root_file)\n-\n+    if os.path.exists(root_file):\n+        LOG.warning(\"The 'root.user' file:  %s\"\n+                    \" is deprecated and ignored. If you want to\"\n+                    \" setup an initial user with SUPER_USER permission,\"\n+                    \" configure the super_user field in the server_config.json\"\n+                    \" as described in the documentation.\"\n+                    \" To get rid off this warning,\"\n+                    \" simply delete the root.user file.\",\n+                    root_file)\n     # Check whether configuration file exists, create an example if not.\n     server_cfg_file = os.path.join(config_directory, 'server_config.json')\n     if not os.path.exists(server_cfg_file):\n@@ -1077,7 +1030,6 @@ def start_server(config_directory, package_data, port, config_sql_server,\n     try:\n         manager = session_manager.SessionManager(\n             server_cfg_file,\n-            root_sha,\n             force_auth)\n     except IOError as ioerr:\n         LOG.debug(ioerr)\n@@ -1098,7 +1050,7 @@ def start_server(config_directory, package_data, port, config_sql_server,\n                       \"Earlier logs might contain additional detailed \"\n                       \"reasoning.\\n\\t* %s\", len(fails),\n                       \"\\n\\t* \".join(\n-                        (f\"'{ep}' ({reason})\" for (ep, reason) in fails)\n+                          (f\"'{ep}' ({reason})\" for (ep, reason) in fails)\n                       ))\n     else:\n         LOG.debug(\"Skipping db_cleanup, as requested.\")"
            },
            {
                "sha": "2bcae3cbc9d92e0b1c7b3acb5152d8c9f7689c39",
                "filename": "web/server/codechecker_server/session_manager.py",
                "status": "modified",
                "additions": 10,
                "deletions": 33,
                "changes": 43,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Fserver%2Fcodechecker_server%2Fsession_manager.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Fserver%2Fcodechecker_server%2Fsession_manager.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Fcodechecker_server%2Fsession_manager.py?ref=866f3796d01f3158c49b87ccae3e09c0807c1c7b",
                "patch": "@@ -9,7 +9,6 @@\n Handles the management of authentication sessions on the server's side.\n \"\"\"\n \n-import hashlib\n import json\n import os\n import re\n@@ -161,13 +160,12 @@ class SessionManager:\n     CodeChecker server.\n     \"\"\"\n \n-    def __init__(self, configuration_file, root_sha, force_auth=False):\n+    def __init__(self, configuration_file, force_auth=False):\n         \"\"\"\n         Initialise a new Session Manager on the server.\n \n         :param configuration_file: The configuration file to read\n             authentication backends from.\n-        :param root_sha: The SHA-256 hash of the root user's authentication.\n         :param force_auth: If True, the manager will be enabled even if the\n             configuration file disables authentication.\n         \"\"\"\n@@ -199,9 +197,6 @@ def __init__(self, configuration_file, root_sha, force_auth=False):\n         self.__refresh_time = self.__auth_config['refresh_time'] \\\n             if 'refresh_time' in self.__auth_config else None\n \n-        # Save the root SHA into the configuration (but only in memory!)\n-        self.__auth_config['method_root'] = root_sha\n-\n         self.__regex_groups_enabled = False\n \n         # Pre-compile the regular expressions of 'regex_groups'\n@@ -334,17 +329,16 @@ def get_realm(self):\n             \"error\": self.__auth_config.get('realm_error')\n         }\n \n+    @property\n+    def get_super_user(self):\n+        return {\n+            \"super_user\": self.__auth_config.get('super_user'),\n+        }\n+\n     @property\n     def default_superuser_name(self) -> Optional[str]:\n         \"\"\" Get default superuser name. \"\"\"\n-        root = self.__auth_config['method_root'].split(\":\")\n-\n-        # Previously the root file doesn't contain the user name. In this case\n-        # we will return with no user name.\n-        if len(root) <= 1:\n-            return None\n-\n-        return root[0]\n+        return self.__auth_config['super_user']\n \n     def set_database_connection(self, connection):\n         \"\"\"\n@@ -365,8 +359,7 @@ def __handle_validation(self, auth_string):\n \n         This validation object contains two keys: username and groups.\n         \"\"\"\n-        validation = self.__try_auth_root(auth_string) \\\n-            or self.__try_auth_dictionary(auth_string) \\\n+        validation = self.__try_auth_dictionary(auth_string) \\\n             or self.__try_auth_pam(auth_string) \\\n             or self.__try_auth_ldap(auth_string)\n         if not validation:\n@@ -387,22 +380,6 @@ def __is_method_enabled(self, method):\n             'method_' + method in self.__auth_config and \\\n             self.__auth_config['method_' + method].get('enabled')\n \n-    def __try_auth_root(self, auth_string):\n-        \"\"\"\n-        Try to authenticate the user against the root username:password's hash.\n-        \"\"\"\n-        user_name = SessionManager.get_user_name(auth_string)\n-        sha = hashlib.sha256(auth_string.encode('utf8')).hexdigest()\n-\n-        if f\"{user_name}:{sha}\" == self.__auth_config['method_root']:\n-            return {\n-                'username': SessionManager.get_user_name(auth_string),\n-                'groups': [],\n-                'root': True\n-            }\n-\n-        return False\n-\n     def __try_auth_token(self, auth_string):\n         if not self.__database_connection:\n             return None\n@@ -562,7 +539,7 @@ def get_db_auth_session_tokens(self, user_name):\n \n     def __is_root_user(self, user_name):\n         \"\"\" Return True if the given user has system permissions. \"\"\"\n-        if self.__auth_config['method_root'].split(\":\")[0] == user_name:\n+        if self.__auth_config['super_user'] == user_name:\n             return True\n \n         transaction = None"
            },
            {
                "sha": "c1e43a54535816aff99910bb6fae1ebac40160b5",
                "filename": "web/server/vue-cli/e2e/init.workspace.js",
                "status": "modified",
                "additions": 4,
                "deletions": 11,
                "changes": 15,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Fserver%2Fvue-cli%2Fe2e%2Finit.workspace.js",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Fserver%2Fvue-cli%2Fe2e%2Finit.workspace.js",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Fvue-cli%2Fe2e%2Finit.workspace.js?ref=866f3796d01f3158c49b87ccae3e09c0807c1c7b",
                "patch": "@@ -7,20 +7,19 @@ const WORKSPACE_DIR = path.join(CC_DIR, \"workspace\");\n const SERVER_CONFIG = {\n   authentication: {\n     enabled : true,\n+    \"super_user\" : \"root\",\n     session_lifetime : 60000,\n     refresh_time : 60,\n     logins_until_cleanup : 30,\n     method_dictionary: {\n       enabled : true,\n-      auths : [ \"cc:admin\" ],\n+      auths : [ \"cc:admin\",\n+        \"root:S3cr3t\" ],\n       groups : {}\n     }\n   }\n };\n \n-const ROOT_USER =\n-  \"root:2691b13e4c5eadd0adad38983e611b2caa19caaa3476ccf31cbcadddf65c321c\";\n-\n // Create workspace directory if it does not exists.\n if (!fs.existsSync(WORKSPACE_DIR)) {\n   fs.mkdirSync(WORKSPACE_DIR);\n@@ -29,10 +28,4 @@ if (!fs.existsSync(WORKSPACE_DIR)) {\n // Create server configuration file and enable authentication.\n const serverConfigFile = path.join(WORKSPACE_DIR, \"server_config.json\");\n const data = JSON.stringify(SERVER_CONFIG, null, \"  \");\n-fs.writeFileSync(serverConfigFile, data);\n-\n-// Generate initial root credentials.\n-//  - username: root\n-//  - password: S3cr3t\n-const rootUserFile = path.join(WORKSPACE_DIR, \"root.user\");\n-fs.writeFileSync(rootUserFile, ROOT_USER);\n+fs.writeFileSync(serverConfigFile, data);\n\\ No newline at end of file"
            },
            {
                "sha": "725fb0d1778cd133e48fd7cae5e85efdf402cbbd",
                "filename": "web/tests/libtest/env.py",
                "status": "modified",
                "additions": 2,
                "deletions": 10,
                "changes": 12,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Ftests%2Flibtest%2Fenv.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/866f3796d01f3158c49b87ccae3e09c0807c1c7b/web%2Ftests%2Flibtest%2Fenv.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Ftests%2Flibtest%2Fenv.py?ref=866f3796d01f3158c49b87ccae3e09c0807c1c7b",
                "patch": "@@ -10,13 +10,11 @@\n \"\"\"\n \n \n-from hashlib import sha256\n import os\n import json\n import tempfile\n import shutil\n import socket\n-import stat\n import subprocess\n \n from codechecker_common.util import load_json\n@@ -350,11 +348,12 @@ def enable_auth(workspace):\n \n     scfg_dict = load_json(server_cfg_file, {})\n     scfg_dict[\"authentication\"][\"enabled\"] = True\n+    scfg_dict[\"authentication\"][\"super_user\"] = \"root\"\n     scfg_dict[\"authentication\"][\"method_dictionary\"][\"enabled\"] = True\n     scfg_dict[\"authentication\"][\"method_dictionary\"][\"auths\"] = \\\n         [\"cc:test\", \"john:doe\", \"admin:admin123\", \"colon:my:password\",\n          \"admin_group_user:admin123\", \"regex_admin:blah\",\n-         \"permission_view_user:pvu\"]\n+         \"permission_view_user:pvu\", \"root:root\"]\n     scfg_dict[\"authentication\"][\"method_dictionary\"][\"groups\"] = \\\n         {\"admin_group_user\": [\"admin_GROUP\"]}\n     scfg_dict[\"authentication\"][\"regex_groups\"][\"enabled\"] = True\n@@ -363,13 +362,6 @@ def enable_auth(workspace):\n               encoding=\"utf-8\", errors=\"ignore\") as scfg:\n         json.dump(scfg_dict, scfg, indent=2, sort_keys=True)\n \n-    # Create a root user.\n-    root_file = os.path.join(workspace, 'root.user')\n-    with open(root_file, 'w',\n-              encoding='utf-8', errors='ignore') as rootf:\n-        rootf.write(f\"root:{sha256(b'root:root').hexdigest()}\")\n-    os.chmod(root_file, stat.S_IRUSR | stat.S_IWUSR)\n-\n \n def enable_storage_of_analysis_statistics(workspace):\n     \"\"\""
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/Ericsson/codechecker/commits/ad41702e3108e4b92ae5d0143a5b961cc34195eb",
        "url": "https://api.github.com/repos/Ericsson/codechecker/commits/ad41702e3108e4b92ae5d0143a5b961cc34195eb",
        "html_url": "https://github.com/Ericsson/codechecker/commit/ad41702e3108e4b92ae5d0143a5b961cc34195eb",
        "message": "Fix the endpoint parsing issue\n\nURL parsing is hardened in the web server.",
        "files": [
            {
                "sha": "e13a3ed3e74494e4eece8ee12bf293e21b3b8ffd",
                "filename": "web/api/products.thrift",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fapi%2Fproducts.thrift",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fapi%2Fproducts.thrift",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fapi%2Fproducts.thrift?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -74,6 +74,7 @@ service codeCheckerProductService {\n \n   // Get the list of product that matches the display name and endpoint\n   // filters specified.\n+  // PERMISSION: PRODUCT_VIEW\n   Products getProducts(1: string productEndpointFilter,\n                        2: string productNameFilter)\n                        throws (1: codechecker_api_shared.RequestFailed requestError),"
            },
            {
                "sha": "7c34652a311d4854221e2ddcb4ed78cb41e09fa1",
                "filename": "web/api/report_server.thrift",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fapi%2Freport_server.thrift",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fapi%2Freport_server.thrift",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fapi%2Freport_server.thrift?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -688,7 +688,7 @@ service codeCheckerDBAccess {\n                                                           throws (1: codechecker_api_shared.RequestFailed requestError),\n \n   // Return true if review status change is disabled.\n-  // PERMISSION: PRODUCT_ACCESS or PRODUCT_STORE\n+  // PERMISSION: PRODUCT_VIEW\n   bool isReviewStatusChangeDisabled()\n                                     throws (1: codechecker_api_shared.RequestFailed requestError),\n \n@@ -769,6 +769,7 @@ service codeCheckerDBAccess {\n   // get the md documentation for a checker\n   // DEPRECATED. Use getCheckerLabels() instead which contains checker\n   // documentation URL.\n+  // PERMISSION: PRODUCT_VIEW\n   string getCheckerDoc(1: string checkerId)\n                        throws (1: codechecker_api_shared.RequestFailed requestError),\n "
            },
            {
                "sha": "a946f55f1499625f962dde6be48b61f4fafe1ef1",
                "filename": "web/server/codechecker_server/api/config_handler.py",
                "status": "modified",
                "additions": 11,
                "deletions": 2,
                "changes": 13,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Fapi%2Fconfig_handler.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Fapi%2Fconfig_handler.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Fcodechecker_server%2Fapi%2Fconfig_handler.py?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -31,14 +31,23 @@ class ThriftConfigHandler:\n     Manages Thrift requests regarding configuration.\n     \"\"\"\n \n-    def __init__(self, auth_session, config_session):\n+    def __init__(self, auth_session, config_session, session_manager):\n         self.__auth_session = auth_session\n         self.__session = config_session\n+        self.__session_manager = session_manager\n \n     def __require_supermission(self):\n         \"\"\"\n         Checks if the current user isn't a SUPERUSER.\n         \"\"\"\n+\n+        # Anonymous access is only allowed if authentication is\n+        # turned off\n+        if self.__session_manager.is_enabled and not self.__auth_session:\n+            raise codechecker_api_shared.ttypes.RequestFailed(\n+                codechecker_api_shared.ttypes.ErrorCode.UNAUTHORIZED,\n+                \"You are not authorized to execute this action.\")\n+\n         if (not (self.__auth_session is None) and\n                 not self.__auth_session.is_root):\n             raise codechecker_api_shared.ttypes.RequestFailed(\n@@ -69,7 +78,7 @@ def getNotificationBannerText(self):\n     def setNotificationBannerText(self, notification_b64):\n         \"\"\"\n         Sets the notification banner remove_products_except.\n-        Bevare: This method only works if the use is a SUPERUSER.\n+        Beware: This method only works if the use is a SUPERUSER.\n         \"\"\"\n \n         self.__require_supermission()"
            },
            {
                "sha": "5daf42118a4a8444d7832c328986c081f446d64a",
                "filename": "web/server/codechecker_server/api/product_server.py",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Fapi%2Fproduct_server.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Fapi%2Fproduct_server.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Fcodechecker_server%2Fapi%2Fproduct_server.py?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -69,6 +69,13 @@ def __require_permission(self, required, args=None):\n                 args = dict(self.__permission_args)\n                 args['config_db_session'] = session\n \n+            # Anonymous access is only allowed if authentication is\n+            # turned off\n+            if self.__server.manager.is_enabled and not self.__auth_session:\n+                raise codechecker_api_shared.ttypes.RequestFailed(\n+                    codechecker_api_shared.ttypes.ErrorCode.UNAUTHORIZED,\n+                    \"You are not authorized to execute this action.\")\n+\n             if not any(permissions.require_permission(\n                            perm, args, self.__auth_session)\n                        for perm in required):\n@@ -247,6 +254,7 @@ def getProductConfiguration(self, product_id):\n         Get the product configuration --- WITHOUT THE DB PASSWORD --- of the\n         given product.\n         \"\"\"\n+        self.__require_permission([permissions.PRODUCT_VIEW])\n \n         with DBSession(self.__session) as session:\n             product = session.query(Product).get(product_id)"
            },
            {
                "sha": "1e94a3426dafb76cd6c06342dc1bca51f59e9df7",
                "filename": "web/server/codechecker_server/api/report_server.py",
                "status": "modified",
                "additions": 17,
                "deletions": 1,
                "changes": 18,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Fapi%2Freport_server.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Fapi%2Freport_server.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Fcodechecker_server%2Fapi%2Freport_server.py?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -1447,6 +1447,13 @@ def __require_permission(self, required):\n             args = dict(self.__permission_args)\n             args['config_db_session'] = session\n \n+            # Anonymous access is only allowed if authentication is\n+            # turned off\n+            if self._manager.is_enabled and not self._auth_session:\n+                raise codechecker_api_shared.ttypes.RequestFailed(\n+                    codechecker_api_shared.ttypes.ErrorCode.UNAUTHORIZED,\n+                    \"You are not authorized to execute this action.\")\n+\n             if not any(permissions.require_permission(\n                     perm, args, self._auth_session)\n                     for perm in required):\n@@ -2320,6 +2327,7 @@ def _setReviewStatus(self, session, report_hash, status,\n         database transaction. This is needed because during storage a specific\n         session object has to be used.\n         \"\"\"\n+\n         review_status = session.query(ReviewStatus).get(report_hash)\n         if review_status is None:\n             review_status = ReviewStatus()\n@@ -2421,6 +2429,8 @@ def isReviewStatusChangeDisabled(self):\n         \"\"\"\n         Return True if review status change is disabled.\n         \"\"\"\n+        self.__require_view()\n+\n         with DBSession(self._config_database) as session:\n             product = session.query(Product).get(self._product.id)\n             return product.is_review_status_change_disabled\n@@ -2746,7 +2756,7 @@ def getCheckerDoc(self, _):\n         Parameters:\n          - checkerId\n         \"\"\"\n-\n+        self.__require_view()\n         return \"\"\n \n     @exc_to_thrift_reqfail\n@@ -2756,6 +2766,8 @@ def getCheckerLabels(\n         checkers: List[ttypes.Checker]\n     ) -> List[List[str]]:\n         \"\"\" Return the list of labels to each checker. \"\"\"\n+        self.__require_view()\n+\n         labels = []\n         for checker in checkers:\n             analyzer_name = None if not checker.analyzerName \\\n@@ -3569,6 +3581,8 @@ def getFailedFilesCount(self, run_ids):\n         given run. If the run id list is empty the number of failed files will\n         be counted for all of the runs.\n         \"\"\"\n+        self.__require_view()\n+\n         # Unfortunately we can't distinct the failed file paths by using SQL\n         # queries because the list of failed files for a run / analyzer are\n         # stored in one column in a compressed way. For this reason we need to\n@@ -3611,6 +3625,8 @@ def getFailedFiles(self, run_ids):\n     # -----------------------------------------------------------------------\n     @timeit\n     def getPackageVersion(self):\n+        self.__require_view()\n+\n         return self.__package_version\n \n     # -----------------------------------------------------------------------"
            },
            {
                "sha": "dfffe8eea894987c2792505dec6a3caf178cd97e",
                "filename": "web/server/codechecker_server/routing.py",
                "status": "modified",
                "additions": 13,
                "deletions": 8,
                "changes": 21,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Frouting.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Frouting.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Fcodechecker_server%2Frouting.py?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -71,6 +71,8 @@ def is_supported_version(version):\n \n     version = version.lstrip('v')\n     version_parts = version.split('.')\n+    if len(version_parts) < 2:\n+        return False\n \n     # We don't care if accidentally the version tag contains a revision number.\n     major, minor = int(version_parts[0]), int(version_parts[1])\n@@ -115,24 +117,27 @@ def split_client_POST_request(path):\n     \"\"\"\n \n     # A standard POST request from an API client looks like:\n-    # http://localhost:8001/[product-name]/<API version>/<API service>\n+    # http://localhost:8001/[product-name/]<API version>/<API service>\n     # where specifying the product name is optional.\n \n     split_path = urlparse(path).path.split('/', 3)\n \n     endpoint_part = split_path[1]\n-    if is_valid_product_endpoint(split_path[1]):\n+    if is_valid_product_endpoint(split_path[1]) and len(split_path) == 4:\n         version_tag = split_path[2].lstrip('v')\n-        remainder = split_path[3]\n+        if not is_supported_version(version_tag):\n+            return None, None, None\n+        endpoint = split_path[3]\n+        return endpoint_part, version_tag, endpoint\n \n-        return endpoint_part, version_tag, remainder\n-    elif split_path[1].startswith('v'):\n+    elif split_path[1].startswith('v') and len(split_path) == 3:\n         # Request came through without a valid product URL endpoint to\n         # possibly the main server.\n         version_tag = split_path[1].lstrip('v')\n-        remainder = split_path[2]\n-\n-        return None, version_tag, remainder\n+        if not is_supported_version(version_tag):\n+            return None, None, None\n+        endpoint = split_path[2]\n+        return None, version_tag, endpoint\n \n     return None, None, None\n "
            },
            {
                "sha": "2439dc478757884f3125933da3d049ff4e7d2d36",
                "filename": "web/server/codechecker_server/server.py",
                "status": "modified",
                "additions": 16,
                "deletions": 10,
                "changes": 26,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Fserver.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Fcodechecker_server%2Fserver.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Fcodechecker_server%2Fserver.py?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -328,10 +328,21 @@ def do_POST(self):\n         otrans = TTransport.TMemoryBuffer()\n         oprot = output_protocol_factory.getProtocol(otrans)\n \n+        product_endpoint, api_ver, request_endpoint = \\\n+            routing.split_client_POST_request(self.path)\n+\n+        if product_endpoint is None and api_ver is None and \\\n+                request_endpoint is None:\n+            self.send_thrift_exception(\"Invalid request endpoint path.\", iprot,\n+                                       oprot, otrans)\n+            return\n+\n+        # Only Authentication, Configuration, ServerInof\n+        # endpoints are allowed for Anonymous users\n+        # if authentication is required.\n         if self.server.manager.is_enabled and \\\n-                not self.path.endswith(('/Authentication',\n-                                        '/Configuration',\n-                                        '/ServerInfo')) and \\\n+                request_endpoint not in \\\n+                ['Authentication', 'Configuration', 'ServerInfo'] and \\\n                 not self.auth_session:\n             # Bail out if the user is not authenticated...\n             # This response has the possibility of melting down Thrift clients,\n@@ -347,12 +358,6 @@ def do_POST(self):\n \n         # Authentication is handled, we may now respond to the user.\n         try:\n-            product_endpoint, api_ver, request_endpoint = \\\n-                routing.split_client_POST_request(self.path)\n-            if product_endpoint is None and api_ver is None and \\\n-                    request_endpoint is None:\n-                raise ValueError(\"Invalid request endpoint path.\")\n-\n             product = None\n             if product_endpoint:\n                 # The current request came through a product route, and not\n@@ -373,7 +378,8 @@ def do_POST(self):\n                     elif request_endpoint == 'Configuration':\n                         conf_handler = ConfigHandler_v6(\n                             self.auth_session,\n-                            self.server.config_session)\n+                            self.server.config_session,\n+                            self.server.manager)\n                         processor = ConfigAPI_v6.Processor(conf_handler)\n                     elif request_endpoint == 'ServerInfo':\n                         server_info_handler = ServerInfoHandler_v6(version)"
            },
            {
                "sha": "9a392b09a16b481e4361119f09d73ae44efffe85",
                "filename": "web/server/tests/unit/test_request_routing.py",
                "status": "modified",
                "additions": 5,
                "deletions": 9,
                "changes": 14,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Ftests%2Funit%2Ftest_request_routing.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Fserver%2Ftests%2Funit%2Ftest_request_routing.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Fserver%2Ftests%2Funit%2Ftest_request_routing.py?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -52,16 +52,12 @@ def test_post(self):\n         # It is the server code's responsibility to give a 404 Not Found.\n         self.assertEqual(post(''), (None, None, None))\n         self.assertEqual(post('CodeCheckerService'), (None, None, None))\n-\n-        # Raise an exception if URL is malformed, such as contains a\n-        # product-endpoint-like component which is badly encoded version\n-        # string.\n-        with self.assertRaises(Exception):\n-            post('v6.0')\n-            post('/v6/CodeCheckerService')\n+        self.assertEqual(post('v6.0'), (None, None, None))\n+        self.assertEqual(post('/v6.0/product/Authentication/Service'),\n+                         (None, None, None))\n \n         self.assertEqual(post('/v6.0/Authentication'),\n                          (None, '6.0', 'Authentication'))\n \n-        self.assertEqual(post('/DummyProduct/v0.0/FoobarService'),\n-                         ('DummyProduct', '0.0', 'FoobarService'))\n+        self.assertEqual(post('/DummyProduct/v6.0/FoobarService'),\n+                         ('DummyProduct', '6.0', 'FoobarService'))"
            },
            {
                "sha": "41982e3fbdf21ed20305759a0bb8eb631f62bb08",
                "filename": "web/tests/functional/products/test_products.py",
                "status": "modified",
                "additions": 14,
                "deletions": 14,
                "changes": 28,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Ftests%2Ffunctional%2Fproducts%2Ftest_products.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Ftests%2Ffunctional%2Fproducts%2Ftest_products.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Ftests%2Ffunctional%2Fproducts%2Ftest_products.py?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -150,7 +150,7 @@ def test_get_product_data(self):\n \n         # Now get the SERVERSPACE (configuration) for the product.\n         # TODO: These things usually should only work for superusers!\n-        pr_conf = self._pr_client.getProductConfiguration(pr_data.id)\n+        pr_conf = self._root_client.getProductConfiguration(pr_data.id)\n \n         self.assertIsNotNone(pr_conf, \"Product configuration must come.\")\n         self.assertEqual(pr_conf.endpoint, self.product_name,\n@@ -189,7 +189,7 @@ def test_editing(self):\n         pr_client = env.setup_product_client(\n             self.test_workspace, product=self.product_name)\n         product_id = pr_client.getCurrentProduct().id\n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n \n         old_name = config.displayedName_b64\n \n@@ -202,7 +202,7 @@ def test_editing(self):\n         self.assertTrue(self._root_client.editProduct(product_id, config),\n                         \"Product edit didn't conclude.\")\n \n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n         self.assertEqual(config.endpoint, self.product_name,\n                          \"The product edit changed the endpoint, when it \"\n                          \"shouldn't have!\")\n@@ -214,7 +214,7 @@ def test_editing(self):\n         self.assertTrue(self._root_client.editProduct(product_id, config),\n                         \"Product config restore didn't conclude.\")\n \n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n         self.assertEqual(config.displayedName_b64, old_name,\n                          \"The product edit didn't change the name back.\")\n \n@@ -225,7 +225,7 @@ def test_editing(self):\n         self.assertTrue(self._root_client.editProduct(product_id, config),\n                         \"Product edit didn't conclude.\")\n \n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n         self.assertEqual(config.confidentiality,\n                          new_confidentiality,\n                          \"Couldn't change the confidentiality to OPEN\")\n@@ -235,7 +235,7 @@ def test_editing(self):\n         self.assertTrue(self._root_client.editProduct(product_id, config),\n                         \"Product edit didn't conclude.\")\n \n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n         self.assertEqual(config.confidentiality,\n                          new_confidentiality,\n                          \"Couldn't change the confidentiality to INTERNAL\")\n@@ -245,7 +245,7 @@ def test_editing(self):\n         self.assertTrue(self._root_client.editProduct(product_id, config),\n                         \"Product edit didn't conclude.\")\n \n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n         self.assertEqual(config.confidentiality,\n                          new_confidentiality,\n                          \"Couldn't change the confidentiality to CONFIDENTIAL\")\n@@ -255,7 +255,7 @@ def test_editing(self):\n         self.assertTrue(self._root_client.editProduct(product_id, config),\n                         \"Product config restore didn't conclude.\")\n \n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n         self.assertEqual(config.confidentiality,\n                          old_confidentiality,\n                          \"The edit didn't change back the confidentiality.\")\n@@ -271,7 +271,7 @@ def test_editing_reconnect(self):\n         pr_client = env.setup_product_client(\n             self.test_workspace, product=self.product_name)\n         product_id = pr_client.getCurrentProduct().id\n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n \n         old_db_name = config.connection.database\n \n@@ -292,7 +292,7 @@ def test_editing_reconnect(self):\n                         \"Product edit didn't conclude.\")\n \n         # Check if the configuration now uses the new values.\n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n \n         self.assertEqual(config.connection.database, new_db_name,\n                          \"Server didn't save new database name.\")\n@@ -311,7 +311,7 @@ def test_editing_reconnect(self):\n         self.assertTrue(self._root_client.editProduct(product_id, config),\n                         \"Product configuration restore didn't conclude.\")\n \n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n         self.assertEqual(config.connection.database, old_db_name,\n                          \"Server didn't save back to old database name.\")\n \n@@ -336,7 +336,7 @@ def test_editing_endpoint(self):\n         pr_client = env.setup_product_client(\n             self.test_workspace, product=self.product_name)\n         product_id = pr_client.getCurrentProduct().id\n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n \n         old_endpoint = config.endpoint\n         new_endpoint = \"edited_endpoint\"\n@@ -347,7 +347,7 @@ def test_editing_endpoint(self):\n                         \"Product edit didn't conclude.\")\n \n         # Check if the configuration now uses the new values.\n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n         self.assertEqual(config.endpoint, new_endpoint,\n                          \"Server didn't save new endpoint.\")\n \n@@ -372,7 +372,7 @@ def test_editing_endpoint(self):\n         self.assertTrue(self._root_client.editProduct(product_id, config),\n                         \"Product configuration restore didn't conclude.\")\n \n-        config = self._pr_client.getProductConfiguration(product_id)\n+        config = self._root_client.getProductConfiguration(product_id)\n         self.assertEqual(config.endpoint, old_endpoint,\n                          \"Server didn't save back to old endpoint.\")\n "
            },
            {
                "sha": "91390cc9561f3219a238a4c8a8c09d5c168f6941",
                "filename": "web/tests/functional/server_configuration/test_server_configuration.py",
                "status": "modified",
                "additions": 18,
                "deletions": 18,
                "changes": 36,
                "blob_url": "https://github.com/Ericsson/codechecker/blob/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Ftests%2Ffunctional%2Fserver_configuration%2Ftest_server_configuration.py",
                "raw_url": "https://github.com/Ericsson/codechecker/raw/ad41702e3108e4b92ae5d0143a5b961cc34195eb/web%2Ftests%2Ffunctional%2Fserver_configuration%2Ftest_server_configuration.py",
                "contents_url": "https://api.github.com/repos/Ericsson/codechecker/contents/web%2Ftests%2Ffunctional%2Fserver_configuration%2Ftest_server_configuration.py?ref=ad41702e3108e4b92ae5d0143a5b961cc34195eb",
                "patch": "@@ -104,23 +104,20 @@ def setup_method(self, _):\n \n     def test_noauth_notification_edit(self):\n         \"\"\"\n-        Test for editing the notification text on a non authenting server.\n+        Test for editing the notification text on a non-authenticating user\n+        on an authenticating server\n         \"\"\"\n \n         # A non-authenticated session should return an empty user.\n         user = self.auth_client.getLoggedInUser()\n         self.assertEqual(user, \"\")\n \n-        # Server without authentication should allow notification setting.\n-        self.config_client.setNotificationBannerText(\n-            convert.to_b64('noAuth notif'))\n-        self.assertEqual(convert.from_b64(\n-            self.config_client.getNotificationBannerText()), 'noAuth notif')\n+        # Anonymous user should not be allowed to change the banner\n+        with self.assertRaises(RequestFailed):\n+            self.config_client.setNotificationBannerText(\n+                    convert.to_b64('non su notification'))\n \n-    def test_auth_su_notification_edit(self):\n-        \"\"\"\n-        Test that SUPERADMINS can edit the notification text.\n-        \"\"\"\n+    def get_su_config_client(self):\n         # Create a SUPERUSER login.\n         self.session_token = self.auth_client.performLogin(\n             \"Username:Password\", \"root:root\")\n@@ -142,8 +139,14 @@ def test_auth_su_notification_edit(self):\n \n         user = su_auth_client.getLoggedInUser()\n         self.assertEqual(user, \"root\")\n-        # we are root\n+        return su_config_client\n \n+    def test_auth_su_notification_edit(self):\n+        \"\"\"\n+        Test that SUPERADMINS can edit the notification text.\n+        \"\"\"\n+\n+        su_config_client = self.get_su_config_client()\n         su_config_client.setNotificationBannerText(\n                 convert.to_b64('su notification'))\n         self.assertEqual(convert.from_b64(\n@@ -172,21 +175,18 @@ def test_auth_non_su_notification_edit(self):\n             authd_config_client.setNotificationBannerText(\n                     convert.to_b64('non su notification'))\n \n-            print(\"You are not authorized to modify notifications!\")\n+        print(\"You are not authorized to modify notifications!\")\n \n     def test_unicode_string(self):\n         \"\"\"\n         Test for non ascii strings. Needed because the used Thrift\n         version won't eat them.\n         \"\"\"\n-\n-        # A non-authenticated session should return an empty user.\n-        user = self.auth_client.getLoggedInUser()\n-        self.assertEqual(user, \"\")\n+        su_config_client = self.get_su_config_client()\n \n         # Check if utf-8 encoded strings are okay.\n-        self.config_client.setNotificationBannerText(\n+        su_config_client.setNotificationBannerText(\n                 convert.to_b64('\u00e1rv\u00edzt\u0171r\u0151 t\u00fck\u00f6rf\u00far\u00f3g\u00e9p'))\n         self.assertEqual(convert.from_b64(\n-            self.config_client.getNotificationBannerText()),\n+             su_config_client.getNotificationBannerText()),\n             '\u00e1rv\u00edzt\u0171r\u0151 t\u00fck\u00f6rf\u00far\u00f3g\u00e9p')"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/ansible/commits/f7be90626da3035c697623dcf9c90b7a0bc91c92",
        "url": "https://api.github.com/repos/ansible/ansible/commits/f7be90626da3035c697623dcf9c90b7a0bc91c92",
        "html_url": "https://github.com/ansible/ansible/commit/f7be90626da3035c697623dcf9c90b7a0bc91c92",
        "message": "[stable-2.17] user action, fix ssh-keygen issues (#84170)\n\n* user module avoid conflicts ssh pub key (#84165)\r\n\r\nRemove pub key if we are going to generate private\r\nfix tests for os X\r\n\r\n(cherry picked from commit 11e4a6a7228116cbbb333d455b4345fc4fa250db)\r\n\r\n* Restore test import missing from backport\r\n\r\n---------\r\n\r\nCo-authored-by: Matt Clay <matt@mystile.com>",
        "files": [
            {
                "sha": "b2c47d60e3a995e152de8c176dfc93e978fd1c92",
                "filename": "changelogs/fragments/user_ssh_fix.yml",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/ansible/ansible/blob/f7be90626da3035c697623dcf9c90b7a0bc91c92/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/f7be90626da3035c697623dcf9c90b7a0bc91c92/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/changelogs%2Ffragments%2Fuser_ssh_fix.yml?ref=f7be90626da3035c697623dcf9c90b7a0bc91c92",
                "patch": "@@ -0,0 +1,4 @@\n+bugfixes:\n+  - user action will now require O(force) to overwrite the public part of an ssh key when generating ssh keys, as was already the case for the private part.\n+security_fixes:\n+  - user action won't allow ssh-keygen, chown and chmod to run on existing ssh public key file, avoiding traversal on existing symlinks (CVE-2024-9902)."
            },
            {
                "sha": "38a6ea09a2f15e4ae6a4886716ecf8a0495c3c2e",
                "filename": "lib/ansible/modules/user.py",
                "status": "modified",
                "additions": 15,
                "deletions": 2,
                "changes": 17,
                "blob_url": "https://github.com/ansible/ansible/blob/f7be90626da3035c697623dcf9c90b7a0bc91c92/lib%2Fansible%2Fmodules%2Fuser.py",
                "raw_url": "https://github.com/ansible/ansible/raw/f7be90626da3035c697623dcf9c90b7a0bc91c92/lib%2Fansible%2Fmodules%2Fuser.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Fmodules%2Fuser.py?ref=f7be90626da3035c697623dcf9c90b7a0bc91c92",
                "patch": "@@ -1167,9 +1167,11 @@ def ssh_key_gen(self):\n         overwrite = None\n         try:\n             ssh_key_file = self.get_ssh_key_path()\n+            pub_file = f'{ssh_key_file}.pub'\n         except Exception as e:\n             return (1, '', to_native(e))\n         ssh_dir = os.path.dirname(ssh_key_file)\n+\n         if not os.path.exists(ssh_dir):\n             if self.module.check_mode:\n                 return (0, '', '')\n@@ -1178,12 +1180,23 @@ def ssh_key_gen(self):\n                 os.chown(ssh_dir, info[2], info[3])\n             except OSError as e:\n                 return (1, '', 'Failed to create %s: %s' % (ssh_dir, to_native(e)))\n+\n         if os.path.exists(ssh_key_file):\n             if self.force:\n-                # ssh-keygen doesn't support overwriting the key interactively, so send 'y' to confirm\n+                self.module.warn(f'Overwriting existing ssh key private file \"{ssh_key_file}\"')\n                 overwrite = 'y'\n             else:\n+                self.module.warn(f'Found existing ssh key private file \"{ssh_key_file}\", no force, so skipping ssh-keygen generation')\n                 return (None, 'Key already exists, use \"force: yes\" to overwrite', '')\n+\n+        if os.path.exists(pub_file):\n+            if self.force:\n+                self.module.warn(f'Overwriting existing ssh key public file \"{pub_file}\"')\n+                os.unlink(pub_file)\n+            else:\n+                self.module.warn(f'Found existing ssh key public file \"{pub_file}\", no force, so skipping ssh-keygen generation')\n+                return (None, 'Public key already exists, use \"force: yes\" to overwrite', '')\n+\n         cmd = [self.module.get_bin_path('ssh-keygen', True)]\n         cmd.append('-t')\n         cmd.append(self.ssh_type)\n@@ -1250,7 +1263,7 @@ def ssh_key_gen(self):\n             # If the keys were successfully created, we should be able\n             # to tweak ownership.\n             os.chown(ssh_key_file, info[2], info[3])\n-            os.chown('%s.pub' % ssh_key_file, info[2], info[3])\n+            os.chown(pub_file, info[2], info[3])\n         return (rc, out, err)\n \n     def ssh_key_fingerprint(self):"
            },
            {
                "sha": "062005f5c6900c470773c09baeb4c322e79d970f",
                "filename": "test/integration/targets/user/tasks/main.yml",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/ansible/ansible/blob/f7be90626da3035c697623dcf9c90b7a0bc91c92/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/f7be90626da3035c697623dcf9c90b7a0bc91c92/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml?ref=f7be90626da3035c697623dcf9c90b7a0bc91c92",
                "patch": "@@ -38,7 +38,8 @@\n - import_tasks: test_ssh_key_passphrase.yml\n - import_tasks: test_password_lock.yml\n - import_tasks: test_password_lock_new_user.yml\n-- import_tasks: test_local.yml\n+- include_tasks: test_local.yml\n   when: not (ansible_distribution == 'openSUSE Leap' and ansible_distribution_version is version('15.4', '>='))\n-- import_tasks: test_umask.yml\n+- include_tasks: test_umask.yml\n   when: ansible_facts.system == 'Linux'\n+- import_tasks: ssh_keygen.yml"
            },
            {
                "sha": "e23bc48ee8cdc3f3dc7eb052aba782c6ead7d7cf",
                "filename": "test/integration/targets/user/tasks/ssh_keygen.yml",
                "status": "added",
                "additions": 100,
                "deletions": 0,
                "changes": 100,
                "blob_url": "https://github.com/ansible/ansible/blob/f7be90626da3035c697623dcf9c90b7a0bc91c92/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/f7be90626da3035c697623dcf9c90b7a0bc91c92/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml?ref=f7be90626da3035c697623dcf9c90b7a0bc91c92",
                "patch": "@@ -0,0 +1,100 @@\n+- name: user generating ssh keys tests\n+  become: true\n+  vars:\n+    home: \"{{ (ansible_facts['os_family'] == 'Darwin')|ternary('/Users/ansibulluser/', '/home/ansibulluser/')}}\"\n+    ssh_key_file: .ssh/ansible_test_rsa\n+    pub_file: '{{ssh_key_file}}.pub'\n+    key_files:\n+      - '{{ssh_key_file}}'\n+      - '{{pub_file}}'\n+  block:\n+  - name: Ensure clean/non existsing ansibulluser\n+    user: name=ansibulluser state=absent\n+\n+  - name: Test creating ssh key creation\n+    block:\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file}}'\n+\n+    - name: check files exist\n+      stat:\n+        path: '{{home ~ item}}'\n+      register: stat_keys\n+      loop: '{{ key_files }}'\n+\n+    - name: ensure they exist\n+      assert:\n+        that:\n+          - stat_keys.results[item].stat.exists\n+      loop: [0, 1]\n+\n+    always:\n+    - name: Clean ssh keys\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent\n+\n+  - name: Ensure we don't break on conflicts\n+    block:\n+    - name: flag file for test\n+      tempfile:\n+      register: flagfile\n+\n+    - name: precreate public .ssh\n+      file: path={{home ~ '.ssh'}} state=directory\n+\n+    - name: setup public key linked to flag file\n+      file: path={{home ~ pub_file}} src={{flagfile.path}} state=link\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+      ignore_errors: true\n+      register: user_no_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub\n+\n+    - name: ensure we didn't overwrite\n+      assert:\n+        that:\n+          - check_pub.stat.exists\n+          - check_pub.stat.islnk\n+          - check_pub.stat.uid == 0\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+        force: true\n+      ignore_errors: true\n+      register: user_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub2\n+\n+    - name: ensure we failed since we didn't force overwrite\n+      assert:\n+        that:\n+          - user_force is success\n+          - check_pub2.stat.exists\n+          - not check_pub2.stat.islnk\n+          - check_pub2.stat.uid != 0\n+    always:\n+    - name: Clean up files\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files + [flagfile.path] }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent"
            },
            {
                "sha": "c4cdb4800f70478cc2702e1511cd73fba12d245b",
                "filename": "test/integration/targets/user/tasks/test_local.yml",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/ansible/ansible/blob/f7be90626da3035c697623dcf9c90b7a0bc91c92/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/f7be90626da3035c697623dcf9c90b7a0bc91c92/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml?ref=f7be90626da3035c697623dcf9c90b7a0bc91c92",
                "patch": "@@ -39,6 +39,15 @@\n   tags:\n     - user_test_local_mode\n \n+- name: Ensure no local_ansibulluser\n+  user:\n+    name: local_ansibulluser\n+    state: absent\n+    local: yes\n+    remove: true\n+  tags:\n+    - user_test_local_mode\n+\n - name: Create local_ansibulluser\n   user:\n     name: local_ansibulluser"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/ansible/commits/3b6de811abea0a811e03e3029222a7e459922892",
        "url": "https://api.github.com/repos/ansible/ansible/commits/3b6de811abea0a811e03e3029222a7e459922892",
        "html_url": "https://github.com/ansible/ansible/commit/3b6de811abea0a811e03e3029222a7e459922892",
        "message": "user module avoid conflicts ssh pub key (#84165) (#84171)\n\nRemove pub key if we are going to generate private\r\nfix tests for os X\r\n\r\n(cherry picked from commit 11e4a6a7228116cbbb333d455b4345fc4fa250db)",
        "files": [
            {
                "sha": "b2c47d60e3a995e152de8c176dfc93e978fd1c92",
                "filename": "changelogs/fragments/user_ssh_fix.yml",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/ansible/ansible/blob/3b6de811abea0a811e03e3029222a7e459922892/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/3b6de811abea0a811e03e3029222a7e459922892/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/changelogs%2Ffragments%2Fuser_ssh_fix.yml?ref=3b6de811abea0a811e03e3029222a7e459922892",
                "patch": "@@ -0,0 +1,4 @@\n+bugfixes:\n+  - user action will now require O(force) to overwrite the public part of an ssh key when generating ssh keys, as was already the case for the private part.\n+security_fixes:\n+  - user action won't allow ssh-keygen, chown and chmod to run on existing ssh public key file, avoiding traversal on existing symlinks (CVE-2024-9902)."
            },
            {
                "sha": "023e4b70e4b8e1bc29b833496d0a5a78cec12f46",
                "filename": "lib/ansible/modules/user.py",
                "status": "modified",
                "additions": 15,
                "deletions": 2,
                "changes": 17,
                "blob_url": "https://github.com/ansible/ansible/blob/3b6de811abea0a811e03e3029222a7e459922892/lib%2Fansible%2Fmodules%2Fuser.py",
                "raw_url": "https://github.com/ansible/ansible/raw/3b6de811abea0a811e03e3029222a7e459922892/lib%2Fansible%2Fmodules%2Fuser.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Fmodules%2Fuser.py?ref=3b6de811abea0a811e03e3029222a7e459922892",
                "patch": "@@ -1220,9 +1220,11 @@ def ssh_key_gen(self):\n         overwrite = None\n         try:\n             ssh_key_file = self.get_ssh_key_path()\n+            pub_file = f'{ssh_key_file}.pub'\n         except Exception as e:\n             return (1, '', to_native(e))\n         ssh_dir = os.path.dirname(ssh_key_file)\n+\n         if not os.path.exists(ssh_dir):\n             if self.module.check_mode:\n                 return (0, '', '')\n@@ -1231,12 +1233,23 @@ def ssh_key_gen(self):\n                 os.chown(ssh_dir, info[2], info[3])\n             except OSError as e:\n                 return (1, '', 'Failed to create %s: %s' % (ssh_dir, to_native(e)))\n+\n         if os.path.exists(ssh_key_file):\n             if self.force:\n-                # ssh-keygen doesn't support overwriting the key interactively, so send 'y' to confirm\n+                self.module.warn(f'Overwriting existing ssh key private file \"{ssh_key_file}\"')\n                 overwrite = 'y'\n             else:\n+                self.module.warn(f'Found existing ssh key private file \"{ssh_key_file}\", no force, so skipping ssh-keygen generation')\n                 return (None, 'Key already exists, use \"force: yes\" to overwrite', '')\n+\n+        if os.path.exists(pub_file):\n+            if self.force:\n+                self.module.warn(f'Overwriting existing ssh key public file \"{pub_file}\"')\n+                os.unlink(pub_file)\n+            else:\n+                self.module.warn(f'Found existing ssh key public file \"{pub_file}\", no force, so skipping ssh-keygen generation')\n+                return (None, 'Public key already exists, use \"force: yes\" to overwrite', '')\n+\n         cmd = [self.module.get_bin_path('ssh-keygen', True)]\n         cmd.append('-t')\n         cmd.append(self.ssh_type)\n@@ -1303,7 +1316,7 @@ def ssh_key_gen(self):\n             # If the keys were successfully created, we should be able\n             # to tweak ownership.\n             os.chown(ssh_key_file, info[2], info[3])\n-            os.chown('%s.pub' % ssh_key_file, info[2], info[3])\n+            os.chown(pub_file, info[2], info[3])\n         return (rc, out, err)\n \n     def ssh_key_fingerprint(self):"
            },
            {
                "sha": "89dec984c04ae950296addc71e17b754b6af2617",
                "filename": "test/integration/targets/user/tasks/main.yml",
                "status": "modified",
                "additions": 4,
                "deletions": 3,
                "changes": 7,
                "blob_url": "https://github.com/ansible/ansible/blob/3b6de811abea0a811e03e3029222a7e459922892/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/3b6de811abea0a811e03e3029222a7e459922892/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml?ref=3b6de811abea0a811e03e3029222a7e459922892",
                "patch": "@@ -38,10 +38,11 @@\n - import_tasks: test_ssh_key_passphrase.yml\n - import_tasks: test_password_lock.yml\n - import_tasks: test_password_lock_new_user.yml\n-- import_tasks: test_local.yml\n+- include_tasks: test_local.yml\n   when: not (ansible_distribution == 'openSUSE Leap' and ansible_distribution_version is version('15.4', '>='))\n-- import_tasks: test_umask.yml\n+- include_tasks: test_umask.yml\n   when: ansible_facts.system == 'Linux'\n - import_tasks: test_inactive_new_account.yml\n-- import_tasks: test_create_user_min_max.yml\n+- include_tasks: test_create_user_min_max.yml\n   when: ansible_facts.system == 'Linux'\n+- import_tasks: ssh_keygen.yml"
            },
            {
                "sha": "e23bc48ee8cdc3f3dc7eb052aba782c6ead7d7cf",
                "filename": "test/integration/targets/user/tasks/ssh_keygen.yml",
                "status": "added",
                "additions": 100,
                "deletions": 0,
                "changes": 100,
                "blob_url": "https://github.com/ansible/ansible/blob/3b6de811abea0a811e03e3029222a7e459922892/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/3b6de811abea0a811e03e3029222a7e459922892/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml?ref=3b6de811abea0a811e03e3029222a7e459922892",
                "patch": "@@ -0,0 +1,100 @@\n+- name: user generating ssh keys tests\n+  become: true\n+  vars:\n+    home: \"{{ (ansible_facts['os_family'] == 'Darwin')|ternary('/Users/ansibulluser/', '/home/ansibulluser/')}}\"\n+    ssh_key_file: .ssh/ansible_test_rsa\n+    pub_file: '{{ssh_key_file}}.pub'\n+    key_files:\n+      - '{{ssh_key_file}}'\n+      - '{{pub_file}}'\n+  block:\n+  - name: Ensure clean/non existsing ansibulluser\n+    user: name=ansibulluser state=absent\n+\n+  - name: Test creating ssh key creation\n+    block:\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file}}'\n+\n+    - name: check files exist\n+      stat:\n+        path: '{{home ~ item}}'\n+      register: stat_keys\n+      loop: '{{ key_files }}'\n+\n+    - name: ensure they exist\n+      assert:\n+        that:\n+          - stat_keys.results[item].stat.exists\n+      loop: [0, 1]\n+\n+    always:\n+    - name: Clean ssh keys\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent\n+\n+  - name: Ensure we don't break on conflicts\n+    block:\n+    - name: flag file for test\n+      tempfile:\n+      register: flagfile\n+\n+    - name: precreate public .ssh\n+      file: path={{home ~ '.ssh'}} state=directory\n+\n+    - name: setup public key linked to flag file\n+      file: path={{home ~ pub_file}} src={{flagfile.path}} state=link\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+      ignore_errors: true\n+      register: user_no_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub\n+\n+    - name: ensure we didn't overwrite\n+      assert:\n+        that:\n+          - check_pub.stat.exists\n+          - check_pub.stat.islnk\n+          - check_pub.stat.uid == 0\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+        force: true\n+      ignore_errors: true\n+      register: user_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub2\n+\n+    - name: ensure we failed since we didn't force overwrite\n+      assert:\n+        that:\n+          - user_force is success\n+          - check_pub2.stat.exists\n+          - not check_pub2.stat.islnk\n+          - check_pub2.stat.uid != 0\n+    always:\n+    - name: Clean up files\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files + [flagfile.path] }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent"
            },
            {
                "sha": "c4cdb4800f70478cc2702e1511cd73fba12d245b",
                "filename": "test/integration/targets/user/tasks/test_local.yml",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/ansible/ansible/blob/3b6de811abea0a811e03e3029222a7e459922892/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/3b6de811abea0a811e03e3029222a7e459922892/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml?ref=3b6de811abea0a811e03e3029222a7e459922892",
                "patch": "@@ -39,6 +39,15 @@\n   tags:\n     - user_test_local_mode\n \n+- name: Ensure no local_ansibulluser\n+  user:\n+    name: local_ansibulluser\n+    state: absent\n+    local: yes\n+    remove: true\n+  tags:\n+    - user_test_local_mode\n+\n - name: Create local_ansibulluser\n   user:\n     name: local_ansibulluser"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/ansible/commits/03794735d370db98a5ec2ad514fab2b0dd22d6be",
        "url": "https://api.github.com/repos/ansible/ansible/commits/03794735d370db98a5ec2ad514fab2b0dd22d6be",
        "html_url": "https://github.com/ansible/ansible/commit/03794735d370db98a5ec2ad514fab2b0dd22d6be",
        "message": "[stable-2.15] user action, fix ssh-keygen issues (#84168)\n\n* user module avoid conflicts ssh pub key (#84165)\r\n\r\nRemove pub key if we are going to generate private\r\nfix tests for os X\r\n\r\n(cherry picked from commit 11e4a6a7228116cbbb333d455b4345fc4fa250db)\r\n\r\n* old python, no f''\r\n\r\n* Restore test import missing from backport\r\n\r\n---------\r\n\r\nCo-authored-by: Matt Clay <matt@mystile.com>",
        "files": [
            {
                "sha": "b2c47d60e3a995e152de8c176dfc93e978fd1c92",
                "filename": "changelogs/fragments/user_ssh_fix.yml",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/ansible/ansible/blob/03794735d370db98a5ec2ad514fab2b0dd22d6be/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/03794735d370db98a5ec2ad514fab2b0dd22d6be/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/changelogs%2Ffragments%2Fuser_ssh_fix.yml?ref=03794735d370db98a5ec2ad514fab2b0dd22d6be",
                "patch": "@@ -0,0 +1,4 @@\n+bugfixes:\n+  - user action will now require O(force) to overwrite the public part of an ssh key when generating ssh keys, as was already the case for the private part.\n+security_fixes:\n+  - user action won't allow ssh-keygen, chown and chmod to run on existing ssh public key file, avoiding traversal on existing symlinks (CVE-2024-9902)."
            },
            {
                "sha": "e022af6d942f4af5839da9bfad3c617b574500ae",
                "filename": "lib/ansible/modules/user.py",
                "status": "modified",
                "additions": 15,
                "deletions": 2,
                "changes": 17,
                "blob_url": "https://github.com/ansible/ansible/blob/03794735d370db98a5ec2ad514fab2b0dd22d6be/lib%2Fansible%2Fmodules%2Fuser.py",
                "raw_url": "https://github.com/ansible/ansible/raw/03794735d370db98a5ec2ad514fab2b0dd22d6be/lib%2Fansible%2Fmodules%2Fuser.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Fmodules%2Fuser.py?ref=03794735d370db98a5ec2ad514fab2b0dd22d6be",
                "patch": "@@ -1148,9 +1148,11 @@ def ssh_key_gen(self):\n         overwrite = None\n         try:\n             ssh_key_file = self.get_ssh_key_path()\n+            pub_file = '%s.pub' % ssh_key_file\n         except Exception as e:\n             return (1, '', to_native(e))\n         ssh_dir = os.path.dirname(ssh_key_file)\n+\n         if not os.path.exists(ssh_dir):\n             if self.module.check_mode:\n                 return (0, '', '')\n@@ -1159,12 +1161,23 @@ def ssh_key_gen(self):\n                 os.chown(ssh_dir, info[2], info[3])\n             except OSError as e:\n                 return (1, '', 'Failed to create %s: %s' % (ssh_dir, to_native(e)))\n+\n         if os.path.exists(ssh_key_file):\n             if self.force:\n-                # ssh-keygen doesn't support overwriting the key interactively, so send 'y' to confirm\n+                self.module.warn('Overwriting existing ssh key private file \"%s\"' % ssh_key_file)\n                 overwrite = 'y'\n             else:\n+                self.module.warn('Found existing ssh key private file \"%s\", no force, so skipping ssh-keygen generation' % ssh_key_file)\n                 return (None, 'Key already exists, use \"force: yes\" to overwrite', '')\n+\n+        if os.path.exists(pub_file):\n+            if self.force:\n+                self.module.warn('Overwriting existing ssh key public file \"%s\"' % pub_file)\n+                os.unlink(pub_file)\n+            else:\n+                self.module.warn('Found existing ssh key public file \"%s\", no force, so skipping ssh-keygen generation' % pub_file)\n+                return (None, 'Public key already exists, use \"force: yes\" to overwrite', '')\n+\n         cmd = [self.module.get_bin_path('ssh-keygen', True)]\n         cmd.append('-t')\n         cmd.append(self.ssh_type)\n@@ -1231,7 +1244,7 @@ def ssh_key_gen(self):\n             # If the keys were successfully created, we should be able\n             # to tweak ownership.\n             os.chown(ssh_key_file, info[2], info[3])\n-            os.chown('%s.pub' % ssh_key_file, info[2], info[3])\n+            os.chown(pub_file, info[2], info[3])\n         return (rc, out, err)\n \n     def ssh_key_fingerprint(self):"
            },
            {
                "sha": "9b0fa950ca48ede3a9758bfd16462f503baf9652",
                "filename": "test/integration/targets/user/tasks/main.yml",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/ansible/ansible/blob/03794735d370db98a5ec2ad514fab2b0dd22d6be/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/03794735d370db98a5ec2ad514fab2b0dd22d6be/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml?ref=03794735d370db98a5ec2ad514fab2b0dd22d6be",
                "patch": "@@ -36,7 +36,8 @@\n - import_tasks: test_ssh_key_passphrase.yml\n - import_tasks: test_password_lock.yml\n - import_tasks: test_password_lock_new_user.yml\n-- import_tasks: test_local.yml\n+- include_tasks: test_local.yml\n   when: not (ansible_distribution == 'openSUSE Leap' and ansible_distribution_version is version('15.4', '>='))\n-- import_tasks: test_umask.yml\n+- include_tasks: test_umask.yml\n   when: ansible_facts.system == 'Linux'\n+- import_tasks: ssh_keygen.yml"
            },
            {
                "sha": "e23bc48ee8cdc3f3dc7eb052aba782c6ead7d7cf",
                "filename": "test/integration/targets/user/tasks/ssh_keygen.yml",
                "status": "added",
                "additions": 100,
                "deletions": 0,
                "changes": 100,
                "blob_url": "https://github.com/ansible/ansible/blob/03794735d370db98a5ec2ad514fab2b0dd22d6be/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/03794735d370db98a5ec2ad514fab2b0dd22d6be/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml?ref=03794735d370db98a5ec2ad514fab2b0dd22d6be",
                "patch": "@@ -0,0 +1,100 @@\n+- name: user generating ssh keys tests\n+  become: true\n+  vars:\n+    home: \"{{ (ansible_facts['os_family'] == 'Darwin')|ternary('/Users/ansibulluser/', '/home/ansibulluser/')}}\"\n+    ssh_key_file: .ssh/ansible_test_rsa\n+    pub_file: '{{ssh_key_file}}.pub'\n+    key_files:\n+      - '{{ssh_key_file}}'\n+      - '{{pub_file}}'\n+  block:\n+  - name: Ensure clean/non existsing ansibulluser\n+    user: name=ansibulluser state=absent\n+\n+  - name: Test creating ssh key creation\n+    block:\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file}}'\n+\n+    - name: check files exist\n+      stat:\n+        path: '{{home ~ item}}'\n+      register: stat_keys\n+      loop: '{{ key_files }}'\n+\n+    - name: ensure they exist\n+      assert:\n+        that:\n+          - stat_keys.results[item].stat.exists\n+      loop: [0, 1]\n+\n+    always:\n+    - name: Clean ssh keys\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent\n+\n+  - name: Ensure we don't break on conflicts\n+    block:\n+    - name: flag file for test\n+      tempfile:\n+      register: flagfile\n+\n+    - name: precreate public .ssh\n+      file: path={{home ~ '.ssh'}} state=directory\n+\n+    - name: setup public key linked to flag file\n+      file: path={{home ~ pub_file}} src={{flagfile.path}} state=link\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+      ignore_errors: true\n+      register: user_no_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub\n+\n+    - name: ensure we didn't overwrite\n+      assert:\n+        that:\n+          - check_pub.stat.exists\n+          - check_pub.stat.islnk\n+          - check_pub.stat.uid == 0\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+        force: true\n+      ignore_errors: true\n+      register: user_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub2\n+\n+    - name: ensure we failed since we didn't force overwrite\n+      assert:\n+        that:\n+          - user_force is success\n+          - check_pub2.stat.exists\n+          - not check_pub2.stat.islnk\n+          - check_pub2.stat.uid != 0\n+    always:\n+    - name: Clean up files\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files + [flagfile.path] }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent"
            },
            {
                "sha": "d5ca59e7e0777c3307639af5290b57140e9b1e72",
                "filename": "test/integration/targets/user/tasks/test_local.yml",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/ansible/ansible/blob/03794735d370db98a5ec2ad514fab2b0dd22d6be/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/03794735d370db98a5ec2ad514fab2b0dd22d6be/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml?ref=03794735d370db98a5ec2ad514fab2b0dd22d6be",
                "patch": "@@ -39,6 +39,15 @@\n   tags:\n     - user_test_local_mode\n \n+- name: Ensure no local_ansibulluser\n+  user:\n+    name: local_ansibulluser\n+    state: absent\n+    local: yes\n+    remove: true\n+  tags:\n+    - user_test_local_mode\n+\n - name: Create local_ansibulluser\n   user:\n     name: local_ansibulluser"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/ansible/commits/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65",
        "url": "https://api.github.com/repos/ansible/ansible/commits/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65",
        "html_url": "https://github.com/ansible/ansible/commit/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65",
        "message": "[stable-2.14] user action, fix ssh-keygen issues (#84167)\n\n* user module avoid conflicts ssh pub key (#84165)\r\n\r\nRemove pub key if we are going to generate private\r\nfix tests for os X\r\n\r\n(cherry picked from commit 11e4a6a7228116cbbb333d455b4345fc4fa250db)\r\n\r\n* old python, no f''\r\n\r\n* Restore test import missing from backport\r\n\r\n---------\r\n\r\nCo-authored-by: Matt Clay <matt@mystile.com>",
        "files": [
            {
                "sha": "b2c47d60e3a995e152de8c176dfc93e978fd1c92",
                "filename": "changelogs/fragments/user_ssh_fix.yml",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/ansible/ansible/blob/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/changelogs%2Ffragments%2Fuser_ssh_fix.yml?ref=03daf774d0d80fb7235910ed1c2b4fbcaebdfe65",
                "patch": "@@ -0,0 +1,4 @@\n+bugfixes:\n+  - user action will now require O(force) to overwrite the public part of an ssh key when generating ssh keys, as was already the case for the private part.\n+security_fixes:\n+  - user action won't allow ssh-keygen, chown and chmod to run on existing ssh public key file, avoiding traversal on existing symlinks (CVE-2024-9902)."
            },
            {
                "sha": "4c873102d98d959ba9beaab0cc4c49235918f964",
                "filename": "lib/ansible/modules/user.py",
                "status": "modified",
                "additions": 15,
                "deletions": 2,
                "changes": 17,
                "blob_url": "https://github.com/ansible/ansible/blob/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/lib%2Fansible%2Fmodules%2Fuser.py",
                "raw_url": "https://github.com/ansible/ansible/raw/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/lib%2Fansible%2Fmodules%2Fuser.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Fmodules%2Fuser.py?ref=03daf774d0d80fb7235910ed1c2b4fbcaebdfe65",
                "patch": "@@ -1152,9 +1152,11 @@ def ssh_key_gen(self):\n         overwrite = None\n         try:\n             ssh_key_file = self.get_ssh_key_path()\n+            pub_file = '%s.pub' % ssh_key_file\n         except Exception as e:\n             return (1, '', to_native(e))\n         ssh_dir = os.path.dirname(ssh_key_file)\n+\n         if not os.path.exists(ssh_dir):\n             if self.module.check_mode:\n                 return (0, '', '')\n@@ -1163,12 +1165,23 @@ def ssh_key_gen(self):\n                 os.chown(ssh_dir, info[2], info[3])\n             except OSError as e:\n                 return (1, '', 'Failed to create %s: %s' % (ssh_dir, to_native(e)))\n+\n         if os.path.exists(ssh_key_file):\n             if self.force:\n-                # ssh-keygen doesn't support overwriting the key interactively, so send 'y' to confirm\n+                self.module.warn('Overwriting existing ssh key private file \"%s\"' % ssh_key_file)\n                 overwrite = 'y'\n             else:\n+                self.module.warn('Found existing ssh key private file \"%s\", no force, so skipping ssh-keygen generation' % ssh_key_file)\n                 return (None, 'Key already exists, use \"force: yes\" to overwrite', '')\n+\n+        if os.path.exists(pub_file):\n+            if self.force:\n+                self.module.warn('Overwriting existing ssh key public file \"%s\"' % pub_file)\n+                os.unlink(pub_file)\n+            else:\n+                self.module.warn('Found existing ssh key public file \"%s\", no force, so skipping ssh-keygen generation' % pub_file)\n+                return (None, 'Public key already exists, use \"force: yes\" to overwrite', '')\n+\n         cmd = [self.module.get_bin_path('ssh-keygen', True)]\n         cmd.append('-t')\n         cmd.append(self.ssh_type)\n@@ -1235,7 +1248,7 @@ def ssh_key_gen(self):\n             # If the keys were successfully created, we should be able\n             # to tweak ownership.\n             os.chown(ssh_key_file, info[2], info[3])\n-            os.chown('%s.pub' % ssh_key_file, info[2], info[3])\n+            os.chown(pub_file, info[2], info[3])\n         return (rc, out, err)\n \n     def ssh_key_fingerprint(self):"
            },
            {
                "sha": "9b0fa950ca48ede3a9758bfd16462f503baf9652",
                "filename": "test/integration/targets/user/tasks/main.yml",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/ansible/ansible/blob/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml?ref=03daf774d0d80fb7235910ed1c2b4fbcaebdfe65",
                "patch": "@@ -36,7 +36,8 @@\n - import_tasks: test_ssh_key_passphrase.yml\n - import_tasks: test_password_lock.yml\n - import_tasks: test_password_lock_new_user.yml\n-- import_tasks: test_local.yml\n+- include_tasks: test_local.yml\n   when: not (ansible_distribution == 'openSUSE Leap' and ansible_distribution_version is version('15.4', '>='))\n-- import_tasks: test_umask.yml\n+- include_tasks: test_umask.yml\n   when: ansible_facts.system == 'Linux'\n+- import_tasks: ssh_keygen.yml"
            },
            {
                "sha": "e23bc48ee8cdc3f3dc7eb052aba782c6ead7d7cf",
                "filename": "test/integration/targets/user/tasks/ssh_keygen.yml",
                "status": "added",
                "additions": 100,
                "deletions": 0,
                "changes": 100,
                "blob_url": "https://github.com/ansible/ansible/blob/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml?ref=03daf774d0d80fb7235910ed1c2b4fbcaebdfe65",
                "patch": "@@ -0,0 +1,100 @@\n+- name: user generating ssh keys tests\n+  become: true\n+  vars:\n+    home: \"{{ (ansible_facts['os_family'] == 'Darwin')|ternary('/Users/ansibulluser/', '/home/ansibulluser/')}}\"\n+    ssh_key_file: .ssh/ansible_test_rsa\n+    pub_file: '{{ssh_key_file}}.pub'\n+    key_files:\n+      - '{{ssh_key_file}}'\n+      - '{{pub_file}}'\n+  block:\n+  - name: Ensure clean/non existsing ansibulluser\n+    user: name=ansibulluser state=absent\n+\n+  - name: Test creating ssh key creation\n+    block:\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file}}'\n+\n+    - name: check files exist\n+      stat:\n+        path: '{{home ~ item}}'\n+      register: stat_keys\n+      loop: '{{ key_files }}'\n+\n+    - name: ensure they exist\n+      assert:\n+        that:\n+          - stat_keys.results[item].stat.exists\n+      loop: [0, 1]\n+\n+    always:\n+    - name: Clean ssh keys\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent\n+\n+  - name: Ensure we don't break on conflicts\n+    block:\n+    - name: flag file for test\n+      tempfile:\n+      register: flagfile\n+\n+    - name: precreate public .ssh\n+      file: path={{home ~ '.ssh'}} state=directory\n+\n+    - name: setup public key linked to flag file\n+      file: path={{home ~ pub_file}} src={{flagfile.path}} state=link\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+      ignore_errors: true\n+      register: user_no_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub\n+\n+    - name: ensure we didn't overwrite\n+      assert:\n+        that:\n+          - check_pub.stat.exists\n+          - check_pub.stat.islnk\n+          - check_pub.stat.uid == 0\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+        force: true\n+      ignore_errors: true\n+      register: user_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub2\n+\n+    - name: ensure we failed since we didn't force overwrite\n+      assert:\n+        that:\n+          - user_force is success\n+          - check_pub2.stat.exists\n+          - not check_pub2.stat.islnk\n+          - check_pub2.stat.uid != 0\n+    always:\n+    - name: Clean up files\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files + [flagfile.path] }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent"
            },
            {
                "sha": "51a22da7ab3fc6c3ff3cddd90750234ed50b12a3",
                "filename": "test/integration/targets/user/tasks/test_local.yml",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/ansible/ansible/blob/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/03daf774d0d80fb7235910ed1c2b4fbcaebdfe65/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml?ref=03daf774d0d80fb7235910ed1c2b4fbcaebdfe65",
                "patch": "@@ -39,6 +39,15 @@\n   tags:\n     - user_test_local_mode\n \n+- name: Ensure no local_ansibulluser\n+  user:\n+    name: local_ansibulluser\n+    state: absent\n+    local: yes\n+    remove: true\n+  tags:\n+    - user_test_local_mode\n+\n - name: Create local_ansibulluser\n   user:\n     name: local_ansibulluser"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/ansible/ansible/commits/9d7312f695639e804d2caeb1d0f51c716a9ac7dd",
        "url": "https://api.github.com/repos/ansible/ansible/commits/9d7312f695639e804d2caeb1d0f51c716a9ac7dd",
        "html_url": "https://github.com/ansible/ansible/commit/9d7312f695639e804d2caeb1d0f51c716a9ac7dd",
        "message": "[stable-2.16] user action, fix ssh-keygen issues (#84169)\n\n* user module avoid conflicts ssh pub key (#84165)\r\n\r\nRemove pub key if we are going to generate private\r\nfix tests for os X\r\n\r\n(cherry picked from commit 11e4a6a7228116cbbb333d455b4345fc4fa250db)\r\n\r\n* old python, no f''\r\n\r\n* Restore test import missing from backport\r\n\r\n---------\r\n\r\nCo-authored-by: Matt Clay <matt@mystile.com>",
        "files": [
            {
                "sha": "b2c47d60e3a995e152de8c176dfc93e978fd1c92",
                "filename": "changelogs/fragments/user_ssh_fix.yml",
                "status": "added",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/ansible/ansible/blob/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/changelogs%2Ffragments%2Fuser_ssh_fix.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/changelogs%2Ffragments%2Fuser_ssh_fix.yml?ref=9d7312f695639e804d2caeb1d0f51c716a9ac7dd",
                "patch": "@@ -0,0 +1,4 @@\n+bugfixes:\n+  - user action will now require O(force) to overwrite the public part of an ssh key when generating ssh keys, as was already the case for the private part.\n+security_fixes:\n+  - user action won't allow ssh-keygen, chown and chmod to run on existing ssh public key file, avoiding traversal on existing symlinks (CVE-2024-9902)."
            },
            {
                "sha": "bef9650d8e0141aeffd560da25fab276c55ded3f",
                "filename": "lib/ansible/modules/user.py",
                "status": "modified",
                "additions": 15,
                "deletions": 2,
                "changes": 17,
                "blob_url": "https://github.com/ansible/ansible/blob/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/lib%2Fansible%2Fmodules%2Fuser.py",
                "raw_url": "https://github.com/ansible/ansible/raw/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/lib%2Fansible%2Fmodules%2Fuser.py",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/lib%2Fansible%2Fmodules%2Fuser.py?ref=9d7312f695639e804d2caeb1d0f51c716a9ac7dd",
                "patch": "@@ -1160,9 +1160,11 @@ def ssh_key_gen(self):\n         overwrite = None\n         try:\n             ssh_key_file = self.get_ssh_key_path()\n+            pub_file = '%s.pub' % ssh_key_file\n         except Exception as e:\n             return (1, '', to_native(e))\n         ssh_dir = os.path.dirname(ssh_key_file)\n+\n         if not os.path.exists(ssh_dir):\n             if self.module.check_mode:\n                 return (0, '', '')\n@@ -1171,12 +1173,23 @@ def ssh_key_gen(self):\n                 os.chown(ssh_dir, info[2], info[3])\n             except OSError as e:\n                 return (1, '', 'Failed to create %s: %s' % (ssh_dir, to_native(e)))\n+\n         if os.path.exists(ssh_key_file):\n             if self.force:\n-                # ssh-keygen doesn't support overwriting the key interactively, so send 'y' to confirm\n+                self.module.warn('Overwriting existing ssh key private file \"%s\"' % ssh_key_file)\n                 overwrite = 'y'\n             else:\n+                self.module.warn('Found existing ssh key private file \"%s\", no force, so skipping ssh-keygen generation' % ssh_key_file)\n                 return (None, 'Key already exists, use \"force: yes\" to overwrite', '')\n+\n+        if os.path.exists(pub_file):\n+            if self.force:\n+                self.module.warn('Overwriting existing ssh key public file \"%s\"' % pub_file)\n+                os.unlink(pub_file)\n+            else:\n+                self.module.warn('Found existing ssh key public file \"%s\", no force, so skipping ssh-keygen generation' % pub_file)\n+                return (None, 'Public key already exists, use \"force: yes\" to overwrite', '')\n+\n         cmd = [self.module.get_bin_path('ssh-keygen', True)]\n         cmd.append('-t')\n         cmd.append(self.ssh_type)\n@@ -1243,7 +1256,7 @@ def ssh_key_gen(self):\n             # If the keys were successfully created, we should be able\n             # to tweak ownership.\n             os.chown(ssh_key_file, info[2], info[3])\n-            os.chown('%s.pub' % ssh_key_file, info[2], info[3])\n+            os.chown(pub_file, info[2], info[3])\n         return (rc, out, err)\n \n     def ssh_key_fingerprint(self):"
            },
            {
                "sha": "062005f5c6900c470773c09baeb4c322e79d970f",
                "filename": "test/integration/targets/user/tasks/main.yml",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/ansible/ansible/blob/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fmain.yml?ref=9d7312f695639e804d2caeb1d0f51c716a9ac7dd",
                "patch": "@@ -38,7 +38,8 @@\n - import_tasks: test_ssh_key_passphrase.yml\n - import_tasks: test_password_lock.yml\n - import_tasks: test_password_lock_new_user.yml\n-- import_tasks: test_local.yml\n+- include_tasks: test_local.yml\n   when: not (ansible_distribution == 'openSUSE Leap' and ansible_distribution_version is version('15.4', '>='))\n-- import_tasks: test_umask.yml\n+- include_tasks: test_umask.yml\n   when: ansible_facts.system == 'Linux'\n+- import_tasks: ssh_keygen.yml"
            },
            {
                "sha": "e23bc48ee8cdc3f3dc7eb052aba782c6ead7d7cf",
                "filename": "test/integration/targets/user/tasks/ssh_keygen.yml",
                "status": "added",
                "additions": 100,
                "deletions": 0,
                "changes": 100,
                "blob_url": "https://github.com/ansible/ansible/blob/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Fssh_keygen.yml?ref=9d7312f695639e804d2caeb1d0f51c716a9ac7dd",
                "patch": "@@ -0,0 +1,100 @@\n+- name: user generating ssh keys tests\n+  become: true\n+  vars:\n+    home: \"{{ (ansible_facts['os_family'] == 'Darwin')|ternary('/Users/ansibulluser/', '/home/ansibulluser/')}}\"\n+    ssh_key_file: .ssh/ansible_test_rsa\n+    pub_file: '{{ssh_key_file}}.pub'\n+    key_files:\n+      - '{{ssh_key_file}}'\n+      - '{{pub_file}}'\n+  block:\n+  - name: Ensure clean/non existsing ansibulluser\n+    user: name=ansibulluser state=absent\n+\n+  - name: Test creating ssh key creation\n+    block:\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file}}'\n+\n+    - name: check files exist\n+      stat:\n+        path: '{{home ~ item}}'\n+      register: stat_keys\n+      loop: '{{ key_files }}'\n+\n+    - name: ensure they exist\n+      assert:\n+        that:\n+          - stat_keys.results[item].stat.exists\n+      loop: [0, 1]\n+\n+    always:\n+    - name: Clean ssh keys\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent\n+\n+  - name: Ensure we don't break on conflicts\n+    block:\n+    - name: flag file for test\n+      tempfile:\n+      register: flagfile\n+\n+    - name: precreate public .ssh\n+      file: path={{home ~ '.ssh'}} state=directory\n+\n+    - name: setup public key linked to flag file\n+      file: path={{home ~ pub_file}} src={{flagfile.path}} state=link\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+      ignore_errors: true\n+      register: user_no_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub\n+\n+    - name: ensure we didn't overwrite\n+      assert:\n+        that:\n+          - check_pub.stat.exists\n+          - check_pub.stat.islnk\n+          - check_pub.stat.uid == 0\n+\n+    - name: Create user with ssh key\n+      user:\n+        name: ansibulluser\n+        state: present\n+        generate_ssh_key: yes\n+        ssh_key_file: '{{ ssh_key_file }}'\n+        force: true\n+      ignore_errors: true\n+      register: user_force\n+\n+    - stat: path={{home ~ pub_file}}\n+      register: check_pub2\n+\n+    - name: ensure we failed since we didn't force overwrite\n+      assert:\n+        that:\n+          - user_force is success\n+          - check_pub2.stat.exists\n+          - not check_pub2.stat.islnk\n+          - check_pub2.stat.uid != 0\n+    always:\n+    - name: Clean up files\n+      file: path={{ home ~ item }} state=absent\n+      loop: '{{ key_files + [flagfile.path] }}'\n+\n+    - name: Ensure clean/non existsing ansibulluser\n+      user: name=ansibulluser state=absent"
            },
            {
                "sha": "c4cdb4800f70478cc2702e1511cd73fba12d245b",
                "filename": "test/integration/targets/user/tasks/test_local.yml",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/ansible/ansible/blob/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "raw_url": "https://github.com/ansible/ansible/raw/9d7312f695639e804d2caeb1d0f51c716a9ac7dd/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml",
                "contents_url": "https://api.github.com/repos/ansible/ansible/contents/test%2Fintegration%2Ftargets%2Fuser%2Ftasks%2Ftest_local.yml?ref=9d7312f695639e804d2caeb1d0f51c716a9ac7dd",
                "patch": "@@ -39,6 +39,15 @@\n   tags:\n     - user_test_local_mode\n \n+- name: Ensure no local_ansibulluser\n+  user:\n+    name: local_ansibulluser\n+    state: absent\n+    local: yes\n+    remove: true\n+  tags:\n+    - user_test_local_mode\n+\n - name: Create local_ansibulluser\n   user:\n     name: local_ansibulluser"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/bytecodealliance/cap-std/commits/dcc3818039761331fbeacbb3a40c542b65b5ebf7",
        "url": "https://api.github.com/repos/bytecodealliance/cap-std/commits/dcc3818039761331fbeacbb3a40c542b65b5ebf7",
        "html_url": "https://github.com/bytecodealliance/cap-std/commit/dcc3818039761331fbeacbb3a40c542b65b5ebf7",
        "message": "Add missing reserved file names (#371)",
        "files": [
            {
                "sha": "db59538594e2a337d826ceefd70777b2da1b5dc4",
                "filename": "cap-primitives/src/windows/fs/open_impl.rs",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/bytecodealliance/cap-std/blob/dcc3818039761331fbeacbb3a40c542b65b5ebf7/cap-primitives%2Fsrc%2Fwindows%2Ffs%2Fopen_impl.rs",
                "raw_url": "https://github.com/bytecodealliance/cap-std/raw/dcc3818039761331fbeacbb3a40c542b65b5ebf7/cap-primitives%2Fsrc%2Fwindows%2Ffs%2Fopen_impl.rs",
                "contents_url": "https://api.github.com/repos/bytecodealliance/cap-std/contents/cap-primitives%2Fsrc%2Fwindows%2Ffs%2Fopen_impl.rs?ref=dcc3818039761331fbeacbb3a40c542b65b5ebf7",
                "patch": "@@ -10,12 +10,14 @@ pub(crate) fn open_impl(\n ) -> io::Result<fs::File> {\n     // Windows reserves several special device paths. Disallow opening any\n     // of them.\n+    // See: https://learn.microsoft.com/en-us/windows/win32/fileio/naming-a-file#naming-conventions\n     if let Some(stem) = path.file_stem() {\n         if let Some(stemstr) = stem.to_str() {\n             match stemstr.to_uppercase().as_str() {\n                 \"CON\" | \"PRN\" | \"AUX\" | \"NUL\" | \"COM0\" | \"COM1\" | \"COM2\" | \"COM3\" | \"COM4\"\n-                | \"COM5\" | \"COM6\" | \"COM7\" | \"COM8\" | \"COM9\" | \"LPT0\" | \"LPT1\" | \"LPT2\"\n-                | \"LPT3\" | \"LPT4\" | \"LPT5\" | \"LPT6\" | \"LPT7\" | \"LPT8\" | \"LPT9\" => {\n+                | \"COM5\" | \"COM6\" | \"COM7\" | \"COM8\" | \"COM9\" | \"COM\u00b9\" | \"COM\u00b2\" | \"COM\u00b3\"\n+                | \"LPT0\" | \"LPT1\" | \"LPT2\" | \"LPT3\" | \"LPT4\" | \"LPT5\" | \"LPT6\" | \"LPT7\"\n+                | \"LPT8\" | \"LPT9\" | \"LPT\u00b9\" | \"LPT\u00b2\" | \"LPT\u00b3\" => {\n                     return Err(io::Error::from_raw_os_error(ERROR_FILE_NOT_FOUND as i32));\n                 }\n                 _ => {}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/workos/authkit-remix/commits/32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06",
        "url": "https://api.github.com/repos/workos/authkit-remix/commits/32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06",
        "html_url": "https://github.com/workos/authkit-remix/commit/32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06",
        "message": "Update logging strategy (#27)",
        "files": [
            {
                "sha": "adda2debe67a362df14e5b513efda473f3a5cdcb",
                "filename": "package.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/workos/authkit-remix/blob/32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06/package.json",
                "raw_url": "https://github.com/workos/authkit-remix/raw/32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06/package.json",
                "contents_url": "https://api.github.com/repos/workos/authkit-remix/contents/package.json?ref=32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06",
                "patch": "@@ -1,6 +1,6 @@\n {\n   \"name\": \"@workos-inc/authkit-remix\",\n-  \"version\": \"0.4.0\",\n+  \"version\": \"0.4.1\",\n   \"description\": \"Authentication and session helpers for using WorkOS & AuthKit with Remix\",\n   \"sideEffects\": false,\n   \"type\": \"commonjs\","
            },
            {
                "sha": "8398ee1780e449168696670ffd7e4177ed8544d6",
                "filename": "src/session.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/workos/authkit-remix/blob/32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06/src%2Fsession.ts",
                "raw_url": "https://github.com/workos/authkit-remix/raw/32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06/src%2Fsession.ts",
                "contents_url": "https://api.github.com/repos/workos/authkit-remix/contents/src%2Fsession.ts?ref=32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06",
                "patch": "@@ -27,15 +27,15 @@ async function updateSession(request: Request, debug: boolean) {\n   }\n \n   try {\n-    if (debug) console.log('Session invalid. Attempting refresh', session.refreshToken);\n+    if (debug) console.log(`Session invalid. Refreshing access token that ends in ${session.accessToken.slice(-10)}`);\n \n     // If the session is invalid (i.e. the access token has expired) attempt to re-authenticate with the refresh token\n     const { accessToken, refreshToken } = await workos.userManagement.authenticateWithRefreshToken({\n       clientId: WORKOS_CLIENT_ID,\n       refreshToken: session.refreshToken,\n     });\n \n-    if (debug) console.log('Refresh successful:', refreshToken);\n+    if (debug) console.log(`Refresh successful. New access token ends in ${accessToken.slice(-10)}`);\n \n     const newSession = {\n       accessToken,"
            },
            {
                "sha": "23d0d885287a8a7f12cd3ee32c00c787c14053c2",
                "filename": "src/workos.ts",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/workos/authkit-remix/blob/32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06/src%2Fworkos.ts",
                "raw_url": "https://github.com/workos/authkit-remix/raw/32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06/src%2Fworkos.ts",
                "contents_url": "https://api.github.com/repos/workos/authkit-remix/contents/src%2Fworkos.ts?ref=32d5bcd54c795c1e2a3204f8e3977ab9ad57ec06",
                "patch": "@@ -1,7 +1,7 @@\n import { WorkOS } from '@workos-inc/node';\n import { WORKOS_API_HOSTNAME, WORKOS_API_HTTPS, WORKOS_API_KEY, WORKOS_API_PORT } from './env-variables.js';\n \n-const VERSION = '0.4.0';\n+const VERSION = '0.4.1';\n \n const options = {\n   apiHostname: WORKOS_API_HOSTNAME,"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/OctoPrint/OctoPrint/commits/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
        "url": "https://api.github.com/repos/OctoPrint/OctoPrint/commits/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
        "html_url": "https://github.com/OctoPrint/OctoPrint/commit/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
        "message": "Merge branch 'regressionfix/xss-issues' into staging/bugfix",
        "files": [
            {
                "sha": "e18f2cf7760ef20f1281feb608b163bcc1be656b",
                "filename": "src/octoprint/plugins/appkeys/__init__.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Fplugins%2Fappkeys%2F__init__.py",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Fplugins%2Fappkeys%2F__init__.py",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fplugins%2Fappkeys%2F__init__.py?ref=b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
                "patch": "@@ -260,7 +260,7 @@ def handle_auth_dialog(self, app_token):\n                 theming=[],\n                 request_text=gettext(\n                     '\"<strong>%(app)s</strong>\" has requested access to control OctoPrint through the API.'\n-                ).replace(\"%(app)s\", app_id),\n+                ),\n             )\n         )\n         return add_csrf_cookie(add_non_caching_response_headers(response))"
            },
            {
                "sha": "6217f0c1f94886e046d7e5eed0125139fbbf0649",
                "filename": "src/octoprint/plugins/appkeys/templates/appkeys_authdialog.jinja2",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Fplugins%2Fappkeys%2Ftemplates%2Fappkeys_authdialog.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Fplugins%2Fappkeys%2Ftemplates%2Fappkeys_authdialog.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fplugins%2Fappkeys%2Ftemplates%2Fappkeys_authdialog.jinja2?ref=b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
                "patch": "@@ -18,7 +18,7 @@\n     <link rel=\"stylesheet\" href=\"{{ url_for('plugin.appkeys.static', filename='css/authdialog.css') }}\">\n \n     {% for url in theming %}\n-        <link rel=\"stylesheet\" href=\"{{ url }}\">\n+        <link rel=\"stylesheet\" href=\"{{ url|e }}\">\n     {% endfor %}\n \n     <!-- le javascript -->\n@@ -45,8 +45,8 @@\n         <form id=\"auth-choice\" class=\"form-auth\">\n             <h2 class=\"form-auth-heading\" data-test-id=\"login-title\">{{ _('Access Request') }}</h2>\n \n-            <p>{% trans %}Hello {{ user }}!{% endtrans %}</p>\n-            <p>{{ request_text }}</p>\n+            <p>{{ _(\"Hello %(user)s!\", user=user|e) }}</p>\n+            <p>{{ request_text | format(app=app|e) }}</p>\n             <p>{% trans %}\n                 Do you want to allow access to this application with your user account?\n             {% endtrans %}</p>"
            },
            {
                "sha": "71d945b72f5da92a62168ed025db1a18064f004e",
                "filename": "src/octoprint/plugins/discovery/templates/discovery.xml.jinja2",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Fplugins%2Fdiscovery%2Ftemplates%2Fdiscovery.xml.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Fplugins%2Fdiscovery%2Ftemplates%2Fdiscovery.xml.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fplugins%2Fdiscovery%2Ftemplates%2Fdiscovery.xml.jinja2?ref=b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
                "patch": "@@ -1,3 +1,4 @@\n+{%- autoescape true -%}\n <?xml version=\"1.0\"?>\n <root xmlns=\"urn:schemas-upnp-org:device-1-0\">\n     <specVersion>\n@@ -20,3 +21,4 @@\n         <presentationURL>{{ presentationUrl }}</presentationURL>\n     </device>\n </root>\n+{%- endautoescape -%}"
            },
            {
                "sha": "f55512bea3023da972aec379da0e5075f8969e06",
                "filename": "src/octoprint/plugins/pluginmanager/templates/pluginmanager_about.jinja2",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Fplugins%2Fpluginmanager%2Ftemplates%2Fpluginmanager_about.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Fplugins%2Fpluginmanager%2Ftemplates%2Fpluginmanager_about.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fplugins%2Fpluginmanager%2Ftemplates%2Fpluginmanager_about.jinja2?ref=b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
                "patch": "@@ -2,7 +2,7 @@\n \n <ul>\n     {% for plugin in plugin_pluginmanager_thirdparty %}\n-        <li>{% if plugin.url %}<a href=\"{{ plugin.url }}\" target=\"_blank\" rel=\"noreferrer noopener\">{% endif %}{{ plugin.name }}{% if plugin.url %}</a>{% endif %}: {% if plugin.license %}{{ plugin.license }}{% else %}-{% endif %}</li>\n+        <li>{% if plugin.url %}<a href=\"{{ plugin.url|e }}\" target=\"_blank\" rel=\"noreferrer noopener\">{% endif %}{{ plugin.name|e }}{% if plugin.url %}</a>{% endif %}: {% if plugin.license %}{{ plugin.license|e }}{% else %}-{% endif %}</li>\n     {% endfor %}\n </ul>\n \n@@ -11,7 +11,7 @@\n \n     {% for key in templates.plugin_pluginmanager_about_thirdparty.order %}\n         {% set heading, config = templates.plugin_pluginmanager_about_thirdparty.entries[key] %}\n-        <h4>{{ heading }}</h4>\n+        <h4>{{ heading|e }}</h4>\n \n         {% include config.template ignore missing %}\n     {% endfor %}"
            },
            {
                "sha": "7823e0982160dfb2694b0d273ba242503ed6fa3b",
                "filename": "src/octoprint/templates/dialogs/about/about.jinja2",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Ftemplates%2Fdialogs%2Fabout%2Fabout.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Ftemplates%2Fdialogs%2Fabout%2Fabout.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Ftemplates%2Fdialogs%2Fabout%2Fabout.jinja2?ref=b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
                "patch": "@@ -2,7 +2,7 @@\n \n <h4>{{ _('The snappy web interface for your 3D printer') }}</h4>\n \n-<p>Version <span class=\"version\">{{ display_version }}</span></p>\n+<p>Version <span class=\"version\">{{ display_version|e }}</span></p>\n \n <ul class=\"fa-ul\">\n     <li><i class=\"fa-li fas fa-home\"></i> Website: <a href=\"https://octoprint.org\" target=\"_blank\" rel=\"noreferrer noopener\">octoprint.org</a></li>"
            },
            {
                "sha": "94f6ad48b3af80a132f74105b065cc7293b40fa4",
                "filename": "src/octoprint/templates/login.jinja2",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Ftemplates%2Flogin.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Ftemplates%2Flogin.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Ftemplates%2Flogin.jinja2?ref=b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
                "patch": "@@ -83,7 +83,7 @@\n                 {{ _('An account with the following permissions is required:') }} {{ permission_names|join(\", \") }}\n             </p>{% endif %}\n \n-            <input type=\"text\" id=\"login-user\" data-test-id=\"login-username\" class=\"input-block-level\" placeholder=\"{{ _('Username')|edq }}\" {% if user_id %}value=\"{{ user_id|edq }}\" disabled{% endif %} autofocus autocapitalize=\"none\">\n+            <input type=\"text\" id=\"login-user\" data-test-id=\"login-username\" class=\"input-block-level\" placeholder=\"{{ _('Username')|edq }}\" {% if user_id %}value=\"{{ user_id|e }}\" disabled{% endif %} autofocus autocapitalize=\"none\">\n             <input type=\"password\" id=\"login-password\" data-test-id=\"login-password\" class=\"input-block-level\" placeholder=\"{{ _('Password')|edq }}\">\n             {% if not reauthenticate %}\n             <span class=\"pull-right\"><small><a href=\"https://faq.octoprint.org/forgotten-password\" id=\"login-forgotpassword\" target=\"_blank\" tabindex=\"-1\">{{ _('Forgot password?') }}</a></small></span>"
            },
            {
                "sha": "37f3de9fe322be9e719644c52af9c0fd2f8bd573",
                "filename": "src/octoprint/templates/recovery.jinja2",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Ftemplates%2Frecovery.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Ftemplates%2Frecovery.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Ftemplates%2Frecovery.jinja2?ref=b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
                "patch": "@@ -18,7 +18,7 @@\n     <link rel=\"stylesheet\" href=\"{{ url_for(\"static\", filename=\"css/recovery.css\") }}\">\n \n     {% for url in theming %}\n-        <link rel=\"stylesheet\" href=\"{{ url }}\">\n+        <link rel=\"stylesheet\" href=\"{{ url|e }}\">\n     {% endfor %}\n \n     <!-- le javascript -->"
            },
            {
                "sha": "8f35f8bce8847114ca5d52031aae8f0aaca85045",
                "filename": "src/octoprint/templates/reverse_proxy_test.jinja2",
                "status": "modified",
                "additions": 17,
                "deletions": 17,
                "changes": 34,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Ftemplates%2Freverse_proxy_test.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/b8a6b0a75202edac3bb142a8e4f9041a0b6825bf/src%2Foctoprint%2Ftemplates%2Freverse_proxy_test.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Ftemplates%2Freverse_proxy_test.jinja2?ref=b8a6b0a75202edac3bb142a8e4f9041a0b6825bf",
                "patch": "@@ -17,20 +17,20 @@\n     <link rel=\"stylesheet\" href=\"{{ url_for(\"static\", filename=\"vendor/font-awesome-5.15.1/css/v4-shims.min\") }}\">\n \n     {% for url in theming %}\n-        <link rel=\"stylesheet\" href=\"{{ url }}\">\n+        <link rel=\"stylesheet\" href=\"{{ url|e }}\">\n     {% endfor %}\n \n     <!-- le javascript -->\n \n     <script>\n         var BASE_URL = \"{{ url_for('index') }}\";\n \n-        var CLIENT_IP = \"{{ client_ip }}\";\n-        var SERVER_PROTOCOL = \"{{ server_protocol }}\";\n-        var SERVER_NAME = \"{{ server_name }}\";\n-        var SERVER_PORT = {{ server_port }};\n-        var SERVER_PATH = \"{{ server_path }}\";\n-        var COOKIE_SUFFIX = \"{{ cookie_suffix }}\";\n+        var CLIENT_IP = \"{{ client_ip|e }}\";\n+        var SERVER_PROTOCOL = \"{{ server_protocol|e }}\";\n+        var SERVER_NAME = \"{{ server_name|e }}\";\n+        var SERVER_PORT = {{ server_port|e }};\n+        var SERVER_PATH = \"{{ server_path|e }}\";\n+        var COOKIE_SUFFIX = \"{{ cookie_suffix|e }}\";\n     </script>\n     <script src=\"{{ url_for(\"static\", filename=\"js/lib/jquery/jquery.min.js\") }}\"></script>\n     <script src=\"{{ url_for(\"static\", filename=\"js/lib/knockout.js\") }}\"></script>\n@@ -85,37 +85,37 @@\n                 <td>Client IP</td>\n                 <td><code>X-Forwarded-For</code></td>\n                 <td>-</td>\n-                <td>{{ client_ip }}</td>\n+                <td>{{ client_ip|e }}</td>\n             </tr>\n             <tr data-bind=\"css: { success: serverProtocolMatch, error: !serverProtocolMatch }\">\n                 <td>Protocol</td>\n                 <td><code>X-Forwarded-Protocol</code>, <code>X-Scheme</code> or config</td>\n                 <td data-bind=\"text: serverProtocol\"></td>\n-                <td>{{ server_protocol }}</td>\n+                <td>{{ server_protocol|e }}</td>\n             </tr>\n             <tr data-bind=\"css: { success: serverNameMatch, error: !serverNameMatch }\">\n                 <td>Host</td>\n                 <td><code>X-Forwarded-Host</code>, <code>Host</code>, <code>X-Forwarded-Server</code> or config</td>\n                 <td data-bind=\"text: serverName\"></td>\n-                <td>{{ server_name }}</td>\n+                <td>{{ server_name|e }}</td>\n             </tr>\n             <tr data-bind=\"css: { success: serverPortMatch, error: !serverPortMatch }\">\n                 <td>Port</td>\n                 <td><code>X-Forwarded-Host</code>, <code>Host</code>, <code>X-Forwarded-Port</code>, <code>X-Forwarded-Protocol</code>, <code>X-Scheme</code> or config</td>\n                 <td data-bind=\"text: serverPort\"></td>\n-                <td>{{ server_port }}</td>\n+                <td>{{ server_port|e }}</td>\n             </tr>\n             <tr data-bind=\"css: { success: serverPathMatch, error: !serverPathMatch }\">\n                 <td>Path</td>\n                 <td><code>X-Script-Name</code> or config</td>\n                 <td data-bind=\"text: serverPath\"></td>\n-                <td>{{ server_path }}</td>\n+                <td>{{ server_path|e }}</td>\n             </tr>\n             <tr data-bind=\"css: { success: cookieSuffixMatch, error: !cookieSuffixMatch }\">\n                 <td>Cookie Suffix</td>\n                 <td>Built from port & path</td>\n                 <td data-bind=\"text: cookieSuffix\"></td>\n-                <td>{{ cookie_suffix }}</td>\n+                <td>{{ cookie_suffix|e }}</td>\n             </tr>\n         </table>\n \n@@ -126,20 +126,20 @@\n \n             <ul>\n                 {% for key, value in headers.items() %}\n-                    <li><code>{{ key }}</code>: <code>{{ value }}</code></li>\n+                    <li><code>{{ key|e }}</code>: <code>{{ value|e }}</code></li>\n                 {% endfor %}\n             </ul>\n \n             <p>\n-                Your server side Client IP was determined to be {{ client_ip }}. Your <code>X-Forwarded-For</code> header\n-                {% if headers[\"X-Forwarded-For\"] %} (<code>{{ headers[\"X-Forwarded-For\"] }}</code>){% endif %} might\n+                Your server side Client IP was determined to be {{ client_ip|e }}. Your <code>X-Forwarded-For</code> header\n+                {% if headers[\"X-Forwarded-For\"] %} (<code>{{ headers[\"X-Forwarded-For\"]|e }}</code>){% endif %} might\n                 have influenced that. Make sure that this is the IP that OctoPrint should be seeing. It will be the right most\n                 IP in the <code>X-Forwarded-For</code> header that is not among your <strong>configured trusted downstreams</strong>:\n             </p>\n \n             <ul>\n                 {% for host in trusted_proxies %}\n-                    <li><code>{{ host }}</code></li>\n+                    <li><code>{{ host|e }}</code></li>\n                 {% endfor %}\n             </ul>\n         {% else %}"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/OctoPrint/OctoPrint/commits/9bc80d782d72881b16e20873dcd0b8314324c70c",
        "url": "https://api.github.com/repos/OctoPrint/OctoPrint/commits/9bc80d782d72881b16e20873dcd0b8314324c70c",
        "html_url": "https://github.com/OctoPrint/OctoPrint/commit/9bc80d782d72881b16e20873dcd0b8314324c70c",
        "message": "Merge branch 'bug/password-repeat-bypass' into staging/bugfix",
        "files": [
            {
                "sha": "f0938bee8e324ab87fbe4310972202c5324a2d50",
                "filename": "src/octoprint/server/api/access.py",
                "status": "modified",
                "additions": 12,
                "deletions": 2,
                "changes": 14,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fserver%2Fapi%2Faccess.py",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fserver%2Fapi%2Faccess.py",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fserver%2Fapi%2Faccess.py?ref=9bc80d782d72881b16e20873dcd0b8314324c70c",
                "patch": "@@ -11,6 +11,7 @@\n from octoprint.server import SUCCESS, groupManager, userManager\n from octoprint.server.api import api, valid_boolean_trues\n from octoprint.server.util.flask import (\n+    credentials_checked_recently,\n     ensure_credentials_checked_recently,\n     no_firstrun_access,\n     require_credentials_checked_recently,\n@@ -132,7 +133,11 @@ def remove_group(key):\n @no_firstrun_access\n @Permissions.ADMIN.require(403)\n def get_users():\n-    return jsonify(users=list(map(lambda u: u.as_dict(), userManager.get_all_users())))\n+    users = [u.as_dict() for u in userManager.get_all_users()]\n+    if not credentials_checked_recently():\n+        for u in users:\n+            u[\"apikey\"] = None\n+    return jsonify(users=users)\n \n \n @api.route(\"/access/users\", methods=[\"POST\"])\n@@ -178,7 +183,10 @@ def get_user(username):\n     ):\n         user = userManager.find_user(username)\n         if user is not None:\n-            return jsonify(user)\n+            user_dict = user.as_dict()\n+            if not credentials_checked_recently():\n+                user_dict[\"apikey\"] = None\n+            return jsonify(user_dict)\n         else:\n             abort(404)\n     else:\n@@ -323,6 +331,7 @@ def change_settings_for_user(username):\n \n @api.route(\"/access/users/<username>/apikey\", methods=[\"DELETE\"])\n @no_firstrun_access\n+@require_credentials_checked_recently\n def delete_apikey_for_user(username):\n     if (\n         current_user is not None\n@@ -347,6 +356,7 @@ def delete_apikey_for_user(username):\n \n @api.route(\"/access/users/<username>/apikey\", methods=[\"POST\"])\n @no_firstrun_access\n+@require_credentials_checked_recently\n def generate_apikey_for_user(username):\n     if not userManager.enabled:\n         return jsonify(SUCCESS)"
            },
            {
                "sha": "340f6a35ca33165940d9d007523a88c9884b0bda",
                "filename": "src/octoprint/server/api/settings.py",
                "status": "modified",
                "additions": 21,
                "deletions": 9,
                "changes": 30,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fserver%2Fapi%2Fsettings.py",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fserver%2Fapi%2Fsettings.py",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fserver%2Fapi%2Fsettings.py?ref=9bc80d782d72881b16e20873dcd0b8314324c70c",
                "patch": "@@ -16,6 +16,7 @@\n from octoprint.server.util.flask import (\n     credentials_checked_recently,\n     no_firstrun_access,\n+    require_credentials_checked_recently,\n     with_revalidation_checking,\n )\n from octoprint.settings import settings, valid_boolean_trues\n@@ -478,6 +479,7 @@ def setSettings():\n @api.route(\"/settings/apikey\", methods=[\"POST\"])\n @no_firstrun_access\n @Permissions.ADMIN.require(403)\n+@require_credentials_checked_recently\n def generateApiKey():\n     apikey = settings().generateApiKey()\n     return jsonify(apikey=apikey)\n@@ -486,6 +488,7 @@ def generateApiKey():\n @api.route(\"/settings/apikey\", methods=[\"DELETE\"])\n @no_firstrun_access\n @Permissions.ADMIN.require(403)\n+@require_credentials_checked_recently\n def deleteApiKey():\n     settings().deleteApiKey()\n     return NO_CONTENT\n@@ -581,7 +584,8 @@ def _saveSettings(data):\n             s.set([\"appearance\", \"color\"], data[\"appearance\"][\"color\"])\n         if \"colorTransparent\" in data[\"appearance\"]:\n             s.setBoolean(\n-                [\"appearance\", \"colorTransparent\"], data[\"appearance\"][\"colorTransparent\"]\n+                [\"appearance\", \"colorTransparent\"],\n+                data[\"appearance\"][\"colorTransparent\"],\n             )\n         if \"colorIcon\" in data[\"appearance\"]:\n             s.setBoolean([\"appearance\", \"colorIcon\"], data[\"appearance\"][\"colorIcon\"])\n@@ -639,7 +643,10 @@ def _saveSettings(data):\n         if \"ffmpegCommandline\" in data[\"webcam\"]:\n             commandline = data[\"webcam\"][\"ffmpegCommandline\"]\n             if not all(\n-                map(lambda x: \"{\" + x + \"}\" in commandline, (\"ffmpeg\", \"input\", \"output\"))\n+                map(\n+                    lambda x: \"{\" + x + \"}\" in commandline,\n+                    (\"ffmpeg\", \"input\", \"output\"),\n+                )\n             ):\n                 abort(\n                     400,\n@@ -855,7 +862,8 @@ def _saveSettings(data):\n             data[\"serial\"][\"blacklistedBaudrates\"], (list, tuple)\n         ):\n             s.set(\n-                [\"serial\", \"blacklistedBaudrates\"], data[\"serial\"][\"blacklistedBaudrates\"]\n+                [\"serial\", \"blacklistedBaudrates\"],\n+                data[\"serial\"][\"blacklistedBaudrates\"],\n             )\n         if \"longRunningCommands\" in data[\"serial\"] and isinstance(\n             data[\"serial\"][\"longRunningCommands\"], (list, tuple)\n@@ -942,7 +950,8 @@ def _saveSettings(data):\n             s.setBoolean([\"serial\", \"sdLowerCase\"], data[\"serial\"][\"sdLowerCase\"])\n         if \"swallowOkAfterResend\" in data[\"serial\"]:\n             s.setBoolean(\n-                [\"serial\", \"swallowOkAfterResend\"], data[\"serial\"][\"swallowOkAfterResend\"]\n+                [\"serial\", \"swallowOkAfterResend\"],\n+                data[\"serial\"][\"swallowOkAfterResend\"],\n             )\n         if \"repetierTargetTemp\" in data[\"serial\"]:\n             s.setBoolean(\n@@ -1040,18 +1049,21 @@ def _saveSettings(data):\n                 data[\"serial\"][\"capEmergencyParser\"],\n             )\n         if \"capExtendedM20\" in data[\"serial\"]:\n-            s.setBoolean(\n-                [\"serial\", \"capabilities\", \"extended_m20\"],\n-                data[\"serial\"][\"capExtendedM20\"],\n-            ),\n+            (\n+                s.setBoolean(\n+                    [\"serial\", \"capabilities\", \"extended_m20\"],\n+                    data[\"serial\"][\"capExtendedM20\"],\n+                ),\n+            )\n         if \"capLfnWrite\" in data[\"serial\"]:\n             s.setBoolean(\n                 [\"serial\", \"capabilities\", \"lfn_write\"],\n                 data[\"serial\"][\"capLfnWrite\"],\n             )\n         if \"resendRatioThreshold\" in data[\"serial\"]:\n             s.setInt(\n-                [\"serial\", \"resendRatioThreshold\"], data[\"serial\"][\"resendRatioThreshold\"]\n+                [\"serial\", \"resendRatioThreshold\"],\n+                data[\"serial\"][\"resendRatioThreshold\"],\n             )\n         if \"resendRatioStart\" in data[\"serial\"]:\n             s.setInt([\"serial\", \"resendRatioStart\"], data[\"serial\"][\"resendRatioStart\"])"
            },
            {
                "sha": "ee352f4d70db6ec2036570afb2e5cd825d3eb3b4",
                "filename": "src/octoprint/static/js/app/viewmodels/access.js",
                "status": "modified",
                "additions": 36,
                "deletions": 0,
                "changes": 36,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Faccess.js",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Faccess.js",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Faccess.js?ref=9bc80d782d72881b16e20873dcd0b8314324c70c",
                "patch": "@@ -43,6 +43,9 @@ $(function () {\n                 return !self.isCurrentUser(user);\n             };\n \n+            self.apikeysVisible = ko.observable(false);\n+            self.revealingApikeys = ko.observable(false);\n+\n             self.editor = {\n                 name: ko.observable(undefined),\n                 groups: ko.observableArray([]),\n@@ -163,6 +166,9 @@ $(function () {\n \n             self.fromResponse = function (response) {\n                 self.listHelper.updateItems(response.users);\n+\n+                // This should only be true if the request was triggered by a click on \"reveal api key\"\n+                self.apikeysVisible(self.revealingApikeys());\n             };\n \n             self.showAddUserDialog = function () {\n@@ -355,6 +361,22 @@ $(function () {\n                 });\n             };\n \n+            self.revealApikeys = () => {\n+                access.loginState.reauthenticateIfNecessary(() => {\n+                    self.revealingApikeys(true);\n+                    self.requestData().always(() => {\n+                        self.revealingApikeys(false);\n+                        if (self.currentUser()) {\n+                            OctoPrint.access.users\n+                                .get(self.currentUser().name)\n+                                .done((data) => {\n+                                    self.currentUser(data);\n+                                });\n+                        }\n+                    });\n+                });\n+            };\n+\n             self.copyApikey = function () {\n                 copyToClipboard(self.editor.apikey());\n             };\n@@ -381,6 +403,16 @@ $(function () {\n                 self.changePasswordDialog = $(\"#settings-usersDialogChangePassword\");\n             };\n \n+            self.onUserCredentialsOutdated = () => {\n+                self.apikeysVisible(false);\n+                self.requestData();\n+                if (self.currentUser()) {\n+                    OctoPrint.access.users.get(self.currentUser().name).done((data) => {\n+                        self.currentUser(data);\n+                    });\n+                }\n+            };\n+\n             //~~ API calls\n \n             self.addUser = function (user) {\n@@ -980,6 +1012,10 @@ $(function () {\n             access.permissions.initialize();\n         };\n \n+        access.onUserCredentialsOutdated = () => {\n+            access.users.onUserCredentialsOutdated();\n+        };\n+\n         access.onUserPermissionsChanged =\n             access.onUserLoggedIn =\n             access.onUserLoggedOut ="
            },
            {
                "sha": "1326d9a60c4506f29fd2d2358034e02b5b6dca01",
                "filename": "src/octoprint/static/js/app/viewmodels/loginstate.js",
                "status": "modified",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Floginstate.js",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Floginstate.js",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Floginstate.js?ref=9bc80d782d72881b16e20873dcd0b8314324c70c",
                "patch": "@@ -21,7 +21,35 @@ $(function () {\n \n         self.currentUser = ko.observable(undefined);\n         self.currentLoginMechanism = ko.observable(undefined);\n+\n         self.credentialsSeen = ko.observable(undefined);\n+        self.credentialsSeenTimeout = undefined;\n+        self.credentialsSeen.subscribe(() => {\n+            const credentialsSeen = self.credentialsSeen();\n+            if (credentialsSeen === undefined) {\n+                return;\n+            }\n+\n+            if (CONFIG_REAUTHENTICATION_TIMEOUT <= 0) return;\n+\n+            if (self.credentialsSeenTimeout)\n+                window.clearTimeout(self.credentialsSeenTimeout);\n+\n+            const now = new Date();\n+            const seen = new Date(credentialsSeen);\n+            const timeout =\n+                seen.getTime() +\n+                (CONFIG_REAUTHENTICATION_TIMEOUT * 60 + 10) * 1000 -\n+                now.getTime();\n+\n+            if (timeout > 0) {\n+                callViewModels(self.allViewModels, \"onUserCredentialsRefreshed\");\n+                window.setTimeout(() => {\n+                    callViewModels(self.allViewModels, \"onUserCredentialsOutdated\");\n+                    self.credentialsSeenTimeout = undefined;\n+                }, timeout);\n+            }\n+        });\n \n         self.elementUsernameInput = undefined;\n         self.elementPasswordInput = undefined;"
            },
            {
                "sha": "97d2bfa5a11ebf9d7259732e7388abae2073970a",
                "filename": "src/octoprint/static/js/app/viewmodels/settings.js",
                "status": "modified",
                "additions": 20,
                "deletions": 18,
                "changes": 38,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Fsettings.js",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Fsettings.js",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Fsettings.js?ref=9bc80d782d72881b16e20873dcd0b8314324c70c",
                "patch": "@@ -128,6 +128,7 @@ $(function () {\n         self.api_allowCrossOrigin = ko.observable(undefined);\n \n         self.apiKeyVisible = ko.observable(false);\n+        self.revealingApiKey = ko.observable(false);\n \n         self.appearance_name = ko.observable(undefined);\n         self.appearance_color = ko.observable(undefined);\n@@ -689,17 +690,19 @@ $(function () {\n             self.settingsDialog.modal(\"hide\");\n         };\n \n-        self.generateApiKey = function () {\n+        self.generateApiKey = () => {\n             if (!CONFIG_ACCESS_CONTROL) return;\n \n             showConfirmationDialog(\n                 gettext(\n                     \"This will generate a new API Key. The old API Key will cease to function immediately.\"\n                 ),\n-                function () {\n-                    OctoPrint.settings.generateApiKey().done(function (response) {\n-                        self.api_key(response.apikey);\n-                        self.requestData();\n+                () => {\n+                    self.loginState.reauthenticateIfNecessary(() => {\n+                        OctoPrint.settings.generateApiKey().done((response) => {\n+                            self.api_key(response.apikey);\n+                            self.requestData();\n+                        });\n                     });\n                 }\n             );\n@@ -713,9 +716,11 @@ $(function () {\n                 gettext(\n                     \"This will delete the API Key. It will cease to to function immediately.\"\n                 ),\n-                function () {\n-                    OctoPrint.settings.deleteApiKey().done(() => {\n-                        self.api_key(undefined);\n+                () => {\n+                    self.loginState.reauthenticateIfNecessary(() => {\n+                        OctoPrint.settings.deleteApiKey().done(() => {\n+                            self.api_key(undefined);\n+                        });\n                     });\n                 }\n             );\n@@ -725,7 +730,6 @@ $(function () {\n             copyToClipboard(self.api_key());\n         };\n \n-        self.revealingApiKey = ko.observable(false);\n         self.revealApiKey = () => {\n             self.loginState.reauthenticateIfNecessary(() => {\n                 self.revealingApiKey(true);\n@@ -1095,7 +1099,6 @@ $(function () {\n             return data;\n         };\n \n-        self.reauthenticationTimeout = undefined;\n         self.fromResponse = function (response, local) {\n             // server side changes to set\n             var serverChangedData;\n@@ -1284,14 +1287,8 @@ $(function () {\n \n             firstRequest.resolve();\n \n-            // special delivery for the API key flag\n-            self.apiKeyVisible(self.loginState.checkCredentialsSeen());\n-            if (self.apiKeyVisible()) {\n-                self.reauthenticationTimeout =\n-                    self.loginState.afterReauthenticationTimeout(() => {\n-                        self.requestData();\n-                    }, self.reauthenticationTimeout);\n-            }\n+            // this should only ever return true if we triggered the request through the \"reveal api key\" button\n+            self.apiKeyVisible(self.revealingApiKey());\n \n             // if autologinLocal is enabled and the heads-up not yet acknowledged, show it now\n             if (\n@@ -1494,6 +1491,11 @@ $(function () {\n                     self.requestData();\n                 };\n \n+        self.onUserCredentialsOutdated = () => {\n+            self.apiKeyVisible(false);\n+            self.requestData();\n+        };\n+\n         self.validURL = function (str) {\n             var pattern = new RegExp(\n                 \"^(https?:\\\\/\\\\/)?\" + // protocol"
            },
            {
                "sha": "443bafc96c6b004b4ce59db19bc9005b55d99e9b",
                "filename": "src/octoprint/static/js/app/viewmodels/usersettings.js",
                "status": "modified",
                "additions": 54,
                "deletions": 21,
                "changes": 75,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Fusersettings.js",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Fusersettings.js",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Fstatic%2Fjs%2Fapp%2Fviewmodels%2Fusersettings.js?ref=9bc80d782d72881b16e20873dcd0b8314324c70c",
                "patch": "@@ -30,6 +30,9 @@ $(function () {\n         self.access_apikey = ko.observable(undefined);\n         self.interface_language = ko.observable(undefined);\n \n+        self.apiKeyVisible = ko.observable(false);\n+        self.revealingApiKey = ko.observable(false);\n+\n         self.currentUser = ko.observable(undefined);\n         self.currentUser.subscribe(function (newUser) {\n             self.access_password(undefined);\n@@ -57,32 +60,44 @@ $(function () {\n             return self.access_password() !== self.access_repeatedPassword();\n         });\n \n-        self.show = function (user) {\n+        self.show = (user) => {\n             if (!CONFIG_ACCESS_CONTROL) return;\n \n             if (user === undefined) {\n                 user = self.loginState.currentUser();\n             }\n \n-            var process = function (user) {\n-                self.currentUser(user);\n-                self.userSettingsDialog.modal(\"show\");\n-            };\n-\n             // make sure we have the current user data, see #2534\n-            OctoPrint.access.users\n-                .get(user.name)\n-                .done(function (data) {\n-                    process(data);\n+            self.requestData(user.name)\n+                .done(() => {\n+                    self.userSettingsDialog.modal(\"show\");\n                 })\n-                .fail(function () {\n+                .fail(() => {\n                     log.warn(\n                         \"Could not fetch current user data, proceeding with client side data copy\"\n                     );\n-                    process(user);\n+                    self.fromResponse(user);\n                 });\n         };\n \n+        self.requestData = (name) => {\n+            if (name === undefined && self.currentUser() === undefined) return;\n+            if (name === undefined) {\n+                name = self.currentUser().name;\n+            }\n+\n+            return OctoPrint.access.users.get(name).done((data) => {\n+                self.fromResponse(data);\n+            });\n+        };\n+\n+        self.fromResponse = (data) => {\n+            self.currentUser(data);\n+\n+            // this should only ever return true if we triggered the request through the \"reveal api key\" button\n+            self.apiKeyVisible(self.revealingApiKey());\n+        };\n+\n         self.save = function () {\n             if (!CONFIG_ACCESS_CONTROL) return;\n \n@@ -129,12 +144,14 @@ $(function () {\n         self.generateApikey = function () {\n             if (!CONFIG_ACCESS_CONTROL) return;\n \n-            var generate = function () {\n-                self.users\n-                    .generateApikey(self.currentUser().name)\n-                    .done(function (response) {\n-                        self.access_apikey(response.apikey);\n-                    });\n+            const generate = () => {\n+                self.loginState.reauthenticateIfNecessary(() => {\n+                    self.users\n+                        .generateApikey(self.currentUser().name)\n+                        .done((response) => {\n+                            self.access_apikey(response.apikey);\n+                        });\n+                });\n             };\n \n             if (self.access_apikey()) {\n@@ -157,14 +174,25 @@ $(function () {\n                 gettext(\n                     \"This will delete the API Key. It will cease to to function immediately.\"\n                 ),\n-                function () {\n-                    self.users.deleteApikey(self.currentUser().name).done(function () {\n-                        self.access_apikey(undefined);\n+                () => {\n+                    self.loginState.reauthenticateIfNecessary(() => {\n+                        self.users.deleteApikey(self.currentUser().name).done(() => {\n+                            self.access_apikey(undefined);\n+                        });\n                     });\n                 }\n             );\n         };\n \n+        self.revealApiKey = () => {\n+            self.loginState.reauthenticateIfNecessary(() => {\n+                self.revealingApiKey(true);\n+                self.requestData(self.currentUser().name).always(() => {\n+                    self.revealingApiKey(false);\n+                });\n+            });\n+        };\n+\n         self.updateSettings = function (username, settings) {\n             return OctoPrint.access.users.saveSettings(username, settings);\n         };\n@@ -188,6 +216,11 @@ $(function () {\n                 callViewModels(allViewModels, \"onUserSettingsBeforeSave\");\n             });\n         };\n+\n+        self.onUserCredentialsOutdated = () => {\n+            self.apiKeyVisible(false);\n+            self.requestData();\n+        };\n     }\n \n     OCTOPRINT_VIEWMODELS.push({"
            },
            {
                "sha": "fb8b3917a0f5ad922c957c2252cd4eb87c365718",
                "filename": "src/octoprint/templates/dialogs/settings/api.jinja2",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Ftemplates%2Fdialogs%2Fsettings%2Fapi.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Ftemplates%2Fdialogs%2Fsettings%2Fapi.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Ftemplates%2Fdialogs%2Fsettings%2Fapi.jinja2?ref=9bc80d782d72881b16e20873dcd0b8314324c70c",
                "patch": "@@ -38,7 +38,7 @@\n                 <button class=\"btn\" data-bind=\"click: revealApiKey, enabled: !revealingApiKey(), css: {disabled: revealingApiKey}\"><i class=\"fas fa-spinner fa-spin\" data-bind=\"visible: revealingApiKey\"></i> {{ _('Reveal API Key') }}</button>\n             </div>\n         </div>\n-        <div class=\"control-group\" data-bind=\"visible: api_key\">\n+        <div class=\"control-group\" data-bind=\"visible: api_key() && apiKeyVisible()\">\n             <label class=\"control-label\">{{ _('QR Code') }}</label>\n             <div class=\"controls\">\n                 <div data-bind=\"qrcode: {text: api_key, size: 180}\"></div>"
            },
            {
                "sha": "1ff108bacea2b05a176741ab0d1ed3b2c742d518",
                "filename": "src/octoprint/templates/dialogs/usersettings/access.jinja2",
                "status": "modified",
                "additions": 5,
                "deletions": 2,
                "changes": 7,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Ftemplates%2Fdialogs%2Fusersettings%2Faccess.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Ftemplates%2Fdialogs%2Fusersettings%2Faccess.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Ftemplates%2Fdialogs%2Fusersettings%2Faccess.jinja2?ref=9bc80d782d72881b16e20873dcd0b8314324c70c",
                "patch": "@@ -32,7 +32,7 @@\n         <legend>{{ _('API Key') }}</legend>\n         <div class=\"control-group\">\n             <label class=\"control-label\" for=\"userSettings-access_apikey\">{{ _('Current API Key') }}</label>\n-            <div class=\"controls\">\n+            <div class=\"controls\" data-bind=\"visible: apiKeyVisible\">\n                 <div class=\"input-append input-block-level\">\n                     <input type=\"text\" readonly=\"readonly\" id=\"userSettings-access_apikey\" data-bind=\"value: access_apikey, attr: {placeholder: '{{ _('N/A')|esq }}'}\">\n                     <a class=\"btn add-on\" title=\"Copy API Key to clipboard\" data-bind=\"click: copyApikey, css: {'disabled': !access_apikey()}\"><i class=\"fas fa-copy\"></i></a>\n@@ -41,8 +41,11 @@\n                 </div>\n                 <span class=\"help-block\">{{ _('Please note that changes to the API key are applied immediately, without having to \"Confirm\" first.') }}</span>\n             </div>\n+            <div class=\"controls\" data-bind=\"visible: !apiKeyVisible()\">\n+                <button class=\"btn\" data-bind=\"click: revealApiKey, enabled: !revealingApiKey(), css: {disabled: revealingApiKey}\"><i class=\"fas fa-spinner fa-spin\" data-bind=\"visible: revealingApiKey\"></i> {{ _('Reveal API Key') }}</button>\n+            </div>\n         </div>\n-        <div class=\"control-group\" data-bind=\"visible: access_apikey\">\n+        <div class=\"control-group\" data-bind=\"visible: access_apikey() && apiKeyVisible()\">\n             <label class=\"control-label\">{{ _('QR Code') }}</label>\n             <div class=\"controls\">\n                 <div data-bind=\"qrcode: {text: access_apikey, size: 150}\"></div>"
            },
            {
                "sha": "05e4b340fa95fbedbde311b361c6a48f29a41f81",
                "filename": "src/octoprint/templates/snippets/settings/accesscontrol/users.jinja2",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/OctoPrint/OctoPrint/blob/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Ftemplates%2Fsnippets%2Fsettings%2Faccesscontrol%2Fusers.jinja2",
                "raw_url": "https://github.com/OctoPrint/OctoPrint/raw/9bc80d782d72881b16e20873dcd0b8314324c70c/src%2Foctoprint%2Ftemplates%2Fsnippets%2Fsettings%2Faccesscontrol%2Fusers.jinja2",
                "contents_url": "https://api.github.com/repos/OctoPrint/OctoPrint/contents/src%2Foctoprint%2Ftemplates%2Fsnippets%2Fsettings%2Faccesscontrol%2Fusers.jinja2?ref=9bc80d782d72881b16e20873dcd0b8314324c70c",
                "patch": "@@ -157,14 +157,16 @@\n                 <legend>API Key</legend>\n                 <div class=\"control-group\">\n                     <label class=\"control-label\">{{ _('Current API Key') }}</label>\n-                    <div class=\"controls\">\n+                    <div class=\"controls\" data-bind=\"visible: $root.access.users.apikeysVisible\">\n                         <div class=\"input-append input-block-level \">\n                             <input type=\"text\" readonly=\"readonly\" data-bind=\"value: $root.access.users.editor.apikey, valueUpdate: 'input', attr: {placeholder: '{{ _('N/A')|esq }}'}\">\n                             <a class=\"btn add-on\" title=\"Copy API Key to clipboard\" data-bind=\"click: $root.access.users.copyApikey, css: {'disabled': !$root.access.users.editor.apikey()}\"><i class=\"fas fa-copy\"></i></a>\n                             <a class=\"btn add-on\" title=\"Generate new API Key\" data-bind=\"click: function() { $root.access.users.confirmGenerateApikey(); }\"><i class=\"fas fa-sync\"></i></a>\n                             <a class=\"btn add-on btn-danger\" title=\"Delete API Key\" data-bind=\"click: function() { $root.access.users.confirmDeleteApikey(); }, css: {'disabled': !$root.access.users.editor.apikey()}\"><i class=\"far fa-trash-alt\"></i></a>\n                         </div>\n-\n+                    </div>\n+                    <div class=\"controls\" data-bind=\"visible: !$root.access.users.apikeysVisible()\">\n+                        <button class=\"btn\" data-bind=\"click: $root.access.users.revealApikeys, enabled: !$root.access.users.revealingApikeys(), css: {disabled: $root.access.users.revealingApikeys}\"><i class=\"fas fa-spinner fa-spin\" data-bind=\"visible: $root.access.users.revealingApikeys\"></i> {{ _('Reveal API Key') }}</button>\n                     </div>\n                 </div>\n             </fieldset>"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/commits/7ede053a5fca50cc2802884c661a241d51703a67",
        "url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/commits/7ede053a5fca50cc2802884c661a241d51703a67",
        "html_url": "https://github.com/hapifhir/org.hl7.fhir.core/commit/7ede053a5fca50cc2802884c661a241d51703a67",
        "message": "Move new documentbuilderfactory calls to XMLUtils",
        "files": [
            {
                "sha": "c396c0b7117ecaa325a558e167b5c586374f2b0a",
                "filename": "org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/misc/CDAUtilities.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FCDAUtilities.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FCDAUtilities.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FCDAUtilities.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -51,7 +51,7 @@ public class CDAUtilities {\n   private final Document doc;\n \n   public CDAUtilities(InputStream stream) throws Exception {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(true);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n "
            },
            {
                "sha": "e4d04ada77e3dc08ae42da925fe961ab8115657f",
                "filename": "org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/misc/CKMImporter.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FCKMImporter.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FCKMImporter.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FCKMImporter.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -130,7 +130,7 @@ private Document loadXml(String address) throws Exception {\n     res.checkThrowException();\n     InputStream xml = new ByteArrayInputStream(res.getContent());\n \n-    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory dbf = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     DocumentBuilder db = dbf.newDocumentBuilder();\n     return db.parse(xml);\n   }"
            },
            {
                "sha": "8b4269f531a8444cef6f76dcfa26c44e9b90ac60",
                "filename": "org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/misc/CountryCodesConverter.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FCountryCodesConverter.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FCountryCodesConverter.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FCountryCodesConverter.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -357,7 +357,7 @@ private String lang3To2(String lang) {\n   }\n \n   private Document load() throws ParserConfigurationException, SAXException, IOException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(true);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n "
            },
            {
                "sha": "225a241a84d834d797d3d1e41add985f9e5d8eb3",
                "filename": "org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/misc/DicomPackageBuilder.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FDicomPackageBuilder.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FDicomPackageBuilder.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FDicomPackageBuilder.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -131,7 +131,7 @@ private JsonObject buildPackage() {\n   }\r\n \r\n   private CodeSystem buildCodeSystem() throws ParserConfigurationException, FileNotFoundException, SAXException, IOException {\r\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\r\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\r\n     factory.setNamespaceAware(true);\r\n     DocumentBuilder builder = factory.newDocumentBuilder();\r\n     Document doc = builder.parse(ManagedFileAccess.inStream(Utilities.path(source, \"Resources\", \"Ontology\", \"DCM\", \"dcm.owl\")));\r"
            },
            {
                "sha": "62610a17e3dc5d53fdbaabfa0b13308fe0fb8901",
                "filename": "org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/misc/ICPC2Importer.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FICPC2Importer.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FICPC2Importer.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FICPC2Importer.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -120,7 +120,7 @@ public void setTargetFileNameVS(String targetFileName) {\n   }\n \n   public void go() throws Exception {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(false);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     Document doc = builder.parse(ManagedFileAccess.inStream(sourceFileName));"
            },
            {
                "sha": "0e14aa7be0c660799ddcc62e89ec6194d75adbf9",
                "filename": "org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/misc/LoincToDEConvertor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FLoincToDEConvertor.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FLoincToDEConvertor.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2FLoincToDEConvertor.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -148,7 +148,7 @@ private void log(String string) {\n \n \t}\n \tprivate void loadLoinc() throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\tDocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n \t\tfactory.setNamespaceAware(true);\n \t\tDocumentBuilder builder = factory.newDocumentBuilder();\n "
            },
            {
                "sha": "81febadee7814c315d1e62e1e6540aaf8ea4aada",
                "filename": "org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/misc/adl/ADLImporter.java",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2Fadl%2FADLImporter.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2Fadl%2FADLImporter.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2Fadl%2FADLImporter.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -1,7 +1,5 @@\n package org.hl7.fhir.convertors.misc.adl;\n \n-import java.io.FileInputStream;\n-import java.io.FileOutputStream;\n import java.util.ArrayList;\n import java.util.HashMap;\n import java.util.List;\n@@ -89,7 +87,7 @@ private static String getParam(String[] args, String name) {\n \n   private void execute() throws Exception {\n     // load config\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(true);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     adlConfig = builder.parse(ManagedFileAccess.inStream(config)).getDocumentElement();"
            },
            {
                "sha": "0cda147931e022f0987f1a4c860767899f1ccf8a",
                "filename": "org.hl7.fhir.convertors/src/main/java/org/hl7/fhir/convertors/misc/iso21090/ISO21090Importer.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2Fiso21090%2FISO21090Importer.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2Fiso21090%2FISO21090Importer.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.convertors%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconvertors%2Fmisc%2Fiso21090%2FISO21090Importer.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -317,7 +317,7 @@ private String getDoco(Element en) {\n   }\n \n   private void load() throws ParserConfigurationException, SAXException, IOException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(false);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     Document doc = builder.parse(ManagedFileAccess.inStream(\"C:\\\\work\\\\projects\\\\org.hl7.v3.dt\\\\iso\\\\iso-21090-datatypes.xsd\"));"
            },
            {
                "sha": "5090afb9d81b093f3fd79ff0d276b67c11ccf80c",
                "filename": "org.hl7.fhir.dstu2/src/main/java/org/hl7/fhir/dstu2/terminologies/LoincToDEConvertor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Fterminologies%2FLoincToDEConvertor.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Fterminologies%2FLoincToDEConvertor.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Fterminologies%2FLoincToDEConvertor.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -162,7 +162,7 @@ private void log(String string) {\n   }\n \n   private void loadLoinc() throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(true);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n "
            },
            {
                "sha": "94c7c2f75a6abad9c7ed34af14e1fcdc934f02a2",
                "filename": "org.hl7.fhir.dstu2/src/main/java/org/hl7/fhir/dstu2/utils/DigitalSignatures.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Futils%2FDigitalSignatures.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Futils%2FDigitalSignatures.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Futils%2FDigitalSignatures.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -60,6 +60,7 @@ WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWIS\n import javax.xml.parsers.ParserConfigurationException;\n \n import org.hl7.fhir.exceptions.FHIRException;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.hl7.fhir.utilities.xml.XmlGenerator;\n import org.w3c.dom.Document;\n import org.xml.sax.SAXException;\n@@ -73,7 +74,7 @@ public static void main(String[] args)\n     //\n     byte[] inputXml = \"<Envelope xmlns=\\\"urn:envelope\\\">\\r\\n</Envelope>\\r\\n\".getBytes();\n     // load the document that's going to be signed\n-    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory dbf = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     dbf.setNamespaceAware(true);\n     DocumentBuilder builder = dbf.newDocumentBuilder();\n     Document doc = builder.parse(new ByteArrayInputStream(inputXml));"
            },
            {
                "sha": "ef474ddb2a24af49a9418d268165e577e5ce5e23",
                "filename": "org.hl7.fhir.dstu2/src/main/java/org/hl7/fhir/dstu2/utils/Translations.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Futils%2FTranslations.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Futils%2FTranslations.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Futils%2FTranslations.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -70,7 +70,7 @@ public void setLang(String lang) {\n    */\n   public void load(String filename)\n       throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     loadMessages(builder.parse(new CSFileInputStream(filename)));\n   }"
            },
            {
                "sha": "ef200a2428228008ac697ac06b52f0cdd09d94ad",
                "filename": "org.hl7.fhir.dstu2/src/test/java/org/hl7/fhir/dstu2/test/TestingUtilities.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Ftest%2FTestingUtilities.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Ftest%2FTestingUtilities.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2%2Ftest%2FTestingUtilities.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -17,6 +17,7 @@\n import org.hl7.fhir.utilities.Utilities;\r\n import org.hl7.fhir.utilities.filesystem.CSFile;\r\n import org.hl7.fhir.utilities.filesystem.ManagedFileAccess;\r\n+import org.hl7.fhir.utilities.xml.XMLUtil;\r\n import org.w3c.dom.Document;\r\n import org.w3c.dom.Element;\r\n import org.w3c.dom.NamedNodeMap;\r\n@@ -145,7 +146,7 @@ private static Node skipBlankText(Node node) {\n   }\r\n \r\n   private static Document loadXml(String fn) throws Exception {\r\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\r\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\r\n     factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\r\n     factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\r\n     factory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\r"
            },
            {
                "sha": "e4b37202df681eb78118080225cee89eb379db96",
                "filename": "org.hl7.fhir.dstu2016may/src/main/java/org/hl7/fhir/dstu2016may/metamodel/XmlParser.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Fmetamodel%2FXmlParser.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Fmetamodel%2FXmlParser.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Fmetamodel%2FXmlParser.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -78,7 +78,7 @@ public XmlParser(IWorkerContext context) {\n   public Element parse(InputStream stream) throws Exception {\n     Document doc = null;\n     try {\n-      DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+      DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n       // xxe protection\n       factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n       factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);"
            },
            {
                "sha": "7ad2f1b49b19fa2f51dbaf90b15848c7d7d7c03e",
                "filename": "org.hl7.fhir.dstu2016may/src/main/java/org/hl7/fhir/dstu2016may/terminologies/ICPC2Importer.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Fterminologies%2FICPC2Importer.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Fterminologies%2FICPC2Importer.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Fterminologies%2FICPC2Importer.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -116,7 +116,7 @@ public void setTargetFileNameVS(String targetFileName) {\n   }\n \n   public void go() throws Exception {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(false);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     Document doc = builder.parse(ManagedFileAccess.inStream(sourceFileName));"
            },
            {
                "sha": "5a1e036239b59110bbcdb8cabf6d311ffdc7cef8",
                "filename": "org.hl7.fhir.dstu2016may/src/main/java/org/hl7/fhir/dstu2016may/terminologies/LoincToDEConvertor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Fterminologies%2FLoincToDEConvertor.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Fterminologies%2FLoincToDEConvertor.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Fterminologies%2FLoincToDEConvertor.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -162,7 +162,7 @@ private void log(String string) {\n   }\n \n   private void loadLoinc() throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(true);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n "
            },
            {
                "sha": "9d4aa18aa07324d80faeb9d58b327cf63e91215d",
                "filename": "org.hl7.fhir.dstu2016may/src/main/java/org/hl7/fhir/dstu2016may/utils/DigitalSignatures.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Futils%2FDigitalSignatures.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Futils%2FDigitalSignatures.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Futils%2FDigitalSignatures.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -60,6 +60,7 @@ WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWIS\n import javax.xml.parsers.ParserConfigurationException;\n \n import org.hl7.fhir.exceptions.FHIRException;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.hl7.fhir.utilities.xml.XmlGenerator;\n import org.w3c.dom.Document;\n import org.xml.sax.SAXException;\n@@ -73,7 +74,7 @@ public static void main(String[] args) throws SAXException, IOException, ParserC\n     //\n     byte[] inputXml = \"<Envelope xmlns=\\\"urn:envelope\\\">\\r\\n</Envelope>\\r\\n\".getBytes();\n     // load the document that's going to be signed\n-    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory dbf = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     dbf.setNamespaceAware(true);\n     DocumentBuilder builder = dbf.newDocumentBuilder();\n     Document doc = builder.parse(new ByteArrayInputStream(inputXml));"
            },
            {
                "sha": "6c24118d3f77736253516efec211b8d3957a1e93",
                "filename": "org.hl7.fhir.dstu2016may/src/main/java/org/hl7/fhir/dstu2016may/utils/Translations.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Futils%2FTranslations.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Futils%2FTranslations.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2016may%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Futils%2FTranslations.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -70,7 +70,7 @@ public void setLang(String lang) {\n    */\n   public void load(String filename)\n       throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     loadMessages(builder.parse(new CSFileInputStream(filename)));\n   }"
            },
            {
                "sha": "25680199432a8e21a0e9bff855072bb4d5eb82d7",
                "filename": "org.hl7.fhir.dstu2016may/src/test/java/org/hl7/fhir/dstu2016may/test/TestingUtilities.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Ftest%2FTestingUtilities.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu2016may%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Ftest%2FTestingUtilities.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu2016may%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu2016may%2Ftest%2FTestingUtilities.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -17,6 +17,7 @@\n import org.hl7.fhir.utilities.Utilities;\r\n import org.hl7.fhir.utilities.filesystem.CSFile;\r\n import org.hl7.fhir.utilities.filesystem.ManagedFileAccess;\r\n+import org.hl7.fhir.utilities.xml.XMLUtil;\r\n import org.w3c.dom.Document;\r\n import org.w3c.dom.Element;\r\n import org.w3c.dom.NamedNodeMap;\r\n@@ -145,7 +146,7 @@ private static Node skipBlankText(Node node) {\n   }\r\n \r\n   private static Document loadXml(String fn) throws Exception {\r\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\r\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\r\n     factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\r\n     factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\r\n     factory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\r"
            },
            {
                "sha": "8203d92e389ba76f4d6add9cbce31bbc8d66cc42",
                "filename": "org.hl7.fhir.dstu3/src/main/java/org/hl7/fhir/dstu3/elementmodel/XmlParser.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Felementmodel%2FXmlParser.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Felementmodel%2FXmlParser.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Felementmodel%2FXmlParser.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -97,7 +97,7 @@ public void setAllowXsiLocation(boolean allowXsiLocation) {\n   public Element parse(InputStream stream) throws FHIRFormatError, DefinitionException, FHIRException, IOException {\n \t\tDocument doc = null;\n   \ttry {\n-  \t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+  \t\tDocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n   \t\t// xxe protection\n   \t\tfactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n   \t\tfactory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);"
            },
            {
                "sha": "24528c24f4c3888eb28f1d1bd0db31158fde0bd1",
                "filename": "org.hl7.fhir.dstu3/src/main/java/org/hl7/fhir/dstu3/terminologies/LoincToDEConvertor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Fterminologies%2FLoincToDEConvertor.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Fterminologies%2FLoincToDEConvertor.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Fterminologies%2FLoincToDEConvertor.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -154,7 +154,7 @@ private void log(String string) {\n \n \t}\n \tprivate void loadLoinc() throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-\t\tDocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+\t\tDocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n \t\tfactory.setNamespaceAware(true);\n \t\tDocumentBuilder builder = factory.newDocumentBuilder();\n "
            },
            {
                "sha": "b7f33b00ad7df65ffef64add55a3ae233eff4114",
                "filename": "org.hl7.fhir.dstu3/src/main/java/org/hl7/fhir/dstu3/utils/DigitalSignatures.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Futils%2FDigitalSignatures.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Futils%2FDigitalSignatures.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Futils%2FDigitalSignatures.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -62,6 +62,7 @@ WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWIS\n import javax.xml.parsers.ParserConfigurationException;\n \n import org.hl7.fhir.exceptions.FHIRException;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.hl7.fhir.utilities.xml.XmlGenerator;\n import org.w3c.dom.Document;\n import org.xml.sax.SAXException;\n@@ -74,7 +75,7 @@ public static void main(String[] args) throws SAXException, IOException, ParserC\n     //\n     byte[] inputXml = \"<Envelope xmlns=\\\"urn:envelope\\\">\\r\\n</Envelope>\\r\\n\".getBytes();\n     // load the document that's going to be signed\n-    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance(); \n+    DocumentBuilderFactory dbf = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     dbf.setNamespaceAware(true);\n     DocumentBuilder builder = dbf.newDocumentBuilder();  \n     Document doc = builder.parse(new ByteArrayInputStream(inputXml)); "
            },
            {
                "sha": "46489fdfa154b9480165a4ff0d8306a0b3dbf075",
                "filename": "org.hl7.fhir.dstu3/src/main/java/org/hl7/fhir/dstu3/utils/Translations.java",
                "status": "modified",
                "additions": 29,
                "deletions": 29,
                "changes": 58,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Futils%2FTranslations.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Futils%2FTranslations.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu3%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Futils%2FTranslations.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -1,33 +1,33 @@\n package org.hl7.fhir.dstu3.utils;\n \n-/*\r\n-  Copyright (c) 2011+, HL7, Inc.\r\n-  All rights reserved.\r\n-  \r\n-  Redistribution and use in source and binary forms, with or without modification, \r\n-  are permitted provided that the following conditions are met:\r\n-    \r\n-   * Redistributions of source code must retain the above copyright notice, this \r\n-     list of conditions and the following disclaimer.\r\n-   * Redistributions in binary form must reproduce the above copyright notice, \r\n-     this list of conditions and the following disclaimer in the documentation \r\n-     and/or other materials provided with the distribution.\r\n-   * Neither the name of HL7 nor the names of its contributors may be used to \r\n-     endorse or promote products derived from this software without specific \r\n-     prior written permission.\r\n-  \r\n-  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND \r\n-  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED \r\n-  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. \r\n-  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, \r\n-  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n-  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR \r\n-  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, \r\n-  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) \r\n-  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE \r\n-  POSSIBILITY OF SUCH DAMAGE.\r\n-  \r\n- */\r\n+/*\n+  Copyright (c) 2011+, HL7, Inc.\n+  All rights reserved.\n+  \n+  Redistribution and use in source and binary forms, with or without modification, \n+  are permitted provided that the following conditions are met:\n+    \n+   * Redistributions of source code must retain the above copyright notice, this \n+     list of conditions and the following disclaimer.\n+   * Redistributions in binary form must reproduce the above copyright notice, \n+     this list of conditions and the following disclaimer in the documentation \n+     and/or other materials provided with the distribution.\n+   * Neither the name of HL7 nor the names of its contributors may be used to \n+     endorse or promote products derived from this software without specific \n+     prior written permission.\n+  \n+  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND \n+  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED \n+  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. \n+  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, \n+  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n+  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR \n+  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, \n+  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) \n+  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE \n+  POSSIBILITY OF SUCH DAMAGE.\n+  \n+ */\n \n \n \n@@ -71,7 +71,7 @@ public void setLang(String lang) {\n    * @throws Exception\n    */\n   public void load(String filename) throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     loadMessages(builder.parse(new CSFileInputStream(filename)));\n   }"
            },
            {
                "sha": "ebbb18fa73ee45de558c798ded12f84b2139e9a9",
                "filename": "org.hl7.fhir.dstu3/src/test/java/org/hl7/fhir/dstu3/test/support/TestingUtilities.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Ftest%2Fsupport%2FTestingUtilities.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.dstu3%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Ftest%2Fsupport%2FTestingUtilities.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.dstu3%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fdstu3%2Ftest%2Fsupport%2FTestingUtilities.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -20,6 +20,7 @@\n import org.hl7.fhir.utilities.filesystem.CSFile;\r\n import org.hl7.fhir.utilities.filesystem.ManagedFileAccess;\r\n import org.hl7.fhir.utilities.tests.BaseTestingUtilities;\r\n+import org.hl7.fhir.utilities.xml.XMLUtil;\r\n import org.w3c.dom.Document;\r\n import org.w3c.dom.Element;\r\n import org.w3c.dom.NamedNodeMap;\r\n@@ -176,7 +177,7 @@ private static Document loadXml(String fn) throws Exception {\n   }\r\n \r\n   private static Document loadXml(InputStream fn) throws Exception {\r\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\r\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\r\n       factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\r\n       factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\r\n       factory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\r"
            },
            {
                "sha": "d5c18197c523fbd8b083decf573b8049b8687d57",
                "filename": "org.hl7.fhir.r4/src/main/java/org/hl7/fhir/r4/elementmodel/XmlParser.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Felementmodel%2FXmlParser.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Felementmodel%2FXmlParser.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Felementmodel%2FXmlParser.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -96,7 +96,7 @@ public void setAllowXsiLocation(boolean allowXsiLocation) {\n   public Element parse(InputStream stream) throws FHIRFormatError, DefinitionException, FHIRException, IOException {\n     Document doc = null;\n     try {\n-      DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+      DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n       // xxe protection\n       factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n       factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);"
            },
            {
                "sha": "94ee1ce89c858c4d5bca3d26ca37b8c9333245bf",
                "filename": "org.hl7.fhir.r4/src/main/java/org/hl7/fhir/r4/terminologies/LoincToDEConvertor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Fterminologies%2FLoincToDEConvertor.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Fterminologies%2FLoincToDEConvertor.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Fterminologies%2FLoincToDEConvertor.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -156,7 +156,7 @@ private void log(String string) {\n   }\n \n   private void loadLoinc() throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(true);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n "
            },
            {
                "sha": "bb016333358434a282f6b2087989d3cea6cbd822",
                "filename": "org.hl7.fhir.r4/src/main/java/org/hl7/fhir/r4/test/utils/TestingUtilities.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Ftest%2Futils%2FTestingUtilities.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Ftest%2Futils%2FTestingUtilities.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Ftest%2Futils%2FTestingUtilities.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -59,6 +59,7 @@ WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWIS\n import org.hl7.fhir.utilities.tests.BaseTestingUtilities;\n import org.hl7.fhir.utilities.tests.ResourceLoaderTests;\n import org.hl7.fhir.utilities.tests.TestConfig;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.w3c.dom.Document;\n import org.w3c.dom.Element;\n import org.w3c.dom.NamedNodeMap;\n@@ -256,7 +257,7 @@ private static Document loadXml(String fn) throws Exception {\n   }\n \n   private static Document loadXml(InputStream fn) throws Exception {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n     factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n     factory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);"
            },
            {
                "sha": "31427122bea8bdc3f407cc5b9c3466e696bc39c5",
                "filename": "org.hl7.fhir.r4/src/main/java/org/hl7/fhir/r4/utils/DigitalSignatures.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Futils%2FDigitalSignatures.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Futils%2FDigitalSignatures.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Futils%2FDigitalSignatures.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -60,6 +60,7 @@ WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWIS\n \n import org.hl7.fhir.utilities.Utilities;\n import org.hl7.fhir.utilities.filesystem.ManagedFileAccess;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.hl7.fhir.utilities.xml.XmlGenerator;\n import org.w3c.dom.Document;\n \n@@ -88,7 +89,7 @@ public static void main(String[] args) throws Exception {\n     //\n     byte[] inputXml = \"<Envelope xmlns=\\\"urn:envelope\\\">\\r\\n</Envelope>\\r\\n\".getBytes();\n     // load the document that's going to be signed\n-    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory dbf = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     dbf.setNamespaceAware(true);\n     DocumentBuilder builder = dbf.newDocumentBuilder();\n     Document doc = builder.parse(new ByteArrayInputStream(inputXml));"
            },
            {
                "sha": "2498f9f687ef0dee178d9393ddbb3627ae186413",
                "filename": "org.hl7.fhir.r4/src/main/java/org/hl7/fhir/r4/utils/Translations.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Futils%2FTranslations.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Futils%2FTranslations.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4%2Futils%2FTranslations.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -70,7 +70,7 @@ public void setLang(String lang) {\n    */\n   public void load(String filename)\n       throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     loadMessages(builder.parse(new CSFileInputStream(filename)));\n   }"
            },
            {
                "sha": "4b8e948eaee1086c87cf29639a5c78c2f772be79",
                "filename": "org.hl7.fhir.r4b/src/main/java/org/hl7/fhir/r4b/elementmodel/XmlParser.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Felementmodel%2FXmlParser.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Felementmodel%2FXmlParser.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Felementmodel%2FXmlParser.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -111,7 +111,7 @@ public List<NamedElement> parse(InputStream stream)\n     List<NamedElement> res = new ArrayList<>();\n     Document doc = null;\n     try {\n-      DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+      DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n       // xxe protection\n       factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n       factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);"
            },
            {
                "sha": "a38b2d16a68db7cd96c9306e9d3c72a137f032f9",
                "filename": "org.hl7.fhir.r4b/src/main/java/org/hl7/fhir/r4b/terminologies/LoincToDEConvertor.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Fterminologies%2FLoincToDEConvertor.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Fterminologies%2FLoincToDEConvertor.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Fterminologies%2FLoincToDEConvertor.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -156,7 +156,7 @@ private void log(String string) {\n   }\n \n   private void loadLoinc() throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(true);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n "
            },
            {
                "sha": "eb5e6906c8ea2751fc7b20265364e19562736c1a",
                "filename": "org.hl7.fhir.r4b/src/main/java/org/hl7/fhir/r4b/test/utils/TestingUtilities.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Ftest%2Futils%2FTestingUtilities.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Ftest%2Futils%2FTestingUtilities.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Ftest%2Futils%2FTestingUtilities.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -23,6 +23,7 @@\n import org.hl7.fhir.utilities.npm.FilesystemPackageCacheManager;\n \n import org.hl7.fhir.utilities.tests.BaseTestingUtilities;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.w3c.dom.Document;\n import org.w3c.dom.Element;\n import org.w3c.dom.NamedNodeMap;\n@@ -269,7 +270,7 @@ private static Document loadXml(String fn) throws Exception {\n   }\n \n   private static Document loadXml(InputStream fn) throws Exception {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n     factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n     factory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);"
            },
            {
                "sha": "74087d945529db4b945dd4690ac25e59099738b5",
                "filename": "org.hl7.fhir.r4b/src/main/java/org/hl7/fhir/r4b/utils/DigitalSignatures.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Futils%2FDigitalSignatures.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Futils%2FDigitalSignatures.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Futils%2FDigitalSignatures.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -60,6 +60,7 @@ WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWIS\n \n import org.hl7.fhir.utilities.Utilities;\n import org.hl7.fhir.utilities.filesystem.ManagedFileAccess;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.hl7.fhir.utilities.xml.XmlGenerator;\n import org.w3c.dom.Document;\n \n@@ -88,7 +89,7 @@ public static void main(String[] args) throws Exception {\n     //\n     byte[] inputXml = \"<Envelope xmlns=\\\"urn:envelope\\\">\\r\\n</Envelope>\\r\\n\".getBytes();\n     // load the document that's going to be signed\n-    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory dbf = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     dbf.setNamespaceAware(true);\n     DocumentBuilder builder = dbf.newDocumentBuilder();\n     Document doc = builder.parse(new ByteArrayInputStream(inputXml));"
            },
            {
                "sha": "cd20814d6104545780b67240156fe2df5af4f7c0",
                "filename": "org.hl7.fhir.r4b/src/main/java/org/hl7/fhir/r4b/utils/Translations.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Futils%2FTranslations.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Futils%2FTranslations.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r4b%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr4b%2Futils%2FTranslations.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -70,7 +70,7 @@ public void setLang(String lang) {\n    */\n   public void load(String filename)\n       throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     loadMessages(builder.parse(new CSFileInputStream(filename)));\n   }"
            },
            {
                "sha": "ac169512068a1bc287832bcf63e13f35583b30c7",
                "filename": "org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/elementmodel/XmlParser.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Felementmodel%2FXmlParser.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Felementmodel%2FXmlParser.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Felementmodel%2FXmlParser.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -126,7 +126,7 @@ public List<ValidatedFragment> parse(InputStream inStream) throws FHIRFormatErro\n     ByteArrayInputStream stream = new ByteArrayInputStream(content);\n     Document doc = null;\n     try {\n-      DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+      DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n       // xxe protection\n       factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n       factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);"
            },
            {
                "sha": "b4f24a0e4d3dcab9dfc6883cff2fa40b8173d9de",
                "filename": "org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/test/utils/CompareUtilities.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Ftest%2Futils%2FCompareUtilities.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Ftest%2Futils%2FCompareUtilities.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Ftest%2Futils%2FCompareUtilities.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -15,6 +15,7 @@\n import org.hl7.fhir.utilities.json.model.JsonProperty;\n import org.hl7.fhir.utilities.json.parser.JsonParser;\n import org.hl7.fhir.utilities.settings.FhirSettings;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.w3c.dom.Document;\n import org.w3c.dom.Element;\n import org.w3c.dom.NamedNodeMap;\n@@ -204,7 +205,7 @@ private Document loadXml(String fn) throws Exception {\n   }\n \n   private Document loadXml(InputStream fn) throws Exception {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n     factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n     factory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);"
            },
            {
                "sha": "6d8c6589224f4a34b7d9ea0445630b6d27f56105",
                "filename": "org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils/DigitalSignatures.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Futils%2FDigitalSignatures.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Futils%2FDigitalSignatures.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Futils%2FDigitalSignatures.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -62,6 +62,7 @@ WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWIS\n \n import org.hl7.fhir.utilities.Utilities;\n import org.hl7.fhir.utilities.filesystem.ManagedFileAccess;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.hl7.fhir.utilities.xml.XmlGenerator;\n import org.w3c.dom.Document;\n \n@@ -91,7 +92,7 @@ public static void main(String[] args) throws Exception {\n     //\n     byte[] inputXml = \"<Envelope xmlns=\\\"urn:envelope\\\">\\r\\n</Envelope>\\r\\n\".getBytes();\n     // load the document that's going to be signed\n-    DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance(); \n+    DocumentBuilderFactory dbf = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     dbf.setNamespaceAware(true);\n     DocumentBuilder builder = dbf.newDocumentBuilder();  \n     Document doc = builder.parse(new ByteArrayInputStream(inputXml)); "
            },
            {
                "sha": "fdac4e3474ca184b3b4144b330c409b6fed93020",
                "filename": "org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils/Translations.java",
                "status": "modified",
                "additions": 29,
                "deletions": 29,
                "changes": 58,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Futils%2FTranslations.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Futils%2FTranslations.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.r5%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fr5%2Futils%2FTranslations.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -1,33 +1,33 @@\n package org.hl7.fhir.r5.utils;\n \n-/*\r\n-  Copyright (c) 2011+, HL7, Inc.\r\n-  All rights reserved.\r\n-  \r\n-  Redistribution and use in source and binary forms, with or without modification, \r\n-  are permitted provided that the following conditions are met:\r\n-    \r\n-   * Redistributions of source code must retain the above copyright notice, this \r\n-     list of conditions and the following disclaimer.\r\n-   * Redistributions in binary form must reproduce the above copyright notice, \r\n-     this list of conditions and the following disclaimer in the documentation \r\n-     and/or other materials provided with the distribution.\r\n-   * Neither the name of HL7 nor the names of its contributors may be used to \r\n-     endorse or promote products derived from this software without specific \r\n-     prior written permission.\r\n-  \r\n-  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND \r\n-  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED \r\n-  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. \r\n-  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, \r\n-  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n-  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR \r\n-  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, \r\n-  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) \r\n-  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE \r\n-  POSSIBILITY OF SUCH DAMAGE.\r\n-  \r\n- */\r\n+/*\n+  Copyright (c) 2011+, HL7, Inc.\n+  All rights reserved.\n+  \n+  Redistribution and use in source and binary forms, with or without modification, \n+  are permitted provided that the following conditions are met:\n+    \n+   * Redistributions of source code must retain the above copyright notice, this \n+     list of conditions and the following disclaimer.\n+   * Redistributions in binary form must reproduce the above copyright notice, \n+     this list of conditions and the following disclaimer in the documentation \n+     and/or other materials provided with the distribution.\n+   * Neither the name of HL7 nor the names of its contributors may be used to \n+     endorse or promote products derived from this software without specific \n+     prior written permission.\n+  \n+  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND \n+  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED \n+  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. \n+  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, \n+  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n+  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR \n+  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, \n+  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) \n+  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE \n+  POSSIBILITY OF SUCH DAMAGE.\n+  \n+ */\n \n \n \n@@ -71,7 +71,7 @@ public void setLang(String lang) {\n    * @throws Exception\n    */\n   public void load(String filename) throws FileNotFoundException, SAXException, IOException, ParserConfigurationException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     loadMessages(builder.parse(new CSFileInputStream(filename)));\n   }"
            },
            {
                "sha": "c7b957fabf0809f20ff1a26bceb65a28fbaecd8b",
                "filename": "org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/TranslatorXml.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2FTranslatorXml.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2FTranslatorXml.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2FTranslatorXml.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -69,7 +69,7 @@ public TranslatorXml(String filename) throws ParserConfigurationException, SAXEx\n \n \n   private void load(String filename) throws ParserConfigurationException, SAXException, IOException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(false);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     Document xml = builder.parse(ManagedFileAccess.file(filename)); "
            },
            {
                "sha": "958d6ea4af78c45eb42786745510a9bb71804b8d",
                "filename": "org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/xls/XLSXmlNormaliser.java",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2Fxls%2FXLSXmlNormaliser.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2Fxls%2FXLSXmlNormaliser.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2Fxls%2FXLSXmlNormaliser.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -221,7 +221,7 @@ private void check(boolean test, String message) throws FHIRException  {\n   \n \n   private Document parseXml(InputStream in) throws FHIRException, ParserConfigurationException, SAXException, IOException  {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(true);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     return builder.parse(in);"
            },
            {
                "sha": "a6b6b05d727bec06ae427e9e2d05a4003e614068",
                "filename": "org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/xls/XLSXmlParser.java",
                "status": "modified",
                "additions": 29,
                "deletions": 29,
                "changes": 58,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2Fxls%2FXLSXmlParser.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2Fxls%2FXLSXmlParser.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2Fxls%2FXLSXmlParser.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -1,33 +1,33 @@\n package org.hl7.fhir.utilities.xls;\n \n-/*\r\n-  Copyright (c) 2011+, HL7, Inc.\r\n-  All rights reserved.\r\n-  \r\n-  Redistribution and use in source and binary forms, with or without modification, \r\n-  are permitted provided that the following conditions are met:\r\n-    \r\n-   * Redistributions of source code must retain the above copyright notice, this \r\n-     list of conditions and the following disclaimer.\r\n-   * Redistributions in binary form must reproduce the above copyright notice, \r\n-     this list of conditions and the following disclaimer in the documentation \r\n-     and/or other materials provided with the distribution.\r\n-   * Neither the name of HL7 nor the names of its contributors may be used to \r\n-     endorse or promote products derived from this software without specific \r\n-     prior written permission.\r\n-  \r\n-  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND \r\n-  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED \r\n-  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. \r\n-  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, \r\n-  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n-  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR \r\n-  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, \r\n-  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) \r\n-  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE \r\n-  POSSIBILITY OF SUCH DAMAGE.\r\n-  \r\n- */\r\n+/*\n+  Copyright (c) 2011+, HL7, Inc.\n+  All rights reserved.\n+  \n+  Redistribution and use in source and binary forms, with or without modification, \n+  are permitted provided that the following conditions are met:\n+    \n+   * Redistributions of source code must retain the above copyright notice, this \n+     list of conditions and the following disclaimer.\n+   * Redistributions in binary form must reproduce the above copyright notice, \n+     this list of conditions and the following disclaimer in the documentation \n+     and/or other materials provided with the distribution.\n+   * Neither the name of HL7 nor the names of its contributors may be used to \n+     endorse or promote products derived from this software without specific \n+     prior written permission.\n+  \n+  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND \n+  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED \n+  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. \n+  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, \n+  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n+  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR \n+  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, \n+  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) \n+  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE \n+  POSSIBILITY OF SUCH DAMAGE.\n+  \n+ */\n \n \n \n@@ -166,7 +166,7 @@ public XLSXmlParser(InputStream in, String name) throws FHIRException  {\n \n   private Document parseXml(InputStream in) throws FHIRException  {\n     try {\n-      DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+      DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n       factory.setNamespaceAware(true);\n       DocumentBuilder builder = factory.newDocumentBuilder();\n       return builder.parse(in);"
            },
            {
                "sha": "fed2a40e089a074af7256d85e130faaf2c5383a7",
                "filename": "org.hl7.fhir.utilities/src/main/java/org/hl7/fhir/utilities/xml/XMLUtil.java",
                "status": "modified",
                "additions": 13,
                "deletions": 7,
                "changes": 20,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2Fxml%2FXMLUtil.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2Fxml%2FXMLUtil.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.utilities%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Futilities%2Fxml%2FXMLUtil.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -32,7 +32,6 @@ WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWIS\n \n \n import java.io.ByteArrayInputStream;\n-import java.io.File;\n import java.io.FileInputStream;\n import java.io.IOException;\n import java.io.InputStream;\n@@ -437,28 +436,28 @@ public static boolean hasNamedChild(Element e, String name) {\n   }\n \n   public static Document parseToDom(String content) throws ParserConfigurationException, SAXException, IOException  {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(false);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     return builder.parse(new ByteArrayInputStream(content.getBytes()));\n   }\n \n   public static Document parseToDom(byte[] content) throws ParserConfigurationException, SAXException, IOException  {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(false);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     return builder.parse(new ByteArrayInputStream(content));\n   }\n \n   public static Document parseToDom(byte[] content, boolean ns) throws ParserConfigurationException, SAXException, IOException  {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(ns);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     return builder.parse(new ByteArrayInputStream(content));\n   }\n \n   public static Document parseFileToDom(String filename) throws ParserConfigurationException, SAXException, IOException  {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(false);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     FileInputStream fs = ManagedFileAccess.inStream(filename);\n@@ -470,7 +469,7 @@ public static Document parseFileToDom(String filename) throws ParserConfiguratio\n   }\n \n   public static Document parseFileToDom(String filename, boolean ns) throws ParserConfigurationException, SAXException, IOException  {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     factory.setNamespaceAware(ns);\n     DocumentBuilder builder = factory.newDocumentBuilder();\n     FileInputStream fs = ManagedFileAccess.inStream(filename);\n@@ -503,12 +502,19 @@ public static String getNamedChildAttribute(Element element, String name, String\n   }\n \n   public static TransformerFactory newXXEProtectedTransformerFactory() {\n-    TransformerFactory transformerFactory = TransformerFactory.newInstance();\n+    final TransformerFactory transformerFactory = TransformerFactory.newInstance();\n     transformerFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, \"\");\n     transformerFactory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, \"\");\n     return transformerFactory;\n   }\n \n+  public static DocumentBuilderFactory newXXEProtectedDocumentBuilderFactory() throws ParserConfigurationException {\n+    final DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();\n+    documentBuilderFactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n+    documentBuilderFactory.setXIncludeAware(false);\n+    return documentBuilderFactory;\n+  }\n+\n \n   public static void writeDomToFile(Document doc, String filename) throws TransformerException, IOException {\n     TransformerFactory transformerFactory = XMLUtil.newXXEProtectedTransformerFactory();"
            },
            {
                "sha": "d1101fa1e80bd518a01b23b4eb40f9aad8e65069",
                "filename": "org.hl7.fhir.validation/src/main/java/org/hl7/fhir/validation/ValidatorUtils.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.validation%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fvalidation%2FValidatorUtils.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.validation%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fvalidation%2FValidatorUtils.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.validation%2Fsrc%2Fmain%2Fjava%2Forg%2Fhl7%2Ffhir%2Fvalidation%2FValidatorUtils.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -37,6 +37,7 @@\n import org.hl7.fhir.utilities.filesystem.ManagedFileAccess;\n import org.hl7.fhir.utilities.i18n.I18nConstants;\n import org.hl7.fhir.utilities.validation.ValidationMessage;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.hl7.fhir.validation.cli.utils.AsteriskFilter;\n import org.hl7.fhir.validation.cli.utils.Common;\n import org.w3c.dom.Document;\n@@ -115,7 +116,7 @@ public static BaseLoaderR5 loaderForVersion(String version, ILoaderKnowledgeProv\n   }\n \n   protected static Document parseXml(byte[] cnt) throws ParserConfigurationException, SAXException, IOException {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n     // xxe protection\n     factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n     factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);"
            },
            {
                "sha": "0e12abb77d5a2194c69ba45bf2f51cfee674f35e",
                "filename": "org.hl7.fhir.validation/src/test/java/org/hl7/fhir/conversion/tests/UtilitiesXTests.java",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/hapifhir/org.hl7.fhir.core/blob/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.validation%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconversion%2Ftests%2FUtilitiesXTests.java",
                "raw_url": "https://github.com/hapifhir/org.hl7.fhir.core/raw/7ede053a5fca50cc2802884c661a241d51703a67/org.hl7.fhir.validation%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconversion%2Ftests%2FUtilitiesXTests.java",
                "contents_url": "https://api.github.com/repos/hapifhir/org.hl7.fhir.core/contents/org.hl7.fhir.validation%2Fsrc%2Ftest%2Fjava%2Forg%2Fhl7%2Ffhir%2Fconversion%2Ftests%2FUtilitiesXTests.java?ref=7ede053a5fca50cc2802884c661a241d51703a67",
                "patch": "@@ -64,6 +64,7 @@ WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWIS\n import org.hl7.fhir.utilities.filesystem.CSFile;\n import org.hl7.fhir.utilities.filesystem.ManagedFileAccess;\n import org.hl7.fhir.utilities.npm.FilesystemPackageCacheManager;\n+import org.hl7.fhir.utilities.xml.XMLUtil;\n import org.w3c.dom.Document;\n import org.w3c.dom.Element;\n import org.w3c.dom.NamedNodeMap;\n@@ -277,7 +278,7 @@ private static Document loadXml(String fn) throws Exception {\n   }\n \n   private static Document loadXml(InputStream fn) throws Exception {\n-    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+    DocumentBuilderFactory factory = XMLUtil.newXXEProtectedDocumentBuilderFactory();\n       factory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\n       factory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n       factory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/taoso/webfeed/commits/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d",
        "url": "https://api.github.com/repos/taoso/webfeed/commits/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d",
        "html_url": "https://github.com/taoso/webfeed/commit/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d",
        "message": "Merge commit from fork\n\n* Avoid using the innerHTML to fix XSS issue\n\n* It's save to assign html content to innerText.\n\nSo there is no need to purge html tags recursively.\n\n* do more escape for innerHTML\n\n* innerHTML is hard ;-(\n\n* fix syntax error",
        "files": [
            {
                "sha": "22e5631b7610698e31cd1412bdb2477f4212ffa1",
                "filename": "js/list.js",
                "status": "modified",
                "additions": 5,
                "deletions": 13,
                "changes": 18,
                "blob_url": "https://github.com/taoso/webfeed/blob/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Flist.js",
                "raw_url": "https://github.com/taoso/webfeed/raw/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Flist.js",
                "contents_url": "https://api.github.com/repos/taoso/webfeed/contents/js%2Flist.js?ref=a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d",
                "patch": "@@ -29,23 +29,15 @@ async function listEntries(last = 0) {\n     const content = template.content.cloneNode(true);\n     let $ = content.querySelector.bind(content);\n \n-    $(\"article>h2\").innerHTML = entry.title;\n-    $(\"article>.meta time\").innerHTML = entry.updated.toLocaleString();\n+    $(\"article>h2\").innerText = utils.html2txt(entry.title);\n+    $(\"article>.meta time\").innerText = entry.updated.toLocaleString();\n+    $(\"article>div\").innerText = utils.html2txt(entry.summary);\n     $(\"article>.meta a.link\").href = entry.link;\n \n-    let sum = $(\"article>div\");\n-    sum.innerHTML = entry.summary;\n-\n-    // drop duplicate read more link in content\n-    let a = $(`article>.summary a[href=\"${entry.link}\"]`);\n-    if (a) a.outerHTML = '';\n-\n-    utils.html2txt(sum);\n-\n     let showUrl = browser.runtime.getURL(`show.html?url=${encodeURI(entry.site)}`)\n     let site = utils.getSiteTitle(entry.site);\n     $(\"article>.meta a.site\").href = showUrl;\n-    $(\"article>.meta a.site\").innerHTML = site;\n+    $(\"article>.meta a.site\").innerText = site;\n     let $img = $(\"article>.meta img.icon\");\n     store.getIcon(site).then(src => $img.src = src);\n \n@@ -75,7 +67,7 @@ async function listEntries(last = 0) {\n   let more = document.querySelector(\"#more\")\n   if (num > 0) {\n     more.dataset.done = true;\n-    more.innerHTML = \"There is no more feeds to load.\";\n+    more.innerText = \"There is no more feeds to load.\";\n   }\n \n   return firstId;"
            },
            {
                "sha": "893fe223c58333c53a4e50bf8c3df0253d0af4f0",
                "filename": "js/logs.js",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/taoso/webfeed/blob/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Flogs.js",
                "raw_url": "https://github.com/taoso/webfeed/raw/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Flogs.js",
                "contents_url": "https://api.github.com/repos/taoso/webfeed/contents/js%2Flogs.js?ref=a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d",
                "patch": "@@ -73,12 +73,13 @@ or caused by a small timeout option.<p>\n     let info = infos[type];\n \n     $('.type').innerText = info.title;\n-    $('.error').innerHTML = info.desc;\n+    $('.error').innerHTML = info.desc; // none user input, safe to use\n     let ol = $('.urls');\n     for (const url of urls) {\n       let li = document.createElement('li');\n       let showUrl = browser.runtime.getURL(`show.html?url=${encodeURI(url)}`);\n-      li.innerHTML = `<a href=\"${showUrl}\" target=\"_blank\">${url}</a>`;\n+      li.innerHTML = `<a href=\"${showUrl}\" target=\"_blank\"></a>`;\n+      li.querySelector('a').innerText = url;\n       ol.appendChild(li);\n     }\n "
            },
            {
                "sha": "243ddaae941a3bd4be5c68b55d85f9d664196c0a",
                "filename": "js/popup.js",
                "status": "modified",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/taoso/webfeed/blob/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Fpopup.js",
                "raw_url": "https://github.com/taoso/webfeed/raw/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Fpopup.js",
                "contents_url": "https://api.github.com/repos/taoso/webfeed/contents/js%2Fpopup.js?ref=a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d",
                "patch": "@@ -2,7 +2,7 @@\n \n let browser = self.browser || self.chrome;\n \n-import { findParent } from './utils.js';\n+import * as utils from './utils.js';\n \n const feeds = JSON.parse(\n   decodeURIComponent(window.location.search.substr(7))\n@@ -16,7 +16,7 @@ const types = {\n };\n \n document.addEventListener(\"click\", e => {\n-  const el = findParent(e.target, \".items__item-link\");\n+  const el = utils.findParent(e.target, \".items__item-link\");\n   if (!el) return;\n   e.preventDefault();\n \n@@ -46,7 +46,7 @@ const items = feeds.map(feed => {\n   }\n \n   link.innerHTML =\n-    (feed.title || feed.url) +\n+    utils.html2txt(feed.title || feed.url) +\n       (types[feed.type]\n         ? ` <span style=\"opacity:0.6;\">(${types[feed.type]})</span>`\n         : \"\");"
            },
            {
                "sha": "3a4278f2fc358c8725e6353b50c7e44f453df513",
                "filename": "js/show.js",
                "status": "modified",
                "additions": 22,
                "deletions": 39,
                "changes": 61,
                "blob_url": "https://github.com/taoso/webfeed/blob/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Fshow.js",
                "raw_url": "https://github.com/taoso/webfeed/raw/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Fshow.js",
                "contents_url": "https://api.github.com/repos/taoso/webfeed/contents/js%2Fshow.js?ref=a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d",
                "patch": "@@ -8,13 +8,13 @@ import * as store from './store.js';\n async function renderHTML(feed, resp) {\n   let header = document.querySelector('body header');\n \n-  header.querySelector('h1').innerHTML = feed.title;\n+  header.querySelector('h1').innerText = utils.html2txt(feed.title);\n   let h1 = header.querySelector('#site-link')\n   h1.href = feed.link;\n-  h1.innerHTML = utils.getSiteTitle(feed.link);\n+  h1.innerText = utils.getSiteTitle(feed.link);\n \n   let img = header.querySelector('#site-icon');\n-  img.src = await store.getIcon(h1.innerHTML);\n+  img.src = await store.getIcon(h1.innerText);\n \n   let button = header.querySelector('subscribe-button')\n   button.dataset.url = feed.url\n@@ -23,14 +23,14 @@ async function renderHTML(feed, resp) {\n \n   let bs = await browser.bookmarks.search({url:document.URL});\n   if (bs.length > 0) {\n-    button.innerHTML = \"Unsubscribe\";\n+    button.innerText = \"Unsubscribe\";\n   } else {\n     if (resp.redirected) {\n       let url = browser.runtime.getURL(`show.html?url=${encodeURI(resp.url)}`);\n       document.location.href = url;\n       return;\n     }\n-    button.innerHTML = \"Subscribe\";\n+    button.innerText = \"Subscribe\";\n   }\n   button.style.display = \"inline\";\n \n@@ -41,55 +41,32 @@ async function renderHTML(feed, resp) {\n       alert(\"invalid feed\");\n       return;\n     }\n-    if (button.innerHTML == \"Subscribe\") {\n+    if (button.innerText == \"Subscribe\") {\n       await store.subscribe(e.target.dataset);\n       await store.saveEntries(feed.url, feed.entries);\n-      button.innerHTML = \"Unsubscribe\";\n+      button.innerText = \"Unsubscribe\";\n     } else {\n       let bs = await browser.bookmarks.search({url:document.URL});\n       await browser.bookmarks.remove(bs[0].id);\n       await store.removeEntries(feed.url);\n-      button.innerHTML = \"Subscribe\";\n+      button.innerText = \"Subscribe\";\n     }\n   };\n \n   const template = document.getElementById(\"feed-item\");\n \n   feed.entries.forEach(entry => {\n     const content = template.content.cloneNode(true);\n+    let $ = content.querySelector.bind(content);\n \n     if (isNaN(entry.updated)) {\n       invalid = true;\n     }\n \n-    content.querySelector(\"article>h2\").innerHTML = entry.title;\n-    content.querySelector(\"article>time\").innerHTML = entry.updated.toLocaleString();\n-\n-    let sum = content.querySelector(\"article>div\");\n-    sum.innerHTML = entry.summary;\n-\n-    utils.html2txt(sum);\n-\n-    let link = utils.fixLink(entry.link, feed.url);\n-    content.querySelector(\"article>a\").href = link;\n-\n-    // drop duplicate read more link in content\n-    let a = sum.querySelector(`a[href=\"${link}\"]`);\n-    if (a) a.outerHTML = '';\n-\n-    content.querySelectorAll(\"article>div img\").forEach(img => {\n-      if (img.dataset.src) {\n-        img.src = img.dataset.src;\n-      }\n-      img.src = utils.fixLink(img.src, feed.url);\n-      img.onerror = (e) => {\n-        img.style.display = 'none';\n-      };\n-    });\n-\n-    content.querySelectorAll(\"article>div a\").forEach(a => {\n-      a.href = utils.fixLink(a.href, feed.url);\n-    });\n+    $(\"article>h2\").innerText = utils.html2txt(entry.title);\n+    $(\"article>time\").innerText = entry.updated.toLocaleString();\n+    $(\"article>div\").innerText = utils.html2txt(entry.summary);\n+    $(\"article>a\").href = utils.fixLink(entry.link, feed.url);\n \n     document.querySelector(\".items\").appendChild(content);\n   });\n@@ -120,12 +97,18 @@ async function main() {\n     error.innerHTML = `\n <div>\n   <p>Error while fetching feed</p>\n-  <p style=\"color:red;\">${e}</p>\n-  <p><pre>${e.stack}</pre></p>\n+  <p class=\"error\" style=\"color:red;\"></p>\n+  <p><pre></pre></p>\n   <p>You may go to the site to find the latest feed and unsubscribe this one.</p>\n-  <a href=\"${url}\">${url}</a>\n+  <a href=\"#\"></a>\n </div>\n `;\n+    let $ = error.querySelector.bind(error);\n+    $('p.error').innerText = e.message;\n+    $('pre').innerText = e.stack;\n+    $('a').href = url;\n+    $('a').innerText = url;\n+\n     document.body.appendChild(error);\n     return;\n   }"
            },
            {
                "sha": "534b5676bd7cd23f0542ba02042a2357f3511262",
                "filename": "js/utils.js",
                "status": "modified",
                "additions": 7,
                "deletions": 10,
                "changes": 17,
                "blob_url": "https://github.com/taoso/webfeed/blob/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Futils.js",
                "raw_url": "https://github.com/taoso/webfeed/raw/a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d/js%2Futils.js",
                "contents_url": "https://api.github.com/repos/taoso/webfeed/contents/js%2Futils.js?ref=a2d1c1c3a98f30e0bd7a1bbcb746fae484985e6d",
                "patch": "@@ -194,16 +194,13 @@ export async function syncAll() {\n   }\n }\n \n-// publisher may embed html code in <pre> or <code>\n-// this should convert to text recursively.\n-export async function html2txt(e) {\n-  for (let i = 0; i < 10; i++) {\n-    if (e.children) {\n-      e.innerHTML = e.innerText;\n-    } else {\n-      break;\n-    }\n-  }\n+// The return value may include html tags, so do not\n+// assign it to innerHTML directly!\n+export function html2txt(content) {\n+  let e = document.createElement('div');\n+  e.innerHTML = content;\n+\n+  return e.innerText;\n }\n \n export function getSiteTitle(link) {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/imputnet/cobalt/commits/c4be1d3a37b0deb6b6087ec7a815262ac942daf1",
        "url": "https://api.github.com/repos/imputnet/cobalt/commits/c4be1d3a37b0deb6b6087ec7a815262ac942daf1",
        "html_url": "https://github.com/imputnet/cobalt/commit/c4be1d3a37b0deb6b6087ec7a815262ac942daf1",
        "message": "web/download: don't try to open non-https links",
        "files": [
            {
                "sha": "7a126a92f62eb3a5d581075f39c6523e675a84e6",
                "filename": "web/src/lib/download.ts",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/imputnet/cobalt/blob/c4be1d3a37b0deb6b6087ec7a815262ac942daf1/web%2Fsrc%2Flib%2Fdownload.ts",
                "raw_url": "https://github.com/imputnet/cobalt/raw/c4be1d3a37b0deb6b6087ec7a815262ac942daf1/web%2Fsrc%2Flib%2Fdownload.ts",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Flib%2Fdownload.ts?ref=c4be1d3a37b0deb6b6087ec7a815262ac942daf1",
                "patch": "@@ -56,6 +56,10 @@ export const shareFile = async (file: File) => {\n }\n \n export const openURL = (url: string) => {\n+    if (!['http:', 'https:'].includes(new URL(url).protocol)) {\n+        return alert('error: invalid url!');\n+    }\n+\n     const open = window.open(url, \"_blank\");\n \n     /* if new tab got blocked by user agent, show a saving dialog */"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/imputnet/cobalt/commits/66bac03e3078e4e781d2d3903c05ad66a883a354",
        "url": "https://api.github.com/repos/imputnet/cobalt/commits/66bac03e3078e4e781d2d3903c05ad66a883a354",
        "html_url": "https://github.com/imputnet/cobalt/commit/66bac03e3078e4e781d2d3903c05ad66a883a354",
        "message": "web/dialogs: add picker dialog & clean up small dialog",
        "files": [
            {
                "sha": "451d74cfcdd08e75b1d70bb56430edd6dc38fe66",
                "filename": "web/i18n/en/a11y/dialog.json",
                "status": "added",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fi18n%2Fen%2Fa11y%2Fdialog.json",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fi18n%2Fen%2Fa11y%2Fdialog.json",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fi18n%2Fen%2Fa11y%2Fdialog.json?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -0,0 +1,3 @@\n+{\n+    \"picker.item.generic\": \"media thumbnail\"\n+}"
            },
            {
                "sha": "bfe30bec244066ef14164c2b25aabaa5a3a8fb63",
                "filename": "web/i18n/en/dialog.json",
                "status": "modified",
                "additions": 8,
                "deletions": 1,
                "changes": 9,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fi18n%2Fen%2Fdialog.json",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fi18n%2Fen%2Fdialog.json",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fi18n%2Fen%2Fdialog.json?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -2,7 +2,14 @@\n     \"button.gotit\": \"got it\",\n     \"button.cancel\": \"cancel\",\n     \"button.reset\": \"reset\",\n+    \"button.done\": \"done\",\n+    \"button.downloadAudio\": \"download audio\",\n \n     \"reset.title\": \"reset all settings?\",\n-    \"reset.body\": \"are you sure you want to reset all settings? this action is immediate and irreversible.\"\n+    \"reset.body\": \"are you sure you want to reset all settings? this action is immediate and irreversible.\",\n+\n+    \"picker.title\": \"select what to save\",\n+    \"picker.description.desktop\": \"click an item to save it. images can also be saved via the right click menu.\",\n+    \"picker.description.phone\": \"press an item to save it. images can also be saved with a long press.\",\n+    \"picker.description.ios\": \"press an item to save it with a shortcut. images can also be saved with a long press.\"\n }"
            },
            {
                "sha": "7c290533d4adc437bb60f1fdc78d9b639c9e00e5",
                "filename": "web/src/components/dialog/DialogBackdropClose.svelte",
                "status": "added",
                "additions": 18,
                "deletions": 0,
                "changes": 18,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FDialogBackdropClose.svelte",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FDialogBackdropClose.svelte",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Fcomponents%2Fdialog%2FDialogBackdropClose.svelte?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -0,0 +1,18 @@\n+<script lang=\"ts\">\n+    export let closeFunc: () => void;\n+</script>\n+\n+<div\n+    id=\"dialog-backdrop-close\"\n+    aria-hidden=\"true\"\n+    on:click={() => closeFunc()}\n+></div>\n+\n+<style>\n+    #dialog-backdrop-close {\n+        position: inherit;\n+        height: 100%;\n+        width: 100%;\n+        z-index: -1;\n+    }\n+</style>"
            },
            {
                "sha": "5f086a78c008d5716517913d848afa3efc767fef",
                "filename": "web/src/components/dialog/DialogButtons.svelte",
                "status": "added",
                "additions": 61,
                "deletions": 0,
                "changes": 61,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FDialogButtons.svelte",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FDialogButtons.svelte",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Fcomponents%2Fdialog%2FDialogButtons.svelte?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -0,0 +1,61 @@\n+<script lang=\"ts\">\n+    import type { DialogButton } from \"$lib/types/dialog\";\n+\n+    export let buttons: DialogButton[];\n+    export let closeFunc: () => void;\n+</script>\n+\n+<div class=\"popup-buttons\">\n+    {#each buttons as button}\n+        <button\n+            class=\"button popup-button {button.color}\"\n+            class:active={button.main}\n+            on:click={async () => {\n+                await button.action();\n+                closeFunc();\n+            }}\n+        >\n+            {button.text}\n+        </button>\n+    {/each}\n+</div>\n+\n+<style>\n+    .popup-buttons {\n+        display: flex;\n+        flex-direction: row;\n+        width: 100%;\n+        gap: calc(var(--padding) / 2);\n+        overflow: scroll;\n+        border-radius: var(--border-radius);\n+        min-height: 40px;\n+    }\n+\n+    .popup-button {\n+        width: 100%;\n+        height: 40px;\n+    }\n+\n+    .popup-button.red {\n+        background-color: var(--red);\n+        color: var(--white);\n+    }\n+\n+    .popup-button:not(.active) {\n+        background-color: var(--button-elevated);\n+    }\n+\n+    .popup-button:not(.active):active {\n+        background-color: var(--button-elevated-hover);\n+    }\n+\n+    .popup-button:not(:focus-visible) {\n+        box-shadow: none;\n+    }\n+\n+    @media (hover: hover) {\n+        .popup-button:not(.active):hover {\n+            background-color: var(--button-elevated-hover);\n+        }\n+    }\n+</style>"
            },
            {
                "sha": "61503fcda0fd6cb9eccb9a90c135b9101707b456",
                "filename": "web/src/components/dialog/DialogHolder.svelte",
                "status": "modified",
                "additions": 106,
                "deletions": 1,
                "changes": 107,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FDialogHolder.svelte",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FDialogHolder.svelte",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Fcomponents%2Fdialog%2FDialogHolder.svelte?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -1,7 +1,9 @@\n <script lang=\"ts\">\n-    import SmallDialog from \"$components/dialog/SmallDialog.svelte\";\n     import dialogs from \"$lib/dialogs\";\n \n+    import SmallDialog from \"$components/dialog/SmallDialog.svelte\";\n+    import PickerDialog from \"$components/dialog/PickerDialog.svelte\";\n+\n     $: backdropVisible = $dialogs.length > 0;\n </script>\n \n@@ -18,11 +20,56 @@\n                 buttons={dialog.buttons}\n             />\n         {/if}\n+\n+        {#if dialog.type === \"picker\"}\n+            <PickerDialog\n+                id={dialog.id}\n+                items={dialog.items}\n+                buttons={dialog.buttons}\n+            />\n+        {/if}\n     {/each}\n     <div id=\"dialog-backdrop\" class:visible={backdropVisible}></div>\n </div>\n \n <style>\n+    :global(dialog) {\n+        display: flex;\n+        flex-direction: column;\n+        justify-content: center;\n+        align-items: center;\n+        background: none;\n+\n+        max-height: 100%;\n+        max-width: 100%;\n+        height: 100%;\n+        width: 100%;\n+        margin: 0;\n+        padding: 0;\n+        border: none;\n+        pointer-events: all;\n+\n+        inset-inline-start: unset;\n+        inset-inline-end: unset;\n+\n+        overflow: hidden;\n+    }\n+\n+    :global(dialog:modal) {\n+        inset-block-start: 0;\n+        inset-block-end: 0;\n+    }\n+\n+    :global(dialog:modal::backdrop) {\n+        display: none;\n+    }\n+\n+    @media screen and (max-width: 535px) {\n+        :global(dialog) {\n+            justify-content: end;\n+        }\n+    }\n+\n     #dialog-holder {\n         position: absolute;\n         padding-top: env(safe-area-inset-bottom);\n@@ -60,4 +107,62 @@\n         backdrop-filter: none !important;\n         -webkit-backdrop-filter: none !important;\n     }\n+\n+    :global(.open .dialog-body) {\n+        animation: modal-in 0.35s;\n+    }\n+\n+    :global(.closing .dialog-body) {\n+        animation: modal-out 0.15s;\n+        opacity: 0;\n+    }\n+\n+    @media screen and (max-width: 535px) {\n+        :global(.open .dialog-body) {\n+            animation: modal-in-mobile 0.4s;\n+        }\n+    }\n+\n+    @keyframes modal-in {\n+        from {\n+            transform: scale(0.8);\n+            opacity: 0;\n+        }\n+        30% {\n+            opacity: 1;\n+        }\n+        50% {\n+            transform: scale(1.005);\n+        }\n+        100% {\n+            transform: scale(1);\n+        }\n+    }\n+\n+    @keyframes modal-out {\n+        from {\n+            opacity: 1;\n+        }\n+        to {\n+            opacity: 0;\n+            transform: scale(0.9);\n+            visibility: hidden;\n+        }\n+    }\n+\n+    @keyframes modal-in-mobile {\n+        from {\n+            transform: translateY(200px);\n+            opacity: 0;\n+        }\n+        30% {\n+            opacity: 1;\n+        }\n+        50% {\n+            transform: translateY(-5px);\n+        }\n+        100% {\n+            transform: translateY(0px);\n+        }\n+    }\n </style>"
            },
            {
                "sha": "5c5c0d61eece9c5e623f6b20ff5c3fe30593f4bb",
                "filename": "web/src/components/dialog/PickerDialog.svelte",
                "status": "added",
                "additions": 231,
                "deletions": 0,
                "changes": 231,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FPickerDialog.svelte",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FPickerDialog.svelte",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Fcomponents%2Fdialog%2FPickerDialog.svelte?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -0,0 +1,231 @@\n+<script lang=\"ts\">\n+    import { tick } from \"svelte\";\n+    import { device } from \"$lib/device\";\n+    import { killDialog } from \"$lib/dialogs\";\n+    import { t } from \"$lib/i18n/translations\";\n+\n+    import type { Optional } from \"$lib/types/generic\";\n+    import type { DialogButton } from \"$lib/types/dialog\";\n+    import type { DialogPickerItem } from \"$lib/types/dialog\";\n+\n+    import PickerItem from \"$components/dialog/PickerItem.svelte\";\n+    import DialogButtons from \"$components/dialog/DialogButtons.svelte\";\n+    import DialogBackdropClose from \"$components/dialog/DialogBackdropClose.svelte\";\n+\n+    import IconBoxMultiple from \"@tabler/icons-svelte/IconBoxMultiple.svelte\";\n+\n+    export let id: string;\n+    export let items: Optional<DialogPickerItem[]>;\n+    export let buttons: Optional<DialogButton[]>;\n+\n+    let dialogDescription = \"dialog.picker.description.\";\n+\n+    if (device.is.iOS) {\n+        dialogDescription += \"ios\";\n+    } else if (device.is.mobile) {\n+        dialogDescription += \"mobile\";\n+    } else {\n+        dialogDescription += \"desktop\";\n+    }\n+\n+    let dialogParent: HTMLDialogElement;\n+\n+    let closing = false;\n+    let open = false;\n+\n+    const close = () => {\n+        if (dialogParent) {\n+            closing = true;\n+            open = false;\n+            setTimeout(() => {\n+                dialogParent.close();\n+                killDialog();\n+            }, 150);\n+        }\n+    };\n+\n+    $: if (dialogParent) {\n+        dialogParent.showModal();\n+        tick().then(() => {\n+            open = true;\n+        });\n+    }\n+</script>\n+\n+<dialog\n+    id=\"dialog-{id}\"\n+    bind:this={dialogParent}\n+    class:closing\n+    class:open\n+    class:three-columns={items && items.length <= 3}\n+>\n+    <div class=\"dialog-body picker-dialog\">\n+        <div class=\"popup-header\">\n+            <div class=\"popup-title-container\">\n+                <IconBoxMultiple />\n+                <h2 class=\"popup-title\" tabindex=\"-1\">\n+                    {$t(\"dialog.picker.title\")}\n+                </h2>\n+            </div>\n+            <div class=\"subtext popup-description\">\n+                {$t(dialogDescription)}\n+            </div>\n+        </div>\n+        <div class=\"picker-body\">\n+            {#if items}\n+                {#each items as item}\n+                    <PickerItem {item} />\n+                {/each}\n+            {/if}\n+        </div>\n+        {#if buttons}\n+            <DialogButtons {buttons} closeFunc={close} />\n+        {/if}\n+    </div>\n+\n+    <DialogBackdropClose closeFunc={close} />\n+</dialog>\n+\n+<style>\n+    .picker-dialog {\n+        --dialog-padding: 18px;\n+        --picker-item-size: 120px;\n+\n+        display: flex;\n+        flex-direction: column;\n+        align-items: center;\n+        gap: var(--padding);\n+        max-height: calc(\n+            90% - env(safe-area-inset-bottom) - env(safe-area-inset-top)\n+        );\n+\n+        width: auto;\n+        background: var(--popup-bg);\n+        box-shadow:\n+            0 0 0 2px var(--popup-stroke) inset,\n+            0 0 60px 10px var(--popup-bg);\n+        padding: var(--dialog-padding);\n+        position: relative;\n+        will-change: transform;\n+\n+        border-radius: 29px;\n+    }\n+\n+    .popup-header {\n+        display: flex;\n+        flex-direction: column;\n+        align-items: flex-start;\n+        gap: 3px;\n+        max-width: calc(var(--picker-item-size) * 4);\n+    }\n+\n+    .popup-title-container {\n+        display: flex;\n+        flex-direction: row;\n+        align-items: center;\n+        gap: calc(var(--padding) / 2);\n+        color: var(--secondary);\n+    }\n+\n+    .popup-title-container :global(svg) {\n+        height: 21px;\n+        width: 21px;\n+    }\n+\n+    .popup-title {\n+        font-size: 18px;\n+        line-height: 1.1;\n+    }\n+\n+    .popup-description {\n+        font-size: 13px;\n+        padding: 0;\n+    }\n+\n+    .popup-title:focus-visible {\n+        box-shadow: none !important;\n+    }\n+\n+    .picker-body {\n+        overflow-y: scroll;\n+        display: grid;\n+        justify-items: center;\n+        grid-template-columns: 1fr 1fr 1fr 1fr;\n+    }\n+\n+    .three-columns .picker-body {\n+        grid-template-columns: 1fr 1fr 1fr;\n+    }\n+\n+    .three-columns .popup-header {\n+        max-width: calc(var(--picker-item-size) * 3);\n+    }\n+\n+    :global(.picker-item) {\n+        width: var(--picker-item-size);\n+        height: var(--picker-item-size);\n+    }\n+\n+    @media screen and (max-width: 535px) {\n+        .picker-dialog {\n+            margin-bottom: calc(\n+                var(--dialog-padding) + env(safe-area-inset-bottom)\n+            );\n+            box-shadow: 0 0 0 2px var(--popup-stroke) inset;\n+        }\n+\n+        .picker-body {\n+            grid-template-columns: 1fr 1fr 1fr;\n+        }\n+\n+        .popup-header {\n+            max-width: calc(var(--picker-item-size) * 3);\n+        }\n+    }\n+\n+    @media screen and (max-width: 400px) {\n+        .picker-dialog {\n+            --picker-item-size: 115px;\n+        }\n+    }\n+\n+    @media screen and (max-width: 380px) {\n+        .picker-dialog {\n+            --picker-item-size: 110px;\n+        }\n+    }\n+\n+    @media screen and (max-width: 365px) {\n+        .picker-dialog {\n+            --picker-item-size: 105px;\n+        }\n+    }\n+\n+    @media screen and (max-width: 350px) {\n+        .picker-dialog {\n+            --picker-item-size: 100px;\n+        }\n+    }\n+\n+    @media screen and (max-width: 335px) {\n+        .picker-body,\n+        .three-columns .picker-body {\n+            grid-template-columns: 1fr 1fr;\n+        }\n+\n+        .popup-header {\n+            max-width: calc(var(--picker-item-size) * 3);\n+        }\n+    }\n+\n+    @media screen and (max-width: 255px) {\n+        .picker-dialog {\n+            --picker-item-size: 120px;\n+        }\n+\n+        .picker-body,\n+        .three-columns .picker-body {\n+            grid-template-columns: 1fr;\n+        }\n+    }\n+</style>"
            },
            {
                "sha": "b56abcc987c94958452463827a30cc3ae6089186",
                "filename": "web/src/components/dialog/PickerItem.svelte",
                "status": "added",
                "additions": 65,
                "deletions": 0,
                "changes": 65,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FPickerItem.svelte",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FPickerItem.svelte",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Fcomponents%2Fdialog%2FPickerItem.svelte?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -0,0 +1,65 @@\n+<script lang=\"ts\">\n+    import { t } from \"$lib/i18n/translations\";\n+\n+    import { downloadFile } from \"$lib/download\";\n+    import type { DialogPickerItem } from \"$lib/types/dialog\";\n+\n+    import Skeleton from \"$components/misc/Skeleton.svelte\";\n+\n+    export let item: DialogPickerItem;\n+\n+    let imageLoaded = false;\n+</script>\n+\n+<button\n+    class=\"picker-item\"\n+    on:click={() => {\n+        downloadFile(item.url);\n+    }}\n+>\n+    <img\n+        class=\"picker-image\"\n+        src={item.thumb ? item.thumb : item.url}\n+        class:loading={!imageLoaded}\n+        on:load={() => (imageLoaded = true)}\n+        alt={$t(\"a11y.dialog.picker.item.generic\")}\n+        height=\"100\"\n+        width=\"100\"\n+    />\n+    <Skeleton class=\"picker-image\" hidden={imageLoaded} />\n+</button>\n+\n+<style>\n+    .picker-item {\n+        background: none;\n+        padding: 2px;\n+        box-shadow: none;\n+        border-radius: calc(var(--border-radius) / 2 + 2px);\n+    }\n+\n+    :global(.picker-image) {\n+        display: block;\n+        width: 100%;\n+        height: 100%;\n+\n+        aspect-ratio: 1/1;\n+        pointer-events: all;\n+\n+        object-fit: cover;\n+        border-radius: calc(var(--border-radius) / 2);\n+    }\n+\n+    .picker-image.loading {\n+        display: none;\n+    }\n+\n+    .picker-item:active .picker-image {\n+        opacity: 0.8;\n+    }\n+\n+    @media (hover: hover) {\n+        .picker-item:hover .picker-image {\n+            opacity: 0.8;\n+        }\n+    }\n+</style>"
            },
            {
                "sha": "b2951d627039f3a716bea37dc4b543ce722ef806",
                "filename": "web/src/components/dialog/SmallDialog.svelte",
                "status": "modified",
                "additions": 16,
                "deletions": 160,
                "changes": 176,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FSmallDialog.svelte",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fdialog%2FSmallDialog.svelte",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Fcomponents%2Fdialog%2FSmallDialog.svelte?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -1,12 +1,14 @@\n <script lang=\"ts\">\n     import { tick } from \"svelte\";\n-\n     import { killDialog } from \"$lib/dialogs\";\n-    import type { DialogButton, SmallDialogIcons } from \"$lib/types/dialog\";\n-    import type { MeowbaltEmotions } from \"$lib/types/meowbalt\";\n+\n     import type { Optional } from \"$lib/types/generic\";\n+    import type { MeowbaltEmotions } from \"$lib/types/meowbalt\";\n+    import type { DialogButton, SmallDialogIcons } from \"$lib/types/dialog\";\n \n     import Meowbalt from \"$components/misc/Meowbalt.svelte\";\n+    import DialogButtons from \"$components/dialog/DialogButtons.svelte\";\n+    import DialogBackdropClose from \"$components/dialog/DialogBackdropClose.svelte\";\n \n     import IconAlertTriangle from \"@tabler/icons-svelte/IconAlertTriangle.svelte\";\n \n@@ -16,7 +18,7 @@\n     export let title: string = \"\";\n     export let bodyText: string = \"\";\n     export let bodySubText: string = \"\";\n-    export let buttons: DialogButton[];\n+    export let buttons: Optional<DialogButton[]>;\n \n     let dialogParent: HTMLDialogElement;\n \n@@ -58,7 +60,7 @@\n                         </div>\n                     {/if}\n                     {#if title}\n-                        <h2 id=\"popup-title\" tabindex=\"-1\">{title}</h2>\n+                        <h2 class=\"popup-title\" tabindex=\"-1\">{title}</h2>\n                     {/if}\n                 </div>\n             {/if}\n@@ -69,57 +71,15 @@\n                 <div class=\"subtext\">{bodySubText}</div>\n             {/if}\n         </div>\n-        <div class=\"popup-buttons\">\n-            {#each buttons as button}\n-                <button\n-                    class=\"button popup-button {button.color}\"\n-                    class:active={button.main}\n-                    on:click={async () => {\n-                        await button.action();\n-                        close();\n-                    }}\n-                >\n-                    {button.text}\n-                </button>\n-            {/each}\n-        </div>\n+        {#if buttons}\n+            <DialogButtons {buttons} closeFunc={close} />\n+        {/if}\n     </div>\n \n-    <div id=\"dialog-backdrop-close\" aria-hidden=\"true\" on:click={() => close()}></div>\n+    <DialogBackdropClose closeFunc={close} />\n </dialog>\n \n <style>\n-    dialog {\n-        display: flex;\n-        flex-direction: column;\n-        justify-content: center;\n-        align-items: center;\n-        background: none;\n-\n-        max-height: 100%;\n-        max-width: 100%;\n-        height: 100%;\n-        width: 100%;\n-        margin: 0;\n-        padding: 0;\n-        border: none;\n-        pointer-events: all;\n-\n-        inset-inline-start: unset;\n-        inset-inline-end: unset;\n-\n-        overflow: hidden;\n-    }\n-\n-    dialog:modal {\n-        inset-block-start: 0;\n-        inset-block-end: 0;\n-    }\n-\n-    dialog:modal::backdrop {\n-        display: none;\n-    }\n-\n     .small-dialog,\n     .popup-body {\n         display: flex;\n@@ -132,34 +92,25 @@\n     }\n \n     .small-dialog {\n-        --small-dialog-padding: 18px;\n+        --dialog-padding: 18px;\n \n         align-items: center;\n         text-align: center;\n         max-width: 340px;\n         width: calc(\n-            100% - var(--padding) * 2 - var(--small-dialog-padding) * 2\n+            100% - var(--padding) * 2 - var(--dialog-padding) * 2\n         );\n         background: var(--popup-bg);\n         box-shadow:\n             0 0 0 2px var(--popup-stroke) inset,\n             0 0 60px 10px var(--popup-bg);\n-        padding: var(--small-dialog-padding);\n+        padding: var(--dialog-padding);\n         margin: var(--padding);\n         border-radius: 29px;\n         position: relative;\n         will-change: transform;\n     }\n \n-    .open .small-dialog {\n-        animation: modal-in 0.35s;\n-    }\n-\n-    .closing .small-dialog {\n-        animation: modal-out 0.15s;\n-        opacity: 0;\n-    }\n-\n     .small-dialog.meowbalt-visible {\n         padding-top: calc(var(--padding) * 4);\n     }\n@@ -169,7 +120,7 @@\n         top: -120px;\n     }\n \n-    .popup-header h2 {\n+    .popup-title {\n         color: var(--secondary);\n         font-size: 19px;\n     }\n@@ -191,109 +142,14 @@\n     }\n \n     .body-text:focus-visible,\n-    h2:focus-visible {\n+    .popup-title:focus-visible {\n         box-shadow: none !important;\n     }\n \n-    .popup-buttons {\n-        display: flex;\n-        flex-direction: row;\n-        width: 100%;\n-        gap: calc(var(--padding) / 2);\n-        overflow: scroll;\n-        border-radius: var(--border-radius);\n-    }\n-\n-    .popup-button {\n-        width: 100%;\n-        height: 40px;\n-    }\n-\n-    .popup-button.red {\n-        background-color: var(--red);\n-        color: var(--white);\n-    }\n-\n-    .popup-button:not(.active) {\n-        background-color: var(--button-elevated);\n-    }\n-\n-    .popup-button:not(.active):active {\n-        background-color: var(--button-elevated-hover);\n-    }\n-\n-    .popup-button:not(:focus-visible) {\n-        box-shadow: none;\n-    }\n-\n-    @media (hover: hover) {\n-        .popup-button:not(.active):hover {\n-            background-color: var(--button-elevated-hover);\n-        }\n-    }\n-\n-    #dialog-backdrop-close {\n-        position: inherit;\n-        height: 100%;\n-        width: 100%;\n-        z-index: -1;\n-    }\n-\n-    @keyframes modal-in {\n-        from {\n-            transform: scale(0.8);\n-            opacity: 0;\n-        }\n-        30% {\n-            opacity: 1;\n-        }\n-        50% {\n-            transform: scale(1.005);\n-        }\n-        100% {\n-            transform: scale(1);\n-        }\n-    }\n-\n-    @keyframes modal-out {\n-        from {\n-            opacity: 1;\n-        }\n-        to {\n-            opacity: 0;\n-            transform: scale(0.9);\n-            visibility: hidden;\n-        }\n-    }\n-\n     @media screen and (max-width: 535px) {\n-        dialog {\n-            justify-content: end;\n-        }\n-\n         .small-dialog {\n             margin-bottom: calc(var(--padding) + env(safe-area-inset-bottom));\n             box-shadow: 0 0 0 2px var(--popup-stroke) inset;\n         }\n-\n-        .open .small-dialog {\n-            animation: modal-in-mobile 0.4s;\n-        }\n-\n-        @keyframes modal-in-mobile {\n-            from {\n-                transform: translateY(200px);\n-                opacity: 0;\n-            }\n-            30% {\n-                opacity: 1;\n-            }\n-            50% {\n-                transform: translateY(-5px);\n-            }\n-            100% {\n-                transform: translateY(0px);\n-            }\n-        }\n     }\n </style>"
            },
            {
                "sha": "fe5f26a0c85ab311faf2a0a694dfb39d2714bacc",
                "filename": "web/src/components/save/buttons/DownloadButton.svelte",
                "status": "modified",
                "additions": 58,
                "deletions": 35,
                "changes": 93,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fsave%2Fbuttons%2FDownloadButton.svelte",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Fcomponents%2Fsave%2Fbuttons%2FDownloadButton.svelte",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Fcomponents%2Fsave%2Fbuttons%2FDownloadButton.svelte?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -2,49 +2,50 @@\n     import \"@fontsource-variable/noto-sans-mono\";\n \n     import API from \"$lib/api\";\n-    import { device } from \"$lib/device\";\n-\n     import { t } from \"$lib/i18n/translations\";\n-\n     import { createDialog } from \"$lib/dialogs\";\n+    import { downloadFile } from \"$lib/download\";\n+\n     import type { DialogInfo } from \"$lib/types/dialog\";\n \n     export let url: string;\n     export let isDisabled = false;\n \n     $: buttonText = \">>\";\n-    $: buttonAltText = $t('a11y.save.download');\n+    $: buttonAltText = $t(\"a11y.save.download\");\n     $: isDisabled = false;\n \n     let defaultErrorPopup: DialogInfo = {\n         id: \"save-error\",\n         type: \"small\",\n         meowbalt: \"error\",\n-        buttons: [{\n-            text: $t(\"dialog.button.gotit\"),\n-            main: true,\n-            action: () => {},\n-        }]\n-    }\n+        buttons: [\n+            {\n+                text: $t(\"dialog.button.gotit\"),\n+                main: true,\n+                action: () => {},\n+            },\n+        ],\n+    };\n \n     const changeDownloadButton = (state: string) => {\n         isDisabled = true;\n         switch (state) {\n             case \"think\":\n                 buttonText = \"...\";\n-                buttonAltText = $t('a11y.save.downloadThink');\n+                buttonAltText = $t(\"a11y.save.downloadThink\");\n                 break;\n             case \"check\":\n                 buttonText = \"..?\";\n-                buttonAltText = $t('a11y.save.downloadCheck');\n+                buttonAltText = $t(\"a11y.save.downloadCheck\");\n                 break;\n             case \"done\":\n                 buttonText = \">>>\";\n-                buttonAltText = $t('a11y.save.downloadDone');\n+                buttonAltText = $t(\"a11y.save.downloadDone\");\n                 break;\n             case \"error\":\n                 buttonText = \"!!\";\n-                buttonAltText = $t('a11y.save.downloadError');\n+                buttonAltText = $t(\"a11y.save.downloadError\");\n                 break;\n         }\n     };\n@@ -53,18 +54,10 @@\n         setTimeout(() => {\n             buttonText = \">>\";\n             isDisabled = false;\n-            buttonAltText = $t('a11y.save.download');\n+            buttonAltText = $t(\"a11y.save.download\");\n         }, 2500);\n     };\n \n-    const downloadFile = (url: string) => {\n-        if (device.is.iOS) {\n-            return navigator?.share({ url }).catch(() => {});\n-        } else {\n-            return window.open(url, \"_blank\");\n-        }\n-    };\n-\n     // alerts are temporary, we don't have an error popup yet >_<\n     export const download = async (link: string) => {\n         changeDownloadButton(\"think\");\n@@ -76,19 +69,19 @@\n             restoreDownloadButton();\n \n             return createDialog({\n-                ...defaultErrorPopup as DialogInfo,\n-                bodyText: \"couldn't access the api\"\n-            })\n+                ...(defaultErrorPopup as DialogInfo),\n+                bodyText: \"couldn't access the api\",\n+            });\n         }\n \n         if (response.status === \"error\" || response.status === \"rate-limit\") {\n             changeDownloadButton(\"error\");\n             restoreDownloadButton();\n \n             return createDialog({\n-                ...defaultErrorPopup as DialogInfo,\n-                bodyText: response.text\n-            })\n+                ...(defaultErrorPopup as DialogInfo),\n+                bodyText: response.text,\n+            });\n         }\n \n         if (response.status === \"redirect\") {\n@@ -113,19 +106,49 @@\n                 restoreDownloadButton();\n \n                 return createDialog({\n-                    ...defaultErrorPopup as DialogInfo,\n-                    bodyText: \"couldn't probe the stream\"\n-                })\n+                    ...(defaultErrorPopup as DialogInfo),\n+                    bodyText: \"couldn't probe the stream\",\n+                });\n             }\n         }\n \n+        if (response.status === \"picker\") {\n+            restoreDownloadButton();\n+\n+            let pickerButtons = [\n+                {\n+                    text: $t(\"dialog.button.done\"),\n+                    main: true,\n+                    action: () => {},\n+                },\n+            ];\n+\n+            if (response.audio) {\n+                const pickerAudio = response.audio;\n+                pickerButtons.unshift({\n+                    text: $t(\"dialog.button.downloadAudio\"),\n+                    main: false,\n+                    action: () => {\n+                        downloadFile(pickerAudio);\n+                    },\n+                });\n+            }\n+\n+            return createDialog({\n+                id: \"download-picker\",\n+                type: \"picker\",\n+                items: response.picker,\n+                buttons: pickerButtons,\n+            });\n+        }\n+\n         changeDownloadButton(\"error\");\n         restoreDownloadButton();\n \n         return createDialog({\n-            ...defaultErrorPopup as DialogInfo,\n-            bodyText: \"unknown/unsupported status\"\n-        })\n+            ...(defaultErrorPopup as DialogInfo),\n+            bodyText: \"unknown/unsupported status\",\n+        });\n     };\n </script>\n "
            },
            {
                "sha": "e08320efc4d255be152a533a6c94167dc0048fb5",
                "filename": "web/src/lib/download.ts",
                "status": "added",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Flib%2Fdownload.ts",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Flib%2Fdownload.ts",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Flib%2Fdownload.ts?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -0,0 +1,9 @@\n+import { device } from \"$lib/device\";\n+\n+export const downloadFile = (url: string) => {\n+    if (device.is.iOS) {\n+        return navigator?.share({ url }).catch(() => {});\n+    } else {\n+        return window.open(url, \"_blank\");\n+    }\n+};"
            },
            {
                "sha": "f6d2439d609456a66d97a3d8a9098c055ab5bd61",
                "filename": "web/src/lib/types/dialog.ts",
                "status": "modified",
                "additions": 9,
                "deletions": 2,
                "changes": 11,
                "blob_url": "https://github.com/imputnet/cobalt/blob/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Flib%2Ftypes%2Fdialog.ts",
                "raw_url": "https://github.com/imputnet/cobalt/raw/66bac03e3078e4e781d2d3903c05ad66a883a354/web%2Fsrc%2Flib%2Ftypes%2Fdialog.ts",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Flib%2Ftypes%2Fdialog.ts?ref=66bac03e3078e4e781d2d3903c05ad66a883a354",
                "patch": "@@ -9,13 +9,20 @@ export type DialogButton = {\n \n export type SmallDialogIcons = \"warn-red\";\n \n+export type DialogPickerItem = {\n+    type?: 'photo' | 'video',\n+    url: string,\n+    thumb?: string,\n+}\n+\n export type DialogInfo = {\n     id: string,\n-    type: \"small\",\n+    type: \"small\" | \"picker\",\n     meowbalt?: MeowbaltEmotions,\n     icon?: SmallDialogIcons,\n     title?: string,\n     bodyText?: string,\n     bodySubText?: string,\n-    buttons: DialogButton[],\n+    buttons?: DialogButton[],\n+    items?: DialogPickerItem[],\n }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/imputnet/cobalt/commits/97977efabd92375f270d1818f38de3b0682c2f19",
        "url": "https://api.github.com/repos/imputnet/cobalt/commits/97977efabd92375f270d1818f38de3b0682c2f19",
        "html_url": "https://github.com/imputnet/cobalt/commit/97977efabd92375f270d1818f38de3b0682c2f19",
        "message": "web: generate `_headers` & add `Content-Security-Policy` header",
        "files": [
            {
                "sha": "2cbf4e88ab407e9fdda7fd252bad459423589734",
                "filename": "web/src/routes/_headers/+server.ts",
                "status": "added",
                "additions": 28,
                "deletions": 0,
                "changes": 28,
                "blob_url": "https://github.com/imputnet/cobalt/blob/97977efabd92375f270d1818f38de3b0682c2f19/web%2Fsrc%2Froutes%2F_headers%2F%2Bserver.ts",
                "raw_url": "https://github.com/imputnet/cobalt/raw/97977efabd92375f270d1818f38de3b0682c2f19/web%2Fsrc%2Froutes%2F_headers%2F%2Bserver.ts",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fsrc%2Froutes%2F_headers%2F%2Bserver.ts?ref=97977efabd92375f270d1818f38de3b0682c2f19",
                "patch": "@@ -0,0 +1,28 @@\n+export async function GET() {\n+    const CSP = [\n+        \"default-src 'none'\",\n+        \"script-src 'self' challenges.cloudflare.com\",\n+        \"frame-src challenges.cloudflare.com\",\n+    ]\n+\n+    const _headers = {\n+        \"/*\": {\n+            \"Cross-Origin-Opener-Policy\": \"same-origin\",\n+            \"Cross-Origin-Embedder-Policy\": \"require-corp\",\n+            \"Content-Security-Policy\": CSP.join(\"; \"),\n+        }\n+    }\n+\n+    return new Response(\n+        Object.entries(_headers).map(\n+            ([path, headers]) => [\n+                path,\n+                Object.entries(headers).map(\n+                    ([key, value]) => `    ${key}: ${value}`\n+                )\n+            ].flat().join(\"\\n\")\n+        ).join(\"\\n\\n\")\n+    );\n+}\n+\n+export const prerender = true;"
            },
            {
                "sha": "cabbdca5434bba3fbef6361816f878a8cd3b849f",
                "filename": "web/static/_headers",
                "status": "removed",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/imputnet/cobalt/blob/d1686be58339d92629c3ccd7b952180fc251595e/web%2Fstatic%2F_headers",
                "raw_url": "https://github.com/imputnet/cobalt/raw/d1686be58339d92629c3ccd7b952180fc251595e/web%2Fstatic%2F_headers",
                "contents_url": "https://api.github.com/repos/imputnet/cobalt/contents/web%2Fstatic%2F_headers?ref=d1686be58339d92629c3ccd7b952180fc251595e",
                "patch": "@@ -1,3 +0,0 @@\n-/*\n-    Cross-Origin-Opener-Policy: same-origin\n-    Cross-Origin-Embedder-Policy: require-corp"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/reactiveui/refit/commits/483b1d8df18098f137ca0eca056b7e9ec19f70dd",
        "url": "https://api.github.com/repos/reactiveui/refit/commits/483b1d8df18098f137ca0eca056b7e9ec19f70dd",
        "html_url": "https://github.com/reactiveui/refit/commit/483b1d8df18098f137ca0eca056b7e9ec19f70dd",
        "message": "Fix for CRLF injection vulnerability (#1834)\n\nCRLF injection in Refit's [Header], [HeaderCollection] and [Authorize] attributes",
        "files": [
            {
                "sha": "98f02379e983e4f1c4df5c75dc9d8b3d8612230c",
                "filename": "Refit.Tests/AuthenticatedClientHandlerTests.cs",
                "status": "modified",
                "additions": 35,
                "deletions": 0,
                "changes": 35,
                "blob_url": "https://github.com/reactiveui/refit/blob/483b1d8df18098f137ca0eca056b7e9ec19f70dd/Refit.Tests%2FAuthenticatedClientHandlerTests.cs",
                "raw_url": "https://github.com/reactiveui/refit/raw/483b1d8df18098f137ca0eca056b7e9ec19f70dd/Refit.Tests%2FAuthenticatedClientHandlerTests.cs",
                "contents_url": "https://api.github.com/repos/reactiveui/refit/contents/Refit.Tests%2FAuthenticatedClientHandlerTests.cs?ref=483b1d8df18098f137ca0eca056b7e9ec19f70dd",
                "patch": "@@ -4,8 +4,11 @@\n using System.Net.Http;\n using System.Text;\n using System.Threading.Tasks;\n+\n using Refit; // for the code gen\n+\n using RichardSzalay.MockHttp;\n+\n using Xunit;\n \n namespace Refit.Tests;\n@@ -49,6 +52,12 @@ public interface IInheritedAuthenticatedServiceWithHeaders : IAuthenticatedServi\n         Task<string> GetInheritedThing();\n     }\n \n+    public interface IInheritedAuthenticatedServiceWithHeadersCRLF : IAuthenticatedServiceWithHeaders\n+    {\n+        [Get(\"/get-inherited-thing\\r\\n\\r\\nGET /smuggled\")]\n+        Task<string> GetInheritedThing();\n+    }\n+\n     [Headers(\"Authorization: Bearer\")]\n     public interface IAuthenticatedServiceWithHeaders\n     {\n@@ -347,4 +356,30 @@ public async void AuthentictedMethodFromInheritedClassWithHeadersAttributeUsesAu\n \n         Assert.Equal(\"Ok\", result);\n     }\n+\n+    [Fact]\n+    public async void AuthentictedMethodFromInheritedClassWithHeadersAttributeUsesAuth_WithCRLFCheck()\n+    {\n+        var handler = new MockHttpMessageHandler();\n+        var settings = new RefitSettings()\n+        {\n+            AuthorizationHeaderValueGetter = (_, __) => Task.FromResult(\"tokenValue\"),\n+            HttpMessageHandlerFactory = () => handler,\n+        };\n+\n+        handler\n+            .Expect(HttpMethod.Get, \"http://api/get-inherited-thing\")\n+            .WithHeaders(\"Authorization\", \"Bearer tokenValue\")\n+            .Respond(\"text/plain\", \"Ok\");\n+\n+        await Assert.ThrowsAsync<ArgumentException>(async () =>\n+        {\n+            var fixture = RestService.For<IInheritedAuthenticatedServiceWithHeadersCRLF>(\n+                    \"http://api\",\n+                    settings\n+                );\n+\n+            var result = await fixture.GetInheritedThing();\n+        });\n+    }\n }"
            },
            {
                "sha": "2882d3ed6b1ab35d3f0fb874ad19f23fdb320108",
                "filename": "Refit/RequestBuilderImplementation.cs",
                "status": "modified",
                "additions": 13,
                "deletions": 1,
                "changes": 14,
                "blob_url": "https://github.com/reactiveui/refit/blob/483b1d8df18098f137ca0eca056b7e9ec19f70dd/Refit%2FRequestBuilderImplementation.cs",
                "raw_url": "https://github.com/reactiveui/refit/raw/483b1d8df18098f137ca0eca056b7e9ec19f70dd/Refit%2FRequestBuilderImplementation.cs",
                "contents_url": "https://api.github.com/repos/reactiveui/refit/contents/Refit%2FRequestBuilderImplementation.cs?ref=483b1d8df18098f137ca0eca056b7e9ec19f70dd",
                "patch": "@@ -977,7 +977,7 @@ static void AddHeadersToRequest(Dictionary<string, string?>? headersToAdd, HttpR\n             // sure we have an HttpContent object to add them to,\n             // provided the HttpClient will allow it for the method\n             if (ret.Content == null && !IsBodyless(ret.Method))\n-                ret.Content = new ByteArrayContent(Array.Empty<byte>());\n+                ret.Content = new ByteArrayContent([]);\n \n             foreach (var header in headersToAdd)\n             {\n@@ -1335,6 +1335,10 @@ static void SetHeader(HttpRequestMessage request, string name, string? value)\n             if (value == null)\n                 return;\n \n+            // CRLF injection protection\n+            name = EnsureSafe(name);\n+            value = EnsureSafe(value);\n+\n             var added = request.Headers.TryAddWithoutValidation(name, value);\n \n             // Don't even bother trying to add the header as a content header\n@@ -1345,6 +1349,14 @@ static void SetHeader(HttpRequestMessage request, string name, string? value)\n             }\n         }\n \n+        static string EnsureSafe(string value)\n+        {\n+            // Remove CR and LF characters\n+#pragma warning disable CA1307 // Specify StringComparison for clarity\n+            return value.Replace(\"\\r\", string.Empty).Replace(\"\\n\", string.Empty);\n+#pragma warning restore CA1307 // Specify StringComparison for clarity\n+        }\n+\n         static bool IsBodyless(HttpMethod method) => method == HttpMethod.Get || method == HttpMethod.Head;\n     }\n }"
            },
            {
                "sha": "901dfc338fc9c5a91289c952d6698db7fdd06d5e",
                "filename": "Refit/RestMethodInfo.cs",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/reactiveui/refit/blob/483b1d8df18098f137ca0eca056b7e9ec19f70dd/Refit%2FRestMethodInfo.cs",
                "raw_url": "https://github.com/reactiveui/refit/raw/483b1d8df18098f137ca0eca056b7e9ec19f70dd/Refit%2FRestMethodInfo.cs",
                "contents_url": "https://api.github.com/repos/reactiveui/refit/contents/Refit%2FRestMethodInfo.cs?ref=483b1d8df18098f137ca0eca056b7e9ec19f70dd",
                "patch": "@@ -259,6 +259,12 @@ static void VerifyUrlPathIsSane(string relativePath)\n                 throw new ArgumentException(\n                     $\"URL path {relativePath} must start with '/' and be of the form '/foo/bar/baz'\"\n                 );\n+\n+            // CRLF injection protection\n+            if (relativePath.Contains(\"\\r\") || relativePath.Contains(\"\\n\"))\n+                throw new ArgumentException(\n+                    $\"URL path {relativePath} must not contain CR or LF characters\"\n+                );\n         }\n \n         static Dictionary<int, RestMethodParameterInfo> BuildParameterMap("
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/bearcove/loona/commits/9a4028ec6484f50a320281271a41a5040ddb1ba8",
        "url": "https://api.github.com/repos/bearcove/loona/commits/9a4028ec6484f50a320281271a41a5040ddb1ba8",
        "html_url": "https://github.com/bearcove/loona/commit/9a4028ec6484f50a320281271a41a5040ddb1ba8",
        "message": "Merge commit from fork\n\nDo not panic when decode_integer fails",
        "files": [
            {
                "sha": "213d54b0a60ef3d01c3217408bc2f037e9a382e4",
                "filename": "crates/loona-hpack/src/decoder.rs",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/bearcove/loona/blob/9a4028ec6484f50a320281271a41a5040ddb1ba8/crates%2Floona-hpack%2Fsrc%2Fdecoder.rs",
                "raw_url": "https://github.com/bearcove/loona/raw/9a4028ec6484f50a320281271a41a5040ddb1ba8/crates%2Floona-hpack%2Fsrc%2Fdecoder.rs",
                "contents_url": "https://api.github.com/repos/bearcove/loona/contents/crates%2Floona-hpack%2Fsrc%2Fdecoder.rs?ref=9a4028ec6484f50a320281271a41a5040ddb1ba8",
                "patch": "@@ -535,7 +535,7 @@ impl<'a> Decoder<'a> {\n     ///\n     /// Returns the number of octets consumed from the given buffer.\n     fn update_max_dynamic_size(&mut self, buf: &[u8]) -> Result<usize, DecoderError> {\n-        let (new_size, consumed) = decode_integer(buf, 5).ok().unwrap();\n+        let (new_size, consumed) = decode_integer(buf, 5)?;\n         if let Some(max_size) = self.max_allowed_table_size {\n             if new_size > max_size {\n                 return Err(DecoderError::InvalidMaxDynamicSize);"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/golang-jwt/jwt/commits/7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c",
        "url": "https://api.github.com/repos/golang-jwt/jwt/commits/7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c",
        "html_url": "https://github.com/golang-jwt/jwt/commit/7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c",
        "message": "Merge commit from fork\n\n* Initial draft of adding text to ParseWithClaims\n\n* Adjusted example and referring to the example in Parse functions\n\n* Backporting logic from v5\n\n* Added a test",
        "files": [
            {
                "sha": "3e3bb382530609b2b408ac486a4247a913ebb3b9",
                "filename": "example_test.go",
                "status": "modified",
                "additions": 5,
                "deletions": 1,
                "changes": 6,
                "blob_url": "https://github.com/golang-jwt/jwt/blob/7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c/example_test.go",
                "raw_url": "https://github.com/golang-jwt/jwt/raw/7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c/example_test.go",
                "contents_url": "https://api.github.com/repos/golang-jwt/jwt/contents/example_test.go?ref=7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c",
                "patch": "@@ -93,7 +93,7 @@ func ExampleParseWithClaims_customClaimsType() {\n \t// Output: bar test\n }\n \n-// An example of parsing the error types using bitfield checks\n+// An example of parsing the error types using [errors.Is].\n func ExampleParse_errorChecking() {\n \t// Token from another example.  This token is expired\n \tvar tokenString = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmb28iOiJiYXIiLCJleHAiOjE1MDAwLCJpc3MiOiJ0ZXN0In0.HE7fK0xOQwFEr4WDgRWj4teRPZ6i3GLwD5YCm6Pwu_c\"\n@@ -106,6 +106,10 @@ func ExampleParse_errorChecking() {\n \t\tfmt.Println(\"You look nice today\")\n \t} else if errors.Is(err, jwt.ErrTokenMalformed) {\n \t\tfmt.Println(\"That's not even a token\")\n+\t} else if errors.Is(err, jwt.ErrTokenUnverifiable) {\n+\t\tfmt.Println(\"We could not verify this token\")\n+\t} else if errors.Is(err, jwt.ErrTokenSignatureInvalid) {\n+\t\tfmt.Println(\"This token has an invalid signature\")\n \t} else if errors.Is(err, jwt.ErrTokenExpired) || errors.Is(err, jwt.ErrTokenNotValidYet) {\n \t\t// Token is either expired or not active yet\n \t\tfmt.Println(\"Timing is everything\")"
            },
            {
                "sha": "9dd36e5a5acd4c5606c061db0aa08583eed7baf6",
                "filename": "parser.go",
                "status": "modified",
                "additions": 20,
                "deletions": 21,
                "changes": 41,
                "blob_url": "https://github.com/golang-jwt/jwt/blob/7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c/parser.go",
                "raw_url": "https://github.com/golang-jwt/jwt/raw/7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c/parser.go",
                "contents_url": "https://api.github.com/repos/golang-jwt/jwt/contents/parser.go?ref=7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c",
                "patch": "@@ -36,19 +36,21 @@ func NewParser(options ...ParserOption) *Parser {\n \treturn p\n }\n \n-// Parse parses, validates, verifies the signature and returns the parsed token.\n-// keyFunc will receive the parsed token and should return the key for validating.\n+// Parse parses, validates, verifies the signature and returns the parsed token. keyFunc will\n+// receive the parsed token and should return the key for validating.\n func (p *Parser) Parse(tokenString string, keyFunc Keyfunc) (*Token, error) {\n \treturn p.ParseWithClaims(tokenString, MapClaims{}, keyFunc)\n }\n \n-// ParseWithClaims parses, validates, and verifies like Parse, but supplies a default object implementing the Claims\n-// interface. This provides default values which can be overridden and allows a caller to use their own type, rather\n-// than the default MapClaims implementation of Claims.\n+// ParseWithClaims parses, validates, and verifies like Parse, but supplies a default object\n+// implementing the Claims interface. This provides default values which can be overridden and\n+// allows a caller to use their own type, rather than the default MapClaims implementation of\n+// Claims.\n //\n-// Note: If you provide a custom claim implementation that embeds one of the standard claims (such as RegisteredClaims),\n-// make sure that a) you either embed a non-pointer version of the claims or b) if you are using a pointer, allocate the\n-// proper memory for it before passing in the overall claims, otherwise you might run into a panic.\n+// Note: If you provide a custom claim implementation that embeds one of the standard claims (such\n+// as RegisteredClaims), make sure that a) you either embed a non-pointer version of the claims or\n+// b) if you are using a pointer, allocate the proper memory for it before passing in the overall\n+// claims, otherwise you might run into a panic.\n func (p *Parser) ParseWithClaims(tokenString string, claims Claims, keyFunc Keyfunc) (*Token, error) {\n \ttoken, parts, err := p.ParseUnverified(tokenString, claims)\n \tif err != nil {\n@@ -85,35 +87,32 @@ func (p *Parser) ParseWithClaims(tokenString string, claims Claims, keyFunc Keyf\n \t\treturn token, &ValidationError{Inner: err, Errors: ValidationErrorUnverifiable}\n \t}\n \n+\t// Perform validation\n+\ttoken.Signature = parts[2]\n+\tif err := token.Method.Verify(strings.Join(parts[0:2], \".\"), token.Signature, key); err != nil {\n+\t\treturn token, &ValidationError{Inner: err, Errors: ValidationErrorSignatureInvalid}\n+\t}\n+\n \tvErr := &ValidationError{}\n \n \t// Validate Claims\n \tif !p.SkipClaimsValidation {\n \t\tif err := token.Claims.Valid(); err != nil {\n-\n \t\t\t// If the Claims Valid returned an error, check if it is a validation error,\n \t\t\t// If it was another error type, create a ValidationError with a generic ClaimsInvalid flag set\n \t\t\tif e, ok := err.(*ValidationError); !ok {\n \t\t\t\tvErr = &ValidationError{Inner: err, Errors: ValidationErrorClaimsInvalid}\n \t\t\t} else {\n \t\t\t\tvErr = e\n \t\t\t}\n+\t\t\treturn token, vErr\n \t\t}\n \t}\n \n-\t// Perform validation\n-\ttoken.Signature = parts[2]\n-\tif err = token.Method.Verify(strings.Join(parts[0:2], \".\"), token.Signature, key); err != nil {\n-\t\tvErr.Inner = err\n-\t\tvErr.Errors |= ValidationErrorSignatureInvalid\n-\t}\n-\n-\tif vErr.valid() {\n-\t\ttoken.Valid = true\n-\t\treturn token, nil\n-\t}\n+\t// No errors so far, token is valid.\n+\ttoken.Valid = true\n \n-\treturn token, vErr\n+\treturn token, nil\n }\n \n // ParseUnverified parses the token but doesn't validate the signature."
            },
            {
                "sha": "54cbfec5edf2f02c3154fd8a2f22827dadc51641",
                "filename": "parser_test.go",
                "status": "modified",
                "additions": 11,
                "deletions": 0,
                "changes": 11,
                "blob_url": "https://github.com/golang-jwt/jwt/blob/7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c/parser_test.go",
                "raw_url": "https://github.com/golang-jwt/jwt/raw/7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c/parser_test.go",
                "contents_url": "https://api.github.com/repos/golang-jwt/jwt/contents/parser_test.go?ref=7b1c1c00a171c6c79bbdb40e4ce7d197060c1c2c",
                "patch": "@@ -111,6 +111,17 @@ var jwtTestData = []struct {\n \t\tnil,\n \t\tjwt.SigningMethodRS256,\n \t},\n+\t{\n+\t\t\"basic invalid and expired\",\n+\t\t\"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJmb28iOiJiYXIiLCJleHAiOjEyMzR9.IbFvatLIJ2Z7B_MAaeIaRZsRSQF1CDzmAE0osHII3WfRTbPavonrDXz-p2Ap_oh9LT2lyohL_jCLoVcpTyu7K3Rt-hdgxZ1_r1StwM1we0SqW2BFFeXCzyS9SLf2YTaVR35lVvfwwlCpPBgOw1SBbczm9m6yPgA9Afsvw_lG_GU2civvG0UzHXxbzWWvJoflGokJDuoHQiku2bfxReyNsoUGcLjx5tfkY7cPihM3CffPpRFYCVjv_abHYelZWpVjdGULQyJDInGYqO8oANqNTtjui7aqxBpcFCUBwVVgktM4Q6Dvj-o5LrdPyJSEl0b_R2JstFE5CbEZGN5anN1yHa\",\n+\t\tdefaultKeyFunc,\n+\t\tjwt.MapClaims{\"foo\": \"bar\", \"exp\": 1234.0},\n+\t\tfalse,\n+\t\tjwt.ValidationErrorSignatureInvalid,\n+\t\t[]error{jwt.ErrTokenSignatureInvalid, rsa.ErrVerification},\n+\t\tnil,\n+\t\tjwt.SigningMethodRS256,\n+\t},\n \t{\n \t\t\"basic nokeyfunc\",\n \t\t\"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJmb28iOiJiYXIifQ.FhkiHkoESI_cG3NPigFrxEk9Z60_oXrOT2vGm9Pn6RDgYNovYORQmmA0zs1AoAOf09ly2Nx2YAg6ABqAYga1AcMFkJljwxTT5fYphTuqpWdy4BELeSYJx5Ty2gmr8e7RonuUztrdD5WfPqLKMm1Ozp_T6zALpRmwTIW0QPnaBXaQD90FplAg46Iy1UlDKr-Eupy0i5SLch5Q-p2ZpaL_5fnTIUDlxC3pWhJTyx_71qDI-mAA_5lE_VdroOeflG56sSmDxopPEG3bFlSu1eowyBfxtu0_CuVd-M42RU75Zc4Gsj6uV77MBtbMrf4_7M_NUTSgoIF3fRqxrj0NzihIBg\","
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/google/safearchive/commits/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
        "url": "https://api.github.com/repos/google/safearchive/commits/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
        "html_url": "https://github.com/google/safearchive/commit/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
        "message": "Prevent path traversals via short filenames on Windows.\n\nPiperOrigin-RevId: 686004821",
        "files": [
            {
                "sha": "c8ce9dbbbbeeaa6e1e87222df125566a2d0501b7",
                "filename": "sanitizer/BUILD.bazel",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/sanitizer%2FBUILD.bazel",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/sanitizer%2FBUILD.bazel",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/sanitizer%2FBUILD.bazel?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
                "patch": "@@ -26,6 +26,7 @@ go_test(\n     size = \"small\",\n     srcs = [\n         \"sanitizer_nix_test.go\",\n+        \"sanitizer_test.go\",\n         \"sanitizer_win_test.go\",\n     ],\n     embed = [\":sanitizer\"],"
            },
            {
                "sha": "9bfedeeabef46ee8b7223d7544d6c551eef50c24",
                "filename": "sanitizer/sanitizer.go",
                "status": "modified",
                "additions": 23,
                "deletions": 0,
                "changes": 23,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/sanitizer%2Fsanitizer.go",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/sanitizer%2Fsanitizer.go",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/sanitizer%2Fsanitizer.go?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
                "patch": "@@ -18,13 +18,19 @@ package sanitizer\n \n import (\n \t\"os\"\n+\t\"regexp\"\n+\t\"strings\"\n )\n \n const (\n \twinPathSeparator = `\\`\n \tnixPathSeparator = `/`\n )\n \n+var (\n+\twinShortFilenameRegex = regexp.MustCompile(`~\\d+\\.?`)\n+)\n+\n // SanitizePath sanitizes the supplied path by purely lexical processing.\n // The return value is safe to be joined together with a base directory (if the basedir is empty\n // and no symlinks are present there).\n@@ -43,3 +49,20 @@ func SanitizePath(in string) string {\n \n \treturn sanitized\n }\n+\n+// HasWindowsShortFilenames reports if any path component look like a Windows short filename.\n+// Short filenames on Windows may look like this:\n+// 1(3)~1.PNG     1 (3) (1).png\n+// DOWNLO~1       Downloads\n+// FOOOOO~1.JPG   fooooooooo.png.gif.jpg\n+func HasWindowsShortFilenames(in string) bool {\n+\tin = strings.ReplaceAll(in, \"\\\\\", \"/\")\n+\tparts := strings.Split(in, \"/\")\n+\tfor _, part := range parts {\n+\t\tmatched := winShortFilenameRegex.MatchString(part)\n+\t\tif matched {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\treturn false\n+}"
            },
            {
                "sha": "115f2e2f9990231a9a51ebbd740c9ef2470f938b",
                "filename": "sanitizer/sanitizer_test.go",
                "status": "added",
                "additions": 53,
                "deletions": 0,
                "changes": 53,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/sanitizer%2Fsanitizer_test.go",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/sanitizer%2Fsanitizer_test.go",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/sanitizer%2Fsanitizer_test.go?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
                "patch": "@@ -0,0 +1,53 @@\n+// Copyright 2024 Google LLC.\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//     http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package sanitizer\n+\n+import (\n+\t\"strings\"\n+\t\"testing\"\n+)\n+\n+func TestHasWindowsShortFilenames(t *testing.T) {\n+\ttests := []struct {\n+\t\tin   string\n+\t\twant bool\n+\t}{\n+\t\t{in: \"ANDROI~2\", want: true},\n+\t\t{in: \"foo/ANDROI~2\", want: true},\n+\t\t{in: \"ANDROI~2/bar\", want: true},\n+\t\t{in: \"foo/ANDROI~2/bar\", want: true},\n+\t\t// Same with different case\n+\t\t{in: \"Androi~2\", want: true},\n+\t\t{in: \"foo/Androi~2\", want: true},\n+\t\t{in: \"Androi~2/bar\", want: true},\n+\t\t{in: \"foo/Androi~2/bar\", want: true},\n+\t\t// File extension\n+\t\t{in: \"FOOOOO~1.JPG \", want: true},\n+\t\t{in: \"foo/FOOOOO~1.JPG\", want: true},\n+\t\t{in: \"FOOOOO~1.JPG/bar\", want: true},\n+\t\t{in: \"foo/FOOOOO~1.JPG/bar\", want: true},\n+\t\t// Not a short filename\n+\t\t{in: \"3D Objects\", want: false},\n+\t\t{in: \"Some~Stuff\", want: false},\n+\t}\n+\tfor _, tc := range tests {\n+\t\tfor _, a := range []string{tc.in, strings.ReplaceAll(tc.in, \"\\\\\", \"/\")} {\n+\t\t\tgot := HasWindowsShortFilenames(a)\n+\t\t\tif got != tc.want {\n+\t\t\t\tt.Errorf(\"HasWindowsShortFilenames(%q) = %v, want %v\", a, got, tc.want)\n+\t\t\t}\n+\t\t}\n+\t}\n+}"
            },
            {
                "sha": "087a02c96a3a8e3d6aa20794c19ff18d1ac903d3",
                "filename": "tar/tar.go",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/tar%2Ftar.go",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/tar%2Ftar.go",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/tar%2Ftar.go?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
                "patch": "@@ -186,11 +186,16 @@ const (\n \t// By default, this is activated only on MacOS and Windows builds. If you are extracting to a\n \t// case insensitive filesystem on a Unix platform, you should activate this feature explicitly.\n \tPreventCaseInsensitiveSymlinkTraversal SecurityMode = 64\n+\t// SkipWindowsShortFilenames drops archive entries that have a path component that look like a\n+\t// Windows short filename (e.g. GIT~1).\n+\t// By default, this is activated only on Windows builds. If you are extracting to a Windows\n+\t// filesystem on a non-Windows platform, you should activate this feature explicitly.\n+\tSkipWindowsShortFilenames SecurityMode = 128\n )\n \n // MaximumSecurityMode enables all features for maximum security.\n // Recommended for integrations that need file contents only (and nothing unix specific).\n-const MaximumSecurityMode = SkipSpecialFiles | SanitizeFileMode | SanitizeFilenames | PreventSymlinkTraversal | DropXattrs | PreventCaseInsensitiveSymlinkTraversal\n+const MaximumSecurityMode = SkipSpecialFiles | SanitizeFileMode | SanitizeFilenames | PreventSymlinkTraversal | DropXattrs | PreventCaseInsensitiveSymlinkTraversal | SkipWindowsShortFilenames\n \n var (\n \t// ErrHeader invalid tar header\n@@ -297,6 +302,10 @@ func (tr *Reader) Next() (*tar.Header, error) {\n \t\t\th.Name = sanitizer.SanitizePath(h.Name)\n \t\t}\n \n+\t\tif tr.securityMode&SkipWindowsShortFilenames != 0 && sanitizer.HasWindowsShortFilenames(h.Name) {\n+\t\t\tcontinue\n+\t\t}\n+\n \t\tif tr.securityMode&PreventSymlinkTraversal != 0 {\n \t\t\thName := sanitizer.SanitizePath(h.Name)\n \t\t\thName = strings.TrimSuffix(hName, \"/\")"
            },
            {
                "sha": "459f842e8545ddb3dee498d556d5f02e58f3eb51",
                "filename": "tar/tar_test.go",
                "status": "modified",
                "additions": 42,
                "deletions": 0,
                "changes": 42,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/tar%2Ftar_test.go",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/tar%2Ftar_test.go",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/tar%2Ftar_test.go?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
                "patch": "@@ -93,6 +93,23 @@ var (\n \t*/\n \t//go:embed case-insensitive.tar\n \teTraverseViaCaseInsensitiveLinksTar []byte\n+\n+\t/*\n+\t\t-rw-r----- imrer/primarygroup 5 2024-10-11 14:27 3D Objects\n+\t\t-rw-r----- imrer/primarygroup 5 2024-10-11 14:27 Androi~2\n+\t\t-rw-r----- imrer/primarygroup 5 2024-10-11 14:27 ANDROI~2\n+\t\tdrwxr-x--- imrer/primarygroup 0 2024-10-11 14:27 foo/\n+\t\tdrwxr-x--- imrer/primarygroup 0 2024-10-11 14:27 foo/ANDROI~2/\n+\t\t-rw-r----- imrer/primarygroup 5 2024-10-11 14:27 foo/ANDROI~2/bar\n+\t\tdrwxr-x--- imrer/primarygroup 0 2024-10-11 14:27 foo/FOOOOO~1.JPG/\n+\t\t-rw-r----- imrer/primarygroup 5 2024-10-11 14:27 foo/FOOOOO~1.JPG/bar\n+\t\tdrwxr-x--- imrer/primarygroup 0 2024-10-11 14:27 foo/Androi~2/\n+\t\t-rw-r----- imrer/primarygroup 5 2024-10-11 14:27 foo/Androi~2/bar\n+\t\t-rw-r----- imrer/primarygroup 5 2024-10-11 14:27 FOOOOO~1.JPG\n+\t\t-rw-r----- imrer/primarygroup 5 2024-10-11 14:27 Some~Stuff\n+\t*/\n+\t//go:embed winshort.tar\n+\teWinShortTar []byte\n )\n \n func isSlashRune(r rune) bool { return r == '/' || r == '\\\\' }\n@@ -493,3 +510,28 @@ func TestSafetarLinksCaseInsensitive(t *testing.T) {\n \t\tt.Fatal(err)\n \t}\n }\n+\n+func TestWindowsShortFilenames(t *testing.T) {\n+\tbuf := bytes.NewBuffer(eWinShortTar[:])\n+\tt.Logf(\"size of archive: %d\", len(buf.Bytes()))\n+\ttr := NewReader(buf)\n+\ttr.SetSecurityMode(tr.GetSecurityMode() | SkipWindowsShortFilenames)\n+\n+\tfor i, want := range []string{\"3D Objects\", \"foo/\", \"Some~Stuff\"} {\n+\t\thdr, err := tr.Next()\n+\t\tif err != nil {\n+\t\t\tt.Errorf(\"No errors were expected at entry %d. Next() = %+v, want nil\", i, err)\n+\t\t}\n+\t\tif hdr.Name != want {\n+\t\t\tt.Errorf(\"Unexpected entry %d. Next().Name = %v, want %v\", i, hdr.Name, want)\n+\t\t}\n+\t}\n+\n+\thdr, err := tr.Next()\n+\tif hdr != nil {\n+\t\tt.Errorf(\"No more tar entries were expected. Next() = %+v, want nil\", hdr)\n+\t}\n+\tif err != io.EOF {\n+\t\tt.Fatal(err)\n+\t}\n+}"
            },
            {
                "sha": "6e77ba40d903ff67af8c510532330b85711c3ea4",
                "filename": "tar/tar_win.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/tar%2Ftar_win.go",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/tar%2Ftar_win.go",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/tar%2Ftar_win.go?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
                "patch": "@@ -18,4 +18,4 @@\n package tar\n \n // DefaultSecurityMode is a set of security features that are enabled by default.\n-const DefaultSecurityMode = SanitizeFilenames | PreventSymlinkTraversal | PreventCaseInsensitiveSymlinkTraversal\n+const DefaultSecurityMode = SanitizeFilenames | PreventSymlinkTraversal | PreventCaseInsensitiveSymlinkTraversal | SkipWindowsShortFilenames"
            },
            {
                "sha": "bc4a18094a7b5d991bb177499cf1371bd393ca2f",
                "filename": "tar/winshort.tar",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/tar%2Fwinshort.tar",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/tar%2Fwinshort.tar",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/tar%2Fwinshort.tar?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc"
            },
            {
                "sha": "05b691f4195eed6badc2a1754ab288e928347898",
                "filename": "zip/winshort.zip",
                "status": "added",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/zip%2Fwinshort.zip",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/zip%2Fwinshort.zip",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/zip%2Fwinshort.zip?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc"
            },
            {
                "sha": "d5467f5951b6894e882962e572de9109d93aef16",
                "filename": "zip/zip.go",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/zip%2Fzip.go",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/zip%2Fzip.go",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/zip%2Fzip.go?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
                "patch": "@@ -130,11 +130,16 @@ const (\n \t// By default, this is activated only on MacOS and Windows builds. If you are extracting to a\n \t// case insensitive filesystem on a Unix platform, you should activate this feature explicitly.\n \tPreventCaseInsensitiveSymlinkTraversal SecurityMode = 16\n+\t// SkipWindowsShortFilenames drops archive entries that have a path component that look like a\n+\t// Windows short filename (e.g. GIT~1).\n+\t// By default, this is activated only on Windows builds. If you are extracting to a Windows\n+\t// filesystem on a non-Windows platform, you should activate this feature explicitly.\n+\tSkipWindowsShortFilenames SecurityMode = 32\n )\n \n // MaximumSecurityMode enables all security features. Apps that care about file contents only\n // and nothing unix specific (e.g. file modes or special devices) should use this mode.\n-const MaximumSecurityMode = SanitizeFilenames | PreventSymlinkTraversal | SanitizeFileMode | SkipSpecialFiles | PreventCaseInsensitiveSymlinkTraversal\n+const MaximumSecurityMode = SanitizeFilenames | PreventSymlinkTraversal | SanitizeFileMode | SkipSpecialFiles | PreventCaseInsensitiveSymlinkTraversal | SkipWindowsShortFilenames\n \n func isSpecialFile(f zip.File) bool {\n \tamode := f.Mode()\n@@ -163,6 +168,10 @@ func applyMagic(files []*zip.File, securityMode SecurityMode) []*zip.File {\n \t\t\tf.Name = sanitizer.SanitizePath(f.Name)\n \t\t}\n \n+\t\tif securityMode&SkipWindowsShortFilenames != 0 && sanitizer.HasWindowsShortFilenames(f.Name) {\n+\t\t\tcontinue\n+\t\t}\n+\n \t\tif securityMode&PreventSymlinkTraversal != 0 {\n \t\t\tfName := sanitizer.SanitizePath(f.Name)\n \t\t\tfName = strings.TrimSuffix(fName, \"/\")"
            },
            {
                "sha": "655b56888c9f4c0d85089875b6bcd001e0b120ae",
                "filename": "zip/zip_test.go",
                "status": "modified",
                "additions": 41,
                "deletions": 0,
                "changes": 41,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/zip%2Fzip_test.go",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/zip%2Fzip_test.go",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/zip%2Fzip_test.go?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
                "patch": "@@ -92,6 +92,28 @@ var (\n \t*/\n \t//go:embed case-insensitive.zip\n \teCaseInsensitiveSymlinksZip []byte\n+\n+\t/*\n+\t\tArchive:  winshort.zip\n+\t\t  Length      Date    Time    Name\n+\t\t---------  ---------- -----   ----\n+\t\t        5  2024-10-11 14:27   3D Objects\n+\t\t        5  2024-10-11 14:27   Androi~2\n+\t\t        5  2024-10-11 14:27   ANDROI~2\n+\t\t        0  2024-10-11 14:27   foo/\n+\t\t        5  2024-10-11 14:27   FOOOOO~1.JPG\n+\t\t        5  2024-10-11 14:27   Some~Stuff\n+\t\t        0  2024-10-11 14:27   foo/ANDROI~2/\n+\t\t        5  2024-10-11 14:27   foo/ANDROI~2/bar\n+\t\t        0  2024-10-11 14:27   foo/FOOOOO~1.JPG/\n+\t\t        5  2024-10-11 14:27   foo/FOOOOO~1.JPG/bar\n+\t\t        0  2024-10-11 14:27   foo/Androi~2/\n+\t\t        5  2024-10-11 14:27   foo/Androi~2/bar\n+\t\t---------                     -------\n+\t\t       40                     12 files\n+\t*/\n+\t//go:embed winshort.zip\n+\teWinShortFilenamesZip []byte\n )\n \n func TestSafezip(t *testing.T) {\n@@ -343,3 +365,22 @@ func TestTypes(t *testing.T) {\n \t\tt.Errorf(\"type of zip.OpenReader().Reader: %v, type of zip.NewReader(): %v\", openReaderType, newReaderType)\n \t}\n }\n+\n+func TestWindowsShortFilenames(t *testing.T) {\n+\tpath := archiveToPath(t, eWinShortFilenamesZip)\n+\tr, err := OpenReader(path)\n+\tif err != nil {\n+\t\tt.Fatalf(\"Error opening zip. OpenReader(%v) = %v, want nil\", path, err)\n+\t}\n+\tr.SetSecurityMode(r.GetSecurityMode() | SkipWindowsShortFilenames)\n+\n+\tif len(r.File) != 3 {\n+\t\tt.Fatalf(\"Unexpected number of files in the archive. len(OpenReader(%v).File) = %d, want 2.\", path, len(r.File))\n+\t}\n+\n+\tfor i, want := range []string{\"3D Objects\", \"foo/\", \"Some~Stuff\"} {\n+\t\tif r.File[i].Name != want {\n+\t\t\tt.Errorf(\"Unexpected entry. OpenReader(%v).File[%d].Name = %v, want %v\", path, i, r.File[i].Name, want)\n+\t\t}\n+\t}\n+}"
            },
            {
                "sha": "2c67ea63938bcf18f36b28bc3858622769457ef6",
                "filename": "zip/zip_win.go",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/google/safearchive/blob/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/zip%2Fzip_win.go",
                "raw_url": "https://github.com/google/safearchive/raw/f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc/zip%2Fzip_win.go",
                "contents_url": "https://api.github.com/repos/google/safearchive/contents/zip%2Fzip_win.go?ref=f7ce9d7b6f9c6ecd72d0b0f16216b046e55e44dc",
                "patch": "@@ -19,4 +19,4 @@ package zip\n \n // DefaultSecurityMode enables path traversal security measures. This mode should be safe for all\n // existing integrations.\n-const DefaultSecurityMode = SanitizeFilenames | PreventSymlinkTraversal | PreventCaseInsensitiveSymlinkTraversal\n+const DefaultSecurityMode = SanitizeFilenames | PreventSymlinkTraversal | PreventCaseInsensitiveSymlinkTraversal | SkipWindowsShortFilenames"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/chamilo/chamilo-lms/commits/3b98682199049ebfb170ace16ada9a7c8e9a6622",
        "url": "https://api.github.com/repos/chamilo/chamilo-lms/commits/3b98682199049ebfb170ace16ada9a7c8e9a6622",
        "html_url": "https://github.com/chamilo/chamilo-lms/commit/3b98682199049ebfb170ace16ada9a7c8e9a6622",
        "message": "Security: Social: Remove XSS when displaying group messages",
        "files": [
            {
                "sha": "21c380d3c8e47eebfb9939d48f0354984e2a4c6b",
                "filename": "main/inc/lib/message.lib.php",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/chamilo/chamilo-lms/blob/3b98682199049ebfb170ace16ada9a7c8e9a6622/main%2Finc%2Flib%2Fmessage.lib.php",
                "raw_url": "https://github.com/chamilo/chamilo-lms/raw/3b98682199049ebfb170ace16ada9a7c8e9a6622/main%2Finc%2Flib%2Fmessage.lib.php",
                "contents_url": "https://api.github.com/repos/chamilo/chamilo-lms/contents/main%2Finc%2Flib%2Fmessage.lib.php?ref=3b98682199049ebfb170ace16ada9a7c8e9a6622",
                "patch": "@@ -1941,7 +1941,9 @@ public static function display_message_for_group($groupId, $topic_id)\n         $main_content .= '<div class=\"message-content\"> ';\n         $main_content .= '<div class=\"username\">'.$user_link.'</div>';\n         $main_content .= $date;\n-        $main_content .= '<div class=\"message\">'.$main_message['content'].$attachment.'</div></div>';\n+        $main_content .= '<div class=\"message\">'\n+            .Security::remove_XSS($main_message['content'], STUDENT, true)\n+            .$attachment.'</div></div>';\n         $main_content .= '</div>';\n         $main_content .= '</div>';\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/chamilo/chamilo-lms/commits/a1a1e4df70dc65ae4fc7857135f4d3ee185548e7",
        "url": "https://api.github.com/repos/chamilo/chamilo-lms/commits/a1a1e4df70dc65ae4fc7857135f4d3ee185548e7",
        "html_url": "https://github.com/chamilo/chamilo-lms/commit/a1a1e4df70dc65ae4fc7857135f4d3ee185548e7",
        "message": "Security: Ensure that is the current user whose data is modified",
        "files": [
            {
                "sha": "3b67ebc0e5464d5b180f4bc0a0c8ec18c1a45013",
                "filename": "main/auth/profile.php",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/chamilo/chamilo-lms/blob/a1a1e4df70dc65ae4fc7857135f4d3ee185548e7/main%2Fauth%2Fprofile.php",
                "raw_url": "https://github.com/chamilo/chamilo-lms/raw/a1a1e4df70dc65ae4fc7857135f4d3ee185548e7/main%2Fauth%2Fprofile.php",
                "contents_url": "https://api.github.com/repos/chamilo/chamilo-lms/contents/main%2Fauth%2Fprofile.php?ref=a1a1e4df70dc65ae4fc7857135f4d3ee185548e7",
                "patch": "@@ -449,6 +449,7 @@ function show_image(image,width,height) {\n \n     $wrong_current_password = false;\n     $user_data = $form->getSubmitValues(1);\n+    $user_data['item_id'] = api_get_user_id();\n     /** @var User $user */\n     $user = UserManager::getRepository()->find(api_get_user_id());\n "
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/chamilo/chamilo-lms/commits/7a0e10cccc92eadae9403925f995b0a8d2d1305e",
        "url": "https://api.github.com/repos/chamilo/chamilo-lms/commits/7a0e10cccc92eadae9403925f995b0a8d2d1305e",
        "html_url": "https://github.com/chamilo/chamilo-lms/commit/7a0e10cccc92eadae9403925f995b0a8d2d1305e",
        "message": "Security: Social: Protect form to post in wall",
        "files": [
            {
                "sha": "c930c1547b1fb0ed72cae9ad85f9b0217a4d1262",
                "filename": "main/inc/lib/social.lib.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/chamilo/chamilo-lms/blob/7a0e10cccc92eadae9403925f995b0a8d2d1305e/main%2Finc%2Flib%2Fsocial.lib.php",
                "raw_url": "https://github.com/chamilo/chamilo-lms/raw/7a0e10cccc92eadae9403925f995b0a8d2d1305e/main%2Finc%2Flib%2Fsocial.lib.php",
                "contents_url": "https://api.github.com/repos/chamilo/chamilo-lms/contents/main%2Finc%2Flib%2Fsocial.lib.php?ref=7a0e10cccc92eadae9403925f995b0a8d2d1305e",
                "patch": "@@ -2409,7 +2409,6 @@ public static function getScriptToGetOpenGraph(): string\n     public static function displayWallForm(string $urlForm): string\n     {\n         $form = self::getWallForm($urlForm);\n-        $form->protect();\n \n         return Display::panel($form->returnForm(), get_lang('SocialWall'));\n     }\n@@ -3397,6 +3396,7 @@ private static function getWallForm(string $urlForm): FormValidator\n         $form->addHtml('</div></div>');\n         $form->addHtml('</div>');\n         $form->addHidden('url_content', '');\n+        $form->protect();\n \n         return $form;\n     }"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/topjohnwu/Magisk/commits/c2eb6039579b8a2fb1e11a753cea7662c07bec02",
        "url": "https://api.github.com/repos/topjohnwu/Magisk/commits/c2eb6039579b8a2fb1e11a753cea7662c07bec02",
        "html_url": "https://github.com/topjohnwu/Magisk/commit/c2eb6039579b8a2fb1e11a753cea7662c07bec02",
        "message": "Require GMS to be system app\n\nFixes https://github.com/topjohnwu/Magisk/issues/8279.",
        "files": [
            {
                "sha": "bb1b5ca9325808d04465baa73fc166cb341f3adb",
                "filename": "app/shared/src/main/java/com/topjohnwu/magisk/ProviderInstaller.java",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/topjohnwu/Magisk/blob/c2eb6039579b8a2fb1e11a753cea7662c07bec02/app%2Fshared%2Fsrc%2Fmain%2Fjava%2Fcom%2Ftopjohnwu%2Fmagisk%2FProviderInstaller.java",
                "raw_url": "https://github.com/topjohnwu/Magisk/raw/c2eb6039579b8a2fb1e11a753cea7662c07bec02/app%2Fshared%2Fsrc%2Fmain%2Fjava%2Fcom%2Ftopjohnwu%2Fmagisk%2FProviderInstaller.java",
                "contents_url": "https://api.github.com/repos/topjohnwu/Magisk/contents/app%2Fshared%2Fsrc%2Fmain%2Fjava%2Fcom%2Ftopjohnwu%2Fmagisk%2FProviderInstaller.java?ref=c2eb6039579b8a2fb1e11a753cea7662c07bec02",
                "patch": "@@ -1,13 +1,22 @@\n package com.topjohnwu.magisk;\n \n import android.content.Context;\n+import android.content.pm.ApplicationInfo;\n \n public class ProviderInstaller {\n \n+    private static final String GMS_PACKAGE_NAME = \"com.google.android.gms\";\n+\n     public static boolean install(Context context) {\n         try {\n+            // Check if gms is a system app\n+            ApplicationInfo appInfo = context.getPackageManager().getApplicationInfo(GMS_PACKAGE_NAME, 0);\n+            if ((appInfo.flags & ApplicationInfo.FLAG_SYSTEM) == 0) {\n+                return false;\n+            }\n+\n             // Try installing new SSL provider from Google Play Service\n-            Context gms = context.createPackageContext(\"com.google.android.gms\",\n+            Context gms = context.createPackageContext(GMS_PACKAGE_NAME,\n                     Context.CONTEXT_INCLUDE_CODE | Context.CONTEXT_IGNORE_SECURITY);\n             gms.getClassLoader()\n                     .loadClass(\"com.google.android.gms.common.security.ProviderInstallerImpl\")"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/mudler/localai/commits/a1634b219a4e52813e70ff07e6376a01449c4515",
        "url": "https://api.github.com/repos/mudler/LocalAI/commits/a1634b219a4e52813e70ff07e6376a01449c4515",
        "html_url": "https://github.com/mudler/LocalAI/commit/a1634b219a4e52813e70ff07e6376a01449c4515",
        "message": "fix: roll out bluemonday Sanitize more widely (#3794)\n\n* initial pass: roll out bluemonday sanitization more widely\r\n\r\nSigned-off-by: Dave Lee <dave@gray101.com>\r\n\r\n* add one additional sanitize - the overall modelslist used by the docs site\r\n\r\nSigned-off-by: Dave Lee <dave@gray101.com>\r\n\r\n---------\r\n\r\nSigned-off-by: Dave Lee <dave@gray101.com>",
        "files": [
            {
                "sha": "719cd094ae9dfeca130f84543c88dee215409798",
                "filename": ".github/ci/modelslist.go",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "blob_url": "https://github.com/mudler/LocalAI/blob/a1634b219a4e52813e70ff07e6376a01449c4515/.github%2Fci%2Fmodelslist.go",
                "raw_url": "https://github.com/mudler/LocalAI/raw/a1634b219a4e52813e70ff07e6376a01449c4515/.github%2Fci%2Fmodelslist.go",
                "contents_url": "https://api.github.com/repos/mudler/LocalAI/contents/.github%2Fci%2Fmodelslist.go?ref=a1634b219a4e52813e70ff07e6376a01449c4515",
                "patch": "@@ -6,6 +6,7 @@ import (\n \t\"io/ioutil\"\n \t\"os\"\n \n+\t\"github.com/microcosm-cc/bluemonday\"\n \t\"gopkg.in/yaml.v3\"\n )\n \n@@ -279,6 +280,12 @@ func main() {\n \t\treturn\n \t}\n \n+\t// Ensure that all arbitrary text content is sanitized before display\n+\tfor i, m := range models {\n+\t\tmodels[i].Name = bluemonday.StrictPolicy().Sanitize(m.Name)\n+\t\tmodels[i].Description = bluemonday.StrictPolicy().Sanitize(m.Description)\n+\t}\n+\n \t// render the template\n \tdata := struct {\n \t\tModels          []*GalleryModel"
            },
            {
                "sha": "06076bd9e55fc316d4a62d738dbd2c8c3ffed6f0",
                "filename": "core/http/elements/gallery.go",
                "status": "modified",
                "additions": 10,
                "deletions": 13,
                "changes": 23,
                "blob_url": "https://github.com/mudler/LocalAI/blob/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Felements%2Fgallery.go",
                "raw_url": "https://github.com/mudler/LocalAI/raw/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Felements%2Fgallery.go",
                "contents_url": "https://api.github.com/repos/mudler/LocalAI/contents/core%2Fhttp%2Felements%2Fgallery.go?ref=a1634b219a4e52813e70ff07e6376a01449c4515",
                "patch": "@@ -6,6 +6,7 @@ import (\n \n \t\"github.com/chasefleming/elem-go\"\n \t\"github.com/chasefleming/elem-go/attrs\"\n+\t\"github.com/microcosm-cc/bluemonday\"\n \t\"github.com/mudler/LocalAI/core/gallery\"\n \t\"github.com/mudler/LocalAI/core/p2p\"\n \t\"github.com/mudler/LocalAI/core/services\"\n@@ -41,7 +42,7 @@ func DoneProgress(galleryID, text string, showDelete bool) string {\n \t\t\t\t\"tabindex\":  \"-1\",\n \t\t\t\t\"autofocus\": \"\",\n \t\t\t},\n-\t\t\telem.Text(text),\n+\t\t\telem.Text(bluemonday.StrictPolicy().Sanitize(text)),\n \t\t),\n \t\telem.If(showDelete, deleteButton(galleryID, modelName), reInstallButton(galleryID)),\n \t).Render()\n@@ -57,7 +58,7 @@ func ErrorProgress(err, galleryName string) string {\n \t\t\t\t\"tabindex\":  \"-1\",\n \t\t\t\t\"autofocus\": \"\",\n \t\t\t},\n-\t\t\telem.Text(\"Error \"+err),\n+\t\t\telem.Text(\"Error \"+bluemonday.StrictPolicy().Sanitize(err)),\n \t\t),\n \t\tinstallButton(galleryName),\n \t).Render()\n@@ -170,7 +171,7 @@ func P2PNodeBoxes(nodes []p2p.NodeData) string {\n \t\t\t\t\t\tattrs.Props{\n \t\t\t\t\t\t\t\"class\": \"text-gray-200 font-semibold ml-2 mr-1\",\n \t\t\t\t\t\t},\n-\t\t\t\t\t\telem.Text(n.ID),\n+\t\t\t\t\t\telem.Text(bluemonday.StrictPolicy().Sanitize(n.ID)),\n \t\t\t\t\t),\n \t\t\t\t\telem.Text(\"Status: \"),\n \t\t\t\t\telem.If(\n@@ -227,7 +228,7 @@ func StartProgressBar(uid, progress, text string) string {\n \t\t\t\t\"tabindex\":  \"-1\",\n \t\t\t\t\"autofocus\": \"\",\n \t\t\t},\n-\t\t\telem.Text(text),\n+\t\t\telem.Text(bluemonday.StrictPolicy().Sanitize(text)), //Perhaps overly defensive\n \t\t\telem.Div(attrs.Props{\n \t\t\t\t\"hx-get\":     \"/browse/job/progress/\" + uid,\n \t\t\t\t\"hx-trigger\": \"every 600ms\",\n@@ -249,9 +250,7 @@ func cardSpan(text, icon string) elem.Node {\n \t\t\t\"class\": icon + \" pr-2\",\n \t\t}),\n \n-\t\telem.Text(text),\n-\n-\t\t//elem.Text(text),\n+\t\telem.Text(bluemonday.StrictPolicy().Sanitize(text)),\n \t)\n }\n \n@@ -285,11 +284,9 @@ func searchableElement(text, icon string) elem.Node {\n \t\t\t\telem.I(attrs.Props{\n \t\t\t\t\t\"class\": icon + \" pr-2\",\n \t\t\t\t}),\n-\t\t\t\telem.Text(text),\n+\t\t\t\telem.Text(bluemonday.StrictPolicy().Sanitize(text)),\n \t\t\t),\n \t\t),\n-\n-\t\t//elem.Text(text),\n \t)\n }\n \n@@ -303,7 +300,7 @@ func link(text, url string) elem.Node {\n \t\telem.I(attrs.Props{\n \t\t\t\"class\": \"fas fa-link pr-2\",\n \t\t}),\n-\t\telem.Text(text),\n+\t\telem.Text(bluemonday.StrictPolicy().Sanitize(text)),\n \t)\n }\n func installButton(galleryName string) elem.Node {\n@@ -387,13 +384,13 @@ func ListModels(models []*gallery.GalleryModel, processTracker ProcessTracker, g\n \t\t\t\tattrs.Props{\n \t\t\t\t\t\"class\": \"mb-2 text-xl font-bold leading-tight\",\n \t\t\t\t},\n-\t\t\t\telem.Text(m.Name),\n+\t\t\t\telem.Text(bluemonday.StrictPolicy().Sanitize(m.Name)),\n \t\t\t),\n \t\t\telem.P(\n \t\t\t\tattrs.Props{\n \t\t\t\t\t\"class\": \"mb-4 text-sm [&:not(:hover)]:truncate text-base\",\n \t\t\t\t},\n-\t\t\t\telem.Text(m.Description),\n+\t\t\t\telem.Text(bluemonday.StrictPolicy().Sanitize(m.Description)),\n \t\t\t),\n \t\t)\n \t}"
            },
            {
                "sha": "1d83066a58e2191ac9a3b73fb43dfb4819ee3496",
                "filename": "core/http/endpoints/openai/assistant.go",
                "status": "modified",
                "additions": 9,
                "deletions": 8,
                "changes": 17,
                "blob_url": "https://github.com/mudler/LocalAI/blob/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Fendpoints%2Fopenai%2Fassistant.go",
                "raw_url": "https://github.com/mudler/LocalAI/raw/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Fendpoints%2Fopenai%2Fassistant.go",
                "contents_url": "https://api.github.com/repos/mudler/LocalAI/contents/core%2Fhttp%2Fendpoints%2Fopenai%2Fassistant.go?ref=a1634b219a4e52813e70ff07e6376a01449c4515",
                "patch": "@@ -10,6 +10,7 @@ import (\n \t\"time\"\n \n \t\"github.com/gofiber/fiber/v2\"\n+\t\"github.com/microcosm-cc/bluemonday\"\n \t\"github.com/mudler/LocalAI/core/config\"\n \t\"github.com/mudler/LocalAI/core/schema\"\n \t\"github.com/mudler/LocalAI/core/services\"\n@@ -83,7 +84,7 @@ func CreateAssistantEndpoint(cl *config.BackendConfigLoader, ml *model.ModelLoad\n \n \t\tif !modelExists(cl, ml, request.Model) {\n \t\t\tlog.Warn().Msgf(\"Model: %s was not found in list of models.\", request.Model)\n-\t\t\treturn c.Status(fiber.StatusBadRequest).SendString(\"Model \" + request.Model + \" not found\")\n+\t\t\treturn c.Status(fiber.StatusBadRequest).SendString(bluemonday.StrictPolicy().Sanitize(fmt.Sprintf(\"Model %q not found\", request.Model)))\n \t\t}\n \n \t\tif request.Tools == nil {\n@@ -147,7 +148,7 @@ func ListAssistantsEndpoint(cl *config.BackendConfigLoader, ml *model.ModelLoade\n \t\t// Convert string limit to integer\n \t\tlimit, err := strconv.Atoi(limitQuery)\n \t\tif err != nil {\n-\t\t\treturn c.Status(http.StatusBadRequest).SendString(fmt.Sprintf(\"Invalid limit query value: %s\", limitQuery))\n+\t\t\treturn c.Status(http.StatusBadRequest).SendString(bluemonday.StrictPolicy().Sanitize(fmt.Sprintf(\"Invalid limit query value: %s\", limitQuery)))\n \t\t}\n \n \t\t// Sort assistants\n@@ -288,7 +289,7 @@ func GetAssistantEndpoint(cl *config.BackendConfigLoader, ml *model.ModelLoader,\n \t\t\t}\n \t\t}\n \n-\t\treturn c.Status(fiber.StatusNotFound).SendString(fmt.Sprintf(\"Unable to find assistant with id: %s\", assistantID))\n+\t\treturn c.Status(fiber.StatusNotFound).SendString(bluemonday.StrictPolicy().Sanitize(fmt.Sprintf(\"Unable to find assistant with id: %s\", assistantID)))\n \t}\n }\n \n@@ -337,11 +338,11 @@ func CreateAssistantFileEndpoint(cl *config.BackendConfigLoader, ml *model.Model\n \t\t\t\t\t}\n \t\t\t\t}\n \n-\t\t\t\treturn c.Status(fiber.StatusNotFound).SendString(fmt.Sprintf(\"Unable to find file_id: %s\", request.FileID))\n+\t\t\t\treturn c.Status(fiber.StatusNotFound).SendString(bluemonday.StrictPolicy().Sanitize(fmt.Sprintf(\"Unable to find file_id: %s\", request.FileID)))\n \t\t\t}\n \t\t}\n \n-\t\treturn c.Status(fiber.StatusNotFound).SendString(fmt.Sprintf(\"Unable to find %q\", assistantID))\n+\t\treturn c.Status(fiber.StatusNotFound).SendString(bluemonday.StrictPolicy().Sanitize(fmt.Sprintf(\"Unable to find %q\", assistantID)))\n \t}\n }\n \n@@ -442,7 +443,7 @@ func ModifyAssistantEndpoint(cl *config.BackendConfigLoader, ml *model.ModelLoad\n \t\t\t\treturn c.Status(fiber.StatusOK).JSON(newAssistant)\n \t\t\t}\n \t\t}\n-\t\treturn c.Status(fiber.StatusNotFound).SendString(fmt.Sprintf(\"Unable to find assistant with id: %s\", assistantID))\n+\t\treturn c.Status(fiber.StatusNotFound).SendString(bluemonday.StrictPolicy().Sanitize(fmt.Sprintf(\"Unable to find assistant with id: %s\", assistantID)))\n \t}\n }\n \n@@ -513,9 +514,9 @@ func GetAssistantFileEndpoint(cl *config.BackendConfigLoader, ml *model.ModelLoa\n \t\t\t\tif assistantFile.ID == fileId {\n \t\t\t\t\treturn c.Status(fiber.StatusOK).JSON(assistantFile)\n \t\t\t\t}\n-\t\t\t\treturn c.Status(fiber.StatusNotFound).SendString(fmt.Sprintf(\"Unable to find assistant file with file_id: %s\", fileId))\n+\t\t\t\treturn c.Status(fiber.StatusNotFound).SendString(bluemonday.StrictPolicy().Sanitize(fmt.Sprintf(\"Unable to find assistant file with file_id: %s\", fileId)))\n \t\t\t}\n \t\t}\n-\t\treturn c.Status(fiber.StatusNotFound).SendString(fmt.Sprintf(\"Unable to find assistant file with assistant_id: %s\", assistantID))\n+\t\treturn c.Status(fiber.StatusNotFound).SendString(bluemonday.StrictPolicy().Sanitize(fmt.Sprintf(\"Unable to find assistant file with assistant_id: %s\", assistantID)))\n \t}\n }"
            },
            {
                "sha": "bc392e73dd0e3db5a53150d142f733f4aa2457c7",
                "filename": "core/http/endpoints/openai/files.go",
                "status": "modified",
                "additions": 7,
                "deletions": 6,
                "changes": 13,
                "blob_url": "https://github.com/mudler/LocalAI/blob/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Fendpoints%2Fopenai%2Ffiles.go",
                "raw_url": "https://github.com/mudler/LocalAI/raw/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Fendpoints%2Fopenai%2Ffiles.go",
                "contents_url": "https://api.github.com/repos/mudler/LocalAI/contents/core%2Fhttp%2Fendpoints%2Fopenai%2Ffiles.go?ref=a1634b219a4e52813e70ff07e6376a01449c4515",
                "patch": "@@ -8,6 +8,7 @@ import (\n \t\"sync/atomic\"\n \t\"time\"\n \n+\t\"github.com/microcosm-cc/bluemonday\"\n \t\"github.com/mudler/LocalAI/core/config\"\n \t\"github.com/mudler/LocalAI/core/schema\"\n \n@@ -49,7 +50,7 @@ func UploadFilesEndpoint(cm *config.BackendConfigLoader, appConfig *config.Appli\n \n \t\terr = c.SaveFile(file, savePath)\n \t\tif err != nil {\n-\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(\"Failed to save file: \" + err.Error())\n+\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(\"Failed to save file: \" + bluemonday.StrictPolicy().Sanitize(err.Error()))\n \t\t}\n \n \t\tf := schema.File{\n@@ -121,7 +122,7 @@ func GetFilesEndpoint(cm *config.BackendConfigLoader, appConfig *config.Applicat\n \treturn func(c *fiber.Ctx) error {\n \t\tfile, err := getFileFromRequest(c)\n \t\tif err != nil {\n-\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(err.Error())\n+\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(bluemonday.StrictPolicy().Sanitize(err.Error()))\n \t\t}\n \n \t\treturn c.JSON(file)\n@@ -143,14 +144,14 @@ func DeleteFilesEndpoint(cm *config.BackendConfigLoader, appConfig *config.Appli\n \treturn func(c *fiber.Ctx) error {\n \t\tfile, err := getFileFromRequest(c)\n \t\tif err != nil {\n-\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(err.Error())\n+\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(bluemonday.StrictPolicy().Sanitize(err.Error()))\n \t\t}\n \n \t\terr = os.Remove(filepath.Join(appConfig.UploadDir, file.Filename))\n \t\tif err != nil {\n \t\t\t// If the file doesn't exist then we should just continue to remove it\n \t\t\tif !errors.Is(err, os.ErrNotExist) {\n-\t\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(fmt.Sprintf(\"Unable to delete file: %s, %v\", file.Filename, err))\n+\t\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(bluemonday.StrictPolicy().Sanitize(fmt.Sprintf(\"Unable to delete file: %s, %v\", file.Filename, err)))\n \t\t\t}\n \t\t}\n \n@@ -180,12 +181,12 @@ func GetFilesContentsEndpoint(cm *config.BackendConfigLoader, appConfig *config.\n \treturn func(c *fiber.Ctx) error {\n \t\tfile, err := getFileFromRequest(c)\n \t\tif err != nil {\n-\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(err.Error())\n+\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(bluemonday.StrictPolicy().Sanitize(err.Error()))\n \t\t}\n \n \t\tfileContents, err := os.ReadFile(filepath.Join(appConfig.UploadDir, file.Filename))\n \t\tif err != nil {\n-\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(err.Error())\n+\t\t\treturn c.Status(fiber.StatusInternalServerError).SendString(bluemonday.StrictPolicy().Sanitize(err.Error()))\n \t\t}\n \n \t\treturn c.Send(fileContents)"
            },
            {
                "sha": "8f5fe2fbf60c5e20a58d91cc7819687ab9f33c5a",
                "filename": "core/http/middleware/auth.go",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mudler/LocalAI/blob/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Fmiddleware%2Fauth.go",
                "raw_url": "https://github.com/mudler/LocalAI/raw/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Fmiddleware%2Fauth.go",
                "contents_url": "https://api.github.com/repos/mudler/LocalAI/contents/core%2Fhttp%2Fmiddleware%2Fauth.go?ref=a1634b219a4e52813e70ff07e6376a01449c4515",
                "patch": "@@ -7,6 +7,7 @@ import (\n \t\"github.com/dave-gray101/v2keyauth\"\r\n \t\"github.com/gofiber/fiber/v2\"\r\n \t\"github.com/gofiber/fiber/v2/middleware/keyauth\"\r\n+\t\"github.com/microcosm-cc/bluemonday\"\r\n \t\"github.com/mudler/LocalAI/core/config\"\r\n )\r\n \r\n@@ -38,7 +39,7 @@ func getApiKeyErrorHandler(applicationConfig *config.ApplicationConfig) fiber.Er\n \t\t\tif applicationConfig.OpaqueErrors {\r\n \t\t\t\treturn ctx.SendStatus(403)\r\n \t\t\t}\r\n-\t\t\treturn ctx.Status(403).SendString(err.Error())\r\n+\t\t\treturn ctx.Status(403).SendString(bluemonday.StrictPolicy().Sanitize(err.Error()))\r\n \t\t}\r\n \t\tif applicationConfig.OpaqueErrors {\r\n \t\t\treturn ctx.SendStatus(500)\r"
            },
            {
                "sha": "6ea38f35392fbb2b9168ec71f93485f7e50c760f",
                "filename": "core/http/routes/ui.go",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "blob_url": "https://github.com/mudler/LocalAI/blob/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Froutes%2Fui.go",
                "raw_url": "https://github.com/mudler/LocalAI/raw/a1634b219a4e52813e70ff07e6376a01449c4515/core%2Fhttp%2Froutes%2Fui.go",
                "contents_url": "https://api.github.com/repos/mudler/LocalAI/contents/core%2Fhttp%2Froutes%2Fui.go?ref=a1634b219a4e52813e70ff07e6376a01449c4515",
                "patch": "@@ -6,6 +6,7 @@ import (\n \t\"sort\"\n \t\"strings\"\n \n+\t\"github.com/microcosm-cc/bluemonday\"\n \t\"github.com/mudler/LocalAI/core/config\"\n \t\"github.com/mudler/LocalAI/core/gallery\"\n \t\"github.com/mudler/LocalAI/core/http/elements\"\n@@ -171,7 +172,7 @@ func RegisterUIRoutes(app *fiber.App,\n \t\t\t\tSearch string `form:\"search\"`\n \t\t\t}{}\n \t\t\tif err := c.BodyParser(&form); err != nil {\n-\t\t\t\treturn c.Status(fiber.StatusBadRequest).SendString(err.Error())\n+\t\t\t\treturn c.Status(fiber.StatusBadRequest).SendString(bluemonday.StrictPolicy().Sanitize(err.Error()))\n \t\t\t}\n \n \t\t\tmodels, _ := gallery.AvailableGalleryModels(appConfig.Galleries, appConfig.ModelPath)"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/zusam/zusam/commits/5930fdf86fa4abed01f0b345c8ec3c443656db9a",
        "url": "https://api.github.com/repos/zusam/zusam/commits/5930fdf86fa4abed01f0b345c8ec3c443656db9a",
        "html_url": "https://github.com/zusam/zusam/commit/5930fdf86fa4abed01f0b345c8ec3c443656db9a",
        "message": "0.5.6 (#79)\n\nCo-authored-by: Neriderc <89974636+Neriderc@users.noreply.github.com>\r\nCo-authored-by: Daniil Kozheikin <ibitlog@hotmail.com>\r\nCo-authored-by: Milan \u0160alka <salka.milan@googlemail.com>\r\nCo-authored-by: YuxiangWang_0525(John Frederick Wang) <1n3-3z0la8jxie@dingtalk.com>\r\nCo-authored-by: Allan Nordh\u00f8y <epost@anotheragency.no>\r\nCo-authored-by: gallegonovato <fran-carro@hotmail.es>\r\nCo-authored-by: Bruno-Van-den-Bosch <brunovandenbosch@proton.me>\r\nCo-authored-by: tabby <tabby4442@gmail.com>\r\nCo-authored-by: Asmodeus <colligare1Asmodeum@gmail.com>\r\nCo-authored-by: Zina <zinaa.bls@gmail.com>\r\nCo-authored-by: \u0ba4\u0bae\u0bbf\u0bb4\u0bcd\u0ba8\u0bc7\u0bb0\u0bae\u0bcd <anishprabu.t@gmail.com>\r\nCo-authored-by: Ettore Atalan <atalanttore@googlemail.com>\r\nCo-authored-by: Ugur Saglam <saglamugur556@gmail.com>",
        "files": [
            {
                "sha": "7326a7d01183e3b0b22cb727e580d7a311ffe907",
                "filename": ".github/workflows/lang.yml",
                "status": "added",
                "additions": 15,
                "deletions": 0,
                "changes": 15,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/.github%2Fworkflows%2Flang.yml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/.github%2Fworkflows%2Flang.yml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/.github%2Fworkflows%2Flang.yml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,15 @@\n+name: Lang tests\n+\n+on: [pull_request]\n+\n+jobs:\n+  validate-json:\n+    runs-on: ubuntu-latest\n+\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v3\n+\n+      - name: Validate JSON files\n+        run: |\n+          find app/src/lang -type f -name \"*.json\" -exec jq . {} \\; || exit 1"
            },
            {
                "sha": "384c02f42622150ba26a5e974aba9678b8ee81b8",
                "filename": ".github/workflows/node.yml",
                "status": "modified",
                "additions": 8,
                "deletions": 3,
                "changes": 11,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/.github%2Fworkflows%2Fnode.yml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/.github%2Fworkflows%2Fnode.yml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/.github%2Fworkflows%2Fnode.yml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -6,20 +6,25 @@ jobs:\n   lint:\n     runs-on: ubuntu-latest\n \n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        node-version: ['18', '20', '22']\n+\n     steps:\n     - name: Checkout code\n       uses: actions/checkout@v2\n \n     - name: Set up Node.js\n       uses: actions/setup-node@v2\n       with:\n-        node-version: '18'\n+        node-version: ${{ matrix.node-version }}\n \n     - name: Install dependencies\n       run: cd app && npm install --include=dev\n \n     - name: Run ESLint\n-      run: cd app && npx eslint -c .eslintrc.json src/\n+      run: cd app && npm run analyze\n \n     - name: Run stylelint\n-      run: cd app && npx stylelint \"src/scss/**/*.scss\"\n+      run: cd app && npm run stylelint"
            },
            {
                "sha": "0b0eea3de8df822a6073ede5ca0b7d8a7c920d9e",
                "filename": ".github/workflows/php.yml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/.github%2Fworkflows%2Fphp.yml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/.github%2Fworkflows%2Fphp.yml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/.github%2Fworkflows%2Fphp.yml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -10,7 +10,7 @@ jobs:\n     strategy:\n       fail-fast: false\n       matrix:\n-        php-version: ['8.1', '8.2']\n+        php-version: ['8.1', '8.2', '8.3']\n \n     steps:\n       - name: Checkout code"
            },
            {
                "sha": "741993d20cf696d2fa453a8fe7dc8054f39eaada",
                "filename": "CONTRIBUTING.md",
                "status": "added",
                "additions": 68,
                "deletions": 0,
                "changes": 68,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/CONTRIBUTING.md",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/CONTRIBUTING.md",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/CONTRIBUTING.md?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,68 @@\n+# Contributing to Zusam\n+\n+Thank you for considering contributing to Zusam! There are many ways that you can help, some of which are outlined below.\n+\n+<!-- TOC -->\n+* [Contributing to Zusam](#contributing-to-zusam)\n+  * [Report bugs and issues or request features](#report-bugs-and-issues-or-request-features)\n+  * [Translate Zusam](#translate-zusam)\n+  * [Contributing code](#contributing-code)\n+    * [Pull requests](#pull-requests)\n+    * [Setting up dev environment](#setting-up-dev-environment)\n+<!-- TOC -->\n+\n+## Report bugs and issues or request features\n+\n+If you find a problem with Zusam, or if you think of a valuable feature you would like implemented, open a new issue on GitHub and describe it for us.\n+\n+If you find a security vulnerability, do NOT open an issue. Please instead use the [GitHub security disclosure](https://github.com/zusam/zusam/security) functionality. Also see [SECURITY.md](./SECURITY.md).\n+\n+## Translate Zusam\n+\n+You can help translate Zusam into your language by using [Weblate](https://hosted.weblate.org/projects/zusam/core/). You can log in using your GitHub account or register for a new Weblate account.\n+\n+## Contributing code\n+\n+Please note this project is [AGPLv3 licenced](https://www.gnu.org/licenses/agpl.html), and all contributions are under the same licence. Please ensure all work is your own.\n+\n+If you're new to contributing, see [this tutorial](https://github.com/firstcontributions/first-contributions) on contributing to projects on GitHub.\n+\n+Check out the [Issues](https://github.com/zusam/zusam/issues) for things that need attention.\n+\n+### Pull requests\n+\n+Please target any pull requests to the `next` branch. This branch will be merged into `master` with each release.\n+\n+### Setting up dev environment\n+\n+Start by cloning the repo. Go to the folder you want to put it inside then:\n+\n+`git clone https://github.com/zusam/zusam.git`\n+\n+Go into the zusam directory and build the dev version:\n+\n+`cd zusam && dev/start-dev-container`\n+\n+You might get an error that it can't find the container that it just built. This is often related to a podman installation. To get around this, run the make command specifically targeting docker before running the start-dev-container script:\n+\n+`make dev container_pgrm=docker`\n+\n+You'll now be inside the container, in the zusam directory. `cd app` to get to the front end app directory, then run `npm install --save-dev` to install the npm packages.\n+\n+Next, compile the webapp and copy to the public directory with:\n+\n+`npm run build; rm -r ../public/*.{js,css,map,png}; cp -r dist/* ../public/`\n+\n+Now install the composer dependencies by running:\n+\n+`cd /zusam/api && php bin/composer install`\n+\n+Now exit the container with ctrl + D and then run the container using repo files using:\n+\n+`dev/start-test-container`\n+\n+You should now be able to access Zusam on [http://localhost:8080](http://localhost:8080). A user `zusam` with password `zusam` is created by default.\n+\n+Any code updates you make in the `api` directory should be reflected immediately in this running instance. For the web app in the `app` directory, after making changes you will need to rerun the command to build and copy to the public directory: \n+\n+`npm run build; rm -r ../public/*.{js,css,map,png}; cp -r dist/* ../public/`\n\\ No newline at end of file"
            },
            {
                "sha": "ad5fcaba849de19700e7e716d3e931174907f233",
                "filename": "README.md",
                "status": "modified",
                "additions": 2,
                "deletions": 3,
                "changes": 5,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/README.md",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/README.md",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/README.md?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -54,7 +54,7 @@ Installation guides:\n The project has the goal of being really stable for the backend once `1.0` is hit.\n That means no database structure changes, an update system and a stable API.  \n The webapp can still change a lot after that point.  \n-For now, Zusam is completely usable in a day-to-day basis but is subject to significative\n+For now, Zusam is completely usable in a day-to-day basis but is subject to significant\n evolutions with upcoming updates and doesn't guarantee backwards compatibility.  \n I try my best to make updates as easy as possible.\n \n@@ -67,8 +67,7 @@ It should work on the latest versions of Edge and Safari but is not tested on th\n \n Zusam is free and open-source software licensed\n under [AGPLv3](https://www.gnu.org/licenses/agpl.html).  \n-You can open issues for bugs you've found or features you think are missing.\n-You can also submit pull requests to this repository.\n+You can open issues for bugs you've found or features you think are missing, or submit pull requests to this repository. See [CONTRIBUTING.md](./CONTRIBUTING.md) for more information.\n \n Zusam is being translated using [Weblate](https://hosted.weblate.org/projects/zusam/core/):  \n <a href=\"https://hosted.weblate.org/engage/zusam/\">"
            },
            {
                "sha": "ffe45b72b08b352c7101640cd33f4b17b252b879",
                "filename": "SECURITY.md",
                "status": "added",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/SECURITY.md",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/SECURITY.md",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/SECURITY.md?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,9 @@\n+# Reporting Security Issues\n+\n+The Zusam team and community take security bugs in Zusam seriously. We appreciate your efforts to responsibly disclose your findings, and will make every effort to acknowledge your contributions.\n+\n+To report a security issue, please use the GitHub Security Advisory [\"Report a Vulnerability\"](https://github.com/zusam/zusam/security/advisories/new) tab.\n+\n+The Zusam team will send a response indicating the next steps in handling your report. After the initial reply to your report, the security team will keep you informed of the progress towards a fix and full announcement, and may ask for additional information or guidance.\n+\n+Please report security bugs in third-party modules to the person or team maintaining the module. \n\\ No newline at end of file"
            },
            {
                "sha": "378fd7ce5593b4d789ddd13611a07135701f775a",
                "filename": "api/.env",
                "status": "modified",
                "additions": 7,
                "deletions": 2,
                "changes": 9,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2F.env",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2F.env",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2F.env?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,5 +1,5 @@\n # Version of the API\n-VERSION=\"0.5.5\"\n+VERSION=\"0.5.6\"\n \n # Do we allow bots ?\n ALLOW_BOTS=\"false\"\n@@ -10,6 +10,9 @@ ALLOW_IMAGE_UPLOAD=\"true\"\n ALLOW_PDF_UPLOAD=\"true\"\n ALLOW_AUDIO_UPLOAD=\"false\" # not allowed since backend is not ready\n \n+# Can users invite?\n+SHOW_GROUP_INVITATION_LINKS=\"true\"\n+\n # Task execution intervals in seconds\n CRON_CONVERT_IMAGES=\"60\" # 1 minute\n CRON_CONVERT_VIDEO=\"3600\" # 1 hour\n@@ -29,8 +32,10 @@ APP_ENV=\"prod\"\n APP_SECRET=\"thisisaplaceholdersecret\"\n ###< symfony/framework-bundle ###\n \n-# DOMAIN is used to generate urls\n+# Base URL information\n+PROTOCOL=\"http\"\n DOMAIN=\"localhost\"\n+PORT=\"\"\n \n # LANG is the default language of the API\n LANG=\"en_US\""
            },
            {
                "sha": "e3253ebc9ddf7acb72fe456d4ca6a0545619da47",
                "filename": "api/bin/composer",
                "status": "modified",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fbin%2Fcomposer",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fbin%2Fcomposer",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fbin%2Fcomposer?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a"
            },
            {
                "sha": "44719415210d5847d3421cdc0e56cf5c018c0053",
                "filename": "api/composer.json",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fcomposer.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fcomposer.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fcomposer.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -83,6 +83,9 @@\n         \"lint\": [\n           \"php -d memory_limit=-1 ./vendor/bin/php-cs-fixer check src/ --verbose\"\n         ],\n+        \"fix\": [\n+          \"php -d memory_limit=-1 ./vendor/bin/php-cs-fixer fix src/ --verbose\"\n+        ],\n         \"analyze\": [\n           \"php -d memory_limit=-1 ./vendor/bin/phpstan analyse src/ -l 3\"\n         ],"
            },
            {
                "sha": "50ea5b8d8e56a2b48b31eab721361f8a049e226e",
                "filename": "api/composer.lock",
                "status": "modified",
                "additions": 2319,
                "deletions": 1556,
                "changes": 3875,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fcomposer.lock",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fcomposer.lock",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fcomposer.lock?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a"
            },
            {
                "sha": "4528e9fe03d6381e228772d7b2bb760d9218f315",
                "filename": "api/config/packages/cache.yaml",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fcache.yaml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fcache.yaml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fconfig%2Fpackages%2Fcache.yaml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,7 +1,7 @@\n framework:\n-    cache:\n-        pools:\n-            app.group_pages:\n-                adapter: 'cache.adapter.filesystem'\n-                default_lifetime: 3600 # 1 hour\n-                tags: true\n+  cache:\n+    pools:\n+      app.group_pages:\n+        adapter: 'cache.adapter.filesystem'\n+        default_lifetime: 3600 # 1 hour\n+        tags: true"
            },
            {
                "sha": "622d1d5d37a8f5128d96c47d330744b2f9ae1921",
                "filename": "api/config/packages/doctrine_migrations.yaml",
                "status": "modified",
                "additions": 12,
                "deletions": 12,
                "changes": 24,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fdoctrine_migrations.yaml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fdoctrine_migrations.yaml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fconfig%2Fpackages%2Fdoctrine_migrations.yaml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,13 +1,13 @@\n doctrine_migrations:\n-    migrations_paths:\n-        # namespace is arbitrary but should be different from App\\Migrations\n-        # as migrations classes should NOT be autoloaded\n-        'DoctrineMigrations': '%kernel.project_dir%/migrations'\n-    enable_profiler: '%kernel.debug%'\n-    storage:\n-      # Default (SQL table) metadata storage configuration\n-      table_storage:\n-          table_name: 'doctrine_migration_versions'\n-          version_column_name: 'version'\n-          version_column_length: 192\n-          executed_at_column_name: 'executed_at'\n+  migrations_paths:\n+    # namespace is arbitrary but should be different from App\\Migrations\n+    # as migrations classes should NOT be autoloaded\n+    'DoctrineMigrations': '%kernel.project_dir%/migrations'\n+  enable_profiler: '%kernel.debug%'\n+  storage:\n+    # Default (SQL table) metadata storage configuration\n+    table_storage:\n+      table_name: 'doctrine_migration_versions'\n+      version_column_name: 'version'\n+      version_column_length: 192\n+      executed_at_column_name: 'executed_at'"
            },
            {
                "sha": "f91c208f2040fddcd751e0df44eaa5bc464c1bd1",
                "filename": "api/config/packages/framework.yaml",
                "status": "modified",
                "additions": 18,
                "deletions": 18,
                "changes": 36,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fframework.yaml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fframework.yaml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fconfig%2Fpackages%2Fframework.yaml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,24 +1,24 @@\n # see https://symfony.com/doc/current/reference/configuration/framework.html\n framework:\n-    secret: '%env(APP_SECRET)%'\n-    #csrf_protection: true\n-    http_method_override: false\n+  secret: '%env(APP_SECRET)%'\n+  #csrf_protection: true\n+  http_method_override: false\n \n-    # Enables session support. Note that the session will ONLY be started if you read or write from it.\n-    # Remove or comment this section to explicitly disable session support.\n-    session:\n-        handler_id: null\n-        cookie_secure: auto\n-        cookie_samesite: lax\n-        storage_factory_id: session.storage.factory.native\n+  # Enables session support. Note that the session will ONLY be started if you read or write from it.\n+  # Remove or comment this section to explicitly disable session support.\n+  session:\n+    handler_id: null\n+    cookie_secure: auto\n+    cookie_samesite: lax\n+    storage_factory_id: session.storage.factory.native\n \n-    #esi: true\n-    #fragments: true\n-    php_errors:\n-        log: true\n+  #esi: true\n+  #fragments: true\n+  php_errors:\n+    log: true\n \n when@test:\n-    framework:\n-        test: true\n-        session:\n-            storage_factory_id: session.storage.factory.mock_file\n+  framework:\n+    test: true\n+    session:\n+      storage_factory_id: session.storage.factory.mock_file"
            },
            {
                "sha": "0a0697c899cfd8a82eb54f2b09fa8034f840cc67",
                "filename": "api/config/packages/mailer.yaml",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fmailer.yaml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fmailer.yaml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fconfig%2Fpackages%2Fmailer.yaml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,3 +1,3 @@\n framework:\n-    mailer:\n-        dsn: '%env(MAILER_DSN)%'\n+  mailer:\n+    dsn: '%env(MAILER_DSN)%'"
            },
            {
                "sha": "5a5655c03e94d5f00db5104001b72098debcaddb",
                "filename": "api/config/packages/monolog.yaml",
                "status": "modified",
                "additions": 46,
                "deletions": 54,
                "changes": 100,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fmonolog.yaml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fmonolog.yaml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fconfig%2Fpackages%2Fmonolog.yaml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,61 +1,53 @@\n monolog:\n-    channels:\n-        - deprecation # Deprecations are logged in the dedicated \"deprecation\" channel when it exists\n+  channels:\n+    - deprecation # Deprecations are logged in the dedicated \"deprecation\" channel when it exists\n \n when@dev:\n-    monolog:\n-        handlers:\n-            main:\n-                type: stream\n-                path: \"%kernel.logs_dir%/%kernel.environment%.log\"\n-                level: debug\n-                channels: [\"!event\"]\n-            # uncomment to get logging in your browser\n-            # you may have to allow bigger header sizes in your Web server configuration\n-            #firephp:\n-            #    type: firephp\n-            #    level: info\n-            #chromephp:\n-            #    type: chromephp\n-            #    level: info\n-            console:\n-                type: console\n-                process_psr_3_messages: false\n-                channels: [\"!event\", \"!doctrine\", \"!console\"]\n+  monolog:\n+    handlers:\n+      main:\n+        type: stream\n+        path: \"%kernel.logs_dir%/%kernel.environment%.log\"\n+        level: debug\n+        channels: [\"!event\"]\n+      console:\n+        type: console\n+        process_psr_3_messages: false\n+        channels: [\"!event\", \"!doctrine\", \"!console\"]\n \n when@test:\n-    monolog:\n-        handlers:\n-            main:\n-                type: fingers_crossed\n-                action_level: error\n-                handler: nested\n-                excluded_http_codes: [404, 405]\n-                channels: [\"!event\"]\n-            nested:\n-                type: stream\n-                path: \"%kernel.logs_dir%/%kernel.environment%.log\"\n-                level: debug\n+  monolog:\n+    handlers:\n+      main:\n+        type: fingers_crossed\n+        action_level: error\n+        handler: nested\n+        excluded_http_codes: [404, 405]\n+        channels: [\"!event\"]\n+      nested:\n+        type: stream\n+        path: \"%kernel.logs_dir%/%kernel.environment%.log\"\n+        level: debug\n \n when@prod:\n-    monolog:\n-        handlers:\n-            main:\n-                type: fingers_crossed\n-                action_level: error\n-                handler: nested\n-                excluded_http_codes: [404, 405]\n-                buffer_size: 50 # How many messages should be saved? Prevent memory leaks\n-            nested:\n-                type: stream\n-                path: php://stderr\n-                level: debug\n-                formatter: monolog.formatter.json\n-            console:\n-                type: console\n-                process_psr_3_messages: false\n-                channels: [\"!event\", \"!doctrine\"]\n-            deprecation:\n-                type: stream\n-                channels: [deprecation]\n-                path: php://stderr\n+  monolog:\n+    handlers:\n+      main:\n+        type: fingers_crossed\n+        action_level: error\n+        handler: nested\n+        excluded_http_codes: [404, 405]\n+        buffer_size: 50 # How many messages should be saved? Prevent memory leaks\n+      nested:\n+        type: stream\n+        path: php://stderr\n+        level: debug\n+        formatter: monolog.formatter.json\n+      console:\n+        type: console\n+        process_psr_3_messages: false\n+        channels: [\"!event\", \"!doctrine\"]\n+      deprecation:\n+        type: stream\n+        channels: [deprecation]\n+        path: php://stderr"
            },
            {
                "sha": "b2add2bda72668baef7578676b74d2677b2c4e3b",
                "filename": "api/config/packages/security.yaml",
                "status": "modified",
                "additions": 4,
                "deletions": 7,
                "changes": 11,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fsecurity.yaml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fpackages%2Fsecurity.yaml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fconfig%2Fpackages%2Fsecurity.yaml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,7 +1,4 @@\n security:\n-  # you must use the authenticator manager for login throttling\n-  # https://symfony.com/doc/current/security.html#limiting-login-attempts\n-  enable_authenticator_manager: true\n   password_hashers:\n     # Use native password hasher, which auto-selects and migrates the best\n     # possible hashing algorithm (starting from Symfony 5.3 this is \"bcrypt\")\n@@ -28,7 +25,7 @@ security:\n     main:\n       lazy: true\n       stateless: true\n-      access_denied_handler: App\\Security\\AccessDeniedHandler\n-      entry_point: App\\Security\\EntryPointService\n-      custom_authenticators:\n-        - App\\Security\\ApiKeyAuthenticator\n+      access_token:\n+        token_handler: App\\Security\\ApiKeyAuthenticator\n+        token_extractors:\n+          - App\\Security\\ApiKeyExtractor"
            },
            {
                "sha": "f7ead061f51af4c6374b0766fbef87d8cb81273d",
                "filename": "api/config/routes.yaml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Froutes.yaml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Froutes.yaml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fconfig%2Froutes.yaml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,5 +1,5 @@\n controllers:\n     resource: '../src/Controller/'\n-    type: annotation\n+    type: attribute\n     defaults:\n         _format: json"
            },
            {
                "sha": "cb9cf42f783273c6b2069c083543dab0d8a29f22",
                "filename": "api/config/routes/annotations.yaml",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Froutes%2Fannotations.yaml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Froutes%2Fannotations.yaml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fconfig%2Froutes%2Fannotations.yaml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,3 +1,3 @@\n controllers:\n     resource: ../../src/Controller/\n-    type: annotation\n+    type: attribute"
            },
            {
                "sha": "045277d4b3418f2064f494dcb35e54e23d3d240a",
                "filename": "api/config/services.yaml",
                "status": "modified",
                "additions": 9,
                "deletions": 0,
                "changes": 9,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fservices.yaml",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fconfig%2Fservices.yaml",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fconfig%2Fservices.yaml?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -3,12 +3,15 @@\n parameters:\n   lang: '%env(resolve:LANG)%'\n   version: '%env(resolve:VERSION)%'\n+  protocol: '%env(resolve:PROTOCOL)%'\n   domain: '%env(resolve:DOMAIN)%'\n+  port: '%env(resolve:PORT)%'\n   app_env: '%env(resolve:APP_ENV)%'\n   allow.upload.image: '%env(resolve:ALLOW_IMAGE_UPLOAD)%'\n   allow.upload.video: '%env(resolve:ALLOW_VIDEO_UPLOAD)%'\n   allow.upload.pdf: '%env(resolve:ALLOW_PDF_UPLOAD)%'\n   allow.upload.audio: '%env(resolve:ALLOW_AUDIO_UPLOAD)%'\n+  show.group.invitation.links: '%env(resolve:SHOW_GROUP_INVITATION_LINKS)%'\n   idle_hours: '%env(resolve:IDLE_HOURS)%'\n   video_conversion_threads: '%env(resolve:VIDEO_CONVERSION_THREADS)%'\n   video_format_not_converted: '%env(resolve:VIDEO_FORMAT_NOT_CONVERTED)%'\n@@ -122,6 +125,9 @@ services:\n     App\\Command\\NotificationEmails:\n       arguments:\n \n+    App\\Command\\ListInviteLinks:\n+      arguments:\n+\n     App\\Command\\StorageStatistics:\n       arguments:\n         $dsn: '%env(resolve:DATABASE_URL)%'\n@@ -153,3 +159,6 @@ services:\n         $lang: '%env(resolve:LANG)%'\n         $allow_email: '%env(resolve:ALLOW_EMAIL)%'\n         $env: '%kernel.environment%'\n+\n+    App\\Service\\Url:\n+      arguments:"
            },
            {
                "sha": "6f07d89eae4e46b6aff02c9fbaf0a1ea228910f1",
                "filename": "api/src/Command/ConvertImages.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FConvertImages.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FConvertImages.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FCommand%2FConvertImages.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -70,7 +70,7 @@ protected function execute(InputInterface $input, OutputInterface $output): int\n             list($width, $height) = getimagesize($inputFile);\n             // This is a special check for long format images that should not be limited in height\n             // example: https://imgs.xkcd.com/comics/earth_temperature_timeline.png\n-            if ($height / $width > 10) {\n+            if ($width != 0 && $height / $width > 10) {\n                 $this->imageService->createThumbnail(\n                     $inputFile,\n                     $outputFile.'.converted',"
            },
            {
                "sha": "28b661e38eb09b36d1859734d95542f161ecd36b",
                "filename": "api/src/Command/Initialize.php",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FInitialize.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FInitialize.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FCommand%2FInitialize.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -101,8 +101,8 @@ protected function execute(InputInterface $input, OutputInterface $output): int\n             $message_1 = $this->messageService->create(\n                 [\n                     'data' => [\n-                      'title' => 'Welcome to Zusam !',\n-                      'text' => '\n+                        'title' => 'Welcome to Zusam !',\n+                        'text' => '\n                           This is a simple message.\n                           Try to post something yourself by using the new message button on the group page or by leaving a comment here.\n                       ',"
            },
            {
                "sha": "d13a9740196a71c8ee2008fdefc4b8251972cb7b",
                "filename": "api/src/Command/ListInviteLinks.php",
                "status": "added",
                "additions": 64,
                "deletions": 0,
                "changes": 64,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FListInviteLinks.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FListInviteLinks.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FCommand%2FListInviteLinks.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,64 @@\n+<?php\n+\n+namespace App\\Command;\n+\n+use App\\Entity\\Group;\n+use App\\Service\\Url;\n+use Doctrine\\ORM\\EntityManagerInterface;\n+use Symfony\\Component\\Console\\Command\\Command;\n+use Symfony\\Component\\Console\\Helper\\Table;\n+use Symfony\\Component\\Console\\Input\\InputInterface;\n+use Symfony\\Component\\Console\\Input\\InputOption;\n+use Symfony\\Component\\Console\\Output\\OutputInterface;\n+\n+class ListInviteLinks extends Command\n+{\n+    private $em;\n+    private $output;\n+    private Url $url;\n+\n+    public function __construct(\n+        EntityManagerInterface $em,\n+        Url $url,\n+    ) {\n+        parent::__construct();\n+        $this->em = $em;\n+        $this->url = $url;\n+    }\n+\n+    protected function configure()\n+    {\n+        $this->setName('zusam:invitations:list')\n+             ->setDescription('List the invite link for each group')\n+             ->addOption('group-id', null, InputOption::VALUE_REQUIRED, \"What's the ID of the group to fetch invites for?\")\n+             ->setHelp('List the invitation links for each of the groups');\n+    }\n+\n+    protected function execute(InputInterface $input, OutputInterface $output): int\n+    {\n+        $this->output = $output;\n+        if ($input->getOption('group-id')) {\n+            $group = $this->em->getRepository(Group::class)->find($input->getOption('group-id'));\n+            if ($group) {\n+                $this->output->writeln([\n+                    $this->url->getBaseUrl() . '/invitation/' . $group->getSecretKey(),\n+                ]);\n+            } else {\n+                $this->output->writeln([\n+                    'Group ID not found',\n+                ]);\n+            }\n+            return 0;\n+        }\n+\n+        $groups = $this->em->getRepository(Group::class)->findAll();\n+        $table = new Table($output);\n+        $table->setHeaders(['Group ID', 'Group Name', 'Invite Link']);\n+        foreach ($groups as $group) {\n+            $table->addRow([$group->getId(), $group->getName(), $this->url->getBaseUrl() . '/invitation/' . $group->getSecretKey()]);\n+        }\n+        $table->render();\n+\n+        return 0;\n+    }\n+}"
            },
            {
                "sha": "2853fe1d856b176a360be330c6ea1a4159b02484",
                "filename": "api/src/Command/Migration.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FMigration.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FMigration.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FCommand%2FMigration.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -3,7 +3,7 @@\n namespace App\\Command;\n \n use App\\Entity\\Message as MessageEntity;\n-use App\\Entity\\User as USerEntity;\n+use App\\Entity\\User as UserEntity;\n use App\\Service\\Bookmark as BookmarkService;\n use Doctrine\\ORM\\EntityManagerInterface;\n use Psr\\Log\\LoggerInterface;"
            },
            {
                "sha": "97cd577f0095e8a948f4aeb0167330c2c6a93217",
                "filename": "api/src/Command/ResetInviteLink.php",
                "status": "added",
                "additions": 59,
                "deletions": 0,
                "changes": 59,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FResetInviteLink.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FCommand%2FResetInviteLink.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FCommand%2FResetInviteLink.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,59 @@\n+<?php\n+\n+namespace App\\Command;\n+\n+use App\\Entity\\Group;\n+use App\\Service\\Url;\n+use Doctrine\\ORM\\EntityManagerInterface;\n+use Symfony\\Component\\Console\\Command\\Command;\n+use Symfony\\Component\\Console\\Input\\InputInterface;\n+use Symfony\\Component\\Console\\Input\\InputOption;\n+use Symfony\\Component\\Console\\Output\\OutputInterface;\n+\n+class ResetInviteLink extends Command\n+{\n+    private $em;\n+    private $output;\n+    private Url $url;\n+\n+    public function __construct(\n+        EntityManagerInterface $em,\n+        Url $url,\n+    ) {\n+        parent::__construct();\n+        $this->em = $em;\n+        $this->url = $url;\n+    }\n+\n+    protected function configure()\n+    {\n+        $this->setName('zusam:invitations:reset')\n+             ->setDescription('Resets the invitation key for a group')\n+             ->addOption('group-id', null, InputOption::VALUE_REQUIRED, \"What's the ID of the group to fetch invites for?\")\n+             ->setHelp('Resets the invitation key for the selected group and outputs the new invitation link');\n+    }\n+\n+    protected function execute(InputInterface $input, OutputInterface $output): int\n+    {\n+        $this->output = $output;\n+        if ($input->getOption('group-id')) {\n+            $group = $this->em->getRepository(Group::class)->find($input->getOption('group-id'));\n+            if ($group) {\n+                $group->resetSecretKey();\n+                $this->em->persist($group);\n+                $this->em->flush();\n+\n+                $this->output->writeln([\n+                    $this->url->getBaseUrl() . '/invitation/' . $group->getSecretKey(),\n+                ]);\n+            } else {\n+                $this->output->writeln([\n+                    'Group ID not found',\n+                ]);\n+            }\n+            return 0;\n+        }\n+\n+        return 0;\n+    }\n+}"
            },
            {
                "sha": "11ee7428c37ef3d11e62464e29da7990ec9c113a",
                "filename": "api/src/Controller/ApiController.php",
                "status": "modified",
                "additions": 14,
                "deletions": 14,
                "changes": 28,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FApiController.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FApiController.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FApiController.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -61,20 +61,20 @@ public function normalize($object, array $groups = [])\n             $object,\n             'json',\n             [\n-            ObjectNormalizer::MAX_TREE_DEPTH_HANDLER => function ($object, $format = null, array $context = []) {\n-                return \\method_exists($object, 'getId') ? ['id' => $object->getId()] : '';\n-            },\n-            AbstractNormalizer::CIRCULAR_REFERENCE_HANDLER => function ($object, $format = null, array $context = []) {\n-                return \\method_exists($object, 'getId') ? ['id' => $object->getId()] : '';\n-            },\n-            AbstractObjectNormalizer::SKIP_NULL_VALUES => true,\n-            AbstractObjectNormalizer::CIRCULAR_REFERENCE_LIMIT => 1, // symfony default\n-            AbstractObjectNormalizer::ALLOW_EXTRA_ATTRIBUTES => true, // symfony default\n-            ObjectNormalizer::ENABLE_MAX_TREE_DEPTH => true,\n-            ObjectNormalizer::TREE_DEPTH_LIMIT => 1,\n-            'currentUser' => $this->getUser() ? $this->getUser()->getUserIdentifier() : null,\n-            'groups' => $groups,\n-        ]\n+                ObjectNormalizer::MAX_TREE_DEPTH_HANDLER => function ($object, $format = null, array $context = []) {\n+                    return \\method_exists($object, 'getId') ? ['id' => $object->getId()] : '';\n+                },\n+                AbstractNormalizer::CIRCULAR_REFERENCE_HANDLER => function ($object, $format = null, array $context = []) {\n+                    return \\method_exists($object, 'getId') ? ['id' => $object->getId()] : '';\n+                },\n+                AbstractObjectNormalizer::SKIP_NULL_VALUES => true,\n+                AbstractObjectNormalizer::CIRCULAR_REFERENCE_LIMIT => 1, // symfony default\n+                AbstractObjectNormalizer::ALLOW_EXTRA_ATTRIBUTES => true, // symfony default\n+                ObjectNormalizer::ENABLE_MAX_TREE_DEPTH => true,\n+                ObjectNormalizer::TREE_DEPTH_LIMIT => 1,\n+                'currentUser' => $this->getUser() ? $this->getUser()->getUserIdentifier() : null,\n+                'groups' => $groups,\n+            ]\n         );\n     }\n }"
            },
            {
                "sha": "38b6afe91363206fc3a16a566675e31f7d07ab28",
                "filename": "api/src/Controller/Bookmark/Create.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FBookmark%2FCreate.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FBookmark%2FCreate.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FBookmark%2FCreate.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -32,8 +32,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/bookmarks\", methods={\"POST\"})\n-     *\n      * @OA\\RequestBody(\n      *\n      *  @OA\\Schema(\n@@ -57,6 +55,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/bookmarks\", methods: [\"POST\"])]\n     public function index(\n         Request $request,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "621f00251877fa83ec8bb17043e000e5177d5536",
                "filename": "api/src/Controller/Bookmark/Delete.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FBookmark%2FDelete.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FBookmark%2FDelete.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FBookmark%2FDelete.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -25,8 +25,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/bookmarks/{id}\", methods={\"DELETE\"})\n-     *\n      * @OA\\Response(\n      *  response=204,\n      *  description=\"Delete a bookmark\"\n@@ -36,6 +34,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/bookmarks/{id}\", methods: [\"DELETE\"])]\n     public function index(\n         string $id,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "a43c3c541a2723052ce269a35ccfd185de445da6",
                "filename": "api/src/Controller/Bookmark/Get.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FBookmark%2FGet.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FBookmark%2FGet.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FBookmark%2FGet.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -28,8 +28,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/bookmarks/{id}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a bookmark\",\n@@ -41,6 +39,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/bookmarks/{id}\", methods: [\"GET\"])]\n     public function index(string $id): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "adcff1585fcb30e2d26e34a294c3ad4576e603c7",
                "filename": "api/src/Controller/Bookmark/GetFromUser.php",
                "status": "modified",
                "additions": 4,
                "deletions": 8,
                "changes": 12,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FBookmark%2FGetFromUser.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FBookmark%2FGetFromUser.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FBookmark%2FGetFromUser.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -25,8 +25,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/users/{id}/bookmarks\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get all bookmarks from a user\",\n@@ -42,6 +40,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/users/{id}/bookmarks\", methods: [\"GET\"])]\n     public function get_bookmarks(string $id): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');\n@@ -60,8 +59,6 @@ public function get_bookmarks(string $id): Response\n     }\n \n     /**\n-     * @Route(\"/me/bookmarks\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get all bookmarks from a user\",\n@@ -77,6 +74,7 @@ public function get_bookmarks(string $id): Response\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/me/bookmarks\", methods: [\"GET\"])]\n     public function my_bookmarks(\n         #[CurrentUser] User $currentUser\n     ): Response {\n@@ -89,8 +87,6 @@ public function my_bookmarks(\n     }\n \n     /**\n-     * @Route(\"/users/{id}/bookmarks/{limit}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get recent bookmarks from a user\",\n@@ -106,6 +102,7 @@ public function my_bookmarks(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/users/{id}/bookmarks/{limit}\", methods: [\"GET\"])]\n     public function get_bookmarks_with_limit(string $id, int $limit): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');\n@@ -126,8 +123,6 @@ public function get_bookmarks_with_limit(string $id, int $limit): Response\n     }\n \n     /**\n-     * @Route(\"/me/bookmarks/{limit}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get all bookmarks from a user\",\n@@ -143,6 +138,7 @@ public function get_bookmarks_with_limit(string $id, int $limit): Response\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/me/bookmarks/{limit}\", methods: [\"GET\"])]\n     public function my_bookmarks_with_limit(\n         int $limit,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "353ec173263cf8e44e4e6659469a03fe40ae0234",
                "filename": "api/src/Controller/File/Get.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FFile%2FGet.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FFile%2FGet.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FFile%2FGet.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -23,8 +23,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/files/{id}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a file\",\n@@ -36,6 +34,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/files/{id}\", methods: [\"GET\"])]\n     public function index(string $id): Response\n     {\n         // This controller is public to allow display of public messages"
            },
            {
                "sha": "3a3ef1b7f0fc81785a1f1fc5253b1678141c3ed5",
                "filename": "api/src/Controller/File/GetMiniature.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FFile%2FGetMiniature.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FFile%2FGetMiniature.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FFile%2FGetMiniature.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -17,8 +17,6 @@\n class GetMiniature extends ApiController\n {\n     /**\n-     * @Route(\"/images/{type}/{width}/{height}/{id}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a miniature of a file\",\n@@ -33,6 +31,7 @@ class GetMiniature extends ApiController\n      * @Security(name=\"api_key\")\n      */\n     #[Cache(public: true, maxage: 31536000)]\n+    #[Route(\"/images/{type}/{width}/{height}/{id}\", methods: [\"GET\"])]\n     public function index(\n         string $id,\n         int $width,"
            },
            {
                "sha": "981daf4bc78f80153f92e2fc17efef688f4ccda3",
                "filename": "api/src/Controller/File/Upload.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FFile%2FUpload.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FFile%2FUpload.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FFile%2FUpload.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -30,8 +30,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/files\", methods={\"POST\"})\n-     *\n      * @OA\\RequestBody(\n      *\n      *  @OA\\Schema(\n@@ -55,6 +53,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/files\", methods: [\"POST\"])]\n     public function index(Request $request, ImageService $imageService): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "36d3132ce040ad01beeb7d09f515345b5352579c",
                "filename": "api/src/Controller/Group/AddInvitedUser.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FAddInvitedUser.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FAddInvitedUser.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FGroup%2FAddInvitedUser.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -27,8 +27,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/groups/invitation/{inviteKey}\", methods={\"POST\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Add the logged in user to the group\",\n@@ -40,6 +38,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/groups/invitation/{inviteKey}\", methods: [\"POST\"])]\n     public function index(string $inviteKey): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "4e163d600181f936998c9dc0e472bc5576a1ce4d",
                "filename": "api/src/Controller/Group/Create.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FCreate.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FCreate.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FGroup%2FCreate.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -31,8 +31,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/groups\", methods={\"POST\"})\n-     *\n      * @OA\\RequestBody(\n      *\n      *  @OA\\Schema(\n@@ -56,6 +54,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/groups\", methods: [\"POST\"])]\n     public function index(\n         Request $request,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "574aa6031db051997ff798e2043bf0ee03a56b11",
                "filename": "api/src/Controller/Group/Edit.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FEdit.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FEdit.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FGroup%2FEdit.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -33,8 +33,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/groups/{id}\", methods={\"PUT\"})\n-     *\n      * @OA\\RequestBody(\n      *\n      *  @OA\\Schema(\n@@ -58,6 +56,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/groups/{id}\", methods: [\"PUT\"])]\n     public function index(\n         string $id,\n         Request $request,"
            },
            {
                "sha": "37a49792c216efa5fe2878afa17684d3eeb7450e",
                "filename": "api/src/Controller/Group/Get.php",
                "status": "modified",
                "additions": 7,
                "deletions": 6,
                "changes": 13,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FGet.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FGet.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FGroup%2FGet.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -31,8 +31,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/groups/{id}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a group\",\n@@ -44,6 +42,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/groups/{id}\", methods: [\"GET\"])]\n     public function index(string $id): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');\n@@ -60,8 +59,11 @@ public function index(string $id): Response\n         $data = $this->cache->get($cacheKey, function (ItemInterface $item) use ($group) {\n             $item->expiresAfter(3600 * 24 * 7);\n             $item->tag('group_'.$group->getId());\n-\n-            return $this->serialize($group, ['read_group']);\n+            $serialization_groups = ['read_group'];\n+            if ($this->getParameter('show.group.invitation.links') == 'true') {\n+                $serialization_groups[] = 'read_secret_key';\n+            }\n+            return $this->serialize($group, $serialization_groups);\n         });\n \n         return new Response(\n@@ -71,8 +73,6 @@ public function index(string $id): Response\n     }\n \n     /**\n-     * @Route(\"/groups/{id}/random\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a random message from the group\",\n@@ -84,6 +84,7 @@ public function index(string $id): Response\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/groups/{id}/random\", methods: [\"GET\"])]\n     public function random_message(string $id): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "266315a146a57f5b1909039300319bf814e422e0",
                "filename": "api/src/Controller/Group/GetPage.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FGetPage.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FGetPage.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FGroup%2FGetPage.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -33,8 +33,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/groups/{id}/page/{n}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a group page\",\n@@ -66,6 +64,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/groups/{id}/page/{n}\", methods: [\"GET\"])]\n     public function index(string $id, int $n): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "1618bc2162f1ff67bdcdf7057a20523ecbb33df7",
                "filename": "api/src/Controller/Group/Leave.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FLeave.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FLeave.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FGroup%2FLeave.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -27,8 +27,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/groups/{id}/leave\", methods={\"POST\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Leave a group\",\n@@ -40,6 +38,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/groups/{id}/leave\", methods: [\"POST\"])]\n     public function index(\n         string $id,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "0ce5260ad54b750f0db1a6a13fc423c47b594cbe",
                "filename": "api/src/Controller/Group/ResetInviteKey.php",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FResetInviteKey.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FGroup%2FResetInviteKey.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FGroup%2FResetInviteKey.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -25,8 +25,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/groups/{id}/reset-invite-key\", methods={\"POST\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Reset invite key of a group\",\n@@ -40,12 +38,16 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/groups/{id}/reset-invite-key\", methods: [\"POST\"])]\n     public function index(\n         string $id,\n         #[CurrentUser] User $currentUser\n     ): Response {\n         $this->denyAccessUnlessGranted('ROLE_USER');\n \n+        if ($this->getParameter('show.group.invitation.links') != 'true') {\n+            return new JsonResponse(['error' => 'Invitation link reset is restricted'], JsonResponse::HTTP_FORBIDDEN);\n+        }\n         $group = $this->em->getRepository(Group::class)->findOneById($id);\n         if (empty($group)) {\n             return new JsonResponse(['error' => 'Not Found'], JsonResponse::HTTP_NOT_FOUND);"
            },
            {
                "sha": "966d067c616846d2cb3e1609f0cc09551f284430",
                "filename": "api/src/Controller/Info.php",
                "status": "modified",
                "additions": 4,
                "deletions": 2,
                "changes": 6,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FInfo.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FInfo.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FInfo.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -10,13 +10,12 @@\n class Info extends ApiController\n {\n     /**\n-     * @Route(\"/info\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get informations about the API\",\n      * )\n      */\n+    #[Route('/info', methods: ['GET'])]\n     public function index(): Response\n     {\n         // check if ghostscript is found\n@@ -46,6 +45,9 @@ public function index(): Response\n           ],\n           'default_lang' => $this->getParameter('lang'),\n           'allow_email' => 'true' == $this->getParameter('allow.email'),\n+          'show' => [\n+            'group_invitation_links' => 'true' == $this->getParameter('show.group.invitation.links'),\n+          ]\n         ], JsonResponse::HTTP_OK);\n     }\n }"
            },
            {
                "sha": "8fb250a26c680d2e4148107ed18ca9cda9877100",
                "filename": "api/src/Controller/Link/GetByUrl.php",
                "status": "modified",
                "additions": 2,
                "deletions": 4,
                "changes": 6,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FLink%2FGetByUrl.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FLink%2FGetByUrl.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FLink%2FGetByUrl.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -27,8 +27,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/links/by_url\", methods={\"POST\"})\n-     *\n      * @OA\\RequestBody(\n      *\n      *  @OA\\Schema(\n@@ -73,6 +71,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/links/by_url\", methods: [\"POST\"])]\n     public function getLinkByPost(Request $request): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');\n@@ -89,8 +88,6 @@ public function getLinkByPost(Request $request): Response\n     }\n \n     /**\n-     * @Route(\"/links/by_url\", methods={\"GET\"})\n-     *\n      * @OA\\Parameter(\n      *  name=\"url\",\n      *  in=\"query\",\n@@ -120,6 +117,7 @@ public function getLinkByPost(Request $request): Response\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route(\"/links/by_url\", methods: [\"GET\"])]\n     public function getLinkByGet(Request $request): Response\n     {\n         // No api token verification because this endpoint is used in public posts"
            },
            {
                "sha": "526bc3a8aba5fdfc291ab6afbe8e09ce322f4e06",
                "filename": "api/src/Controller/Message/Create.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FCreate.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FCreate.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FMessage%2FCreate.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -31,8 +31,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/messages\", methods={\"POST\"})\n-     *\n      * @OA\\RequestBody(\n      *\n      *  @OA\\Schema(\n@@ -62,6 +60,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/messages', methods: ['POST'])]\n     public function index(Request $request): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "20e4b1df2f2742ae7ae93d4c9a6a550fab4a9cd2",
                "filename": "api/src/Controller/Message/Delete.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FDelete.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FDelete.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FMessage%2FDelete.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -31,8 +31,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/messages/{id}\", methods={\"DELETE\"})\n-     *\n      * @OA\\Response(\n      *  response=204,\n      *  description=\"Delete a message\"\n@@ -42,6 +40,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/messages/{id}', methods: ['DELETE'])]\n     public function index(\n         string $id,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "e55c6b914d6d18992762a0b13e4a8402e5d6be8a",
                "filename": "api/src/Controller/Message/Edit.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FEdit.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FEdit.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FMessage%2FEdit.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -34,8 +34,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/messages/{id}\", methods={\"PUT\"})\n-     *\n      * @OA\\RequestBody(\n      *\n      *  @OA\\Schema(\n@@ -65,6 +63,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/messages/{id}', methods: ['PUT'])]\n     public function index(\n         string $id,\n         Request $request,"
            },
            {
                "sha": "ca3acc07e604fe8f0c5f23f93db177256cd629fd",
                "filename": "api/src/Controller/Message/Get.php",
                "status": "modified",
                "additions": 2,
                "deletions": 4,
                "changes": 6,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FGet.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FGet.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FMessage%2FGet.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -24,8 +24,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/messages/{id}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a message\",\n@@ -37,6 +35,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/messages/{id}', methods: ['GET'])]\n     public function index(string $id): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');\n@@ -66,8 +65,6 @@ public function index(string $id): Response\n     }\n \n     /**\n-     * @Route(\"/messages/{id}/preview\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a message\",\n@@ -79,6 +76,7 @@ public function index(string $id): Response\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/messages/{id}/preview', methods: ['GET'])]\n     public function preview(string $id): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "d4da7027ce0571ad40bba811f3acfacaa93f4aee",
                "filename": "api/src/Controller/Message/GetPublicLink.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FGetPublicLink.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FGetPublicLink.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FMessage%2FGetPublicLink.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -24,8 +24,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/messages/{id}/get-public-link\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a message's public link token\",\n@@ -39,6 +37,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/messages/{id}/get-public-link', methods: ['GET'])]\n     public function index(string $id): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "bb6ce8eb0145ffd27f6041546bae2ec0d3b4429d",
                "filename": "api/src/Controller/Message/Search.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FSearch.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FMessage%2FSearch.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FMessage%2FSearch.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -45,8 +45,6 @@ public static function has_term($terms, $text): bool\n     }\n \n     /**\n-     * @Route(\"/messages/search\", methods={\"POST\"})\n-     *\n      * @OA\\Parameter(\n      *  name=\"data\",\n      *  in=\"body\",\n@@ -93,6 +91,7 @@ public static function has_term($terms, $text): bool\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/messages/search', methods: ['POST'])]\n     public function index(Request $request): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "df896648699200e5232347e75dad127307ca65bb",
                "filename": "api/src/Controller/Notification/Delete.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FNotification%2FDelete.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FNotification%2FDelete.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FNotification%2FDelete.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -25,8 +25,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/notifications/{id}\", methods={\"DELETE\"})\n-     *\n      * @OA\\Response(\n      *  response=204,\n      *  description=\"Delete a notification\"\n@@ -36,6 +34,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/notifications/{id}', methods: ['DELETE'])]\n     public function index(\n         string $id,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "8ad9490c466c6eb8df39757fdd5c10839a631197",
                "filename": "api/src/Controller/Notification/Edit.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FNotification%2FEdit.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FNotification%2FEdit.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FNotification%2FEdit.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -27,8 +27,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/notifications/{id}\", methods={\"PUT\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Modify a notification\",\n@@ -40,6 +38,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/notifications/{id}', methods: ['PUT'])]\n     public function index(\n         string $id,\n         Request $request,"
            },
            {
                "sha": "f879c90119f68bf04b852ab62642f824fd82c2e6",
                "filename": "api/src/Controller/Notification/Get.php",
                "status": "modified",
                "additions": 3,
                "deletions": 4,
                "changes": 7,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FNotification%2FGet.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FNotification%2FGet.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FNotification%2FGet.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -28,8 +28,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/notifications/{id}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get a notification\",\n@@ -41,6 +39,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/notifications/{id}', methods: ['GET'])]\n     public function index(string $id): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');\n@@ -54,8 +53,8 @@ public function index(string $id): Response\n         if (in_array(\n             $notification->getType(),\n             [\n-              Notification::NEW_COMMENT,\n-              Notification::NEW_MESSAGE,\n+                Notification::NEW_COMMENT,\n+                Notification::NEW_MESSAGE,\n             ]\n         )) {\n             $notification_data_output['parentAuthorName'] = $this->notificationService->getParentAuthorName($notification);"
            },
            {
                "sha": "45e3920814af1040defb826ebc05b6cafa835698",
                "filename": "api/src/Controller/Notification/GetFromUser.php",
                "status": "modified",
                "additions": 4,
                "deletions": 8,
                "changes": 12,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FNotification%2FGetFromUser.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FNotification%2FGetFromUser.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FNotification%2FGetFromUser.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -25,8 +25,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/users/{id}/notifications\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get all notifications from a user\",\n@@ -42,6 +40,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/users/{id}/notifications', methods: ['GET'])]\n     public function get_notifications(string $id): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');\n@@ -60,8 +59,6 @@ public function get_notifications(string $id): Response\n     }\n \n     /**\n-     * @Route(\"/me/notifications\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get all notifications from a user\",\n@@ -77,6 +74,7 @@ public function get_notifications(string $id): Response\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/me/notifications', methods: ['GET'])]\n     public function my_notifications(\n         #[CurrentUser] User $currentUser\n     ): Response {\n@@ -89,8 +87,6 @@ public function my_notifications(\n     }\n \n     /**\n-     * @Route(\"/users/{id}/notifications/{limit}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get recent notifications from a user\",\n@@ -106,6 +102,7 @@ public function my_notifications(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/users/{id}/notifications/{limit}', methods: ['GET'])]\n     public function get_notifications_with_limit(string $id, int $limit): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');\n@@ -126,8 +123,6 @@ public function get_notifications_with_limit(string $id, int $limit): Response\n     }\n \n     /**\n-     * @Route(\"/me/notifications/{limit}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Get all notifications from a user\",\n@@ -143,6 +138,7 @@ public function get_notifications_with_limit(string $id, int $limit): Response\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/me/notifications/{limit}', methods: ['GET'])]\n     public function my_notifications_with_limit(\n         int $limit,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "3d561dde40393e9b8f5f79b98ea3fdb0955482c5",
                "filename": "api/src/Controller/PublicController.php",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FPublicController.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FPublicController.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FPublicController.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -19,9 +19,7 @@ public function __construct(\n         parent::__construct($em, $serializer);\n     }\n \n-    /**\n-     * @Route(\"/public/{token}\", methods={\"GET\"})\n-     */\n+    #[Route('/public/{token}', methods: ['GET'])]\n     public function public(string $token)\n     {\n         $token_data = Token::extract($token);"
            },
            {
                "sha": "1a10774a1788bacac82c24b203fe976a78f9eff2",
                "filename": "api/src/Controller/Security.php",
                "status": "modified",
                "additions": 4,
                "deletions": 12,
                "changes": 16,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FSecurity.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FSecurity.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FSecurity.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -40,9 +40,7 @@ public function __construct(\n         $this->limiter = $limiter;\n     }\n \n-    /**\n-     * @Route(\"/login\", methods={\"POST\"})\n-     */\n+    #[Route('/login', methods: ['POST'])]\n     public function login(Request $request): Response\n     {\n         $data = json_decode($request->getContent(), true);\n@@ -79,9 +77,7 @@ public function login(Request $request): Response\n         return $this->json(['api_key' => $user->getSecretKey()], Response::HTTP_OK);\n     }\n \n-    /**\n-     * @Route(\"/signup\", methods={\"POST\"})\n-     */\n+    #[Route('/signup', methods: ['POST'])]\n     public function signup(Request $request): Response\n     {\n         $data = json_decode($request->getContent(), true);\n@@ -151,9 +147,7 @@ public function signup(Request $request): Response\n         return $this->json(['api_key' => $user->getSecretKey()], Response::HTTP_OK);\n     }\n \n-    /**\n-     * @Route(\"/password-reset-mail\", methods={\"POST\"})\n-     */\n+    #[Route('/password-reset-mail', methods: ['POST'])]\n     public function sendPasswordResetMail(Request $request): Response\n     {\n         $data = json_decode($request->getContent(), true);\n@@ -170,9 +164,7 @@ public function sendPasswordResetMail(Request $request): Response\n         }\n     }\n \n-    /**\n-     * @Route(\"/new-password\", methods={\"POST\"})\n-     */\n+    #[Route('/new-password', methods: ['POST'])]\n     public function newPassword(Request $request): Response\n     {\n         $data = json_decode($request->getContent(), true);"
            },
            {
                "sha": "be90b69c55ce5398b33738359e4fd1cab50cfe4f",
                "filename": "api/src/Controller/StopNotificationEmails.php",
                "status": "modified",
                "additions": 1,
                "deletions": 3,
                "changes": 4,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FStopNotificationEmails.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FStopNotificationEmails.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FStopNotificationEmails.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -18,9 +18,7 @@ public function __construct(EntityManagerInterface $em)\n         $this->em = $em;\n     }\n \n-    /**\n-     * @Route(\"/stop-notification-emails/{user_id}/{token}\", methods={\"GET\"})\n-     */\n+    #[Route('/public/{user_id}/{token}', methods: ['GET'])]\n     public function login(string $user_id, string $token)\n     {\n         $user = $this->em->getRepository(User::class)->findOneById($user_id);"
            },
            {
                "sha": "a04b3e8e32fb5bccfa423d2d259105210b5f456e",
                "filename": "api/src/Controller/User/Delete.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FUser%2FDelete.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FUser%2FDelete.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FUser%2FDelete.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -24,8 +24,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/users/{id}\", methods={\"DELETE\"})\n-     *\n      * @OA\\Response(\n      *  response=204,\n      *  description=\"Delete a user\",\n@@ -35,6 +33,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/users/{id}', methods: ['DELETE'])]\n     public function index(\n         string $id,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "a0c5a42e59286fd9c799328762775c5ea86502cc",
                "filename": "api/src/Controller/User/Edit.php",
                "status": "modified",
                "additions": 4,
                "deletions": 8,
                "changes": 12,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FUser%2FEdit.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FUser%2FEdit.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FUser%2FEdit.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -32,8 +32,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/bookmarks/{id}\", methods={\"POST\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Register a bookmark\",\n@@ -45,6 +43,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/bookmarks/{id}', methods: ['POST'])]\n     public function post_bookmark(\n         string $id,\n         #[CurrentUser] User $user\n@@ -69,8 +68,6 @@ public function post_bookmark(\n     }\n \n     /**\n-     * @Route(\"/bookmarks/{id}\", methods={\"DELETE\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Unregister a bookmark\",\n@@ -82,6 +79,7 @@ public function post_bookmark(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/bookmarks/{id}', methods: ['DELETE'])]\n     public function delete_bookmark(\n         string $id,\n         #[CurrentUser] User $user\n@@ -110,8 +108,6 @@ function ($e) use ($id) {\n     }\n \n     /**\n-     * @Route(\"/users/{id}\", methods={\"PUT\"})\n-     *\n      * @OA\\RequestBody(\n      *\n      *  @OA\\Schema(\n@@ -156,6 +152,7 @@ function ($e) use ($id) {\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/users/{id}', methods: ['PUT'])]\n     public function index(\n         string $id,\n         Request $request,\n@@ -207,8 +204,6 @@ public function index(\n     }\n \n     /**\n-     * @Route(\"/users/{id}/reset-api-key\", methods={\"POST\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Reset a user api key\",\n@@ -220,6 +215,7 @@ public function index(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/users/{id}/reset-api-key', methods: ['POST'])]\n     public function resetApiKey(\n         string $id,\n         #[CurrentUser] User $currentUser"
            },
            {
                "sha": "d26034ae862b524e8eb7a260006a3ce7db450825",
                "filename": "api/src/Controller/User/Get.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FUser%2FGet.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FUser%2FGet.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FUser%2FGet.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -24,8 +24,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/users/{id}\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Returns a user given its id\",\n@@ -37,6 +35,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/users/{id}', methods: ['GET'])]\n     #[Cache(public: true, maxage: 86400)]\n     public function index(string $id): Response\n     {"
            },
            {
                "sha": "868442b24dde3f2ddb17208d2c02c30538ace499",
                "filename": "api/src/Controller/User/Me.php",
                "status": "modified",
                "additions": 1,
                "deletions": 2,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FUser%2FMe.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FController%2FUser%2FMe.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FController%2FUser%2FMe.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -21,8 +21,6 @@ public function __construct(\n     }\n \n     /**\n-     * @Route(\"/me\", methods={\"GET\"})\n-     *\n      * @OA\\Response(\n      *  response=200,\n      *  description=\"Returns the current logged in user\",\n@@ -34,6 +32,7 @@ public function __construct(\n      *\n      * @Security(name=\"api_key\")\n      */\n+    #[Route('/me', methods: ['GET'])]\n     public function index(): Response\n     {\n         $this->denyAccessUnlessGranted('ROLE_USER');"
            },
            {
                "sha": "e8066e3f0f8337ee97cae9ba89b4864c09355a5d",
                "filename": "api/src/Entity/File.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FEntity%2FFile.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FEntity%2FFile.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FEntity%2FFile.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -179,7 +179,7 @@ public function getFile()\n      * must be able to accept an instance of 'File' as the bundle will inject one here\n      * during Doctrine hydration.\n      *\n-     * @param File|\\Symfony\\Component\\HttpFoundation\\File\\UploadedFile $file\n+     * @param File|UploadedFile $file\n      */\n     public function setFile($file = null): void\n     {"
            },
            {
                "sha": "6ffe0721fca29ea0e086843b69968edd31624365",
                "filename": "api/src/Entity/Group.php",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FEntity%2FGroup.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FEntity%2FGroup.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FEntity%2FGroup.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -33,7 +33,7 @@ class Group extends ApiEntity\n     /**\n      * @ORM\\Column(type=\"string\", unique=true)\n      *\n-     * @Groups({\"read_group\"})\n+     * @Groups({\"read_secret_key\"})\n      *\n      * @Assert\\NotBlank()\n      *"
            },
            {
                "sha": "54fc233f5662c483ac17192d62269d742752b90e",
                "filename": "api/src/Normalizer/ObjectNormalizer.php",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FNormalizer%2FObjectNormalizer.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FNormalizer%2FObjectNormalizer.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FNormalizer%2FObjectNormalizer.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -102,7 +102,7 @@ protected function isMaxTreeDepth($object, &$context)\n      *\n      * @throws MaxTreeDepthException\n      */\n-    protected function handleMaxTreeDepth($object, string $format = null, array $context = [])\n+    protected function handleMaxTreeDepth($object, ?string $format = null, array $context = [])\n     {\n         $maxTreeDepthHandler = $context[self::MAX_TREE_DEPTH_HANDLER] ?? $this->defaultContext[self::MAX_TREE_DEPTH_HANDLER];\n         if ($maxTreeDepthHandler) {\n@@ -140,7 +140,7 @@ public function normalize($object, $format = null, array $context = [])\n         return $this->normalizer->normalize($object, $format, $context);\n     }\n \n-    public function supportsNormalization($data, string $format = null, array $context = []): bool\n+    public function supportsNormalization($data, ?string $format = null, array $context = []): bool\n     {\n         return $data instanceof ApiEntity;\n     }\n@@ -150,17 +150,17 @@ public function getSupportedTypes(?string $format): array\n         return $this->normalizer->getSupportedTypes($format);\n     }\n \n-    protected function setAttributeValue(object $object, string $attribute, mixed $value, string $format = null, array $context = [])\n+    protected function setAttributeValue(object $object, string $attribute, mixed $value, ?string $format = null, array $context = [])\n     {\n         $this->normalizer->setAttributeValue($object, $attribute, $value, $format, $context);\n     }\n \n-    protected function getAttributeValue(object $object, string $attribute, string $format = null, array $context = []): mixed\n+    protected function getAttributeValue(object $object, string $attribute, ?string $format = null, array $context = []): mixed\n     {\n         return $this->normalizer->getAttributeValue($object, $attribute, $format, $context);\n     }\n \n-    protected function extractAttributes(object $object, string $format = null, array $context = []): array\n+    protected function extractAttributes(object $object, ?string $format = null, array $context = []): array\n     {\n         return $this->normalizer->extractAttributes($object, $format, $context);\n     }"
            },
            {
                "sha": "a00ad545790dd5ea5d2924b485d1d2a34d6b92d9",
                "filename": "api/src/Security/AccessDeniedHandler.php",
                "status": "removed",
                "additions": 0,
                "deletions": 20,
                "changes": 20,
                "blob_url": "https://github.com/zusam/zusam/blob/e2d688af1aa25f0dd1055141e516982f033a77ef/api%2Fsrc%2FSecurity%2FAccessDeniedHandler.php",
                "raw_url": "https://github.com/zusam/zusam/raw/e2d688af1aa25f0dd1055141e516982f033a77ef/api%2Fsrc%2FSecurity%2FAccessDeniedHandler.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FSecurity%2FAccessDeniedHandler.php?ref=e2d688af1aa25f0dd1055141e516982f033a77ef",
                "patch": "@@ -1,20 +0,0 @@\n-<?php\n-\n-namespace App\\Security;\n-\n-use Symfony\\Component\\HttpFoundation\\Request;\n-use Symfony\\Component\\HttpFoundation\\Response;\n-use Symfony\\Component\\Security\\Core\\Exception\\AccessDeniedException;\n-use Symfony\\Component\\Security\\Http\\Authorization\\AccessDeniedHandlerInterface;\n-\n-class AccessDeniedHandler implements AccessDeniedHandlerInterface\n-{\n-    public function handle(Request $request, AccessDeniedException $accessDeniedException): Response\n-    {\n-        return new Response(\n-            '{\"message\":\"Access denied\"}',\n-            Response::HTTP_FORBIDDEN,\n-            ['Content-type' => 'application/json']\n-        );\n-    }\n-}"
            },
            {
                "sha": "424b3ad64f9e6a9de7a3ef3aaea71157e1cf8537",
                "filename": "api/src/Security/ApiKeyAuthenticator.php",
                "status": "modified",
                "additions": 17,
                "deletions": 45,
                "changes": 62,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FSecurity%2FApiKeyAuthenticator.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FSecurity%2FApiKeyAuthenticator.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FSecurity%2FApiKeyAuthenticator.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -2,58 +2,30 @@\n \n namespace App\\Security;\n \n-use Symfony\\Component\\HttpFoundation\\JsonResponse;\n-use Symfony\\Component\\HttpFoundation\\Request;\n-use Symfony\\Component\\HttpFoundation\\Response;\n-use Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;\n-use Symfony\\Component\\Security\\Core\\Exception\\AuthenticationException;\n-use Symfony\\Component\\Security\\Core\\Exception\\CustomUserMessageAuthenticationException;\n-use Symfony\\Component\\Security\\Http\\Authenticator\\AbstractAuthenticator;\n+use App\\Entity\\User;\n+use Doctrine\\ORM\\EntityManagerInterface;\n+use Symfony\\Component\\Security\\Core\\Exception\\BadCredentialsException;\n+use Symfony\\Component\\Security\\Http\\AccessToken\\AccessTokenHandlerInterface;\n use Symfony\\Component\\Security\\Http\\Authenticator\\Passport\\Badge\\UserBadge;\n-use Symfony\\Component\\Security\\Http\\Authenticator\\Passport\\Passport;\n-use Symfony\\Component\\Security\\Http\\Authenticator\\Passport\\SelfValidatingPassport;\n \n-// https://symfony.com/index.php/doc/current/security/custom_authenticator.html\n-class ApiKeyAuthenticator extends AbstractAuthenticator\n+// https://symfony.com/doc/current/security/access_token.html#using-the-access-token-authenticator\n+class ApiKeyAuthenticator implements AccessTokenHandlerInterface\n {\n-    /**\n-     * Called on every request to decide if this authenticator should be\n-     * used for the request. Returning false will cause this authenticator\n-     * to be skipped.\n-     */\n-    public function supports(Request $request): ?bool\n-    {\n-        return $request->headers->has('X-AUTH-TOKEN');\n-    }\n-\n-    /**\n-     * Called on every request. Return whatever credentials you want to\n-     * be passed to getUser() as $credentials.\n-     */\n-    public function authenticate(Request $request): Passport\n-    {\n-        $apiToken = $request->headers->get('X-AUTH-TOKEN');\n-        if (null === $apiToken) {\n-            // The token header was empty, authentication fails with HTTP Status\n-            // Code 401 \"Unauthorized\"\n-            throw new CustomUserMessageAuthenticationException('No API token provided');\n-        }\n+    private $em;\n \n-        return new SelfValidatingPassport(new UserBadge($apiToken));\n+    public function __construct(\n+        EntityManagerInterface $em,\n+    ) {\n+        $this->em = $em;\n     }\n \n-    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $firewallName): ?Response\n+    public function getUserBadgeFrom(string $apiKey): UserBadge\n     {\n-        // on success, let the request continue\n-        return null;\n-    }\n-\n-    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): ?Response\n-    {\n-        $data = [\n-          'message' => strtr($exception->getMessageKey(), $exception->getMessageData()),\n-        ];\n+        $user = $this->em->getRepository(User::class)->findOneBySecretKey($apiKey);\n+        if (null === $user->getSecretKey()) {\n+            throw new BadCredentialsException('Invalid credentials.');\n+        }\n \n-        return new JsonResponse($data, Response::HTTP_UNAUTHORIZED);\n+        return new UserBadge($user->getSecretKey());\n     }\n }"
            },
            {
                "sha": "5750cfab6d1b732e73a05fe2f35df5f8f0edaaa4",
                "filename": "api/src/Security/ApiKeyExtractor.php",
                "status": "added",
                "additions": 39,
                "deletions": 0,
                "changes": 39,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FSecurity%2FApiKeyExtractor.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FSecurity%2FApiKeyExtractor.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FSecurity%2FApiKeyExtractor.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,39 @@\n+<?php\n+\n+namespace App\\Security;\n+\n+use Symfony\\Component\\HttpFoundation\\Request;\n+use Symfony\\Component\\Security\\Http\\AccessToken\\AccessTokenExtractorInterface;\n+\n+/**\n+ * Extracts a token from the request header.\n+ *\n+ * @see https://github.com/symfony/symfony/blob/6.3/src/Symfony/Component/Security/Http/AccessToken/HeaderAccessTokenExtractor.php\n+ */\n+final class ApiKeyExtractor implements AccessTokenExtractorInterface\n+{\n+    private string $regex;\n+\n+    public function __construct(\n+        private readonly string $headerParameter = 'X-AUTH-TOKEN',\n+        private readonly string $tokenType = ''\n+    ) {\n+        $this->regex = sprintf(\n+            '/^%s([a-zA-Z0-9\\-_\\+~\\/\\.]+)$/',\n+            '' === $this->tokenType ? '' : preg_quote($this->tokenType).'\\s+'\n+        );\n+    }\n+\n+    public function extractAccessToken(Request $request): ?string\n+    {\n+        if (!$request->headers->has($this->headerParameter) || !\\is_string($header = $request->headers->get($this->headerParameter))) {\n+            return null;\n+        }\n+\n+        if (preg_match($this->regex, $header, $matches)) {\n+            return $matches[1];\n+        }\n+\n+        return null;\n+    }\n+}"
            },
            {
                "sha": "ee1345967f191c5dc8cfc3b65691f5a91b7f8615",
                "filename": "api/src/Security/EntryPointService.php",
                "status": "removed",
                "additions": 0,
                "deletions": 20,
                "changes": 20,
                "blob_url": "https://github.com/zusam/zusam/blob/e2d688af1aa25f0dd1055141e516982f033a77ef/api%2Fsrc%2FSecurity%2FEntryPointService.php",
                "raw_url": "https://github.com/zusam/zusam/raw/e2d688af1aa25f0dd1055141e516982f033a77ef/api%2Fsrc%2FSecurity%2FEntryPointService.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FSecurity%2FEntryPointService.php?ref=e2d688af1aa25f0dd1055141e516982f033a77ef",
                "patch": "@@ -1,20 +0,0 @@\n-<?php\n-\n-namespace App\\Security;\n-\n-use Symfony\\Component\\HttpFoundation\\Request;\n-use Symfony\\Component\\HttpFoundation\\Response;\n-use Symfony\\Component\\Security\\Core\\Exception\\AuthenticationException;\n-use Symfony\\Component\\Security\\Http\\EntryPoint\\AuthenticationEntryPointInterface;\n-\n-class EntryPointService implements AuthenticationEntryPointInterface\n-{\n-    public function start(Request $request, AuthenticationException $authException = null)\n-    {\n-        return new Response(\n-            '{\"message\":\"unauthorized\"}',\n-            Response::HTTP_UNAUTHORIZED,\n-            ['Content-type' => 'application/json']\n-        );\n-    }\n-}"
            },
            {
                "sha": "9e3c7b5281e30cd1b7ea5aa55c2714f169435b6d",
                "filename": "api/src/Service/Mailer.php",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FService%2FMailer.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FService%2FMailer.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FService%2FMailer.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -16,6 +16,7 @@ class Mailer\n     private $logger;\n     private $symfonyMailer;\n     private $twig;\n+    private Url $url;\n \n     public function __construct(\n         \\Twig\\Environment $twig,\n@@ -25,6 +26,7 @@ public function __construct(\n         string $env,\n         LoggerInterface $logger,\n         MailerInterface $symfonyMailer,\n+        Url $url,\n     ) {\n         $this->allow_email = $allow_email;\n         $this->domain = $domain;\n@@ -33,6 +35,7 @@ public function __construct(\n         $this->logger = $logger;\n         $this->symfonyMailer = $symfonyMailer;\n         $this->twig = $twig;\n+        $this->url = $url;\n     }\n \n     private function sendMail($email)\n@@ -74,7 +77,7 @@ public function sendNotificationEmail(User $user, array $notifications = [])\n                 $this->twig->render(\n                     \"notification-email.$lang.txt.twig\",\n                     [\n-                        'domain' => $this->domain,\n+                        'base_url' => $this->url->getBaseUrl(),\n                         'notifications' => $notifications,\n                         'user' => $user,\n                         'unsubscribe_token' => $unsubscribe_token,\n@@ -110,8 +113,7 @@ public function sendPasswordReset(User $user)\n                     \"password-reset-mail.$lang.txt.twig\",\n                     [\n                         'name' => ucfirst($user->getName()),\n-                        'url' => 'https://'\n-                        .$this->domain\n+                        'url' => $this->url->getBaseUrl()\n                         .'/password-reset'\n                         .'?mail='.urlencode($user->getLogin())\n                         .'&key='.$token,"
            },
            {
                "sha": "41b8408a28acfc3d59f1e0b232833dc74c78a7dc",
                "filename": "api/src/Service/Token.php",
                "status": "modified",
                "additions": 8,
                "deletions": 0,
                "changes": 8,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FService%2FToken.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FService%2FToken.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FService%2FToken.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -35,4 +35,12 @@ public static function extract(string $jwt): array\n             return [];\n         }\n     }\n+\n+    public static function is_uuid(string $uuid): bool\n+    {\n+        // Regular expression to match a valid UUID\n+        $pattern = '/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i';\n+\n+        return 1 === preg_match($pattern, $uuid);\n+    }\n }"
            },
            {
                "sha": "75267f92435db9b7f4eadbd139f436166b270fb0",
                "filename": "api/src/Service/Url.php",
                "status": "modified",
                "additions": 59,
                "deletions": 50,
                "changes": 109,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FService%2FUrl.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FService%2FUrl.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FService%2FUrl.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -56,6 +56,15 @@ public function getLink($url, $rescan = false): ?Link\n         return $this->linkService->hydrateLink($link);\n     }\n \n+    public function getBaseUrl(): string\n+    {\n+        $protocol = $this->params->get('protocol');\n+        $domain = $this->params->get('domain');\n+        $port = $this->params->get('port');\n+\n+        return $protocol . '://' . $domain . ($port ? ':' . $port : '');\n+    }\n+\n     // taken from https://github.com/guzzle/psr7/blob/089edd38f5b8abba6cb01567c2a8aaa47cec4c72/src/Uri.php#L166\n     public static function composeComponents(?string $scheme, ?string $authority, string $path, ?string $query, ?string $fragment): string\n     {\n@@ -101,22 +110,22 @@ public static function getInstagramData(string $url): array\n             $data = json_decode($res->getBody(), true);\n \n             return [\n-        'authorName' => $data['author_name'],\n-        'authorUrl' => $data['author_url'],\n-        'code' => $data['html'],\n-        'description' => $data['title'],\n-        'thumbnail_url' => $data['thumbnail_url'],\n-        'image' => $data['thumbnail_url'],\n-        'origin' => $url,\n-        'title' => $data['author_name'],\n-        'providerName' => $data['provider_name'],\n-        'providerUrl' => $data['provider_url'],\n-      ];\n+                'authorName' => $data['author_name'],\n+                'authorUrl' => $data['author_url'],\n+                'code' => $data['html'],\n+                'description' => $data['title'],\n+                'thumbnail_url' => $data['thumbnail_url'],\n+                'image' => $data['thumbnail_url'],\n+                'origin' => $url,\n+                'title' => $data['author_name'],\n+                'providerName' => $data['provider_name'],\n+                'providerUrl' => $data['provider_url'],\n+            ];\n         } catch (\\Exception $e) {\n             return [\n-        'origin' => $url, // The original input url\n-        'exception' => $e->getMessage(),\n-      ];\n+                'origin' => $url, // The original input url\n+                'exception' => $e->getMessage(),\n+            ];\n         }\n     }\n \n@@ -127,44 +136,44 @@ public static function getEmbedData(string $url): array\n             $info = $embed->get(Url::exceptionRedirect($url));\n \n             return [\n-        'title' => $info->title, // The page title\n-        'description' => $info->description, // The page description\n-        'url' => Url::composeComponents( // The canonical url\n-            $info->url->getScheme(),\n-            $info->url->getAuthority(),\n-            $info->url->getPath(),\n-            $info->url->getQuery(),\n-            $info->url->getFragment(),\n-        ),\n-        'keywords' => $info->keywords, // The page keywords (tags)\n-\n-        'image' => $info->image, // The image choosen as main image\n-\n-        'code' => $info->code ? $info->code->html : null, // The code to embed the image, video, etc\n-\n-        'authorName' => $info->authorName, // The resource author\n-        'authorUrl' => $info->authorUrl, // The author url\n-\n-        'cms' => $info->cms, // The cms used\n-        'language' => $info->language, // The language of the page\n-        'languages' => $info->languages, // The alternative languages\n-\n-        'providerName' => $info->providerName, // The provider name of the page (Youtube, Twitter, Instagram, etc)\n-        'providerUrl' => $info->providerUrl, // The provider url\n-        'icon' => $info->icon, // The big icon of the site\n-        'favicon' => $info->favicon, // The favicon of the site (an .ico file or a png with up to 32x32px)\n-\n-        'publishedTime' => $info->publishedTime, // The published time of the resource\n-        'license' => $info->license, // The license url of the resource\n-        'feeds' => $info->feeds, // The RSS/Atom feeds\n-        'content-type' => $info->getResponse()->getHeader('content-Type'), // The content type of the url\n-        'origin' => $url, // The original input url\n-      ];\n+                'title' => $info->title, // The page title\n+                'description' => $info->description, // The page description\n+                'url' => Url::composeComponents( // The canonical url\n+                    $info->url->getScheme(),\n+                    $info->url->getAuthority(),\n+                    $info->url->getPath(),\n+                    $info->url->getQuery(),\n+                    $info->url->getFragment(),\n+                ),\n+                'keywords' => $info->keywords, // The page keywords (tags)\n+\n+                'image' => $info->image, // The image choosen as main image\n+\n+                'code' => $info->code ? $info->code->html : null, // The code to embed the image, video, etc\n+\n+                'authorName' => $info->authorName, // The resource author\n+                'authorUrl' => $info->authorUrl, // The author url\n+\n+                'cms' => $info->cms, // The cms used\n+                'language' => $info->language, // The language of the page\n+                'languages' => $info->languages, // The alternative languages\n+\n+                'providerName' => $info->providerName, // The provider name of the page (Youtube, Twitter, Instagram, etc)\n+                'providerUrl' => $info->providerUrl, // The provider url\n+                'icon' => $info->icon, // The big icon of the site\n+                'favicon' => $info->favicon, // The favicon of the site (an .ico file or a png with up to 32x32px)\n+\n+                'publishedTime' => $info->publishedTime, // The published time of the resource\n+                'license' => $info->license, // The license url of the resource\n+                'feeds' => $info->feeds, // The RSS/Atom feeds\n+                'content-type' => $info->getResponse()->getHeader('content-Type'), // The content type of the url\n+                'origin' => $url, // The original input url\n+            ];\n         } catch (\\Exception $e) {\n             return [\n-        'origin' => $url, // The original input url\n-        'exception' => $e->getMessage(),\n-      ];\n+                'origin' => $url, // The original input url\n+                'exception' => $e->getMessage(),\n+            ];\n         }\n     }\n "
            },
            {
                "sha": "5a0f7d8ef1c9a5b1188b53645f6d1e711560f881",
                "filename": "api/src/Service/Uuid.php",
                "status": "modified",
                "additions": 7,
                "deletions": 7,
                "changes": 14,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FService%2FUuid.php",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Fsrc%2FService%2FUuid.php",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Fsrc%2FService%2FUuid.php?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -10,7 +10,7 @@ class Uuid\n      *     xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\n      * where y is one of: [8, 9, A, B].\n      */\n-    public static function uuidv4(string $seed = null): string\n+    public static function uuidv4(?string $seed = null): string\n     {\n         if (null == $seed) {\n             return uuid_create(UUID_TYPE_RANDOM);\n@@ -21,11 +21,11 @@ public static function uuidv4(string $seed = null): string\n         $num = intval(preg_replace(\"/[^\\d]/\", '', substr($str, 0, 10)));\n \n         return implode('-', [\n-      substr($str, 0, 8),\n-      substr($str, 8, 4),\n-      4 .substr($str, 12, 3),\n-      [8, 9, 'a', 'b'][$num % 4].substr($str, 15, 3),\n-      substr($str, 18, 12),\n-    ]);\n+            substr($str, 0, 8),\n+            substr($str, 8, 4),\n+            4 .substr($str, 12, 3),\n+            [8, 9, 'a', 'b'][$num % 4].substr($str, 15, 3),\n+            substr($str, 18, 12),\n+        ]);\n     }\n }"
            },
            {
                "sha": "8d4fb90df1dc228c96a120d5530994c624d47c8e",
                "filename": "api/templates/notification-email.en_US.txt.twig",
                "status": "renamed",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fnotification-email.en_US.txt.twig",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fnotification-email.en_US.txt.twig",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Ftemplates%2Fnotification-email.en_US.txt.twig?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -4,12 +4,12 @@ There is something new in Zusam!\n You can see these new messages by going to the following links:\n {% for notification in notifications %}\n {% if notification.type == 'new_message' %}\n-- https://{{ domain }}/messages/{{ notification.target }}\n+- {{ base_url }}/messages/{{ notification.target }}\n {% endif %}\n {% if notification.type == 'new_comment' %}\n-- https://{{ domain }}/messages/{{ notification.fromMessage.id }}/{{ notification.target }}\n+- {{ base_url }}/messages/{{ notification.fromMessage.id }}/{{ notification.target }}\n {% endif %}\n {% endfor %}\n \n If you do not want to receive this email anymore, you can deactivate it in your settings or click on the following link:\n-https://{{ domain }}/stop-notification-emails/{{ user.id }}/{{ unsubscribe_token }}\n+{{ base_url }}/stop-notification-emails/{{ user.id }}/{{ unsubscribe_token }}\n\\ No newline at end of file",
                "previous_filename": "api/templates/notification-email.en.txt.twig"
            },
            {
                "sha": "65cfa824bdd33db6989422d13926038c36dc3179",
                "filename": "api/templates/notification-email.es_ES.txt.twig",
                "status": "renamed",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fnotification-email.es_ES.txt.twig",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fnotification-email.es_ES.txt.twig",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Ftemplates%2Fnotification-email.es_ES.txt.twig?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -4,12 +4,12 @@ Hola {{ name }},\n Puedes ver estos nuevos mensajes en los siguientes enlaces:\n {% for notification in notifications %}\n {% if notification.type == 'new_message' %}\n-- https://{{ domain }}/messages/{{ notification.target }}\n+- {{ base_url }}/messages/{{ notification.target }}\n {% endif %}\n {% if notification.type == 'new_comment' %}\n-- https://{{ domain }}/messages/{{ notification.fromMessage.id }}/{{ notification.target }}\n+- {{ base_url }}/messages/{{ notification.fromMessage.id }}/{{ notification.target }}\n {% endif %}\n {% endfor %}\n \n Si ya no desea recibir este correo, puede desactivarlo en su configuraci\u00f3n o hacer clic en el siguiente enlace:\n-https://{{ domain }}/stop-notification-emails/{{ user.id }}/{{ unsubscribe_token }}\n+{{ base_url }}/stop-notification-emails/{{ user.id }}/{{ unsubscribe_token }}",
                "previous_filename": "api/templates/notification-email.es.txt.twig"
            },
            {
                "sha": "9c5ccc7d098ea98dc0c4289b015dc530a31e41a9",
                "filename": "api/templates/notification-email.fr_FR.txt.twig",
                "status": "renamed",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fnotification-email.fr_FR.txt.twig",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fnotification-email.fr_FR.txt.twig",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Ftemplates%2Fnotification-email.fr_FR.txt.twig?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -4,12 +4,12 @@ Il y a du nouveau sur Zusam !\n Vous pouvez voir ces nouveaux messages en vous rendant sur les liens suivants :\n {% for notification in notifications %}\n {% if notification.type == 'new_message' %}\n-- https://{{ domain }}/messages/{{ notification.target }}\n+- {{ base_url }}/messages/{{ notification.target }}\n {% endif %}\n {% if notification.type == 'new_comment' %}\n-- https://{{ domain }}/messages/{{ notification.fromMessage.id }}/{{ notification.target }}\n+- {{ base_url }}/messages/{{ notification.fromMessage.id }}/{{ notification.target }}\n {% endif %}\n {% endfor %}\n \n Si vous ne voulez plus recevoir ces emails vous pouvez les d\u00e9sactiver dans vos param\u00e8tres ou cliquer sur le lien suivant :\n-https://{{ domain }}/stop-notification-emails/{{ user.id }}/{{ unsubscribe_token }}\n+{{ base_url }}/stop-notification-emails/{{ user.id }}/{{ unsubscribe_token }}",
                "previous_filename": "api/templates/notification-email.fr.txt.twig"
            },
            {
                "sha": "e9a82c755e22f82658aba0d808f00511441c6a50",
                "filename": "api/templates/notification-email.sk_SK.txt.twig",
                "status": "renamed",
                "additions": 3,
                "deletions": 3,
                "changes": 6,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fnotification-email.sk_SK.txt.twig",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fnotification-email.sk_SK.txt.twig",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Ftemplates%2Fnotification-email.sk_SK.txt.twig?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -4,12 +4,12 @@ Na Zusam-e m\u00e1\u0161 nov\u00e9 pr\u00edspevky!\n M\u00f4\u017ee\u0161 si ich pozriet na nasledovnom odkazoch:\n {% for notification in notifications %}\n {% if notification.type == 'new_message' %}\n-- https://{{ domain }}/messages/{{ notification.target }}\n+- {{ base_url }}/messages/{{ notification.target }}\n {% endif %}\n {% if notification.type == 'new_comment' %}\n-- https://{{ domain }}/messages/{{ notification.fromMessage.id }}/{{ notification.target }}\n+- {{ base_url }}/messages/{{ notification.fromMessage.id }}/{{ notification.target }}\n {% endif %}\n {% endfor %}\n \n Ak nechce\u0161 dost\u00e1va\u0165 tento email, m\u00f4\u017ee\u0161 to vypn\u00fa\u0165 v tvojich nastaveniach alebo klikn\u00fa\u0165 na nasleduj\u00faci odkaz:\n-https://{{ domain }}/stop-notification-emails/{{ user.id }}/{{ unsubscribe_token }}\n+{{ base_url }}/stop-notification-emails/{{ user.id }}/{{ unsubscribe_token }}",
                "previous_filename": "api/templates/notification-email.sk.txt.twig"
            },
            {
                "sha": "2b275adfa9fa22d4611cec0d8c4eaec3970b1a59",
                "filename": "api/templates/password-reset-mail.en_US.txt.twig",
                "status": "renamed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fpassword-reset-mail.en_US.txt.twig",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fpassword-reset-mail.en_US.txt.twig",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Ftemplates%2Fpassword-reset-mail.en_US.txt.twig?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "previous_filename": "api/templates/password-reset-mail.en.txt.twig"
            },
            {
                "sha": "22fe903e9b473f2e387e67ac636ef16ca1de4af3",
                "filename": "api/templates/password-reset-mail.es_ES.txt.twig",
                "status": "renamed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fpassword-reset-mail.es_ES.txt.twig",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fpassword-reset-mail.es_ES.txt.twig",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Ftemplates%2Fpassword-reset-mail.es_ES.txt.twig?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "previous_filename": "api/templates/password-reset-mail.es.txt.twig"
            },
            {
                "sha": "7dd46c0cb9e8f783cd9423268c79a1a4e9f09d8a",
                "filename": "api/templates/password-reset-mail.fr_FR.txt.twig",
                "status": "renamed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fpassword-reset-mail.fr_FR.txt.twig",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fpassword-reset-mail.fr_FR.txt.twig",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Ftemplates%2Fpassword-reset-mail.fr_FR.txt.twig?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "previous_filename": "api/templates/password-reset-mail.fr.txt.twig"
            },
            {
                "sha": "54d5fc5dd4a94939fb50823773617c55c5808985",
                "filename": "api/templates/password-reset-mail.sk_SK.txt.twig",
                "status": "renamed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fpassword-reset-mail.sk_SK.txt.twig",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/api%2Ftemplates%2Fpassword-reset-mail.sk_SK.txt.twig",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/api%2Ftemplates%2Fpassword-reset-mail.sk_SK.txt.twig?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "previous_filename": "api/templates/password-reset-mail.sk.txt.twig"
            },
            {
                "sha": "3dc1a0ce72328231f7c5e880db6d36849dc0b32e",
                "filename": "app/.eslintrc.json",
                "status": "removed",
                "additions": 0,
                "deletions": 31,
                "changes": 31,
                "blob_url": "https://github.com/zusam/zusam/blob/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2F.eslintrc.json",
                "raw_url": "https://github.com/zusam/zusam/raw/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2F.eslintrc.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2F.eslintrc.json?ref=e2d688af1aa25f0dd1055141e516982f033a77ef",
                "patch": "@@ -1,31 +0,0 @@\n-{\n-  \"env\": {\n-    \"browser\": true,\n-    \"es2021\": true\n-  },\n-  \"extends\": [\n-    \"eslint:recommended\",\n-    \"preact\"\n-  ],\n-  \"parserOptions\": {\n-    \"ecmaFeatures\": {\n-      \"jsx\": true\n-    },\n-    \"ecmaVersion\": \"latest\",\n-    \"sourceType\": \"module\"\n-  },\n-  \"rules\": {\n-    \"react-hooks/exhaustive-deps\": [\"off\"],\n-    \"indent\": [\"error\", 2 ],\n-    \"linebreak-style\": [\"error\", \"unix\"],\n-    \"quotes\": [\"error\", \"double\" ],\n-    \"semi\": [\"error\", \"always\" ],\n-    \"react/no-danger\": [\"off\"]\n-  },\n-  \"settings\": {\n-      \"jest\": {\n-          \"version\": \"latest\"\n-      }\n-  }\n-}\n-"
            },
            {
                "sha": "1ae6a4fe43a872c68cb38db5635494fffa7cbbbf",
                "filename": "app/dist/index.0942891d.js",
                "status": "removed",
                "additions": 0,
                "deletions": 698,
                "changes": 698,
                "blob_url": "https://github.com/zusam/zusam/blob/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.0942891d.js",
                "raw_url": "https://github.com/zusam/zusam/raw/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.0942891d.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.0942891d.js?ref=e2d688af1aa25f0dd1055141e516982f033a77ef"
            },
            {
                "sha": "20c3818ac43847a4193e2058cf96df3e4abce92e",
                "filename": "app/dist/index.0942891d.js.map",
                "status": "removed",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.0942891d.js.map",
                "raw_url": "https://github.com/zusam/zusam/raw/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.0942891d.js.map",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.0942891d.js.map?ref=e2d688af1aa25f0dd1055141e516982f033a77ef"
            },
            {
                "sha": "1dee811c8e42be47229737ef505fd1c824177dd9",
                "filename": "app/dist/index.4a2b78a0.js",
                "status": "added",
                "additions": 30,
                "deletions": 0,
                "changes": 30,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.4a2b78a0.js",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.4a2b78a0.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.4a2b78a0.js?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a"
            },
            {
                "sha": "34e81d9a501fb1ccb90a0f40359bc87685c088cf",
                "filename": "app/dist/index.4a2b78a0.js.map",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.4a2b78a0.js.map",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.4a2b78a0.js.map",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.4a2b78a0.js.map?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a"
            },
            {
                "sha": "12b157a8e72f084ee07fcea33b183ff6703640a6",
                "filename": "app/dist/index.8292cd79.js",
                "status": "added",
                "additions": 30,
                "deletions": 0,
                "changes": 30,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.8292cd79.js",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.8292cd79.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.8292cd79.js?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a"
            },
            {
                "sha": "f9af7d8b5240469a038760e720869f994df84f72",
                "filename": "app/dist/index.8292cd79.js.map",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.8292cd79.js.map",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.8292cd79.js.map",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.8292cd79.js.map?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a"
            },
            {
                "sha": "fbea53433df609f9db0ea9fd5b097836d3732597",
                "filename": "app/dist/index.c139946c.css",
                "status": "removed",
                "additions": 0,
                "deletions": 2,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.c139946c.css",
                "raw_url": "https://github.com/zusam/zusam/raw/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.c139946c.css",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.c139946c.css?ref=e2d688af1aa25f0dd1055141e516982f033a77ef"
            },
            {
                "sha": "fce4e2e12f968964cc03e2b33b0abb1b1f212676",
                "filename": "app/dist/index.c139946c.css.map",
                "status": "removed",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.c139946c.css.map",
                "raw_url": "https://github.com/zusam/zusam/raw/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.c139946c.css.map",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.c139946c.css.map?ref=e2d688af1aa25f0dd1055141e516982f033a77ef"
            },
            {
                "sha": "bfe705dd6b8f24acc6711ef726303a5c2bce5a64",
                "filename": "app/dist/index.d005b0e5.css",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.d005b0e5.css",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.d005b0e5.css",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.d005b0e5.css?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a"
            },
            {
                "sha": "b6e8b259a35a12856bbc6ef127083629a702d2f0",
                "filename": "app/dist/index.d005b0e5.css.map",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.d005b0e5.css.map",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.d005b0e5.css.map",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.d005b0e5.css.map?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a"
            },
            {
                "sha": "c2b0a246b2bd7881f37d11fa54880e6ffb0bb9b1",
                "filename": "app/dist/index.html",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.html",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.html",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.html?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,10 +1,10 @@\n <!DOCTYPE html>\n <html>\n-    <head><script type=\"module\" src=\"/index.runtime.5b4495c6.js\"></script>\n+    <head><script type=\"module\" src=\"/index.runtime.9940b38b.js\"></script><script nomodule=\"\" defer=\"\" src=\"/index.runtime.096eed7d.js\"></script>\n         <!-- WEBAPP CONFIGURATION -->\n         <base href=\"/\">\n         <meta name=\"zusam:default-lang\" content=\"en\">\n-        <meta name=\"zusam:version\" content=\"0.5.5\">\n+        <meta name=\"zusam:version\" content=\"0.5.6\">\n         <!-- -->\n \n         <title>Zusam</title>\n@@ -26,12 +26,12 @@\n         <meta name=\"application-name\" content=\"Zusam\">\n         <meta name=\"msapplication-TileColor\" content=\"#f7a71b\">\n         <meta name=\"theme-color\" content=\"#f7a71b\">\n-        <link rel=\"stylesheet\" href=\"/index.c139946c.css\">\n+        <link rel=\"stylesheet\" href=\"/index.d005b0e5.css\">\n     </head>\n     <body>\n         <noscript>\n             Zusam requires <a href=\"https://www.enable-javascript.com\">javascript enabled</a> to work.\n         </noscript>\n-        <script type=\"module\" src=\"/index.0942891d.js\"></script>\n+        <script type=\"module\" src=\"/index.4a2b78a0.js\"></script><script src=\"/index.8292cd79.js\" nomodule=\"\" defer=\"\"></script>\n     </body>\n </html>"
            },
            {
                "sha": "f48bc56cdc44bbb55afbb6c99b42721b77b31a4d",
                "filename": "app/dist/index.runtime.096eed7d.js",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.runtime.096eed7d.js",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.runtime.096eed7d.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.runtime.096eed7d.js?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,2 @@\n+!function(){function e(e,r,n,t){Object.defineProperty(e,r,{get:n,set:t,enumerable:!0,configurable:!0})}var r=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:{},n={},t={},o=r.parcelRequiredc87;null==o&&((o=function(e){if(e in n)return n[e].exports;if(e in t){var r=t[e];delete t[e];var o={id:e,exports:{}};return n[e]=o,r.call(o.exports,o,o.exports),o.exports}var i=Error(\"Cannot find module '\"+e+\"'\");throw i.code=\"MODULE_NOT_FOUND\",i}).register=function(e,r){t[e]=r},r.parcelRequiredc87=o);var i=o.register;i(\"6TJWq\",function(r,n){e(r.exports,\"register\",function(){return t},function(e){return t=e});var t,o=new Map;t=function(e,r){for(var n=0;n<r.length-1;n+=2)o.set(r[n],{baseUrl:e,path:r[n+1]})}}),i(\"lpwGa\",function(r,n){e(r.exports,\"getBundleURL\",function(){return t},function(e){return t=e});var t,o={};t=function(e){var r=o[e];return r||(r=function(){try{throw Error()}catch(r){var e=(\"\"+r.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/[^)\\n]+/g);if(e)return(\"\"+e[2]).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\\/\\/.+)\\/[^/]+$/,\"$1\")+\"/\"}return\"/\"}(),o[e]=r),r}}),o(\"6TJWq\").register(o(\"lpwGa\").getBundleURL(\"88FtB\"),JSON.parse('[\"88FtB\",\"index.8292cd79.js\",\"051d2\",\"zusam_logo.1eebfd28.svg\"]'))}();\n+//# sourceMappingURL=index.runtime.096eed7d.js.map"
            },
            {
                "sha": "e33e5f93f2e8ffe48188caa201ba1dba00a13088",
                "filename": "app/dist/index.runtime.096eed7d.js.map",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.runtime.096eed7d.js.map",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.runtime.096eed7d.js.map",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.runtime.096eed7d.js.map?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1 @@\n+{\"mappings\":\"C,A,W,S,E,C,C,C,C,C,C,C,E,O,c,C,E,E,C,I,E,I,E,W,C,E,a,C,C,E,C,I,E,A,a,O,W,W,A,a,O,K,K,A,a,O,O,O,A,a,O,O,O,C,E,E,C,E,E,C,E,E,E,iB,A,O,I,A,C,E,S,C,E,G,K,E,O,C,C,E,C,O,C,G,K,E,C,I,E,C,C,E,A,Q,C,C,E,C,I,E,C,G,E,Q,C,C,E,O,C,C,E,C,E,E,I,C,E,O,C,E,E,O,E,E,O,A,C,I,E,A,M,uB,E,I,O,E,I,C,mB,C,C,E,Q,C,S,C,C,C,E,C,C,E,C,C,E,E,iB,C,G,I,E,E,Q,C,E,Q,S,C,C,C,E,E,E,O,C,W,W,O,C,E,S,C,E,O,E,C,GCEA,IAgBA,EAhBI,EAAU,IAAI,IAgBlB,EAfA,SAAkB,CAAO,CAAE,CAAQ,EACjC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAS,MAAM,CAAG,EAAG,GAAK,EAC5C,EAAQ,GAAG,CAAC,CAAQ,CAAC,EAAE,CAAE,CACvB,QAAS,EACT,KAAM,CAAQ,CAAC,EAAI,EAAE,AACvB,EAEJ,C,G,E,Q,S,C,C,C,E,E,E,O,C,e,W,O,C,E,S,C,E,O,E,C,GCRA,IAkCA,EAlCI,EAAY,CAAC,EAkCjB,EAjCA,SAA4B,CAAE,EAC5B,IAAI,EAAQ,CAAS,CAAC,EAAG,CAKzB,OAJK,IACH,EAAQ,AAKZ,WACE,GAAI,CACF,MAAM,AAAI,OACZ,CAAE,MAAO,EAAK,CACZ,IAAI,EAAW,AAAA,CAAA,GAAK,EAAI,KAAI,AAAJ,EAAO,KAAK,CAAC,oEACrC,GAAI,EAGF,MAMI,AAAA,CAAA,GANc,CAAO,CAAC,EAAE,AAMnB,EAAK,OAAO,CAAC,0EAA2E,MAAQ,GAJ7G,CACA,MAAO,GACT,IAhBI,CAAS,CAAC,EAAG,CAAG,GAEX,CACT,C,GCVA,AAAA,EAAA,SAAA,QAAA,CAA8C,AAAA,EAAA,SAAA,YAAA,CAA6C,SAAS,KAAK,KAAK,CAAC,qG\",\"sources\":[\"<anon>\",\"node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js\",\"node_modules/@parcel/runtime-js/lib/helpers/bundle-url.js\",\"node_modules/@parcel/runtime-js/lib/runtime-335ffc391dfe8439.js\"],\"sourcesContent\":[\"(function () {\\n\\nfunction $parcel$export(e, n, v, s) {\\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\\n}\\n\\n      var $parcel$global =\\n        typeof globalThis !== 'undefined'\\n          ? globalThis\\n          : typeof self !== 'undefined'\\n          ? self\\n          : typeof window !== 'undefined'\\n          ? window\\n          : typeof global !== 'undefined'\\n          ? global\\n          : {};\\n  \\nvar $parcel$modules = {};\\nvar $parcel$inits = {};\\n\\nvar parcelRequire = $parcel$global[\\\"parcelRequiredc87\\\"];\\n\\nif (parcelRequire == null) {\\n  parcelRequire = function(id) {\\n    if (id in $parcel$modules) {\\n      return $parcel$modules[id].exports;\\n    }\\n    if (id in $parcel$inits) {\\n      var init = $parcel$inits[id];\\n      delete $parcel$inits[id];\\n      var module = {id: id, exports: {}};\\n      $parcel$modules[id] = module;\\n      init.call(module.exports, module, module.exports);\\n      return module.exports;\\n    }\\n    var err = new Error(\\\"Cannot find module '\\\" + id + \\\"'\\\");\\n    err.code = 'MODULE_NOT_FOUND';\\n    throw err;\\n  };\\n\\n  parcelRequire.register = function register(id, init) {\\n    $parcel$inits[id] = init;\\n  };\\n\\n  $parcel$global[\\\"parcelRequiredc87\\\"] = parcelRequire;\\n}\\n\\nvar parcelRegister = parcelRequire.register;\\nparcelRegister(\\\"6TJWq\\\", function(module, exports) {\\n\\n$parcel$export(module.exports, \\\"register\\\", function () { return $505b8421e380ecc6$export$6503ec6e8aabbaf; }, function (v) { return $505b8421e380ecc6$export$6503ec6e8aabbaf = v; });\\nvar $505b8421e380ecc6$export$6503ec6e8aabbaf;\\nvar $505b8421e380ecc6$export$f7ad0328861e2f03;\\n\\\"use strict\\\";\\nvar $505b8421e380ecc6$var$mapping = new Map();\\nfunction $505b8421e380ecc6$var$register(baseUrl, manifest) {\\n    for(var i = 0; i < manifest.length - 1; i += 2)$505b8421e380ecc6$var$mapping.set(manifest[i], {\\n        baseUrl: baseUrl,\\n        path: manifest[i + 1]\\n    });\\n}\\nfunction $505b8421e380ecc6$var$resolve(id) {\\n    var resolved = $505b8421e380ecc6$var$mapping.get(id);\\n    if (resolved == null) throw new Error(\\\"Could not resolve bundle with id \\\" + id);\\n    return new URL(resolved.path, resolved.baseUrl).toString();\\n}\\n$505b8421e380ecc6$export$6503ec6e8aabbaf = $505b8421e380ecc6$var$register;\\n$505b8421e380ecc6$export$f7ad0328861e2f03 = $505b8421e380ecc6$var$resolve;\\n\\n});\\n\\nparcelRegister(\\\"lpwGa\\\", function(module, exports) {\\n\\n$parcel$export(module.exports, \\\"getBundleURL\\\", function () { return $f965482ec7a35662$export$bdfd709ae4826697; }, function (v) { return $f965482ec7a35662$export$bdfd709ae4826697 = v; });\\nvar $f965482ec7a35662$export$bdfd709ae4826697;\\nvar $f965482ec7a35662$export$c9e73fbda7da57b6;\\nvar $f965482ec7a35662$export$5a759dc7a1cfb72a;\\n\\\"use strict\\\";\\nvar $f965482ec7a35662$var$bundleURL = {};\\nfunction $f965482ec7a35662$var$getBundleURLCached(id) {\\n    var value = $f965482ec7a35662$var$bundleURL[id];\\n    if (!value) {\\n        value = $f965482ec7a35662$var$getBundleURL();\\n        $f965482ec7a35662$var$bundleURL[id] = value;\\n    }\\n    return value;\\n}\\nfunction $f965482ec7a35662$var$getBundleURL() {\\n    try {\\n        throw new Error();\\n    } catch (err) {\\n        var matches = (\\\"\\\" + err.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\\\/\\\\/[^)\\\\n]+/g);\\n        if (matches) // The first two stack frames will be this function and getBundleURLCached.\\n        // Use the 3rd one, which will be a runtime in the original bundle.\\n        return $f965482ec7a35662$var$getBaseURL(matches[2]);\\n    }\\n    return \\\"/\\\";\\n}\\nfunction $f965482ec7a35662$var$getBaseURL(url) {\\n    return (\\\"\\\" + url).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\\\\/\\\\/.+)\\\\/[^/]+$/, \\\"$1\\\") + \\\"/\\\";\\n}\\n// TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\\nfunction $f965482ec7a35662$var$getOrigin(url) {\\n    var matches = (\\\"\\\" + url).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\\\/\\\\/[^/]+/);\\n    if (!matches) throw new Error(\\\"Origin not found\\\");\\n    return matches[0];\\n}\\n$f965482ec7a35662$export$bdfd709ae4826697 = $f965482ec7a35662$var$getBundleURLCached;\\n$f965482ec7a35662$export$c9e73fbda7da57b6 = $f965482ec7a35662$var$getBaseURL;\\n$f965482ec7a35662$export$5a759dc7a1cfb72a = $f965482ec7a35662$var$getOrigin;\\n\\n});\\n\\nvar $ee382aeb3fe63482$exports = {};\\n\\n\\n(parcelRequire(\\\"6TJWq\\\")).register((parcelRequire(\\\"lpwGa\\\")).getBundleURL(\\\"88FtB\\\"), JSON.parse('[\\\"88FtB\\\",\\\"index.8292cd79.js\\\",\\\"051d2\\\",\\\"zusam_logo.1eebfd28.svg\\\"]'));\\n\\n})();\\n//# sourceMappingURL=index.runtime.096eed7d.js.map\\n\",\"\\\"use strict\\\";\\n\\nvar mapping = new Map();\\nfunction register(baseUrl, manifest) {\\n  for (var i = 0; i < manifest.length - 1; i += 2) {\\n    mapping.set(manifest[i], {\\n      baseUrl: baseUrl,\\n      path: manifest[i + 1]\\n    });\\n  }\\n}\\nfunction resolve(id) {\\n  var resolved = mapping.get(id);\\n  if (resolved == null) {\\n    throw new Error('Could not resolve bundle with id ' + id);\\n  }\\n  return new URL(resolved.path, resolved.baseUrl).toString();\\n}\\nmodule.exports.register = register;\\nmodule.exports.resolve = resolve;\",\"\\\"use strict\\\";\\n\\nvar bundleURL = {};\\nfunction getBundleURLCached(id) {\\n  var value = bundleURL[id];\\n  if (!value) {\\n    value = getBundleURL();\\n    bundleURL[id] = value;\\n  }\\n  return value;\\n}\\nfunction getBundleURL() {\\n  try {\\n    throw new Error();\\n  } catch (err) {\\n    var matches = ('' + err.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\\\/\\\\/[^)\\\\n]+/g);\\n    if (matches) {\\n      // The first two stack frames will be this function and getBundleURLCached.\\n      // Use the 3rd one, which will be a runtime in the original bundle.\\n      return getBaseURL(matches[2]);\\n    }\\n  }\\n  return '/';\\n}\\nfunction getBaseURL(url) {\\n  return ('' + url).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\\\\/\\\\/.+)\\\\/[^/]+$/, '$1') + '/';\\n}\\n\\n// TODO: Replace uses with `new URL(url).origin` when ie11 is no longer supported.\\nfunction getOrigin(url) {\\n  var matches = ('' + url).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\\\\/\\\\/[^/]+/);\\n  if (!matches) {\\n    throw new Error('Origin not found');\\n  }\\n  return matches[0];\\n}\\nexports.getBundleURL = getBundleURLCached;\\nexports.getBaseURL = getBaseURL;\\nexports.getOrigin = getOrigin;\",\"require('./helpers/bundle-manifest').register(require('./helpers/bundle-url').getBundleURL('88FtB'),JSON.parse(\\\"[\\\\\\\"88FtB\\\\\\\",\\\\\\\"index.8292cd79.js\\\\\\\",\\\\\\\"051d2\\\\\\\",\\\\\\\"zusam_logo.1eebfd28.svg\\\\\\\"]\\\"));\"],\"names\":[\"$parcel$export\",\"e\",\"n\",\"v\",\"s\",\"Object\",\"defineProperty\",\"get\",\"set\",\"enumerable\",\"configurable\",\"$parcel$global\",\"globalThis\",\"self\",\"window\",\"global\",\"$parcel$modules\",\"$parcel$inits\",\"parcelRequire\",\"id\",\"exports\",\"init\",\"module\",\"call\",\"err\",\"Error\",\"code\",\"register\",\"parcelRegister\",\"$505b8421e380ecc6$export$6503ec6e8aabbaf\",\"$505b8421e380ecc6$var$mapping\",\"Map\",\"baseUrl\",\"manifest\",\"i\",\"length\",\"path\",\"$f965482ec7a35662$export$bdfd709ae4826697\",\"$f965482ec7a35662$var$bundleURL\",\"value\",\"$f965482ec7a35662$var$getBundleURL\",\"matches\",\"stack\",\"match\",\"replace\",\"getBundleURL\",\"JSON\",\"parse\"],\"version\":3,\"file\":\"index.runtime.096eed7d.js.map\"}\n\\ No newline at end of file"
            },
            {
                "sha": "adf7e61be4528861220a4dca2b2353f51a818b22",
                "filename": "app/dist/index.runtime.5b4495c6.js",
                "status": "removed",
                "additions": 0,
                "deletions": 3,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.runtime.5b4495c6.js",
                "raw_url": "https://github.com/zusam/zusam/raw/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.runtime.5b4495c6.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.runtime.5b4495c6.js?ref=e2d688af1aa25f0dd1055141e516982f033a77ef",
                "patch": "@@ -1,3 +0,0 @@\n-var e=globalThis,r={},t={},n=e.parcelRequiredc87;null==n&&((n=function(e){if(e in r)return r[e].exports;if(e in t){var n=t[e];delete t[e];var o={id:e,exports:{}};return r[e]=o,n.call(o.exports,o,o.exports),o.exports}var i=Error(\"Cannot find module '\"+e+\"'\");throw i.code=\"MODULE_NOT_FOUND\",i}).register=function(e,r){t[e]=r},e.parcelRequiredc87=n),(0,n.register)(\"c1bOu\",function(e,r){Object.defineProperty(e.exports,\"register\",{get:()=>t,set:e=>t=e,enumerable:!0,configurable:!0});var t,n=new Map;t=function(e,r){for(var t=0;t<r.length-1;t+=2)n.set(r[t],{baseUrl:e,path:r[t+1]})}}),n(\"c1bOu\").register(new URL(\"\",import.meta.url).toString(),JSON.parse('[\"bXkwM\",\"index.0942891d.js\",\"IA7EQ\",\"zusam_logo.1eebfd28.svg\"]'));//# sourceMappingURL=index.runtime.5b4495c6.js.map\n-\n-//# sourceMappingURL=index.runtime.5b4495c6.js.map"
            },
            {
                "sha": "b787e2177acee078efea617152797dbd86cf9adc",
                "filename": "app/dist/index.runtime.5b4495c6.js.map",
                "status": "removed",
                "additions": 0,
                "deletions": 1,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.runtime.5b4495c6.js.map",
                "raw_url": "https://github.com/zusam/zusam/raw/e2d688af1aa25f0dd1055141e516982f033a77ef/app%2Fdist%2Findex.runtime.5b4495c6.js.map",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.runtime.5b4495c6.js.map?ref=e2d688af1aa25f0dd1055141e516982f033a77ef",
                "patch": "@@ -1 +0,0 @@\n-{\"mappings\":\"A,I,E,W,E,C,E,E,C,E,E,E,iB,A,O,I,A,C,E,S,C,E,G,K,E,O,C,C,E,C,O,C,G,K,E,C,I,E,C,C,E,A,Q,C,C,E,C,I,E,C,G,E,Q,C,C,E,O,C,C,E,C,E,E,I,C,E,O,C,E,E,O,E,E,O,A,C,I,E,A,M,uB,E,I,O,E,I,C,mB,C,C,E,Q,C,S,C,C,C,E,C,C,E,C,C,E,E,iB,C,G,A,C,E,E,Q,A,E,Q,S,C,C,C,E,O,c,C,E,O,C,W,C,I,I,E,I,A,G,E,E,W,C,E,a,C,C,GCEA,IAgBA,EAhBI,EAAU,IAAI,IAgBlB,EAfA,SAAkB,CAAO,CAAE,CAAQ,EACjC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAS,MAAM,CAAG,EAAG,GAAK,EAC5C,EAAQ,GAAG,CAAC,CAAQ,CAAC,EAAE,CAAE,CACvB,QAAS,EACT,KAAM,CAAQ,CAAC,EAAI,EAAE,AACvB,EAEJ,C,GCVA,AAAA,EAAA,SAAA,QAAA,CAA8C,IAAA,IAAoB,GAAA,YAAA,GAAA,EAAI,QAAQ,GAAG,KAAK,KAAK,CAAC,qG,oE\",\"sources\":[\"<anon>\",\"node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js\",\"node_modules/@parcel/runtime-js/lib/runtime-7c370b7a84c3c59f.js\"],\"sourcesContent\":[\"\\nfunction $parcel$export(e, n, v, s) {\\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\\n}\\n\\n      var $parcel$global = globalThis;\\n    \\nvar $parcel$modules = {};\\nvar $parcel$inits = {};\\n\\nvar parcelRequire = $parcel$global[\\\"parcelRequiredc87\\\"];\\n\\nif (parcelRequire == null) {\\n  parcelRequire = function(id) {\\n    if (id in $parcel$modules) {\\n      return $parcel$modules[id].exports;\\n    }\\n    if (id in $parcel$inits) {\\n      var init = $parcel$inits[id];\\n      delete $parcel$inits[id];\\n      var module = {id: id, exports: {}};\\n      $parcel$modules[id] = module;\\n      init.call(module.exports, module, module.exports);\\n      return module.exports;\\n    }\\n    var err = new Error(\\\"Cannot find module '\\\" + id + \\\"'\\\");\\n    err.code = 'MODULE_NOT_FOUND';\\n    throw err;\\n  };\\n\\n  parcelRequire.register = function register(id, init) {\\n    $parcel$inits[id] = init;\\n  };\\n\\n  $parcel$global[\\\"parcelRequiredc87\\\"] = parcelRequire;\\n}\\n\\nvar parcelRegister = parcelRequire.register;\\nparcelRegister(\\\"c1bOu\\\", function(module, exports) {\\n\\n$parcel$export(module.exports, \\\"register\\\", () => $8bfebded0011ab7d$export$6503ec6e8aabbaf, (v) => $8bfebded0011ab7d$export$6503ec6e8aabbaf = v);\\nvar $8bfebded0011ab7d$export$6503ec6e8aabbaf;\\nvar $8bfebded0011ab7d$export$f7ad0328861e2f03;\\n\\\"use strict\\\";\\nvar $8bfebded0011ab7d$var$mapping = new Map();\\nfunction $8bfebded0011ab7d$var$register(baseUrl, manifest) {\\n    for(var i = 0; i < manifest.length - 1; i += 2)$8bfebded0011ab7d$var$mapping.set(manifest[i], {\\n        baseUrl: baseUrl,\\n        path: manifest[i + 1]\\n    });\\n}\\nfunction $8bfebded0011ab7d$var$resolve(id) {\\n    var resolved = $8bfebded0011ab7d$var$mapping.get(id);\\n    if (resolved == null) throw new Error(\\\"Could not resolve bundle with id \\\" + id);\\n    return new URL(resolved.path, resolved.baseUrl).toString();\\n}\\n$8bfebded0011ab7d$export$6503ec6e8aabbaf = $8bfebded0011ab7d$var$register;\\n$8bfebded0011ab7d$export$f7ad0328861e2f03 = $8bfebded0011ab7d$var$resolve;\\n\\n});\\n\\nvar $c3f9ef799c74b805$exports = {};\\n\\n(parcelRequire(\\\"c1bOu\\\")).register(new URL(\\\"\\\", import.meta.url).toString(), JSON.parse('[\\\"bXkwM\\\",\\\"index.0942891d.js\\\",\\\"IA7EQ\\\",\\\"zusam_logo.1eebfd28.svg\\\"]'));\\n\\n\\n//# sourceMappingURL=index.runtime.5b4495c6.js.map\\n\",\"\\\"use strict\\\";\\n\\nvar mapping = new Map();\\nfunction register(baseUrl, manifest) {\\n  for (var i = 0; i < manifest.length - 1; i += 2) {\\n    mapping.set(manifest[i], {\\n      baseUrl: baseUrl,\\n      path: manifest[i + 1]\\n    });\\n  }\\n}\\nfunction resolve(id) {\\n  var resolved = mapping.get(id);\\n  if (resolved == null) {\\n    throw new Error('Could not resolve bundle with id ' + id);\\n  }\\n  return new URL(resolved.path, resolved.baseUrl).toString();\\n}\\nmodule.exports.register = register;\\nmodule.exports.resolve = resolve;\",\"require('./helpers/bundle-manifest').register(new __parcel__URL__(\\\"\\\").toString(),JSON.parse(\\\"[\\\\\\\"bXkwM\\\\\\\",\\\\\\\"index.0942891d.js\\\\\\\",\\\\\\\"IA7EQ\\\\\\\",\\\\\\\"zusam_logo.1eebfd28.svg\\\\\\\"]\\\"));\"],\"names\":[\"$parcel$global\",\"globalThis\",\"$parcel$modules\",\"$parcel$inits\",\"parcelRequire\",\"id\",\"exports\",\"init\",\"module\",\"call\",\"err\",\"Error\",\"code\",\"register\",\"parcelRegister\",\"Object\",\"defineProperty\",\"get\",\"$8bfebded0011ab7d$export$6503ec6e8aabbaf\",\"set\",\"v\",\"enumerable\",\"configurable\",\"$8bfebded0011ab7d$var$mapping\",\"Map\",\"baseUrl\",\"manifest\",\"i\",\"length\",\"path\",\"URL\",\"url\",\"toString\",\"JSON\",\"parse\"],\"version\":3,\"file\":\"index.runtime.5b4495c6.js.map\"}\n\\ No newline at end of file"
            },
            {
                "sha": "e5c8e433641d611d018327779e0368133eb3bafa",
                "filename": "app/dist/index.runtime.9940b38b.js",
                "status": "added",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.runtime.9940b38b.js",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.runtime.9940b38b.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.runtime.9940b38b.js?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,2 @@\n+var e=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:{},r={},n={},t=e.parcelRequiredc87;null==t&&((t=function(e){if(e in r)return r[e].exports;if(e in n){var t=n[e];delete n[e];var o={id:e,exports:{}};return r[e]=o,t.call(o.exports,o,o.exports),o.exports}var i=Error(\"Cannot find module '\"+e+\"'\");throw i.code=\"MODULE_NOT_FOUND\",i}).register=function(e,r){n[e]=r},e.parcelRequiredc87=t),(0,t.register)(\"c1bOu\",function(e,r){Object.defineProperty(e.exports,\"register\",{get:()=>n,set:e=>n=e,enumerable:!0,configurable:!0});var n,t=new Map;n=function(e,r){for(var n=0;n<r.length-1;n+=2)t.set(r[n],{baseUrl:e,path:r[n+1]})}}),t(\"c1bOu\").register(new URL(\"\",import.meta.url).toString(),JSON.parse('[\"bXkwM\",\"index.4a2b78a0.js\",\"IA7EQ\",\"zusam_logo.1eebfd28.svg\"]'));\n+//# sourceMappingURL=index.runtime.9940b38b.js.map"
            },
            {
                "sha": "cc415c1271f6de03d00dacc96d6d9bbb8eca9c30",
                "filename": "app/dist/index.runtime.9940b38b.js.map",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.runtime.9940b38b.js.map",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Findex.runtime.9940b38b.js.map",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Findex.runtime.9940b38b.js.map?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1 @@\n+{\"mappings\":\"A,I,E,A,a,O,W,W,A,a,O,K,K,A,a,O,O,O,A,a,O,O,O,C,E,E,C,E,E,C,E,E,E,iB,A,O,I,A,C,E,S,C,E,G,K,E,O,C,C,E,C,O,C,G,K,E,C,I,E,C,C,E,A,Q,C,C,E,C,I,E,C,G,E,Q,C,C,E,O,C,C,E,C,E,E,I,C,E,O,C,E,E,O,E,E,O,A,C,I,E,A,M,uB,E,I,O,E,I,C,mB,C,C,E,Q,C,S,C,C,C,E,C,C,E,C,C,E,E,iB,C,G,A,C,E,E,Q,A,E,Q,S,C,C,C,E,O,c,C,E,O,C,W,C,I,I,E,I,A,G,E,E,W,C,E,a,C,C,GCEA,IAgBA,EAhBI,EAAU,IAAI,IAgBlB,EAfA,SAAkB,CAAO,CAAE,CAAQ,EACjC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAS,MAAM,CAAG,EAAG,GAAK,EAC5C,EAAQ,GAAG,CAAC,CAAQ,CAAC,EAAE,CAAE,CACvB,QAAS,EACT,KAAM,CAAQ,CAAC,EAAI,EAAE,AACvB,EAEJ,C,GCVA,AAAA,EAAA,SAAA,QAAA,CAA8C,IAAA,IAAoB,GAAA,YAAA,GAAA,EAAI,QAAQ,GAAG,KAAK,KAAK,CAAC\",\"sources\":[\"<anon>\",\"node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js\",\"node_modules/@parcel/runtime-js/lib/runtime-7c370b7a84c3c59f.js\"],\"sourcesContent\":[\"\\nfunction $parcel$export(e, n, v, s) {\\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\\n}\\n\\n      var $parcel$global =\\n        typeof globalThis !== 'undefined'\\n          ? globalThis\\n          : typeof self !== 'undefined'\\n          ? self\\n          : typeof window !== 'undefined'\\n          ? window\\n          : typeof global !== 'undefined'\\n          ? global\\n          : {};\\n  \\nvar $parcel$modules = {};\\nvar $parcel$inits = {};\\n\\nvar parcelRequire = $parcel$global[\\\"parcelRequiredc87\\\"];\\n\\nif (parcelRequire == null) {\\n  parcelRequire = function(id) {\\n    if (id in $parcel$modules) {\\n      return $parcel$modules[id].exports;\\n    }\\n    if (id in $parcel$inits) {\\n      var init = $parcel$inits[id];\\n      delete $parcel$inits[id];\\n      var module = {id: id, exports: {}};\\n      $parcel$modules[id] = module;\\n      init.call(module.exports, module, module.exports);\\n      return module.exports;\\n    }\\n    var err = new Error(\\\"Cannot find module '\\\" + id + \\\"'\\\");\\n    err.code = 'MODULE_NOT_FOUND';\\n    throw err;\\n  };\\n\\n  parcelRequire.register = function register(id, init) {\\n    $parcel$inits[id] = init;\\n  };\\n\\n  $parcel$global[\\\"parcelRequiredc87\\\"] = parcelRequire;\\n}\\n\\nvar parcelRegister = parcelRequire.register;\\nparcelRegister(\\\"c1bOu\\\", function(module, exports) {\\n\\n$parcel$export(module.exports, \\\"register\\\", () => $8bfebded0011ab7d$export$6503ec6e8aabbaf, (v) => $8bfebded0011ab7d$export$6503ec6e8aabbaf = v);\\nvar $8bfebded0011ab7d$export$6503ec6e8aabbaf;\\nvar $8bfebded0011ab7d$export$f7ad0328861e2f03;\\n\\\"use strict\\\";\\nvar $8bfebded0011ab7d$var$mapping = new Map();\\nfunction $8bfebded0011ab7d$var$register(baseUrl, manifest) {\\n    for(var i = 0; i < manifest.length - 1; i += 2)$8bfebded0011ab7d$var$mapping.set(manifest[i], {\\n        baseUrl: baseUrl,\\n        path: manifest[i + 1]\\n    });\\n}\\nfunction $8bfebded0011ab7d$var$resolve(id) {\\n    var resolved = $8bfebded0011ab7d$var$mapping.get(id);\\n    if (resolved == null) throw new Error(\\\"Could not resolve bundle with id \\\" + id);\\n    return new URL(resolved.path, resolved.baseUrl).toString();\\n}\\n$8bfebded0011ab7d$export$6503ec6e8aabbaf = $8bfebded0011ab7d$var$register;\\n$8bfebded0011ab7d$export$f7ad0328861e2f03 = $8bfebded0011ab7d$var$resolve;\\n\\n});\\n\\nvar $c3f9ef799c74b805$exports = {};\\n\\n(parcelRequire(\\\"c1bOu\\\")).register(new URL(\\\"\\\", import.meta.url).toString(), JSON.parse('[\\\"bXkwM\\\",\\\"index.4a2b78a0.js\\\",\\\"IA7EQ\\\",\\\"zusam_logo.1eebfd28.svg\\\"]'));\\n\\n\\n//# sourceMappingURL=index.runtime.9940b38b.js.map\\n\",\"\\\"use strict\\\";\\n\\nvar mapping = new Map();\\nfunction register(baseUrl, manifest) {\\n  for (var i = 0; i < manifest.length - 1; i += 2) {\\n    mapping.set(manifest[i], {\\n      baseUrl: baseUrl,\\n      path: manifest[i + 1]\\n    });\\n  }\\n}\\nfunction resolve(id) {\\n  var resolved = mapping.get(id);\\n  if (resolved == null) {\\n    throw new Error('Could not resolve bundle with id ' + id);\\n  }\\n  return new URL(resolved.path, resolved.baseUrl).toString();\\n}\\nmodule.exports.register = register;\\nmodule.exports.resolve = resolve;\",\"require('./helpers/bundle-manifest').register(new __parcel__URL__(\\\"\\\").toString(),JSON.parse(\\\"[\\\\\\\"bXkwM\\\\\\\",\\\\\\\"index.4a2b78a0.js\\\\\\\",\\\\\\\"IA7EQ\\\\\\\",\\\\\\\"zusam_logo.1eebfd28.svg\\\\\\\"]\\\"));\"],\"names\":[\"$parcel$global\",\"globalThis\",\"self\",\"window\",\"global\",\"$parcel$modules\",\"$parcel$inits\",\"parcelRequire\",\"id\",\"exports\",\"init\",\"module\",\"call\",\"err\",\"Error\",\"code\",\"register\",\"parcelRegister\",\"Object\",\"defineProperty\",\"get\",\"$8bfebded0011ab7d$export$6503ec6e8aabbaf\",\"set\",\"v\",\"enumerable\",\"configurable\",\"$8bfebded0011ab7d$var$mapping\",\"Map\",\"baseUrl\",\"manifest\",\"i\",\"length\",\"path\",\"URL\",\"url\",\"toString\",\"JSON\",\"parse\"],\"version\":3,\"file\":\"index.runtime.9940b38b.js.map\"}\n\\ No newline at end of file"
            },
            {
                "sha": "7ffb6afb9e886cf692cbe24945326e7e0276ccad",
                "filename": "app/dist/lang/cs_CZ.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fcs_CZ.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fcs_CZ.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fcs_CZ.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -10,7 +10,7 @@\n     \"submit\": \"Odeslat\",\n     \"title_placeholder\": \"Nadpis zpr\u00e1vy (voliteln\u011b)\",\n     \"text_placeholder\": \"Zde napi\u0161te svou zpr\u00e1vu\",\n-    \"upload_pdf\": \"Nahr\u00e1t pdf\",\n+    \"upload_pdf\": \"Nahr\u00e1t PDF\",\n     \"upload_image\": \"Nahr\u00e1t fotky\",\n     \"upload_video\": \"Nahr\u00e1t video\",\n     \"upload_music\": \"Nahr\u00e1t hudbu\","
            },
            {
                "sha": "cc5b04059a28930737a716af51dd00005a5ec162",
                "filename": "app/dist/lang/de_DE.json",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fde_DE.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fde_DE.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fde_DE.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -30,16 +30,16 @@\n     \"email_input\": \"Gib hier deine E-Mail-Adresse ein\",\n     \"password\": \"Passwort\",\n     \"Invalid login/password\": \"Ung\u00fcltiges Benutzername oder Passwort\",\n-    \"forgot_password\": \"Hast du dein Passwort vergessen?\",\n-    \"ask_delete_message\": \"Bist du sicher, dass du diese Nachricht l\u00f6schen willst?\",\n+    \"forgot_password\": \"Passwort vergessen?\",\n+    \"ask_delete_message\": \"Diese Nachricht l\u00f6schen?\",\n     \"account\": \"Konto\",\n     \"password_reset_mail_sent\": \"Die E-Mail zum Zur\u00fccksetzen des Passworts wurde gesendet!\",\n     \"create_a_group\": \"Eine Gruppe erstellen\",\n     \"users\": \"Benutzer\",\n     \"to\": \"zu\",\n     \"remove_bookmark\": \"Nachricht aus den Lesezeichnen entfernen\",\n     \"bookmarks\": \"Lesezeichen\",\n-    \"multiple_photos_upload\": \"Ein Fehler ist aufgetreten. Versuche, die Bilder nacheinander hochzuladen (dies kann bei einigen Browsern vorkommen).\",\n+    \"multiple_photos_upload\": \"Ein Fehler ist aufgetreten. Versuche, die Bilder nacheinander hochzuladen (dies kann bei einigen Browsern vorkommen)\",\n     \"passwords_dont_match\": \"Passw\u00f6rter stimmen nicht \u00fcberein\",\n     \"User not found\": \"Benutzer nicht gefunden\",\n     \"reset_password_title\": \"Dein Passwort zur\u00fccksetzen\",\n@@ -50,8 +50,8 @@\n     \"notification_emails_stopped\": \"E-Mail-Benachrichtigungen gestoppt!\",\n     \"the_message_from\": \"die Nachricht von\",\n     \"signup\": \"Registrieren\",\n-    \"group_updated\": \"Die Gruppe wurde aktualisiert!\",\n-    \"group_left\": \"Du hast die Gruppe verlassen!\",\n+    \"group_updated\": \"Die Gruppe wurde aktualisiert.\",\n+    \"group_left\": \"Du hast die Gruppe verlassen.\",\n     \"create_the_group\": \"Die Gruppe erstellen\",\n     \"quit_group\": \"Die Gruppe verlassen\",\n     \"settings_updated\": \"Deine Einstellungen wurden aktualisiert\",\n@@ -63,7 +63,7 @@\n     \"are_you_sure\": \"Bist du sicher?\",\n     \"error_upload\": \"Beim Hochladen ist ein Fehler aufgetreten\",\n     \"cancel_write\": \"Willst du das Schreiben einer neuen Nachricht wirklich abbrechen?\",\n-    \"empty_message\": \"Die Nachricht ist leer und kann nicht gesendet werden!\",\n+    \"empty_message\": \"Die Nachricht ist leer und kann nicht gesendet werden.\",\n     \"cancel\": \"Abbrechen\",\n     \"notification_emails\": \"E-Mail-Benachrichtigungen\",\n     \"hourly\": \"St\u00fcndlich\",\n@@ -90,11 +90,11 @@\n     \"notifications\": \"Benachrichtigungen\",\n     \"reset_api_key\": \"Setze den API-Schl\u00fcssel zur\u00fcck (die Verbindung wird unterbrochen)\",\n     \"video_not_ready\": \"Das Video ist noch nicht fertig.\",\n-    \"bookmark_added\": \"Nachricht zu den Lesezeichen hinzugef\u00fcgt!\",\n+    \"bookmark_added\": \"Nachricht zu den Lesezeichen hinzugef\u00fcgt.\",\n     \"search_without_result\": \"Deine Suche hat zu keiner Nachricht gef\u00fchrt.\",\n     \"add_bookmark\": \"Nachricht zu den Lesezeichnen hinzuf\u00fcgen\",\n     \"api_key\": \"API-Schl\u00fcssel\",\n-    \"bookmark_removed\": \"Nachricht aus den Lesezeichen entfernt!\",\n+    \"bookmark_removed\": \"Nachricht aus den Lesezeichen entfernt.\",\n     \"parent_message\": \"Quellenachricht\",\n     \"audio_not_ready\": \"Audio ist noch nicht fertig.\",\n     \"upload_audio\": \"Audio hinzuf\u00fcgen.\""
            },
            {
                "sha": "04984c9e9d27e8158f9fbc30c7aee192d37e8b6e",
                "filename": "app/dist/lang/en_US.json",
                "status": "modified",
                "additions": 19,
                "deletions": 19,
                "changes": 38,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fen_US.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fen_US.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fen_US.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -3,7 +3,7 @@\n     \"next_coms\": \"See next comments\",\n     \"ago\": \"{{duration}} ago\",\n     \"groups\": \"Groups\",\n-    \"login_placeholder\": \"email\",\n+    \"login_placeholder\": \"e-mail\",\n     \"password_placeholder\": \"password\",\n     \"new_password_placeholder\": \"new password\",\n     \"confirm_password_placeholder\": \"confirm password\",\n@@ -13,56 +13,56 @@\n     \"text_placeholder\": \"Write your message here\",\n     \"upload_image\": \"Add photos\",\n     \"upload_video\": \"Add a video\",\n-    \"upload_music\": \"Add musics\",\n-    \"upload_pdf\": \"Add pdf\",\n+    \"upload_music\": \"Add music\",\n+    \"upload_pdf\": \"Add PDF\",\n     \"add_date\": \"Add a date\",\n-    \"logout\": \"Logout\",\n+    \"logout\": \"Log out\",\n     \"settings\": \"Settings\",\n     \"name\": \"Name\",\n     \"name_input\": \"Choose a name\",\n-    \"login\": \"Login\",\n+    \"login\": \"Log in\",\n     \"login_input\": \"Choose a login\",\n-    \"email\": \"Email\",\n-    \"email_input\": \"Fill in your email here\",\n+    \"email\": \"E-mail\",\n+    \"email_input\": \"Fill in your e-mail address here\",\n     \"save_changes\": \"Save changes\",\n     \"password\": \"Password\",\n     \"password_input\": \"Write a new password here\",\n     \"Invalid login/password\": \"Invalid login and/or password\",\n     \"edit\": \"Edit\",\n     \"delete\": \"Delete\",\n-    \"ask_delete_message\": \"Are you sure to delete this message?\",\n+    \"ask_delete_message\": \"Delete this message?\",\n     \"account\": \"Account\",\n-    \"forgot_password\": \"Did you forget your password?\",\n-    \"password_reset_mail_sent\": \"The password reset email was sent !\",\n+    \"forgot_password\": \"Forgot your password?\",\n+    \"password_reset_mail_sent\": \"Look for the password reset e-mail in your inbox.\",\n     \"User not found\": \"User not found\",\n     \"reset_password_title\": \"Reset your password\",\n     \"error\": \"An error occurred\",\n     \"passwords_dont_match\": \"Passwords don't match\",\n     \"invitation_link\": \"Invitation link\",\n     \"reset_invitation_link\": \"Reset invitation link\",\n-    \"invitation_welcome\": \"Welcome on Zusam ! Please sign up before joining the group.\",\n+    \"invitation_welcome\": \"Welcome on Zusam. Please sign up before joining the group.\",\n     \"signup\": \"Sign up\",\n     \"create_a_group\": \"Create a group\",\n     \"create_the_group\": \"Create the group\",\n     \"quit_group\": \"Leave the group\",\n     \"settings_updated\": \"Your settings were updated\",\n-    \"group_updated\": \"The group was updated !\",\n-    \"group_left\": \"You left the group !\",\n+    \"group_updated\": \"The group was updated.\",\n+    \"group_left\": \"You left the group.\",\n     \"multiple_photos_upload\": \"An error ocurred. Try uploading images one by one (this can happen in some browsers)\",\n     \"error_new_message\": \"An error occurred while sending your message.\",\n     \"error_upload\": \"An error occurred during the upload\",\n     \"cancel_write\": \"Do you really want to cancel writing a new message?\",\n-    \"empty_message\": \"The message is empty and cannot be sent !\",\n+    \"empty_message\": \"The message is empty and cannot be sent.\",\n     \"cancel\": \"Cancel\",\n     \"just_now\": \"Just now\",\n-    \"notification_emails\": \"Email notifications\",\n+    \"notification_emails\": \"E-mail notifications\",\n     \"none\": \"None\",\n     \"hourly\": \"Hourly\",\n     \"daily\": \"Daily\",\n     \"weekly\": \"Weekly\",\n     \"monthly\": \"Monthly\",\n-    \"notification_emails_stopped\": \"Email notifications stopped !\",\n-    \"group_share_choice\": \"To which group do you want to send this message?\",\n+    \"notification_emails_stopped\": \"E-mail notifications stopped!\",\n+    \"group_share_choice\": \"Which group do you want to send this message to?\",\n     \"public_link\": \"public link\",\n     \"default_group\": \"Default group\",\n     \"destroy_account\": \"Delete your account\",\n@@ -93,8 +93,8 @@\n     \"api_key\": \"API key\",\n     \"reset_api_key\": \"Reset the API key (you will be disconnected)\",\n     \"video_not_ready\": \"Video is not ready yet.\",\n-    \"bookmark_added\": \"Message added to bookmarks !\",\n-    \"bookmark_removed\": \"Message removed from bookmarks !\",\n+    \"bookmark_added\": \"Message bookmarked.\",\n+    \"bookmark_removed\": \"Message bookmark removed.\",\n     \"parent_message\": \"Parent message\",\n     \"audio_not_ready\": \"Audio is not ready yet.\",\n     \"upload_audio\": \"Add an audio file.\""
            },
            {
                "sha": "ba12a499b1bb2c1a4409ec49eb27c28041357ae7",
                "filename": "app/dist/lang/es_ES.json",
                "status": "modified",
                "additions": 16,
                "deletions": 16,
                "changes": 32,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fes_ES.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fes_ES.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fes_ES.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -3,7 +3,7 @@\n     \"next_coms\": \"Ver los siguientes comentarios\",\n     \"ago\": \"Hace {{duration}}\",\n     \"groups\": \"Grupos\",\n-    \"login_placeholder\": \"correo\",\n+    \"login_placeholder\": \"correo electr\u00f3nico\",\n     \"password_placeholder\": \"contrase\u00f1a\",\n     \"new_password_placeholder\": \"nueva contrase\u00f1a\",\n     \"confirm_password_placeholder\": \"confirmar contrase\u00f1a\",\n@@ -14,55 +14,55 @@\n     \"upload_image\": \"A\u00f1adir fotos\",\n     \"upload_video\": \"A\u00f1adir video\",\n     \"upload_music\": \"A\u00f1adir m\u00fasica\",\n-    \"upload_pdf\": \"A\u00f1adir pdf\",\n+    \"upload_pdf\": \"A\u00f1adir PDF\",\n     \"add_date\": \"A\u00f1adir una fecha\",\n     \"logout\": \"Desconectarse\",\n     \"settings\": \"Par\u00e1metros\",\n     \"name\": \"Nombre\",\n     \"name_input\": \"Elige un nombre\",\n-    \"login\": \"Usuario\",\n+    \"login\": \"Iniciar sesi\u00f3n\",\n     \"login_input\": \"Elige un usuario\",\n-    \"email\": \"Correo\",\n-    \"email_input\": \"Indicar correo electr\u00f3nico\",\n+    \"email\": \"Correo electr\u00f3nico\",\n+    \"email_input\": \"Escriba aqu\u00ed su direcci\u00f3n de correo electr\u00f3nico\",\n     \"save_changes\": \"Guardar los cambios\",\n     \"password\": \"Contrase\u00f1a\",\n     \"password_input\": \"Indicar una nueva contrase\u00f1a\",\n     \"Invalid login/password\": \"Usuario o contrase\u00f1a incorrecto\",\n     \"edit\": \"Editar\",\n     \"delete\": \"Borrar\",\n-    \"ask_delete_message\": \"\u00bfQuieres borrar este mensaje?\",\n+    \"ask_delete_message\": \"\u00bfBorrar este mensaje?\",\n     \"account\": \"Cuenta\",\n     \"forgot_password\": \"\u00bfOlvidaste tu contrase\u00f1a?\",\n-    \"password_reset_mail_sent\": \"El correo ha sido enviado!\",\n+    \"password_reset_mail_sent\": \"Busque el correo electr\u00f3nico de restablecimiento de la contrase\u00f1a en su bandeja de entrada.\",\n     \"User not found\": \"El usuario no existe\",\n     \"reset_password_title\": \"Cambia tu contrase\u00f1a\",\n     \"error\": \"Se ha producido un error\",\n     \"passwords_dont_match\": \"Las contrase\u00f1as no coinciden\",\n     \"invitation_link\": \"Enlace de invitaci\u00f3n\",\n     \"reset_invitation_link\": \"Cambiar el enlace de invitaci\u00f3n\",\n-    \"invitation_welcome\": \"Bienvenido a Zusam ! Inscribete para conectarte con un grupo.\",\n+    \"invitation_welcome\": \"Bienvenido a Zusam. Por favor, reg\u00edstrate antes de unirte al grupo.\",\n     \"signup\": \"Inscribirse\",\n     \"create_a_group\": \"Crear un grupo\",\n     \"create_the_group\": \"Crear el grupo\",\n     \"quit_group\": \"Dejar el grupo\",\n     \"settings_updated\": \"Sus ajustes fueron actualizados\",\n-    \"group_updated\": \"El grupo ha sido actualizado!\",\n-    \"group_left\": \"\u00a1Has dejado el grupo!\",\n+    \"group_updated\": \"El grupo ha sido actualizado.\",\n+    \"group_left\": \"Has dejado el grupo.\",\n     \"multiple_photos_upload\": \"Se ha producido un error. Intenta subir las im\u00e1genes una a una (esto puede ocurrir en algunos navegadores)\",\n     \"error_new_message\": \"Se ha producido un error al enviar su mensaje.\",\n     \"error_upload\": \"Se ha producido un error durante la carga\",\n     \"cancel_write\": \"\u00bfQuieres cancelar este nuevo mensaje?\",\n-    \"empty_message\": \"No hay mensaje!\",\n+    \"empty_message\": \"El mensaje est\u00e1 vac\u00edo y no se puede enviar.\",\n     \"cancel\": \"Cancelar\",\n     \"just_now\": \"Ahora\",\n-    \"notification_emails\": \"Correo de notificaci\u00f3n\",\n+    \"notification_emails\": \"Notificaciones por correo electr\u00f3nico\",\n     \"none\": \"Ninguno\",\n     \"hourly\": \"Cada hora\",\n     \"daily\": \"Diario\",\n     \"weekly\": \"Semanal\",\n     \"monthly\": \"Mensual\",\n-    \"notification_emails_stopped\": \"Notificaciones de correo electr\u00f3nico detenidas!\",\n-    \"group_share_choice\": \"\u00bfA qu\u00e9 grupo desea enviar este mensaje?\",\n+    \"notification_emails_stopped\": \"\u00a1Se han detenido las notificaciones por correo electr\u00f3nico!\",\n+    \"group_share_choice\": \"\u00bfA qu\u00e9 grupo quieres enviar este mensaje?\",\n     \"public_link\": \"enlace p\u00fablico\",\n     \"default_group\": \"Grupo predeterminado\",\n     \"destroy_account\": \"Borrar la cuenta\",\n@@ -93,8 +93,8 @@\n     \"api_key\": \"Clave API\",\n     \"reset_api_key\": \"Restablecer la clave API (se desconectar\u00e1)\",\n     \"video_not_ready\": \"El v\u00eddeo a\u00fan no est\u00e1 listo.\",\n-    \"bookmark_added\": \"Mensaje agregado a marcadores !\",\n-    \"bookmark_removed\": \"Mensaje eliminado de los marcadores !\",\n+    \"bookmark_added\": \"Mensaje en favoritos.\",\n+    \"bookmark_removed\": \"Se elimin\u00f3 el marcador de mensajes.\",\n     \"parent_message\": \"Mensaje para padres\",\n     \"audio_not_ready\": \"El audio a\u00fan no est\u00e1 listo.\",\n     \"upload_audio\": \"A\u00f1adir un archivo de audio.\""
            },
            {
                "sha": "c470d8807a22b286f918220ef855ccfddc8d6b6c",
                "filename": "app/dist/lang/fr_FR.json",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Ffr_FR.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Ffr_FR.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Ffr_FR.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -14,13 +14,13 @@\n     \"upload_image\": \"Ajouter des photos\",\n     \"upload_video\": \"Ajouter une vid\u00e9o\",\n     \"upload_music\": \"Ajouter des musiques\",\n-    \"upload_pdf\": \"Ajouter un pdf\",\n+    \"upload_pdf\": \"Ajouter un PDF\",\n     \"add_date\": \"Pr\u00e9ciser une date\",\n     \"logout\": \"Se d\u00e9connecter\",\n     \"settings\": \"Param\u00e8tres\",\n     \"name\": \"Nom\",\n     \"name_input\": \"Choisissez un nom\",\n-    \"login\": \"Identifiant\",\n+    \"login\": \"Se connecter\",\n     \"login_input\": \"Choisissez un identifiant\",\n     \"email\": \"Courriel\",\n     \"email_input\": \"Saisissez votre adresse \u00e9lectronique ici\",\n@@ -30,7 +30,7 @@\n     \"Invalid login/password\": \"Identifiant et/ou mot de passe invalide\",\n     \"edit\": \"Modifier\",\n     \"delete\": \"Supprimer\",\n-    \"ask_delete_message\": \"\u00cates-vous s\u00fbr de vouloir supprimer ce message ?\",\n+    \"ask_delete_message\": \"\u00cates-vous s\u00fbr de vouloir supprimer ce message\u202f?\",\n     \"account\": \"Compte\",\n     \"forgot_password\": \"Mot de passe oubli\u00e9 ?\",\n     \"password_reset_mail_sent\": \"Le courriel de r\u00e9initialisation a bien \u00e9t\u00e9 envoy\u00e9\u00a0!\",\n@@ -46,8 +46,8 @@\n     \"create_the_group\": \"Cr\u00e9er le groupe\",\n     \"quit_group\": \"Quitter le groupe\",\n     \"settings_updated\": \"Vos param\u00e8tres ont \u00e9t\u00e9 mis \u00e0 jour\",\n-    \"group_updated\": \"Le groupe a \u00e9t\u00e9 mis \u00e0 jour !\",\n-    \"group_left\": \"Vous avez quitt\u00e9 le groupe !\",\n+    \"group_updated\": \"Le groupe a \u00e9t\u00e9 mis \u00e0 jour.\",\n+    \"group_left\": \"Vous avez quitt\u00e9 le groupe.\",\n     \"multiple_photos_upload\": \"Une erreur s'est produite. Essayez de t\u00e9l\u00e9charger les images une par une (cela peut se produire dans certains navigateurs).\",\n     \"error_new_message\": \"Une erreur s\u2019est produite lors de l\u2019envoi de votre message.\",\n     \"error_upload\": \"Une erreur s'est produite pendant le t\u00e9l\u00e9versement\","
            },
            {
                "sha": "6b48f88aa348e1ce23d179ea01bccd0d2bf2d103",
                "filename": "app/dist/lang/hu_HU.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fhu_HU.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fhu_HU.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fhu_HU.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -14,7 +14,7 @@\n     \"upload_image\": \"Fot\u00f3k hozz\u00e1ad\u00e1sa\",\n     \"upload_video\": \"Vide\u00f3 hozz\u00e1ad\u00e1sa\",\n     \"upload_music\": \"Zen\u00e9k hozz\u00e1ad\u00e1sa\",\n-    \"upload_pdf\": \"Pdf hozz\u00e1ad\u00e1sa\",\n+    \"upload_pdf\": \"PDF hozz\u00e1ad\u00e1sa\",\n     \"add_date\": \"D\u00e1tum hozz\u00e1ad\u00e1sa\",\n     \"logout\": \"Kijelentkez\u00e9s\",\n     \"name_input\": \"V\u00e1lassz egy nevet\","
            },
            {
                "sha": "8b677d006f41e3a543a9cd2abf5e16cf518fad5a",
                "filename": "app/dist/lang/ko_KR.json",
                "status": "modified",
                "additions": 10,
                "deletions": 10,
                "changes": 20,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fko_KR.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fko_KR.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fko_KR.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -6,7 +6,7 @@\n     \"upload_pdf\": \"PDF \ucd94\uac00\",\n     \"password\": \"\ube44\ubc00\ubc88\ud638\",\n     \"password_input\": \"\uc5ec\uae30\uc5d0 \uc0c8\ub85c\uc6b4 \ube44\ubc00\ubc88\ud638 \uc791\uc131\",\n-    \"password_reset_mail_sent\": \"\ube44\ubc00\ubc88\ud638 \uc7ac\uc124\uc815 \uc774\uba54\uc77c\uc774 \uc804\uc1a1\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n+    \"password_reset_mail_sent\": \"\ube44\ubc00\ubc88\ud638 \uc7ac\uc124\uc815 \uc774\uba54\uc77c\uc774 \uc804\uc1a1\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\",\n     \"settings_updated\": \"\uc124\uc815 \uc5c5\ub370\uc774\ud2b8\ub428\",\n     \"notification_emails_stopped\": \"\uc774\uba54\uc77c \uc54c\ub9bc\uc774 \uc911\uc9c0\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n     \"public_link\": \"\uacf5\uac1c \ub9c1\ud06c\",\n@@ -32,13 +32,13 @@\n     \"upload_image\": \"\uc0ac\uc9c4 \ucd94\uac00\",\n     \"save_changes\": \"\ubcc0\uacbd \uc0ac\ud56d \uc800\uc7a5\",\n     \"email\": \"\uc774\uba54\uc77c\",\n-    \"email_input\": \"\uc5ec\uae30\uc5d0 \uc774\uba54\uc77c \uc785\ub825\",\n+    \"email_input\": \"\uc5ec\uae30\uc5d0 \uc774\uba54\uc77c \uc8fc\uc18c\ub97c \uc785\ub825\ud569\ub2c8\ub2e4\",\n     \"Invalid login/password\": \"\uc798\ubabb\ub41c \ub85c\uadf8\uc778 \ubc0f/\ub610\ub294 \ube44\ubc00\ubc88\ud638\",\n     \"edit\": \"\ud3b8\uc9d1\",\n     \"delete\": \"\uc0ad\uc81c\",\n     \"ask_delete_message\": \"\uc774 \uba54\uc2dc\uc9c0\ub97c \uc0ad\uc81c\ud558\uaca0\uc2b5\ub2c8\uae4c?\",\n     \"account\": \"\uacc4\uc815\",\n-    \"forgot_password\": \"\ube44\ubc00\ubc88\ud638\ub97c \uc78a\uc5c8\ub098\uc694?\",\n+    \"forgot_password\": \"\ube44\ubc00\ubc88\ud638\ub97c \uc78a\uc5b4\ubc84\ub838\uc2b5\ub2c8\uae4c?\",\n     \"signup\": \"\uac00\uc785\ud558\uae30\",\n     \"notification_emails\": \"\uc774\uba54\uc77c \uc54c\ub9bc\",\n     \"none\": \"\uc5c6\uc74c\",\n@@ -48,23 +48,23 @@\n     \"reset_invitation_link\": \"\ucd08\ub300 \ub9c1\ud06c \uc7ac\uc124\uc815\",\n     \"error\": \"\uc624\ub958 \ubc1c\uc0dd\",\n     \"passwords_dont_match\": \"\ube44\ubc00\ubc88\ud638\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc74c\",\n-    \"invitation_welcome\": \"Zusam\uc5d0 \uc624\uc2e0 \uac83\uc744 \ud658\uc601\ud569\ub2c8\ub2e4! \uadf8\ub8f9\uc5d0 \uac00\uc785\ud558\uae30 \uc804\uc5d0 \uac00\uc785\ud558\uc138\uc694.\",\n+    \"invitation_welcome\": \"Zusam\uc5d0 \uc624\uc2e0 \uac83\uc744 \ud658\uc601\ud569\ub2c8\ub2e4. \uadf8\ub8f9\uc5d0 \uac00\uc785\ud558\uae30 \uc804\uc5d0 \uac00\uc785\ud558\uc138\uc694.\",\n     \"create_a_group\": \"\uadf8\ub8f9 \ub9cc\ub4e4\uae30\",\n     \"daily\": \"\uc77c\uac04\",\n     \"create_the_group\": \"\uadf8\ub8f9 \ub9cc\ub4e4\uae30\",\n     \"quit_group\": \"\uadf8\ub8f9 \ub098\uac00\uae30\",\n-    \"group_updated\": \"\uadf8\ub8f9\uc774 \uc5c5\ub370\uc774\ud2b8\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n+    \"group_updated\": \"\uadf8\ub8f9\uc774 \uc5c5\ub370\uc774\ud2b8\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\",\n     \"multiple_photos_upload\": \"\uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4. \uc774\ubbf8\uc9c0\ub97c \ud558\ub098\uc529 \uc5c5\ub85c\ub4dc\ud574 \ubcf4\uc138\uc694 (\uc77c\ubd80 \ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c \ubc1c\uc0dd\ud560 \uc218 \uc788\uc74c).\",\n-    \"group_left\": \"\uadf8\ub8f9\uc744 \ub098\uac14\uc2b5\ub2c8\ub2e4!\",\n+    \"group_left\": \"\uadf8\ub8f9\uc744 \ub098\uac14\uc2b5\ub2c8\ub2e4.\",\n     \"error_new_message\": \"\uba54\uc2dc\uc9c0\ub97c \ubcf4\ub0b4\ub294 \ub3d9\uc548 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.\",\n-    \"empty_message\": \"\uba54\uc2dc\uc9c0\uac00 \ube44\uc5b4 \uc788\uc5b4 \ubcf4\ub0bc \uc218 \uc5c6\uc2b5\ub2c8\ub2e4!\",\n+    \"empty_message\": \"\uba54\uc2dc\uc9c0\uac00 \ube44\uc5b4 \uc788\uc5b4 \ubcf4\ub0bc \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.\",\n     \"default_group\": \"\uae30\ubcf8 \uadf8\ub8f9\",\n     \"error_upload\": \"\uc5c5\ub85c\ub4dc \uc911 \uc624\ub958 \ubc1c\uc0dd\",\n     \"weekly\": \"\uc8fc\uac04\",\n     \"monthly\": \"\uc6d4\uac04\",\n     \"cancel_write\": \"\uc0c8\ub85c\uc6b4 \uba54\uc2dc\uc9c0 \uc791\uc131\uc744 \ucde8\uc18c\ud558\uaca0\uc2b5\ub2c8\uae4c?\",\n     \"cancel\": \"\ucde8\uc18c\",\n-    \"group_share_choice\": \"\uc774 \uba54\uc2dc\uc9c0\ub97c \uc5b4\ub290 \uadf8\ub8f9\uc5d0 \ubcf4\ub0b4\uaca0\uc2b5\ub2c8\uae4c?\",\n+    \"group_share_choice\": \"\uc774 \uba54\uc2dc\uc9c0\ub97c \uc5b4\ub290 \uadf8\ub8f9\uc5d0 \ubcf4\ub0b4\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\",\n     \"hourly\": \"\ub9e4 \uc2dc\uac04\",\n     \"just_now\": \"\uc9c0\uae08 \ub2f9\uc7a5\",\n     \"users\": \"\uc0ac\uc6a9\uc790\",\n@@ -93,8 +93,8 @@\n     \"replies_other\": \"{{count}} \ub2f5\uae00\",\n     \"remove_bookmark\": \"\ubd81\ub9c8\ud06c \ud574\uc81c \uba54\uc2dc\uc9c0\",\n     \"api_key\": \"API \ud0a4\",\n-    \"bookmark_added\": \"\ubd81\ub9c8\ud06c\uc5d0 \uba54\uc2dc\uc9c0\uac00 \ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n-    \"bookmark_removed\": \"\ubd81\ub9c8\ud06c\uc5d0\uc11c \uba54\uc2dc\uc9c0\uac00 \uc81c\uac70\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n+    \"bookmark_added\": \"\ubd81\ub9c8\ud06c\uc5d0 \uba54\uc2dc\uc9c0\uac00 \ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\",\n+    \"bookmark_removed\": \"\ubd81\ub9c8\ud06c\uc5d0\uc11c \uba54\uc2dc\uc9c0\uac00 \uc81c\uac70\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\",\n     \"add_bookmark\": \"\ubd81\ub9c8\ud06c \uba54\uc2dc\uc9c0\",\n     \"audio_not_ready\": \"\uc624\ub514\uc624\uac00 \uc544\uc9c1 \uc900\ube44\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4.\",\n     \"upload_audio\": \"\uc624\ub514\uc624 \ud30c\uc77c\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4.\""
            },
            {
                "sha": "350a50c11b940e3d8e8a0c630198bb3a8c429839",
                "filename": "app/dist/lang/nb_NO.json",
                "status": "added",
                "additions": 101,
                "deletions": 0,
                "changes": 101,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fnb_NO.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fnb_NO.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fnb_NO.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,101 @@\n+{\n+    \"login_placeholder\": \"e-post\",\n+    \"password_placeholder\": \"passord\",\n+    \"new_password_placeholder\": \"nytt passord\",\n+    \"add_date\": \"Legg til en dato\",\n+    \"logout\": \"Logg ut\",\n+    \"upload_pdf\": \"Legg til PDF\",\n+    \"email_input\": \"Fyll inn e-postadressen din her\",\n+    \"save_changes\": \"Lagre endringer\",\n+    \"password\": \"Passord\",\n+    \"login_input\": \"Velg innloggingsnavn\",\n+    \"password_input\": \"Skriv det nye passordet ditt her\",\n+    \"ask_delete_message\": \"Slett meldingen?\",\n+    \"account\": \"Konto\",\n+    \"passwords_dont_match\": \"Passordene samsvarer ikke\",\n+    \"reset_invitation_link\": \"Tilbakestill invitasjonslenke\",\n+    \"password_reset_mail_sent\": \"Se etter e-post om tilbakestilling av passord i innboksen din.\",\n+    \"invitation_welcome\": \"Velkommen til Zusam. Registrer deg f\u00f8r du tar del i gruppen.\",\n+    \"group_updated\": \"Gruppen ble oppdatert.\",\n+    \"error_new_message\": \"En feil inntraff ved forsendelse av meldingen din\",\n+    \"just_now\": \"Akkurat n\u00e5\",\n+    \"none\": \"Ingen\",\n+    \"cancel_write\": \"Forkast den nye meldingen?\",\n+    \"group_share_choice\": \"Hvilken gruppe vil du sende denne meldingen til?\",\n+    \"share_message\": \"del meldingen\",\n+    \"has_posted_in\": \"har postet i\",\n+    \"destroy_account_explain\": \"N\u00e5r du sletter kontoen din er permanent. V\u00e6r sikker i din sak.\",\n+    \"in\": \"i\",\n+    \"has_joined\": \"har tatt del i\",\n+    \"has_left\": \"har forlatt\",\n+    \"has_commented_on\": \"har kommentert\",\n+    \"publish_in_group\": \"offentliggj\u00f8r i gruppen\",\n+    \"search_in_group\": \"s\u00f8k i denne gruppen\",\n+    \"changed_group_name\": \"endret gruppenavnet\",\n+    \"to\": \"til\",\n+    \"notifications\": \"merknader\",\n+    \"remove_bookmark\": \"Fjern meldingsbokmerke\",\n+    \"search_without_result\": \"S\u00f8ket ditt er resultatl\u00f8st.\",\n+    \"bookmarks\": \"bokmerker\",\n+    \"reset_api_key\": \"Tilbakestill API-n\u00f8kkelen (du vil bli frakoblet)\",\n+    \"bookmark_added\": \"Melding bokmerket.\",\n+    \"upload_audio\": \"Legg til en lydfil.\",\n+    \"previous_coms\": \"Vis tidligere kommentarer\",\n+    \"groups\": \"Grupper\",\n+    \"connect\": \"Tilkobling\",\n+    \"next_coms\": \"Vis videre kommentarer\",\n+    \"ago\": \"{{duration}} siden\",\n+    \"submit\": \"Send inn\",\n+    \"text_placeholder\": \"Skriv meldingen din her\",\n+    \"confirm_password_placeholder\": \"bekreft\",\n+    \"title_placeholder\": \"Navn p\u00e5 meldingen (valgfritt)\",\n+    \"upload_image\": \"Legg til bilder\",\n+    \"upload_video\": \"Legg til video\",\n+    \"upload_music\": \"Legg til musikk\",\n+    \"forgot_password\": \"Glemt passordet?\",\n+    \"settings\": \"Innstillinger\",\n+    \"name\": \"Navn\",\n+    \"signup\": \"Registrer deg\",\n+    \"name_input\": \"Velg et navn\",\n+    \"login\": \"Logg inn\",\n+    \"email\": \"E-post\",\n+    \"edit\": \"Rediger\",\n+    \"delete\": \"Slett\",\n+    \"error\": \"En feil oppstod\",\n+    \"User not found\": \"Fant ikke brukeren\",\n+    \"public_link\": \"offentlig lenke\",\n+    \"reset_password_title\": \"Tilbakestill passordet ditt\",\n+    \"invitation_link\": \"Invitasjonslenke\",\n+    \"create_a_group\": \"Opprett en gruppe\",\n+    \"create_the_group\": \"Opprett gruppen\",\n+    \"group_left\": \"Du forlot gruppen.\",\n+    \"quit_group\": \"Forlat gruppen\",\n+    \"destroy_account\": \"Slett kontoen din\",\n+    \"lang\": \"spr\u00e5k\",\n+    \"replies_other\": \"{{count}} svar\",\n+    \"daily\": \"Daglig\",\n+    \"weekly\": \"Ukentlig\",\n+    \"monthly\": \"M\u00e5nedlig\",\n+    \"default_group\": \"Forvalgt gruppe\",\n+    \"are_you_sure\": \"Er du sikker?\",\n+    \"the_message_from\": \"meldingen fra\",\n+    \"users\": \"brukere\",\n+    \"reply\": \"svar\",\n+    \"replies_one\": \"{{count}} svar\",\n+    \"video_not_ready\": \"Videoen er ikke klar enda.\",\n+    \"api_key\": \"API-n\u00f8kkel\",\n+    \"audio_not_ready\": \"Lyden er ikke klar enda.\",\n+    \"Invalid login/password\": \"Ugyldig brukernavn/eller passord\",\n+    \"mark_all_as_read\": \"marker alt som lest\",\n+    \"add_bookmark\": \"Bokmerk melding\",\n+    \"settings_updated\": \"Innstillingene dine ble oppdatert\",\n+    \"hourly\": \"Timevist\",\n+    \"multiple_photos_upload\": \"En feil inntraff. Pr\u00f8v \u00e5 laste opp bilder enkeltvis. (N\u00f8dvendig i noen nettlesere.)\",\n+    \"error_upload\": \"En feil inntraff under opplasting\",\n+    \"cancel\": \"Avbryt\",\n+    \"empty_message\": \"Meldingen er tom og kan ikke sendes.\",\n+    \"notification_emails\": \"E-postmerknader\",\n+    \"notification_emails_stopped\": \"E-postmerknader stoppet.\",\n+    \"bookmark_removed\": \"Meldingsbokmerke fjernet.\",\n+    \"parent_message\": \"Inneholdende melding\"\n+}"
            },
            {
                "sha": "8451276376a0af47805d8b86bd3f1e8d2c91be31",
                "filename": "app/dist/lang/nl_NL.json",
                "status": "modified",
                "additions": 18,
                "deletions": 18,
                "changes": 36,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fnl_NL.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fnl_NL.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fnl_NL.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -3,7 +3,7 @@\n     \"next_coms\": \"Zie volgende\",\n     \"ago\": \"{{duration}} geleden\",\n     \"groups\": \"Groepen\",\n-    \"login_placeholder\": \"email\",\n+    \"login_placeholder\": \"e-mail\",\n     \"password_placeholder\": \"wachtwoord\",\n     \"new_password_placeholder\": \"nieuw wachtwoord\",\n     \"confirm_password_placeholder\": \"bevestig wachtwoord\",\n@@ -22,47 +22,47 @@\n     \"name_input\": \"Kies een naam\",\n     \"login\": \"Aanmelden\",\n     \"login_input\": \"Kies een aanmeldingsnaam\",\n-    \"email\": \"Email\",\n-    \"email_input\": \"Voeg uw email adres hier in\",\n+    \"email\": \"E-mail\",\n+    \"email_input\": \"Voeg uw e-mail adres hier in\",\n     \"save_changes\": \"Wijzigingen opslaan\",\n     \"password\": \"Wachtwoord\",\n     \"password_input\": \"Kies een nieuw wachtwoord\",\n     \"Invalid login/password\": \"Ongeldige aanmeldnaam/wachtwoord combinatie\",\n     \"edit\": \"Bewerken\",\n     \"delete\": \"Verwijderen\",\n-    \"ask_delete_message\": \"Bent u zeker dat u dit bericht wil verwijderen?\",\n+    \"ask_delete_message\": \"Verwijder dit bericht?\",\n     \"account\": \"Account\",\n     \"forgot_password\": \"Wachtwoord vergeten?\",\n-    \"password_reset_mail_sent\": \"De wachtwoord reset link is naar uw email adres verstuurd !\",\n+    \"password_reset_mail_sent\": \"Zoek in uw inbox naar de wachtwoordreset e-mail.\",\n     \"User not found\": \"Gebruiker niet gevonden\",\n     \"reset_password_title\": \"Reset uw wachtwoord\",\n     \"error\": \"Er is een fout opgetreden\",\n     \"passwords_dont_match\": \"Wachtwoorden komen niet overeen\",\n     \"invitation_link\": \"Uitnodigings link\",\n     \"reset_invitation_link\": \"Reset uitnodiging link\",\n-    \"invitation_welcome\": \"Welkom op Zusam ! Gelieve aan te melden vooraleer in een groep in te schrijven.\",\n+    \"invitation_welcome\": \"Welkom op Zusam. Gelieve aan te melden vooraleer in een groep in te schrijven.\",\n     \"signup\": \"Inschrijven\",\n     \"create_a_group\": \"Maak een groep\",\n     \"create_the_group\": \"Maak de groep\",\n     \"quit_group\": \"Verlaat de groep\",\n     \"settings_updated\": \"Uw instellingen werden aangepast\",\n-    \"group_updated\": \"De groep werd aangepast !\",\n-    \"group_left\": \"U heeft de groep verlaten !\",\n-    \"multiple_photos_upload\": \"Er is een fout opgetreden. Probeer foto's 1 voor 1 op te laden\",\n+    \"group_updated\": \"De groep werd aangepast.\",\n+    \"group_left\": \"U heeft de groep verlaten.\",\n+    \"multiple_photos_upload\": \"Er is een fout opgetreden. Probeer foto's \u00e9\u00e9n voor \u00e9\u00e9n op te laden\",\n     \"error_new_message\": \"Er is een fout opgetreden bij het doorsturen van uw bericht.\",\n     \"error_upload\": \"Er is een fout opgetreden bij het uploaden\",\n     \"cancel_write\": \"Bent u zeker dat u dit bericht wil annuleren?\",\n-    \"empty_message\": \"Dit bericht is leeg en kan niet worden verzonden !\",\n+    \"empty_message\": \"Dit bericht is leeg en kan niet worden verzonden.\",\n     \"cancel\": \"Annuleren\",\n     \"just_now\": \"Net\",\n-    \"notification_emails\": \"Email notificaties\",\n+    \"notification_emails\": \"E-mail meldingen\",\n     \"none\": \"Niets\",\n     \"hourly\": \"Elk uur\",\n     \"daily\": \"Elke dag\",\n     \"weekly\": \"Elke week\",\n     \"monthly\": \"Elke maand\",\n-    \"notification_emails_stopped\": \"Email notificaties zijn gestopt !\",\n-    \"group_share_choice\": \"Naar welke groep wenst u dit bericht te sturen?\",\n+    \"notification_emails_stopped\": \"E-mail meldingen zijn gestopt !\",\n+    \"group_share_choice\": \"Naar welke groep wenst u dit bericht te versturen?\",\n     \"public_link\": \"publieke link\",\n     \"default_group\": \"Standaard groep\",\n     \"destroy_account\": \"Verwijder jouw account\",\n@@ -91,11 +91,11 @@\n     \"remove_bookmark\": \"Unbookmark bericht\",\n     \"bookmarks\": \"bookmarks\",\n     \"api_key\": \"API key\",\n-    \"reset_api_key\": \"Reset the API key (you will be disconnected)\",\n+    \"reset_api_key\": \"Reset de API key (u zal worden gedeconnecteerd)\",\n     \"video_not_ready\": \"Video is nog niet klaar.\",\n-    \"bookmark_added\": \"Bericht toegevoegd aan bookmarks !\",\n-    \"bookmark_removed\": \"Bericht verwijderd uit bookmarks !\",\n+    \"bookmark_added\": \"Bericht toegevoegd aan bladwijzers.\",\n+    \"bookmark_removed\": \"Bericht verwijderd uit bladwijzers.\",\n     \"parent_message\": \"Parent bericht\",\n-    \"upload_audio\": \"\",\n-    \"audio_not_ready\": \"\"\n+    \"upload_audio\": \"Voeg een audiobestand toe.\",\n+    \"audio_not_ready\": \"Audio is nog niet klaar.\"\n }"
            },
            {
                "sha": "101e40330831ec0d0f413428e61010a2d6816cca",
                "filename": "app/dist/lang/pt_BR.json",
                "status": "added",
                "additions": 101,
                "deletions": 0,
                "changes": 101,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fpt_BR.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fpt_BR.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fpt_BR.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,101 @@\n+{\n+    \"next_coms\": \"Ver os pr\u00f3ximos coment\u00e1rios\",\n+    \"ago\": \"{{duration}} atr\u00e1s\",\n+    \"new_password_placeholder\": \"nova senha\",\n+    \"confirm_password_placeholder\": \"confirmar senha\",\n+    \"connect\": \"Conex\u00e3o\",\n+    \"submit\": \"Enviar\",\n+    \"text_placeholder\": \"Escreva sua mensagem aqui\",\n+    \"upload_video\": \"Adicionar um v\u00eddeo\",\n+    \"upload_music\": \"Adicionar m\u00fasica\",\n+    \"upload_pdf\": \"Adicionar PDF\",\n+    \"login\": \"Entrar\",\n+    \"login_input\": \"Escolha um login\",\n+    \"Invalid login/password\": \"Login e/ou senha inv\u00e1lidos\",\n+    \"edit\": \"Editar\",\n+    \"ask_delete_message\": \"Deletar essa mensagem?\",\n+    \"passwords_dont_match\": \"As senhas n\u00e3o coincidem\",\n+    \"invitation_welcome\": \"Bem-vindo ao Zusam. Registre-se antes de entrar no grupo.\",\n+    \"create_the_group\": \"Criar o grupo\",\n+    \"group_updated\": \"O grupo foi atualizado.\",\n+    \"cancel_write\": \"Voc\u00ea realmente deseja cancelar a cria\u00e7\u00e3o de uma nova mensagem?\",\n+    \"just_now\": \"Agora mesmo\",\n+    \"hourly\": \"Por Hora\",\n+    \"destroy_account\": \"Deletar sua conta\",\n+    \"are_you_sure\": \"Voc\u00ea tem certeza?\",\n+    \"share_message\": \"compartilhe a mensagem\",\n+    \"has_commented_on\": \"comentou em\",\n+    \"in\": \"em\",\n+    \"lang\": \"idioma\",\n+    \"publish_in_group\": \"publicar no grupo\",\n+    \"remove_bookmark\": \"Remover mensagem dos favoritos\",\n+    \"api_key\": \"Chave API\",\n+    \"video_not_ready\": \"O v\u00eddeo ainda n\u00e3o est\u00e1 pronto.\",\n+    \"previous_coms\": \"Ver coment\u00e1rios anteriores\",\n+    \"groups\": \"Grupos\",\n+    \"login_placeholder\": \"e-mail\",\n+    \"password_placeholder\": \"senha\",\n+    \"title_placeholder\": \"T\u00edtulo da sua mensagem (opcional)\",\n+    \"upload_image\": \"Adicionar fotos\",\n+    \"logout\": \"Sair da sess\u00e3o\",\n+    \"add_date\": \"Adicionar uma data\",\n+    \"settings\": \"Configura\u00e7\u00f5es\",\n+    \"email\": \"E-mail\",\n+    \"password\": \"Senha\",\n+    \"name\": \"Nome\",\n+    \"email_input\": \"Preencha seu endere\u00e7o de e-mail aqui\",\n+    \"name_input\": \"Escolher um nome\",\n+    \"save_changes\": \"Salvar altera\u00e7\u00f5es\",\n+    \"password_input\": \"Escreva uma nova senha aqui\",\n+    \"delete\": \"Deletar\",\n+    \"account\": \"Conta\",\n+    \"forgot_password\": \"Esqueceu sua senha?\",\n+    \"password_reset_mail_sent\": \"Procure o e-mail de redefini\u00e7\u00e3o de senha em sua caixa de entrada.\",\n+    \"User not found\": \"Usu\u00e1rio n\u00e3o encontrado\",\n+    \"reset_password_title\": \"Redefinir sua senha\",\n+    \"error\": \"Um erro ocorreu\",\n+    \"invitation_link\": \"Link de convite\",\n+    \"reset_invitation_link\": \"Redefinir o link de convite\",\n+    \"signup\": \"Registrar-se\",\n+    \"create_a_group\": \"Criar um grupo\",\n+    \"quit_group\": \"Sair do grupo\",\n+    \"settings_updated\": \"Suas configura\u00e7\u00f5es foram atualizadas\",\n+    \"group_left\": \"Voc\u00ea saiu do grupo.\",\n+    \"multiple_photos_upload\": \"Ocorreu um erro. Tente fazer o upload das imagens uma a uma (isso pode ocorrer em alguns navegadores)\",\n+    \"error_new_message\": \"Um erro ocorreu ao enviar sua mensagem.\",\n+    \"error_upload\": \"Ocorreu um erro durante o envio\",\n+    \"empty_message\": \"A mensagem est\u00e1 vazia e n\u00e3o pode ser enviada.\",\n+    \"cancel\": \"Cancelar\",\n+    \"notification_emails\": \"Notifica\u00e7\u00f5es de e-mail\",\n+    \"none\": \"Nenhuma\",\n+    \"daily\": \"Diariamente\",\n+    \"weekly\": \"Semanalmente\",\n+    \"monthly\": \"Mensal\",\n+    \"notification_emails_stopped\": \"As notifica\u00e7\u00f5es de e-mail foram interrompidas!\",\n+    \"group_share_choice\": \"Para qual grupo voc\u00ea deseja enviar essa mensagem?\",\n+    \"public_link\": \"link p\u00fablico\",\n+    \"default_group\": \"Grupo padr\u00e3o\",\n+    \"destroy_account_explain\": \"Depois de excluir sua conta, n\u00e3o h\u00e1 como voltar atr\u00e1s. Por favor, tenha certeza.\",\n+    \"users\": \"usu\u00e1rios\",\n+    \"has_posted_in\": \"postou em\",\n+    \"has_joined\": \"entrou\",\n+    \"has_left\": \"saiu\",\n+    \"the_message_from\": \"a mensagem de\",\n+    \"reply\": \"responder\",\n+    \"replies_one\": \"{{count}} responder\",\n+    \"replies_other\": \"{{count}} respostas\",\n+    \"search_in_group\": \"procurar neste grupo\",\n+    \"changed_group_name\": \"mudou o nome do grupo\",\n+    \"to\": \"para\",\n+    \"notifications\": \"notifica\u00e7\u00f5es\",\n+    \"mark_all_as_read\": \"marcar todos como lido\",\n+    \"search_without_result\": \"Sua pesquisa n\u00e3o correspondeu a nenhuma mensagem.\",\n+    \"add_bookmark\": \"Adicionar mensagem aos favoritos\",\n+    \"bookmarks\": \"Favoritos\",\n+    \"reset_api_key\": \"Redefinir a chave API (voc\u00ea ser\u00e1 desconectado)\",\n+    \"bookmark_added\": \"Mensagem adicionada aos favoritos.\",\n+    \"bookmark_removed\": \"Mensagem removida dos favoritos.\",\n+    \"parent_message\": \"Mensagem relacionada\",\n+    \"audio_not_ready\": \"O \u00e1udio ainda n\u00e3o est\u00e1 pronto.\",\n+    \"upload_audio\": \"Adicionar um arquivo de \u00e1udio.\"\n+}"
            },
            {
                "sha": "2c20a9503f3abf24bca37d2065ccc148ea71902b",
                "filename": "app/dist/lang/ru_RU.json",
                "status": "modified",
                "additions": 62,
                "deletions": 61,
                "changes": 123,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fru_RU.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fru_RU.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fru_RU.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,80 +1,81 @@\n {\n-    \"save_changes\": \"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\",\n+    \"add_bookmark\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n     \"add_date\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u0442\u0443\",\n-    \"are_you_sure\": \"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?\",\n-    \"text_placeholder\": \"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0441\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0437\u0434\u0435\u0441\u044c\",\n-    \"password\": \"\u041f\u0430\u0440\u043e\u043b\u044c\",\n-    \"has_left\": \"\u0443\u0448\u0435\u043b\",\n-    \"password_input\": \"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u0437\u0434\u0435\u0441\u044c\",\n-    \"has_commented_on\": \"\u043f\u0440\u043e\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043b\",\n-    \"video_not_ready\": \"\u0412\u0438\u0434\u0435\u043e \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u043e.\",\n-    \"group_left\": \"\u0422\u044b \u043f\u043e\u043a\u0438\u043d\u0443\u043b \u0433\u0440\u0443\u043f\u043f\u0443 !\",\n     \"api_key\": \"\u041a\u043b\u044e\u0447 API\",\n+    \"are_you_sure\": \"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?\",\n     \"ask_delete_message\": \"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?\",\n-    \"the_message_from\": \"\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442\",\n+    \"audio_not_ready\": \"\u0410\u0443\u0434\u0438\u043e \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u043e.\",\n+    \"bookmark_added\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e \u0432 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438 !\",\n+    \"bookmark_removed\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e \u0438\u0437 \u0437\u0430\u043a\u043b\u0430\u0434\u043e\u043a !\",\n+    \"bookmarks\": \"\u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n+    \"cancel_write\": \"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u043e\u0432\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f?\",\n     \"changed_group_name\": \"\u0438\u0437\u043c\u0435\u043d\u0438\u043b \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b\",\n-    \"has_joined\": \"\u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u043b\u0441\u044f\",\n-    \"title_placeholder\": \"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0432\u0430\u0448\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)\",\n+    \"confirm_password_placeholder\": \"\u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c\",\n     \"create_a_group\": \"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443\",\n-    \"group_share_choice\": \"\u041a\u0430\u043a\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u0435 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?\",\n-    \"email\": \"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430\",\n-    \"edit\": \"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c\",\n-    \"password_reset_mail_sent\": \"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0435 \u043f\u0438\u0441\u044c\u043c\u043e \u0441\u043e \u0441\u0431\u0440\u043e\u0441\u043e\u043c \u043f\u0430\u0440\u043e\u043b\u044f \u0431\u044b\u043b\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e !\",\n-    \"search_in_group\": \"\u043f\u043e\u0438\u0441\u043a \u0432 \u044d\u0442\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u0435\",\n-    \"upload_audio\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0430\u0443\u0434\u0438\u043e\u0444\u0430\u0439\u043b.\",\n-    \"search_without_result\": \"\u0412\u0430\u0448 \u043f\u043e\u0438\u0441\u043a \u043d\u0435 \u0432\u044b\u044f\u0432\u0438\u043b \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.\",\n-    \"invitation_link\": \"\u041f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0441\u0441\u044b\u043b\u043a\u0430\",\n-    \"passwords_dont_match\": \"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442\",\n-    \"name\": \"\u0418\u043c\u044f\",\n-    \"bookmark_removed\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e \u0438\u0437 \u0437\u0430\u043a\u043b\u0430\u0434\u043e\u043a !\",\n-    \"in\": \"\u0432\",\n-    \"new_password_placeholder\": \"\u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c\",\n-    \"upload_image\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438\",\n-    \"User not found\": \"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\",\n-    \"password_placeholder\": \"\u043f\u0430\u0440\u043e\u043b\u044c\",\n+    \"default_group\": \"\u0413\u0440\u0443\u043f\u043f\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e\",\n     \"delete\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c\",\n-    \"to\": \"\u043a\",\n-    \"publish_in_group\": \"\u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0435\",\n-    \"remove_bookmark\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438\u0437 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n+    \"destroy_account\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\",\n+    \"edit\": \"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c\",\n+    \"email_input\": \"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0430\u0434\u0440\u0435\u0441 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u044b \u0437\u0434\u0435\u0441\u044c\",\n+    \"email\": \"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430\",\n+    \"empty_message\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043f\u0443\u0441\u0442\u043e\u0435 \u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e !\",\n     \"error_new_message\": \"\u041f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0432\u0430\u0448\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430.\",\n-    \"reset_invitation_link\": \"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u043f\u0440\u0438\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u0435\",\n-    \"notifications\": \"\u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f\",\n-    \"reset_api_key\": \"\u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043a\u043b\u044e\u0447 API (\u0432\u044b \u0431\u0443\u0434\u0435\u0442\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u044b)\",\n-    \"name_input\": \"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u043c\u044f\",\n-    \"cancel_write\": \"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u043e\u0432\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f?\",\n-    \"upload_pdf\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c pdf-\u0444\u0430\u0439\u043b\",\n-    \"forgot_password\": \"\u0412\u044b \u0437\u0430\u0431\u044b\u043b\u0438 \u0441\u0432\u043e\u0439 \u043f\u0430\u0440\u043e\u043b\u044c?\",\n-    \"bookmark_added\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e \u0432 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438 !\",\n     \"error_upload\": \"\u0412\u043e \u0432\u0440\u0435\u043c\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430\",\n-    \"audio_not_ready\": \"\u0410\u0443\u0434\u0438\u043e \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u043e.\",\n-    \"upload_music\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043c\u0443\u0437\u044b\u043a\u0443\",\n-    \"invitation_welcome\": \"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u043d\u0430 Zusam! \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c, \u043f\u0440\u0435\u0436\u0434\u0435 \u0447\u0435\u043c \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u043a \u0433\u0440\u0443\u043f\u043f\u0435.\",\n-    \"mark_all_as_read\": \"\u043e\u0442\u043c\u0435\u0442\u044c\u0442\u0435 \u0432\u0441\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u043e\u0435\",\n-    \"lang\": \"\u044f\u0437\u044b\u043a\",\n-    \"group_updated\": \"\u0413\u0440\u0443\u043f\u043f\u0430 \u0431\u044b\u043b\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430!\",\n-    \"users\": \"\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438\",\n-    \"email_input\": \"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0430\u0434\u0440\u0435\u0441 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u044b \u0437\u0434\u0435\u0441\u044c\",\n     \"error\": \"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430\",\n-    \"Invalid login/password\": \"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438/\u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c\",\n-    \"logout\": \"\u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b\",\n+    \"forgot_password\": \"\u0412\u044b \u0437\u0430\u0431\u044b\u043b\u0438 \u0441\u0432\u043e\u0439 \u043f\u0430\u0440\u043e\u043b\u044c?\",\n+    \"group_left\": \"\u0422\u044b \u043f\u043e\u043a\u0438\u043d\u0443\u043b \u0433\u0440\u0443\u043f\u043f\u0443 !\",\n+    \"group_share_choice\": \"\u041a\u0430\u043a\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u0435 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?\",\n     \"groups\": \"\u0413\u0440\u0443\u043f\u043f\u044b\",\n-    \"login\": \"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f\",\n-    \"destroy_account\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\",\n-    \"confirm_password_placeholder\": \"\u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c\",\n-    \"default_group\": \"\u0413\u0440\u0443\u043f\u043f\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e\",\n+    \"group_updated\": \"\u0413\u0440\u0443\u043f\u043f\u0430 \u0431\u044b\u043b\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430!\",\n+    \"has_commented_on\": \"\u043f\u0440\u043e\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043b\",\n+    \"has_joined\": \"\u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u043b\u0441\u044f\",\n+    \"has_left\": \"\u0443\u0448\u0435\u043b\",\n+    \"has_posted_in\": \"\u0440\u0430\u0437\u043c\u0435\u0441\u0442\u0438\u043b \u0432\",\n+    \"Invalid login/password\": \"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438/\u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c\",\n+    \"invitation_link\": \"\u041f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0441\u0441\u044b\u043b\u043a\u0430\",\n+    \"invitation_welcome\": \"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u043d\u0430 Zusam! \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c, \u043f\u0440\u0435\u0436\u0434\u0435 \u0447\u0435\u043c \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u043a \u0433\u0440\u0443\u043f\u043f\u0435.\",\n+    \"in\": \"\u0432\",\n+    \"lang\": \"\u044f\u0437\u044b\u043a\",\n     \"login_placeholder\": \"\u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430\",\n-    \"upload_video\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e\",\n-    \"settings\": \"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438\",\n+    \"login\": \"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f\",\n+    \"logout\": \"\u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b\",\n+    \"mark_all_as_read\": \"\u043e\u0442\u043c\u0435\u0442\u044c\u0442\u0435 \u0432\u0441\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u043e\u0435\",\n     \"multiple_photos_upload\": \"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u043e \u043e\u0434\u043d\u043e\u043c\u0443 (\u044d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u043e\u0439\u0442\u0438 \u0432 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430\u0445)\",\n-    \"notification_emails\": \"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043f\u043e \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u0435\",\n-    \"signup\": \"\u0412\u043e\u0439\u0442\u0438\",\n+    \"name_input\": \"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u043c\u044f\",\n+    \"name\": \"\u0418\u043c\u044f\",\n+    \"new_password_placeholder\": \"\u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c\",\n     \"notification_emails_stopped\": \"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043f\u043e \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u0435 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u044b !\",\n-    \"add_bookmark\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n+    \"notification_emails\": \"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043f\u043e \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u0435\",\n+    \"notifications\": \"\u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f\",\n+    \"password_input\": \"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u0437\u0434\u0435\u0441\u044c\",\n+    \"password_placeholder\": \"\u043f\u0430\u0440\u043e\u043b\u044c\",\n+    \"password_reset_mail_sent\": \"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0435 \u043f\u0438\u0441\u044c\u043c\u043e \u0441\u043e \u0441\u0431\u0440\u043e\u0441\u043e\u043c \u043f\u0430\u0440\u043e\u043b\u044f \u0431\u044b\u043b\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e !\",\n+    \"passwords_dont_match\": \"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442\",\n+    \"password\": \"\u041f\u0430\u0440\u043e\u043b\u044c\",\n     \"public_link\": \"\u043e\u0431\u0449\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430\u044f \u0441\u0441\u044b\u043b\u043a\u0430\",\n-    \"has_posted_in\": \"\u0440\u0430\u0437\u043c\u0435\u0441\u0442\u0438\u043b \u0432\",\n+    \"publish_in_group\": \"\u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0435\",\n     \"quit_group\": \"\u041f\u043e\u043a\u0438\u043d\u0443\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443\",\n+    \"remove_bookmark\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438\u0437 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n+    \"reset_api_key\": \"\u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043a\u043b\u044e\u0447 API (\u0432\u044b \u0431\u0443\u0434\u0435\u0442\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u044b)\",\n+    \"reset_invitation_link\": \"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u043f\u0440\u0438\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u0435\",\n+    \"save_changes\": \"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\",\n+    \"search_in_group\": \"\u043f\u043e\u0438\u0441\u043a \u0432 \u044d\u0442\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u0435\",\n+    \"search_without_result\": \"\u0412\u0430\u0448 \u043f\u043e\u0438\u0441\u043a \u043d\u0435 \u0432\u044b\u044f\u0432\u0438\u043b \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.\",\n     \"settings_updated\": \"\u0412\u0430\u0448\u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0431\u044b\u043b\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u044b\",\n+    \"settings\": \"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438\",\n     \"share_message\": \"\u043f\u043e\u0434\u0435\u043b\u0438\u0442\u044c\u0441\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\u043c\",\n-    \"empty_message\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043f\u0443\u0441\u0442\u043e\u0435 \u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e !\",\n-    \"bookmarks\": \"\u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\"\n+    \"signup\": \"\u0412\u043e\u0439\u0442\u0438\",\n+    \"text_placeholder\": \"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0441\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0437\u0434\u0435\u0441\u044c\",\n+    \"the_message_from\": \"\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442\",\n+    \"title_placeholder\": \"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0432\u0430\u0448\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)\",\n+    \"to\": \"\u043a\",\n+    \"upload_audio\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0430\u0443\u0434\u0438\u043e\u0444\u0430\u0439\u043b.\",\n+    \"upload_image\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438\",\n+    \"upload_music\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043c\u0443\u0437\u044b\u043a\u0443\",\n+    \"upload_pdf\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c pdf-\u0444\u0430\u0439\u043b\",\n+    \"upload_pdf\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c PDF-\u0444\u0430\u0439\u043b\",\n+    \"upload_video\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e\",\n+    \"User not found\": \"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\",\n+    \"users\": \"\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438\",\n+    \"video_not_ready\": \"\u0412\u0438\u0434\u0435\u043e \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u043e.\"\n }"
            },
            {
                "sha": "98000782adf0473497d44eaff9ae2960a59f99d2",
                "filename": "app/dist/lang/sk_SK.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fsk_SK.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fsk_SK.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fsk_SK.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -14,7 +14,7 @@\n     \"upload_image\": \"Prida\u0165 fotografie\",\n     \"upload_video\": \"Pridajte video\",\n     \"upload_music\": \"Prida\u0165 hudbu\",\n-    \"upload_pdf\": \"Prida\u0165 pdf\",\n+    \"upload_pdf\": \"Prida\u0165 PDF\",\n     \"add_date\": \"Prida\u0165 d\u00e1tum\",\n     \"logout\": \"Odhl\u00e1si\u0165\",\n     \"settings\": \"Nastavenia\","
            },
            {
                "sha": "153e217125b00e99c2476f1e1a37d91fecac80a5",
                "filename": "app/dist/lang/ta_IN.json",
                "status": "added",
                "additions": 101,
                "deletions": 0,
                "changes": 101,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fta_IN.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fta_IN.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fta_IN.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,101 @@\n+{\n+    \"previous_coms\": \"\u0bae\u0bc1\u0ba8\u0bcd\u0ba4\u0bc8\u0baf \u0b95\u0bb0\u0bc1\u0ba4\u0bcd\u0ba4\u0bc1\u0b95\u0bb3\u0bc8\u0baa\u0bcd \u0baa\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"upload_music\": \"\u0b87\u0b9a\u0bc8\u0baf\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"upload_pdf\": \"PDF \u0b90\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"add_date\": \"\u0b92\u0bb0\u0bc1 \u0ba4\u0bc7\u0ba4\u0bbf\u0baf\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"logout\": \"\u0bb5\u0bbf\u0b9f\u0bc1\u0baa\u0ba4\u0bbf\u0b95\u0bc8\",\n+    \"settings\": \"\u0b85\u0bae\u0bc8\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd\",\n+    \"login_input\": \"\u0b89\u0bb3\u0bcd\u0ba8\u0bc1\u0bb4\u0bc8\u0bb5\u0bc8\u0ba4\u0bcd \u0ba4\u0bc7\u0bb0\u0bcd\u0bb5\u0bc1\u0b9a\u0bc6\u0baf\u0bcd\u0b95\",\n+    \"reply\": \"\u0baa\u0ba4\u0bbf\u0bb2\u0bcd\",\n+    \"replies_one\": \"{{count}} \u0baa\u0ba4\u0bbf\u0bb2\u0bcd\",\n+    \"bookmark_added\": \"\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf \u0baa\u0bc1\u0b95\u0bcd\u0bae\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0baf\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1.\",\n+    \"next_coms\": \"\u0b85\u0b9f\u0bc1\u0ba4\u0bcd\u0ba4 \u0b95\u0bb0\u0bc1\u0ba4\u0bcd\u0ba4\u0bc1\u0b95\u0bb3\u0bc8\u0baa\u0bcd \u0baa\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"ago\": \"{{\u0b95\u0bbe\u0bb2\u0bae\u0bcd}} \u0bae\u0bc1\u0ba9\u0bcd\u0baa\u0bc1\",\n+    \"groups\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0b95\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"login_placeholder\": \"\u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd\",\n+    \"password_placeholder\": \"\u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\",\n+    \"new_password_placeholder\": \"\u0baa\u0bc1\u0ba4\u0bbf\u0baf \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\",\n+    \"confirm_password_placeholder\": \"\u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb2\u0bcd\u0bb2\u0bc8 \u0b89\u0bb1\u0bc1\u0ba4\u0bbf\u0baa\u0bcd\u0baa\u0b9f\u0bc1\u0ba4\u0bcd\u0ba4\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"connect\": \"\u0b87\u0ba3\u0bc8\u0baa\u0bcd\u0baa\u0bc1\",\n+    \"submit\": \"\u0b9a\u0bae\u0bb0\u0bcd\u0baa\u0bcd\u0baa\u0bbf\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"title_placeholder\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bbf\u0ba9\u0bcd \u0ba4\u0bb2\u0bc8\u0baa\u0bcd\u0baa\u0bc1 (\u0bb5\u0bbf\u0bb0\u0bc1\u0bae\u0bcd\u0baa\u0bbf\u0ba9\u0bbe\u0bb2\u0bcd)\",\n+    \"text_placeholder\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0b87\u0b99\u0bcd\u0b95\u0bc7 \u0b8e\u0bb4\u0bc1\u0ba4\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"upload_image\": \"\u0baa\u0bc1\u0b95\u0bc8\u0baa\u0bcd\u0baa\u0b9f\u0b99\u0bcd\u0b95\u0bb3\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"upload_video\": \"\u0bb5\u0bc0\u0b9f\u0bbf\u0baf\u0bcb\u0bb5\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"name\": \"\u0baa\u0bc6\u0baf\u0bb0\u0bcd\",\n+    \"name_input\": \"\u0b92\u0bb0\u0bc1 \u0baa\u0bc6\u0baf\u0bb0\u0bc8\u0ba4\u0bcd \u0ba4\u0bc7\u0bb0\u0bcd\u0bb5\u0bc1\u0b9a\u0bc6\u0baf\u0bcd\u0b95\",\n+    \"login\": \"\u0baa\u0bc1\u0b95\u0bc1\u0baa\u0ba4\u0bbf\u0b95\u0bc8\",\n+    \"email\": \"\u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd\",\n+    \"email_input\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd \u0bae\u0bc1\u0b95\u0bb5\u0bb0\u0bbf\u0baf\u0bc8 \u0b87\u0b99\u0bcd\u0b95\u0bc7 \u0ba8\u0bbf\u0bb0\u0baa\u0bcd\u0baa\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"save_changes\": \"\u0bae\u0bbe\u0bb1\u0bcd\u0bb1\u0b99\u0bcd\u0b95\u0bb3\u0bc8 \u0b9a\u0bc7\u0bae\u0bbf\u0baf\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"password\": \"\u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\",\n+    \"password_input\": \"\u0baa\u0bc1\u0ba4\u0bbf\u0baf \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb2\u0bcd\u0bb2\u0bc8 \u0b87\u0b99\u0bcd\u0b95\u0bc7 \u0b8e\u0bb4\u0bc1\u0ba4\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"Invalid login/password\": \"\u0ba4\u0bb5\u0bb1\u0bbe\u0ba9 \u0b89\u0bb3\u0bcd\u0ba8\u0bc1\u0bb4\u0bc8\u0bb5\u0bc1 \u0bae\u0bb1\u0bcd\u0bb1\u0bc1\u0bae\u0bcd/\u0b85\u0bb2\u0bcd\u0bb2\u0ba4\u0bc1 \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb2\u0bcd\",\n+    \"edit\": \"\u0ba4\u0bc6\u0bbe\u0b95\u0bc1\",\n+    \"delete\": \"\u0b85\u0bb4\u0bbf\",\n+    \"ask_delete_message\": \"\u0b87\u0ba8\u0bcd\u0ba4 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0ba8\u0bc0\u0b95\u0bcd\u0b95\u0bb5\u0bbe?\",\n+    \"account\": \"\u0b95\u0ba3\u0b95\u0bcd\u0b95\u0bc1\",\n+    \"forgot_password\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\u0bb2\u0bc8 \u0bae\u0bb1\u0ba8\u0bcd\u0ba4\u0bc1 \u0bb5\u0bbf\u0b9f\u0bcd\u0b9f\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bbe?\",\n+    \"password_reset_mail_sent\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b87\u0ba9\u0bcd\u0baa\u0bbe\u0b95\u0bcd\u0b9a\u0bbf\u0bb2\u0bcd \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb2\u0bcd \u0bae\u0bc0\u0b9f\u0bcd\u0b9f\u0bae\u0bc8\u0baa\u0bcd\u0baa\u0bc1 \u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bc8\u0ba4\u0bcd \u0ba4\u0bc7\u0b9f\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd.\",\n+    \"User not found\": \"\u0baa\u0baf\u0ba9\u0bb0\u0bcd \u0b95\u0ba3\u0bcd\u0b9f\u0bc1\u0baa\u0bbf\u0b9f\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bb5\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8\",\n+    \"reset_password_title\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\u0bb2\u0bc8 \u0bae\u0bc0\u0b9f\u0bcd\u0b9f\u0bae\u0bc8\u0b95\u0bcd\u0b95\",\n+    \"public_link\": \"\u0baa\u0bca\u0ba4\u0bc1 \u0b87\u0ba3\u0bc8\u0baa\u0bcd\u0baa\u0bc1\",\n+    \"error\": \"\u0baa\u0bbf\u0bb4\u0bc8 \u0b8f\u0bb1\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1\",\n+    \"passwords_dont_match\": \"\u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb1\u0bcd\u0b95\u0bb3\u0bcd \u0baa\u0bca\u0bb0\u0bc1\u0ba8\u0bcd\u0ba4\u0bb5\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8\",\n+    \"invitation_link\": \"\u0b85\u0bb4\u0bc8\u0baa\u0bcd\u0baa\u0bbf\u0ba4\u0bb4\u0bcd \u0b87\u0ba3\u0bc8\u0baa\u0bcd\u0baa\u0bc1\",\n+    \"reset_invitation_link\": \"\u0b85\u0bb4\u0bc8\u0baa\u0bcd\u0baa\u0bbf\u0ba4\u0bb4\u0bcd \u0b87\u0ba3\u0bc8\u0baa\u0bcd\u0baa\u0bc8 \u0bae\u0bc0\u0b9f\u0bcd\u0b9f\u0bae\u0bc8\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"invitation_welcome\": \"\u0b9a\u0bc2\u0b9a\u0bbe\u0bae\u0bbf\u0bb2\u0bcd \u0bb5\u0bb0\u0bb5\u0bc7\u0bb1\u0bcd\u0b95\u0bbf\u0bb1\u0bcb\u0bae\u0bcd. \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0bb2\u0bcd \u0b9a\u0bc7\u0bb0\u0bc1\u0bb5\u0ba4\u0bb1\u0bcd\u0b95\u0bc1 \u0bae\u0bc1\u0ba9\u0bcd \u0baa\u0ba4\u0bbf\u0bb5\u0bc1\u0baa\u0bc6\u0bb1\u0bc1\u0b95.\",\n+    \"signup\": \"\u0baa\u0ba4\u0bbf\u0bb5\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0b95\",\n+    \"create_a_group\": \"\u0b92\u0bb0\u0bc1 \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bc8 \u0b89\u0bb0\u0bc1\u0bb5\u0bbe\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"create_the_group\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bc8 \u0b89\u0bb0\u0bc1\u0bb5\u0bbe\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"quit_group\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bc8 \u0bb5\u0bbf\u0b9f\u0bcd\u0b9f\u0bc1 \u0bb5\u0bbf\u0b9f\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"settings_updated\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b85\u0bae\u0bc8\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd \u0baa\u0bc1\u0ba4\u0bc1\u0baa\u0bcd\u0baa\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba9\",\n+    \"group_updated\": \"\u0b95\u0bc1\u0bb4\u0bc1 \u0baa\u0bc1\u0ba4\u0bc1\u0baa\u0bcd\u0baa\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1.\",\n+    \"group_left\": \"\u0ba8\u0bc0\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bc8 \u0bb5\u0bbf\u0b9f\u0bcd\u0b9f\u0bc1 \u0bb5\u0bc6\u0bb3\u0bbf\u0baf\u0bc7\u0bb1\u0bbf\u0ba9\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bcd.\",\n+    \"multiple_photos_upload\": \"\u0baa\u0bbf\u0bb4\u0bc8 \u0b8f\u0bb1\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1. \u0baa\u0b9f\u0b99\u0bcd\u0b95\u0bb3\u0bc8 \u0b92\u0bb5\u0bcd\u0bb5\u0bca\u0ba9\u0bcd\u0bb1\u0bbe\u0b95 \u0baa\u0ba4\u0bbf\u0bb5\u0bc7\u0bb1\u0bcd\u0bb1 \u0bae\u0bc1\u0baf\u0bb1\u0bcd\u0b9a\u0bbf\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd (\u0b87\u0ba4\u0bc1 \u0b9a\u0bbf\u0bb2 \u0b89\u0bb2\u0bbe\u0bb5\u0bbf\u0b95\u0bb3\u0bbf\u0bb2\u0bcd \u0ba8\u0bbf\u0b95\u0bb4\u0bb2\u0bbe\u0bae\u0bcd)\",\n+    \"error_new_message\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0b85\u0ba9\u0bc1\u0baa\u0bcd\u0baa\u0bc1\u0bae\u0bcd\u0baa\u0bcb\u0ba4\u0bc1 \u0baa\u0bbf\u0bb4\u0bc8 \u0b8f\u0bb1\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1.\",\n+    \"error_upload\": \"\u0baa\u0ba4\u0bbf\u0bb5\u0bc7\u0bb1\u0bcd\u0bb1\u0ba4\u0bcd\u0ba4\u0bbf\u0ba9\u0bcd \u0baa\u0bcb\u0ba4\u0bc1 \u0baa\u0bbf\u0bb4\u0bc8 \u0b8f\u0bb1\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1\",\n+    \"cancel_write\": \"\u0baa\u0bc1\u0ba4\u0bbf\u0baf \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0b8e\u0bb4\u0bc1\u0ba4\u0bc1\u0bb5\u0ba4\u0bc8 \u0bb0\u0ba4\u0bcd\u0ba4\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0baf \u0bb5\u0bbf\u0bb0\u0bc1\u0bae\u0bcd\u0baa\u0bc1\u0b95\u0bbf\u0bb1\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bbe?\",\n+    \"empty_message\": \"\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf \u0b95\u0bbe\u0bb2\u0bbf\u0baf\u0bbe\u0b95 \u0b89\u0bb3\u0bcd\u0bb3\u0ba4\u0bc1 \u0bae\u0bb1\u0bcd\u0bb1\u0bc1\u0bae\u0bcd \u0b85\u0ba9\u0bc1\u0baa\u0bcd\u0baa \u0bae\u0bc1\u0b9f\u0bbf\u0baf\u0bbe\u0ba4\u0bc1.\",\n+    \"cancel\": \"\u0bb0\u0ba4\u0bcd\u0ba4\u0bc1\u0b9a\u0bc6\u0baf\u0bcd\",\n+    \"just_now\": \"\u0b87\u0baa\u0bcd\u0baa\u0bcb\u0ba4\u0bc1\",\n+    \"notification_emails\": \"\u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd \u0b85\u0bb1\u0bbf\u0bb5\u0bbf\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd\",\n+    \"none\": \"\u0b8e\u0ba4\u0bc1\u0bb5\u0bc1\u0bae\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8\",\n+    \"hourly\": \"\u0bae\u0ba3\u0bbf\u0ba8\u0bc7\u0bb0\u0ba4\u0bcd\u0ba4\u0bbf\u0bb1\u0bcd\u0b95\u0bc1\",\n+    \"daily\": \"\u0ba8\u0bbe\u0bb3\u0bcd\u0ba4\u0bcb\u0bb1\u0bc1\u0bae\u0bcd\",\n+    \"weekly\": \"\u0bb5\u0bbe\u0bb0\u0bbe\u0ba8\u0bcd\u0ba4\u0bbf\u0bb0\",\n+    \"monthly\": \"\u0bae\u0bbe\u0ba4\u0bbe\u0ba8\u0bcd\u0ba4\u0bbf\u0bb0\",\n+    \"notification_emails_stopped\": \"\u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd \u0b85\u0bb1\u0bbf\u0bb5\u0bbf\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd \u0ba8\u0bbf\u0bb1\u0bc1\u0ba4\u0bcd\u0ba4\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba9!\",\n+    \"group_share_choice\": \"\u0b87\u0ba8\u0bcd\u0ba4 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0b8e\u0ba8\u0bcd\u0ba4 \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0bb1\u0bcd\u0b95\u0bc1 \u0b85\u0ba9\u0bc1\u0baa\u0bcd\u0baa \u0bb5\u0bbf\u0bb0\u0bc1\u0bae\u0bcd\u0baa\u0bc1\u0b95\u0bbf\u0bb1\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bcd?\",\n+    \"default_group\": \"\u0b87\u0baf\u0bb2\u0bcd\u0baa\u0bc1\u0ba8\u0bbf\u0bb2\u0bc8 \u0b95\u0bc1\u0bb4\u0bc1\",\n+    \"destroy_account\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0ba3\u0b95\u0bcd\u0b95\u0bc8 \u0ba8\u0bc0\u0b95\u0bcd\u0b95\u0bc1\",\n+    \"destroy_account_explain\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0ba3\u0b95\u0bcd\u0b95\u0bc8 \u0ba8\u0bc0\u0b95\u0bcd\u0b95\u0bbf\u0baf\u0ba4\u0bc1\u0bae\u0bcd, \u0ba4\u0bbf\u0bb0\u0bc1\u0bae\u0bcd\u0baa\u0bbf\u0b9a\u0bcd \u0b9a\u0bc6\u0bb2\u0bcd\u0bb5\u0ba4\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8. \u0ba4\u0baf\u0bb5\u0bc1\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bc1 \u0b89\u0bb1\u0bc1\u0ba4\u0bbf\u0baf\u0bbe\u0b95 \u0b87\u0bb0\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd.\",\n+    \"are_you_sure\": \"\u0ba8\u0bc0 \u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\u0bb5\u0ba4\u0bc1 \u0b89\u0bb1\u0bc1\u0ba4\u0bbf\u0baf\u0bbe?\",\n+    \"share_message\": \"\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8\u0baa\u0bcd \u0baa\u0b95\u0bbf\u0bb0\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"users\": \"\u0baa\u0baf\u0ba9\u0bb0\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"has_posted_in\": \"\u0b87\u0b9f\u0bc1\u0b95\u0bc8\u0baf\u0bbf\u0b9f\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0bc1\u0bb3\u0bcd\u0bb3\u0ba4\u0bc1\",\n+    \"has_commented_on\": \"\u0b95\u0bb0\u0bc1\u0ba4\u0bcd\u0ba4\u0bc1 \u0ba4\u0bc6\u0bb0\u0bbf\u0bb5\u0bbf\u0ba4\u0bcd\u0ba4\u0bc1\u0bb3\u0bcd\u0bb3\u0ba4\u0bc1\",\n+    \"has_joined\": \"\u0b9a\u0bc7\u0bb0\u0bcd\u0ba8\u0bcd\u0ba4\u0bc1\u0bb3\u0bcd\u0bb3\u0bbe\u0bb0\u0bcd\",\n+    \"has_left\": \"\u0baa\u0bc7\u0bbe\u0baf\u0bcd \u0bb5\u0bbf\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1\",\n+    \"the_message_from\": \"\u0b87\u0bb0\u0bc1\u0ba8\u0bcd\u0ba4\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\",\n+    \"in\": \"\u0b87\u0bb2\u0bcd\",\n+    \"lang\": \"\u0bae\u0bca\u0bb4\u0bbf\",\n+    \"replies_other\": \"{{count}} \u0baa\u0ba4\u0bbf\u0bb2\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"publish_in_group\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0bb2\u0bcd \u0bb5\u0bc6\u0bb3\u0bbf\u0baf\u0bbf\u0b9f\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"search_in_group\": \"\u0b87\u0ba8\u0bcd\u0ba4 \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0bb2\u0bcd \u0ba4\u0bc7\u0b9f\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"changed_group_name\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0ba9\u0bcd \u0baa\u0bc6\u0baf\u0bb0\u0bc8 \u0bae\u0bbe\u0bb1\u0bcd\u0bb1\u0bbf\u0baf\u0ba4\u0bc1\",\n+    \"to\": \"\u0baa\u0bc6\u0bb1\u0bc1\u0ba8\u0bb0\u0bcd\",\n+    \"notifications\": \"\u0b85\u0bb1\u0bbf\u0bb5\u0bbf\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd\",\n+    \"mark_all_as_read\": \"\u0b85\u0ba9\u0bc8\u0ba4\u0bcd\u0ba4\u0bc8\u0baf\u0bc1\u0bae\u0bcd \u0bb5\u0bbe\u0b9a\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bbe\u0b95 \u0b85\u0b9f\u0bc8\u0baf\u0bbe\u0bb3\u0bae\u0bbf\u0b9f\u0bc1\",\n+    \"search_without_result\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0ba4\u0bc7\u0b9f\u0bb2\u0bcd \u0b8e\u0ba8\u0bcd\u0ba4 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0b95\u0bcd\u0b95\u0bc1\u0bae\u0bcd \u0baa\u0bca\u0bb0\u0bc1\u0ba8\u0bcd\u0ba4\u0bb5\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8.\",\n+    \"add_bookmark\": \"\u0baa\u0bc1\u0b95\u0bcd\u0bae\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\",\n+    \"remove_bookmark\": \"\u0baa\u0bc1\u0ba4\u0bcd\u0ba4\u0b95\u0bae\u0bb0\u0bae\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\",\n+    \"bookmarks\": \"\u0baa\u0bc1\u0b95\u0bcd\u0bae\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bc1\u0b95\u0bb3\u0bcd\",\n+    \"api_key\": \"\u0baa\u0ba8\u0bbf\u0b87 \u0bb5\u0bbf\u0b9a\u0bc8\",\n+    \"reset_api_key\": \"\u0baa\u0ba8\u0bbf\u0b87 \u0bb5\u0bbf\u0b9a\u0bc8\u0baf\u0bc8 \u0bae\u0bc0\u0b9f\u0bcd\u0b9f\u0bae\u0bc8\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd (\u0ba8\u0bc0\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0ba4\u0bc1\u0ba3\u0bcd\u0b9f\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bc1\u0bb5\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bcd)\",\n+    \"video_not_ready\": \"\u0bb5\u0bc0\u0b9f\u0bbf\u0baf\u0bcb \u0b87\u0ba9\u0bcd\u0ba9\u0bc1\u0bae\u0bcd \u0ba4\u0baf\u0bbe\u0bb0\u0bbe\u0b95 \u0b87\u0bb2\u0bcd\u0bb2\u0bc8.\",\n+    \"bookmark_removed\": \"\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf \u0baa\u0bc1\u0b95\u0bcd\u0bae\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bc1 \u0ba8\u0bc0\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1.\",\n+    \"parent_message\": \"\u0baa\u0bc6\u0bb1\u0bcd\u0bb1\u0bcb\u0bb0\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\",\n+    \"audio_not_ready\": \"\u0b86\u0b9f\u0bbf\u0baf\u0bcb \u0b87\u0ba9\u0bcd\u0ba9\u0bc1\u0bae\u0bcd \u0ba4\u0baf\u0bbe\u0bb0\u0bbe\u0b95 \u0b87\u0bb2\u0bcd\u0bb2\u0bc8.\",\n+    \"upload_audio\": \"\u0b86\u0b9f\u0bbf\u0baf\u0bcb \u0b95\u0bcb\u0baa\u0bcd\u0baa\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd.\"\n+}"
            },
            {
                "sha": "0967ef424bce6791893e9a57bb952f80fd536e93",
                "filename": "app/dist/lang/tr_TR.json",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Ftr_TR.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Ftr_TR.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Ftr_TR.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1 @@\n+{}"
            },
            {
                "sha": "41287eecb150611555f0daac11da835af4f77433",
                "filename": "app/dist/lang/zgh.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fzgh.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fdist%2Flang%2Fzgh.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fdist%2Flang%2Fzgh.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -25,7 +25,7 @@\n     \"title_placeholder\": \"\u2d30\u2d63\u2d61\u2d4d \u2d4f \u2d5c\u2d31\u2d54\u2d30\u2d5c \u2d4f\u2d4f\u2d3d (\u2d30\u2d54\u2d53\u2d5b\u2d5b\u2d49\u2d4d)\",\n     \"upload_image\": \"\u2d54\u2d4f\u2d53 \u2d5c\u2d49\u2d61\u2d4d\u2d30\u2d3c\u2d49\u2d4f\",\n     \"upload_video\": \"\u2d54\u2d4f\u2d53 \u2d49\u2d3c\u2d49\u2d37\u2d62\u2d53\u2d5c\u2d4f\",\n-    \"upload_pdf\": \"\u2d54\u2d4f\u2d53 pdf\",\n+    \"upload_pdf\": \"\u2d54\u2d4f\u2d53 PDF\",\n     \"add_date\": \"\u2d54\u2d4f\u2d53 \u2d3d\u2d54\u2d30 \u2d4f \u2d53\u2d59\u2d30\u2d3d\u2d53\u2d37\",\n     \"logout\": \"\u2d3c\u2d3c\u2d56\",\n     \"settings\": \"\u2d5c\u2d49\u2d59\u2d56\u2d30\u2d4d\","
            },
            {
                "sha": "7eeed1fd9e61f9af118e77eba4d224fd33fcb33f",
                "filename": "app/eslint.config.js",
                "status": "added",
                "additions": 34,
                "deletions": 0,
                "changes": 34,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Feslint.config.js",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Feslint.config.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Feslint.config.js?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,34 @@\n+const react = require('eslint-plugin-react');\n+const globals = require('globals');\n+const js = require(\"@eslint/js\");\n+\n+module.exports = [\n+  // Using eslint recommends\n+  // https://eslint.org/docs/latest/use/configure/configuration-files#using-predefined-configurations\n+  js.configs.recommended,\n+  {\n+    languageOptions: {\n+      parserOptions: {\n+        ecmaFeatures: {\n+          jsx: true\n+        }\n+      },\n+      globals: {\n+        ...globals.browser,\n+      },\n+    },\n+    files: ['**/*.{js,jsx,mjs,cjs,ts,tsx}'],\n+    plugins: {\n+      react,\n+    },\n+    rules: {\n+      \"indent\": [\"error\", 2 ],\n+      \"linebreak-style\": [\"error\", \"unix\"],\n+      \"quotes\": [\"error\", \"double\" ],\n+      \"semi\": [\"error\", \"always\" ],\n+      \"no-unused-vars\": \"off\",\n+      'react/jsx-uses-react': 'error',\n+      'react/jsx-uses-vars': 'error',\n+    }\n+  },\n+];"
            },
            {
                "sha": "a38c291f6b83ccc00c04fa74d9359bc328554c99",
                "filename": "app/package-lock.json",
                "status": "modified",
                "additions": 4225,
                "deletions": 3499,
                "changes": 7724,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fpackage-lock.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fpackage-lock.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fpackage-lock.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a"
            },
            {
                "sha": "aa867fda92f9f0eb769e78459ddd71da915ca380",
                "filename": "app/package.json",
                "status": "modified",
                "additions": 16,
                "deletions": 16,
                "changes": 32,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fpackage.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fpackage.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fpackage.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,31 +1,31 @@\n {\n   \"name\": \"Zusam\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"version\": \"0.5.5\",\n+  \"version\": \"0.5.6\",\n   \"scripts\": {\n     \"build\": \"parcel build --public-url='/' src/index.html\",\n     \"clean\": \"rm -rf dist/*\",\n     \"lang\": \"cp -r src/lang dist/\",\n     \"postbuild\": \"node ./build-tools/set_version_in_files.js dist/index.html\",\n     \"prebuild\": \"npm run lang\",\n     \"prelang\": \"npm run clean\",\n-    \"analyze\": \"npx eslint -c .eslintrc.json src/\",\n+    \"analyze\": \"npx eslint -c eslint.config.js src/\",\n     \"stylelint\": \"npx stylelint src/scss/**/*.scss\"\n   },\n   \"dependencies\": {\n-    \"@parcel/core\": \"^2.5.0\",\n+    \"@parcel/core\": \"^2.12.0\",\n     \"@storeon/crosstab\": \"^1.0.2\",\n-    \"@storeon/localstorage\": \"^1.4.0\",\n-    \"bootstrap\": \"^5.1.3\",\n+    \"@storeon/localstorage\": \"^1.5.0\",\n+    \"bootstrap\": \"^5.3.3\",\n     \"glightbox\": \"^3.2.0\",\n     \"i18next\": \"^23.2.11\",\n     \"idb-keyval\": \"^6.1.0\",\n     \"image-blob-reduce\": \"^4.1.0\",\n     \"js-cookie\": \"^3.0.1\",\n-    \"mobile-drag-drop\": \"^3.0.0-beta.0\",\n+    \"mobile-drag-drop\": \"^3.0.0-rc.0\",\n     \"node-sass\": \"^9.0.0\",\n-    \"preact\": \"10.17.1\",\n-    \"react-i18next\": \"^13.0.2\",\n+    \"preact\": \"^10.24.2\",\n+    \"react-i18next\": \"^15.0.3\",\n     \"react-router\": \"^6.3.0\",\n     \"react-router-dom\": \"^6.3.0\",\n     \"storeon\": \"^3.1.5\"\n@@ -39,24 +39,24 @@\n     \"@babel/preset-env\": \"^7.16.11\",\n     \"@babel/preset-react\": \"^7.16.7\",\n     \"@babel/preset-typescript\": \"^7.16.7\",\n+    \"@eslint/js\": \"^9.12.0\",\n     \"@parcel/packager-raw-url\": \"^2.5.0\",\n     \"@parcel/transformer-image\": \"^2.5.0\",\n     \"@parcel/transformer-sass\": \"^2.5.0\",\n     \"@parcel/transformer-webmanifest\": \"^2.5.0\",\n     \"@size-limit/preset-app\": \"^8.0.1\",\n     \"babel-plugin-module-resolver\": \"^5.0.0\",\n-    \"eslint\": \"^8.13.0\",\n-    \"eslint-config-preact\": \"^1.3.0\",\n-    \"eslint-plugin-compat\": \"^4.0.2\",\n-    \"eslint-plugin-jest\": \"^27.0.3\",\n+    \"eslint\": \"^9.12.0\",\n+    \"eslint-plugin-compat\": \"^6.0.1\",\n     \"eslint-plugin-react\": \"^7.29.4\",\n-    \"eslint-plugin-react-hooks\": \"^4.4.0\",\n+    \"eslint-plugin-react-hooks\": \"^5.0.0\",\n+    \"globals\": \"^15.11.0\",\n     \"parcel\": \"^2.5.0\",\n     \"prettier\": \"^3.0.0\",\n     \"sass\": \"^1.50.1\",\n-    \"size-limit\": \"^8.0.1\",\n-    \"stylelint\": \"^15.11.0\",\n-    \"stylelint-config-standard-scss\": \"^11.0.0\"\n+    \"size-limit\": \"^11.1.6\",\n+    \"stylelint\": \"^16.10.0\",\n+    \"stylelint-config-standard-scss\": \"^13.1.0\"\n   },\n   \"alias\": {\n     \"react\": \"preact/compat\","
            },
            {
                "sha": "0de0dbe482f99e05311780488beb19b39f95af24",
                "filename": "app/src/core/lang.js",
                "status": "modified",
                "additions": 10,
                "deletions": 1,
                "changes": 11,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fcore%2Flang.js",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fcore%2Flang.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Fcore%2Flang.js?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -9,9 +9,12 @@ import es_ES from \"/src/lang/es_ES.json\";\n import fr_FR from \"/src/lang/fr_FR.json\";\n import hu_HU from \"/src/lang/hu_HU.json\";\n import ko_KR from \"/src/lang/ko_KR.json\";\n+import nb_NO from \"/src/lang/nb_NO.json\";\n import nl_NL from \"/src/lang/nl_NL.json\";\n-import sk_SK from \"/src/lang/sk_SK.json\";\n+import pt_BR from \"/src/lang/pt_BR.json\";\n import ru_RU from \"/src/lang/ru_RU.json\";\n+import sk_SK from \"/src/lang/sk_SK.json\";\n+import ta_IN from \"/src/lang/ta_IN.json\";\n import zgh from \"/src/lang/zgh.json\";\n import zh_Hans from \"/src/lang/zh_Hans.json\";\n \n@@ -24,9 +27,12 @@ const lang = {\n     fr_FR: \"fran\u00e7ais\",\n     hu_HU: \"magyar nyelv\",\n     ko_KR: \"\ud55c\uad6d\uc5b4\",\n+    nb_NO: \"Norge\",\n     nl_NL: \"Nederlands\",\n+    pt_BR: \"Portugu\u00eas\",\n     ru_RU: \"\u0420\u0443\u0441\u0441\u043a\u0438\u0439\",\n     sk_SK: \"Slovensk\u00fd\",\n+    ta_IN: \"\u0939\u093f\u0902\u0926\u0942\",\n     zgh: \"\u2d5c\u2d30\u2d4e\u2d30\u2d63\u2d49\u2d56\u2d5c\",\n     zh_Hans: \"\u4e2d\u6587\",\n   }, // possible dicts names to load\n@@ -48,11 +54,14 @@ i18n.use(initReactI18next).init({\n     fr: { translation: fr_FR }, // backwards compatibility, remove for 0.6\n     hu_HU: { translation: hu_HU },\n     ko_KR: { translation: ko_KR },\n+    nb_NO: { translation: nb_NO },\n     nl_NL: { translation: nl_NL },\n     nl: { translation: nl_NL }, // backwards compatibility, remove for 0.6\n+    pt_BR: { translation: pt_BR },\n     ru_RU: { translation: ru_RU },\n     sk_SK: { translation: sk_SK },\n     sk: { translation: sk_SK }, // backwards compatibility, remove for 0.6\n+    ta_IN: { translation: ta_IN },\n     zgh: { translation: zgh },\n     zh_Hans: { translation: zh_Hans },\n   },"
            },
            {
                "sha": "6b285f02bedf22bc9e8ca8b4a04fe16ff91b29d0",
                "filename": "app/src/core/nanoevents.js",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fcore%2Fnanoevents.js",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fcore%2Fnanoevents.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Fcore%2Fnanoevents.js?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -11,4 +11,4 @@ let createNanoEvents = () => ({\n   }\n });\n \n-module.exports = { createNanoEvents };\n+export default createNanoEvents;"
            },
            {
                "sha": "7ffb6afb9e886cf692cbe24945326e7e0276ccad",
                "filename": "app/src/lang/cs_CZ.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fcs_CZ.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fcs_CZ.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fcs_CZ.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -10,7 +10,7 @@\n     \"submit\": \"Odeslat\",\n     \"title_placeholder\": \"Nadpis zpr\u00e1vy (voliteln\u011b)\",\n     \"text_placeholder\": \"Zde napi\u0161te svou zpr\u00e1vu\",\n-    \"upload_pdf\": \"Nahr\u00e1t pdf\",\n+    \"upload_pdf\": \"Nahr\u00e1t PDF\",\n     \"upload_image\": \"Nahr\u00e1t fotky\",\n     \"upload_video\": \"Nahr\u00e1t video\",\n     \"upload_music\": \"Nahr\u00e1t hudbu\","
            },
            {
                "sha": "cc5b04059a28930737a716af51dd00005a5ec162",
                "filename": "app/src/lang/de_DE.json",
                "status": "modified",
                "additions": 8,
                "deletions": 8,
                "changes": 16,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fde_DE.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fde_DE.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fde_DE.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -30,16 +30,16 @@\n     \"email_input\": \"Gib hier deine E-Mail-Adresse ein\",\n     \"password\": \"Passwort\",\n     \"Invalid login/password\": \"Ung\u00fcltiges Benutzername oder Passwort\",\n-    \"forgot_password\": \"Hast du dein Passwort vergessen?\",\n-    \"ask_delete_message\": \"Bist du sicher, dass du diese Nachricht l\u00f6schen willst?\",\n+    \"forgot_password\": \"Passwort vergessen?\",\n+    \"ask_delete_message\": \"Diese Nachricht l\u00f6schen?\",\n     \"account\": \"Konto\",\n     \"password_reset_mail_sent\": \"Die E-Mail zum Zur\u00fccksetzen des Passworts wurde gesendet!\",\n     \"create_a_group\": \"Eine Gruppe erstellen\",\n     \"users\": \"Benutzer\",\n     \"to\": \"zu\",\n     \"remove_bookmark\": \"Nachricht aus den Lesezeichnen entfernen\",\n     \"bookmarks\": \"Lesezeichen\",\n-    \"multiple_photos_upload\": \"Ein Fehler ist aufgetreten. Versuche, die Bilder nacheinander hochzuladen (dies kann bei einigen Browsern vorkommen).\",\n+    \"multiple_photos_upload\": \"Ein Fehler ist aufgetreten. Versuche, die Bilder nacheinander hochzuladen (dies kann bei einigen Browsern vorkommen)\",\n     \"passwords_dont_match\": \"Passw\u00f6rter stimmen nicht \u00fcberein\",\n     \"User not found\": \"Benutzer nicht gefunden\",\n     \"reset_password_title\": \"Dein Passwort zur\u00fccksetzen\",\n@@ -50,8 +50,8 @@\n     \"notification_emails_stopped\": \"E-Mail-Benachrichtigungen gestoppt!\",\n     \"the_message_from\": \"die Nachricht von\",\n     \"signup\": \"Registrieren\",\n-    \"group_updated\": \"Die Gruppe wurde aktualisiert!\",\n-    \"group_left\": \"Du hast die Gruppe verlassen!\",\n+    \"group_updated\": \"Die Gruppe wurde aktualisiert.\",\n+    \"group_left\": \"Du hast die Gruppe verlassen.\",\n     \"create_the_group\": \"Die Gruppe erstellen\",\n     \"quit_group\": \"Die Gruppe verlassen\",\n     \"settings_updated\": \"Deine Einstellungen wurden aktualisiert\",\n@@ -63,7 +63,7 @@\n     \"are_you_sure\": \"Bist du sicher?\",\n     \"error_upload\": \"Beim Hochladen ist ein Fehler aufgetreten\",\n     \"cancel_write\": \"Willst du das Schreiben einer neuen Nachricht wirklich abbrechen?\",\n-    \"empty_message\": \"Die Nachricht ist leer und kann nicht gesendet werden!\",\n+    \"empty_message\": \"Die Nachricht ist leer und kann nicht gesendet werden.\",\n     \"cancel\": \"Abbrechen\",\n     \"notification_emails\": \"E-Mail-Benachrichtigungen\",\n     \"hourly\": \"St\u00fcndlich\",\n@@ -90,11 +90,11 @@\n     \"notifications\": \"Benachrichtigungen\",\n     \"reset_api_key\": \"Setze den API-Schl\u00fcssel zur\u00fcck (die Verbindung wird unterbrochen)\",\n     \"video_not_ready\": \"Das Video ist noch nicht fertig.\",\n-    \"bookmark_added\": \"Nachricht zu den Lesezeichen hinzugef\u00fcgt!\",\n+    \"bookmark_added\": \"Nachricht zu den Lesezeichen hinzugef\u00fcgt.\",\n     \"search_without_result\": \"Deine Suche hat zu keiner Nachricht gef\u00fchrt.\",\n     \"add_bookmark\": \"Nachricht zu den Lesezeichnen hinzuf\u00fcgen\",\n     \"api_key\": \"API-Schl\u00fcssel\",\n-    \"bookmark_removed\": \"Nachricht aus den Lesezeichen entfernt!\",\n+    \"bookmark_removed\": \"Nachricht aus den Lesezeichen entfernt.\",\n     \"parent_message\": \"Quellenachricht\",\n     \"audio_not_ready\": \"Audio ist noch nicht fertig.\",\n     \"upload_audio\": \"Audio hinzuf\u00fcgen.\""
            },
            {
                "sha": "04984c9e9d27e8158f9fbc30c7aee192d37e8b6e",
                "filename": "app/src/lang/en_US.json",
                "status": "modified",
                "additions": 19,
                "deletions": 19,
                "changes": 38,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fen_US.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fen_US.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fen_US.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -3,7 +3,7 @@\n     \"next_coms\": \"See next comments\",\n     \"ago\": \"{{duration}} ago\",\n     \"groups\": \"Groups\",\n-    \"login_placeholder\": \"email\",\n+    \"login_placeholder\": \"e-mail\",\n     \"password_placeholder\": \"password\",\n     \"new_password_placeholder\": \"new password\",\n     \"confirm_password_placeholder\": \"confirm password\",\n@@ -13,56 +13,56 @@\n     \"text_placeholder\": \"Write your message here\",\n     \"upload_image\": \"Add photos\",\n     \"upload_video\": \"Add a video\",\n-    \"upload_music\": \"Add musics\",\n-    \"upload_pdf\": \"Add pdf\",\n+    \"upload_music\": \"Add music\",\n+    \"upload_pdf\": \"Add PDF\",\n     \"add_date\": \"Add a date\",\n-    \"logout\": \"Logout\",\n+    \"logout\": \"Log out\",\n     \"settings\": \"Settings\",\n     \"name\": \"Name\",\n     \"name_input\": \"Choose a name\",\n-    \"login\": \"Login\",\n+    \"login\": \"Log in\",\n     \"login_input\": \"Choose a login\",\n-    \"email\": \"Email\",\n-    \"email_input\": \"Fill in your email here\",\n+    \"email\": \"E-mail\",\n+    \"email_input\": \"Fill in your e-mail address here\",\n     \"save_changes\": \"Save changes\",\n     \"password\": \"Password\",\n     \"password_input\": \"Write a new password here\",\n     \"Invalid login/password\": \"Invalid login and/or password\",\n     \"edit\": \"Edit\",\n     \"delete\": \"Delete\",\n-    \"ask_delete_message\": \"Are you sure to delete this message?\",\n+    \"ask_delete_message\": \"Delete this message?\",\n     \"account\": \"Account\",\n-    \"forgot_password\": \"Did you forget your password?\",\n-    \"password_reset_mail_sent\": \"The password reset email was sent !\",\n+    \"forgot_password\": \"Forgot your password?\",\n+    \"password_reset_mail_sent\": \"Look for the password reset e-mail in your inbox.\",\n     \"User not found\": \"User not found\",\n     \"reset_password_title\": \"Reset your password\",\n     \"error\": \"An error occurred\",\n     \"passwords_dont_match\": \"Passwords don't match\",\n     \"invitation_link\": \"Invitation link\",\n     \"reset_invitation_link\": \"Reset invitation link\",\n-    \"invitation_welcome\": \"Welcome on Zusam ! Please sign up before joining the group.\",\n+    \"invitation_welcome\": \"Welcome on Zusam. Please sign up before joining the group.\",\n     \"signup\": \"Sign up\",\n     \"create_a_group\": \"Create a group\",\n     \"create_the_group\": \"Create the group\",\n     \"quit_group\": \"Leave the group\",\n     \"settings_updated\": \"Your settings were updated\",\n-    \"group_updated\": \"The group was updated !\",\n-    \"group_left\": \"You left the group !\",\n+    \"group_updated\": \"The group was updated.\",\n+    \"group_left\": \"You left the group.\",\n     \"multiple_photos_upload\": \"An error ocurred. Try uploading images one by one (this can happen in some browsers)\",\n     \"error_new_message\": \"An error occurred while sending your message.\",\n     \"error_upload\": \"An error occurred during the upload\",\n     \"cancel_write\": \"Do you really want to cancel writing a new message?\",\n-    \"empty_message\": \"The message is empty and cannot be sent !\",\n+    \"empty_message\": \"The message is empty and cannot be sent.\",\n     \"cancel\": \"Cancel\",\n     \"just_now\": \"Just now\",\n-    \"notification_emails\": \"Email notifications\",\n+    \"notification_emails\": \"E-mail notifications\",\n     \"none\": \"None\",\n     \"hourly\": \"Hourly\",\n     \"daily\": \"Daily\",\n     \"weekly\": \"Weekly\",\n     \"monthly\": \"Monthly\",\n-    \"notification_emails_stopped\": \"Email notifications stopped !\",\n-    \"group_share_choice\": \"To which group do you want to send this message?\",\n+    \"notification_emails_stopped\": \"E-mail notifications stopped!\",\n+    \"group_share_choice\": \"Which group do you want to send this message to?\",\n     \"public_link\": \"public link\",\n     \"default_group\": \"Default group\",\n     \"destroy_account\": \"Delete your account\",\n@@ -93,8 +93,8 @@\n     \"api_key\": \"API key\",\n     \"reset_api_key\": \"Reset the API key (you will be disconnected)\",\n     \"video_not_ready\": \"Video is not ready yet.\",\n-    \"bookmark_added\": \"Message added to bookmarks !\",\n-    \"bookmark_removed\": \"Message removed from bookmarks !\",\n+    \"bookmark_added\": \"Message bookmarked.\",\n+    \"bookmark_removed\": \"Message bookmark removed.\",\n     \"parent_message\": \"Parent message\",\n     \"audio_not_ready\": \"Audio is not ready yet.\",\n     \"upload_audio\": \"Add an audio file.\""
            },
            {
                "sha": "ba12a499b1bb2c1a4409ec49eb27c28041357ae7",
                "filename": "app/src/lang/es_ES.json",
                "status": "modified",
                "additions": 16,
                "deletions": 16,
                "changes": 32,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fes_ES.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fes_ES.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fes_ES.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -3,7 +3,7 @@\n     \"next_coms\": \"Ver los siguientes comentarios\",\n     \"ago\": \"Hace {{duration}}\",\n     \"groups\": \"Grupos\",\n-    \"login_placeholder\": \"correo\",\n+    \"login_placeholder\": \"correo electr\u00f3nico\",\n     \"password_placeholder\": \"contrase\u00f1a\",\n     \"new_password_placeholder\": \"nueva contrase\u00f1a\",\n     \"confirm_password_placeholder\": \"confirmar contrase\u00f1a\",\n@@ -14,55 +14,55 @@\n     \"upload_image\": \"A\u00f1adir fotos\",\n     \"upload_video\": \"A\u00f1adir video\",\n     \"upload_music\": \"A\u00f1adir m\u00fasica\",\n-    \"upload_pdf\": \"A\u00f1adir pdf\",\n+    \"upload_pdf\": \"A\u00f1adir PDF\",\n     \"add_date\": \"A\u00f1adir una fecha\",\n     \"logout\": \"Desconectarse\",\n     \"settings\": \"Par\u00e1metros\",\n     \"name\": \"Nombre\",\n     \"name_input\": \"Elige un nombre\",\n-    \"login\": \"Usuario\",\n+    \"login\": \"Iniciar sesi\u00f3n\",\n     \"login_input\": \"Elige un usuario\",\n-    \"email\": \"Correo\",\n-    \"email_input\": \"Indicar correo electr\u00f3nico\",\n+    \"email\": \"Correo electr\u00f3nico\",\n+    \"email_input\": \"Escriba aqu\u00ed su direcci\u00f3n de correo electr\u00f3nico\",\n     \"save_changes\": \"Guardar los cambios\",\n     \"password\": \"Contrase\u00f1a\",\n     \"password_input\": \"Indicar una nueva contrase\u00f1a\",\n     \"Invalid login/password\": \"Usuario o contrase\u00f1a incorrecto\",\n     \"edit\": \"Editar\",\n     \"delete\": \"Borrar\",\n-    \"ask_delete_message\": \"\u00bfQuieres borrar este mensaje?\",\n+    \"ask_delete_message\": \"\u00bfBorrar este mensaje?\",\n     \"account\": \"Cuenta\",\n     \"forgot_password\": \"\u00bfOlvidaste tu contrase\u00f1a?\",\n-    \"password_reset_mail_sent\": \"El correo ha sido enviado!\",\n+    \"password_reset_mail_sent\": \"Busque el correo electr\u00f3nico de restablecimiento de la contrase\u00f1a en su bandeja de entrada.\",\n     \"User not found\": \"El usuario no existe\",\n     \"reset_password_title\": \"Cambia tu contrase\u00f1a\",\n     \"error\": \"Se ha producido un error\",\n     \"passwords_dont_match\": \"Las contrase\u00f1as no coinciden\",\n     \"invitation_link\": \"Enlace de invitaci\u00f3n\",\n     \"reset_invitation_link\": \"Cambiar el enlace de invitaci\u00f3n\",\n-    \"invitation_welcome\": \"Bienvenido a Zusam ! Inscribete para conectarte con un grupo.\",\n+    \"invitation_welcome\": \"Bienvenido a Zusam. Por favor, reg\u00edstrate antes de unirte al grupo.\",\n     \"signup\": \"Inscribirse\",\n     \"create_a_group\": \"Crear un grupo\",\n     \"create_the_group\": \"Crear el grupo\",\n     \"quit_group\": \"Dejar el grupo\",\n     \"settings_updated\": \"Sus ajustes fueron actualizados\",\n-    \"group_updated\": \"El grupo ha sido actualizado!\",\n-    \"group_left\": \"\u00a1Has dejado el grupo!\",\n+    \"group_updated\": \"El grupo ha sido actualizado.\",\n+    \"group_left\": \"Has dejado el grupo.\",\n     \"multiple_photos_upload\": \"Se ha producido un error. Intenta subir las im\u00e1genes una a una (esto puede ocurrir en algunos navegadores)\",\n     \"error_new_message\": \"Se ha producido un error al enviar su mensaje.\",\n     \"error_upload\": \"Se ha producido un error durante la carga\",\n     \"cancel_write\": \"\u00bfQuieres cancelar este nuevo mensaje?\",\n-    \"empty_message\": \"No hay mensaje!\",\n+    \"empty_message\": \"El mensaje est\u00e1 vac\u00edo y no se puede enviar.\",\n     \"cancel\": \"Cancelar\",\n     \"just_now\": \"Ahora\",\n-    \"notification_emails\": \"Correo de notificaci\u00f3n\",\n+    \"notification_emails\": \"Notificaciones por correo electr\u00f3nico\",\n     \"none\": \"Ninguno\",\n     \"hourly\": \"Cada hora\",\n     \"daily\": \"Diario\",\n     \"weekly\": \"Semanal\",\n     \"monthly\": \"Mensual\",\n-    \"notification_emails_stopped\": \"Notificaciones de correo electr\u00f3nico detenidas!\",\n-    \"group_share_choice\": \"\u00bfA qu\u00e9 grupo desea enviar este mensaje?\",\n+    \"notification_emails_stopped\": \"\u00a1Se han detenido las notificaciones por correo electr\u00f3nico!\",\n+    \"group_share_choice\": \"\u00bfA qu\u00e9 grupo quieres enviar este mensaje?\",\n     \"public_link\": \"enlace p\u00fablico\",\n     \"default_group\": \"Grupo predeterminado\",\n     \"destroy_account\": \"Borrar la cuenta\",\n@@ -93,8 +93,8 @@\n     \"api_key\": \"Clave API\",\n     \"reset_api_key\": \"Restablecer la clave API (se desconectar\u00e1)\",\n     \"video_not_ready\": \"El v\u00eddeo a\u00fan no est\u00e1 listo.\",\n-    \"bookmark_added\": \"Mensaje agregado a marcadores !\",\n-    \"bookmark_removed\": \"Mensaje eliminado de los marcadores !\",\n+    \"bookmark_added\": \"Mensaje en favoritos.\",\n+    \"bookmark_removed\": \"Se elimin\u00f3 el marcador de mensajes.\",\n     \"parent_message\": \"Mensaje para padres\",\n     \"audio_not_ready\": \"El audio a\u00fan no est\u00e1 listo.\",\n     \"upload_audio\": \"A\u00f1adir un archivo de audio.\""
            },
            {
                "sha": "c470d8807a22b286f918220ef855ccfddc8d6b6c",
                "filename": "app/src/lang/fr_FR.json",
                "status": "modified",
                "additions": 5,
                "deletions": 5,
                "changes": 10,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Ffr_FR.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Ffr_FR.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Ffr_FR.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -14,13 +14,13 @@\n     \"upload_image\": \"Ajouter des photos\",\n     \"upload_video\": \"Ajouter une vid\u00e9o\",\n     \"upload_music\": \"Ajouter des musiques\",\n-    \"upload_pdf\": \"Ajouter un pdf\",\n+    \"upload_pdf\": \"Ajouter un PDF\",\n     \"add_date\": \"Pr\u00e9ciser une date\",\n     \"logout\": \"Se d\u00e9connecter\",\n     \"settings\": \"Param\u00e8tres\",\n     \"name\": \"Nom\",\n     \"name_input\": \"Choisissez un nom\",\n-    \"login\": \"Identifiant\",\n+    \"login\": \"Se connecter\",\n     \"login_input\": \"Choisissez un identifiant\",\n     \"email\": \"Courriel\",\n     \"email_input\": \"Saisissez votre adresse \u00e9lectronique ici\",\n@@ -30,7 +30,7 @@\n     \"Invalid login/password\": \"Identifiant et/ou mot de passe invalide\",\n     \"edit\": \"Modifier\",\n     \"delete\": \"Supprimer\",\n-    \"ask_delete_message\": \"\u00cates-vous s\u00fbr de vouloir supprimer ce message ?\",\n+    \"ask_delete_message\": \"\u00cates-vous s\u00fbr de vouloir supprimer ce message\u202f?\",\n     \"account\": \"Compte\",\n     \"forgot_password\": \"Mot de passe oubli\u00e9 ?\",\n     \"password_reset_mail_sent\": \"Le courriel de r\u00e9initialisation a bien \u00e9t\u00e9 envoy\u00e9\u00a0!\",\n@@ -46,8 +46,8 @@\n     \"create_the_group\": \"Cr\u00e9er le groupe\",\n     \"quit_group\": \"Quitter le groupe\",\n     \"settings_updated\": \"Vos param\u00e8tres ont \u00e9t\u00e9 mis \u00e0 jour\",\n-    \"group_updated\": \"Le groupe a \u00e9t\u00e9 mis \u00e0 jour !\",\n-    \"group_left\": \"Vous avez quitt\u00e9 le groupe !\",\n+    \"group_updated\": \"Le groupe a \u00e9t\u00e9 mis \u00e0 jour.\",\n+    \"group_left\": \"Vous avez quitt\u00e9 le groupe.\",\n     \"multiple_photos_upload\": \"Une erreur s'est produite. Essayez de t\u00e9l\u00e9charger les images une par une (cela peut se produire dans certains navigateurs).\",\n     \"error_new_message\": \"Une erreur s\u2019est produite lors de l\u2019envoi de votre message.\",\n     \"error_upload\": \"Une erreur s'est produite pendant le t\u00e9l\u00e9versement\","
            },
            {
                "sha": "6b48f88aa348e1ce23d179ea01bccd0d2bf2d103",
                "filename": "app/src/lang/hu_HU.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fhu_HU.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fhu_HU.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fhu_HU.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -14,7 +14,7 @@\n     \"upload_image\": \"Fot\u00f3k hozz\u00e1ad\u00e1sa\",\n     \"upload_video\": \"Vide\u00f3 hozz\u00e1ad\u00e1sa\",\n     \"upload_music\": \"Zen\u00e9k hozz\u00e1ad\u00e1sa\",\n-    \"upload_pdf\": \"Pdf hozz\u00e1ad\u00e1sa\",\n+    \"upload_pdf\": \"PDF hozz\u00e1ad\u00e1sa\",\n     \"add_date\": \"D\u00e1tum hozz\u00e1ad\u00e1sa\",\n     \"logout\": \"Kijelentkez\u00e9s\",\n     \"name_input\": \"V\u00e1lassz egy nevet\","
            },
            {
                "sha": "8b677d006f41e3a543a9cd2abf5e16cf518fad5a",
                "filename": "app/src/lang/ko_KR.json",
                "status": "modified",
                "additions": 10,
                "deletions": 10,
                "changes": 20,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fko_KR.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fko_KR.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fko_KR.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -6,7 +6,7 @@\n     \"upload_pdf\": \"PDF \ucd94\uac00\",\n     \"password\": \"\ube44\ubc00\ubc88\ud638\",\n     \"password_input\": \"\uc5ec\uae30\uc5d0 \uc0c8\ub85c\uc6b4 \ube44\ubc00\ubc88\ud638 \uc791\uc131\",\n-    \"password_reset_mail_sent\": \"\ube44\ubc00\ubc88\ud638 \uc7ac\uc124\uc815 \uc774\uba54\uc77c\uc774 \uc804\uc1a1\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n+    \"password_reset_mail_sent\": \"\ube44\ubc00\ubc88\ud638 \uc7ac\uc124\uc815 \uc774\uba54\uc77c\uc774 \uc804\uc1a1\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\",\n     \"settings_updated\": \"\uc124\uc815 \uc5c5\ub370\uc774\ud2b8\ub428\",\n     \"notification_emails_stopped\": \"\uc774\uba54\uc77c \uc54c\ub9bc\uc774 \uc911\uc9c0\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n     \"public_link\": \"\uacf5\uac1c \ub9c1\ud06c\",\n@@ -32,13 +32,13 @@\n     \"upload_image\": \"\uc0ac\uc9c4 \ucd94\uac00\",\n     \"save_changes\": \"\ubcc0\uacbd \uc0ac\ud56d \uc800\uc7a5\",\n     \"email\": \"\uc774\uba54\uc77c\",\n-    \"email_input\": \"\uc5ec\uae30\uc5d0 \uc774\uba54\uc77c \uc785\ub825\",\n+    \"email_input\": \"\uc5ec\uae30\uc5d0 \uc774\uba54\uc77c \uc8fc\uc18c\ub97c \uc785\ub825\ud569\ub2c8\ub2e4\",\n     \"Invalid login/password\": \"\uc798\ubabb\ub41c \ub85c\uadf8\uc778 \ubc0f/\ub610\ub294 \ube44\ubc00\ubc88\ud638\",\n     \"edit\": \"\ud3b8\uc9d1\",\n     \"delete\": \"\uc0ad\uc81c\",\n     \"ask_delete_message\": \"\uc774 \uba54\uc2dc\uc9c0\ub97c \uc0ad\uc81c\ud558\uaca0\uc2b5\ub2c8\uae4c?\",\n     \"account\": \"\uacc4\uc815\",\n-    \"forgot_password\": \"\ube44\ubc00\ubc88\ud638\ub97c \uc78a\uc5c8\ub098\uc694?\",\n+    \"forgot_password\": \"\ube44\ubc00\ubc88\ud638\ub97c \uc78a\uc5b4\ubc84\ub838\uc2b5\ub2c8\uae4c?\",\n     \"signup\": \"\uac00\uc785\ud558\uae30\",\n     \"notification_emails\": \"\uc774\uba54\uc77c \uc54c\ub9bc\",\n     \"none\": \"\uc5c6\uc74c\",\n@@ -48,23 +48,23 @@\n     \"reset_invitation_link\": \"\ucd08\ub300 \ub9c1\ud06c \uc7ac\uc124\uc815\",\n     \"error\": \"\uc624\ub958 \ubc1c\uc0dd\",\n     \"passwords_dont_match\": \"\ube44\ubc00\ubc88\ud638\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc74c\",\n-    \"invitation_welcome\": \"Zusam\uc5d0 \uc624\uc2e0 \uac83\uc744 \ud658\uc601\ud569\ub2c8\ub2e4! \uadf8\ub8f9\uc5d0 \uac00\uc785\ud558\uae30 \uc804\uc5d0 \uac00\uc785\ud558\uc138\uc694.\",\n+    \"invitation_welcome\": \"Zusam\uc5d0 \uc624\uc2e0 \uac83\uc744 \ud658\uc601\ud569\ub2c8\ub2e4. \uadf8\ub8f9\uc5d0 \uac00\uc785\ud558\uae30 \uc804\uc5d0 \uac00\uc785\ud558\uc138\uc694.\",\n     \"create_a_group\": \"\uadf8\ub8f9 \ub9cc\ub4e4\uae30\",\n     \"daily\": \"\uc77c\uac04\",\n     \"create_the_group\": \"\uadf8\ub8f9 \ub9cc\ub4e4\uae30\",\n     \"quit_group\": \"\uadf8\ub8f9 \ub098\uac00\uae30\",\n-    \"group_updated\": \"\uadf8\ub8f9\uc774 \uc5c5\ub370\uc774\ud2b8\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n+    \"group_updated\": \"\uadf8\ub8f9\uc774 \uc5c5\ub370\uc774\ud2b8\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\",\n     \"multiple_photos_upload\": \"\uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4. \uc774\ubbf8\uc9c0\ub97c \ud558\ub098\uc529 \uc5c5\ub85c\ub4dc\ud574 \ubcf4\uc138\uc694 (\uc77c\ubd80 \ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c \ubc1c\uc0dd\ud560 \uc218 \uc788\uc74c).\",\n-    \"group_left\": \"\uadf8\ub8f9\uc744 \ub098\uac14\uc2b5\ub2c8\ub2e4!\",\n+    \"group_left\": \"\uadf8\ub8f9\uc744 \ub098\uac14\uc2b5\ub2c8\ub2e4.\",\n     \"error_new_message\": \"\uba54\uc2dc\uc9c0\ub97c \ubcf4\ub0b4\ub294 \ub3d9\uc548 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.\",\n-    \"empty_message\": \"\uba54\uc2dc\uc9c0\uac00 \ube44\uc5b4 \uc788\uc5b4 \ubcf4\ub0bc \uc218 \uc5c6\uc2b5\ub2c8\ub2e4!\",\n+    \"empty_message\": \"\uba54\uc2dc\uc9c0\uac00 \ube44\uc5b4 \uc788\uc5b4 \ubcf4\ub0bc \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.\",\n     \"default_group\": \"\uae30\ubcf8 \uadf8\ub8f9\",\n     \"error_upload\": \"\uc5c5\ub85c\ub4dc \uc911 \uc624\ub958 \ubc1c\uc0dd\",\n     \"weekly\": \"\uc8fc\uac04\",\n     \"monthly\": \"\uc6d4\uac04\",\n     \"cancel_write\": \"\uc0c8\ub85c\uc6b4 \uba54\uc2dc\uc9c0 \uc791\uc131\uc744 \ucde8\uc18c\ud558\uaca0\uc2b5\ub2c8\uae4c?\",\n     \"cancel\": \"\ucde8\uc18c\",\n-    \"group_share_choice\": \"\uc774 \uba54\uc2dc\uc9c0\ub97c \uc5b4\ub290 \uadf8\ub8f9\uc5d0 \ubcf4\ub0b4\uaca0\uc2b5\ub2c8\uae4c?\",\n+    \"group_share_choice\": \"\uc774 \uba54\uc2dc\uc9c0\ub97c \uc5b4\ub290 \uadf8\ub8f9\uc5d0 \ubcf4\ub0b4\uc2dc\uaca0\uc2b5\ub2c8\uae4c?\",\n     \"hourly\": \"\ub9e4 \uc2dc\uac04\",\n     \"just_now\": \"\uc9c0\uae08 \ub2f9\uc7a5\",\n     \"users\": \"\uc0ac\uc6a9\uc790\",\n@@ -93,8 +93,8 @@\n     \"replies_other\": \"{{count}} \ub2f5\uae00\",\n     \"remove_bookmark\": \"\ubd81\ub9c8\ud06c \ud574\uc81c \uba54\uc2dc\uc9c0\",\n     \"api_key\": \"API \ud0a4\",\n-    \"bookmark_added\": \"\ubd81\ub9c8\ud06c\uc5d0 \uba54\uc2dc\uc9c0\uac00 \ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n-    \"bookmark_removed\": \"\ubd81\ub9c8\ud06c\uc5d0\uc11c \uba54\uc2dc\uc9c0\uac00 \uc81c\uac70\ub418\uc5c8\uc2b5\ub2c8\ub2e4!\",\n+    \"bookmark_added\": \"\ubd81\ub9c8\ud06c\uc5d0 \uba54\uc2dc\uc9c0\uac00 \ucd94\uac00\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\",\n+    \"bookmark_removed\": \"\ubd81\ub9c8\ud06c\uc5d0\uc11c \uba54\uc2dc\uc9c0\uac00 \uc81c\uac70\ub418\uc5c8\uc2b5\ub2c8\ub2e4.\",\n     \"add_bookmark\": \"\ubd81\ub9c8\ud06c \uba54\uc2dc\uc9c0\",\n     \"audio_not_ready\": \"\uc624\ub514\uc624\uac00 \uc544\uc9c1 \uc900\ube44\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4.\",\n     \"upload_audio\": \"\uc624\ub514\uc624 \ud30c\uc77c\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4.\""
            },
            {
                "sha": "350a50c11b940e3d8e8a0c630198bb3a8c429839",
                "filename": "app/src/lang/nb_NO.json",
                "status": "added",
                "additions": 101,
                "deletions": 0,
                "changes": 101,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fnb_NO.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fnb_NO.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fnb_NO.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,101 @@\n+{\n+    \"login_placeholder\": \"e-post\",\n+    \"password_placeholder\": \"passord\",\n+    \"new_password_placeholder\": \"nytt passord\",\n+    \"add_date\": \"Legg til en dato\",\n+    \"logout\": \"Logg ut\",\n+    \"upload_pdf\": \"Legg til PDF\",\n+    \"email_input\": \"Fyll inn e-postadressen din her\",\n+    \"save_changes\": \"Lagre endringer\",\n+    \"password\": \"Passord\",\n+    \"login_input\": \"Velg innloggingsnavn\",\n+    \"password_input\": \"Skriv det nye passordet ditt her\",\n+    \"ask_delete_message\": \"Slett meldingen?\",\n+    \"account\": \"Konto\",\n+    \"passwords_dont_match\": \"Passordene samsvarer ikke\",\n+    \"reset_invitation_link\": \"Tilbakestill invitasjonslenke\",\n+    \"password_reset_mail_sent\": \"Se etter e-post om tilbakestilling av passord i innboksen din.\",\n+    \"invitation_welcome\": \"Velkommen til Zusam. Registrer deg f\u00f8r du tar del i gruppen.\",\n+    \"group_updated\": \"Gruppen ble oppdatert.\",\n+    \"error_new_message\": \"En feil inntraff ved forsendelse av meldingen din\",\n+    \"just_now\": \"Akkurat n\u00e5\",\n+    \"none\": \"Ingen\",\n+    \"cancel_write\": \"Forkast den nye meldingen?\",\n+    \"group_share_choice\": \"Hvilken gruppe vil du sende denne meldingen til?\",\n+    \"share_message\": \"del meldingen\",\n+    \"has_posted_in\": \"har postet i\",\n+    \"destroy_account_explain\": \"N\u00e5r du sletter kontoen din er permanent. V\u00e6r sikker i din sak.\",\n+    \"in\": \"i\",\n+    \"has_joined\": \"har tatt del i\",\n+    \"has_left\": \"har forlatt\",\n+    \"has_commented_on\": \"har kommentert\",\n+    \"publish_in_group\": \"offentliggj\u00f8r i gruppen\",\n+    \"search_in_group\": \"s\u00f8k i denne gruppen\",\n+    \"changed_group_name\": \"endret gruppenavnet\",\n+    \"to\": \"til\",\n+    \"notifications\": \"merknader\",\n+    \"remove_bookmark\": \"Fjern meldingsbokmerke\",\n+    \"search_without_result\": \"S\u00f8ket ditt er resultatl\u00f8st.\",\n+    \"bookmarks\": \"bokmerker\",\n+    \"reset_api_key\": \"Tilbakestill API-n\u00f8kkelen (du vil bli frakoblet)\",\n+    \"bookmark_added\": \"Melding bokmerket.\",\n+    \"upload_audio\": \"Legg til en lydfil.\",\n+    \"previous_coms\": \"Vis tidligere kommentarer\",\n+    \"groups\": \"Grupper\",\n+    \"connect\": \"Tilkobling\",\n+    \"next_coms\": \"Vis videre kommentarer\",\n+    \"ago\": \"{{duration}} siden\",\n+    \"submit\": \"Send inn\",\n+    \"text_placeholder\": \"Skriv meldingen din her\",\n+    \"confirm_password_placeholder\": \"bekreft\",\n+    \"title_placeholder\": \"Navn p\u00e5 meldingen (valgfritt)\",\n+    \"upload_image\": \"Legg til bilder\",\n+    \"upload_video\": \"Legg til video\",\n+    \"upload_music\": \"Legg til musikk\",\n+    \"forgot_password\": \"Glemt passordet?\",\n+    \"settings\": \"Innstillinger\",\n+    \"name\": \"Navn\",\n+    \"signup\": \"Registrer deg\",\n+    \"name_input\": \"Velg et navn\",\n+    \"login\": \"Logg inn\",\n+    \"email\": \"E-post\",\n+    \"edit\": \"Rediger\",\n+    \"delete\": \"Slett\",\n+    \"error\": \"En feil oppstod\",\n+    \"User not found\": \"Fant ikke brukeren\",\n+    \"public_link\": \"offentlig lenke\",\n+    \"reset_password_title\": \"Tilbakestill passordet ditt\",\n+    \"invitation_link\": \"Invitasjonslenke\",\n+    \"create_a_group\": \"Opprett en gruppe\",\n+    \"create_the_group\": \"Opprett gruppen\",\n+    \"group_left\": \"Du forlot gruppen.\",\n+    \"quit_group\": \"Forlat gruppen\",\n+    \"destroy_account\": \"Slett kontoen din\",\n+    \"lang\": \"spr\u00e5k\",\n+    \"replies_other\": \"{{count}} svar\",\n+    \"daily\": \"Daglig\",\n+    \"weekly\": \"Ukentlig\",\n+    \"monthly\": \"M\u00e5nedlig\",\n+    \"default_group\": \"Forvalgt gruppe\",\n+    \"are_you_sure\": \"Er du sikker?\",\n+    \"the_message_from\": \"meldingen fra\",\n+    \"users\": \"brukere\",\n+    \"reply\": \"svar\",\n+    \"replies_one\": \"{{count}} svar\",\n+    \"video_not_ready\": \"Videoen er ikke klar enda.\",\n+    \"api_key\": \"API-n\u00f8kkel\",\n+    \"audio_not_ready\": \"Lyden er ikke klar enda.\",\n+    \"Invalid login/password\": \"Ugyldig brukernavn/eller passord\",\n+    \"mark_all_as_read\": \"marker alt som lest\",\n+    \"add_bookmark\": \"Bokmerk melding\",\n+    \"settings_updated\": \"Innstillingene dine ble oppdatert\",\n+    \"hourly\": \"Timevist\",\n+    \"multiple_photos_upload\": \"En feil inntraff. Pr\u00f8v \u00e5 laste opp bilder enkeltvis. (N\u00f8dvendig i noen nettlesere.)\",\n+    \"error_upload\": \"En feil inntraff under opplasting\",\n+    \"cancel\": \"Avbryt\",\n+    \"empty_message\": \"Meldingen er tom og kan ikke sendes.\",\n+    \"notification_emails\": \"E-postmerknader\",\n+    \"notification_emails_stopped\": \"E-postmerknader stoppet.\",\n+    \"bookmark_removed\": \"Meldingsbokmerke fjernet.\",\n+    \"parent_message\": \"Inneholdende melding\"\n+}"
            },
            {
                "sha": "8451276376a0af47805d8b86bd3f1e8d2c91be31",
                "filename": "app/src/lang/nl_NL.json",
                "status": "modified",
                "additions": 18,
                "deletions": 18,
                "changes": 36,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fnl_NL.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fnl_NL.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fnl_NL.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -3,7 +3,7 @@\n     \"next_coms\": \"Zie volgende\",\n     \"ago\": \"{{duration}} geleden\",\n     \"groups\": \"Groepen\",\n-    \"login_placeholder\": \"email\",\n+    \"login_placeholder\": \"e-mail\",\n     \"password_placeholder\": \"wachtwoord\",\n     \"new_password_placeholder\": \"nieuw wachtwoord\",\n     \"confirm_password_placeholder\": \"bevestig wachtwoord\",\n@@ -22,47 +22,47 @@\n     \"name_input\": \"Kies een naam\",\n     \"login\": \"Aanmelden\",\n     \"login_input\": \"Kies een aanmeldingsnaam\",\n-    \"email\": \"Email\",\n-    \"email_input\": \"Voeg uw email adres hier in\",\n+    \"email\": \"E-mail\",\n+    \"email_input\": \"Voeg uw e-mail adres hier in\",\n     \"save_changes\": \"Wijzigingen opslaan\",\n     \"password\": \"Wachtwoord\",\n     \"password_input\": \"Kies een nieuw wachtwoord\",\n     \"Invalid login/password\": \"Ongeldige aanmeldnaam/wachtwoord combinatie\",\n     \"edit\": \"Bewerken\",\n     \"delete\": \"Verwijderen\",\n-    \"ask_delete_message\": \"Bent u zeker dat u dit bericht wil verwijderen?\",\n+    \"ask_delete_message\": \"Verwijder dit bericht?\",\n     \"account\": \"Account\",\n     \"forgot_password\": \"Wachtwoord vergeten?\",\n-    \"password_reset_mail_sent\": \"De wachtwoord reset link is naar uw email adres verstuurd !\",\n+    \"password_reset_mail_sent\": \"Zoek in uw inbox naar de wachtwoordreset e-mail.\",\n     \"User not found\": \"Gebruiker niet gevonden\",\n     \"reset_password_title\": \"Reset uw wachtwoord\",\n     \"error\": \"Er is een fout opgetreden\",\n     \"passwords_dont_match\": \"Wachtwoorden komen niet overeen\",\n     \"invitation_link\": \"Uitnodigings link\",\n     \"reset_invitation_link\": \"Reset uitnodiging link\",\n-    \"invitation_welcome\": \"Welkom op Zusam ! Gelieve aan te melden vooraleer in een groep in te schrijven.\",\n+    \"invitation_welcome\": \"Welkom op Zusam. Gelieve aan te melden vooraleer in een groep in te schrijven.\",\n     \"signup\": \"Inschrijven\",\n     \"create_a_group\": \"Maak een groep\",\n     \"create_the_group\": \"Maak de groep\",\n     \"quit_group\": \"Verlaat de groep\",\n     \"settings_updated\": \"Uw instellingen werden aangepast\",\n-    \"group_updated\": \"De groep werd aangepast !\",\n-    \"group_left\": \"U heeft de groep verlaten !\",\n-    \"multiple_photos_upload\": \"Er is een fout opgetreden. Probeer foto's 1 voor 1 op te laden\",\n+    \"group_updated\": \"De groep werd aangepast.\",\n+    \"group_left\": \"U heeft de groep verlaten.\",\n+    \"multiple_photos_upload\": \"Er is een fout opgetreden. Probeer foto's \u00e9\u00e9n voor \u00e9\u00e9n op te laden\",\n     \"error_new_message\": \"Er is een fout opgetreden bij het doorsturen van uw bericht.\",\n     \"error_upload\": \"Er is een fout opgetreden bij het uploaden\",\n     \"cancel_write\": \"Bent u zeker dat u dit bericht wil annuleren?\",\n-    \"empty_message\": \"Dit bericht is leeg en kan niet worden verzonden !\",\n+    \"empty_message\": \"Dit bericht is leeg en kan niet worden verzonden.\",\n     \"cancel\": \"Annuleren\",\n     \"just_now\": \"Net\",\n-    \"notification_emails\": \"Email notificaties\",\n+    \"notification_emails\": \"E-mail meldingen\",\n     \"none\": \"Niets\",\n     \"hourly\": \"Elk uur\",\n     \"daily\": \"Elke dag\",\n     \"weekly\": \"Elke week\",\n     \"monthly\": \"Elke maand\",\n-    \"notification_emails_stopped\": \"Email notificaties zijn gestopt !\",\n-    \"group_share_choice\": \"Naar welke groep wenst u dit bericht te sturen?\",\n+    \"notification_emails_stopped\": \"E-mail meldingen zijn gestopt !\",\n+    \"group_share_choice\": \"Naar welke groep wenst u dit bericht te versturen?\",\n     \"public_link\": \"publieke link\",\n     \"default_group\": \"Standaard groep\",\n     \"destroy_account\": \"Verwijder jouw account\",\n@@ -91,11 +91,11 @@\n     \"remove_bookmark\": \"Unbookmark bericht\",\n     \"bookmarks\": \"bookmarks\",\n     \"api_key\": \"API key\",\n-    \"reset_api_key\": \"Reset the API key (you will be disconnected)\",\n+    \"reset_api_key\": \"Reset de API key (u zal worden gedeconnecteerd)\",\n     \"video_not_ready\": \"Video is nog niet klaar.\",\n-    \"bookmark_added\": \"Bericht toegevoegd aan bookmarks !\",\n-    \"bookmark_removed\": \"Bericht verwijderd uit bookmarks !\",\n+    \"bookmark_added\": \"Bericht toegevoegd aan bladwijzers.\",\n+    \"bookmark_removed\": \"Bericht verwijderd uit bladwijzers.\",\n     \"parent_message\": \"Parent bericht\",\n-    \"upload_audio\": \"\",\n-    \"audio_not_ready\": \"\"\n+    \"upload_audio\": \"Voeg een audiobestand toe.\",\n+    \"audio_not_ready\": \"Audio is nog niet klaar.\"\n }"
            },
            {
                "sha": "101e40330831ec0d0f413428e61010a2d6816cca",
                "filename": "app/src/lang/pt_BR.json",
                "status": "added",
                "additions": 101,
                "deletions": 0,
                "changes": 101,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fpt_BR.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fpt_BR.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fpt_BR.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,101 @@\n+{\n+    \"next_coms\": \"Ver os pr\u00f3ximos coment\u00e1rios\",\n+    \"ago\": \"{{duration}} atr\u00e1s\",\n+    \"new_password_placeholder\": \"nova senha\",\n+    \"confirm_password_placeholder\": \"confirmar senha\",\n+    \"connect\": \"Conex\u00e3o\",\n+    \"submit\": \"Enviar\",\n+    \"text_placeholder\": \"Escreva sua mensagem aqui\",\n+    \"upload_video\": \"Adicionar um v\u00eddeo\",\n+    \"upload_music\": \"Adicionar m\u00fasica\",\n+    \"upload_pdf\": \"Adicionar PDF\",\n+    \"login\": \"Entrar\",\n+    \"login_input\": \"Escolha um login\",\n+    \"Invalid login/password\": \"Login e/ou senha inv\u00e1lidos\",\n+    \"edit\": \"Editar\",\n+    \"ask_delete_message\": \"Deletar essa mensagem?\",\n+    \"passwords_dont_match\": \"As senhas n\u00e3o coincidem\",\n+    \"invitation_welcome\": \"Bem-vindo ao Zusam. Registre-se antes de entrar no grupo.\",\n+    \"create_the_group\": \"Criar o grupo\",\n+    \"group_updated\": \"O grupo foi atualizado.\",\n+    \"cancel_write\": \"Voc\u00ea realmente deseja cancelar a cria\u00e7\u00e3o de uma nova mensagem?\",\n+    \"just_now\": \"Agora mesmo\",\n+    \"hourly\": \"Por Hora\",\n+    \"destroy_account\": \"Deletar sua conta\",\n+    \"are_you_sure\": \"Voc\u00ea tem certeza?\",\n+    \"share_message\": \"compartilhe a mensagem\",\n+    \"has_commented_on\": \"comentou em\",\n+    \"in\": \"em\",\n+    \"lang\": \"idioma\",\n+    \"publish_in_group\": \"publicar no grupo\",\n+    \"remove_bookmark\": \"Remover mensagem dos favoritos\",\n+    \"api_key\": \"Chave API\",\n+    \"video_not_ready\": \"O v\u00eddeo ainda n\u00e3o est\u00e1 pronto.\",\n+    \"previous_coms\": \"Ver coment\u00e1rios anteriores\",\n+    \"groups\": \"Grupos\",\n+    \"login_placeholder\": \"e-mail\",\n+    \"password_placeholder\": \"senha\",\n+    \"title_placeholder\": \"T\u00edtulo da sua mensagem (opcional)\",\n+    \"upload_image\": \"Adicionar fotos\",\n+    \"logout\": \"Sair da sess\u00e3o\",\n+    \"add_date\": \"Adicionar uma data\",\n+    \"settings\": \"Configura\u00e7\u00f5es\",\n+    \"email\": \"E-mail\",\n+    \"password\": \"Senha\",\n+    \"name\": \"Nome\",\n+    \"email_input\": \"Preencha seu endere\u00e7o de e-mail aqui\",\n+    \"name_input\": \"Escolher um nome\",\n+    \"save_changes\": \"Salvar altera\u00e7\u00f5es\",\n+    \"password_input\": \"Escreva uma nova senha aqui\",\n+    \"delete\": \"Deletar\",\n+    \"account\": \"Conta\",\n+    \"forgot_password\": \"Esqueceu sua senha?\",\n+    \"password_reset_mail_sent\": \"Procure o e-mail de redefini\u00e7\u00e3o de senha em sua caixa de entrada.\",\n+    \"User not found\": \"Usu\u00e1rio n\u00e3o encontrado\",\n+    \"reset_password_title\": \"Redefinir sua senha\",\n+    \"error\": \"Um erro ocorreu\",\n+    \"invitation_link\": \"Link de convite\",\n+    \"reset_invitation_link\": \"Redefinir o link de convite\",\n+    \"signup\": \"Registrar-se\",\n+    \"create_a_group\": \"Criar um grupo\",\n+    \"quit_group\": \"Sair do grupo\",\n+    \"settings_updated\": \"Suas configura\u00e7\u00f5es foram atualizadas\",\n+    \"group_left\": \"Voc\u00ea saiu do grupo.\",\n+    \"multiple_photos_upload\": \"Ocorreu um erro. Tente fazer o upload das imagens uma a uma (isso pode ocorrer em alguns navegadores)\",\n+    \"error_new_message\": \"Um erro ocorreu ao enviar sua mensagem.\",\n+    \"error_upload\": \"Ocorreu um erro durante o envio\",\n+    \"empty_message\": \"A mensagem est\u00e1 vazia e n\u00e3o pode ser enviada.\",\n+    \"cancel\": \"Cancelar\",\n+    \"notification_emails\": \"Notifica\u00e7\u00f5es de e-mail\",\n+    \"none\": \"Nenhuma\",\n+    \"daily\": \"Diariamente\",\n+    \"weekly\": \"Semanalmente\",\n+    \"monthly\": \"Mensal\",\n+    \"notification_emails_stopped\": \"As notifica\u00e7\u00f5es de e-mail foram interrompidas!\",\n+    \"group_share_choice\": \"Para qual grupo voc\u00ea deseja enviar essa mensagem?\",\n+    \"public_link\": \"link p\u00fablico\",\n+    \"default_group\": \"Grupo padr\u00e3o\",\n+    \"destroy_account_explain\": \"Depois de excluir sua conta, n\u00e3o h\u00e1 como voltar atr\u00e1s. Por favor, tenha certeza.\",\n+    \"users\": \"usu\u00e1rios\",\n+    \"has_posted_in\": \"postou em\",\n+    \"has_joined\": \"entrou\",\n+    \"has_left\": \"saiu\",\n+    \"the_message_from\": \"a mensagem de\",\n+    \"reply\": \"responder\",\n+    \"replies_one\": \"{{count}} responder\",\n+    \"replies_other\": \"{{count}} respostas\",\n+    \"search_in_group\": \"procurar neste grupo\",\n+    \"changed_group_name\": \"mudou o nome do grupo\",\n+    \"to\": \"para\",\n+    \"notifications\": \"notifica\u00e7\u00f5es\",\n+    \"mark_all_as_read\": \"marcar todos como lido\",\n+    \"search_without_result\": \"Sua pesquisa n\u00e3o correspondeu a nenhuma mensagem.\",\n+    \"add_bookmark\": \"Adicionar mensagem aos favoritos\",\n+    \"bookmarks\": \"Favoritos\",\n+    \"reset_api_key\": \"Redefinir a chave API (voc\u00ea ser\u00e1 desconectado)\",\n+    \"bookmark_added\": \"Mensagem adicionada aos favoritos.\",\n+    \"bookmark_removed\": \"Mensagem removida dos favoritos.\",\n+    \"parent_message\": \"Mensagem relacionada\",\n+    \"audio_not_ready\": \"O \u00e1udio ainda n\u00e3o est\u00e1 pronto.\",\n+    \"upload_audio\": \"Adicionar um arquivo de \u00e1udio.\"\n+}"
            },
            {
                "sha": "2c20a9503f3abf24bca37d2065ccc148ea71902b",
                "filename": "app/src/lang/ru_RU.json",
                "status": "modified",
                "additions": 62,
                "deletions": 61,
                "changes": 123,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fru_RU.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fru_RU.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fru_RU.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,80 +1,81 @@\n {\n-    \"save_changes\": \"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\",\n+    \"add_bookmark\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n     \"add_date\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u0442\u0443\",\n-    \"are_you_sure\": \"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?\",\n-    \"text_placeholder\": \"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0441\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0437\u0434\u0435\u0441\u044c\",\n-    \"password\": \"\u041f\u0430\u0440\u043e\u043b\u044c\",\n-    \"has_left\": \"\u0443\u0448\u0435\u043b\",\n-    \"password_input\": \"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u0437\u0434\u0435\u0441\u044c\",\n-    \"has_commented_on\": \"\u043f\u0440\u043e\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043b\",\n-    \"video_not_ready\": \"\u0412\u0438\u0434\u0435\u043e \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u043e.\",\n-    \"group_left\": \"\u0422\u044b \u043f\u043e\u043a\u0438\u043d\u0443\u043b \u0433\u0440\u0443\u043f\u043f\u0443 !\",\n     \"api_key\": \"\u041a\u043b\u044e\u0447 API\",\n+    \"are_you_sure\": \"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?\",\n     \"ask_delete_message\": \"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?\",\n-    \"the_message_from\": \"\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442\",\n+    \"audio_not_ready\": \"\u0410\u0443\u0434\u0438\u043e \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u043e.\",\n+    \"bookmark_added\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e \u0432 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438 !\",\n+    \"bookmark_removed\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e \u0438\u0437 \u0437\u0430\u043a\u043b\u0430\u0434\u043e\u043a !\",\n+    \"bookmarks\": \"\u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n+    \"cancel_write\": \"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u043e\u0432\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f?\",\n     \"changed_group_name\": \"\u0438\u0437\u043c\u0435\u043d\u0438\u043b \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0433\u0440\u0443\u043f\u043f\u044b\",\n-    \"has_joined\": \"\u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u043b\u0441\u044f\",\n-    \"title_placeholder\": \"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0432\u0430\u0448\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)\",\n+    \"confirm_password_placeholder\": \"\u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c\",\n     \"create_a_group\": \"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443\",\n-    \"group_share_choice\": \"\u041a\u0430\u043a\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u0435 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?\",\n-    \"email\": \"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430\",\n-    \"edit\": \"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c\",\n-    \"password_reset_mail_sent\": \"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0435 \u043f\u0438\u0441\u044c\u043c\u043e \u0441\u043e \u0441\u0431\u0440\u043e\u0441\u043e\u043c \u043f\u0430\u0440\u043e\u043b\u044f \u0431\u044b\u043b\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e !\",\n-    \"search_in_group\": \"\u043f\u043e\u0438\u0441\u043a \u0432 \u044d\u0442\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u0435\",\n-    \"upload_audio\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0430\u0443\u0434\u0438\u043e\u0444\u0430\u0439\u043b.\",\n-    \"search_without_result\": \"\u0412\u0430\u0448 \u043f\u043e\u0438\u0441\u043a \u043d\u0435 \u0432\u044b\u044f\u0432\u0438\u043b \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.\",\n-    \"invitation_link\": \"\u041f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0441\u0441\u044b\u043b\u043a\u0430\",\n-    \"passwords_dont_match\": \"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442\",\n-    \"name\": \"\u0418\u043c\u044f\",\n-    \"bookmark_removed\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0443\u0434\u0430\u043b\u0435\u043d\u043e \u0438\u0437 \u0437\u0430\u043a\u043b\u0430\u0434\u043e\u043a !\",\n-    \"in\": \"\u0432\",\n-    \"new_password_placeholder\": \"\u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c\",\n-    \"upload_image\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438\",\n-    \"User not found\": \"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\",\n-    \"password_placeholder\": \"\u043f\u0430\u0440\u043e\u043b\u044c\",\n+    \"default_group\": \"\u0413\u0440\u0443\u043f\u043f\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e\",\n     \"delete\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c\",\n-    \"to\": \"\u043a\",\n-    \"publish_in_group\": \"\u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0435\",\n-    \"remove_bookmark\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438\u0437 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n+    \"destroy_account\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\",\n+    \"edit\": \"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c\",\n+    \"email_input\": \"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0430\u0434\u0440\u0435\u0441 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u044b \u0437\u0434\u0435\u0441\u044c\",\n+    \"email\": \"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430\",\n+    \"empty_message\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043f\u0443\u0441\u0442\u043e\u0435 \u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e !\",\n     \"error_new_message\": \"\u041f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0432\u0430\u0448\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430.\",\n-    \"reset_invitation_link\": \"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u043f\u0440\u0438\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u0435\",\n-    \"notifications\": \"\u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f\",\n-    \"reset_api_key\": \"\u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043a\u043b\u044e\u0447 API (\u0432\u044b \u0431\u0443\u0434\u0435\u0442\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u044b)\",\n-    \"name_input\": \"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u043c\u044f\",\n-    \"cancel_write\": \"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u043e\u0432\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f?\",\n-    \"upload_pdf\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c pdf-\u0444\u0430\u0439\u043b\",\n-    \"forgot_password\": \"\u0412\u044b \u0437\u0430\u0431\u044b\u043b\u0438 \u0441\u0432\u043e\u0439 \u043f\u0430\u0440\u043e\u043b\u044c?\",\n-    \"bookmark_added\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e \u0432 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438 !\",\n     \"error_upload\": \"\u0412\u043e \u0432\u0440\u0435\u043c\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430\",\n-    \"audio_not_ready\": \"\u0410\u0443\u0434\u0438\u043e \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u043e.\",\n-    \"upload_music\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043c\u0443\u0437\u044b\u043a\u0443\",\n-    \"invitation_welcome\": \"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u043d\u0430 Zusam! \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c, \u043f\u0440\u0435\u0436\u0434\u0435 \u0447\u0435\u043c \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u043a \u0433\u0440\u0443\u043f\u043f\u0435.\",\n-    \"mark_all_as_read\": \"\u043e\u0442\u043c\u0435\u0442\u044c\u0442\u0435 \u0432\u0441\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u043e\u0435\",\n-    \"lang\": \"\u044f\u0437\u044b\u043a\",\n-    \"group_updated\": \"\u0413\u0440\u0443\u043f\u043f\u0430 \u0431\u044b\u043b\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430!\",\n-    \"users\": \"\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438\",\n-    \"email_input\": \"\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u0430\u0434\u0440\u0435\u0441 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u044b \u0437\u0434\u0435\u0441\u044c\",\n     \"error\": \"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430\",\n-    \"Invalid login/password\": \"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438/\u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c\",\n-    \"logout\": \"\u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b\",\n+    \"forgot_password\": \"\u0412\u044b \u0437\u0430\u0431\u044b\u043b\u0438 \u0441\u0432\u043e\u0439 \u043f\u0430\u0440\u043e\u043b\u044c?\",\n+    \"group_left\": \"\u0422\u044b \u043f\u043e\u043a\u0438\u043d\u0443\u043b \u0433\u0440\u0443\u043f\u043f\u0443 !\",\n+    \"group_share_choice\": \"\u041a\u0430\u043a\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u0435 \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?\",\n     \"groups\": \"\u0413\u0440\u0443\u043f\u043f\u044b\",\n-    \"login\": \"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f\",\n-    \"destroy_account\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0432\u043e\u0439 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\",\n-    \"confirm_password_placeholder\": \"\u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c\",\n-    \"default_group\": \"\u0413\u0440\u0443\u043f\u043f\u0430 \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e\",\n+    \"group_updated\": \"\u0413\u0440\u0443\u043f\u043f\u0430 \u0431\u044b\u043b\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430!\",\n+    \"has_commented_on\": \"\u043f\u0440\u043e\u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043b\",\n+    \"has_joined\": \"\u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u043b\u0441\u044f\",\n+    \"has_left\": \"\u0443\u0448\u0435\u043b\",\n+    \"has_posted_in\": \"\u0440\u0430\u0437\u043c\u0435\u0441\u0442\u0438\u043b \u0432\",\n+    \"Invalid login/password\": \"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438/\u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c\",\n+    \"invitation_link\": \"\u041f\u0440\u0438\u0433\u043b\u0430\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0441\u0441\u044b\u043b\u043a\u0430\",\n+    \"invitation_welcome\": \"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u043d\u0430 Zusam! \u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0439\u0442\u0435\u0441\u044c, \u043f\u0440\u0435\u0436\u0434\u0435 \u0447\u0435\u043c \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f \u043a \u0433\u0440\u0443\u043f\u043f\u0435.\",\n+    \"in\": \"\u0432\",\n+    \"lang\": \"\u044f\u0437\u044b\u043a\",\n     \"login_placeholder\": \"\u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430\",\n-    \"upload_video\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e\",\n-    \"settings\": \"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438\",\n+    \"login\": \"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f\",\n+    \"logout\": \"\u0412\u044b\u0445\u043e\u0434 \u0438\u0437 \u0441\u0438\u0441\u0442\u0435\u043c\u044b\",\n+    \"mark_all_as_read\": \"\u043e\u0442\u043c\u0435\u0442\u044c\u0442\u0435 \u0432\u0441\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u043e\u0435\",\n     \"multiple_photos_upload\": \"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u043e \u043e\u0434\u043d\u043e\u043c\u0443 (\u044d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u043e\u0439\u0442\u0438 \u0432 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430\u0445)\",\n-    \"notification_emails\": \"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043f\u043e \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u0435\",\n-    \"signup\": \"\u0412\u043e\u0439\u0442\u0438\",\n+    \"name_input\": \"\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0438\u043c\u044f\",\n+    \"name\": \"\u0418\u043c\u044f\",\n+    \"new_password_placeholder\": \"\u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c\",\n     \"notification_emails_stopped\": \"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043f\u043e \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u0435 \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u044b !\",\n-    \"add_bookmark\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n+    \"notification_emails\": \"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043f\u043e \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u0435\",\n+    \"notifications\": \"\u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f\",\n+    \"password_input\": \"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u043e\u0432\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c \u0437\u0434\u0435\u0441\u044c\",\n+    \"password_placeholder\": \"\u043f\u0430\u0440\u043e\u043b\u044c\",\n+    \"password_reset_mail_sent\": \"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0435 \u043f\u0438\u0441\u044c\u043c\u043e \u0441\u043e \u0441\u0431\u0440\u043e\u0441\u043e\u043c \u043f\u0430\u0440\u043e\u043b\u044f \u0431\u044b\u043b\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e !\",\n+    \"passwords_dont_match\": \"\u041f\u0430\u0440\u043e\u043b\u0438 \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442\",\n+    \"password\": \"\u041f\u0430\u0440\u043e\u043b\u044c\",\n     \"public_link\": \"\u043e\u0431\u0449\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430\u044f \u0441\u0441\u044b\u043b\u043a\u0430\",\n-    \"has_posted_in\": \"\u0440\u0430\u0437\u043c\u0435\u0441\u0442\u0438\u043b \u0432\",\n+    \"publish_in_group\": \"\u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c \u0432 \u0433\u0440\u0443\u043f\u043f\u0435\",\n     \"quit_group\": \"\u041f\u043e\u043a\u0438\u043d\u0443\u0442\u044c \u0433\u0440\u0443\u043f\u043f\u0443\",\n+    \"remove_bookmark\": \"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438\u0437 \u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\",\n+    \"reset_api_key\": \"\u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043a\u043b\u044e\u0447 API (\u0432\u044b \u0431\u0443\u0434\u0435\u0442\u0435 \u043e\u0442\u043a\u043b\u044e\u0447\u0435\u043d\u044b)\",\n+    \"reset_invitation_link\": \"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u043f\u0440\u0438\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u0435\",\n+    \"save_changes\": \"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f\",\n+    \"search_in_group\": \"\u043f\u043e\u0438\u0441\u043a \u0432 \u044d\u0442\u043e\u0439 \u0433\u0440\u0443\u043f\u043f\u0435\",\n+    \"search_without_result\": \"\u0412\u0430\u0448 \u043f\u043e\u0438\u0441\u043a \u043d\u0435 \u0432\u044b\u044f\u0432\u0438\u043b \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f.\",\n     \"settings_updated\": \"\u0412\u0430\u0448\u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u0431\u044b\u043b\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u044b\",\n+    \"settings\": \"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438\",\n     \"share_message\": \"\u043f\u043e\u0434\u0435\u043b\u0438\u0442\u044c\u0441\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435\u043c\",\n-    \"empty_message\": \"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043f\u0443\u0441\u0442\u043e\u0435 \u0438 \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e !\",\n-    \"bookmarks\": \"\u0437\u0430\u043a\u043b\u0430\u0434\u043a\u0438\"\n+    \"signup\": \"\u0412\u043e\u0439\u0442\u0438\",\n+    \"text_placeholder\": \"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0441\u0432\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0437\u0434\u0435\u0441\u044c\",\n+    \"the_message_from\": \"\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442\",\n+    \"title_placeholder\": \"\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0432\u0430\u0448\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f (\u043e\u043f\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e)\",\n+    \"to\": \"\u043a\",\n+    \"upload_audio\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0430\u0443\u0434\u0438\u043e\u0444\u0430\u0439\u043b.\",\n+    \"upload_image\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438\",\n+    \"upload_music\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043c\u0443\u0437\u044b\u043a\u0443\",\n+    \"upload_pdf\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c pdf-\u0444\u0430\u0439\u043b\",\n+    \"upload_pdf\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c PDF-\u0444\u0430\u0439\u043b\",\n+    \"upload_video\": \"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e\",\n+    \"User not found\": \"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\",\n+    \"users\": \"\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438\",\n+    \"video_not_ready\": \"\u0412\u0438\u0434\u0435\u043e \u0435\u0449\u0435 \u043d\u0435 \u0433\u043e\u0442\u043e\u0432\u043e.\"\n }"
            },
            {
                "sha": "98000782adf0473497d44eaff9ae2960a59f99d2",
                "filename": "app/src/lang/sk_SK.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fsk_SK.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fsk_SK.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fsk_SK.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -14,7 +14,7 @@\n     \"upload_image\": \"Prida\u0165 fotografie\",\n     \"upload_video\": \"Pridajte video\",\n     \"upload_music\": \"Prida\u0165 hudbu\",\n-    \"upload_pdf\": \"Prida\u0165 pdf\",\n+    \"upload_pdf\": \"Prida\u0165 PDF\",\n     \"add_date\": \"Prida\u0165 d\u00e1tum\",\n     \"logout\": \"Odhl\u00e1si\u0165\",\n     \"settings\": \"Nastavenia\","
            },
            {
                "sha": "153e217125b00e99c2476f1e1a37d91fecac80a5",
                "filename": "app/src/lang/ta_IN.json",
                "status": "added",
                "additions": 101,
                "deletions": 0,
                "changes": 101,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fta_IN.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fta_IN.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fta_IN.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,101 @@\n+{\n+    \"previous_coms\": \"\u0bae\u0bc1\u0ba8\u0bcd\u0ba4\u0bc8\u0baf \u0b95\u0bb0\u0bc1\u0ba4\u0bcd\u0ba4\u0bc1\u0b95\u0bb3\u0bc8\u0baa\u0bcd \u0baa\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"upload_music\": \"\u0b87\u0b9a\u0bc8\u0baf\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"upload_pdf\": \"PDF \u0b90\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"add_date\": \"\u0b92\u0bb0\u0bc1 \u0ba4\u0bc7\u0ba4\u0bbf\u0baf\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"logout\": \"\u0bb5\u0bbf\u0b9f\u0bc1\u0baa\u0ba4\u0bbf\u0b95\u0bc8\",\n+    \"settings\": \"\u0b85\u0bae\u0bc8\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd\",\n+    \"login_input\": \"\u0b89\u0bb3\u0bcd\u0ba8\u0bc1\u0bb4\u0bc8\u0bb5\u0bc8\u0ba4\u0bcd \u0ba4\u0bc7\u0bb0\u0bcd\u0bb5\u0bc1\u0b9a\u0bc6\u0baf\u0bcd\u0b95\",\n+    \"reply\": \"\u0baa\u0ba4\u0bbf\u0bb2\u0bcd\",\n+    \"replies_one\": \"{{count}} \u0baa\u0ba4\u0bbf\u0bb2\u0bcd\",\n+    \"bookmark_added\": \"\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf \u0baa\u0bc1\u0b95\u0bcd\u0bae\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0baf\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1.\",\n+    \"next_coms\": \"\u0b85\u0b9f\u0bc1\u0ba4\u0bcd\u0ba4 \u0b95\u0bb0\u0bc1\u0ba4\u0bcd\u0ba4\u0bc1\u0b95\u0bb3\u0bc8\u0baa\u0bcd \u0baa\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"ago\": \"{{\u0b95\u0bbe\u0bb2\u0bae\u0bcd}} \u0bae\u0bc1\u0ba9\u0bcd\u0baa\u0bc1\",\n+    \"groups\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0b95\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"login_placeholder\": \"\u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd\",\n+    \"password_placeholder\": \"\u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\",\n+    \"new_password_placeholder\": \"\u0baa\u0bc1\u0ba4\u0bbf\u0baf \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\",\n+    \"confirm_password_placeholder\": \"\u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb2\u0bcd\u0bb2\u0bc8 \u0b89\u0bb1\u0bc1\u0ba4\u0bbf\u0baa\u0bcd\u0baa\u0b9f\u0bc1\u0ba4\u0bcd\u0ba4\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"connect\": \"\u0b87\u0ba3\u0bc8\u0baa\u0bcd\u0baa\u0bc1\",\n+    \"submit\": \"\u0b9a\u0bae\u0bb0\u0bcd\u0baa\u0bcd\u0baa\u0bbf\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"title_placeholder\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bbf\u0ba9\u0bcd \u0ba4\u0bb2\u0bc8\u0baa\u0bcd\u0baa\u0bc1 (\u0bb5\u0bbf\u0bb0\u0bc1\u0bae\u0bcd\u0baa\u0bbf\u0ba9\u0bbe\u0bb2\u0bcd)\",\n+    \"text_placeholder\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0b87\u0b99\u0bcd\u0b95\u0bc7 \u0b8e\u0bb4\u0bc1\u0ba4\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"upload_image\": \"\u0baa\u0bc1\u0b95\u0bc8\u0baa\u0bcd\u0baa\u0b9f\u0b99\u0bcd\u0b95\u0bb3\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"upload_video\": \"\u0bb5\u0bc0\u0b9f\u0bbf\u0baf\u0bcb\u0bb5\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"name\": \"\u0baa\u0bc6\u0baf\u0bb0\u0bcd\",\n+    \"name_input\": \"\u0b92\u0bb0\u0bc1 \u0baa\u0bc6\u0baf\u0bb0\u0bc8\u0ba4\u0bcd \u0ba4\u0bc7\u0bb0\u0bcd\u0bb5\u0bc1\u0b9a\u0bc6\u0baf\u0bcd\u0b95\",\n+    \"login\": \"\u0baa\u0bc1\u0b95\u0bc1\u0baa\u0ba4\u0bbf\u0b95\u0bc8\",\n+    \"email\": \"\u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd\",\n+    \"email_input\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd \u0bae\u0bc1\u0b95\u0bb5\u0bb0\u0bbf\u0baf\u0bc8 \u0b87\u0b99\u0bcd\u0b95\u0bc7 \u0ba8\u0bbf\u0bb0\u0baa\u0bcd\u0baa\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"save_changes\": \"\u0bae\u0bbe\u0bb1\u0bcd\u0bb1\u0b99\u0bcd\u0b95\u0bb3\u0bc8 \u0b9a\u0bc7\u0bae\u0bbf\u0baf\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"password\": \"\u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\",\n+    \"password_input\": \"\u0baa\u0bc1\u0ba4\u0bbf\u0baf \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb2\u0bcd\u0bb2\u0bc8 \u0b87\u0b99\u0bcd\u0b95\u0bc7 \u0b8e\u0bb4\u0bc1\u0ba4\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"Invalid login/password\": \"\u0ba4\u0bb5\u0bb1\u0bbe\u0ba9 \u0b89\u0bb3\u0bcd\u0ba8\u0bc1\u0bb4\u0bc8\u0bb5\u0bc1 \u0bae\u0bb1\u0bcd\u0bb1\u0bc1\u0bae\u0bcd/\u0b85\u0bb2\u0bcd\u0bb2\u0ba4\u0bc1 \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb2\u0bcd\",\n+    \"edit\": \"\u0ba4\u0bc6\u0bbe\u0b95\u0bc1\",\n+    \"delete\": \"\u0b85\u0bb4\u0bbf\",\n+    \"ask_delete_message\": \"\u0b87\u0ba8\u0bcd\u0ba4 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0ba8\u0bc0\u0b95\u0bcd\u0b95\u0bb5\u0bbe?\",\n+    \"account\": \"\u0b95\u0ba3\u0b95\u0bcd\u0b95\u0bc1\",\n+    \"forgot_password\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\u0bb2\u0bc8 \u0bae\u0bb1\u0ba8\u0bcd\u0ba4\u0bc1 \u0bb5\u0bbf\u0b9f\u0bcd\u0b9f\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bbe?\",\n+    \"password_reset_mail_sent\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b87\u0ba9\u0bcd\u0baa\u0bbe\u0b95\u0bcd\u0b9a\u0bbf\u0bb2\u0bcd \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb2\u0bcd \u0bae\u0bc0\u0b9f\u0bcd\u0b9f\u0bae\u0bc8\u0baa\u0bcd\u0baa\u0bc1 \u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bc8\u0ba4\u0bcd \u0ba4\u0bc7\u0b9f\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd.\",\n+    \"User not found\": \"\u0baa\u0baf\u0ba9\u0bb0\u0bcd \u0b95\u0ba3\u0bcd\u0b9f\u0bc1\u0baa\u0bbf\u0b9f\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bb5\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8\",\n+    \"reset_password_title\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\u0bb2\u0bc8 \u0bae\u0bc0\u0b9f\u0bcd\u0b9f\u0bae\u0bc8\u0b95\u0bcd\u0b95\",\n+    \"public_link\": \"\u0baa\u0bca\u0ba4\u0bc1 \u0b87\u0ba3\u0bc8\u0baa\u0bcd\u0baa\u0bc1\",\n+    \"error\": \"\u0baa\u0bbf\u0bb4\u0bc8 \u0b8f\u0bb1\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1\",\n+    \"passwords_dont_match\": \"\u0b95\u0b9f\u0bb5\u0bc1\u0b9a\u0bcd\u0b9a\u0bca\u0bb1\u0bcd\u0b95\u0bb3\u0bcd \u0baa\u0bca\u0bb0\u0bc1\u0ba8\u0bcd\u0ba4\u0bb5\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8\",\n+    \"invitation_link\": \"\u0b85\u0bb4\u0bc8\u0baa\u0bcd\u0baa\u0bbf\u0ba4\u0bb4\u0bcd \u0b87\u0ba3\u0bc8\u0baa\u0bcd\u0baa\u0bc1\",\n+    \"reset_invitation_link\": \"\u0b85\u0bb4\u0bc8\u0baa\u0bcd\u0baa\u0bbf\u0ba4\u0bb4\u0bcd \u0b87\u0ba3\u0bc8\u0baa\u0bcd\u0baa\u0bc8 \u0bae\u0bc0\u0b9f\u0bcd\u0b9f\u0bae\u0bc8\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"invitation_welcome\": \"\u0b9a\u0bc2\u0b9a\u0bbe\u0bae\u0bbf\u0bb2\u0bcd \u0bb5\u0bb0\u0bb5\u0bc7\u0bb1\u0bcd\u0b95\u0bbf\u0bb1\u0bcb\u0bae\u0bcd. \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0bb2\u0bcd \u0b9a\u0bc7\u0bb0\u0bc1\u0bb5\u0ba4\u0bb1\u0bcd\u0b95\u0bc1 \u0bae\u0bc1\u0ba9\u0bcd \u0baa\u0ba4\u0bbf\u0bb5\u0bc1\u0baa\u0bc6\u0bb1\u0bc1\u0b95.\",\n+    \"signup\": \"\u0baa\u0ba4\u0bbf\u0bb5\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0b95\",\n+    \"create_a_group\": \"\u0b92\u0bb0\u0bc1 \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bc8 \u0b89\u0bb0\u0bc1\u0bb5\u0bbe\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"create_the_group\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bc8 \u0b89\u0bb0\u0bc1\u0bb5\u0bbe\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"quit_group\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bc8 \u0bb5\u0bbf\u0b9f\u0bcd\u0b9f\u0bc1 \u0bb5\u0bbf\u0b9f\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"settings_updated\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b85\u0bae\u0bc8\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd \u0baa\u0bc1\u0ba4\u0bc1\u0baa\u0bcd\u0baa\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba9\",\n+    \"group_updated\": \"\u0b95\u0bc1\u0bb4\u0bc1 \u0baa\u0bc1\u0ba4\u0bc1\u0baa\u0bcd\u0baa\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1.\",\n+    \"group_left\": \"\u0ba8\u0bc0\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bc8 \u0bb5\u0bbf\u0b9f\u0bcd\u0b9f\u0bc1 \u0bb5\u0bc6\u0bb3\u0bbf\u0baf\u0bc7\u0bb1\u0bbf\u0ba9\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bcd.\",\n+    \"multiple_photos_upload\": \"\u0baa\u0bbf\u0bb4\u0bc8 \u0b8f\u0bb1\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1. \u0baa\u0b9f\u0b99\u0bcd\u0b95\u0bb3\u0bc8 \u0b92\u0bb5\u0bcd\u0bb5\u0bca\u0ba9\u0bcd\u0bb1\u0bbe\u0b95 \u0baa\u0ba4\u0bbf\u0bb5\u0bc7\u0bb1\u0bcd\u0bb1 \u0bae\u0bc1\u0baf\u0bb1\u0bcd\u0b9a\u0bbf\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd (\u0b87\u0ba4\u0bc1 \u0b9a\u0bbf\u0bb2 \u0b89\u0bb2\u0bbe\u0bb5\u0bbf\u0b95\u0bb3\u0bbf\u0bb2\u0bcd \u0ba8\u0bbf\u0b95\u0bb4\u0bb2\u0bbe\u0bae\u0bcd)\",\n+    \"error_new_message\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0b85\u0ba9\u0bc1\u0baa\u0bcd\u0baa\u0bc1\u0bae\u0bcd\u0baa\u0bcb\u0ba4\u0bc1 \u0baa\u0bbf\u0bb4\u0bc8 \u0b8f\u0bb1\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1.\",\n+    \"error_upload\": \"\u0baa\u0ba4\u0bbf\u0bb5\u0bc7\u0bb1\u0bcd\u0bb1\u0ba4\u0bcd\u0ba4\u0bbf\u0ba9\u0bcd \u0baa\u0bcb\u0ba4\u0bc1 \u0baa\u0bbf\u0bb4\u0bc8 \u0b8f\u0bb1\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1\",\n+    \"cancel_write\": \"\u0baa\u0bc1\u0ba4\u0bbf\u0baf \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0b8e\u0bb4\u0bc1\u0ba4\u0bc1\u0bb5\u0ba4\u0bc8 \u0bb0\u0ba4\u0bcd\u0ba4\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0baf \u0bb5\u0bbf\u0bb0\u0bc1\u0bae\u0bcd\u0baa\u0bc1\u0b95\u0bbf\u0bb1\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bbe?\",\n+    \"empty_message\": \"\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf \u0b95\u0bbe\u0bb2\u0bbf\u0baf\u0bbe\u0b95 \u0b89\u0bb3\u0bcd\u0bb3\u0ba4\u0bc1 \u0bae\u0bb1\u0bcd\u0bb1\u0bc1\u0bae\u0bcd \u0b85\u0ba9\u0bc1\u0baa\u0bcd\u0baa \u0bae\u0bc1\u0b9f\u0bbf\u0baf\u0bbe\u0ba4\u0bc1.\",\n+    \"cancel\": \"\u0bb0\u0ba4\u0bcd\u0ba4\u0bc1\u0b9a\u0bc6\u0baf\u0bcd\",\n+    \"just_now\": \"\u0b87\u0baa\u0bcd\u0baa\u0bcb\u0ba4\u0bc1\",\n+    \"notification_emails\": \"\u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd \u0b85\u0bb1\u0bbf\u0bb5\u0bbf\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd\",\n+    \"none\": \"\u0b8e\u0ba4\u0bc1\u0bb5\u0bc1\u0bae\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8\",\n+    \"hourly\": \"\u0bae\u0ba3\u0bbf\u0ba8\u0bc7\u0bb0\u0ba4\u0bcd\u0ba4\u0bbf\u0bb1\u0bcd\u0b95\u0bc1\",\n+    \"daily\": \"\u0ba8\u0bbe\u0bb3\u0bcd\u0ba4\u0bcb\u0bb1\u0bc1\u0bae\u0bcd\",\n+    \"weekly\": \"\u0bb5\u0bbe\u0bb0\u0bbe\u0ba8\u0bcd\u0ba4\u0bbf\u0bb0\",\n+    \"monthly\": \"\u0bae\u0bbe\u0ba4\u0bbe\u0ba8\u0bcd\u0ba4\u0bbf\u0bb0\",\n+    \"notification_emails_stopped\": \"\u0bae\u0bbf\u0ba9\u0bcd\u0ba9\u0b9e\u0bcd\u0b9a\u0bb2\u0bcd \u0b85\u0bb1\u0bbf\u0bb5\u0bbf\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd \u0ba8\u0bbf\u0bb1\u0bc1\u0ba4\u0bcd\u0ba4\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba9!\",\n+    \"group_share_choice\": \"\u0b87\u0ba8\u0bcd\u0ba4 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8 \u0b8e\u0ba8\u0bcd\u0ba4 \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0bb1\u0bcd\u0b95\u0bc1 \u0b85\u0ba9\u0bc1\u0baa\u0bcd\u0baa \u0bb5\u0bbf\u0bb0\u0bc1\u0bae\u0bcd\u0baa\u0bc1\u0b95\u0bbf\u0bb1\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bcd?\",\n+    \"default_group\": \"\u0b87\u0baf\u0bb2\u0bcd\u0baa\u0bc1\u0ba8\u0bbf\u0bb2\u0bc8 \u0b95\u0bc1\u0bb4\u0bc1\",\n+    \"destroy_account\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0ba3\u0b95\u0bcd\u0b95\u0bc8 \u0ba8\u0bc0\u0b95\u0bcd\u0b95\u0bc1\",\n+    \"destroy_account_explain\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b95\u0ba3\u0b95\u0bcd\u0b95\u0bc8 \u0ba8\u0bc0\u0b95\u0bcd\u0b95\u0bbf\u0baf\u0ba4\u0bc1\u0bae\u0bcd, \u0ba4\u0bbf\u0bb0\u0bc1\u0bae\u0bcd\u0baa\u0bbf\u0b9a\u0bcd \u0b9a\u0bc6\u0bb2\u0bcd\u0bb5\u0ba4\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8. \u0ba4\u0baf\u0bb5\u0bc1\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bc1 \u0b89\u0bb1\u0bc1\u0ba4\u0bbf\u0baf\u0bbe\u0b95 \u0b87\u0bb0\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd.\",\n+    \"are_you_sure\": \"\u0ba8\u0bc0 \u0b9a\u0bc6\u0bbe\u0bb2\u0bcd\u0bb5\u0ba4\u0bc1 \u0b89\u0bb1\u0bc1\u0ba4\u0bbf\u0baf\u0bbe?\",\n+    \"share_message\": \"\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0baf\u0bc8\u0baa\u0bcd \u0baa\u0b95\u0bbf\u0bb0\u0bb5\u0bc1\u0bae\u0bcd\",\n+    \"users\": \"\u0baa\u0baf\u0ba9\u0bb0\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"has_posted_in\": \"\u0b87\u0b9f\u0bc1\u0b95\u0bc8\u0baf\u0bbf\u0b9f\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0bc1\u0bb3\u0bcd\u0bb3\u0ba4\u0bc1\",\n+    \"has_commented_on\": \"\u0b95\u0bb0\u0bc1\u0ba4\u0bcd\u0ba4\u0bc1 \u0ba4\u0bc6\u0bb0\u0bbf\u0bb5\u0bbf\u0ba4\u0bcd\u0ba4\u0bc1\u0bb3\u0bcd\u0bb3\u0ba4\u0bc1\",\n+    \"has_joined\": \"\u0b9a\u0bc7\u0bb0\u0bcd\u0ba8\u0bcd\u0ba4\u0bc1\u0bb3\u0bcd\u0bb3\u0bbe\u0bb0\u0bcd\",\n+    \"has_left\": \"\u0baa\u0bc7\u0bbe\u0baf\u0bcd \u0bb5\u0bbf\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1\",\n+    \"the_message_from\": \"\u0b87\u0bb0\u0bc1\u0ba8\u0bcd\u0ba4\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\",\n+    \"in\": \"\u0b87\u0bb2\u0bcd\",\n+    \"lang\": \"\u0bae\u0bca\u0bb4\u0bbf\",\n+    \"replies_other\": \"{{count}} \u0baa\u0ba4\u0bbf\u0bb2\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"publish_in_group\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0bb2\u0bcd \u0bb5\u0bc6\u0bb3\u0bbf\u0baf\u0bbf\u0b9f\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"search_in_group\": \"\u0b87\u0ba8\u0bcd\u0ba4 \u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0bb2\u0bcd \u0ba4\u0bc7\u0b9f\u0bc1\u0b99\u0bcd\u0b95\u0bb3\u0bcd\",\n+    \"changed_group_name\": \"\u0b95\u0bc1\u0bb4\u0bc1\u0bb5\u0bbf\u0ba9\u0bcd \u0baa\u0bc6\u0baf\u0bb0\u0bc8 \u0bae\u0bbe\u0bb1\u0bcd\u0bb1\u0bbf\u0baf\u0ba4\u0bc1\",\n+    \"to\": \"\u0baa\u0bc6\u0bb1\u0bc1\u0ba8\u0bb0\u0bcd\",\n+    \"notifications\": \"\u0b85\u0bb1\u0bbf\u0bb5\u0bbf\u0baa\u0bcd\u0baa\u0bc1\u0b95\u0bb3\u0bcd\",\n+    \"mark_all_as_read\": \"\u0b85\u0ba9\u0bc8\u0ba4\u0bcd\u0ba4\u0bc8\u0baf\u0bc1\u0bae\u0bcd \u0bb5\u0bbe\u0b9a\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bbe\u0b95 \u0b85\u0b9f\u0bc8\u0baf\u0bbe\u0bb3\u0bae\u0bbf\u0b9f\u0bc1\",\n+    \"search_without_result\": \"\u0b89\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0ba4\u0bc7\u0b9f\u0bb2\u0bcd \u0b8e\u0ba8\u0bcd\u0ba4 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\u0b95\u0bcd\u0b95\u0bc1\u0bae\u0bcd \u0baa\u0bca\u0bb0\u0bc1\u0ba8\u0bcd\u0ba4\u0bb5\u0bbf\u0bb2\u0bcd\u0bb2\u0bc8.\",\n+    \"add_bookmark\": \"\u0baa\u0bc1\u0b95\u0bcd\u0bae\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bc1 \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\",\n+    \"remove_bookmark\": \"\u0baa\u0bc1\u0ba4\u0bcd\u0ba4\u0b95\u0bae\u0bb0\u0bae\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\",\n+    \"bookmarks\": \"\u0baa\u0bc1\u0b95\u0bcd\u0bae\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bc1\u0b95\u0bb3\u0bcd\",\n+    \"api_key\": \"\u0baa\u0ba8\u0bbf\u0b87 \u0bb5\u0bbf\u0b9a\u0bc8\",\n+    \"reset_api_key\": \"\u0baa\u0ba8\u0bbf\u0b87 \u0bb5\u0bbf\u0b9a\u0bc8\u0baf\u0bc8 \u0bae\u0bc0\u0b9f\u0bcd\u0b9f\u0bae\u0bc8\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd (\u0ba8\u0bc0\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0ba4\u0bc1\u0ba3\u0bcd\u0b9f\u0bbf\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bc1\u0bb5\u0bc0\u0bb0\u0bcd\u0b95\u0bb3\u0bcd)\",\n+    \"video_not_ready\": \"\u0bb5\u0bc0\u0b9f\u0bbf\u0baf\u0bcb \u0b87\u0ba9\u0bcd\u0ba9\u0bc1\u0bae\u0bcd \u0ba4\u0baf\u0bbe\u0bb0\u0bbe\u0b95 \u0b87\u0bb2\u0bcd\u0bb2\u0bc8.\",\n+    \"bookmark_removed\": \"\u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf \u0baa\u0bc1\u0b95\u0bcd\u0bae\u0bbe\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bc1 \u0ba8\u0bc0\u0b95\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0b9f\u0bcd\u0b9f\u0ba4\u0bc1.\",\n+    \"parent_message\": \"\u0baa\u0bc6\u0bb1\u0bcd\u0bb1\u0bcb\u0bb0\u0bcd \u0b9a\u0bc6\u0baf\u0bcd\u0ba4\u0bbf\",\n+    \"audio_not_ready\": \"\u0b86\u0b9f\u0bbf\u0baf\u0bcb \u0b87\u0ba9\u0bcd\u0ba9\u0bc1\u0bae\u0bcd \u0ba4\u0baf\u0bbe\u0bb0\u0bbe\u0b95 \u0b87\u0bb2\u0bcd\u0bb2\u0bc8.\",\n+    \"upload_audio\": \"\u0b86\u0b9f\u0bbf\u0baf\u0bcb \u0b95\u0bcb\u0baa\u0bcd\u0baa\u0bc8\u0b9a\u0bcd \u0b9a\u0bc7\u0bb0\u0bcd\u0b95\u0bcd\u0b95\u0bb5\u0bc1\u0bae\u0bcd.\"\n+}"
            },
            {
                "sha": "0967ef424bce6791893e9a57bb952f80fd536e93",
                "filename": "app/src/lang/tr_TR.json",
                "status": "added",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Ftr_TR.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Ftr_TR.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Ftr_TR.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1 @@\n+{}"
            },
            {
                "sha": "41287eecb150611555f0daac11da835af4f77433",
                "filename": "app/src/lang/zgh.json",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fzgh.json",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Flang%2Fzgh.json",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Flang%2Fzgh.json?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -25,7 +25,7 @@\n     \"title_placeholder\": \"\u2d30\u2d63\u2d61\u2d4d \u2d4f \u2d5c\u2d31\u2d54\u2d30\u2d5c \u2d4f\u2d4f\u2d3d (\u2d30\u2d54\u2d53\u2d5b\u2d5b\u2d49\u2d4d)\",\n     \"upload_image\": \"\u2d54\u2d4f\u2d53 \u2d5c\u2d49\u2d61\u2d4d\u2d30\u2d3c\u2d49\u2d4f\",\n     \"upload_video\": \"\u2d54\u2d4f\u2d53 \u2d49\u2d3c\u2d49\u2d37\u2d62\u2d53\u2d5c\u2d4f\",\n-    \"upload_pdf\": \"\u2d54\u2d4f\u2d53 pdf\",\n+    \"upload_pdf\": \"\u2d54\u2d4f\u2d53 PDF\",\n     \"add_date\": \"\u2d54\u2d4f\u2d53 \u2d3d\u2d54\u2d30 \u2d4f \u2d53\u2d59\u2d30\u2d3d\u2d53\u2d37\",\n     \"logout\": \"\u2d3c\u2d3c\u2d56\",\n     \"settings\": \"\u2d5c\u2d49\u2d59\u2d56\u2d30\u2d4d\","
            },
            {
                "sha": "8fa122278f089ee853fe65be43de60a72c23fedb",
                "filename": "app/src/scss/_embed.scss",
                "status": "modified",
                "additions": 3,
                "deletions": 1,
                "changes": 4,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_embed.scss",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_embed.scss",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Fscss%2F_embed.scss?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,3 +1,5 @@\n+@use 'sass:map';\n+\n .embed-preview {\n     display: inline-block;\n     max-width: 100%;\n@@ -239,7 +241,7 @@\n }\n \n .bandcamp-embed {\n-    @media (min-width: map-get($grid-breakpoints, \"md\")) {\n+    @media (min-width: map.get($grid-breakpoints, \"md\")) {\n         width: 450px;\n         height: 570px;\n         padding: 0 !important;"
            },
            {
                "sha": "d87a3d45feed6a261ceb720290b24dda7a53ffb8",
                "filename": "app/src/scss/_message.scss",
                "status": "modified",
                "additions": 6,
                "deletions": 6,
                "changes": 12,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_message.scss",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_message.scss",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Fscss%2F_message.scss?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -225,7 +225,7 @@\n       flex-flow: column;\n       width: calc(100% - 5rem);\n \n-      @media (max-width: map-get($grid-breakpoints, \"md\")) {\n+      @media (max-width: map.get($grid-breakpoints, \"md\")) {\n         width: 100%;\n       }\n     }\n@@ -239,7 +239,7 @@\n       font-size: .7rem;\n       width: 5rem;\n \n-      @media (min-width: map-get($grid-breakpoints, \"md\")) {\n+      @media (min-width: map.get($grid-breakpoints, \"md\")) {\n         .infos {\n           display: none;\n         }\n@@ -281,7 +281,7 @@\n       }\n     }\n \n-    @media (max-width: map-get($grid-breakpoints, \"md\")) {\n+    @media (max-width: map.get($grid-breakpoints, \"md\")) {\n       background-color: #fff;\n       flex-direction: column;\n       box-shadow: $material-shadow;\n@@ -313,7 +313,7 @@\n     margin: 1rem;\n     background: linear-gradient(15deg, #999, #ddd);\n \n-    @media (max-width: map-get($grid-breakpoints, \"sm\")) {\n+    @media (max-width: map.get($grid-breakpoints, \"sm\")) {\n       margin: 1rem 0;\n     }\n   }\n@@ -324,11 +324,11 @@\n     position: relative;\n     max-width: 320px;\n \n-    @media (min-width: map-get($grid-breakpoints, \"sm\")) and (max-width: map-get($grid-breakpoints, \"md\")) {\n+    @media (min-width: map.get($grid-breakpoints, \"sm\")) and (max-width: map.get($grid-breakpoints, \"md\")) {\n       max-width: 250px;\n     }\n \n-    @media (max-width: map-get($grid-breakpoints, \"sm\")) {\n+    @media (max-width: map.get($grid-breakpoints, \"sm\")) {\n       margin: 1rem 0;\n     }\n "
            },
            {
                "sha": "ad954775e02ea13bc07d9940eb971c000e49d23e",
                "filename": "app/src/scss/_search_results.scss",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_search_results.scss",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_search_results.scss",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Fscss%2F_search_results.scss?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -5,7 +5,7 @@\n         margin: 1rem;\n         background: linear-gradient(15deg, #999, #ddd);\n \n-        @media (max-width: map-get($grid-breakpoints, \"sm\")) {\n+        @media (max-width: map.get($grid-breakpoints, \"sm\")) {\n             margin: 1rem 0;\n         }\n     }\n@@ -15,7 +15,7 @@\n         margin: 1rem;\n         position: relative;\n \n-        @media (max-width: map-get($grid-breakpoints, \"sm\")) {\n+        @media (max-width: map.get($grid-breakpoints, \"sm\")) {\n             margin: 1rem 0;\n         }\n "
            },
            {
                "sha": "a2b5a3a17a054a90b5d7ecd6148f4ae63a263f65",
                "filename": "app/src/scss/_settings.scss",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_settings.scss",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_settings.scss",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Fscss%2F_settings.scss?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,6 +1,6 @@\n .settings {\n     form {\n-        @media (max-width: map-get($grid-breakpoints, \"sm\")) {\n+        @media (max-width: map.get($grid-breakpoints, \"sm\")) {\n             border: none !important;\n             padding-left: 0;\n         }"
            },
            {
                "sha": "b55097f69bbd17870c3f3c7a7ec36f8b9541a1e0",
                "filename": "app/src/scss/_writer.scss",
                "status": "modified",
                "additions": 4,
                "deletions": 4,
                "changes": 8,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_writer.scss",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2F_writer.scss",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Fscss%2F_writer.scss?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,4 +1,5 @@\n @use 'sass:color';\n+@use 'sass:map';\n \n .remove-button {\n     display: none;\n@@ -86,9 +87,8 @@\n             }\n \n             .cancel {\n-                border-color: #f7a71b;\n                 color: #f7a71b;\n-                border: 1px solid;\n+                border: 1px solid #f7a71b;\n                 background-color: white;\n                 padding: 3px 9px;\n             }\n@@ -112,14 +112,14 @@\n     width: 100%;\n }\n \n-@media (min-width: map-get($grid-breakpoints, \"md\")) {\n+@media (min-width: map.get($grid-breakpoints, \"md\")) {\n     .children .message .writer {\n         margin-left: 5rem;\n         margin-bottom: 1rem;\n     }\n }\n \n-@media (min-width: map-get($grid-breakpoints, \"md\")) {\n+@media (min-width: map.get($grid-breakpoints, \"md\")) {\n     .message.child .writer {\n         position: relative;\n         top: 12px;"
            },
            {
                "sha": "b3257b90e01d68dcdd9beb071fc4a0dc8490e3fc",
                "filename": "app/src/scss/main.scss",
                "status": "modified",
                "additions": 3,
                "deletions": 2,
                "changes": 5,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2Fmain.scss",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fscss%2Fmain.scss",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Fscss%2Fmain.scss?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,4 +1,5 @@\n @use 'sass:list';\n+@use 'sass:map';\n \n // override boostraps variables here\n \n@@ -22,7 +23,7 @@ $grid-breakpoints: (\n     $gutter: 6px;\n \n     @each $value in $params {\n-        @media (min-width: #{map-get($grid-breakpoints, list.nth($value, 1))}) {\n+        @media (min-width: #{map.get($grid-breakpoints, list.nth($value, 1))}) {\n             width: calc((100% / #{list.nth($value, 2)}) - #{$gutter});\n         }\n     }\n@@ -59,7 +60,7 @@ $grid-breakpoints: (\n     unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;\n }\n \n-@media (max-width: map-get($grid-breakpoints, \"md\")) {\n+@media (max-width: map.get($grid-breakpoints, \"md\")) {\n     .container {\n         padding: 0;\n     }"
            },
            {
                "sha": "4c13545184a6ececeb675c47d612859468dfeebc",
                "filename": "app/src/settings/group-settings.component.js",
                "status": "modified",
                "additions": 25,
                "deletions": 23,
                "changes": 48,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fsettings%2Fgroup-settings.component.js",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/app%2Fsrc%2Fsettings%2Fgroup-settings.component.js",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/app%2Fsrc%2Fsettings%2Fgroup-settings.component.js?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,5 +1,5 @@\n import { h } from \"preact\";\n-import { alert, http, util, router } from \"/src/core\";\n+import { alert, http, util, router, api } from \"/src/core\";\n import { useStoreon } from \"storeon/preact\";\n import { useEffect, useState } from \"preact/hooks\";\n import { useTranslation } from \"react-i18next\";\n@@ -108,28 +108,30 @@ export default function GroupSettings() {\n                       {t(\"save_changes\")}\n                     </button>\n                   </form>\n-                  <form class=\"mb-1 border-bottom pb-1\">\n-                    <div class=\"form-group\">\n-                      <label for=\"inviteKey\">\n-                        {t(\"invitation_link\")}:{\" \"}\n-                      </label>\n-                      <input\n-                        type=\"text\"\n-                        name=\"inviteKey\"\n-                        value={\n-                          `${window.location.protocol}//${window.location.host}/invitation/${secretKey}`\n-                        }\n-                        class=\"form-control font-size-80\"\n-                        readonly=\"readonly\"\n-                      />\n-                    </div>\n-                    <button\n-                      class=\"btn btn-outline-secondary\"\n-                      onClick={resetSecretKey}\n-                    >\n-                      {t(\"reset_invitation_link\")}\n-                    </button>\n-                  </form>\n+                  {api?.info?.show?.group_invitation_links && (\n+                    <form class=\"mb-1 border-bottom pb-1\">\n+                      <div class=\"form-group\">\n+                        <label for=\"inviteKey\">\n+                          {t(\"invitation_link\")}:{\" \"}\n+                        </label>\n+                        <input\n+                          type=\"text\"\n+                          name=\"inviteKey\"\n+                          value={\n+                            `${window.location.protocol}//${window.location.host}/invitation/${secretKey}`\n+                          }\n+                          class=\"form-control font-size-80\"\n+                          readonly=\"readonly\"\n+                        />\n+                      </div>\n+                      <button\n+                        class=\"btn btn-outline-secondary\"\n+                        onClick={resetSecretKey}\n+                      >\n+                        {t(\"reset_invitation_link\")}\n+                      </button>\n+                    </form>\n+                  )}\n                   <form>\n                     <button\n                       onClick={e => leaveGroup(e)}"
            },
            {
                "sha": "cb3a848b5160666fd7d960bc5d86175e1156ccfe",
                "filename": "container/dev_run.sh",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdev_run.sh",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdev_run.sh",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fdev_run.sh?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -2,5 +2,5 @@\n \n set -xe\n \n-chown -R \"$UID:$GID\" /zusam /etc/s6.d /etc/nginx /etc/php81\n+chown -R \"$UID:$GID\" /zusam /etc/s6.d /etc/nginx /etc/php83\n su-exec \"$UID:$GID\" /bin/bash"
            },
            {
                "sha": "9736afc92f4bdd8b60e05379c15bed06e2a5569b",
                "filename": "container/dockerfile/base.docker",
                "status": "modified",
                "additions": 4,
                "deletions": 1,
                "changes": 5,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fbase.docker",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fbase.docker",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fdockerfile%2Fbase.docker?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,4 +1,7 @@\n-FROM alpine:3.18\n+// The lastest version number can be found at:\n+// https://hub.docker.com/_/alpine\n+\n+FROM alpine:3.20\n \n RUN apk add --no-cache -U tini s6\n ENTRYPOINT [\"/sbin/tini\", \"--\"]"
            },
            {
                "sha": "b6eb35d337d80abfd504d1f5c3af11de0a60fa94",
                "filename": "container/dockerfile/dev.docker",
                "status": "modified",
                "additions": 2,
                "deletions": 30,
                "changes": 32,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fdev.docker",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fdev.docker",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fdockerfile%2Fdev.docker?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -4,41 +4,15 @@\n WORKDIR /zusam\n \n #include \"packages.docker\"\n+#include \"php-packages.docker\"\n #include \"zusam-files.docker\"\n #include \"setup.docker\"\n \n EXPOSE 8080\n VOLUME /zusam/data\n CMD [\"dev_run.sh\"]\n \n-RUN set -xe && apk add --no-cache \\\\\n-    ffmpeg \\\\\n-    imagemagick \\\\\n-    nginx \\\\\n-    openssl \\\\\n-    php81 \\\\\n-    php81-common \\\\\n-    php81-ctype \\\\\n-    php81-curl \\\\\n-    php81-dom \\\\\n-    php81-fileinfo \\\\\n-    php81-fpm \\\\\n-    php81-iconv \\\\\n-    php81-intl \\\\\n-    php81-json \\\\\n-    php81-mbstring \\\\\n-    php81-opcache \\\\\n-    php81-openssl \\\\\n-    php81-pdo_sqlite \\\\\n-    php81-pecl-apcu \\\\\n-    php81-pecl-imagick \\\\\n-    php81-phar \\\\\n-    php81-posix \\\\\n-    php81-session \\\\\n-    php81-simplexml \\\\\n-    php81-tokenizer \\\\\n-    php81-xml \\\\\n-    php81-xmlwriter\n+// The following are additional packages useful during dev\n \n RUN set -xe && apk add --no-cache \\\\\n     acl \\\\\n@@ -51,11 +25,9 @@ RUN set -xe && apk add --no-cache \\\\\n     npm \\\\\n     openssh \\\\\n     openssl \\\\\n-    php81-phar \\\\\n     rsync \\\\\n     sqlite \\\\\n     sudo \\\\\n     unzip \\\\\n     wget \\\\\n-    yarn \\\\\n     zip"
            },
            {
                "sha": "af5cbf08ae4ff8996608136034806217e0196063",
                "filename": "container/dockerfile/packages.docker",
                "status": "modified",
                "additions": 1,
                "deletions": 24,
                "changes": 25,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fpackages.docker",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fpackages.docker",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fdockerfile%2Fpackages.docker?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -3,27 +3,4 @@ RUN set -xe && apk add --no-cache \\\\\n     imagemagick \\\\\n     nginx \\\\\n     openssl \\\\\n-    php81 \\\\\n-    php81-common \\\\\n-    php81-ctype \\\\\n-    php81-curl \\\\\n-    php81-dom \\\\\n-    php81-fileinfo \\\\\n-    php81-fpm \\\\\n-    php81-iconv \\\\\n-    php81-intl \\\\\n-    php81-json \\\\\n-    php81-mbstring \\\\\n-    php81-opcache \\\\\n-    php81-openssl \\\\\n-    php81-pdo_sqlite \\\\\n-    php81-pecl-apcu \\\\\n-    php81-pecl-imagick \\\\\n-    php81-posix \\\\\n-    php81-session \\\\\n-    php81-simplexml \\\\\n-    php81-tokenizer \\\\\n-    php81-xml \\\\\n-    php81-xmlwriter \\\\\n-    su-exec \\\\\n-    && ln -sf /usr/bin/php81 /usr/bin/php\n+    su-exec"
            },
            {
                "sha": "9c47934353f7be1a0dacbcdfcc77053162838056",
                "filename": "container/dockerfile/php-packages.docker",
                "status": "added",
                "additions": 30,
                "deletions": 0,
                "changes": 30,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fphp-packages.docker",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fphp-packages.docker",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fdockerfile%2Fphp-packages.docker?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -0,0 +1,30 @@\n+// The correct PHP version can be found at\n+// https://pkgs.alpinelinux.org/packages?name=php%3F%3F&branch=v3.20&repo=&arch=x86_64&origin=yes\n+// (Switch the branch to the version specified in base.docker)\n+\n+RUN set -xe && apk add --no-cache \\\\\n+    php83 \\\\\n+    php83-common \\\\\n+    php83-ctype \\\\\n+    php83-curl \\\\\n+    php83-dom \\\\\n+    php83-fileinfo \\\\\n+    php83-fpm \\\\\n+    php83-iconv \\\\\n+    php83-intl \\\\\n+    php83-json \\\\\n+    php83-mbstring \\\\\n+    php83-opcache \\\\\n+    php83-openssl \\\\\n+    php83-pdo_sqlite \\\\\n+    php83-pecl-apcu \\\\\n+    php83-pecl-imagick \\\\\n+    php83-phar \\\\\n+    php83-posix \\\\\n+    php83-session \\\\\n+    php83-simplexml \\\\\n+    php83-tokenizer \\\\\n+    php83-xml \\\\\n+    php83-xmlwriter \\\\\n+    && ln -sf /usr/bin/php83 /usr/bin/php\n+"
            },
            {
                "sha": "a24834d961b2cff920d956417e2828171d948ef3",
                "filename": "container/dockerfile/prod.docker",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fprod.docker",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fprod.docker",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fdockerfile%2Fprod.docker?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -4,6 +4,7 @@\n WORKDIR /zusam\n \n #include \"packages.docker\"\n+#include \"php-packages.docker\"\n #include \"zusam-files.docker\"\n #include \"setup.docker\"\n "
            },
            {
                "sha": "f6730f4da298097fd413e8e74ed3281a734f141a",
                "filename": "container/dockerfile/setup.docker",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fsetup.docker",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fsetup.docker",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fdockerfile%2Fsetup.docker?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -2,8 +2,8 @@ RUN set -xe \\\\\n     && addgroup -g $GID zusam \\\\\n     && adduser -D -G zusam -u $UID zusam \\\\\n     && mkdir -p /run/nginx /zusam/data /var/tmp/nginx /var/lib/nginx \\\\\n-    && apk add --no-cache --virtual .build-deps tar ca-certificates wget php81-phar unzip \\\\\n-    && COMPOSER_ALLOW_SUPERUSER=1 php81 /zusam/api/bin/composer install -d /zusam/api --no-dev --prefer-dist \\\\\n+    && apk add --no-cache --virtual .build-deps tar ca-certificates wget unzip \\\\\n+    && COMPOSER_ALLOW_SUPERUSER=1 php83 /zusam/api/bin/composer install -d /zusam/api --no-dev --prefer-dist \\\\\n     && rm -rf /zusam/data/data.db \\\\\n     && apk del .build-deps \\\\\n     && chmod -R 755 /usr/local/bin /etc/s6.d /var/lib/nginx /zusam/public /var/tmp/nginx"
            },
            {
                "sha": "9ee00f8436baab17bb442edb1468bc0baa8550a5",
                "filename": "container/dockerfile/zusam-files.docker",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fzusam-files.docker",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fdockerfile%2Fzusam-files.docker",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fdockerfile%2Fzusam-files.docker?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,6 +1,6 @@\n COPY container/s6.d /etc/s6.d\n COPY container/config /zusam/config\n-COPY container/php81 /etc/php81\n+COPY container/php83 /etc/php83\n COPY container/nginx /etc/nginx\n COPY container/run.sh /usr/local/bin/run.sh\n COPY container/dev_run.sh /usr/local/bin/dev_run.sh"
            },
            {
                "sha": "3a7a2a7b43161d6b110c92f1ae1e58ad613b34db",
                "filename": "container/nginx/nginx-root.conf",
                "status": "modified",
                "additions": 4,
                "deletions": 0,
                "changes": 4,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fnginx%2Fnginx-root.conf",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fnginx%2Fnginx-root.conf",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fnginx%2Fnginx-root.conf?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -37,6 +37,10 @@ http {\n \n         location /files {\n             expires 1M;\n+            # Should prevent scripts execution\n+            # (Inline css is allowed because browsers often inject their own styles for the content preview).\n+            add_header Content-Security-Policy \"default-src 'none'; style-src 'unsafe-inline'; sandbox\";\n+\n             try_files $uri =404;\n         }\n "
            },
            {
                "sha": "d2f4e3a6c05f89510819f3dff7cdf2f0b87ccf5f",
                "filename": "container/nginx/nginx-subpath.conf",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fnginx%2Fnginx-subpath.conf",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fnginx%2Fnginx-subpath.conf",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fnginx%2Fnginx-subpath.conf?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -37,6 +37,9 @@ http {\n \n             location @SUBPATH@/files {\n                 expires 1M;\n+                # Should prevent scripts execution\n+                # (Inline css is allowed because browsers often inject their own styles for the content preview).\n+                add_header Content-Security-Policy \"default-src 'none'; style-src 'unsafe-inline'; sandbox\";\n                 try_files $uri =404;\n             }\n "
            },
            {
                "sha": "6bb7772117edc94462cdb8621c6130d32174655a",
                "filename": "container/php83/conf.d/100-zusam.ini",
                "status": "renamed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fphp83%2Fconf.d%2F100-zusam.ini",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fphp83%2Fconf.d%2F100-zusam.ini",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fphp83%2Fconf.d%2F100-zusam.ini?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "previous_filename": "container/php81/conf.d/100-zusam.ini"
            },
            {
                "sha": "25386853a43908ed9d8713a4287e32e28cd5a985",
                "filename": "container/php83/php-fpm.conf",
                "status": "renamed",
                "additions": 0,
                "deletions": 0,
                "changes": 0,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fphp83%2Fphp-fpm.conf",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fphp83%2Fphp-fpm.conf",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fphp83%2Fphp-fpm.conf?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "previous_filename": "container/php81/php-fpm.conf"
            },
            {
                "sha": "11b209bb3efb86d2c5bdc669fc26bdf10162eb41",
                "filename": "container/run.sh",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Frun.sh",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Frun.sh",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Frun.sh?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -7,7 +7,7 @@ set -xe\n rm -rf $(find /etc/s6.d -name 'event')\n \n crontab -r\n-echo \"* * * * * php81 /zusam/api/bin/console zusam:cron > /dev/stdout\" | crontab -\n+echo \"* * * * * php83 /zusam/api/bin/console zusam:cron > /dev/stdout\" | crontab -\n \n DATABASE_URL=\"sqlite:///%kernel.project_dir%/../data/${DATABASE_NAME}\"\n \n@@ -50,5 +50,5 @@ else\n   ln -sfn /etc/nginx/nginx-root.conf /etc/nginx/nginx.conf\n fi\n \n-chown -R \"$UID:$GID\" /zusam /etc/s6.d /etc/nginx /etc/php81 /var/lib/nginx /var/log /run/nginx\n+chown -R \"$UID:$GID\" /zusam /etc/s6.d /etc/nginx /etc/php83 /var/lib/nginx /var/log /run/nginx\n su-exec \"$UID:$GID\" /bin/s6-svscan /etc/s6.d"
            },
            {
                "sha": "822fe527333462d6923592a035f14b212197404f",
                "filename": "container/s6.d/php/run",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fs6.d%2Fphp%2Frun",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/container%2Fs6.d%2Fphp%2Frun",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/container%2Fs6.d%2Fphp%2Frun?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -1,2 +1,2 @@\n #!/bin/sh\n-exec php-fpm81 --allow-to-run-as-root\n+exec php-fpm83 --allow-to-run-as-root"
            },
            {
                "sha": "6d74a963be4bbdc32553d19d22af79b00c5f0ca4",
                "filename": "documentation/debian-buster-apache.md",
                "status": "modified",
                "additions": 13,
                "deletions": 1,
                "changes": 14,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/documentation%2Fdebian-buster-apache.md",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/documentation%2Fdebian-buster-apache.md",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/documentation%2Fdebian-buster-apache.md?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -29,7 +29,7 @@ curl -Ls https://github.com/zusam/zusam/archive/refs/heads/master.tar.gz | tar x\n \n Let's copy the webapp in the public directory (you don't need to do this if you only want the api server running):\n ```\n-cp app/dist/* public/\n+cp -r app/dist/* public/\n ```\n \n Install the server dependencies:\n@@ -49,6 +49,17 @@ Replace `/etc/apache2/sites-available/000-default.conf` with the following:\n                 Require all granted\n                 FallbackResource /index.html\n         </Directory>\n+        <Directory /srv/zusam/public/files>\n+            Header set Content-Security-Policy \"default-src 'none'; style-src 'unsafe-inline'; sandbox\"\n+\n+            # Disable script execution\n+            Options -ExecCGI\n+            php_admin_flag engine off\n+\n+            # Try to serve the file, or return 404 if not found\n+            FallbackResource disabled\n+            ErrorDocument 404 /404.html\n+        </Directory>\n         <Directory /srv/zusam/public/api>\n                 FallbackResource /api/index.php\n         </Directory>\n@@ -59,6 +70,7 @@ Replace `/etc/apache2/sites-available/000-default.conf` with the following:\n ```\n \n Set `upload_max_filesize` and `post_max_size` to `2048M` in `/etc/php/8.1/apache2/php.ini`.  \n+Activate the headers module with: `sudo a2enmod headers`.  \n And then restart apache with `sudo systemctl restart apache2`.\n \n Initialiaze the database (replace values with yours):"
            },
            {
                "sha": "f9c94179e540c573eac39b1d8abe9775a9dcc537",
                "filename": "documentation/debian-buster-nginx.md",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/zusam/zusam/blob/5930fdf86fa4abed01f0b345c8ec3c443656db9a/documentation%2Fdebian-buster-nginx.md",
                "raw_url": "https://github.com/zusam/zusam/raw/5930fdf86fa4abed01f0b345c8ec3c443656db9a/documentation%2Fdebian-buster-nginx.md",
                "contents_url": "https://api.github.com/repos/zusam/zusam/contents/documentation%2Fdebian-buster-nginx.md?ref=5930fdf86fa4abed01f0b345c8ec3c443656db9a",
                "patch": "@@ -55,6 +55,7 @@ server {\n     }\n     location /files {\n         expires 1M;\n+        add_header Content-Security-Policy \"default-src 'none'; style-src 'unsafe-inline'; sandbox\";\n         try_files $uri =404;\n     }\n     location /api {"
            }
        ]
    },
    {
        "query_url": "https://api.github.com/repos/oakserver/oak/commits/4b2f27efd5cba5a45b2c3982e610da3af0869209",
        "url": "https://api.github.com/repos/oakserver/oak/commits/4b2f27efd5cba5a45b2c3982e610da3af0869209",
        "html_url": "https://github.com/oakserver/oak/commit/4b2f27efd5cba5a45b2c3982e610da3af0869209",
        "message": "fix: decode path to avoid bypassing security checks",
        "files": [
            {
                "sha": "1ade88fe4f6ae406219ff3edbafd9c763a067aac",
                "filename": "send.test.ts",
                "status": "modified",
                "additions": 19,
                "deletions": 1,
                "changes": 20,
                "blob_url": "https://github.com/oakserver/oak/blob/4b2f27efd5cba5a45b2c3982e610da3af0869209/send.test.ts",
                "raw_url": "https://github.com/oakserver/oak/raw/4b2f27efd5cba5a45b2c3982e610da3af0869209/send.test.ts",
                "contents_url": "https://api.github.com/repos/oakserver/oak/contents/send.test.ts?ref=4b2f27efd5cba5a45b2c3982e610da3af0869209",
                "patch": "@@ -1,6 +1,10 @@\n // Copyright 2018-2024 the oak authors. All rights reserved. MIT license.\n \n-import { assertEquals, assertStrictEquals } from \"./deps_test.ts\";\n+import {\n+  assertEquals,\n+  assertRejects,\n+  assertStrictEquals,\n+} from \"./deps_test.ts\";\n import {\n   createMockApp,\n   createMockContext,\n@@ -13,6 +17,7 @@ import { assert, errors, eTag } from \"./deps.ts\";\n import type { RouteParams } from \"./router.ts\";\n import { send } from \"./send.ts\";\n import { isNode } from \"./utils/type_guards.ts\";\n+import { httpErrors } from \"./mod.ts\";\n \n function setup<\n   // deno-lint-ignore no-explicit-any\n@@ -482,3 +487,16 @@ Deno.test({\n     context.response.destroy();\n   },\n });\n+\n+Deno.test({\n+  name: \"send - security - decoding paths to subvert checks\",\n+  async fn() {\n+    const { context } = setup(\"/poc%2f../.test.json\");\n+    await assertRejects(async () => {\n+      await send(context, context.request.url.pathname, {\n+        root: \"./fixtures\",\n+        hidden: false,\n+      });\n+    }, httpErrors.NotFound);\n+  },\n+});"
            },
            {
                "sha": "bb8b4569ef0504a5725e743583a90c390c2193d8",
                "filename": "send.ts",
                "status": "modified",
                "additions": 2,
                "deletions": 2,
                "changes": 4,
                "blob_url": "https://github.com/oakserver/oak/blob/4b2f27efd5cba5a45b2c3982e610da3af0869209/send.ts",
                "raw_url": "https://github.com/oakserver/oak/raw/4b2f27efd5cba5a45b2c3982e610da3af0869209/send.ts",
                "contents_url": "https://api.github.com/repos/oakserver/oak/contents/send.ts?ref=4b2f27efd5cba5a45b2c3982e610da3af0869209",
                "patch": "@@ -30,7 +30,7 @@ import {\n } from \"./deps.ts\";\n import type { Response } from \"./response.ts\";\n import { isNode } from \"./utils/type_guards.ts\";\n-import { decodeComponent } from \"./utils/decode_component.ts\";\n+import { decode } from \"./utils/decode.ts\";\n import { resolvePath } from \"./utils/resolve_path.ts\";\n \n if (isNode()) {\n@@ -179,7 +179,7 @@ export async function send(\n     root,\n   } = options;\n   const trailingSlash = path[path.length - 1] === \"/\";\n-  path = decodeComponent(path.substring(parse(path).root.length));\n+  path = decode(path.substring(parse(path).root.length));\n   if (index && trailingSlash) {\n     path += index;\n   }"
            }
        ]
    }
]